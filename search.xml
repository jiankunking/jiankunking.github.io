<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Go è®¾è®¡æ¨¡å¼]]></title>
    <url>%2Fgo-solid-design.html</url>
    <content type="text"><![CDATA[Golang ä»£ç è®¾è®¡åŠè§„èŒƒ ä»£ç è¯„å®¡ä¸ºä»€ä¹ˆè¦ä»£ç è¯„å®¡ï¼Ÿ å¦‚æžœä»£ç è¯„å®¡æ˜¯è¦æ•æ‰ç³Ÿç³•çš„ä»£ç ï¼Œé‚£ä¹ˆä½ å¦‚ä½•çŸ¥é“ä½ å®¡æŸ¥çš„ä»£ç æ˜¯å¥½çš„è¿˜æ˜¯ç³Ÿç³•çš„ï¼Ÿ æˆ‘åœ¨æ‰¾ä¸€äº›å®¢è§‚çš„æ–¹å¼æ¥è°ˆè®ºä»£ç çš„å¥½åå±žæ€§ã€‚ ç³Ÿç³•çš„ä»£ç ä½ å¯èƒ½ä¼šåœ¨ä»£ç å®¡æŸ¥ä¸­é‡åˆ°ä»¥ä¸‹è¿™äº›ç³Ÿç³•çš„ä»£ç ï¼š Rigid - ä»£ç æ˜¯å¦æ­»æ¿ï¼Ÿå®ƒæ˜¯å¦æœ‰å¼ºç±»åž‹æˆ–å‚æ•°ä»¥è‡³äºŽä¿®æ”¹èµ·æ¥å¾ˆå›°éš¾ï¼Ÿ Fragile - ä»£ç æ˜¯å¦è„†å¼±ï¼Ÿå¯¹ä»£ç åšè½»å¾®çš„æ”¹å˜æ˜¯å¦å°±ä¼šå¼•èµ·ç¨‹åºæžå¤§çš„ç ´åï¼Ÿ Immobile - ä»£ç æ˜¯å¦å¾ˆéš¾é‡æž„ï¼Ÿ Complex - ä»£ç æ˜¯å¦è¿‡äºŽå¤æ‚ï¼Œæ˜¯å¦è¿‡åº¦è®¾è®¡ï¼Ÿ Verbose - ä»£ç æ˜¯å¦è¿‡äºŽå†—é•¿è€Œä½¿ç”¨èµ·æ¥å¾ˆè´¹åŠ²ï¼Ÿå½“æŸ¥é˜…ä»£ç æ˜¯å¦å¾ˆéš¾çœ‹å‡ºæ¥ä»£ç åœ¨åšä»€ä¹ˆï¼Ÿ å½“ä½ åšä»£ç å®¡æŸ¥çš„æ—¶å€™æ˜¯å¦ä¼šå¾ˆé«˜å…´çœ‹åˆ°è¿™äº›è¯è¯­ï¼Ÿ å½“ç„¶ä¸ä¼šã€‚ å¥½çš„è®¾è®¡å¦‚æžœæœ‰ä¸€äº›æè¿°ä¼˜ç§€çš„è®¾è®¡å±žæ€§çš„æ–¹å¼å°±æ›´å¥½äº†ï¼Œä¸ä»…ä»…æ˜¯ç³Ÿç³•çš„è®¾è®¡ï¼Œæ˜¯å¦èƒ½åœ¨å®¢è§‚æ¡ä»¶ä¸‹åšï¼Ÿ SOLIDåœ¨2002å¹´ï¼ŒRobert Martinçš„ã€ŠAgile Software Development, Principles, Patterns, and Practicesã€‹ä¹¦ä¸­æåˆ°äº†äº”ä¸ªå¯é‡ç”¨è½¯ä»¶è®¾è®¡çš„åŽŸåˆ™ - â€œSOLIDâ€ï¼ˆè‹±æ–‡é¦–å­—æ¯ç¼©ç•¥å­—ï¼‰: Single Responsibility Principle - å•ä¸€åŠŸèƒ½åŽŸåˆ™ Open/Closed Principle - å¼€é—­åŽŸåˆ™ Liskov Substitution Principle - é‡Œæ°æ›¿æ¢åŽŸåˆ™ Interface Segregation Principle - æŽ¥å£éš”ç¦»åŽŸåˆ™ Dependency Inversion Principle - ä¾èµ–åè½¬åŽŸåˆ™ è¿™æœ¬ä¹¦æœ‰ç‚¹ç‚¹è¿‡æ—¶ï¼Œä½¿ç”¨çš„è¯­è¨€ä¹Ÿæ˜¯åå¤šå¹´å‰çš„ã€‚ä½†æ˜¯ï¼Œæˆ–è®¸SOLIDåŽŸåˆ™çš„æŸäº›æ–¹é¢å¯ä»¥ç»™æˆ‘ä»¬ä¸€ä¸ªæœ‰å…³å¦‚ä½•è°ˆè®ºä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„Goè¯­è¨€ç¨‹åºçš„çº¿ç´¢ã€‚ Single Responsibility Principle A class should have one, and only one, reason to change. â€“Robert C Martin çŽ°åœ¨Goè¯­è¨€æ˜¾ç„¶æ²¡æœ‰classses - ç›¸åï¼Œæˆ‘ä»¬æœ‰æ›´ä¸ºå¼ºå¤§çš„ç»„åˆçš„æ¦‚å¿µ - ä½†æ˜¯å¦‚æžœä½ å¯ä»¥çœ‹åˆ°è¿‡åŽ»classçš„ä½¿ç”¨ï¼Œæˆ‘è®¤ä¸ºè¿™é‡Œæœ‰å…¶ä»·å€¼ã€‚ ä¸ºä»€ä¹ˆä¸€æ®µä»£ç åº”è¯¥åªæœ‰ä¸€ä¸ªåŽŸå› æ”¹å˜å¦‚æ­¤é‡è¦ï¼Ÿå½“ç„¶ï¼Œå’Œä½ è‡ªå·±çš„ä»£ç è¦ä¿®æ”¹æ¯”è¾ƒèµ·æ¥ï¼Œå‘çŽ°è‡ªå·±ä»£ç æ‰€ä¾èµ–çš„ä»£ç è¦ä¿®æ”¹ä¼šæ›´ä»¤äººå¤´ç–¼ã€‚è€Œä¸”ï¼Œå½“ä½ çš„ä»£ç ä¸å¾—ä¸è¦ä¿®æ”¹çš„æ—¶å€™ï¼Œå®ƒåº”è¯¥å¯¹ç›´æŽ¥çš„åˆºæ¿€æœ‰ååº”ï¼Œè€Œä¸åº”è¯¥æ˜¯ä¸€ä¸ªé—´æŽ¥ä¼¤å®³çš„å—å®³è€…ã€‚ æ‰€ä»¥ï¼Œä»£ç æœ‰å•ä¸€åŠŸèƒ½åŽŸåˆ™ä»Žè€Œæœ‰æœ€å°‘çš„åŽŸå› æ¥æ”¹å˜ã€‚ Coupling&amp;Cohesion - è€¦åˆä¸Žå†…èšè¿™ä¸¤ä¸ªè¯è¯­æç»˜äº†ä¿®æ”¹ä¸€æ®µè½¯ä»¶ä»£ç æ˜¯ä½•ç­‰çš„ç®€å•æˆ–å›°éš¾ã€‚ Coupling - è€¦åˆæ˜¯ä¸¤ä¸ªä¸œè¥¿ä¸€èµ·æ”¹å˜ - ä¸€ä¸ªç§»åŠ¨ä¼šå¼•å‘å¦ä¸€ä¸ªç§»åŠ¨ã€‚Cohesion - å†…èšæ˜¯ç›¸å…³è”ä½†åˆéš”ç¦»ï¼Œä¸€ç§ç›¸äº’å¸å¼•çš„åŠ›é‡ã€‚ åœ¨è½¯ä»¶æ–¹é¢ï¼Œå†…èšæ˜¯å½¢å®¹ä»£ç æ®µè‡ªç„¶å¸å¼•åˆ°å¦ä¸€ä¸ªçš„å±žæ€§ã€‚ è¦æè¿°Goè¯­è¨€çš„è€¦åˆä¸Žå†…èšï¼Œæˆ‘ä»¬å¯ä»¥è¦è°ˆè®ºä¸€ä¸‹functionså’Œmethodsï¼Œå½“è®¨è®ºå•ä¸€åŠŸèƒ½åŽŸåˆ™æ—¶å®ƒä»¬å¾ˆå¸¸è§ï¼Œä½†æ˜¯æˆ‘ç›¸ä¿¡å®ƒå§‹äºŽGoè¯­è¨€çš„packageæ¨¡åž‹ã€‚ Pakcageå‘½ååœ¨Goè¯­è¨€ä¸­ï¼Œæ‰€æœ‰çš„ä»£ç éƒ½åœ¨æŸä¸ªpackageä¸­ã€‚å¥½çš„packageè®¾è®¡å§‹äºŽä»–çš„å‘½åã€‚packageåå­—ä¸ä»…æè¿°äº†å®ƒçš„ç›®çš„è€Œä¸”è¿˜æ˜¯ä¸€ä¸ªå‘½åç©ºé—´çš„å‰ç¼€ã€‚Goè¯­è¨€æ ‡å‡†åº“é‡Œæœ‰ä¸€äº›å¥½çš„ä¾‹å­ï¼š net/http - æä¾›äº†httpå®¢æˆ·ç«¯å’ŒæœåŠ¡ os/exec - æ‰§è¡Œå¤–éƒ¨çš„å‘½ä»¤ encoding/json - å®žçŽ°äº†JSONçš„ç¼–ç ä¸Žè§£ç  åœ¨ä½ è‡ªå·±çš„é¡¹ç›®ä¸­ä½¿ç”¨å…¶ä»–pakcageæ—¶è¦ç”¨importå£°æ˜Žï¼Œå®ƒä¼šåœ¨ä¸¤ä¸ªpackageä¹‹é—´å»ºç«‹ä¸€ä¸ªæºç çº§çš„è€¦åˆã€‚ ç³Ÿç³•çš„pakcageå‘½åå…³æ³¨äºŽå‘½åå¹¶ä¸æ˜¯åœ¨å–å¼„ã€‚ç³Ÿç³•çš„å‘½åä¼šå¤±åŽ»ç½—åˆ—å…¶ç›®çš„çš„æœºä¼šã€‚ æ¯”å¦‚è¯´serverã€privateã€commonã€utils è¿™äº›ç³Ÿç³•çš„å‘½åéƒ½å¾ˆå¸¸è§ã€‚è¿™äº›packageå°±åƒæ˜¯ä¸€ä¸ªæ··æ‚çš„åœºæ‰€ï¼Œå› ä¸ºä»–ä»¬å¥½å¤šéƒ½æ˜¯æ²¡æœ‰åŽŸå› åœ°ç»å¸¸æ”¹å˜ã€‚ Goè¯­è¨€çš„UNIXå“²å­¦ä»¥æˆ‘çš„è§‚ç‚¹ï¼Œæ¶‰åŠåˆ°è§£è€¦è®¾è®¡å¿…é¡»è¦æåŠDoug Mcllroyçš„Unixå“²å­¦ï¼šå°å·§è€Œé”‹åˆ©çš„å·¥å…·çš„ç»“åˆè§£å†³æ›´å¤§çš„ä»»åŠ¡æˆ–è€…é€šå¸¸åŽŸåˆ›ä½œè€…å¹¶æ²¡æœ‰é¢„æƒ³åˆ°çš„ä»»åŠ¡ã€‚ æˆ‘è®¤ä¸ºGoè¯­è¨€çš„Packageä½“çŽ°äº†UNIXå“²å­¦ç²¾ç¥žã€‚å®žé™…ä¸Šæ¯ä¸ªpackageè‡ªèº«å°±æ˜¯ä¸€ä¸ªå…·æœ‰å•ä¸€åŽŸåˆ™çš„å˜åŒ–å•å…ƒçš„å°åž‹Goè¯­è¨€é¡¹ç›®ã€‚ Open/Closed PrincipleBertrand Meyeræ›¾ç»å†™é“ï¼š Software entities should be open for extension, but closed for modification. â€“Bertrand Meyer, Object-Oriented Software Construction è¯¥å»ºè®®å¦‚ä½•åº”ç”¨åˆ°çŽ°åœ¨çš„ç¼–ç¨‹è¯­è¨€ä¸Šï¼š 12345678910111213141516171819202122package maintype A struct &#123; year int&#125;func (a A) Greet() &#123; fmt.Println(&quot;Hello GolangUK&quot;, a.year) &#125;type B struct &#123; A&#125;func (b B) Greet() &#123; fmt.Println(&quot;Welcome to GolangUK&quot;, b.year) &#125;func main() &#123; var a A a.year = 2016 var b B b.year = 2016 a.Greet() // Hello GolangUK 2016 b.Greet() // Welcome to GolangUK 2016&#125; typeAæœ‰ä¸€ä¸ªyearå­—æ®µä»¥åŠGreetæ–¹æ³•ã€‚ typeBåµŒå…¥äº†Aåšä¸ºå­—æ®µï¼Œä»Žè€Œï¼Œä½¿Bæä¾›çš„Greetæ–¹æ³•é®è”½äº†Açš„ï¼Œè°ƒç”¨æ—¶å¯ä»¥çœ‹åˆ°Bçš„æ–¹æ³•è¦†ç›–äº†Aã€‚ ä½†æ˜¯åµŒå…¥ä¸ä»…ä»…æ˜¯å¯¹äºŽæ–¹æ³•ï¼Œå®ƒè¿˜èƒ½æä¾›åµŒå…¥typeçš„å­—æ®µè®¿é—®ã€‚å¦‚ä½ æ‰€è§ï¼Œç”±äºŽAå’ŒBéƒ½åœ¨åŒä¸€ä¸ªpackageå†…ï¼ŒBå¯ä»¥è®¿é—®Açš„ç§æœ‰yearå­—æ®µå°±åƒBå·²ç»å£°æ˜Žè¿‡ã€‚ å› æ­¤åµŒå…¥æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå®ƒå…è®¸Goè¯­è¨€typeå¯¹æ‰©å±•æ˜¯å¼€æ”¾çš„ã€‚ 1234567891011121314151617181920212223package maintype Cat struct &#123; Name string&#125;func (c Cat) Legs() int &#123; return 4 &#125;func (c Cat) PrintLegs() &#123; fmt.Printf(&quot;I have %d legs\n&quot;, c.Legs())&#125;type OctoCat struct &#123; Cat&#125;func (o OctoCat) Legs() int &#123; return 5 &#125;func main() &#123; var octo OctoCat fmt.Println(octo.Legs()) // 5 octo.PrintLegs() // I have 4 legs&#125; åœ¨ä¸Šè¾¹è¿™ä¸ªä¾‹å­ä¸­ï¼ŒtypeCatæœ‰Legsæ–¹æ³•æ¥è®¡ç®—å®ƒæœ‰å‡ æ¡è…¿ã€‚æˆ‘ä»¬åµŒå…¥Catåˆ°ä¸€ä¸ªæ–°çš„typeOctoCatä¸­ï¼Œå¹¶å£°æ˜ŽOctocatsæœ‰äº”æ¡è…¿ã€‚ç„¶è€Œï¼Œå°½ç®¡OctoCatå®šä¹‰äº†è‡ªå·±æœ‰äº”æ¡è…¿ï¼Œä½†æ˜¯PrintLegsæ–¹æ³•è¢«è°ƒç”¨æ—¶ä¼šè¿”å›ž4ã€‚ è¿™æ˜¯å› ä¸ºPrintLegsåœ¨typeCatä¸­å®šä¹‰ã€‚å®ƒä¼šå°†Catåšä¸ºå®ƒçš„æŽ¥æ”¶è€…ï¼Œå› æ­¤å®ƒä¼šä½¿ç”¨Catçš„Legsæ–¹æ³•ã€‚Catå¹¶ä¸äº†è§£å·²åµŒå…¥çš„typeï¼Œå› æ­¤å®ƒçš„åµŒå…¥æ–¹æ³•ä¸èƒ½è¢«ä¿®æ”¹ã€‚ ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è¯´Goè¯­è¨€çš„typeså¯¹æ‰©å±•å¼€æ”¾ï¼Œä½†æ˜¯å¯¹ä¿®æ”¹æ˜¯å…³é—­çš„ã€‚ äº‹å®žä¸Šï¼ŒGoè¯­è¨€æŽ¥æ”¶è€…çš„æ–¹æ³•ä»…ä»…æ˜¯å¸¦æœ‰é¢„å…ˆå£°æ˜Žå½¢å¼çš„å‚æ•°çš„functionçš„è¯­æ³•ç³–è€Œå·²ï¼š 1234567func (c Cat) PrintLegs() &#123; fmt.Printf(&quot;I have %d legs\n&quot;, c.Legs())&#125;func PrintLegs(c Cat) &#123; fmt.Printf(&quot;I have %d legs\n&quot;, c.Legs())&#125; ç¬¬ä¸€ä¸ªfunctionçš„æŽ¥æ”¶è€…å°±æ˜¯ä½ ä¼ è¿›åŽ»çš„å‚æ•°ï¼Œè€Œä¸”ç”±äºŽGoè¯­è¨€ä¸çŸ¥é“é‡è½½ï¼Œæ‰€ä»¥è¯´OctoCatså¹¶ä¸èƒ½æ›¿æ¢æ™®é€šçš„Catsï¼Œè¿™å°±å¼•å‡ºäº†æŽ¥ä¸‹æ¥ä¸€ä¸ªåŽŸåˆ™ï¼š Liskov Substitution Principleè¯¥åŽŸåˆ™ç”±Barbara Liskovæå‡ºï¼Œå¤§è‡´ä¸Š,å®ƒè§„å®šäº†ä¸¤ç§ç±»åž‹å¦‚æžœè°ƒç”¨è€…ä¸èƒ½åŒºåˆ†å‡ºä»–ä»¬è¡Œä¸ºçš„ä¸åŒï¼Œé‚£ä¹ˆä»–ä»¬æ˜¯å¯æ›¿ä»£çš„ã€‚ åŸºäºŽclassçš„ç¼–ç¨‹è¯­è¨€ï¼Œé‡Œæ°æ›¿æ¢åŽŸåˆ™é€šå¸¸è¢«è§£é‡Šä¸ºä¸€ä¸ªæŠ½è±¡åŸºç±»çš„å„ç§å…·ä½“å­ç±»çš„è§„èŒƒã€‚ä½†æ˜¯Goè¯­è¨€æ²¡æœ‰classæˆ–è€…inheritanceï¼ˆç»§æ‰¿ï¼‰ï¼Œå› æ­¤å°±ä¸èƒ½ä»¥æŠ½è±¡ç±»çš„å±‚æ¬¡ç»“æž„å®žçŽ°æ›¿æ¢ã€‚ Interfacesç›¸åï¼ŒGoè¯­è¨€çš„interfaceæ‰æœ‰æƒæ›¿æ¢ã€‚åœ¨Goè¯­è¨€ä¸­ï¼Œtypeä¸éœ€è¦å£°æ˜Žä»–ä»¬å…·ä½“è¦å®žçŽ°çš„æŸä¸ªinterfaceï¼Œç›¸åçš„ï¼Œä»»ä½•æƒ³è¦å®žçŽ°interfaceçš„typeä»…éœ€æä¾›ä¸Žinterfaceå£°æ˜Žæ‰€åŒ¹é…çš„æ–¹æ³•ã€‚ å°±Goè¯­è¨€è€Œè¨€ï¼Œéšå¼çš„interfaceè¦æ¯”æ˜¾å¼çš„æ›´ä»¤äººæ»¡æ„ï¼Œè¿™ä¹Ÿæ·±åˆ»åœ°å½±å“ç€ä»–ä»¬ä½¿ç”¨çš„æ–¹å¼ã€‚ ç²¾å¿ƒè®¾è®¡çš„interfaceæ›´å¯èƒ½æ˜¯å°å·§çš„ï¼Œæµè¡Œçš„åšæ³•æ˜¯ä¸€ä¸ªinterfaceåªåŒ…å«ä¸€ä¸ªæ–¹æ³•ã€‚é€»è¾‘ä¸Šæ¥è®²å°å·§çš„interfaceä½¿å®žçŽ°å˜å¾—ç®€å•ï¼Œåä¹‹å°±å¾ˆéš¾åšåˆ°ã€‚è¿™å°±å¯¼è‡´äº†ç”±å¸¸è§è¡Œä¸ºè¿žæŽ¥çš„ç®€å•å®žçŽ°è€Œç»„æˆçš„packageã€‚ io.Reader1234type Reader interface &#123; // Read reads up to len(buf) bytes into buf. Read(buf []byte) (n int, err error)&#125; æˆ‘æœ€å–œçˆ±çš„Goè¯­è¨€interface - io.Reader interface io.Readeréžå¸¸ç®€å•ï¼ŒReadè¯»å–æ•°æ®åˆ°æä¾›çš„bufferï¼Œå¹¶è¿”å›žè°ƒç”¨è€…è¯»å–æ•°æ®çš„bytesçš„æ•°é‡ä»¥åŠè¯»å–æœŸé—´çš„ä»»ä½•é”™è¯¯ã€‚å®ƒçœ‹èµ·æ¥ç®€å•ä½†æ˜¯å¾ˆå¼ºå¤§ã€‚ å› ä¸ºio.Readerå¯ä»¥å¤„ç†ä»»ä½•èƒ½è½¬æ¢ä¸ºbytesæµçš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•äº‹æƒ…ä¸Šæž„å»ºreadersï¼šstringå¸¸é‡ã€byteæ•°ç»„ã€æ ‡å‡†è¾“å…¥ã€ç½‘ç»œæ•°æ®æµã€gzipåŽçš„taræ–‡ä»¶ä»¥åŠé€šè¿‡sshè¿œç¨‹æ‰§è¡Œçš„å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºã€‚ æ‰€æœ‰è¿™äº›å®žçŽ°å¯¹äºŽå¦å¤–ä¸€ä¸ªéƒ½æ˜¯å¯æ›¿æ¢çš„ï¼Œå› ä¸ºä»–ä»¬éƒ½å±¥è¡Œäº†ç›¸åŒçš„ç®€å•åˆåŒã€‚ å› æ­¤ï¼Œé‡Œæ°æ›¿æ¢åŽŸåˆ™åœ¨Goè¯­è¨€çš„åº”ç”¨ï¼Œå¯ä»¥ç”¨ Jim Weirich çš„æ ¼è¨€æ¥æ€»ç»“ï¼š Require no more, promise no less. â€“Jim Weirich æŽ¥ä¸‹æ¥å°±åˆ°äº†â€SOLIDâ€ç¬¬å››ä¸ªåŽŸåˆ™ã€‚ Interface Segregation Principle Clients should not be forced to depend on methods they do not use. â€“Robert C. Martin åœ¨Goè¯­è¨€ä¸­ï¼ŒæŽ¥å£éš”ç¦»åŽŸåˆ™çš„åº”ç”¨æ˜¯æŒ‡ä¸€ä¸ªæ–¹æ³•æ¥å®Œæˆå…¶å·¥ä½œçš„å­¤ç«‹è¡Œä¸ºçš„è¿‡ç¨‹ã€‚ä¸¾ä¸ªâ€œæ —å­â€ï¼Œç¼–å†™æ–¹æ³•æ¥ä¿å­˜ä¸€ä¸ªæ–‡æ¡£ç»“æž„åˆ°ç£ç›˜çš„ä»»åŠ¡ã€‚ 12// Save writes the contents of doc to the file f.func Save(f *os.File, doc *Document) error æˆ‘å¯ä»¥è¿™æ ·å®šä¹‰è¿™ä¸ªSaveæ–¹æ³•ï¼Œä½¿ç”¨*os.Fileåšä¸ºä¿å­˜Documentçš„æ–‡ä»¶ã€‚ä½†æ˜¯è¿™æ ·åšä¼šæœ‰ä¸€äº›é—®é¢˜ã€‚ Saveæ–¹æ³•æŽ’é™¤äº†ä¿å­˜æ•°æ®åˆ°ç½‘ç»œä½ç½®çš„é€‰é¡¹ã€‚å‡å¦‚è¿‡åŽè¦åŠ å…¥ç½‘ç»œå‚¨å­˜çš„éœ€æ±‚ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•å°±éœ€è¦ä¿®æ”¹ä¹Ÿå°±æ„å‘³ç€è¦å½±å“åˆ°æ‰€æœ‰ä½¿ç”¨è¯¥æ–¹æ³•çš„è°ƒç”¨è€…ã€‚ å› ä¸ºSaveç›´æŽ¥åœ°æ“ä½œç£ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œæµ‹è¯•èµ·æ¥å¾ˆä¸æ–¹ä¾¿ã€‚è¦éªŒè¯å…¶æ“ä½œï¼Œæµ‹è¯•ä¸å¾—ä¸åœ¨æ–‡ä»¶è¢«å†™å…¥åŽè¯»å–å…¶å†…å®¹ã€‚å¦å¤–æµ‹è¯•å¿…é¡»ç¡®ä¿fè¢«å†™å…¥ä¸€ä¸ªä¸´æ—¶çš„ä½ç½®è€Œä¸”è¿‡åŽè¿˜è¦åˆ é™¤ã€‚ *os.Fileè¿˜åŒ…å«äº†è®¸å¤šè·ŸSaveæ— å…³çš„æ–¹æ³•ï¼Œåƒè¯»å–è·¯å¾„ä»¥åŠæ£€æŸ¥è·¯å¾„æ˜¯å¦æ˜¯è½¯è¿žæŽ¥ã€‚å¦‚æžœSaveæ–¹æ³•åªä½¿ç”¨*os.Fileç›¸å…³çš„éƒ¨åˆ†å°†ä¼šéžå¸¸æœ‰ç”¨ã€‚ æˆ‘ä»¬å¦‚ä½•åšå‘¢ï¼Ÿ 12// Save writes the contents of doc to the supplied ReadWriterCloser.func Save(rwc io.ReadWriteCloser, doc *Document) error ä½¿ç”¨io.ReadWriteCloseræ¥åº”ç”¨æŽ¥å£éš”ç¦»åŽŸåˆ™ï¼Œè¿™æ ·å°±é‡æ–°å®šä¹‰äº†Saveæ–¹æ³•ä½¿ç”¨ä¸€ä¸ªinterfaceæ¥æè¿°æ›´ä¸ºé€šç”¨çš„ç±»åž‹ã€‚ éšç€ä¿®æ”¹ï¼Œä»»ä½•å®žçŽ°äº†io.ReadWriteCloseræŽ¥å£çš„typeéƒ½å¯ä»¥ä»£æ›¿ä¹‹å‰çš„*os.Fileã€‚è¿™ä½¿å¾—Saveä¸ä»…æ‰©å±•äº†å®ƒçš„åº”ç”¨èŒƒå›´åŒæ—¶ä¹Ÿç»™Saveçš„è°ƒç”¨è€…è¯´æ˜Žäº†type *os.Fileå“ªäº›æ–¹æ³•æ˜¯æ“ä½œç›¸å…³çš„ã€‚ åšä¸ºSaveçš„ä½œè€…ï¼Œæˆ‘æ²¡æœ‰äº†åœ¨*os.Fileä¸Šè°ƒç”¨æ— å…³çš„æ–¹æ³•é€‰é¡¹äº†ï¼Œå› ä¸ºä»–ä»¬éƒ½è¢«éšè—äºŽio.ReadWriteCloseræŽ¥å£ã€‚æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥åœ°åº”ç”¨æŽ¥å£éš”ç¦»åŽŸåˆ™ã€‚ é¦–å…ˆï¼ŒSaveæ–¹æ³•ä¸å¤ªå¯èƒ½ä¼šä¿æŒå•ä¸€åŠŸèƒ½åŽŸåˆ™ï¼Œå› ä¸ºå®ƒè¦è¯»å–çš„æ–‡ä»¶å†…å®¹åº”è¯¥æ˜¯å¦å¤–ä¸€æ®µä»£ç çš„è´£ä»»ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ç¼©å°æŽ¥å£èŒƒå›´ï¼Œåªä¼ å…¥writingå’Œclosingã€‚ 12// Save writes the contents of doc to the supplied WriteCloser.func Save(wc io.WriteCloser, doc *Document) error å…¶æ¬¡ï¼Œé€šè¿‡å‘Saveæä¾›ä¸€ç§æœºåˆ¶æ¥å…³é—­å®ƒçš„æ•°æ®æµï¼Œä¼šå¯¼è‡´å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šwcä¼šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å…³é—­ã€‚Saveå¯èƒ½ä¼šæ— æ¡ä»¶çš„è°ƒç”¨Closeæˆ–åœ¨æˆåŠŸçš„æƒ…å†µä¸‹è°ƒç”¨Closeã€‚ å¦‚æžœå®ƒæƒ³è¦åœ¨å†™å…¥documentä¹‹åŽå†å†™å…¥é¢å¤–çš„æ•°æ®æ—¶ä¼šå¼•èµ·Saveçš„è°ƒç”¨è€…ä¸€ä¸ªé—®é¢˜ã€‚ 123456type NopCloser struct &#123; io.Writer&#125;// Close has no effect on the underlying writer.func (c *NopCloser) Close() error &#123; return nil &#125; ä¸€ä¸ªåŽŸå§‹è§£å†³æ–¹æ¡ˆå›žäº‹å®šä¹‰ä¸€ä¸ªæ–°çš„typeï¼Œåœ¨å…¶å†…åµŒå…¥io.Writerä»¥åŠé‡å†™Closeæ–¹æ³•æ¥é˜»æ­¢Saveæ–¹æ³•å…³é—­åº•å±‚æ•°æ®æµã€‚ ä½†æ˜¯è¿™æ ·å¯èƒ½ä¼šè¿åé‡Œæ°æ›¿æ¢åŽŸåˆ™ï¼Œå¦‚æžœNopCloserå¹¶æ²¡æœ‰å…³é—­ä»»ä½•ä¸œè¥¿ã€‚ 12// Save writes the contents of doc to the supplied Writer.func Save(w io.Writer, doc *Document) error ä¸€ä¸ªæ›´å¥½çš„è§£å†³åŠžæ³•æ˜¯é‡æ–°å®šä¹‰Saveåªä¼ å…¥io.Writerï¼Œå‰¥ç¦»å®ƒçš„æ‰€æœ‰è´£ä»»é™¤äº†å†™å…¥æ•°æ®åˆ°æ•°æ®æµã€‚ é€šè¿‡å¯¹Saveæ–¹æ³•åº”ç”¨æŽ¥å£éš”ç¦»åŽŸåˆ™ï¼ŒåŒæ—¶å¾—åˆ°äº†æœ€å…·ä½“ä»¥åŠæœ€é€šç”¨çš„éœ€æ±‚å‡½æ•°ã€‚æˆ‘ä»¬çŽ°åœ¨å¯ä»¥ä½¿ç”¨Saveæ–¹æ³•æ¥ä¿å­˜æ•°æ®åˆ°ä»»ä½•å®žçŽ°äº†io.Writerçš„åœ°æ–¹ã€‚ A great rule of thumb for Go is accept interfaces, return structs. â€“Jack Lindamood Dependency Inversion Principle High-level modules should not depend on low-level modules. Both should depend on abstractions. Abstractions should not depend on details. Details should depend on abstractions. â€“Robert C. Martin å¯¹äºŽGoè¯­è¨€æ¥è®²ï¼Œä¾èµ–åè½¬æ„å‘³ç€ä»€ä¹ˆå‘¢? å¦‚æžœä½ åº”ç”¨ä»¥ä¸Šæ‰€æœ‰çš„åŽŸåˆ™ï¼Œä»£ç å·²ç»è¢«åˆ†è§£æˆç¦»æ•£çš„æœ‰æ˜Žç¡®è´£ä»»å’Œç›®çš„çš„packageï¼Œä½ çš„ä»£ç åº”è¯¥æè¿°äº†å®ƒçš„ä¾èµ–interfaceä»¥åŠè¿™äº›interfaceåº”è¯¥åªæè¿°ä»–ä»¬éœ€è¦çš„åŠŸèƒ½è¡Œä¸ºã€‚æ¢å¥è¯è¯´å°±æ˜¯ä»–ä»¬ä¸ä¼šå†è¿‡å¤šçš„æ”¹å˜ã€‚ å› æ­¤ï¼Œæˆ‘è®¤ä¸ºMartinæ‰€è®²çš„åœ¨Goè¯­è¨€çš„åº”ç”¨æ˜¯contextï¼Œå³ä½ import graphï¼ˆè¯‘æ³¨ï¼šåŽæ–‡ç”¨â€œå¯¼å…¥å›¾â€ä»£æ›¿ï¼‰çš„ç»“æž„ã€‚ åœ¨Goè¯­è¨€ä¸­ï¼Œä½ çš„å¯¼å…¥å›¾å¿…é¡»æ˜¯éžå¾ªçŽ¯ã€‚ä¸éµå®ˆæ­¤éžå¾ªçŽ¯çš„éœ€æ±‚ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼Œä½†æ˜¯æ›´ä¸ºä¸¥é‡çš„æ˜¯å®ƒä»£è¡¨äº†ä¸€ç³»åˆ—çš„è®¾è®¡é”™è¯¯ã€‚ æ‰€æœ‰æ¡ä»¶éƒ½ç›¸åŒçš„æƒ…å†µä¸‹ç²¾å¿ƒè®¾è®¡çš„å¯¼å…¥å›¾åº”è¯¥æ˜¯å¹¿æ³›çš„ä»¥åŠç›¸å¯¹å¹³å¦çš„ï¼Œè€Œä¸æ˜¯åˆé«˜åˆçª„ã€‚å¦‚æžœä½ æœ‰ä¸€ä¸ªpackageçš„å‡½æ•°åœ¨æ²¡æœ‰å…¶ä»–packageçš„æƒ…å†µä¸‹å°±æ— æ³•æ“ä½œï¼Œä¹Ÿè®¸è¿™å°±è¡¨æ˜Žäº†ä»£ç æ²¡æœ‰è€ƒè™‘pakcageçš„è¾¹ç•Œã€‚ ä¾èµ–åè½¬åŽŸåˆ™é¼“åŠ±ä½ å°½å¯èƒ½åœ°åƒå¯¼å…¥å›¾ä¸€æ ·åœ¨main packageæˆ–è€…æœ€é«˜å±‚çº§çš„å¤„ç†ç¨‹åºå†…å¯¹å…·ä½“ç»†èŠ‚è´Ÿè´£ï¼Œè®©ä½Žå±‚çº§ä»£ç æ¥å¤„ç†æŠ½è±¡çš„æŽ¥å£ã€‚ â€œSOLIDâ€ Goè¯­è¨€è®¾è®¡å›žé¡¾ä¸€ä¸‹ï¼Œå½“åº”ç”¨åˆ°Goè¯­è¨€è®¾è®¡ä¸­ï¼Œæ¯ä¸ªâ€œSOLIDâ€åŽŸåˆ™éƒ½æ˜¯å¼ºæœ‰åŠ›çš„å£°æ˜Žï¼Œä½†æ˜¯åŠ åœ¨ä¸€èµ·ä»–ä»¬æœ‰ä¸€ä¸ªä¸­å¿ƒä¸»é¢˜ã€‚ å•ä¸€åŠŸèƒ½åŽŸåˆ™é¼“åŠ±ä½ åœ¨packageä¸­æž„å»ºfunctionsã€typesä»¥åŠæ–¹æ³•è¡¨çŽ°å‡ºè‡ªç„¶çš„å‡èšåŠ›ã€‚typeså±žäºŽå½¼æ­¤ï¼Œfunctionsä¸ºå•ä¸€ç›®çš„æœåŠ¡ã€‚ å¼€é—­åŽŸåˆ™é¼“åŠ±ä½ ä½¿ç”¨åµŒå…¥å°†ç®€å•çš„typeç»„åˆæˆæ›´ä¸ºå¤æ‚çš„ã€‚ é‡Œæ°æ›¿æ¢åŽŸåˆ™é¼“åŠ±ä½ åœ¨packageä¹‹é—´è¡¨è¾¾ä¾èµ–å…³ç³»æ—¶ç”¨interfaceï¼Œè€Œéžå…·ä½“ç±»åž‹ã€‚é€šè¿‡å®šä¹‰å°å·§çš„interfaceï¼Œæˆ‘ä»¬å¯ä»¥æ›´æœ‰ä¿¡å¿ƒåœ°åˆ‡å®žæ»¡è¶³å…¶åˆçº¦ã€‚ æŽ¥å£éš”ç¦»åŽŸåˆ™é¼“åŠ±ä½ ä»…å–å†³äºŽæ‰€éœ€è¡Œä¸ºæ¥å®šä¹‰å‡½æ•°å’Œæ–¹æ³•ã€‚å¦‚æžœä½ çš„å‡½æ•°ä»…ä»…éœ€è¦æœ‰ä¸€ä¸ªæ–¹æ³•çš„interfaceåšä¸ºå‚æ•°ï¼Œé‚£ä¹ˆå®ƒå¾ˆæœ‰å¯èƒ½åªæœ‰ä¸€ä¸ªè´£ä»»ã€‚ ä¾èµ–åè½¬åŽŸåˆ™é¼“åŠ±ä½ åœ¨ç¼–è¯‘æ—¶å°†packageæ‰€ä¾èµ–çš„ä¸œè¥¿ç§»é™¤ - åœ¨Goè¯­è¨€ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ ·åšä½¿å¾—è¿è¡Œæ—¶ç”¨åˆ°çš„æŸä¸ªç‰¹å®šçš„packageçš„importå£°æ˜Žçš„æ•°é‡å‡å°‘ã€‚ å¦‚æžœæ€»ç»“è¿™ä¸ªæ¼”è®²ï¼ˆè¯‘æ³¨ï¼šè¯¥ç¯‡æ–‡ç« å–è‡ªDaveå¤§ç¥žåœ¨Golang UK Conference 2016çš„æ¼”è®²æ–‡å­—å†…å®¹ï¼Œæ–‡ç« ç»“å°¾å¤„æœ‰YouTubeé“¾æŽ¥ï¼‰å®ƒå¯èƒ½ä¼šæ˜¯ï¼š &gt; interfaces let you apply the SOLID principles to Go programs å› ä¸ºinterfaceæç»˜äº†ä»–ä»¬çš„pakcageçš„è§„å®šï¼Œè€Œä¸æ˜¯å¦‚ä½•è§„å®šçš„ã€‚æ¢ä¸ªè¯´æ³•å°±æ˜¯â€œè§£è€¦â€ï¼Œè¿™ç¡®å®žæ˜¯æˆ‘ä»¬çš„ç›®æ ‡ï¼Œå› ä¸ºè§£è€¦çš„è½¯ä»¶ä¿®æ”¹èµ·æ¥æ›´å®¹æ˜“ã€‚ å°±åƒSandi Metzæåˆ°çš„ï¼š Design is the art of arranging code that needs to work today, and to be easy to change forever. â€“Sandi Metz å› ä¸ºå¦‚æžœGoè¯­è¨€æƒ³è¦æˆä¸ºå…¬å¸é•¿æœŸæŠ•èµ„çš„ç¼–ç¨‹è¯­è¨€ï¼ŒGoç¨‹åºçš„ç»´æŠ¤ï¼Œæ›´å®¹æ˜“çš„å˜æ›´å°†æ˜¯ä»–ä»¬å†³å®šçš„å…³é”®å› ç´ ã€‚ ç»“å°¾Goè¯­è¨€ç¨‹åºå‘˜åº”å½“è®¨è®ºæ›´å¤šçš„æ˜¯è®¾è®¡è€Œéžæ¡†æž¶ã€‚æˆ‘ä»¬åº”å½“ä¸æƒœä¸€åˆ‡ä»£ä»·åœ°å…³æ³¨é‡ç”¨è€Œéžæ€§èƒ½ã€‚ æˆ‘æƒ³è¦çœ‹åˆ°æ˜¯ä»Šå¤©çš„äººä»¬è°ˆè®ºå…³äºŽå¦‚ä½•ä½¿ç”¨ç¼–ç¨‹è¯­è¨€ï¼Œæ— è®ºæ˜¯è®¾è®¡è§£å†³æ–¹æ¡ˆè¿˜æ˜¯è§£å†³å®žé™…é—®é¢˜çš„é€‰æ‹©å’Œå±€é™æ€§ã€‚ æˆ‘æƒ³è¦å¬åˆ°çš„æ˜¯äººä»¬è°ˆè®ºå¦‚ä½•é€šè¿‡ç²¾å¿ƒè®¾è®¡ã€è§£è€¦ã€é‡ç”¨ä»¥åŠé€‚åº”å˜åŒ–çš„æ–¹å¼æ¥è®¾è®¡Goè¯­è¨€ç¨‹åºã€‚ â€¦è¿˜æœ‰ä¸€ç‚¹æˆ‘ä»¬éœ€è¦å‘Šè¯‰ä¸–ç•Œä¼˜ç§€çš„è½¯ä»¶è¯¥å¦‚ä½•ç¼–å†™ã€‚å‘Šè¯‰ä»–ä»¬ä½¿ç”¨Goè¯­è¨€å¦‚ä½•ç¼–å†™ä¼˜ç§€çš„ã€å¯ç»„åˆçš„åŠæ˜“äºŽå˜åŒ–çš„è½¯ä»¶ã€‚ åŽŸæ–‡é“¾æŽ¥ï¼šhttp://dave.cheney.net/2016/08/20/solid-go-design æœ¬æ–‡è½¬è½½è‡ªï¼šhttps://blog.gokit.info/post/go-solid-design/]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Design</tag>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Golang åˆå§‹åŒ–é¡ºåº]]></title>
    <url>%2Fgolang-package-init-order.html</url>
    <content type="text"><![CDATA[golang package init order Goç¨‹åºçš„åˆå§‹åŒ–å’Œæ‰§è¡Œæ€»æ˜¯ä»Ž main.main å‡½æ•°å¼€å§‹çš„ã€‚ä½†æ˜¯å¦‚æžœ main åŒ…é‡Œå¯¼å…¥äº†å…¶å®ƒçš„åŒ…ï¼Œåˆ™ä¼šæŒ‰ç…§é¡ºåºå°†å®ƒä»¬åŒ…å«è¿› main åŒ…é‡Œï¼ˆè¿™é‡Œçš„å¯¼å…¥é¡ºåºä¾èµ–å…·ä½“å®žçŽ°ï¼Œä¸€èˆ¬å¯èƒ½æ˜¯ä»¥æ–‡ä»¶åæˆ–åŒ…è·¯å¾„åçš„å­—ç¬¦ä¸²é¡ºåºå¯¼å…¥ï¼‰ã€‚å¦‚æžœæŸä¸ªåŒ…è¢«å¤šæ¬¡å¯¼å…¥çš„è¯ï¼Œåœ¨æ‰§è¡Œçš„æ—¶å€™åªä¼šå¯¼å…¥ä¸€æ¬¡ã€‚å½“ä¸€ä¸ªåŒ…è¢«å¯¼å…¥æ—¶ï¼Œå¦‚æžœå®ƒè¿˜å¯¼å…¥äº†å…¶å®ƒçš„åŒ…ï¼Œåˆ™å…ˆå°†å…¶å®ƒçš„åŒ…åŒ…å«è¿›æ¥ï¼Œç„¶åŽåˆ›å»ºå’Œåˆå§‹åŒ–è¿™ä¸ªåŒ…çš„å¸¸é‡å’Œå˜é‡ã€‚ç„¶åŽå°±æ˜¯è°ƒç”¨åŒ…é‡Œçš„ init å‡½æ•°ï¼Œå¦‚æžœä¸€ä¸ªåŒ…æœ‰å¤šä¸ª init å‡½æ•°çš„è¯ï¼Œå®žçŽ°å¯èƒ½æ˜¯ä»¥æ–‡ä»¶åçš„é¡ºåºè°ƒç”¨ï¼ŒåŒä¸€ä¸ªæ–‡ä»¶å†…çš„å¤šä¸ª init åˆ™æ˜¯ä»¥å‡ºçŽ°çš„é¡ºåºä¾æ¬¡è°ƒç”¨ï¼ˆ init ä¸æ˜¯æ™®é€šå‡½æ•°ï¼Œå¯ä»¥å®šä¹‰æœ‰å¤šä¸ªï¼Œæ‰€ä»¥ä¸èƒ½è¢«å…¶å®ƒå‡½æ•°è°ƒç”¨ï¼‰ã€‚æœ€ç»ˆï¼Œåœ¨ main åŒ…çš„æ‰€æœ‰åŒ…å¸¸é‡ã€åŒ…å˜é‡è¢«åˆ›å»ºå’Œåˆå§‹åŒ–ï¼Œå¹¶ä¸” init å‡½æ•°è¢«æ‰§è¡ŒåŽï¼Œæ‰ä¼šè¿›å…¥ main.main å‡½æ•°ï¼Œç¨‹åºå¼€å§‹æ­£å¸¸æ‰§è¡Œã€‚ä¸‹å›¾æ˜¯Goç¨‹åºå‡½æ•°å¯åŠ¨é¡ºåºçš„ç¤ºæ„å›¾ï¼š è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ main.main å‡½æ•°æ‰§è¡Œä¹‹å‰æ‰€æœ‰ä»£ç éƒ½è¿è¡Œåœ¨åŒä¸€ä¸ªGoroutineä¸­ï¼Œä¹Ÿæ˜¯è¿è¡Œåœ¨ç¨‹åºçš„ä¸»ç³»ç»Ÿçº¿ç¨‹ä¸­ã€‚å¦‚æžœæŸä¸ª init å‡½æ•°å†…éƒ¨ç”¨goå…³é”®å­—å¯åŠ¨äº†æ–°çš„Goroutineçš„è¯ï¼Œæ–°çš„Goroutineå’Œ main.main å‡½æ•°æ˜¯å¹¶å‘æ‰§è¡Œçš„ã€‚å› ä¸ºæ‰€æœ‰çš„ init å‡½æ•°å’Œ main å‡½æ•°éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹å®Œæˆï¼Œå®ƒä»¬ä¹Ÿæ˜¯æ»¡è¶³é¡ºåºä¸€è‡´æ€§æ¨¡åž‹çš„ã€‚ æ•´ç†è‡ªï¼šGoè¯­è¨€é«˜çº§ç¼–ç¨‹ ä½œè€…ï¼šæŸ´æ ‘æ‰ã€æ›¹æ˜¥æ™–å›¾ç‰‡æ¥è‡ªï¼šbeegoå®˜ç½‘routeréƒ¨åˆ†]]></content>
      <tags>
        <tag>Go</tag>
        <tag>Init</tag>
        <tag>Order</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Goroutineå’Œç³»ç»Ÿçº¿ç¨‹]]></title>
    <url>%2Fgoroutine-and-system-threads.html</url>
    <content type="text"><![CDATA[goroutine and system threads Goroutineæ˜¯Goè¯­è¨€ç‰¹æœ‰çš„å¹¶å‘ä½“ï¼Œæ˜¯ä¸€ç§è½»é‡çº§çš„çº¿ç¨‹ï¼Œç”±goå…³é”®å­—å¯åŠ¨ã€‚åœ¨çœŸå®žçš„Goè¯­è¨€çš„å®žçŽ°ä¸­ï¼Œgoroutineå’Œç³»ç»Ÿçº¿ç¨‹ä¹Ÿä¸æ˜¯ç­‰ä»·çš„ã€‚å°½ç®¡ä¸¤è€…çš„åŒºåˆ«å®žé™…ä¸Šåªæ˜¯ä¸€ä¸ªé‡çš„åŒºåˆ«ï¼Œä½†æ­£æ˜¯è¿™ä¸ªé‡å˜å¼•å‘äº†Goè¯­è¨€å¹¶å‘ç¼–ç¨‹è´¨çš„é£žè·ƒã€‚ é¦–å…ˆï¼Œæ¯ä¸ªç³»ç»Ÿçº§çº¿ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªå›ºå®šå¤§å°çš„æ ˆï¼ˆä¸€èˆ¬é»˜è®¤å¯èƒ½æ˜¯2MBï¼‰ï¼Œè¿™ä¸ªæ ˆä¸»è¦ç”¨æ¥ä¿å­˜å‡½æ•°é€’å½’è°ƒç”¨æ—¶å‚æ•°å’Œå±€éƒ¨å˜é‡ã€‚å›ºå®šäº†æ ˆçš„å¤§å°å¯¼è‡´äº†ä¸¤ä¸ªé—®é¢˜ï¼šä¸€æ˜¯å¯¹äºŽå¾ˆå¤šåªéœ€è¦å¾ˆå°çš„æ ˆç©ºé—´çš„çº¿ç¨‹æ¥è¯´æ˜¯ä¸€ä¸ªå·¨å¤§çš„æµªè´¹ï¼ŒäºŒæ˜¯å¯¹äºŽå°‘æ•°éœ€è¦å·¨å¤§æ ˆç©ºé—´çš„çº¿ç¨‹æ¥è¯´åˆé¢ä¸´æ ˆæº¢å‡ºçš„é£Žé™©ã€‚é’ˆå¯¹è¿™ä¸¤ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šè¦ä¹ˆé™ä½Žå›ºå®šçš„æ ˆå¤§å°ï¼Œæå‡ç©ºé—´çš„åˆ©ç”¨çŽ‡ï¼›è¦ä¹ˆå¢žå¤§æ ˆçš„å¤§å°ä»¥å…è®¸æ›´æ·±çš„å‡½æ•°é€’å½’è°ƒç”¨ï¼Œä½†è¿™ä¸¤è€…æ˜¯æ²¡æ³•åŒæ—¶å…¼å¾—çš„ã€‚ç›¸åï¼Œä¸€ä¸ªGoroutineä¼šä»¥ä¸€ä¸ªå¾ˆå°çš„æ ˆå¯åŠ¨ï¼ˆå¯èƒ½æ˜¯2KBæˆ–4KBï¼‰ï¼Œå½“é‡åˆ°æ·±åº¦é€’å½’å¯¼è‡´å½“å‰æ ˆç©ºé—´ä¸è¶³æ—¶ï¼ŒGoroutineä¼šæ ¹æ®éœ€è¦åŠ¨æ€åœ°ä¼¸ç¼©æ ˆçš„å¤§å°ï¼ˆä¸»æµå®žçŽ°ä¸­æ ˆçš„æœ€å¤§å€¼å¯è¾¾åˆ°1GBï¼‰ã€‚å› ä¸ºå¯åŠ¨çš„ä»£ä»·å¾ˆå°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è½»æ˜“åœ°å¯åŠ¨æˆåƒä¸Šä¸‡ä¸ªGoroutineã€‚ Goçš„è¿è¡Œæ—¶è¿˜åŒ…å«äº†å…¶è‡ªå·±çš„è°ƒåº¦å™¨ï¼Œè¿™ä¸ªè°ƒåº¦å™¨ä½¿ç”¨äº†ä¸€äº›æŠ€æœ¯æ‰‹æ®µï¼Œå¯ä»¥åœ¨nä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸Šå¤šå·¥è°ƒåº¦mä¸ªGoroutineã€‚Goè°ƒåº¦å™¨çš„å·¥ä½œå’Œå†…æ ¸çš„è°ƒåº¦æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æ˜¯è¿™ä¸ªè°ƒåº¦å™¨åªå…³æ³¨å•ç‹¬çš„Goç¨‹åºä¸­çš„Goroutineã€‚Goroutineé‡‡ç”¨çš„æ˜¯åŠæŠ¢å å¼çš„åä½œè°ƒåº¦ï¼Œåªæœ‰åœ¨å½“å‰Goroutineå‘ç”Ÿé˜»å¡žæ—¶æ‰ä¼šå¯¼è‡´è°ƒåº¦ï¼›åŒæ—¶å‘ç”Ÿåœ¨ç”¨æˆ·æ€ï¼Œè°ƒåº¦å™¨ä¼šæ ¹æ®å…·ä½“å‡½æ•°åªä¿å­˜å¿…è¦çš„å¯„å­˜å™¨ï¼Œåˆ‡æ¢çš„ä»£ä»·è¦æ¯”ç³»ç»Ÿçº¿ç¨‹ä½Žå¾—å¤šã€‚è¿è¡Œæ—¶æœ‰ä¸€ä¸ª runtime.GOMAXPROCS å˜é‡ï¼Œç”¨äºŽæŽ§åˆ¶å½“å‰è¿è¡Œæ­£å¸¸éžé˜»å¡žGoroutineçš„ç³»ç»Ÿçº¿ç¨‹æ•°ç›®ã€‚ åœ¨Goè¯­è¨€ä¸­å¯åŠ¨ä¸€ä¸ªGoroutineä¸ä»…å’Œè°ƒç”¨å‡½æ•°ä¸€æ ·ç®€å•ï¼Œè€Œä¸”Goroutineä¹‹é—´è°ƒåº¦ä»£ä»·ä¹Ÿå¾ˆä½Žï¼Œè¿™äº›å› ç´ æžå¤§åœ°ä¿ƒè¿›äº†å¹¶å‘ç¼–ç¨‹çš„æµè¡Œå’Œå‘å±•ã€‚ æ•´ç†è‡ªï¼šGoè¯­è¨€é«˜çº§ç¼–ç¨‹ ä½œè€…ï¼šæŸ´æ ‘æ‰ã€æ›¹æ˜¥æ™–]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>Goroutine</tag>
        <tag>Thread</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Go å¯†ç å­¦åº”ç”¨]]></title>
    <url>%2Fgolang-for-crypto-developers.html</url>
    <content type="text"><![CDATA[Go Crypto è§†é¢‘ä¿¡æ¯Go for Crypto Developersby George Tankersleyat GopherCon 2016 https://www.youtube.com/watch?v=2r_KMzXB74w å¹»ç¯åœ°å€ï¼šhttps://speakerdeck.com/gtank/crypto-for-go-developersä»£ç ï¼šhttps://github.com/gtank/cryptopasta Donâ€™t write your own cryptoå¾ˆå¤šäººæŠŠè¿™å¥è¯è¯¯è§£ä¸ºä¸è¦ä½¿ç”¨åŠ å¯†ã€ä¸è¦ä½¿ç”¨ä»»ä½•å¯†ç å­¦çš„æŠ€æœ¯ï¼Œå› ä¸ºä½ ä¸å¤Ÿèªæ˜Žã€‚Noã€‚å®Œå…¨ä¸æ˜¯è¿™ä¸ªæ„æ€ã€‚ è¿™å¥è¯æ˜¯è¯´ä¸è¦è¯•å›¾åŽ»å‘æ˜Žåˆ›é€ é‚£äº›åŠ å¯†ç±»çš„ç®—æ³•ã€‚å› ä¸ºä½ ä¸å¤§å¯èƒ½ä¼šåˆ›é€ ä¸€ä¸ªè¶…è¿‡ AES çš„åŠ å¯†ç®—æ³•ã€ä¹Ÿä¸å¤§å¯èƒ½ä¼šåˆ›é€ ä¸€ä¸ªæ¯” SHA æ›´å¥½çš„ hash ç®—æ³•ã€‚æ‰€ä»¥è‡ªå·±é—­é—¨é€ çš„ç®—æ³•ä¸€èˆ¬æ„å‘³ç€å®‰å…¨æ€§çš„å¤§å¤§é™ä½Žã€‚ å…¨ä¸–ç•Œèƒ½å¹²è¿™ä»¶äº‹æƒ…çš„äººä¸è¶…è¿‡5ä¸ªï¼Œè€Œä¸”ä»–ä»¬ä»Šå¤©éƒ½ä¸åœ¨è¿™é‡Œã€‚å¦å¤–ä¸€åŠéƒ½æ˜¯ Daniel J. Bernstein å¹²çš„ï¼ˆå¼€ä¸ªçŽ©ç¬‘ï¼Œä¸è¿‡è¿™äººå¾ˆç‰›ï¼Œä»Šå¤©æˆ‘ä»¬åœ¨ç”¨çš„å¾ˆå¤šåŠ å¯†çš„ä¸œè¥¿éƒ½æ˜¯ä»–è®¾è®¡ã€å®žçŽ°çš„ï¼‰ã€‚ è¡¨é¢ä¸Šå¥½åƒè¿™æ˜¯ä¸ªé™åˆ¶ï¼Œå…¶å®žè¿™æ˜¯ä¸ªä¼˜åŠ¿ã€‚å› ä¸ºæˆ‘ä»¬ä¸éœ€è¦ç¼–å†™è‡ªå·±çš„åŠ å¯†ç®—æ³•ï¼Œä¸€åˆ‡ç—›è‹¦çš„å·¥ä½œéƒ½å·²ç»ç”±åˆ«äººåšå¥½äº†ã€‚æˆ‘ä»¬åªéœ€è¦å’Œæ­ç§¯æœ¨ä¸€æ ·åŽ»ä½¿ç”¨è¿™äº›å¯†ç å­¦å·¥å…·å°±å¥½äº†ã€‚ ç»å¸¸å¬åˆ°è¿™æ ·çš„å»ºè®® å¯¹ä¼ è¾“ä¸­çš„æ•°æ®ç”¨ TLS å¯¹é™æ­¢çš„æ•°æ®ç”¨ GPG TLSGo å¯ä»¥å¾ˆå®¹æ˜“ä½¿ç”¨ TLSï¼Œå› ä¸ºå¿…é¡»çš„ä¸œè¥¿éƒ½å†…ç½®äº†ï¼Œä»Žå®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯ã€‚ å®¢æˆ·ç«¯ 1234567891011121314151617var minimalTLSConfig = &amp;tls.Config&#123; MinVersion: tls.VersionTLS12,&#125;var tlsTransport = &amp;http.Transport&#123; TLSClientConfig: minimalTLSConfig,&#125;var httpClient = &amp;http.Client&#123; Transport: tlsTransport, Timeout: 10 * time.Second,&#125;func MakeRequest() error &#123; resp, err := httpClient.Get(&quot;https://www.google.com&quot;) if err != nil &#123; return err &#125; // have fun&#125; è¿™é‡Œæœ€é‡è¦çš„æ˜¯ tls.VersionTLS12ï¼Œå› ä¸ºä½ŽäºŽ 1.2 çš„è¯ï¼Œä¼šå¯¼è‡´ Go ä½¿ç”¨ä¸€äº›ä¸å®‰å…¨çš„ä½Žç‰ˆæœ¬çš„å®žçŽ°ï¼Œæ‰€ä»¥è¿™é‡Œé™å®š 1.2 æ¯”è¾ƒå®‰å…¨ã€‚è€Œä¸”å¤§éƒ¨åˆ†ç½‘ç«™ä¹Ÿéƒ½æ”¯æŒã€‚ æœåŠ¡ç«¯ 123456789101112131415161718var minimalTLSConfig = &amp;tls.Config&#123; MinVersion: tls.VersionTLS12, PreferServerCipherSuites: true,&#125;var srv = &amp;http.Server&#123; Addr: &quot;localhost:8080&quot;, TLSConfig: minimalTLSConfig,&#125;func handleReq(w http.ResponseWriter, r *http.Request) &#123; fmt.Fprintf(w, &quot;Hello, world&quot;)&#125;func main() &#123; http.HandleFunc(&quot;/&quot;, handleReq) err := srv.ListenAndServeTLS(&quot;cert.pem&quot;, &quot;key.pem&quot;) if err != nil &#123; log.Fatal(err) &#125;&#125; è¿™é‡Œå’Œå®¢æˆ·ç«¯ä¸€æ ·ï¼Œé™å®šæœ€å°ç‰ˆæœ¬æ˜¯ 1.2ï¼Œå¹¶ä¸”å¤šäº†ä¸€ä¸ªé¢å¤–çš„å‚æ•°ï¼Œè¦æ±‚ä»¥æœåŠ¡å™¨çš„ Cipher ä¼˜å…ˆï¼Œå› æ­¤ä¸æŒ‰ç…§å®¢æˆ·ç«¯ç»™çš„é€‰æ‹©ï¼Œè€Œæ˜¯æŒ‰ç…§GoæœåŠ¡ç«¯ç»™çš„é€‰æ‹©ã€‚å› ä¸º Go çš„ TLS åŒ…ä¸­æœ‰å¤§é‡é’ˆå¯¹å„ç§å®‰å…¨é—®é¢˜çš„è°ƒæ•´ï¼Œå› æ­¤é€‰æ‹©åŠ å¯†åŒ…çš„è¯ï¼Œéµå¾ª Go å†…éƒ¨çš„å†³å®šæ˜¯æœ€å¥½çš„ã€‚ GPGGPG æ˜¯ä¸ºäº†äººå’Œäººä¹‹é—´çš„äº¤æµä¿¡æ¯ï¼Œè€Œä¸æ˜¯æœºå™¨å’Œæœºå™¨ä¹‹é—´äº¤æµä¿¡æ¯çš„ã€‚ é‚£ä¹ˆå¦‚ä½•å®‰å…¨çš„ä½¿ç”¨ GPG å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä¸ç”¨GPGã€‚å› ä¸ºä½œè€…è§‰å¾— GPG å¤ªè¿‡é˜´è°‹è®ºäº†ï¼Œé™·å…¥äº†å¾ˆå¤šæœ¬ä¸éœ€è¦è¿‡å¤šæ³¨æ„çš„åŒºåŸŸï¼Œå³ä½¿é‚£ä¹ˆåšäº†ï¼Œä¹Ÿä¸è§å¾—æ›´å®‰å…¨ã€‚ è¿™ä¸ª Talk ä¸è®² TLS å’Œ GPGå› ä¸ºå½“ä½ å®žçŽ°å®‰å…¨çš„ä¿¡æ¯ç³»ç»Ÿçš„æ—¶å€™ï¼Œé€šå¸¸ä¸ä¼šç”¨åˆ°è¿™ä¸¤ä¸ªä¸œè¥¿ã€‚TLS å’Œ GPG æœ‰ä»–ä»¬åº”ç”¨çš„åœºåˆï¼Œä½†æ˜¯å¯¹äºŽæ¯å¤©çš„å¯†ç å­¦å·¥ä½œæ¥è¯´ï¼ŒåŸºæœ¬éƒ½ä¸ç”¨è¿™ä¸¤ä¸ªå·¥å…·ï¼š å¯¹æ–‡ä»¶è®¡ç®—æ•£åˆ— ç”Ÿæˆéšæœº ID API éªŒè¯ ç½‘ç«™å¯†ç å­˜å‚¨ ç­¾åã€åŠ å¯† cookies JWT ç­¾åæ›´æ–° åœ¨ Go çš„ crypto åŒ…é‡Œçš„ç®—æ³•å¯ä¸éƒ½æ˜¯å¥½çš„ç®—æ³•åŠ å¯†ä¸‹åˆ—åˆ’æŽ‰çš„ç®—æ³•éƒ½ä¸åº”è¯¥å†ä½¿ç”¨äº†ï¼š DES 3DES RC4 TEA XTEA Blowfish âœ”ï¸ Twofish CAST5 âœ”ï¸ Salsa20 âœ”ï¸ AES åªæœ‰ Twofishã€Salsa20 å’Œ AES è¿˜ç®—æ˜¯å®‰å…¨çš„åŠ å¯†ç®—æ³•ï¼Œä½†æ˜¯ AES åœ¨å¤§éƒ¨åˆ†çš„è®¡ç®—æœºä¸Šéƒ½æœ‰ç¡¬ä»¶åŠ é€Ÿã€‚å› æ­¤åªå‰©ä¸‹ä¸€ä¸ª AES æ˜¯æœ€ä½³åŠ å¯†ç®—æ³•ã€‚ æ€Žä¹ˆä½¿ç”¨ AESè¦æ³¨æ„ï¼ŒaesCipher.Encrypt() åªä¼šåŠ å¯†å‰16ä¸ªå­—èŠ‚ã€‚ä¸å°‘äººæŽ‰åˆ°è¿™ä¸ªå‘é‡Œäº†ï¼Œç»“æžœä¸çŸ¥é“ä¸ºå•¥å°±å‰å‡ ä¸ªå­—ç¬¦æ˜¯å¯†æ–‡ï¼ŒåŽé¢å…¨éƒ½æ˜¯æ˜Žæ–‡ã€‚è§£å†³åŠžæ³•å°±æ˜¯ä¸ç›´æŽ¥ç”¨AESï¼Œé€šè¿‡ Mode æ¥ä½¿ç”¨ã€‚ Block cipher mode ä¸€æ ·æœ‰å¾ˆå¤šç§é€‰æ‹©ï¼š CBC CFB CTR OFB âœ”ï¸ GCM è¿™é‡Œåªæœ‰ GCM æ˜¯éªŒè¯çš„åŠ å¯†ç®—æ³•ï¼Œå› æ­¤åˆ«çš„éƒ½å¯ä»¥ä¸é€‰ã€‚ åŠ å¯†12345678910111213141516171819202122232425import ( &quot;crypto/aes&quot; &quot;crypto/cipher&quot; &quot;crypto/rand&quot;)func Encrypt(data []byte, key [32]byte) ([]byte, error) &#123; // åˆå§‹åŒ– block cipher block, err := aes.NewCipher(key[:]) if err != nil &#123; return nil, err &#125; // è®¾ç½® block cipher mode gcm, err := cipher.NewGCM(block) if err != nil &#123; return nil, err &#125; // ç”Ÿæˆéšæœº nonce nonce := make([]byte, gcm.NonceSize()) _, err = rand.Read(nonce) if err != nil &#123; return nil, err &#125; // å°è£…ã€è¿”å›ž return gcm.Seal(nonce, nonce, data, nil), nil&#125; è§£å¯†1234567891011121314151617181920212223import ( &quot;crypto/aes&quot; &quot;crypto/cipher&quot; &quot;crypto/rand&quot;)func Decrypt(ciphertext []byte, key [32]byte) (plaintext []byte, err error) &#123; // åˆå§‹åŒ– block cipher block, err := aes.NewCipher(key[:]) if err != nil &#123; return nil, err &#125; // è®¾ç½® block cipher mode gcm, err := cipher.NewGCM(block) if err != nil &#123; return nil, err &#125; // è¿”å›žè§£å¼€çš„åŒ…ï¼Œæ³¨æ„è¿™é‡Œçš„ nonce æ˜¯ç›´æŽ¥å–çš„ã€‚ return gcm.Open(nil, ciphertext[:gcm.NonceSize()], ciphertext[gcm.NonceSize():], nil, )&#125; å“ˆå¸Œæ•£åˆ—å°†ä¸€å¤§æ®µæ•°æ®ä½¿ç”¨ Hash ç®—æ³•ï¼Œå¸Œæœ›å¾—åˆ°ä¸€ä¸²æ•°å€¼ï¼Œè¿™ä¸²æ•°å€¼å¯ä»¥åæ˜ ä½ çš„è¿™æ®µæ•°æ®ï¼Œä»»ä½•æ•°æ®å˜åŒ–ï¼Œè¿™ä¸²æ•°å€¼éƒ½ä¸åŒã€‚è€Œä¸”å¸Œæœ›æ— æ³•ä»Žè¿™ä¸²æ•°å€¼åæŽ¨æ•°æ®ã€‚è¿™å°±æ˜¯å¯†ç å­¦ Hash å‡½æ•°è¦ä¿è¯çš„ã€‚ï¼ˆæ³¨æ„ï¼šå“ˆå¸Œä¸ç­‰äºŽåŠ å¯†ï¼Œå¾ˆå¤šäººè¿™ç‚¹å®¹æ˜“æžæ··ï¼‰ åŒæ · Hash å‡½æ•°ä¸€æ ·æœ‰å¾ˆå¤šé€‰æ‹©ï¼Œä¸€æ ·æ˜¯å¤§éƒ¨åˆ†éƒ½ä¸ç”¨ï¼š MD4 MD5 RIPEMD160 SHA1 âœ”ï¸ SHA2 âœ”ï¸ SHA3é€‰æ‹© SHA3 å¹¶ä¸æ˜¯å› ä¸ºå®ƒæ¯” SHA2 æ›´æ–°æ›´å¥½ï¼Œè€Œæ˜¯å› ä¸ºå®ƒä¸åŒäºŽ SHA1 å’Œ SHA2ã€‚å‡ å¹´å‰å¯†ç å­¦å®¶å·²ç»å¼€å§‹æ‹…å¿ƒï¼Œå› ä¸ºMDä»¥åŠSHAçš„å“ˆå¸Œç®—æ³•æœ¬è´¨å¤ªç›¸ä¼¼äº†ï¼Œé‚£ä¹ˆä¸€æ—¦è¿™ä¸ªä¾èµ–å‡ºçŽ°é—®é¢˜ï¼Œå°±æ„å‘³ç€è¿™ä¸ªä½“ç³»çš„ä¸å†å®‰å…¨ã€‚å› æ­¤å¼€å§‹å¯»æ‰¾ä¸€ç§ä¸åŒçš„ç®—æ³•ã€‚ç»è¿‡ç«žèµ›ã€æŒ‘é€‰ï¼Œæœ€ç»ˆ SHA3 è„±é¢–è€Œå‡ºã€‚ä»–æœ¬èº«æ˜¯ä¸ªå¾ˆå‡ºè‰²çš„ Hash ç®—æ³•ï¼ŒåŒæ—¶å…¶è®¾è®¡å’Œä¹‹å‰çš„è¿™å‡ ä¸ªç®—æ³•å®Œå…¨ä¸ä¸€æ ·ã€‚ ä½†æ˜¯ç”±äºŽ SHA3 å¹¶ä¸è¢«å¹¿æ³›æ”¯æŒï¼Œæ‰€ä»¥å¦‚æžœä½ æ˜Žç¡®çŸ¥é“ä½ å¯ä»¥ç”¨ SHA3ï¼Œé‚£ä¹ˆå°±ç”¨ SHA3ã€‚å…¶å®ƒæƒ…å†µç”¨ SHA2ã€‚ ä½†æ˜¯å’ŒåŠ å¯†ä¸€æ ·ï¼Œæˆ‘ä»¬ä¸åº”è¯¥ç›´æŽ¥ä½¿ç”¨ Hash ç®—æ³•ã€‚å› ä¸ºå¯èƒ½ä¼šé¢ä¸´ä¸€ç³»åˆ—çš„æ”»å‡»ï¼š Length extension Rainbow tables Small number of possibilities (phone numbers) Salt? Peper? æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ HMACï¼Œè€Œä¸è¦ç›´æŽ¥ç”¨ Hash å®žçŽ° Hash1234567891011121314151617181920import ( &quot;crypto/hmac&quot; &quot;crypto/sha512&quot;)func Hash(tag string, data []byte) []byte &#123; h := hmac.New(sha512.New512_256, []byte(tag)) h.Write(data) return h.Sum(nil)&#125;func ExampleHash() error &#123; tag := &quot;hashing file for storage key&quot; contents, err := ioutil.ReadFile(&quot;testfile&quot;) if err != nil &#123; return error &#125; digest := Hash(tag, contents) fmt.Println(hex.EncodeToString(digest))&#125;// Output:// 9f4c795d8ae5e207f19184ccebee6a606c1fdfe509c793614006d613580f03e1 Hash å¯†ç ä¸€èˆ¬ä¸œè¥¿çš„ Hash ç”¨åˆšæ‰çš„å°±è¡Œäº†ï¼Œä½†æ˜¯é™¤äº†å¯†ç Hashã€‚å¯†ç  Hash å’Œæ•°æ® Hash çš„ç‰¹å¾å®Œå…¨ä¸åŒã€‚ æ•°æ® Hash å¸Œæœ›çš„æ˜¯ Hash ç®—æ³•è¶Šå¿«è¶Šå¥½ è€Œå¯†ç  Hash åˆ™å¸Œæœ› Hash ç®—æ³•è¶Šæ…¢è¶Šå¥½ è¿‡å¿«çš„å¯†ç å“ˆå¸Œä¼šå¯¼è‡´æš´åŠ›ç ´è§£çš„æˆæœ¬é™ä½Žã€‚å› æ­¤å¯†ç å“ˆå¸Œéœ€è¦ç‰¹æ®Šç®—æ³•ã€‚ ä½¿ç”¨ bcrypt1234567891011121314151617import ( &quot;golang.org/x/crypto/bcrypt&quot;)func HashPassword(password []byte) ([]byte, error) &#123; return bcrypt.GenerateFromPassword(password, 14)&#125;func CheckPasswordHash(hash, password []byte) error &#123; return bcrypt.CompareHashAndPassword(hash, password)&#125;func Example() &#123; myPassword := []byte(&quot;password&quot;) hashed, err := HashPassword(myPassword) if err != nil &#123; return &#125; fmt.Println(string(hashed))&#125; 14 æ˜¯è®¡ç®—é‡çš„å¤æ‚åº¦ï¼Œ14 æ˜¯ä¸ªæ¯”è¾ƒå¥½çš„å€¼ï¼Œå¦‚æžœè§‰å¾—æ€§èƒ½æ— æ³•æŽ¥å—ï¼Œå¯ä»¥é™åˆ° 12ï¼Œä½†æ˜¯ä¸è¦å†ä½Žäº†ã€‚ ç­¾åé¦–å…ˆæ˜¯æœ‰ä¸€å¯¹å¯†é’¥ï¼Œä¸€ä¸ªæ˜¯å…¬é’¥ã€ä¸€ä¸ªæ˜¯ç§é’¥ã€‚ä»»ä½•æ‹¥æœ‰ç§é’¥çš„äººå¯ä»¥å¯¹ä¸€æ®µä¿¡æ¯ç­¾åï¼Œè€Œæ‰€æœ‰æ‹¥æœ‰å…¬é’¥çš„äººéƒ½å¯ä»¥æ¥éªŒè¯è¿™ä¸ªæ¶ˆæ¯ç¡®å®žæ˜¯ç”±é‚£ä¸ªäººç­¾åçš„ã€‚ é€šè¿‡ç­¾åå¯ä»¥ç¡®ä¿ä¸¤ä»¶äº‹æƒ…ï¼š æ¶ˆæ¯æœªæ›¾è¢«ç¯¡æ”¹ æ˜¯è°å‘å‡ºçš„è¿™ä¸ªæ¶ˆæ¯ å’Œå‰é¢ä¸€æ ·ï¼ŒGo æœ‰å¾ˆå¤šç­¾åç®—æ³•å¯ä»¥é€‰æ‹©ï¼š RSA PKCS1v15 PSS ECDSA âœ”ï¸ P256 P385 P521 Ed25519 è¿™æ¬¡å’Œå‰é¢ä¸åŒï¼Œç­¾åç®—æ³•çš„å®‰å…¨æ›´å¤šçš„ä¸æ˜¯å–å†³äºŽç®—æ³•é€‰æ‹©ï¼Œè€Œæ˜¯å–å†³äºŽä½ æ˜¯æ€Žä¹ˆä½¿ç”¨çš„ã€‚ æ¯”å¦‚è¿™é‡Œæ¯”è¾ƒæŽ¨èä½¿ç”¨ ECDSA/P256ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œå½“åˆ PS3 è¢«é»‘ï¼Œè¢«è§£å‡ºç§é’¥å°±æ˜¯ç”¨çš„è¿™ä¸ªç®—æ³•ï¼Œå½“æ—¶æ˜¯ç”±äºŽé‚£ä¸ªç®—æ³•å®žçŽ°æ˜¯éžå¸¸çƒ‚çš„ã€‚å¹¸è¿çš„æ˜¯ Go æ²¡è¿™ä¸ªé—®é¢˜ã€‚æ‰€ä»¥ç›¸å¯¹äºŽå…¶ä»–è¯­è¨€ï¼ŒGo å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¯”è¾ƒå®‰å…¨çš„ç­¾åç®—æ³•ã€‚ å®žçŽ°ç”Ÿæˆå¯†é’¥ 12345678import ( &quot;crypto/ecdsa&quot; &quot;crypto/elliptic&quot; &quot;crypto/rand&quot;)func NewSigningKey() (*ecdsa.PrivateKey, error) &#123; return ecdsa.GenerateKey(elliptic.P256(), rand.Reader)&#125; ç­¾åæ•°æ® 123456789101112131415func Sign(data []byte, priv *ecdsa.PrivateKey) ([]byte, error) &#123; digest := sha256.Sum256(data) r, s, err := ecdsa.Sign(rand.Reader, priv, digest[:]) if err != nil &#123; return nil, err &#125; // encode the signature &#123;R, S&#125; params := priv.Curve.Params() curveByteSize := params.P.BitLen() / 8 rBytes, sBytes := r.Bytes(), s.Bytes() signature := make([]byte, curveByteSize * 2) copy(signature[curveByteSize - len(rBytes):], rBytes) copy(signature[curveByteSize*2 - len(sBytes):], sBytes) return signature, nil&#125; éªŒè¯ç­¾å 1234567891011121314import ( &quot;crypto/ecdsa&quot; &quot;crypto/sha256&quot; &quot;math/big&quot;)// éªŒè¯æˆåŠŸè¿”å›ž trueï¼Œå¦åˆ™ falsefunc Verify(data, sig []byte, pub *ecdsa.PublicKey) bool &#123; digest := sha256.Sum256(data) curveByteSize := pub.Curve.Params().P.BitLen() / 8 r, s := new(big.Int), new(big.Int) r.SetBytes(signature[:curveByteSize]) s.SetBytes(signature[curveByteSize:]) return ecdsa.Verify(pub, digest[:], r, s)&#125;]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[gRPC ä»Žå­¦ä¹ åˆ°ç”Ÿäº§]]></title>
    <url>%2Fgolang-grpc-from-tutorial-to-production.html</url>
    <content type="text"><![CDATA[gRPC Practiceäº†è§£gRPCï¼Œæ›´çŸ¥REST è§†é¢‘ä¿¡æ¯grpc: From Tutorial to Productionby Alan Shreveat GopherCon 2017 https://www.youtube.com/watch?v=7FZ6ZyzGex0 åšæ–‡ï¼šhttps://about.sourcegraph.com/go/grpc-in-production-alan-shreve/ å¾®æœåŠ¡ä¹‹é—´åº”è¯¥å¦‚ä½•é€šè®¯ï¼Ÿç­”æ¡ˆå°±æ˜¯ï¼šSOAPâ€¦â€¦å¥½å§ï¼Œå¼€ä¸ªçŽ©ç¬‘ï¼Œå½“ç„¶ä¸å¯èƒ½æ˜¯ SOAP äº†ã€‚ çŽ°åœ¨æµè¡Œçš„åšæ³•æ˜¯ HTTP + JSON (REST API) Alan è¯´â€œå¦‚æžœè¿™è¾ˆå­å†ä¹Ÿä¸å†™å¦ä¸€ä¸ª REST å®¢æˆ·ç«¯åº“çš„è¯ï¼Œé‚£å°±å¯ä»¥å¾ˆå¹¸ç¦çš„æ­»åŽ»äº†â€¦â€¦ðŸ˜‚â€ï¼Œå› ä¸ºè¿™æ˜¯æœ€æ— èŠçš„äº‹æƒ…ï¼Œä¸€éä¸€éçš„åœ¨åšåŒæ ·çš„äº‹æƒ…ã€‚ ä¸ºä»€ä¹ˆ REST API ä¸å¥½ç”¨ï¼Ÿ å®žçŽ° Stream å¤ªéš¾äº† è€ŒåŒå‘çš„æµå°±æ ¹æœ¬ä¸å¯èƒ½ å¾ˆéš¾å¯¹æ“ä½œå»ºç«‹æ¨¡åž‹ æ•ˆçŽ‡å¾ˆå·®ï¼Œæ–‡æœ¬è¡¨ç¤ºå¯¹äºŽç½‘ç»œæ¥è¯´å¹¶ä¸æ˜¯æœ€å¥½çš„é€‰æ‹© è€Œä¸”ï¼Œå…¶å®žæœåŠ¡å†…éƒ¨æ ¹æœ¬ä¸æ˜¯ RESTful çš„æ–¹å¼ï¼Œè¿™åªæ˜¯ HTTP endpoint å¾ˆéš¾åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­å–å¾—å¤šä¸ªèµ„æºæ•°æ® ï¼ˆåä¾‹çœ‹ GraphQLï¼‰ æ²¡æœ‰æ­£å¼çš„ï¼ˆæœºå™¨å¯è¯»çš„ï¼‰APIçº¦æŸ å› æ­¤å†™å®¢æˆ·ç«¯éœ€è¦äººç±» è€Œä¸”å› ä¸ºðŸ‘·å¾ˆè´µï¼Œè€Œä¸”ä¸å–œæ¬¢å†™å®¢æˆ·ç«¯ ä»€ä¹ˆæ˜¯ gRPC gPRC æ˜¯é«˜æ€§èƒ½ã€å¼€æºã€é€šç”¨çš„ RPC æ¡†æž¶ã€‚ ä¸Žå…¶è®²è§£å®šä¹‰ï¼Œä¸å¦‚æ¥å®žé™…åšä¸ªä¸œè¥¿æ›´æ¸…æ¥šã€‚ å»ºä¸€ä¸ªç¼“å­˜æœåŠ¡ä½¿ç”¨ gRPC è¿™ç±»ä¸œè¥¿ï¼Œæˆ‘ä»¬å¹¶éžå¼€å§‹äºŽå†™ Go ä»£ç ï¼Œæˆ‘ä»¬æ˜¯ä»Žæ’°å†™ gRPC çš„ IDL å¼€å§‹çš„ã€‚ app.proto123456789101112131415161718syntax = &quot;proto3&quot;package rpc;service Cache &#123; rpc Store(StoreReq) returns (StoreResp) &#123;&#125; rpc Get(GetReq) returns (GetResp) &#123;&#125;&#125;message StoreReq &#123; string key = 1; bytes val = 2;&#125;message StoreResp &#123;&#125;message GetReq &#123; string key = 1;&#125;message GetResp &#123; bytes val = 1;&#125; å½“å†™äº†è¿™ä¸ªæ–‡ä»¶åŽï¼Œæˆ‘ä»¬ç«‹åˆ»æ‹¥æœ‰äº† 9 ç§è¯­è¨€çš„å®¢æˆ·ç«¯çš„åº“ã€‚ C++ Java(and Android) Python Go Ruby C# Javascript(node.js) Objective-C (iOS!) PHP åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿæ‹¥æœ‰äº† 7 ç§è¯­è¨€çš„æœåŠ¡ç«¯çš„ API Stubï¼š C++ Java Python Go Ruby C# Javascript(node.js) server.go12345678910111213141516func serverMain() &#123; if err := runServer(); err != nil &#123; fmt.Fprintf(os.Stderr, &quot;Failed to run cache server: %s\n&quot;, err) os.Exit(1) &#125;&#125;func runServer() error &#123; srv := grpc.NewServer() rpc.RegisterCacheServer(srv, &amp;CacheService&#123;&#125;) l, err := net.Listen(&quot;tcp&quot;, &quot;localhost:5051&quot;) if err != nil &#123; return err &#125; // block return srv.Serve(l)&#125; æš‚æ—¶å…ˆä¸å®žçŽ° CacheServiceï¼Œå…ˆæ”¾ä¸ªç©ºçš„ï¼Œç¨åŽå†å®žçŽ°ã€‚ 12345678type CacheService struct &#123;&#125;func (s *CacheService) Get(ctx context.Context, req *rpc.GetReq) (*rpc.GetResp, error) &#123; return nil, fmt.Errorf(&quot;unimplemented&quot;)&#125;func (s *CacheService) Store(ctx context.Context, req *rpc.StoreReq) (*rpc.StoreResp, error) &#123; return nil, fmt.Errorf(&quot;unimplemented&quot;)&#125; client.go123456789101112131415161718192021222324252627func clientMain() &#123; if err != runClient(); err != nil &#123; fmt.Fprintf(os.Stderr, &quot;failed: %v\n&quot;, err) os.Exit(1) &#125;&#125;func runClient() error &#123; // å»ºç«‹è¿žæŽ¥ conn, err := grpc.Dial(&quot;localhost:5053&quot;, grpc.WithInsecure()) if err != nil &#123; return fmt.Errorf(&quot;failed to dial server: %v&quot;, err) &#125; cache := rpc.NewCacheClient(conn) // è°ƒç”¨ grpc çš„ store() æ–¹æ³•å­˜å‚¨é”®å€¼å¯¹ &#123; &quot;gopher&quot;: &quot;con&quot; &#125; _, err = cache.Store(context.Background(), &amp;rpc.StoreReq&#123;Key: &quot;gopher&quot;, Val: []byte(&quot;con&quot;)&#125;) if err != nil &#123; return fmt.Errorf(&quot;failed to store: %v&quot;, err) &#125; // è°ƒç”¨ grpc çš„ get() æ–¹æ³•å–å›žé”®ä¸º `gopher` çš„å€¼ resp, err := cache.Get(context.Background(), &amp;rpc.GetReq&#123;Key: &quot;gopher&quot;&#125;) if err != nil &#123; return fmt.Errorf(&quot;failed to get: %v&quot;, err) &#125; // è¾“å‡º fmt.Printf(&quot;Got cached value %s\n&quot;, resp.Val) return nil&#125; è¿™ä¸å°±æ˜¯ WSDL ä¹ˆï¼Ÿæˆ–è®¸æœ‰äº›äººä¼šè®¤ä¸ºè¿™å’Œ WSDL ä¹Ÿå¤ªåƒäº†ï¼Œè¿™ä¹ˆæƒ³æ²¡æœ‰é”™ï¼Œå› ä¸º gRPC åœ¨å€Ÿé‰´ä¹‹å‰çš„ SOAP/WSDL çš„é”™è¯¯åŸºç¡€ä¸Šï¼Œä¹Ÿå¸å–äº†ä»–ä»¬ä¼˜ç§€çš„åœ°æ–¹ã€‚ å’Œ XML å…³ç³»æ²¡é‚£ä¹ˆç´§(grpc æ˜¯å¯æ’æ‹”å¼çš„ï¼Œå¯ä»¥æ¢æˆå„ç§åº•å±‚è¡¨è¿°) å†™è¿‡ XML/XSD çš„äººéƒ½çŸ¥é“è¿™äº›æœåŠ¡å®šä¹‰å¤ªç¹é‡äº†ï¼ŒgRPC æ²¡æœ‰è¿™ä¸ªé—®é¢˜ WSDLè¿™ç±»æœ‰å®Œå…¨ä¸å¿…è¦çš„å¤æ‚åº¦ã€å’ŒåŸºæœ¬ä¸éœ€è¦çš„åŠŸèƒ½ï¼ˆä¸¤æ­¥ commitï¼‰ WSDL ä¸çµæ´»ã€è€Œä¸”æ— æ³•å‰å‘å…¼å®¹ï¼ˆä¸åƒ protobufï¼‰ SOAP/WSDL æ€§èƒ½å¤ªå·®ï¼Œä»¥åŠæ— æ³•ä½¿ç”¨æµ ä½†æ˜¯WSDLä¸­çš„æœºå™¨å¯ä»¥ç†è§£çš„APIå®šä¹‰ç¡®å®žæ˜¯ä¸ªå¥½ä¸œè¥¿ å®žçŽ°å…·ä½“çš„ CacheServiceserver.go 1234567891011type CacheService struct &#123; store map[string][]byte&#125;func (s *CacheService) Get(ctx context.Context, req *rpc.GetReq) (*rpc.GetResp, error) &#123; val := s.store[req.Key] return &amp;rpc.GetResp&#123;Val: val&#125;, nil&#125;func (s *CacheService) Store(ctx context.Context, req *rpc.StoreReq) (*rpc.StoreResp, error) &#123; s.store[req.Key] = req.Val return &amp;rpc.StoreResp&#123;&#125;, nil&#125; æ³¨æ„è¿™é‡Œæ²¡æœ‰é”ï¼Œä½ å¯ä»¥æƒ³æƒ³ä»–ä»¬ä¸­æœ‰ï¼Œå› ä¸ºå°†æ¥ä»–ä»¬ä¼šè¢«å¹¶å‘çš„è°ƒç”¨çš„ã€‚ é”™è¯¯å¤„ç†å½“ç„¶ï¼ŒgRPC æ”¯æŒé”™è¯¯å¤„ç†ã€‚å‡è®¾æ”¹å†™ä¸Šé¢çš„ Get()ï¼Œå¯¹ä¸å­˜åœ¨çš„é”®è¿›è¡ŒæŠ¥é”™ï¼š 1234567func (s *CacheService) Get(ctx context.Context, req *rpc.GetReq) (*rpc.GetResp, error) &#123; val, ok := s.store[req.Key] if !ok &#123; return nil, status.Errorf(code.NotFound, &quot;Key not found %s&quot;, req.Key) &#125; return &amp;rpc.GetResp&#123;Val: val&#125;, nil&#125; åŠ å¯†ä¼ è¾“å¦‚æžœè¿™æ ·çš„ä»£ç æ‰“ç®—åŽ»éƒ¨ç½²çš„è¯ï¼Œä¸€å®šä¼šè¢« SRE æ‹¦æˆªä¸‹æ¥ï¼Œå› ä¸ºæ‰€æœ‰é€šè®¯å¿…é¡»åŠ å¯†ä¼ è¾“ã€‚ åœ¨ gRPC ä¸­æ·»åŠ  TLS åŠ å¯†ä¼ è¾“å¾ˆå®¹æ˜“ã€‚æ¯”å¦‚æˆ‘ä»¬ä¿®æ”¹ runServer() æ·»åŠ  TLS åŠ å¯†ä¼ è¾“ã€‚ 12345678func runServer() error &#123; tlsCreds, err := credentials.NewServerTLSFromFile(&quot;tls.crt&quot;, &quot;tls.key&quot;) if err != nil &#123; return err &#125; srv := grpc.NewServer(grpc.Creds(tlsCreds)) ...&#125; åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¿®æ”¹ä¸€ä¸‹ runClient()ã€‚ 12345func runClient() error &#123; tlsCreds := credentials.NewTLS(&amp;tls.Config(InsecureSkipVerify: true)) conn, err := grpc.Dial(&quot;localhost:5051&quot;, grpc.WithTransportCredentials(tlsCreds)) ...&#125; ç”Ÿäº§çŽ¯å¢ƒå¦‚ä½•ä½¿ç”¨ gRPC HTTP/2 protobuf serialization (pluggable) å®¢æˆ·ç«¯ä¼šå’Œ grpc æœåŠ¡å™¨æ‰“å¼€ä¸€ä¸ªé•¿è¿žæŽ¥ å¯¹äºŽæ¯ä¸€ä¸ª RPC è°ƒç”¨éƒ½å°†æ˜¯ä¸€ä¸ªæ–°çš„ HTTP/2 stream å…è®¸æ¨¡æ‹Ÿé£žè¡Œæ¨¡å¼çš„ RPC è°ƒç”¨ å…è®¸å®¢æˆ·ç«¯ å’Œ æœåŠ¡ç«¯ Streaming gRPC çš„å®žçŽ°çŽ°åœ¨æœ‰3ä¸ªé«˜æ€§èƒ½çš„ã€äº‹ä»¶é©±åŠ¨çš„å®žçŽ° C Ruby, Python, Node.js, PHP, C#, Objective-C, C++ éƒ½æ˜¯å¯¹è¿™ä¸ª C core å®žçŽ°çš„ç»‘å®š PHP åˆ™æ˜¯é€šè¿‡ PECL å’Œè¿™ä¸ªå®žçŽ°çš„ç»‘å®š Java Netty + BoringSSL é€šè¿‡ JNI Go çº¯ Go å®žçŽ°ï¼Œä½¿ç”¨äº† Go æ ‡å‡†åº“çš„ crypto/tls gRPC ä»Žå“ªæ¥çš„ æœ€åˆæ˜¯ Google çš„ä¸€ä¸ªå›¢é˜Ÿåˆ›å»ºçš„ æ›´æ—©æœŸçš„æ˜¯ Google ä¸€ä¸ªå†…éƒ¨é¡¹ç›®å«åš stubby è¿™ä¸ª gRPC æ˜¯å…¶ä¸‹ä¸€ä»£å¼€æºé¡¹ç›®ï¼Œå¹¶ä¸”çŽ°åœ¨ä¸ä»…ä»…æ˜¯ Google åœ¨ä½¿ç”¨ï¼Œå¾ˆå¤šå…¬å¸éƒ½åœ¨è´¡çŒ®ä»£ç  å½“ç„¶ï¼ŒGoogle è¿˜æ˜¯ä¸»è¦ä»£ç è´¡çŒ®è€… ç”Ÿäº§çŽ¯å¢ƒæ¡ˆä¾‹ï¼šå¤šç§Ÿæˆ·ä¸Šçº¿ç”Ÿäº§åŽï¼Œå‘çŽ°æœ‰ä¸€éƒ¨åˆ†å®¢æˆ·äº§ç”Ÿäº†å¤§é‡çš„é”®å€¼ï¼Œè¯¢é—®å¾—çŸ¥ï¼Œæœ‰çš„å®¢æˆ·å¸Œæœ›å¯¹æ‰€æœ‰ä¸œè¥¿éƒ½ç¼“å­˜ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯å¯¹æˆ‘ä»¬è¿™ä¸ªç¼“å­˜æœåŠ¡å¾ˆå¥½çš„äº‹æƒ…ã€‚ æˆ‘ä»¬å¸Œæœ›é™åˆ¶è¿™ç§è¡Œä¸ºï¼Œä½†å¯¹äºŽå½“å‰ç³»ç»Ÿè€Œè¨€ï¼Œæ— æ³•æ»¡è¶³è¿™ç§éœ€æ±‚ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¿®æ”¹å®žçŽ°ï¼Œå¯¹æ¯ä¸ªå®¢æˆ·å‘æ”¾å®¢æˆ· tokenï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥çº¦æŸç‰¹å®šå®¢æˆ·æœ€å¤šå¯ä»¥å»ºç«‹å¤šå°‘é”®å€¼ï¼Œé¿å…ç³»ç»Ÿæ»¥ç”¨ã€‚è¿™å°±æˆä¸ºäº†å¤šç§Ÿæˆ·çš„ç¼“å­˜æœåŠ¡ã€‚ å’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»Ž IDL å¼€å§‹ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹æŽ¥å£ï¼Œå¢žåŠ  account_token é¡¹ã€‚ 12345message StoreReq &#123; string key = 1; bytes val = 2; string account_token = 3;&#125; åŒæ ·ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ç‹¬ç«‹çš„æœåŠ¡é’ˆå¯¹è´¦æˆ·æœåŠ¡ï¼Œæ¥èŽ·å–è´¦æˆ·æ‰€å…è®¸çš„ç¼“å­˜é”®æ•°ï¼š 123456789101112service Accounts &#123; rpc GetByToken(GetByTokenReq) return (GetByTokenResp) &#123;&#125;&#125;message GetByTokenReq &#123; string token = 1;&#125;message GetByTokenResp &#123; Account account = 1;&#125;message Account &#123; int64 max_cache_keys = 1;&#125; è¿™é‡Œå»ºç«‹äº†ä¸€ä¸ªæ–°çš„ Accounts æœåŠ¡ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ª GetByToken() æ–¹æ³•ï¼Œç»™å…¥ tokenï¼Œè¿”å›žä¸€ä¸ª Account ç±»åž‹çš„ç»“æžœï¼Œè€Œ Account å†…æœ‰ max_cache_keys é”®å¯¹åº”æœ€å¤§å¯ç¼“å­˜çš„é”®å€¼æ•°ã€‚ çŽ°åœ¨æˆ‘ä»¬è¿›ä¸€æ­¥ä¿®æ”¹ client.go 12345678910111213func runClient() error &#123; ... cache := rpc.NewCacheClient(conn) _, err = cache.Store(context.Background(), &amp;rpc.StoreReq&#123; AccountToken: &quot;inconshreveable&quot;, Key: &quot;gopher&quot;, Val: []byte(&quot;con&quot;), &#125;) if err != nil &#123; return fmt.Errorf(&quot;failed to store: %v&quot;, err) &#125; ...&#125; æœåŠ¡ç«¯çš„æ”¹å˜è¦ç¨å¾®å¤§ä¸€äº›ï¼Œä½†ä¸è¿‡åˆ†ã€‚ 12345type CacheService struct &#123; accounts rpc.AccountsClient store map[string][]byte keysByAccount map[string]int64&#125; æ³¨æ„è¿™é‡Œçš„ accounts æ˜¯ä¸€ä¸ª grpc çš„å®¢æˆ·ç«¯ï¼Œå› ä¸ºæˆ‘ä»¬è¿™ä¸ªæœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¦ä¸€ä¸ª grpc æœåŠ¡çš„å®¢æˆ·ç«¯ã€‚æ‰€ä»¥åœ¨æŽ¥ä¸‹æ¥çš„ Store() å®žçŽ°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å…ˆé€šè¿‡ accounts è°ƒç”¨å¦ä¸€ä¸ªæœåŠ¡å–å¾—è´¦æˆ·ä¿¡æ¯ã€‚ 1234567891011121314151617181920func (s *CacheService) Store(ctx context.Context, req *rpc.StoreReq) (*rpc.StoreResp, error) &#123; // è°ƒç”¨å¦ä¸€ä¸ªæœåŠ¡å–å¾—è´¦æˆ·ä¿¡æ¯ï¼ŒåŒ…å«å…¶é”®å€¼é™åˆ¶ resp, err := s.accounts.GetByToken(context.Background(), &amp;rpc.GetByTokenReq&#123; Token: req.AccountToken, &#125;) if err != nil &#123; return nil, err &#125; // æ£€æŸ¥æ˜¯å¦è¶…é‡ä½¿ç”¨ if s.keysByAccount[req.AccountToken] &gt;= resp.Account.MaxCacheKeys &#123; return nil, status.Errorf(codes.FailedPrecondition, &quot;Account %s exceeds max key limit %d&quot;, req.AccountToken, resp.Account.MaxCacheKeys) &#125; // å¦‚æžœé”®ä¸å­˜åœ¨ï¼Œéœ€è¦æ–°åŠ é”®å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯¹è®¡æ•°å™¨åŠ ä¸€ if _, ok := s.store[req.Key]; !ok &#123; s.keysByAccount[req.AccountToken] += 1 &#125; // ä¿å­˜é”®å€¼ s.store[req.Key] = req.Val return &amp;rpc.StoreResp&#123;&#125;, nil&#125; ç”Ÿäº§çŽ¯å¢ƒæ¡ˆä¾‹ï¼šæ€§èƒ½ä¸Šé¢çš„é—®é¢˜è§£å†³äº†ï¼Œæˆ‘ä»¬æœåŠ¡åˆæ¢å¤äº†æ­£å¸¸ï¼Œä¸ä¼šæœ‰ç”¨æˆ·å»ºç«‹è¿‡å¤šçš„é”®å€¼äº†ã€‚ä½†æ˜¯å¾ˆå¿«ï¼Œæˆ‘ä»¬å°±åˆæ”¶åˆ°äº†å…¶ä»–ç”¨æˆ·å‘æ¥çš„æ–°çš„ issueï¼Œå¾ˆå¤šäººååº”è¯´æ–°ç³»ç»Ÿå˜æ…¢äº†ï¼Œæ²¡æœ‰è¾¾åˆ° SLA çš„è¦æ±‚ã€‚ å¯æ˜¯æˆ‘ä»¬æ ¹æœ¬ä¸çŸ¥é“åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼ŒäºŽæ˜¯æ„è¯†åˆ°äº†ï¼Œæˆ‘ä»¬çš„ç¨‹åºæ²¡æœ‰ä»»ä½•å¯è§‚å¯Ÿæ€§ï¼ˆObservabilityï¼‰ï¼Œæ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬çš„ç¨‹åºæ²¡æœ‰ä»»ä½•è®¡é‡ç³»ç»Ÿæ¥ç»Ÿè®¡æ€§èƒ½ç›¸å…³çš„æ•°æ®ã€‚ æˆ‘ä»¬å…ˆä»Žæœ€ç®€å•çš„åšèµ·ï¼Œæ·»åŠ æ—¥å¿—ã€‚ æˆ‘ä»¬å…ˆä»Ž client.go å¼€å§‹ï¼Œå¢žåŠ ä¸€äº›æµ‹é‡å’Œè®¡æ•°ä»¥åŠæ—¥å¿—è¾“å‡ºã€‚ 12345678910111213141516171819202122...// å¼€å§‹è®¡æ—¶start := time.Now()_, err = cache.Store(context.Background(), &amp;rpc.StoreReq&#123; AccountToken: &quot;inconshreveable&quot;, Key: &quot;gopher&quot;, Val: []byte(&quot;con&quot;),&#125;)// è®¡ç®— cache.Store() è°ƒç”¨æ—¶é—´log.Printf(&quot;cache.Store duration %s&quot;, time.Since(start))if err != nil &#123; return fmt.Errorf(&quot;failed to store: %v&quot;, err)&#125;// å†æ¬¡å¼€å§‹è®¡æ—¶start = time.Now()// è°ƒç”¨ grpc çš„ get() æ–¹æ³•å–å›žé”®ä¸º `gopher` çš„å€¼resp, err := cache.Get(context.Background(), &amp;rpc.GetReq&#123;Key: &quot;gopher&quot;&#125;)// è®¡ç®— cache.Get() è°ƒç”¨æ—¶é—´log.Printf(&quot;cache.Get duration %s&quot;, time.Since(start))if err != nil &#123; return fmt.Errorf(&quot;failed to get: %v&quot;, err)&#125; åŒæ ·ï¼Œåœ¨æœåŠ¡ç«¯ä¹Ÿè¿™ä¹ˆå¤„ç†ã€‚ 1234567891011func (s *CacheService) Store(ctx context.Context, req *rpc.StoreReq) (*rpc.StoreResp, error) &#123; // å¼€å§‹è®¡æ—¶ start := time.Now() // è°ƒç”¨å¦ä¸€ä¸ªæœåŠ¡å–å¾—è´¦æˆ·ä¿¡æ¯ï¼ŒåŒ…å«å…¶é”®å€¼é™åˆ¶ resp, err := s.accounts.GetByToken(context.Background(), &amp;rpc.GetByTokenReq&#123; Token: req.AccountToken, &#125;) // è¾“å‡º account.GetByToken() çš„è°ƒç”¨æ—¶é—´ log.Printf(&quot;accounts.GetByToken duration %s&quot;, time.Since(start)) ...&#125; ç»è¿‡è¿™äº›ä¿®æ”¹åŽï¼Œæˆ‘ä»¬å‘çŽ°ä¸€æ ·çš„äº‹æƒ…åœ¨ååå¤å¤çš„åšï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆåŠžæ³•å¯ä»¥æ”¹å˜è¿™ç§æ— èŠçš„åšæ³•ä¹ˆï¼ŸæŸ¥é˜… grpc æ–‡æ¡£åŽï¼Œçœ‹åˆ°æœ‰ä¸€ä¸ªå«åš Client Interceptor çš„ä¸œè¥¿ã€‚ è¿™ç›¸å½“äºŽæ˜¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œä½†æ˜¯æ˜¯åœ¨å®¢æˆ·ç«¯ã€‚å½“å®¢æˆ·ç«¯è¿›è¡Œ rpc è°ƒç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªä¸­é—´ä»¶å…ˆä¼šè¢«è°ƒç”¨ï¼Œå› æ­¤è¿™ä¸ªä¸­é—´ä»¶å¯ä»¥å¯¹è°ƒç”¨è¿›è¡Œä¸€å±‚åŒ…è£…ï¼Œç„¶åŽå†è¿›è¡Œè°ƒç”¨ã€‚ ä¸ºäº†å®žçŽ°è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå«åš interceptor.goï¼š 1234567891011121314151617func WithClientInterceptor() grpc.DialOption &#123; return grpc.WithUnaryInterceptor(clientInterceptor)&#125;func clientInterceptor( ctx context.Context, method string, req interface&#123;&#125;, reply interface&#123;&#125;, cc *grpc.ClientConn, invoker grpc.UnaryInvoker, opts ...grpc.CallOption,) error &#123; start := time.Now() err := invoker(ctx, method, req, reply, cc, opts...) log.Printf(&quot;invoke remote method=%s duration=%s error=%v&quot;, method, time.Since(start), err) return err&#125; æˆ‘ä»¬æœ‰äº†è¿™ä¸ª WithClientInterceptor() ä¹‹åŽï¼Œå¯ä»¥åœ¨ grpc.Dial() çš„æ—¶å€™æ³¨å†Œè¿›åŽ»ã€‚client.go 1234567func runClient() error &#123; ... conn, err := grpc.Dial(&quot;localhost:5051&quot;, grpc.WithTransportCredentials(tlsCreds), WithClientInterceptor()) ...&#125; æ³¨å†Œä¹‹åŽï¼Œæ‰€æœ‰çš„ grpc è°ƒç”¨éƒ½ä¼šç»è¿‡æˆ‘ä»¬æ³¨å†Œçš„ clientInterceptor()ï¼Œå› æ­¤æ‰€æœ‰çš„æ—¶é—´å°±éƒ½æœ‰ç»Ÿè®¡äº†ï¼Œè€Œä¸ç”¨æ¯ä¸ªå‡½æ•°å†…éƒ¨ååå¤å¤çš„æ·»åŠ æ—¶é—´ã€è®¡é‡ã€è¾“å‡ºã€‚ æ·»åŠ äº†å®¢æˆ·ç«¯çš„è¿™ä¸ªè®¡é‡åŽï¼Œè‡ªç„¶è€Œç„¶å°±è”æƒ³åˆ°æœåŠ¡ç«¯æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥åšåŒæ ·çš„äº‹æƒ…ï¼Ÿç»è¿‡æŸ¥çœ‹æ–‡æ¡£ï¼Œå¯ä»¥ï¼Œæœ‰ä¸ªå«åš Server Interceptor çš„ä¸œè¥¿ã€‚ åŒæ ·çš„åšæ³•ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡ç«¯æ·»åŠ  interceptor.goï¼Œå¹¶ä¸”æ·»åŠ  ServerInterceptor() å‡½æ•°ã€‚ 1234567891011121314151617func ServerInterceptor() grpc.ServerOption &#123; return grpc.UnaryInterceptor(serverInterceptor)&#125;func serverInterceptor( ctx context.Context, req interface&#123;&#125;, info *grpc.UnaryServerInfo, handler grpc.UnaryHandler,) (interface&#123;&#125;, error) &#123; start := time.Now() resp, err := handler(ctx, req) log.Printf(&quot;invoke server method=%s duration=%s error=%v&quot;, info.FullMethod, time.Since(start), err) return resp, err&#125; å’Œå®¢æˆ·ç«¯ä¸€æ ·ï¼Œéœ€è¦åœ¨ runServer() çš„æ—¶å€™æ³¨å†Œæˆ‘ä»¬å®šä¹‰çš„è¿™ä¸ªä¸­é—´ä»¶ã€‚ 12345func runServer() error &#123; ... srv := grpc.NewServer(grpc.Creds(tlsCreds), ServerInterceptor()) ...&#125; ç”Ÿäº§çŽ¯å¢ƒæ¡ˆä¾‹ï¼šè¶…æ—¶æ·»åŠ äº†æ—¥å¿—åŽï¼Œæˆ‘ä»¬ç»ˆäºŽåœ¨æ—¥å¿—ä¸­å‘çŽ°ï¼Œ/rpc.Accounts/GetByToken/ èŠ±äº†å¥½é•¿çš„æ—¶é—´ã€‚æˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸ªæ“ä½œè®¾ç½®è¶…æ—¶ã€‚server.go 1234567func (s *CacheService) Store(ctx context.Context, req *rpc.StoreReq) (*rpc.StoreResp, error) &#123; accountsCtx, _ := context.WithTimeout(context.Background(), 2 * time.Second) resp, err := s.accounts.GetByToken(accountsCtx, &amp;rpc.GetByTokenReq&#123; Token: req.AccountToken, &#125;) ...&#125; è¿™é‡Œæ“ä½œå¾ˆç®€å•ï¼Œç›´æŽ¥ä½¿ç”¨æ ‡å‡†åº“ä¸­ context.WithTimeout() å°±å¯ä»¥äº†ã€‚ ç”Ÿäº§çŽ¯å¢ƒæ¡ˆä¾‹ï¼šä¸Šä¸‹æ–‡ä¼ é€’ç»è¿‡ä¸Šé¢ä¿®æ”¹åŽï¼Œå®¢æˆ·ä¾æ—§æŠ±æ€¨è¯´æ²¡æœ‰æ»¡è¶³ SLAï¼Œä»”ç»†ä¸€æƒ³ä¹Ÿå¯¹ã€‚å°±ç®—è¿™é‡Œçº¦æŸäº† 2 ç§’é’Ÿï¼Œå®¢æˆ·ç«¯è°ƒç”¨è¿˜éœ€è¦æ—¶é—´ï¼Œåˆ«çš„ä»£ç åœ¨ä¸­é—´ä¹Ÿæœ‰æ—¶é—´å¼€é”€ã€‚è€Œä¸”æœ‰çš„å®¢æˆ·è¯´ï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦1ç§’é’Ÿï¼Œè€Œä¸æ˜¯2ç§’é’Ÿã€‚ å¥½å§ï¼Œè®©æˆ‘ä»¬æŠŠè¿™ä¸ªæ—¶é—´è®¾å®šæŽ¨å‘è°ƒç”¨æ–¹ã€‚ é¦–å…ˆæˆ‘ä»¬è¦æ±‚åœ¨å®¢æˆ·ç«¯è¿›è¡Œè°ƒç”¨æ—¶é—´çº¦æŸçš„è®¾å®šï¼šclient.go 123456789func runClient() error &#123; ... ctx, _ := context.WithTimeout(context.Background(), time.Second) _, err = cache.Store(ctx, &amp;rpc.StoreReq&#123;Key: &quot;gopher&quot;, Val: []byte(&quot;con&quot;)&#125;) ... ctx, _ = context.WithTimeout(context.Background(), 50*time.Millisecond) resp, err := cache.Get(ctx, &amp;rpc.GetReq&#123;Key: &quot;gopher&quot;&#125;) ...&#125; ç„¶åŽåœ¨æœåŠ¡ç«¯ï¼Œæˆ‘ä»¬å°†ä¸Šä¸‹æ–‡ä¼ é€’ã€‚ç›´æŽ¥å–è°ƒç”¨æ–¹çš„ ctxã€‚ 123456func (s *CacheService) Store(ctx context.Context, req *rpc.StoreReq) (*rpc.StoreResp, error) &#123; resp, err := s.accounts.GetByToken(ctx, &amp;rpc.GetByTokenReq&#123; Token: req.AccountToken, &#125;) ...&#125; ç”Ÿäº§çŽ¯å¢ƒæ¡ˆä¾‹ï¼šGRPC Metadataä¸Šé¢çš„é—®é¢˜éƒ½è§£å†³äº†ï¼Œç»ˆäºŽå¯ä»¥æ¾ä¸€å£æ°”äº†ã€‚å¯æ˜¯å®¢æˆ·åˆææ–°çš„éœ€æ±‚äº†â€¦â€¦ðŸ˜…ï¼Œè¯´æˆ‘ä»¬èƒ½ä¸èƒ½å¢žåŠ ä¸€ä¸ª Dry Run çš„æ ‡å¿—ï¼Œå°±æ˜¯è¯´æˆ‘å¸Œæœ›ä½ åšæ‰€æœ‰éœ€è¦åšçš„äº‹æƒ…ï¼Œé™¤äº†çœŸçš„ä¿®æ”¹é”®å€¼åº“ã€‚ GRPC metadataï¼Œä¹Ÿç§°ä¸º GRPC çš„ Headerã€‚å°±åƒ HTTP å¤´ä¸€æ ·ï¼Œå¯ä»¥æœ‰ä¸€äº› Metadata ä¿¡æ¯ä¼ é€’è¿‡æ¥ã€‚ä½¿ç”¨ metadataï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„ Dry Run çš„å®žçŽ°å˜å¾—æ›´ç®€æ´ï¼Œä¸å¿…æ¯ä¸ª RPC æ–¹æ³•å†…éƒ½å®žçŽ°ä¸€éæ£€æŸ¥ Dry Run æ ‡å¿—çš„é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥ç‹¬ç«‹å‡ºæ¥ã€‚ 1234567891011121314151617181920212223242526func (s *CacheService) Store(ctx context.Context, req *rpc.StoreReq) (*rpc.StoreResp, error) &#123; resp, err := s.accounts.GetByToken(ctx, &amp;rpc.GetByTokenReq&#123; Token: req.AccountToken, &#125;) if !dryRun(ctx) &#123; if _, ok := s.store[req.Key]; !ok &#123; s.keysByAccount[req.AccountToke] += 1 &#125; s.store[req.Key] = req.Val &#125; return &amp;rpc.StoreResp&#123;&#125;, nil&#125;func dryRun(ctx context.Context) bool &#123; md, ok := metadata.FromContext(ctx) if !ok &#123; return false &#125; val, ok := md[&quot;dry-run&quot;] if !ok &#123; return false &#125; if len(val) &lt; 1 &#123; return false &#125; return val[0] == &quot;1&quot;&#125; å½“ç„¶ï¼Œè¿™ä¹ˆåšæ˜¯æœ‰å¦¥åçš„ï¼Œå› ä¸ºé€šç”¨åŒ–åŽå°±å¤±åŽ»äº†ç±»åž‹æ£€æŸ¥çš„èƒ½åŠ›ã€‚ åœ¨å®¢æˆ·ç«¯è°ƒç”¨çš„æ—¶å€™ï¼Œåˆ™éœ€è¦æ ¹æ®æƒ…å†µæ·»åŠ  dry-run å‚æ•°ç»™ metadataã€‚ 1234567func runClient() error &#123; ... ctx, _ := context.WithTimeout(context.Background(), time.Second) ctx = metadata.NewContext(ctx, metadata.Pairs(&quot;dry-run&quot;, &quot;1&quot;)) _, err = cache.Store(ctx, &amp;rpc.StoreReq&#123;Key: &quot;gopher&quot;, Val: []byte(&quot;con&quot;)&#125;) ...&#125; ç”Ÿäº§çŽ¯å¢ƒæ¡ˆä¾‹ï¼šRetryå®žçŽ°äº† Dry Run ä»¥ä¸ºå¯ä»¥ä¼‘æ¯äº†ï¼Œä¹‹å‰æŠ±æ€¨æ…¢çš„å®¢æˆ·åˆæ¥æŠ±æ€¨äº†ï¼Œè™½ç„¶æœ‰è¶…æ—¶æŽ§åˆ¶ï¼Œæ»¡è¶³ SLAï¼Œä½†æ˜¯æœåŠ¡é‚£è¾¹è¿˜æ˜¯æ…¢ï¼Œæ€»è¶…æ—¶ä¸æˆåŠŸã€‚æ£€æŸ¥äº†ä¸€ä¸‹ï¼Œå‘çŽ°æ˜¯ç½‘ç»œä¸Šçš„äº‹æƒ…ï¼Œæˆ‘ä»¬æ²¡æœ‰å¤ªå¤šå¯ä»¥åšçš„äº‹æƒ…ã€‚ä¸ºäº†è§£å†³å®¢æˆ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¥æ·»åŠ ä¸€ä¸ªé‡è¯•çš„æœºåˆ¶ã€‚ æˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸€ä¸ª gRPC è°ƒç”¨æ·»åŠ ä¸€ä¸ª Retry æœºåˆ¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åƒä¹‹å‰è®¡æ—¶ç»Ÿè®¡é‚£æ ·ï¼Œä½¿ç”¨ Interceptor å§ï¼Ÿ 12345678910111213141516171819202122232425func clientInterceptor(...) error &#123; var ( start = time.Now() attempts = 0 err error backoff retryBackOff ) for &#123; attempts += 1 select &#123; case &lt;-ctx.Done(): err = status.Errorf(codes.DeadlineExceeded, &quot;timeout reached before next retry attempt&quot;) case &lt;-backoff.Next(): startAttempt := time.Now() err = invoker(ctx, method, req, reply, cc, opts...) if err != nil &#123; log.Printf(...) continue &#125; &#125; break &#125; log.Printf(...) return err&#125; çœ‹èµ·æ¥è¿˜ä¸é”™ï¼Œç„¶åŽå°±æ‰“ç®—å‘å¸ƒè¿™ä¸ªä»£ç äº†ã€‚ç»“æžœæäº¤å®¡æ ¸çš„æ—¶å€™è¢«æ‰“å›žæ¥äº†ï¼Œè¯´è¿™ä¸ªä»£ç ä¸åˆç†ï¼Œå› ä¸ºå¦‚æžœæ˜¯éžå¹‚ç­‰ï¼ˆnon-idempotentï¼‰ çš„æ“ä½œï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å¤šæ¬¡æ‰§è¡Œï¼Œæ”¹å˜æœŸæœ›ç»“æžœäº†ã€‚ çœ‹æ¥æˆ‘ä»¬å¾—é’ˆå¯¹å¹‚ç­‰å’Œéžå¹‚ç­‰æ“ä½œåŒºåˆ«å¯¹å¾…äº†ã€‚ 1silo.FireZeMissiles(NotIdempotent(ctx), req) å—¯ï¼Œå½“ç„¶ï¼Œæ²¡è¿™ä¸ªä¸œè¥¿ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±æ¥åˆ›é€ ä¸€ä¸ªæ ‡è®°ï¼Œé€šè¿‡ contextï¼Œæ¥æ ‡æ˜Žæ“ä½œæ˜¯å¦å¹‚ç­‰ã€‚ 12345678910func NotIdempotent(ctx context.Context) context.Context &#123; return context.WithValue(ctx, &quot;idempotent&quot;, false)&#125;func isIdempotent(ctx context.Context) bool &#123; val, ok := ctx.Value(&quot;idempotent&quot;).(bool) if !ok &#123; return true &#125; return val&#125; ç„¶åŽåœ¨æˆ‘ä»¬çš„ clientInterceptor() å®žçŽ°ä¸­åŠ å…¥ isIdempotent() åˆ¤æ–­ï¼š 12345678910111213141516171819202122232425func clientInterceptor(...) error &#123; var ( start = time.Now() attempts = 0 err error backoff retryBackOff ) for &#123; attempts += 1 select &#123; case &lt;-ctx.Done(): err = status.Errorf(codes.DeadlineExceeded, &quot;timeout reached before next retry attempt&quot;) case &lt;-backoff.Next(): startAttempt := time.Now() err = invoker(ctx, method, req, reply, cc, opts...) if err != nil &amp;&amp; isIdempotent(ctx) &#123; log.Printf(...) continue &#125; &#125; break &#125; log.Printf(...) return err&#125; è¿™æ ·å½“è°ƒç”¨å¤±è´¥åŽï¼Œå®¢æˆ·ç«¯æ£€æŸ¥å‘çŽ°æ˜¯å¹‚ç­‰çš„æƒ…å†µï¼Œæ‰é‡è¯•ï¼Œå¦åˆ™ä¸é‡è¯•ã€‚é¿å…äº†éžå¹‚ç­‰æ“ä½œçš„åå¤æ“ä½œã€‚ ç”Ÿäº§çŽ¯å¢ƒæ¡ˆä¾‹ï¼šç»“æž„åŒ–é”™è¯¯æ„Ÿè§‰æ²¡å•¥é—®é¢˜äº†ï¼ŒäºŽæ˜¯éƒ¨ç½²ä¸Šçº¿äº†ã€‚å¯æ˜¯è¿è¡Œä¸€æ®µæ—¶é—´åŽï¼Œå‘çŽ°æœ‰äº›ä¸å¯¹åŠ²ã€‚æ‰€æœ‰æˆåŠŸçš„RPCè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ“ä½œæœ¬èº«æ˜¯æ­£ç¡®çš„ï¼Œéƒ½æ²¡æœ‰é—®é¢˜ï¼Œè¶…æ—¶é‡è¯•ä¹Ÿæ­£å¸¸ã€‚ä½†æ˜¯æ‰€æœ‰å¤±è´¥çš„ RPC è°ƒç”¨éƒ½ä¸å¯¹äº†ï¼Œæ‰€æœ‰å¤±è´¥çš„ RPC è°ƒç”¨ï¼Œéƒ½è¿”å›žè¶…æ—¶ï¼Œè€Œä¸æ˜¯é”™è¯¯æœ¬èº«ã€‚è¿™é‡Œè¯´çš„å¤±è´¥ï¼Œä¸æ˜¯è¯´ç½‘ç»œé—®é¢˜å¯¼è‡´è¶…æ—¶å•¥çš„ï¼Œè€Œæ˜¯è¯´è¯·æ±‚æœ¬èº«çš„å¤±è´¥ï¼Œæ¯”å¦‚ä¹‹å‰æåˆ°çš„ï¼ŒGet() ä¸å­˜åœ¨çš„é”®ï¼Œåº”è¯¥è¿”å›žé”™è¯¯ï¼›æˆ–è€… Store() è¶…è¿‡äº†é…é¢ï¼Œåº”è¯¥è¿”å›žé”™è¯¯ï¼Œè¿™ç±»é”™è¯¯åœ¨æ—¥å¿—ä¸­éƒ½æ²¡çœ‹åˆ°ï¼Œåè€Œéƒ½å¯¹åº”äº†è¶…æ—¶ã€‚ ç»è¿‡åˆ†æžå‘çŽ°ï¼ŒæœåŠ¡ç«¯è¯¥æŠ¥é”™éƒ½æŠ¥é”™ï¼Œæ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸å¯¹ï¼Œæœ¬åº”è¯¥è¿”å›žé”™è¯¯ç»™è°ƒç”¨æ–¹çš„åœ°æ–¹ï¼Œå®¢æˆ·ç«¯ä»£ç åè€Œåˆå¼€å§‹é‡è¯•è¿™ä¸ªæ“ä½œäº†ã€‚çœ‹æ¥ä¹‹å‰é‡è¯•çš„ä»£ç è¿˜æœ‰é—®é¢˜ã€‚ 12345err = invoker(ctx, method, req, reply, cc, opts...)if err != nil &amp;&amp; isIdempotent(ctx) &#123; log.Printf(...) continue&#125; å¦‚æžœä»”ç»†è§‚å¯Ÿè¿™éƒ¨åˆ†ä»£ç ï¼Œä¼šå‘çŽ°ï¼Œæ— è®º err æ˜¯ä»€ä¹ˆï¼Œåªè¦éž nilï¼Œæˆ‘ä»¬å°±é‡è¯•ã€‚å…¶å®žè¿™æ˜¯ä¸å¯¹çš„ï¼Œæˆ‘ä»¬åªæœ‰é’ˆå¯¹æŸäº›é”™è¯¯é‡è¯•ï¼Œæ¯”å¦‚ç½‘ç»œé—®é¢˜ä¹‹ç±»çš„ï¼Œè€Œä¸åº”è¯¥å¯¹æˆ‘ä»¬å¸Œæœ›è¿”å›žç»™è°ƒç”¨æ–¹çš„é”™è¯¯é‡è¯•ï¼Œé‚£æ²¡æœ‰æ„ä¹‰ã€‚ é‚£ä¹ˆé—®é¢˜å°±å˜æˆäº†ï¼Œæˆ‘ä»¬åˆ°åº•åº”è¯¥æ€Žä¹ˆå¯¹ err åˆ¤æ–­æ¥å†³å®šæ˜¯å¦é‡è¯•ï¼Ÿ å¯ä»¥ä½¿ç”¨ä¸åŒçš„ Error Codeï¼Œç‰¹å®šçš„ Code éœ€è¦ Retryï¼Œå…¶å®ƒçš„ä¸éœ€è¦ï¼Œé‚£å°±éœ€è¦è‡ªå®šä¹‰ gRPC é”™è¯¯ç ï¼› æˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰ä¸€ä¸ª Error ç±»åž‹çš„æ•°æ®ï¼Œé‡Œé¢åŒ…å«äº†æŸç§æ ‡å¿—ä½ï¼Œæ¥å‘ŠçŸ¥æ˜¯å¦å€¼å¾— retry æˆ–è€…å¹²è„†æŠŠé”™è¯¯ç æ”¾åˆ° Response çš„æ¶ˆæ¯é‡Œï¼Œç¡®ä¿æ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªæˆ‘ä»¬å®šä¹‰çš„é”™è¯¯ç ï¼Œæ¥æ ‡æ˜Žæ˜¯å¦éœ€è¦ retryã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç»“æž„åŒ–çš„é”™è¯¯ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ç®€å•çš„ä¸€ä¸ª Error Code å’Œå­—ç¬¦ä¸²ã€‚å½“ç„¶è¿™æ¡è·¯ä¸å¥½èµ°ï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»åšäº†è¿™ä¹ˆå¤šäº†ï¼ŒåšæŒä¸€ä¸‹è¿˜æ˜¯å¯ä»¥å…‹æœçš„ã€‚ è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ä»Ž IDL å¼€å§‹ï¼š 123456message Error &#123; int64 code = 1; string messsage = 2; bool temporary = 3; int64 userErrorCode = 4;&#125; ç„¶åŽæˆ‘ä»¬å®žçŽ°è¿™ä¸ª Error ç±»åž‹ã€‚rpc/error.go 12345678910func (e *Error) Error() string &#123; return e.Message&#125;func Errorf(code codes.Code, temporary bool, msg string, args ..interface&#123;&#125;) error &#123; return &amp;Error&#123; Code: int64(code), Message: fmt.Sprintf(msg, args...), Temporary: temporary, &#125;&#125; æœ‰è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºå’Œæž„é€ è¿™ä¸ª Error ç±»åž‹çš„å˜é‡äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¯¥æ€Žä¹ˆæŠŠé”™è¯¯æ¶ˆæ¯ä¼ å›žå®¢æˆ·ç«¯å‘¢ï¼Ÿç„¶åŽé—®é¢˜å°±å¼€å§‹å˜çš„ç¹çèµ·æ¥äº†ï¼šrpc/error.go 123456789101112131415161718192021222324252627func MarshalError (err error, ctx context.Context) error &#123; rerr, ok := err.(*Error) if !ok &#123; return err &#125; pberr, marshalerr := pb.Marshal(rerr) if marshalerr == nil &#123; md := metadata.Pairs(&quot;rpc-error&quot;, base64.StdEncoding.EncodeToString(pberr)) _ = grpc.SetTrailer(ctx, md) &#125; return status.Errorf(codes.Code(rerr.Code), rerr.Message)&#125;func UnmarshalError(err error, md metadata.MD) *Error &#123; vals, ok := md[&quot;rpc-error&quot;] if !ok &#123; return nil &#125; buf, err := base64.StdEncoding.DecodeString(vals[0]) if err != nil &#123; return nil &#125; var rerr Error if err := pb.Unmarshal(buf, &amp;rerr); err != nil &#123; return nil &#125; return &amp;rerr&#125; interceptor.go 123456789101112func serverInterceptor ( ctx context.Context, req interface&#123;&#125;, info *grpc.UnaryServerInfo, handler grpc.UnaryHandler,) (interface&#123;&#125;, error) &#123; start := time.Now() resp, err := handler(ctx, req) err = rpc.MarshalError(err, ctx) log.Print(...) return resp, err&#125; itâ€™s uglyï¼Œbut works. è¿™æ˜¯åœ¨ gRPC ä¸æ”¯æŒé«˜çº§ Error çš„æƒ…å†µä¸‹ï¼Œæ€Žä¹ˆåŽ» work around è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”å‡‘åˆç”¨èµ·æ¥ã€‚çŽ°åœ¨è¿™ä¹ˆåšï¼Œé”™è¯¯å°±å¯ä»¥è·¨ä¸»æœºè¾¹ç•Œä¼ é€’äº†ã€‚ ç”Ÿäº§çŽ¯å¢ƒæ¡ˆä¾‹ï¼šDumpåˆæœ‰å®¢æˆ·å‰æ¥æéœ€æ±‚äº†ï¼Œæœ‰çš„å®¢æˆ·è¯´æˆ‘ä»¬å¯ä»¥å­˜ã€ä¹Ÿå¯ä»¥å–ï¼Œä½†æ˜¯å¦‚ä½•æ‰èƒ½æŠŠé‡Œé¢æ‰€æœ‰çš„æ•°æ®éƒ½èŽ·å–ä¸‹æ¥ï¼ŸäºŽæ˜¯æœ‰äº†éœ€æ±‚ï¼Œå¸Œæœ›å®žçŽ° Dump() æ“ä½œï¼Œå¯ä»¥å–å›žæ‰€æœ‰æ•°æ®ã€‚ çŽ°åœ¨å·²ç»è½»è½¦ç†Ÿè·¯äº†ï¼Œæˆ‘ä»¬å…ˆæ”¹ IDLï¼Œæ·»åŠ ä¸€ä¸ª Dump() å‡½æ•°ã€‚ 1234567891011121314service Cache &#123; rpc Store(StoreReq) returns (StoreResp) &#123;&#125; rpc Get(GetReq) returns (GetResp) &#123;&#125; rpc Dump(DumpReq) returns (DumpResp) &#123;&#125;&#125;message DumpReq&#123;&#125;message DumpResp &#123; repeated DumpItem items = 1;&#125;message DumpItem &#123; string key = 1; bytes val = 2;&#125; è¿™é‡Œ DumpResp é‡Œé¢ç”¨çš„æ˜¯ repeatedï¼Œå› ä¸º protobuf é‡Œé¢ä¸çŸ¥é“ä¸ºå•¥ä¸å« arrayã€‚ ç”Ÿäº§çŽ¯å¢ƒæ¡ˆä¾‹ï¼šæµé‡æŽ§åˆ¶æ–°åŠŸèƒ½ Dump ä¸Šçº¿äº†ï¼Œç»“æžœå‘çŽ°å¤§å®¶éƒ½å¾ˆå–œæ¬¢ Dumpï¼Œæœ‰å¾ˆå¤šäººåœ¨ Dumpï¼Œç»“æžœæœåŠ¡å™¨çš„å†…å­˜å¼€å§‹ä¸å¤Ÿäº†ã€‚äºŽæ˜¯æˆ‘ä»¬éœ€è¦ä¸€äº›é™åˆ¶æ‰‹æ®µï¼Œå¯ä»¥æŽ§åˆ¶æµé‡ã€‚ æŸ¥é˜…äº†æ–‡æ¡£åŽï¼Œå‘çŽ°æˆ‘ä»¬å¯ä»¥æŽ§åˆ¶åŒæ—¶æœ€å¤§æœ‰å¤šå°‘å¹¶å‘å¯ä»¥è®¿é—®ï¼Œä»¥åŠå¯ä»¥å¤šé¢‘ç¹çš„æ¥è®¿é—®æœåŠ¡ã€‚server.go 1234567891011121314func runServer() error &#123; ... srv := grpc.NewServer(grpc.Creds(tlsCreds), ServerInterceptor(), grpc.MaxConcurrentStreams(64), grpc.InTapHandle(NewTap().Handler)) rpc.RegisterCacheServer(srv, NewCacheService(accounts)) l, err := net.Listen(&quot;tcp&quot;, &quot;localhost:5051&quot;) if err != nil &#123; return err &#125; l = netutil.LimitListener(l, 1024) return srv.Serve(l)&#125; è¿™é‡Œä½¿ç”¨äº† netutil.LimitListener(l, 1024) æŽ§åˆ¶äº†æ€»å…±å¯ä»¥æœ‰å¤šå°‘ä¸ªè¿žæŽ¥ï¼Œç„¶åŽç”¨ grpc.MaxConcurrentStreams(64) æŒ‡å®šäº†æ¯ä¸ª grpc çš„è¿žæŽ¥å¯ä»¥æœ‰å¤šå°‘ä¸ªå¹¶å‘æµ(stream)ã€‚è¿™ä¸¤ä¸ªç»“åˆèµ·æ¥åŸºæœ¬æŽ§åˆ¶äº†å¹¶å‘çš„æ€»æ•°ã€‚ ä½†æ˜¯ gRPC é‡Œæ²¡æœ‰åœ°æ–¹é™å®šå¯ä»¥å¤šé¢‘ç¹çš„è®¿é—®ã€‚å› æ­¤è¿™é‡Œç”¨äº† grpc.InTapHandle(NewTap().Handler)) æ¥è¿›è¡Œå®šåˆ¶ï¼Œè¿™æ˜¯åœ¨æ›´é å‰çš„ä½ç½®æ‰§è¡Œçš„ã€‚ tap.go 123456789101112type Tap struct &#123; lim *rate.Limiter&#125;func NewTap() *Tap &#123; return &amp;Tap(rate.NewLimiter(150, 5))&#125;func (t *Tap) Handler(ctx context.Context, info *tap.Info) (context.Context, error) &#123; if !t.lim.Allow() &#123; return nil, status.Errorf(codes.ResourceExhausted, &quot;service is over rate limit&quot;) &#125; return ctx, nil&#125; ç”Ÿäº§çŽ¯å¢ƒæ¡ˆä¾‹ï¼šStreamingä¹‹å‰çš„æ–¹æ¡ˆéƒ¨ç½²åŽï¼Œå†…å­˜ç»ˆäºŽé™ä¸‹æ¥äº†ï¼Œä½†æ˜¯è¿˜æ²¡ä¼‘æ¯ï¼Œå°±å‘çŽ°å¤§å®¶è¶Šæ¥è¶Šå–œæ¬¢ç”¨è¿™ä¸ªç¼“å­˜æœåŠ¡ï¼Œå†…å­˜åˆä¸å¤Ÿç”¨äº†ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¼€å§‹æ€è€ƒï¼Œæ˜¯ä¸æ˜¯å¯ä»¥è°ƒæ•´ä¸€ä¸‹è®¾è®¡ï¼Œä¸æ˜¯æ¯æ¬¡ Dump å°±ç«‹å³åœ¨å†…å­˜ç”Ÿæˆå®Œæ•´çš„è¿”å›žæ•°ç»„ï¼Œè€Œæ˜¯ä»¥æµçš„å½¢å¼ï¼ŒæŒ‰éœ€å‘å›žã€‚app.proto 12345678910111213syntax = &quot;proto3&quot;;package rpc;service Cache &#123; rpc Store(StoreReq) returns (StoreResp) &#123;&#125; rpc Get(GetReq) returns (GetResp) &#123;&#125; rpc Dump(DumpReq) returns (stream DumpItem) &#123;&#125;&#125;message DumpReq&#123;&#125;message DumpItem &#123; string key = 1; bytes val = 2;&#125; è¿™é‡Œä¸å†ä½¿ç”¨æ•°ç»„æ€§è´¨çš„ repeatedï¼Œè€Œæ˜¯ç”¨ streamï¼Œå®¢æˆ·ç«¯è¯·æ±‚ Dump() åŽï¼Œå°†ç»“æžœä»¥æµçš„å½¢å¼å‘å›žåŽ»ã€‚server.go 123456789func (s *CacheService) Dump(req *rpc.DumpReq, stream rpc.Cache_DumpServer) error &#123; for k, v := range s.store &#123; stream.Send(&amp;rpc.DumpItem&#123; Key: k, Val: v, &#125;) &#125; return nil&#125; æˆ‘ä»¬ä¿®æ”¹ Dump() çš„å®žçŽ°ï¼Œå¯¹äºŽæ¯ä¸ªè®°å½•ï¼Œåˆ©ç”¨ stream.Send() å‘é€åˆ°æµã€‚ æ³¨æ„è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰ contextï¼Œåªæœ‰ä¸ª streamã€‚client.go 1234567891011121314151617func runClient() error &#123; ... stream, err := cache.Dump(context.Background(), &amp;rpc.DumpReq&#123;&#125;) if err != nil &#123; return fmt.Errorf(&quot;failed to dump: %v&quot;, err) &#125; for &#123; item, err := stream.Recv() if err == io.EOF &#123; break &#125; if err != nil &#123; return fmt.Errorf(&quot;failed to stream item: %v&quot;, err) &#125; &#125; return nil&#125; ç”Ÿäº§çŽ¯å¢ƒæ¡ˆä¾‹ï¼šæ¨ªå‘æ‰©å±•ã€è´Ÿè½½å‡è¡¡ä½¿ç”¨æµåŽï¼ŒæœåŠ¡å™¨æ€§èƒ½æé«˜äº†å¾ˆå¤šï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬çš„æœåŠ¡å¤ªå¸å¼•äººäº†ï¼Œç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œç»“æžœåˆå†…å­˜ä¸å¤Ÿäº†ã€‚è¿™æ—¶å€™æˆ‘ä»¬å®¡æŸ¥ä»£ç ï¼Œæ„Ÿè§‰èƒ½åšçš„äº‹æƒ…éƒ½åšäº†ï¼Œæˆ–è®¸æ˜¯æ—¶å€™ä»Žå•ä¸€æœåŠ¡å™¨ï¼Œæ‰©å±•ä¸ºå¤šä¸ªæœåŠ¡å™¨ï¼Œç„¶åŽä¹‹é—´ä½¿ç”¨è´Ÿè½½å‡è¡¡ã€‚ gRPC æ˜¯é•¿è¿žæŽ¥æ€§è´¨çš„é€šè®¯ï¼Œå› æ­¤å¦‚æžœä¸€ä¸ªå®¢æˆ·ç«¯è¿žæŽ¥äº†ä¸€ä¸ª gRPC Endpointï¼Œé‚£ä¹ˆä»–å°±ä¼šä¸€ç›´è¿žæŽ¥åˆ°ä¸€ä¸ªå›ºå®šçš„æœåŠ¡å™¨ï¼Œå› æ­¤å¤šæœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡å¯¹åŒä¸€ä¸ªå®¢æˆ·ç«¯æ¥è¯´æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œä¸ä¼šå› ä¸ºè¿™ä¸ªå®¢æˆ·ç«¯æœ‰å¤§é‡çš„è¯·æ±‚è€Œå¯¼è‡´åˆ†æ•£è¯·æ±‚åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸ŠåŽ»ã€‚ å¦‚æžœæˆ‘ä»¬å¸Œæœ›å®¢æˆ·ç«¯å¯ä»¥åˆ©ç”¨å¤šæœåŠ¡å™¨çš„æœºåˆ¶ï¼Œæˆ‘ä»¬å°±éœ€è¦æ›´æ™ºèƒ½çš„å®¢æˆ·ç«¯ï¼Œè®©å®¢æˆ·ç«¯æ„è¯†åˆ°æœåŠ¡å™¨å­˜åœ¨å¤šä¸ªå‰¯æœ¬ï¼Œå› æ­¤å®¢æˆ·ç«¯å»ºç«‹å¤šæ¡è¿žæŽ¥åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œè¿™æ ·å°±å¯ä»¥è®©å•ä¸€å®¢æˆ·ç«¯åˆ©ç”¨è´Ÿè½½å‡è¡¡çš„æ¨ªå‘æ‰©å±•èƒ½åŠ›ã€‚ ç”Ÿäº§çŽ¯å¢ƒæ¡ˆä¾‹ï¼šå¤šè¯­è¨€åä½œåœ¨å¤æ‚çš„çŽ¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ gRPC çš„å®¢æˆ·ç«¯ï¼ˆç”šè‡³æœåŠ¡ç«¯ï¼‰å¯èƒ½æ˜¯ä¸åŒè¯­è¨€å¹³å°çš„ã€‚è¿™å…¶å®žæ˜¯ gRPC çš„ä¼˜åŠ¿ï¼Œå¯ä»¥æ¯”è¾ƒå®¹æ˜“çš„å®žçŽ°è·¨è¯­è¨€å¹³å°çš„é€šè®¯ã€‚ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åšä¸€ä¸ª Python å®¢æˆ·ç«¯ï¼š 12345678import grpcimport rpc_pb2 as rpcchannel = grpc.insecure_channel(&apos;localhost:5051&apos;)cache_svc = rpc.CacheStub(channel)resp = cache_svc.Get(rpc.GetReq( key=&quot;gopher&quot;,))print resp.val ä¸€ä¸ªä¸æ˜¯å¾ˆçˆ½çš„åœ°æ–¹æ˜¯è™½ç„¶ gRPC çš„è·¨è¯­è¨€é€šè®¯å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å„ä¸ªè¯­è¨€çš„å®žçŽ°éƒ½æ¯”è¾ƒéšæ„ï¼Œæ¯”å¦‚ Go ä¸­å«åš CacheClient()ï¼Œè€Œ Python ä¸­åˆ™å«åš CacheStub()ã€‚è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åŽŸå› éžä¸ä¸€æ ·çš„åå­—ï¼Œå°±æ˜¯ç”±äºŽä¸åŒçš„ä½œè€…å®žçŽ°çš„æ—¶å€™æŒ‰ç…§è‡ªå·±çš„æƒ³æ³•å‘½åçš„ã€‚ gRPC å°šä¸å®Œç¾Žçš„åœ°æ–¹ è´Ÿè½½å‡è¡¡ ç»“æž„åŒ–çš„é”™è¯¯ä¿¡æ¯ è¿˜ä¸æ”¯æŒæµè§ˆå™¨çš„ JS ï¼ˆæŸç§è§’åº¦ä¸Šè®²ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„å®¢æˆ·ç«¯ï¼‰ è¿˜ç»å¸¸å‘ç”Ÿ API æ”¹å˜ï¼ˆå³ä½¿éƒ½1.0äº†ï¼‰ æŸäº›è¯­è¨€å®žçŽ°çš„æ–‡æ¡£éžå¸¸å·® æ²¡æœ‰è·¨è¯­è¨€çš„æ ‡å‡†åŒ–çš„åšæ³• gRPC åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­çš„ç”¨ä¾‹ ngrokï¼Œæ‰€æœ‰å†…éƒ¨20å¤šä¸ªé€šè®¯éƒ½èµ°çš„æ˜¯ gRPC Squareï¼Œå°†å†…éƒ¨çš„é€šè®¯éƒ½æ¢æˆäº† gRPCï¼Œæ˜¯æœ€æ—©ä½¿ç”¨ gRPC çš„ç”¨æˆ·å’Œè´¡çŒ®è€… CoreOSï¼Œetcd v3 å®Œå…¨èµ°çš„æ˜¯ gRPC Googleï¼ŒGoogle Cloud Serviceï¼ˆPubSub, Speech Recï¼‰èµ°çš„æ˜¯ gRPC Netflix, Yik Yak, VSCO, Cockroach, â€¦ gRPC æœªæ¥çš„å˜åŒ– æƒ³äº†è§£æœªæ¥çš„å˜åŒ–å¯ä»¥æŸ¥çœ‹ï¼š grpc/proposal grpc-io é‚®ä»¶åˆ—è¡¨ æ–°çš„è¯­è¨€æ”¯æŒï¼ˆSwift å’Œ Haskellæ­£åœ¨è¯•éªŒé˜¶æ®µï¼‰ ç¨³å®šæ€§ã€å¯é æ€§ã€æ€§èƒ½çš„æé«˜ å¢žåŠ æ›´å¤šç»†åŒ–çš„ API æ¥æ”¯æŒè‡ªå®šä¹‰çš„è¡Œä¸ºï¼ˆè¿žæŽ¥ç®¡ç†ã€é¢‘é“è·Ÿè¸ªï¼‰ æµè§ˆå™¨çš„ JS]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>gRPC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç»™ Go åº“ä½œè€…çš„å»ºè®®]]></title>
    <url>%2Fgolang-practice-advice-for-go-library-authors.html</url>
    <content type="text"><![CDATA[Golang Practice Advice è§†é¢‘ä¿¡æ¯Practical Advice for Go Library Authorsby Jack Lindamoodat GopherCon 2016 https://www.youtube.com/watch?v=5v2fqm_8jYI å¹»ç¯åœ°å€ï¼šhttp://go-talks.appspot.com/github.com/cep21/go-talks/practical-advice-for-go-library-authors.slide#1 å‘½ååŒ…åæ˜¯å°†æ¥ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥é¿å…é‡å¤åŒ…åå’Œç»“æž„ä¸Žå‡½æ•°ã€‚æ¯”å¦‚ 1var h client.Client â†’ var h http.Client 1context.NewContext() =&gt; context.Background() Object Creationgolang æ²¡æœ‰æž„é€ å‡½æ•°ï¼Œå› æ­¤åˆ›å»ºå¯¹è±¡ä¸€èˆ¬æœ‰ä¸¤ç§åŠžæ³•: é»˜è®¤çš„0å€¼ å•ç‹¬çš„æž„é€ å‡½æ•°ï¼ŒNewSomething() æŽ¨èä½¿ç”¨é»˜è®¤ 0 å€¼çš„æž„é€ æ–¹æ³• åœ¨é»˜è®¤0å€¼çš„æƒ…å†µä¸‹ï¼Œå„ä¸ªæ–¹æ³•è¦å¤„ç†å¥½0å€¼ï¼Œæ¯”å¦‚æœ‰äº›ä¸œè¥¿å‘çŽ°æ˜¯0å€¼åŽï¼Œç»™å…¥ä¸€ä¸ªé»˜è®¤å€¼ã€‚ New() æž„é€ å‡½æ•°å¾ˆçµæ´»ï¼Œå¯ä»¥åšä»»ä½•äº‹æƒ…ï¼Œå› æ­¤å¯¹äºŽä»£ç é˜…è¯»ä¸Šä¸åˆ©ï¼Œæ„å‘³ç€éšè—äº†å¾ˆå¤šä¸œè¥¿ã€‚ æœ‰äº›åº“ä½¿ç”¨ç§æœ‰ structï¼Œå…¬å¼€æŽ¥å£çš„æ–¹æ³•ï¼ŒauthImpl struct and Auth interfaceï¼Œè¿™æ˜¯åæ¨¡å¼ï¼Œä¸æŽ¨èä½¿ç”¨ã€‚ ä¸æŽ¨èä½¿ç”¨ Singletonï¼Œè™½ç„¶æ ‡å‡†åº“ä¸­å¤§é‡ä½¿ç”¨äº† Singleton æ¨¡å¼ï¼Œä½†æ˜¯ Jack ä¸ªäººä¸å–œæ¬¢è¿™ç§æ¨¡å¼ã€‚ ä½¿ç”¨é«˜é˜¶å‡½æ•°ä½œä¸ºé€‰é¡¹è¿™ç§å½¢å¼ä¸æŽ¨èï¼šNewSomething(WithThingA(), WithThingB()) æ—¥å¿—ä¸€äº›æ—¥å¿—æ˜¯ç›´æŽ¥æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºåŽ»ï¼Œè¿™æ˜¯éžå¸¸ä¸å¥½çš„è®¾è®¡ï¼Œå› ä¸ºç”¨æˆ·å¦‚æžœæƒ³å…³æ ¹æœ¬å…³ä¸äº†ã€‚ å»ºè®® ç¡®å®šä¸€ä¸‹ä½œä¸ºåº“æ˜¯ä¸æ˜¯çœŸçš„éœ€è¦æ‰“å°æ—¥å¿—ï¼Œæ˜¯ä¸æ˜¯åº”è¯¥æŠŠè¾“å‡ºæ—¥å¿—çš„å·¥ä½œäº¤ç»™è°ƒç”¨æ–¹å†³å®šï¼Ÿ å¦‚æžœä¸€å®šéœ€è¦æ—¥å¿—ï¼Œé‚£ä¹ˆä½¿ç”¨å›žè°ƒå‡½æ•°æ–¹å¼ è¾“å‡ºæ—¥å¿—åˆ°ä¸€ä¸ª interface ä¸è¦å‡å®šä¼ è¿›æ¥çš„å°±æ˜¯æ ‡å‡†åº“çš„ log ï¼Œæœ‰å¾ˆå¤šé€‰æ‹©ã€‚ å°Šé‡ stdout å’Œ stderr ä¸è¦ä½¿ç”¨ singleton interface vs structæŽ¥å— interface ï¼Œä½†è¿”å›žçš„æ˜¯ struct è¿™ç‚¹å’Œ Java ä¸åŒï¼ŒJava æ›´å€¾å‘äºŽæ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯é€šè¿‡ interface æ“ä½œã€‚è€Œ golang ä¸éœ€è¦ï¼Œgolang ä½¿ç”¨çš„æ˜¯éšæ€§interfaceã€‚ ä»€ä¹ˆæ—¶å€™ panicæœ€å¥½éƒ½ä¸ panicã€‚å¦‚æžœéžè¦ panicï¼Œå¯èƒ½æœ€åˆé€‚çš„åœ°æ–¹æ˜¯ init çš„æ—¶å€™ï¼Œå› ä¸ºåˆšä¸€è¿è¡Œå°±èƒ½çœ‹åˆ°æŒ‚äº†ï¼Œæ¯”è¾ƒå®¹æ˜“å¤„ç†ã€‚ä½†å³ä½¿å¦‚æ­¤ï¼Œä¹Ÿå°½é‡ä¸è¦ panicã€‚ æ£€æŸ¥ erroré—®ï¼šæˆ‘ä»¬æ˜¯éœ€è¦æ£€æŸ¥æ‰€æœ‰çš„ error ä¹ˆï¼Ÿæ¯”å¦‚æœ‰äº›ä¼¼ä¹Žä¸å¤§å®¹æ˜“å‡ºé”™ã€‚ç­”ï¼šéœ€è¦ï¼Œç‰¹åˆ«æ˜¯ä½ è¯´çš„è¿™äº›ä¸å¤§å®¹æ˜“å‡ºé”™çš„ï¼ï¼ æˆ‘ä»¬ç”¨ error ä»£æ›¿äº† exceptionï¼Œæ‰€ä»¥ä¸è¦å¿½ç•¥è¿™ä¸ªä¸œè¥¿ã€‚ å¤„ç†çš„åŠžæ³• æœ€å¥½çš„åŠžæ³•æ˜¯ Bubble upï¼Œä¹Ÿå°±æ˜¯ä¼ å›žè°ƒç”¨æ–¹ ä½†æœ‰çš„æ—¶å€™ï¼ˆæ¯”å¦‚ goroutine) ä¸é€‚åˆï¼Œé‚£å°±ï¼š åšæ—¥å¿— æˆ–è€…å¢žåŠ æŸä¸ªè®¡æ•°å™¨ ä»€ä¹ˆæ—¶å€™åº”è¯¥è¿”å›žé”™è¯¯æ¯”è¾ƒåˆé€‚ï¼Ÿ å½“ä¸æ»¡è¶³çº¦å®š å½“éœ€è¦çš„ç­”æ¡ˆæ— æ³•å¾—åˆ° å…è®¸å¯ç”¨åº“çš„è°ƒè¯•èƒ½åŠ›ä¸ºæµ‹è¯•è€Œè®¾è®¡ ä¸ºäº†æ–¹ä¾¿è‡ªå·±æµ‹è¯• ä¸ºäº†æ–¹ä¾¿åº“ç”¨æˆ·æµ‹è¯• å¹¶å‘channelsè™½ç„¶ channel æ˜¯ golang ä¸€ä¸ªå¤„ç†å¹¶å‘å¾ˆå¥½åœ°ä¸œè¥¿ï¼Œä½†æ˜¯å¹¶éžæ‰€æœ‰åœºåˆéƒ½éœ€è¦ã€‚æ¯”å¦‚æ ‡å‡†åº“ä¸­å°±å¾ˆå°‘æœ‰åœ¨ API ä¸­ä½¿ç”¨ channel çš„ã€‚ å°†ä½¿ç”¨ channel çš„ä½ç½®å‘ä¸Šå±‚ç§»åŠ¨ã€‚ å¯ä»¥ä½¿ç”¨å›žè°ƒå‡½æ•°ã€‚ ä¸è¦æ··åˆä½¿ç”¨ mutex å’Œ channel ä»€ä¹ˆæ—¶å€™å‘èµ· goroutine æœ‰ä¸€äº›åº“çš„ New() ä¼šå‘èµ·ä»–ä»¬çš„ goroutineï¼Œè¿™æ˜¯ä¸å¥½çš„ã€‚ æ ‡å‡†åº“ä½¿ç”¨çš„æ˜¯ Serve() å‡½æ•°ã€‚ä»¥åŠå¯¹åº”çš„ Close() å‡½æ•° å°† goroutine å‘ä¸Šå±‚æŽ¨ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ context.Context æ‰€æœ‰çš„é˜»å¡žã€é•¿æ—¶é—´çš„æ“ä½œï¼Œéƒ½åº”è¯¥å¯ä»¥è¢« cancel ç”±äºŽ context.Context å¾ˆå®¹æ˜“å­˜å‚¨ä¸œè¥¿ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è¢«æ»¥ç”¨ã€‚è¦å°½åŠ›åŽ»é¿å…ä½¿ç”¨ Context Singleton å’Œ context.Value() æ˜¯åŒæ ·æ€§è´¨çš„ä¸œè¥¿ï¼Œåƒå…¨å±€å˜é‡ä¸€æ ·ï¼Œå¯¹äºŽç¨‹åºçŠ¶æ€æ¥è¯´æ˜¯ä¸ªé»‘ç®±ã€‚ å…¶å®ƒæ³¨æ„äº‹é¡¹ å¦‚æžœä»€ä¹ˆä¸œè¥¿å¾ˆéš¾åšï¼Œå—¯ï¼Œé‚£å°±è®©åˆ«äººåŽ»åšå§ ä¸ºäº†æ•ˆçŽ‡è€Œå‡çº§ ä½†æ˜¯ï¼Œæ­£ç¡®æ€§è¦æ¯”æ•ˆçŽ‡é‡è¦ï¼Œåœ¨æ­£ç¡®æ€§çš„å‰æä¸‹ï¼Œæ³¨æ„æ•ˆçŽ‡ ä¸è¦åœ¨åº“ä¸­ä½¿ç”¨ /vendor ï¼ˆåœ¨ main åŒ…ä¸­å¯ä»¥ï¼‰ æ³¨æ„ build tag ä¿æŒå¹²å‡€ å°½é‡ä½¿ç”¨æ‰€æœ‰çš„é™æ€åˆ†æžå·¥å…·æ¥æ£€æŸ¥ä»£ç ã€‚ åŽŸæ–‡https://blog.lab99.org/post/golang-2017-09-21-video-practice-advice-for-go-library-authors.html]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>Practice</tag>
        <tag>Advice</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•æ­£ç¡®ä½¿ç”¨ Context]]></title>
    <url>%2Fhow-to-correctly-use-package-context.html</url>
    <content type="text"><![CDATA[Golang Context è§†é¢‘ä¿¡æ¯How to correctly use package contextby Jack Lindamoodat Golang UK Conf. 2017 è§†é¢‘ï¼šhttps://www.youtube.com/watch?v=-_B5uQ4UGi0åšæ–‡ï¼šhttps://medium.com/@cep21/how-to-correctly-use-context-context-in-go-1-7-8f2c0fafdf39 ä¸ºä»€ä¹ˆéœ€è¦ Context æ¯ä¸€ä¸ªé•¿è¯·æ±‚éƒ½åº”è¯¥æœ‰ä¸ªè¶…æ—¶é™åˆ¶ éœ€è¦åœ¨è°ƒç”¨ä¸­ä¼ é€’è¿™ä¸ªè¶…æ—¶ æ¯”å¦‚å¼€å§‹å¤„ç†è¯·æ±‚çš„æ—¶å€™æˆ‘ä»¬è¯´æ˜¯ 3 ç§’é’Ÿè¶…æ—¶ é‚£ä¹ˆåœ¨å‡½æ•°è°ƒç”¨ä¸­é—´ï¼Œè¿™ä¸ªè¶…æ—¶è¿˜å‰©å¤šå°‘æ—¶é—´äº†ï¼Ÿ éœ€è¦åœ¨ä»€ä¹ˆåœ°æ–¹å­˜å‚¨è¿™ä¸ªä¿¡æ¯ï¼Œè¿™æ ·è¯·æ±‚å¤„ç†ä¸­é—´å¯ä»¥åœæ­¢ å¦‚æžœè¿›ä¸€æ­¥è€ƒè™‘ã€‚å¦‚ä¸Šå›¾è¿™æ ·çš„ RPC è°ƒç”¨ï¼Œå¼€å§‹è°ƒç”¨ RPC 1 åŽï¼Œé‡Œé¢åˆ†åˆ«è°ƒç”¨äº† RPC 2, RPC 3, RPC 4ï¼Œç­‰æ‰€æœ‰ RPC ç”¨æˆåŠŸåŽï¼Œè¿”å›žç»“æžœã€‚ è¿™æ˜¯æ­£å¸¸çš„æ–¹å¼ï¼Œä½†æ˜¯å¦‚æžœ RPC 2 è°ƒç”¨å¤±è´¥äº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ RPC 2 å¤±è´¥åŽï¼Œå¦‚æžœæ²¡æœ‰ Context çš„å­˜åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½ä¾æ—§ä¼šç­‰æ‰€æœ‰çš„ RPC æ‰§è¡Œå®Œæ¯•ï¼Œä½†æ˜¯ç”±äºŽ RPC 2 è´¥äº†ï¼Œæ‰€ä»¥å…¶å®žå…¶å®ƒçš„ RPC ç»“æžœæ„ä¹‰ä¸å¤§äº†ï¼Œæˆ‘ä»¬ä¾æ—§éœ€è¦ç»™ç”¨æˆ·è¿”å›žé”™è¯¯ã€‚å› æ­¤æˆ‘ä»¬ç™½ç™½çš„æµªè´¹äº† 10msï¼Œå®Œå…¨æ²¡å¿…è¦åŽ»ç­‰å¾…å…¶å®ƒ RPC æ‰§è¡Œå®Œæ¯•ã€‚ é‚£å¦‚æžœæˆ‘ä»¬åœ¨ RPC 2 å¤±è´¥åŽï¼Œå°±ç›´æŽ¥ç»™ç”¨æˆ·è¿”å›žå¤±è´¥å‘¢ï¼Ÿç”¨æˆ·æ˜¯åœ¨ 30ms çš„ä½ç½®æ”¶åˆ°äº†é”™è¯¯æ¶ˆæ¯ï¼Œå¯æ˜¯ RPC 3 å’Œ RPC 4 ä¾ç„¶åœ¨æ²¡æ„ä¹‰çš„è¿è¡Œï¼Œè¿˜åœ¨æµªè´¹è®¡ç®—å’ŒIOèµ„æºã€‚ æ‰€ä»¥ç†æƒ³çŠ¶æ€åº”è¯¥æ˜¯å¦‚ä¸Šå›¾ï¼Œå½“ RPC 2 å‡ºé”™åŽï¼Œé™¤äº†è¿”å›žç”¨æˆ·é”™è¯¯ä¿¡æ¯å¤–ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥æœ‰æŸç§æ–¹å¼å¯ä»¥é€šçŸ¥ RPC 3 å’Œ RPC 4ï¼Œè®©ä»–ä»¬ä¹Ÿåœæ­¢è¿è¡Œï¼Œä¸å†æµªè´¹èµ„æºã€‚ æ‰€ä»¥è§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼š ç”¨ä¿¡å·çš„æ–¹å¼æ¥é€šçŸ¥è¯·æ±‚è¯¥åœäº† åŒ…å«ä¸€äº›å…³äºŽä»€ä¹ˆæ—¶é—´è¯·æ±‚å¯èƒ½ä¼šç»“æŸçš„æç¤ºï¼ˆè¶…æ—¶ï¼‰ ç”¨ channel æ¥é€šçŸ¥è¯·æ±‚ç»“æŸäº† é‚£å¹²è„†è®©æˆ‘ä»¬æŠŠå˜é‡ä¹Ÿæ‰”é‚£å§ã€‚ðŸ˜ˆ åœ¨ Go ä¸­æ²¡æœ‰çº¿ç¨‹/go routine å˜é‡ å…¶å®žæŒºåˆç†çš„ï¼Œå› ä¸ºè¿™æ ·å°±ä¼šè®© goroutine äº’ç›¸äº§ç”Ÿä¾èµ– éžå¸¸å®¹æ˜“è¢«æ»¥ç”¨ Context å®žçŽ°ç»†èŠ‚context.Contextï¼š æ˜¯ä¸å¯å˜çš„(immutable)æ ‘èŠ‚ç‚¹ Cancel ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¼šè¿žå¸¦ Cancel å…¶æ‰€æœ‰å­èŠ‚ç‚¹ ï¼ˆä»Žä¸Šåˆ°ä¸‹ï¼‰ Context values æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ Value æŸ¥æ‰¾æ˜¯å›žæº¯æ ‘çš„æ–¹å¼ ï¼ˆä»Žä¸‹åˆ°ä¸Šï¼‰ ç¤ºä¾‹ Context é“¾å®Œæ•´ä»£ç ï¼šhttps://play.golang.org/p/ddpofBV1QS 123456789package mainfunc tree() &#123; ctx1 := context.Background() ctx2, _ := context.WithCancel(ctx1) ctx3, _ := context.WithTimeout(ctx2, time.Second * 5) ctx4, _ := context.WithTimeout(ctx3, time.Second * 3) ctx5, _ := context.WithTimeout(ctx3, time.Second * 6) ctx6 := context.WithValue(ctx5, &quot;userID&quot;, 12)&#125; å¦‚æžœè¿™æ ·æž„æˆçš„ Context é“¾ï¼Œå…¶å½¢å¦‚ä¸‹å›¾ï¼šé‚£ä¹ˆå½“ 3 ç§’è¶…æ—¶åˆ°äº†æ—¶å€™ï¼šå¯ä»¥çœ‹åˆ° ctx4 è¶…æ—¶é€€å‡ºäº†ã€‚ å½“ 5ç§’é’Ÿ è¶…æ—¶åˆ°è¾¾æ—¶ï¼šå¯ä»¥çœ‹åˆ°ï¼Œä¸ä»…ä»… ctx3 é€€å‡ºäº†ï¼Œå…¶æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œæ¯”å¦‚ ctx5 å’Œ ctx6 ä¹Ÿéƒ½é€€å‡ºäº†ã€‚ context.Context APIåŸºæœ¬ä¸Šæ˜¯ä¸¤ç±»æ“ä½œï¼š 3ä¸ªå‡½æ•°ç”¨äºŽé™å®šä»€ä¹ˆæ—¶å€™ä½ çš„å­èŠ‚ç‚¹é€€å‡ºï¼› 1ä¸ªå‡½æ•°ç”¨äºŽè®¾ç½®è¯·æ±‚èŒƒç•´çš„å˜é‡12345678type Context interface &#123; // å•¥æ—¶å€™é€€å‡º Deadline() (deadline time.Time, ok bool) Done() &lt;-chan struct&#123;&#125; Err() error // è®¾ç½®å˜é‡ Value(key interface&#123;&#125;) interface&#123;&#125;&#125; ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ Contextï¼Ÿ æ¯ä¸€ä¸ª RPC è°ƒç”¨éƒ½åº”è¯¥æœ‰è¶…æ—¶é€€å‡ºçš„èƒ½åŠ›ï¼Œè¿™æ˜¯æ¯”è¾ƒåˆç†çš„ API è®¾è®¡ ä¸ä»…ä»… æ˜¯è¶…æ—¶ï¼Œä½ è¿˜éœ€è¦æœ‰èƒ½åŠ›åŽ»ç»“æŸé‚£äº›ä¸å†éœ€è¦æ“ä½œçš„è¡Œä¸º context.Context æ˜¯ Go æ ‡å‡†çš„è§£å†³æ–¹æ¡ˆ ä»»ä½•å‡½æ•°å¯èƒ½è¢«é˜»å¡žï¼Œæˆ–è€…éœ€è¦å¾ˆé•¿æ—¶é—´æ¥å®Œæˆçš„ï¼Œéƒ½åº”è¯¥æœ‰ä¸ª context.Context å¦‚ä½•åˆ›å»º Contextï¼Ÿ åœ¨ RPC å¼€å§‹çš„æ—¶å€™ï¼Œä½¿ç”¨ context.Background() æœ‰äº›äººæŠŠåœ¨ main() é‡Œè®°å½•ä¸€ä¸ª context.Background()ï¼Œç„¶åŽæŠŠè¿™ä¸ªæ”¾åˆ°æœåŠ¡å™¨çš„æŸä¸ªå˜é‡é‡Œï¼Œç„¶åŽè¯·æ±‚æ¥äº†åŽä»Žè¿™ä¸ªå˜é‡é‡Œç»§æ‰¿ contextã€‚è¿™ä¹ˆåšæ˜¯ä¸å¯¹çš„ã€‚ç›´æŽ¥æ¯ä¸ªè¯·æ±‚ï¼Œæºè‡ªè‡ªå·±çš„ context.Background() å³å¯ã€‚ å¦‚æžœä½ æ²¡æœ‰ contextï¼Œå´éœ€è¦è°ƒç”¨ä¸€ä¸ª context çš„å‡½æ•°çš„è¯ï¼Œç”¨ context.TODO() å¦‚æžœæŸæ­¥æ“ä½œéœ€è¦è‡ªå·±çš„è¶…æ—¶è®¾ç½®çš„è¯ï¼Œç»™å®ƒä¸€ä¸ªç‹¬ç«‹çš„ sub-contextï¼ˆå¦‚å‰é¢çš„ä¾‹å­ï¼‰ å¦‚ä½•é›†æˆåˆ° API é‡Œï¼Ÿ å¦‚æžœæœ‰ Contextï¼Œå°†å…¶ä½œä¸ºç¬¬ä¸€ä¸ªå˜é‡ã€‚ å¦‚ func (d* Dialer) DialContext(ctx context.Context, network, address string) (Conn, error) æœ‰äº›äººæŠŠ context æ”¾åˆ°ä¸­é—´çš„æŸä¸ªå˜é‡é‡ŒåŽ»ï¼Œè¿™å¾ˆä¸åˆä¹ æƒ¯ï¼Œä¸è¦é‚£ä¹ˆåšï¼Œæ”¾åˆ°ç¬¬ä¸€ä¸ªåŽ»ã€‚ å°†å…¶ä½œä¸ºå¯é€‰çš„æ–¹å¼ï¼Œç”¨ request ç»“æž„ä½“æ–¹å¼ã€‚ å¦‚ï¼šfunc (r *Request) WithContext(ctx context.Context) *Request Context çš„å˜é‡åè¯·ç”¨ ctxï¼ˆä¸è¦èµ·ä¸€äº›è¯¡å¼‚çš„åå­—ðŸ˜“ï¼‰ Context æ”¾å“ªï¼Ÿ æŠŠ Context æƒ³è±¡ä¸ºä¸€æ¡æ²³æµæµè¿‡ä½ çš„ç¨‹åºï¼ˆå¦ä¸€ä¸ªæ„æ€å°±æ˜¯è¯´ä¸è¦å–æ²³é‡Œçš„æ°´â€¦â€¦ðŸ™Šï¼‰ ç†æƒ³æƒ…å†µä¸‹ï¼ŒContext å­˜åœ¨äºŽè°ƒç”¨æ ˆï¼ˆCall Stackï¼‰ ä¸­ ä¸è¦æŠŠ Context å­˜å‚¨åˆ°ä¸€ä¸ª struct é‡Œ é™¤éžä½ ä½¿ç”¨çš„æ˜¯åƒ http.Request ä¸­çš„ request ç»“æž„ä½“çš„æ–¹å¼ request ç»“æž„ä½“åº”è¯¥ä»¥ Request ç»“æŸä¸ºç”Ÿå‘½ç»ˆæ­¢ å½“ RPC è¯·æ±‚å¤„ç†ç»“æŸåŽï¼Œåº”è¯¥åŽ»æŽ‰å¯¹ Context å˜é‡çš„å¼•ç”¨ï¼ˆUnreferenceï¼‰ Request ç»“æŸï¼ŒContext å°±åº”è¯¥ç»“æŸã€‚ï¼ˆè¿™ä¿©æ˜¯ä¸€å¯¹å„¿ï¼Œä¸æ±‚åŒå¹´åŒæœˆåŒæ—¥ç”Ÿï¼Œä½†æ±‚åŒå¹´åŒæœˆåŒæ—¥æ­»â€¦â€¦ðŸ’•ï¼‰ Context åŒ…çš„æ³¨æ„äº‹é¡¹ è¦å…»æˆå…³é—­ Context çš„ä¹ æƒ¯ ç‰¹åˆ«æ˜¯ è¶…æ—¶çš„ Contexts å¦‚æžœä¸€ä¸ª context è¢« GC è€Œä¸æ˜¯ cancel äº†ï¼Œé‚£ä¸€èˆ¬æ˜¯ä½ åšé”™äº† 12ctx, cancel := context.WithTimeout(parentCtx, time.Second * 2)defer cancel() ä½¿ç”¨ Timeout ä¼šå¯¼è‡´å†…éƒ¨ä½¿ç”¨ time.AfterFuncï¼Œä»Žè€Œä¼šå¯¼è‡´ context åœ¨è®¡æ—¶å™¨åˆ°æ—¶ä¹‹å‰éƒ½ä¸ä¼šè¢«åžƒåœ¾å›žæ”¶ã€‚ åœ¨å»ºç«‹ä¹‹åŽï¼Œç«‹å³ defer cancel() æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚ ç»ˆæ­¢è¯·æ±‚ (Request Cancellation)å½“ä½ ä¸å†å…³å¿ƒæŽ¥ä¸‹æ¥èŽ·å–çš„ç»“æžœçš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼š Cancel ä¸€ä¸ª Contextï¼Ÿ ä»¥ golang.org/x/sync/errgroup ä¸ºä¾‹ï¼Œerrgroup ä½¿ç”¨ Context æ¥æä¾› RPC çš„ç»ˆæ­¢è¡Œä¸ºã€‚ 123456type Group struct &#123; cancel func() wg sync.WaitGroup errOnce sync.Once err error&#125; åˆ›å»ºä¸€ä¸ª group å’Œ contextï¼š 1234func WithContext(ctx context.Context) (*Group, context.Context) &#123; ctx, cancel := context.WithCancel(ctx) return &amp;Group&#123;cancel: cancel&#125;, ctx&#125; è¿™æ ·å°±è¿”å›žäº†ä¸€ä¸ªå¯ä»¥è¢«æå‰ cancel çš„ groupã€‚ è€Œè°ƒç”¨çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯ç›´æŽ¥è°ƒç”¨ go func()ï¼Œè€Œæ˜¯è°ƒç”¨ Go()ï¼Œå°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ è¿›åŽ»ï¼Œç”¨é«˜é˜¶å‡½æ•°çš„å½¢å¼æ¥è°ƒç”¨ï¼Œå…¶å†…éƒ¨æ‰æ˜¯ go func() å¼€å¯ goroutineã€‚ 1234567891011121314func (g *Group) Go(f func() error) &#123; g.wg.Add(1) go func() &#123; defer g.wg.Done() if err := f(); err != nil &#123; g.errOnce.Do(func() &#123; g.err = err if g.cancel != nil &#123; g.cancel() &#125; &#125;) &#125; &#125;()&#125; å½“ç»™å…¥å‡½æ•° f è¿”å›žé”™è¯¯ï¼Œåˆ™ä½¿ç”¨ sync.Once æ¥ cancel contextï¼Œè€Œé”™è¯¯è¢«ä¿å­˜äºŽ g.err ä¹‹ä¸­ï¼Œåœ¨éšåŽçš„ Wait() å‡½æ•°ä¸­è¿”å›žã€‚ 1234567func (g *Group) Wait() error &#123; g.wg.Wait() if g.cancel != nil &#123; g.cancel() &#125; return g.err&#125; æ³¨æ„ï¼šè¿™é‡Œåœ¨ Wait() ç»“æŸåŽï¼Œè°ƒç”¨äº†ä¸€æ¬¡ cancel()ã€‚ 123456789101112131415161718192021package mainfunc DoTwoRequestsAtOnce(ctx context.Context) error &#123; eg, egCtx := errgroup.WithContext(ctx) var resp1, resp2 *http.Response f := func(loc string, respIn **http.Response) func() error &#123; return func() error &#123; reqCtx, cancel := context.WithTimeout(egCtx, time.Second) defer cancel() req, _ := http.NewRequest(&quot;GET&quot;, loc, nil) var err error *respIn, err = http.DefaultClient.Do(req.WithContext(reqCtx)) if err == nil &amp;&amp; (*respIn).StatusCode &gt;= 500 &#123; return errors.New(&quot;unexpected!&quot;) &#125; return err &#125; &#125; eg.Go(f(&quot;http://localhost:8080/fast_request&quot;, &amp;resp1)) eg.Go(f(&quot;http://localhost:8080/slow_request&quot;, &amp;resp2)) return eg.Wait()&#125; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåŒæ—¶å‘èµ·äº†ä¸¤ä¸ª RPC è°ƒç”¨ï¼Œå½“ä»»ä½•ä¸€ä¸ªè°ƒç”¨è¶…æ—¶æˆ–è€…å‡ºé”™åŽï¼Œä¼šç»ˆæ­¢å¦ä¸€ä¸ª RPC è°ƒç”¨ã€‚è¿™é‡Œå°±æ˜¯åˆ©ç”¨å‰é¢è®²åˆ°çš„ errgroup æ¥å®žçŽ°çš„ï¼Œåº”å¯¹æœ‰å¾ˆå¤šå¹¶éžè¯·æ±‚ï¼Œå¹¶éœ€è¦é›†ä¸­å¤„ç†è¶…æ—¶ã€å‡ºé”™ç»ˆæ­¢å…¶å®ƒå¹¶å‘ä»»åŠ¡çš„æ—¶å€™ï¼Œè¿™ä¸ª pattern ä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ã€‚ Context.Value - Request èŒƒç•´çš„å€¼context.Value API çš„ä¸‡é‡‘æ²¹ï¼ˆduct tape)èƒ¶å¸¦ï¼ˆduct tape) å‡ ä¹Žå¯ä»¥ä¿®ä»»ä½•ä¸œè¥¿ï¼Œä»Žç ´ç®±å­ï¼Œåˆ°äººçš„ä¼¤å£ï¼Œåˆ°æ±½è½¦å¼•æ“Žï¼Œç”šè‡³åˆ°NASAç™»æœˆä»»åŠ¡ä¸­çš„é˜¿æ³¢ç½—13å·é£žèˆ¹ï¼ˆYeah! True Story)ã€‚æ‰€ä»¥åœ¨è¥¿æ–¹æ–‡åŒ–é‡Œï¼Œèƒ¶å¸¦æ˜¯ä¸ªâ€œä¸‡èƒ½â€çš„ä¸œè¥¿ã€‚åœ¨ä¸­æ–‡é‡Œï¼Œææ€•ä¸‡é‡‘æ²¹æ˜¯æ›´åˆé€‚çš„å¯¹åº”è¯æ±‡ï¼Œä»Žå¤´ç–¼ã€è„‘çƒ­ï¼Œæ„Ÿå†’å‘çƒ§ï¼Œåˆ°è·Œæ‰“æŸä¼¤å‡ ä¹Žæ— æ‰€ä¸æ²»ã€‚ å½“ç„¶ï¼Œæ²»æ ‡ä¸æ²»æœ¬ï¼Œè¿™ç‚¹ä¸œè¥¿æ–¹æ–‡åŒ–ä¸­çš„æ½œå°è¯éƒ½æ˜¯ä¸€æ ·çš„ã€‚è¿™é‡ŒæåŠçš„ context.Value å¯¹äºŽ API è€Œè¨€ï¼Œå°±æ˜¯è¿™ç±»æ€§è´¨çš„ä¸œè¥¿ï¼Œå•¥éƒ½å¯ä»¥å¹²ï¼Œä½†æ˜¯æ²»æ ‡ä¸æ²»æœ¬ã€‚ value èŠ‚ç‚¹æ˜¯ Context é“¾ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹123456789101112131415package contexttype valueCtx struct &#123; Context key, val interface&#123;&#125;&#125;func WithValue(parent Context, key, val interface&#123;&#125;) Context &#123; // ... return &amp;valueCtx&#123;parent, key, val&#125;&#125;func (c *valueCtx) Value(key interface&#123;&#125;) interface&#123;&#125; &#123; if c.key == key &#123; return c.val &#125; return c.Context.Value(key)&#125; å¯ä»¥çœ‹åˆ°ï¼ŒWithValue() å®žé™…ä¸Šå°±æ˜¯åœ¨ Context æ ‘å½¢ç»“æž„ä¸­ï¼Œå¢žåŠ ä¸€ä¸ªèŠ‚ç‚¹ç½¢äº†ã€‚ Context æ˜¯ immutable çš„ã€‚ çº¦æŸ key çš„ç©ºé—´ä¸ºäº†é˜²æ­¢æ ‘å½¢ç»“æž„ä¸­å‡ºçŽ°é‡å¤çš„é”®ï¼Œå»ºè®®çº¦æŸé”®çš„ç©ºé—´ã€‚æ¯”å¦‚ä½¿ç”¨ç§æœ‰ç±»åž‹ï¼Œç„¶åŽç”¨ GetXxx() å’Œ WithXxxx() æ¥æ“ä½œç§æœ‰å®žä½“ã€‚ 1234567891011type privateCtxType stringvar ( reqID = privateCtxType(&quot;req-id&quot;))func GetRequestID(ctx context.Context) (int, bool) &#123; id, exists := ctx.Value(reqID).(int) return id, exists&#125;func WithRequestID(ctx context.Context, reqid int) context.Context &#123; return context.WithValue(ctx, reqID, reqid)&#125; è¿™é‡Œä½¿ç”¨ WithXxx è€Œä¸æ˜¯ SetXxx ä¹Ÿæ˜¯å› ä¸º Context å®žé™…ä¸Šæ˜¯ immutable çš„ï¼Œæ‰€ä»¥ä¸æ˜¯ä¿®æ”¹ Context é‡ŒæŸä¸ªå€¼ï¼Œè€Œæ˜¯äº§ç”Ÿæ–°çš„ Context å¸¦æŸä¸ªå€¼ã€‚ Context.Value æ˜¯ immutable çš„å†å¤šæ¬¡çš„å¼ºè°ƒ Context.Value æ˜¯ immutable çš„ä¹Ÿä¸è¿‡åˆ†ã€‚ context.Context ä»Žè®¾è®¡ä¸Šå°±æ˜¯æŒ‰ç…§ immutable ï¼ˆä¸å¯å˜çš„ï¼‰æ¨¡å¼è®¾è®¡çš„ åŒæ ·ï¼ŒContext.Value ä¹Ÿæ˜¯ immutable çš„ ä¸è¦è¯•å›¾åœ¨ Context.Value é‡Œå­˜æŸä¸ªå¯å˜æ›´çš„å€¼ï¼Œç„¶åŽæ”¹å˜ï¼ŒæœŸæœ›åˆ«çš„ Context å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ”¹å˜ æ›´åˆ«æŒ‡æœ›ç€åœ¨ Context.Value é‡Œå­˜å¯å˜çš„å€¼ï¼Œæœ€åŽå¤šä¸ª goroutine å¹¶å‘è®¿é—®æ²¡ç«žäº‰å†’é™©å•¥çš„ï¼Œå› ä¸ºè‡ªå§‹è‡³ç»ˆï¼Œå°±æ˜¯æŒ‰ç…§ä¸å¯å˜æ¥è®¾è®¡çš„ æ¯”å¦‚è®¾ç½®äº†è¶…æ—¶ï¼Œå°±åˆ«ä»¥ä¸ºå¯ä»¥æ”¹å˜è¿™ä¸ªè®¾ç½®çš„è¶…æ—¶å€¼ åœ¨ä½¿ç”¨ Context.Value çš„æ—¶å€™ï¼Œä¸€å®šè¦è®°ä½è¿™ä¸€ç‚¹ åº”è¯¥æŠŠä»€ä¹ˆæ”¾åˆ° Context.Value é‡Œï¼Ÿ åº”è¯¥ä¿å­˜ Request èŒƒç•´çš„å€¼ ä»»ä½•å…³äºŽ Context è‡ªèº«çš„éƒ½æ˜¯ Request èŒƒç•´çš„ï¼ˆè¿™ä¿©åŒç”Ÿå…±æ­»ï¼‰ ä»Ž Request æ•°æ®è¡ç”Ÿå‡ºæ¥ï¼Œå¹¶ä¸”éšç€ Request çš„ç»“æŸè€Œç»ˆç»“ ä»€ä¹ˆä¸œè¥¿ä¸å±žäºŽ Request èŒƒç•´ï¼Ÿ åœ¨ Request ä»¥å¤–å»ºç«‹çš„ï¼Œå¹¶ä¸”ä¸éšç€ Request æ”¹å˜è€Œå˜åŒ– æ¯”å¦‚ä½  func main() é‡Œå»ºç«‹çš„ä¸œè¥¿æ˜¾ç„¶ä¸å±žäºŽ Request èŒƒç•´ æ•°æ®åº“è¿žæŽ¥ å¦‚æžœ User ID åœ¨è¿žæŽ¥é‡Œå‘¢ï¼Ÿ(ç¨åŽä¼šæåŠ) å…¨å±€ logger å¦‚æžœ logger é‡Œéœ€è¦æœ‰ User ID å‘¢ï¼Ÿï¼ˆç¨åŽä¼šæåŠï¼‰ é‚£ä¹ˆç”¨ Context.Value æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ ä¸å¹¸çš„æ˜¯ï¼Œå¥½åƒæ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯ç”±è¯·æ±‚è¡ç”Ÿå‡ºæ¥çš„ é‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜éœ€è¦å‡½æ•°å‚æ•°ï¼Ÿç„¶åŽå¹²è„†åªæ¥ä¸€ä¸ª Context å°±å®Œäº†ï¼Ÿ123func Add(ctx context.Context) int &#123; return ctx.Value(&quot;first&quot;).(int) + ctx.Value(&quot;second&quot;).(int)&#125; æ›¾ç»çœ‹åˆ°è¿‡ä¸€ä¸ª APIï¼Œå°±æ˜¯è¿™ç§å½¢å¼ï¼š 1234func IsAdminUser(ctx context.Context) bool &#123; userID := GetUser(ctx) return authSingleton.IsAdmin(userID)&#125; è¿™é‡ŒAPIå®žçŽ°å†…éƒ¨ä»Ž context ä¸­å–å¾— UserIDï¼Œç„¶åŽå†è¿›è¡Œæƒé™åˆ¤æ–­ã€‚ä½†æ˜¯ä»Žå‡½æ•°ç­¾åçœ‹ï¼Œåˆ™å®Œå…¨æ— æ³•ç†è§£è¿™ä¸ªå‡½æ•°å…·ä½“éœ€è¦ä»€ä¹ˆã€ä»¥åŠåšä»€ä¹ˆã€‚ ä»£ç è¦ä»¥å¯è¯»æ€§ä¸ºä¼˜å…ˆè®¾è®¡è€ƒè™‘ã€‚ åˆ«äººæ‹¿åˆ°ä¸€ä¸ªä»£ç ï¼Œä¸€èˆ¬ä¸æ˜¯æŽ‰è¿›å‡½æ•°å®žçŽ°ç»†èŠ‚é‡ŒåŽ»ä¸€è¡Œè¡Œçš„è¯»ä»£ç ï¼Œè€Œæ˜¯ä¼šå…ˆæµè§ˆä¸€ä¸‹å‡½æ•°æŽ¥å£ã€‚æ‰€ä»¥æ¸…æ™°çš„å‡½æ•°æŽ¥å£è®¾è®¡ï¼Œä¼šæ›´åŠ åˆ©äºŽåˆ«äººï¼ˆæˆ–è€…æ˜¯å‡ ä¸ªæœˆåŽçš„ä½ è‡ªå·±ï¼‰ç†è§£è¿™æ®µä»£ç ã€‚ ä¸€ä¸ªè‰¯å¥½çš„ API è®¾è®¡ï¼Œåº”è¯¥ä»Žå‡½æ•°ç­¾åå°±æ¸…æ™°çš„ç†è§£å‡½æ•°çš„é€»è¾‘ã€‚å¦‚æžœæˆ‘ä»¬å°†ä¸Šé¢çš„æŽ¥å£æ”¹ä¸ºï¼š 1func IsAdminUser(ctx context.Context, userID string, authenticator auth.Service) bool æˆ‘ä»¬ä»Žè¿™ä¸ªå‡½æ•°ç­¾åå°±å¯ä»¥æ¸…æ¥šçš„çŸ¥é“ï¼š è¿™ä¸ªå‡½æ•°å¾ˆå¯èƒ½å¯ä»¥æå‰è¢« cancel è¿™ä¸ªå‡½æ•°éœ€è¦ User ID è¿™ä¸ªå‡½æ•°éœ€è¦ä¸€ä¸ªauthenticatoræ¥ è€Œä¸”ç”±äºŽ authenticator æ˜¯ä¼ å…¥å‚æ•°ï¼Œè€Œä¸æ˜¯ä¾èµ–äºŽéšå¼çš„æŸä¸ªä¸œè¥¿ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæµ‹è¯•çš„æ—¶å€™å°±å¾ˆå®¹æ˜“ä¼ å…¥ä¸€ä¸ªæ¨¡æ‹Ÿè®¤è¯å‡½æ•°æ¥åšæµ‹è¯• userID æ˜¯ä¼ å…¥å€¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¿®æ”¹å®ƒï¼Œä¸ç”¨æ‹…å¿ƒå½±å“åˆ«çš„ä¸œè¥¿ æ‰€æœ‰è¿™äº›ä¿¡æ¯ï¼Œéƒ½æ˜¯ä»Žå‡½æ•°ç­¾åå¾—åˆ°çš„ï¼Œè€Œæ— éœ€æ‰“å¼€å‡½æ•°å®žçŽ°ä¸€è¡Œè¡ŒåŽ»çœ‹ã€‚ é‚£ä»€ä¹ˆå¯ä»¥æ”¾åˆ° Context.Value é‡ŒåŽ»ï¼ŸçŽ°åœ¨çŸ¥é“ Context.Value ä¼šè®©æŽ¥å£å®šä¹‰æ›´åŠ æ¨¡ç³Šï¼Œä¼¼ä¹Žä¸åº”è¯¥ä½¿ç”¨ã€‚é‚£ä¹ˆåˆå›žåˆ°äº†åŽŸæ¥çš„é—®é¢˜ï¼Œåˆ°åº•ä»€ä¹ˆå¯ä»¥æ”¾åˆ° Context.Value é‡ŒåŽ»ï¼Ÿæ¢ä¸ªè§’åº¦åŽ»æƒ³ï¼Œä»€ä¹ˆä¸æ˜¯è¡ç”ŸäºŽ Requestï¼Ÿ Context.Value åº”è¯¥æ˜¯å‘ŠçŸ¥æ€§è´¨çš„ä¸œè¥¿ï¼Œè€Œä¸æ˜¯æŽ§åˆ¶æ€§è´¨çš„ä¸œè¥¿ åº”è¯¥æ°¸è¿œéƒ½ä¸éœ€è¦å†™è¿›æ–‡æ¡£ä½œä¸ºå¿…é¡»å­˜åœ¨çš„è¾“å…¥æ•°æ® å¦‚æžœä½ å‘çŽ°ä½ çš„å‡½æ•°åœ¨æŸäº› Context.Value ä¸‹æ— æ³•æ­£ç¡®å·¥ä½œï¼Œé‚£å°±è¯´æ˜Žè¿™ä¸ª Context.Value é‡Œçš„ä¿¡æ¯ä¸åº”è¯¥æ”¾åœ¨é‡Œé¢ï¼Œè€Œåº”è¯¥æ”¾åœ¨æŽ¥å£ä¸Šã€‚å› ä¸ºå·²ç»è®©æŽ¥å£å¤ªæ¨¡ç³Šäº†ã€‚ ä»€ä¹ˆä¸œè¥¿ä¸æ˜¯æŽ§åˆ¶æ€§è´¨çš„ä¸œè¥¿ï¼Ÿ Request ID åªæ˜¯ç»™æ¯ä¸ª RPC è°ƒç”¨ä¸€ä¸ª IDï¼Œè€Œæ²¡æœ‰å®žé™…æ„ä¹‰ è¿™å°±æ˜¯ä¸ªæ•°å­—/å­—ç¬¦ä¸²ï¼Œåæ­£ä½ ä¹Ÿä¸ä¼šç”¨å…¶ä½œä¸ºé€»è¾‘åˆ¤æ–­ ä¸€èˆ¬ä¹Ÿå°±æ˜¯æ—¥å¿—çš„æ—¶å€™éœ€è¦è®°å½•ä¸€ä¸‹ è€Œ logger æœ¬èº«ä¸æ˜¯ Request èŒƒç•´ï¼Œæ‰€ä»¥ logger ä¸åº”è¯¥åœ¨ Context é‡Œ éž Request èŒƒç•´çš„ logger åº”è¯¥åªæ˜¯åˆ©ç”¨ Context ä¿¡æ¯æ¥ä¿®é¥°æ—¥å¿— User ID ï¼ˆå¦‚æžœä»…ä»…æ˜¯ä½œä¸ºæ—¥å¿—ç”¨ï¼‰ Incoming Request ID ä»€ä¹ˆæ˜¾ç„¶æ˜¯æŽ§åˆ¶æ€§è´¨çš„ä¸œè¥¿ï¼Ÿ æ•°æ®åº“è¿žæŽ¥ æ˜¾ç„¶ä¼šéžå¸¸ä¸¥é‡çš„å½±å“é€»è¾‘ å› æ­¤è¿™åº”è¯¥åœ¨å‡½æ•°å‚æ•°é‡Œï¼Œæ˜Žç¡®è¡¨ç¤ºå‡ºæ¥ è®¤è¯æœåŠ¡(Authentication) æ˜¾ç„¶ä¸åŒçš„è®¤è¯æœåŠ¡å¯¼è‡´çš„é€»è¾‘ä¸åŒ ä¹Ÿåº”è¯¥æ”¾åˆ°å‡½æ•°å‚æ•°é‡Œï¼Œæ˜Žç¡®è¡¨ç¤ºå‡ºæ¥ ä¾‹å­è°ƒè¯•æ€§è´¨çš„ Context.Value - net/http/httptracehttps://medium.com/@cep21/go-1-7-httptrace-and-context-debug-patterns-608ae887224a 12345678910111213141516package mainfunc trace(req *http.Request, c *http.Client) &#123; trace := &amp;httptrace.ClientTrace&#123; GotConn: func(connInfo httptrace.GotConnInfo) &#123; fmt.Println(&quot;Got Conn&quot;) &#125;, ConnectStart: func(network, addr string) &#123; fmt.Println(&quot;Dial Start&quot;) &#125;, ConnectDone: func(network, addr string, err error) &#123; fmt.Println(&quot;Dial done&quot;) &#125;, &#125; req = req.WithContext(httptrace.WithClientTrace(req.Context(), trace)) c.Do(req)&#125; net/http æ˜¯æ€Žä¹ˆä½¿ç”¨ httptrace çš„ï¼Ÿ å¦‚æžœæœ‰ trace å­˜åœ¨çš„è¯ï¼Œå°±æ‰§è¡Œ trace å›žè°ƒå‡½æ•° è¿™åªæ˜¯å‘ŠçŸ¥æ€§è´¨ï¼Œè€Œä¸æ˜¯æŽ§åˆ¶æ€§è´¨ http ä¸ä¼šå› ä¸ºå­˜åœ¨ trace ä¸Žå¦å°±æœ‰ä¸åŒçš„æ‰§è¡Œé€»è¾‘ è¿™é‡Œåªæ˜¯å‘ŠçŸ¥ API çš„ç”¨æˆ·ï¼Œå¸®åŠ©ç”¨æˆ·è®°å½•æ—¥å¿—æˆ–è€…è°ƒè¯• å› æ­¤è¿™é‡Œçš„ trace æ˜¯å­˜åœ¨äºŽ Context é‡Œçš„123456789package httpfunc (req *Request) write(w io.Writer, usingProxy bool, extraHeaders Header, waitForContinue func() bool) (err error) &#123; // ... trace := httptrace.ContextClientTrace(req.Context()) // ... if trace != nil &amp;&amp; trace.WroteHeaders != nil &#123; trace.WroteHeaders() &#125;&#125; å›žé¿ä¾èµ–æ³¨å…¥ - github.com/golang/oauth2 è¿™é‡Œæ¯”è¾ƒè¯¡å¼‚ï¼Œä½¿ç”¨ ctx.Value æ¥å®šä½ä¾èµ– ä¸æŽ¨èè¿™æ ·åš è¿™é‡Œè¿™æ ·åšåŸºæœ¬ä¸Šåªæ˜¯ä¸ºäº†æ»¡è¶³æµ‹è¯•éœ€æ±‚12345678package mainimport &quot;github.com/golang/oauth2&quot;func oauth() &#123; c := &amp;http.Client&#123;Transport: &amp;mockTransport&#123;&#125;&#125; ctx := context.WithValue(context.Background(), oauth2.HTTPClient, c) conf := &amp;oauth2.Config&#123; /* ... */ &#125; conf.Exchange(ctx, &quot;code&quot;)&#125; äººä»¬æ»¥ç”¨ Context.Value çš„åŽŸå›  ä¸­é—´ä»¶çš„æŠ½è±¡ å¾ˆæ·±çš„å‡½æ•°è°ƒç”¨æ ˆ æ··ä¹±çš„è®¾è®¡ context.Value å¹¶æ²¡æœ‰è®©ä½ çš„ API æ›´ç®€æ´ï¼Œé‚£æ˜¯å‡è±¡ï¼Œç›¸åï¼Œå®ƒè®©ä½ çš„ API å®šä¹‰æ›´åŠ æ¨¡ç³Šã€‚ æ€»ç»“ Context.Value å¯¹äºŽè°ƒè¯•éžå¸¸æ–¹ä¾¿ å°†å¿…é¡»çš„ä¿¡æ¯æ”¾å…¥ Context.Value ä¸­ï¼Œä¼šè®©æŽ¥å£å®šä¹‰æ›´åŠ ä¸é€æ˜Ž å¦‚æžœå¯ä»¥å°½é‡æ˜Žç¡®å®šä¹‰åœ¨æŽ¥å£ å°½é‡ä¸è¦ç”¨ Context.Value æ€»ç»“ Context æ‰€æœ‰çš„é•¿çš„ã€é˜»å¡žçš„æ“ä½œéƒ½éœ€è¦ Context errgroup æ˜¯æž„æž¶äºŽ Context ä¹‹ä¸Šå¾ˆå¥½çš„æŠ½è±¡ å½“ Request çš„ç»“æŸçš„æ—¶å€™ï¼ŒCancel Context Context.Value åº”è¯¥è¢«ç”¨äºŽå‘ŠçŸ¥æ€§è´¨çš„äº‹ç‰©ï¼Œè€Œä¸æ˜¯æŽ§åˆ¶æ€§è´¨çš„äº‹ç‰© çº¦æŸ Context.Value çš„é”®ç©ºé—´ Context ä»¥åŠ Context.Value åº”è¯¥æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ï¼Œå¹¶ä¸”åº”è¯¥æ˜¯çº¿ç¨‹å®‰å…¨ Context åº”è¯¥éš Request æ¶ˆäº¡è€Œæ¶ˆäº¡ Q&amp;Aæ•°æ®åº“çš„è®¿é—®ä¹Ÿç”¨ Context ä¹ˆï¼Ÿä¹‹å‰è¯´è¿‡é•¿æ—¶é—´ã€å¯é˜»å¡žçš„æ“ä½œéƒ½ç”¨ Contextï¼Œæ•°æ®åº“æ“ä½œä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸è¿‡å¯¹äºŽè¶…æ—¶ Cancel æ“ä½œæ¥è¯´ï¼Œä¸€èˆ¬ä¸ä¼šå¯¹å†™æ“ä½œè¿›è¡Œ cancelï¼›ä½†æ˜¯å¯¹äºŽè¯»æ“ä½œï¼Œä¸€èˆ¬ä¼šæœ‰ Cancel æ“ä½œã€‚ åŽŸæ–‡https://blog.lab99.org/post/golang-2017-10-27-video-how-to-correctly-use-package-context.html]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>Context</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[encrypted communication elasticsearch java rest client]]></title>
    <url>%2Fencrypted-communication-elasticsearch-java-rest-client.html</url>
    <content type="text"><![CDATA[ElasticSearch 7.3.1Java Rest Client HTTPSè¿žæŽ¥æ“ä½œ ElasticSearchç‰ˆæœ¬7.3.1ï¼Œelasticsearch.ymlé…ç½®å¦‚ä¸‹ï¼š 12345678910xpack.security.enabled: truexpack.security.transport.ssl.enabled: truexpack.security.transport.ssl.verification_mode: certificatexpack.security.transport.ssl.key: /home/jiankunking/elasticsearch-7.3.1/config/certs/_.jiankunking.com.keyxpack.security.transport.ssl.certificate: /home/jiankunking/elasticsearch-7.3.1/config/certs/_.jiankunking.com.cerxpack.security.transport.ssl.certificate_authorities: [ &quot;/home/jiankunking/elasticsearch-7.3.1/config/certs/_.jiankunking.com_ca.crt&quot; ]xpack.security.http.ssl.enabled: truexpack.security.http.ssl.key: /home/jiankunking/elasticsearch-7.3.1/config/certs/_.jiankunking.com.keyxpack.security.http.ssl.certificate: /home/jiankunking/elasticsearch-7.3.1/config/certs/_.jiankunking.com.cerxpack.security.http.ssl.certificate_authorities: [ &quot;/home/jiankunking/elasticsearch-7.3.1/config/certs/_.jiankunking.com_ca.crt&quot; ] ç”±äºŽElasticSearch Java clientä¸­çš„KeyStore Typesåªæ”¯æŒä»¥ä¸‹å‡ ç§ï¼š Type Description jceks The proprietary keystore implementation provided by the SunJCE provider. jks The proprietary keystore implementation provided by the SUN provider. dks A domain keystore is a collection of keystores presented as a single logical keystore. It is specified by configuration data whose syntax is described in DomainLoadStoreParameter. pkcs11 A keystore backed by a PKCS #11 token. pkcs12 The transfer syntax for personal identity information as defined in PKCS #12. è€Œæˆ‘è¿™è¾¹è¯ä¹¦æ ¼å¼ä¸ºcerï¼Œæ‰€ä»¥é€šè¿‡keytoolè¿›è¡Œè½¬æ¢ï¼š 1keytool -import -v -trustcacerts -file _.jiankunking.com.cer -keystore my_keystore.jks -keypass password -storepass password è¯ä¹¦è½¬æ¢å®ŒæˆåŽï¼Œæ“ä½œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687package ssl;import org.apache.http.HttpHost;import org.apache.http.auth.AuthScope;import org.apache.http.auth.UsernamePasswordCredentials;import org.apache.http.client.CredentialsProvider;import org.apache.http.impl.client.BasicCredentialsProvider;import org.apache.http.ssl.SSLContexts;import org.elasticsearch.client.RequestOptions;import org.elasticsearch.client.RestClient;import org.elasticsearch.client.RestClientBuilder;import org.elasticsearch.client.RestHighLevelClient;import org.elasticsearch.client.indices.CreateIndexRequest;import org.elasticsearch.client.indices.CreateIndexResponse;import org.elasticsearch.common.settings.Settings;import org.elasticsearch.common.xcontent.XContentType;import javax.net.ssl.SSLContext;import java.io.File;import java.io.IOException;import java.security.KeyManagementException;import java.security.KeyStoreException;import java.security.NoSuchAlgorithmException;import java.security.cert.CertificateException;import java.util.HashMap;import java.util.Map;/** * @Author: jiankunking * @Date: 2019/8/27 15:32 * @Description: */public class es &#123; public static void main(String[] args) throws KeyStoreException, IOException, NoSuchAlgorithmException, KeyManagementException, CertificateException &#123; CredentialsProvider credentialsProvider = new BasicCredentialsProvider(); credentialsProvider.setCredentials(AuthScope.ANY, new UsernamePasswordCredentials(&quot;elastic&quot;, &quot;jiankunking&quot;)); SSLContext sslContext = SSLContexts.custom() .loadTrustMaterial(new File(&quot;I:\\certs\\my_keystore.jks&quot;)) .build(); String host = &quot;es.jiankunking.com&quot;; int port = 9200; String scheme = &quot;https&quot;; String indexName = &quot;twitter2&quot;; RestClientBuilder restClientBuilder = RestClient.builder(new HttpHost(host, port, scheme)).setHttpClientConfigCallback(httpClientBuilder -&gt; httpClientBuilder .setDefaultCredentialsProvider(credentialsProvider) .setSSLContext(sslContext) ); // åˆ°è¿™é‡ŒRestHighLevelClientå·²ç»åˆå§‹åŒ–å®Œæˆï¼Œä¸‹é¢çš„åˆ›å»ºç´¢å¼•æ˜¯æµ‹è¯• RestHighLevelClient restHighLevelClient = new RestHighLevelClient(restClientBuilder); // åˆ›å»ºç´¢å¼•è¯·æ±‚ CreateIndexRequest request = new CreateIndexRequest(indexName); request.settings(Settings.builder() .put(&quot;index.number_of_shards&quot;, 3) .put(&quot;index.number_of_replicas&quot;, 2) ); request.mapping( &quot;&#123;\n&quot; + &quot; \&quot;properties\&quot;: &#123;\n&quot; + &quot; \&quot;message\&quot;: &#123;\n&quot; + &quot; \&quot;type\&quot;: \&quot;text\&quot;\n&quot; + &quot; &#125;\n&quot; + &quot; &#125;\n&quot; + &quot;&#125;&quot;, XContentType.JSON); Map&lt;String, Object&gt; message = new HashMap&lt;&gt;(); message.put(&quot;type&quot;, &quot;text&quot;); Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;(); properties.put(&quot;message&quot;, message); Map&lt;String, Object&gt; mapping = new HashMap&lt;&gt;(); mapping.put(&quot;properties&quot;, properties); request.mapping(mapping); CreateIndexResponse createIndexResponse; try &#123; createIndexResponse = restHighLevelClient.indices().create(request, RequestOptions.DEFAULT); System.out.println(createIndexResponse); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125;]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>ElasticSearch</tag>
        <tag>Java</tag>
        <tag>Rest</tag>
        <tag>Client</tag>
        <tag>Encrypted</tag>
        <tag>Communication</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Webæ€§èƒ½æƒå¨æŒ‡å— ç¬”è®°]]></title>
    <url>%2Fhigh-performance-browser-networking-note.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ•´ç†è‡ªï¼šã€ŠWebæ€§èƒ½æƒå¨æŒ‡å—ã€‹ ä½œè€…ï¼šIlya Grigorik å‡ºç‰ˆæ—¶é—´ï¼š2014-04 ç½‘ç»œæŠ€æœ¯æ¦‚è§ˆå¸¦å®½ä¸Žå»¶è¿Ÿå»¶è¿Ÿçš„æœ€åŽä¸€å…¬é‡Œtraceroute (Windows ç³»ç»Ÿä¸‹æ˜¯tracert) å‘½ä»¤åˆ©ç”¨ICMPåè®®å®šä½æ‚¨çš„è®¡ç®—æœºå’Œç›®æ ‡è®¡ç®—æœºä¹‹é—´çš„æ‰€æœ‰è·¯ç”±å™¨ã€‚ TCPçš„æž„æˆå› ç‰¹ç½‘æœ‰ä¸¤ä¸ªæ ¸å¿ƒåè®®ï¼šIPå’ŒTCPã€‚IPï¼Œå³ Internet Protocolï¼ˆå› ç‰¹ç½‘åè®®ï¼‰ï¼Œè´Ÿè´£è”ç½‘ä¸»æœºä¹‹é—´çš„è·¯ç”±é€‰æ‹©å’Œå¯»å€ï¼›TCPï¼Œå³ Transmission Control Protocolï¼ˆä¼ è¾“æŽ§åˆ¶åè®®ï¼‰ï¼Œè´Ÿè´£åœ¨ä¸å¯é çš„ä¼ è¾“ä¿¡é“ä¹‹ä¸Šæä¾›å¯é çš„æŠ½è±¡å±‚ã€‚ ä¸‰æ¬¡æ¡æ‰‹æ‰€æœ‰TCPè¿žæŽ¥ä¸€å¼€å§‹éƒ½è¦ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼ˆè§å›¾ 2-1ï¼‰ã€‚å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨åœ¨äº¤æ¢åº”ç”¨æ•°æ®ä¹‹å‰ï¼Œå¿…é¡»å°±èµ·å§‹åˆ†ç»„åºåˆ—å·ï¼Œä»¥åŠå…¶ä»–ä¸€äº›è¿žæŽ¥ç›¸å…³çš„ç»†èŠ‚è¾¾æˆä¸€è‡´ã€‚å‡ºäºŽå®‰å…¨è€ƒè™‘ï¼Œåºåˆ—å·ç”±ä¸¤ç«¯éšæœºç”Ÿæˆã€‚ SYNå®¢æˆ·ç«¯é€‰æ‹©ä¸€ä¸ªéšæœºåºåˆ—å·xï¼Œå¹¶å‘é€ä¸€ä¸ªSYNåˆ†ç»„ï¼Œå…¶ä¸­å¯èƒ½è¿˜åŒ…æ‹¬å…¶ä»–TCPæ ‡å¿—å’Œé€‰é¡¹ã€‚ SYN ACKæœåŠ¡å™¨ç»™xåŠ 1ï¼Œå¹¶é€‰æ‹©è‡ªå·±çš„ä¸€ä¸ªéšæœºåºåˆ—å·yï¼Œè¿½åŠ è‡ªå·±çš„æ ‡å¿—å’Œé€‰é¡¹ï¼Œç„¶åŽè¿”å›žå“åº”ã€‚ ACKå®¢æˆ·ç«¯ç»™xå’ŒyåŠ 1å¹¶å‘é€æ¡æ‰‹æœŸé—´çš„æœ€åŽä¸€ä¸ªACKåˆ†ç»„ã€‚ SYNï¼šåŒæ­¥åºåˆ—ç¼–å·ï¼ˆSynchronize Sequence Numbersï¼‰ACK (Acknowledge characterï¼‰å³æ˜¯ç¡®è®¤å­—ç¬¦ ä¸‰æ¬¡æ¡æ‰‹å®ŒæˆåŽï¼Œå®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨ä¹‹é—´å°±å¯ä»¥é€šä¿¡äº†ã€‚å®¢æˆ·ç«¯å¯ä»¥åœ¨å‘é€ACKåˆ†ç»„ä¹‹åŽç«‹å³å‘é€æ•°æ®ï¼Œè€ŒæœåŠ¡å™¨å¿…é¡»ç­‰æŽ¥æ”¶åˆ°ACKåˆ†ç»„ä¹‹åŽæ‰èƒ½å‘é€æ•°æ®ã€‚è¿™ä¸ªå¯åŠ¨é€šä¿¡çš„è¿‡ç¨‹é€‚ç”¨äºŽæ‰€æœ‰TCPè¿žæŽ¥ï¼Œå› æ­¤å¯¹æ‰€æœ‰ä½¿ç”¨TCPçš„åº”ç”¨å…·æœ‰éžå¸¸å¤§çš„æ€§èƒ½å½±å“ï¼Œå› ä¸ºæ¯æ¬¡ä¼ è¾“åº”ç”¨æ•°æ®ä¹‹å‰ï¼Œéƒ½å¿…é¡»ç»åŽ†ä¸€æ¬¡å®Œæ•´çš„å¾€è¿”ã€‚ é˜Ÿé¦–é˜»å¡ž ä¸¢åŒ…å°±ä¸¢åŒ…äº‹å®žä¸Šï¼Œä¸¢åŒ…æ˜¯è®©TCPè¾¾åˆ°æœ€ä½³æ€§èƒ½çš„å…³é”®ã€‚è¢«åˆ é™¤çš„åŒ…æ°æ°æ˜¯ä¸€ç§åé¦ˆæœºåˆ¶ï¼Œèƒ½å¤Ÿè®©æŽ¥æ”¶ç«¯å’Œå‘é€ç«¯å„è‡ªè°ƒæ•´é€Ÿåº¦ï¼Œä»¥é¿å…ç½‘ç»œæ‹¥å µï¼ŒåŒæ—¶ä¿æŒå»¶è¿Ÿæœ€çŸ­ã€‚å¦å¤–ï¼Œæœ‰äº›åº”ç”¨ç¨‹åºå¯ä»¥å®¹å¿ä¸¢å¤±ä¸€å®šæ•°é‡çš„åŒ…ï¼Œæ¯”å¦‚è¯­éŸ³å’Œæ¸¸æˆçŠ¶æ€é€šä¿¡ï¼Œå°±ä¸éœ€è¦å¯é ä¼ è¾“æˆ–æŒ‰åºäº¤ä»˜ã€‚å°±ç®—æœ‰ä¸ªåŒ…ä¸¢äº†ï¼ŒéŸ³é¢‘ç¼–è§£ç å™¨åªè¦åœ¨éŸ³é¢‘ä¸­æ’å…¥ä¸€ä¸ªå°å°çš„é—´æ­‡ï¼Œå°±å¯ä»¥ç»§ç»­å¤„ç†åŽæ¥çš„åŒ…ã€‚åªè¦é—´æ­‡å¤Ÿå°ï¼Œç”¨æˆ·å°±æ³¨æ„ä¸åˆ°ï¼Œè€Œç­‰å¾…ä¸¢å¤±çš„åŒ…åˆ™å¯èƒ½å¯¼è‡´éŸ³é¢‘è¾“å‡ºäº§ç”Ÿæ— æ³•é¢„æ–™çš„æš‚åœã€‚ç›¸å¯¹æ¥è¯´ï¼ŒåŽè€…çš„ç”¨æˆ·ä½“éªŒæ›´ç³Ÿç³•ã€‚ç±»ä¼¼åœ°ï¼Œæ›´æ–°3Dæ¸¸æˆä¸­è§’è‰²çš„çŠ¶æ€ä¹Ÿä¸€æ ·ï¼šæ”¶åˆ°Tæ—¶åˆ»çš„åŒ…è€Œç­‰å¾…T-1æ—¶åˆ»çš„åŒ…é€šå¸¸æ¯«æ— å¿…è¦ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œåº”è¯¥å¯ä»¥æŽ¥æ”¶æ‰€æœ‰çŠ¶æ€æ›´æ–°ï¼Œä½†ä¸ºé¿å…æ¸¸æˆå»¶è¿Ÿï¼Œé—´æ­‡æ€§çš„ä¸¢åŒ…ä¹Ÿæ˜¯å¯ä»¥æŽ¥å—çš„ã€‚ é’ˆå¯¹TCPçš„ä¼˜åŒ–å»ºè®®TCPæ˜¯ä¸€ä¸ªè‡ªé€‚åº”çš„ã€å¯¹æ‰€æœ‰ç½‘ç»œèŠ‚ç‚¹ä¸€è§†åŒä»çš„ã€æœ€å¤§é™åˆ¶åˆ©ç”¨åº•å±‚ç½‘ç»œçš„åè®®ã€‚å› æ­¤ï¼Œä¼˜åŒ–TCPçš„æœ€ä½³é€”å¾„å°±æ˜¯è°ƒæ•´å®ƒæ„ŸçŸ¥å½“å‰ç½‘ç»œçŠ¶å†µçš„æ–¹å¼ï¼Œæ ¹æ®å®ƒä¹‹ä¸Šæˆ–ä¹‹ä¸‹çš„æŠ½è±¡å±‚çš„ç±»åž‹å’Œéœ€æ±‚æ¥æ”¹å˜å®ƒçš„è¡Œä¸ºã€‚ æœåŠ¡å™¨é…ç½®è°ƒä¼˜åœ¨ç€æ‰‹è°ƒæ•´TCPçš„ç¼“å†²åŒºã€è¶…æ—¶ç­‰æ•°åä¸ªå˜é‡ä¹‹å‰ï¼Œæœ€å¥½å…ˆæŠŠä¸»æœºæ“ä½œç³»ç»Ÿå‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚TCP çš„æœ€ä½³å®žè·µä»¥åŠå½±å“å…¶æ€§èƒ½çš„åº•å±‚ç®—æ³•ä¸€ç›´åœ¨ä¸Žæ—¶ä¿±è¿›ï¼Œè€Œä¸”å¤§å¤šæ•°å˜åŒ–éƒ½åªåœ¨æœ€æ–°å†…æ ¸ä¸­æ‰æœ‰å®žçŽ°ã€‚ä¸€å¥è¯ï¼Œè®©ä½ çš„æœåŠ¡å™¨è·Ÿä¸Šæ—¶ä»£æ˜¯ä¼˜åŒ–å‘é€ç«¯å’ŒæŽ¥æ”¶ç«¯TCPæ ˆçš„é¦–è¦æŽªæ–½ã€‚ æœ‰äº†æœ€æ–°çš„å†…æ ¸ï¼Œæˆ‘ä»¬æŽ¨èä½ éµå¾ªå¦‚ä¸‹æœ€ä½³å®žè·µæ¥é…ç½®è‡ªå·±çš„æœåŠ¡å™¨ã€‚ å¢žå¤§TCPçš„åˆå§‹æ‹¥å¡žçª—å£åŠ å¤§èµ·å§‹æ‹¥å¡žçª—å£å¯ä»¥è®©TCPåœ¨ç¬¬ä¸€æ¬¡å¾€è¿”å°±ä¼ è¾“è¾ƒå¤šæ•°æ®ï¼Œè€ŒéšåŽçš„é€Ÿåº¦æå‡ä¹Ÿä¼šå¾ˆæ˜Žæ˜¾ã€‚å¯¹äºŽçªå‘æ€§çš„çŸ­æš‚è¿žæŽ¥ï¼Œè¿™ä¹Ÿæ˜¯ç‰¹åˆ«å…³é”®çš„ä¸€ä¸ªä¼˜åŒ–ã€‚ æ…¢å¯åŠ¨é‡å¯åœ¨è¿žæŽ¥ç©ºé—²æ—¶ç¦ç”¨æ…¢å¯åŠ¨å¯ä»¥æ”¹å–„çž¬æ—¶å‘é€æ•°æ®çš„é•¿TCPè¿žæŽ¥çš„æ€§èƒ½ã€‚ çª—å£ç¼©æ”¾å¯ç”¨çª—å£ç¼©æ”¾å¯ä»¥å¢žå¤§æœ€å¤§æŽ¥æ”¶çª—å£å¤§å°ï¼Œå¯ä»¥è®©é«˜å»¶è¿Ÿçš„è¿žæŽ¥è¾¾åˆ°æ›´å¥½åžåé‡ã€‚ TCPå¿«é€Ÿæ‰“å¼€åœ¨æŸäº›æ¡ä»¶ä¸‹ï¼Œå…è®¸åœ¨ç¬¬ä¸€ä¸ªSYNåˆ†ç»„ä¸­å‘é€åº”ç”¨ç¨‹åºæ•°æ®ã€‚TFOï¼ˆTCP Fast Openï¼ŒTCP å¿«é€Ÿæ‰“å¼€ï¼‰æ˜¯ä¸€ç§æ–°çš„ä¼˜åŒ–é€‰é¡¹ï¼Œéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…±åŒæ”¯æŒã€‚ä¸ºæ­¤ï¼Œé¦–å…ˆè¦æžæ¸…æ¥šä½ çš„åº”ç”¨ç¨‹åºæ˜¯å¦å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ã€‚ Linuxç”¨æˆ·å¯ä»¥ä½¿ç”¨ssæ¥æŸ¥çœ‹å½“å‰æ‰“å¼€çš„å¥—æŽ¥å­—çš„å„ç§ç»Ÿè®¡ä¿¡æ¯ã€‚åœ¨å‘½ä»¤è¡Œé‡Œè¿è¡Œss â€“options â€“extended â€“memory â€“processes â€“info ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰é€šä¿¡èŠ‚ç‚¹ä»¥åŠå®ƒä»¬ç›¸åº”çš„è¿žæŽ¥è®¾ç½®ã€‚ UDPçš„æž„æˆå…³äºŽUDPçš„åº”ç”¨ï¼Œæœ€å¹¿ä¸ºäººçŸ¥åŒæ—¶ä¹Ÿæ˜¯æ‰€æœ‰æµè§ˆå™¨å’Œå› ç‰¹ç½‘åº”ç”¨éƒ½èµ–ä»¥è¿ä½œçš„ï¼Œå°±æ˜¯DNSï¼ˆDomain Name Systemï¼ŒåŸŸåç³»ç»Ÿï¼‰ã€‚ IETFå’ŒW3Cå·¥ä½œç»„å…±åŒåˆ¶å®šäº†ä¸€å¥—æ–°API WebRTCï¼ˆWeb Real-Time Communicationï¼ŒWeb å®žæ—¶é€šä¿¡ï¼‰ã€‚WebRTCç€çœ¼äºŽåœ¨æµè§ˆå™¨ä¸­é€šè¿‡UDPå®žçŽ°åŽŸç”Ÿçš„è¯­éŸ³å’Œè§†é¢‘å®žæ—¶é€šä¿¡ï¼Œä»¥åŠå…¶ä»–å½¢å¼çš„ P2Pï¼ˆPeer-to-Peerï¼Œç«¯åˆ°ç«¯ï¼‰é€šä¿¡ã€‚ æ— åè®®æœåŠ¡è¦ç†è§£ä¸ºä»€ä¹ˆUDPè¢«äººç§°ä½œâ€œæ— åè®®â€ï¼Œå¿…é¡»ä»Žä½œä¸ºTCPå’ŒUDPä¸‹ä¸€å±‚çš„IPåè®®è¯´èµ·ã€‚IPå±‚çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯æŒ‰ç…§åœ°å€ä»Žæºä¸»æœºå‘ç›®æ ‡ä¸»æœºå‘é€æ•°æ®æŠ¥ã€‚ä¸ºæ­¤ï¼Œæ¶ˆæ¯ä¼šè¢«å°è£…åœ¨ä¸€ä¸ªIPåˆ†ç»„å†…ï¼ˆå›¾3-1ï¼‰ï¼Œå…¶ä¸­è½½æ˜Žäº†æºåœ°å€å’Œç›®æ ‡åœ°å€ï¼Œä»¥åŠå…¶ä»–ä¸€äº›è·¯ç”±å‚æ•°ã€‚æ³¨æ„ï¼Œæ•°æ®æŠ¥è¿™ä¸ªè¯æš—ç¤ºäº†ä¸€ä¸ªé‡è¦çš„ä¿¡æ¯ï¼šIPå±‚ä¸ä¿è¯æ¶ˆæ¯å¯é çš„äº¤ä»˜ï¼Œä¹Ÿä¸å‘é€å¤±è´¥é€šçŸ¥ï¼Œå®žé™…ä¸Šæ˜¯æŠŠåº•å±‚ç½‘ç»œçš„ä¸å¯é æ€§ç›´æŽ¥æš´éœ²ç»™äº†ä¸Šä¸€å±‚ã€‚å¦‚æžœæŸä¸ªè·¯ç”±èŠ‚ç‚¹å› ä¸ºç½‘ç»œæ‹¥å¡žã€è´Ÿè½½è¿‡é«˜æˆ–å…¶ä»–åŽŸå› è€Œåˆ é™¤äº†IPåˆ†ç»„ï¼Œé‚£ä¹ˆåœ¨å¿…è¦çš„æƒ…å†µä¸‹ï¼ŒIP çš„ä¸Šä¸€å±‚åè®®è¦è´Ÿè´£æ£€æµ‹ã€æ¢å¤å’Œé‡å‘æ•°æ®ã€‚ UDPåè®®ä¼šç”¨è‡ªå·±çš„åˆ†ç»„ç»“æž„ï¼ˆå›¾3-2ï¼‰å°è£…ç”¨æˆ·æ¶ˆæ¯ï¼Œå®ƒåªå¢žåŠ  4ä¸ªå­—æ®µï¼šæºç«¯å£ã€ç›®æ ‡ç«¯å£ã€åˆ†ç»„é•¿åº¦å’Œæ ¡éªŒå’Œã€‚è¿™æ ·ï¼Œå½“IPæŠŠåˆ†ç»„é€è¾¾ç›®æ ‡ä¸»æœºæ—¶ï¼Œè¯¥ä¸»æœºèƒ½å¤Ÿæ‹†å¼€UDPåˆ†ç»„ï¼Œæ ¹æ®ç›®æ ‡ç«¯å£æ‰¾åˆ°ç›®æ ‡åº”ç”¨ç¨‹åºï¼Œç„¶åŽå†æŠŠæ¶ˆæ¯å‘é€è¿‡åŽ»ã€‚ä»…æ­¤è€Œå·²ã€‚ äº‹å®žä¸Šï¼ŒUDPæ•°æ®æŠ¥ä¸­çš„æºç«¯å£å’Œæ ¡éªŒå’Œå­—æ®µéƒ½æ˜¯å¯é€‰çš„ã€‚IPåˆ†ç»„çš„é¦–éƒ¨ä¹Ÿæœ‰æ ¡éªŒå’Œï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å¿½ç•¥UDPæ ¡éªŒå’Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰é”™è¯¯æ£€æµ‹å’Œé”™è¯¯çº æ­£å·¥ä½œéƒ½å¯ä»¥å§”æ‰˜ç»™ä¸Šå±‚çš„åº”ç”¨ç¨‹åºã€‚è¯´åˆ°åº•ï¼ŒUDPä»…ä»…æ˜¯åœ¨IPå±‚ä¹‹ä¸Šé€šè¿‡åµŒå…¥åº”ç”¨ç¨‹åºçš„æºç«¯å£å’Œç›®æ ‡ç«¯å£ï¼Œæä¾›äº†ä¸€ä¸ªâ€œåº”ç”¨ç¨‹åºå¤šè·¯å¤ç”¨â€æœºåˆ¶ã€‚æ˜Žç™½äº†è¿™ä¸€ç‚¹ï¼Œå°±å¯ä»¥æ€»ç»“ä¸€ä¸‹UDPçš„æ— æœåŠ¡æ˜¯æ€Žä¹ˆå›žäº‹äº†ã€‚ ä¸ä¿è¯æ¶ˆæ¯äº¤ä»˜ä¸ç¡®è®¤ï¼Œä¸é‡ä¼ ï¼Œæ— è¶…æ—¶ã€‚ ä¸ä¿è¯äº¤ä»˜é¡ºåºä¸è®¾ç½®åŒ…åºå·ï¼Œä¸é‡æŽ’ï¼Œä¸ä¼šå‘ç”Ÿé˜Ÿé¦–é˜»å¡žã€‚ ä¸è·Ÿè¸ªè¿žæŽ¥çŠ¶æ€ä¸å¿…å»ºç«‹è¿žæŽ¥æˆ–é‡å¯çŠ¶æ€æœºã€‚ ä¸éœ€è¦æ‹¥å¡žæŽ§åˆ¶ä¸å†…ç½®å®¢æˆ·ç«¯æˆ–ç½‘ç»œåé¦ˆæœºåˆ¶ã€‚ TCPæ˜¯ä¸€ä¸ªé¢å‘å­—èŠ‚æµçš„åè®®ï¼Œèƒ½å¤Ÿä»¥å¤šä¸ªåˆ†ç»„å½¢å¼å‘é€åº”ç”¨ç¨‹åºæ¶ˆæ¯ï¼Œä¸”å¯¹åˆ†ç»„ä¸­çš„æ¶ˆæ¯èŒƒå›´æ²¡æœ‰ä»»ä½•æ˜Žç¡®é™åˆ¶ã€‚å› æ­¤ï¼Œè¿žæŽ¥çš„ä¸¤ç«¯å­˜åœ¨ä¸€ä¸ªè¿žæŽ¥çŠ¶æ€ï¼Œæ¯ä¸ªåˆ†ç»„éƒ½æœ‰åºå·ï¼Œä¸¢å¤±è¿˜è¦é‡å‘ï¼Œå¹¶ä¸”è¦æŒ‰é¡ºåºäº¤ä»˜ã€‚ç›¸å¯¹æ¥è¯´ï¼ŒUDPæ•°æ®æŠ¥æœ‰æ˜Žç¡®çš„é™åˆ¶ï¼šæ•°æ®æŠ¥å¿…é¡»å°è£…åœ¨IPåˆ†ç»„ä¸­ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»è¯»å–å®Œæ•´çš„æ¶ˆæ¯ã€‚æ¢å¥è¯è¯´ï¼Œæ•°æ®æŠ¥ä¸èƒ½åˆ†ç‰‡ã€‚ UDPä¸Žç½‘ç»œåœ°å€è½¬æ¢å™¨ä½œä¸ºç›‘ç®¡å…¨çƒIPåœ°å€åˆ†é…çš„æœºæž„ï¼ŒIANAï¼ˆInternet Assigned Numbers Authorityï¼Œå› ç‰¹ç½‘å·ç åˆ†é…æœºæž„ï¼‰ä¸ºç§æœ‰ç½‘ç»œä¿ç•™äº†ä¸‰æ®µIPåœ°å€ï¼Œè¿™äº›IPåœ°å€ç»å¸¸å¯ä»¥åœ¨NATè®¾å¤‡åŽé¢çš„å†…ç½‘ä¸­çœ‹åˆ°ã€‚ ä¿ç•™çš„IPåœ°å€èŒƒå›´ï¼š IPåœ°å€èŒƒå›´ åœ°å€æ•°é‡ 10.0.0.0~10.255.255.255 16 777 216 172.16.0.0~172.31.255.255 1 048 576 192.168.0.0~192.168.255.255 65 536 ä¸ºé˜²æ­¢è·¯ç”±é”™è¯¯å’Œå¼•èµ·ä¸å¿…è¦çš„éº»çƒ¦ï¼Œä¸å…è®¸ç»™å¤–ç½‘è®¡ç®—æœºåˆ†é…è¿™äº›ä¿ç•™çš„ç§æœ‰IPåœ°å€ã€‚ ä¼ è¾“å±‚å®‰å…¨ï¼ˆTLSï¼‰SSLï¼ˆSecure Sockets Layerï¼Œå®‰å…¨å¥—æŽ¥å­—å±‚ï¼‰åè®®æœ€åˆæ˜¯ç½‘æ™¯å…¬å¸ä¸ºäº†ä¿éšœç½‘ä¸Šäº¤æ˜“å®‰å…¨è€Œå¼€å‘çš„ï¼Œè¯¥åè®®é€šè¿‡åŠ å¯†æ¥ä¿æŠ¤å®¢æˆ·ä¸ªäººèµ„æ–™ï¼Œé€šè¿‡è®¤è¯å’Œå®Œæ•´æ€§æ£€æŸ¥æ¥ç¡®ä¿äº¤æ˜“å®‰å…¨ã€‚ä¸ºè¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼ŒSSLåè®®åœ¨ç›´æŽ¥ä½äºŽTCPä¸Šä¸€å±‚çš„åº”ç”¨å±‚è¢«å®žçŽ°ï¼ˆå›¾ 4-1ï¼‰ã€‚SSLä¸ä¼šå½±å“ä¸Šå±‚åè®®ï¼ˆå¦‚HTTPã€ç”µå­é‚®ä»¶ã€å³æ—¶é€šè®¯ï¼‰ï¼Œä½†èƒ½å¤Ÿä¿è¯ä¸Šå±‚åè®®çš„ç½‘ç»œé€šä¿¡å®‰å…¨ã€‚ åœ¨æ­£ç¡®ä½¿ç”¨SSLçš„æƒ…å†µä¸‹ï¼Œç¬¬ä¸‰æ–¹ç›‘å¬è€…åªèƒ½æŽ¨æ–­å‡ºè¿žæŽ¥çš„ç«¯ç‚¹ã€åŠ å¯†ç±»åž‹ï¼Œä»¥åŠå‘é€æ•°æ®çš„é¢‘çŽ‡å’Œå¤§è‡´æ•°é‡ï¼Œä¸èƒ½å®žé™…è¯»å–æˆ–ä¿®æ”¹ä»»ä½•æ•°æ®ã€‚ åŠ å¯†ã€èº«ä»½éªŒè¯ä¸Žå®Œæ•´æ€§ Web ä»£ç†ã€ä¸­é—´è®¾å¤‡ã€TLS ä¸Žæ–°åè®®HTTP è‰¯å¥½çš„æ‰©å±•èƒ½åŠ›å’ŒèŽ·å¾—çš„å·¨å¤§æˆåŠŸï¼Œä½¿å¾— Web ä¸Šå‡ºçŽ°äº†å¤§é‡ä»£ç†å’Œä¸­é—´è®¾å¤‡ï¼šç¼“å­˜æœåŠ¡å™¨ã€å®‰å…¨ç½‘å…³ã€Web åŠ é€Ÿå™¨ã€å†…å®¹è¿‡æ»¤å™¨ï¼Œç­‰ç­‰ã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬çŸ¥é“è¿™äº›è®¾å¤‡çš„å­˜åœ¨ï¼ˆæ˜¾å¼ä»£ç†ï¼‰ï¼Œè€Œæœ‰æ—¶å€™ï¼Œè¿™äº›è®¾å¤‡å¯¹ç»ˆç«¯ç”¨æˆ·åˆ™å®Œå…¨ä¸å¯è§ã€‚ ç„¶è€Œï¼Œè¿™äº›æœåŠ¡å™¨çš„å­˜åœ¨åŠæˆåŠŸä¹Ÿç»™é‚£äº›è¯•å›¾è„±ç¦» HTTP åè®®çš„äººå¸¦äº†ä¸€äº›ä¸ä¾¿ã€‚æ¯”å¦‚ï¼Œæœ‰çš„ä»£ç†æœåŠ¡å™¨åªä¼šç®€å•åœ°è½¬å‘è‡ªå·±æ— æ³•è§£é‡Šçš„ HTTP æ‰©å±•æˆ–å…¶ä»–åœ¨çº¿æ ¼å¼ï¼ˆwire formatï¼‰ï¼Œè€Œæœ‰çš„åˆ™ä¸ç®¡æ˜¯å¦å¿…è¦éƒ½ä¼šå¯¹æ‰€æœ‰æ•°æ®æ‰§è¡Œè‡ªå·±è®¾å®šçš„é€»è¾‘ï¼Œè¿˜æœ‰ä¸€äº›å®‰å…¨è®¾å¤‡å¯èƒ½ä¼šæŠŠæœ¬æ¥æ­£å¸¸çš„æ•°æ®è¯¯åˆ¤æˆæ¶æ„é€šä¿¡ã€‚ æ¢å¥è¯è¯´ï¼ŒçŽ°å®žå½“ä¸­å¦‚æžœæƒ³è„±ç¦» HTTP å’Œ 80 ç«¯å£çš„è¯­ä¹‰è¡Œäº‹ï¼Œç»å¸¸ä¼šé­é‡å„ç§éƒ¨ç½²ä¸Šçš„éº»çƒ¦ã€‚æ¯”å¦‚ï¼ŒæŸäº›å®¢æˆ·ç«¯è¡¨çŽ°æ­£å¸¸ï¼Œå¦ä¸€äº›å¯èƒ½å°±ä¼šå¼‚å¸¸ï¼Œç”šè‡³åœ¨æŸä¸ªç½‘æ®µè¡¨çŽ°æ­£å¸¸çš„å®¢æˆ·ç«¯åˆ°äº†å¦ä¸€ä¸ªç½‘æ®µåˆä¼šå˜å¾—å¼‚å¸¸ã€‚ ä¸ºè§£å†³è¿™äº›é—®é¢˜ï¼Œå‡ºçŽ°äº†ä¸€äº›æ–°åè®®å’Œå¯¹ HTTP çš„æ‰©å±•ï¼Œæ¯”å¦‚ WebSocketã€SPDYç­‰ã€‚è¿™äº›æ–°åè®®ä¸€èˆ¬è¦ä¾èµ–äºŽå»ºç«‹ HTTPS ä¿¡é“ï¼Œä»¥ç»•è¿‡ä¸­é—´ä»£ç†ï¼Œä»Žè€Œå®žçŽ°å¯é çš„éƒ¨ç½²ï¼Œå› ä¸ºåŠ å¯†çš„ä¼ è¾“ä¿¡é“ä¼šå¯¹æ‰€æœ‰ä¸­é—´è®¾å¤‡éƒ½æ··æ·†æ•°æ®ã€‚è¿™æ ·è™½ç„¶è§£å†³äº†ä¸­é—´è®¾å¤‡çš„é—®é¢˜ï¼Œä½†å´å¯¼è‡´é€šä¿¡ä¸¤ç«¯ä¸èƒ½å†åˆ©ç”¨è¿™äº›ä¸­é—´è®¾å¤‡ï¼Œä»Žè€Œä¸Žè¿™äº›è®¾å¤‡æä¾›çš„èº«ä»½éªŒè¯ã€ç¼“å­˜ã€å®‰å…¨æ‰«æç­‰åŠŸèƒ½å¤±ä¹‹äº¤è‡‚ã€‚ ä¿¡ä»»é“¾ä¸Žè¯ä¹¦é¢å‘æœºæž„Webä»¥åŠæµè§ˆå™¨ä¸­çš„èº«ä»½éªŒè¯éœ€è¦å›žç­”ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼šæˆ‘çš„æµè§ˆå™¨ä¿¡ä»»è°ï¼Ÿæˆ‘åœ¨ä½¿ç”¨æµè§ˆå™¨çš„æ—¶å€™ä¿¡ä»»è°ï¼Ÿè¿™ä¸ªé—®é¢˜è‡³å°‘æœ‰ä¸‰ä¸ªç­”æ¡ˆã€‚ æ‰‹å·¥æŒ‡å®šè¯ä¹¦æ‰€æœ‰æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿéƒ½æä¾›äº†ä¸€ç§æ‰‹å·¥å¯¼å…¥ä¿¡ä»»è¯ä¹¦çš„æœºåˆ¶ã€‚è‡³äºŽå¦‚ä½•èŽ·å¾—è¯ä¹¦å’ŒéªŒè¯å®Œæ•´æ€§åˆ™å®Œå…¨ç”±ä½ è‡ªå·±æ¥å®šã€‚ è¯ä¹¦é¢å‘æœºæž„CAï¼ˆCertificate Authorityï¼Œè¯ä¹¦é¢å‘æœºæž„ï¼‰æ˜¯è¢«è¯ä¹¦æŽ¥å—è€…ï¼ˆæ‹¥æœ‰è€…ï¼‰å’Œä¾èµ–è¯ä¹¦çš„ä¸€æ–¹å…±åŒä¿¡ä»»çš„ç¬¬ä¸‰æ–¹ã€‚ æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿæ¯ä¸ªæ“ä½œç³»ç»Ÿå’Œå¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šå†…ç½®ä¸€ä¸ªçŸ¥åè¯ä¹¦é¢å‘æœºæž„çš„åå•ã€‚å› æ­¤ï¼Œä½ ä¹Ÿä¼šä¿¡ä»»æ“ä½œç³»ç»ŸåŠæµè§ˆå™¨æä¾›å•†æä¾›å’Œç»´æŠ¤çš„å¯ä¿¡ä»»æœºæž„ã€‚ å®žè·µä¸­ï¼Œä¿å­˜å¹¶æ‰‹å·¥éªŒè¯æ¯ä¸ªç½‘ç«™çš„å¯†é’¥æ˜¯ä¸å¯è¡Œçš„ï¼ˆå½“ç„¶ï¼Œå¦‚æžœä½ æ„¿æ„ï¼Œä¹Ÿå¯ä»¥ï¼‰ã€‚çŽ°å®žä¸­æœ€å¸¸è§çš„æ–¹æ¡ˆå°±æ˜¯è®©è¯ä¹¦é¢å‘æœºæž„æ›¿æˆ‘ä»¬åšè¿™ä»¶äº‹ï¼ˆå›¾ 4-5ï¼‰ï¼šæµè§ˆå™¨æŒ‡å®šå¯ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæž„ï¼ˆæ ¹CAï¼‰ï¼Œç„¶åŽéªŒè¯ä»–ä»¬ç­¾ç½²çš„æ¯ä¸ªç«™ç‚¹çš„è´£ä»»å°±è½¬ç§»åˆ°äº†ä»–ä»¬å¤´ä¸Šï¼Œä»–ä»¬ä¼šå®¡è®¡å’ŒéªŒè¯è¿™äº›ç«™ç‚¹çš„è¯ä¹¦æ²¡æœ‰è¢«æ»¥ç”¨æˆ–å†’å……ã€‚æŒæœ‰CAè¯ä¹¦çš„ç«™ç‚¹çš„å®‰å…¨æ€§å¦‚æžœé­åˆ°ç ´åï¼Œé‚£æ’¤é”€è¯¥è¯ä¹¦ä¹Ÿæ˜¯è¯ä¹¦é¢å‘æœºæž„çš„è´£ä»»ã€‚ æ‰€æœ‰æµè§ˆå™¨éƒ½å…è®¸ç”¨æˆ·æ£€è§†è‡ªå·±å®‰å…¨è¿žæŽ¥çš„ä¿¡ä»»é“¾ï¼Œå¸¸è§çš„è®¿é—®å…¥å£å°±æ˜¯åœ°å€æ å¤´å„¿ä¸Šçš„é”å›¾æ ‡ï¼Œç‚¹å‡»å³å¯æŸ¥çœ‹ã€‚ è¯ä¹¦æ’¤é”€è¯ä¹¦æ’¤é”€åå•ï¼ˆCRLï¼‰CRLï¼ˆCertificate Revocation Listï¼Œè¯ä¹¦æ’¤é”€åå•ï¼‰æ˜¯RFC 5280è§„å®šçš„ä¸€ç§æ£€æŸ¥æ‰€æœ‰è¯ä¹¦çŠ¶æ€çš„ç®€å•æœºåˆ¶ï¼šæ¯ä¸ªè¯ä¹¦é¢å‘æœºæž„ç»´æŠ¤å¹¶å®šæœŸå‘å¸ƒå·²æ’¤é”€è¯ä¹¦çš„åºåˆ—å·åå•ã€‚è¿™æ ·ï¼Œä»»ä½•æƒ³éªŒè¯è¯ä¹¦çš„äººéƒ½å¯ä»¥ä¸‹è½½æ’¤é”€åå•ï¼Œæ£€æŸ¥ç›¸åº”è¯ä¹¦æ˜¯å¦æ¦œä¸Šæœ‰åã€‚å¦‚æžœæœ‰ï¼Œè¯´æ˜Žè¯ä¹¦å·²ç»è¢«æ’¤é”€äº†ã€‚ CRLæ–‡ä»¶æœ¬èº«å¯ä»¥å®šæœŸå‘å¸ƒã€æ¯æ¬¡æ›´æ–°æ—¶å‘å¸ƒï¼Œæˆ–é€šè¿‡HTTPæˆ–å…¶ä»–æ–‡ä»¶ä¼ è¾“åè®®æ¥æä¾›è®¿é—®ã€‚è¿™ä¸ªåå•åŒæ ·ç”±è¯ä¹¦é¢å‘æœºæž„ç­¾åï¼Œé€šå¸¸å…è®¸è¢«ç¼“å­˜ä¸€å®šæ—¶é—´ã€‚å®žè·µä¸­ï¼Œè¿™ç§æœºåˆ¶æ•ˆæžœå¾ˆå¥½ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š CRLåå•ä¼šéšç€è¦æ’¤é”€çš„è¯ä¹¦å¢žå¤šè€Œå˜é•¿ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯éƒ½å¿…é¡»å–å¾—åŒ…å«æ‰€æœ‰åºåˆ—å·çš„å®Œæ•´åå•ï¼› æ²¡æœ‰åŠžæ³•ç«‹å³æ›´æ–°åˆšåˆšè¢«æ’¤é”€çš„è¯ä¹¦åºåˆ—å·ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯å…ˆç¼“å­˜äº†CRLï¼Œä¹‹åŽæŸè¯ä¹¦è¢«æ’¤é”€ï¼Œé‚£åˆ°ç¼“å­˜è¿‡æœŸä¹‹å‰ï¼Œè¯¥è¯ä¹¦å°†ä¸€ç›´è¢«è§†ä¸ºæœ‰æ•ˆã€‚ åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼ˆOCSPï¼‰ä¸ºè§£å†³CRLæœºåˆ¶çš„ä¸Šè¿°é—®é¢˜ï¼ŒRFC 2560å®šä¹‰äº†OCSPï¼ˆOnline Certificate Status Protocolï¼Œåœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼‰ï¼Œæä¾›äº†ä¸€ç§å®žæ—¶æ£€æŸ¥è¯ä¹¦çŠ¶æ€çš„æœºåˆ¶ã€‚ä¸ŽCRLåŒ…å«è¢«æ’¤é”€è¯ä¹¦çš„åºåˆ—å·ä¸åŒï¼ŒOCSP æ”¯æŒéªŒè¯ç«¯ç›´æŽ¥æŸ¥è¯¢è¯ä¹¦æ•°æ®åº“ä¸­çš„åºåˆ—å·ï¼Œä»Žè€ŒéªŒè¯è¯ä¹¦é“¾æ˜¯å¦æœ‰æ•ˆã€‚æ€»ä¹‹ï¼ŒOCSP å ç”¨å¸¦å®½æ›´å°‘ï¼Œæ”¯æŒå®žæ—¶éªŒè¯ã€‚ ç„¶è€Œï¼Œæ²¡æœ‰ä»€ä¹ˆæœºåˆ¶æ˜¯å®Œç¾Žæ— ç¼ºçš„ï¼å®žæ—¶OCSPæŸ¥è¯¢ä¹Ÿå¸¦äº†ä¸€äº›é—®é¢˜ï¼š è¯ä¹¦é¢å‘æœºæž„å¿…é¡»å¤„ç†å®žæ—¶æŸ¥è¯¢ï¼› è¯ä¹¦é¢å‘æœºæž„å¿…é¡»ç¡®ä¿éšæ—¶éšåœ°å¯ä»¥è®¿é—®ï¼› å®¢æˆ·ç«¯åœ¨è¿›ä¸€æ­¥åå•†ä¹‹å‰é˜»å¡žOCSPè¯·æ±‚ï¼› ç”±äºŽè¯ä¹¦é¢å‘æœºæž„çŸ¥é“å®¢æˆ·ç«¯è¦è®¿é—®å“ªä¸ªç«™ç‚¹ï¼Œå› æ­¤å®žæ—¶OCSPè¯·æ±‚å¯èƒ½ä¼šæ³„éœ²å®¢æˆ·ç«¯çš„éšç§ã€‚ å®žè·µä¸­ï¼ŒCRLå’ŒOCSPæœºåˆ¶æ˜¯äº’è¡¥å­˜åœ¨çš„ï¼Œå¤§å¤šæ•°è¯ä¹¦æ—¢æä¾›æŒ‡ä»¤ä¹Ÿæ”¯æŒæŸ¥è¯¢ã€‚æ›´é‡è¦çš„å€’æ˜¯å®¢æˆ·ç«¯çš„æ”¯æŒå’Œè¡Œä¸ºã€‚æœ‰çš„æµè§ˆå™¨ä¼šåˆ†å‘è‡ªå·±çš„CRLåå•ï¼Œæœ‰çš„æµè§ˆå™¨ä»Žè¯ä¹¦é¢å‘æœºæž„å–å¾—å¹¶ç¼“å­˜CRLæ–‡ä»¶ã€‚ç±»ä¼¼åœ°ï¼Œæœ‰çš„æµè§ˆå™¨ä¼šè¿›è¡Œå®žæ—¶OCSPæ£€æŸ¥ï¼Œä½†åœ¨OCSPè¯·æ±‚å¤±è´¥çš„æƒ…å†µä¸‹è¡Œä¸ºåˆä¼šæœ‰æ‰€ä¸åŒã€‚è¦äº†è§£å…·ä½“çš„æƒ…å†µï¼Œå¯ä»¥æ£€æŸ¥æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿçš„è¯ä¹¦æ’¤é”€ç½‘ç»œè®¾ç½®ã€‚ é’ˆå¯¹TLSçš„ä¼˜åŒ–å»ºè®®TLSè®°å½•å¤§å°ä¸è¿‡å¯¹äºŽåœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„Webåº”ç”¨æ¥è¯´ï¼Œå€’æ˜¯æœ‰ä¸€ä¸ªå€¼å¾—æŽ¨èçš„åšæ³•ï¼šæ¯ä¸ªTCPåˆ†ç»„æ°å¥½å°è£…ä¸€ä¸ªTLSè®°å½•ï¼Œè€ŒTLSè®°å½•å¤§å°æ°å¥½å æ»¡TCPåˆ†é…çš„MSSï¼ˆMaximum Segment Sizeï¼Œæœ€å¤§æ®µå¤§å°ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œä¸€æ–¹é¢ä¸è¦è®©TLSè®°å½•åˆ†æˆå¤šä¸ªTCPåˆ†ç»„ï¼Œå¦ä¸€æ–¹é¢åˆè¦å°½é‡åœ¨ä¸€æ¡è®°å½•ä¸­å¤šå‘é€æ•°æ®ã€‚ä»¥ä¸‹æ•°æ®å¯ä½œä¸ºç¡®å®šæœ€ä¼˜TLSè®°å½•å¤§å°çš„å‚è€ƒï¼š IPv4 å¸§éœ€è¦ 20 å­—èŠ‚ï¼ŒIPv6 éœ€è¦ 40 å­—èŠ‚ï¼› TCP å¸§éœ€è¦ 20 å­—èŠ‚ï¼› TCP é€‰é¡¹éœ€è¦ 40 å­—èŠ‚ï¼ˆæ—¶é—´æˆ³ã€SACK ç­‰ï¼‰ã€‚ å‡è®¾å¸¸è§çš„MTUä¸º1500å­—èŠ‚ï¼Œåˆ™TLSè®°å½•å¤§å°åœ¨IPv4ä¸‹æ˜¯1420å­—èŠ‚ï¼Œåœ¨IPv6ä¸‹æ˜¯1400å­—èŠ‚ã€‚ä¸ºç¡®ä¿å‘å‰å…¼å®¹ï¼Œå»ºè®®ä½¿ç”¨IPv6ä¸‹çš„å¤§å°ï¼š1400å­—èŠ‚ã€‚å½“ç„¶ï¼Œå¦‚æžœMTUæ›´å°ï¼Œè¿™ä¸ªå€¼ä¹Ÿè¦ç›¸åº”è°ƒå°ã€‚ å¯æƒœçš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨åº”ç”¨å±‚æŽ§åˆ¶TLSè®°å½•å¤§å°ã€‚TLSè®°å½•å¤§å°é€šå¸¸æ˜¯ä¸€ä¸ªè®¾ç½®ï¼Œç”šè‡³æ˜¯TLSæœåŠ¡å™¨ä¸Šçš„ç¼–è¯‘æ—¶å¸¸é‡æˆ–æ ‡å¿—ã€‚è¦äº†è§£å…·ä½“å¦‚ä½•è®¾ç½®è¿™ä¸ªå€¼ï¼Œè¯·å‚è€ƒæœåŠ¡å™¨æ–‡æ¡£ã€‚ å¦‚æžœæœåŠ¡å™¨è¦å¤„ç†å¤§é‡TLSè¿žæŽ¥ï¼Œé‚£ä¹ˆå…³é”®çš„ä¼˜åŒ–æ˜¯æŠŠæ¯ä¸ªè¿žæŽ¥å ç”¨çš„å†…å­˜é‡æŽ§åˆ¶åœ¨æœ€å°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenSSLç­‰å¸¸ç”¨çš„åº“ä¼šç»™æ¯ä¸ªè¿žæŽ¥åˆ†é…50KBç©ºé—´ï¼Œä½†æ­£åƒè®¾ç½®è®°å½•å¤§å°ä¸€æ ·ï¼Œæœ‰å¿…è¦æŸ¥ä¸€æŸ¥æ–‡æ¡£æˆ–è€…æºä»£ç ï¼Œç„¶åŽå†å†³å®šå¦‚ä½•è°ƒæ•´è¿™ä¸ªå€¼ã€‚è°·æ­Œçš„æœåŠ¡å™¨æŠŠOpenSSLç¼“å†²åŒºçš„å¤§å°å‡å°‘åˆ°äº†å¤§çº¦5KBã€‚ TLSåŽ‹ç¼©TLSè¿˜æœ‰ä¸€ä¸ªå†…ç½®çš„å°åŠŸèƒ½ï¼Œå°±æ˜¯æ”¯æŒå¯¹è®°å½•åè®®ä¼ è¾“çš„æ•°æ®è¿›è¡Œæ— æŸåŽ‹ç¼©ã€‚åŽ‹ç¼©ç®—æ³•åœ¨TLSæ¡æ‰‹æœŸé—´å•†å®šï¼ŒåŽ‹ç¼©æ“ä½œåœ¨å¯¹è®°å½•åŠ å¯†ä¹‹å‰æ‰§è¡Œã€‚ç„¶è€Œï¼Œå‡ºäºŽå¦‚ä¸‹åŽŸå› ï¼Œå®žè·µä¸­å¾€å¾€éœ€è¦ç¦ç”¨æœåŠ¡å™¨ä¸Šçš„TLSåŽ‹ç¼©åŠŸèƒ½ï¼š 2012 å¹´å…¬å¸ƒçš„â€œCRIMEâ€æ”»å‡»ä¼šåˆ©ç”¨TLSåŽ‹ç¼©æ¢å¤åŠ å¯†è®¤è¯cookieï¼Œè®©æ”»å‡»è€…å®žæ–½ä¼šè¯åŠ«æŒï¼› ä¼ è¾“çº§çš„TLSåŽ‹ç¼©ä¸å…³å¿ƒå†…å®¹ï¼Œå¯èƒ½ä¼šå†æ¬¡åŽ‹ç¼©å·²ç»åŽ‹ç¼©è¿‡çš„æ•°æ®ï¼ˆå›¾åƒã€è§†é¢‘ç­‰ç­‰ï¼‰ã€‚ åŒé‡åŽ‹ç¼©ä¼šæµªè´¹æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„CPUæ—¶é—´ï¼Œè€Œä¸”æš´éœ²çš„å®‰å…¨æ¼æ´žä¹Ÿå¾ˆä¸¥é‡ï¼Œå› æ­¤è¯·ç¦ç”¨TLSåŽ‹ç¼©ã€‚å®žè·µä¸­ï¼Œå¤§å¤šæ•°æµè§ˆå™¨ä¼šç¦ç”¨TLSåŽ‹ç¼©ï¼Œä½†å³ä¾¿å¦‚æ­¤ä½ ä¹Ÿåº”è¯¥åœ¨æœåŠ¡å™¨çš„é…ç½®ä¸­æ˜Žç¡®ç¦ç”¨å®ƒï¼Œä»¥ä¿æŠ¤ç”¨æˆ·çš„åˆ©ç›Šã€‚ è™½ç„¶ä¸èƒ½ä½¿ç”¨TLSåŽ‹ç¼©ï¼Œä½†åº”è¯¥ä½¿ç”¨æœåŠ¡å™¨çš„Gzipè®¾ç½®åŽ‹ç¼©æ‰€æœ‰æ–‡æœ¬èµ„æºï¼ŒåŒæ—¶å¯¹å›¾åƒã€è§†é¢‘ã€éŸ³é¢‘ç­‰åª’ä½“é‡‡ç”¨æœ€åˆé€‚çš„åŽ‹ç¼©æ ¼å¼ã€‚ æ— çº¿ç½‘ç»œæ€§èƒ½ç§»åŠ¨ç½‘ç»œçš„ä¼˜åŒ–å»ºè®®æ¶ˆé™¤å‘¨æœŸæ€§åŠæ— æ•ˆçš„æ•°æ®ä¼ è¾“å¯¹æŽ¨é€è€Œè¨€ï¼ŒåŽŸç”Ÿåº”ç”¨å¯ä»¥è®¿é—®å¹³å°ä¸“æœ‰çš„æŽ¨é€æœåŠ¡ï¼Œå› æ­¤åº”è¯¥å°½å¯èƒ½ä½¿ç”¨ã€‚å¯¹ Web åº”ç”¨æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨SSEï¼ˆServer Sent Eventsï¼ŒæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼‰å’ŒWebSocketä»¥é™ä½Žå»¶è¿Ÿæ—¶é—´å’Œåè®®æ¶ˆè€—ï¼Œå°½å¯èƒ½ä¸ä½¿ç”¨è½®è¯¢å’Œæ›´è€—èµ„æºçš„XHRæŠ€æœ¯ã€‚ æ¶ˆé™¤ä¸å¿…è¦çš„é•¿è¿žæŽ¥TCPæˆ–UDPè¿žæŽ¥çš„è¿žæŽ¥çŠ¶æ€åŠç”Ÿå‘½æœŸä¸Žè®¾å¤‡çš„æ— çº¿çŠ¶æ€æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚æ¢å¥è¯è¯´ï¼Œå³ä¾¿ä¸Žè¿è¥å•†ç½‘ç»œä»ç»´æŒç€ï¼ˆä¸¤ç«¯é—´ï¼‰è¿žæŽ¥ä¸ä¸­æ–­ï¼Œæ— çº¿æ¨¡å—ä¹Ÿå¯ä»¥å¤„äºŽä½Žè€—ç”µçŠ¶æ€ã€‚å¤–éƒ¨ç½‘ç»œçš„åˆ†ç»„åˆ°æ¥æ—¶ï¼Œè¿è¥å•†æ— çº¿ç½‘ç»œä¼šé€šçŸ¥è®¾å¤‡ï¼Œä½¿å…¶æ— çº¿æ¨¡å—åˆ‡æ¢åˆ°è¿žæŽ¥çŠ¶æ€ï¼Œä»Žè€Œæ¢å¤æ•°æ®ä¼ è¾“ã€‚ æ˜Žç™½äº†å—ï¼Œåº”ç”¨ä¸å¿…è®©æ— çº¿æ¨¡å—â€œæ´»åŠ¨â€ä¹Ÿå¯ä»¥ä¿æŒè¿žæŽ¥ä¸è¢«æ–­å¼€ã€‚ä½†ä¸å¿…è¦çš„é•¿è¿žæŽ¥ä¹Ÿæœ‰å¯èƒ½æžå¤§åœ°æ¶ˆè€—ç”µé‡ï¼Œè€Œä¸”ç”±äºŽäººä»¬å¯¹ç§»åŠ¨ç½‘ç»œæ— çº¿é€šä¿¡çš„è¯¯è§£ï¼Œè¿™ç§æƒ…å†µç»å¸¸å‘ç”Ÿã€‚ é¢„æµ‹ç½‘ç»œå»¶è¿Ÿä¸Šé™åœ¨ç§»åŠ¨ç½‘ç»œä¸­ï¼Œä¸€ä¸ªHTTPè¯·æ±‚å¾ˆå¯èƒ½ä¼šå¯¼è‡´ä¸€è¿žä¸²é•¿è¾¾å‡ ç™¾ç”šè‡³ä¸Šå‡ åƒmsçš„ç½‘ç»œå»¶è¿Ÿã€‚è¿™ä¸€æ–¹é¢æ˜¯å› ä¸ºæœ‰å¾€è¿”å»¶è¿Ÿï¼Œå¦ä¸€æ–¹é¢ä¹Ÿä¸èƒ½å¿˜è®°DNSã€TCPã€TLSåŠæŽ§åˆ¶é¢çš„å»¶è¿Ÿï¼ˆå›¾8-2ï¼‰ã€‚ HTTPHTTP ç®€å²HTTP 1.0ï¼šè¿…é€Ÿå‘å±•åŠå‚è€ƒæ€§RFCä»Šå¤©ï¼Œå‡ ä¹Žæ‰€æœ‰WebæœåŠ¡å™¨éƒ½æ”¯æŒï¼Œè€Œä¸”ä»¥åŽè¿˜ä¼šç»§ç»­æ”¯æŒHTTP 1.0ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå‰©ä¸‹çš„ä½ éƒ½çŸ¥é“äº†ã€‚ä½†HTTP 1.0å¯¹æ¯ä¸ªè¯·æ±‚éƒ½æ‰“å¼€ä¸€ä¸ªæ–°TCPè¿žæŽ¥ä¸¥é‡å½±å“æ€§èƒ½ã€‚ HTTP 1.1ï¼šäº’è”ç½‘æ ‡å‡†HTTP 1.1 æ ‡å‡†åŽ˜æ¸…äº†ä¹‹å‰ç‰ˆæœ¬ä¸­å¾ˆå¤šæœ‰æ­§ä¹‰çš„åœ°æ–¹ï¼Œè€Œä¸”è¿˜åŠ å…¥äº†å¾ˆå¤šé‡è¦çš„æ€§èƒ½ä¼˜åŒ–ï¼šæŒä¹…è¿žæŽ¥ã€åˆ†å—ç¼–ç ä¼ è¾“ã€å­—èŠ‚èŒƒå›´è¯·æ±‚ã€å¢žå¼ºçš„ç¼“å­˜æœºåˆ¶ã€ä¼ è¾“ç¼–ç åŠè¯·æ±‚ç®¡é“ã€‚ HTTP 1.1 æ”¹å˜äº†HTTPåè®®çš„è¯­ä¹‰ï¼Œé»˜è®¤ä½¿ç”¨æŒä¹…è¿žæŽ¥ã€‚æ¢å¥è¯è¯´ï¼Œé™¤éžæ˜Žç¡®å‘ŠçŸ¥ï¼ˆé€šè¿‡Connection: close é¦–éƒ¨ï¼‰ï¼Œå¦åˆ™æœåŠ¡å™¨é»˜è®¤ä¼šä¿æŒè¿žæŽ¥æ‰“å¼€ã€‚ ä¸è¿‡ï¼Œè¿™ä¸ªåŠŸèƒ½ä¹Ÿåå‘ç§»æ¤åˆ°äº†HTTP 1.0ï¼Œå¯ä»¥é€šè¿‡Connection: Keep-Alive é¦–éƒ¨æ¥å¯ç”¨ã€‚å®žé™…ä¸Šï¼Œå¦‚æžœä½ ä½¿ç”¨çš„æ˜¯HTTP 1.1ï¼Œä»ŽæŠ€æœ¯ä¸Šè¯´ä¸éœ€è¦Connection: Keep-Aliveé¦–éƒ¨ï¼Œä½†å¾ˆå¤šå®¢æˆ·ç«¯è¿˜æ˜¯é€‰æ‹©åŠ ä¸Šå®ƒã€‚ æ­¤å¤–ï¼ŒHTTP 1.1 åè®®æ·»åŠ äº†å†…å®¹ã€ç¼–ç ã€å­—ç¬¦é›†ï¼Œç”šè‡³è¯­è¨€çš„åå•†æœºåˆ¶ï¼Œè¿˜æ·»åŠ äº†ä¼ è¾“ç¼–ç ã€ç¼“å­˜æŒ‡ä»¤ã€å®¢æˆ·ç«¯cookie ç­‰åå‡ ä¸ªå¯ä»¥æ¯æ¬¡è¯·æ±‚éƒ½åå•†çš„å­—æ®µã€‚ HTTP 2.0ï¼šæ”¹è¿›ä¼ è¾“æ€§èƒ½ HTTPï¼ˆHypertext Transfer Protocolï¼‰æ˜¯ä¸€ä¸ªåº”ç”¨å±‚åè®®ï¼Œå¯ç”¨äºŽåˆ†å¸ƒåä½œå¼çš„è¶…åª’ä½“ç³»ç»Ÿã€‚å®ƒæ˜¯ä¸€ä¸ªé€šç”¨ã€æ— çŠ¶æ€çš„åè®®ã€‚é™¤äº†è¶…æ–‡æœ¬ï¼Œé€šè¿‡æ‰©å±•å®ƒçš„è¯·æ±‚æ–¹å¼ã€é”™è¯¯ç¼–ç åŠé¦–éƒ¨ï¼Œè¿˜å¯ä»¥å°†å®ƒç”¨äºŽå¾ˆå¤šå…¶ä»–é¢†åŸŸï¼Œæ¯”å¦‚åŸŸåæœåŠ¡å™¨å’Œåˆ†å¸ƒå¼å¯¹è±¡ç®¡ç†ç³»ç»Ÿã€‚HTTPçš„ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯å…è®¸æ•°æ®çš„ç±»åž‹å˜åŒ–å’Œåå•†ï¼Œä»Žè€Œå…è®¸ç³»ç»Ÿç‹¬ç«‹äºŽè¢«ä¼ è¾“çš„æ•°æ®æž„å»ºã€‚â€”â€”RFC 2616ï¼šHTTP/1.1ï¼ˆ1999 å¹´ 6 æœˆï¼‰ å½“å‰ï¼Œå‡ºçŽ°äº†ä¸€ç§ä¿æŒHTTPè¯­ä¹‰ï¼Œä½†è„±ç¦»HTTP/1.xæ¶ˆæ¯åˆ†å¸§åŠè¯­æ³•çš„åè®®ç”¨æ³•ã€‚è¿™ç§ç”¨æ³•è¢«è¯æ˜Žæœ‰ç¢äºŽæ€§èƒ½ï¼Œå¹¶ä¸”æ˜¯åœ¨é¼“åŠ±æ»¥ç”¨åº•å±‚ä¼ è¾“åè®®ã€‚æœ¬å·¥ä½œç»„å°†åˆ¶å®šä¸€ä¸ªæ–°è§„èŒƒï¼Œä»Žæœ‰åºã€åŠåŒå·¥æµçš„è§’åº¦é‡æ–°è¡¨è¾¾å½“å‰HTTPçš„è¯­ä¹‰ã€‚ä¸ŽHTTP/1.xä¸€æ ·ï¼Œä¸»è¦å°†ä½¿ç”¨TCPä½œä¸ºä¼ è¾“å±‚ï¼Œä¸è¿‡ä¹Ÿåº”è¯¥æ”¯æŒå…¶ä»–ä¼ è¾“åè®®ã€‚â€”â€”HTTP 2.0 çº²é¢† ï¼ˆ2012 å¹´ 1 æœˆï¼‰ HTTP 2.0 çš„ä¸»è¦ç›®æ ‡æ˜¯æ”¹è¿›ä¼ è¾“æ€§èƒ½ï¼Œå®žçŽ°ä½Žå»¶è¿Ÿå’Œé«˜åžåé‡ã€‚ä¸»ç‰ˆæœ¬å·çš„å¢žåŠ å¬èµ·æ¥åƒæ˜¯è¦åšå¤§çš„æ”¹è¿›ï¼Œä»Žæ€§èƒ½è§’åº¦è¯´çš„ç¡®å¦‚æ­¤ã€‚ä½†ä»Žå¦ä¸€æ–¹é¢çœ‹ï¼ŒHTTPçš„é«˜å±‚åè®®è¯­ä¹‰å¹¶ä¸ä¼šå› ä¸ºè¿™æ¬¡ç‰ˆæœ¬å‡çº§è€Œå—å½±å“ã€‚æ‰€æœ‰ HTTP é¦–éƒ¨ã€å€¼ï¼Œä»¥åŠå®ƒä»¬çš„ä½¿ç”¨åœºæ™¯éƒ½ä¸ä¼šå˜ã€‚ Webæ€§èƒ½è¦ç‚¹å‰–æžçŽ°ä»£Webåº”ç”¨é€Ÿåº¦ã€æ€§èƒ½ä¸Žç”¨æˆ·æœŸæœ›æ—¶é—´å’Œç”¨æˆ·æ„Ÿè§‰ æ—¶é—´ æ„Ÿè§‰ 0 ~100 ms å¾ˆå¿« 100~300 ms æœ‰ä¸€ç‚¹ç‚¹æ…¢ 300~1000 ms æœºå™¨åœ¨å·¥ä½œå‘¢ &gt; 1000 ms å…ˆå¹²ç‚¹åˆ«çš„å§ &gt; 10000 ms ä¸èƒ½ç”¨äº† è¿™ä¸ªè¡¨æ ¼è§£é‡Šäº†Webæ€§èƒ½ç¤¾åŒºæ€»ç»“çš„ç»éªŒæ³•åˆ™ï¼šå¿…é¡»250 mså†…æ¸²æŸ“é¡µé¢ï¼Œæˆ–è€…è‡³å°‘æä¾›è§†è§‰åé¦ˆï¼Œæ‰èƒ½ä¿è¯ç”¨æˆ·ä¸èµ°å¼€ï¼ HTTP 1.xHTTP 1.0çš„ä¼˜åŒ–ç­–ç•¥éžå¸¸ç®€å•ï¼Œå°±ä¸€å¥è¯ï¼šå‡çº§åˆ°HTTP 1.1ã€‚å®Œäº†ï¼ æ”¹è¿› HTTP çš„æ€§èƒ½æ˜¯ HTTP 1.1 å·¥ä½œç»„çš„ä¸€ä¸ªé‡è¦ç›®æ ‡ï¼ŒåŽæ¥è¿™ä¸ªç‰ˆæœ¬ä¹Ÿå¼•å…¥äº†å¤§é‡å¢žå¼ºæ€§èƒ½çš„é‡è¦ç‰¹æ€§ï¼Œå…¶ä¸­ä¸€äº›å¤§å®¶æ¯”è¾ƒç†ŸçŸ¥çš„æœ‰ï¼š æŒä¹…åŒ–è¿žæŽ¥ä»¥æ”¯æŒè¿žæŽ¥é‡ç”¨ï¼› åˆ†å—ä¼ è¾“ç¼–ç ä»¥æ”¯æŒæµå¼å“åº”ï¼› è¯·æ±‚ç®¡é“ä»¥æ”¯æŒå¹¶è¡Œè¯·æ±‚å¤„ç†ï¼› å­—èŠ‚æœåŠ¡ä»¥æ”¯æŒåŸºäºŽèŒƒå›´çš„èµ„æºè¯·æ±‚ï¼› æ”¹è¿›çš„æ›´å¥½çš„ç¼“å­˜æœºåˆ¶ã€‚ HTTPç®¡é“HTTP 1.x åªèƒ½ä¸¥æ ¼ä¸²è¡Œåœ°è¿”å›žå“åº”ã€‚ç‰¹åˆ«æ˜¯ï¼ŒHTTP 1.x ä¸å…è®¸ä¸€ä¸ªè¿žæŽ¥ä¸Šçš„å¤šä¸ªå“åº”æ•°æ®äº¤é”™åˆ°è¾¾ï¼ˆå¤šè·¯å¤ç”¨ï¼‰ï¼Œå› è€Œä¸€ä¸ªå“åº”å¿…é¡»å®Œå…¨è¿”å›žåŽï¼Œä¸‹ä¸€ä¸ªå“åº”æ‰ä¼šå¼€å§‹ä¼ è¾“ã€‚ä¸ºè¯´æ˜Žè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹æœåŠ¡å™¨å¹¶è¡Œå¤„ç†è¯·æ±‚çš„æƒ…å†µï¼ˆå›¾ 11-4ï¼‰ã€‚ å›¾ 11-4 æ¼”ç¤ºäº†å¦‚ä¸‹å‡ ä¸ªæ–¹é¢ï¼š HTML å’Œ CSS è¯·æ±‚åŒæ—¶åˆ°è¾¾ï¼Œä½†å…ˆå¤„ç†çš„æ˜¯ HTML è¯·æ±‚ï¼› æœåŠ¡å™¨å¹¶è¡Œå¤„ç†ä¸¤ä¸ªè¯·æ±‚ï¼Œå…¶ä¸­å¤„ç† HTML ç”¨æ—¶ 40 msï¼Œå¤„ç† CSS ç”¨æ—¶ 20 msï¼› CSS è¯·æ±‚å…ˆå¤„ç†å®Œæˆï¼Œä½†è¢«ç¼“å†²èµ·æ¥ä»¥ç­‰å€™å‘é€ HTML å“åº”ï¼› å‘é€å®Œ HTML å“åº”åŽï¼Œå†å‘é€æœåŠ¡å™¨ç¼“å†²ä¸­çš„ CSS å“åº”ã€‚ HTTP ç®¡é“ä¼šå¯¼è‡´ HTTP æœåŠ¡å™¨ã€ä»£ç†å’Œå®¢æˆ·ç«¯å‡ºçŽ°å¾ˆå¤šå¾®å¦™çš„ï¼Œä¸è§æ–‡æ¡£è®°è½½çš„é—®é¢˜ï¼š ä¸€ä¸ªæ…¢å“åº”å°±ä¼šé˜»å¡žæ‰€æœ‰åŽç»­è¯·æ±‚ï¼› å¹¶è¡Œå¤„ç†è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å¿…é¡»ç¼“å†²ç®¡é“ä¸­çš„å“åº”ï¼Œä»Žè€Œå ç”¨æœåŠ¡å™¨èµ„æºï¼Œå¦‚æžœæœ‰ä¸ªå“åº”éžå¸¸å¤§ï¼Œåˆ™å¾ˆå®¹æ˜“å½¢æˆæœåŠ¡å™¨çš„å—æ”»å‡»é¢ï¼› å“åº”å¤±è´¥å¯èƒ½ç»ˆæ­¢ TCP è¿žæŽ¥ï¼Œä»Žé¡µå¼ºè¿«å®¢æˆ·ç«¯é‡æ–°å‘é€å¯¹æ‰€æœ‰åŽç»­èµ„æºçš„è¯·æ±‚ï¼Œå¯¼è‡´é‡å¤å¤„ç†ï¼› ç”±äºŽå¯èƒ½å­˜åœ¨ä¸­é—´ä»£ç†ï¼Œå› æ­¤æ£€æµ‹ç®¡é“å…¼å®¹æ€§ï¼Œç¡®ä¿å¯é æ€§å¾ˆé‡è¦ï¼› å¦‚æžœä¸­é—´ä»£ç†ä¸æ”¯æŒç®¡é“ï¼Œé‚£å®ƒå¯èƒ½ä¼šä¸­æ–­è¿žæŽ¥ï¼Œä¹Ÿå¯èƒ½ä¼šæŠŠæ‰€æœ‰è¯·æ±‚ä¸²è”èµ·æ¥ã€‚ ä»Šå¤©ï¼Œä¸€äº›æ”¯æŒç®¡é“çš„æµè§ˆå™¨ï¼Œé€šå¸¸éƒ½å°†å…¶ä½œä¸ºä¸€ä¸ªé«˜çº§é…ç½®é€‰é¡¹ï¼Œä½†å¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šç¦ç”¨å®ƒã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æžœæµè§ˆå™¨æ˜¯ Web åº”ç”¨çš„ä¸»è¦äº¤ä»˜å·¥å…·ï¼Œé‚£è¿˜æ˜¯å¾ˆéš¾æŒ‡æœ›é€šè¿‡ HTTP ç®¡é“æ¥æå‡æ€§èƒ½ã€‚ è¦åœ¨ä½ è‡ªå·±çš„åº”ç”¨ä¸­å¯ç”¨ç®¡é“ï¼Œè¦æ³¨æ„å¦‚ä¸‹äº‹é¡¹ï¼š ç¡®ä¿ HTTP å®¢æˆ·ç«¯æ”¯æŒç®¡é“ï¼› ç¡®ä¿ HTTP æœåŠ¡å™¨æ”¯æŒç®¡é“ï¼› åº”ç”¨å¿…é¡»å¤„ç†ä¸­æ–­çš„è¿žæŽ¥å¹¶æ¢å¤ï¼› åº”ç”¨å¿…é¡»å¤„ç†ä¸­æ–­è¯·æ±‚çš„å¹‚ç­‰é—®é¢˜ï¼› åº”ç”¨å¿…é¡»ä¿æŠ¤è‡ªèº«ä¸å—å‡ºé—®é¢˜çš„ä»£ç†çš„å½±å“ã€‚ å®žè·µä¸­éƒ¨ç½² HTTP ç®¡é“çš„æœ€ä½³é€”å¾„ï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é—´ä½¿ç”¨å®‰å…¨é€šé“ï¼ˆHTTPSï¼‰ã€‚è¿™æ ·ï¼Œå°±èƒ½å¯é åœ°é¿å…é‚£äº›ä¸ç†è§£æˆ–ä¸æ”¯æŒç®¡é“çš„ä¸­é—´ä»£ç†çš„å¹²æ‰°ã€‚ ä½¿ç”¨å¤šä¸ªTCPè¿žæŽ¥ç”±äºŽ HTTP 1.x ä¸æ”¯æŒå¤šè·¯å¤ç”¨ï¼Œæµè§ˆå™¨å¯ä»¥ä¸å‡æ€ç´¢åœ°åœ¨å®¢æˆ·ç«¯æŽ’é˜Ÿæ‰€æœ‰ HTTPè¯·æ±‚ï¼Œç„¶åŽé€šè¿‡ä¸€ä¸ªæŒä¹…è¿žæŽ¥ï¼Œä¸€ä¸ªæŽ¥ä¸€ä¸ªåœ°å‘é€è¿™äº›è¯·æ±‚ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹å¼åœ¨å®žè·µä¸­å¤ªæ…¢ã€‚å®žé™…ä¸Šï¼Œæµè§ˆå™¨å¼€å‘å•†æ²¡æœ‰åˆ«çš„åŠžæ³•ï¼Œåªèƒ½å…è®¸æˆ‘ä»¬å¹¶è¡Œæ‰“å¼€å¤šä¸ª TCPä¼šè¯ã€‚å¤šå°‘ä¸ªï¼ŸçŽ°å®žä¸­ï¼Œå¤§å¤šæ•°çŽ°ä»£æµè§ˆå™¨ï¼ŒåŒ…æ‹¬æ¡Œé¢å’Œç§»åŠ¨æµè§ˆå™¨ï¼Œéƒ½æ”¯æŒæ¯ä¸ªä¸»æœºæ‰“å¼€ 6 ä¸ªè¿žæŽ¥ã€‚ æ¶ˆè€—å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨èµ„æºé™åˆ¶æ¯ä¸ªä¸»æœºæœ€å¤š 6 ä¸ªè¿žæŽ¥ï¼Œå¯ä»¥è®©æµè§ˆå™¨æ£€æµ‹å‡ºæ— æ„ï¼ˆæˆ–æœ‰æ„ï¼‰çš„ DoSï¼ˆDenial of Serviceï¼‰æ”»å‡»ã€‚å¦‚æžœæ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼Œå®¢æˆ·ç«¯æœ‰å¯èƒ½æ¶ˆè€—æŽ‰æœåŠ¡å™¨çš„æ‰€æœ‰èµ„æºã€‚è®½åˆºçš„æ˜¯ï¼ŒåŒæ ·çš„å®‰å…¨æ£€æµ‹åœ¨æŸäº›æµè§ˆå™¨ä¸Šå´ä¼šæ‹›è‡´åå‘æ”»å‡»ï¼šå¦‚æžœå®¢æˆ·ç«¯è¶…è¿‡äº†æœ€å¤§è¿žæŽ¥æ•°ï¼Œé‚£ä¹ˆæ‰€æœ‰åŽæ¥çš„å®¢æˆ·ç«¯è¯·æ±‚éƒ½å°†è¢«é˜»å¡žã€‚å¤§å®¶å¯ä»¥åšä¸ªè¯•éªŒï¼Œåœ¨ä¸€ä¸ªä¸»æœºä¸ŠåŒæ—¶æ‰“å¼€ 6 ä¸ªå¹¶è¡Œä¸‹è½½ï¼Œç„¶åŽå†æ‰“å¼€ç¬¬ 7 ä¸ªä¸‹è½½è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šæŒ‚èµ·ï¼Œç›´åˆ°å‰é¢çš„è¯·æ±‚å®Œæˆæ‰ä¼šæ‰§è¡Œã€‚ ç”¨è¶³å®¢æˆ·ç«¯è¿žæŽ¥çš„é™åˆ¶ä¼¼ä¹Žæ˜¯ä¸€ä¸ªå¯ä»¥æŽ¥å—çš„å®‰å…¨é—®é¢˜ï¼Œä½†å¯¹äºŽéœ€è¦å®žæ—¶äº¤ä»˜æ•°æ®çš„åº”ç”¨è€Œè¨€ï¼Œè¿™æ ·åšè¶Šæ¥è¶Šå®¹æ˜“é€ æˆéƒ¨ç½²ä¸Šçš„é—®é¢˜ã€‚æ¯”å¦‚ WebSocketã€ServerSent Event å’ŒæŒ‚èµ· XHRï¼Œè¿™äº›ä¼šè¯éƒ½ä¼šå ç”¨æ•´æ•´ä¸€ä¸ª TCP æµï¼Œè€Œä¸ç®¡æœ‰æ— æ•°æ®ä¼ è¾“â€”â€”è®°ä½ï¼Œæ²¡æœ‰å¤šè·¯å¤ç”¨ä¸€è¯´ï¼å®žé™…ä¸Šï¼Œå¦‚æžœä½ ä¸æ³¨æ„ï¼Œé‚£å¾ˆå¯èƒ½è‡ªå·±å¯¹è‡ªå·±çš„åº”ç”¨æ–½åŠ  DoS æ”»å‡»ã€‚ åŸŸååˆ†åŒºæ ¹æ® HTTP Archive çš„ç»Ÿè®¡ï¼Œç›®å‰å¹³å‡æ¯ä¸ªé¡µé¢éƒ½åŒ…å« 90 å¤šä¸ªç‹¬ç«‹çš„èµ„æºï¼Œå¦‚æžœè¿™äº›èµ„æºéƒ½æ¥è‡ªåŒä¸€ä¸ªä¸»æœºï¼Œé‚£ä¹ˆä»ç„¶ä¼šå¯¼è‡´æ˜Žæ˜¾çš„æŽ’é˜Ÿç­‰å¾…ã€‚å®žé™…ä¸Šï¼Œä½•å¿…æŠŠè‡ªå·±åªé™åˆ¶åœ¨ä¸€ä¸ªä¸»æœºä¸Šå‘¢ï¼Ÿæˆ‘ä»¬ä¸å¿…åªé€šè¿‡ä¸€ä¸ªä¸»æœºï¼ˆä¾‹å¦‚ www.example.comï¼‰æä¾›æ‰€æœ‰èµ„æºï¼Œè€Œæ˜¯å¯ä»¥æ‰‹å·¥å°†æ‰€æœ‰èµ„æºåˆ†æ•£åˆ°å¤šä¸ªå­åŸŸåï¼š{shard1,shardn}.example.comã€‚ç”±äºŽä¸»æœºåç§°ä¸ä¸€æ ·äº†ï¼Œå°±å¯ä»¥çªç ´æµè§ˆå™¨çš„è¿žæŽ¥é™åˆ¶ï¼Œå®žçŽ°æ›´é«˜çš„å¹¶è¡Œèƒ½åŠ›ã€‚åŸŸååˆ†åŒºä½¿ç”¨å¾—è¶Šå¤šï¼Œå¹¶è¡Œèƒ½åŠ›å°±è¶Šå¼ºï¼ å½“ç„¶ï¼Œå¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼ŒåŸŸååˆ†åŒºä¹Ÿä¸ä¾‹å¤–ï¼šæ¯ä¸ªæ–°ä¸»æœºåéƒ½è¦æ±‚æœ‰ä¸€æ¬¡é¢å¤–çš„ DNS æŸ¥è¯¢ï¼Œæ¯å¤šä¸€ä¸ªå¥—æŽ¥å­—éƒ½ä¼šå¤šæ¶ˆè€—ä¸¤ç«¯çš„ä¸€äº›èµ„æºï¼Œè€Œæ›´ç³Ÿç³•çš„æ˜¯ï¼Œç«™ç‚¹ä½œè€…å¿…é¡»æ‰‹å·¥åˆ†ç¦»è¿™äº›èµ„æºï¼Œå¹¶åˆ†åˆ«æŠŠå®ƒä»¬æ‰˜ç®¡åˆ°å¤šä¸ªä¸»æœºä¸Šã€‚ å®žè·µä¸­ï¼ŒæŠŠå¤šä¸ªåŸŸåï¼ˆå¦‚ shard1.example.comã€shard2.example.comï¼‰è§£æžåˆ°åŒä¸€ä¸ª IP åœ°å€æ˜¯å¾ˆå¸¸è§çš„åšæ³•ã€‚æ‰€æœ‰åˆ†åŒºéƒ½é€šè¿‡ CNAME DNS è®°å½•æŒ‡å‘åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œè€Œæµè§ˆå™¨è¿žæŽ¥é™åˆ¶é’ˆå¯¹çš„æ˜¯ä¸»æœºåï¼Œä¸æ˜¯ IP åœ°å€ã€‚å¦å¤–ï¼Œæ¯ä¸ªåˆ†åŒºä¹Ÿå¯ä»¥æŒ‡å‘ä¸€ä¸ª CDN æˆ–å…¶ä»–å¯ä»¥è®¿é—®åˆ°çš„æœåŠ¡å™¨ã€‚ DNS æŸ¥è¯¢å’Œ TCP æ…¢å¯åŠ¨å¯¼è‡´çš„é¢å¤–æ¶ˆè€—å¯¹é«˜å»¶è¿Ÿå®¢æˆ·ç«¯çš„å½±å“æœ€å¤§ã€‚æ¢å¥è¯è¯´ï¼Œç§»åŠ¨ï¼ˆ3Gã€4Gï¼‰å®¢æˆ·ç«¯ç»å¸¸æ˜¯å—è¿‡åº¦åŸŸååˆ†åŒºå½±å“æœ€å¤§çš„ï¼ Cookie åœ¨å¾ˆå¤šåº”ç”¨ä¸­éƒ½æ˜¯å¸¸è§çš„æ€§èƒ½ç“¶é¢ˆï¼Œå¾ˆå¤šå¼€å‘è€…éƒ½ä¼šå¿½ç•¥å®ƒç»™æ¯æ¬¡è¯·æ±‚å¢žåŠ çš„é¢å¤–è´Ÿæ‹…ã€‚ è®¡ç®—å›¾ç‰‡å¯¹å†…å­˜çš„éœ€æ±‚æ‰€æœ‰ç¼–ç çš„å›¾ç‰‡ç»æµè§ˆå™¨è§£æžåŽéƒ½ä¼šä»¥ RGBA ä½å›¾çš„å½¢å¼ä¿å­˜äºŽå†…å­˜å½“ä¸­ã€‚æ¯ä¸ªRGBA å›¾ç‰‡çš„åƒç´ éœ€è¦å ç”¨ 4 å­—èŠ‚ï¼šçº¢ã€ç»¿ã€è“é€šé“å„å  1 å­—èŠ‚ï¼ŒAlphaï¼ˆé€æ˜Žï¼‰é€šé“å  1 å­—èŠ‚ã€‚è¿™æ ·ç®—ä¸‹æ¥ï¼Œä¸€å¼ å›¾ç‰‡å ç”¨çš„å†…å­˜é‡å°±æ˜¯å›¾ç‰‡åƒç´ å®½åº¦ Ã— åƒç´ é«˜åº¦ Ã—4 å­—èŠ‚ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ800Ã—600 åƒç´ çš„ä½å›¾ä¼šå å¤šå¤§å†…å­˜å‘¢ï¼Ÿ800 Ã— 600 Ã— 4 B = 1 920 000 B â‰ˆ 1.83 MBåœ¨èµ„æºå—é™çš„è®¾å¤‡ï¼Œæ¯”å¦‚æ‰‹æœºä¸Šï¼Œå†…å­˜å ç”¨å¾ˆå¿«å°±ä¼šæˆä¸ºç“¶é¢ˆã€‚å¯¹äºŽæ¸¸æˆç­‰ä¸¥é‡ä¾èµ–å›¾ç‰‡çš„åº”ç”¨æ¥è¯´ï¼Œè¿™ä¸ªé—®é¢˜å°±ä¼šæ›´æ˜Žæ˜¾ã€‚ æ‰“åŒ…æ–‡ä»¶åˆ°åº•å¤šå¤§åˆé€‚å‘¢ï¼Ÿå¯æƒœçš„æ˜¯ï¼Œæ²¡æœ‰ç†æƒ³çš„å¤§å°ã€‚ç„¶è€Œï¼Œè°·æ­Œ PageSpeedå›¢é˜Ÿçš„æµ‹è¯•è¡¨æ˜Žï¼Œ30~50 KBï¼ˆåŽ‹ç¼©åŽï¼‰æ˜¯æ¯ä¸ª JavaScript æ–‡ä»¶å¤§å°çš„åˆé€‚èŒƒå›´ï¼šæ—¢å¤§åˆ°äº†èƒ½å¤Ÿå‡å°‘å°æ–‡ä»¶å¸¦æ¥çš„ç½‘ç»œå»¶è¿Ÿï¼Œè¿˜èƒ½ç¡®ä¿é€’å¢žåŠåˆ†å±‚å¼çš„æ‰§è¡Œã€‚å…·ä½“çš„ç»“æžœå¯èƒ½ä¼šç”±äºŽåº”ç”¨ç±»åž‹å’Œè„šæœ¬æ•°é‡è€Œæœ‰æ‰€ä¸åŒã€‚ åµŒå…¥èµ„æºåµŒå…¥èµ„æºæ˜¯å¦ä¸€ç§éžå¸¸æµè¡Œçš„ä¼˜åŒ–æ–¹æ³•ï¼ŒæŠŠèµ„æºåµŒå…¥æ–‡æ¡£å¯ä»¥å‡å°‘è¯·æ±‚çš„æ¬¡æ•°ã€‚æ¯”å¦‚ï¼ŒJavaScript å’Œ CSS ä»£ç ï¼Œé€šè¿‡é€‚å½“çš„ script å’Œ style å—å¯ä»¥ç›´æŽ¥æ”¾åœ¨é¡µé¢ä¸­ï¼Œè€Œå›¾ç‰‡ç”šè‡³éŸ³é¢‘æˆ– PDF æ–‡ä»¶ï¼Œéƒ½å¯ä»¥é€šè¿‡æ•°æ® URIï¼ˆdata:[mediatype][;base64],data ï¼‰çš„æ–¹å¼åµŒå…¥åˆ°é¡µé¢ä¸­ï¼š 123&lt;img src=&quot;data:image/gif;base64,R0lGODlhAQABAIAAAAAAAAAAACH5BAAAAAAALAAAAAABAAEAAAICTAEAOw==&quot;alt=&quot;1x1 transparent (GIF) pixel&quot; /&gt; å‰é¢çš„ä¾‹å­æ˜¯åœ¨æ–‡æ¡£ä¸­åµŒå…¥äº†ä¸€ä¸ª 1Ã—1 çš„é€æ˜Ž GIF åƒç´ ã€‚è€Œä»»ä½• MIMEç±»åž‹ï¼Œåªè¦æµè§ˆå™¨èƒ½ç†è§£ï¼Œéƒ½å¯ä»¥é€šè¿‡ç±»ä¼¼æ–¹å¼åµŒå…¥åˆ°é¡µé¢ä¸­ï¼ŒåŒ…æ‹¬PDFã€éŸ³é¢‘ã€è§†é¢‘ã€‚ä¸è¿‡ï¼Œæœ‰äº›æµè§ˆå™¨ä¼šé™åˆ¶æ•°æ® URI çš„å¤§å°ï¼Œæ¯”å¦‚ IE8æœ€å¤§åªå…è®¸ 32 KBã€‚ æ•°æ® URI é€‚åˆç‰¹åˆ«å°çš„ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œæœ€å¥½æ˜¯åªç”¨ä¸€æ¬¡çš„èµ„æºã€‚ä»¥åµŒå…¥æ–¹å¼æ”¾åˆ°é¡µé¢ä¸­çš„èµ„æºï¼Œåº”è¯¥ç®—æ˜¯é¡µé¢çš„ä¸€éƒ¨åˆ†ï¼Œä¸èƒ½è¢«æµè§ˆå™¨ã€CDN æˆ–å…¶ä»–ç¼“å­˜ä»£ç†ä½œä¸ºå•ç‹¬çš„èµ„æºç¼“å­˜ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æžœåœ¨å¤šä¸ªé¡µé¢ä¸­éƒ½åµŒå…¥åŒæ ·çš„èµ„æºï¼Œé‚£ä¹ˆè¿™ä¸ªèµ„æºå°†ä¼šéšç€æ¯ä¸ªé¡µé¢çš„åŠ è½½è€Œè¢«åŠ è½½ï¼Œä»Žè€Œå¢žå¤§æ¯ä¸ªé¡µé¢çš„æ€»ä½“å¤§å°ã€‚å¦å¤–ï¼Œå¦‚æžœåµŒå…¥èµ„æºè¢«æ›´æ–°ï¼Œé‚£ä¹ˆæ‰€æœ‰ä»¥å‰å‡ºçŽ°è¿‡å®ƒçš„é¡µé¢éƒ½å°†è¢«å®£å‘Šæ— æ•ˆï¼Œè€Œç”±å®¢æˆ·ç«¯é‡æ–°ä»ŽæœåŠ¡å™¨èŽ·å–ã€‚ æœ€åŽï¼Œè™½ç„¶ CSS å’Œ JavaScript ç­‰åŸºäºŽæ–‡æœ¬çš„èµ„æºå¾ˆå®¹æ˜“ç›´æŽ¥åµŒå…¥é¡µé¢ï¼Œä¹Ÿä¸ä¼šå¸¦æ¥å¤šä½™çš„å¼€é”€ï¼Œä½†éžæ–‡æœ¬æ€§èµ„æºåˆ™å¿…é¡»é€šè¿‡ base64 ç¼–ç ï¼Œè€Œè¿™ä¼šå¯¼è‡´å¼€é”€æ˜Žæ˜¾å¢žå¤§ï¼šç¼–ç åŽçš„èµ„æºå¤§å°æ¯”åŽŸå¤§å°å¢žå¤§ 33% ï¼ base64 ç¼–ç ä½¿ç”¨ 64 ä¸ª ASCII ç¬¦å·å’Œç©ºç™½ç¬¦å°†ä»»æ„å­—èŠ‚æµç¼–ç ä¸º ASCIIå­—ç¬¦ä¸²ã€‚ç¼–ç è¿‡ç¨‹ä¸­ï¼Œbase64 ä¼šå¯¼è‡´è¢«ç¼–ç çš„æµå˜æˆåŽŸæ¥çš„ 4/3ï¼Œå³å¢žå¤§33% çš„å­—èŠ‚å¼€é”€ã€‚ å®žè·µä¸­ï¼Œå¸¸è§çš„ä¸€ä¸ªç»éªŒè§„åˆ™æ˜¯åªè€ƒè™‘åµŒå…¥ 1~2 KB ä»¥ä¸‹çš„èµ„æºï¼Œå› ä¸ºå°äºŽè¿™ä¸ªæ ‡å‡†çš„èµ„æºç»å¸¸ä¼šå¯¼è‡´æ¯”å®ƒè‡ªèº«æ›´é«˜çš„ HTTP å¼€é”€ã€‚ç„¶è€Œï¼Œå¦‚æžœåµŒå…¥çš„èµ„æºé¢‘ç¹å˜æ›´ï¼Œåˆä¼šå¯¼è‡´å®¿ä¸»æ–‡æ¡£çš„æ— æ•ˆç¼“å­˜çŽ‡å‡é«˜ã€‚åµŒå…¥èµ„æºä¹Ÿä¸æ˜¯å®Œç¾Žçš„æ–¹æ³•ã€‚å¦‚æžœä½ çš„åº”ç”¨è¦ä½¿ç”¨å¾ˆå°çš„ã€ä¸ªåˆ«çš„æ–‡ä»¶ï¼Œåœ¨è€ƒè™‘æ˜¯å¦åµŒå…¥æ—¶ï¼Œå¯ä»¥å‚ç…§å¦‚ä¸‹å»ºè®®ï¼š å¦‚æžœæ–‡ä»¶å¾ˆå°ï¼Œè€Œä¸”åªæœ‰ä¸ªåˆ«é¡µé¢ä½¿ç”¨ï¼Œå¯ä»¥è€ƒè™‘åµŒå…¥ï¼› å¦‚æžœæ–‡ä»¶å¾ˆå°ï¼Œä½†éœ€è¦åœ¨å¤šä¸ªé¡µé¢ä¸­é‡ç”¨ï¼Œåº”è¯¥è€ƒè™‘é›†ä¸­æ‰“åŒ…ï¼› å¦‚æžœå°æ–‡ä»¶ç»å¸¸éœ€è¦æ›´æ–°ï¼Œå°±ä¸è¦åµŒå…¥äº†ï¼› é€šè¿‡å‡å°‘ HTTP cookie çš„å¤§å°å°†åè®®å¼€é”€æœ€å°åŒ–ã€‚ HTTP 2.0HTTP 2.0 çš„ç›®çš„å°±æ˜¯é€šè¿‡æ”¯æŒè¯·æ±‚ä¸Žå“åº”çš„å¤šè·¯å¤ç”¨æ¥å‡å°‘å»¶è¿Ÿï¼Œé€šè¿‡åŽ‹ç¼© HTTPé¦–éƒ¨å­—æ®µå°†åè®®å¼€é”€é™è‡³æœ€ä½Žï¼ŒåŒæ—¶å¢žåŠ å¯¹è¯·æ±‚ä¼˜å…ˆçº§å’ŒæœåŠ¡å™¨ç«¯æŽ¨é€çš„æ”¯æŒã€‚ HTTP 2.0 ä¸ä¼šæ”¹åŠ¨ HTTP çš„è¯­ä¹‰ã€‚HTTP æ–¹æ³•ã€çŠ¶æ€ç ã€URI åŠé¦–éƒ¨å­—æ®µï¼Œç­‰ç­‰è¿™äº›æ ¸å¿ƒæ¦‚å¿µä¸€å¦‚å¾€å¸¸ã€‚ä½†æ˜¯ï¼ŒHTTP 2.0 ä¿®æ”¹äº†æ ¼å¼åŒ–æ•°æ®ï¼ˆåˆ†å¸§ï¼‰çš„æ–¹å¼ï¼Œä»¥åŠå®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨é—´ä¼ è¾“è¿™äº›æ•°æ®çš„æ–¹å¼ã€‚è¿™ä¸¤ç‚¹ç»Ÿå¸…å…¨å±€ï¼Œé€šè¿‡æ–°çš„ç»„å¸§æœºåˆ¶å‘æˆ‘ä»¬çš„åº”ç”¨éšè—äº†æ‰€æœ‰å¤æ‚æ€§ã€‚æ¢å¥è¯è¯´ï¼Œæ‰€æœ‰åŽŸæ¥çš„åº”ç”¨éƒ½å¯ä»¥ä¸å¿…ä¿®æ”¹è€Œåœ¨æ–°åè®®è¿è¡Œã€‚è¿™å½“ç„¶æ˜¯å¥½äº‹ã€‚ èµ°å‘HTTP 2.0åœ¨æ­¤ï¼Œæœ‰å¿…è¦å›žé¡¾ä¸€ä¸‹ HTTP 2.0 å®£è¨€è‰ç¨¿ï¼Œå› ä¸ºè¿™ä»½å®£è¨€æ˜Žç¡®äº†è¯¥åè®®çš„èŒƒå›´å’Œå…³é”®è®¾è®¡è¦æ±‚ï¼š HTTP/2.0 åº”è¯¥æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š ç›¸å¯¹äºŽä½¿ç”¨ TCP çš„ HTTP 1.1ï¼Œç”¨æˆ·åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹çš„æ„ŸçŸ¥å»¶è¿Ÿè¦æœ‰å®žè´¨ä¸Šã€å¯åº¦é‡çš„æ”¹è¿›ï¼› è§£å†³ HTTP ä¸­çš„â€œé˜Ÿé¦–é˜»å¡žâ€é—®é¢˜ï¼› å¹¶è¡Œæ“ä½œæ— éœ€ä¸ŽæœåŠ¡å™¨å»ºç«‹å¤šä¸ªè¿žæŽ¥ï¼Œä»Žè€Œæ”¹è¿› TCP çš„åˆ©ç”¨çŽ‡ï¼Œç‰¹åˆ«æ˜¯æ‹¥å¡žæŽ§åˆ¶æ–¹é¢ï¼› ä¿æŒ HTTP 1.1 çš„è¯­ä¹‰ï¼Œåˆ©ç”¨çŽ°æœ‰æ–‡æ¡£ï¼ŒåŒ…æ‹¬ï¼ˆä½†ä¸é™äºŽï¼‰HTTP æ–¹æ³•ã€çŠ¶æ€ç ã€URIï¼Œä»¥åŠé¦–éƒ¨å­—æ®µï¼› æ˜Žç¡®è§„å®š HTTP 2.0 å¦‚ä½•ä¸Ž HTTP 1.x äº’æ“ä½œï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸­é—´ä»‹è´¨ä¸Šï¼› æ˜Žç¡®æŒ‡å‡ºæ‰€æœ‰æ–°çš„å¯æ‰©å±•æœºåˆ¶ä»¥åŠé€‚å½“çš„æ‰©å±•ç­–ç•¥ã€‚ ä¹‹æ‰€ä»¥è¦é€’å¢žä¸€ä¸ªå¤§ç‰ˆæœ¬åˆ° 2.0ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒæ”¹å˜äº†å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨ä¹‹é—´äº¤æ¢æ•°æ®çš„æ–¹å¼ã€‚ä¸ºå®žçŽ°å®ä¼Ÿçš„æ€§èƒ½æ”¹è¿›ç›®æ ‡ï¼ŒHTTP 2.0å¢žåŠ äº†æ–°çš„äºŒè¿›åˆ¶åˆ†å¸§æ•°æ®å±‚ï¼Œè€Œè¿™ä¸€å±‚å¹¶ä¸å…¼å®¹ä¹‹å‰çš„ HTTP 1.x æœåŠ¡å™¨åŠå®¢æˆ·ç«¯â€”â€”æ˜¯è°“ 2.0ã€‚ é™¤éžä½ åœ¨å®žçŽ° Web æœåŠ¡å™¨æˆ–è€…å®šåˆ¶å®¢æˆ·ç«¯ï¼Œéœ€è¦ä½¿ç”¨åŽŸå§‹çš„ TCP å¥—æŽ¥å­—ï¼Œå¦åˆ™ä½ å¾ˆå¯èƒ½æ³¨æ„ä¸åˆ° HTTP 2.0 æŠ€æœ¯é¢çš„å®žé™…å˜åŒ–ï¼šæ‰€æœ‰æ–°çš„ã€ä½Žçº§åˆ†å¸§æœºåˆ¶éƒ½æ˜¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¸ºä½ å¤„ç†çš„ã€‚æˆ–è®¸å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å¯é€‰çš„ APIå¤šäº†ä¸€äº›ï¼Œæ¯”å¦‚æœåŠ¡å™¨æŽ¨é€ï¼ è®¾è®¡å’ŒæŠ€æœ¯ç›®æ ‡ HTTP/2.0 é€šè¿‡æ”¯æŒé¦–éƒ¨å­—æ®µåŽ‹ç¼©å’Œåœ¨åŒä¸€è¿žæŽ¥ä¸Šå‘é€å¤šä¸ªå¹¶å‘æ¶ˆæ¯ï¼Œè®©åº”ç”¨æ›´æœ‰æ•ˆåœ°åˆ©ç”¨ç½‘ç»œèµ„æºï¼Œå‡å°‘æ„ŸçŸ¥çš„å»¶è¿Ÿæ—¶é—´ã€‚è€Œä¸”ï¼Œå®ƒè¿˜æ”¯æŒæœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„ä¸»åŠ¨æŽ¨é€æœºåˆ¶ã€‚â€”â€”HTTP/2.0ï¼ŒDraft 4 äºŒè¿›åˆ¶åˆ†å¸§å±‚HTTP 2.0 æ€§èƒ½å¢žå¼ºçš„æ ¸å¿ƒï¼Œå…¨åœ¨äºŽæ–°å¢žçš„äºŒè¿›åˆ¶åˆ†å¸§å±‚ï¼ˆå›¾ 12-1ï¼‰ï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•å°è£… HTTP æ¶ˆæ¯å¹¶åœ¨å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“ã€‚ è¿™é‡Œæ‰€è°“çš„â€œå±‚â€ï¼ŒæŒ‡çš„æ˜¯ä½äºŽå¥—æŽ¥å­—æŽ¥å£ä¸Žåº”ç”¨å¯è§çš„é«˜å±‚ HTTP API ä¹‹é—´çš„ä¸€ä¸ªæ–°æœºåˆ¶ï¼šHTTP çš„è¯­ä¹‰ï¼ŒåŒ…æ‹¬å„ç§åŠ¨è¯ã€æ–¹æ³•ã€é¦–éƒ¨ï¼Œéƒ½ä¸å—å½±å“ï¼Œä¸åŒçš„æ˜¯ä¼ è¾“æœŸé—´å¯¹å®ƒä»¬çš„ç¼–ç æ–¹å¼å˜äº†ã€‚HTTP 1.x ä»¥æ¢è¡Œç¬¦ä½œä¸ºçº¯æ–‡æœ¬çš„åˆ†éš”ç¬¦ï¼Œè€Œ HTTP2.0 å°†æ‰€æœ‰ä¼ è¾“çš„ä¿¡æ¯åˆ†å‰²ä¸ºæ›´å°çš„æ¶ˆæ¯å’Œå¸§ï¼Œå¹¶å¯¹å®ƒä»¬é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼çš„ç¼–ç ã€‚ æµã€æ¶ˆæ¯å’Œå¸§ æµå·²å»ºç«‹çš„è¿žæŽ¥ä¸Šçš„åŒå‘å­—èŠ‚æµã€‚ æ¶ˆæ¯ä¸Žé€»è¾‘æ¶ˆæ¯å¯¹åº”çš„å®Œæ•´çš„ä¸€ç³»åˆ—æ•°æ®å¸§ã€‚ å¸§HTTP 2.0 é€šä¿¡çš„æœ€å°å•ä½ï¼Œæ¯ä¸ªå¸§åŒ…å«å¸§é¦–éƒ¨ï¼Œè‡³å°‘ä¹Ÿä¼šæ ‡è¯†å‡ºå½“å‰å¸§æ‰€å±žçš„æµã€‚ æ‰€æœ‰ HTTP 2.0 é€šä¿¡éƒ½åœ¨ä¸€ä¸ªè¿žæŽ¥ä¸Šå®Œæˆï¼Œè¿™ä¸ªè¿žæŽ¥å¯ä»¥æ‰¿è½½ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµã€‚ç›¸åº”åœ°ï¼Œæ¯ä¸ªæ•°æ®æµä»¥æ¶ˆæ¯çš„å½¢å¼å‘é€ï¼Œè€Œæ¶ˆæ¯ç”±ä¸€æˆ–å¤šä¸ªå¸§ç»„æˆï¼Œè¿™äº›å¸§å¯ä»¥ä¹±åºå‘é€ï¼Œç„¶åŽå†æ ¹æ®æ¯ä¸ªå¸§é¦–éƒ¨çš„æµæ ‡è¯†ç¬¦é‡æ–°ç»„è£…ã€‚ HTTP 2.0 çš„æ‰€æœ‰å¸§éƒ½é‡‡ç”¨äºŒè¿›åˆ¶ç¼–ç ï¼Œæ‰€æœ‰é¦–éƒ¨æ•°æ®éƒ½ä¼šè¢«åŽ‹ç¼©ã€‚å› æ­¤ï¼Œå›¾ 12-2 åªæ˜¯è¯´æ˜Žäº†æ•°æ®æµã€æ¶ˆæ¯å’Œå¸§ä¹‹é—´çš„å…³ç³»ï¼Œè€Œéžå®ƒä»¬å®žé™…ä¼ è¾“æ—¶çš„ç¼–ç ç»“æžœã€‚ è¦ç†è§£ HTTP 2.0ï¼Œå°±å¿…é¡»ç†è§£æµã€æ¶ˆæ¯å’Œå¸§è¿™å‡ ä¸ªåŸºæœ¬æ¦‚å¿µã€‚ æ‰€æœ‰é€šä¿¡éƒ½åœ¨ä¸€ä¸ª TCP è¿žæŽ¥ä¸Šå®Œæˆã€‚ æµæ˜¯è¿žæŽ¥ä¸­çš„ä¸€ä¸ªè™šæ‹Ÿä¿¡é“ï¼Œå¯ä»¥æ‰¿è½½åŒå‘çš„æ¶ˆæ¯ï¼›æ¯ä¸ªæµéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°æ ‡è¯†ç¬¦ï¼ˆ1ã€2â€¦Nï¼‰ã€‚ æ¶ˆæ¯æ˜¯æŒ‡é€»è¾‘ä¸Šçš„ HTTP æ¶ˆæ¯ï¼Œæ¯”å¦‚è¯·æ±‚ã€å“åº”ç­‰ï¼Œç”±ä¸€æˆ–å¤šä¸ªå¸§ç»„æˆã€‚ å¸§æ˜¯æœ€å°çš„é€šä¿¡å•ä½ï¼Œæ‰¿è½½ç€ç‰¹å®šç±»åž‹çš„æ•°æ®ï¼Œå¦‚ HTTP é¦–éƒ¨ã€è´Ÿè·ï¼Œç­‰ç­‰ã€‚ ç®€è¨€ä¹‹ï¼ŒHTTP 2.0 æŠŠ HTTP åè®®é€šä¿¡çš„åŸºæœ¬å•ä½ç¼©å°ä¸ºä¸€ä¸ªä¸€ä¸ªçš„å¸§ï¼Œè¿™äº›å¸§å¯¹åº”ç€é€»è¾‘æµä¸­çš„æ¶ˆæ¯ã€‚ç›¸åº”åœ°ï¼Œå¾ˆå¤šæµå¯ä»¥å¹¶è¡Œåœ°åœ¨åŒä¸€ä¸ª TCP è¿žæŽ¥ä¸Šäº¤æ¢æ¶ˆæ¯ã€‚ å¤šå‘è¯·æ±‚ä¸Žå“åº”åœ¨ HTTP 1.x ä¸­ï¼Œå¦‚æžœå®¢æˆ·ç«¯æƒ³å‘é€å¤šä¸ªå¹¶è¡Œçš„è¯·æ±‚ä»¥åŠæ”¹è¿›æ€§èƒ½ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨å¤šä¸ª TCP è¿žæŽ¥ã€‚è¿™æ˜¯ HTTP 1.x äº¤ä»˜æ¨¡åž‹çš„ç›´æŽ¥ç»“æžœï¼Œè¯¥æ¨¡åž‹ä¼šä¿è¯æ¯ä¸ªè¿žæŽ¥æ¯æ¬¡åªäº¤ä»˜ä¸€ä¸ªå“åº”ï¼ˆå¤šä¸ªå“åº”å¿…é¡»æŽ’é˜Ÿï¼‰ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™ç§æ¨¡åž‹ä¹Ÿä¼šå¯¼è‡´é˜Ÿé¦–é˜»å¡žï¼Œä»Žè€Œé€ æˆåº•å±‚ TCP è¿žæŽ¥çš„æ•ˆçŽ‡ä½Žä¸‹ã€‚ HTTP 2.0 ä¸­æ–°çš„äºŒè¿›åˆ¶åˆ†å¸§å±‚çªç ´äº†è¿™äº›é™åˆ¶ï¼Œå®žçŽ°äº†å¤šå‘è¯·æ±‚å’Œå“åº”ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥æŠŠ HTTP æ¶ˆæ¯åˆ†è§£ä¸ºäº’ä¸ä¾èµ–çš„å¸§ï¼ˆå›¾ 12-3ï¼‰ï¼Œç„¶åŽä¹±åºå‘é€ï¼Œæœ€åŽå†åœ¨å¦ä¸€ç«¯æŠŠå®ƒä»¬é‡æ–°ç»„åˆèµ·æ¥ã€‚ å›¾ 12-3 ä¸­åŒ…å«äº†åŒä¸€ä¸ªè¿žæŽ¥ä¸Šå¤šä¸ªä¼ è¾“ä¸­çš„æ•°æ®æµï¼šå®¢æˆ·ç«¯æ­£åœ¨å‘æœåŠ¡å™¨ä¼ è¾“ä¸€ä¸ªDATA å¸§ï¼ˆstream 5ï¼‰ï¼Œä¸Žæ­¤åŒæ—¶ï¼ŒæœåŠ¡å™¨æ­£å‘å®¢æˆ·ç«¯ä¹±åºå‘é€ stream 1 å’Œ stream 3çš„ä¸€ç³»åˆ—å¸§ã€‚æ­¤æ—¶ï¼Œä¸€ä¸ªè¿žæŽ¥ä¸Šæœ‰ 3 ä¸ªè¯·æ±‚/å“åº”å¹¶è¡Œäº¤æ¢ï¼ æ€»ä¹‹ï¼ŒHTTP 2.0 çš„äºŒè¿›åˆ¶åˆ†å¸§æœºåˆ¶è§£å†³äº† HTTP 1.x ä¸­å­˜åœ¨çš„é˜Ÿé¦–é˜»å¡žé—®é¢˜ï¼Œä¹Ÿæ¶ˆé™¤äº†å¹¶è¡Œå¤„ç†å’Œå‘é€è¯·æ±‚åŠå“åº”æ—¶å¯¹å¤šä¸ªè¿žæŽ¥çš„ä¾èµ–ã€‚ æ”¯æŒå¤šå‘è¯·æ±‚ä¸Žå“åº”ï¼Œå¯ä»¥çœæŽ‰é’ˆå¯¹ HTTP 1.x é™åˆ¶æ‰€è´¹çš„é‚£äº›è„‘ç­‹å’Œå·¥ä½œï¼Œæ¯”å¦‚æ‹¼æŽ¥æ–‡ä»¶ã€å›¾ç‰‡ç²¾çµã€åŸŸååˆ†åŒºã€‚ç±»ä¼¼åœ°ï¼Œé€šè¿‡å‡å°‘ TCP è¿žæŽ¥çš„æ•°é‡ï¼ŒHTTP 2.0 ä¹Ÿä¼šå‡å°‘å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„ CPU åŠå†…å­˜å ç”¨ã€‚ è¯·æ±‚ä¼˜å…ˆçº§æŠŠ HTTP æ¶ˆæ¯åˆ†è§£ä¸ºå¾ˆå¤šç‹¬ç«‹çš„å¸§ä¹‹åŽï¼Œå°±å¯ä»¥é€šè¿‡ä¼˜åŒ–è¿™äº›å¸§çš„äº¤é”™å’Œä¼ è¾“é¡ºåºï¼Œè¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ¯ä¸ªæµéƒ½å¯ä»¥å¸¦æœ‰ä¸€ä¸ª 31 æ¯”ç‰¹çš„ä¼˜å…ˆå€¼ï¼š 0 è¡¨ç¤ºæœ€é«˜ä¼˜å…ˆçº§ï¼› 2^31 -1 è¡¨ç¤ºæœ€ä½Žä¼˜å…ˆçº§ã€‚ æœ‰äº†è¿™ä¸ªä¼˜å…ˆå€¼ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å°±å¯ä»¥åœ¨å¤„ç†ä¸åŒçš„æµæ—¶é‡‡å–ä¸åŒçš„ç­–ç•¥ï¼Œä»¥æœ€ä¼˜çš„æ–¹å¼å‘é€æµã€æ¶ˆæ¯å’Œå¸§ã€‚å…·ä½“æ¥è®²ï¼ŒæœåŠ¡å™¨å¯ä»¥æ ¹æ®æµçš„ä¼˜å…ˆçº§ï¼ŒæŽ§åˆ¶èµ„æºåˆ†é…ï¼ˆCPUã€å†…å­˜ã€å¸¦å®½ï¼‰ï¼Œè€Œåœ¨å“åº”æ•°æ®å‡†å¤‡å¥½ä¹‹åŽï¼Œä¼˜å…ˆå°†æœ€é«˜ä¼˜å…ˆçº§çš„å¸§å‘é€ç»™å®¢æˆ·ç«¯ã€‚ æµè§ˆå™¨è¯·æ±‚ä¼˜å…ˆçº§ä¸Ž HTTP 2.0æµè§ˆå™¨åœ¨æ¸²æŸ“é¡µé¢æ—¶ï¼Œå¹¶éžæ‰€æœ‰èµ„æºéƒ½å…·æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ï¼šHTML æ–‡æ¡£æœ¬èº«å¯¹æž„å»º DOM ä¸å¯æˆ–ç¼ºï¼ŒCSS å¯¹æž„å»º CSSOM ä¸å¯æˆ–ç¼ºï¼Œè€Œ DOM å’Œ CSSOM çš„æž„å»ºéƒ½å¯èƒ½å—åˆ° JavaScript èµ„æºçš„é˜»å¡žï¼Œå…¶ä»–èµ„æºï¼ˆå¦‚å›¾ç‰‡ï¼‰çš„ä¼˜å…ˆçº§éƒ½å¯ä»¥é™ä½Žã€‚ä¸ºåŠ å¿«é¡µé¢åŠ è½½é€Ÿåº¦ï¼Œæ‰€æœ‰çŽ°ä»£æµè§ˆå™¨éƒ½ä¼šåŸºäºŽèµ„æºçš„ç±»åž‹ä»¥åŠå®ƒåœ¨é¡µé¢ä¸­çš„ä½ç½®æŽ’å®šè¯·æ±‚çš„ä¼˜å…ˆæ¬¡åºï¼Œç”šè‡³é€šè¿‡ä¹‹å‰çš„è®¿é—®æ¥å­¦ä¹ ä¼˜å…ˆçº§æ¨¡å¼â€”â€”æ¯”å¦‚ï¼Œä¹‹å‰çš„æ¸²æŸ“å¦‚æžœè¢«æŸäº›èµ„æºé˜»å¡žäº†ï¼Œé‚£ä¹ˆåŒæ ·çš„èµ„æºåœ¨ä¸‹ä¸€æ¬¡è®¿é—®æ—¶å¯èƒ½å°±ä¼šè¢«èµ‹äºˆæ›´é«˜çš„ä¼˜å…ˆçº§ã€‚åœ¨ HTTP 1.x ä¸­ï¼Œæµè§ˆå™¨æžå°‘èƒ½åˆ©ç”¨ä¸Šè¿°ä¼˜å…ˆçº§ä¿¡æ¯ï¼Œå› ä¸ºåè®®æœ¬èº«å¹¶ä¸æ”¯æŒå¤šè·¯å¤ç”¨ï¼Œä¹Ÿæ²¡æœ‰åŠžæ³•å‘æœåŠ¡å™¨é€šå‘Šè¯·æ±‚çš„ä¼˜å…ˆçº§ã€‚æ­¤æ—¶ï¼Œæµè§ˆå™¨åªèƒ½ä¾èµ–å¹¶è¡Œè¿žæŽ¥ï¼Œä¸”æœ€å¤šåªèƒ½åŒæ—¶å‘ä¸€ä¸ªåŸŸåå‘é€ 6 ä¸ªè¯·æ±‚ã€‚äºŽæ˜¯ï¼Œåœ¨ç­‰è¿žæŽ¥å¯ç”¨æœŸé—´ï¼Œè¯·æ±‚åªèƒ½åœ¨å®¢æˆ·ç«¯æŽ’é˜Ÿï¼Œä»Žè€Œå¢žåŠ äº†ä¸å¿…è¦çš„ç½‘ç»œå»¶è¿Ÿã€‚ç†è®ºä¸Šï¼ŒHTTP ç®¡é“å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªæ˜¯ç”±äºŽç¼ºä¹æ”¯æŒè€Œæ— æ³•ä»˜è¯¸å®žè·µã€‚HTTP 2.0 ä¸€ä¸¾è§£å†³äº†æ‰€æœ‰è¿™äº›ä½Žæ•ˆçš„é—®é¢˜ï¼šæµè§ˆå™¨å¯ä»¥åœ¨å‘çŽ°èµ„æºæ—¶ç«‹å³åˆ†æ´¾è¯·æ±‚ï¼ŒæŒ‡å®šæ¯ä¸ªæµçš„ä¼˜å…ˆçº§ï¼Œè®©æœåŠ¡å™¨å†³å®šæœ€ä¼˜çš„å“åº”æ¬¡åºã€‚è¿™æ ·è¯·æ±‚å°±ä¸å¿…æŽ’é˜Ÿäº†ï¼Œæ—¢èŠ‚çœäº†æ—¶é—´ï¼Œä¹Ÿæœ€å¤§é™åº¦åœ°åˆ©ç”¨äº†æ¯ä¸ªè¿žæŽ¥ã€‚ HTTP 2.0 æ²¡æœ‰è§„å®šå¤„ç†ä¼˜å…ˆçº§çš„å…·ä½“ç®—æ³•ï¼Œåªæ˜¯æä¾›äº†ä¸€ç§èµ‹äºˆæ•°æ®ä¼˜å…ˆçº§çš„æœºåˆ¶ï¼Œè€Œä¸”è¦æ±‚å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨å¿…é¡»èƒ½å¤Ÿäº¤æ¢è¿™äº›æ•°æ®ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¼˜å…ˆå€¼ä½œä¸ºæç¤ºä¿¡æ¯ï¼Œå¯¹åº”çš„æ¬¡åºæŽ’å®šç­–ç•¥å¯èƒ½å› å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨çš„å®žçŽ°è€Œä¸åŒï¼šå®¢æˆ·ç«¯åº”è¯¥æ˜Žç¡®æŒ‡å®šä¼˜å…ˆå€¼ï¼ŒæœåŠ¡å™¨åº”è¯¥æ ¹æ®è¯¥å€¼å¤„ç†å’Œäº¤ä»˜æ•°æ®ã€‚ åœ¨è¿™ä¸ªè§„å®šä¹‹ä¸‹ï¼Œå°½ç®¡ä½ å¯èƒ½æ— æ³•æŽ§åˆ¶å®¢æˆ·ç«¯å‘é€çš„ä¼˜å…ˆå€¼ï¼Œä½†æˆ–è®¸ä½ å¯ä»¥æŽ§åˆ¶æœåŠ¡å™¨ã€‚å› æ­¤ï¼Œåœ¨é€‰æ‹© HTTP 2.0 æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥å¤šç•™ç‚¹å¿ƒï¼ä¸ºè¯´æ˜Žè¿™ä¸€ç‚¹ï¼Œè€ƒè™‘ä¸‹é¢å‡ ä¸ªé—®é¢˜ã€‚ å¦‚æžœæœåŠ¡å™¨å¯¹æ‰€æœ‰ä¼˜å…ˆå€¼è§†è€Œä¸è§æ€Žä¹ˆåŠžï¼Ÿ é«˜ä¼˜å…ˆå€¼çš„æµä¸€å®šä¼˜å…ˆå¤„ç†å—ï¼Ÿ æ˜¯å¦å­˜åœ¨ä¸åŒä¼˜å…ˆçº§çš„æµåº”è¯¥äº¤é”™çš„æƒ…å†µï¼Ÿå¦‚æžœæœåŠ¡å™¨ä¸ç†ç¬æ‰€æœ‰ä¼˜å…ˆå€¼ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´åº”ç”¨å“åº”å˜æ…¢ï¼šæµè§ˆå™¨æ˜Žæ˜Žåœ¨ç­‰å…³é”®çš„ CSS å’Œ JavaScriptï¼ŒæœåŠ¡å™¨å´åœ¨å‘é€å›¾ç‰‡ï¼Œä»Žè€Œé€ æˆæ¸²æŸ“é˜»å¡žã€‚ä¸è¿‡ï¼Œè§„å®šä¸¥æ ¼çš„ä¼˜å…ˆçº§æ¬¡åºä¹Ÿå¯èƒ½å¸¦æ¥æ¬¡ä¼˜çš„ç»“æžœï¼Œå› ä¸ºè¿™å¯èƒ½åˆä¼šå¼•å…¥é˜Ÿé¦–é˜»å¡žé—®é¢˜ï¼Œå³æŸä¸ªé«˜ä¼˜å…ˆçº§çš„æ…¢è¯·æ±‚ä¼šä¸å¿…è¦åœ°é˜»å¡žå…¶ä»–èµ„æºçš„äº¤ä»˜ã€‚ æœåŠ¡å™¨å¯ä»¥è€Œä¸”åº”è¯¥äº¤é”™å‘é€ä¸åŒä¼˜å…ˆçº§åˆ«çš„å¸§ã€‚åªè¦å¯èƒ½ï¼Œé«˜ä¼˜å…ˆçº§æµéƒ½åº”è¯¥ä¼˜å…ˆï¼ŒåŒ…æ‹¬åˆ†é…å¤„ç†èµ„æºå’Œå®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨é—´çš„å¸¦å®½ã€‚ä¸è¿‡ï¼Œä¸ºäº†æœ€é«˜æ•ˆåœ°åˆ©ç”¨åº•å±‚è¿žæŽ¥ï¼Œä¸åŒä¼˜å…ˆçº§çš„æ··åˆä¹Ÿæ˜¯å¿…éœ€çš„ã€‚ æ¯ä¸ªæ¥æºä¸€ä¸ªè¿žæŽ¥æœ‰äº†æ–°çš„åˆ†å¸§æœºåˆ¶åŽï¼ŒHTTP 2.0 ä¸å†ä¾èµ–å¤šä¸ª TCP è¿žæŽ¥åŽ»å®žçŽ°å¤šæµå¹¶è¡Œäº†ã€‚çŽ°åœ¨ï¼Œæ¯ä¸ªæ•°æ®æµéƒ½æ‹†åˆ†æˆå¾ˆå¤šå¸§ï¼Œè€Œè¿™äº›å¸§å¯ä»¥äº¤é”™ï¼Œè¿˜å¯ä»¥åˆ†åˆ«ä¼˜å…ˆçº§ã€‚äºŽæ˜¯ï¼Œæ‰€æœ‰HTTP 2.0 è¿žæŽ¥éƒ½æ˜¯æŒä¹…åŒ–çš„ï¼Œè€Œä¸”å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨ä¹‹é—´ä¹Ÿåªéœ€è¦ä¸€ä¸ªè¿žæŽ¥å³å¯ã€‚ å®žéªŒè¡¨æ˜Žï¼Œå®¢æˆ·ç«¯ä½¿ç”¨æ›´å°‘çš„è¿žæŽ¥è‚¯å®šå¯ä»¥é™ä½Žå»¶è¿Ÿæ—¶é—´ã€‚HTTP 2.0 å‘é€çš„æ€»åˆ†ç»„æ•°é‡æ¯” HTTP å·®ä¸å¤šè¦å°‘ 40%ã€‚è€ŒæœåŠ¡å™¨å¤„ç†å¤§é‡å¹¶å‘è¿žæŽ¥çš„æƒ…å†µä¹Ÿå˜æˆäº†å¯ä¼¸ç¼©æ€§é—®é¢˜ï¼Œå› ä¸º HTTP 2.0 å‡è½»äº†è¿™ä¸ªè´Ÿæ‹…ã€‚â€”â€”HTTP/2.0 Draft 2 æ¯ä¸ªæ¥æºä¸€ä¸ªè¿žæŽ¥æ˜¾è‘—å‡å°‘äº†ç›¸å…³çš„èµ„æºå ç”¨ï¼šè¿žæŽ¥è·¯å¾„ä¸Šçš„å¥—æŽ¥å­—ç®¡ç†å·¥ä½œé‡å°‘äº†ï¼Œå†…å­˜å ç”¨å°‘äº†ï¼Œè¿žæŽ¥åžåé‡å¤§äº†ã€‚æ­¤å¤–ï¼Œä»Žä¸Šåˆ°ä¸‹æ‰€æœ‰å±‚é¢ä¸Šä¹Ÿéƒ½èŽ·å¾—äº†ç›¸åº”çš„å¥½å¤„ï¼š æ‰€æœ‰æ•°æ®æµçš„ä¼˜å…ˆæ¬¡åºå§‹ç»ˆå¦‚ä¸€ï¼› åŽ‹ç¼©ä¸Šä¸‹æ–‡å•ä¸€ä½¿å¾—åŽ‹ç¼©æ•ˆæžœæ›´å¥½ï¼› ç”±äºŽ TCP è¿žæŽ¥å‡å°‘è€Œä½¿ç½‘ç»œæ‹¥å¡žçŠ¶å†µå¾—ä»¥æ”¹è§‚ï¼› æ…¢å¯åŠ¨æ—¶é—´å‡å°‘ï¼Œæ‹¥å¡žå’Œä¸¢åŒ…æ¢å¤é€Ÿåº¦æ›´å¿«ã€‚ å¤§å¤šæ•° HTTP è¿žæŽ¥çš„æ—¶é—´éƒ½å¾ˆçŸ­ï¼Œè€Œä¸”æ˜¯çªå‘æ€§çš„ï¼Œä½† TCP åªåœ¨é•¿æ—¶é—´è¿žæŽ¥ä¼ è¾“å¤§å—æ•°æ®æ—¶æ•ˆçŽ‡æ‰æœ€é«˜ã€‚HTTP 2.0 é€šè¿‡è®©æ‰€æœ‰æ•°æ®æµå…±ç”¨åŒä¸€ä¸ªè¿žæŽ¥ï¼Œå¯ä»¥æ›´æœ‰æ•ˆåœ°ä½¿ç”¨ TCP è¿žæŽ¥ã€‚ ä¸¢åŒ…ã€é«˜ RTT è¿žæŽ¥å’Œ HTTP 2.0 æ€§èƒ½ç­‰ä¸€ç­‰ï¼Œæˆ‘å¬ä½ è¯´äº†ä¸€å¤§å †æ¯ä¸ªæ¥æºä¸€ä¸ª TCP è¿žæŽ¥çš„å¥½å¤„ï¼Œéš¾é“å®ƒå°±ä¸€ç‚¹åå¤„éƒ½æ²¡æœ‰å—ï¼Ÿæœ‰ï¼Œå½“ç„¶æœ‰ã€‚ï¼› è™½ç„¶æ¶ˆé™¤äº† HTTP é˜Ÿé¦–é˜»å¡žçŽ°è±¡ï¼Œä½† TCP å±‚æ¬¡ä¸Šä»ç„¶å­˜åœ¨é˜Ÿé¦–é˜»å¡ž; å¦‚æžœ TCP çª—å£ç¼©æ”¾è¢«ç¦ç”¨ï¼Œé‚£å¸¦å®½å»¶è¿Ÿç§¯æ•ˆåº”å¯èƒ½ä¼šé™åˆ¶è¿žæŽ¥çš„åžåé‡ï¼› ä¸¢åŒ…æ—¶ï¼ŒTCP æ‹¥å¡žçª—å£ä¼šç¼©å°ã€‚ ä¸Šè¿°æ¯ä¸€ç‚¹éƒ½å¯èƒ½å¯¹ HTTP 2.0 è¿žæŽ¥çš„åžåé‡å’Œå»¶è¿Ÿæ€§èƒ½é€ æˆä¸åˆ©å½±å“ã€‚ç„¶è€Œï¼Œé™¤äº†è¿™äº›å±€é™æ€§ä¹‹å¤–ï¼Œå®žéªŒè¡¨æ˜Žä¸€ä¸ª TCP è¿žæŽ¥ä»ç„¶æ˜¯ HTTP 2.0 åŸºç¡€ä¸Šçš„æœ€ä½³éƒ¨ç½²ç­–ç•¥ã€‚ æ€»ä¹‹ï¼Œä¸€å®šè¦çŸ¥é“ HTTP 2.0 ä¸Žä¹‹å‰çš„ç‰ˆæœ¬ä¸€æ ·ï¼Œå¹¶ä¸å¼ºåˆ¶ä½¿ç”¨ TCPã€‚UDP ç­‰å…¶ä»–ä¼ è¾“åè®®ä¹Ÿå¹¶éžä¸å¯ä»¥ã€‚ æµé‡æŽ§åˆ¶åœ¨åŒä¸€ä¸ª TCP è¿žæŽ¥ä¸Šä¼ è¾“å¤šä¸ªæ•°æ®æµï¼Œå°±æ„å‘³ç€è¦å…±äº«å¸¦å®½ã€‚æ ‡å®šæ•°æ®æµçš„ä¼˜å…ˆçº§æœ‰åŠ©äºŽæŒ‰åºäº¤ä»˜ï¼Œä½†åªæœ‰ä¼˜å…ˆçº§è¿˜ä¸è¶³ä»¥ç¡®å®šå¤šä¸ªæ•°æ®æµæˆ–å¤šä¸ªè¿žæŽ¥é—´çš„èµ„æºåˆ†é…ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHTTP 2.0 ä¸ºæ•°æ®æµå’Œè¿žæŽ¥çš„æµé‡æŽ§åˆ¶æä¾›äº†ä¸€ä¸ªç®€å•çš„æœºåˆ¶ï¼š æµé‡æŽ§åˆ¶åŸºäºŽæ¯ä¸€è·³è¿›è¡Œï¼Œè€Œéžç«¯åˆ°ç«¯çš„æŽ§åˆ¶ï¼› æµé‡æŽ§åˆ¶åŸºäºŽçª—å£æ›´æ–°å¸§è¿›è¡Œï¼Œå³æŽ¥æ”¶æ–¹å¹¿æ’­è‡ªå·±å‡†å¤‡æŽ¥æ”¶æŸä¸ªæ•°æ®æµçš„å¤šå°‘å­—èŠ‚ï¼Œä»¥åŠå¯¹æ•´ä¸ªè¿žæŽ¥è¦æŽ¥æ”¶å¤šå°‘å­—èŠ‚ï¼› æµé‡æŽ§åˆ¶çª—å£å¤§å°é€šè¿‡WINDOW_UPDATE å¸§æ›´æ–°ï¼Œè¿™ä¸ªå­—æ®µæŒ‡å®šäº†æµ ID å’Œçª—å£å¤§å°é€’å¢žå€¼ï¼› æµé‡æŽ§åˆ¶æœ‰æ–¹å‘æ€§ï¼Œå³æŽ¥æ”¶æ–¹å¯èƒ½æ ¹æ®è‡ªå·±çš„æƒ…å†µä¸ºæ¯ä¸ªæµä¹ƒè‡³æ•´ä¸ªè¿žæŽ¥è®¾ç½®ä»»æ„çª—å£å¤§å°ï¼› æµé‡æŽ§åˆ¶å¯ä»¥ç”±æŽ¥æ”¶æ–¹ç¦ç”¨ï¼ŒåŒ…æ‹¬é’ˆå¯¹ä¸ªåˆ«çš„æµå’Œé’ˆå¯¹æ•´ä¸ªè¿žæŽ¥ã€‚ HTTP 2.0 è¿žæŽ¥å»ºç«‹ä¹‹åŽï¼Œå®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨äº¤æ¢ SETTINGS å¸§ï¼Œç›®çš„æ˜¯è®¾ç½®åŒå‘çš„æµé‡æŽ§åˆ¶çª—å£å¤§å°ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä»»ä½•ä¸€ç«¯éƒ½å¯ä»¥é€‰æ‹©ç¦ç”¨ä¸ªåˆ«æµæˆ–æ•´ä¸ªè¿žæŽ¥çš„æµé‡æŽ§åˆ¶ã€‚ ä¼˜å…ˆçº§å¯ä»¥å†³å®šäº¤ä»˜æ¬¡åºï¼Œè€Œæµé‡æŽ§åˆ¶åˆ™å¯ä»¥æŽ§åˆ¶ HTTP 2.0 è¿žæŽ¥ä¸­æ¯ä¸ªæµå ç”¨çš„èµ„æºï¼šæŽ¥æ”¶æ–¹å¯ä»¥é’ˆå¯¹ç‰¹å®šçš„æµå¹¿æ’­è¾ƒä½Žçš„çª—å£å¤§å°ï¼Œä»¥é™åˆ¶å®ƒçš„ä¼ è¾“é€Ÿåº¦ã€‚ æœåŠ¡å™¨æŽ¨é€HTTP 2.0 æ–°å¢žçš„ä¸€ä¸ªå¼ºå¤§çš„æ–°åŠŸèƒ½ï¼Œå°±æ˜¯æœåŠ¡å™¨å¯ä»¥å¯¹ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚å‘é€å¤šä¸ªå“åº”ã€‚æ¢å¥è¯è¯´ï¼Œé™¤äº†å¯¹æœ€åˆè¯·æ±‚çš„å“åº”å¤–ï¼ŒæœåŠ¡å™¨è¿˜å¯ä»¥é¢å¤–å‘å®¢æˆ·ç«¯æŽ¨é€èµ„æºï¼Œè€Œæ— éœ€å®¢æˆ·ç«¯æ˜Žç¡®åœ°è¯·æ±‚ã€‚ å»ºç«‹ HTTP 2.0 è¿žæŽ¥åŽï¼Œå®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨äº¤æ¢ SETTINGS å¸§ï¼Œå€Ÿæ­¤å¯ä»¥é™å®šåŒå‘å¹¶å‘çš„æµçš„æœ€å¤§æ•°é‡ã€‚å› æ­¤ï¼Œå®¢æˆ·ç«¯å¯ä»¥é™å®šæŽ¨é€æµçš„æ•°é‡ï¼Œæˆ–è€…é€šè¿‡æŠŠè¿™ä¸ªå€¼è®¾ç½®ä¸º 0 è€Œå®Œå…¨ç¦ç”¨æœåŠ¡å™¨æŽ¨é€ã€‚ ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·ä¸€ä¸ªæœºåˆ¶å‘¢ï¼Ÿé€šå¸¸çš„ Web åº”ç”¨éƒ½ç”±å‡ åä¸ªèµ„æºç»„æˆï¼Œå®¢æˆ·ç«¯éœ€è¦åˆ†æžæœåŠ¡å™¨æä¾›çš„æ–‡æ¡£æ‰èƒ½é€ä¸ªæ‰¾åˆ°å®ƒä»¬ã€‚é‚£ä¸ºä»€ä¹ˆä¸è®©æœåŠ¡å™¨æå‰å°±æŠŠè¿™äº›èµ„æºæŽ¨é€ç»™å®¢æˆ·ç«¯ï¼Œä»Žè€Œå‡å°‘é¢å¤–çš„æ—¶é—´å»¶è¿Ÿå‘¢ï¼ŸæœåŠ¡å™¨å·²ç»çŸ¥é“å®¢æˆ·ç«¯ä¸‹ä¸€æ­¥è¦è¯·æ±‚ä»€ä¹ˆèµ„æºäº†ï¼Œè¿™æ—¶å€™æœåŠ¡å™¨æŽ¨é€å³å¯æ´¾ä¸Šç”¨åœºã€‚äº‹å®žä¸Šï¼Œå¦‚æžœä½ åœ¨ç½‘é¡µé‡ŒåµŒå…¥è¿‡ CSSã€JavaScriptï¼Œæˆ–è€…é€šè¿‡æ•°æ® URI åµŒå…¥è¿‡å…¶ä»–èµ„æºï¼Œé‚£ä½ å°±å·²ç»äº²èº«ä½“éªŒè¿‡æœåŠ¡å™¨æŽ¨é€äº†ã€‚ æ‰€æœ‰æŽ¨é€çš„èµ„æºéƒ½éµå®ˆåŒæºç­–ç•¥ã€‚æ¢å¥è¯è¯´ï¼ŒæœåŠ¡å™¨ä¸èƒ½éšä¾¿å°†ç¬¬ä¸‰æ–¹èµ„æºæŽ¨é€ç»™å®¢æˆ·ç«¯ï¼Œè€Œå¿…é¡»æ˜¯ç»è¿‡åŒæ–¹ç¡®è®¤æ‰è¡Œã€‚ é¦–éƒ¨åŽ‹ç¼©HTTP çš„æ¯ä¸€æ¬¡é€šä¿¡éƒ½ä¼šæºå¸¦ä¸€ç»„é¦–éƒ¨ï¼Œç”¨äºŽæè¿°ä¼ è¾“çš„èµ„æºåŠå…¶å±žæ€§ã€‚åœ¨ HTTP 1.x ä¸­ï¼Œè¿™äº›å…ƒæ•°æ®éƒ½æ˜¯ä»¥çº¯æ–‡æœ¬å½¢å¼å‘é€çš„ï¼Œé€šå¸¸ä¼šç»™æ¯ä¸ªè¯·æ±‚å¢žåŠ  500~800 å­—èŠ‚çš„è´Ÿè·ã€‚å¦‚æžœç®—ä¸Š HTTP cookieï¼Œå¢žåŠ çš„è´Ÿè·é€šå¸¸ä¼šè¾¾åˆ°ä¸Šåƒå­—èŠ‚ã€‚ä¸ºå‡å°‘è¿™äº›å¼€é”€å¹¶æå‡æ€§èƒ½ï¼ŒHTTP 2.0 ä¼šåŽ‹ç¼©é¦–éƒ¨å…ƒæ•°æ®ï¼š HTTP 2.0 åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨â€œé¦–éƒ¨è¡¨â€æ¥è·Ÿè¸ªå’Œå­˜å‚¨ä¹‹å‰å‘é€çš„é”®ï¼å€¼å¯¹ï¼Œå¯¹äºŽç›¸åŒçš„æ•°æ®ï¼Œä¸å†é€šè¿‡æ¯æ¬¡è¯·æ±‚å’Œå“åº”å‘é€ï¼› é¦–éƒ¨è¡¨åœ¨HTTP 2.0çš„è¿žæŽ¥å­˜ç»­æœŸå†…å§‹ç»ˆå­˜åœ¨ï¼Œç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…±åŒæ¸è¿›åœ°æ›´æ–°; æ¯ä¸ªæ–°çš„é¦–éƒ¨é”®ï¼å€¼å¯¹è¦ä¹ˆè¢«è¿½åŠ åˆ°å½“å‰è¡¨çš„æœ«å°¾ï¼Œè¦ä¹ˆæ›¿æ¢è¡¨ä¸­ä¹‹å‰çš„å€¼ã€‚ äºŽæ˜¯ï¼ŒHTTP 2.0 è¿žæŽ¥çš„ä¸¤ç«¯éƒ½çŸ¥é“å·²ç»å‘é€äº†å“ªäº›é¦–éƒ¨ï¼Œè¿™äº›é¦–éƒ¨çš„å€¼æ˜¯ä»€ä¹ˆï¼Œä»Žè€Œå¯ä»¥é’ˆå¯¹ä¹‹å‰çš„æ•°æ®åªç¼–ç å‘é€å·®å¼‚æ•°æ®ï¼ˆå›¾ 12-5ï¼‰ã€‚ è¯·æ±‚ä¸Žå“åº”é¦–éƒ¨çš„å®šä¹‰åœ¨ HTTP 2.0 ä¸­åŸºæœ¬æ²¡æœ‰æ”¹å˜ï¼Œåªæ˜¯æ‰€æœ‰é¦–éƒ¨é”®å¿…é¡»å…¨éƒ¨å°å†™ï¼Œè€Œä¸”è¯·æ±‚è¡Œè¦ç‹¬ç«‹ä¸º :method ã€ :scheme ã€ :host å’Œ :path è¿™äº›é”®ï¼å€¼å¯¹ã€‚ åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œç¬¬äºŒä¸ªè¯·æ±‚åªéœ€è¦å‘é€å˜åŒ–äº†çš„è·¯å¾„é¦–éƒ¨ï¼ˆ:pathï¼‰ï¼Œå…¶ä»–é¦–éƒ¨æ²¡æœ‰å˜åŒ–ï¼Œä¸ç”¨å†å‘é€äº†ã€‚è¿™æ ·å°±å¯ä»¥é¿å…ä¼ è¾“å†—ä½™çš„é¦–éƒ¨ï¼Œä»Žè€Œæ˜¾è‘—å‡å°‘æ¯ä¸ªè¯·æ±‚çš„å¼€é”€ã€‚é€šä¿¡æœŸé—´å‡ ä¹Žä¸ä¼šæ”¹å˜çš„é€šç”¨é”®ï¼å€¼å¯¹ï¼ˆç”¨æˆ·ä»£ç†ã€å¯æŽ¥å—çš„åª’ä½“ç±»åž‹ï¼Œç­‰ç­‰ï¼‰åªéœ€å‘é€ä¸€æ¬¡ã€‚äº‹å®žä¸Šï¼Œå¦‚æžœè¯·æ±‚ä¸­ä¸åŒ…å«é¦–éƒ¨ï¼ˆä¾‹å¦‚å¯¹åŒä¸€èµ„æºçš„è½®è¯¢è¯·æ±‚ï¼‰ï¼Œé‚£ä¹ˆé¦–éƒ¨å¼€é”€å°±æ˜¯é›¶å­—èŠ‚ã€‚æ­¤æ—¶æ‰€æœ‰é¦–éƒ¨éƒ½è‡ªåŠ¨ä½¿ç”¨ä¹‹å‰è¯·æ±‚å‘é€çš„é¦–éƒ¨ï¼ æœ‰æ•ˆçš„HTTP 2.0å‡çº§ä¸Žå‘çŽ°é€šè¿‡å¸¸è§„éžåŠ å¯†ä¿¡é“å»ºç«‹ HTTP 2.0 è¿žæŽ¥éœ€è¦å¤šåšä¸€ç‚¹å·¥ä½œã€‚å› ä¸º HTTP 1.0 å’ŒHTTP 2.0 éƒ½ä½¿ç”¨åŒä¸€ä¸ªç«¯å£ï¼ˆ80ï¼‰ï¼Œåˆæ²¡æœ‰æœåŠ¡å™¨æ˜¯å¦æ”¯æŒ HTTP 2.0 çš„å…¶ä»–ä»»ä½•ä¿¡æ¯ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯åªèƒ½ä½¿ç”¨ HTTP Upgrade æœºåˆ¶é€šè¿‡åè°ƒç¡®å®šé€‚å½“çš„åè®®ï¼š 1234567891011121314GET /page HTTP/1.1Host: server.example.comConnection: Upgrade, HTTP2-SettingsUpgrade: HTTP/2.0 âžŠHTTP2-Settings: (SETTINGS payload) âž‹HTTP/1.1 200 OK âžŒContent-length: 243Content-type: text/html(... HTTP 1.1 response ...)(or)HTTP/1.1 101 Switching Protocols âžConnection: UpgradeUpgrade: HTTP/2.0(... HTTP 2.0 response ...) âžŠ å‘èµ·å¸¦æœ‰ HTTP 2.0 Upgrade é¦–éƒ¨çš„ HTTP 1.1 è¯·æ±‚âž‹ HTTP/2.0 SETTINGS å‡€è·çš„ Base64 URL ç¼–ç âžŒ æœåŠ¡å™¨æ‹’ç»å‡çº§ï¼Œé€šè¿‡ HTTP 1.1 è¿”å›žå“åº”âž æœåŠ¡å™¨æŽ¥å— HTTP 2.0 å‡çº§ï¼Œåˆ‡æ¢åˆ°æ–°åˆ†å¸§ ä½¿ç”¨è¿™ç§ Upgrade æµï¼Œå¦‚æžœæœåŠ¡å™¨ä¸æ”¯æŒ HTTP 2.0ï¼Œå°±ç«‹å³è¿”å›ž HTTP 1.1 å“åº”ã€‚å¦åˆ™ï¼ŒæœåŠ¡å™¨å°±ä¼šä»¥ HTTP 1.1 æ ¼å¼è¿”å›ž 101 Switching Protocols å“åº”ï¼Œç„¶åŽç«‹å³åˆ‡æ¢åˆ° HTTP 2.0 å¹¶ä½¿ç”¨æ–°çš„äºŒè¿›åˆ¶åˆ†å¸§åè®®è¿”å›žå“åº”ã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œéƒ½ä¸éœ€è¦é¢å¤–å¾€è¿”ã€‚ ä¸ºç¡®å®šæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½æœ‰æ„ä½¿ç”¨ HTTP 2.0 å¯¹è¯ï¼ŒåŒæ–¹è¿˜å¿…é¡»å‘é€â€œè¿žæŽ¥é¦–éƒ¨â€ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸²æ ‡å‡†çš„å­—èŠ‚ã€‚è¿™ç§ä¿¡æ¯äº¤æ¢æœ¬è´¨ä¸Šæ˜¯ä¸€ç§â€œå°½æ—©å¤±è´¥â€ï¼ˆfail-fastï¼‰çš„æœºåˆ¶ï¼Œå¯ä»¥é¿å…å®¢æˆ·ç«¯ã€æœåŠ¡å™¨ï¼Œä»¥åŠä¸­é—´è®¾å¤‡å¶å°”æŽ¥å—è¯·æ±‚çš„å‡çº§å´ä¸ç†è§£æ–°åè®®ã€‚è€Œä¸”ï¼Œè¿™ç§ä¿¡æ¯äº¤æ¢ä¹Ÿä¸ä¼šå¸¦æ¥é¢å¤–çš„å¾€è¿”ï¼Œåªæ˜¯åœ¨è¿žæŽ¥å¼€å§‹æ—¶è¦å¤šä¼ ä¸€äº›å­—èŠ‚ã€‚ æœ€åŽï¼Œå¦‚æžœå®¢æˆ·ç«¯å› ä¸ºè‡ªå·±ä¿å­˜æœ‰æˆ–é€šè¿‡å…¶ä»–æ‰‹æ®µï¼ˆå¦‚ DNS è®°å½•ã€æ‰‹å·¥é…ç½®ç­‰ï¼‰èŽ·å¾—äº†å…³äºŽ HTTP 2.0 çš„æ”¯æŒä¿¡æ¯ï¼Œå®ƒä¹Ÿå¯ä»¥ç›´æŽ¥å‘é€ HTTP 2.0 åˆ†å¸§ï¼Œè€Œä¸å¿…ä¾èµ–Upgrade æœºåˆ¶ã€‚æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸€ä¸Šæ¥å°±é€šè¿‡éžåŠ å¯†ä¿¡é“å‘é€ HTTP 2.0 åˆ†å¸§ï¼Œå…¶ä»–å°±ä¸ç®¡äº†ã€‚æœ€åçš„æƒ…å†µï¼Œå°±æ˜¯æ— æ³•å»ºç«‹è¿žæŽ¥ï¼Œå®¢æˆ·ç«¯å†å›žé€€ä¸€æ­¥ï¼Œé‡æ–°ä½¿ç”¨ Upgrade é¦–éƒ¨ï¼Œæˆ–è€…åˆ‡æ¢åˆ°å¸¦ ALPN åå•†çš„ TLS ä¿¡é“ã€‚ æœåŠ¡å™¨ä¹‹å‰çš„ HTTP 2.0 æ”¯æŒä¿¡æ¯å¹¶ä¸èƒ½ä¿è¯ä¸‹ä¸€æ¬¡å°±èƒ½å¯é åœ°å»ºç«‹è¿žæŽ¥ã€‚ä»¥è¿™ç§æ–¹å¼é€šä¿¡çš„å‰æï¼Œå°±æ˜¯å„ç«¯éƒ½å¿…é¡»æ”¯æŒ HTTP 2.0ã€‚å¦‚æžœä»»ä½•ä¸­é—´è®¾å¤‡ä¸æ”¯æŒï¼Œè¿žæŽ¥éƒ½ä¸ä¼šæˆåŠŸã€‚ äºŒè¿›åˆ¶åˆ†å¸§ç®€ä»‹HTTP 2.0 çš„æ ¹æœ¬æ”¹è¿›è¿˜æ˜¯æ–°å¢žçš„é•¿åº¦å‰ç½®çš„äºŒè¿›åˆ¶åˆ†å¸§å±‚ã€‚ å»ºç«‹äº† HTTP 2.0 è¿žæŽ¥åŽï¼Œå®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨ä¼šé€šè¿‡äº¤æ¢å¸§æ¥é€šä¿¡ï¼Œå¸§æ˜¯åŸºäºŽè¿™ä¸ªæ–°åè®®é€šä¿¡çš„æœ€å°å•ä½ã€‚æ‰€æœ‰å¸§éƒ½å…±äº«ä¸€ä¸ª 8 å­—èŠ‚çš„é¦–éƒ¨ï¼ˆå›¾ 12-6ï¼‰ï¼Œå…¶ä¸­åŒ…å«å¸§çš„é•¿åº¦ã€ç±»åž‹ã€æ ‡å¿—ï¼Œè¿˜æœ‰ä¸€ä¸ªä¿ç•™ä½å’Œä¸€ä¸ª 31 ä½çš„æµæ ‡è¯†ç¬¦ã€‚ 16 ä½çš„é•¿åº¦å‰ç¼€æ„å‘³ç€ä¸€å¸§å¤§çº¦å¯ä»¥æºå¸¦ 64 KB æ•°æ®ï¼Œä¸åŒ…æ‹¬ 8 å­—èŠ‚é¦–éƒ¨ã€‚ 8 ä½çš„ç±»åž‹å­—æ®µå†³å®šå¦‚ä½•è§£é‡Šå¸§å…¶ä½™éƒ¨åˆ†çš„å†…å®¹ã€‚ 8 ä½çš„æ ‡å¿—å­—æ®µå…è®¸ä¸åŒçš„å¸§ç±»åž‹å®šä¹‰ç‰¹å®šäºŽå¸§çš„æ¶ˆæ¯æ ‡å¿—ã€‚ 1 ä½çš„ä¿ç•™å­—æ®µå§‹ç»ˆç½®ä¸º 0ã€‚ 31 ä½çš„æµæ ‡è¯†ç¬¦å”¯ä¸€æ ‡è¯† HTTP 2.0 çš„æµã€‚ åœ¨è°ƒè¯• HTTP 2.0 é€šä¿¡æ—¶ï¼Œæœ‰äººä¼šä½¿ç”¨è‡ªå·±å–œæ¬¢çš„åå…­è¿›åˆ¶æŸ¥çœ‹å™¨ã€‚å…¶å®žï¼ŒWireshark åŠå…¶ä»–ç±»ä¼¼çš„å·¥å…·ä¹Ÿæœ‰ç›¸åº”çš„æ’ä»¶ï¼Œä½¿ç”¨å¾ˆç®€å•ï¼Œä¹Ÿå¾ˆäººæ€§åŒ–ã€‚æ¯”å¦‚ï¼Œè°·æ­Œ Chrome å°±æ”¯æŒ chrome://internals#spdy ï¼Œé€šè¿‡å®ƒå¯ä»¥æŸ¥çœ‹é€šä¿¡ç»†èŠ‚ã€‚ çŸ¥é“äº† HTTP 2.0 è§„å®šçš„è¿™ä¸ªå…±äº«çš„å¸§é¦–éƒ¨ï¼Œå°±å¯ä»¥è‡ªå·±ç¼–å†™ä¸€ä¸ªç®€å•çš„è§£æžå™¨ï¼Œé€šè¿‡åˆ†æž HTTP 2.0 å­—èŠ‚æµï¼Œæ ¹æ®æ¯ä¸ªå¸§çš„å‰ 8 å­—èŠ‚æ‰¾åˆ°å¸§çš„ç±»åž‹ã€æ ‡å¿—å’Œé•¿åº¦ã€‚è€Œä¸”ï¼Œç”±äºŽæ¯ä¸ªå¸§çš„é•¿åº¦éƒ½æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„ï¼Œè§£æžå™¨å¯ä»¥è¿…é€Ÿè€Œå‡†ç¡®åœ°è·³åˆ°ä¸‹ä¸€å¸§çš„å¼€å§‹ï¼Œè¿™ä¹Ÿæ˜¯ç›¸å¯¹äºŽ HTTP 1.x çš„ä¸€ä¸ªå¾ˆå¤§çš„æ€§èƒ½æå‡ã€‚ çŸ¥é“äº†å¸§ç±»åž‹ï¼Œè§£æžå™¨å°±çŸ¥é“è¯¥å¦‚ä½•è§£é‡Šå¸§çš„å…¶ä½™å†…å®¹äº†ã€‚HTTP 2.0 è§„å®šäº†å¦‚ä¸‹å¸§ç±»åž‹ã€‚ DATAï¼šç”¨äºŽä¼ è¾“ HTTP æ¶ˆæ¯ä½“ã€‚ HEADERSï¼šç”¨äºŽä¼ è¾“å…³äºŽæµçš„é¢å¤–çš„é¦–éƒ¨å­—æ®µã€‚ PRIORITYï¼šç”¨äºŽæŒ‡å®šæˆ–é‡æ–°æŒ‡å®šå¼•ç”¨èµ„æºçš„ä¼˜å…ˆçº§ã€‚ RST_STREAMï¼šç”¨äºŽé€šçŸ¥æµçš„éžæ­£å¸¸ç»ˆæ­¢ã€‚ SETTINGSï¼šç”¨äºŽé€šçŸ¥ä¸¤ç«¯é€šä¿¡æ–¹å¼çš„é…ç½®æ•°æ®ã€‚ PUSH_PROMISEï¼šç”¨äºŽå‘å‡ºåˆ›å»ºæµå’ŒæœåŠ¡å™¨å¼•ç”¨èµ„æºçš„è¦çº¦ã€‚ PINGï¼šç”¨äºŽè®¡ç®—å¾€è¿”æ—¶é—´ï¼Œæ‰§è¡Œâ€œæ´»æ€§â€æ£€æŸ¥ã€‚ GOAWAYï¼šç”¨äºŽé€šçŸ¥å¯¹ç«¯åœæ­¢åœ¨å½“å‰è¿žæŽ¥ä¸­åˆ›å»ºæµã€‚ WINDOW_UPDATEï¼šç”¨äºŽé’ˆå¯¹ä¸ªåˆ«æµæˆ–ä¸ªåˆ«è¿žæŽ¥å®žçŽ°æµé‡æŽ§åˆ¶ã€‚ CONTINUATIONï¼šç”¨äºŽç»§ç»­ä¸€ç³»åˆ—é¦–éƒ¨å—ç‰‡æ®µã€‚ æœåŠ¡å™¨å¯ä»¥åˆ©ç”¨ GOAWAY ç±»åž‹çš„å¸§å‘Šè¯‰å®¢æˆ·ç«¯è¦å¤„ç†çš„æœ€åŽä¸€ä¸ªæµçš„ IDï¼Œä»Žè€Œæ¶ˆé™¤ä¸€äº›è¯·æ±‚ç«žäº‰ï¼Œè€Œä¸”æµè§ˆå™¨ä¹Ÿå¯ä»¥æ®æ­¤æ™ºèƒ½åœ°é‡è¯•æˆ–å–æ¶ˆâ€œæ‚¬ç€çš„â€è¯·æ±‚ã€‚è¿™ä¹Ÿæ˜¯ä¿è¯å¤ç”¨è¿žæŽ¥å®‰å…¨çš„ä¸€ä¸ªé‡è¦å’Œå¿…è¦çš„åŠŸèƒ½ï¼ æ—¢ç„¶æœ‰äº†è¿™ä¸ªåˆ†å¸§å±‚ï¼Œå³ä½¿å®ƒå¯¹æˆ‘ä»¬çš„åº”ç”¨ä¸å¯è§ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥æ›´è¿›ä¸€æ­¥ï¼Œåˆ†æžä¸€ä¸‹ä¸¤ç§æœ€å¸¸è§çš„å·¥ä½œæµï¼šå‘èµ·æ–°æµå’Œäº¤æ¢åº”ç”¨æ•°æ®ã€‚åªæœ‰æ˜Žç™½äº†ä¸€ä¸ªè¯·æ±‚æˆ–å“åº”å¦‚ä½•è½¬æ¢æˆä¸€ä¸ªä¸€ä¸ªçš„å¸§ï¼Œæ‰èƒ½ç†è§£ HTTP 2.0 å¯¹æ€§èƒ½çš„æå‡æ¥è‡ªå“ªé‡Œã€‚ å›ºå®šé•¿åº¦ä¸Žå¯å˜é•¿åº¦å­—æ®µHTTP 2.0 åªä½¿ç”¨å›ºå®šé•¿åº¦å­—æ®µï¼ŒHTTP 2.0 å¸§å ç”¨å¸¦å®½å¾ˆå°‘ï¼ˆå¸§é¦–éƒ¨æ˜¯ 8 å­—èŠ‚ï¼‰ã€‚é‡‡ç”¨å¯å˜é•¿åº¦ç¼–ç çš„ç¡®å¯ä»¥èŠ‚çœä¸€ç‚¹å¸¦å®½å’Œæ—¶å»¶ï¼Œä½†å´æ— æ³•æŠµå¿ç”±æ­¤å¸¦æ¥çš„åˆ†æžå¤æ‚æ€§ã€‚å³ä½¿å¯å˜é•¿åº¦ç¼–ç èƒ½å‡å°‘ 50% çš„å¸¦å®½å ç”¨ï¼Œé‚£ä¹ˆåœ¨ 1 Mbit/s çš„è¿žæŽ¥ä¸Šä¼ è¾“ 1400 å­—èŠ‚çš„åˆ†ç»„ï¼Œä¹Ÿåªèƒ½èŠ‚çœ 4 å­—èŠ‚ï¼ˆ0.3%ï¼‰å’Œæ¯å¸§ä¸åˆ° 100 çº³ç§’çš„å»¶è¿Ÿæ—¶é—´ã€‚ å‘èµ·æ–°æµåœ¨å‘é€åº”ç”¨æ•°æ®ä¹‹å‰ï¼Œå¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°æµå¹¶éšä¹‹å‘é€ç›¸åº”çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚æµä¼˜å…ˆçº§ã€HTTP é¦–éƒ¨ç­‰ã€‚HTTP 2.0 åè®®è§„å®šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥å‘èµ·æ–°æµï¼Œå› æ­¤æœ‰ä¸¤ç§å¯èƒ½ï¼š å®¢æˆ·ç«¯é€šè¿‡å‘é€HEADERS å¸§æ¥å‘èµ·æ–°æµï¼ˆå›¾ 12-7ï¼‰ï¼Œè¿™ä¸ªå¸§é‡ŒåŒ…å«å¸¦æœ‰æ–°æµ ID çš„å…¬ç”¨é¦–éƒ¨ã€å¯é€‰çš„ 31 ä½ä¼˜å…ˆå€¼ï¼Œä»¥åŠä¸€ç»„ HTTP é”®ï¼å€¼å¯¹é¦–éƒ¨ï¼› æœåŠ¡å™¨é€šè¿‡å‘é€PUSH_PROMISE å¸§æ¥å‘èµ·æŽ¨é€æµï¼Œè¿™ä¸ªå¸§ä¸Ž HEADERS å¸§ç­‰æ•ˆï¼Œä½†å®ƒåŒ…å«â€œè¦çº¦æµ IDâ€ï¼Œæ²¡æœ‰ä¼˜å…ˆå€¼ã€‚ è¿™ä¸¤ç§å¸§çš„ç±»åž‹å­—æ®µéƒ½åªç”¨äºŽæ²Ÿé€šæ–°æµçš„å…ƒæ•°æ®ï¼Œå‡€è·ä¼šåœ¨ DATA å¸§ä¸­å•ç‹¬å‘é€ã€‚åŒæ ·ï¼Œç”±äºŽä¸¤ç«¯éƒ½å¯ä»¥å‘èµ·æ–°æµï¼Œæµè®¡æ•°å™¨åç½®ï¼šå®¢æˆ·ç«¯å‘èµ·çš„æµå…·æœ‰å¶æ•° IDï¼ŒæœåŠ¡å™¨å‘èµ·çš„æµå…·æœ‰å¥‡æ•° IDã€‚è¿™æ ·ï¼Œä¸¤ç«¯çš„æµ ID ä¸ä¼šå†²çªï¼Œè€Œä¸”å„è‡ªæŒæœ‰ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨ï¼Œæ¯æ¬¡å‘èµ·æ–°æµæ—¶é€’å¢ž ID å³å¯ã€‚ ç”±äºŽæµçš„å…ƒæ•°æ®ä¸Žåº”ç”¨æ•°æ®æ˜¯å•ç‹¬å‘é€çš„ï¼Œå› æ­¤å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥åˆ†åˆ«ç»™å®ƒä»¬è®¾å®šä¸åŒçš„ä¼˜å…ˆçº§ã€‚æ¯”å¦‚ï¼Œâ€œæŽ§åˆ¶æµé‡â€çš„æµä¼˜å…ˆçº§å¯ä»¥é«˜ä¸€äº›ï¼Œä½†åªå°†å…¶åº”ç”¨ç»™ DATA å¸§ã€‚ å‘é€åº”ç”¨æ•°æ®åˆ›å»ºæ–°æµå¹¶å‘é€ HTTP é¦–éƒ¨ä¹‹åŽï¼ŒæŽ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨ DATA å¸§ï¼ˆå›¾ 12-8ï¼‰å‘é€åº”ç”¨æ•°æ®ã€‚åº”ç”¨æ•°æ®å¯ä»¥åˆ†ä¸ºå¤šä¸ª DATA å¸§ï¼Œæœ€åŽä¸€å¸§è¦ç¿»è½¬å¸§é¦–éƒ¨çš„ END_STREAM å­—æ®µã€‚ æ•°æ®å‡€è·ä¸ä¼šè¢«å¦è¡Œç¼–ç æˆ–åŽ‹ç¼©ã€‚ç¼–ç æ–¹å¼å–å†³äºŽåº”ç”¨æˆ–æœåŠ¡å™¨ï¼Œçº¯æ–‡æœ¬ã€gzip åŽ‹ç¼©ã€å›¾ç‰‡æˆ–è§†é¢‘åŽ‹ç¼©æ ¼å¼éƒ½å¯ä»¥ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œå…³äºŽ DATA å¸§å†ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ–°ä¸œè¥¿å¥½è¯´äº†ï¼æ•´ä¸ªå¸§ç”±å…¬ç”¨çš„ 8 å­—èŠ‚é¦–éƒ¨ï¼ŒåŽè·Ÿ HTTP å‡€è·ç»„æˆã€‚ ä»ŽæŠ€æœ¯ä¸Šè¯´ï¼Œ DATA å¸§çš„é•¿åº¦å­—æ®µå†³å®šäº†æ¯å¸§çš„æ•°æ®å‡€è·æœ€å¤šå¯è¾¾ 2^16-1ï¼ˆ65 535ï¼‰å­—èŠ‚ã€‚å¯æ˜¯ï¼Œä¸ºå‡å°‘é˜Ÿé¦–é˜»å¡žï¼ŒHTTP 2.0 æ ‡å‡†è¦æ±‚ DATA å¸§ä¸èƒ½è¶…è¿‡ 2^14 -1ï¼ˆ16383ï¼‰å­—èŠ‚ã€‚é•¿åº¦è¶…è¿‡è¿™ä¸ªé˜€å€¼çš„æ•°æ®ï¼Œå°±å¾—åˆ†å¸§å‘é€ã€‚ HTTP 2.0å¸§æ•°æ®æµåˆ†æž æœ‰ 3 ä¸ªæ´»åŠ¨çš„æµï¼šstream 1ã€stream 3 å’Œ stream 5ã€‚ 3 ä¸ªæµçš„ ID éƒ½æ˜¯å¥‡æ•°ï¼Œè¯´æ˜Žéƒ½æ˜¯å®¢æˆ·ç«¯å‘èµ·çš„ã€‚ è¿™é‡Œæ²¡æœ‰æœåŠ¡å™¨å‘èµ·çš„æµã€‚ æœåŠ¡å™¨å‘é€çš„ stream 1 åŒ…å«å¤šä¸ªDATA å¸§ï¼Œè¿™æ˜¯å¯¹å®¢æˆ·ç«¯ä¹‹å‰è¯·æ±‚çš„å“åº”æ•°æ®ã€‚ è¿™ä¹Ÿè¯´æ˜Žåœ¨æ­¤ä¹‹å‰å·²ç»å‘é€è¿‡ HEADERS å¸§äº†ã€‚ æœåŠ¡å™¨åœ¨äº¤é”™å‘é€ stream 1 çš„DATA å¸§å’Œ stream 3 çš„ HEADERS å¸§ï¼Œè¿™å°±æ˜¯å“åº”çš„å¤šè·¯å¤ç”¨ï¼ å®¢æˆ·ç«¯æ­£åœ¨å‘é€ stream 5 çš„DATA å¸§ï¼Œè¡¨æ˜Ž HEADERS å¸§ä¹‹å‰å·²ç»å‘é€è¿‡äº†ã€‚ ç®€è¨€ä¹‹ï¼Œå›¾ 12-3 ä¸­è¿žæŽ¥æ­£åœ¨å¹¶è¡Œä¼ é€ 3 ä¸ªæ•°æ®æµï¼Œæ¯ä¸ªæµéƒ½å¤„äºŽå„è‡ªå¤„ç†å‘¨æœŸçš„ä¸åŒé˜¶æ®µã€‚æœåŠ¡å™¨å†³å®šå¸§çš„é¡ºåºï¼Œè€Œæˆ‘ä»¬ä¸ç”¨å…³å¿ƒæ¯ä¸ªæµçš„ç±»åž‹æˆ–å†…å®¹ã€‚stream 1 æºå¸¦çš„æ•°æ®é‡å¯èƒ½æ¯”è¾ƒå¤§ï¼Œä¹Ÿè®¸æ˜¯è§†é¢‘ï¼Œä½†å®ƒä¸ä¼šé˜»å¡žå…±äº«è¿žæŽ¥ä¸­çš„å…¶ä»–æµï¼ ä¼˜åŒ–åº”ç”¨çš„äº¤ä»˜äº‹å®žä¸Šï¼Œå½±å“ç»å¤§å¤šæ•° Web åº”ç”¨æ€§èƒ½çš„å¹¶éžå¸¦å®½ï¼Œè€Œæ˜¯å»¶è¿Ÿã€‚ç½‘é€Ÿè™½ç„¶è¶Šæ¥è¶Šå¿«ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œå»¶è¿Ÿä¼¼ä¹Žå¹¶æ²¡æœ‰ç¼©çŸ­ã€‚ è¯´åˆ°åº•ï¼ŒæˆåŠŸçš„ã€å¯æŒç»­çš„ Web æ€§èƒ½ä¼˜åŒ–ç­–ç•¥å…¶å®žå¾ˆç®€å•ï¼šå…ˆåº¦é‡ï¼Œç„¶åŽæ‹¿ä¸šåŠ¡ç›®æ ‡ä¸Žæ€§èƒ½æŒ‡æ ‡è¿›è¡Œæ¯”è¾ƒï¼Œé‡‡å–ä¼˜åŒ–æŽªæ–½ï¼Œç´§äº†æ¾ç‚¹ï¼Œæ¾äº†ç´§ç‚¹ï¼Œå¦‚æ­¤åå¤ã€‚å¼€å‘å’Œè´­ä¹°åˆç”¨çš„åº¦é‡å·¥å…·åŠé€‰æ‹©æ°å½“çš„åº¦é‡æ‰‹æ®µå…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ï¼› ç»å…¸çš„æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®žè·µæ— è®ºä»€ä¹ˆç½‘ç»œï¼Œä¹Ÿä¸ç®¡æ‰€ç”¨ç½‘ç»œåè®®æ˜¯ä»€ä¹ˆç‰ˆæœ¬ï¼Œæ‰€æœ‰åº”ç”¨éƒ½åº”è¯¥è‡´åŠ›äºŽæ¶ˆé™¤æˆ–å‡å°‘ä¸å¿…è¦çš„ç½‘ç»œå»¶è¿Ÿï¼Œå°†éœ€è¦ä¼ è¾“çš„æ•°æ®åŽ‹ç¼©è‡³æœ€å°‘ã€‚è¿™ä¸¤æ¡æ ‡å‡†æ˜¯ç»å…¸çš„æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®žè·µï¼Œæ˜¯å…¶ä»–æ•°åæ¡æ€§èƒ½å‡†åˆ™çš„å‡ºå‘ç‚¹ã€‚ å‡å°‘DNSæŸ¥æ‰¾æ¯ä¸€æ¬¡ä¸»æœºåè§£æžéƒ½éœ€è¦ä¸€æ¬¡ç½‘ç»œå¾€è¿”ï¼Œä»Žè€Œå¢žåŠ è¯·æ±‚çš„å»¶è¿Ÿæ—¶é—´ï¼ŒåŒæ—¶è¿˜ä¼šé˜»å¡žåŽç»­è¯·æ±‚ã€‚ é‡ç”¨TCPè¿žæŽ¥å°½å¯èƒ½ä½¿ç”¨æŒä¹…è¿žæŽ¥ï¼Œä»¥æ¶ˆé™¤ TCP æ¡æ‰‹å’Œæ…¢å¯åŠ¨å»¶è¿Ÿã€‚ å‡å°‘HTTPé‡å®šå‘HTTP é‡å®šå‘æžè´¹æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯ä¸åŒåŸŸåä¹‹é—´çš„é‡å®šå‘ï¼Œæ›´åŠ è´¹æ—¶ï¼›è¿™é‡Œé¢æ—¢æœ‰é¢å¤–çš„ DNS æŸ¥è¯¢ã€TCP æ¡æ‰‹ï¼Œè¿˜æœ‰å…¶ä»–å»¶è¿Ÿã€‚æœ€ä½³çš„é‡å®šå‘æ¬¡æ•°ä¸ºé›¶ã€‚ ä½¿ç”¨CDNï¼ˆå†…å®¹åˆ†å‘ç½‘ç»œï¼‰æŠŠæ•°æ®æ”¾åˆ°ç¦»ç”¨æˆ·åœ°ç†ä½ç½®æ›´è¿‘çš„åœ°æ–¹ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘æ¯æ¬¡ TCP è¿žæŽ¥çš„ç½‘ç»œå»¶è¿Ÿï¼Œå¢žå¤§åžåé‡ã€‚è¿™ä¸€æ¡æ—¢é€‚ç”¨äºŽé™æ€å†…å®¹ï¼Œä¹Ÿé€‚ç”¨äºŽåŠ¨æ€å†…å®¹(æ¯”å¦‚ï¼šä¸ç¼“å­˜çš„åŽŸå§‹èŽ·å–)ã€‚ åŽ»æŽ‰ä¸å¿…è¦çš„èµ„æºä»»ä½•è¯·æ±‚éƒ½ä¸å¦‚æ²¡æœ‰è¯·æ±‚å¿«ã€‚ ä¸ç¼“å­˜çš„åŽŸå§‹èŽ·å–ä½¿ç”¨ CDN æˆ–ä»£ç†æœåŠ¡å™¨å–å¾—èµ„æºçš„æŠ€æœ¯ï¼Œå¦‚æžœè¦æ ¹æ®ç”¨æˆ·å®šåˆ¶æˆ–è€…æ¶‰åŠéšç§æ•°æ®ï¼Œåˆ™ä¸èƒ½åšåˆ°å…¨çƒç¼“å­˜ï¼Œè¿™ç§æƒ…å†µè¢«ç§°ä¸ºâ€œä¸ç¼“å­˜çš„åŽŸå§‹èŽ·å–â€ï¼ˆuncached origin fetchï¼‰ã€‚è™½ç„¶åªæœ‰æŠŠæ•°æ®ç¼“å­˜åˆ°å…¨çƒå„åœ°çš„æœåŠ¡å™¨ä¸Š CDN æ‰èƒ½å‘æŒ¥æœ€å¤§çš„æ•ˆç”¨ï¼Œä½†â€œä¸ç¼“å­˜çš„åŽŸå§‹èŽ·å–â€ä»ç„¶å…·æœ‰æ€§èƒ½ä¼˜åŠ¿ï¼šå®¢æˆ·ç«¯è¿žæŽ¥ç»ˆæ­¢äºŽé™„è¿‘çš„æœåŠ¡å™¨ï¼Œä»Žè€Œæ˜¾è‘—å‡å°‘æ¡æ‰‹å»¶è¿Ÿã€‚ç›¸åº”åœ°ï¼ŒCDN æˆ–ä½ çš„ä»£ç†æœåŠ¡å™¨å¯ä»¥ç»´æŠ¤ä¸€ä¸ªâ€œçƒ­è¿žæŽ¥æ± â€ï¼ˆwarm connection poolï¼‰ï¼Œé€šè¿‡å®ƒå°†æ•°æ®è½¬å‘ç»™åŽŸå§‹æœåŠ¡å™¨ï¼ŒåŒæ—¶åšåˆ°å¯¹å®¢æˆ·ç«¯å¿«é€Ÿå“åº”ã€‚äº‹å®žä¸Šï¼Œä½œä¸ºé™„åŠ çš„ä¸€ä¸ªä¼˜åŒ–å±‚ï¼ŒCDN æä¾›å•†åœ¨è¿žæŽ¥ä¸¤ç«¯éƒ½ä¼šä½¿ç”¨é‚»è¿‘æœåŠ¡å™¨ï¼å®¢æˆ·ç«¯è¿žæŽ¥ç»ˆæ­¢äºŽé‚»è¿‘ CDN èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å°†è¯·æ±‚è½¬å‘åˆ°ä¸Žå¯¹ç«¯æœåŠ¡å™¨é‚»è¿‘çš„ CDNèŠ‚ç‚¹ï¼Œä¹‹åŽè¯·æ±‚æ‰ä¼šè¢«è·¯ç”±åˆ°åŽŸå§‹æœåŠ¡å™¨ã€‚CDN ç½‘ç»œä¸­å¤šå‡ºæ¥è¿™ä¸€è·³ï¼Œå¯ä»¥è®©æ•°æ®åœ¨ä¼˜åŒ–çš„ CDN éª¨å¹²ç½‘ä¸­å¯»è·¯ï¼Œä»Žè€Œè¿›ä¸€æ­¥å‡å°‘å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨ä¹‹é—´çš„å»¶è¿Ÿã€‚ åœ¨å®¢æˆ·ç«¯ç¼“å­˜èµ„æºåº”è¯¥ç¼“å­˜åº”ç”¨èµ„æºï¼Œä»Žè€Œé¿å…æ¯æ¬¡è¯·æ±‚éƒ½å‘é€ç›¸åŒçš„å†…å®¹ã€‚ ä¼ è¾“åŽ‹ç¼©è¿‡çš„å†…å®¹ä¼ è¾“å‰åº”è¯¥åŽ‹ç¼©åº”ç”¨èµ„æºï¼ŒæŠŠè¦ä¼ è¾“çš„å­—èŠ‚å‡è‡³æœ€å°‘ï¼šç¡®ä¿å¯¹æ¯ç§è¦ä¼ è¾“çš„èµ„æºé‡‡ç”¨æœ€å¥½çš„åŽ‹ç¼©æ‰‹æ®µã€‚ æ¶ˆé™¤ä¸å¿…è¦çš„è¯·æ±‚å¼€é”€å‡å°‘è¯·æ±‚çš„ HTTP é¦–éƒ¨æ•°æ®ï¼ˆæ¯”å¦‚ HTTP cookieï¼‰ï¼ŒèŠ‚çœçš„æ—¶é—´ç›¸å½“äºŽå‡ æ¬¡å¾€è¿”çš„å»¶è¿Ÿæ—¶é—´ã€‚ å¹¶è¡Œå¤„ç†è¯·æ±‚å’Œå“åº”è¯·æ±‚å’Œå“åº”çš„æŽ’é˜Ÿéƒ½ä¼šå¯¼è‡´å»¶è¿Ÿï¼Œæ— è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ç«¯ã€‚è¿™ä¸€ç‚¹ç»å¸¸è¢«å¿½è§†ï¼Œä½†å´ä¼šæ— è°“åœ°å¯¼è‡´å¾ˆé•¿å»¶è¿Ÿã€‚ é’ˆå¯¹åè®®ç‰ˆæœ¬é‡‡å–ä¼˜åŒ–æŽªæ–½HTTP 1.x æ”¯æŒæœ‰é™çš„å¹¶è¡Œæœºåˆ¶ï¼Œè¦æ±‚æ‰“åŒ…èµ„æºã€è·¨åŸŸåˆ†æ•£èµ„æºï¼Œç­‰ç­‰ã€‚ç›¸å¯¹è€Œè¨€ï¼ŒHTTP 2.0 åªè¦å»ºç«‹ä¸€ä¸ªè¿žæŽ¥å°±èƒ½å®žçŽ°æœ€ä¼˜æ€§èƒ½ï¼ŒåŒæ—¶æ— éœ€é’ˆå¯¹ HTTP 1.x çš„é‚£äº›ä¼˜åŒ–æ–¹æ³•ã€‚ åœ¨å®¢æˆ·ç«¯ç¼“å­˜èµ„æºè¦è¯´æœ€å¿«çš„ç½‘ç»œè¯·æ±‚ï¼Œé‚£å°±æ˜¯ä¸ç”¨å‘é€è¯·æ±‚å°±èƒ½èŽ·å–èµ„æºã€‚å°†ä¹‹å‰ä¸‹è½½è¿‡çš„æ•°æ®ç¼“å­˜å¹¶ç»´æŠ¤å¥½ï¼Œå°±å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å¯¹äºŽé€šè¿‡ HTTP ä¼ è¾“çš„èµ„æºï¼Œè¦ä¿è¯é¦–éƒ¨åŒ…å«é€‚å½“çš„ç¼“å­˜å­—æ®µï¼š Cache-Control é¦–éƒ¨ç”¨äºŽæŒ‡å®šç¼“å­˜æ—¶é—´ï¼› Last-Modified å’Œ ETag é¦–éƒ¨æä¾›éªŒè¯æœºåˆ¶ã€‚ åªè¦å¯èƒ½ï¼Œå°±ç»™æ¯ç§èµ„æºéƒ½æŒ‡å®šä¸€ä¸ªæ˜Žç¡®çš„ç¼“å­˜æ—¶é—´ã€‚è¿™æ ·å®¢æˆ·ç«¯å°±å¯ä»¥ç›´æŽ¥ä½¿ç”¨æœ¬åœ°å‰¯æœ¬ï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½è¯·æ±‚ç›¸åŒçš„å†…å®¹ã€‚ç±»ä¼¼åœ°ï¼ŒæŒ‡å®šéªŒè¯æœºåˆ¶å¯ä»¥è®©å®¢æˆ·ç«¯æ£€æŸ¥è¿‡æœŸçš„èµ„æºæ˜¯å¦æœ‰æ›´æ–°ã€‚æ²¡æœ‰æ›´æ–°ï¼Œå°±æ²¡å¿…è¦é‡æ–°å‘é€ã€‚ æœ€åŽï¼Œè¿˜è¦æ³¨æ„åº”åŒæ—¶æŒ‡å®šç¼“å­˜æ—¶é—´å’ŒéªŒè¯æ–¹æ³•ï¼åªæŒ‡å®šå…¶ä¸­ä¹‹ä¸€æ˜¯æœ€å¸¸è§çš„é”™è¯¯ï¼ŒäºŽæ˜¯è¦ä¹ˆå¯¼è‡´æ¯æ¬¡éƒ½åœ¨æ²¡æœ‰æ›´æ–°çš„æƒ…å†µä¸‹é‡å‘ç›¸åŒå†…å®¹ï¼ˆè¿™æ˜¯æ²¡æœ‰æŒ‡å®šéªŒè¯ï¼‰ï¼Œè¦ä¹ˆå¯¼è‡´æ¯æ¬¡ä½¿ç”¨èµ„æºæ—¶éƒ½å¤šä½™åœ°æ‰§è¡ŒéªŒè¯æ£€æŸ¥ï¼ˆè¿™æ˜¯æ²¡æœ‰æŒ‡å®šç¼“å­˜æ—¶é—´ï¼‰ã€‚ åŽ‹ç¼©ä¼ è¾“çš„æ•°æ®åˆ©ç”¨æœ¬åœ°ç¼“å­˜å¯ä»¥è®©å®¢æˆ·ç«¯é¿å…æ¯æ¬¡è¯·æ±‚éƒ½é‡å¤å–å¾—æ•°æ®ã€‚ä¸è¿‡ï¼Œè¿˜æ˜¯æœ‰ä¸€äº›èµ„æºæ˜¯å¿…é¡»å–å¾—çš„ï¼Œæ¯”å¦‚åŽŸæ¥çš„èµ„æºè¿‡æœŸäº†ï¼Œæˆ–è€…æœ‰æ–°èµ„æºï¼Œå†æˆ–è€…èµ„æºä¸èƒ½ç¼“å­˜ã€‚å¯¹äºŽè¿™äº›èµ„æºï¼Œåº”è¯¥ä¿è¯ä¼ è¾“çš„å­—èŠ‚æ•°æœ€å°‘ã€‚å› æ­¤è¦ä¿è¯å¯¹å®ƒä»¬è¿›è¡Œæœ€æœ‰æ•ˆçš„åŽ‹ç¼©ã€‚ HTMLã€CSS å’Œ JavaScript ç­‰æ–‡æœ¬èµ„æºçš„å¤§å°ç»è¿‡ gzip åŽ‹ç¼©å¹³å‡å¯ä»¥å‡å°‘ 60%~80%ã€‚è€Œå›¾ç‰‡åˆ™éœ€è¦ä»”ç»†è€ƒé‡ï¼š å›¾ç‰‡ä¸€èˆ¬ä¼šå åˆ°ä¸€ä¸ªç½‘é¡µéœ€è¦ä¼ è¾“çš„æ€»å­—èŠ‚æ•°çš„ä¸€åŠï¼› é€šè¿‡åŽ»æŽ‰ä¸å¿…è¦çš„å…ƒæ•°æ®å¯ä»¥æŠŠå›¾ç‰‡æ–‡ä»¶å˜å°ï¼› è¦è°ƒæ•´å¤§å°å°±åœ¨æœåŠ¡å™¨ä¸Šè°ƒæ•´ï¼Œé¿å…ä¼ è¾“ä¸å¿…è¦çš„å­—èŠ‚ï¼› åº”è¯¥æ ¹æ®å›¾åƒé€‰æ‹©æœ€ä¼˜çš„å›¾ç‰‡æ ¼å¼ï¼› å°½å¯èƒ½ä½¿ç”¨æœ‰æŸåŽ‹ç¼©ã€‚ ä¸åŒå›¾ç‰‡æ ¼å¼çš„åŽ‹ç¼©çŽ‡è¿¥ç„¶ä¸åŒï¼Œå› ä¸ºä¸åŒçš„æ ¼å¼æ˜¯åˆ†åˆ«ä¸ºä¸åŒä½¿ç”¨åœºæ™¯è®¾è®¡çš„ã€‚äº‹å®žä¸Šï¼Œå¦‚æžœé€‰é”™äº†å›¾ç‰‡æ ¼å¼ï¼ˆæ¯”å¦‚ï¼Œä½¿ç”¨äº† PNG è€Œéž JPG æˆ– WebPï¼‰ï¼Œå¤šäº§ç”Ÿå‡ ç™¾ç”šè‡³ä¸Šåƒ KB æ•°æ®æ˜¯è½»è€Œæ˜“ä¸¾çš„äº‹ã€‚å»ºè®®å¤§å®¶å¤šæ‰¾ä¸€äº›å·¥å…·å’Œè‡ªåŠ¨åŒ–æ‰‹æ®µï¼Œä»¥ç¡®å®šæœ€ä½³å›¾ç‰‡æ ¼å¼ã€‚ é€‰å®šå›¾ç‰‡æ ¼å¼åŽï¼Œå…¶æ¬¡å°±æ˜¯ä¸è¦è®©å›¾ç‰‡è¶…è¿‡å®ƒéœ€è¦çš„å¤§å°ã€‚å¦‚æžœåœ¨å®¢æˆ·ç«¯å¯¹è¶…å‡ºéœ€è¦å¤§å°çš„å›¾ç‰‡åšè°ƒæ•´ï¼Œé‚£ä¹ˆé™¤äº†é¢å¤–ä¼ è¾“ä¸å¿…è¦çš„å­—èŠ‚ä¹‹å¤–ï¼Œè¿˜ä¼šæµªè´¹ CPUã€GPUå’Œå†…å­˜èµ„æºã€‚ æœ€åŽï¼Œé€‰æ‹©äº†æ­£ç¡®çš„æ ¼å¼ï¼Œç¡®å®šäº†å¿…éœ€çš„å¤§å°ï¼ŒæŽ¥ä¸‹æ¥å°±è¦ç ”ç©¶ä½¿ç”¨å“ªä¸€ç§æœ‰æŸå›¾ç‰‡æ ¼å¼ï¼Œæ¯”å¦‚ JPEG è¿˜æ˜¯ WebPï¼Œä»¥åŠåŽ‹ç¼©åˆ°å“ªä¸ªçº§åˆ«ï¼šè¾ƒé«˜åŽ‹ç¼©çŽ‡å¯ä»¥æ˜Žæ˜¾å‡å°‘å­—èŠ‚æ•°ï¼ŒåŒæ—¶å›¾ç‰‡å“è´¨ä¸ä¼šæœ‰å¤ªå¤§æˆ–å¤ªæ˜Žæ˜¾çš„æŸå¤±ï¼Œå°¤å…¶æ˜¯åœ¨è¾ƒå°ï¼ˆæ‰‹æœºï¼‰çš„å±å¹•ä¸Šçœ‹ï¼Œä¸å®¹æ˜“å‘çŽ°ã€‚ WebPï¼šWeb ä¸Šçš„æ–°å›¾ç‰‡æ ¼å¼WebP æ˜¯è°·æ­Œå¼€å‘çš„ä¸€ç§æ–°å›¾ç‰‡æ ¼å¼ï¼Œå¾—åˆ°äº† Chrome å’Œ Opera æµè§ˆå™¨æ”¯æŒã€‚è¿™ç§æ ¼å¼çš„æ— æŸåŽ‹ç¼©å’Œæœ‰æŸåŽ‹ç¼©æ•ˆèƒ½éƒ½æœ‰æ‰€æå‡ï¼š WebP çš„æ— æŸåŽ‹ç¼©å›¾ç‰‡æ¯” PNG çš„å° 26%ï¼› WebP çš„æœ‰æŸåŽ‹ç¼©å›¾ç‰‡æ¯” JPG çš„å° 25%~34%ï¼› WebP æ”¯æŒæ— æŸé€æ˜ŽåŽ‹ç¼©ï¼Œä½†å› æ­¤ä»…å¢žåŠ  22% çš„å­—èŠ‚ã€‚ åœ¨çŽ°æœ‰ç½‘é¡µå¹³å‡ 1 MB å¤§å°ï¼Œå…¶ä¸­å›¾ç‰‡å ä¸€åŠçš„æƒ…å†µä¸‹ï¼ŒWebP èŠ‚çœçš„ 20%~30%ï¼Œå¯¹æ¯ä¸ªé¡µé¢è€Œè¨€å°±æ˜¯å‡ ç™¾ KBã€‚è¿™ç§æ ¼å¼éœ€è¦å®¢æˆ·ç«¯ CPU å¤šèŠ±ç‚¹æ—¶é—´è§£ç ï¼ˆå¤§çº¦ç›¸å½“äºŽå¤„ç† JPG çš„ 1.4 å€ï¼‰ï¼Œä½†å­—èŠ‚çš„èŠ‚çœå®Œå…¨å¯ä»¥è¡¥å¿å¤„ç†æ—¶é—´çš„å¢žé•¿ã€‚æ­¤å¤–ï¼Œç”±äºŽæ•°æ®æµé‡çš„é™åˆ¶å’Œé«˜é€Ÿç½‘ç»œçš„å­˜åœ¨ï¼Œå¯¹å¾ˆå¤šç”¨æˆ·è€Œè¨€ï¼ŒèŠ‚çœå­—èŠ‚æ‰æ˜¯å½“åŠ¡ä¹‹æ€¥ã€‚äº‹å®žä¸Šï¼ŒChrome Data Compression Proxy å’Œ Opera Turbo ç­‰å·¥å…·ä¸ºç”¨æˆ·é™ä½Žå¸¦å®½å ç”¨çš„ä¸»è¦æ‰‹æ®µï¼Œå°±æ˜¯é‡æ–°æŠŠæ¯å¼ å›¾ç‰‡ç¼–ç ä¸º WebP æ ¼å¼ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼ŒChrome Data Compression Proxy çš„æ•°æ®åŽ‹ç¼©çŽ‡å¯ä»¥è¾¾åˆ° 50%ï¼Œè¿™è¯´æ˜Žæˆ‘ä»¬è‡ªå·±çš„åº”ç”¨ä¹Ÿæœ‰å¾ˆå¤šå¯ä»¥é€šè¿‡åŽ‹ç¼©æå‡æ€§èƒ½çš„ç©ºé—´ã€‚ æ¶ˆé™¤ä¸å¿…è¦çš„è¯·æ±‚å­—èŠ‚HTTP æ˜¯ä¸€ç§æ— çŠ¶æ€åè®®ï¼Œä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨ä¸å¿…ä¿å­˜æ¯æ¬¡è¯·æ±‚çš„å®¢æˆ·ç«¯çš„ä¿¡æ¯ã€‚ç„¶è€Œï¼Œå¾ˆå¤šåº”ç”¨åˆä¾èµ–äºŽçŠ¶æ€ä¿¡æ¯ä»¥å®žçŽ°ä¼šè¯ç®¡ç†ã€ä¸ªæ€§åŒ–ã€åˆ†æžç­‰åŠŸèƒ½ã€‚ä¸ºäº†å®žçŽ°è¿™äº›åŠŸèƒ½ï¼ŒHTTP State Management Mechanismï¼ˆRFC 2965ï¼‰ä½œä¸ºæ‰©å±•ï¼Œå…è®¸ä»»ä½•ç½‘ç«™é’ˆå¯¹è‡ªèº«æ¥æºå…³è”å’Œæ›´æ–° cookie å…ƒæ•°æ®ï¼šæµè§ˆå™¨ä¿å­˜æ•°æ®ï¼Œè€Œåœ¨éšåŽå‘é€ç»™æ¥æºçš„æ¯ä¸€ä¸ªè¯·æ±‚çš„ Cookie é¦–éƒ¨ä¸­è‡ªåŠ¨é™„åŠ è¿™äº›ä¿¡æ¯ã€‚ ä¸Šè¿°æ ‡å‡†å¹¶æœªè§„å®š cookie æœ€å¤§ä¸èƒ½è¶…è¿‡å¤šå¤§ï¼Œä½†å®žè·µä¸­å¤§å¤šæ•°æµè§ˆå™¨éƒ½å°†å…¶é™åˆ¶ä¸º4 KBã€‚ä¸Žæ­¤åŒæ—¶ï¼Œè¯¥æ ‡å‡†è¿˜è§„å®šæ¯ä¸ªç«™ç‚¹é’ˆå¯¹å…¶æ¥æºå¯ä»¥æœ‰å¤šä¸ªå…³è”çš„ cookieã€‚äºŽæ˜¯ï¼Œä¸€ä¸ªæ¥æºçš„ cookie å°±æœ‰å¯èƒ½å¤šè¾¾å‡ å KB ï¼ä¸ç”¨è¯´ï¼Œè¿™ä¹ˆå¤šå…ƒæ•°æ®éšè¯·æ±‚ä¼ é€’ï¼Œå¿…ç„¶ä¼šç»™åº”ç”¨å¸¦æ¥æ˜Žæ˜¾çš„æ€§èƒ½æŸå¤±ï¼š æµè§ˆå™¨ä¼šåœ¨æ¯ä¸ªè¯·æ±‚ä¸­è‡ªåŠ¨é™„åŠ å…³è”çš„ cookie æ•°æ®ï¼› åœ¨ HTTP 1.x ä¸­ï¼ŒåŒ…æ‹¬ cookie åœ¨å†…çš„æ‰€æœ‰ HTTP é¦–éƒ¨éƒ½ä¼šåœ¨ä¸åŽ‹ç¼©çš„çŠ¶æ€ä¸‹ä¼ è¾“ï¼› åœ¨ HTTP 2.0 ä¸­ï¼Œè¿™äº›å…ƒæ•°æ®ç»è¿‡åŽ‹ç¼©äº†ï¼Œä½†å¼€é”€ä¾ç„¶ä¸å°ï¼› æœ€åçš„æƒ…å†µä¸‹ï¼Œè¿‡å¤§çš„ HTTP cookie ä¼šè¶…è¿‡åˆå§‹çš„ TCP æ‹¥å¡žçª—å£ï¼Œä»Žè€Œå¯¼è‡´å¤šä½™çš„ç½‘ç»œå¾€è¿”ã€‚ åº”è¯¥è®¤çœŸå¯¹å¾…å’Œç›‘æŽ§ cookie çš„å¤§å°ï¼Œç¡®ä¿åªä¼ è¾“æœ€ä½Žæ•°é‡çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚å®‰å…¨ä¼šè¯ä»¤ç‰Œã€‚åŒæ—¶ï¼Œè¿˜åº”è¯¥åˆ©ç”¨æœåŠ¡å™¨ä¸Šå…±äº«çš„ä¼šè¯ç¼“å­˜ï¼Œä»Žä¸­æŸ¥è¯¢ç¼“å­˜çš„å…ƒæ•°æ®ã€‚æ›´å¥½çš„ç»“æžœï¼Œåˆ™æ˜¯å®Œå…¨ä¸ç”¨cookieã€‚æ¯”å¦‚ï¼Œåœ¨è¯·æ±‚å›¾ç‰‡ã€è„šæœ¬å’Œæ ·å¼è¡¨ç­‰é™æ€èµ„æºæ—¶ï¼Œæµè§ˆå™¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ä¸å¿…ä¼ è¾“ç‰¹å®šäºŽå®¢æˆ·ç«¯çš„å…ƒæ•°æ®ã€‚ åœ¨ä½¿ç”¨ HTTP 1.x çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªä¸“é—¨çš„â€œæ— éœ€ cookieâ€çš„æ¥æºæœåŠ¡å™¨ã€‚è¿™ä¸ªæœåŠ¡å™¨å¯ä»¥ç”¨äºŽäº¤ä»˜é‚£äº›ä¸åŒºåˆ†å®¢æˆ·ç«¯çš„å…±ç”¨èµ„æºã€‚ é’ˆå¯¹HTTP 1.xçš„ä¼˜åŒ–å»ºè®®é’ˆå¯¹ HTTP 1.x çš„ä¼˜åŒ–æ¬¡åºå¾ˆé‡è¦ï¼šé¦–å…ˆè¦é…ç½®æœåŠ¡å™¨ä»¥æœ€å¤§é™åº¦åœ°ä¿è¯ TCP å’ŒTLS çš„æ€§èƒ½æœ€ä¼˜ï¼Œç„¶åŽå†è°¨æ…Žåœ°é€‰æ‹©å’Œé‡‡ç”¨ç§»åŠ¨åŠç»å…¸çš„åº”ç”¨æœ€ä½³å®žè·µï¼Œä¹‹åŽå†åº¦é‡ï¼Œè¿­ä»£ã€‚ é‡‡ç”¨äº†ç»å…¸çš„åº”ç”¨ä¼˜åŒ–æŽªæ–½å’Œé€‚å½“çš„æ€§èƒ½åº¦é‡æ‰‹æ®µï¼Œè¿˜è¦è¿›ä¸€æ­¥è¯„ä¼°æ˜¯å¦æœ‰å¿…è¦ä¸ºåº”ç”¨é‡‡å–ç‰¹å®šäºŽ HTTP 1.x çš„ä¼˜åŒ–æŽªæ–½ï¼ˆå…¶å®žæ˜¯æƒå®œä¹‹è®¡ï¼‰ã€‚ åˆ©ç”¨HTTPç®¡é“å¦‚æžœä½ çš„åº”ç”¨å¯ä»¥æŽ§åˆ¶å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿™ä¸¤ç«¯ï¼Œé‚£ä¹ˆä½¿ç”¨ç®¡é“å¯ä»¥æ˜¾è‘—å‡å°‘ç½‘ç»œå»¶è¿Ÿã€‚ é‡‡ç”¨åŸŸååˆ†åŒºå¦‚æžœä½ çš„åº”ç”¨æ€§èƒ½å—é™äºŽé»˜è®¤çš„æ¯æ¥æº 6 ä¸ªè¿žæŽ¥ï¼Œå¯ä»¥è€ƒè™‘å°†èµ„æºåˆ†æ•£åˆ°å¤šä¸ªæ¥æºã€‚ æ‰“åŒ…èµ„æºä»¥å‡å°‘HTTPè¯·æ±‚æ‹¼æŽ¥å’Œç²¾çµå›¾ç­‰æŠ€å·§æœ‰åŠ©äºŽé™ä½Žåè®®å¼€é”€ï¼Œåˆèƒ½è¾¾æˆç±»ä¼¼ç®¡é“çš„æ€§èƒ½æå‡ã€‚ åµŒå…¥å°èµ„æºè€ƒè™‘ç›´æŽ¥åœ¨çˆ¶æ–‡æ¡£ä¸­åµŒå…¥å°èµ„æºï¼Œä»Žè€Œå‡å°‘è¯·æ±‚æ•°é‡ã€‚ ç®¡é“ç¼ºä¹æ”¯æŒï¼Œè€Œå…¶ä»–ä¼˜åŒ–æ‰‹æ®µåˆå„æœ‰å„çš„åˆ©å¼Šã€‚äº‹å®žä¸Šï¼Œè¿™äº›ä¼˜åŒ–æŽªæ–½å¦‚æžœè¿‡äºŽæ¿€è¿›æˆ–ä½¿ç”¨ä¸å½“ï¼Œåå€’ä¼šä¼¤å®³æ€§èƒ½ã€‚æ€»ä¹‹ï¼Œè¦æœ‰åŠ¡å®žçš„æ€åº¦ï¼Œé€šè¿‡åº¦é‡æ¥è¯„ä¼°å„ç§æŽªæ–½å¯¹æ€§èƒ½çš„å½±å“ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå†è¿­ä»£æ”¹è¿›ã€‚å¤©åº•ä¸‹å°±æ²¡æœ‰åŒ…æ²»ç™¾ç—…çš„çµä¸¹å¦™è¯ã€‚ å¯¹äº†ï¼Œè¿˜æœ‰æœ€åŽä¸€æ‹›å„¿ â€”â€” å‡çº§åˆ° HTTP 2.0ã€‚ä»…æ­¤ä¸€æ‹›å„¿æŠµå¾—ä¸Šå‰é¢æåˆ°çš„å¤§å¤šæ•°é’ˆå¯¹ HTTP 1.x çš„ä¼˜åŒ–æ‰‹æ®µï¼ HTTP 2.0 ä¸å…‰èƒ½è®©åº”ç”¨åŠ è½½æ›´å¿«ï¼Œè¿˜èƒ½è®©å¼€å‘æ›´ç®€å•ã€‚ é’ˆå¯¹HTTP 2.0çš„ä¼˜åŒ–å»ºè®®HTTP 2.0 çš„ä¸»è¦ç›®æ ‡å°±æ˜¯æå‡ä¼ è¾“æ€§èƒ½ï¼Œå®žçŽ°å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨é—´è¾ƒä½Žçš„å»¶è¿Ÿå’Œè¾ƒé«˜çš„åžåé‡ã€‚æ˜¾ç„¶ï¼Œåœ¨ TCP å’Œ TLS ä¹‹ä¸Šå®žçŽ°æœ€ä½³æ€§èƒ½ï¼ŒåŒæ—¶æ¶ˆé™¤ä¸å¿…è¦çš„ç½‘ç»œå»¶è¿Ÿï¼Œä»Žæ¥æ²¡æœ‰å¦‚æ­¤é‡è¦è¿‡ã€‚æœ€ä½Žé™åº¦ï¼š æœåŠ¡å™¨çš„åˆå§‹cwnd åº”è¯¥æ˜¯ 10 ä¸ªåˆ†ç»„ï¼› æœåŠ¡å™¨åº”è¯¥é€šè¿‡ ALPNï¼ˆé’ˆå¯¹ SPDY åˆ™ä¸º NPNï¼‰åå•†æ”¯æŒ TLSï¼› æœåŠ¡å™¨åº”è¯¥æ”¯æŒ TLS æ¢å¤ä»¥æœ€å°åŒ–æ¡æ‰‹å»¶è¿Ÿã€‚ æŽ¥ä¸‹æ¥ï¼Œæˆ–è®¸æœ‰ç‚¹æ„å¤–ï¼Œé‚£å°±æ˜¯é‡‡ç”¨ç§»åŠ¨åŠå…¶ä»–ç»å…¸çš„æœ€ä½³åšæ³•ï¼šå°‘å‘æ•°æ®ã€å‰Šå‡è¯·æ±‚ï¼Œæ ¹æ®æ— çº¿ç½‘ç»œæƒ…å†µè°ƒæ•´èµ„æºä¾›ç»™ã€‚ä¸ç®¡ä½¿ç”¨ä»€ä¹ˆç‰ˆæœ¬çš„åè®®ï¼Œå‡å°‘ä¼ è¾“çš„æ•°æ®é‡å’Œæ¶ˆé™¤ä¸å¿…è¦çš„ç½‘ç»œå»¶è¿Ÿï¼Œå¯¹ä»»ä½•åº”ç”¨éƒ½æ˜¯æœ€æœ‰æ•ˆçš„ä¼˜åŒ–æ‰‹æ®µã€‚ æœ€åŽï¼Œæœç»å’Œå¿˜è®°åŸŸååˆ†åŒºã€æ–‡ä»¶æ‹¼æŽ¥ã€å›¾ç‰‡ç²¾çµç­‰ä¸è‰¯çš„ä¹ æƒ¯ï¼Œè¿™äº›åšæ³•åœ¨HTTP 2.0 ä¹‹ä¸Šå®Œå…¨æ²¡æœ‰å¿…è¦ã€‚äº‹å®žä¸Šï¼Œç»§ç»­ä½¿ç”¨è¿™äº›æ‰‹æ®µåè€Œæœ‰å®³ï¼å¯ä»¥åˆ©ç”¨HTTP 2.0 å†…ç½®çš„å¤šè·¯åˆ†å‘ä»¥åŠæœåŠ¡å™¨æŽ¨é€ç­‰æ–°åŠŸèƒ½ã€‚ åŽ»æŽ‰å¯¹1.xçš„ä¼˜åŒ–é’ˆå¯¹ HTTP 2.0 å’Œ HTTP 1.x çš„ä¼˜åŒ–ç­–ç•¥æ²¡æœ‰ä»€ä¹ˆé‡å ã€‚å› æ­¤ï¼Œä¸ä»…ä¸å¿…æ‹…å¿ƒ HTTP 1.x åè®®çš„ç§ç§é™åˆ¶ï¼Œè€Œä¸”è¦æ’¤é”€åŽŸå…ˆé‚£äº›å¿…è¦çš„åšæ³•ã€‚ æ¯ä¸ªæ¥æºä½¿ç”¨ä¸€ä¸ªè¿žæŽ¥HTTP 2.0 é€šè¿‡å°†ä¸€ä¸ª TCP è¿žæŽ¥çš„åžåé‡æœ€å¤§åŒ–æ¥æå‡æ€§èƒ½ã€‚äº‹å®žä¸Šï¼Œåœ¨ HTTP 2.0 ä¹‹ä¸‹å†ä½¿ç”¨å¤šä¸ªè¿žæŽ¥ï¼ˆæ¯”å¦‚åŸŸååˆ†åŒºï¼‰åå€’æˆäº†ä¸€ç§åæ¨¡å¼ï¼Œå› ä¸ºå¤šä¸ªè¿žæŽ¥ä¼šæŠµæ¶ˆæ–°åè®®ä¸­é¦–éƒ¨åŽ‹ç¼©å’Œè¯·æ±‚ä¼˜å…ˆçº§çš„æ•ˆç”¨ã€‚ åŽ»æŽ‰ä¸å¿…è¦çš„æ–‡ä»¶åˆå¹¶å’Œå›¾ç‰‡æ‹¼æŽ¥æ‰“åŒ…èµ„æºçš„ç¼ºç‚¹å¾ˆå¤šï¼Œæ¯”å¦‚ç¼“å­˜å¤±æ•ˆã€å ç”¨å†…å­˜ã€å»¶ç¼“æ‰§è¡Œï¼Œä»¥åŠå¢žåŠ åº”ç”¨å¤æ‚æ€§ã€‚æœ‰äº† HTTP 2.0ï¼Œå¾ˆå¤šå°èµ„æºéƒ½å¯ä»¥å¹¶è¡Œå‘é€ï¼Œå¯¼è‡´æ‰“åŒ…èµ„æºçš„æ•ˆçŽ‡åè€Œæ›´ä½Žã€‚ åˆ©ç”¨æœåŠ¡å™¨æŽ¨é€ä¹‹å‰é’ˆå¯¹ HTTP 1.x è€ŒåµŒå…¥çš„å¤§å¤šæ•°èµ„æºï¼Œéƒ½å¯ä»¥è€Œä¸”åº”è¯¥é€šè¿‡æœåŠ¡å™¨æŽ¨é€æ¥äº¤ä»˜ã€‚è¿™æ ·ä¸€æ¥ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥åˆ†åˆ«ç¼“å­˜æ¯ä¸ªèµ„æºï¼Œå¹¶åœ¨é¡µé¢é—´å®žçŽ°é‡ç”¨ï¼Œè€Œä¸å¿…æŠŠå®ƒä»¬æ”¾åˆ°æ¯ä¸ªé¡µé¢é‡Œäº†ã€‚ è¦èŽ·å¾—æœ€ä½³æ€§èƒ½ï¼Œåº”è¯¥å°½å¯èƒ½æŠŠæ‰€æœ‰èµ„æºéƒ½é›†ä¸­åœ¨ä¸€ä¸ªåŸŸåä¹‹ä¸‹ã€‚åŸŸååˆ†åŒºåœ¨ HTTP 2.0 ä¹‹ä¸‹å±žäºŽåæ¨¡å¼ï¼Œå¯¹å‘æŒ¥åè®®çš„æ€§èƒ½æœ‰å®³ï¼šåˆ†åŒºæ˜¯å¼€å§‹ï¼Œä¹‹åŽå½±å“ä¼šé€æ¸æ‰©æ•£ã€‚æ‰“åŒ…èµ„æºä¸ä¼šå½±å“ HTTP 2.0 åè®®æœ¬èº«ï¼Œä½†å¯¹ç¼“å­˜æ€§èƒ½å’Œæ‰§è¡Œé€Ÿåº¦æœ‰è´Ÿé¢å½±å“ã€‚ ç±»ä¼¼åœ°ï¼ŒæŠŠåµŒå…¥èµ„æºæ”¹ä¸ºæœåŠ¡å™¨æŽ¨é€èƒ½æå‡å®¢æˆ·ç«¯çš„ç¼“å­˜æ€§èƒ½ï¼Œåˆä¸ä¼šå¯¼è‡´é¢å¤–ç½‘ç»œå»¶è¿Ÿã€‚äº‹å®žä¸Šï¼Œç”±äºŽ 3G å’Œ 4G ç½‘ç»œçš„å¾€è¿”æ—¶é—´æ›´é•¿ï¼Œå› è€ŒæœåŠ¡å™¨æŽ¨é€å¯¹ç§»åŠ¨åº”ç”¨æ¥è¯´æ•ˆæžœæ›´æ˜Žæ˜¾ã€‚ HTTP 2.0 ä¸­çš„æ‰“åŒ…ä¸Žåè®®å¼€é”€ç”±äºŽ HTTP 1.x åšä¸åˆ°å¤šè·¯å¤ç”¨ï¼Œè€Œä¸”æ¯æ¬¡è¯·æ±‚çš„åè®®å¼€é”€å¾ˆé«˜ï¼Œè¿™æ‰æœ‰äº†è¿žæŽ¥å’Œæ‹¼åˆç­‰æ‰“åŒ…æŠ€æœ¯ã€‚åœ¨ HTTP 2.0 ä¹‹ä¸‹ï¼Œå¤šè·¯å¤ç”¨å·²ç»ä¸æˆé—®é¢˜ï¼Œé¦–éƒ¨åŽ‹ç¼©ä¹Ÿå¯ä»¥é™ä½Žæ¯æ¬¡ HTTP è¯·æ±‚è¦ä¼ è¾“çš„å…ƒæ•°æ®é‡ï¼Œæ‰“åŒ…æŠ€æœ¯åœ¨å¤šæ•°æƒ…å†µä¸‹éƒ½ä¸å†éœ€è¦äº†ã€‚ä¸è¿‡ï¼Œè¯·æ±‚å¼€é”€åªæ˜¯å‡å°‘äº†ï¼Œå¹¶æ²¡æœ‰ç­‰äºŽé›¶ã€‚å°‘æ•°æƒ…å†µä¸‹ï¼ŒæŸäº›èµ„æºå¿…é¡»ä¸€å—ä½¿ç”¨ï¼Œè€Œä¸”æ›´æ–°ä¹Ÿä¸é¢‘ç¹ï¼Œæ­¤æ—¶ä½¿ç”¨æ‰“åŒ…æŠ€æœ¯ä»ç„¶å¯ä»¥æå‡æ€§èƒ½ã€‚ä½†è¿™äº›æƒ…å†µå¾ˆå°‘è§ï¼Œå¯ä»¥ç®—ä½œä¾‹å¤–ã€‚å…·ä½“æŽªæ–½å¯ä»¥é€šè¿‡æ€§èƒ½åº¦é‡ç¡®å®šã€‚ åŒåè®®åº”ç”¨ç­–ç•¥é—æ†¾çš„æ˜¯ï¼Œå‡çº§åˆ° HTTP 2.0 ä¸ä¼šåœ¨ä¸€å¤œä¹‹é—´å®Œæˆã€‚å› æ­¤ï¼Œå¾ˆå¤šåº”ç”¨éƒ½éœ€è¦è®¤çœŸè€ƒè™‘åŒåè®®å¹¶å­˜çš„éƒ¨ç½²ç­–ç•¥ï¼Œå³åŒä¸€ä¸ªåº”ç”¨æ—¢èƒ½é€šè¿‡ HTTP 1.x äº¤ä»˜ï¼Œä¹Ÿèƒ½é€šè¿‡ HTTP2.0 äº¤ä»˜ï¼Œæ— éœ€ä»»ä½•æ”¹åŠ¨ã€‚ç„¶è€Œï¼Œè¿‡äºŽæ¿€è¿›çš„ HTTP 1.x ä¼˜åŒ–å¯èƒ½ä¼¤å®³ HTTP 2.0 æ€§èƒ½ï¼Œåä¹‹äº¦ç„¶ã€‚ å¦‚æžœåº”ç”¨å¯ä»¥åŒæ—¶æŽ§åˆ¶æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œé‚£å€’ç®€å•äº†ï¼Œå› ä¸ºå®ƒå¯ä»¥å†³å®šä½¿ç”¨ä»€ä¹ˆåè®®ã€‚ä½†å¤§å¤šæ•°åº”ç”¨ä¸èƒ½ä¹Ÿæ— æ³•æŽ§åˆ¶å®¢æˆ·ç«¯ï¼Œåªæœ‰é‡‡ç”¨ä¸€ç§æ··åˆæˆ–è‡ªåŠ¨ç­–ç•¥ï¼Œä»¥é€‚åº”ä¸¤ç§åè®®å¹¶å­˜çš„çŽ°å®žã€‚ä¸‹é¢æˆ‘ä»¬å°±åˆ†æžå‡ ç§å¯èƒ½çš„æƒ…å†µã€‚ ç›¸åŒçš„åº”ç”¨ä»£ç ï¼ŒåŒåè®®éƒ¨ç½²ç›¸åŒçš„åº”ç”¨ä»£ç å¯èƒ½é€šè¿‡ HTTP 1.x ä¹Ÿå¯èƒ½é€šè¿‡ HTTP 2.0 äº¤ä»˜ã€‚å¯èƒ½ä»»ä½•ä¸€ç§åè®®ä¹‹ä¸‹éƒ½è¾¾ä¸åˆ°æœ€ä½³æ€§èƒ½ï¼Œä½†å¯ä»¥è¿½æ±‚æ€§èƒ½è¶³å¤Ÿå¥½ã€‚æ‰€è°“è¶³å¤Ÿå¥½ï¼Œéœ€è¦é€šè¿‡é’ˆå¯¹æ¯ä¸€ç§åº”ç”¨å•ç‹¬åº¦é‡æ¥ä¿è¯ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬ä¸€æ­¥å¯ä»¥å…ˆæ’¤é”€åŸŸååˆ†åŒºä»¥å®žçŽ°HTTP 2.0 äº¤ä»˜ã€‚ç„¶åŽï¼Œéšç€æ›´å¤šç”¨æˆ·è¿ç§»åˆ° HTTP 2.0ï¼Œå¯ä»¥ç»§ç»­æ’¤é”€èµ„æºæ‰“åŒ…å¹¶å°½å¯èƒ½åˆ©ç”¨æœåŠ¡å™¨æŽ¨é€ã€‚ åˆ†ç¦»åº”ç”¨ä»£ç ï¼ŒåŒåè®®éƒ¨ç½²æ ¹æ®åè®®ä¸åŒåˆ†åˆ«äº¤ä»˜ä¸åŒç‰ˆæœ¬çš„åº”ç”¨ã€‚è¿™æ ·ä¼šå¢žåŠ è¿ç»´çš„å¤æ‚æ€§ï¼Œä½†å®žè·µä¸­å¯¹å¾ˆå¤šåº”ç”¨å€’æ˜¯ååˆ†å¯è¡Œã€‚æ¯”å¦‚ï¼Œä¸€å°è´Ÿè´£å®Œæˆè¿žæŽ¥çš„è¾¹ç•ŒæœåŠ¡å™¨å¯ä»¥æ ¹æ®åå•†åŽçš„åè®®ç‰ˆæœ¬ï¼ŒæŠŠå®¢æˆ·ç«¯è¯·æ±‚å¼•å¯¼è‡³é€‚å½“çš„æœåŠ¡å™¨ã€‚ åŠ¨æ€HTTP 1.xå’ŒHTTP 2.0ä¼˜åŒ–æŸäº›è‡ªåŠ¨åŒ–çš„ Web ä¼˜åŒ–æ¡†æž¶ï¼Œä»¥åŠå¼€æºåŠå•†ä¸šäº§å“ï¼Œéƒ½å¯ä»¥åœ¨å“åº”è¯·æ±‚æ—¶åŠ¨æ€é‡å†™äº¤ä»˜çš„åº”ç”¨ä»£ç ï¼ˆåŒ…æ‹¬è¿žæŽ¥ã€æ‹¼åˆã€åˆ†åŒºï¼Œç­‰ç­‰ï¼‰ã€‚æ­¤æ—¶ï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä»¥è€ƒè™‘åå•†çš„åè®®ç‰ˆæœ¬ï¼Œå¹¶åŠ¨æ€é‡‡ç”¨é€‚å½“çš„ä¼˜åŒ–ç­–ç•¥ã€‚ HTTP 2.0ï¼Œå•åè®®éƒ¨ç½²å¦‚æžœåº”ç”¨å¯ä»¥æŽ§åˆ¶æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œé‚£æ²¡ç†ç”±ä¸åªä½¿ç”¨ HTTP 2.0ã€‚äº‹å®žä¸Šï¼Œå¦‚æžœçœŸæœ‰è¿™ç§å¯èƒ½ï¼Œé‚£å°±åº”è¯¥ä¸“ä¸€ä½¿ç”¨ HTTP 2.0ã€‚ é€‰æ‹©è·¯çº¿æ—¶ï¼Œè¦çœ‹å½“å‰çš„åŸºç¡€è®¾æ–½ã€åº”ç”¨çš„å¤æ‚ç¨‹åº¦ï¼Œä»¥åŠç”¨æˆ·çš„æž„æˆã€‚è®©äººå“­ç¬‘ä¸å¾—çš„æ˜¯ï¼Œé‚£äº›åœ¨ HTTP 1.x ä¼˜åŒ–ä¸ŠæŠ•èµ„å¾ˆå¤§çš„åº”ç”¨ï¼Œåå€’åœ¨è¿™ç§æƒ…å†µä¸‹æœ€éš¾åŠžã€‚å¦‚æžœä½ èƒ½æŽ§åˆ¶å®¢æˆ·ç«¯ï¼Œæœ‰è‡ªåŠ¨çš„åº”ç”¨ä¼˜åŒ–ç­–ç•¥ï¼Œæˆ–è€…æ²¡æœ‰ä½¿ç”¨ä»»ä½•ç‰¹å®šäºŽ 1.x çš„ä¼˜åŒ–ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä¸“æ³¨äºŽ HTTP 2.0ï¼Œè€Œæ²¡æœ‰åŽé¡¾ä¹‹å¿§äº†ã€‚ ä½¿ç”¨ PageSpeed å®žçŽ°åŠ¨æ€ä¼˜åŒ–è°·æ­Œçš„ PageSpeed Optimization Librariesï¼ˆPSOLï¼‰æä¾›äº† 40 å¤šç§â€œWeb ä¼˜åŒ–è¿‡æ»¤å™¨â€çš„å¼€æºå®žçŽ°ï¼Œå¯ä»¥é›†æˆåˆ°ä»»ä½•æœåŠ¡å™¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€åº”ç”¨å„ç§ä¼˜åŒ–ç­–ç•¥ã€‚ åœ¨ä½¿ç”¨ PSOL åº“çš„æƒ…å†µä¸‹ï¼Œ mod_pagespeed ï¼ˆApacheï¼‰å’Œ ngx_pagespeed ï¼ˆNginxï¼‰æ¨¡å—éƒ½å¯ä»¥åŸºäºŽæŒ‡å®šçš„ä¼˜åŒ–è¿‡æ»¤å™¨ï¼ˆå¦‚åµŒå…¥ã€åŽ‹ç¼©ã€æ‹¼æŽ¥ã€åˆ†ç‰‡ç­‰ï¼‰å®žçŽ°åŠ¨æ€é‡å†™ï¼Œå¹¶ä¼˜åŒ–èµ„æºäº¤ä»˜æ–¹å¼ã€‚æ¯æ¬¡ä¼˜åŒ–éƒ½åœ¨è¯·æ±‚æ—¶åŠ¨æ€åº”ç”¨ï¼ˆå¹¶è¢«ç¼“å­˜ï¼‰ï¼Œæ•´ä¸ªä¼˜åŒ–è¿‡ç¨‹å®Œå…¨è‡ªåŠ¨åŒ–äº†ã€‚åœ¨åŠ¨æ€ä¼˜åŒ–ä¸‹ï¼ŒæœåŠ¡å™¨è¿˜å¯ä»¥æ ¹æ®æ‰€ç”¨åè®®ï¼Œç”šè‡³ç”¨æˆ·ä»£ç†çš„ç±»åž‹å’Œç‰ˆæœ¬è°ƒæ•´ä¼˜åŒ–ç­–ç•¥ã€‚æ¯”å¦‚ï¼Œå¯ä»¥é…ç½® mod_pagespeed æ¨¡å—ï¼Œåœ¨å®¢æˆ·ç«¯ä½¿ç”¨ HTTP 2.0 æ—¶è·³è¿‡æŸäº›ä¼˜åŒ–ï¼š 12345678# å¯¹ SPDY/HTTP 2.0 å®¢æˆ·ç«¯ç¦ç”¨æ‹¼æŽ¥&lt;ModPagespeedIf spdy&gt;ModPagespeedDisableFilters combine_css,combine_javascript&lt;/ModPagespeedIf&gt;# åªå¯¹ HTTP 1.x å®¢æˆ·ç«¯ä½¿ç”¨åŸŸååˆ†åŒº&lt;ModPagespeedIf !spdy&gt;ModPagespeedShardDomain www.site.com s1.site.com,s2.site.com&lt;/ModPagespeedIf&gt; ä½¿ç”¨ PageSpeed è¿™æ ·çš„è‡ªåŠ¨ Web ä¼˜åŒ–åº“ï¼Œå¯ä»¥è®©æˆ‘ä»¬çœåŽ»ä¸å°‘éº»çƒ¦ï¼Œå€¼å¾—è€ƒè™‘ã€‚ 1.xä¸Ž2.0çš„ç›¸äº’è½¬æ¢é™¤äº†åŒåè®®ä¼˜åŒ–ç­–ç•¥ï¼Œå¾ˆå¤šå·²éƒ¨ç½²çš„åº”ç”¨éƒ½éœ€è¦åœ¨è‡ªå·±çš„åº”ç”¨æœåŠ¡å™¨ä¸Šé‡‡å–ä¸€ç§æŠ˜ä¸­æ–¹æ¡ˆï¼šä¸¤ç«¯éƒ½æ˜¯ HTTP 2.0 æ˜¯è¿½æ±‚æœ€ä½³æ€§èƒ½çš„ç›®æ ‡ï¼Œä½†ï¼ˆæ–°å¢žï¼‰ä¸€ä¸ªè½¬æ¢å±‚ï¼ˆå›¾13-2ï¼‰ä¹Ÿå¯ä»¥è®© 1.x æœåŠ¡å™¨åˆ©ç”¨ HTTP 2.0ã€‚ ä¸€å°å±…é—´æœåŠ¡å™¨å¯ä»¥æŽ¥å— HTTP 2.0 ä¼šè¯ï¼Œå¤„ç†ä¹‹åŽå†å‘æ—¢æœ‰åŸºç¡€è®¾æ–½åˆ†æ´¾ 1.x æ ¼å¼çš„è¯·æ±‚ã€‚æŽ¥åˆ°å“åº”åŽï¼Œå†å°†å…¶è½¬æ¢æˆ HTTP 2.0 çš„æµå¹¶è¿”å›žå®¢æˆ·ç«¯ã€‚é€šå¸¸ï¼Œè¿™æ˜¯åº”ç”¨ HTTP 2.0 æ›´æ–°çš„æœ€ç®€å•æ–¹å¼ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥é‡ç”¨å·²æœ‰çš„ 1.x åŸºç¡€è®¾æ–½ï¼Œè€Œä¸”åŸºæœ¬ä¸ç”¨ä¿®æ”¹ã€‚ å¤§å¤šæ•°æ”¯æŒ HTTP 2.0 çš„ Web æœåŠ¡å™¨é»˜è®¤éƒ½æä¾› 2.0 åˆ° 1.x çš„è½¬æ¢æœºåˆ¶ï¼š2.0 ä¼šè¯ç»ˆæ­¢äºŽæœåŠ¡å™¨ï¼ˆApache æˆ– Nginxï¼‰ï¼Œå¦‚æžœæœåŠ¡å™¨è¢«é…ç½®ä¸ºåå‘ä»£ç†ï¼Œé‚£ä¹ˆåˆ†æ´¾ç»™å…·ä½“åº”ç”¨æœåŠ¡å™¨çš„å°±æ˜¯ 1.x è¯·æ±‚ã€‚ ç„¶è€Œï¼Œ2.0 åˆ° 1.x çš„è¿™ç§ç®€å•ç­–ç•¥å¹¶éžé•¿ä¹…ä¹‹è®¡ã€‚ä»Žå¾ˆå¤šæ–¹é¢æ¥è¯´ï¼Œè¿™ç§å·¥ä½œæµå®žé™…æ˜¯ä¸€ç§å€’é€€ã€‚çœŸæ­£æ­£ç¡®çš„åšæ³•ï¼Œä¸æ˜¯æŠŠä¼˜åŒ–çš„ã€å¯å¤ç”¨çš„ä¼šè¯è½¬æ¢æˆä¸€ç³»åˆ— 1.xè¯·æ±‚ï¼Œå› åŸºç¡€è®¾æ–½è€ŒåºŸä¼˜åŒ–ï¼Œè€Œæ˜¯ç›¸åï¼šæŠŠæŽ¥æ”¶åˆ°çš„ 1.x å®¢æˆ·ç«¯è¯·æ±‚è½¬æ¢æˆ 2.0 æµï¼Œå¹¶æŠŠæˆ‘ä»¬çš„åŸºç¡€è®¾æ–½æ ‡å‡†åŒ–ï¼Œä½¿å…¶åœ¨ä»»ä½•æ—¶å€™éƒ½å¤„ç† 2.0 ä¼šè¯ã€‚ ä¸ºèŽ·å¾—æœ€ä½³æ€§èƒ½ï¼ŒåŒæ—¶å®žçŽ°ä½Žå»¶è¿Ÿå’Œå®žæ—¶çš„ Web åº”ç”¨ï¼Œåº”è¯¥è¦æ±‚æˆ‘ä»¬çš„å†…éƒ¨åŸºç¡€è®¾æ–½è¾¾åˆ°å¦‚ä¸‹æ ‡å‡†ï¼š è´Ÿè½½å‡è¡¡å™¨å’Œä»£ç†ä¸Žåº”ç”¨çš„è¿žæŽ¥åº”è¯¥æŒä¹…åŒ–ï¼› è¯·æ±‚å’Œå“åº”æµåŠå¤šè·¯å¤ç”¨åº”è¯¥æ˜¯é»˜è®¤é…ç½®ï¼› ä¸Žåº”ç”¨æœåŠ¡å™¨çš„é€šä¿¡åº”è¯¥åŸºäºŽæ¶ˆæ¯ï¼› å®¢æˆ·ç«¯ä¸Žåº”ç”¨æœåŠ¡å™¨çš„é€šä¿¡åº”è¯¥æ˜¯åŒå‘çš„ã€‚ ç«¯åˆ°ç«¯çš„ HTTP 2.0 ä¼šè¯ç¬¦åˆä¸Šè¿°æ‰€æœ‰æ¡ä»¶ï¼Œèƒ½å®žçŽ°å¯¹å®¢æˆ·ç«¯ä»¥åŠæ•°æ®ä¸­å¿ƒå†…éƒ¨çš„ä½Žå»¶è¿Ÿäº¤ä»˜ï¼šæ— éœ€å®šåˆ¶çš„ RPC å±‚åŠç›¸åº”æœºåˆ¶ï¼Œå°±èƒ½å®žçŽ°å†…éƒ¨æœåŠ¡ä¹‹é—´çš„é€šä¿¡ï¼Œå¹¶èŽ·å¾—ç†æƒ³çš„æ€§èƒ½ã€‚ç®€è¨€ä¹‹ï¼Œä¸è¦æŠŠ 2.0 é™çº§åˆ° 1.xï¼Œè¿™ä¸æ˜¯é•¿ä¹…ä¹‹è®¡ã€‚é•¿ä¹…ä¹‹è®¡æ˜¯æŠŠ1.x å‡çº§åˆ° 2.0ï¼Œè¿™æ ·æ‰èƒ½æ±‚å¾—æœ€ä½³æ€§èƒ½ã€‚ è¯„ä¼°æœåŠ¡å™¨è´¨é‡ä¸Žæ€§èƒ½HTTP 2.0 æœåŠ¡å™¨å®žçŽ°çš„è´¨é‡å¯¹å®¢æˆ·ç«¯æ€§èƒ½å½±å“å¾ˆå¤§ã€‚HTTP æœåŠ¡å™¨çš„é…ç½®å½“ç„¶æ˜¯ä¸€ä¸ªé‡è¦å› ç´ ï¼Œä½†æœåŠ¡å™¨å®žçŽ°é€»è¾‘çš„è´¨é‡åŒæ ·ä¸Žä¼˜å…ˆçº§ã€æœåŠ¡å™¨æŽ¨é€ã€å¤šè·¯å¤ç”¨ç­‰æ€§èƒ½æœºåˆ¶çš„å‘æŒ¥ç´§å¯†ç›¸å…³ã€‚ HTTP 2.0 æœåŠ¡å™¨å¿…é¡»ç†è§£æµä¼˜å…ˆçº§ï¼› HTTP 2.0 æœåŠ¡å™¨å¿…é¡»æ ¹æ®ä¼˜å…ˆçº§å¤„ç†å“åº”å’Œäº¤ä»˜èµ„æºï¼› HTTP 2.0 æœåŠ¡å™¨å¿…é¡»æ”¯æŒæœåŠ¡å™¨æŽ¨é€ï¼› HTTP 2.0 æœåŠ¡å™¨åº”è¯¥æä¾›ä¸åŒæŽ¨é€ç­–ç•¥çš„å®žçŽ°ã€‚ HTTP 2.0 æœåŠ¡å™¨çš„åˆçº§å®žçŽ°ä¹Ÿèƒ½æ”¯æŒæŸäº›åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ˜Žç¡®æ”¯æŒè¯·æ±‚çš„ä¼˜å…ˆçº§å’ŒæœåŠ¡å™¨æŽ¨é€ï¼Œå¯èƒ½å¯¼è‡´æ¬¡ä¼˜æ€§èƒ½ã€‚æ¯”å¦‚ï¼Œå‘é€å¤§åž‹ã€é™æ€å›¾ç‰‡å¯¼è‡´å¸¦å®½é¥±å’Œï¼Œè€Œå®¢æˆ·ç«¯åˆå› ä¸ºå…¶ä»–é‡è¦èµ„æºï¼ˆå¦‚ CSS æˆ– JavaScriptï¼‰è¢«é˜»å¡žã€‚ ä¸ºå°½å¯èƒ½èŽ·å¾—æœ€ä½³æ€§èƒ½ï¼ŒHTTP 2.0 å®¢æˆ·ç«¯å¿…é¡»æ˜¯ä¸ªâ€œä¹è§‚ä¸»ä¹‰è€…â€ï¼šå°½å¯èƒ½æ—©åœ°å‘é€æ‰€æœ‰è¯·æ±‚ï¼Œç„¶åŽå®Œå…¨å¬å‡­æœåŠ¡å™¨çš„ä¼˜åŒ–ã€‚äº‹å®žä¸Šï¼ŒHTTP 2.0 å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨çš„ä¾èµ–ç¨‹åº¦è¾ƒä¹‹ä»¥å‰æ›´ç”šã€‚ 2.0ä¸ŽTLSå®žè·µä¸­ï¼Œç”±äºŽå­˜åœ¨å¾ˆå¤šä¸å…¼å®¹çš„ä¸­é—´ä»£ç†ï¼Œæ—©æœŸçš„ HTTP 2.0 éƒ¨ç½²å¿…ç„¶ä¾èµ–åŠ å¯†ä¿¡é“ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±é¢ä¸´ä¸¤ç§å¯èƒ½å‡ºçŽ° ALPN åå•†å’Œ TLS ç»ˆæ­¢çš„æƒ…å†µï¼š TLS è¿žæŽ¥å¯èƒ½ä¼šåœ¨ HTTP 2.0 æœåŠ¡å™¨ä¸Šç»ˆæ­¢ï¼› TLS è¿žæŽ¥å¯èƒ½ä¼šåœ¨ä¸Šæ¸¸ï¼ˆå¦‚è´Ÿè½½å‡è¡¡å™¨ï¼‰ä¸Šç»ˆæ­¢ã€‚ ç¬¬ä¸€ç§æƒ…å†µè¦æ±‚ HTTP 2.0 æœåŠ¡å™¨èƒ½å¤Ÿå¤„ç† TLSï¼Œé™¤æ­¤ä¹‹å¤–å°±æ²¡æœ‰ä»€ä¹ˆäº†ã€‚ç¬¬äºŒç§æƒ…å†µå¤æ‚ä¸€äº›ï¼šTLS+ALPN æ¡æ‰‹å¯èƒ½ä¼šåœ¨ä¸Šæ¸¸ä»£ç†å¤„ç»ˆæ­¢ï¼ˆå›¾ 13-3ï¼‰ï¼Œç„¶åŽå†ä»Žé‚£é‡Œå»ºç«‹ä¸€æ¡åŠ å¯†ä¿¡é“ï¼Œæˆ–è€…ç›´æŽ¥å°†éžåŠ å¯†çš„ HTTP 2.0 æµå‘é€åˆ°æœåŠ¡å™¨ã€‚ ä»£ç†å’Œåº”ç”¨æœåŠ¡å™¨ä¹‹é—´ä½¿ç”¨å®‰å…¨ä¿¡é“è¿˜æ˜¯éžåŠ å¯†ä¿¡é“ï¼Œå–å†³äºŽåº”ç”¨ï¼šåªè¦èƒ½æŽ§åˆ¶ä¸­é—´è®¾å¤‡ï¼Œå°±å¯ä»¥ä¿è¯æœªåŠ å¯†çš„å¸§ä¸ä¼šè¢«ä¿®æ”¹æˆ–ä¸¢å¼ƒã€‚é‚£ä¹ˆï¼Œè™½ç„¶å¤§å¤šæ•° HTTP 2.0 æœåŠ¡å™¨éƒ½åº”è¯¥æ”¯æŒ TLS+ALPN åå•†ï¼Œä½†å®ƒä»¬åŒæ—¶ä¹Ÿåº”è¯¥åœ¨ä¸åŠ å¯†çš„æƒ…å†µä¸‹å®žçŽ°HTTP 2.0 é€šä¿¡ã€‚ å¦å¤–ï¼Œæ™ºèƒ½è´Ÿè½½å‡è¡¡å™¨ä¹Ÿå¯ä»¥ä½¿ç”¨ TLS+ALPN åå•†æœºåˆ¶ï¼Œæ ¹æ®åå•†åŽçš„åè®®ï¼Œé€‰æ‹©æ€§åœ°å°†ä¸åŒçš„å®¢æˆ·ç«¯è·¯ç”±åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚ è´Ÿè½½å‡è¡¡å™¨ã€ä»£ç†åŠåº”ç”¨æœåŠ¡å™¨æ ¹æ®çŽ°æœ‰åŸºç¡€è®¾æ–½ä»¥åŠåº”ç”¨çš„å¤æ‚ç¨‹åº¦å’Œè§„æ¨¡ï¼Œä½ çš„åŸºç¡€è®¾æ–½ä¸­å¯èƒ½éœ€è¦ä¸€å°æˆ–å¤šå°è´Ÿè½½å‡è¡¡å™¨ï¼ˆå›¾ 13-4ï¼‰æˆ–è€… HTTP 2.0 ä»£ç†ã€‚ æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼ŒHTTP 2.0 æœåŠ¡å™¨ä¸Žå®¢æˆ·ç«¯ç›´æŽ¥å¯¹è¯ï¼Œå¹¶è´Ÿè´£å®Œæˆ TLS è¿žæŽ¥ï¼Œè¿›è¡Œ ALPN åå•†ï¼Œä»¥åŠå¤„ç†æ‰€æœ‰è¯·æ±‚ã€‚ ç„¶è€Œï¼Œä¸€å°æœåŠ¡å™¨å¯¹äºŽå¤§åž‹åº”ç”¨æ˜¯ä¸å¤Ÿçš„ã€‚å¤§åž‹åº”ç”¨å¿…é¡»è¦æ·»åŠ ä¸€å°è´Ÿè½½å‡è¡¡å™¨ï¼Œä»¥åˆ†æµå¤§é‡è¯·æ±‚ã€‚æ­¤æ—¶ï¼Œè´Ÿè½½å‡è¡¡å™¨å¯ä»¥ç»ˆæ­¢ TLS è¿žæŽ¥ï¼ˆå‚è§ ä¸ŠèŠ‚ â€œ2.0 ä¸ŽTLSâ€ï¼‰ï¼Œä¹Ÿå¯ä»¥ç»è¿‡é…ç½®ä½œä¸º TCP ä»£ç†å¹¶ç›´æŽ¥å°†åŠ å¯†æ•°æ®å‘é€ç»™åº”ç”¨æœåŠ¡å™¨ã€‚ å¾ˆå¤šäº‘æä¾›å•†ä¹Ÿä¼šæä¾›è´Ÿè½½å‡è¡¡å™¨æœåŠ¡ã€‚ç„¶è€Œï¼Œè¿™äº›è´Ÿè½½å‡è¡¡å™¨å¤§å¤šæ”¯æŒTLS ç»ˆæ­¢ï¼Œå´ä¸æ”¯æŒ ALPN åå•†ï¼Œè€Œè¿™å¯¹äºŽé€šè¿‡ TLS å®žçŽ° HTTP 2.0 é€šä¿¡æ˜¯å¿…éœ€çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥å°†è´Ÿè½½å‡è¡¡å™¨é…ç½®ä¸º TCP ä»£ç†ï¼Œå³é€šè¿‡å®ƒä»¬å°†åŠ å¯†æ•°æ®å‘é€ç»™åº”ç”¨æœåŠ¡å™¨ï¼Œè®©åº”ç”¨æœåŠ¡å™¨å®Œæˆ TLS+ALPN åå•†ã€‚ å®žè·µä¸­ï¼Œè¦å›žç­”çš„æœ€é‡è¦çš„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä½ çš„åŸºç¡€è®¾æ–½ä¸­çš„å“ªä¸ªç»„ä»¶è´Ÿè´£ç»ˆæ­¢TLS è¿žæŽ¥ï¼Œä»¥åŠå®ƒæ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œå¿…è¦çš„ ALPN åå•†ï¼Ÿ è¦åœ¨ TLS ä¹‹ä¸Šå®žçŽ° HTTP 2.0 é€šä¿¡ï¼Œç»ˆç«¯æœåŠ¡å™¨å¿…é¡»æ”¯æŒ ALPNï¼› å°½å¯èƒ½åœ¨æŽ¥è¿‘ç”¨æˆ·çš„åœ°æ–¹ç»ˆæ­¢ TLSï¼› å¦‚æžœæ— æ³•æ”¯æŒ ALPNï¼Œé‚£ä¹ˆé€‰æ‹© TCP è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼› å¦‚æžœæ— æ³•æ”¯æŒ ALPN ä¸” TCP è´Ÿè½½å‡è¡¡ä¹Ÿåšä¸åˆ°ï¼Œé‚£ä¹ˆå°±é€€è€Œæ±‚å…¶æ¬¡ï¼Œåœ¨éžåŠ å¯† ä¿¡é“ä¸Šä½¿ç”¨ HTTP çš„ Upgrade æµ æµè§ˆå™¨APIä¸Žåè®®æµè§ˆå™¨ç½‘ç»œæ¦‚è¿° è¿žæŽ¥ç®¡ç†ä¸Žä¼˜åŒ–è¿è¡Œåœ¨æµè§ˆå™¨ä¸­çš„ Web åº”ç”¨å¹¶ä¸è´Ÿè´£ç®¡ç†ä¸ªåˆ«ç½‘ç»œå¥—æŽ¥å­—çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™æ˜¯å¥½äº‹ã€‚é€šè¿‡æŠŠè¿™ä¸ªä»»åŠ¡å§”æ‰˜ç»™æµè§ˆå™¨ï¼Œå¯ä»¥è‡ªåŠ¨åŒ–å¾ˆå¤šé‡è¦çš„æ€§èƒ½ä¼˜åŒ–ä»»åŠ¡ï¼ŒåŒ…æ‹¬å¥—æŽ¥å­—é‡ç”¨ã€è¯·æ±‚ä¼˜å…ˆçº§æŽ’å®šã€æ™šç»‘å®šã€åè®®åå•†ã€æ–½åŠ è¿žæŽ¥æ•°é™åˆ¶ï¼Œç­‰ç­‰ã€‚äº‹å®žä¸Šï¼Œæµè§ˆå™¨æ˜¯æœ‰æ„æŠŠè¯·æ±‚ç®¡ç†ç”Ÿå‘½å‘¨æœŸä¸Žå¥—æŽ¥å­—ç®¡ç†åˆ†å¼€çš„ã€‚è¿™ä¸€ç‚¹å¾ˆå¾®å¦™ï¼Œä½†å´è‡³å…³é‡è¦ã€‚ å¥—æŽ¥å­—æ˜¯ä»¥æ± çš„å½¢å¼è¿›è¡Œç®¡ç†çš„ï¼ˆå›¾ 14-2ï¼‰ï¼Œå³æŒ‰ç…§æ¥æºï¼Œæ¯ä¸ªæ± éƒ½æœ‰è‡ªå·±çš„è¿žæŽ¥é™åˆ¶å’Œå®‰å…¨çº¦æŸã€‚æŒ‚èµ·çš„è¯·æ±‚æ˜¯æŽ’å¥½é˜Ÿçš„ã€æœ‰ä¼˜å…ˆæ¬¡åºçš„ï¼Œç„¶åŽå†é€‚æ—¶æŠŠå®ƒä»¬ç»‘å®šåˆ°æ± ä¸­ä¸ªåˆ«çš„å¥—æŽ¥å­—ä¸Šã€‚é™¤éžæœåŠ¡å™¨æœ‰æ„å…³é—­è¿žæŽ¥ï¼Œå¦åˆ™åŒä¸€ä¸ªå¥—æŽ¥å­—å¯ä»¥è‡ªåŠ¨ç”¨äºŽå¤šä¸ªè¯·æ±‚ï¼ æ¥æºç”±åº”ç”¨åè®®ã€åŸŸåå’Œç«¯å£ä¸‰ä¸ªè¦ä»¶æž„æˆï¼Œæ¯”å¦‚ (http, www.example.com, 80) ä¸Ž(https, www.example.com, 443) å°±æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¥æºã€‚ å¥—æŽ¥å­—æ± å±žäºŽåŒä¸€ä¸ªæ¥æºçš„ä¸€ç»„å¥—æŽ¥å­—ã€‚å®žè·µä¸­ï¼Œæ‰€æœ‰ä¸»æµæµè§ˆå™¨çš„æœ€å¤§æ± è§„æ¨¡éƒ½æ˜¯ 6 ä¸ªå¥—æŽ¥å­—ã€‚ è‡ªåŠ¨åŒ–çš„å¥—æŽ¥å­—æ± ç®¡ç†ä¼šè‡ªåŠ¨é‡ç”¨ TCP è¿žæŽ¥ï¼Œä»Žè€Œæœ‰æ•ˆä¿éšœæ€§èƒ½ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿™ç§æž¶æž„è®¾è®¡è¿˜æä¾›äº†å…¶ä»–ä¼˜åŒ–çš„æœºä¼šï¼š æµè§ˆå™¨å¯ä»¥æŒ‰ç…§ä¼˜å…ˆæ¬¡åºå‘é€æŽ’é˜Ÿçš„è¯·æ±‚ï¼› æµè§ˆå™¨å¯ä»¥é‡ç”¨å¥—æŽ¥å­—ä»¥æœ€å°åŒ–å»¶è¿Ÿå¹¶æå‡åžåé‡ï¼› æµè§ˆå™¨å¯ä»¥é¢„æµ‹è¯·æ±‚æå‰æ‰“å¼€å¥—æŽ¥å­—ï¼› æµè§ˆå™¨å¯ä»¥ä¼˜åŒ–ä½•æ—¶å…³é—­ç©ºé—²å¥—æŽ¥å­—ï¼› æµè§ˆå™¨å¯ä»¥ä¼˜åŒ–åˆ†é…ç»™æ‰€æœ‰å¥—æŽ¥å­—çš„å¸¦å®½ã€‚ è°·æ­Œ Chrome çš„æŽ¨æµ‹æ€§ç½‘ç»œä¼˜åŒ–æˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼ŒçŽ°ä»£æµè§ˆå™¨çš„ç½‘ç»œç»„ä»¶å¹¶éžä¸€ä¸ªå¥—æŽ¥å­—ç®¡ç†å™¨é‚£ä¹ˆç®€å•ã€‚ä½†æ˜¯ï¼Œå³ä½¿å¦‚æ­¤æœ‰æ—¶å€™ä¹Ÿè¶³ä»¥å®¢è§‚åœ°è¯„ä»·çŽ°ä»£æµè§ˆå™¨ä¸­çš„æŸäº›ä¼˜åŒ–æŠ€æœ¯ã€‚æ¯”å¦‚ï¼Œä½ ä½¿ç”¨è°·æ­Œ Chrome æµè§ˆå™¨çš„æ¬¡æ•°è¶Šå¤šï¼Œå®ƒçš„é€Ÿåº¦å°±ä¼šè¶Šå¿«ã€‚Chrome ä¼šå­¦ä¹ è®¿é—®è¿‡çš„ç«™ç‚¹çš„æ‹“æ‰‘ï¼Œä»¥åŠå¸¸è§çš„æµè§ˆæ¨¡å¼ï¼Œç„¶åŽåˆ©ç”¨è¿™äº›ä¿¡æ¯è¿›è¡Œå„ç§â€œæŽ¨æµ‹æ€§ä¼˜åŒ–â€ï¼Œä»¥é¢„æµ‹ç”¨æˆ·ä¸‹ä¸€æ­¥çš„æ“ä½œï¼Œä»Žè€Œæ¶ˆé™¤ä¸å¿…è¦çš„ç½‘ç»œå»¶è¿Ÿï¼šDNS é¢„è§£æžã€TCP é¢„è¿žæŽ¥ã€é¡µé¢é¢„æ¸²æŸ“ï¼Œç­‰ç­‰ã€‚åƒé¼ æ ‡æ‚¬åœåœ¨é“¾æŽ¥ä¸Šè¿™ä¹ˆä¸ªç®€å•çš„åŠ¨ä½œï¼Œå°±å¯ä»¥è§¦å‘æµè§ˆå™¨å‘å…¶ç½‘ç»œç»„ä»¶çš„â€œé¢„æµ‹å™¨â€å‘é€ä¿¡å·ï¼ŒåŽè€…åˆ™ä¼šä¾æ®è¿‡å¾€çš„æ€§èƒ½æ•°æ®é€‰æ‹©æœ€ä½³çš„ä¼˜åŒ–æŽªæ–½ã€‚å¦‚æžœä½ å¯¹Chrome æµè§ˆå™¨çš„ç½‘ç»œä¼˜åŒ–æŠ€æœ¯æ„Ÿå…´è¶£ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« â€œHigh Performance Networking in Google Chromeâ€ï¼šhttp://hpbn.co/chrome-networkingã€‚ ç½‘ç»œå®‰å…¨ä¸Žæ²™ç®±å°†ä¸ªåˆ«å¥—æŽ¥å­—çš„ç®¡ç†ä»»åŠ¡å§”æ‰˜ç»™æµè§ˆå™¨è¿˜æœ‰å¦ä¸€ä¸ªé‡è¦çš„ç”¨æ„ï¼šå¯ä»¥è®©æµè§ˆå™¨è¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œå¯¹ä¸å—ä¿¡ä»»çš„åº”ç”¨ä»£ç é‡‡å–ä¸€è‡´çš„å®‰å…¨ä¸Žç­–ç•¥é™åˆ¶ã€‚æ¯”å¦‚ï¼Œæµè§ˆå™¨ä¸å…è®¸ç›´æŽ¥è®¿é—®åŽŸå§‹ç½‘ç»œå¥—æŽ¥å­— APIï¼Œå› ä¸ºè¿™æ ·ç»™æ¶æ„åº”ç”¨å‘ä»»æ„ä¸»æœºå‘èµ·ä»»æ„è¯·æ±‚ï¼ˆç«¯å£æ‰«æã€è¿žæŽ¥é‚®ä»¶æœåŠ¡å™¨æˆ–å‘é€æœªçŸ¥æ¶ˆæ¯ï¼‰æä¾›å¯ä¹˜ä¹‹æœºã€‚ è¿žæŽ¥é™åˆ¶æµè§ˆå™¨ç®¡ç†æ‰€æœ‰æ‰“å¼€çš„å¥—æŽ¥å­—æ± å¹¶å¼ºåˆ¶æ–½åŠ è¿žæŽ¥æ•°é™åˆ¶ï¼Œä¿æŠ¤å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„èµ„æºä¸ä¼šè¢«è€—å°½ã€‚ è¯·æ±‚æ ¼å¼åŒ–ä¸Žå“åº”å¤„ç†æµè§ˆå™¨æ ¼å¼åŒ–æ‰€æœ‰å¤–å‘è¯·æ±‚ä»¥ä¿è¯æ ¼å¼ä¸€è‡´å’Œç¬¦åˆåè®®çš„è¯­ä¹‰ï¼Œä»Žè€Œä¿æŠ¤æœåŠ¡å™¨ã€‚ç±»ä¼¼åœ°ï¼Œå“åº”è§£ç ä¹Ÿä¼šè‡ªåŠ¨å®Œæˆï¼Œä»¥ä¿æŠ¤ç”¨æˆ·ã€‚ TLS åå•†æµè§ˆå™¨æ‰§è¡Œ TLS æ¡æ‰‹å’Œå¿…è¦çš„è¯ä¹¦æ£€æŸ¥ã€‚ä»»ä½•è¯ä¹¦æœ‰é—®é¢˜ï¼ˆæ¯”å¦‚æœåŠ¡å™¨æ­£åœ¨ä½¿ç”¨è‡ªå·²ç­¾å‘çš„è¯ä¹¦ï¼‰ï¼Œç”¨æˆ·éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ã€‚ åŒæºç­–ç•¥æµè§ˆå™¨ä¼šé™åˆ¶åº”ç”¨åªèƒ½å‘å“ªä¸ªæ¥æºå‘é€è¯·æ±‚ã€‚ ä»¥ä¸Šåˆ—å‡ºçš„å®‰å…¨é™åˆ¶æœºåˆ¶åªæ˜¯ä¸€éƒ¨åˆ†ï¼Œä½†å·²ç»å¯ä»¥ä½“çŽ°â€œæœ€ä½Žç‰¹æƒâ€ï¼ˆleast privilegeï¼‰åŽŸåˆ™äº†ã€‚æµè§ˆå™¨åªå‘åº”ç”¨ä»£ç å…¬å¼€é‚£äº›å¿…è¦çš„ API å’Œèµ„æºï¼šåº”ç”¨æä¾›æ•°æ®å’Œ URLï¼Œæµè§ˆå™¨æ‰§è¡Œè¯·æ±‚å¹¶è´Ÿè´£ç®¡ç†æ¯ä¸ªè¿žæŽ¥çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚ æœ‰å¿…è¦æä¸€å¥ï¼Œå¹¶æ²¡æœ‰å•ç‹¬ä¸€æ¡åŽŸåˆ™å«â€œåŒæºç­–ç•¥â€ã€‚å®žé™…ä¸Šï¼Œè¿™æ˜¯ä¸€ç»„ç›¸å…³çš„æœºåˆ¶ï¼Œæ¶‰åŠå¯¹ DOM è®¿é—®ã€cookie å’Œä¼šè¯çŠ¶æ€ç®¡ç†ã€ç½‘ç»œåŠå…¶ä»–æµè§ˆå™¨ç»„ä»¶çš„é™åˆ¶ã€‚ èµ„æºä¸Žå®¢æˆ·ç«¯çŠ¶æ€ç¼“å­˜æœ€å¥½æœ€å¿«çš„è¯·æ±‚æ˜¯æ²¡æœ‰è¯·æ±‚ã€‚åœ¨åˆ†æ´¾è¯·æ±‚ä¹‹å‰ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ£€æŸ¥å…¶èµ„æºç¼“å­˜ï¼Œæ‰§è¡Œå¿…è¦çš„éªŒè¯ï¼Œç„¶åŽåœ¨æ»¡è¶³é™åˆ¶æ¡ä»¶çš„æƒ…å†µä¸‹è¿”å›žèµ„æºçš„æœ¬åœ°å‰¯æœ¬ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æžœæŸæœ¬åœ°èµ„æºä¸åœ¨ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼Œå°†å“åº”è‡ªåŠ¨å¡«å……åˆ°ç¼“å­˜ä¸­ï¼Œä»¥å¤‡åŽç»­è®¿é—®ä½¿ç”¨ã€‚ æµè§ˆå™¨é’ˆå¯¹æ¯ä¸ªèµ„æºè‡ªåŠ¨æ‰§è¡Œç¼“å­˜æŒ‡ä»¤ã€‚ æµè§ˆå™¨ä¼šå°½å¯èƒ½æ¢å¤å¤±æ•ˆèµ„æºçš„æœ‰æ•ˆæ€§ã€‚ æµè§ˆå™¨ä¼šè‡ªåŠ¨ç®¡ç†ç¼“å­˜å¤§å°åŠèµ„æºå›žæ”¶ã€‚ æµè§ˆå™¨è¿˜æœ‰ä¸€ä¸ªç»å¸¸è¢«äººå¿½è§†çš„é‡è¦åŠŸèƒ½ï¼Œé‚£å°±æ˜¯æä¾›ä¼šè¯è®¤è¯å’Œ cookie ç®¡ç†ã€‚æµè§ˆå™¨ä¸ºæ¯ä¸ªæ¥æºç»´æŠ¤ç€ç‹¬ç«‹çš„ cookie å®¹å™¨ï¼Œä¸ºè¯»å†™æ–° cookieã€ä¼šè¯å’Œè®¤è¯æ•°æ®æä¾›å¿…è¦çš„åº”ç”¨åŠæœåŠ¡å™¨ APIï¼Œè¿˜ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨è¿½åŠ å’Œå¤„ç† HTTP é¦–éƒ¨ï¼Œè®©ä¸€åˆ‡éƒ½è‡ªåŠ¨åŒ–ã€‚ ä¸¾ä¸€ä¸ªç®€å•ä½†ç›´è§‚çš„ä¾‹å­ï¼Œå®ƒèƒ½è¯´æ˜ŽæŠŠä¼šè¯çŠ¶æ€ç®¡ç†å§”æ‰˜ç»™æµè§ˆå™¨çš„å¥½å¤„ï¼šè®¤è¯çš„ä¼šè¯å¯ä»¥åœ¨å¤šä¸ªæ ‡ç­¾é¡µæˆ–æµè§ˆå™¨å£é—´å…±äº«ï¼Œåä¹‹äº¦ç„¶ï¼›å¦‚æžœç”¨æˆ·åœ¨æŸä¸ªæ ‡ç­¾é¡µä¸­é€€å‡ºï¼Œé‚£ä¹ˆå…¶ä»–æ‰€æœ‰æ‰“å¼€çª—å£ä¸­çš„ä¼šè¯éƒ½å°†å¤±æ•ˆã€‚ åº”ç”¨APIä¸Žåè®® æˆ‘ä»¬åœ¨è¿™ä¸ªè¡¨ä¸­æœ‰æ„å¿½ç•¥äº† WebRTCï¼Œå› ä¸ºé‚£æ˜¯ä¸€ç§ç«¯åˆ°ç«¯çš„äº¤ä»˜æ¨¡åž‹ï¼Œä¸Ž XHRã€SSE å’Œ WebSocket åè®®æœ‰ç€æ ¹æœ¬çš„ä¸åŒã€‚ XMLHttpRequestXHRç®€å²å°½ç®¡åå­—é‡Œæœ‰ XML çš„ Xï¼ŒXHR ä¹Ÿä¸æ˜¯ä¸“é—¨é’ˆå¯¹ XML å¼€å‘çš„ã€‚è¿™åªæ˜¯å› ä¸º Internet Explorer 5 å½“åˆå‘å¸ƒå®ƒçš„æ—¶å€™ï¼ŒæŠŠå®ƒæ”¾åˆ° MSXML åº“é‡Œï¼Œè¿™æ‰â€œç»§æ‰¿â€äº†è¿™ä¸ª Xã€‚ è·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰XHR æ˜¯ä¸€ä¸ªæµè§ˆå™¨å±‚é¢çš„ APIï¼Œå‘æˆ‘ä»¬éšè—äº†å¤§é‡åº•å±‚å¤„ç†ï¼ŒåŒ…æ‹¬ç¼“å­˜ã€é‡å®šå‘ã€å†…å®¹åå•†ã€è®¤è¯ï¼Œç­‰ç­‰ã€‚è¿™æ ·åšæœ‰ä¸¤ä¸ªç›®çš„ã€‚ç¬¬ä¸€ï¼ŒXHR çš„ API å› æ­¤éžå¸¸ç®€å•ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä¸“æ³¨ä¸šåŠ¡é€»è¾‘ã€‚å…¶æ¬¡ï¼Œæµè§ˆå™¨å¯ä»¥é‡‡ç”¨æ²™ç®±æœºåˆ¶ï¼Œå¯¹åº”ç”¨ä»£ç å¼ºåˆ¶æ–½åŠ ä¸€å¥—å®‰å…¨é™åˆ¶ã€‚ XHR æŽ¥å£å¼ºåˆ¶è¦æ±‚æ¯ä¸ªè¯·æ±‚éƒ½ä¸¥æ ¼å…·å¤‡ HTTP è¯­ä¹‰ï¼šåº”ç”¨æä¾›æ•°æ®å’Œ URLï¼Œæµè§ˆå™¨æ ¼å¼åŒ–è¯·æ±‚å¹¶ç®¡ç†æ¯ä¸ªè¿žæŽ¥çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚ç±»ä¼¼åœ°ï¼Œè™½ç„¶ XHR API å…è®¸åº”ç”¨æ·»åŠ è‡ªå®šä¹‰çš„ HTTP é¦–éƒ¨ï¼ˆé€šè¿‡ setRequestHeader() æ–¹æ³•ï¼‰ï¼ŒåŒæ—¶ä¹Ÿæœ‰ä¸€äº›é¦–éƒ¨æ˜¯åº”ç”¨ä»£ç ä¸èƒ½è®¾å®šçš„ï¼š Accept-Charsetã€Accept-Encodingã€Access-Control-* Hostã€Upgradeã€Connectionã€Refererã€Origin Cookieã€Sec-*ã€Proxy-* ä»¥åŠå¾ˆå¤šå…¶ä»–é¦–éƒ¨ æµè§ˆå™¨ä¼šæ‹’ç»å¯¹ä¸å®‰å…¨é¦–éƒ¨çš„é‡å†™ï¼Œä»¥æ­¤ä¿è¯åº”ç”¨ä¸èƒ½å‡æ‰®ç”¨æˆ·ä»£ç†ã€ç”¨æˆ·æˆ–è¯·æ±‚æ¥æºã€‚äº‹å®žä¸Šï¼Œä¿æŠ¤æ¥æºï¼ˆOriginï¼‰é¦–éƒ¨ç‰¹åˆ«é‡è¦ï¼Œå› ä¸ºè¿™æ˜¯å¯¹æ‰€æœ‰ XHR è¯·æ±‚åº”ç”¨â€œåŒæºç­–ç•¥â€çš„å…³é”®ã€‚ ä¸€ä¸ªâ€œæºâ€ç”±åº”ç”¨åè®®ã€åŸŸåå’Œç«¯å£è¿™ä¸‰ä¸ªè¦ä»¶å…±åŒå®šä¹‰ã€‚æ¯”å¦‚ï¼Œ(http,example.com, 80) å’Œ (https, example.com, 443) å°±æ˜¯ä¸åŒçš„æºã€‚ åŒæºç­–ç•¥çš„å‡ºå‘ç‚¹å¾ˆç®€å•ï¼šæµè§ˆå™¨å­˜å‚¨ç€ç”¨æˆ·æ•°æ®ï¼Œæ¯”å¦‚è®¤è¯ä»¤ç‰Œã€cookie åŠå…¶ä»–ç§æœ‰å…ƒæ•°æ®ï¼Œè¿™äº›æ•°æ®ä¸èƒ½æ³„éœ²ç»™å…¶ä»–åº”ç”¨ã€‚å¦‚æžœæ²¡æœ‰åŒæºæ²™ç®±ï¼Œé‚£ä¹ˆ example.com ä¸­çš„è„šæœ¬å°±å¯ä»¥è®¿é—®å¹¶æ“çºµ thirdparty.com çš„ç”¨æˆ·æ•°æ®ï¼ ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒXHR çš„æ—©æœŸç‰ˆæœ¬éƒ½é™åˆ¶åº”ç”¨åªèƒ½æ‰§è¡ŒåŒæºè¯·æ±‚ï¼Œå³æ–°è¯·æ±‚çš„æ¥æºå¿…é¡»ä¸Žæ—§è¯·æ±‚çš„æ¥æºä¸€è‡´ï¼šæ¥è‡ª example.com çš„ XHR è¯·æ±‚ï¼Œåªèƒ½ä»Ž example.com è¯·æ±‚å…¶ä»–èµ„æºã€‚å¦‚æžœåŽç»­è¯·æ±‚ä¸åŒæºï¼Œæµè§ˆå™¨å°±æ‹’ç»è¯¥ XHR è¯·æ±‚å¹¶æŠ¥é”™ã€‚ å¯æ˜¯ï¼Œåœ¨æŸäº›å¿…è¦çš„æƒ…å†µä¸‹ï¼ŒåŒæºç­–ç•¥ä¹Ÿä¼šç»™æ›´å¥½åœ°åˆ©ç”¨ XHR å¸¦æ¥éº»çƒ¦ï¼šå¦‚æžœæœåŠ¡å™¨æƒ³è¦ç»™å¦ä¸€ä¸ªç½‘ç«™ä¸­çš„è„šæœ¬æä¾›èµ„æºæ€Žä¹ˆåŠžï¼Ÿè¿™å°±æ˜¯ Cross-Origin Resource Sharingï¼ˆè·¨æºèµ„æºå…±äº«ï¼ŒCORSï¼‰çš„æ¥ç”±ï¼ CORS é’ˆå¯¹å®¢æˆ·ç«¯çš„è·¨æºè¯·æ±‚æä¾›äº†å®‰å…¨çš„é€‰æ‹©åŒæ„æœºåˆ¶ï¼š 123456789// è„šæœ¬æ¥æºï¼š (http, example.com, 80)var xhr = new XMLHttpRequest();xhr.open(&apos;GET&apos;, &apos;/resource.js&apos;); âžŠxhr.onload = function() &#123; ... &#125;;xhr.send();var cors_xhr = new XMLHttpRequest();cors_xhr.open(&apos;GET&apos;, &apos;http://thirdparty.com/resource.js&apos;); âž‹cors_xhr.onload = function() &#123; ... &#125;;cors_xhr.send(); âžŠ åŒæº XHR è¯·æ±‚âž‹ è·¨æº XHR è¯·æ±‚ CORS è¯·æ±‚ä¹Ÿä½¿ç”¨ç›¸åŒçš„ XHR APIï¼ŒåŒºåˆ«ä»…åœ¨äºŽè¯·æ±‚èµ„æºç”¨çš„ URL ä¸Žå½“å‰è„šæœ¬å¹¶ä¸åŒæºã€‚åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œå½“å‰æ‰§è¡Œçš„è„šæœ¬æ¥è‡ª (http, example.com, 80)ï¼Œè€Œç¬¬äºŒä¸ªXHR è¯·æ±‚è®¿é—®çš„ resource.js åˆ™æ¥è‡ª (http, thirdparty.com, 80)ã€‚ é’ˆå¯¹ CORS è¯·æ±‚çš„é€‰æ‹©åŒæ„è®¤è¯æœºåˆ¶ç”±åº•å±‚å¤„ç†ï¼šè¯·æ±‚å‘å‡ºåŽï¼Œæµè§ˆå™¨è‡ªåŠ¨è¿½åŠ å—ä¿æŠ¤çš„ Origin HTTP é¦–éƒ¨ï¼ŒåŒ…å«ç€å‘å‡ºè¯·æ±‚çš„æ¥æºã€‚ç›¸åº”åœ°ï¼Œè¿œç¨‹æœåŠ¡å™¨å¯ä»¥æ£€æŸ¥ Origin é¦–éƒ¨ï¼Œå†³å®šæ˜¯å¦æŽ¥å—è¯¥è¯·æ±‚ï¼Œå¦‚æžœæŽ¥å—å°±è¿”å›ž Access-Control-Allow-Origin å“åº”é¦–éƒ¨ï¼š 123456789=&gt; è¯·æ±‚GET /resource.js HTTP/1.1Host: thirdparty.comOrigin: http://example.com âžŠ...&lt;= å“åº”HTTP/1.1 200 OKAccess-Control-Allow-Origin: http://example.com âž‹... âžŠ Origin é¦–éƒ¨ç”±æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®âž‹ é€‰æ‹©åŒæ„é¦–éƒ¨ç”±æœåŠ¡å™¨è®¾ç½® åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œthirdparty.com å†³å®šåŒæ„ä¸Ž example.com è·¨æºå…±äº«èµ„æºï¼Œå› æ­¤å°±åœ¨å“åº”ä¸­è¿”å›žäº†é€‚å½“çš„è®¿é—®æŽ§åˆ¶é¦–éƒ¨ã€‚å‡å¦‚å®ƒé€‰æ‹©ä¸åŒæ„æŽ¥å—è¿™ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆåªè¦ä¸åœ¨å“åº”ä¸­åŒ…å« Access-Control-Allow-Origin é¦–éƒ¨å³å¯ã€‚è¿™æ ·ï¼Œå®¢æˆ·ç«¯çš„æµè§ˆå™¨å°±ä¼šè‡ªåŠ¨å°†å‘å‡ºçš„è¯·æ±‚ä½œåºŸã€‚ å¦‚æžœç¬¬ä¸‰æ–¹æœåŠ¡å™¨ä¸æ”¯æŒ CORSï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯è¯·æ±‚åŒæ ·ä¼šä½œåºŸï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¼šéªŒè¯å“åº”ä¸­æ˜¯å¦åŒ…å«é€‰æ‹©åŒæ„çš„é¦–éƒ¨ã€‚ä½œä¸ºä¸€ä¸ªç‰¹ä¾‹ï¼ŒCORS è¿˜å…è®¸æœåŠ¡å™¨è¿”å›žä¸€ä¸ªé€šé…å€¼ ( Access-Control-Allow-Origin: * )ï¼Œè¡¨ç¤ºå®ƒå…è®¸æ¥è‡ªä»»ä½•æºçš„è¯·æ±‚ã€‚ä¸è¿‡ï¼Œåœ¨å¯ç”¨è¿™ä¸ªé€‰é¡¹å‰ï¼Œè¯·å¤§å®¶åŠ¡å¿…ä¸‰æ€ï¼ è¿™å°±æ˜¯å…¨éƒ¨äº†å§ï¼Ÿå‡†ç¡®åœ°è®²ï¼Œä¸æ˜¯ã€‚å› ä¸º CORS è¿˜ä¼šæå‰é‡‡å–ä¸€ç³»åˆ—å®‰å…¨æŽªæ–½ï¼Œä»¥ç¡®ä¿æœåŠ¡å™¨æ”¯æŒ CORSï¼š CORS è¯·æ±‚ä¼šçœç•¥ cookie å’Œ HTTP è®¤è¯ç­‰ç”¨æˆ·å‡­æ®ï¼› å®¢æˆ·ç«¯è¢«é™åˆ¶åªèƒ½å‘é€â€œç®€å•çš„è·¨æºè¯·æ±‚â€ï¼ŒåŒ…æ‹¬åªèƒ½ä½¿ç”¨ç‰¹å®šçš„æ–¹æ³•ï¼ˆGETã€POST å’Œ HEADï¼‰ï¼Œä»¥åŠåªèƒ½è®¿é—®å¯ä»¥é€šè¿‡ XHR å‘é€å¹¶è¯»å–çš„ HTTP é¦–éƒ¨ã€‚ è¦å¯ç”¨ cookie å’Œ HTTP è®¤è¯ï¼Œå®¢æˆ·ç«¯å¿…é¡»åœ¨å‘é€è¯·æ±‚æ—¶é€šè¿‡ XHR å¯¹è±¡å‘é€é¢å¤–çš„å±žæ€§ï¼ˆ withCredentials ï¼‰ï¼Œè€ŒæœåŠ¡å™¨ä¹Ÿå¿…é¡»ä»¥é€‚å½“çš„é¦–éƒ¨ï¼ˆAccess-Control-Allow-Credentialsï¼‰å“åº”ï¼Œè¡¨ç¤ºå®ƒå…è®¸åº”ç”¨å‘é€ç”¨æˆ·çš„éšç§æ•°æ®ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æžœå®¢æˆ·ç«¯éœ€è¦å†™æˆ–è€…è¯»è‡ªå®šä¹‰çš„ HTTP é¦–éƒ¨ï¼Œæˆ–è€…æƒ³è¦ä½¿ç”¨â€œä¸ç®€å•çš„æ–¹æ³•â€å‘é€è¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»é¦–å…ˆè¦èŽ·å¾—ç¬¬ä¸‰æ–¹æœåŠ¡å™¨çš„è®¸å¯ï¼Œå³å‘ç¬¬ä¸‰æ–¹æœåŠ¡å™¨å‘é€ä¸€ä¸ªé¢„å¤‡ï¼ˆpreflightï¼‰è¯·æ±‚ï¼š 1234567891011121314=&gt; é¢„å¤‡è¯·æ±‚OPTIONS /resource.js HTTP/1.1 âžŠHost: thirdparty.comOrigin: http://example.comAccess-Control-Request-Method: POSTAccess-Control-Request-Headers: My-Custom-Header...&lt;= é¢„å¤‡å“åº”HTTP/1.1 200 OK âž‹Access-Control-Allow-Origin: http://example.comAccess-Control-Allow-Methods: GET, POST, PUTAccess-Control-Allow-Headers: My-Custom-Header...ï¼ˆæ­£å¼çš„ HTTP è¯·æ±‚ï¼‰ âžŒ âžŠ éªŒè¯è®¸å¯çš„é¢„å¤‡ OPTIONS è¯·æ±‚âž‹ ç¬¬ä¸‰æ–¹æºçš„æˆåŠŸé¢„å¤‡å“åº”âžŒ å®žé™…çš„ CORS è¯·æ±‚ W3C å®˜æ–¹çš„ CORS è§„èŒƒè§„å®šäº†ä½•æ—¶ä½•åœ°å¿…é¡»ä½¿ç”¨é¢„å¤‡è¯·æ±‚ï¼šâ€œç®€å•çš„â€è¯·æ±‚å¯ä»¥è·³è¿‡å®ƒï¼Œä½†å¾ˆå¤šæ¡ä»¶ä¸‹è¿™ä¸ªè¯·æ±‚éƒ½æ˜¯å¿…éœ€çš„ï¼Œå› æ­¤ä¹Ÿä¼šä¸ºéªŒè¯è®¸å¯è€Œå¢žåŠ ä»…æœ‰ä¸€æ¬¡å¾€è¿”çš„ç½‘ç»œå»¶è¿Ÿã€‚å¥½åœ¨ï¼Œåªè¦å®Œæˆé¢„å¤‡è¯·æ±‚ï¼Œå®¢æˆ·ç«¯å°±ä¼šå°†ç»“æžœç¼“å­˜èµ·æ¥ï¼ŒåŽç»­è¯·æ±‚å°±ä¸å¿…é‡å¤éªŒè¯äº†ã€‚ CORS å¾—åˆ°äº†æ‰€æœ‰çŽ°ä»£æµè§ˆå™¨æ”¯æŒï¼Œå‚è§ï¼šcaniuse.com/corsã€‚è¦å…¨é¢äº†è§£CORS çš„å„ç§ç­–ç•¥åŠå®žçŽ°ï¼Œè¯·å‚è€ƒ W3C å®˜æ–¹æ ‡å‡†ï¼ˆhttp://www.w3.org/TR/cors/ï¼‰ã€‚ é€šè¿‡XHRä¸‹è½½æ•°æ®æµè§ˆå™¨å¯ä»¥è‡ªåŠ¨è§£ç çš„æ•°æ®ç±»åž‹å¦‚ä¸‹: ArrayBufferå›ºå®šé•¿åº¦çš„äºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒºã€‚ BlobäºŒè¿›åˆ¶å¤§å¯¹è±¡æˆ–ä¸å¯å˜æ•°æ®ã€‚ Documentè§£æžåŽå¾—åˆ°çš„ HTML æˆ– XML æ–‡æ¡£ã€‚ JSONè¡¨ç¤ºç®€å•æ•°æ®ç»“æž„çš„ JavaScript å¯¹è±¡ã€‚ Textç®€å•çš„æ–‡æœ¬å­—ç¬¦ä¸²ã€‚ æµè§ˆå™¨å¯ä»¥ä¾é  HTTP çš„ content-type é¦–éƒ¨æ¥æŽ¨æ–­é€‚å½“çš„æ•°æ®ç±»åž‹ï¼ˆæ¯”å¦‚æŠŠapplication/json å“åº”è§£æžä¸º JSON å¯¹è±¡ï¼‰ï¼Œåº”ç”¨ä¹Ÿå¯ä»¥åœ¨å‘èµ· XHR è¯·æ±‚æ—¶æ˜¾å¼é‡å†™æ•°æ®ç±»åž‹ã€‚ è¿™é‡Œçš„äºŒè¿›åˆ¶å¤§å¯¹è±¡æŽ¥å£ï¼ˆ Blob ï¼‰å±žäºŽ HTML5 çš„ File APIï¼Œå°±åƒä¸€ä¸ªä¸é€æ˜Žçš„å¼•ç”¨ï¼Œå¯ä»¥æŒ‡å‘ä»»ä½•æ•°æ®å—ï¼ˆäºŒè¿›åˆ¶æˆ–æ–‡æœ¬ï¼‰ã€‚è¿™ä¸ªå¯¹è±¡æœ¬èº«æ²¡æœ‰å¤ªå¤šåŠŸèƒ½ï¼Œåªèƒ½æŸ¥è¯¢å…¶å¤§å°ã€MIME ç±»åž‹ï¼Œæˆ–å°†å®ƒåˆ‡åˆ†æˆæ›´å°çš„å—ã€‚è¿™ä¸ªå¯¹è±¡å­˜åœ¨çš„çœŸæ­£ç›®çš„ï¼Œæ˜¯ä½œä¸ºå„ç§ JavaScript API ä¹‹é—´çš„ä¸€ç§é«˜æ•ˆçš„äº’æ“ä½œæœºåˆ¶ã€‚ è¦ä¼°ç®—ä¼ è¾“å®Œæˆçš„æ•°æ®é‡ï¼ŒæœåŠ¡å™¨å¿…é¡»åœ¨å…¶å“åº”ä¸­æä¾›å†…å®¹é•¿åº¦ï¼ˆContent-Lengthï¼‰é¦–éƒ¨ã€‚è€Œå¯¹äºŽåˆ†å—æ•°æ®ï¼Œç”±äºŽå“åº”çš„æ€»é•¿åº¦æœªçŸ¥ï¼Œå› æ­¤å°±æ— æ³•ä¼°è®¡è¿›åº¦äº†ã€‚å¦å¤–ï¼ŒXHR è¯·æ±‚é»˜è®¤æ²¡æœ‰è¶…æ—¶é™åˆ¶ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªè¯·æ±‚çš„â€œè¿›åº¦â€å¯ä»¥æ— é™é•¿ã€‚ä½œä¸ºæœ€ä½³å®žè·µï¼Œä¸€å®šè¦ä¸ºåº”ç”¨è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œå¹¶é€‚å½“å¤„ç†é”™è¯¯ã€‚ æœåŠ¡å™¨å‘é€äº‹ä»¶Server-Sent Eventsï¼ˆSSEï¼‰è®©æœåŠ¡å™¨å¯ä»¥å‘å®¢æˆ·ç«¯æµå¼å‘é€æ–‡æœ¬æ¶ˆæ¯ï¼Œæ¯”å¦‚æœåŠ¡å™¨ä¸Šç”Ÿæˆçš„å®žæ—¶é€šçŸ¥æˆ–æ›´æ–°ã€‚ä¸ºè¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼ŒSSE è®¾è®¡äº†ä¸¤ä¸ªç»„ä»¶ï¼šæµè§ˆå™¨ä¸­çš„EventSource å’Œæ–°çš„â€œäº‹ä»¶æµâ€æ•°æ®æ ¼å¼ã€‚å…¶ä¸­ï¼Œ EventSource å¯ä»¥è®©å®¢æˆ·ç«¯ä»¥ DOM äº‹ä»¶çš„å½¢å¼æŽ¥æ”¶åˆ°æœåŠ¡å™¨æŽ¨é€çš„é€šçŸ¥ï¼Œè€Œæ–°æ•°æ®æ ¼å¼åˆ™ç”¨äºŽäº¤ä»˜æ¯ä¸€æ¬¡æ›´æ–°ã€‚ EventSource API å’Œå®šä¹‰å®Œå–„çš„äº‹ä»¶æµæ•°æ®æ ¼å¼ï¼Œä½¿å¾— SSE æˆä¸ºäº†åœ¨æµè§ˆå™¨ä¸­å¤„ç†å®žæ—¶æ•°æ®çš„é«˜æ•ˆè€Œä¸å¯æˆ–ç¼ºçš„å·¥å…·ï¼š é€šè¿‡ä¸€ä¸ªé•¿è¿žæŽ¥ä½Žå»¶è¿Ÿäº¤ä»˜ï¼› é«˜æ•ˆçš„æµè§ˆå™¨æ¶ˆæ¯è§£æžï¼Œä¸ä¼šå‡ºçŽ°æ— é™ç¼“å†²ï¼› è‡ªåŠ¨è·Ÿè¸ªæœ€åŽçœ‹åˆ°çš„æ¶ˆæ¯åŠè‡ªåŠ¨é‡æ–°è¿žæŽ¥ï¼› æ¶ˆæ¯é€šçŸ¥åœ¨å®¢æˆ·ç«¯ä»¥ DOM äº‹ä»¶å½¢å¼å‘ˆçŽ°ã€‚ å®žé™…ä¸Šï¼ŒSSE æä¾›çš„æ˜¯ä¸€ä¸ªé«˜æ•ˆã€è·¨æµè§ˆå™¨çš„ XHR æµå®žçŽ°ï¼Œæ¶ˆæ¯äº¤ä»˜åªä½¿ç”¨ä¸€ä¸ªé•¿ HTTP è¿žæŽ¥ã€‚ç„¶è€Œï¼Œä¸Žæˆ‘ä»¬è‡ªå·±å®žçŽ° XHR æµä¸åŒï¼Œæµè§ˆå™¨ä¼šå¸®æˆ‘ä»¬ç®¡ç†è¿žæŽ¥ã€è§£æžæ¶ˆæ¯ï¼Œä»Žè€Œè®©æˆ‘ä»¬åªå…³æ³¨ä¸šåŠ¡é€»è¾‘ã€‚ EventSource APIEventSource æŽ¥å£é€šè¿‡ä¸€ä¸ªç®€å•çš„æµè§ˆå™¨ API éšè—äº†æ‰€æœ‰çš„åº•å±‚ç»†èŠ‚ï¼ŒåŒ…æ‹¬å»ºç«‹è¿žæŽ¥å’Œè§£æžæ¶ˆæ¯ã€‚ SSE å®žçŽ°äº†èŠ‚çœå†…å­˜çš„ XHR æµã€‚ä¸ŽåŽŸå§‹çš„ XHR æµåœ¨è¿žæŽ¥å…³é—­å‰ä¼šç¼“å†²æŽ¥æ”¶åˆ°çš„æ‰€æœ‰å“åº”ä¸åŒï¼ŒSSE è¿žæŽ¥ä¼šä¸¢å¼ƒå·²ç»å¤„ç†è¿‡çš„æ¶ˆæ¯ï¼Œè€Œä¸ä¼šåœ¨å†…å­˜ä¸­ç´¯ç§¯ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ EventSource æŽ¥å£è¿˜èƒ½è‡ªåŠ¨é‡æ–°è¿žæŽ¥å¹¶è·Ÿè¸ªæœ€è¿‘æŽ¥æ”¶çš„æ¶ˆæ¯ï¼šå¦‚æžœè¿žæŽ¥æ–­å¼€äº†ï¼Œ EventSource ä¼šè‡ªåŠ¨é‡æ–°è¿žæŽ¥åˆ°æœåŠ¡å™¨ï¼Œè¿˜å¯ä»¥å‘æœåŠ¡å™¨å‘é€ä¸Šä¸€æ¬¡æŽ¥æ”¶åˆ°çš„æ¶ˆæ¯ IDï¼Œä»¥ä¾¿æœåŠ¡å™¨é‡ä¼ ä¸¢å¤±çš„æ¶ˆæ¯å¹¶æ¢å¤æµã€‚ Event Streamåè®®SSE äº‹ä»¶æµæ˜¯ä»¥æµå¼ HTTP å“åº”å½¢å¼äº¤ä»˜çš„ï¼šå®¢æˆ·ç«¯å‘èµ·å¸¸è§„ HTTP è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä»¥è‡ªå®šä¹‰çš„â€œtext/event-streamâ€å†…å®¹ç±»åž‹å“åº”ï¼Œç„¶åŽäº¤ä»˜ UTF-8 ç¼–ç çš„äº‹ä»¶æ•°æ®ã€‚è¿™ä¹ˆç®€å•å‡ å¥è¯ä¼¼ä¹Žéƒ½æœ‰ç‚¹è¯´å¤æ‚äº†ï¼Œçœ‹ä¸€ä¸ªä¾‹å­ï¼š 1234567891011121314151617181920=&gt; è¯·æ±‚GET /stream HTTP/1.1 âžŠHost: example.comAccept: text/event-stream&lt;= å“åº”HTTP/1.1 200 OK âž‹Connection: keep-aliveContent-Type: text/event-streamTransfer-Encoding: chunkedretry: 15000 âžŒdata: First message is a simple string. âždata: &#123;&quot;message&quot;: &quot;JSON payload&quot;&#125; âžŽevent: foo âždata: Message of type &quot;foo&quot;id: 42 âževent: bardata: Multi-line message ofdata: type &quot;bar&quot; and id &quot;42&quot;id: 43 âž‘data: Last message, id &quot;43&quot; âžŠ å®¢æˆ·ç«¯é€šè¿‡ EventSource æŽ¥å£å‘èµ·è¿žæŽ¥âž‹ æœåŠ¡å™¨ä»¥ â€œtext/event-streamâ€ å†…å®¹ç±»åž‹å“åº”âžŒ æœåŠ¡å™¨è®¾ç½®è¿žæŽ¥ä¸­æ–­åŽé‡æ–°è¿žæŽ¥çš„é—´éš”æ—¶é—´ï¼ˆ15 sï¼‰âž ä¸å¸¦æ¶ˆæ¯ç±»åž‹çš„ç®€å•æ–‡æœ¬äº‹ä»¶âžŽ ä¸å¸¦æ¶ˆæ¯ç±»åž‹çš„ JSON æ•°æ®è½½è·âž ç±»åž‹ä¸º â€œfooâ€ çš„ç®€å•æ–‡æœ¬äº‹ä»¶âž å¸¦æ¶ˆæ¯ ID å’Œç±»åž‹çš„å¤šè¡Œäº‹ä»¶âž‘ å¸¦å¯é€‰ ID çš„ç®€å•æ–‡æœ¬äº‹ä»¶ åœ¨æŽ¥æ”¶ç«¯ï¼Œ EventSource æŽ¥å£é€šè¿‡æ£€æŸ¥æ¢è¡Œåˆ†éš”ç¬¦æ¥è§£æžåˆ°æ¥çš„æ•°æ®æµã€‚ SSE ä¸­çš„ UTF-8 ç¼–ç ä¸ŽäºŒè¿›åˆ¶ä¼ è¾“ EventSource ä¸ä¼šå¯¹å®žé™…è½½è·è¿›è¡Œä»»ä½•é¢å¤–å¤„ç†ï¼šä»Žä¸€æˆ–å¤šä¸ª data å­—æ®µä¸­æå–å‡ºæ¥çš„æ¶ˆæ¯ï¼Œä¼šè¢«æ‹¼æŽ¥èµ·æ¥ç›´æŽ¥äº¤ç»™åº”ç”¨ã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨å¯ä»¥æŽ¨é€ä»»ä½•æ–‡æœ¬æ ¼å¼ï¼ˆä¾‹å¦‚ï¼Œç®€å•å­—ç¬¦ä¸²ã€JSONï¼Œç­‰ç­‰ï¼‰ï¼Œåº”ç”¨å¿…é¡»è‡ªå·±è§£ç ã€‚ è¯è™½å¦‚æ­¤ï¼Œä½†æ‰€æœ‰äº‹ä»¶æºæ•°æ®éƒ½æ˜¯ UTF-8 ç¼–ç çš„ï¼šSSE ä¸æ˜¯ä¸ºä¼ è¾“äºŒè¿›åˆ¶è½½è·è€Œè®¾è®¡çš„ï¼å¦‚æžœæœ‰å¿…è¦ï¼Œå¯ä»¥æŠŠäºŒè¿›åˆ¶å¯¹è±¡ç¼–ç ä¸º base64 å½¢å¼ï¼Œç„¶åŽå†ä½¿ç”¨ SSEã€‚ä½†è¿™æ ·ä¼šå¯¼è‡´å¾ˆé«˜ï¼ˆ33%ï¼‰çš„å­—èŠ‚å¼€é”€ã€‚ æ‹…å¿ƒ UTF-8 ç¼–ç ä¹Ÿä¼šé€ æˆé«˜å¼€é”€ï¼Ÿ SSE è¿žæŽ¥æœ¬è´¨ä¸Šæ˜¯ HTTP æµå¼å“åº”ï¼Œå› æ­¤å“åº”æ˜¯å¯ä»¥åŽ‹ç¼©çš„ï¼ˆå¦‚ gzip åŽ‹ç¼©ï¼‰ï¼Œå°±è·ŸåŽ‹ç¼©å…¶ä»– HTTP å“åº”ä¸€æ ·ï¼Œè€Œä¸”æ˜¯åŠ¨æ€åŽ‹ç¼©ï¼è™½ç„¶ SSE ä¸æ˜¯ä¸ºä¼ è¾“äºŒè¿›åˆ¶æ•°æ®è€Œè®¾è®¡çš„ï¼Œä½†å®ƒå´æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„æœºåˆ¶â€”â€”åªè¦è®©ä½ çš„æœåŠ¡å™¨å¯¹ SSE æµåº”ç”¨ gzip åŽ‹ç¼©ã€‚ ä¸æ”¯æŒäºŒè¿›åˆ¶ä¼ è¾“æ˜¯æœ‰æ„ä¸ºä¹‹çš„ã€‚SSE çš„è®¾è®¡ç›®æ ‡æ˜¯ç®€å•ã€é«˜æ•ˆï¼Œä½œä¸ºä¸€ç§æœåŠ¡å™¨å‘å®¢æˆ·ç«¯ä¼ é€æ–‡æœ¬æ•°æ®çš„æœºåˆ¶ã€‚å¦‚æžœä½ æƒ³ä¼ è¾“äºŒè¿›åˆ¶æ•°æ®ï¼ŒWebSocket æ‰æ˜¯æ›´åˆé€‚çš„é€‰æ‹©ã€‚ æœ€åŽï¼Œé™¤äº†è‡ªåŠ¨è§£æžäº‹ä»¶æ•°æ®ï¼ŒSSE è¿˜å†…ç½®æ”¯æŒæ–­çº¿é‡è¿žï¼Œä»¥åŠæ¢å¤å®¢æˆ·ç«¯å› æ–­çº¿è€Œä¸¢å¤±çš„æ¶ˆæ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æžœè¿žæŽ¥ä¸­æ–­ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨é‡æ–°è¿žæŽ¥ã€‚SSE è§„èŒƒå»ºè®®çš„é—´éš”æ—¶é—´æ˜¯ 2~3 sï¼Œè¿™ä¹Ÿæ˜¯å¤§å¤šæ•°æµè§ˆå™¨é‡‡ç”¨çš„é»˜è®¤å€¼ã€‚ä¸è¿‡ï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„é—´éš”æ—¶é—´ï¼Œåªè¦åœ¨æŽ¨é€ä»»ä½•æ¶ˆæ¯æ—¶å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª retry å‘½ä»¤å³å¯ã€‚ ç±»ä¼¼åœ°ï¼ŒæœåŠ¡å™¨è¿˜å¯ä»¥ç»™æ¯æ¡æ¶ˆæ¯å…³è”ä»»æ„ ID å­—ç¬¦ä¸²ã€‚æµè§ˆå™¨ä¼šè‡ªåŠ¨è®°å½•æœ€åŽä¸€æ¬¡æ”¶åˆ°çš„æ¶ˆæ¯ IDï¼Œå¹¶åœ¨å‘é€é‡è¿žè¯·æ±‚æ—¶è‡ªåŠ¨åœ¨ HTTP é¦–éƒ¨è¿½åŠ â€œLast-Event-IDâ€å€¼ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼š 123456789101112131415161718ï¼ˆæ—¢æœ‰ SSE è¿žæŽ¥ï¼‰retry: 4500 âžŠid: 43 âž‹data: Lorem ipsumï¼ˆè¿žæŽ¥æ–­å¼€ï¼‰ï¼ˆ4500 ms åŽï¼‰=&gt; è¯·æ±‚GET /stream HTTP/1.1 âžŒHost: example.comAccept: text/event-streamLast-Event-ID: 43&lt;= å“åº”HTTP/1.1 200 OK âžContent-Type: text/event-streamConnection: keep-aliveTransfer-Encoding: chunkedid: 44 âžŽdata: dolor sit amet âžŠ æœåŠ¡å™¨å°†å®¢æˆ·ç«¯çš„é‡è¿žé—´éš”è®¾ç½®ä¸º 4.5 sâž‹ ç®€å•æ–‡æœ¬äº‹ä»¶ï¼ŒID:43âžŒ å¸¦æœ€åŽä¸€æ¬¡äº‹ä»¶ ID çš„å®¢æˆ·ç«¯é‡è¿žè¯·æ±‚âž æœåŠ¡å™¨ä»¥ â€˜text/event-streamâ€™ å†…å®¹ç±»åž‹å“åº”âžŽ ç®€å•æ–‡æœ¬äº‹ä»¶ï¼ŒID:44 å®¢æˆ·ç«¯åº”ç”¨ä¸å¿…ä¸ºé‡æ–°è¿žæŽ¥å’Œè®°å½•ä¸Šä¸€æ¬¡äº‹ä»¶ ID ç¼–å†™ä»»ä½•ä»£ç ã€‚è¿™äº›éƒ½ç”±æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œç„¶åŽå°±æ˜¯æœåŠ¡å™¨è´Ÿè´£æ¢å¤äº†ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ ¹æ®åº”ç”¨çš„è¦æ±‚å’Œæ•°æ®æµï¼ŒæœåŠ¡å™¨å¯ä»¥é‡‡å–ä¸åŒçš„å®žçŽ°ç­–ç•¥ã€‚ å¦‚æžœä¸¢å¤±æ¶ˆæ¯å¯ä»¥æŽ¥å—ï¼Œå°±ä¸éœ€è¦äº‹ä»¶ ID æˆ–ç‰¹æ®Šé€»è¾‘ï¼Œåªè¦è®©å®¢æˆ·ç«¯é‡è¿žå¹¶æ¢å¤æ•°æ®æµå³å¯ã€‚ å¦‚æžœå¿…é¡»æ¢å¤æ¶ˆæ¯ï¼Œé‚£æœåŠ¡å™¨å°±éœ€è¦æŒ‡å®šç›¸å…³äº‹ä»¶çš„ IDï¼Œä»¥ä¾¿å®¢æˆ·ç«¯åœ¨é‡è¿žæ—¶æŠ¥å‘Šæœ€åŽæŽ¥æ”¶åˆ°çš„ IDã€‚åŒæ ·ï¼ŒæœåŠ¡å™¨ä¹Ÿéœ€è¦å®žçŽ°æŸç§å½¢å¼çš„æœ¬åœ°ç¼“å­˜ï¼Œä»¥ä¾¿æ¢å¤å¹¶å‘å®¢æˆ·ç«¯é‡ä¼ é”™è¿‡çš„æ¶ˆæ¯ã€‚ SSEä½¿ç”¨åœºæ™¯åŠæ€§èƒ½ é€šè¿‡ TLS å®žçŽ° SSE æµSSE é€šè¿‡å¸¸è§„ HTTP è¿žæŽ¥å®žçŽ°äº†ç®€å•ä¾¿æ·çš„å®žæ—¶ä¼ è¾“æœºåˆ¶ï¼ŒæœåŠ¡å™¨ç«¯å®¹æ˜“éƒ¨ç½²ï¼Œå®¢æˆ·ç«¯ä¹Ÿå®¹æ˜“æ‰“è¡¥ä¸ã€‚å¯æ˜¯ï¼ŒçŽ°æœ‰ç½‘ç»œä¸­é—´è®¾å¤‡ï¼Œæ¯”å¦‚ä»£ç†æœåŠ¡å™¨å’Œé˜²ç«å¢™ï¼Œéƒ½ä¸æ”¯æŒ SSEï¼Œè€Œè¿™æœ‰å¯èƒ½å¸¦æ¥é—®é¢˜ï¼šä¸­é—´è®¾å¤‡å¯èƒ½ä¼šç¼“å†²äº‹ä»¶æµæ•°æ®ï¼Œå¯¼è‡´é¢å¤–å»¶è¿Ÿï¼Œç”šè‡³å½»åº•æ¯æŽ‰ SSE è¿žæŽ¥ã€‚ å¦‚æžœä½ ç¢°åˆ°äº†è¿™æ ·æˆ–ç±»ä¼¼çš„é—®é¢˜ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘é€šè¿‡ TLS å‘é€ SSE äº‹ä»¶æµã€‚ WebSocketWebSocket å¯ä»¥å®žçŽ°å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨é—´åŒå‘ã€åŸºäºŽæ¶ˆæ¯çš„æ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ•°æ®ä¼ è¾“ã€‚ æŽ¥æ”¶æ–‡æœ¬å’ŒäºŒè¿›åˆ¶æ•°æ®WebSocket åè®®ä¸ä½œæ ¼å¼å‡è®¾ï¼Œå¯¹åº”ç”¨çš„å‡€è·ä¹Ÿæ²¡æœ‰é™åˆ¶ï¼šæ–‡æœ¬æˆ–è€…äºŒè¿›åˆ¶æ•°æ®éƒ½æ²¡é—®é¢˜ã€‚ä»Žå†…éƒ¨çœ‹ï¼Œåè®®åªå…³æ³¨æ¶ˆæ¯çš„ä¸¤ä¸ªä¿¡æ¯ï¼šå‡€è·é•¿åº¦å’Œç±»åž‹ï¼ˆå‰è€…æ˜¯ä¸€ä¸ªå¯å˜é•¿åº¦å­—æ®µï¼‰ï¼Œæ®ä»¥åŒºåˆ« UTF-8 æ•°æ®å’ŒäºŒè¿›åˆ¶æ•°æ®ã€‚ æµè§ˆå™¨æŽ¥æ”¶åˆ°æ–°æ¶ˆæ¯åŽï¼Œå¦‚æžœæ˜¯æ–‡æœ¬æ•°æ®ï¼Œä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢æˆ DOMString å¯¹è±¡ï¼Œå¦‚æžœæ˜¯äºŒè¿›åˆ¶æ•°æ®æˆ– Blob å¯¹è±¡ï¼Œä¼šç›´æŽ¥å°†å…¶è½¬äº¤ç»™åº”ç”¨ã€‚å”¯ä¸€å¯ä»¥ï¼ˆä½œä¸ºæ€§èƒ½æš—ç¤ºå’Œä¼˜åŒ–æŽªæ–½ï¼‰å¤šä½™è®¾ç½®çš„ï¼Œå°±æ˜¯å‘Šè¯‰æµè§ˆå™¨æŠŠæŽ¥æ”¶åˆ°çš„äºŒè¿›åˆ¶æ•°æ®è½¬æ¢æˆ ArrayBufferè€Œéž Blobã€‚ ç”¨æˆ·ä»£ç†å¯ä»¥å°†è¿™ä¸ªé€‰é¡¹çœ‹ä½œä¸€ä¸ªæš—ç¤ºï¼Œä»¥å†³å®šå¦‚ä½•å¤„ç†æŽ¥æ”¶åˆ°çš„äºŒè¿›åˆ¶æ•°æ®ï¼šå¦‚æžœè¿™é‡Œè®¾ç½®ä¸ºâ€œblobâ€ï¼Œé‚£å°±å¯ä»¥æ”¾å¿ƒåœ°å°†å…¶è½¬å­˜åˆ°ç£ç›˜ä¸Šï¼›è€Œå¦‚æžœè®¾ç½®ä¸ºâ€œarraybufferâ€ï¼Œé‚£å¾ˆå¯èƒ½åœ¨å†…å­˜é‡Œå¤„ç†å®ƒæ›´æœ‰æ•ˆã€‚è‡ªç„¶åœ°ï¼Œæˆ‘ä»¬é¼“åŠ±ç”¨æˆ·ä»£ç†ä½¿ç”¨æ›´ç»†å¾®çš„çº¿ç´¢ï¼Œä»¥å†³å®šæ˜¯å¦å°†åˆ°æ¥çš„æ•°æ®æ”¾åˆ°å†…å­˜é‡Œâ€¦â€¦ â€”â€”The WebSocket API W3C Candidate Recommendation Blob å¯¹è±¡ä¸€èˆ¬ä»£è¡¨ä¸€ä¸ªä¸å¯å˜çš„æ–‡ä»¶å¯¹è±¡æˆ–åŽŸå§‹æ•°æ®ã€‚å¦‚æžœä½ ä¸éœ€è¦ä¿®æ”¹å®ƒæˆ–è€…ä¸éœ€è¦æŠŠå®ƒåˆ‡åˆ†æˆæ›´å°çš„å—ï¼Œé‚£è¿™ç§æ ¼å¼æ˜¯ç†æƒ³çš„ï¼ˆæ¯”å¦‚ï¼Œå¯ä»¥æŠŠä¸€ä¸ªå®Œæ•´çš„ Blob å¯¹è±¡ä¼ ç»™ img æ ‡ç­¾ï¼‰ã€‚è€Œå¦‚æžœä½ è¿˜éœ€è¦å†å¤„ç†æŽ¥æ”¶åˆ°çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œé‚£ä¹ˆé€‰æ‹© ArrayBuffer åº”è¯¥æ›´åˆé€‚ã€‚ å­åè®®åå•†WebSocket åè®®å¯¹æ¯æ¡æ¶ˆæ¯çš„æ ¼å¼äº‹å…ˆä¸ä½œä»»ä½•å‡è®¾ï¼šä»…ç”¨ä¸€ä½æ ‡è®°æ¶ˆæ¯æ˜¯æ–‡æœ¬è¿˜æ˜¯äºŒè¿›åˆ¶ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æœ‰æ•ˆåœ°è§£ç æ•°æ®ï¼Œè€Œé™¤æ­¤ä¹‹å¤–çš„æ¶ˆæ¯å†…å®¹å°±æ˜¯æœªçŸ¥çš„ã€‚ æ­¤å¤–ï¼Œä¸Ž HTTP æˆ– XHR è¯·æ±‚ä¸åŒâ€”â€”å®ƒä»¬æ˜¯é€šè¿‡æ¯æ¬¡è¯·æ±‚å’Œå“åº”çš„ HTTP é¦–éƒ¨æ¥æ²Ÿé€šå…ƒæ•°æ®ï¼ŒWebSocket å¹¶æ²¡æœ‰ç­‰ä»·çš„æœºåˆ¶ã€‚å› æ­¤ï¼Œå¦‚æžœéœ€è¦æ²Ÿé€šå…³äºŽæ¶ˆæ¯çš„å…ƒæ•°æ®ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¿…é¡»è¾¾æˆæ²Ÿé€šè¿™ä¸€æ•°æ®çš„å­åè®®ã€‚ å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥æå‰ç¡®å®šä¸€ç§å›ºå®šçš„æ¶ˆæ¯æ ¼å¼ï¼Œæ¯”å¦‚æ‰€æœ‰é€šä¿¡éƒ½é€šè¿‡ JSONç¼–ç çš„æ¶ˆæ¯æˆ–è€…æŸç§è‡ªå®šä¹‰çš„äºŒè¿›åˆ¶æ ¼å¼è¿›è¡Œï¼Œè€Œå¿…è¦çš„å…ƒæ•°æ®ä½œä¸ºè¿™ç§æ•°æ®ç»“æž„çš„ä¸€ä¸ªéƒ¨åˆ†ã€‚ å¦‚æžœå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¦å‘é€ä¸åŒçš„æ•°æ®ç±»åž‹ï¼Œé‚£å®ƒä»¬å¯ä»¥ç¡®å®šä¸€ä¸ªåŒæ–¹éƒ½çŸ¥é“çš„æ¶ˆæ¯é¦–éƒ¨ï¼Œåˆ©ç”¨å®ƒæ¥æ²Ÿé€šè¯´æ˜Žä¿¡æ¯æˆ–æœ‰å…³å‡€è·çš„å…¶ä»–è§£ç ä¿¡æ¯ã€‚ æ··åˆä½¿ç”¨æ–‡æœ¬å’ŒäºŒè¿›åˆ¶æ¶ˆæ¯å¯ä»¥æ²Ÿé€šå‡€è·å’Œå…ƒæ•°æ®ï¼Œæ¯”å¦‚ç”¨æ–‡æœ¬æ¶ˆæ¯å®žçŽ° HTTPé¦–éƒ¨çš„åŠŸèƒ½ï¼ŒåŽè·ŸåŒ…å«åº”ç”¨å‡€è·çš„äºŒè¿›åˆ¶æ¶ˆæ¯ã€‚ å­åè®®åç”±åº”ç”¨è‡ªå·±å®šä¹‰ï¼Œä¸”åœ¨åˆæ¬¡ HTTP æ¡æ‰‹æœŸé—´å‘é€ç»™æœåŠ¡å™¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒæŒ‡å®šçš„å­åè®®å¯¹æ ¸å¿ƒ WebSocket API ä¸ä¼šæœ‰ä»»ä½•å½±å“ã€‚ WebSocketåè®® WebSocket åè®®å°è¯•åœ¨æ—¢æœ‰ HTTP åŸºç¡€è®¾æ–½ä¸­å®žçŽ°åŒå‘ HTTP é€šä¿¡ï¼Œå› æ­¤ä¹Ÿä½¿ç”¨ HTTP çš„ 80 å’Œ 443 ç«¯å£â€¦â€¦ä¸è¿‡ï¼Œè¿™ä¸ªè®¾è®¡ä¸é™äºŽé€šè¿‡ HTTP å®žçŽ°WebSocket é€šä¿¡ï¼Œæœªæ¥çš„å®žçŽ°å¯ä»¥åœ¨æŸä¸ªä¸“ç”¨ç«¯å£ä¸Šä½¿ç”¨æ›´ç®€å•çš„æ¡æ‰‹ï¼Œè€Œä¸å¿…é‡æ–°å®šä¹‰ä¹ˆä¸€ä¸ªåè®®ã€‚ â€”â€”WebSocket Protocol RFC 6455 äºŒè¿›åˆ¶åˆ†å¸§å±‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ WebSocket åº”ç”¨é€šè¿‡åŸºäºŽæ¶ˆæ¯çš„ API é€šä¿¡ï¼šå‘é€ç«¯æä¾›ä»»æ„ UTF-8æˆ–äºŒè¿›åˆ¶çš„å‡€è·ï¼ŒæŽ¥æ”¶ç«¯åœ¨æ•´ä¸ªæ¶ˆæ¯å¯ç”¨æ—¶æ”¶åˆ°é€šçŸ¥ã€‚ä¸ºæ­¤ï¼ŒWebSocket ä½¿ç”¨äº†è‡ªå®šä¹‰çš„äºŒè¿›åˆ¶åˆ†å¸§æ ¼å¼ï¼ˆå›¾ 17-1ï¼‰ï¼ŒæŠŠæ¯ä¸ªåº”ç”¨æ¶ˆæ¯åˆ‡åˆ†æˆä¸€æˆ–å¤šä¸ªå¸§ï¼Œå‘é€åˆ°ç›®çš„åœ°ä¹‹åŽå†ç»„è£…èµ·æ¥ï¼Œç­‰åˆ°æŽ¥æ”¶åˆ°å®Œæ•´çš„æ¶ˆæ¯åŽå†é€šçŸ¥æŽ¥æ”¶ç«¯ã€‚ å¸§æœ€å°çš„é€šä¿¡å•ä½ï¼ŒåŒ…å«å¯å˜é•¿åº¦çš„å¸§é¦–éƒ¨å’Œå‡€è·éƒ¨åˆ†ï¼Œå‡€è·å¯èƒ½åŒ…å«å®Œæ•´æˆ–éƒ¨åˆ†åº”ç”¨æ¶ˆæ¯ã€‚ æ¶ˆæ¯ä¸€ç³»åˆ—å¸§ï¼Œä¸Žåº”ç”¨æ¶ˆæ¯å¯¹ç­‰ã€‚ æ¯ä¸€å¸§çš„ç¬¬ä¸€ä½ï¼ˆFINï¼‰è¡¨ç¤ºå½“å‰å¸§æ˜¯ä¸æ˜¯æ¶ˆæ¯çš„æœ€åŽä¸€å¸§ã€‚ä¸€æ¡æ¶ˆæ¯æœ‰å¯èƒ½åªå¯¹åº”ä¸€å¸§ã€‚ æ“ä½œç ï¼ˆ4 ä½ï¼‰è¡¨ç¤ºè¢«ä¼ è¾“å¸§çš„ç±»åž‹ï¼šä¼ è¾“åº”ç”¨æ•°æ®æ—¶ï¼Œæ˜¯æ–‡æœ¬ï¼ˆ1ï¼‰è¿˜æ˜¯äºŒè¿›åˆ¶ï¼ˆ2ï¼‰ï¼›è¿žæŽ¥æœ‰æ•ˆæ€§æ£€æŸ¥æ—¶ï¼Œæ˜¯å…³é—­ï¼ˆ8ï¼‰ã€å‘¼å«ï¼ˆpingï¼Œ9ï¼‰è¿˜æ˜¯å›žåº”ï¼ˆpongï¼Œ10ï¼‰ã€‚ æŽ©ç ä½è¡¨ç¤ºå‡€è·æ˜¯å¦æœ‰æŽ©ç ï¼ˆåªé€‚ç”¨äºŽå®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„æ¶ˆæ¯ï¼‰ã€‚ å‡€è·é•¿åº¦ç”±å¯å˜é•¿åº¦å­—æ®µè¡¨ç¤ºï¼š å¦‚æžœæ˜¯ 0~125ï¼Œå°±æ˜¯å‡€è·é•¿åº¦ï¼› å¦‚æžœæ˜¯ 126ï¼Œåˆ™æŽ¥ä¸‹æ¥ 2 å­—èŠ‚è¡¨ç¤ºçš„ 16 ä½æ— ç¬¦å·æ•´æ•°æ‰æ˜¯è¿™ä¸€å¸§çš„é•¿åº¦ï¼› å¦‚æžœæ˜¯ 127ï¼Œåˆ™æŽ¥ä¸‹æ¥ 8 å­—èŠ‚è¡¨ç¤ºçš„ 64 ä½æ— ç¬¦å·æ•´æ•°æ‰æ˜¯è¿™ä¸€å¸§çš„é•¿åº¦ã€‚ æŽ©ç é”®åŒ…å« 32 ä½å€¼ï¼Œç”¨äºŽç»™å‡€è·åŠ æŽ©æŠ¤ã€‚ å‡€è·åŒ…å«åº”ç”¨æ•°æ®ï¼Œå¦‚æžœå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨å»ºç«‹è¿žæŽ¥æ—¶åå•†è¿‡ï¼Œä¹Ÿå¯ä»¥åŒ…å«è‡ªå®šä¹‰çš„æ‰©å±•æ•°æ®ã€‚ æ‰€æœ‰å®¢æˆ·ç«¯å‘é€å¸§çš„å‡€è·éƒ½è¦ä½¿ç”¨å¸§é¦–éƒ¨ä¸­æŒ‡å®šçš„å€¼åŠ æŽ©ç ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢å®¢æˆ·ç«¯ä¸­è¿è¡Œçš„æ¶æ„è„šæœ¬å¯¹ä¸æ”¯æŒ WebSocket çš„ä¸­é—´è®¾å¤‡è¿›è¡Œç¼“å­˜æŠ•æ¯’æ”»å‡»ï¼ˆcache poisoning attackï¼‰ã€‚è¦äº†è§£è¿™ç§æ”»å‡»çš„ç»†èŠ‚ï¼Œè¯·å‚è€ƒ W2SP2011 çš„è®ºæ–‡â€œTalking to Yourself for Fun and Profitâ€ï¼ˆhttp://w2spconf.com/2011/papers/websocket.pdfï¼‰ã€‚ ç®—ä¸‹æ¥ï¼ŒæœåŠ¡å™¨å‘é€çš„æ¯ä¸ª WebSocket å¸§ä¼šäº§ç”Ÿ 2~10 å­—èŠ‚çš„åˆ†å¸§å¼€é”€ã€‚è€Œå®¢æˆ·ç«¯å¿…é¡»å‘é€æŽ©ç é”®ï¼Œè¿™åˆä¼šå¢žåŠ  4 å­—èŠ‚ï¼Œç»“æžœå°±æ˜¯ 6~14 å­—èŠ‚çš„å¼€é”€ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ²¡æœ‰å…¶ä»–å…ƒæ•°æ®ï¼ˆæ¯”å¦‚é¦–éƒ¨å­—æ®µæˆ–å…¶ä»–å…³äºŽå‡€è·çš„ä¿¡æ¯ï¼‰ï¼šæ‰€æœ‰ WebSocket é€šä¿¡éƒ½æ˜¯é€šè¿‡äº¤æ¢å¸§å®žçŽ°çš„ï¼Œè€Œå¸§å°†å‡€è·è§†ä¸ºä¸é€æ˜Žçš„åº”ç”¨æ•°æ®å—ã€‚ WebSocket çš„å¤šè·¯å¤ç”¨åŠé˜Ÿé¦–é˜»å¡žWebSocket å¾ˆå®¹æ˜“å‘ç”Ÿé˜Ÿé¦–é˜»å¡žçš„æƒ…å†µï¼šæ¶ˆæ¯å¯èƒ½ä¼šè¢«åˆ†æˆä¸€æˆ–å¤šä¸ªå¸§ï¼Œä½†ä¸åŒæ¶ˆæ¯çš„å¸§ä¸èƒ½äº¤é”™å‘é€ï¼Œå› ä¸ºæ²¡æœ‰ä¸Ž HTTP 2.0 åˆ†å¸§æœºåˆ¶ä¸­â€œæµ IDâ€å¯¹ç­‰çš„å­—æ®µã€‚æ˜¾ç„¶ï¼Œå¦‚æžœä¸€ä¸ªå¤§æ¶ˆæ¯è¢«åˆ†æˆå¤šä¸ª WebSocket å¸§ï¼Œå°±ä¼šé˜»å¡žå…¶ä»–æ¶ˆæ¯çš„å¸§ã€‚å¦‚æžœä½ çš„åº”ç”¨ä¸å®¹è®¸æœ‰äº¤ä»˜å»¶è¿Ÿï¼Œé‚£å¯ä»¥å°å¿ƒæŽ§åˆ¶æ¯æ¡æ¶ˆæ¯çš„å‡€è·å¤§å°ï¼Œç”šè‡³å¯ä»¥è€ƒè™‘æŠŠå¤§æ¶ˆæ¯æ‹†åˆ†æˆå¤šä¸ªå°æ¶ˆæ¯ï¼WebSocket ä¸æ”¯æŒå¤šè·¯å¤ç”¨ï¼Œè¿˜æ„å‘³ç€æ¯ä¸ª WebSocket è¿žæŽ¥éƒ½éœ€è¦ä¸€ä¸ªä¸“é—¨çš„TCP è¿žæŽ¥ã€‚å¯¹äºŽ HTTP 1.x è€Œè¨€ï¼Œç”±äºŽæµè§ˆå™¨é’ˆå¯¹æ¯ä¸ªæ¥æºæœ‰è¿žæŽ¥æ•°é‡é™åˆ¶ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚å¥½ åœ¨ï¼ŒHyBi Working Group æ­£ ç€ æ‰‹ åˆ¶ å®š çš„ æ–° çš„â€œMultiplexing Extension for WebSocketsâ€ï¼ˆWebSockets å¤šè·¯å¤ç”¨æ‰©å±•ï¼‰ä¼šè§£å†³è¿™ä¸ªé—®é¢˜ï¼šè¿™ä¸ªæ‰©å±•é€šè¿‡å°è£…å¸§å¹¶åŠ ä¸Šä¿¡é“ IDï¼Œå¯ä»¥è®©ä¸€ä¸ª TCP è¿žæŽ¥æ”¯æŒå¤šä¸ªè™šæ‹Ÿ WebSocket è¿žæŽ¥â€¦â€¦è¿™ä¸ªå¤šè·¯å¤ç”¨æ‰©å±•ç»´æŠ¤ç‹¬ç«‹çš„é€»è¾‘ä¿¡é“ï¼Œæ¯ä¸ªé€»è¾‘ä¿¡é“ä¸Žç‹¬ç«‹çš„ WebSocket è¿žæŽ¥æ²¡æœ‰å·®åˆ«ï¼ŒåŒ…æ‹¬ç‹¬ç«‹çš„æ¡æ‰‹é¦–éƒ¨ã€‚â€”â€”WebSocket Multiplexingï¼ˆDraft 10ï¼‰æœ‰äº†è¿™ä¸ªæ‰©å±•åŽï¼Œå¤šä¸ª WebSocket è¿žæŽ¥ï¼ˆä¿¡é“ï¼‰å°±å¯èƒ½åœ¨åŒä¸€ä¸ª TCP è¿žæŽ¥ä¸Šå¾—åˆ°å¤ç”¨ã€‚å¯æ˜¯ï¼Œæ¯ä¸ªä¿¡é“ä¾æ—§å®¹æ˜“äº§ç”Ÿé˜Ÿé¦–é˜»å¡žé—®é¢˜ï¼å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ä¸åŒçš„ä¿¡é“ï¼Œæˆ–è€…ä¸“ç”¨ TCP è¿žæŽ¥ï¼Œå¤šè·¯å¹¶è¡Œå‘é€æ¶ˆæ¯ã€‚æœ€åŽï¼Œæ³¨æ„å‰é¢çš„æ‰©å±•ä»…å¯¹ HTTP 1.x è¿žæŽ¥æ˜¯å¿…è¦çš„ã€‚è™½ç„¶é€šè¿‡ HTTP 2.0 ä¼ è¾“WebSocket å¸§çš„å®˜æ–¹è§„èŒƒå°šæœªå‘å¸ƒï¼Œä½†ç›¸å¯¹æ¥è¯´å°±å®¹æ˜“å¤šäº†ã€‚å› ä¸º HTTP 2.0 å†…ç½®äº†æµçš„å¤šè·¯å¤ç”¨ï¼Œåªè¦é€šè¿‡ HTTP 2.0 çš„åˆ†å¸§æœºåˆ¶æ¥å°è£… WebSocket å¸§ï¼Œå¤šä¸ªWebSocket è¿žæŽ¥å°±å¯ä»¥åœ¨ä¸€ä¸ªä¼šè¯ä¸­ä¼ è¾“ã€‚ åè®®æ‰©å±•WebSocket è§„èŒƒå…è®¸å¯¹åè®®è¿›è¡Œæ‰©å±•ï¼šæ•°æ®æ ¼å¼å’Œ WebSocket åè®®çš„è¯­ä¹‰å¯ä»¥é€šè¿‡æ–°çš„æ“ä½œç å’Œæ•°æ®å­—æ®µæ‰©å±•ã€‚è™½ç„¶æœ‰äº›ä¸åŒå¯»å¸¸ï¼Œä½†è¿™å´æ˜¯ä¸€ä¸ªéžå¸¸å¼ºå¤§çš„ç‰¹æ€§ï¼Œå› ä¸ºå®ƒå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨åŸºæœ¬çš„ WebSocket åˆ†å¸§å±‚ä¹‹ä¸Šå®žçŽ°æ›´å¤šåŠŸèƒ½ï¼Œåˆä¸éœ€è¦åº”ç”¨ä»£ç ä»‹å…¥æˆ–åä½œã€‚ è¦ä½¿ç”¨æ‰©å±•ï¼Œå®¢æˆ·ç«¯å¿…é¡»åœ¨ç¬¬ä¸€æ¬¡çš„ Upgrade æ¡æ‰‹ä¸­é€šçŸ¥æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¿…é¡»é€‰æ‹©å¹¶ç¡®è®¤è¦åœ¨å•†å®šè¿žæŽ¥ä¸­ä½¿ç”¨çš„æ‰©å±•ã€‚ HTTPå‡çº§åå•†WebSocket åè®®æä¾›äº†å¾ˆå¤šå¼ºå¤§çš„ç‰¹æ€§ï¼šåŸºäºŽæ¶ˆæ¯çš„é€šä¿¡ã€è‡ªå®šä¹‰çš„äºŒè¿›åˆ¶åˆ†å¸§å±‚ã€å­åè®®åå•†ã€å¯é€‰çš„åè®®æ‰©å±•ï¼Œç­‰ç­‰ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨äº¤æ¢æ•°æ®ä¹‹å‰ï¼Œå®¢æˆ·ç«¯å¿…é¡»ä¸ŽæœåŠ¡å™¨åå•†é€‚å½“çš„å‚æ•°ä»¥å»ºç«‹è¿žæŽ¥ã€‚ åˆ©ç”¨ HTTP å®Œæˆæ¡æ‰‹æœ‰å‡ ä¸ªå¥½å¤„ã€‚é¦–å…ˆï¼Œè®© WebSockets ä¸ŽçŽ°æœ‰ HTTP åŸºç¡€è®¾æ–½å…¼å®¹ï¼šWebSocket æœåŠ¡å™¨å¯ä»¥è¿è¡Œåœ¨ 80 å’Œ 443 ç«¯å£ä¸Šï¼Œè¿™é€šå¸¸æ˜¯å¯¹å®¢æˆ·ç«¯å”¯ä¸€å¼€æ”¾çš„ç«¯å£ã€‚å…¶æ¬¡ï¼Œè®©æˆ‘ä»¬å¯ä»¥é‡ç”¨å¹¶æ‰©å±• HTTP çš„ Upgrade æµï¼Œä¸ºå…¶æ·»åŠ è‡ªå®šä¹‰çš„WebSocket é¦–éƒ¨ï¼Œä»¥å®Œæˆåå•†ã€‚ Sec-WebSocket-Versionå®¢æˆ·ç«¯å‘é€ï¼Œè¡¨ç¤ºå®ƒæƒ³ä½¿ç”¨çš„ WebSocket åè®®ç‰ˆæœ¬ï¼ˆâ€œ13â€è¡¨ç¤º RFC 6455ï¼‰ã€‚å¦‚æžœæœåŠ¡å™¨ä¸æ”¯æŒè¿™ä¸ªç‰ˆæœ¬ï¼Œå¿…é¡»å›žåº”è‡ªå·±æ”¯æŒçš„ç‰ˆæœ¬ã€‚ Sec-WebSocket-Keyå®¢æˆ·ç«¯å‘é€ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªé”®ï¼Œä½œä¸ºä¸€ä¸ªå¯¹æœåŠ¡å™¨çš„â€œæŒ‘æˆ˜â€ï¼Œä»¥éªŒè¯æœåŠ¡å™¨æ”¯æŒè¯·æ±‚çš„åè®®ç‰ˆæœ¬ã€‚Sec-WebSocket-AcceptæœåŠ¡å™¨å“åº”ï¼ŒåŒ…å« Sec-WebSocket-Key çš„ç­¾åå€¼ï¼Œè¯æ˜Žå®ƒæ”¯æŒè¯·æ±‚çš„åè®®ç‰ˆæœ¬ã€‚ Sec-WebSocket-Protocolç”¨äºŽåå•†åº”ç”¨å­åè®®ï¼šå®¢æˆ·ç«¯å‘é€æ”¯æŒçš„åè®®åˆ—è¡¨ï¼ŒæœåŠ¡å™¨å¿…é¡»åªå›žåº”ä¸€ä¸ªåè®®åã€‚ Sec-WebSocket-Extensionsç”¨äºŽåå•†æœ¬æ¬¡è¿žæŽ¥è¦ä½¿ç”¨çš„ WebSocket æ‰©å±•ï¼šå®¢æˆ·ç«¯å‘é€æ”¯æŒçš„æ‰©å±•ï¼ŒæœåŠ¡å™¨é€šè¿‡è¿”å›žç›¸åŒçš„é¦–éƒ¨ç¡®è®¤è‡ªå·±æ”¯æŒä¸€æˆ–å¤šä¸ªæ‰©å±•ã€‚ æœ‰äº†è¿™äº›åå•†å­—æ®µï¼Œå°±å¯ä»¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œ HTTP Upgrade å¹¶åå•†æ–°çš„WebSocket è¿žæŽ¥äº†ï¼š 123456789GET /socket HTTP/1.1Host: thirdparty.comOrigin: http://example.comConnection: UpgradeUpgrade: websocket âžŠSec-WebSocket-Version: 13 âž‹Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ== âžŒSec-WebSocket-Protocol: appProtocol, appProtocol-v2 âžSec-WebSocket-Extensions: x-webkit-deflate-message, x-custom-extension âžŽ âžŠ è¯·æ±‚å‡çº§åˆ° WebSocket åè®®âž‹ å®¢æˆ·ç«¯ä½¿ç”¨çš„ WebSocket åè®®ç‰ˆæœ¬âžŒ è‡ªåŠ¨ç”Ÿæˆçš„é”®ï¼Œä»¥éªŒè¯æœåŠ¡å™¨å¯¹åè®®çš„æ”¯æŒâž å¯é€‰çš„åº”ç”¨æŒ‡å®šçš„å­åè®®åˆ—è¡¨âžŽ å¯é€‰çš„å®¢æˆ·ç«¯æ”¯æŒçš„åè®®æ‰©å±•åˆ—è¡¨ä¸Žæµè§ˆå™¨ä¸­å®¢æˆ·ç«¯å‘èµ·çš„ä»»ä½•è¿žæŽ¥ä¸€æ ·ï¼ŒWebSocket è¯·æ±‚ä¹Ÿå¿…é¡»éµå®ˆåŒæºç­–ç•¥ï¼šæµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨å‡çº§æ¡æ‰‹è¯·æ±‚ä¸­è¿½åŠ  Origin é¦–éƒ¨ï¼Œè¿œç¨‹æœåŠ¡å™¨å¯èƒ½ä½¿ç”¨ CORS åˆ¤æ–­æŽ¥å—æˆ–æ‹’ç»è·¨æºè¯·æ±‚ã€‚è¦å®Œæˆæ¡æ‰‹ï¼ŒæœåŠ¡å™¨å¿…é¡»è¿”å›žä¸€ä¸ªæˆåŠŸçš„â€œSwitching Protocolsâ€ï¼ˆåˆ‡æ¢åè®®ï¼‰å“åº”ï¼Œå¹¶ç¡®è®¤é€‰æ‹©äº†å®¢æˆ·ç«¯å‘é€çš„å“ªä¸ªé€‰é¡¹ï¼š 1234567HTTP/1.1 101 Switching Protocols âžŠUpgrade: websocketConnection: UpgradeAccess-Control-Allow-Origin: http://example.com âž‹Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo= âžŒSec-WebSocket-Protocol: appProtocol-v2 âžSec-WebSocket-Extensions: x-custom-extension âžŽ âžŠ 101 å“åº”ç ç¡®è®¤å‡çº§åˆ° WebSocket åè®®âž‹ CORS é¦–éƒ¨è¡¨ç¤ºé€‰æ‹©åŒæ„è·¨æºè¿žæŽ¥âžŒ ç­¾åçš„é”®å€¼éªŒè¯åè®®æ”¯æŒâž æœåŠ¡å™¨é€‰æ‹©çš„åº”ç”¨å­åè®®âžŽ æœåŠ¡å™¨é€‰æ‹©çš„ WebSocket æ‰©å±• æ‰€æœ‰å…¼å®¹ RFC 6455 çš„ WebSocket æœåŠ¡å™¨éƒ½ä½¿ç”¨ç›¸åŒçš„ç®—æ³•è®¡ç®—å®¢æˆ·ç«¯æŒ‘æˆ˜çš„ç­”æ¡ˆï¼šå°† Sec-WebSocket-Key çš„å†…å®¹ä¸Žæ ‡å‡†å®šä¹‰çš„å”¯ä¸€ GUID å­—ç¬¦ä¸²æ‹¼æŽ¥èµ·æ¥ï¼Œè®¡ç®—å‡º SHA1 æ•£åˆ—å€¼ï¼Œç»“æžœæ˜¯ä¸€ä¸ª base-64 ç¼–ç çš„å­—ç¬¦ä¸²ï¼ŒæŠŠè¿™ä¸ªå­—ç¬¦ä¸²å‘ç»™å®¢æˆ·ç«¯å³å¯ã€‚ æœ€ä½Žé™åº¦ï¼ŒæˆåŠŸçš„ WebSocket æ¡æ‰‹å¿…é¡»æ˜¯å®¢æˆ·ç«¯å‘é€åè®®ç‰ˆæœ¬å’Œè‡ªåŠ¨ç”Ÿæˆçš„æŒ‘æˆ˜å€¼ï¼ŒæœåŠ¡å™¨è¿”å›ž 101 HTTP å“åº”ç ï¼ˆSwitching Protocolsï¼‰å’Œæ•£åˆ—å½¢å¼çš„æŒ‘æˆ˜ç­”æ¡ˆï¼Œç¡®è®¤é€‰æ‹©çš„åè®®ç‰ˆæœ¬ï¼š å®¢æˆ·ç«¯å¿…é¡»å‘é€Sec-WebSocket-Version å’Œ Sec-WebSocket-Key ï¼› æœåŠ¡å™¨å¿…é¡»è¿”å›žSec-WebSocket-Accept ç¡®è®¤åè®®ï¼› å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡Sec-WebSocket-Protocol å‘é€åº”ç”¨å­åè®®åˆ—è¡¨ï¼› æœåŠ¡å™¨å¿…é¡»é€‰æ‹©ä¸€ä¸ªå­åè®®å¹¶é€šè¿‡Sec-WebSocket-Protocol è¿”å›žåè®®åï¼›å¦‚æžœæœåŠ¡å™¨ä¸æ”¯æŒä»»ä½•ä¸€ä¸ªåè®®ï¼Œè¿žæŽ¥æ–­å¼€ï¼› å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡Sec-WebSocket-Extensions å‘é€åè®®æ‰©å±•ï¼› æœåŠ¡å™¨å¯ä»¥é€šè¿‡Sec-WebSocket-Extensions ç¡®è®¤ä¸€æˆ–å¤šä¸ªæ‰©å±•ï¼›å¦‚æžœæœåŠ¡å™¨æ²¡æœ‰è¿”å›žæ‰©å±•ï¼Œåˆ™è¿žæŽ¥ä¸æ”¯æŒæ‰©å±•ã€‚ æœ€åŽï¼Œå‰è¿°æ¡æ‰‹å®ŒæˆåŽï¼Œå¦‚æžœæ¡æ‰‹æˆåŠŸï¼Œè¯¥è¿žæŽ¥å°±å¯ä»¥ç”¨ä½œåŒå‘é€šä¿¡ä¿¡é“äº¤æ¢WebSocket æ¶ˆæ¯ã€‚ä»Žæ­¤ä»¥åŽï¼Œå®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨ä¹‹é—´ä¸ä¼šå†å‘ç”Ÿ HTTP é€šä¿¡ï¼Œä¸€åˆ‡ç”±WebSocket åè®®æŽ¥ç®¡ã€‚ ä»£ç†ã€ä¸­é—´è®¾å¤‡ä¸Ž WebSocketå®žè·µä¸­ï¼Œè€ƒè™‘åˆ°å®‰å…¨å’Œä¿å¯†ï¼Œå¾ˆå¤šç”¨æˆ·éƒ½åªå¼€æ”¾æœ‰é™çš„ç«¯å£ï¼Œé€šå¸¸åªæœ‰ 80ï¼ˆHTTPï¼‰å’Œ 443ï¼ˆHTTPSï¼‰ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼ŒWebSocket åå•†æ˜¯é€šè¿‡ HTTP Upgradeæµè¿›è¡Œçš„ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä¸ŽçŽ°æœ‰ç½‘ç»œç­–ç•¥åŠåŸºç¡€è®¾æ–½å…¼å®¹ã€‚ä¸è¿‡ï¼Œæ­£å¦‚ â€œWeb ä»£ç†ã€ä¸­é—´è®¾å¤‡ã€TLS ä¸Žæ–°åè®®â€æ‰€è¯´ï¼Œå¾ˆå¤šçŽ°æœ‰çš„HTTP ä¸­é—´è®¾å¤‡å¯èƒ½ä¸ç†è§£æ–°çš„ WebSocket åè®®ï¼Œè€Œè¿™å¯èƒ½å¯¼è‡´å„ç§é—®é¢˜ï¼šç›²ç›®çš„è¿žæŽ¥å‡çº§ã€æ„å¤–ç¼“å†² WebSocket å¸§ã€ä¸æ˜Žå°±é‡Œåœ°ä¿®æ”¹å†…å®¹ã€æŠŠ WebSocket æµé‡è¯¯å½“ä½œä¸å®Œæ•´çš„ HTTP é€šä¿¡ï¼Œç­‰ç­‰ã€‚WebSocket çš„ Key å’Œ Accept æ¡æ‰‹å¯ä»¥è§£å†³å…¶ä¸­ä¸€äº›é—®é¢˜ï¼šè¿™æ˜¯æœåŠ¡å™¨çš„ä¸€ä¸ªå®‰å…¨ç­–ç•¥ï¼Œè€Œç›²ç›®â€œå‡çº§â€è¿žæŽ¥çš„ä¸­é—´è®¾å¤‡å¯èƒ½å¹¶ä¸ç†è§£ WebSocket åè®®ã€‚è™½ç„¶è¿™ä¸ªé¢„é˜²æŽªæ–½å¯¹æŸäº›ä»£ç†å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†å¯¹äºŽé‚£äº›â€œé€æ˜Žä»£ç†â€è¿˜æ˜¯ä¸è¡Œï¼Œå®ƒä»¬å¯èƒ½ä¼šåˆ†æžå¹¶æ„å¤–åœ°ä¿®æ”¹æ•°æ®ã€‚è§£å†³ä¹‹é“ï¼Ÿå»ºç«‹ä¸€æ¡ç«¯åˆ°ç«¯çš„å®‰å…¨é€šé“ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨ WSS ï¼åœ¨æ‰§è¡Œ HTTP Upgrade æ¡æ‰‹ä¹‹å‰ï¼Œå…ˆåå•†ä¸€æ¬¡ TLS ä¼šè¯ï¼Œåœ¨å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€æ¡åŠ å¯†é€šé“ï¼Œå°±å¯ä»¥è§£å†³å‰è¿°æ‰€æœ‰é—®é¢˜ã€‚è¿™ä¸ªæ–¹æ¡ˆå°¤å…¶é€‚åˆç§»åŠ¨å®¢æˆ·ç«¯ï¼Œå› ä¸ºå®ƒä»¬çš„æµé‡ç»å¸¸è¦ç©¿è¶Šå„ç§ä»£ç†æœåŠ¡ï¼Œè¿™äº›ä»£ç†æœåŠ¡å¾ˆå¯èƒ½ä¸è®¤è¯† WebSocketã€‚ WebSocketä½¿ç”¨åœºæ™¯åŠæ€§èƒ½è¯·æ±‚å’Œå“åº”æµ æŠŠä¼ è¾“æœºåˆ¶ä»Ž XHR åˆ‡æ¢ä¸º SSE æˆ– WebSocket å¹¶ä¸ä¼šå‡å°‘å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨é—´çš„å¾€è¿”æ¬¡æ•°ï¼ä¸ç®¡ä»€ä¹ˆä¼ è¾“æœºåˆ¶ï¼Œæ•°æ®åŒ…çš„ä¼ æ’­å»¶è¿Ÿéƒ½ä¸€æ ·ã€‚ä¸è¿‡ï¼Œé™¤äº†ä¼ æ’­å»¶è¿Ÿï¼Œè¿˜æœ‰ä¸€ä¸ªæŽ’é˜Ÿå»¶è¿Ÿâ€”â€”æ¶ˆæ¯åœ¨è¢«å‘é€ç»™å¦ä¸€ç«¯ä¹‹å‰å¿…é¡»åœ¨å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ä¸Šç­‰å¾…çš„æ—¶é—´ã€‚ WebRTCç•¥ PDFä¹¦ç±ä¸‹è½½åœ°å€ï¼šhttps://github.com/jiankunking/books-recommendation/tree/master/HTTP]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>Network</tag>
        <tag>HTTP</tag>
        <tag>TCP</tag>
        <tag>UDP</tag>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
        <tag>SSL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java ForkJoin è§£æž]]></title>
    <url>%2Fjava-forkjoin.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸»è¦æƒ³äº†è§£ä¸¤ä¸ªåœ°æ–¹ï¼šå¦‚ä½•çªƒå–ä»»åŠ¡ã€taskå¦‚ä½•ç­‰å¾…ï¼ˆjoinï¼‰ä»£ç åŸºäºŽ OpenJDK 12 çªƒå–ç®—æ³•ï¼ˆwork-stealingï¼‰ä»ŽForkJoin-Paper-DougLeaä¸­å¯ä»¥çœ‹å‡º: æ¯ä¸ªé˜Ÿåˆ—åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥æ‰§è¡Œé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ï¼Œçº¿ç¨‹å’Œé˜Ÿåˆ—ä¸€ä¸€å¯¹åº”ã€‚ é˜Ÿåˆ—ä½¿ç”¨çš„æ˜¯åŒç«¯é˜Ÿåˆ—ï¼Œæ”¯æŒLIFOã€FIFOã€‚ å­ä»»åŠ¡ä¼šè¢«æ”¾åˆ°çº¿ç¨‹ï¼ˆä¸ä¸€å®šæ˜¯å½“å‰çº¿ç¨‹ï¼‰çš„é˜Ÿåˆ—ä¸­ã€‚ å·¥ä½œçº¿ç¨‹æŒ‰ç…§LIFOçš„é¡ºåºå¤„ç†è‡ªå·±é˜Ÿåˆ—ä¸­æ•°æ®ã€‚ å½“ä¸€ä¸ªå·¥ä½œçº¿ç¨‹å¤„ç†å®Œè‡ªå·±é˜Ÿåˆ—ä¸­æ•°æ®çš„æ—¶å€™ï¼Œä¼šéšæœºæŒ‘é€‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå¹¶â€œçªƒå–â€çš„è¯¥å·¥ä½œçº¿ç¨‹é˜Ÿåˆ—é˜Ÿå°¾çš„taskã€‚ åˆ°äº†è¿™é‡Œå°±å¯ä»¥çŸ¥é“ï¼Œçªƒå–ä»»åŠ¡ä»Žå…¶ä»–çº¿ç¨‹é˜Ÿåˆ—çš„å°¾éƒ¨çªƒå–çš„äº†ã€‚ çªƒå–ç®—æ³•ä¼˜ç¼ºç‚¹å·¥ä½œçªƒå–ç®—æ³•çš„ä¼˜ç‚¹ï¼šå……åˆ†åˆ©ç”¨çº¿ç¨‹è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œå‡å°‘äº†çº¿ç¨‹é—´çš„ç«žäº‰ã€‚å·¥ä½œçªƒå–ç®—æ³•çš„ç¼ºç‚¹ï¼šåœ¨æŸäº›æƒ…å†µä¸‹è¿˜æ˜¯å­˜åœ¨ç«žäº‰ï¼Œæ¯”å¦‚åŒç«¯é˜Ÿåˆ—é‡Œåªæœ‰ä¸€ä¸ªä»»åŠ¡æ—¶ã€‚å¹¶ä¸”è¯¥ç®—æ³•ä¼šæ¶ˆè€—äº†æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚åˆ›å»ºå¤šä¸ªçº¿ç¨‹å’Œå¤šä¸ªåŒç«¯é˜Ÿåˆ—ã€‚ Task ç­‰å¾…ï¼ˆjoinï¼‰Joinæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯é˜»å¡žå½“å‰çº¿ç¨‹å¹¶ç­‰å¾…èŽ·å–ç»“æžœã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š 123456public final V join() &#123; int s; if (((s = doJoin()) &amp; ABNORMAL) != 0) reportException(s); return getRawResult();&#125; é¦–å…ˆï¼Œå®ƒè°ƒç”¨äº†doJoin()æ–¹æ³•ï¼Œé€šè¿‡doJoin()æ–¹æ³•å¾—åˆ°å½“å‰ä»»åŠ¡çš„çŠ¶æ€æ¥åˆ¤æ–­è¿”å›žä»€ä¹ˆç»“æžœï¼Œä»»åŠ¡çŠ¶æ€æœ‰4ç§ï¼šå·²å®Œæˆï¼ˆNORMALï¼‰ã€è¢«å–æ¶ˆï¼ˆCANCELLEDï¼‰ã€ä¿¡å·ï¼ˆSIGNALï¼‰å’Œå‡ºçŽ°å¼‚å¸¸ï¼ˆEXCEPTIONALï¼‰ã€‚ å¦‚æžœä»»åŠ¡çŠ¶æ€æ˜¯å·²å®Œæˆï¼Œåˆ™ç›´æŽ¥è¿”å›žä»»åŠ¡ç»“æžœã€‚ å¦‚æžœä»»åŠ¡çŠ¶æ€æ˜¯è¢«å–æ¶ˆï¼Œåˆ™ç›´æŽ¥æŠ›å‡ºCancellationExceptionã€‚ å¦‚æžœä»»åŠ¡çŠ¶æ€æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ç›´æŽ¥æŠ›å‡ºå¯¹åº”çš„å¼‚å¸¸ã€‚ è®©æˆ‘ä»¬å†æ¥åˆ†æžä¸€ä¸‹doJoin()æ–¹æ³•çš„å®žçŽ°ä»£ç : 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556/** * Implementation for join, get, quietlyJoin. Directly handles * only cases of already-completed, external wait, and * unfork+exec. Others are relayed to ForkJoinPool.awaitJoin. * * @return status upon completion */private int doJoin() &#123; int s; Thread t; ForkJoinWorkerThread wt; ForkJoinPool.WorkQueue w; return //å·²å®Œæˆ,è¿”å›žstatus (s = status) &lt; 0 ? s : //æœªå®Œæˆ,å¦‚æžœå½“å‰çº¿ç¨‹æ˜¯ForkJoinWorkerThread,ä»Žè¯¥çº¿ç¨‹ä¸­å–å‡ºworkQueue,å¹¶å°è¯•å°† //å½“å‰taskå‡ºé˜Ÿç„¶åŽæ‰§è¡Œ,æ‰§è¡Œçš„ç»“æžœæ˜¯å®Œæˆåˆ™è¿”å›žçŠ¶æ€,å¦åˆ™ä½¿ç”¨å½“çº¿ç¨‹æ± æ‰€åœ¨çš„ForkJoinPoolçš„awaitJoinæ–¹æ³•ç­‰å¾… ((t = Thread.currentThread()) instanceof ForkJoinWorkerThread) ? (w = (wt = (ForkJoinWorkerThread)t).workQueue).tryUnpush(this) &amp;&amp; (s = doExec()) &lt; 0 ? s : wt.pool.awaitJoin(w, this, 0L) : //å½“å‰çº¿ç¨‹ä¸æ˜¯ForkJoinWorkerThread,è°ƒç”¨externalAwaitDoneæ–¹æ³• //externalAwaitDone: Blocks a non-worker-thread until completion. externalAwaitDone();&#125;/** * Pops the given task only if it is at the current top. */final boolean tryUnpush(ForkJoinTask&lt;?&gt; task) &#123; boolean popped = false; int s, cap; ForkJoinTask&lt;?&gt;[] a; if ((a = array) != null &amp;&amp; (cap = a.length) &gt; 0 &amp;&amp; (s = top) != base &amp;&amp; (popped = QA.compareAndSet(a, (cap - 1) &amp; --s, task, null))) TOP.setOpaque(this, s); return popped;&#125;/** * Primary execution method for stolen tasks. Unless done, calls * exec and records status if completed, but doesn&apos;t wait for * completion otherwise. * * @return status on exit from this method*/final int doExec() &#123; int s; boolean completed; // ä»…æœªå®Œæˆçš„ä»»åŠ¡ä¼šè¿è¡Œ,å…¶ä»–æƒ…å†µä¼šå¿½ç•¥. if ((s = status) &gt;= 0) &#123; try &#123; //execæ˜¯abstractæ–¹æ³• //è°ƒç”¨ForkJoinTaskå­ç±»ä¸­exec completed = exec(); &#125; catch (Throwable rex) &#123; completed = false; s = setExceptionalCompletion(rex); &#125; if (completed) s = setDone(); &#125; return s;&#125; åœ¨doJoin()æ–¹æ³•é‡Œï¼Œé¦–å…ˆé€šè¿‡æŸ¥çœ‹ä»»åŠ¡çš„çŠ¶æ€ï¼Œçœ‹ä»»åŠ¡æ˜¯å¦å·²ç»æ‰§è¡Œå®Œæˆï¼Œå¦‚æžœæ‰§è¡Œå®Œæˆï¼Œåˆ™ç›´æŽ¥è¿”å›žä»»åŠ¡çŠ¶æ€ï¼›å¦‚æžœæ²¡æœ‰æ‰§è¡Œå®Œï¼Œåˆ™ä»Žä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œã€‚å¦‚æžœä»»åŠ¡é¡ºåˆ©æ‰§è¡Œå®Œæˆï¼Œåˆ™è®¾ç½®ä»»åŠ¡çŠ¶æ€ä¸ºNORMALï¼Œå¦‚æžœå‡ºçŽ°å¼‚å¸¸ï¼Œåˆ™è®°å½•å¼‚å¸¸ï¼Œå¹¶å°†ä»»åŠ¡çŠ¶æ€è®¾ç½®ä¸ºEXCEPTIONALã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JUC</tag>
        <tag>ForkJoin</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java ThreadLocal]]></title>
    <url>%2Fjava-threadlocal.html</url>
    <content type="text"><![CDATA[åŸºäºŽOpenJDK 12 å¼•æœ¬æ–‡ä¸»è¦æƒ³äº†è§£ä¸¤ä¸ªåœ°æ–¹ï¼š ThreadLocalå®žä¾‹çœ‹èµ·æ¥æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œä½†å®žé™…ä¸Šæ˜¯å½¼æ­¤ç‹¬ç«‹çš„ï¼Œè¿™ä¸ªæ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ ThreadLocalä½¿ç”¨ä¸å½“çœŸçš„ä¼šOOMå—ï¼Ÿå¦‚æžœä¼šï¼Œé‚£ä¹ˆåŽŸå› æ˜¯å•¥ï¼Ÿ å…ˆçœ‹ä¸€ä¸‹ThreadLocalçš„å®˜æ–¹APIè§£é‡Šä¸ºï¼š è¯¥ç±»æä¾›äº†çº¿ç¨‹å±€éƒ¨ (thread-local) å˜é‡ã€‚è¿™äº›å˜é‡ä¸åŒäºŽå®ƒä»¬çš„æ™®é€šå¯¹åº”ç‰©ï¼Œå› ä¸ºè®¿é—®æŸä¸ªå˜é‡ï¼ˆé€šè¿‡å…¶ get æˆ– set æ–¹æ³•ï¼‰çš„æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å±€éƒ¨å˜é‡ï¼Œå®ƒç‹¬ç«‹äºŽå˜é‡çš„åˆå§‹åŒ–å‰¯æœ¬[åŽŸæ–‡ï¼šThese variables differ from their normal counterparts in that each thread that accesses one (via its get or set method) has its own, independently initialized copy of the variable.]ã€‚ThreadLocal å®žä¾‹é€šå¸¸æ˜¯ç±»ä¸­çš„ private static å­—æ®µï¼Œå®ƒä»¬å¸Œæœ›å°†çŠ¶æ€ä¸ŽæŸä¸€ä¸ªçº¿ç¨‹ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ· ID æˆ–äº‹åŠ¡ IDï¼‰ç›¸å…³è”ã€‚ å¤§æ¦‚çš„æ„æ€æœ‰ä¸¤ç‚¹ï¼š ThreadLocalæä¾›äº†ä¸€ç§è®¿é—®æŸä¸ªå˜é‡çš„ç‰¹æ®Šæ–¹å¼ï¼šè®¿é—®åˆ°çš„å˜é‡å±žäºŽå½“å‰çº¿ç¨‹ï¼Œå³ä¿è¯æ¯ä¸ªçº¿ç¨‹çš„å˜é‡ä¸ä¸€æ ·ï¼Œè€ŒåŒä¸€ä¸ªçº¿ç¨‹åœ¨ä»»ä½•åœ°æ–¹æ‹¿åˆ°çš„å˜é‡éƒ½æ˜¯ä¸€è‡´çš„ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„çº¿ç¨‹éš”ç¦»ã€‚ å¦‚æžœè¦ä½¿ç”¨ThreadLocalï¼Œé€šå¸¸å®šä¹‰ä¸ºprivate staticç±»åž‹ï¼Œåœ¨æˆ‘çœ‹æ¥æœ€å¥½æ˜¯å®šä¹‰ä¸ºprivate static finalç±»åž‹ã€‚ çœ‹ä¸€æ®µä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637// ä»£ç æ¥è‡ªï¼š// http://tutorials.jenkov.com/java-concurrency/threadlocal.htmlpublic class ThreadLocalExample &#123; public static class MyRunnable implements Runnable &#123; private ThreadLocal&lt;Integer&gt; threadLocal = new ThreadLocal&lt;Integer&gt;(); @Override public void run() &#123; //æ³¨æ„è¿™é‡Œ setçš„å€¼æ˜¯runå‡½æ•°çš„å†…éƒ¨å˜é‡ï¼Œå¦‚æžœæ˜¯MyRunnableçš„å…¨å±€å˜é‡ //åˆ™æ— æ³•èµ·åˆ°çº¿ç¨‹éš”ç¦»çš„ä½œç”¨ threadLocal.set((int) (Math.random() * 100D)); try &#123; //sleepä¸¤ç§’çš„ä½œç”¨æ˜¯è®©thread2 setæ“ä½œåœ¨thread1çš„è¾“å‡ºä¹‹å‰æ‰§è¡Œ //å¦‚æžœçº¿ç¨‹ä¹‹é—´æ˜¯å…±ç”¨threadLocalï¼Œåˆ™thread2 setæ“ä½œä¼šè¦†ç›–æŽ‰thread1çš„setæ“ä½œ //ä»Žè€Œä¸¤è€…çš„è¾“å‡ºéƒ½æ˜¯thread2 setçš„å€¼ Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; System.out.println(e); &#125; System.out.println(threadLocal.get()); &#125; &#125; public static void main(String[] args) throws InterruptedException &#123; MyRunnable sharedRunnableInstance = new MyRunnable(); Thread thread1 = new Thread(sharedRunnableInstance); Thread thread2 = new Thread(sharedRunnableInstance); thread1.start(); thread2.start(); thread1.join(); //wait for thread 1 to terminate thread2.join(); //wait for thread 2 to terminate &#125;&#125; è¾“å‡ºç»“æžœï¼š 123456thread1 startthread2 start38thread1 join78thread2 join MyRunnable runä¸­sleepä¸¤ç§’çš„ä½œç”¨æ˜¯è®©thread2 setæ“ä½œåœ¨thread1çš„è¾“å‡ºä¹‹å‰æ‰§è¡Œï¼Œå¦‚æžœçº¿ç¨‹ä¹‹é—´æ˜¯å…±ç”¨threadLocalï¼Œåˆ™thread2 setæ“ä½œä¼šè¦†ç›–æŽ‰thread1çš„setæ“ä½œï¼Œä¸¤è€…çš„è¾“å‡ºéƒ½æ˜¯thread2 setçš„å€¼ï¼Œä»Žè€Œè¾“å‡ºçš„åº”è¯¥æ˜¯åŒä¸€ä¸ªå€¼ã€‚ ä½†ä»Žä»£ç æ‰§è¡Œç»“æžœæ¥çœ‹ï¼Œthread1ã€thread2çš„threadLocalæ˜¯ä¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯å®žçŽ°äº†çº¿ç¨‹éš”ç¦»ã€‚ ThreadLocalå®žä¾‹åœ¨çº¿ç¨‹é—´æ˜¯å¦‚ä½•ç‹¬ç«‹çš„ï¼Ÿçœ‹ä¸€çœ¼ThreadLocal setæ–¹æ³•ï¼š 12345678910111213141516171819public void set(T value) &#123; //currentThreadæ˜¯ä¸ªnativeæ–¹æ³•ï¼Œä¼šè¿”å›žå¯¹å½“å‰æ‰§è¡Œçº¿ç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚ Thread t = Thread.currentThread(); //getMap è¿”å›žçº¿ç¨‹è‡ªèº«çš„threadLocals ThreadLocalMap map = getMap(t); if (map != null) &#123; //æŠŠvalue setåˆ°çº¿ç¨‹è‡ªèº«çš„ThreadLocalMapä¸­äº† map.set(this, value); &#125; else &#123; //çº¿ç¨‹è‡ªèº«çš„ThreadLocalMapæœªåˆå§‹åŒ–ï¼Œåˆ™å…ˆåˆå§‹åŒ–ï¼Œå†set createMap(t, value); &#125;&#125;ThreadLocalMap getMap(Thread t) &#123; return t.threadLocals;&#125;//Threadç±»ä¸­//ThreadLocalMapsetçš„setæ–¹æ³•æœªæ‰§è¡Œæ·±æ‹·è´ï¼Œéœ€è¦æ³¨æ„ä¼ é€’å€¼çš„ç±»åž‹ThreadLocal.ThreadLocalMap threadLocals = null; ä»Žä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨setçš„æ—¶å€™ï¼Œä¼šæ ¹æ®Threadå¯¹è±¡çš„å¼•ç”¨æ¥å°†å€¼æ·»åŠ åˆ°å„è‡ªçº¿ç¨‹ä¸­ã€‚ä½†setçš„å€¼valueè¿˜æ˜¯åŒä¸€ä¸ªå¯¹è±¡,æ—¢ç„¶ä¼ é€’çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£å°±æ¶‰åŠåˆ°å¦ä¸€ä¸ªé—®é¢˜ï¼šå‚æ•°å€¼ä¼ é€’ã€å¼•ç”¨ä¼ é€’çš„é—®é¢˜äº†ã€‚ åŸºæœ¬ç±»åž‹123456789101112131415161718192021222324252627282930313233343536373839public class ThreadLocalExample &#123; public static class MyRunnable implements Runnable &#123; private ThreadLocal&lt;Object&gt; threadLocal = new ThreadLocal&lt;&gt;(); // MyRunnable å…¨å±€å˜é‡ int random; @Override public void run() &#123; random = (int) (Math.random() * 100D); threadLocal.set(random); try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; System.out.println(e); &#125; System.out.println(threadLocal.get()); &#125; &#125; public static void main(String[] args) throws InterruptedException &#123; MyRunnable sharedRunnableInstance = new MyRunnable(); Thread thread1 = new Thread(sharedRunnableInstance); Thread thread2 = new Thread(sharedRunnableInstance); thread1.start(); System.out.println(&quot;thread1 start&quot;); thread2.start(); System.out.println(&quot;thread2 start&quot;); thread1.join(); //wait for thread 1 to terminate System.out.println(&quot;thread1 join&quot;); thread2.join(); //wait for thread 2 to terminate System.out.println(&quot;thread2 join&quot;); &#125;&#125; è¾“å‡ºç»“æžœï¼š 1234567thread1 startthread2 start//ä¸¤ä¸ªå€¼ä¸åŒ16thread1 join75thread2 join ä»Žè¾“å‡ºå¯ä»¥çœ‹å‡ºä¸¤è€…éš”ç¦»äº†ã€‚ å¼•ç”¨ç±»åž‹å…¨å±€å¼•ç”¨12345678910111213141516171819202122232425262728293031323334353637383940414243public class ThreadLocalExample &#123; public static class MyRunnable implements Runnable &#123; private ThreadLocal&lt;Object&gt; threadLocal = new ThreadLocal&lt;&gt;(); // MyRunnable å…¨å±€å˜é‡ Obj obj = new Obj(); @Override public void run() &#123; obj.value = (int) (Math.random() * 100D); threadLocal.set(obj); try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; System.out.println(e); &#125; System.out.println(((Obj) threadLocal.get()).value); &#125; class Obj &#123; int value; &#125; &#125; public static void main(String[] args) throws InterruptedException &#123; MyRunnable sharedRunnableInstance = new MyRunnable(); Thread thread1 = new Thread(sharedRunnableInstance); Thread thread2 = new Thread(sharedRunnableInstance); thread1.start(); System.out.println(&quot;thread1 start&quot;); thread2.start(); System.out.println(&quot;thread2 start&quot;); thread1.join(); //wait for thread 1 to terminate System.out.println(&quot;thread1 join&quot;); thread2.join(); //wait for thread 2 to terminate System.out.println(&quot;thread2 join&quot;); &#125;&#125; è¾“å‡ºç»“æžœï¼š 1234567thread1 startthread2 start//ä¸¤ä¸ªå€¼ç›¸åŒ3636thread1 jointhread2 join ä»Žè¾“å‡ºç»“æžœæ¥çœ‹ï¼Œå½“setæ“ä½œçš„å€¼æ˜¯MyRunnableçš„å…¨å±€å˜é‡ï¼Œå¹¶ä¸”æ˜¯å¼•ç”¨ç±»åž‹çš„æ—¶å€™ï¼Œæ— æ³•èµ·åˆ°éš”ç¦»çš„ä½œç”¨ã€‚ å±€éƒ¨å¼•ç”¨123456789101112131415161718192021222324252627282930313233343536373839404142public class ThreadLocalExample &#123; public static class MyRunnable implements Runnable &#123; private ThreadLocal&lt;Object&gt; threadLocal = new ThreadLocal&lt;&gt;(); //Obj obj = new Obj(); @Override public void run() &#123; Obj obj = new Obj(); obj.value = (int) (Math.random() * 100D); threadLocal.set(obj); try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; System.out.println(e); &#125; System.out.println(((Obj) threadLocal.get()).value); &#125; class Obj &#123; int value; &#125; &#125; public static void main(String[] args) throws InterruptedException &#123; MyRunnable sharedRunnableInstance = new MyRunnable(); Thread thread1 = new Thread(sharedRunnableInstance); Thread thread2 = new Thread(sharedRunnableInstance); thread1.start(); System.out.println(&quot;thread1 start&quot;); thread2.start(); System.out.println(&quot;thread2 start&quot;); thread1.join(); //wait for thread 1 to terminate System.out.println(&quot;thread1 join&quot;); thread2.join(); //wait for thread 2 to terminate System.out.println(&quot;thread2 join&quot;); &#125;&#125; è¾“å‡ºç»“æžœï¼š 1234567thread1 startthread2 start//ä¸¤ä¸ªå€¼ä¸åŒ1219thread1 jointhread2 join ä»Žè¾“å‡ºç»“æžœçœ‹ï¼Œå±€éƒ¨å¼•ç”¨ï¼Œå¯ä»¥ç›¸äº’éš”ç¦»ã€‚ åˆ°è¿™é‡Œå¯ä»¥çœ‹å‡ºThreadLocalï¼Œåªæ˜¯æŠŠsetå€¼æˆ–å¼•ç”¨ç»‘å®šåˆ°äº†å½“å‰çº¿ç¨‹ï¼Œä½†å´æ²¡æœ‰è¿›è¡Œç›¸åº”çš„æ·±æ‹·è´ï¼Œæ‰€ä»¥ThreadLocalè¦æƒ³åšçš„çº¿ç¨‹éš”ç¦»ï¼Œå¿…é¡»æ˜¯åŸºæœ¬ç±»åž‹æˆ–è€…runçš„å±€éƒ¨å˜é‡ã€‚ ThreadLocal OOM ï¼Ÿçœ‹ä¸€ä¸‹ThreadLocalMapå†…éƒ¨Entryï¼š 123456789static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; &#123; /** The value associated with this ThreadLocal. */ Object value; Entry(ThreadLocal&lt;?&gt; k, Object v) &#123; super(k); value = v; &#125;&#125; ä»Žä»£ç ä¸­çœ‹åˆ°ï¼ŒEntryç»§æ‰¿äº†WeakReferenceï¼Œå¹¶å°†ThreadLocalè®¾ç½®ä¸ºäº†WeakReferenceï¼Œvalueè®¾ç½®ä¸ºå¼ºå¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯ï¼šå½“æ²¡æœ‰å¼ºå¼•ç”¨æŒ‡å‘ThreadLocalå˜é‡æ—¶ï¼Œå®ƒå¯è¢«å›žæ”¶ã€‚ ä½†æ˜¯ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šThreadLocalMapç»´æŠ¤ThreadLocalå˜é‡ä¸Žå…·ä½“å®žä¾‹çš„æ˜ å°„ï¼Œå½“ThreadLocalå˜é‡è¢«å›žæ”¶åŽï¼Œè¯¥æ˜ å°„çš„keyå˜ä¸º nullï¼Œè€Œè¯¥Entryè¿˜æ˜¯åœ¨ThreadLocalMapä¸­ï¼Œä»Žè€Œè¿™äº›æ— æ³•æ¸…ç†çš„Entryï¼Œä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚ ThreadLocalè‡ªå¸¦çš„removeã€setæ–¹æ³•ï¼Œéƒ½æ— æ³•å¤„ç†ThreadLocalè‡ªèº«ä¸ºnullçš„æƒ…å†µï¼Œå› ä¸ºä»£ç ä¸­éƒ½ç›´æŽ¥å–ThreadLocalçš„threadLocalHashCodeå±žæ€§äº†ï¼Œæ‰€ä»¥å¦‚æžœThreadLocalè‡ªèº«å·²ç»æ˜¯nullï¼Œè¿™æ—¶è°ƒç”¨removeã€setä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ˆjava.lang.NullPointerExceptionï¼‰çš„ã€‚ æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨ThreadLocalçš„æ—¶å€™ï¼Œåœ¨ä½¿ç”¨å®Œæ¯•è®°å¾—removeï¼ˆremoveæ–¹æ³•ä¼šå°†Entryçš„valueåŠEntryè‡ªèº«è®¾ç½®ä¸ºnullå¹¶è¿›è¡Œæ¸…ç†ï¼‰ã€‚ JDK 12 ThreadLocalä»£ç åœ°å€ï¼šhttps://github.com/jiankunking/openjdk12/blob/master/src/java.base/share/classes/java/lang/ThreadLocal.java]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ThreadLocal</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¯‘ Java Concurrent Atomic Packageè¯¦è§£]]></title>
    <url>%2Fjava-concurrent-atomic-package.html</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ªï¼šPackage java.util.concurrent.atomic åœ°å€ï¼šhttps://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/package-summary.html#package.descriptionç¿»è¯‘JDK8è€Œä¸æ˜¯12çš„åŽŸå› æ˜¯JDK8å¯¹ä¸Žå†…å­˜è¯­ä¹‰éƒ¨åˆ†è®²è§£æ›´åŠ è¯¦ç»†ã€‚ Package java.util.concurrent.atomic å¯¹äºŽå•ä¸ªå˜é‡æ”¯æŒæ— é”ã€çº¿ç¨‹å®‰å…¨æ“ä½œçš„å·¥å…·ç±»ã€‚ ç±»æ‘˜è¦ï¼š ç±»å æè¿° AtomicBoolean å¯ä»¥åŽŸå­æ€§æ›´æ–°çš„booleanå€¼ã€‚ AtomicInteger å¯ä»¥åŽŸå­æ€§æ›´æ–°çš„intå€¼ã€‚ AtomicIntegerArray ä¸€ä¸ªintæ•°ç»„ï¼Œå…¶ä¸­çš„å…ƒç´ å¯ä»¥åŽŸå­æ€§æ›´æ–°ã€‚ AtomicIntegerFieldUpdater åŸºäºŽåå°„ï¼Œå¯ä»¥å¯¹æŒ‡å®šç±»çš„æŒ‡å®š volatile int å­—æ®µè¿›è¡ŒåŽŸå­æ›´æ–°ã€‚ AtomicLong å¯ä»¥åŽŸå­æ€§æ›´æ–°çš„longå€¼ã€‚ AtomicLongArray ä¸€ä¸ªlongæ•°ç»„ï¼Œå…¶ä¸­çš„å…ƒç´ å¯ä»¥åŽŸå­æ€§æ›´æ–°ã€‚ AtomicLongFieldUpdater åŸºäºŽåå°„ï¼Œå¯ä»¥å¯¹æŒ‡å®šç±»çš„æŒ‡å®š volatile long å­—æ®µè¿›è¡ŒåŽŸå­æ›´æ–°ã€‚ AtomicMarkableReference ç»´æŠ¤å¸¦æœ‰æ ‡è®°ä½çš„å¯¹è±¡å¼•ç”¨ï¼Œå¯ä»¥åŽŸå­æ–¹å¼å¯¹å…¶è¿›è¡Œæ›´æ–°ã€‚ AtomicReference å¯ä»¥åŽŸå­æ€§æ›´æ–°çš„å¯¹è±¡å¼•ç”¨ AtomicReferenceArray ä¸€ä¸ªå¯¹è±¡å¼•ç”¨æ•°ç»„ï¼Œå…¶ä¸­çš„å…ƒç´ å¯ä»¥åŽŸå­æ€§æ›´æ–°ã€‚ AtomicReferenceFieldUpdater&lt;T,V&gt; åŸºäºŽåå°„ï¼Œå¯ä»¥å¯¹æŒ‡å®šç±»çš„æŒ‡å®š volatile reference å­—æ®µè¿›è¡ŒåŽŸå­æ›´æ–°ã€‚ AtomicStampedReference ç»´æŠ¤å¸¦æœ‰æ•´æ•°ç‰ˆæœ¬æ ‡å¿—çš„å¯¹è±¡å¼•ç”¨ï¼Œå¯ä»¥åŽŸå­æ–¹å¼å¯¹å…¶è¿›è¡Œæ›´æ–°ã€‚ DoubleAccumulator One or more variables that together maintain a running double value updated using a supplied function. DoubleAdder One or more variables that together maintain an initially zero double sum. LongAccumulator One or more variables that together maintain a running long value updated using a supplied function. LongAdder One or more variables that together maintain an initially zero long sum. DoubleAccumulatorã€DoubleAdderã€LongAccumulatorã€LongAdder å‡æ˜¯Striped64çš„å­ç±»ï¼Œå†…éƒ¨ç»´æŠ¤çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå½“å¹¶å‘æ›´æ–°æ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹æ“ä½œçš„æ˜¯æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œä»Žè€Œé™ä½Žé”çš„ç²’åº¦ã€‚ æœ¬è´¨ä¸Šï¼Œè¯¥packageä¸‹çš„ç±»æ‰©å±•äº†volatileå€¼ã€å­—æ®µã€æ•°ç»„å…ƒç´ çš„æ¦‚å¿µï¼Œæä¾›ä»¥ä¸‹å½¢å¼çš„åŽŸå­æ›´æ–°æ“ä½œï¼š 1boolean compareAndSet(expectedValue, updateValue); è¯¥æ–¹æ³•ï¼ˆåœ¨ä¸åŒç±»ä¸­çš„å‚æ•°ç±»åž‹ä¸åŒï¼‰åŽŸå­åœ°å°†å˜é‡è®¾ç½®ä¸ºupdateValueï¼Œå¦‚æžœå®ƒå½“å‰æŒæœ‰expectedValueï¼Œæ›´æ–°æˆåŠŸè¿”å›žtrueã€‚è¯¥åŒ…ä¸­çš„ç±»è¿˜åŒ…å«èŽ·å–å’Œæ— æ¡ä»¶è®¾ç½®ï¼ˆsetï¼‰å€¼çš„æ–¹æ³•ã€‚ è¿™äº›æ–¹æ³•çš„è§„èŒƒä½¿å®žçŽ°èƒ½å¤Ÿé‡‡ç”¨å½“ä»£å¤„ç†å™¨ä¸Šå¯ç”¨çš„é«˜æ•ˆæœºå™¨çº§åŽŸå­æŒ‡ä»¤ã€‚ ç„¶è€Œï¼Œåœ¨æŸäº›å¹³å°ä¸Šï¼Œæ”¯æŒå¯èƒ½éœ€è¦æŸç§å½¢å¼çš„å†…éƒ¨é”å®šã€‚å› æ­¤ï¼Œè¿™äº›æ–¹æ³•ä¸æ˜¯ä¸¥æ ¼ä¿è¯æ˜¯éžé˜»å¡žçš„ï¼ˆçº¿ç¨‹å¯èƒ½åœ¨æ‰§è¡Œæ“ä½œä¹‹å‰æš‚æ—¶é˜»å¡žï¼‰ã€‚ AtomicBooleanã€AtomicIntegerã€AtomicLongå’ŒAtomicReferenceç±»çš„å®žä¾‹éƒ½æä¾›å¯¹å¯¹åº”ç±»åž‹çš„å•ä¸ªå˜é‡çš„è®¿é—®å’Œæ›´æ–°ã€‚æ¯ä¸ªç±»è¿˜æä¾›äº†é€‚ç”¨äºŽè¯¥ç±»åž‹çš„å®žç”¨æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œç±»AtomicLongå’ŒAtomicIntegeræä¾›åŽŸå­å¢žé‡æ–¹æ³•ã€‚ ä¸€ä¸ªåº”ç”¨æ˜¯ç”Ÿæˆåºåˆ—å·ï¼Œå¦‚ï¼š 123456class Sequencer &#123; private final AtomicLong sequenceNumber = new AtomicLong(0); public long next() &#123; return sequenceNumber.getAndIncrement(); &#125;&#125; åŽŸå­æ€§è®¿é—®å’Œæ›´æ–°å†…å­˜æ•ˆæžœï¼Œä¸Žvolatileséµå¾ªåŒæ ·çš„è§„åˆ™ï¼Œå¦‚The Java Language Specification (17.4 Memory Model)æ‰€è¿°ï¼š getä¸Žvolatileè¯»æ•ˆæžœä¸€æ · setä¸Žvolatileå†™æ•ˆæžœä¸€æ · lazySetä¸Žå†™å…¥(åˆ†é…)volatileå˜é‡çš„æ•ˆæžœä¸€æ ·ã€å†™æ“ä½œä¸ä¼šä¸Žä¹‹å‰çš„ä»»ä½•å†™æ“ä½œé‡æ–°æŽ’åºã€‘ï¼Œä½†å®ƒå¯èƒ½è¢«åŽç»­æ“ä½œé‡æŽ’ã€ä¹Ÿå°±æ˜¯ï¼Œåœ¨volatileå†™æˆ–è€…åŒæ­¥æ“ä½œä¹‹å‰ï¼Œå¯èƒ½å¯¹äºŽå…¶å®ƒçº¿ç¨‹ä¸å¯è§ã€‘ã€‚ compareAndSetå’Œæ‰€æœ‰å…¶ä»–è¯»å–å’Œæ›´æ–°æ“ä½œ(å¦‚getAndIncrement)ä¸€æ ·ï¼Œä¸Žvolatileå˜é‡è¯»å–å’Œå†™å…¥å…·æœ‰ç›¸åŒçš„å†…å­˜æ•ˆæžœã€‚ lazySetæ˜¯ä½¿ç”¨Unsafe.putOrderedObjectæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨å¯¹ä½Žå»¶è¿Ÿä»£ç æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œå®ƒèƒ½å¤Ÿå®žçŽ°éžé˜»å¡žçš„å†™å…¥ï¼Œè¿™äº›å†™å…¥ä¸ä¼šè¢«Javaçš„JITé‡æ–°æŽ’åºæŒ‡ä»¤(instruction reordering)ï¼Œè¿™æ ·å®ƒä½¿ç”¨å¿«é€Ÿçš„å­˜å‚¨-å­˜å‚¨(store-store) barrier, è€Œä¸æ˜¯è¾ƒæ…¢çš„å­˜å‚¨-åŠ è½½(store-load) barrier, åŽè€…æ€»æ˜¯ç”¨åœ¨volatileçš„å†™æ“ä½œä¸Šï¼Œè¿™ç§æ€§èƒ½æå‡æ˜¯æœ‰ä»£ä»·çš„ï¼Œè™½ç„¶ä¾¿å®œï¼Œä¹Ÿå°±æ˜¯å†™åŽç»“æžœå¹¶ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°ï¼Œç”šè‡³æ˜¯è‡ªå·±çš„çº¿ç¨‹ï¼Œé€šå¸¸æ˜¯å‡ çº³ç§’åŽè¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°ï¼Œè¿™ä¸ªæ—¶é—´æ¯”è¾ƒçŸ­ï¼Œæ‰€ä»¥ä»£ä»·å¯ä»¥å¿å—ã€‚è®¾æƒ³å¦‚ä¸‹åœºæ™¯: è®¾ç½®ä¸€ä¸ª volatile å˜é‡ä¸º nullï¼Œè®©è¿™ä¸ªå¯¹è±¡è¢« GC æŽ‰ï¼Œvolatile write æ˜¯æ¶ˆè€—æ¯”è¾ƒå¤§ï¼ˆstore-load å±éšœï¼‰çš„ï¼Œä½†æ˜¯ putOrderedInt åªä¼šåŠ  store-store å±éšœï¼ŒæŸè€—ä¼šå°ä¸€äº›ã€‚ æ·»åŠ lazySetæ–¹æ³•çš„åŽŸå› :https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6275329 123456789101112131415161718192021222324252627As probably the last little JSR166 follow-up for Mustang,we added a &quot;lazySet&quot; method to the Atomic classes(AtomicInteger, AtomicReference, etc). This is a nichemethod that is sometimes useful when fine-tuning code usingnon-blocking data structures. The semantics arethat the write is guaranteed not to be re-ordered with anyprevious write, but may be reordered with subsequent operations(or equivalently, might not be visible to other threads) untilsome other volatile write or synchronizing action occurs).The main use case is for nulling out fields of nodes innon-blocking data structures solely for the sake of avoidinglong-term garbage retention; it applies when it is harmlessif other threads see non-null values for a while, but you&apos;dlike to ensure that structures are eventually GCable. In suchcases, you can get better performance by avoidingthe costs of the null volatile-write. There are a fewother use cases along these lines for non-reference-basedatomics as well, so the method is supported across all of theAtomicX classes.For people who like to think of these operations in terms ofmachine-level barriers on common multiprocessors, lazySetprovides a preceeding store-store barrier (which is eithera no-op or very cheap on current platforms), but nostore-load barrier (which is usually the expensive partof a volatile-write). weakCompareAndSet JDK 9ä¹‹åŽDeprecatedï¼Œæœ¬æ–‡å·²è·³è¿‡ã€‚ é™¤äº†è¡¨ç¤ºå•ä¸ªå€¼çš„ç±»ä¹‹å¤–ï¼Œpackageä¸­è¿˜åŒ…å«Updaterç±»ï¼Œå¯ç”¨äºŽåœ¨ç±»çš„volatileå­—æ®µä¸Šæ‰§è¡ŒcompareAndSetæ“ä½œã€‚ AtomicReferenceFieldUpdaterã€AtomicIntegerFieldUpdaterå’ŒAtomicLongFieldUpdateræ˜¯åŸºäºŽåå°„çš„ï¼Œå¯æä¾›å¯¹ç›¸å…³å­—æ®µç±»åž‹çš„è®¿é—®ã€‚è¿™äº›ä¸»è¦ç”¨äºŽåŽŸå­æ•°æ®ç»“æž„ï¼ŒåŒä¸€èŠ‚ç‚¹çš„å‡ ä¸ªvolatileå­—æ®µï¼ˆä¾‹å¦‚ï¼Œæ ‘èŠ‚ç‚¹çš„é“¾æŽ¥ï¼‰ç‹¬ç«‹åœ°åŽŸå­æ›´æ–°ã€‚è¿™äº›ç±»åœ¨å¦‚ä½•ä»¥åŠä½•æ—¶ä½¿ç”¨åŽŸå­æ›´æ–°æ–¹é¢æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ï¼Œä½†ä»£ä»·æ˜¯æ›´åŠ ç¬¨æ‹™çš„åŸºäºŽåå°„çš„è®¾ç½®ã€æ›´ä¸æ–¹ä¾¿çš„ä½¿ç”¨å’Œæ›´å¼±çš„ä¿è¯ã€‚ AtomicIntegerArrayã€AtomicLongArrayå’ŒAtomicReferenceArrayç±»è¿›ä¸€æ­¥å°†åŽŸå­æ“ä½œæ”¯æŒæ‰©å±•åˆ°è¿™äº›ç±»åž‹çš„æ•°ç»„ã€‚è¿™äº›ç±»è¿˜æä¾›äº†æ•°ç»„å…ƒç´ çš„volatileè®¿é—®è¯­ä¹‰ï¼Œè¿™æ˜¯æ™®é€šæ•°ç»„ä¸æ”¯æŒçš„ã€‚ AtomicMarkableReferenceç±»å°†å•ä¸ªå¸ƒå°”å€¼ä¸Žå¼•ç”¨ç›¸å…³è”ã€‚ ä¾‹å¦‚ï¼Œè¯¥ä½å¯èƒ½åœ¨æ•°æ®ç»“æž„ä¸­ä½¿ç”¨ï¼Œè¡¨ç¤ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨é€»è¾‘ä¸Šå·²è¢«åˆ é™¤ã€‚ AtomicStampedReferenceç±»å°†æ•´æ•°å€¼ä¸Žå¼•ç”¨ç›¸å…³è”ã€‚ ä¾‹å¦‚ï¼Œè¿™å¯ä»¥ç”¨äºŽè¡¨ç¤ºä¸Žä¸€ç³»åˆ—æ›´æ–°ç›¸å¯¹åº”çš„ç‰ˆæœ¬å·ã€‚ åŽŸå­ç±»ä¸»è¦è®¾è®¡ä¸ºç”¨äºŽå®žçŽ°éžé˜»å¡žæ•°æ®ç»“æž„å’Œç›¸å…³åŸºç¡€ç»“æž„ç±»çš„æž„å»ºã€‚ compareAndSetæ–¹æ³•ä¸æ˜¯é”å®šçš„ä¸€èˆ¬æ›¿ä»£æ–¹æ³•ã€‚ ä»…å½“å¯¹è±¡çš„å…³é”®æ›´æ–°ä»…é™äºŽå•ä¸ªå˜é‡æ—¶ï¼Œå®ƒæ‰é€‚ç”¨ã€‚ åŽŸå­ç±»ä¸æ˜¯java.lang.Integerå’Œç›¸å…³ç±»çš„é€šç”¨æ›¿æ¢ã€‚å®ƒä»¬æ²¡æœ‰å®šä¹‰equalsï¼ŒhashCodeå’ŒcompareToç­‰æ–¹æ³•ï¼ˆç”±äºŽåŽŸå­å˜é‡é¢„æœŸä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥å®ƒä»¬ä¸é€‚åˆä½œä¸ºå“ˆå¸Œè¡¨é”®ï¼‰ã€‚ åŽç»­ä¼šå‡ºæ–‡ç« è§£æžï¼šAtomicLongã€Striped64ã€LongAdderæœ¬æ–‡çš„ç›®çš„ä¸»è¦æ˜¯ä»Žå¤§ä½“ä¸Šäº†è§£atomicåŠå…¶å†…å­˜è¯­ä¹‰ JDK 12https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/util/concurrent/atomic/package-summary.html]]></content>
      <categories>
        <category>JDK</category>
      </categories>
      <tags>
        <tag>JDK</tag>
        <tag>Concurrent</tag>
        <tag>Atomic</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java JUC Atomic AtomicLong]]></title>
    <url>%2Fjava-juc-atomic-atomiclong.html</url>
    <content type="text"><![CDATA[åŸºäºŽOpenJDK 12æœ¬æ–‡çš„ç›®çš„æ˜¯ä¸ºåŽç»­æ–‡ç« è§£æžLongAdderåšä¸€ä¸ªå¼•å­ï¼Œä»¥ä¾¿ä¸¤è€…å¯¹æ¯”ã€‚ Atomic Packageè§£æžå‚è€ƒï¼ˆæ¯”å¦‚lazySetåŽŸç†è§£æžï¼‰ AtomicLongçš„å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š long addAndGet(long delta)ï¼šä»¥åŽŸå­æ–¹å¼å°†è¾“å…¥çš„æ•°å€¼ä¸Žå®žä¾‹ä¸­çš„å€¼ï¼ˆAtomicLongé‡Œçš„valueï¼‰ç›¸åŠ ï¼Œå¹¶è¿”å›žç»“æžœã€‚ compareAndSet(long expectedValue, long newValue)ï¼šå¦‚æžœè¾“å…¥çš„æ•°å€¼ç­‰äºŽé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŽŸå­æ–¹å¼å°†è¯¥å€¼è®¾ç½®ä¸ºè¾“å…¥çš„å€¼ã€‚ long getAndIncrement()ï¼šä»¥åŽŸå­æ–¹å¼å°†å½“å‰å€¼åŠ 1ï¼Œæ³¨æ„ï¼Œè¿™é‡Œè¿”å›žçš„æ˜¯è‡ªå¢žå‰çš„å€¼ã€‚ void lazySet(long newValue)ï¼šæœ€ç»ˆä¼šè®¾ç½®æˆnewValueï¼Œä½¿ç”¨lazySetè®¾ç½®å€¼åŽï¼Œå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åŽçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ã€‚ long getAndSet(long newValue)ï¼šä»¥åŽŸå­æ–¹å¼è®¾ç½®ä¸ºnewValueçš„å€¼ï¼Œå¹¶è¿”å›žæ—§å€¼ã€‚ AtomicLongç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234567public class AtomicLongTest &#123; static AtomicLong ai = new AtomicLong(1); public static void main(String[] args) &#123; System.out.println(ai.getAndIncrement()); System.out.println(ai.get()); &#125;&#125; è¾“å‡ºç»“æžœå¦‚ä¸‹: 1212 é‚£ä¹ˆgetAndIncrementæ˜¯å¦‚ä½•å®žçŽ°åŽŸå­æ“ä½œçš„å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·åˆ†æžå…¶å®žçŽ°åŽŸç†ï¼ŒgetAndIncrementçš„æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334public final long getAndIncrement() &#123; return U.getAndAddLong(this, VALUE, 1L);&#125;@HotSpotIntrinsicCandidatepublic final long getAndAddLong(Object o, long offset, long delta) &#123; long v; do &#123; v = getLongVolatile(o, offset); &#125; while (!weakCompareAndSetLong(o, offset, v, v + delta)); return v;&#125;/** Volatile version of &#123;@link #getLong(Object, long)&#125; */@HotSpotIntrinsicCandidatepublic native long getLongVolatile(Object o, long offset);@HotSpotIntrinsicCandidatepublic final boolean weakCompareAndSetLong(Object o, long offset, long expected, ong x) &#123; return compareAndSetLong(o, offset, expected, x);&#125;/** * Atomically updates Java variable to &#123;@code x&#125; if it is currently * holding &#123;@code expected&#125;. * * &lt;p&gt;This operation has memory semantics of a &#123;@code volatile&#125; read * and write. Corresponds to C11 atomic_compare_exchange_strong. * * @return &#123;@code true&#125; if successful */@HotSpotIntrinsicCandidatepublic final native boolean compareAndSetLong(Object o, long offset, long expected, long x); @HotSpotIntrinsicCandidate JDKçš„æºç ä¸­ï¼Œè¢«@HotSpotIntrinsicCandidateæ ‡æ³¨çš„æ–¹æ³•ï¼Œåœ¨HotSpotä¸­éƒ½æœ‰ä¸€å¥—é«˜æ•ˆçš„å®žçŽ°ï¼Œè¯¥é«˜æ•ˆå®žçŽ°åŸºäºŽCPUæŒ‡ä»¤ï¼Œè¿è¡Œæ—¶ï¼ŒHotSpotç»´æŠ¤çš„é«˜æ•ˆå®žçŽ°ä¼šæ›¿ä»£JDKçš„æºç å®žçŽ°ï¼Œä»Žè€ŒèŽ·å¾—æ›´é«˜çš„æ•ˆçŽ‡ã€‚ æºç getAndAddLong(Object o, long offset, long delta)ä¸­do whileå¾ªçŽ¯ä½“æ˜¯å®žçŽ°çš„å…³é”®æ‰€åœ¨ï¼Œå…¶é€»è¾‘æ˜¯ï¼šç¬¬ä¸€æ­¥å…ˆå–å¾—AtomicLongé‡Œå­˜å‚¨çš„æ•°å€¼ï¼Œç¬¬äºŒæ­¥å¯¹AtomicLongçš„å½“å‰æ•°å€¼è¿›è¡ŒåŠ 1æ“ä½œï¼Œç¬¬ä¸‰æ­¥è°ƒç”¨weakCompareAndSetLongæ–¹æ³•æ¥è¿›è¡ŒåŽŸå­æ›´æ–°æ“ä½œï¼Œè¯¥æ–¹æ³•å…ˆæ£€æŸ¥å½“å‰æ•°å€¼æ˜¯å¦ç­‰äºŽvï¼Œç­‰äºŽæ„å‘³ç€AtomicLongçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡ï¼Œåˆ™å°†weakCompareAndSetLongçš„å½“å‰æ•°å€¼æ›´æ–°æˆv+deltaçš„å€¼ï¼Œå¦‚æžœä¸ç­‰äºŽvï¼ŒweakCompareAndSetLongæ–¹æ³•ä¼šè¿”å›žfalseï¼Œç¨‹åºä¼šè¿›å…¥do whileå¾ªçŽ¯é‡æ–°è¿›è¡ŒweakCompareAndSetLongæ“ä½œã€‚ è¿™é‡Œéšå«äº†ä¸€ä¸ªé—®é¢˜ï¼Œå½“å¯¹äºŽå…±äº«å˜é‡ï¼ˆå‡è®¾å˜é‡åå­—æ˜¯aï¼‰çš„ç«žäº‰éžå¸¸æ¿€çƒˆçš„æ—¶å€™ï¼Œåœ¨å½“å‰çº¿ç¨‹è¯»å–aã€æ”¹å˜aä¹‹é—´ï¼Œaçš„å€¼ä¼šè¢«åˆ«çš„çº¿ç¨‹æ”¹å˜ï¼Œä»Žè€Œå¯¼è‡´å½“å‰çº¿ç¨‹ä¸€ç›´é‡è¯•ï¼ˆè‡ªæ—‹ï¼‰ï¼Œä¸€ç›´å ç”¨CPUã€‚ è¿™å°±å¼•å‡ºå¦ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äºŽé”æŠ¢å å¾ˆæ¿€çƒˆçš„æ—¶å€™ï¼Œä¸²è¡Œæ˜¯æœ€å¥½çš„è§£å†³åŠžæ³•ã€‚æ¯”å¦‚ä½¿ç”¨synchronizedã€‚ java.util.concurrent.atomicä¸­çš„åŽŸå­æ“ä½œåŸºæœ¬æ˜¯åŸºäºŽUnsafeæˆ–è€…VarHandleå®žçŽ°çš„ã€‚ AtomicLongæºç  æœ¬æ–‡å‚è€ƒ ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ ä½œè€…ï¼šæ–¹è…¾é£ž é­é¹ ç¨‹æ™“æ˜Ž]]></content>
      <categories>
        <category>JDK</category>
      </categories>
      <tags>
        <tag>JDK</tag>
        <tag>Concurrent</tag>
        <tag>Atomic</tag>
        <tag>AtomicLong</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java JUC Atomic LongAdder]]></title>
    <url>%2Fjava-juc-atomic-longadder.html</url>
    <content type="text"><![CDATA[åŸºäºŽOpenJDK 12 é˜…è¯»æœ¬æ–‡å‰ï¼ŒæŽ¨èå…ˆé˜…è¯»ä»¥ä¸‹ä¸¤ç¯‡æ–‡ç« ï¼Œä»¥ä¾¿èƒ½æ›´å¥½çš„å¯¹æ¯”ç†è§£ï¼š è¯‘-Java-Concurrent-Atomic-Package-è¯¦è§£ Java-JUC-Atomic-AtomicLong LongAdderæ˜¯JDK 1.8 æ–°å¢žçš„åŽŸå­ç±»ï¼ŒåŸºäºŽStriped64å®žçŽ°ã€‚ ä»Žå®˜æ–¹æ–‡æ¡£çœ‹ï¼ŒLongAdderåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ä¼šæ¯”AtomicLong å…·æœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œä»£ä»·æ˜¯æ¶ˆè€—æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼š This class is usually preferable to AtomicLong when multiple threads update a common sum that is used for purposes such as collecting statistics, not for fine-grained synchronization control. Under low update contention, the two classes have similar characteristics. But under high contention, expected throughput of this class is significantly higher, at the expense of higher space consumption. é‚£ä¹ˆLongAdderæ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ å…ˆçœ‹ä¸€ä¸‹LongAdderçš„ç±»å›¾ï¼š åŸºç±»Numberï¼ŒNumberæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å…¶ä¸­æ²¡æœ‰ä»»ä½•é€»è¾‘ï¼Œè¯¥ç±»æ˜¯byteã€doubleã€floatã€intã€longã€shortçš„åŸºç±»ã€‚ Striped64è®¾è®¡æ€æƒ³è¯¥éƒ¨åˆ†ç¿»è¯‘è‡ªStriped64æºç æ³¨é‡Šï¼Œå¯ä»¥ç•¥è¿‡ï¼Œæ¦‚æ‹¬èµ·æ¥å°±æ˜¯ï¼š åˆ†æ•£çƒ­ç‚¹ï¼Œå°†valueå€¼åˆ†æ•£åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œä¸åŒçº¿ç¨‹ä¼šå‘½ä¸­åˆ°æ•°ç»„çš„ä¸åŒæ§½ä¸­ï¼Œå„ä¸ªçº¿ç¨‹åªå¯¹è‡ªå·±æ§½ä¸­çš„é‚£ä¸ªå€¼è¿›è¡ŒCASæ“ä½œï¼Œè¿™æ ·çƒ­ç‚¹å°±è¢«åˆ†æ•£äº†ï¼Œå†²çªçš„æ¦‚çŽ‡å°±å°å¾ˆå¤šã€‚å¦‚æžœè¦èŽ·å–çœŸæ­£çš„longå€¼ï¼Œåªè¦å°†å„ä¸ªæ§½ä¸­çš„å˜é‡å€¼ç´¯åŠ è¿”å›žã€‚ ä»ŽStriped64ç±»æ³¨é‡Šå¯ä»¥çœ‹åˆ°ï¼š Striped64æ˜¯packageå†…ä½¿ç”¨çš„ï¼Œå¯¹äºŽåœ¨64ä½å…ƒç´ ä¸ŠåŠ¨æ€åˆ†ç‰‡æä¾›ç»Ÿä¸€å®žçŽ°ï¼ˆæ„Ÿè§‰æœ‰ç‚¹åƒï¼šAbstractQueuedSynchronizerï¼‰Striped64ç»§æ‰¿äº†Numberç±»ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´å…·ä½“å®žçŽ°çš„å­ç±»ä¹Ÿå¿…é¡»å®žçŽ°ç›¸å…³çš„å†…å®¹ è¯¥ç±»ç»´æŠ¤ä¸€ä¸ªåŽŸå­æ›´æ–°å˜é‡çš„å»¶è¿Ÿåˆå§‹åŒ–è¡¨ï¼Œä»¥åŠä¸€ä¸ªé¢å¤–çš„â€œbaseâ€å­—æ®µã€‚è¡¨çš„å¤§å°æ˜¯2çš„å¹‚ã€‚ç´¢å¼•ä½¿ç”¨æŽ©ç ä¸‹çš„æ¯ä¸ªçº¿ç¨‹çš„hash codeã€‚è¿™ä¸ªç±»ä¸­çš„å‡ ä¹Žæ‰€æœ‰å£°æ˜Žéƒ½æ˜¯packageç§æœ‰çš„ï¼Œç”±å­ç±»ç›´æŽ¥è®¿é—®ã€‚ è¡¨æ ¼å†…çš„å…ƒç´ æ˜¯Cellç±»ï¼ŒCellç±»æ˜¯ä¸€ä¸ªä¸ºäº†å‡å°‘ç¼“å­˜äº‰ç”¨è€Œå¡«å……çš„AtomicLongçš„å˜ç§ã€‚å¡«å……å¯¹äºŽå¤§å¤šæ•°åŽŸå­æ¥è¯´æ˜¯å¤šä½™çš„ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸ä¸è§„åˆ™åœ°åˆ†æ•£åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤å½¼æ­¤ä¹‹é—´ä¸ä¼šæœ‰å¤ªå¤šçš„å¹²æ‰°ã€‚ä½†æ˜¯ï¼Œé©»ç•™åœ¨æ•°ç»„ä¸­çš„åŽŸå­å¯¹è±¡å¾€å¾€æ˜¯å½¼æ­¤ç›¸é‚»çš„ï¼Œå› æ­¤åœ¨æ²¡æœ‰è¿™ç§é¢„é˜²æŽªæ–½çš„æƒ…å†µä¸‹ï¼Œæœ€å¸¸è§çš„æƒ…å†µæ˜¯å…±äº«é«˜é€Ÿç¼“å­˜çº¿(è¿™å¯¹æ€§èƒ½æœ‰å¾ˆå¤§çš„è´Ÿé¢å½±å“)ã€‚ åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œå› ä¸ºCellç±»ç›¸å¯¹è¾ƒå¤§ï¼Œåªæœ‰ä»–ä»¬çœŸæ­£è¢«éœ€è¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰åˆ›å»ºã€‚å¦‚æžœæ²¡æœ‰ç«žäº‰ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ›´æ–°æ“ä½œå°†å¯¹baseå­—æ®µå®žçŽ°ã€‚å½“å‘ç”Ÿç¬¬ä¸€æ¬¡äº‰ç”¨ï¼ˆä¹Ÿå°±æ˜¯è¯´å¦‚æžœç¬¬ä¸€æ¬¡å¯¹baseå­—æ®µçš„CASæ“ä½œå¤±è´¥ï¼‰ï¼Œåˆå§‹åŒ–ä¸ºå¤§å°æ˜¯2çš„è¡¨æ ¼ã€‚å½“è¿›ä¸€æ­¥çš„äº‰ç”¨å‘ç”Ÿçš„æ—¶å€™,è¡¨çš„å¤§å°ä¼šåŠ å€ï¼Œç›´åˆ°è¾¾åˆ°ç­‰äºŽå¤§äºŽcpuçš„æ•°é‡ã€‚è¡¨åœ¨æœªä½¿ç”¨ä¹‹å‰ä¸€ç›´ä¸ºnullã€‚ åˆ©ç”¨ä¸€ä¸ªè‡ªæ—‹é”ï¼ˆcellsBusyï¼‰æ¥åˆå§‹åŒ–å’Œè°ƒæ•´è¡¨çš„å¤§å°ï¼Œä»¥åŠç”¨æ–°Cellså¡«å……slotsã€‚è¿™ä¸ªåœ°æ–¹æ²¡æœ‰å¿…è¦ä½¿ç”¨é˜»å¡žé”ï¼Œå¦‚æžœé”ä¸å¯è¾¾ï¼Œçº¿ç¨‹å¯ä»¥å°è¯•å…¶ä»–çš„slotsï¼Œæˆ–è€…å°è¯•baseå­—æ®µã€‚åœ¨è¿™äº›é‡è¯•æœŸé—´ï¼Œç«žäº‰åŠ å‰§ï¼Œä½†æ˜¯é™ä½Žäº†å±€éƒ¨æ€§ï¼Œè¿™ä»ç„¶æ¯”é˜»å¡žé”æ¥å¾—å¥½ã€‚ é€šè¿‡ThreadLocalRandomç»´æŠ¤çš„Thread.probeå­—æ®µç”¨ä½œæ¯ä¸ªçº¿ç¨‹çš„å“ˆå¸Œç ã€‚æˆ‘ä»¬è®©å®ƒä»¬ä¿æŒæœªåˆå§‹åŒ–ï¼ˆä¸ºé›¶ï¼‰(å¦‚æžœå®ƒä»¬ä»¥è¿™ç§æ–¹å¼å‡ºçŽ°)ï¼Œç›´åˆ°å®ƒä»¬åœ¨æ’æ§½0ç«žäº‰ã€‚å‡ºçŽ°ç«žäº‰åŽåˆå§‹åŒ–ä¸ºé€šå¸¸ä¸ä¼šå’Œå…¶ä»–çš„çš„å€¼å†²çªçš„å€¼ï¼Œæ¯”å¦‚çº¿ç¨‹çš„å“ˆå¸Œç ã€‚åœ¨æ‰§è¡Œæ›´æ–°æ—¶å‘ç”ŸCASæ“ä½œå¤±è´¥æ„å‘³ç€å‡ºçŽ°äº†äº‰ç”¨æˆ–è€…è¡¨ç¢°æ’žï¼Œæˆ–ä¸¤è€…éƒ½æœ‰ã€‚åœ¨å‘ç”Ÿå†²çªæ—¶ï¼Œå¦‚æžœè¡¨çš„å¤§å°å°äºŽå®¹é‡ï¼Œé‚£ä¹ˆå®ƒçš„å¤§å°å°†åŠ å€ï¼Œé™¤éžå…¶ä»–çº¿ç¨‹æŒæœ‰é”ã€‚å¦‚æžœå“ˆå¸ŒåŽçš„slotä¸ºç©ºï¼Œå¹¶ä¸”é”å¯ç”¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°å•å…ƒæ ¼ã€‚å¦‚æžœå­˜åœ¨äº†é‚£ä¹ˆä¼šè¿›è¡ŒCASå°è¯•ã€‚é€šè¿‡åŒé‡å“ˆå¸Œè¿›è¡Œé‡è¯•ï¼Œåˆ©ç”¨ä¸€ä¸ªè¾…åŠ©å“ˆå¸Œï¼ˆMarsaglia XorShiftéšæœºæ•°ç®—æ³•ï¼‰æ¥å°è¯•å¯»æ‰¾ä¸€ä¸ªç©ºé—²çš„slotã€‚ è¡¨çš„å¤§å°æ˜¯æœ‰ä¸Šé™çš„ï¼Œå› ä¸ºå½“çº¿ç¨‹å¤šäºŽCPUæ—¶ï¼Œå‡è®¾æ¯ä¸ªçº¿ç¨‹éƒ½ç»‘å®šåˆ°ä¸€ä¸ªCPUï¼Œå°±ä¼šæœ‰ä¸€ä¸ªå®Œç¾Žçš„æ•£åˆ—å‡½æ•°å°†çº¿ç¨‹æ˜ å°„åˆ°æ’æ§½ï¼Œä»Žè€Œæ¶ˆé™¤å†²çªã€‚å½“æˆ‘ä»¬è¾¾åˆ°å®¹é‡æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡éšæœºæ”¹å˜å†²çªçº¿ç¨‹çš„å“ˆå¸Œä»£ç æ¥æœç´¢è¿™ä¸ªæ˜ å°„ã€‚å› ä¸ºæœç´¢æ˜¯éšæœºçš„ï¼Œå†²çªåªæœ‰é€šè¿‡CASå¤±è´¥æ‰çŸ¥é“ï¼Œæ”¶æ•›å¯èƒ½ä¼šå¾ˆæ…¢ï¼Œè€Œä¸”å› ä¸ºçº¿ç¨‹é€šå¸¸ä¸ä¼šæ°¸è¿œç»‘å®šåˆ°CPUï¼Œæ‰€ä»¥æ ¹æœ¬ä¸ä¼šå‘ç”Ÿã€‚ç„¶è€Œï¼Œå°½ç®¡æœ‰è¿™äº›é™åˆ¶ï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹è§‚å¯Ÿåˆ°çš„ç«žäº‰çŽ‡é€šå¸¸å¾ˆä½Žã€‚ Cellå¯èƒ½ä¼šå‡ºçŽ°ä¸å¯ç”¨çš„æƒ…å†µï¼ŒåŒ…æ‹¬è¿›è¡Œå“ˆå¸Œçš„çº¿ç¨‹ç»ˆæ­¢ï¼Œæˆ–è€…ç”±äºŽtableæ‰©å®¹å¯¼è‡´çº¿ç¨‹å“ˆå¸Œä¸æ­£ç¡®ã€‚æˆ‘ä»¬ä¸å°è¯•æ£€æµ‹æˆ–åˆ é™¤è¿™æ ·çš„å•å…ƒæ ¼ï¼Œå‡è®¾å¯¹äºŽé•¿æ—¶é—´è¿è¡Œçš„å®žä¾‹ï¼Œäº‰ç”¨ä¼šå†æ¬¡å‘ç”Ÿï¼Œå› æ­¤æœ€ç»ˆå°†å†æ¬¡éœ€è¦è¿™äº›å•å…ƒæ ¼;è€Œå¯¹äºŽçŸ­æ—¶é—´è¿è¡Œçš„å®žä¾‹ï¼ŒèŠ±è´¹æ—¶é—´åŽ»é”€æ¯åˆæ²¡æœ‰ä»€ä¹ˆå¿…è¦ã€‚ Cellç±»Atomiclongçš„å˜ä½“ï¼Œä»…æ”¯æŒåŽŸå§‹è®¿é—®å’ŒCASã€‚ Cellç±»è¢«æ³¨è§£@jdk.internal.vm.annotation.Contendedä¿®é¥°ã€‚Contendedçš„ä½œç”¨ï¼ˆè¯¦ç»†ä¿¡æ¯å‚è§ï¼šJEP 142ï¼‰ï¼šDefine a way to specify that one or more fields in an object are likely to be highly contended across processor cores so that the VM can arrange for them not to share cache lines with other fields, or other objects, that are likely to be independently accessed. ç¤ºæ„å›¾ å…·ä½“å®žçŽ°Striped64çš„æ ¸å¿ƒæ–¹æ³•æ˜¯longAccumulateã€doubleAccumulateï¼Œä¸¤è€…ç±»ä¼¼ï¼Œä¸‹é¢ä¸»è¦çœ‹ä¸€ä¸‹longAccumulateï¼Œå¯¹äºŽè¿™ç§ä»£ç ï¼Œä¸ªäººå»ºè®®æ˜¯ç†è§£æ€è·¯å³å¯ï¼Œæ¯•ç«Ÿå’±ä»¬åˆä¸æ˜¯è¿‡æ¥ä¿®æ”¹JDKçš„ï¼Œå¦‚æžœçœŸçš„è¦ä¿®æ”¹äº†æˆ–è€…æœ‰ç±»ä¼¼çš„éœ€æ±‚äº†ï¼Œå†å›žæ¥ç»†çœ‹å³å¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107//x å…ƒç´ //fn æ›´æ–°å‡½æ•°ï¼Œå¦‚æžœæ˜¯addå¯ä»¥ä¸ºnullï¼ˆè¿™ä¸ªçº¦å®šé¿å…äº†longadderä¸­å®šä¹‰é¢å¤–çš„å˜é‡æˆ–è€…å‡½æ•°ï¼‰//wasUncontended å¦‚æžœCASåœ¨è°ƒç”¨ä¹‹å‰å¤±è´¥äº†ï¼Œè¿™ä¸ªå€¼ä¸ºfalsefinal void longAccumulate(long x, LongBinaryOperator fn, boolean wasUncontended) &#123; int h; //èŽ·å–å½“å‰çº¿ç¨‹çš„probeå€¼ï¼Œå¦‚æžœä¸º0ï¼Œåˆ™éœ€è¦åˆå§‹åŒ–è¯¥çº¿ç¨‹çš„probeå€¼ if ((h = getProbe()) == 0) &#123; ThreadLocalRandom.current(); // force initialization h = getProbe(); wasUncontended = true; &#125; boolean collide = false; // True if last slot nonempty done: for (;;) &#123; Cell[] cs; Cell c; int n; long v; //Cellsä¸ä¸ºç©ºï¼Œè¿›è¡Œæ“ä½œ if ((cs = cells) != null &amp;&amp; (n = cs.length) &gt; 0) &#123; //é€šè¿‡ï¼ˆhashCode &amp; (length - 1)ï¼‰è¿™ç§ç®—æ³•æ¥å®žçŽ°å–æ¨¡ æœ‰ç§çœ‹åˆ°HashMapä»£ç çš„æ„Ÿè§‰ //å¦‚æžœå½“å‰ä½ç½®ä¸ºnullè¯´æ˜Žéœ€è¦åˆå§‹åŒ– if ((c = cs[(n - 1) &amp; h]) == null) &#123; //åˆ¤æ–­é”çŠ¶æ€ if (cellsBusy == 0) &#123; // Try to attach new Cell Cell r = new Cell(x); // Optimistically create //å†æ¬¡åˆ¤æ–­é”çŠ¶æ€ï¼ŒåŒæ—¶èŽ·å–é” if (cellsBusy == 0 &amp;&amp; casCellsBusy()) &#123; try &#123; // Recheck under lock Cell[] rs; int m, j; if ((rs = cells) != null &amp;&amp; (m = rs.length) &gt; 0 &amp;&amp; rs[j = (m - 1) &amp; h] == null) &#123; rs[j] = r; //åˆ›å»ºæˆåŠŸè·³å‡º break done; &#125; &#125; finally &#123; //é‡Šæ”¾é” cellsBusy = 0; &#125; continue; // Slot is now non-empty &#125; &#125; collide = false; &#125; //è¿è¡Œåˆ°æ­¤è¯´æ˜Žcellçš„å¯¹åº”ä½ç½®ä¸Šå·²ç»æœ‰ç›¸åº”çš„Celläº†ï¼Œ //ä¸éœ€è¦åˆå§‹åŒ–äº† //CASæ“ä½œå·²ç»å¤±è´¥äº†ï¼Œå‡ºçŽ°äº†ç«žäº‰ else if (!wasUncontended) // CAS already known to fail wasUncontended = true; // Continue after rehash //è¿™é‡Œå°è¯•å°†xå€¼åŠ åˆ°açš„valueä¸Š else if (c.cas(v = c.value, (fn == null) ? v + x : fn.applyAsLong(v, x))) //å¦‚æžœå°è¯•æˆåŠŸï¼Œè·³å‡ºå¾ªçŽ¯ï¼Œæ–¹æ³•é€€å‡º break; //cellæ•°ç»„æœ€å¤§ä¸ºcpuçš„æ•°é‡ï¼Œ //cells != asè¡¨æ˜Žcellsæ•°ç»„å·²ç»è¢«æ›´æ–°äº† //æ ‡è®°ä¸ºæœ€å¤§çŠ¶æ€æˆ–è€…è¯´æ˜¯è¿‡æœŸçŠ¶æ€ else if (n &gt;= NCPU || cells != cs) collide = false; // At max size or stale else if (!collide) collide = true; //æ‰©å®¹ å½“å‰å®¹é‡ * 2 else if (cellsBusy == 0 &amp;&amp; casCellsBusy()) &#123; try &#123; if (cells == cs) // Expand table unless stale cells = Arrays.copyOf(cs, n &lt;&lt; 1); &#125; finally &#123; cellsBusy = 0; &#125; collide = false; continue; // Retry with expanded table &#125; h = advanceProbe(h); &#125; //å°è¯•èŽ·å–é”ä¹‹åŽæ‰©å¤§Cells else if (cellsBusy == 0 &amp;&amp; cells == cs &amp;&amp; casCellsBusy()) &#123; try &#123; // Initialize table if (cells == cs) &#123; //åˆå§‹åŒ–cellè¡¨ï¼Œåˆå§‹å®¹é‡ä¸º2ã€‚ Cell[] rs = new Cell[2]; rs[h &amp; 1] = new Cell(x); cells = rs; break done; &#125; &#125; finally &#123; //é‡Šæ”¾cellsBusyé” cellsBusy = 0; &#125; &#125; //å¦‚æžœåˆ›å»ºcellè¡¨ç”±äºŽç«žäº‰å¯¼è‡´å¤±è´¥ï¼Œå°è¯•å°†xç´¯åŠ åˆ°baseä¸Š // Fall back on using base else if (casBase(v = base, (fn == null) ? v + x : fn.applyAsLong(v, x))) break done; &#125;&#125;/** * CASes the cellsBusy field from 0 to 1 to acquire lock. */final boolean casCellsBusy() &#123; return CELLSBUSY.compareAndSet(this, 0, 1);&#125;/** * CASes the base field. */final boolean casBase(long cmp, long val) &#123; return BASE.compareAndSet(this, cmp, val);&#125; è¿™ä¸€æ®µçš„æ ¸å¿ƒæ˜¯è¿™æ ·çš„ï¼š longAccumulateä¼šæ ¹æ®å½“å‰çº¿ç¨‹æ¥è®¡ç®—ä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œç„¶åŽæ ¹æ®(hashCode &amp; (length - 1))å–æ¨¡ï¼Œä»¥å®šä½åˆ°è¯¥çº¿ç¨‹è¢«åˆ†æ•£åˆ°çš„Cellæ•°ç»„ä¸­çš„ä½ç½® å¦‚æžœCellæ•°ç»„è¿˜æ²¡æœ‰è¢«åˆ›å»ºï¼Œé‚£ä¹ˆå°±åŽ»èŽ·å–cellBusyè¿™ä¸ªé”ï¼ˆç›¸å½“äºŽé”ï¼Œä½†æ˜¯æ›´ä¸ºè½»é‡çº§ï¼‰ï¼Œå¦‚æžœèŽ·å–æˆåŠŸï¼Œåˆ™åˆå§‹åŒ–Cellæ•°ç»„ï¼Œåˆå§‹å®¹é‡ä¸º2ï¼Œåˆå§‹åŒ–å®Œæˆä¹‹åŽå°†xåŒ…è£…æˆä¸€ä¸ªCellï¼Œå“ˆå¸Œè®¡ç®—ä¹‹åŽåˆ†æ•£åˆ°ç›¸åº”çš„indexä¸Šã€‚å¦‚æžœèŽ·å–cellBusyå¤±è´¥ï¼Œé‚£ä¹ˆä¼šè¯•å›¾å°†xç´¯è®¡åˆ°baseä¸Šï¼Œæ›´æ–°å¤±è´¥ä¼šé‡æ–°å°è¯•ç›´åˆ°æˆåŠŸã€‚ å¦‚æžœCellæ•°ç»„å·²ç»è¢«åˆå§‹åŒ–è¿‡äº†ï¼Œé‚£ä¹ˆå°±æ ¹æ®çº¿ç¨‹çš„å“ˆå¸Œå€¼åˆ†æ•£åˆ°ä¸€ä¸ªCellæ•°ç»„å…ƒç´ ä¸Šï¼ŒèŽ·å–è¿™ä¸ªä½ç½®ä¸Šçš„Cellå¹¶ä¸”èµ‹å€¼ç»™å˜é‡aï¼Œå¦‚æžœaä¸ºnullï¼Œè¯´æ˜Žè¯¥ä½ç½®è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œé‚£ä¹ˆå°±åˆå§‹åŒ–ï¼Œå½“ç„¶åœ¨åˆå§‹åŒ–ä¹‹å‰éœ€è¦ç«žäº‰cellBusyå˜é‡ã€‚ å¦‚æžœCellæ•°ç»„çš„å¤§å°å·²ç»æœ€å¤§äº†ï¼ˆå¤§äºŽç­‰äºŽCPUçš„æ•°é‡ï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°è®¡ç®—å“ˆå¸Œï¼Œæ¥é‡æ–°åˆ†æ•£å½“å‰çº¿ç¨‹åˆ°å¦å¤–ä¸€ä¸ªCellä½ç½®ä¸Šå†èµ°ä¸€éè¯¥æ–¹æ³•çš„é€»è¾‘ï¼Œå¦åˆ™å°±éœ€è¦å¯¹Cellæ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œç„¶åŽå°†åŽŸæ¥çš„è®¡æ•°å†…å®¹è¿ç§»è¿‡åŽ»ã€‚ç”±äºŽCellé‡Œé¢ä¿å­˜çš„æ˜¯è®¡æ•°å€¼ï¼Œæ‰€ä»¥æ‰©å®¹åŽæ²¡æœ‰å¿…è¦åšå…¶ä»–å¤„ç†ï¼Œç›´æŽ¥æ ¹æ®indexå°†æ—§çš„Cellæ•°ç»„å†…å®¹å¤åˆ¶åˆ°æ–°çš„Cellæ•°ç»„ä¸­ã€‚ LongAdder LongAdderçš„åŸºæœ¬æ€è·¯å°±æ˜¯åˆ†æ•£çƒ­ç‚¹ï¼Œå°†valueå€¼åˆ†æ•£åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œä¸åŒçº¿ç¨‹ä¼šå‘½ä¸­åˆ°æ•°ç»„çš„ä¸åŒæ§½ä¸­ï¼Œå„ä¸ªçº¿ç¨‹åªå¯¹è‡ªå·±æ§½ä¸­çš„é‚£ä¸ªå€¼è¿›è¡ŒCASæ“ä½œï¼Œè¿™æ ·çƒ­ç‚¹å°±è¢«åˆ†æ•£äº†ï¼Œå†²çªçš„æ¦‚çŽ‡å°±å°å¾ˆå¤šã€‚å¦‚æžœè¦èŽ·å–çœŸæ­£çš„longå€¼ï¼Œåªè¦å°†å„ä¸ªæ§½ä¸­çš„å˜é‡å€¼ç´¯åŠ è¿”å›žã€‚ è¯´æ˜Žä¿æŒä¸€ä¸ªæˆ–è€…å¤šä¸ªå˜é‡ï¼Œåˆå§‹å€¼è®¾ç½®ä¸ºé›¶ç”¨äºŽæ±‚å’Œã€‚å½“æ›´æ–°å‡ºçŽ°å¤šä¸ªçº¿ç¨‹ç«žäº‰æ—¶ï¼Œå˜é‡é›†åˆåŠ¨æ€å¢žé•¿ä»¥å‡å°‘äº‰ç”¨ã€‚æœ€åŽå½“éœ€è¦æ±‚å’Œçš„æ—¶å€™æˆ–è€…è¯´éœ€è¦è¿™ä¸ªLongåž‹çš„å€¼æ—¶ï¼Œå¯ä»¥é€šè¿‡æŠŠå½“å‰è¿™äº›å˜é‡æ±‚å’Œï¼Œåˆå¹¶åŽå¾—å‡ºæœ€ç»ˆçš„å’Œã€‚ LongAdderåœ¨ä¸€äº›é«˜å¹¶å‘åœºæ™¯ä¸‹è¡¨çŽ°è¦æ¯”AtomicLongå¥½ï¼Œæ¯”å¦‚å¤šä¸ªçº¿ç¨‹åŒæ—¶æ›´æ–°ä¸€ä¸ªæ±‚å’Œçš„å˜é‡ï¼Œæ¯”å¦‚ç»Ÿè®¡é›†åˆçš„æ•°é‡ï¼Œä½†æ˜¯ä¸èƒ½ç”¨äºŽç»†ç²’åº¦åŒæ­¥æŽ§åˆ¶ï¼Œæ¢å¥è¯è¯´è¿™ä¸ªæ˜¯å¯èƒ½æœ‰è¯¯å·®çš„ï¼ˆå› ä¸ºæ›´æ–°ä¸Žè¯»å–æ˜¯å¹¶è¡Œçš„ï¼‰ã€‚åœ¨ä½Žå¹¶å‘åœºæ™¯åœºæ™¯ä¸‹LongAdderå’ŒAtomicLongçš„æ€§èƒ½è¡¨çŽ°æ²¡ä»€ä¹ˆå·®åˆ«ï¼Œä½†æ˜¯å½“é«˜å¹¶å‘ç«žäº‰çš„æ—¶å€™ï¼Œè¿™ä¸ªç±»å°†å…·å¤‡æ›´å¥½çš„åžåæ€§èƒ½ï¼Œä½†æ˜¯ç›¸åº”çš„ä¹Ÿä¼šè€—è´¹ç›¸å½“çš„ç©ºé—´ã€‚ LongAdderç»§æ‰¿äº†NumberæŠ½è±¡ç±»ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å®žçŽ°ä¸€äº›æ–¹æ³•ä¾‹å¦‚: equalsã€hashCodeã€compareToï¼Œå› ä¸ºLongAdderå®žä¾‹çš„é¢„æœŸç”¨é€”æ˜¯è¿›è¡Œä¸€äº›æ¯”è¾ƒé¢‘ç¹çš„å˜åŒ–ï¼Œæ‰€ä»¥ä¹Ÿä¸é€‚åˆä½œä¸ºé›†åˆçš„keyã€‚ å…·ä½“å®žçŽ°çœ‹ä¸€ä¸‹LongAdderæœ‰å“ªäº›æ–¹æ³•ï¼š ä¸‹é¢ä¸»è¦è§£æžLongAdder incrementã€sumæ–¹æ³•ï¼Œå…ˆçœ‹ä¸€ä¸‹æºç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243/** * Equivalent to &#123;@code add(1)&#125;. */public void increment() &#123; add(1L);&#125;/*** Adds the given value.** @param x the value to add*/public void add(long x) &#123; Cell[] cs; long b, v; int m; Cell c; if ((cs = cells) != null || !casBase(b = base, b + x)) &#123; //åˆ°äº†è¿™é‡Œ è¡¨æ˜Žcsä¸ä¸ºnull or çº¿ç¨‹æœ‰å¹¶å‘å†²çªï¼Œå¯¼è‡´caseBaseå¤±è´¥ boolean uncontended = true; if (cs == null || // cells ä¸ºnull (m = cs.length - 1) &lt; 0 || // cells ä¸ä¸ºnull ä½†åªæœ‰ä¸€ä¸ªå…ƒç´  (c = cs[getProbe() &amp; m]) == null || //å“ˆå¸Œå–æ¨¡ å¯¹åº”ä½ç½®å…ƒç´ ä¸ºnull !(uncontended = c.cas(v = c.value, v + x))) //cas æ›¿æ¢å¤±è´¥ï¼ˆå¹¶å‘ç«žäº‰ï¼‰ longAccumulate(x, null, uncontended); &#125;&#125;/*** CASes the base field (Striped64ç±»ä¸­çš„æ–¹æ³•)*/final boolean casBase(long cmp, long val) &#123; return BASE.compareAndSet(this, cmp, val);&#125;//å½“åœ¨sumçš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½åˆ«çš„çº¿ç¨‹æ­£åœ¨æ“ä½œcellsï¼ˆå› ä¸ºæ²¡æœ‰åŠ é”ï¼‰//sumå–çš„å€¼ï¼Œä¸ä¸€å®šå‡†ç¡®public long sum() &#123; Cell[] cs = cells; long sum = base; if (cs != null) &#123; for (Cell c : cs) if (c != null) sum += c.value; &#125; return sum;&#125; LongAdder vs AtomicLong PerformanceJava 8 Performance Improvements: LongAdder vs AtomicLong å¯¹æ¯”LongAccumulatorLongAdderç±»å¯ä»¥çœ‹åšæ˜¯LongAccumulatorçš„ä¸€ä¸ªç‰¹ä¾‹ï¼ŒLongAccumulatoræä¾›äº†æ¯”LongAdderæ›´å¼ºå¤§ã€çµæ´»çš„åŠŸèƒ½ã€‚ 1234567891011121314151617181920212223/** * Creates a new instance using the given accumulator function * and identity element. * @param accumulatorFunction a side-effect-free function of two arguments * @param identity identity (initial value) for the accumulator function*/public LongAccumulator(LongBinaryOperator accumulatorFunction, long identity) &#123; this.function = accumulatorFunction; base = this.identity = identity;&#125;@FunctionalInterfacepublic interface LongBinaryOperator &#123;/** * Applies this operator to the given operands. * * @param left the first operand * @param right the second operand * @return the operator result*/long applyAsLong(long left, long right);&#125; æž„é€ å‡½æ•°å…¶ä¸­accumulatorFunctionä¸€ä¸ªåŒç›®è¿ç®—æŽ¥å£ï¼Œæ ¹æ®è¾“å…¥çš„ä¸¤ä¸ªå‚æ•°è¿”å›žä¸€ä¸ªè®¡ç®—å€¼ï¼Œidentityåˆ™æ˜¯LongAccumulatorç´¯åŠ å™¨çš„åˆå§‹å€¼ã€‚ accumulatorFunctionä¸»è¦ç”¨äºŽStriped64 longAccumulateä¸­ä½¿ç”¨ï¼Œå¦‚æžœfn==nullï¼Œåˆ™é»˜è®¤æ˜¯ç›¸åŠ ï¼Œå¦åˆ™ä¼šè°ƒç”¨fn.applyAsLong(v, x) LongAccumulatorç›¸æ¯”äºŽLongAdderï¼Œå¯ä»¥ä¸ºç´¯åŠ å™¨æä¾›éž0çš„åˆå§‹å€¼ï¼Œè€ŒLongAdderåªèƒ½æä¾›é»˜è®¤çš„0å€¼ã€‚å¦å¤–ï¼ŒLongAccumulatorè¿˜å¯ä»¥æŒ‡å®šç´¯åŠ è§„åˆ™ï¼Œæ¯”å¦‚ç´¯åŠ æˆ–è€…ç›¸ä¹˜ï¼Œåªéœ€è¦åœ¨æž„é€ LongAccumulatoræ—¶ï¼Œä¼ å…¥è‡ªå®šä¹‰çš„åŒç›®è¿ç®—å™¨å³å¯ï¼ŒåŽè€…åˆ™å†…ç½®ç´¯åŠ è§„åˆ™ã€‚ Referencehttps://github.com/jiankunking/openjdk12/blob/master/src/java.base/share/classes/java/util/concurrent/atomic/LongAdder.java https://github.com/jiankunking/openjdk12/blob/master/src/java.base/share/classes/jdk/internal/vm/annotation/Contended.java https://www.jianshu.com/p/9a7de5644dd4 http://openjdk.java.net/jeps/142 http://mail.openjdk.java.net/pipermail/hotspot-dev/2012-November/007309.html]]></content>
      <categories>
        <category>JDK</category>
      </categories>
      <tags>
        <tag>JDK</tag>
        <tag>Concurrent</tag>
        <tag>Atomic</tag>
        <tag>LongAdder</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JRockitæƒå¨æŒ‡å—æ·±å…¥ç†è§£JVM ç¬”è®°]]></title>
    <url>%2Fjava-jrockit-note.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ•´ç†è‡ªï¼šã€ŠJRockitæƒå¨æŒ‡å—æ·±å…¥ç†è§£JVMã€‹ ä½œè€…ï¼šMarcus Hirt , Marcus Lagergren å‡ºç‰ˆæ—¶é—´ï¼š2018-12-10 èµ·æ­¥å°†åº”ç”¨ç¨‹åºè¿ç§»åˆ°JRockitå‘½ä»¤è¡Œé€‰é¡¹åœ¨ JRockit JVMä¸­,ä¸»è¦æœ‰3ç±»å‘½ä»¤è¡Œé€‰é¡¹,åˆ†åˆ«æ˜¯ç³»ç»Ÿå±žæ€§ã€æ ‡å‡†é€‰é¡¹(ä»¥-Xå¼€å¤´)å’Œéžæ ‡å‡†é€‰é¡¹(ä»¥-XXå¼€å¤´) 1ã€ç³»ç»Ÿå±žæ€§ è®¾ç½®JVMå¯åŠ¨å‚æ•°çš„æ–¹å¼æœ‰å¤šç§ã€‚ä»¥-Då¼€å¤´çš„å‚æ•°ä¼šä½œä¸ºç³»ç»Ÿå±žæ€§ä½¿ç”¨,è¿™äº›å±žæ€§å¯ä»¥ä¸ºJavaç±»åº“(å¦‚RMIç­‰)æä¾›ç›¸å…³çš„é…ç½®ä¿¡æ¯ã€‚ä¾‹å¦‚,åœ¨å¯åŠ¨çš„æ—¶å€™,å¦‚æžœè®¾ç½®äº†-Dcom.Rockin.mc.debug=trueå‚æ•°,åˆ™JRockit Mission Controlä¼šæ‰“å°å‡ºè°ƒè¯•ä¿¡æ¯ã€‚ä¸è¿‡,R28ä¹‹åŽçš„JRockit JVMç‰ˆæœ¬åºŸå¼ƒäº†å¾ˆå¤šä¹‹å‰ä½¿ç”¨è¿‡çš„ç³»ç»Ÿå±žæ€§,è½¬è€Œé‡‡ç”¨éžæ ‡å‡†é€‰é¡¹å’Œç±»ä¼¼ HotSpotä¸­è™šæ‹Ÿæœºæ ‡å¿—(VM flag)çš„æ–¹å¼è®¾ç½®ç›¸å…³é€‰é¡¹ 2ã€æ ‡å‡†é€‰é¡¹ ä»¥-Xå¼€å¤´çš„é€‰é¡¹æ˜¯å¤§éƒ¨åˆ†JVMåŽ‚å•†éƒ½æ”¯æŒçš„é€šç”¨è®¾ç½®ã€‚ä¾‹å¦‚,ç”¨äºŽè®¾ç½®å †å¤§å°æœ€å¤§å€¼çš„é€‰é¡¹-Xmxåœ¨åŒ…æ‹¬ JRockitåœ¨å†…çš„å¤§éƒ¨åˆ†JVMä¸­éƒ½æ˜¯ç›¸åŒçš„ã€‚å½“ç„¶,ä¹Ÿå­˜åœ¨ä¾‹å¤–,å¦‚JRockitä¸­çš„é€‰é¡¹-Xverboseä¼šæ‰“å°å‡ºå¯é€‰çš„å­æ¨¡å—æ—¥å¿—ä¿¡æ¯,è€Œåœ¨ HotSpotä¸­,ç±»ä¼¼çš„(ä½†å®žé™…ä¸Šæœ‰æ›´å¤šçš„é™åˆ¶)é€‰é¡¹æ˜¯-verbose 3ã€éžæ ‡å‡†é€‰é¡¹ ä»¥-XXå¼€å¤´çš„å‘½ä»¤è¡Œé€‰é¡¹æ˜¯å„ä¸ªJVMåŽ‚å•†è‡ªå·±å®šåˆ¶çš„ã€‚è¿™äº›é€‰é¡¹å¯èƒ½ä¼šåœ¨å°†æ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­è¢«åºŸå¼ƒæˆ–ä¿®æ”¹ã€‚å¦‚æžœJVMçš„å‚æ•°é…ç½®ä¸­åŒ…å«äº†ä»¥-XXå¼€å¤´çš„å‘½ä»¤è¡Œé€‰é¡¹,åˆ™åœ¨å°†Javaåº”ç”¨ç¨‹åºä»Žä¸€ç§JVMè¿ç§»åˆ°å¦ä¸€ç§æ—¶,åº”è¯¥åœ¨å¯åŠ¨Mä¹‹å‰åŽ»é™¤è¿™äº›éžæ ‡å‡†é€‰é¡¹ç¡®å®šäº†æ–°çš„VMé€‰é¡¹åŽæ‰å¯ä»¥å¯åŠ¨Javaåº”ç”¨ç¨‹åºã€‚ è‡ªé€‚åº”ä»£ç ç”ŸæˆJavaè™šæ‹Ÿæœºå­—èŠ‚ç æ ¼å¼Opcodes for the Java Virtual Machine å¸¸é‡æ± ç¨‹åº,åŒ…å«æ•°æ®å’Œä»£ç ä¸¤éƒ¨åˆ†,å…¶ä¸­æ•°æ®ä½œä¸ºæ“ä½œæ•°ä½¿ç”¨ã€‚å¯¹äºŽå­—èŠ‚ç ç¨‹åºæ¥è¯´,å¦‚æžœæ“ä½œæ•°éžå¸¸å°æˆ–è€…å¾ˆå¸¸ç”¨(å¦‚å¸¸é‡0),åˆ™è¿™äº›æ“ä½œæ•°æ˜¯ç›´æŽ¥å†…åµŒåœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­çš„ã€‚ è¾ƒå¤§å—çš„æ•°æ®,ä¾‹å¦‚å¸¸é‡å­—ç¬¦ä¸²æˆ–æ¯”è¾ƒå¤§çš„æ•°å­—,æ˜¯å­˜å‚¨åœ¨classæ–‡ä»¶å¼€å§‹éƒ¨åˆ†çš„å¸¸é‡æ± (constant pool)ä¸­çš„ã€‚å½“ä½¿ç”¨è¿™ç±»æ•°æ®ä½œä¸ºæ“ä½œæ•°æ—¶,ä½¿ç”¨çš„æ˜¯å¸¸é‡æ± ä¸­æ•°æ®çš„ç´¢å¼•ä½ç½®,è€Œä¸æ˜¯å®žé™…æ•°æ®æœ¬èº«ã€‚ä»¥å­—ç¬¦ä¸²æ•°æ®aVeryLong FunctionNameä¸ºä¾‹,å¦‚æžœåœ¨ç¼–è¯‘æ–¹æ³•æ—¶æ¯æ¬¡éƒ½è¦é‡æ–°ç¼–ç è¿™ä¸ªå­—ç¬¦ä¸²çš„è¯,é‚£å­—èŠ‚ç å°±è°ˆä¸ä¸ŠåŽ‹ç¼©å­˜å‚¨äº†ã€‚ æ­¤å¤–,Javaç¨‹åºä¸­çš„æ–¹æ³•ã€å±žæ€§å’Œç±»çš„å…ƒæ•°æ®ç­‰ä¹Ÿä½œä¸ºclasæ–‡ä»¶çš„ç»„æˆéƒ¨åˆ†,å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚ è‡ªé€‚åº”ä»£ç ç”Ÿæˆä¼˜åŒ–åŠ¨æ€ç¨‹åºåœ¨æ±‡ç¼–ä»£ç ä¸­,æ–¹æ³•è°ƒç”¨æ˜¯é€šè¿‡callæŒ‡ä»¤å®Œæˆçš„ã€‚ä¸åŒå¹³å°ä¸ŠcallæŒ‡ä»¤çš„å…·ä½“å½¢å¼ä¸å°½ç›¸åŒ,ä¸åŒç±»åž‹çš„callæŒ‡ä»¤,å…¶å…·ä½“æ ¼å¼ä¹Ÿä¸å°½ç›¸åŒã€‚ åœ¨é¢å‘å¯¹è±¡çš„è¯­è¨€ä¸­,è™šæ‹Ÿæ–¹æ³•åˆ†æ´¾é€šå¸¸è¢«ç¼–è¯‘ä¸ºå¯¹åˆ†æ´¾è¡¨(dispatch table)ä¸­åœ°å€çš„é—´æŽ¥è°ƒç”¨(indirect call,å³éœ€è¦ä»Žå†…å­˜ä¸­è¯»å–çœŸæ­£çš„è°ƒç”¨åœ°å€)ã€‚è¿™æ˜¯å› ä¸º,æ ¹æ®ä¸åŒçš„ç±»ç»§æ‰¿ç»“æž„åˆ†æ´¾è™šæ‹Ÿè°ƒç”¨æ—¶å¯èƒ½ä¼šæœ‰å¤šä¸ªæŽ¥æ”¶è€…ã€‚æ¯ä¸ªç±»ä¸­éƒ½æœ‰ä¸€ä¸ªåˆ†æ´¾è¡¨,å…¶ä¸­åŒ…å«äº†å…¶è™šæ‹Ÿè°ƒç”¨çš„æŽ¥æ”¶è€…ä¿¡æ¯ã€‚é™æ€æ–¹æ³•å’Œç¡®çŸ¥åªæœ‰ä¸€ä¸ªæŽ¥æ”¶è€…çš„è™šæ‹Ÿæ–¹æ³•å¯ä»¥è¢«ç¼–è¯‘ä¸ºå¯¹å›ºå®šè°ƒç”¨åœ°å€çš„ç›´æŽ¥è°ƒç”¨(direct call)ã€‚ä¸€èˆ¬æ¥è¯´,è¿™å¯ä»¥å¤§å¤§åŠ å¿«æ‰§è¡Œé€Ÿåº¦ã€‚ å‡è®¾åº”ç”¨ç¨‹åºæ˜¯ä½¿ç”¨C++å¼€å‘çš„,å¯¹ä»£ç ç”Ÿæˆå™¨æ¥è¯´,åœ¨ç¼–è¯‘æ—¶å·²ç»å¯ä»¥èŽ·å–åˆ°ç¨‹åºçš„æ‰€æœ‰ç»“æž„æ€§ä¿¡æ¯ã€‚ä¾‹å¦‚,ç”±äºŽåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­,ä»£ç ä¸ä¼šå‘ç”Ÿå˜åŒ–,æ‰€ä»¥åœ¨ç¼–è¯‘æ—¶å°±å¯ä»¥ä»Žä»£ç ä¸­åˆ¤æ–­å‡º,æŸä¸ªè™šæ‹Ÿæ–¹æ³•æ˜¯å¦åªæœ‰ä¸€ç§å®žçŽ°ã€‚æ­£å› å¦‚æ­¤,ç¼–è¯‘å™¨ä¸ä»…ä¸éœ€è¦å› ä¸ºåºŸå¼ƒä»£ç è€Œè®°å½•é¢å¤–çš„ä¿¡æ¯,è¿˜å¯ä»¥å°†é‚£äº›åªæœ‰ä¸€ç§å®žçŽ°çš„è™šæ‹Ÿæ–¹æ³•è½¬åŒ–ä¸ºé™æ€è°ƒç”¨ã€‚ å‡å¦‚åº”ç”¨ç¨‹åºæ˜¯ä½¿ç”¨Javaå¼€å‘çš„,èµ·åˆæŸä¸ªè™šæ‹Ÿæ–¹æ³•å¯èƒ½åªæœ‰ä¸€ç§å®žçŽ°,ä½†Javaå…è®¸åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¿®æ”¹æ–¹æ³•å®žçŽ°ã€‚å½“JITç¼–è¯‘å™¨éœ€è¦ç¼–è¯‘æŸä¸ªè™šæ‹Ÿæ–¹æ³•æ—¶,æ›´å–œæ¬¢çš„æ˜¯é‚£äº›æ°¸è¿œåªå­˜åœ¨ä¸€ç§å®žçŽ°çš„,è¿™æ ·ç¼–è¯‘å™¨å°±å¯ä»¥åƒå‰é¢æåˆ°çš„C+ç¼–è¯‘å™¨ä¸€æ ·åšå¾ˆå¤šä¼˜åŒ–,ä¾‹å¦‚å°†è™šæ‹Ÿè°ƒç”¨è½¬åŒ–ä¸ºç›´æŽ¥è°ƒç”¨ã€‚ä½†æ˜¯,ç”±äºŽJavaå…è®¸åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ä¿®æ”¹ä»£ç ,å¦‚æžœæŸä¸ªæ–¹æ³•æ²¡æœ‰å£°æ˜Žfinalä¿®é¥°ç¬¦,é‚£å®ƒå°±æœ‰å¯èƒ½åœ¨è¿è¡ŒæœŸé—´è¢«ä¿®æ”¹,å³ä½¿å®ƒçœ‹èµ·æ¥å‡ ä¹Žä¸å¯èƒ½æœ‰å…¶ä»–å®žçŽ°,ç¼–è¯‘å™¨ä¹Ÿä¸èƒ½å°†ä¹‹ä¼˜åŒ–ä¸ºç›´æŽ¥è°ƒç”¨ã€‚ åœ¨Javaä¸–ç•Œä¸­,æœ‰ä¸€äº›åœºæ™¯çŽ°åœ¨çœ‹èµ·æ¥ä¸€åˆ‡æ­£å¸¸,ç¼–è¯‘å™¨å¯ä»¥å¤§åŠ›ä¼˜åŒ–ä»£ç ,ä½†æ˜¯å¦‚æžœæŸå¤©ç¨‹åºå‘ç”Ÿäº†æ”¹å˜çš„è¯,å°±éœ€è¦å°†ç›¸å…³çš„ä¼˜åŒ–å…¨éƒ¨æ’¤é”€ã€‚å¯¹äºŽJavaæ¥è¯´,ä¸ºäº†èƒ½å¤Ÿåª²ç¾ŽC++ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦,å°±éœ€è¦ä¸€äº›ç‰¹æ®Šçš„ä¼˜åŒ–æŽªæ–½ã€‚ JVMä½¿ç”¨çš„ç­–ç•¥å°±æ˜¯â€œèµŒâ€ã€‚JVMä»£ç ç”Ÿæˆç­–ç•¥çš„å‡è®¾æ¡ä»¶æ˜¯,æ­£åœ¨è¿è¡Œçš„ä»£ç æ°¸è¿œä¸å˜ã€‚äº‹å®žä¸Š,å¤§éƒ¨åˆ†æ—¶é—´é‡Œç¡®å®žå¦‚æ­¤ã€‚ä½†å¦‚æžœæ­£åœ¨è¿è¡Œçš„ä»£ç å‘ç”Ÿäº†å˜åŒ–,è¿åäº†ä»£ç ä¼˜åŒ–çš„å‡è®¾æ¡ä»¶,å°±ä¼šè§¦å‘å…¶ç°¿è®°ç³»ç»Ÿ(bookkeeping system)çš„å›žè°ƒåŠŸèƒ½ã€‚æ­¤æ—¶,åŸºäºŽåŽŸå…ˆå‡è®¾æ¡ä»¶ç”Ÿæˆçš„ä»£ç å°±éœ€è¦è¢«åºŸå¼ƒæŽ‰,é‡æ–°ç”Ÿæˆ,ä¾‹å¦‚ä¸ºå·²ç»è½¬åŒ–ä¸ºç›´æŽ¥è°ƒç”¨çš„è™šæ‹Ÿè°ƒç”¨é‡æ–°ç”Ÿæˆç›¸å…³ä»£ç ã€‚å› æ­¤,â€œèµŒè¾“â€çš„ä»£ä»·æ˜¯å¾ˆå¤§çš„,ä½†å¦‚æžœâ€œèµŒèµ¢â€çš„æ¦‚çŽ‡éžå¸¸é«˜,åˆ™ä»Žä¸­èŽ·å¾—çš„æ€§èƒ½æå‡å°±ä¼šéžå¸¸å¤§,å€¼å¾—ä¸€è¯•ã€‚ ä¸€èˆ¬æ¥è¯´,JVMå’ŒJITç¼–è¯‘å™¨æ‰€åšçš„å…¸åž‹å‡è®¾åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š è™šæ‹Ÿæ–¹æ³•ä¸ä¼šè¢«è¦†ç›–ã€‚ç”±äºŽæŸä¸ªè™šæ‹Ÿæ–¹æ³•åªå­˜åœ¨ä¸€ç§å®žçŽ°,å°±å¯ä»¥å°†ä¹‹ä¼˜åŒ–ä¸ºä¸€ä¸ªç›´æŽ¥è°ƒç”¨ã€‚ æµ®ç‚¹æ•°çš„å€¼æ°¸è¿œä¸ä¼šæ˜¯NaNã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹,å¯ä»¥ä½¿ç”¨ç¡¬ä»¶æŒ‡ä»¤æ¥æ›¿æ¢å¯¹æœ¬åœ°æµ®ç‚¹æ•°å‡½æ•°åº“çš„è°ƒç”¨ã€‚ æŸäº›tryè¯­å¥å—ä¸­å‡ ä¹Žä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å› æ­¤,å¯ä»¥å°†catchè¯­å¥å—ä¸­çš„ä»£ç ä½œä¸ºå†·æ–¹æ³•å¯¹å¾…ã€‚ å¯¹äºŽå¤§å¤šæ•°ä¸‰è§’å‡½æ•°æ¥è¯´,ç¡¬ä»¶æŒ‡ä»¤fsinéƒ½èƒ½å¤Ÿè¾¾åˆ°ç²¾åº¦è¦æ±‚ã€‚å¦‚æžœçœŸçš„è¾¾ä¸åˆ°,å°±æŠ›å‡ºå¼‚å¸¸,è°ƒç”¨æœ¬åœ°æµ®ç‚¹æ•°å‡½æ•°åº“å®Œæˆè®¡ç®—ã€‚ é”ç«žäº‰å¹¶ä¸ä¼šå¤ªæ¿€çƒˆ,åˆæœŸå¯ä»¥ä½¿ç”¨è‡ªæ—‹é”(spinlock)æ›¿ä»£ã€‚ é”å¯èƒ½ä¼šå‘¨æœŸæ€§åœ°è¢«åŒä¸€ä¸ªçº¿ç¨‹èŽ·å–å’Œé‡Šæ”¾,æ‰€ä»¥,å¯ä»¥å°†å¯¹é”çš„é‡å¤èŽ·å–æ“ä½œå’Œé‡å¤é‡Šæ”¾æ“ä½œç›´æŽ¥çœç•¥æŽ‰ã€‚ æ·±å…¥JITç¼–è¯‘å™¨ä¼˜åŒ–å­—èŠ‚ç  æœ‰äº›æ—¶å€™,å¯¹Javaæºä»£ç åšä¼˜åŒ–ä¼šé€‚å¾—å…¶åã€‚ç»å¤§éƒ¨åˆ†å†™å‡ºå¯è¯»æ€§å¾ˆå·®çš„ä»£ç çš„äººéƒ½å£°ç§°æ˜¯ä¸ºäº†ä¼˜åŒ–æ€§èƒ½,å…¶å®žå°±æ˜¯ç…§ç€ä¸€äº›åŸºå‡†æµ‹è¯•æŠ¥å‘Šçš„ç»“è®ºå†™ä»£ç ,è€Œè¿™äº›æ€§èƒ½æµ‹è¯•å¾€å¾€åªæ¶‰åŠäº†å­—èŠ‚ç è§£é‡Šæ‰§è¡Œ,æ²¡æœ‰ç»è¿‡JITç¼–è¯‘å™¨ä¼˜åŒ–,æ‰€ä»¥å¹¶ä¸èƒ½ä»£è¡¨åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶çš„çœŸå®žè¡¨çŽ°ã€‚ä¾‹å¦‚,æŸä¸ªæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºä¸­åŒ…å«äº†å¤§é‡å¯¹æ•°ç»„å…ƒç´ çš„è¿­ä»£è®¿é—®æ“ä½œ,ç¨‹åºå‘˜å‚è€ƒäº†é‚£äº›æŠ¥å‘Šä¸­çš„ç»“è®º,æ²¡æœ‰è®¾ç½®å¾ªçŽ¯æ¡ä»¶,è€Œæ˜¯å†™ä¸€ä¸ªæ— é™forå¾ªçŽ¯,ç½®äºŽtryè¯­å¥å—ä¸­,å¹¶åœ¨catchè¯­å¥å—ä¸­æ•èŽ·ArrayIndexOutOfBoundsExceptionå¼‚å¸¸ã€‚è¿™ç§ç³Ÿç³•çš„å†™æ³•ä¸ä»…ä½¿ä»£ç å¯è¯»æ€§æžå·®,è€Œä¸”ä¸€æ—¦è¿è¡Œæ—¶å¯¹ä¹‹ä¼˜åŒ–ç¼–è¯‘çš„è¯,å…¶æ‰§è¡Œæ•ˆçŽ‡åè€Œæ¯”æ™®é€šå¾ªçŽ¯æ–¹å¼ä½Žå¾—å¤šã€‚åŽŸå› åœ¨äºŽ,JVMçš„åŸºæœ¬å‡è®¾ä¹‹ä¸€å°±æ˜¯â€œå¼‚å¸¸æ˜¯å¾ˆå°‘å‘ç”Ÿçš„â€ã€‚åŸºäºŽè¿™ç§å‡è®¾,JVMä¼šåšä¸€äº›ç›¸å…³ä¼˜åŒ–,æ‰€ä»¥å½“çœŸçš„å‘ç”Ÿå¼‚å¸¸æ—¶,å¤„ç†æˆæœ¬å°±å¾ˆé«˜ã€‚ ä»£ç æµæ°´çº¿ä»£ç ç”Ÿæˆæ¦‚è¿° åœ¨ç”Ÿæˆä¼˜åŒ–ä»£ç æ—¶,å¦‚ä½•åˆ†é…å¯„å­˜å™¨éžå¸¸é‡è¦ã€‚ç¼–è¯‘å™¨æ•™æä¸Šéƒ½å°†å¯„å­˜å™¨åˆ†é…é—®é¢˜ä½œä¸ºå›¾çš„ç€è‰²é—®é¢˜å¤„ç†,è¿™æ˜¯å› ä¸ºåŒæ—¶ç”¨åˆ°çš„ä¸¤ä¸ªå˜é‡ä¸èƒ½å…±äº«åŒä¸€ä¸ªå¯„å­˜å™¨,ä»Žè¿™ç‚¹ä¸Šè®²,ä¸Žç€è‰²é—®é¢˜ç›¸åŒã€‚åŒæ—¶ä½¿ç”¨çš„å¤šä¸ªå˜é‡å¯ä»¥ç”¨å›¾ä¸­ç›¸è¿žæŽ¥çš„èŠ‚ç‚¹æ¥è¡¨ç¤º,è¿™æ ·,å¯„å­˜å™¨åˆ†é…é—®é¢˜å°±å¯ä»¥è¢«æŠ½è±¡ä¸ºâ€œå¦‚ä½•ä¸ºå›¾ä¸­çš„èŠ‚ç‚¹ç€è‰²,5èƒ½ä½¿ç›¸è¿žèŠ‚ç‚¹æœ‰ä¸åŒçš„é¢œè‰²â€ã€‚è¿™é‡Œå¯ç”¨é¢œè‰²çš„æ•°é‡ç­‰äºŽæŒ‡å®šå¹³å°ä¸Šå¯ç”¨å¯„å­˜å™¨çš„æ•°é‡ã€‚ä¸è¿‡,é—æ†¾çš„æ˜¯,ä»Žè®¡ç®—å¤æ‚æ€§ä¸Šè®²,ç€è‰²é—®é¢˜æ˜¯NP-hardçš„,ä¹Ÿå°±æ˜¯è¯´çŽ°åœ¨è¿˜æ²¡æœ‰ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•(æŒ‡å¯ä»¥åœ¨å¤šé¡¹å¼æ—¶é—´å†…å®Œæˆè®¡ç®—)èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯,ç€è‰²é—®é¢˜å¯ä»¥åœ¨çº¿æ€§å¯¹æ•°æ—¶é—´å†…ç»™å‡ºè¿‘ä¼¼è§£,å› æ­¤å¤§å¤šæ•°ç¼–è¯‘å™¨éƒ½ä½¿ç”¨ç€è‰²ç®—æ³•çš„æŸä¸ªå˜ç§æ¥å¤„ç†å¯„å­˜å™¨åˆ†é…é—®é¢˜ã€‚ è‡ªé€‚åº”å†…å­˜ç®¡ç†å †ç®¡ç†åŸºç¡€å¯¹è±¡çš„åˆ†é…ä¸Žé‡Šæ”¾ä¸€èˆ¬æ¥è¯´,ä¸ºå¯¹è±¡åˆ†é…å†…å­˜æ—¶,å¹¶ä¸ä¼šç›´æŽ¥åœ¨å †ä¸Šåˆ’åˆ†å†…å­˜,è€Œæ˜¯å…ˆåœ¨çº¿ç¨‹å±€éƒ¨ç¼“å†²(thread local buffer)æˆ–å…¶ä»–ç±»ä¼¼çš„ç»“æž„ä¸­æ‰¾åœ°æ–¹æ”¾ç½®å¯¹è±¡,ç„¶åŽéšç€åº”ç”¨ç¨‹åºçš„è¿è¡Œã€æ–°å¯¹è±¡çš„ä¸æ–­åˆ†é…,åžƒåœ¾å›žæ”¶é€æ¬¡æ‰§è¡Œ,è¿™äº›å¯¹è±¡å¯èƒ½æœ€ç»ˆä¼šè¢«æå‡åˆ°å †ä¸­ä¿å­˜,ä¹Ÿæœ‰å¯èƒ½ä¼šå½“ä½œåžƒåœ¾è¢«é‡Šæ”¾æŽ‰ã€‚ ä¸ºäº†èƒ½å¤Ÿåœ¨å †ä¸­ç»™æ–°åˆ›å»ºçš„å¯¹è±¡æ‰¾ä¸€ä¸ªåˆé€‚çš„ä½ç½®,å†…å­˜ç®¡ç†ç³»ç»Ÿå¿…é¡»çŸ¥é“å †ä¸­æœ‰å“ªäº›åœ°æ–¹æ˜¯ç©ºé—²çš„,å³è¿˜æ²¡æœ‰å­˜æ´»å¯¹è±¡å ç”¨ã€‚å†…å­˜ç®¡ç†ç³»ç»Ÿä½¿ç”¨ç©ºé—²åˆ—è¡¨(free list)â€”ä¸²è”èµ·å†…å­˜ä¸­å¯ç”¨å†…å­˜å—çš„é“¾è¡¨,æ¥ç®¡ç†å†…å­˜ä¸­å¯ç”¨çš„ç©ºé—²åŒºåŸŸ,å¹¶æŒ‰ç…§æŸä¸ªç»´åº¦çš„ä¼˜å…ˆçº§æŽ’åºã€‚ åœ¨ç©ºé—²åˆ—è¡¨ä¸­æœç´¢è¶³å¤Ÿå­˜å‚¨æ–°å¯¹è±¡çš„ç©ºé—²å—æ—¶,å¯ä»¥é€‰æ‹©å¤§å°æœ€é€‚åˆçš„ç©ºé—²å—,ä¹Ÿå¯ä»¥é€‰æ‹©ç¬¬ä¸€ä¸ªæ”¾å¾—ä¸‹çš„ç©ºé—²å—ã€‚è¿™å…¶ä¸­ä¼šç”¨åˆ°å‡ ç§ä¸åŒçš„ç®—æ³•åŽ»å®žçŽ°,å„æœ‰ä¼˜åŠ£,åŽæ–‡ä¼šè¯¦ç»†è®¨è®ºã€‚ åžƒåœ¾å›žæ”¶ç®—æ³•åœ¨åŽæ–‡ä¸­,æ ¹é›†åˆ(root set)ä¸“æŒ‡ä¸Šè¿°æœç´¢ç®—æ³•çš„åˆå§‹è¾“å…¥é›†åˆ,å³å¼€å§‹æ‰§è¡Œå¼•ç”¨è·Ÿè¸ªæ—¶çš„å­˜æ´»å¯¹è±¡é›†åˆã€‚ä¸€èˆ¬æƒ…å†µä¸‹,æ ¹é›†åˆä¸­åŒ…æ‹¬äº†å› ä¸ºæ‰§è¡Œåžƒåœ¾å›žæ”¶è€Œæš‚åœçš„åº”ç”¨ç¨‹åºçš„å½“å‰æ ˆå¸§ä¸­æ‰€æœ‰çš„å¯¹è±¡,åŒ…å«äº†å¯ä»¥ä»Žå½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡çš„ç”¨æˆ·æ ˆå’Œå¯„å­˜å™¨ä¸­èƒ½å¾—åˆ°çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ­¤å¤–,æ ¹é›†åˆä¸­è¿˜åŒ…å«å…¨å±€æ•°æ®,ä¾‹å¦‚ç±»çš„é™æ€å±žæ€§ã€‚ç®€å•æ¥è¯´å°±æ˜¯,æ ¹é›†åˆä¸­åŒ…å«äº†æ‰€æœ‰æ— é¡»è·Ÿè¸ªå¼•ç”¨å°±å¯ä»¥å¾—åˆ°çš„å¯¹è±¡ã€‚ Javaä½¿ç”¨çš„æ˜¯å‡†ç¡®å¼åžƒåœ¾å›žæ”¶å™¨(exact garbage collector),å¯ä»¥å°†å¯¹è±¡æŒ‡é’ˆç±»åž‹æ•°æ®å’Œå…¶ä»–ç±»åž‹çš„æ•°æ®åŒºåˆ†å¼€,åªéœ€è¦å°†å…ƒæ•°æ®ä¿¡æ¯å‘ŠçŸ¥åžƒåœ¾å›žæ”¶å™¨å³å¯,è¿™äº›å…ƒæ•°æ®ä¿¡æ¯,ä¸€èˆ¬å¯ä»¥ä»ŽJavaæ–¹æ³•çš„ä»£ç ä¸­å¾—åˆ°ã€‚ è¿‘äº›å¹´,ä½¿ç”¨ä¿¡å·æ¥æš‚åœçº¿ç¨‹çš„æ–¹å¼å—åˆ°é¢‡å¤šäº‰è®®ã€‚å®žè·µå‘çŽ°,åœ¨æŸäº›æ“ä½œç³»ç»Ÿä¸Š,å°¤ä»¥Linuxä¸ºä¾‹,åº”ç”¨ç¨‹åºå¯¹ä¿¡å·çš„ä½¿ç”¨å’Œæµ‹è¯•å¾ˆä¸åˆ°ä½,è¿˜æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹çš„æœ¬åœ°åº“ä¸éµå®ˆä¿¡å·çº¦å®š,å¯¼è‡´ä¿¡å·å†²çªç­‰äº‹ä»¶çš„å‘ç”Ÿã€‚å› æ­¤,ä¸Žä¿¡å·ç›¸å…³çš„å¤–éƒ¨ä¾èµ–å·²ç»ä¸å†å¯é ã€‚ åˆ†ä»£åžƒåœ¾å›žæ”¶äº‹å®žä¸Š,å°†å †åˆ’åˆ†ä¸ºä¸¤ä¸ªæˆ–å¤šä¸ªç§°ä¸ºä»£(generation)çš„ç©ºé—´,å¹¶åˆ†åˆ«å­˜æ”¾å…·æœ‰ä¸åŒé•¿åº¦ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡,å¯ä»¥æå‡åžƒåœ¾å›žæ”¶çš„æ‰§è¡Œæ•ˆçŽ‡ã€‚åœ¨JRockitä¸­,æ–°åˆ›å»º(young)çš„å¯¹è±¡å­˜æ”¾åœ¨ç§°ä¸ºæ–°ç”Ÿä»£(nursery)çš„ç©ºé—´ä¸­,ä¸€èˆ¬æ¥è¯´,å®ƒçš„å¤§å°ä¼šæ¯”è€å¹´ä»£(old collections)å°å¾ˆå¤š,éšç€åžƒåœ¾å›žæ”¶çš„é‡å¤æ‰§è¡Œ,ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ä¼šè¢«æå‡(promote)åˆ°è€å¹´ä»£ä¸­ã€‚å› æ­¤,æ–°ç”Ÿä»£åžƒåœ¾å›žæ”¶å’Œè€å¹´ä»£åžƒåœ¾å›žæ”¶ä¸¤ç§ä¸åŒçš„åžƒåœ¾å›žæ”¶æ–¹å¼åº”è¿è€Œç”Ÿ,åˆ†åˆ«ç”¨äºŽå¯¹å„è‡ªç©ºé—´ä¸­çš„å¯¹è±¡æ‰§è¡Œåžƒåœ¾å›žæ”¶ã€‚ æ–°ç”Ÿä»£åžƒåœ¾å›žæ”¶çš„é€Ÿåº¦æ¯”è€å¹´ä»£å¿«å‡ ä¸ªæ•°é‡çº§,å³ä½¿æ–°ç”Ÿä»£åžƒåœ¾å›žæ”¶çš„é¢‘çŽ‡æ›´é«˜,æ‰§è¡Œæ•ˆçŽ‡ä¹Ÿä»ç„¶æ¯”è€å¹´ä»£åžƒåœ¾å›žæ”¶å¼º,è¿™æ˜¯å› ä¸ºå¤§å¤šæ•°å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸéƒ½å¾ˆçŸ­,æ ¹æœ¬æ— é¡»æå‡åˆ°è€å¹´ä»£ã€‚ç†æƒ³æƒ…å†µä¸‹,æ–°ç”Ÿä»£åžƒåœ¾å›žæ”¶å¯ä»¥å¤§å¤§æå‡ç³»ç»Ÿçš„åžåé‡,å¹¶æ¶ˆé™¤æ½œåœ¨çš„å†…å­˜ç¢Žç‰‡ã€‚ å†™å±éšœåœ¨å®žçŽ°åˆ†ä»£å¼åžƒåœ¾å›žæ”¶æ—¶,å¤§éƒ¨åˆ†JVMéƒ½æ˜¯ç”¨åä¸ºå†™å±éšœ(write barrier)çš„æŠ€æœ¯æ¥è®°å½•æ‰§è¡Œåžƒåœ¾å›žæ”¶æ—¶éœ€è¦éåŽ†å †çš„å“ªäº›éƒ¨åˆ†ã€‚å½“å¯¹è±¡AæŒ‡å‘å¯¹è±¡Bæ—¶,å³å¯¹è±¡Bæˆä¸ºå¯¹è±¡Açš„å±žæ€§çš„å€¼æ—¶,å°±ä¼šè§¦å‘å†™å±éšœ,åœ¨å®Œæˆå±žæ€§åŸŸèµ‹å€¼åŽæ‰§è¡Œä¸€äº›è¾…åŠ©æ“ä½œã€‚ å†™å±éšœçš„ä¼ ç»Ÿå®žçŽ°æ–¹å¼æ˜¯å°†å †åˆ’åˆ†æˆå¤šä¸ªå°çš„è¿žç»­ç©ºé—´(ä¾‹å¦‚æ¯å—512å­—èŠ‚),æ¯å—ç©ºé—´ç§°ä¸ºå¡ç‰‡(card),äºŽæ˜¯,å †è¢«æ˜ å°„ä¸ºä¸€ä¸ªç²—ç²’åº¦çš„å¡è¡¨(card table)ã€‚å½“Javaåº”ç”¨ç¨‹åºå°†æŸä¸ªå¯¹è±¡èµ‹å€¼ç»™å¯¹è±¡å¼•ç”¨æ—¶,ä¼šé€šè¿‡å†™å±éšœè®¾ç½®è„æ ‡å¿—ä½(dirty bit),å°†è¯¥å¯¹è±¡æ‰€åœ¨çš„å¡ç‰‡æ ‡è®°ä¸ºè„ã€‚ è¿™æ ·,éåŽ†ä»Žè€å¹´ä»£æŒ‡å‘æ–°ç”Ÿä»£çš„å¼•ç”¨æ—¶é—´å¾—ä»¥ç¼©çŸ­,åžƒåœ¾å›žæ”¶å™¨åœ¨åšæ–°ç”Ÿä»£åžƒåœ¾å›žæ”¶æ—¶åªéœ€è¦æ£€æŸ¥è€å¹´ä»£ä¸­è¢«æ ‡è®°ä¸ºè„çš„å¡ç‰‡æ‰€å¯¹åº”çš„å†…å­˜åŒºåŸŸå³å¯ã€‚ JRockitä¸­çš„åžƒåœ¾å›žæ”¶è€å¹´ä»£åžƒåœ¾å›žæ”¶JRockitä¸ä»…å°†å¡è¡¨åº”ç”¨äºŽåˆ†ä»£å¼åžƒåœ¾å›žæ”¶,è¿˜ç”¨åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸæ—¶çš„æ¸…ç†å·¥ä½œ,é¿å…æœç´¢æ•´ä¸ªå­˜æ´»å¯¹è±¡å›¾ã€‚è¿™æ˜¯å› ä¸ºJRockitéœ€è¦æ‰¾å‡ºåœ¨æ‰§è¡Œå¹¶å‘æ ‡è®°æ“ä½œæ—¶,åº”ç”¨ç¨‹åºåˆåˆ›å»ºäº†å“ªäº›å¯¹è±¡ã€‚ä¿®æ”¹å¼•ç”¨å…³ç³»æ—¶é€šè¿‡å†™å±éšœå¯ä»¥æ›´æ–°å¡è¡¨,å­˜æ´»å¯¹è±¡å›¾ä¸­çš„æ¯ä¸ªåŒºåŸŸä½¿ç”¨å¡è¡¨ä¸­çš„ä¸€ä¸ªå¡ç‰‡è¡¨ç¤º,å¡ç‰‡çš„çŠ¶æ€å¯ä»¥æ˜¯å¹²å‡€æˆ–è€…è„,æœ‰æ–°å¯¹è±¡åˆ›å»ºæˆ–è€…å¯¹è±¡å¼•ç”¨å…³ç³»ä¿®æ”¹äº†çš„å¡ç‰‡ä¼šè¢«æ ‡è®°ä¸ºè„ã€‚åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸæ—¶,åžƒåœ¾å›žæ”¶å™¨åªéœ€è¦æ£€æŸ¥é‚£äº›æ ‡è®°ä¸ºè„çš„å¡ç‰‡æ‰€å¯¹åº”çš„å †ä¸­åŒºåŸŸå³å¯,è¿™æ ·å°±å¯ä»¥æ‰¾åˆ°åœ¨å¹¶å‘æ ‡è®°æœŸé—´æ–°åˆ›å»ºçš„å’Œè¢«æ›´æ–°è¿‡å¼•ç”¨å…³ç³»çš„å¯¹è±¡ æ€§èƒ½ä¸Žä¼¸ç¼©æ€§çº¿ç¨‹å±€éƒ¨åˆ†é…åœ¨JRockitä¸­,ä½¿ç”¨äº†åä¸ºçº¿ç¨‹å±€éƒ¨åˆ†é…(thread local allocation)çš„æŠ€æœ¯æ¥å¤§å¹…åŠ é€Ÿå¯¹è±¡çš„åˆ†é…è¿‡ç¨‹ã€‚æ­£å¸¸æƒ…å†µä¸‹,åœ¨çº¿ç¨‹å†…çš„ç¼“å†²åŒºä¸­ä¸ºå¯¹è±¡åˆ†é…å†…å­˜è¦æ¯”ç›´æŽ¥åœ¨éœ€è¦åŒæ­¥æ“ä½œçš„å †ä¸Šåˆ†é…å†…å­˜å¿«å¾—å¤šã€‚åžƒåœ¾å›žæ”¶å™¨åœ¨å †ä¸Šç›´æŽ¥åˆ†é…å†…å­˜æ—¶æ˜¯éœ€è¦å¯¹æ•´ä¸ªå †åŠ é”çš„,å¯¹äºŽå¤šçº¿ç¨‹ç«žäº‰æ¿€çƒˆçš„åº”ç”¨ç¨‹åºæ¥è¯´,è¿™å°†ä¼šæ˜¯ä¸€åœºç¾éš¾ã€‚å› æ­¤,å¦‚æžœæ¯ä¸ªJavaçº¿ç¨‹èƒ½å¤Ÿæœ‰ä¸€å—å±€éƒ¨å¯¹è±¡ç¼“å†²åŒºé‚£ä¹ˆç»å¤§éƒ¨åˆ†çš„å¯¹è±¡åˆ†é…æ“ä½œåªéœ€è¦ç§»åŠ¨ä¸€ä¸‹æŒ‡é’ˆå³å¯å®Œæˆ,åœ¨å¤§å¤šæ•°ç¡¬ä»¶å¹³å°ä¸Š,åªéœ€è¦ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤å°±è¡Œäº†ã€‚è¿™å—è½¬ä¸ºåˆ†é…å¯¹è±¡è€Œä¿ç•™çš„åŒºåŸŸ,å°±ç§°ä¸ºçº¿ç¨‹å±€éƒ¨ç¼“å†²åŒº(thread local area,TLA)ã€‚ ä¸ºäº†æ›´å¥½åœ°åˆ©ç”¨ç¼“å­˜,è¾¾åˆ°æ›´é«˜çš„æ€§èƒ½,ä¸€èˆ¬æƒ…å†µä¸‹,TLAçš„å¤§å°ä»‹äºŽ16KBåˆ°128KBä¹‹é—´,å½“ç„¶,ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ˜¾å¼æŒ‡å®šã€‚å½“TLAè¢«å¡«æ»¡æ—¶,åžƒåœ¾å›žæ”¶å™¨ä¼šå°†TLAä¸­çš„å†…å®¹æå‡åˆ°å †ä¸­ã€‚å› æ­¤,å¯ä»¥å°†TLAçœ‹ä½œæ˜¯çº¿ç¨‹ä¸­çš„æ–°ç”Ÿä»£å†…å­˜ç©ºé—´ã€‚ å½“Javaæºä»£ç ä¸­æœ‰newæ“ä½œç¬¦,å¹¶ä¸”JITç¼–è¯‘å™¨å¯¹å†…å­˜åˆ†é…æ‰§è¡Œé«˜çº§ä¼˜åŒ–ä¹‹åŽ,å†…å­˜åˆ†é…çš„ä¼ªä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011object allocateNewobject(Class objectclass)&#123; Thread current getcurrentThread(): int objectSize=alignedSize(objectclass) if(current.nextTLAOffset+objectSize&gt; TLA_SIZE)&#123; current.promoteTLAToHeap();//æ…¢,è€Œä¸”æ˜¯åŒæ­¥æ“ä½œ current.nextTLAOffset=0; &#125; Object ptr= current.TLAStart+current.nextTLAOffset: current.nextTLAOffset + objectSize; return ptr: &#125; ä¸ºäº†è¯´æ˜Žå†…å­˜åˆ†é…é—®é¡Œ,åœ¨ä¸Šé¢çš„ä¼ªä»£ç ä¸­çœç•¥äº†å¾ˆå¤šå…¶ä»–å…³è”æ“ä½œã€‚ä¾‹å¦‚å¦‚æžœå¾…åˆ†é…çš„å¯¹è±¡éžå¸¸å¤§,è¶…è¿‡äº†æŸä¸ªé˜ˆå€¼,æˆ–å¯¹è±¡å¤ªå¤§å¯¼è‡´æ— æ³•å­˜æ”¾åœ¨TLAä¸­,åˆ™ä¼šç›´æŽ¥åœ¨å †ä¸­ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚ NUMAæž¶æž„NUMA(non-uniform memory access,éžç»Ÿä¸€å†…å­˜è®¿é—®æ¨¡åž‹)æž¶æž„çš„å‡ºçŽ°ä¸ºåžƒåœ¾å›žæ”¶å¸¦æ¥äº†æ›´å¤šæŒ‘æˆ˜ã€‚åœ¨NUMAæž¶æž„ä¸‹,ä¸åŒçš„å¤„ç†å™¨æ ¸å¿ƒé€šå¸¸è®¿é—®å„è‡ªçš„å†…å­˜åœ°å€ç©ºé—´,è¿™æ˜¯ä¸ºäº†é¿å…å› å¤šä¸ªCPUæ ¸å¿ƒè®¿é—®åŒä¸€å†…å­˜åœ°å€é€ æˆçš„æ€»çº¿å»¶è¿Ÿã€‚æ¯ä¸ªCPUæ ¸å¿ƒéƒ½é…æœ‰ä¸“ç”¨çš„å†…å­˜å’Œæ€»çº¿å› æ­¤CPUæ ¸å¿ƒåœ¨è®¿é—®å…¶ä¸“æœ‰å†…å­˜æ—¶é€Ÿåº¦å¾ˆå¿«,è€Œè¦è®¿é—®ç›¸é‚»CPUæ ¸å¿ƒçš„å†…å­˜æ—¶å°±ä¼šç›¸å¯¹æ…¢äº›,CPUæ ¸å¿ƒç›¸è·è¶Šè¿œ,è®¿é—®é€Ÿåº¦è¶Šæ…¢(ä¹Ÿä¾èµ–äºŽå…·ä½“é…ç½®)ä¼ ç»Ÿä¸Š,å¤šæ ¸CPUæ˜¯æŒ‰ç…§UMA(uniform memory access,ç»Ÿä¸€å†…å­˜è®¿é—®æ¨¡åž‹)æž¶æž„è¿è¡Œçš„,æ‰€æœ‰çš„CPUæ ¸å¿ƒæŒ‰ç…§ç»Ÿä¸€çš„æ¨¡å¼æ— å·®åˆ«åœ°è®¿é—®æ‰€æœ‰å†…å­˜ã€‚ ä¸ºäº†æ›´å¥½åœ°åˆ©ç”¨NUMAæž¶æž„,åžƒåœ¾å›žæ”¶å™¨çº¿ç¨‹çš„ç»„ç»‡ç»“æž„åº”è¯¥åšç›¸åº”çš„è°ƒæ•´ã€‚å¦‚æžœæŸä¸ªCPUæ ¸å¿ƒæ­£åœ¨è¿è¡Œæ ‡è®°çº¿ç¨‹,é‚£ä¹ˆè¯¥çº¿ç¨‹æ‰€è¦è®¿é—®çš„é‚£éƒ¨åˆ†å †å†…å­˜æœ€å¥½èƒ½å¤Ÿæ”¾ç½®åœ¨è¯¥CPUçš„ä¸“æœ‰å†…å­˜ä¸­,è¿™æ ·æ‰èƒ½å‘æŒ¥NUMAæž¶æž„çš„æœ€å¤§å¨åŠ›ã€‚åœ¨æœ€åæƒ…å†µä¸‹,å¦‚æžœæ ‡è®°çº¿ç¨‹æ‰€è¦è®¿é—®çš„å¯¹è±¡ä½äºŽå…¶ä»–NUMAèŠ‚ç‚¹çš„ä¸“æœ‰å†…å­˜ä¸­,è¿™æ—¶åžƒåœ¾å›žæ”¶å™¨é€šå¸¸éœ€è¦ä¸€ä¸ªå¯å‘å¼å¯¹è±¡ç§»åŠ¨ç®—æ³•ã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯ä½¿ç”¨æ—¶é—´ä¸Šç›¸è¿‘çš„å¯¹è±¡åœ¨å­˜å‚¨ä½ç½®ä¸Šä¹Ÿèƒ½ç›¸è¿‘,å¦‚æžœè¿™ä¸ªç®—æ³•èƒ½å¤Ÿæ­£ç¡®å·¥ä½œ,è¿˜æ˜¯å¯ä»¥å¸¦æ¥ä¸å°çš„æ€§èƒ½æå‡çš„ã€‚è¿™é‡Œæ‰€é¢ä¸´çš„ä¸»è¦é—®é¢˜æ˜¯å¦‚ä½•é¿å…å¯¹è±¡åœ¨ä¸åŒNUMAèŠ‚ç‚¹çš„ä¸“æœ‰å†…å­˜ä¸­é‡å¤ç§»åŠ¨ã€‚ç†è®ºä¸Š,è‡ªé€‚åº”è¿è¡Œæ—¶ç³»ç»Ÿåº”è¯¥å¯ä»¥å¾ˆå¥½åœ°å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚ å¤§å†…å­˜é¡µå†…å­˜åˆ†é…æ˜¯é€šè¿‡æ“ä½œç³»ç»ŸåŠå…¶æ‰€ä½¿ç”¨çš„é¡µè¡¨å®Œæˆçš„ã€‚æ“ä½œç³»ç»Ÿå°†ç‰©ç†å†…å­˜åˆ’åˆ†æˆå¤šä¸ªé¡µæ¥ç®¡ç†,ä»Žæ“ä½œç³»ç»Ÿå±‚é¢è®²,é¡µæ˜¯å®žé™…åˆ†é…å†…å­˜çš„æœ€å°å•ä½ã€‚ä¼ ç»Ÿä¸Š,é¡µçš„å¤§å°æ˜¯ä»¥4KBä¸ºåŸºæœ¬å•ä½åˆ’åˆ†çš„,é¡µæ“ä½œå¯¹è¿›ç¨‹æ¥è¯´æ˜¯é€æ˜Žçš„,è¿›ç¨‹æ‰€ä½¿ç”¨çš„æ˜¯è™šæ‹Ÿåœ°å€ç©ºé—´,å¹¶éžçœŸæ­£çš„ç‰©ç†åœ°å€ã€‚ä¸ºäº†ä¾¿äºŽå°†è™šæ‹Ÿé¡µé¢è½¬æ¢ä¸ºå®žé™…çš„ç‰©ç†å†…å­˜åœ°å€,å¯ä½¿ç”¨åä¸ºæ—è·¯è½¬æ¢ç¼“å†²(translation lookaside buffer,TLB)çš„ç¼“å­˜æ¥åŠ é€Ÿåœ°å€çš„è½¬æ¢æ“ä½œã€‚ä»Žå®žçŽ°ä¸Šçœ‹,å¦‚æžœé¡µé¢çš„å®¹é‡éžå¸¸å°çš„è¯,ä¼šå¯¼è‡´é¢‘ç¹å‡ºçŽ°æ—è·¯è½¬æ¢ç¼“å†²ä¸¢å¤±çš„æƒ…å†µã€‚ ä¿®å¤è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•å°±æ˜¯å°†é¡µé¢çš„å®¹é‡è°ƒå¤§å‡ ä¸ªæ•°é‡çº§,ä¾‹å¦‚ä»¥MBä¸ºåŸºæœ¬å•ä½ã€‚çŽ°ä»£æ“ä½œç³»ç»Ÿæ™®éå€¾å‘äºŽæ”¯æŒè¿™ç§å¤§å†…å­˜é¡µæœºåˆ¶ã€‚ å¾ˆæ˜Žæ˜¾,å½“å¤šä¸ªè¿›ç¨‹åˆ†åˆ«åœ¨å„è‡ªçš„å¯»å€ç©ºé—´ä¸­åˆ†é…å†…å­˜,è€Œé¡µé¢çš„å®¹é‡åˆæ¯”è¾ƒå¤§æ—¶,éšç€ä½¿ç”¨çš„é¡µé¢æ•°é‡è¶Šæ¥è¶Šå¤š,ç¢Žç‰‡åŒ–çš„é—®é¢˜å°±æ„ˆå‘ä¸¥é‡,åƒè¿›ç¨‹è¦åˆ†é…çš„å†…å­˜æ¯”é¡µé¢å®¹é‡ç¨å¾®å¤§ä¸€ç‚¹çš„æƒ…å†µ,å°±ä¼šæµªè´¹å¾ˆå¤šå­˜å‚¨ç©ºé—´ã€‚å¯¹äºŽåœ¨è¿›ç¨‹å†…è‡ªå·±ç®¡ç†å†…å­˜åˆ†é…å›žæ”¶ã€å¹¶æœ‰å¤§é‡å†…å­˜ç©ºé—´å¯ç”¨çš„è¿è¡Œæ—¶æ¥è¯´,è¿™ä¸ç®—ä»€ä¹ˆé—®é¢˜,å› ä¸ºè¿è¡Œæ—¶å¯ä»¥é€šè¿‡æŠ½è±¡å‡ºä¸åŒå¤§å°çš„è™šæ‹Ÿé¡µé¢æ¥è§£å†³ã€‚ é€šå¸¸æƒ…å†µä¸‹,å¯¹äºŽé‚£äº›å†…å­˜åˆ†é…å’Œå›žæ”¶é¢‘ç¹çš„åº”ç”¨ç¨‹åºæ¥è¯´,ä½¿ç”¨å¤§å†…å­˜é¡µå¯ä»¥ä½¿ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½è‡³å°‘æå‡10%ã€‚ JRockitå¯¹å¤§å†…å­˜é¡µæœ‰å¾ˆå¥½çš„æ”¯æŒã€‚ è¿‘å®žæ—¶åžƒåœ¾å›žæ”¶JRockit Real Timeä½Žå»¶è¿Ÿçš„ä»£ä»·æ˜¯åžƒåœ¾å›žæ”¶æ•´ä½“æ—¶é—´çš„å»¶é•¿ã€‚ç›¸æ¯”äºŽå¹¶è¡Œåžƒåœ¾å›žæ”¶,åœ¨ç¨‹åºè¿è¡Œçš„åŒæ—¶å¹¶å‘åžƒåœ¾å›žæ”¶çš„éš¾åº¦æ›´å¤§,è€Œé¢‘ç¹ä¸­æ–­åžƒåœ¾å›žæ”¶åˆ™å¯èƒ½å¸¦æ¥æ›´å¤šçš„éº»çƒ¦ã€‚äº‹å®žä¸Š,è¿™å¹¶éžä»€ä¹ˆå¤§é—®é¢˜,å› ä¸ºå¤§å¤šæ•°ä½¿ç”¨JRockit Real Timeçš„ç”¨æˆ·æ›´å…³å¿ƒç³»ç»Ÿçš„å¯é¢„æµ‹æ€§,è€Œä¸æ˜¯å‡å°‘åžƒåœ¾å›žæ”¶çš„æ€»ä½“æ—¶é—´ã€‚å¤§å¤šæ•°ç”¨æˆ·è®¤ä¸ºæš‚åœæ—¶é—´çš„çªç„¶å¢žé•¿æ¯”åžƒåœ¾å›žæ”¶æ€»ä½“æ—¶é—´çš„å»¶é•¿æ›´å…·å±å®³æ€§ã€‚ è½¯å®žæ—¶çš„æœ‰æ•ˆæ€§è½¯å®žæ—¶æ˜¯JRockit Real Timeçš„æ ¸å¿ƒæœºåˆ¶ã€‚ä½†éžç¡®å®šæ€§ç³»ç»Ÿå¦‚ä½•æä¾›æŒ‡å®šç¨‹åº¦çš„ç¡®å®šæ€§,ä¾‹å¦‚åƒåžƒåœ¾å›žæ”¶å™¨è¿™æ ·çš„ç³»ç»Ÿå¦‚ä½•ä¿è¯åº”ç”¨ç¨‹åºçš„æš‚åœæ—¶é—´ä¸ä¼šè¶…è¿‡æŸä¸ªé˜ˆå€¼?ä¸¥æ ¼æ¥è¯´,æ— æ³•æä¾›è¿™æ ·çš„ä¿è¯,ä½†ç”±äºŽè¿™æ ·çš„æžç«¯æ¡ˆä¾‹å¾ˆå°‘,æ‰€ä»¥ä¹Ÿå°±æ— å…³ç´§è¦äº†ã€‚ å½“ç„¶,æ²¡æœ‰ä»€ä¹ˆä¸‡å…¨ä¹‹ç­–,ç¡®å®žå­˜åœ¨æ— æ³•ä¿è¯æš‚åœæ—¶é—´çš„åœºæ™¯ã€‚ä½†å®žè·µè¯æ˜Ž,å¯¹äºŽé‚£äº›å †ä¸­å­˜æ´»å¯¹è±¡çº¦å 30%-50%çš„åº”ç”¨ç¨‹åºæ¥è¯´, JRockit Real Timeçš„è¡¨çŽ°å¯ä»¥æ»¡è¶³æœåŠ¡éœ€è¦,è€Œä¸”éšç€JRockit Real Timeå„ä¸ªç‰ˆæœ¬çš„å‘è¡Œ,30%-50%è¿™ä¸ªé˜ˆå€¼åœ¨ä¸æ–­æå‡,å¯æ”¯æŒçš„æš‚åœæ—¶é—´é˜ˆå€¼åˆ™ä¸æ–­é™ä½Žã€‚ å·¥ä½œåŽŸç† é«˜æ•ˆçš„å¹¶è¡Œæ‰§è¡Œ ç»†åˆ†åžƒåœ¾å›žæ”¶è¿‡ç¨‹,å°†ä¹‹å˜æˆå‡ ä¸ªå¯å›žæ»šã€å¯ä¸­æ–­çš„å­ä»»åŠ¡(work packet) é«˜æ•ˆçš„å¯å‘å¼ç®—æ³• äº‹å®žä¸Š,å®žçŽ°ä½Žå»¶è¿Ÿçš„å…³é”®ä»æ˜¯å°½å¯èƒ½å¤šè®©Javaåº”ç”¨ç¨‹åºè¿è¡Œ,ä¿æŒå †çš„ä½¿ç”¨çŽ‡å’Œç¢Žç‰‡åŒ–ç¨‹åº¦åœ¨ä¸€ä¸ªè¾ƒä½Žçš„æ°´å¹³ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Š, JRockit Real Timeä½¿ç”¨çš„æ˜¯è´ªå¿ƒç­–ç•¥,å³å°½å¯èƒ½æŽ¨è¿ŸSTWå¼çš„åžƒåœ¾å›žæ”¶æ“ä½œ,å¸Œæœ›é—®é¢˜èƒ½å¤Ÿç”±åº”ç”¨ç¨‹åºè‡ªèº«è§£å†³,æˆ–è€…èƒ½å¤Ÿå‡å°‘ä¸å¾—ä¸æ‰§è¡ŒSTWå¼æ“ä½œçš„æƒ…å†µ,æœ€å¥½åœ¨å…·ä½“æ‰§è¡Œçš„æ—¶å€™éœ€è¦å¤„ç†çš„å¯¹è±¡ä¹Ÿå°½å¯èƒ½å°‘ä¸€äº›ã€‚ JRockit Real Timeä¸­,åžƒåœ¾å›žæ”¶å™¨çš„å·¥ä½œè¢«åˆ’åˆ†ä¸ºå‡ ä¸ªå­ä»»åŠ¡ã€‚å¦‚æžœåœ¨æ‰§è¡Œå…¶ä¸­æŸä¸ªå­ä»»åŠ¡æ—¶(ä¾‹å¦‚æ•´ç†å †ä¸­çš„æŸä¸€éƒ¨åˆ†å†…å­˜),åº”ç”¨ç¨‹åºçš„æš‚åœæ—¶é—´è¶…è¿‡äº†é˜ˆå€¼,é‚£ä¹ˆå°±æ”¾å¼ƒè¯¥å­ä»»åŠ¡æ¢å¤åº”ç”¨ç¨‹åºçš„æ‰§è¡Œã€‚ç”¨æˆ·æ ¹æ®ä¸šåŠ¡éœ€è¦æŒ‡å®šå¯ç”¨äºŽå®Œæˆåžƒåœ¾å›žæ”¶çš„æ€»ä½“æ—¶é—´,æœ‰äº›æ—¶å€™,æŸäº›å­ä»»åŠ¡å·²ç»å®Œæˆ,ä½†æ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´å®Œæˆæ•´ä¸ªåžƒåœ¾å›žæ”¶å·¥ä½œ,è¿™æ—¶ä¸ºäº†ä¿è¯åº”ç”¨ç¨‹åºçš„è¿è¡Œ,ä¸å¾—ä¸åºŸå¼ƒè¿˜æœªå®Œæˆçš„å­ä»»åŠ¡,å¾…åˆ°ä¸‹æ¬¡åžƒåœ¾å›žæ”¶çš„æ—¶å€™å†é‡æ–°æ‰§è¡Œ,æŒ‡å®šçš„å“åº”æ—¶é—´è¶ŠçŸ­,åˆ™åºŸå¼ƒçš„å­ä»»åŠ¡å¯èƒ½è¶Šå¤šã€‚ å‰é¢ä»‹ç»è¿‡çš„æ ‡è®°é˜¶æ®µçš„å·¥ä½œæ¯”è¾ƒå®¹æ˜“è°ƒæ•´,å¯ä»¥ä¸Žåº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚ä½†æ¸…ç†å’Œæ•´ç†é˜¶æ®µåˆ™éœ€è¦æš‚åœåº”ç”¨ç¨‹åºçº¿ç¨‹(STW)ã€‚å¹¸è¿çš„æ˜¯,æ ‡è®°é˜¶æ®µä¼šå åˆ°åžƒåœ¾å›žæ”¶æ€»ä½“æ—¶é—´çš„90%ã€‚å¦‚æžœæš‚åœåº”ç”¨ç¨‹åºçš„æ—¶é—´è¿‡é•¿,åˆ™ä¸å¾—ä¸ç»ˆæ­¢å½“å‰åžƒåœ¾å›žæ”¶ä»»åŠ¡,é‡æ–°å¹¶å‘æ‰§è¡Œ,æœŸæœ›é—®é¢˜å¯ä»¥è‡ªåŠ¨è§£å†³ã€‚ä¹‹æ‰€ä»¥å°†åžƒåœ¾å›žæ”¶åˆ’åˆ†ä¸ºå‡ ä¸ªå­ä»»åŠ¡å°±æ˜¯ä¸ºäº†ä¾¿äºŽè¿™ä¸€ç›®æ ‡çš„å®žçŽ°ã€‚ å†…å­˜æ“ä½œç›¸å…³APIæžæž„æ–¹æ³• Javaä¸­çš„æžæž„å‡½æ•°çš„è®¾è®¡å°±æ˜¯ä¸€ä¸ªå¤±è¯¯,åº”é¿å…ä½¿ç”¨ã€‚ è¿™ä¸ä»…ä»…æ˜¯æˆ‘ä»¬çš„æ„è§,ä¹Ÿæ˜¯Javaç¤¾åŒºçš„ä¸€è‡´æ„è§ã€‚ JVMçš„è¡Œä¸ºå·®å¼‚å¯¹äºŽJVMæ¥è¯´,ä¸€å®šè°¨è®°,ç¼–ç¨‹è¯­è¨€åªèƒ½æé†’åžƒåœ¾å›žæ”¶å™¨å·¥ä½œã€‚å°±Javaè€Œè¨€,åœ¨è®¾è®¡ä¸Šå®ƒæœ¬èº«å¹¶ä¸èƒ½ç²¾ç¡®æŽ§åˆ¶å†…å­˜ç³»ç»Ÿã€‚ä¾‹å¦‚,å‡è®¾ä¸¤ä¸ªâ…£MåŽ‚å•†æ‰€å®žçŽ°è½¯å¼•ç”¨åœ¨ç¼“å­˜ä¸­å…·æœ‰ç›¸åŒçš„å­˜æ´»æ—¶é—´,è¿™æœ¬å°±æ˜¯ä¸åˆ‡å®žé™…çš„ã€‚ å¦å¤–ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¤§é‡ç”¨æˆ·å¯¹System.gc()æ–¹æ³•çš„é”™è¯¯ä½¿ç”¨ã€‚System.gc()æ–¹æ³•ä»…ä»…æ˜¯æé†’è¿è¡Œæ—¶â€œçŽ°åœ¨å¯ä»¥åšåžƒåœ¾å›žæ”¶äº†â€ã€‚åœ¨æŸäº›JVMå®žçŽ°ä¸­,é¢‘ç¹è°ƒç”¨è¯¥æ–¹æ³•å¯¼è‡´äº†é¢‘ç¹çš„åžƒåœ¾å›žæ”¶æ“ä½œ,è€Œåœ¨æŸäº›JVMå®žçŽ°ä¸­,å¤§éƒ¨åˆ†æ—¶é—´å¿½ç•¥äº†è¯¥è°ƒç”¨ã€‚ æˆ‘è¿‡åŽ»ä»»èŒä¸ºæ€§èƒ½é¡¾é—®æœŸé—´,å¤šæ¬¡çœ‹åˆ°è¯¥æ–¹æ³•è¢«æ»¥ç”¨ã€‚å¾ˆå¤šæ—¶å€™,åªæ˜¯åŽ»æŽ‰å¯¹ System.gcæ–¹æ³•çš„å‡ æ¬¡è°ƒç”¨å°±å¯ä»¥å¤§å¹…æå‡æ€§èƒ½,è¿™ä¹Ÿæ˜¯ JRockä¸­ä¼šæœ‰å‘½ä»¤è¡Œå‚æ•°-xx:AllowSystemGC=Falseæ¥ç¦ç”¨System,gcæ–¹æ³•çš„åŽŸå› ã€‚ é™·é˜±ä¸Žä¼ªä¼˜åŒ–éƒ¨åˆ†å¼€å‘äººå‘˜åœ¨å†™ä»£ç æ—¶,æœ‰æ—¶ä¼šå†™ä¸€äº›â€œç»è¿‡ä¼˜åŒ–çš„â€çš„ä»£ç ,æœŸæœ›å¯ä»¥å¸®åŠ©å®Œæˆåžƒåœ¾å›žæ”¶çš„å·¥ä½œ,ä½†å®žé™…ä¸Š,è¿™åªæ˜¯ä»–ä»¬çš„é”™è§‰ã€‚è®°ä½,è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æºã€‚å°±Javaæ¥è¯´,å¾ˆéš¾åœ¨è¯­è¨€å±‚é¢æŽ§åˆ¶åžƒåœ¾å›žæ”¶çš„è¡Œä¸ºã€‚è¿™é‡Œçš„ä¸»è¦é—®é¢˜æ—¶,å¼€å‘äººå‘˜è¯¯ä»¥ä¸ºåžƒåœ¾å›žæ”¶å™¨æœ‰å›ºå®šçš„è¿è¡Œæ¨¡å¼,å¹¶å¦„å›¾åŽ»æŽ§åˆ¶å®ƒã€‚ é™¤äº†åžƒåœ¾å›žæ”¶å¤–,å¯¹è±¡æ± (object poll)ä¹Ÿæ˜¯Javaä¸­å¸¸è§çš„ä¼ªä¼˜åŒ–(false optimization)ã€‚æœ‰äººè®¤ä¸º,ä¿ç•™ä¸€ä¸ªå­˜æ´»å¯¹è±¡æ± æ¥é‡æ–°ä½¿ç”¨å·²åˆ›å»ºçš„å¯¹è±¡å¯ä»¥æå‡åžƒåœ¾å›žæ”¶çš„æ€§èƒ½,ä½†å®žé™…ä¸Š,å¯¹è±¡æ± ä¸ä»…å¢žåŠ äº†åº”ç”¨ç¨‹åºçš„å¤æ‚åº¦,è¿˜å¾ˆå®¹æ˜“å‡ºé”™ã€‚å¯¹äºŽçŽ°ä»£åžƒåœ¾æ”¶é›†å™¨æ¥è¯´,ä½¿ç”¨java.lang.ref.Referenceç³»åˆ—ç±»å®žçŽ°ç¼“å­˜,æˆ–è€…ç›´æŽ¥å°†æ— ç”¨å¯¹è±¡çš„å¼•ç”¨ç½®ä¸ºnullå°±å¥½äº†,ä¸ç”¨å¤šæ“å¿ƒã€‚ äº‹å®žä¸Š,åŸºäºŽçŽ°ä»£VM,å¦‚æžœèƒ½å¤Ÿåˆç†åˆ©ç”¨ä¹¦æœ¬ä¸Šçš„æŠ€å·§,ä¾‹å¦‚æ­£ç¡®ä½¿ç”¨java.lang.ref.Referenceç³»åˆ—ç±»,æ³¨æ„Javaçš„åŠ¨æ€ç‰¹æ€§,å®Œå…¨å¯ä»¥å†™å‡ºè¿è¡Œè‰¯å¥½çš„åº”ç”¨ç¨‹åºã€‚å¦‚æžœåº”ç”¨ç¨‹åºçœŸçš„æœ‰å®žæ—¶æ€§è¦æ±‚,é‚£ä¹ˆä¸€å¼€å§‹å°±ä¸è¯¥ç”¨Javaç¼–å†™,è€Œåº”è¯¥ä½¿ç”¨é‚£äº›ç”±ç¨‹åºå‘˜æ‰‹åŠ¨æŽ§åˆ¶å†…å­˜çš„é™æ€ç¼–ç¨‹è¯­è¨€æ¥å®žçŽ°åº”ç”¨ç¨‹åºã€‚ JRockitä¸­çš„å†…å­˜ç®¡ç†éœ€è¦æ³¨æ„çš„æ˜¯,èŠ±å¤§åŠ›æ°”é¼“æ£JVMå‚æ•°å¹¶ä¸ä¸€å®šä¼šä½¿åº”ç”¨ç¨‹åºæ€§èƒ½æœ‰å¤šä¹ˆå¤§çš„æå‡,è€Œä¸”åè€Œå¯èƒ½ä¼šå¹²æ‰°JVMçš„æ­£å¸¸è¿è¡Œã€‚ çº¿ç¨‹ä¸ŽåŒæ­¥åŸºæœ¬æ¦‚å¿µæ¯ä¸ªå¯¹è±¡éƒ½æŒæœ‰ä¸ŽåŒæ­¥æ“ä½œç›¸å…³çš„ä¿¡æ¯,ä¾‹å¦‚å½“å‰å¯¹è±¡æ˜¯å¦ä½œä¸ºé”ä½¿ç”¨,ä»¥åŠé”çš„å…·ä½“å®žçŽ°ç­‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹,ä¸ºäº†ä¾¿äºŽå¿«é€Ÿè®¿é—®,è¿™äº›ä¿¡æ¯è¢«ä¿å­˜åœ¨æ¯ä¸ªå¯¹è±¡çš„å¯¹è±¡å¤´çš„é”å­—(lock word)ä¸­ã€‚JRockitä½¿ç”¨é”å­—ä¸­çš„ä¸€äº›ä½æ¥å­˜å‚¨åžƒåœ¾å›žæ”¶çŠ¶æ€ä¿¡æ¯,è™½ç„¶å…¶ä¸­åŒ…å«äº†åžƒåœ¾å›žæ”¶ä¿¡æ¯,ä½†æ˜¯æœ¬ä¹¦è¿˜æ˜¯ç§°ä¹‹ä¸ºé”å­—ã€‚ å¯¹è±¡å¤´è¿˜åŒ…å«äº†æŒ‡å‘ç±»åž‹ä¿¡æ¯çš„æŒ‡é’ˆ,åœ¨ JRockitä¸­,è¿™ç§°ä¸ºç±»å—(class block)ä¸‹å›¾æ˜¯ JRockitä¸­Javaå¯¹è±¡åœ¨ä¸åŒçš„CPUå¹³å°ä¸Šçš„å†…å­˜å¸ƒå±€ã€‚ä¸ºäº†èŠ‚çœå†…å­˜,å¹¶åŠ é€Ÿè§£å¼•ç”¨æ“ä½œ,å¯¹è±¡å¤´ä¸­æ‰€æœ‰å­—çš„é•¿åº¦æ˜¯32ä½ã€‚ç±»å—æ˜¯ä¸€ä¸ª32ä½çš„æŒ‡é’ˆ,æŒ‡å‘å¦ä¸€ä¸ªå¤–éƒ¨ç»“æž„,è¯¥ç»“æž„åŒ…å«äº†å½“å‰å¯¹è±¡çš„ç±»åž‹ä¿¡æ¯å’Œè™šåˆ†æ´¾è¡¨(virtual dispatch table)ç­‰ä¿¡æ¯ã€‚ å°±ç›®å‰æ¥çœ‹,åœ¨ç»å¤§éƒ¨åˆ†JVM(åŒ…æ‹¬JRockit)ä¸­,å¯¹è±¡å¤´æ˜¯ä½¿ç”¨ä¸¤ä¸ª32ä½é•¿çš„å­—æ¥è¡¨ç¤ºçš„ã€‚åœ¨JRockitä¸­,åç§»ä¸º0çš„å¯¹è±¡æŒ‡é’ˆæŒ‡å‘å½“å‰å¯¹è±¡çš„ç±»åž‹ä¿¡æ¯,æŽ¥ä¸‹æ¥æ˜¯4å­—èŠ‚çš„é”å­—ã€‚åœ¨SPARCå¹³å°ä¸Š,å¯¹è±¡å¤´çš„å¸ƒå±€åˆšå¥½åè¿‡æ¥,å› ä¸ºåœ¨ä½¿ç”¨åŽŸå­æŒ‡ä»¤æ“ä½œæŒ‡é’ˆæ—¶,å¦‚æžœæ²¡æœ‰åç§»çš„è¯,æ•ˆçŽ‡ä¼šæ›´é«˜ã€‚ä¸Žé”å­—ä¸åŒ,ç±»å—å¹¶ä¸ä¸ºåŽŸå­æ“ä½œæ‰€ä½¿ç”¨,å› æ­¤åœ¨SPARCå¹³å°ä¸Š,ç±»å—è¢«æ”¾åœ¨é”å­—åŽé¢ã€‚ åŽŸå­æ“ä½œ(atomic operation)æ˜¯æŒ‡å…¨éƒ¨æ‰§è¡Œæˆ–å…¨éƒ¨ä¸æ‰§è¡Œçš„æœ¬åœ°æŒ‡ä»¤ã€‚å½“åŽŸå­æŒ‡ä»¤å…¨éƒ¨æ‰§è¡Œæ—¶,å…¶æ“ä½œç»“æžœéœ€è¦å¯¹æ‰€æœ‰æ½œåœ¨è®¿é—®è€…å¯è§ã€‚ åŽŸå­æ“ä½œç”¨äºŽè¯»å†™é”å­—,å…·æœ‰æŽ’ä»–æ€§,è¿™æ˜¯å®žçŽ°JVMä¸­åŒæ­¥å—çš„åŸºç¡€ã€‚ éš¾ä»¥è°ƒè¯• æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾è‡ªå·±æ‰€éœ€çš„èµ„æº,ç»“æžœå¯¼è‡´ä¸¤ä¸ªçº¿ç¨‹éƒ½è¿›å…¥ä¼‘çœ çŠ¶æ€ã€‚å¾ˆæ˜Žæ˜¾,å®ƒä»¬å†ä¹Ÿé†’ä¸è¿‡æ¥äº†ã€‚æ´»é”çš„æ¦‚å¿µä¸Žæ­»é”ç±»ä¼¼,åŒºåˆ«åœ¨äºŽçº¿ç¨‹åœ¨ç«Ÿäº‰æ—¶ä¼šé‡‡å–ä¸»åŠ¨æ“ä½œ,ä½†æ— æ³•èŽ·å–é”ã€‚è¿™å°±åƒä¸¤ä¸ªäººé¢å¯¹é¢å‰è¿›,åœ¨ä¸€ä¸ªå¾ˆçª„çš„èµ°å»Šç›¸é‡,ä¸ºäº†èƒ½ç»§ç»­å‰è¿›,ä»–ä»¬éƒ½å‘ä¾§é¢ç§»åŠ¨,ä½†ç”±äºŽç§»åŠ¨çš„æ–¹å‘ç›¸åå¯¼è‡´è¿˜æ˜¯æ— æ³•å‰è¿›ã€‚ Java APIsynchronizedå…³é”®å­—åœ¨Javaä¸­,å…³é”®å­—synchronizedç”¨äºŽå®šä¹‰ä¸€ä¸ªä¸´ç•ŒåŒº,æ—¢å¯ä»¥æ˜¯ä¸€æ®µä»£ç å—,ä¹Ÿå¯ä»¥æ˜¯ä¸ªå®Œæ•´çš„æ–¹æ³•,å¦‚ä¸‹æ‰€ç¤º: 123public synchronized void setGadget(Gadget g)&#123; this.gadget = g;&#125; ä¸Šé¢çš„æ–¹æ³•å®šä¹‰ä¸­åŒ…å«synchronizedå…³é”®å­—,å› æ­¤æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ç»™å®šå¯¹è±¡çš„gadgetåŸŸã€‚ åœ¨åŒæ­¥æ–¹æ³•ä¸­,ç›‘è§†å™¨å¯¹è±¡æ˜¯éšå¼çš„,å³å½“å‰å¯¹è±¡this,è€Œå¯¹é™æ€åŒæ­¥æ–¹æ³•æ¥è¯´,ç›‘è§†å™¨å¯¹è±¡æ˜¯å½“å‰å¯¹è±¡çš„ç±»å¯¹è±¡ã€‚ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸Žä¸‹é¢çš„ä»£ç æ˜¯ç­‰æ•ˆçš„ï¼š 12345public void setGadget(Gadget g)&#123; synchronized(this)&#123; this.gadget = g; &#125;&#125; java.lang.Threadç±»Javaä¸­çš„çº¿ç¨‹ä¹Ÿæœ‰ä¼˜å…ˆçº§æ¦‚å¿µ,ä½†æ˜¯å¦çœŸçš„èµ·ä½œç”¨å–å†³äºŽJVMçš„å…·ä½“å®žçŽ°ã€‚setPriorityæ–¹æ³•ç”¨äºŽè®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§,æç¤ºJVMè¯¥çº¿ç¨‹æ›´åŠ é‡è¦æˆ–ä¸æ€Žä¹ˆé‡è¦ã€‚å½“ç„¶,å¯¹äºŽå¤§å¤šæ•°JVMæ¥è¯´,æ˜¾å¼åœ°ä¿®æ”¹çº¿ç¨‹ä¼˜å…ˆçº§æ²¡ä»€ä¹ˆå¤§å¸®åŠ©ã€‚å½“è¿è¡Œæ—¶â€œæœ‰æ›´å¥½çš„æ–¹æ¡ˆâ€æ—¶, JRockit JVMç”šè‡³ä¼šå¿½ç•¥Javaçº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚ æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å¯ä»¥é€šè¿‡è°ƒç”¨yieldæ–¹æ³•ä¸»åŠ¨æ”¾å¼ƒå‰©ä½™çš„æ—¶é—´ç‰‡,ä»¥ä¾¿å…¶ä»–çº¿ç¨‹è¿è¡Œ,è‡ªèº«ä¼‘çœ (è°ƒç”¨waitæ–¹æ³•)æˆ–ç­‰å¾…å…¶ä»–çº¿ç¨‹ç»“æŸå†è¿è¡Œ(è°ƒç”¨joinæ–¹æ³•)ã€‚ volatile å…³é”®å­—åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹,å¯¹æŸä¸ªå±žæ€§åŸŸæˆ–å†…å­˜åœ°å€è¿›è¡Œå†™æ“ä½œåŽ,å…¶ä»–æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æœªå¿…èƒ½ç«‹å³çœ‹åˆ°è¿™ä¸ªç»“æžœã€‚åœ¨æŸäº›åœºæ™¯ä¸­,è¦æ±‚æ‰€æœ‰çº¿ç¨‹åœ¨æ‰§è¡Œæ—¶éœ€è¦å¾—çŸ¥æŸä¸ªå±žæ€§æœ€æ–°çš„å€¼,ä¸ºæ­¤,Javaæä¾›äº†å…³é”®å­—volatileæ¥è§£å†³æ­¤é—®é¢˜ã€‚ ä½¿ç”¨volatileä¿®é¥°å±žæ€§åŽ,å¯ä»¥ä¿è¯å¯¹è¯¥å±žæ€§åŸŸçš„å†™æ“ä½œä¼šç›´æŽ¥ä½œç”¨åˆ°å†…å­˜ä¸­ã€‚åŽŸæœ¬,æ•°æ®æ“ä½œä»…ä»…å°†æ•°æ®å†™åˆ°CPUç¼“å­˜ä¸­,è¿‡ä¸€ä¼šå†å†™åˆ°å†…å­˜ä¸­,æ­£å› å¦‚æ­¤,åœ¨åŒä¸€ä¸ªå±žæ€§åŸŸä¸Š,ä¸åŒçš„çº¿ç¨‹å¯èƒ½çœ‹åˆ°ä¸åŒçš„å€¼ã€‚ç›®å‰,JVMåœ¨å®žçŽ°volatileå…³é”®å­—æ—¶,æ˜¯é€šè¿‡åœ¨å†™å±žæ€§æ“ä½œåŽæ’å…¥å†…å­˜å±éšœä»£ç æ¥å®žçŽ°çš„,åªä¸è¿‡è¿™ç§æ–¹æ³•æœ‰ä¸€ç‚¹æ€§èƒ½æŸè€—ã€‚ äººä»¬å¸¸å¸¸éš¾ä»¥ç†è§£â€œä¸ºä»€ä¹ˆä¸åŒçš„çº¿ç¨‹ä¼šåœ¨åŒä¸€ä¸ªå±žæ€§åŸŸä¸Šçœ‹åˆ°ä¸åŒçš„å€¼â€ã€‚ä¸€èˆ¬æ¥è¯´,ç›®å‰çš„æœºå™¨çš„å†…å­˜æ¨¡åž‹å·²ç»è¶³å¤Ÿå¼º,æˆ–è€…åº”ç”¨ç¨‹åºçš„æœ¬èº«ç»“æž„å°±ä¸å®¹æ˜“ä½¿éžvolatileå±žæ€§å‡ºçŽ°è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯,è€ƒè™‘åˆ°JITä¼˜åŒ–ç¼–è¯‘å™¨å¯èƒ½ä¼šå¯¹ç¨‹åºåšè¾ƒå¤§æ”¹åŠ¨,å¦‚æžœå¼€å‘äººå‘˜ä¸ç•™å¿ƒçš„è¯,è¿˜æ˜¯ä¼šå‡ºçŽ°é—®é¢˜çš„ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç è§£é‡Šäº†åœ¨Javaç¨‹åºä¸­,ä¸ºä»€ä¹ˆå†…å­˜è¯­ä¹‰å¦‚æ­¤é‡è¦,å°¤å…¶æ˜¯å½“é—®é¢˜è¿˜æ²¡è¡¨çŽ°å‡ºæ¥çš„æ—¶å€™ã€‚ 1234567891011public class My Thread extends Thread&#123; private volatile boolean finished; public void run()&#123; while(!finished)&#123; // &#125; &#125; public void signalDone()&#123; this.finished = true &#125;&#125; å¦‚æžœå®šä¹‰å˜é‡finishedæ—¶æ²¡æœ‰åŠ ä¸Švolatileå…³é”®å­—,é‚£ä¹ˆåœ¨ç†è®ºä¸Š,JITç¼–è¯‘å™¨åœ¨ä¼˜åŒ–æ—¶,å¯èƒ½ä¼šå°†ä¹‹ä¿®æ”¹ä¸ºåªåœ¨å¾ªçŽ¯å¼€å§‹å‰åŠ è½½ä¸€æ¬¡finishedçš„å€¼,ä½†è¿™å°±æ”¹å˜äº†ä»£ç åŽŸæœ¬çš„å«ä¹‰å¦‚æžœfinishedçš„å€¼æ˜¯false,é‚£ä¹ˆç¨‹åºå°±ä¼šé™·å…¥æ— é™å¾ªçŽ¯,å³ä½¿å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†signalDoneæ–¹æ³•ä¹Ÿæ²¡ç”¨ã€‚Javaè¯­è¨€è§„èŒƒæŒ‡æ˜Ž,å¦‚æžœç¼–è¯‘å™¨è®¤ä¸ºåˆé€‚çš„è¯,å¯ä»¥ä¸ºéž volatileå˜é‡åœ¨çº¿ç¨‹å†…åˆ›å»ºå‰¯æœ¬ä»¥ä¾¿åŽç»­ä½¿ç”¨ã€‚ ç”±äºŽä¸€èˆ¬ä¼šä½¿ç”¨å†…å­˜å±éšœæ¥å®žçŽ°volatileå…³é”®å­—çš„è¯­ä¹‰,ä¼šå¯¼è‡´CPUç¼“å­˜å¤±æ•ˆ,é™ä½Žåº”ç”¨ç¨‹åºæ•´ä½“æ€§èƒ½,ä½¿ç”¨çš„æ—¶å€™è¦è°¨æ…Žã€‚ Javaä¸­çº¿ç¨‹ä¸ŽåŒæ­¥æœºåˆ¶çš„å®žçŽ°Javaå†…å­˜æ¨¡åž‹çŽ°åœ¨CPUæž¶æž„ä¸­,æ™®éä½¿ç”¨äº†æ•°æ®ç¼“å­˜æœºåˆ¶ä»¥å¤§å¹…æå‡CPUå¯¹æ•°æ®çš„è¯»å†™é€Ÿåº¦,å‡è½»å¤„ç†å™¨æ€»çº¿çš„ç«žäº‰ç¨‹åº¦ã€‚æ­£å¦‚æ‰€æœ‰çš„ç¼“å­˜ç³»ç»Ÿä¸€æ ·,è¿™é‡Œä¹Ÿå­˜åœ¨ä¸€è‡´æ€§é—®é¢˜,å¯¹äºŽå¤šå¤„ç†å™¨ç³»ç»Ÿæ¥è¯´å°¤å…¶é‡è¦,å› ä¸ºå¤šä¸ªå¤„ç†å™¨æœ‰å¯èƒ½åŒæ—¶è®¿é—®å†…å­˜ä¸­åŒä¸€ä½ç½®çš„æ•°æ®å†…å­˜æ¨¡åž‹å®šä¹‰äº†ä¸åŒçš„CPU,åœ¨åŒæ—¶è®¿é—®å†…å­˜ä¸­åŒä¸€ä½ç½®æ—¶,æ˜¯å¦ä¼šçœ‹åˆ°ç›¸åŒçš„å€¼çš„æƒ…å†µã€‚ å¼ºå†…å­˜æ¨¡åž‹(ä¾‹å¦‚x86å¹³å°)æ˜¯æŒ‡,å½“æŸä¸ªCPUä¿®æ”¹äº†æŸä¸ªå†…å­˜ä½ç½®çš„å€¼åŽ,å…¶ä»–çš„CPUå‡ ä¹Žè‡ªåŠ¨å°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªåˆšåˆšä¿å­˜çš„å€¼ã€‚åœ¨è¿™ç§å†…å­˜æ¨¡åž‹ä¹‹ä¸‹,å†…å­˜å†™æ“ä½œçš„æ‰§è¡Œé¡ºåºä¸Žä»£ç ä¸­çš„æŽ’åˆ—é¡ºåºç›¸åŒã€‚å¼±å†…å­˜æ¨¡åž‹(ä¾‹å¦‚IA-64å¹³å°)æ˜¯æŒ‡,å½“æŸä¸ªCPUä¿®æ”¹äº†æŸä¸ªå†…å­˜ä½ç½®çš„å€¼åŽå…¶ä»–çš„CPUä¸ä¸€å®šå¯ä»¥çœ‹åˆ°è¿™ä¸ªåˆšåˆšä¿å­˜çš„å€¼(é™¤éžCPUåœ¨æ‰§è¡Œå†™æ“ä½œæ—¶é™„æœ‰ç‰¹æ®Šçš„å†…å­˜å±éšœç±»æŒ‡ä»¤),æ›´æ™®éä½Žè¯´,æ‰€æœ‰ç”±Javaç¨‹åºå¼•èµ·çš„å†…å­˜è®¿é—®éƒ½åº”è¯¥å¯¹å…¶ä»–æ‰€æœ‰CPUå¯è§,ä½†äº‹å®žä¸Šå´ä¸èƒ½ä¿è¯ç«‹å³å¯è§ã€‚ åŒæ­¥çš„å®žçŽ°åŽŸç”Ÿæœºåˆ¶ä»Žè®¡ç®—æœºæœ€åº•å±‚CPUç»“æž„æ¥è¯´,åŒæ­¥æ˜¯ä½¿ç”¨åŽŸå­æŒ‡ä»¤å®žçŽ°çš„,å„ä¸ªå¹³å°çš„å…·ä½“å®žçŽ°å¯èƒ½æœ‰æ‰€ä¸åŒã€‚ä»¥x86å¹³å°ä¸ºä¾‹,å®ƒä½¿ç”¨äº†ä¸“é—¨çš„é”å‰ç¼€(lock prefix)æ¥å®žçŽ°å¤šå¤„ç†å™¨çŽ¯å¢ƒä¸­æŒ‡ä»¤çš„åŽŸå­æ€§ã€‚ åœ¨å¤§å¤šæ•°CPUæž¶æž„ä¸­,æ ‡å‡†æŒ‡ä»¤(ä¾‹å¦‚åŠ æ³•å’Œå‡æ³•æŒ‡ä»¤)éƒ½å¯ä»¥å®žçŽ°ä¸ºåŽŸå­æŒ‡ä»¤ã€‚ åœ¨å¾®æž¶æž„( micro- architecture)å±‚é¢,åŽŸå­æŒ‡ä»¤çš„æ‰§è¡Œæ–¹å¼åœ¨å„ä¸ªå¹³å°ä¸Šä¸å°½ç›¸åŒã€‚ä¸€èˆ¬æƒ…å†µä¸‹,å®ƒä¼šæš‚åœCPUæµæ°´çº¿çš„æŒ‡ä»¤åˆ†æ´¾,ç›´åˆ°æ‰€æœ‰å·²æœ‰çš„æŒ‡ä»¤éƒ½å®Œæˆæ‰§è¡Œ,å¹¶å°†æ“ä½œç»“æžœåˆ·å…¥åˆ°å†…å­˜ä¸­ã€‚æ­¤å¤–,è¯¥CPUè¿˜ä¼šé˜»æ­¢å…¶ä»–CPUå¯¹ç›¸å…³ç¼“å­˜è¡Œçš„è®¿é—®,ç›´åˆ°è¯¥åŽŸå­æŒ‡ä»¤ç»“æŸæ‰§è¡Œã€‚åœ¨çŽ°ä»£x86ç¡¬ä»¶å¹³å°ä¸Š,å¦‚æžœå±éšœæŒ‡ä»¤(fence instruction)ä¸­æ–­äº†æ¯”è¾ƒå¤æ‚çš„æŒ‡ä»¤æ‰§è¡Œ,åˆ™è¯¥åŽŸå­æŒ‡ä»¤å¯èƒ½éœ€è¦ç­‰ä¸Šå¾ˆå¤šä¸ªæ—¶é’Ÿå‘¨æœŸæ‰èƒ½å®Œæˆæ‰§è¡Œã€‚å› æ­¤,ä¸ä»…æ˜¯è¿‡å¤šçš„ä¸´ç•ŒåŒºä¼šå½±å“ç³»ç»Ÿæ€§èƒ½é”çš„å…·ä½“å®žçŽ°ä¹Ÿä¼šå½±å“æ€§èƒ½,å½“é¢‘ç¹å¯¹è¾ƒå°çš„ä¸´ç•ŒåŒºæ‰§è¡ŒåŠ é”ã€è§£é”æ“ä½œæ—¶,æ€§èƒ½æŸè€—æ›´æ˜¯å·¨å¤§ã€‚ åŒæ­¥åœ¨å­—èŠ‚ç ä¸­çš„å®žçŽ°Javaå­—èŠ‚ç ä¸­æœ‰ä¸¤æ¡ç”¨äºŽå®žçŽ°åŒæ­¥çš„æŒ‡ä»¤,åˆ†åˆ«æ˜¯monitorenterå’Œmonitorexit,å®ƒä»¬éƒ½ä¼šä»Žæ‰§è¡Œæ ˆä¸­å¼¹å‡ºä¸€ä¸ªå¯¹è±¡ä½œä¸ºå…¶æ“ä½œæ•°ã€‚ä½¿ç”¨javacç¼–è¯‘æºä»£ç æ—¶,è‹¥é‡åˆ°æ˜¾å¼ä½¿ç”¨ç›‘è§†å™¨å¯¹è±¡çš„åŒæ­¥ä»£ç ,åˆ™ä¸ºä¹‹ç”Ÿæˆç›¸åº”çš„monitorenteræŒ‡ä»¤å’ŒmonitorexitæŒ‡ä»¤ã€‚ å¯¹äºŽçº¿ç¨‹ä¸ŽåŒæ­¥çš„ä¼˜åŒ–é”è†¨èƒ€ä¸Žé”æ”¶ç¼© é»˜è®¤æƒ…å†µä¸‹, JRockitä½¿ç”¨ä¸€ä¸ªå°çš„è‡ªæ—‹é”æ¥å®žçŽ°åˆšè†¨èƒ€çš„èƒ–é”,åªæŒç»­å¾ˆçŸ­çš„æ—¶é—´ã€‚ä¹çœ‹ä¹‹ä¸‹,è¿™ä¸å¤ªç¬¦åˆå¸¸ç†,ä½†è¿™ä¹ˆåšç¡®å®žæ˜¯å¾ˆæœ‰ç›Šå¤„çš„ã€‚å¦‚æžœé”çš„ç«Ÿäº‰ç¡®å®žéžå¸¸æ¿€çƒˆ,è€Œå¯¼è‡´çº¿ç¨‹é•¿æ—¶é—´è‡ªæ—‹çš„è¯,å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°-XX:UseFatSpin=falseç¦ç”¨æ­¤æ–¹å¼ã€‚ä½œä¸ºèƒ–é”çš„ä¸€éƒ¨åˆ†,è‡ªæ—‹é”ä¹Ÿå¯ä»¥åˆ©ç”¨è‡ªé€‚åº”è¿è¡Œæ—¶èŽ·å–åˆ°çš„åé¦ˆä¿¡æ¯,è¿™éƒ¨åˆ†åŠŸèƒ½é»˜è®¤æ˜¯ç¦ç”¨çš„,å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°-XX:UseAdaptiveFatSpin=trueæ¥å¼€å¯ã€‚ å»¶è¿Ÿè§£é”å¦‚ä½•åˆ†æžå¾ˆå¤šçº¿ç¨‹å±€éƒ¨çš„è§£é”,ä»¥åŠé‡æ–°åŠ é”çš„æ“ä½œåªä¼šé™ä½Žç¨‹åºæ‰§è¡Œæ•ˆçŽ‡?è¿™æ˜¯å¦æ˜¯ç¨‹åºè¿è¡Œçš„å¸¸æ€?è¿è¡Œæ—¶æ˜¯å¦å¯ä»¥å‡è®¾æ¯ä¸ªå•ç‹¬çš„è§£é”æ“ä½œå®žé™…ä¸Šéƒ½æ˜¯ä¸å¿…è¦çš„? å¦‚æžœæŸä¸ªé”æ¯æ¬¡è¢«é‡Šæ”¾åŽåˆç«‹åˆ»éƒ½è¢«åŒä¸€ä¸ªçº¿ç¨‹èŽ·å–,åˆ™è¿è¡Œæ—¶å¯ä»¥åšä¸Šè¿°å‡è®¾ã€‚ä½†åªè¦æœ‰å¦å¤–æŸä¸ªçº¿ç¨‹è¯•å›¾èŽ·å–è¿™ä¸ªçœ‹èµ·æ¥åƒæ˜¯æœªè¢«åŠ é”çš„ç›‘è§†å™¨å¯¹è±¡(è¿™ç§æƒ…å†µæ˜¯ç¬¦åˆè¯­ä¹‰çš„),è¿™ç§å‡è®¾å°±ä¸å†æˆç«‹äº†ã€‚è¿™æ—¶ä¸ºäº†ä½¿è¿™ä¸ªç›‘è§†å™¨å¯¹è±¡çœ‹èµ·æ¥åƒæ˜¯ä¸€åˆ‡æ­£å¸¸,åŽŸæœ¬æŒæœ‰è¯¥ç›‘è§†å™¨å¯¹è±¡çš„çº¿ç¨‹éœ€è¦å¼ºè¡Œé‡Šæ”¾è¯¥é”ã€‚è¿™ç§å®žçŽ°æ–¹å¼ç§°ä¸ºå»¶è¿Ÿè§£é”,åœ¨æŸäº›æè¿°ä¸­ä¹Ÿç§°ä¸ºåå‘é”(biased locking)ã€‚ å³ä½¿æŸä¸ªé”å®Œå…¨æ²¡æœ‰ç«žäº‰,æ‰§è¡ŒåŠ é”å’Œè§£é”æ“ä½œçš„å¼€é”€ä»æ—§æ¯”ä»€ä¹ˆéƒ½ä¸åšè¦å¤§ã€‚è€Œä½¿ç”¨åŽŸå­æŒ‡ä»¤ä¼šä½¿è¯¥æŒ‡ä»¤å‘¨å›´çš„Javaä»£ç éƒ½äº§ç”Ÿé¢å¤–çš„æ‰§è¡Œå¼€é”€ã€‚ ä»Žä»¥ä¸Šå¯ä»¥çœ‹å‡º,å‡è®¾å¤§éƒ¨åˆ†é”éƒ½åªåœ¨çº¿ç¨‹å±€éƒ¨èµ·ä½œç”¨è€Œä¸ä¼šå‡ºçŽ°ç«žäº‰æƒ…å†µ,æ˜¯æœ‰é“ç†çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹,ä½¿ç”¨å»¶è¿Ÿè§£é”çš„ä¼˜åŒ–æ–¹å¼å¯ä»¥æå‡ç³»ç»Ÿæ€§èƒ½ã€‚å½“ç„¶,å¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤,å¦‚æžœæŸä¸ªçº¿ç¨‹è¯•å›¾èŽ·å–æŸä¸ªå·²ç»å»¶è¿Ÿè§£é”ä¼˜åŒ–çš„ç›‘è§†å™¨å¯¹è±¡,è¿™æ—¶çš„æ‰§è¡Œå¼€é”€ä¼šè¢«ç›´æŽ¥èŽ·å–æ™®é€šç›‘è§†å™¨å¯¹è±¡å¤§å¾—å¤š,å› ä¸ºè¿™ä¸ªçœ‹ä¼¼æœªåŠ é”çš„ç›‘è§†å™¨å¯¹è±¡å¿…é¡»è¦å…ˆè¢«å¼ºè¡Œé‡Šæ”¾æŽ‰å› æ­¤,ä¸èƒ½ä¸€ç›´å‡è®¾è§£é”æ“ä½œæ˜¯ä¸å¿…è¦çš„,éœ€è¦å¯¹ä¸åŒçš„è¿è¡Œæ—¶è¡Œä¸ºåšé’ˆå¯¹æ€§çš„ä¼˜åŒ–ã€‚ 1.å®žçŽ° å®žçŽ°å»¶è¿Ÿè§£é”çš„è¯­ä¹‰å…¶å®žå¾ˆç®€å•ã€‚ å®žçŽ° monitorenteræŒ‡ä»¤ã€‚ å¦‚æžœå¯¹è±¡æ˜¯æœªé”å®šçš„,åˆ™åŠ é”æˆåŠŸçš„çº¿ç¨‹å°†ç»§ç»­æŒæœ‰è¯¥é”,å¹¶æ ‡è®°è¯¥å¯¹è±¡ä¸ºå»¶è¿ŸåŠ é”çš„ã€‚ å¦‚æžœå¯¹è±¡å·²ç»è¢«æ ‡è®°ä¸ºå»¶è¿ŸåŠ é”çš„ï¼š å¦‚æžœå¯¹è±¡æ˜¯è¢«åŒä¸€ä¸ªçº¿ç¨‹åŠ é”çš„,åˆ™ä»€ä¹ˆä¹Ÿä¸åš(å¤§ä½“ä¸Šæ˜¯ä¸€ä¸ªé€’å½’é”) å¦‚æžœå¯¹è±¡æ˜¯è¢«å¦ä¸€ä¸ªçº¿ç¨‹åŠ é”çš„,åˆ™æš‚åœè¯¥çº¿ç¨‹å¯¹é”çš„æŒæœ‰çŠ¶æ€,æ£€æŸ¥è¯¥å¯¹è±¡çœŸå®žçš„åŠ é”çŠ¶æ€,å³æ˜¯å·²åŠ é”çš„è¿˜æ˜¯æœªåŠ é”çš„,è¿™ä¸€æ­¥æ“ä½œä»£ä»·é«˜æ˜‚,éœ€è¦éåŽ†è°ƒç”¨æ ˆã€‚å¦‚æžœå¯¹è±¡æ˜¯å·²åŠ é”çš„,åˆ™å°†è¯¥é”è½¬æ¢ä¸ºç˜¦é”,å¦åˆ™å¼ºåˆ¶é‡Šæ”¾è¯¥é”,ä»¥ä¾¿å¯ä»¥è¢«æ–°çº¿ç¨‹èŽ·å–åˆ°ã€‚ å®žçŽ°monitorexitæŒ‡ä»¤:å¦‚æžœæ˜¯å»¶è¿ŸåŠ é”çš„å¯¹è±¡,åˆ™ä»€ä¹ˆä¹Ÿä¸åš,ä¿ç•™å…¶å·²åŠ é”çŠ¶æ€,å³æ‰§è¡Œå»¶è¿Ÿè§£é”ã€‚ ä¸ºäº†èƒ½è§£é™¤çº¿ç¨‹å¯¹é”çš„æŒæœ‰çŠ¶æ€,å¿…é¡»è¦å…ˆæš‚åœè¯¥çº¿ç¨‹çš„æ‰§è¡Œ,è¿™ä¸ªæ“ä½œæœ‰ä¸å°çš„å¼€é”€ã€‚åœ¨é‡Šæ”¾é”ä¹‹åŽ,é”çš„å®žé™…çŠ¶æ€ä¼šé€šè¿‡æ£€æŸ¥çº¿ç¨‹æ ˆä¸­çš„é”ç¬¦å·æ¥ç¡®å®šã€‚å»¶è¿Ÿè§£é”ä½¿ç”¨è‡ªå·±çš„é”ç¬¦å·,ä»¥è¡¨ç¤ºâ€œè¯¥å¯¹è±¡æ˜¯è¢«å»¶è¿Ÿé”å®šçš„â€ã€‚ å¦‚æžœå»¶è¿Ÿé”å®šçš„å¯¹è±¡ä»Žæ¥ä¹Ÿæ²¡æœ‰è¢«æ’¤é”€è¿‡,å³æ‰€æœ‰çš„é”éƒ½åªåœ¨çº¿ç¨‹å±€éƒ¨å†…å‘æŒ¥ä½œç”¨,é‚£ä¹ˆä½¿ç”¨å»¶è¿Ÿé”å®šå°±å¯ä»¥å¤§å¹…æå‡ç³»ç»Ÿæ€§èƒ½ã€‚ä½†åœ¨å®žé™…åº”ç”¨ä¸­,å¦‚æžœæˆ‘ä»¬çš„å‡è®¾ä¸æˆç«‹,è¿è¡Œæ—¶å°±ä¸å¾—ä¸ä¸€éåˆä¸€éåœ°é‡Šæ”¾å·²ç»è¢«å»¶è¿ŸåŠ é”çš„å¯¹è±¡,è¿™ç§æ€§èƒ½æ¶ˆè€—å®žåœ¨æ‰¿å—ä¸èµ·ã€‚å› æ­¤,è¿è¡Œæ—¶éœ€è¦è®°å½•ä¸‹ç›‘è§†å™¨å¯¹è±¡è¢«ä¸åŒçº¿ç¨‹èŽ·å–åˆ°çš„æ¬¡æ•°,è¿™éƒ¨åˆ†ä¿¡æ¯å­˜å‚¨åœ¨ç›‘è§†å™¨å¯¹è±¡çš„é”å­—ä¸­,ç§°ä¸ºè½¬ç§»ä½(transfer bit)ã€‚ å¦‚æžœç›‘è§†å™¨å¯¹è±¡åœ¨ä¸åŒçš„çº¿ç¨‹ä¹‹é—´è½¬ç§»çš„æ¬¡æ•°è¿‡å¤š,é‚£ä¹ˆè¯¥å¯¹è±¡ã€å…¶ç±»å¯¹è±¡æˆ–è€…å…¶ç±»çš„æ‰€æœ‰å®žä¾‹éƒ½å¯èƒ½ä¼šè¢«ç¦ç”¨å»¶è¿ŸåŠ é”,åªä¼šä½¿ç”¨æ ‡å‡†çš„èƒ–é”å’Œç˜¦é”æ¥å¤„ç†åŠ é”æˆ–è§£é”æ“ä½œã€‚ æ­£å¦‚ä¹‹å‰ä»‹ç»è¿‡çš„,å¯¹è±¡é¦–å…ˆæ˜¯æœªåŠ é”çŠ¶æ€çš„,ç„¶åŽçº¿ç¨‹T1æ‰§è¡ŒmonitorenteræŒ‡ä»¤,ä½¿ä¹‹è¿›å…¥å»¶è¿ŸåŠ é”çŠ¶æ€ã€‚ä½†å¦‚æžœçº¿ç¨‹T1åœ¨è¯¥å¯¹è±¡ä¸Šæ‰§è¡Œäº†monitorexitæŒ‡ä»¤,è¿™æ—¶ç³»ç»Ÿä¼šå‡è£…å·²ç»è§£é”äº†,ä½†å®žé™…ä¸Šä»æ˜¯é”å®šçŠ¶æ€,é”å¯¹è±¡çš„é”å­—ä¸­ä»è®°å½•ç€çº¿ç¨‹T1çš„çº¿ç¨‹IDã€‚åœ¨æ­¤ä¹‹åŽçº¿ç¨‹T1å¦‚æžœå†æ‰§è¡ŒåŠ é”æ“ä½œ,å°±ä¸ç”¨å†æ‰§è¡Œç›¸å…³æ“ä½œäº†ã€‚ å¦‚æžœå¦ä¸€ä¸ªçº¿ç¨‹T2è¯•å›¾èŽ·å–åŒä¸€ä¸ªé”,åˆ™ä¹‹å‰æ‰€åšâ€œè¯¥é”ç»å¤§éƒ¨åˆ†è¢«çº¿T1ç¨‹ä½¿ç”¨â€çš„å‡è®¾ä¸å†æˆç«‹,ä¼šå—åˆ°æ€§èƒ½æƒ©ç½š,å°†é”å­—ä¸­çš„çº¿ç¨‹IDç”±çº¿ç¨‹T1çš„IDæ›¿æ¢ä¸ºçº¿ç¨‹T2çš„ã€‚å¦‚æžœè¿™æƒ…å†µç»å¸¸å‡ºçŽ°,é‚£ä¹ˆå¯èƒ½ä¼šç¦ç”¨è¯¥å¯¹è±¡ä½œä¸ºå»¶è¿Ÿé”,å¹¶å°†è¯¥å¯¹è±¡ä½œä¸ºæ™®é€šçš„ç˜¦é”ä½¿ç”¨ã€‚ é™·é˜±ä¸Žä¼ªä¼˜åŒ–Thread.stopã€Thread.resumeå’ŒThread.suspendæ°¸è¿œä¸è¦ä½¿ç”¨Thread.stopæ–¹æ³•ã€Thread.resumeæ–¹æ³•æˆ–Thread.suspendæ–¹æ³•å¹¶å°å¿ƒå¤„ç†ä½¿ç”¨è¿™äº›æ–¹æ³•çš„åŽ†å²é—ç•™ä»£ç ã€‚ æ™®éå»ºè®®ä½¿ç”¨waitæ–¹æ³•ã€notifyæ–¹æ³•æˆ–volatileå˜é‡æ¥åšçº¿ç¨‹é—´çš„åŒæ­¥å¤„ç†ã€‚ åŒæ£€æŸ¥é”å¦‚æžœå¯¹å†…å­˜æ¨¡åž‹å’ŒCPUæž¶æž„ç¼ºä¹ç†è§£çš„è¯,å³ä½¿ä½¿ç”¨å¹³é‡åˆ°é—®é¢˜ã€‚ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹,å…¶ç›®çš„æ˜¯å®žçŽ°å•ä¾‹æ¨¡å¼ã€‚ 123456789public class Gadget Holder&#123; private Gadget theGadget; public synchronized Gadget cetGadget()&#123; if (this.theGadget == null)&#123; this.theGadget = new Gadget(); &#125; return this.theGadget; &#125;&#125; ä¸Šé¢çš„ä»£ç æ˜¯çº¿ç¨‹å®‰å…¨çš„,å› ä¸ºgetGadgetæ–¹æ³•æ˜¯åŒæ­¥ä½†å½“Gadgetç±»çš„æž„é€ å‡½æ•°å·²ç»æ‰§è¡Œè¿‡ä¸€æ¬¡ä¹‹åŽ,å†æ‰§è¡ŒåŒä¼˜åŒ–æ€§èƒ½,å°†ä¹‹æ”¹é€ ä¸ºä¸‹é¢çš„ä»£ç ã€‚ 12345678910public Gadget getGadget()&#123; if (this.theGadget == null)&#123; synchronized(this)&#123; if(this.theGadget == null))&#123; this.theGadget = new Gadget(); &#125; &#125; &#125; return this.theGadget;&#125; ä¸Šé¢çš„ä»£ç ä½¿ç”¨äº†ä¸€ä¸ªçœ‹èµ·æ¥å¾ˆâ€œèªæ˜Žâ€çš„æŠ€å·§,å¦‚æžœè¡ŒåŒæ­¥æ“ä½œ,è€Œæ˜¯ç›´æŽ¥è¿”å›žå·²æœ‰çš„å¯¹è±¡;å¦‚æžœå¯¹è±¡è¿˜æœªåˆ›å»ºå€¼ã€‚è¿™æ ·å¯ä»¥ä¿è¯â€œçº¿ç¨‹å®‰å…¨â€ã€‚ ä¸Šè¿°ä»£ç å°±æ˜¯æ‰€è°“çš„åŒæ£€æŸ¥é”(double checked locking),ä¸‹é¢åˆ†æžä¸€ä¸‹è¿™æ®µä»£ç çš„é—®é¢˜ã€‚å‡è®¾æŸä¸ªçº¿ç¨‹ç»è¿‡å†…å±‚çš„ç©ºå€¼æ£€æŸ¥,å¼€å§‹åˆå§‹åŒ–theGadgetå­—æ®µçš„å€¼,è¯¥çº¿ç¨‹éœ€è¦ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜,å¹¶å¯¹theGadgetå­—æ®µèµ‹å€¼ã€‚å¯æ˜¯,è¿™ä¸€ç³»åˆ—æ“ä½œå¹¶ä¸æ˜¯åŽŸå­çš„,ä¸”æ‰§è¡Œé¡ºåºæ— æ³•ä¿è¯ã€‚å¦‚æžœåœ¨æ­¤æ—¶æ­£å¥½å‘ç”Ÿçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢,åˆ™å¦ä¸€ä¸ªçº¿ç¨‹çœ‹åˆ°çš„theGadgetå­—æ®µçš„å€¼å¯èƒ½æ˜¯æœªç»å®Œæ•´åˆå§‹åŒ–çš„,æœ‰å¯èƒ½ä¼šå¯¼è‡´å¤–å±‚çš„æŽ§åˆ¶æ£€æŸ¥å¤±æ•ˆ,å¹¶è¿”å›žè¿™ä¸ªæœªç»å®Œæ•´åˆå§‹åŒ–çš„å¯¹è±¡ã€‚ä¸ä»…ä»…æ˜¯åˆ›å»ºå¯¹è±¡å¯èƒ½ä¼šå‡ºé—®é¢˜,å¤„ç†å…¶ä»–ç±»åž‹æ•°æ®æ—¶ä¹Ÿè¦å°å¿ƒã€‚ä¾‹å¦‚,åœ¨32ä½å¹³å°ä¸Š,å†™å…¥ä¸€ä¸ªlongåž‹æ•°æ®é€šå¸¸éœ€è¦æ‰§è¡Œä¸¤æ¬¡32ä½æ•°æ®çš„å†™æ“ä½œ,è€Œå†™å…¥intæ•°æ®åˆ™æ— æ­¤é¡¾è™‘ã€‚ ä¸Šè¿°é—®é¢˜å¯ä»¥é€šè¿‡å°† theGadgetå­—æ®µå£°æ˜Žä¸º volatileæ¥è§£å†³(æ³¨æ„,åªåœ¨æ–°ç‰ˆæœ¬çš„å†…å­˜æ¨¡åž‹ä¸‹æ‰æœ‰æ•ˆ),å¢žåŠ çš„æ‰§è¡Œå¼€é”€å°½ç®¡æ¯”ä½¿ç”¨synchronizedæ–¹æ³•çš„å°,ä½†è¿˜æ˜¯æœ‰çš„ã€‚å¦‚æžœä¸ç¡®å®šå½“å‰ç‰ˆæœ¬çš„å†…å­˜æ¨¡åž‹æ˜¯å¦å®žçŽ°æ­£ç¡®,ä¸è¦ä½¿ç”¨åŒæ£€æŸ¥é”ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« ä»‹ç»äº†ä¸ºä»€ä¹ˆä¸åº”è¯¥ä½¿ç”¨åŒæ£€æŸ¥é”,ä¸ä»…é™äºŽJava,å…¶ä»–è¯­è¨€ä¹Ÿæ˜¯ã€‚ åŒæ£€æŸ¥é”çš„å±é™©ä¹‹å¤„åœ¨äºŽ,åœ¨å¼ºå†…å­˜æ¨¡åž‹ä¸‹,å®ƒå¾ˆå°‘ä¼šä½¿ç¨‹åºå´©æºƒã€‚Intel IA-64å¹³å°å°±æ˜¯ä¸ªå…¸åž‹ç¤ºä¾‹,å…¶å¼±å†…å­˜æ¨¡åž‹è‡­åè¿œæ‰¬,åŽŸæœ¬å¥½å¥½è¿è¡Œçš„Javaåº”ç”¨ç¨‹åºå´å‡ºçŽ°æ•…éšœã€‚å¦‚æžœæŸä¸ªåº”ç”¨ç¨‹åºåœ¨x86å¹³å°è¿è¡Œè‰¯å¥½,åœ¨x64å¹³å°å´å‡ºé—®é¢˜,äººä»¬å¾ˆå®¹æ˜“æ€€ç–‘æ˜¯JVMçš„bug,å´å¿½è§†äº†æœ‰å¯èƒ½æ˜¯Javaåº”ç”¨ç¨‹åºè‡ªèº«çš„é—®é¢˜ã€‚ ä½¿ç”¨é™æ€å±žæ€§æ¥å®žçŽ°å•ä¾‹æ¨¡å¼å¯ä»¥å®žçŽ°åŒæ ·çš„è¯­ä¹‰,è€Œæ— é¡»ä½¿ç”¨åŒæ£€æŸ¥é”,å¦‚ä¸‹æ‰€ç¤º: 123public class GadgetMaker&#123; public static Gadget theGadget= new Gadget();&#125; Javaè¯­è¨€ä¿è¯ç±»çš„åˆå§‹åŒ–æ˜¯åŽŸå­æ“ä½œ, GadgetMakerç±»ä¸­æ²¡æœ‰å…¶ä»–çš„åŸŸ,å› æ­¤,åœ¨é¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨è¯¥ç±»æ—¶ä¼šè‡ªåŠ¨åˆ›å»º Gadgetç±»çš„å®žä¾‹ã€‚å¹¶èµ‹å€¼ç»™theGadgetå­—æ®µã€‚è¿™ç§æ–¹æ³•åœ¨æ–°æ—§ä¸¤ç§å†…å­˜æ¨¡åž‹ä¸‹å‡å¯æ­£å¸¸å·¥ä½œã€‚ æ€»ä¹‹,ä½¿ç”¨Javaåšå¹¶è¡Œç¨‹åºå¼€å‘æœ‰å¾ˆå¤šéœ€è¦å°å¿ƒçš„åœ°æ–¹,å¦‚æžœèƒ½å¤Ÿæ­£ç¡®ç†è§£Javaå†…å­˜æ¨¡åž‹é‚£ä¹ˆæ˜¯å¯ä»¥é¿å¼€è¿™äº›é™·é˜±çš„ã€‚å¼€å‘äººå‘˜å¾€å¾€ä¸å¤ªå…³å¿ƒå½“å‰çš„ç¡¬ä»¶æž¶æž„,ä½†å¦‚æžœä¸èƒ½ç†è§£Javaå†…å­˜æ¨¡åž‹,è¿Ÿæ—©ä¼šæ¬èµ·çŸ³å¤´ç ¸è‡ªå·±çš„è„šã€‚ åŸºå‡†æµ‹è¯•ä¸Žæ€§èƒ½è°ƒä¼˜waitæ–¹æ³•ã€notifyæ–¹æ³•ä¸Žèƒ–é”Javaå¹¶éžä¸‡èƒ½çš„Javaæ˜¯ä¸€é—¨å¼ºå¤§çš„é€šç”¨ç¼–ç¨‹è¯­è¨€,å› å…¶å‹å¥½çš„è¯­ä¹‰å’Œå†…å»ºçš„å†…çš„å¼€å‘è¿›åº¦,ä½†Javaä¸æ˜¯ä¸‡èƒ½çš„,è¿™é‡Œæ¥è°ˆè°ˆä¸å®œä½¿ç”¨Javaè§£å†³çš„åœºæ™¯ï¼š è¦å¼€å‘ä¸€ä¸ªæœ‰è¿‘å®žæ—¶æ€§è¦æ±‚çš„ç”µä¿¡åº”ç”¨ç¨‹åº,å¹¶ä¸”å…¶ä¸­ä¼šæœ‰å…¶ä¸­ä¼šæœ‰æˆåƒä¸Šä¸‡çš„çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚ åº”ç”¨ç¨‹åºçš„æ•°æ®åº“å±‚æ‰€è¿”å›žçš„æ•°æ®ç»å¸¸æ˜¯20MBçš„å­—èŠ‚æ•°ç»„ã€‚ åº”ç”¨ç¨‹åºæ€§èƒ½å’Œè¡Œä¸ºçš„ç¡®å®šæ€§,å®Œå…¨ä¾èµ–äºŽåº•å±‚æ“ä½œç³»ç»Ÿçš„è°ƒåº¦å™¨ï¼Œå³ä½¿è°ƒåº¦å™¨æœ‰å¾®å°å˜åŒ–ä¹Ÿä¼šå¯¹åº”ç”¨ç¨‹åºæ€§èƒ½äº§ç”Ÿè¾ƒå¤§å½±å“ã€‚ å¼€å‘è®¾å¤‡é©±åŠ¨ç¨‹åºã€‚ ä½¿ç”¨ C/Fortran/COBOLç­‰è¯­è¨€å¼€å‘çš„åŽ†å²é—ç•™ä»£ç å¤ªå¤š,ç›®å‰å›¢é˜Ÿæ‰‹ä¸­è¿˜æ²¡æœ‰å¥½ç”¨çš„å·¥å…·å¯ä»¥å°†è¿™äº›ä»£ç è½¬æ¢ä¸ºJavaä»£ç ã€‚ é™¤äº†ä¸Šé¢çš„ç¤ºä¾‹å¤–,è¿˜æœ‰å…¶ä»–å¾ˆå¤šåœºæ™¯ä¸é€‚å®œä½¿ç”¨Javaã€‚é€šè¿‡JvMå¯¹åº•å±‚æ“ä½œç³»ç»Ÿçš„æŠ½è±¡Javaå®žçŽ°äº†â€œä¸€æ¬¡ç¼–å†™,åˆ°å¤„è¿è¡Œâ€,ä¹Ÿå› æ­¤å—åˆ°äº†å¹¿æ³›å…³æ³¨ã€‚ä½†å¤¸å¤§ä¸€ç‚¹è¯´,ANSI Cä¹Ÿèƒ½åšåˆ°è¿™ä¸€ç‚¹,åªä¸è¿‡åœ¨ç¼–å†™æºä»£ç æ—¶,è¦èŠ±å¾ˆå¤šç²¾åŠ›æ¥åº”å¯¹å¯ç§»æ¤æ€§é—®é¢˜ã€‚å› æ­¤è¦ç»“åˆå®žé™…åœºæ™¯é€‰æ‹©åˆé€‚çš„å·¥å…·ã€‚Javaæ˜¯å¥½ç”¨,ä½†ä¹Ÿä¸è¦æ»¥ç”¨ã€‚ PDFä¹¦ç±ä¸‹è½½åœ°å€ï¼šhttps://github.com/jiankunking/books-recommendation/tree/master/Java]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>GC</tag>
        <tag>JVM</tag>
        <tag>JRockit</tag>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£JVMï¼†G1GC ç¬”è®°]]></title>
    <url>%2Fjava-jvm-gc-g1-note.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ•´ç†è‡ªï¼šã€Šæ·±å…¥ç†è§£JVMï¼†G1GCã€‹ ä½œè€…ï¼šå‘¨æ˜Žè€€æœ¬ä¹¦å¾ˆä¸€èˆ¬å‡ºç‰ˆæ—¶é—´ï¼š2017-06-01 JVM GCåŸºæœ¬çŸ¥è¯†å¼•è¨€G1å†…éƒ¨ä¸»è¦æœ‰å››ä¸ªæ“ä½œé˜¶æ®µï¼š å¹´è½»ä»£å›žæ”¶(A Young Collection) è¿è¡Œåœ¨åŽå°çš„å¹¶è¡Œå¾ªçŽ¯(A Background,Concurrent Cycle) æ··åˆå›žæ”¶(A Mixed Collection) å…¨é‡å›žæ”¶(A Full GC) åŸºæœ¬æœ¯è¯­Javaç›¸å…³æœ¯è¯­Interned Stringsåœ¨Javaè¯­è¨€ä¸­æœ‰8ç§åŸºæœ¬ç±»åž‹å’Œä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„ç±»åž‹ Stringè¿™äº›ç±»åž‹ä¸ºäº†ä½¿å®ƒä»¬åœ¨è¿è¡Œè¿‡ç¨‹ä¸­é€Ÿåº¦æ›´å¿«ã€æ›´èŠ‚çœå†…å­˜,éƒ½æä¾›äº†ä¸€ç§å¸¸é‡æ± çš„æ¦‚å¿µã€‚å¸¸é‡æ± å°±ç±»ä¼¼ä¸€ä¸ªJavaç³»ç»Ÿçº§åˆ«æä¾›çš„ç¼“å­˜ã€‚8ç§åŸºæœ¬ç±»åž‹çš„å¸¸é‡æ± éƒ½æ˜¯ç³»ç»Ÿåè°ƒçš„,Stringç±»åž‹çš„å¸¸é‡æ± æ¯”è¾ƒç‰¹æ®Šã€‚å®ƒçš„ä¸»è¦ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§ã€‚ ç›´æŽ¥ä½¿ç”¨åŒå¼•å·å£°æ˜Žå‡ºæ¥çš„Stringå¯¹è±¡ä¼šç›´æŽ¥å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ å¦‚æžœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜Žçš„Stringå¯¹è±¡,å¯ä»¥ä½¿ç”¨Stringæä¾›çš„Internæ–¹æ³•ã€‚ internæ–¹æ³•ä¼šä»Žå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æŸ¥è¯¢å½“å‰å­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨,è‹¥ä¸å­˜åœ¨å°±ä¼šå°†å½“å‰å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± ä¸­ã€‚ é€šä¿—ç‚¹è®²,Interned Stringå°±æ˜¯ç¡®ä¿å­—ç¬¦ä¸²åœ¨å†…å­˜é‡Œåªæœ‰ä¸€ä»½æ‹·è´,è¿™æ ·å¯ä»¥èŠ‚çº¦å†…å­˜ç©ºé—´,åŠ å¿«å­—ç¬¦ä¸²æ“ä½œä»»åŠ¡çš„æ‰§è¡Œé€Ÿåº¦ã€‚æ³¨æ„,è¿™ä¸ªå€¼ä¼šè¢«å­˜æ”¾åœ¨å­—ç¬¦ä¸²å†…éƒ¨æ± (String Intern Pool)ã€‚ Java 7ä¸­Oracleçš„å·¥ç¨‹å¸ˆå¯¹å­—ç¬¦ä¸²æ± çš„é€»è¾‘åšäº†å¾ˆå¤§çš„æ”¹å˜,å³å°†å­—ç¬¦ä¸²æ± çš„ä½ç½®è°ƒæ•´åˆ°Javaå †å†…,è¿™ä¸ªæ”¹åŠ¨æ„å‘³ç€ä½ å†ä¹Ÿä¸ä¼šè¢«å›ºå®šçš„å†…å­˜ç©ºé—´é™åˆ¶äº†ã€‚æ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½ä¿å­˜åœ¨å †(Heap)ä¸­,å’Œå…¶ä»–æ™®é€šå¯¹è±¡ä¸€æ ·,è¿™æ ·å¯ä»¥è®©ä½ åœ¨è¿›è¡Œè°ƒä¼˜åº”ç”¨æ—¶ä»…éœ€è¦è°ƒæ•´å †å¤§å°å°±å¯ä»¥äº†ã€‚å­—ç¬¦ä¸²æ± æ¦‚å¿µåŽŸæœ¬ä½¿ç”¨å¾—æ¯”è¾ƒå¤š,ä½†æ˜¯è¿™ä¸ªæ”¹åŠ¨ä½¿å¾—æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ç†ç”±è®©æˆ‘ä»¬é‡æ–°è€ƒè™‘åœ¨Java7ä¸­ä½¿ç”¨ String intern()ã€‚ Java å¯¹è±¡å¤´åœ¨HotSpotè™šæ‹Ÿæœºä¸­,å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€å¯ä»¥åˆ†æˆå¯¹è±¡å¤´ã€å®žä¾‹æ•°æ®ã€å¯¹é½å¡«å……ä¸‰éƒ¨åˆ†ã€‚ å¯¹è±¡å¤´:å®ƒä¸»è¦åŒ…æ‹¬å¯¹è±¡è‡ªèº«çš„è¿è¡Œè¡Œå…ƒæ•°æ®,æ¯”å¦‚å“ˆå¸Œç ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ç­‰,åŒæ—¶è¿˜åŒ…å«ä¸€ä¸ªç±»åž‹æŒ‡é’ˆ,æŒ‡å‘ç±»å…ƒæ•°æ®,è¡¨æ˜Žè¯¥å¯¹è±¡æ‰€å±žçš„ç±»åž‹ã€‚ å®žä¾‹æ•°æ®:å®ƒæ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯,åŒ…æ‹¬ç¨‹åºä»£ç ä¸­å®šä¹‰çš„å„ç§ç±»åž‹çš„å­—æ®µ(åŒ…æ‹¬ä»Žçˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å’Œæœ¬èº«æ‹¥æœ‰çš„å­—æ®µ)ã€‚ å¯¹é½å¡«å……:å®ƒä¸æ˜¯å¿…è¦å­˜åœ¨çš„,ä»…ä»…èµ·ç€å ä½ç¬¦çš„ä½œç”¨ å¯¹è±¡å¤´å¤§å°åœ¨32ä½HotSpot VMå’Œ64ä½ HotSpot VMä¹‹é—´æ˜¯ä¸ä¸€æ ·çš„,å¯¹è±¡å¤´åœ¨32ä½ç³»ç»Ÿä¸Šå ç”¨8yte,åœ¨64ä½ç³»ç»Ÿä¸Šå ç”¨16yteã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡Javaå¯¹è±¡å¸ƒå±€å·¥å…·èŽ·å–å¤´å¤§å°,è¿™ä¸ªå·¥å…·ç®€ç§°ä¸ºJOLã€‚ G1 æ¶‰åŠæœ¯è¯­MetaspaceJDK8 HotSpot JVMä½¿ç”¨æœ¬åœ°å†…å­˜æ¥å­˜å‚¨ç±»å…ƒæ•°æ®ä¿¡æ¯å¹¶ç§°ä¸ºå…ƒç©ºé—´(Metaspace)ã€‚ é»˜è®¤æƒ…å†µä¸‹,å¤§éƒ¨åˆ†ç±»å…ƒæ•°æ®éƒ½åœ¨æœ¬åœ°å†…å­˜ä¸­åˆ†é…,ç±»å…ƒæ•°æ®åªå—å¯ç”¨çš„æœ¬åœ°å†…å­˜é™åˆ¶(å®¹é‡å–å†³äºŽæ˜¯32ä½æˆ–æ˜¯64ä½æ“ä½œç³»ç»Ÿçš„å¯ç”¨è™šæ‹Ÿå†…å­˜å¤§å°)ã€‚æ–°å‚æ•°(MaxMetaspace Size)ç”¨äºŽé™åˆ¶æœ¬åœ°å†…å­˜åˆ†é…ç»™ç±»å…ƒæ•°æ®çš„å¤§å°ã€‚å¦‚æžœæ²¡æœ‰æŒ‡å®šè¿™ä¸ªå‚æ•°,å…ƒç©ºé—´ä¼šåœ¨è¿è¡Œæ—¶æ ¹æ®éœ€è¦åŠ¨æ€è°ƒæ•´ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹,é€‚æ—¶åœ°ç›‘æŽ§å’Œè°ƒæ•´å…ƒç©ºé—´å¯¹äºŽå‡å°åžƒåœ¾å›žæ”¶é¢‘çŽ‡å’Œå‡å°‘å»¶æ—¶æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚æŒç»­çš„å…ƒç©ºé—´åžƒåœ¾å›žæ”¶æƒ…å†µå¦‚æžœé¢‘ç¹å‘ç”Ÿ,è¯´æ˜Žå¯èƒ½å­˜åœ¨ç±»ã€ç±»åŠ è½½å™¨å¯¼è‡´çš„å†…å­˜æ³„æ¼æˆ–æ˜¯å¤§å°è®¾ç½®ä¸åˆé€‚ã€‚ G1 GCä¸ŽMetaspaceç›¸å…³çš„é€‰é¡¹å¦‚ä¸‹ï¼š -XX:MetaspaceSize:åˆå§‹åŒ–å…ƒç©ºé—´çš„å¤§å°(é»˜è®¤12 Mbytesåœ¨32bit client VM and 16 Mbytesåœ¨32bit server VM,åœ¨64 bit VMä¸Šä¼šæ›´å¤§äº›)ã€‚ -XX:MaxMetaspaceSize:æœ€å¤§å…ƒç©ºé—´çš„å¤§å°(é»˜è®¤æœ¬åœ°å†…å­˜)ã€‚ -XX:MinMetaspaceFreeRatio:æ‰©å¤§ç©ºé—´çš„æœ€å°æ¯”çŽ‡,å½“GCåŽ,å†…å­˜å ç”¨è¶…è¿‡è¿™ä¸€æ¯”çŽ‡,å°±ä¼šæ‰©å¤§ç©ºé—´ã€‚ -XX:MaxMetaspaceFreeRatio:ç¼©å°ç©ºé—´çš„æœ€å°æ¯”çŽ‡,å½“GCåŽ,å†…å­˜å ç”¨ä½ŽäºŽè¿™ä¸€æ¯”çŽ‡,å°±ä¼šç¼©å°ç©ºé—´ã€‚ Mixed GC Eventå³æ··åˆGCäº‹ä»¶,åœ¨è¿™ä¸ªäº‹ä»¶å†…éƒ¨,æ‰€æœ‰çš„å¹´è½»ä»£Regionå’Œä¸€éƒ¨åˆ†è€å¹´ä»£Regionä¸€èµ·è¢«å›žæ”¶ã€‚æ··åˆGCäº‹ä»¶ä¸€å®šæ˜¯è·Ÿåœ¨Minor GCä¹‹åŽçš„,å¹¶ä¸”æ··åˆGCåªæœ‰åœ¨å­˜æ´»å¯¹è±¡å…ƒæ•°æ®å­˜åœ¨çš„æƒ…å†µä¸‹æ‰ä¼šè§¦å‘ã€‚ ReclaimableGl GCä¸ºäº†èƒ½å¤Ÿå›žæ”¶,åˆ›å»ºäº†ä¸€ç³»åˆ—ä¸“é—¨ç”¨äºŽå­˜æ”¾å¯å›žæ”¶å¯¹è±¡çš„Regionã€‚è¿™äº›Regionéƒ½åœ¨ä¸ªé“¾è¡¨é˜Ÿåˆ—é‡Œé¢,è¿™ä¸ªé˜Ÿåˆ—åªåŒ…å«å­˜æ´»çŽ‡å°äºŽ-XX: GIMixedGCLiveThresholdPercent(é»˜è®¤85%)çš„Regionã€‚Regionçš„å€¼é™¤ä»¥æ•´ä¸ªJavaå †åŒº,å¦‚æžœå¤§äºŽ-XX:G1HeapWastePercen(é»˜è®¤5%),åˆ™å¯åŠ¨å›žæ”¶æœºåˆ¶ã€‚ Rsetå…¨ç§°Remembered Set,ç®€ç§°Rset,å³è·Ÿè¸ªæŒ‡å‘æŸä¸ªå †åŒº(Region)å†…çš„å¯¹è±¡å¼•ç”¨ã€‚ åœ¨æ ‡è®°å­˜æ´»å¯¹è±¡æ—¶,G1ä½¿ç”¨RememberSetçš„æ¦‚å¿µ,å°†æ¯ä¸ªåˆ†åŒºå¤–æŒ‡å‘åˆ†åŒºå†…çš„å¼•ç”¨è®°å½•åœ¨è¯¥åˆ†åŒºçš„RememberSetä¸­,é¿å…äº†å¯¹æ•´ä¸ªHeapçš„æ‰«æ,ä½¿å¾—å„ä¸ªåˆ†åŒºçš„GCæ›´åŠ ç‹¬ç«‹ã€‚å †å†…å­˜ä¸­çš„æ¯ä¸ªåŒºéƒ½æœ‰ä¸€ä¸ªRSet,Rsetçš„ä½œç”¨æ˜¯è®©å †åŒºèƒ½å¹¶è¡Œç‹¬ç«‹åœ°è¿›è¡Œåžƒåœ¾é›†åˆã€‚RSetæ‰€å ç”¨çš„JVMå†…å­˜å°äºŽæ€»å¤§å°çš„5%ã€‚åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹,å¯ä»¥çœ‹å‡ºG1GCå¤§å¤§æé«˜äº†è§¦å‘ Full Gcæ—¶çš„Heapå ç”¨çŽ‡,åŒæ—¶ä¹Ÿä½¿å¾— Minor GCçš„æš‚åœæ—¶é—´æ›´åŠ å¯æŽ§,å¯¹äºŽå†…å­˜è¾ƒå¤§çš„çŽ¯å¢ƒéžå¸¸å‹å¥½ã€‚ G1 GCå¼•å…¥äº†ä¸€äº›æ–°çš„é€‰é¡¹ã€‚G1RSetUpdatingPauseTimePercentè®¾ç½®STWé˜¶æ®µ(ç‹¬å é˜¶æ®µ)ä¸ºG1æ”¶é›†å™¨æŒ‡å®šæ›´æ–°RememberSetçš„æ—¶é—´å æ€»STWæ—¶é—´çš„æœŸæœ›æ¯”ä¾‹,é»˜è®¤ä¸º10ã€‚è€ŒG1ConcRefinementThreadsåˆ™æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ç»´æŠ¤RememberSetçš„çº¿ç¨‹æ•°ç›®ã€‚é€šè¿‡å¯¹è¿™ä¸¤ä¸ªå€¼çš„å¯¹åº”è°ƒæ•´,æˆ‘ä»¬å¯ä»¥æŠŠSTWé˜¶æ®µçš„RememberSetæ›´æ–°å·¥ä½œåŽ‹åŠ›æ›´å¤šåœ°ç§»åˆ°å¹¶è¡Œé˜¶æ®µã€‚ CSetå…¨ç§°Collection Set,ç®€ç§°CSet,å³æ”¶é›†é›†åˆ,ä¿å­˜ä¸€æ¬¡GCä¸­å°†æ‰§è¡Œåžƒåœ¾å›žæ”¶çš„åŒºé—´(Region)ã€‚GCæ—¶åœ¨CSetä¸­çš„æ‰€æœ‰å­˜æ´»æ•°æ®(Live Data)éƒ½ä¼šè¢«è½¬ç§»(å¤åˆ¶/ç§»åŠ¨)ã€‚é›†åˆä¸­çš„å †åŒºå¯ä»¥æ˜¯Eden, Survivorå’Œ/æˆ–Old Generationã€‚CSetsæ‰€å ç”¨çš„JVMå†…å­˜å°äºŽæ€»å¤§å°çš„1%ã€‚ ä»Žè¿™é‡Œå¯ä»¥çŸ¥é“,å®žé™…ä¸ŠCSetç›¸å½“äºŽä¸€ä¸ªå¤§åœˆ,é‡Œé¢åŒ…å«äº†å¾ˆå¤šçš„å°åœˆ(Rset),è¿™äº›åœˆåœˆéƒ½æ˜¯éœ€è¦è¢«å›žæ”¶çš„ä¿¡æ¯ã€‚è¿™æ ·å¯ä»¥æŠŠCSetæ¯”ä½œåžƒåœ¾åœº,RSetæ˜¯åžƒåœ¾åœºé‡Œé¢ä¸€ä¸ªä¸ªç»¿è‰²çš„å¯å›žæ”¶åžƒåœ¾æ¡¶ã€‚ PLABå…¨ç§°ä¸ºPromotion Local Allocation Buffers,å®ƒè¢«ç”¨äºŽå¹´è½»ä»£å›žæ”¶ã€‚PLABçš„ä½œç”¨æ˜¯é¿å…å¤šçº¿ç¨‹ç«žäº‰ç›¸åŒçš„æ•°æ®,å¤„ç†æ–¹å¼æ˜¯æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„PLAB,ç”¨äºŽé’ˆå¯¹å¹¸å­˜è€…å’Œè€å¹´ç©ºé—´ã€‚å½“åº”ç”¨å¼€å¯çš„çº¿ç¨‹è¾ƒå¤šæ—¶,æœ€å¥½ä½¿ç”¨-XX:-ResizePlaBæ¥å…³é—­PLAB()çš„å¤§å°è°ƒæ•´,ä»¥é¿å…å¤§é‡çš„çº¿ç¨‹é€šä¿¡æ‰€å¯¼è‡´çš„æ€§èƒ½ä¸‹é™ã€‚ TLABå…¨ç§°ä¸ºThread Local Allocation Buffers,å³çº¿ç¨‹æœ¬åœ°åˆ†é…ç¼“å­˜,æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸“ç”¨çš„å†…å­˜åˆ†é…åŒºåŸŸã€‚ æ€»çš„æ¥è¯´,TLABæ˜¯ä¸ºäº†åŠ é€Ÿå¯¹è±¡åˆ†é…è€Œç”Ÿçš„ã€‚ç”±äºŽå¯¹è±¡ä¸€èˆ¬ä¼šåˆ†é…åœ¨å †ä¸Š,è€Œå †æ˜¯å…¨å±€å…±äº«çš„ã€‚å› æ­¤åœ¨åŒä¸€æ—¶é—´,å¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åœ¨å †ä¸Šç”³è¯·ç©ºé—´ã€‚å› æ­¤,æ¯ä¸€æ¬¡å¯¹è±¡åˆ†é…éƒ½å¿…é¡»è¦è¿›è¡ŒåŒæ­¥,è€Œåœ¨ç«žäº‰æ¿€çƒˆçš„åœºåˆåˆ†é…çš„æ•ˆçŽ‡åˆä¼šè¿›ä¸€æ­¥ä¸‹é™ã€‚è€ƒè™‘åˆ°å¯¹è±¡åˆ†é…å‡ ä¹Žæ˜¯Javaæœ€æœ€å¸¸ç”¨çš„æ“ä½œ,æ‰€ä»¥JVMå°±ä½¿ç”¨äº†TLABè¿™ç§çº¿ç¨‹ä¸“å±žçš„åŒºé—´æ¥é¿å…å¤šçº¿ç¨‹å†²çª,æé«˜å¯¹è±¡åˆ†é…çš„æ•ˆçŽ‡ã€‚TLABæœ¬èº«å ç”¨äº†EdenåŒºçš„ç©ºé—´,å³JVMä¼šä¸ºæ¯ä¸€ä¸ªJavaçº¿ç¨‹åˆ†é…ä¸€å—TLABç©ºé—´ã€‚ å¯¹äºŽG1 GCæ¥è¯´,TLABæ˜¯Edençš„ä¸€ä¸ªRegion,è¢«ä¸€ä¸ªå•ä¸€çº¿ç¨‹ç”¨äºŽåˆ†é…èµ„æºã€‚ä¸»è¦ç”¨é€”æ˜¯è®©ä¸€ä¸ªçº¿ç¨‹é€šè¿‡æ ˆæ“ä½œæ–¹å¼ç‹¬äº«å†…å­˜ç©ºé—´,ç”¨äºŽå¯¹è±¡åˆ†é…,è¿™æ ·æ¯”å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«èµ„æºè¦å¿«å¾ˆå¤šã€‚å¦‚æžœæ¯ä¸ªçº¿ç¨‹çš„åˆ†é…å†…å­˜ä¸å¤Ÿ,é‚£ä¹ˆå®ƒä¼šåŽ»å…¨å±€å†…å­˜æ± ç”³è¯·æ–°çš„å†…å­˜ã€‚è¿™æ ·ä¹Ÿå°±æ˜¯è¯´,å¦‚æžœTLABå€¼è®¾ç½®è¿‡å°,å®¹æ˜“é€ æˆé¢‘ç¹ç”³è¯·,ä¹Ÿå°±ä¼šé€ æˆGCæ€§èƒ½ä¸‹é™ã€‚åä¹‹,å¦‚æžœè®¾ç½®è¿‡å¤§,ä¼šé€ æˆTLABä½¿ç”¨ä¸å®Œ,ä¹Ÿå°±æ˜¯è¯´å†…å­˜æµªè´¹ã€‚ Regionä»Žå­—é¢ä¸Šæ¥è¯´, Regionè¡¨ç¤ºä¸€ä¸ªåŒºåŸŸ,æ¯ä¸ªåŒºåŸŸé‡Œé¢çš„å­—æ¯ä»£è¡¨ä¸åŒçš„åˆ†ä»£å†…å­˜ç©ºé—´ç±»åž‹(å¦‚[E]Eden,[O]Old,[S]Survivor),ç©ºç™½çš„åŒºå—ä¸å±žäºŽä»»ä½•ä¸€ä¸ªåˆ†åŒºã€‚G1å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™ä»»æ„æŒ‡å®šè¿™ä¸ªåŒºåŸŸå±žäºŽEdenæˆ–æ˜¯OåŒºä¹‹ç±»çš„ã€‚ Ergonomics Heuristic Decisionåœ¨å¾ˆå¤šè‹±æ–‡ä¹¦é‡Œéƒ½èƒ½çœ‹åˆ°è¿™ä¸²å•è¯,ç‰¹åˆ«æ˜¯Ergonomics Heuristi,å®ƒä»¬çš„å­—é¢æ„æ€æ˜¯äººä½“å·¥ç¨‹å­¦,å¯ä»¥ç†è§£ä¸ºé€‚åˆäººç±»ç†è§£çš„è¡Œä¸ºã€ä¹ æƒ¯ã€‚GCæ—¥å¿—é‡Œé¢çœ‹åˆ°Ergonomicsè¿™ä¸ªå•è¯,å®ƒåŽé¢ä¸€èˆ¬è·Ÿç€çš„æ˜¯G1 GCç›¸å…³çš„è¯¦ç»†æè¿°,æ¯”å¦‚å †å†…å­˜æ—¥å¿—ã€CSetåˆ’åˆ†ç­‰,é€šå¸¸é‡‡ç”¨é€‰é¡¹-XX:+PrintAdaptiveSizePolicyæ—¶ä¼šçœ‹åˆ°è¿™ä¸ªå•è¯ã€‚ Top-at-mark-startæ¯ä¸ªåŒºé—´è®°å½•ç€ä¸¤ä¸ªTAMSæŒ‡é’ˆ(Top-at-mark-start),åˆ†åˆ«ä¸ºprevTAMSå’ŒnextTAMSåœ¨TAMSä»¥ä¸Šçš„å¯¹è±¡æ˜¯æ–°åˆ†é…çš„,å› è€Œè¢«è§†ä¸ºéšå¼æ ‡è®°ã€‚ JVM&amp;GC æ·±å…¥çŸ¥è¯†Javaè™šæ‹Ÿæœºå†…å­˜æ¨¡åž‹ ç¨‹åºè®¡æ•°å™¨ç¨‹åºè®¡æ•°å™¨,è‹±æ–‡å…¨ç§°Program Counter Register,å®ƒæ˜¯ä¸€å—å¾ˆå°çš„å†…å­˜ç©ºé—´,å®ƒæ˜¯è¿è¡Œé€Ÿåº¦æœ€å¿«çš„å­˜å‚¨åŒºåŸŸ,è¿™æ˜¯å› ä¸ºå®ƒä½äºŽä¸åŒäºŽå…¶ä»–å­˜å‚¨åŒºçš„åœ°æ–¹â€”å¤„ç†å™¨å†…éƒ¨ã€‚å¯„å­˜å™¨çš„æ•°é‡æžå…¶æœ‰é™,æ‰€ä»¥å¯„å­˜å™¨ç”±ç¼–è¯‘å™¨æ ¹æ®éœ€æ±‚è¿›è¡Œåˆ†é…ã€‚å®žé™…ä¸Šåœ¨Jaaåº”ç”¨ç¨‹åºå†…éƒ¨ä¸èƒ½ç›´æŽ¥æŽ§åˆ¶å¯„å­˜å™¨,ä¹Ÿä¸èƒ½åœ¨ç¨‹åºä¸­æ„Ÿè§‰åˆ°å¯„å­˜å™¨å­˜åœ¨çš„ä»»ä½•è¿¹è±¡ã€‚å¯ä»¥æŠŠç¨‹åºè®¡æ•°å™¨çœ‹ä½œå½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚åœ¨è™šæ‹Ÿæœºçš„æ¦‚å¿µæ¨¡åž‹é‡Œ,å­—èŠ‚ç è§£é‡Šå™¨çš„å·¥ä½œå°±æ˜¯é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨çš„å€¼æ¥é€‰æ‹©ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤,åˆ†æ”¯ã€å¾ªçŽ¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚ ç®€å•æ¦‚æ‹¬ä¸Šé¢çš„æè¿°,å³åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹,ä¸ºäº†è®©çº¿ç¨‹åˆ‡æ¢åŽèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®,æ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨,å„ä¸ªçº¿ç¨‹ä¹‹é—´äº’ä¸å½±å“ã€ç‹¬ç«‹å­˜å‚¨,å› æ­¤è¿™å—å†…å­˜æ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚JVMä¸­çš„å¯„å­˜å™¨ç±»ä¼¼äºŽç‰©ç†å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ,æ­£å¦‚å‰é¢è¯´çš„,å®ƒæ˜¯çº¿ç¨‹ç§æœ‰çš„,æ‰€ä»¥ç”Ÿå‘½å‘¨æœŸä¸Žçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ã€‚ æ ¹æ®Javaè™šæ‹Ÿæœºå®šä¹‰æ¥çœ‹,ç¨‹åºå¯„å­˜å™¨åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•OutOfMemory Erroræƒ…å†µçš„åŒºåŸŸã€‚ è™šæ‹Ÿæœºæ ˆJVMçš„æž¶æž„æ˜¯åŸºäºŽæ ˆçš„,å³ç¨‹åºæŒ‡ä»¤çš„æ¯ä¸€ä¸ªæ“ä½œéƒ½è¦ç»è¿‡å…¥æ ˆå’Œå‡ºæ ˆè¿™æ ·çš„ç»„åˆåž‹æ“ä½œæ‰èƒ½å®Œæˆã€‚ æ€»çš„æ¥è¯´,æ ˆçš„ä¼˜åŠ¿æ˜¯è®¿é—®é€Ÿåº¦æ¯”å †è¦å¿«,å®ƒä»…æ¬¡äºŽå¯„å­˜å™¨,å¹¶ä¸”æ ˆæ•°æ®æ˜¯å¯ä»¥è¢«å…±äº«çš„æ ˆçš„ç¼ºç‚¹æ˜¯å­˜å‚¨åœ¨æ ˆé‡Œé¢çš„æ•°æ®å¤§å°ä¸Žç”Ÿå­˜æœŸå¿…é¡»æ˜¯ç¡®å®šçš„,ä»Žè¿™ä¸€ç‚¹æ¥çœ‹,æ ˆæ˜Žæ˜¾ç¼ºä¹çµæ´»æ€§ã€‚è™šæ‹Ÿæœºæ ˆå†…ä¸»è¦è¢«ç”¨æ¥å­˜æ”¾ä¸€äº›åŸºæœ¬ç±»åž‹çš„å˜é‡,ä¾‹å¦‚intã€ shortã€longã€byteã€foatã€ doubleã€booleaã€char,ä»¥åŠå¯¹è±¡å¼•ç”¨ã€‚ å‰é¢è¯´è¿‡,è™šæ‹Ÿæœºæ ˆæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ®Šæ€§,å°±æ˜¯å­˜æ”¾åœ¨æ ˆå†…çš„æ•°æ®å¯ä»¥å…±äº«ã€‚å‡è®¾åŒæ—¶å®šä¹‰: 12int a=1;int b=1; å¯¹äºŽä¸Šé¢çš„ä»£ç ,è™šæ‹Ÿæœºå¤„ç†ç¬¬ä¸€æ¡è¯­å¥,é¦–å…ˆå®ƒä¼šåœ¨æ ˆå†…åˆ›å»ºä¸€ä¸ªå˜é‡ä¸ºaçš„å¼•ç”¨,ç„¶åŽæŸ¥æ‰¾æ ˆå†…æ˜¯å¦æœ‰1è¿™ä¸ªå€¼,å¦‚æžœæ²¡æ‰¾åˆ°,å°±å°†1å­˜æ”¾è¿›æ¥,ç„¶åŽå°†aæŒ‡å‘1ã€‚æŽ¥ä¸‹æ¥å¤„ç†ç¬¬äºŒæ¡è¯­å¥,åœ¨åˆ›å»ºå®Œbçš„å¼•ç”¨å˜é‡åŽ,å› ä¸ºåœ¨æ ˆå†…å·²ç»æœ‰1è¿™ä¸ªå€¼,ä¾¿å°†bç›´æŽ¥æŒ‡å‘1ã€‚è¿™æ ·,å°±å‡ºçŽ°äº†aä¸ŽbåŒæ—¶å‡æŒ‡å‘1çš„æƒ…å†µã€‚è¿™æ—¶,å¦‚æžœå­˜åœ¨ç¬¬ä¸‰æ¡è¯­å¥,å®ƒé’ˆå¯¹aå†æ¬¡å®šä¹‰ä¸ºa=4,é‚£ä¹ˆç¼–è¯‘å™¨ä¼šé‡æ–°æœç´¢æ ˆå†…æ˜¯å¦æœ‰4å€¼,å¦‚æžœæ²¡æœ‰,åˆ™å°†4å­˜æ”¾è¿›æ¥,å¹¶ä»¤aæŒ‡å‘4,å¦‚æžœå·²ç»æœ‰äº†,åˆ™ç›´æŽ¥å°†aæŒ‡å‘è¿™ä¸ªåœ°å€,å› æ­¤aå€¼çš„æ”¹å˜ä¸ä¼šå½±å“åˆ°bçš„å€¼ã€‚è¦æ³¨æ„è¿™ç§æ•°æ®çš„å…±äº«ä¸Žä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨åŒæ—¶æŒ‡å‘ä¸€ä¸ªå¯¹è±¡çš„è¿™ç§å…±äº«çš„æ–¹å¼å­˜åœ¨æ˜Žæ˜¾çš„ä¸åŒ,å› ä¸ºè¿™ç§æƒ…å†µaçš„ä¿®æ”¹å¹¶ä¸ä¼šå½±å“åˆ°b,å®ƒæ˜¯ç”±è™šæ‹Ÿæœºå®Œæˆçš„,è¿™æ ·çš„åšæ³•æœ‰åˆ©äºŽèŠ‚çœç©ºé—´ã€‚è€Œä¸€ä¸ªå¯¹è±¡å¼•ç”¨å˜é‡ä¿®æ”¹äº†è¿™ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€,ä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡å¼•ç”¨å˜é‡ã€‚ ä¸Žç¨‹åºè®¡æ•°å™¨ä¸€æ ·,Javaè™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„å†…å­˜ç©ºé—´,å®ƒå’ŒJavaçº¿ç¨‹åœ¨åŒä¸€æ—¶é—´åˆ›å»º,å®ƒä¿å­˜æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æžœ,å¹¶å‚ä¸Žæ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›žã€‚ è™šæ‹Ÿæœºæ ˆåœ¨è¿è¡Œæ—¶ä½¿ç”¨ä¸€ç§å«ä½œæ ˆå¸§çš„æ•°æ®ç»“æž„ä¿å­˜ä¸Šä¸‹æ–‡æ•°æ®,æ ˆå¸§é‡Œé¢å­˜æ”¾äº†æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿žæŽ¥æ–¹æ³•å’Œè¿”å›žåœ°å€ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼´éšç€æ ˆå¸§çš„å…¥æ ˆæ“ä½œ,ç›¸åº”åœ°,æ–¹æ³•çš„è¿”å›žåˆ™è¡¨ç¤ºæ ˆå¸§çš„å‡ºæ ˆæ“ä½œã€‚ ä½¿ç”¨JClassLibå·¥å…·å¯ä»¥æŸ¥çœ‹Classæ–‡ä»¶ä¸­æ¯ä¸ªæ–¹æ³•æ‰€åˆ†é…çš„æœ€å¤§å±€éƒ¨å˜é‡åŒºçš„å®¹é‡ã€‚JClassLibå·¥å…·æ˜¯å¼€æºè½¯ä»¶,å®ƒå¯ä»¥ç”¨äºŽæŸ¥çœ‹ Classæ–‡ä»¶çš„ç»“æž„,åŒ…æ‹¬å¸¸é‡æ± ã€æŽ¥å£ã€å±žæ€§ã€æ–¹æ³•,è¿˜å¯ä»¥ç”¨äºŽæŸ¥çœ‹æ–‡ä»¶çš„å­—èŠ‚ç ã€‚ Javaå †Javaå †åŒºåœ¨JVMå¯åŠ¨çš„æ—¶å€™å³è¢«åˆ›å»º,å®ƒåªè¦æ±‚é€»è¾‘ä¸Šæ˜¯è¿žç»­çš„,åœ¨ç‰©ç†ç©ºé—´ä¸Šå¯ä»¥æ˜¯ä¸è¿žç»­ã€‚æ‰€æœ‰çš„çº¿ç¨‹å…±äº«Javaå †,åœ¨è¿™é‡Œå¯ä»¥åˆ’åˆ†çº¿ç¨‹ç§æœ‰çš„ç¼“å†²åŒº(Thread Local Allocation Buffer,TLAB)ã€‚ æ­£æ˜¯å› ä¸ºJavaå †åŒºæ˜¯GCçš„é‡ç‚¹å›žæ”¶åŒºåŸŸ,æ‰€ä»¥GCæžæœ‰å¯èƒ½ä¼šåœ¨å¤§å†…å­˜çš„ä½¿ç”¨å’Œé¢‘ç¹è¿›è¡Œåžƒåœ¾å›žæ”¶è¿‡ç¨‹ä¸Šæˆä¸ºç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜,JVMçš„è®¾è®¡è€…ä»¬å¼€å§‹è€ƒè™‘æ˜¯å¦ä¸€å®šéœ€è¦å°†å¯¹è±¡å®žä¾‹å­˜å‚¨åˆ°Javaå †åŒºå†…ã€‚åŸºäºŽOpenJDKæ·±åº¦å®šåˆ¶çš„TaobaoJVM,å…¶ä¸­åˆ›æ–°çš„GCIH(GC invisible heap)æŠ€æœ¯å®žçŽ°äº†off-heap,å³å°†ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„Javaå¯¹è±¡ä»Žheapä¸­ç§»åˆ°heapä¹‹å¤–,å¹¶ä¸”GCä¸èƒ½ç®¡ç†GCHå†…éƒ¨çš„Javaå¯¹è±¡,ä»¥æ­¤è¾¾åˆ°é™ä½ŽGCçš„å›žæ”¶é¢‘çŽ‡å’Œæå‡GCçš„å›žæ”¶æ•ˆçŽ‡çš„ç›®çš„ã€‚ æ–¹æ³•åŒºæ–¹æ³•åŒºä¸»è¦ä¿å­˜çš„ä¿¡æ¯æ˜¯ç±»çš„å…ƒæ•°æ®ã€‚æ–¹æ³•åŒºä¸Žå †ç©ºé—´ç±»ä¼¼,å®ƒä¹Ÿæ˜¯è¢«JVMä¸­æ‰€æœ‰çš„çº¿ç¨‹å…±äº«çš„åŒºåŸŸã€‚å¦‚ä¸‹å›¾æ‰€ç¤º,æ–¹æ³•åŒºä¸­æœ€ä¸ºé‡è¦çš„æ˜¯ç±»çš„ç±»åž‹ä¿¡æ¯ã€å¸¸é‡æ± ã€åŸŸä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€‚ç±»åž‹ä¿¡æ¯åŒ…æ‹¬ç±»çš„å®Œæ•´åç§°ã€çˆ¶ç±»çš„å®Œæ•´åç§°ã€ç±»åž‹ä¿®é¥°ç¬¦(public/protected/private)å’Œç±»åž‹çš„ç›´æŽ¥æŽ¥å£ç±»è¡¨ã€‚ å¸¸é‡æ± åŒ…æ‹¬ç±»æ–¹æ³•ã€åŸŸç­‰ä¿¡æ¯æ‰€å¼•ç”¨çš„å¸¸é‡ä¿¡æ¯ã€‚åŸŸä¿¡æ¯åŒ…æ‹¬åŸŸåç§°ã€åŸŸç±»åž‹å’ŒåŸŸä¿®é¥°ç¬¦æ–¹æ³•ä¿¡æ¯åŒ…æ‹¬æ–¹æ³•åç§°ã€è¿”å›žç±»åž‹ã€æ–¹æ³•å‚æ•°ã€æ–¹æ³•ä¿®é¥°ç¬¦ã€æ–¹æ³•å­—èŠ‚ç ã€æ“ä½œæ•°æ ˆå’Œæ–¹æ³•æ ˆå¸§çš„å±€éƒ¨å˜é‡åŒºå¤§å°ä»¥åŠå¼‚å¸¸è¡¨ã€‚æ–¹æ³•åŒºæ˜¯çº¿ç¨‹é—´å…±äº«çš„,å½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶éœ€è¦åŠ è½½ä¸€ä¸ªç±»åž‹æ—¶,åªæœ‰ä¸€ä¸ªç±»ä¼šè¯·æ±‚ClassLoaderåŠ è½½,å¦ä¸€ä¸ªçº¿ç¨‹åˆ™ä¼šç­‰å¾…ã€‚æ€»è€Œè¨€ä¹‹,æ–¹æ³•åŒºå†…ä¿å­˜çš„ä¿¡æ¯å¤§éƒ¨åˆ†æ¥è‡ªäºŽClassä»¶,æ˜¯Javaåº”ç”¨ç¨‹åºè¿è¡Œå¿…ä¸å¯å°‘çš„é‡è¦æ•°æ®ã€‚ åœ¨Hotspotè™šæ‹Ÿæœºä¸­,æ–¹æ³•åŒºä¹Ÿè¢«ç§°ä¸ºæ°¸ä¹…åŒº,æ˜¯ä¸€å—ç‹¬ç«‹äºŽJavaå †çš„å†…å­˜ç©ºé—´ã€‚è™½ç„¶è¢«å«ä½œæ°¸ä¹…åŒº,ä½†æ˜¯åœ¨æ°¸ä¹…åŒºä¸­çš„å¯¹è±¡åŒæ ·ä¹Ÿæ˜¯å¯ä»¥è¢«GCå›žæ”¶çš„,åªæ˜¯å¯¹äºŽGCçš„å¯¹åº”ç­–ç•¥ä¸ŽJavaå †ç©ºé—´ç•¥æœ‰ä¸åŒã€‚ GCé’ˆå¯¹æ°¸ä¹…åŒºçš„å›žæ”¶,é€šå¸¸ä¸»è¦ä»Žä¸¤ä¸ªæ–¹é¢åˆ†æž:ä¸€æ˜¯GCå¯¹æ°¸ä¹…åŒºå¸¸é‡æ± çš„å›žæ”¶,äºŒæ˜¯æ°¸ä¹…åŒºå¯¹ç±»å…ƒæ•°æ®çš„å›žæ”¶ã€‚HotSpotè™šæ‹Ÿæœºå¯¹å¸¸é‡æ± çš„å›žæ”¶ç­–ç•¥æ˜¯å¾ˆæ˜Žç¡®çš„,åªè¦å¸¸é‡æ± ä¸­çš„å¸¸é‡æ²¡æœ‰è¢«ä»»ä½•åœ°æ–¹å¼•ç”¨ï¼Œå°±å¯ä»¥è¢«å›žæ”¶ã€‚ åžƒåœ¾æ”¶é›†ç®—æ³•æ ¹æœç´¢ç®—æ³•åœ¨HotSpotä¸­,æ ¹å¯¹è±¡é›†åˆä¸­åŒ…å«äº†5ä¸ªå…ƒç´ ,Javaæ ˆå†…çš„å¯¹è±¡å¼•ç”¨ã€æœ¬åœ°æ–¹æ³•æ ˆå†…çš„å¯¹è±¡å¼•ç”¨ã€è¿è¡Œæ—¶å¸¸é‡æ± ä¸­çš„å¯¹è±¡å¼•ç”¨ã€æ–¹æ³•åŒºä¸­ç±»é™æ€å±žæ€§çš„å¯¹è±¡å¼•ç”¨ä»¥åŠä¸Žä¸€ä¸ªç±»å¯¹åº”çš„å”¯ä¸€æ•°æ®ç±»åž‹çš„Classå¯¹è±¡ã€‚ è¿™éƒ¨åˆ†äº†è§£ä¸€ä¸‹å°±å¥½æ³¨æ„,åœ¨æ ¹æœç´¢ç®—æ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡,ä¹Ÿå¹¶éžæ˜¯â€œéžæ­»ä¸å¯â€çš„,è¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºŽâ€œç¼“åˆ‘â€é˜¶æ®µ,è¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡,è‡³å°‘è¦ç»åŽ†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ã€‚å¦‚æžœå¯¹è±¡åœ¨è¿›è¡Œæ ¹æœç´¢åŽå‘çŽ°æ²¡æœ‰ä¸ŽGC Rootsç›¸è¿žæŽ¥çš„å¼•ç”¨é“¾,é‚£å®ƒå°†ä¼šè¢«ç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰,ç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalizeæ–¹æ³•ã€‚å½“å¯¹è±¡æ²¡æœ‰è¦†ç›–finalizeæ–¹æ³•,æˆ–è€…finalizedæ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡,è™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µéƒ½è§†ä¸ºâ€œæ²¡æœ‰å¿…è¦æ‰§è¡Œâ€ã€‚å¦‚æžœè¿™ä¸ªå¯¹è±¡è¢«åˆ¤å®šä¸ºæœ‰å¿…è¦æ‰§è¡Œfinalizeæ–¹æ³•,é‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†ä¼šè¢«æ”¾ç½®åœ¨ä¸€ä¸ªåä¸ºF-Queueçš„é˜Ÿåˆ—ä¹‹ä¸­,å¹¶åœ¨ç¨åŽç”±æ¡ç”±è™šæ‹Ÿæœºè‡ªåŠ¨å»ºç«‹çš„ã€ä½Žä¼˜å…ˆçº§çš„Finalizerçº¿ç¨‹åŽ»æ‰§è¡Œã€‚è¿™é‡Œæ‰€è°“çš„â€œæ‰§è¡Œâ€æ˜¯æŒ‡è™šæ‹Ÿæœºä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•,ä½†å¹¶ä¸æ‰¿è¯ºä¼šç­‰å¾…å®ƒè¿è¡Œç»“æŸã€‚è¿™æ ·åšçš„åŽŸå› æ˜¯,å¦‚æžœä¸€ä¸ªå¯¹è±¡åœ¨finalizeæ–¹æ³•ä¸­æ‰§è¡Œç¼“æ…¢,æˆ–è€…å‘ç”Ÿäº†æ­»å¾ªçŽ¯(æ›´æžç«¯çš„æƒ…å†µ),å¾ˆå¯èƒ½ä¼šå¯¼è‡´F-Queueé˜Ÿåˆ—ä¸­çš„å…¶ä»–å¯¹è±¡æ°¸ä¹…å¤„äºŽç­‰å¾…çŠ¶æ€,ç”šè‡³å¯¼è‡´æ•´ä¸ªå†…å­˜å›žæ”¶ç³»ç»Ÿå´©æºƒã€‚finalize()æ–¹æ³•æ˜¯å¯¹è±¡é€ƒè„±æ­»äº¡å‘½è¿çš„æœ€åŽä¸€æ¬¡æœºä¼š,ç¨åŽGCå°†å¯¹F-Queueä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡å°è§„æ¨¡çš„æ ‡è®°,å¦‚æžœå¯¹è±¡è¦åœ¨finalizedä¸­æˆåŠŸæ‹¯æ•‘è‡ªå·±â€”åªè¦é‡æ–°ä¸Žå¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹å…³è”å³å¯,è­¬å¦‚æŠŠè‡ªå·±(thiså…³é”®å­—)èµ‹å€¼ç»™æŸä¸ªç±»å˜é‡æˆ–å¯¹è±¡çš„æˆå‘˜å˜é‡,é‚£åœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶å®ƒå°†è¢«ç§»é™¤å‡ºâ€œå³å°†å›žæ”¶â€çš„é›†åˆã€‚å¦‚æžœå¯¹è±¡è¿™æ—¶å€™è¿˜æ²¡æœ‰é€ƒè„±,é‚£å®ƒå°±çœŸçš„ç¦»æ­»ä¸è¿œäº†ã€‚ æ ‡è®°æ¸…é™¤ç®—æ³•(Mark-Sweep)ç®—æ³•æ¶‰åŠå‡ ä¸ªæ¦‚å¿µ,å…ˆæ¥äº†è§£ä¸€ä¸‹mutatorå’Œcollector,è¿™ä¸¤ä¸ªåè¯ç»å¸¸åœ¨åžƒåœ¾æ”¶é›†ç®—æ³•ä¸­å‡ºçŽ°,collectoræŒ‡çš„å°±æ˜¯åžƒåœ¾æ”¶é›†å™¨,è€Œ mutatoræ˜¯æŒ‡é™¤äº†åžƒåœ¾æ”¶é›†å™¨ä¹‹å¤–çš„éƒ¨åˆ†,æ¯”å¦‚è¯´æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæœ¬èº«ã€‚mutatorçš„èŒè´£ä¸€èˆ¬æ˜¯NEW(åˆ†é…å†…å­˜)ã€READ(ä»Žå†…å­˜ä¸­è¯»å–å†…å®¹)ã€WRITE(å°†å†…å®¹å†™å…¥å†…å­˜),è€Œcollectoråˆ™å°±æ˜¯å›žæ”¶ä¸å†ä½¿ç”¨çš„å†…å­˜æ¥ä¾›mutatorè¿›è¡ŒNEWæ“ä½œçš„ä½¿ç”¨ã€‚mutatoræ ¹å¯¹è±¡ä¸€èˆ¬æŒ‡çš„æ˜¯åˆ†é…åœ¨å †å†…å­˜ä¹‹å¤–,å¯ä»¥ç›´æŽ¥è¢«mutatorç›´æŽ¥è®¿é—®åˆ°çš„å¯¹è±¡,ä¸€èˆ¬æ˜¯æŒ‡é™æ€/å…¨å±€å˜é‡ä»¥åŠThreadLocalå˜é‡ã€‚ å¤åˆ¶ç®—æ³•(Copying)åŸºäºŽåˆ†ä»£çš„æ¦‚å¿µ,Javaå †åŒºå¦‚æžœè¿˜è¦æ›´è¿›ä¸€æ­¥ç»†åˆ†çš„è¯,è¿˜å¯ä»¥åˆ’åˆ†ä¸ºå¹´è½»ä»£(Young Gen)å’Œè€å¹´ä»£(OldEn),å…¶ä¸­å¹´è½»ä»£åˆå¯ä»¥è¢«åˆ’åˆ†ä¸ºEdenç©ºé—´ã€From Survivorç©ºé—´å’ŒTo Survivorç©ºé—´ã€‚åœ¨HotSpotä¸­,Edenç©ºé—´å’Œå¦å¤–ä¸¤ä¸ªSurvivorç©ºé—´é»˜è®¤æ‰€å çš„æ¯”ä¾‹æ˜¯8:1,å½“ç„¶å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹â€œ-XX:SurvivorRatioâ€è°ƒæ•´è¿™ä¸ªç©ºé—´æ¯”ä¾‹ã€‚å½“æ‰§è¡Œä¸€æ¬¡Minor GC(å¹´è½»ä»£çš„åžƒåœ¾å›žæ”¶),Edenç©ºé—´ä¸­çš„å­˜æ´»å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ°Toç©ºé—´å†…,å¹¶ä¸”ä¹‹å‰å·²ç»ç»åŽ†è¿‡ä¸€æ¬¡ Minor GCå¹¶åœ¨Fromç©ºé—´ä¸­å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å¦‚æžœè¿˜å¹´è½»çš„è¯åŒæ ·ä¹Ÿä¼šè¢«å¤åˆ¶åˆ°Toç©ºé—´å†…ã€‚éœ€è¦æ³¨æ„çš„æ˜¯,åœ¨æ»¡è¶³ä¸¤ç§ç‰¹æ®Šæƒ…å†µä¸‹,Edenå’ŒFromç©ºé—´ä¸­çš„å­˜æ´»å¯¹è±¡å°†ä¸ä¼šè¢«å¤åˆ¶åˆ°Toç©ºé—´å†…ã€‚é¦–å…ˆæ˜¯å¦‚æžœå­˜æ´»å¯¹è±¡çš„åˆ†ä»£å¹´é¾„è¶…è¿‡é€‰é¡¹â€œ-XX:MaxTenuringThresholdâ€æ‰€æŒ‡å®šçš„é˜ˆå€¼æ—¶,å°†ä¼šç›´æŽ¥æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å…¶æ¬¡å½“Toç©ºé—´çš„å®¹é‡è¾¾åˆ°é˜ˆå€¼æ—¶,å­˜æ´»å¯¹è±¡åŒæ ·ä¹Ÿæ˜¯ç›´æŽ¥æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å½“æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡éƒ½è¢«å¤åˆ¶åˆ°Toç©ºé—´æˆ–è€…æ™‹å‡åˆ°è€å¹´ä»£åŽ,å‰©ä¸‹çš„å‡ä¸ºåžƒåœ¾å¯¹è±¡,è¿™å°±æ„å‘³ç€GCå¯ä»¥å¯¹è¿™äº›å·²ç»æ­»äº¡äº†çš„å¯¹è±¡æ‰§è¡Œä¸€æ¬¡Minor GC,é‡Šæ”¾æŽ‰å…¶æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ æ ‡è®°åŽ‹ç¼©ç®—æ³•(Mark-Compact)åœ¨HotSpotä¸­,åŸºäºŽåˆ†ä»£çš„æ¦‚å¿µ,GCæ‰€ä½¿ç”¨çš„å†…å­˜å›žæ”¶ç®—æ³•å¿…é¡»ç»“åˆå¹´è½»ä»£å’Œè€å¹´ä»£å„è‡ªçš„ç‰¹ç‚¹ã€‚ç®€å•æ¥è¯´,å°±æ˜¯é’ˆå¯¹ä¸åŒçš„ä»£ç©ºé—´,ä»Žè€Œç»“åˆä½¿ç”¨ä¸åŒçš„åžƒåœ¾æ”¶é›†ç®—æ³•ã€‚ä¸ºå¹´è½»ä»£é€‰æ‹©çš„åžƒåœ¾æ”¶é›†ç®—æ³•é€šå¸¸æ˜¯ä»¥é€Ÿåº¦ä¼˜å…ˆ,å› ä¸ºå¹´è½»ä»£ä¸­æ‰€å­˜å‚¨çš„çž¬æ—¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸéžå¸¸çŸ­æš‚,å¯ä»¥æœ‰é’ˆå¯¹æ€§åœ°ä½¿ç”¨å¤åˆ¶ç®—æ³•,å› æ­¤æ‰§è¡ŒMinor GCæ—¶,ä¸€å®šè¦ä¿æŒé«˜æ•ˆå’Œå¿«é€Ÿã€‚è€Œå¹´è½»ä»£ä¸­çš„ç”Ÿå­˜ç©ºé—´é€šå¸¸éƒ½æ¯”è¾ƒå°,æ‰€ä»¥å›žæ”¶å¹´è½»ä»£æ—¶ä¸€å®šä¼šéžå¸¸é¢‘ç¹ã€‚ä½†è€å¹´ä»£é€šå¸¸ä½¿ç”¨æ›´èŠ‚çœå†…å­˜çš„å›žæ”¶ç®—æ³•,å› ä¸ºè€å¹´ä»£ä¸­æ‰€å­˜å‚¨çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸéƒ½éžå¸¸é•¿,å¹¶ä¸”è€å¹´ä»£å æ®äº†å¤§éƒ¨åˆ†çš„å †ç©ºé—´æ‰€ä»¥è€å¹´ä»£çš„Full GCå¹¶ä¸ä¼šè·Ÿå¹´è½»ä»£çš„Minor GCä¸€æ ·é¢‘ç¹,ä¸è¿‡ä¸€æ—¦ç¨‹åºä¸­å‘ç”Ÿä¸€æ¬¡Full GC,å°†ä¼šè€—è´¹æ›´é•¿çš„æ—¶é—´æ¥å®Œæˆ,é‚£ä¹ˆåœ¨è€å¹´ä»£ä¸­ä½¿ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•æˆ–è€…æ ‡è®°-åŽ‹ç¼©ç®—æ³•æ‰§è¡Œåžƒåœ¾å›žæ”¶å°†ä¼šæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚ Garbage CollectionGC æ¦‚å¿µåœ¨è®¸å¤šæƒ…å†µä¸‹,GCä¸åº”è¯¥æˆä¸ºå½±å“ç³»ç»Ÿæ€§èƒ½çš„ç“¶é¢ˆ,å¯ä»¥æ ¹æ®ä»¥ä¸‹å…­ç‚¹æ¥è¯„ä¼°ä¸€æ¬¾GCçš„æ€§èƒ½ã€‚ åžåé‡ï¼šç¨‹åºçš„è¿è¡Œæ—¶é—´(ç¨‹åºçš„è¿è¡Œæ—¶é—´+å†…å­˜å›žæ”¶çš„æ—¶é—´)ã€‚ åžƒåœ¾æ”¶é›†å¼€é”€ï¼šåžåé‡çš„è¡¥æ•°,åžƒåœ¾æ”¶é›†å™¨æ‰€å æ—¶é—´ä¸Žæ€»æ—¶é—´çš„æ¯”ä¾‹ã€‚ æš‚åœæ—¶é—´ï¼šæ‰§è¡Œåžƒåœ¾æ”¶é›†æ—¶,ç¨‹åºçš„å·¥ä½œçº¿ç¨‹è¢«æš‚åœçš„æ—¶é—´ã€‚ æ”¶é›†é¢‘çŽ‡ï¼šç›¸å¯¹äºŽåº”ç”¨ç¨‹åºçš„æ‰§è¡Œ,æ”¶é›†æ“ä½œå‘ç”Ÿçš„é¢‘çŽ‡ã€‚ å †ç©ºé—´ï¼šJavaå †åŒºæ‰€å çš„å†…å­˜å¤§å°ã€‚ å¿«é€Ÿï¼šä¸€ä¸ªå¯¹è±¡ä»Žè¯žç”Ÿåˆ°è¢«å›žæ”¶æ‰€ç»åŽ†çš„æ—¶é—´ã€‚ Parallelæ”¶é›†å™¨éœ€è¦æ³¨æ„çš„æ˜¯,åžƒåœ¾æ”¶é›†å™¨ä¸­åžåé‡å’Œä½Žå»¶è¿Ÿè¿™ä¸¤ä¸ªç›®æ ‡æœ¬èº«æ˜¯ç›¸äº’çŸ›ç›¾çš„,å› ä¸ºå¦‚æžœé€‰æ‹©ä»¥åžåé‡ä¼˜å…ˆ,é‚£ä¹ˆå¿…ç„¶éœ€è¦é™ä½Žå†…å­˜å›žæ”¶çš„æ‰§è¡Œé¢‘çŽ‡,ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´GCéœ€è¦æ›´é•¿çš„æš‚åœæ—¶é—´æ¥æ‰§è¡Œå†…å­˜å›žæ”¶ã€‚ç›¸åçš„,å¦‚æžœé€‰æ‹©ä»¥ä½Žå»¶è¿Ÿä¼˜å…ˆä¸ºåŽŸåˆ™,é‚£ä¹ˆä¸ºäº†é™ä½Žæ¯æ¬¡æ‰§è¡Œå†…å­˜å›žæ”¶æ—¶çš„æš‚åœæ—¶é—´,ä¹Ÿåªèƒ½é¢‘ç¹åœ°æ‰§è¡Œå†…å­˜å›žæ”¶,ä½†è¿™åˆå¼•èµ·äº†å¹´è½»ä»£å†…å­˜çš„ç¼©å‡å’Œå¯¼è‡´ç¨‹åºåžåé‡çš„ä¸‹é™ã€‚ ä¸¾ä¸ªä¾‹å­,åœ¨60sçš„JVMæ€»è¿è¡Œæ—¶é—´é‡Œ,GCçš„æ‰§è¡Œé¢‘çŽ‡æ˜¯20ç§’/æ¬¡,é‚£ä¹ˆ60så†…ä¸€å…±ä¼šæ‰§è¡Œ3æ¬¡å†…å­˜å›žæ”¶,æŒ‰ç…§æ¯æ¬¡GCè€—æ—¶100msæ¥è®¡ç®—,æœ€ç»ˆä¸€å…±ä¼šæœ‰300ms(3Ã—100)è¢«ç”¨äºŽæ‰§è¡Œåžƒåœ¾å›žæ”¶ã€‚ä½†æ˜¯å¦‚æžœæˆ‘ä»¬å°†é€‰é¡¹â€œ-XX:MaxGCPauseMillsâ€çš„å€¼è°ƒå°åŽ,å¹´è½»ä»£çš„å†…å­˜ç©ºé—´ä¹Ÿä¼šè‡ªåŠ¨è°ƒæ•´,å†…å­˜ç©ºé—´è¶Šå°å°±è¶Šå®¹æ˜“è¢«è€—å°½,ä¹Ÿå°±è¶Šå®¹æ˜“é€ æˆGCçš„æ‰§è¡Œé¢‘ç¹å‘ç”Ÿã€‚ä¹‹å‰åœ¨60sçš„JVMæ€»è¿è¡Œæ—¶é—´é‡Œ,æœ€ç»ˆä¼šæœ‰300msè¢«ç”¨äºŽæ‰§è¡Œå†…å­˜å›žæ”¶,è€Œå¦‚ä»ŠGCçš„æ‰§è¡Œé¢‘çŽ‡å´æ˜¯10s/æ¬¡,60så†…å°†ä¼šæ‰§è¡Œ6æ¬¡å†…å­˜å›žæ”¶,æŒ‰ç…§æ¯æ¬¡GCè€—æ—¶60msæ¥è®¡ç®—,è™½ç„¶çœ‹ä¸ŠåŽ»æš‚åœæ—¶é—´æ›´çŸ­äº†,ä½†æœ€ç»ˆä¼šè€—æ—¶360ms(6Ã—60)ç”¨äºŽæ‰§è¡Œå†…å­˜å›žæ”¶,å¾ˆæ˜Žæ˜¾ç¨‹åºçš„åžåé‡ä¸‹é™äº†ã€‚æ‰€ä»¥å¤§å®¶åœ¨è®¾ç½®è¿™ä¸¤ä¸ªé€‰é¡¹æ—¶,ä¸€å®šéœ€è¦æ³¨æ„æŽ§åˆ¶åœ¨ä¸€ä¸ªæŠ˜ä¸­çš„èŒƒå›´ä¹‹å†…ã€‚Parallelæ”¶é›†å™¨è¿˜æä¾›ä¸ªâ€œ-XX:UseAdaptiveSizePolicyâ€é€‰é¡¹ç”¨äºŽè®¾ç½®GCçš„è‡ªåŠ¨åˆ†ä»£å¤§å°è°ƒèŠ‚ç­–ç•¥,ä¸€æ—¦è®¾ç½®è¿™ä¸ªé€‰é¡¹åŽ,å°±æ„å‘³ç€å¼€å‘äººå‘˜å°†ä¸å†éœ€è¦æ˜¾å¼åœ°è®¾ç½®å¹´è½»ä»£ä¸­çš„ä¸€äº›ç»†èŠ‚å‚æ•°,JVMä¼šæ ¹æ®è‡ªèº«å½“å‰çš„è¿è¡Œæƒ…å†µåŠ¨æ€è°ƒæ•´è¿™äº›ç›¸å…³å‚æ•°ã€‚ Garbage First (G1) GCG1å¾ˆé‡è§†è€å¹´ä»£çš„åžƒåœ¾å›žæ”¶,ä¸€æ—¦æ•´ä¸ªå †ç©ºé—´å æœ‰çŽ‡è¾¾åˆ°æŒ‡å®šçš„é˜ˆå€¼(å¯åŠ¨æ—¶å¯é…ç½®),G1ä¼šç«‹å³å¯åŠ¨ä¸€ä¸ªç‹¬å çš„å¹¶è¡Œåˆå§‹æ ‡è®°é˜¶æ®µ(inil-mark phase)è¿›è¡Œåžƒåœ¾å›žæ”¶ã€‚åœ¨G1 GC,åˆ¤æ–­çš„æ˜¯æ•´ä¸ªJavaå †å†…éƒ¨è€å¹´ä»£çš„å æœ‰çŽ‡,è¶³ä»¥è§G1å¯¹è€å¹´ä»£çš„é‡è§†ã€‚ åˆå§‹æ ‡è®°é˜¶æ®µä¸€èˆ¬å’Œå¹´è½»ä»£GCä¸€èµ·è¿è¡Œ,ä¸€æ—¦åˆå§‹æ ‡è®°é˜¶æ®µç»“æŸ,å¹¶è¡Œå¤šçº¿ç¨‹çš„æ ‡è®°é˜¶æ®µå°±å¼€å§‹å¯åŠ¨åŽ»æ ‡è®°æ‰€æœ‰è€å¹´ä»£è¿˜å­˜æ´»çš„å¯¹è±¡,æ³¨æ„è¿™ä¸ªæ ‡è®°é˜¶æ®µä¸æ˜¯ç‹¬å å¼çš„,å®ƒå…è®¸åº”ç”¨ç¨‹åºçº¿ç¨‹å’Œå®ƒå¹¶è¡Œæ‰§è¡Œã€‚å½“è¿™ä¸ªæ ‡è®°é˜¶æ®µè¿è¡Œå®Œæ¯•ä¹‹åŽ,ä¸ºäº†å†æ¬¡ç¡®è®¤æ˜¯å¦æœ‰é€ƒè¿‡æ‰«æçš„å¯¹è±¡,â€œå¯åŠ¨ä¸€ä¸ªç‹¬å å¼çš„å†æ¬¡æ ‡è®°é˜¶æ®µ(remark phase),å°è¯•æ ‡è®°æ‰€æœ‰é—æ¼çš„å¯¹è±¡ã€‚åœ¨è¿™ä¸ªå†æ¬¡æ ‡è®°é˜¶æ®µç»“æŸä¹‹åŽ,G1å°±æŽŒæ¡äº†æ‰€æœ‰çš„è€å¹´ä»£ Regionçš„æ ‡è®°ä¿¡æ¯,è¿™å’Œå›½å®¶çš„æˆ·å£ç»Ÿè®¡æ–¹å¼å·®ä¸å¤šã€‚ä¸€æ—¦è€å¹´ä»£çš„æŸäº›Regionå†…éƒ¨å­˜åœ¨ä»»ä½•çš„å­˜æ´»å¯¹è±¡,å®ƒå°±å¯ä»¥åœ¨ä¸‹ä¸€ä¸ªé˜¶æ®µ,å³æ¸…é™¤é˜¶æ®µ(cleanup phase)è¢«æ¸…é™¤äº†,å°±æ˜¯å¯ä»¥é”€æˆ·äº†,åˆè¢«æ”¾å›žäº†å¯ç”¨Regioné˜Ÿåˆ—ã€‚åŒæ ·åœ°,å†æ¬¡æ ‡è®°é˜¶æ®µç»“æŸåŽå°±å¯ä»¥å¯¹ä¸€äº›è€å¹´ä»£æ‰§è¡Œæ”¶é›†åŠ¨ä½œã€‚ å‰é¢æåˆ°äº†CSetæ¦‚å¿µ,ä¸€ä¸ªCSeté‡Œé¢å¯ä»¥åŒ…å«å¤šå°‘Regionå–å†³äºŽå¤šå°‘ç©ºé—´å¯ä»¥è¢«é‡Šæ”¾ã€G1åœé¡¿ç›®æ ‡æ—¶é—´è¿™ä¸¤ä¸ªå› ç´ ã€‚å‰é¢è¯´èµ·è¿‡æ··åˆGC(Mixed GC),è¿™é‡Œå°±è¦å…·ä½“è¯´æ˜Žä¸€ä¸‹äº†ã€‚å½“CSetè¢«ç¡®å®šä¹‹åŽ,ä¼šåœ¨æŽ¥ä¸‹æ¥çš„ä¸€ä¸ªå¹´è½»ä»£å›žæ”¶è¿‡ç¨‹å½“ä¸­å¯¹CSetè¿›è¡Œå›žæ”¶,é€šè¿‡å¹´è½»ä»£GCçš„å‡ ä¸ªé˜¶æ®µ,ä¸€éƒ¨åˆ†çš„è€å¹´ä»£Regionä¼šè¢«å›žæ”¶å¹¶æ”¾å…¥å¹´è½»ä»£ä½¿ç”¨ã€‚è¿™ä¸ªæ¦‚å¿µå¾ˆçµæ´»,å³G1åªå…³æ³¨ä½ æœ‰æ²¡æœ‰å­˜æ´»å¯¹è±¡äº†,å¦‚æžœæ²¡æœ‰,æ— è®ºä½ å±žäºŽè€å¹´ä»£,è¿˜æ˜¯å±žäºŽå¹´è½»ä»£,ä½ éƒ½ä¼šè¢«å›žæ”¶å¹¶æ”¾å…¥å¯ç”¨Regioné˜Ÿåˆ—,ä¸‹ä¸€æ¬¡ä½ è¢«åˆ†é…åˆ°å“ªé‡Œå°±ä¸ç¡®å®šäº†ã€‚ä¹Ÿæ­£æ˜¯å› ä¸ºRegionã€æ··åˆæ”¶é›†è¿™äº›ç‰¹æ€§,è®©G1å¯¹è€å¹´ä»£çš„åžƒåœ¾æ”¶é›†æ–¹å¼æœ‰åˆ«äºŽSerial GCã€Parallel GCå’ŒCMS GC,G1é‡‡ç”¨Regionæ–¹å¼è®©å¯¹è±¡ä¹‹é—´çš„è”ç³»å­˜åœ¨äºŽè™šæ‹Ÿåœ°å€ä¹‹ä¸Š,è¿™æ ·å°±ä¸éœ€è¦é’ˆå¯¹è€å¹´ä»£çš„åŽ‹ç¼©å’Œå›žæ”¶åŠ¨ä½œå¯¹æ•´ä¸ªJavaå †æ‰§è¡Œæ‰«æ,ä¸ºè€å¹´ä»£å›žæ”¶èŠ‚çº¦äº†æ—¶é—´ã€‚ G1 è®¾è®¡æ€è·¯GlæŠŠæ•´ä¸ªJavaå †åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªåŒºé—´(Region)ã€‚æ¯ä¸ªRegionå¤§å°ä¸º2çš„å€æ•°,èŒƒå›´åœ¨MB32MBä¹‹é—´,å¯èƒ½ä¸º1MBã€2MBã€4MBã€8MBã€16MBã€32MBã€‚æ‰€æœ‰çš„Regionæœ‰ä¸€æ ·çš„å¤§å°,åœ¨JVMç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šè¢«æ”¹å˜ã€‚ æ³¨æ„,åœ¨å¹´è½»ä»£ã€æ··åˆä»£ã€Full GCè¿™ä¸‰ä¸ªé˜¶æ®µ,å¹´è½»ä»£çš„Eden Regionå’ŒSurvivor Regionçš„æ•°é‡ä¼šéšæ—¶å˜åŒ–ã€‚Humongous Region(å¤§å¯¹è±¡ Region)æ˜¯è€å¹´ä»£Regionçš„ä¸€éƒ¨åˆ†,é‡Œé¢çš„å¯¹è±¡è¶…è¿‡æ¯ä¸ªRegionçš„50%ç©ºé—´,è¿™ä¸€ç‚¹æœ‰åˆ«äºŽä¸€èˆ¬å¯¹è±¡Regionã€‚ ä»Žä¹‹å‰çš„ä»‹ç»æˆ‘ä»¬çŸ¥é“æ²¡æœ‰å¿…è¦åŽ»åˆ»æ„åŒºåˆ†Regionçš„ç”¨é€”,å› ä¸ºG1è®¾è®¡Regionçš„åˆ†é…åŽŸåˆ™æ˜¯å¾ˆçµæ´»çš„ã€‚ä¸€å¼€å§‹G1ä¼šä»Žå¯ç”¨ Regioné˜Ÿåˆ—é‡Œé¢æŒ‘é€‰å‡ºRegionå¹¶è®¾ç½®ä¸ºEden Region,ä¸€ä¸ªEden Regioné‡Œé¢å¡«æ»¡å¯¹è±¡ä»¥åŽ,åˆä¼šä»Žå¯ç”¨Regioné˜Ÿåˆ—é‡Œå†æŒ‘å‡ºä¸€ä¸ªã€‚å½“æ‰€æœ‰çš„Eden Regionéƒ½è¢«å¡«æ»¡æ—¶,ä¸€ä¸ªå¹´è½»ä»£GCæ”¶é›†å°±ä¼šå¼€å§‹æ‰§è¡Œäº†,åœ¨è¿™ä¸ªæ”¶é›†é˜¶æ®µ,æˆ‘ä»¬ä¼šæ”¶é›†Edenå’ŒSurvivor Region,æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡è¦ä¹ˆè¿›å…¥åˆ°ä¸‹ä¸€ä¸ªSurvivor region,è¦ä¹ˆè¿›å…¥è€å¹´ä»£Regionã€‚ G1æä¾›äº†ä¸€ä¸ªé€‰é¡¹-XX:InitiatingHeapOccupancyPercent,é»˜è®¤å€¼æ˜¯Javaå †ç©ºé—´çš„45%,è¿™ä¸ªé€‰é¡¹å†³å®šäº†æ˜¯å¦å¼€å§‹ä¸€æ¬¡è€å¹´ä»£å›žæ”¶åŠ¨ä½œ,å³å¹´è½»ä»£GCç»“æŸä¹‹åŽ,G1ä¼šè¯„ä¼°å‰©ä½™çš„å¯¹è±¡æ˜¯å¦è¾¾åˆ°äº†45%è¿™ä¸ªé˜ˆå€¼ã€‚ å¦‚æžœæ ‡è®°é˜¶æ®µ(Marking Phase)ç»“æŸåŽä¸€ä¸ªè€å¹´ä»£çš„Regionå·²ç»ä¸å­˜åœ¨å¯¹è±¡,é‚£ä¹ˆå®ƒä¼šè¢«æ”¾å›žå¯ç”¨Regioné˜Ÿåˆ—,åä¹‹,å®ƒä¼šè¢«æ”¾å…¥æ··åˆæ”¶é›†å™¨ã€‚ ç”±äºŽæ ‡è®°é˜¶æ®µä¸æ˜¯ä¸€ä¸ªç‹¬å å¼çš„å¤šçº¿ç¨‹å¹¶è¡Œç¨‹åº,è¿™æ ·åº”ç”¨ç¨‹åºçº¿ç¨‹å°±ä¼šå’Œå®ƒä¸€èµ·å¹¶è¡Œæ‰§è¡Œã€‚ä¸ºäº†é¿å…æ ‡è®°é˜¶æ®µå ç”¨è¿‡å¤šçš„CPUèµ„æº,G1é‡‡ç”¨æ—¶é—´ç‰‡æ–¹å¼åˆ†æ®µæ‰§è¡Œæ“ä½œ,å³åœ¨æ—¶é—´ç‰‡å†…å…¨åŠ›è¿è¡Œ,ç„¶åŽä¼‘æ¯ä¸€æ®µæ—¶é—´,è¿™ä¸ªä¼‘æ¯æ—¶é—´å°±æ˜¯è®©åº”ç”¨ç¨‹åºå°½å¯èƒ½å¤šåœ°ä½¿ç”¨CPUèµ„æºè¿è¡Œã€‚ å¤§å¯¹è±¡(Humongous Object)å¤§å¯¹è±¡Regionå±žäºŽè€å¹´ä»£çš„ä¸€éƒ¨åˆ†,å®ƒåªåŒ…å«ä¸€ä¸ªå¯¹è±¡ã€‚å½“å¹¶è¡Œæ ‡è®°é˜¶æ®µå‘çŽ°æ²¡æœ‰å­˜æ´»å¯¹è±¡æ—¶,G1ä¼šå›žæ”¶è¿™ä¸ªå¤§å¯¹è±¡ Region,æ³¨æ„è¿™ä¸ªåŠ¨ä½œå¯ä»¥æ˜¯ä¸€ä¸ªæ‰¹é‡å›žæ”¶ã€‚ å…¨åžƒåœ¾æ”¶é›†(Full Garbage Collection)G1çš„Full GCå’ŒSerial goçš„FuGCé‡‡ç”¨çš„æ˜¯åŒä¸€ç§ç®—æ³•ã€‚Full GCä¼šå¯¹æ•´ä¸ªJavaå †è¿›è¡ŒåŽ‹ç¼©ã€‚G1çš„Full GCæ˜¯å•çº¿ç¨‹çš„,ä¼šå¼•èµ·è¾ƒé•¿çš„åœé¡¿æ—¶é—´,å› æ­¤G1çš„è®¾è®¡ç›®æ ‡æ˜¯å‡å°‘Full GCçš„å‘ç”Ÿæ¬¡æ•°ã€‚ å¹¶è¡Œå¾ªçŽ¯(Concurrent Cycle)ä¸€ä¸ªG1å¹¶è¡Œå¾ªçŽ¯åŒ…æ‹¬å‡ ä¸ªé˜¶æ®µçš„æ´»åŠ¨:åˆå§‹æ ‡è®°(Initial Marking)ã€å¹¶è¡ŒRootåŒºé—´æ‰«æ(Concurrent Root Region Scanning)ã€å¹¶è¡Œæ ‡è®°(Concurrent Marking)ã€é‡æ ‡è®°(Remarking)å’Œæ¸…é™¤(Cleanup)ã€‚é™¤äº†æœ€åŽçš„Cleanupé˜¶æ®µä»¥å¤–,å…¶ä½™é˜¶æ®µéƒ½å±žäºŽæ ‡è®°å­˜æ´»å¯¹è±¡é˜¶æ®µã€‚ åˆå§‹æ ‡è®°é˜¶æ®µçš„ç›®çš„æ˜¯æ”¶é›†æ‰€æœ‰GCæ ¹(Roots)ã€‚ Rootsæ˜¯ä¸€ä¸ªå¯¹è±¡çš„èµ·æºæŒ‡é’ˆã€‚ä¸ºäº†æ”¶é›†æ ¹å¼•ç”¨,ä»Žåº”ç”¨çº¿ç¨‹å¼€å§‹,åº”ç”¨çº¿ç¨‹å¿…é¡»åœä¸‹æ¥,æ‰€ä»¥åˆå§‹æ ‡è®°é˜¶æ®µæ˜¯ä¸€ä¸ªç‹¬å å¼çš„ã€‚ç”±äºŽä¸ªå¹´è½»ä»£GCå¿…é¡»æ”¶é›†æ‰€æœ‰çš„Roots,æ‰€ä»¥G1çš„åˆå§‹æ ‡è®°åœ¨ä¸€ä¸ªå¹´è½»ä»£GCé‡Œå®Œæˆã€‚ å¹¶è¡Œæ ¹åŒºé—´æ‰«æé˜¶æ®µå¿…é¡»æ‰«æå’Œæ ‡è®°æ‰€æœ‰å¹¸å­˜è€…åŒºé—´çš„å¯¹è±¡å¼•ç”¨,è¿™ä¸€é˜¶æ®µæ‰€æœ‰çš„åº”ç”¨ç¨‹åºçº¿ç¨‹éƒ½å¯ä»¥å¹¶è¡Œæ‰§è¡Œ,å”¯ä¸€çš„çº¦æŸæ˜¯æ‰«æå¿…é¡»åœ¨ä¸‹ä¸€ä¸ªGCå¼€å§‹å‰å®Œæˆã€‚è¿™ä¸€çº¦æŸçš„åŽŸå› æ˜¯ä¸ªæ–°çš„GCäº‹ä»¶ä¼šäº§ç”Ÿä¸€å †æ–°çš„å¹¸å­˜è€…å¯¹è±¡é›†åˆ,è¿™äº›å¯¹è±¡å’Œåˆå§‹åŒ–æ ‡è®°é˜¶æ®µçš„å¹¸å­˜è€…å¯¹è±¡ä¸ä¸€æ ·,å®¹æ˜“å‘ç”Ÿæ··æ·†ã€‚ å¹¶è¡Œæ ‡è®°é˜¶æ®µå®Œæˆäº†å‡ ä¹Žæ‰€æœ‰çš„æ ‡è®°å·¥ä½œã€‚åœ¨è¿™ä¸€é˜¶æ®µ,åˆ©ç”¨å¤šçº¿ç¨‹å¹¶è¡Œæ ‡è®°å­˜æ´»å¯¹è±¡åŠå¯¹åº”çš„é€»è¾‘åœ°å›¾ã€‚è¿™ä¸€é˜¶æ®µå…è®¸æ‰€æœ‰çš„Javaçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œ,ä½†æ˜¯å¯¹åº”ç”¨ç¨‹åºæ¥è¯´æ€»ä½“çš„åžåé‡å¯èƒ½ä¼šä¸‹é™ã€‚å…¶å®žä»»ä½•ä¸€ä¸ªç³»ç»Ÿéƒ½å’Œäººä½“å¾ªçŽ¯ä¸€æ ·,å½“æ²¡æœ‰å¤–éƒ¨å¹²æ‰°æ—¶,ç³»ç»Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå¦‚æžœå—åˆ°å¤–éƒ¨å¹²æ‰°,äººä½“ç³»ç»Ÿä¹Ÿä¼šå‡ºçŽ°æ··ä¹±,ç”šè‡³å‡ºçŽ°çŸ­æ—¶é—´çš„ä¼‘å…‹ã€‚ é‡æ ‡è®°é˜¶æ®µæ˜¯ä¸€ä¸ªç‹¬å å¼é˜¶æ®µ,é€šå¸¸æ˜¯ä¸€ä¸ªå¾ˆçŸ­çš„åœé¡¿,è¿™ä¸ªé˜¶æ®µä¼šå®Œæˆæ‰€æœ‰çš„æ ‡è®°å·¥ä½œã€‚ æœ€åŽä¸€ä¸ªå¹¶è¡Œæ ‡è®°æ­¥éª¤æ˜¯æ¸…é™¤é˜¶æ®µã€‚åœ¨è¿™ä¸ªé˜¶æ®µ,æ²¡æœ‰åŒ…å«å­˜æ´»å¯¹è±¡çš„Regionä¼šè¢«å›žæ”¶,å¹¶éšå³è¢«åŠ å…¥å¯ç”¨Regioné˜Ÿåˆ—ã€‚è¿™ä¸ªé˜¶æ®µçš„é‡è¦æ„ä¹‰æ˜¯æœ€ç»ˆå†³å®šäº†å“ªäº› Regionå¯ä»¥è¿›å…¥æ··åˆGCã€‚åœ¨G1å†…éƒ¨,æ··åˆGCæ˜¯éžå¸¸é‡è¦çš„é‡Šæ”¾å†…å­˜æœºåˆ¶,é¿å…äº†G1å‡ºçŽ°æ²¡æœ‰å¯ç”¨Regionçš„æƒ…å†µå‘ç”Ÿ,å¦åˆ™å°±ä¼šè§¦å‘Full GCäº‹ä»¶ã€‚ å †å¤§å°ï¼ˆHeap Sizingï¼‰G1åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹å¯èƒ½ä¼šå¢žå¤§å †å†…å­˜å¤§å°ï¼š Full GCé˜¶æ®µã€‚ Youngæˆ–Mixed GCå‘ç”Ÿæ—¶,G1è®¡ç®—GCèŠ±è´¹çš„æ—¶é—´ä¸ŽJavaçº¿ç¨‹çš„èŠ±è´¹æ—¶é—´æ¯”ä¾‹,å¦‚æžœ-XX:GCTimeRatioè®¾ç½®GCèŠ±è´¹æ—¶é—´å¾ˆé•¿,åˆ™å †å¤§å°ä¼šå¢žå¤§,è¿™æ ·çš„è®¾è®¡æ€è·¯æ˜¯å¸Œæœ›G1å‘ç”ŸGCçš„é¢‘çŽ‡é™ä½Ž,è¿™æ ·GCèŠ±è´¹æ—¶é—´å’ŒJavaçº¿ç¨‹èŠ±è´¹æ—¶é—´æ¯”ä¾‹ä¹Ÿä¼šç›¸åº”ä¸‹é™ã€‚ -XX:GCTimeRatioé€‰é¡¹çš„é»˜è®¤å€¼æ˜¯9,æ‰€æœ‰å…¶ä»–HotSpot GCçš„é»˜è®¤å€¼æ˜¯99ã€‚è¿™ä¸ªå€¼è¶Šå¤§,ä»£è¡¨Javaå †ç©ºé—´å¤§å°å¢žé•¿è¶Šåæ¿€,å³è¶Šå®¹æ˜“æ‰©å¤§å †ç©ºé—´å¤§å°,è¿™æ ·ä¹Ÿæ˜¯ä¸ºäº†è¾¾åˆ°é™ä½ŽGCèŠ±è´¹æ—¶é—´çš„è®¾è®¡ç›®æ ‡ã€‚ å¦‚æžœä¸€ä¸ªå¯¹è±¡åˆ†é…å¤±è´¥,å³ä¾¿ä¸€ä¸ªGCåˆšåˆšç»“æŸ,G1é‡‡ç”¨çš„ç­–ç•¥ä¸æ˜¯ç«‹å³é‡å¤Full GCï¼Œè€Œæ˜¯é€šè¿‡å¢žå¤§å †å†…å­˜å¤§å°,ç¡®ä¿å¯¹è±¡åˆ†é…æˆåŠŸã€‚è¿™æ ·çš„è®¾è®¡ç†å¿µç¬¦åˆG1çš„é¿å…Full GCå‘ç”Ÿçš„æœ€åˆæ€æƒ³ã€‚ å’Œç¬¬3æ¡ä¸€æ ·,å¦‚æžœå‡ºçŽ°ä¸€ä¸ªå¤§å¯¹è±¡åˆ†é…å¤±è´¥,å‰é¢è¯´è¿‡,å¤§å¯¹è±¡éœ€è¦å‡ ä¸ªè¿žç»­çš„RegionåŒºé—´æ‰èƒ½ç¡®ä¿å¯¹è±¡åˆ†é…æˆåŠŸã€‚å¦‚æžœå‘ç”Ÿè¿™ç§åˆ†é…å¤±è´¥çš„æƒ…å†µ,é‡‡ç”¨çš„è®¾è®¡ç†å¿µä¹Ÿä¸æ˜¯è°ƒç”¨Full GC,è€Œæ˜¯æ‰©å¤§å †å†…å­˜ã€‚ å½“GCç”³è¯·åŠ å…¥ä¸€ä¸ªæ–°çš„Regionæ—¶ã€‚ å¼•ç”¨ä¸€æ®µåœ¨StackOverfall.comä¸Šçœ‹åˆ°çš„ç»éªŒåˆ†äº«,â€æˆ‘åœ¨ä¸€ä¸ªçœŸå®žçš„ã€è¾ƒå¤§è§„æ¨¡çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿‡G1:å¤§çº¦åˆ†é…æœ‰60B-70GBå†…å­˜,å­˜æ´»å¯¹è±¡å¤§çº¦åœ¨20GB50GBä¹‹é—´ã€‚æœåŠ¡å™¨è¿è¡ŒLinuxæ“ä½œç³»ç»Ÿ,JDKç‰ˆæœ¬ä¸º6u22ã€‚G1ä¸ŽPS/PS Oldç›¸æ¯”,æœ€å¤§çš„å¥½å¤„æ˜¯åœé¡¿æ—¶é—´æ›´åŠ å¯æŽ§å¯é¢„æµ‹ã€‚å¦‚æžœæˆ‘åœ¨PSä¸­è®¾ç½®ä¸€ä¸ªå¾ˆä½Žçš„æœ€å¤§å…è®¸GCæ—¶é—´,è­¬å¦‚æœŸæœ›50mså†…å®ŒæˆGC(-XX:MaxGCPauseMillis=50),ä½†åœ¨65GBçš„Javaå †ä¸‹æœ‰å¯èƒ½å¾—åˆ°çš„ç›´æŽ¥ç»“æžœæ˜¯ä¸€æ¬¡é•¿è¾¾30sè‡³2minçš„æ¼«é•¿çš„Stop-the-Worldè¿‡ç¨‹ã€‚è€ŒGlä¸ŽCMSç›¸æ¯”,å®ƒä»¬éƒ½ç«‹è¶³äºŽä½Žåœé¡¿æ—¶é—´,CMSä»ç„¶æ˜¯æˆ‘çŽ°åœ¨çš„é€‰æ‹©,ä½†æ˜¯éšç€Oracleå¯¹G1çš„æŒç»­æ”¹è¿›,æˆ‘ç›¸ä¿¡Glä¼šæ˜¯æœ€ç»ˆçš„èƒœåˆ©è€…ã€‚å¦‚æžœä½ çŽ°åœ¨é‡‡ç”¨çš„æ”¶é›†å™¨æ²¡æœ‰å‡ºçŽ°é—®é¢˜,é‚£ä¹ˆå°±æ²¡æœ‰ä»»ä½•ç†ç”±çŽ°åœ¨åŽ»é€‰æ‹©G1;å¦‚æžœä½ çš„åº”ç”¨è¿½æ±‚ä½Žåœé¡¿,é‚£ä¹ˆG1çŽ°åœ¨å·±ç»å¯ä»¥ä½œä¸ºä¸€ä¸ªå¯å°è¯•çš„é€‰æ‹©:å¦‚æžœä½ çš„åº”ç”¨è¿½æ±‚åžåé‡,é‚£ä¹ˆG1å¹¶ä¸ä¼šä¸ºä½ å¸¦æ¥ä»€ä¹ˆç‰¹åˆ«çš„å¥½å¤„ã€‚â€ G1 GCåº”ç”¨ç¤ºä¾‹G1 GCç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šçš„å‘½ä»¤è¡Œé€‰é¡¹,ä¹Ÿå°±æ˜¯å‚æ•°,è¿™äº›å‚æ•°ä¸€ç±»ä»¥å¸ƒå°”ç±»åž‹æ‰“å¤´,â€œ+â€è¡¨ç¤ºå¯ç”¨è¯¥é€‰é¡¹,â€œ-â€è¡¨ç¤ºå…³é—­è¯¥é€‰é¡¹ã€‚å¦ä¸€ç±»é‡‡ç”¨æ•°å­—èµ‹å€¼,ä¸éœ€è¦å¸ƒå°”ç±»åž‹æ‰“å¤´ã€‚ é€‰é¡¹è§£é‡ŠåŠåº”ç”¨é¦–å…ˆåœ¨cmdå‘½ä»¤è¡Œæ¨¡å¼ä¸‹è¾“å…¥java -X,,å¦‚C:Users\Administrator&gt; java -X,è¾“å‡ºå¦‚ä»£ç å¦‚ä¸‹ï¼š -XX:+PrintGCDetailsè¯¥é€‰é¡¹ç”¨äºŽè®°å½•GCè¿è¡Œæ—¶çš„è¯¦ç»†æ•°æ®ä¿¡æ¯å¹¶è¾“å‡º,æ˜¯æœ€åŸºæœ¬ã€ä½¿ç”¨æœ€æ™®éçš„ä¸€ä¸ªé€‰é¡¹è¿™ä¸ªé€‰é¡¹é€‚ç”¨äºŽæ‰€æœ‰GC,è¾“å‡ºå†…å®¹ä¸»è¦åŒ…æ‹¬æ–°ç”Ÿæˆå¯¹è±¡å ç”¨å†…å­˜å¤§å°ä»¥åŠè€—è´¹æ—¶é—´ã€å„ä¸ªå¹´é¾„ä»£çš„æƒ…å†µã€æ¯æ¬¡å›žæ”¶çš„å¯¹åº”æ•°æ®ç­‰ã€‚ -Xloggcå¦‚æžœæƒ³è¦ä»¥æ–‡ä»¶å½¢å¼ä¿å­˜è¿™äº›GCæ—¥å¿—,å¯ä»¥åœ¨å¯åŠ¨å‚æ•°ä¸­è¾“å…¥-XX:+PrintGCDetails -verbose:gc -XLoggc:gc.log,è¿è¡ŒåŽæˆ‘ä»¬ä¼šå‘çŽ°ç”Ÿæˆäº†ä¸€ä¸ª gc.logæ–‡ä»¶ã€‚ -Xloggc:example_gc.log ï¼ˆè®¾ç½®åžƒåœ¾å›žæ”¶æ—¥å¿—æ‰“å°çš„æ–‡ä»¶ï¼Œæ–‡ä»¶åç§°å¯ä»¥è‡ªå®šä¹‰ï¼‰ -XX:initialHeapSizeå’Œ-XX:MaxHeapSizeå°±æ˜¯æˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„-Xmså’Œ-Xmx,å®ƒä»¬å…è®¸æˆ‘ä»¬æŒ‡å®šJVMçš„åˆå§‹å’Œæœ€å¤§å †å†…å­˜å¤§å°-XX:+UseCompressedClassPointersã€XX:+UseCompressedOopsä»¥åŠ-XX:-UseLargePagesIndividualAllocationè¿™ä¸‰ä¸ªé€‰é¡¹å’ŒOOPæœ‰å…³ã€‚OOPçš„å…¨ç§°æ˜¯Ordinary Object Pointer,å³æ™®é€šå¯¹è±¡æŒ‡é’ˆã€‚é€šå¸¸64ä½JVMæ¶ˆè€—çš„å†…å­˜ä¼šæ¯”32ä½çš„å¤§1.5å€,è¿™æ˜¯å› ä¸ºå¯¹è±¡æŒ‡é’ˆåœ¨64ä½æž¶æž„ä¸‹,é•¿åº¦ä¼šç¿»å€(æ›´å®½çš„å¯»å€)ã€‚å¯¹äºŽé‚£äº›å°†è¦ä»Ž32ä½å¹³å°ç§»æ¤åˆ°64ä½çš„åº”ç”¨æ¥è¯´,å¹³ç™½æ— æ•…å¤šäº†1/2çš„å†…å­˜å ç”¨,ä½œä¸ºå¼€å‘è€…ä¸€å®šä¸æ„¿æ„çœ‹åˆ°è¿™ç§åœºæ™¯ã€‚æ‰€ä»¥,ä»ŽJDK1.6 update4å¼€å§‹,64 bit JVMæ­£å¼æ”¯æŒäº†-XX:+UseCompressedOopsè¿™ä¸ªå¯ä»¥åŽ‹ç¼©æŒ‡é’ˆ,èµ·åˆ°èŠ‚çº¦å†…å­˜å ç”¨çš„é€‰é¡¹ã€‚CompressedOopsçš„å®žçŽ°æ–¹å¼æ˜¯åœ¨æœºå™¨ç ä¸­æ¤å…¥åŽ‹ç¼©ä¸Žè§£åŽ‹æŒ‡ä»¤,å¯èƒ½ä¼šç»™JVMå¢žåŠ é¢å¤–çš„å¼€é”€ã€‚-XX:+UseCompressedClassPointersé€‰é¡¹æ˜¯åœ¨JDK8å‡ºçŽ°çš„,ä¹Ÿæ˜¯åœ¨æ°¸ä¹…åŒºæ¶ˆå¤±ä¹‹åŽå‡ºçŽ°çš„æ–°çš„é€‰é¡¹,ä¸»è¦ç”¨äºŽå¯¹ç±»çš„å…ƒæ•°æ®è¿›è¡ŒåŽ‹ç¼©ã€‚-XX:UseLargePagesIndividualAllocationå’Œoopsæ˜¯ä¸€èµ·ä½¿ç”¨çš„,åœ¨å¤§é¡µå†…å­˜ä½¿ç”¨å‘ç”Ÿæ—¶è¿™ä¸ªé€‰é¡¹ä¹Ÿä¼šè‡ªåŠ¨å¯ç”¨ã€‚ -XX:+PrintGCApplicationStoppedTimeæ‰“å°åžƒåœ¾å›žæ”¶æœŸé—´ç¨‹åºæš‚åœçš„æ—¶é—´,å¦‚æžœä½¿ç”¨è¯¥é€‰é¡¹,ä¼šè¾“å‡ºGCé€ æˆåº”ç”¨ç¨‹åºæš‚åœçš„æ—¶é—´ã€‚ä¸€èˆ¬å’Œ-XX:+PrintGCApplicationConcurrentTimeç»„åˆèµ·æ¥ä¸€èµ·ä½¿ç”¨,è¿™æ ·æ¯”è¾ƒæœ‰åˆ©äºŽæŸ¥çœ‹è¾“å‡ºã€‚ -XX:ConcGCThreadsè¿™ä¸ªé€‰é¡¹ç”¨æ¥è®¾ç½®ä¸ŽJavaåº”ç”¨ç¨‹åºçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œçš„GCçº¿ç¨‹æ•°é‡,é»˜è®¤ä¸ºGCç‹¬å æ—¶è¿è¡Œçº¿ç¨‹çš„1/4ã€‚è¿™ä¸ªé€‰é¡¹è®¾ç½®è¿‡å¤§ä¼šå¯¼è‡´Javaåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨çš„CPUèµ„æºå‡å°‘,å¦‚æžœå°ä¸€ç‚¹åˆ™ä¼šå¯¹åº”ç”¨ç¨‹åºæœ‰åˆ©,ä½†æ˜¯è¿‡å°å°±ä¼šå¢žåŠ GCå¹¶è¡Œå¾ªçŽ¯çš„æ‰§è¡Œæ—¶é—´,åè¿‡æ¥å‡å°‘Javaåº”ç”¨ç¨‹åºçš„è¿è¡Œæ—¶é—´(å› ä¸ºç‹¬å æœŸæ—¶é—´æ‹‰é•¿)ã€‚ -XX:G1HeapRegionSizeè¿™æ˜¯G1GCç‹¬æœ‰çš„é€‰é¡¹,å®ƒæ˜¯ä¸“é—¨é’ˆå¯¹Regionè¿™ä¸ªæ¦‚å¿µçš„å¯¹åº”è®¾ç½®é€‰é¡¹,åŽç»­GCåº”è¯¥ä¼šç»§ç»­é‡‡ç”¨ Regionè¿™ä¸ªæ¦‚å¿µã€‚ Regionçš„å¤§å°é»˜è®¤ä¸ºå †å¤§å°çš„1/200,.ä¹Ÿå¯ä»¥è®¾ç½®ä¸º1MBã€2MBã€4MBã€8MBã€16MB,ä»¥åŠ32MB,è¿™å…­ä¸ªåˆ’åˆ†æ¡£æ¬¡ã€‚ å¢žå¤§Regionå—çš„å¤§å°æœ‰åˆ©äºŽå¤„ç†å¤§å¯¹è±¡ã€‚å‰é¢ä»‹ç»è¿‡,å¤§å¯¹è±¡æ²¡æœ‰æŒ‰ç…§æ™®é€šå¯¹è±¡æ–¹å¼è¿›è¡Œç®¡ç†å’Œåˆ†é…ç©ºé—´,å¦‚æžœå¢žå¤§Regionå—çš„å¤§å°,åˆ™ä¸€äº›åŽŸæœ¬èµ°ç‰¹æ®Šå¤„ç†é€šé“çš„å¤§å¯¹è±¡å°±å¯ä»¥è¢«çº³å…¥æ™®é€šå¤„ç†é€šé“äº†ã€‚è¿™å°±å¥½æ¯”æˆ‘ä»¬åœ¨æœºåœºå®‰æ£€,é£žè¡Œå‘˜ã€ç©ºå§å¯ä»¥èµ°ç‰¹æ®Šé€šé“,ä¹˜å®¢å¦‚æžœä¹Ÿæžç‰¹æ®ŠåŒ–,ä¸€éƒ¨åˆ†äººåŽ»ç‰¹æ®Šé€šé“å¤„ç†,é‚£ä¹ˆç‰¹æ®Šé€šé“å°±å¾—å¢—åŠ å‡ ä¸ª,ç›¸åº”çš„æ™®é€šé€šé“å°±å¾—å‡å°‘äº†,å¯¹æ•ˆçŽ‡å°±èµ·äº†é™ä½Žä½œç”¨ã€‚åä¹‹,å¦‚æžœRegionå¤§å°è®¾ç½®è¿‡å°,åˆ™ä¼šé™ä½ŽG1çš„çµæ´»æ€§,å¯¹äºŽå„ä¸ªå¹´é¾„ä»£çš„å¤§å°éƒ½ä¼šé€ æˆåˆ†é…é—®é¢˜ã€‚ -XX:G1HeapWastePercentè¿™ä¸ªé€‰é¡¹æŽ§åˆ¶G1 GCä¸ä¼šå›žæ”¶çš„ç©ºé—²å†…å­˜æ¯”ä¾‹,é»˜è®¤æ˜¯å †å†…å­˜çš„5%ã€‚G1 GCåœ¨å›žæ”¶è¿‡ç¨‹ä¸­ä¼šå›žæ”¶æ‰€æœ‰Regionçš„å†…å­˜,å¹¶æŒç»­åœ°åšè¿™ä¸ªå·¥ä½œç›´åˆ°ç©ºé—²å†…å­˜æ¯”ä¾‹è¾¾åˆ°è®¾ç½®çš„è¿™ä¸ªå€¼ä¸ºæ­¢,æ‰€ä»¥å¯¹äºŽè®¾ç½®äº†è¾ƒå¤§å€¼çš„å †å†…å­˜æ¥è¯´,éœ€è¦é‡‡ç”¨æ¯”è¾ƒä½Žçš„æ¯”ä¾‹,è¿™æ ·å¯ä»¥ç¡®ä¿è¾ƒå°éƒ¨åˆ†çš„å†…å­˜ä¸è¢«å›žæ”¶ã€‚è¿™ä¸ªå¾ˆå®¹æ˜“ç†è§£,åŸŽå¸‚è¶Šå¤§å°±è¶Šå®¹æ˜“å‡ºçŽ°ä¸€äº›æ­»è§’,å‡ºäºŽæ€§èƒ½çš„åŽŸå› å¯ä»¥ä¸åŽ»å…³æ³¨é‚£é‡Œ,ä½†æ˜¯è¿™ä¸ªæ¯”ä¾‹ä¸èƒ½å¤§ã€‚ -XX:G1MixedGCCountTargetè€å¹´ä»£Regionçš„å›žæ”¶æ—¶é—´é€šå¸¸æ¥è¯´æ¯”å¹´è½»ä»£Regionç¨é•¿ä¸€äº›,è¿™ä¸ªé€‰é¡¹å¯ä»¥è®¾ç½®ä¸€ä¸ªå¹¶è¡Œå¾ªçŽ¯ä¹‹åŽå¯åŠ¨å¤šå°‘ä¸ªæ··åˆGC,é»˜è®¤å€¼æ˜¯8ä¸ªã€‚è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼å¯ä»¥è®©G1 GCåœ¨è€å¹´ä»£Regionå›žæ”¶æ—¶å¤šèŠ±ä¸€äº›æ—¶é—´,å¦‚æžœä¸€ä¸ªæ··åˆGCçš„åœé¡¿æ—¶é—´å¾ˆé•¿,è¯´æ˜Žå®ƒè¦åšçš„äº‹æƒ…å¾ˆå¤š,æ‰€ä»¥å¯ä»¥å¢žå¤§è¿™ä¸ªå€¼çš„è®¾ç½®,ä½†æ˜¯å¦‚æžœè¿™ä¸ªå€¼è¿‡å¤§,ä¹Ÿä¼šé€ æˆå¹¶è¡Œå¾ªçŽ¯ç­‰å¾…æ··åˆGCå®Œæˆçš„æ—¶é—´ç›¸åº”çš„å¢žåŠ ã€‚ å½“å ç”¨å†…å­˜è¶…è¿‡InitiatingHeapOccupancyPercenté˜€å€¼æ—¶, æœ€å¤šé€šè¿‡å¤šå°‘æ¬¡Mixed GCæ¥å°†å†…å­˜æŽ§åˆ¶åœ¨é˜€å€¼ä¹‹ä¸‹ã€‚ -XX:+G1PrintRegionLivenessInfoç”±äºŽå¼€å¯è¿™ä¸ªé€‰é¡¹ä¼šåœ¨æ ‡è®°å¾ªçŽ¯é˜¶æ®µå®Œæˆä¹‹åŽè¾“å‡ºè¯¦ç»†ä¿¡æ¯,ä¸“ä¸šä¸€ç‚¹çš„å«æ³•æ˜¯è¯Šæ–­é€‰é¡¹,æ‰€ä»¥åœ¨ä½¿ç”¨å‰éœ€è¦å¼€å¯é€‰é¡¹UnlockDiagnosticVMOptionsã€‚è¿™ä¸ªé€‰é¡¹å¯ç”¨åŽä¼šæ‰“å°å †å†…å­˜å†…éƒ¨æ¯ä¸ªRegioné‡Œé¢çš„å­˜æ´»å¯¹è±¡ä¿¡æ¯,è¿™äº›ä¿¡æ¯åŒ…æ‹¬ä½¿ç”¨çŽ‡ã€RSetå¤§å°ã€å›žæ”¶ä¸€ä¸ªRegionçš„ä»·å€¼(Regionå†…éƒ¨å›žæ”¶ä»·å€¼è¯„ä¼°,å³æ€§ä»·æ¯”)ã€‚ è¿™ä¸ªé€‰é¡¹è¾“å‡ºçš„ä¿¡æ¯å¯¹äºŽè°ƒè¯•å †å†…Regionæ˜¯å¾ˆæœ‰æ•ˆçš„,ä¸è¿‡å¯¹äºŽä¸€ä¸ªå¾ˆå¤§çš„å †å†…å­˜æ¥è¯´,ç”±äºŽæ¯ä¸ª Regionä¿¡æ¯éƒ½è¾“å‡ºäº†,æ‰€ä»¥ä¿¡æ¯é‡ä¹Ÿæ˜¯æŒºå¤§çš„ã€‚ -XX:G1ReservePercentæ¯ä¸ªå¹´é¾„ä»£éƒ½ä¼šæœ‰ä¸€äº›å¯¹è±¡å¯ä»¥è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µ,ä¸ºäº†ç¡®ä¿è¿™ä¸ªæå‡è¿‡ç¨‹æ­£å¸¸å®Œæˆ,æˆ‘ä»¬å…è®¸G1GCä¿ç•™ä¸€äº›å†…å­˜,è¿™æ ·å°±å¯ä»¥é¿å…å‡ºçŽ°â€œ to space exhaustedâ€é”™è¯¯,è¿™ä¸ªé€‰é¡¹å°±æ˜¯ä¸ºäº†è¿™ä¸ªç”¨é€”ã€‚ è¿™ä¸ªé€‰é¡¹é»˜è®¤ä¿ç•™å †å†…å­˜çš„10%ã€‚æ³¨æ„,è¿™ä¸ªé¢„ç•™å†…å­˜ç©ºé—´ä¸èƒ½ç”¨äºŽå¹´è½»ä»£ã€‚ å¯¹äºŽä¸€ä¸ªæ‹¥æœ‰å¤§å†…å­˜çš„å †å†…å­˜æ¥è¯´,è¿™ä¸ªå€¼ä¸èƒ½è¿‡å¤§,å› ä¸ºå®ƒä¸èƒ½ç”¨äºŽå¹´è½»ä»£,è¿™å°±æ„å‘³ç€å¹´è½»ä»£å¯ç”¨å†…å­˜é™ä½Žäº†ã€‚å‡å°è¿™ä¸ªå€¼æœ‰åŠ©äºŽç»™å¹´è½»ä»£ç•™å‡ºæ›´å¤§çš„å†…å­˜ç©ºé—´ã€æ›´é•¿çš„GCæ—¶é—´,è¿™å¯¹æå‡æ€§èƒ½åžåé‡æœ‰å¥½å¤„ã€‚ -XX:+G1SummarizeRSetStatså’ŒGIPrintRegionLivenessInfoé€‰é¡¹ä¸€æ ·,è¿™ä¸ªé€‰é¡¹ä¹Ÿæ˜¯ä¸€ä¸ªè¯Šæ–­é€‰é¡¹,æ‰€ä»¥ä¹Ÿéœ€è¦å¼€å¯UnlockDiagnosticVMOptionsé€‰é¡¹åŽæ‰èƒ½ä½¿ç”¨,è¿™ä¹Ÿå°±æ„å‘³ç€-XX:+UnlockDiagnosticVMOptionsé€‰é¡¹éœ€è¦æ”¾åœ¨-XX:+G1SummarizeRSetStatsé€‰é¡¹çš„å‰é¢ã€‚ è¿™ä¸ªé€‰é¡¹å’Œ-XX:G1SummarizePeriodä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ä¼šé˜¶æ®µæ€§åœ°æ‰“å°RSetsçš„è¯¦ç»†ä¿¡æ¯,è¿™æœ‰åŠ©äºŽæ‰¾åˆ°RSeté‡Œé¢å­˜åœ¨çš„é—®é¢˜ã€‚ -XX:+G1TraceConcRefinementè¿™æ˜¯ä¸€ä¸ªè¯Šæ–­é€‰é¡¹ã€‚å¦‚æžœå¯åŠ¨è¿™ä¸ªè¯Šæ–­é€‰é¡¹,é‚£ä¹ˆå¹¶è¡ŒRefinementçº¿ç¨‹ç›¸å…³çš„ä¿¡æ¯ä¼šè¢«æ‰“å°ã€‚æ³¨æ„,çº¿ç¨‹å¯åŠ¨å’Œç»“æŸæ—¶çš„ä¿¡æ¯éƒ½ä¼šè¢«æ‰“å°ã€‚ è¿™é‡Œæåˆ°äº†Refinementçº¿ç¨‹,æˆ‘ä»¬æ¥æå‰æ¢³ç†è¿™ä¸ªæ¦‚å¿µã€‚è¯·çœ‹æ¯ä¸€ä»£GCå¯¹åº”çš„GCçº¿ç¨‹: Garbage Collector Worker Threads Used Parallel GC ParallelGCThreads CMS GC ParallelGCThreadsConcGCThreads G1 GC ParallelGCThreadsConcGCThreadsG1ConcRefinementThreads ä¸Šé¢åˆ—å‡ºäº†ä¸‰ç±»GCçº¿ç¨‹,åˆ†åˆ«æ˜¯ParallelGCThreadsã€ConcGCThreadså’ŒG1ConcRefinementThreadsã€‚å…³äºŽè¿™ä¸‰ä¸ªçº¿ç¨‹çš„åŒºåˆ«ï¼š åç§° é€‰é¡¹æŽ§åˆ¶ ä½œç”¨ ParallelGC Thread -XX:ParallelGCThreads GCçš„å¹¶è¡Œå·¥ä½œçº¿ç¨‹,ä¸“é—¨ç”¨äºŽç‹¬å é˜¶æ®µçš„å·¥ä½œ,æ¯”å¦‚æ‹·è´å­˜æ´»å¯¹è±¡ ParallelMarkingThreads -XX:ConcGCThreads å¹¶è¡Œæ ‡è®°é˜¶æ®µçš„å¹¶è¡Œçº¿ç¨‹,å®ƒç”±ä¸€ä¸ªä¸»æŽ§(Master)çº¿ç¨‹å’Œä¸€äº›å·¥ä½œ(Worker)çº¿ç¨‹ç»„æˆ,å¯ä»¥å’Œåº”ç”¨ç¨‹åºå¹¶è¡Œæ‰§è¡Œ G1ConcurrentRefinementThreads -XX:G1ConcRefinementThreads å’Œåº”ç”¨ç¨‹åºä¸€èµ·è¿è¡Œ,ç”¨äºŽæ›´æ–°RSet,å¦‚æžœConcurrentRefinementThreadsæ²¡æœ‰è®¾ç½®,é‚£ä¹ˆé»˜è®¤ä¸ºParallelGCThreads+1 -XX:+G1UseAdaptiveConcRefinementè¿™ä¸ªé€‰é¡¹é»˜è®¤æ˜¯å¼€å¯çš„ã€‚å®ƒä¼šåŠ¨æ€åœ°å¯¹æ¯ä¸€æ¬¡GCä¸­XX:G1ConcRefinementGreenZoneã€-XX:G1ConcRefinementYellowZoneã€-XX:G1ConcRefinementRedZoneçš„å€¼è¿›è¡Œé‡æ–°è®¡ç®—ã€‚ å¹¶è¡ŒRefinementçº¿ç¨‹æ˜¯æŒç»­è¿è¡Œçš„,å¹¶ä¸”ä¼šéšç€update log bufferç§¯ç´¯çš„æ•°é‡è€ŒåŠ¨æ€è°ƒèŠ‚ã€‚å‰é¢è¯´åˆ°çš„ä¸‰ä¸ªé…ç½®é€‰é¡¹-XX:G1ConcRefinementGreenZoneã€-XX:G1ConcRefinementYellowZoneã€-XX:G1ConcRefinementRedZone,æ˜¯è¢«ç”¨æ¥æ ¹æ®ä¸åŒçš„ bufferä½¿ç”¨ä¸åŒçš„Refinementçº¿ç¨‹,ç›®çš„å°±æ˜¯ä¸ºäº†ä¿è¯ Refinementçº¿ç¨‹ä¸€å®šè¦å°½å¯èƒ½åœ°è·Ÿä¸Šupdate log bufferäº§ç”Ÿçš„æ­¥ä¼ã€‚ä½†æ˜¯è¿™ä¸ªRefinementçº¿ç¨‹ä¸æ˜¯æ— é™å¢žåŠ çš„,ä¸€æ—¦å‡ºçŽ° Refinementçº¿ç¨‹è·Ÿä¸ä¸Šupdate log bufferäº§ç”Ÿçš„é€Ÿåº¦ã€update log bufferå¼€å§‹å‡ºçŽ°ç§¯åŽ‹çš„æƒ…å†µ,Mutatorçº¿ç¨‹(å³åº”ç”¨ä¸šåŠ¡çº¿ç¨‹)å°±ä¼šååŠ©Refinementçº¿ç¨‹æ‰§è¡ŒRSetçš„æ›´æ–°å·¥ä½œã€‚è¿™ä¸ª Mutatorçº¿ç¨‹å®žé™…ä¸Šå°±æ˜¯åº”ç”¨ä¸šåŠ¡çº¿ç¨‹,å½“ä¸šåŠ¡çº¿ç¨‹åŽ»å‚ä¸ŽRsetä¿®æ”¹æ—¶,ç³»ç»Ÿæ€§èƒ½ä¸€å®šä¼šå—åˆ°å½±å“,æ‰€ä»¥éœ€è¦å°½åŠ›åŽ»é¿å…è¿™ç§çŠ¶å†µã€‚ -XX:GCTimeRatioè¿™ä¸ªé€‰é¡¹ä»£è¡¨Javaåº”ç”¨çº¿ç¨‹èŠ±è´¹çš„æ—¶é—´ä¸ŽGCçº¿ç¨‹èŠ±è´¹æ—¶é—´çš„æ¯”çŽ‡ã€‚é€šè¿‡è¿™ä¸ªæ¯”çŽ‡å€¼å¯ä»¥è°ƒèŠ‚Javaåº”ç”¨çº¿ç¨‹æˆ–è€…GCçº¿ç¨‹çš„å·¥ä½œæ—¶é—´,ä¿éšœä¸¤è€…çš„æ‰§è¡Œæ—¶é—´. HotSpot VMè½¬æ¢è¿™ä¸ªå€¼ä¸ºä¸€ä¸ªç™¾åˆ†æ¯”,å…¬å¼æ˜¯100/(1+GCTimeRatio),é»˜è®¤å€¼æ˜¯9,è¡¨ç¤ºèŠ±è´¹åœ¨GCå·¥ä½œé‡ä¸Šçš„æ—¶é—´å æ€»æ—¶é—´çš„10%ã€‚ -XX:+HeapDumpBeforeFullGC/-XX:+HeapDumpAfterFullGCè¿™ä¸ªé€‰é¡¹å¯ç”¨ä¹‹åŽ,åœ¨Full GCå¼€å§‹ä¹‹å‰æœ‰ä¸€ä¸ªhprofæ–‡ä»¶ä¼šè¢«åˆ›å»ºã€‚å»ºè®®è¿™ä¸ªé€‰é¡¹å’Œ-XX:+HeapDumpAfterFullGCä¸€èµ·ä½¿ç”¨,å¯ä»¥é€šè¿‡å¯¹Full GCå‘ç”Ÿå‰åŽçš„Javaå †å†…å­˜è¿›è¡Œå¯¹æ¯”,æ‰¾å‡ºå†…å­˜æ³„æ¼å’Œå…¶ä»–é—®é¢˜ã€‚ èŽ·å–full GCå‰åŽçš„heap dump -XX:InitiatingHeapOccypancyPercentè¯¥é€‰é¡¹çš„é»˜è®¤å€¼æ˜¯45,è¡¨ç¤ºG1 GCå¹¶è¡Œå¾ªçŽ¯åˆå§‹è®¾ç½®çš„å †å¤§å°å€¼,è¿™ä¸ªå€¼å†³å®šäº†ä¸€ä¸ªå¹¶è¡Œå¾ªçŽ¯æ˜¯ä¸æ˜¯è¦å¼€å§‹æ‰§è¡Œã€‚å®ƒçš„é€»è¾‘æ˜¯åœ¨ä¸€æ¬¡GCå®ŒæˆåŽ,æ¯”è¾ƒè€å¹´ä»£å ç”¨çš„ç©ºé—´å’Œæ•´ä¸ªJavaå †ä¹‹é—´çš„æ¯”ä¾‹ã€‚å¦‚æžœå¤§äºŽè¿™ä¸ªå€¼,åˆ™é¢„çº¦ä¸‹ä¸€æ¬¡GCå¼€å§‹ä¸€ä¸ªå¹¶è¡Œå¾ªçŽ¯å›žæ”¶åžƒåœ¾,ä»Žåˆå§‹æ ‡è®°é˜¶æ®µå¼€å§‹ã€‚è¿™ä¸ªå€¼è¶Šå°,GCè¶Šé¢‘ç¹,åä¹‹,å€¼è¶Šå¤§,å¯ä»¥è®©åº”ç”¨ç¨‹åºæ‰§è¡Œæ—¶é—´æ›´é•¿ã€‚ä¸è¿‡åœ¨å†…å­˜æ¶ˆè€—å¾ˆå¿«çš„æƒ…å†µä¸‹,æˆ‘è®¤ä¸ºæ—©è¿è¡Œå¹¶è¡Œå¾ªçŽ¯æ¯”æ™šè¿è¡Œè¦å¥½,çœ‹ç—…è¦è¶æ—©ã€‚ -XX:+UseStringDeduplicationè¯¥é€‰é¡¹å¯åŠ¨Java Stringå¯¹è±¡çš„åŽ»é‡å·¥ä½œã€‚JDK8u20å¼€å§‹å¼•å…¥è¯¥é€‰é¡¹,é»˜è®¤ä¸ºä¸å¯ç”¨ã€‚æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªåˆ¤æ–­Java Stringå¯¹è±¡å€¼æ˜¯å¦ä¸€æ ·çš„è¯­å¥â€œStringl equals(String2)tueâ€,å¦‚æžœå¼€å¯äº†è¯¥é€‰é¡¹,å¹¶ä¸”å¦‚æžœä¸¤ä¸ªå¯¹è±¡åŒ…å«ç›¸åŒçš„å†…å®¹,å³è¿”å›žâ€œtueâ€,åˆ™ä¸¤ä¸ªStringå¯¹è±¡åªä¼šå…±äº«ä¸€ä¸ªå­—ç¬¦æ•°ç»„ã€‚è¿™ä¸ªé€‰é¡¹æ˜¯G1GCç‹¬æœ‰çš„,ä¹Ÿå¯ä»¥å’Œå…¶ä»–GCä¸€èµ·ä½¿ç”¨ã€‚ å»¶ä¼¸ä¸€ç‚¹æˆ‘ä»¬çš„çŸ¥è¯†é¢,ä¸€ä¸ªåŽ»é‡å¯¹è±¡çš„å¿…å¤‡æ¡ä»¶æœ‰å¦‚ä¸‹ä¸‰ç‚¹: Java.lang Stringå¯¹è±¡çš„ä¸€ä¸ªå®žä¾‹ã€‚ è¿™ä¸ªå¯¹è±¡åœ¨å¹´è½»ä»£å †åŒºé—´ã€‚ è¿™ä¸ªå¯¹è±¡çš„å¹´é¾„è¾¾åˆ°åŽ»é‡å¹´é¾„ä»£,æˆ–è€…è¿™ä¸ªå¯¹è±¡å·²ç»åœ¨è€å¹´ä»£å †åŒºé—´å¹¶ä¸”å¯¹è±¡å¹´é¾„æ¯”åŽ»é‡å¹´é¾„å°ã€‚é€‰é¡¹-XX:StringDeduplicationAgeThresholdè®¾ç½®äº†è¿™ä¸ªå¹´é¾„ç•Œé™ã€‚ å‰é¢ä»‹ç»è¿‡çš„å¯ä¿®æ”¹å’Œä¸å¯ä¿®æ”¹å­—ç¬¦ä¸²çš„å¤„ç†æ–¹å¼æœ‰æ‰€ä¸åŒ,ä¸å¯ä¿®æ”¹å­—ç¬¦ä¸²é»˜è®¤å°±æ˜¯åŽ»é‡çš„,åœ¨æ’å…¥åˆ°HotSpot VMçš„String Tableæ—¶å·²ç»æ³¨æ˜Žäº†æ˜¯åŽ»é‡çš„,è¿™æ ·å°±é¿å…äº†HotSpotæœåŠ¡å™¨JITç¼–è¯‘ä¼˜åŒ–æŽªæ–½ã€‚ -XX:StringDeduplicationAgeThresholdè¿™ä¸ªé€‰é¡¹æ˜¯é’ˆå¯¹-XX:+UseStringDeduplicationé€‰é¡¹çš„,é»˜è®¤å€¼æ˜¯3ã€‚å®ƒçš„æ„æ€æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å¹´é¾„è¶…è¿‡è®¾å®šçš„é˜ˆå€¼,æˆ–è€…æå‡åˆ°G1 GCè€å¹´ä»£Regionä¹‹åŽ,å°±ä¼šæˆä¸ºå­—ç¬¦ä¸²åŽ»é‡çš„å€™é€‰å¯¹è±¡,åŽ»é‡æ“ä½œåªä¼šæœ‰ä¸€æ¬¡ã€‚ -XX:+PrintStringDeduplicationStatisticsè¿™ä¸ªé€‰é¡¹æŒºæœ‰ç”¨çš„,èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬é€šè¿‡è¯»å–è¾“å‡ºçš„ç»Ÿè®¡èµ„æ–™æ¥äº†è§£æ˜¯å¦å­—ç¬¦ä¸²åŽ»é‡åŽèŠ‚çº¦äº†å¤§é‡çš„å †å†…å­˜ç©ºé—´,é»˜è®¤æ˜¯å…³é—­çš„,å°±æ˜¯è¯´ä¸ä¼šè¾“å‡ºå­—ç¬¦ä¸²åŽ»é‡çš„ç»Ÿè®¡èµ„æ–™ã€‚ -XX:+G1UseAdaptiveIHOPJDK9æä¾›çš„æ–°çš„é€‰é¡¹ã€‚è¿™ä¸ªé€‰é¡¹çš„ä½œç”¨æ˜¯é€šè¿‡åŠ¨æ€è°ƒèŠ‚æ ‡è®°é˜¶æ®µå¼€å§‹çš„æ—¶é—´,ä»¥è¾¾åˆ°æå‡åº”ç”¨ç¨‹åºåžåé‡çš„ç›®æ ‡,ä¸»è¦é€šè¿‡å°½å¯èƒ½è¿Ÿåœ°è§¦å‘æ ‡è®°å¾ªçŽ¯æ–¹å¼æ¥é¿å…æ¶ˆè€—è€å¹´ä»£ç©ºé—´ã€‚ è¿™ä¸ªé€‰é¡¹çš„å€¼åœ¨VMåˆšå¼€å§‹å¯åŠ¨æ—¶å’Œ-XX:InitiatingHeapOccupancyPercentçš„å€¼ä¸€æ ·,å¦‚æžœå‡ºçŽ°æ ‡è®°å¾ªçŽ¯é˜¶æ®µå†…å­˜ä¸å¤Ÿç”¨,åˆ™å®ƒä¼šè‡ªåŠ¨è°ƒèŠ‚å¤§å°,ç¡®ä¿æ ‡è®°å¾ªçŽ¯å¯ç”¨æ›´å¤šçš„å †å†…å­˜ã€‚ æ³¨æ„,-XX:+G1UseAdaptiveIHOPè¿™ä¸ªé€‰é¡¹ä¼šåœ¨JDK9é‡Œé»˜è®¤å¯ç”¨,å³-XX:InitiatingHeapOccupancyPercentå’ŒXX:+GIUseAdaptivelHOPåœ¨JDK9ä¹‹åŽåªéœ€è¦å¯ç”¨ä¸€ä¸ªå°±å¯ä»¥äº†ã€‚ JDK8çŽ¯å¢ƒä¸‹è¿è¡Œè¯¥é€‰é¡¹ä¼šè¾“å‡º:â€œUnrecognized VM option â€˜G1UseAdaptivelHOPâ€™â€ -XX:+MaxGCPauseMillsè¿™ä¸ªé€‰é¡¹æ¯”è¾ƒé‡è¦ã€‚å®ƒè®¾ç½®äº†G1çš„ç›®æ ‡åœé¡¿æ—¶é—´,å•ä½æ˜¯ms,é»˜è®¤å€¼ä¸º200msã€‚è¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªç›®æ ‡æ—¶é—´,è€Œä¸æ˜¯æœ€å¤§åœé¡¿æ—¶é—´ã€‚G1 GCå°½æœ€å¤§åŠªåŠ›ç¡®ä¿å¹´è½»ä»£çš„å›žæ”¶æ—¶é—´å¯ä»¥æŽ§åˆ¶åœ¨è¿™ä¸ªç›®æ ‡åœé¡¿æ—¶é—´èŒƒå›´é‡Œé¢,åœ¨G1GCä½¿ç”¨è¿‡ç¨‹ä¸­,è¿™ä¸ªé€‰é¡¹å’Œ-Xmsã€Xmxä¸¤ä¸ªé€‰é¡¹ä¸€èµ·ä½¿ç”¨,å®ƒä»¬ä¸‰ä¸ªä¹Ÿæœ€å¥½åœ¨JVMå¯åŠ¨æ—¶å°±ä¸€èµ·é…ç½®å¥½ã€‚ -XX:+MinHeapFreeRatioè¿™ä¸ªé€‰é¡¹è®¾ç½®å †å†…å­˜é‡Œå¯ä»¥ç©ºé—²çš„æœ€å°çš„å†…å­˜ç©ºé—´å¤§å°,é»˜è®¤å€¼ä¸ºå †å†…å­˜çš„40%ã€‚å½“ç©ºé—²å †å†…å­˜å¤§å°å°äºŽè¿™ä¸ªè®¾ç½®çš„å€¼æ—¶,æˆ‘ä»¬éœ€è¦åˆ¤æ–­-Xmså’Œ-Xmxè¿™ä¸¤ä¸ªå€¼çš„åˆå§‹åŒ–è®¾ç½®å€¼,å¦‚æžœ-Xmså’Œ-Xmxä¸ä¸€æ ·,é‚£ä¹ˆæˆ‘ä»¬å°±æœ‰æœºä¼šæ‰©å±•å †å†…å­˜,å¦åˆ™å°±æ— æ³•æ‰©å±•ã€‚ -XX:+MaxHeapFreeRatioè¿™ä¸ªé€‰é¡¹è®¾ç½®æœ€å¤§ç©ºé—²ç©ºé—´å¤§å°,é»˜è®¤å€¼ä¸ºå †å†…å­˜çš„70%ã€‚è¿™ä¸ªé€‰é¡¹å’Œä¸Šé¢é‚£ä¸ªæœ€å°å †å†…å­˜ç©ºé—²å¤§å°åˆšå¥½ç›¸å,å½“å¤§äºŽè¿™ä¸ªç©ºé—²æ¯”çŽ‡æ—¶,G1 GCä¼šè‡ªåŠ¨å‡å°‘å †å†…å­˜å¤§å°ã€‚éœ€è¦åˆ¤æ–­-Xmså’Œ-Xmxè¿™ä¸¤ä¸ªå€¼çš„åˆå§‹åŒ–è®¾ç½®å€¼,å¦‚æžœ-Xmså’Œ-Xmxä¸ä¸€æ ·,é‚£ä¹ˆå°±æœ‰æœºä¼šå‡å°å †å†…å­˜,å¦åˆ™å°±æ— æ³•å‡å°ã€‚ -XX:+PrintAdaptiveSizePolicyè¿™ä¸ªé€‰é¡¹å†³å®šæ˜¯å¦å¼€å¯å †å†…å­˜å¤§å°å˜åŒ–çš„ç›¸åº”è®°å½•ä¿¡æ¯æ‰“å°,å³æ˜¯å¦æ‰“å°è¿™äº›ä¿¡æ¯åˆ°GCæ—¥å¿—é‡Œé¢ã€‚è¿™ä¸ªä¿¡æ¯å¯¹äºŽParallel GCå’ŒG1 GCéƒ½å¾ˆæœ‰ç”¨ã€‚ -XX:+ResizePLABGCä½¿ç”¨çš„æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å­˜å—é‡‡ç”¨åŠ¨æ€å€¼è¿˜æ˜¯é™æ€å€¼è¿›è¡Œè®¾ç½®æ˜¯ç”±è¿™ä¸ªé€‰é¡¹å†³å®šçš„,å®ƒé»˜è®¤æ˜¯å¼€å¯çš„,è¿™ä¸ªè®¾ç½®å¯¹åº”çš„æ˜¯GCåœ¨æå‡å¯¹è±¡æ—¶æ˜¯å¦ä¼šè°ƒæ•´PLABçš„å¤§å°ã€‚ è¿™ä¸ªé€‰é¡¹å¤§å®¶è¿˜æ˜¯æ…Žç”¨,æ®è¯´ä¼šå‡ºçŽ°æ€§èƒ½é—®é¢˜,å¯ç”¨åŽå¯èƒ½ä¼šå¢žåŠ GCçš„åœé¡¿æ—¶é—´ã€‚å½“åº”ç”¨å¼€å¯çš„çº¿ç¨‹è¾ƒå¤šæ—¶,æœ€å¥½ä½¿ç”¨-XX:ResizePlaBæ¥å…³é—­PLAB()çš„å¤§å°è°ƒæ•´,ä»¥é¿å…å¤§é‡çš„çº¿ç¨‹é€šä¿¡æ‰€å¯¼è‡´çš„æ€§èƒ½ä¸‹é™ã€‚ -XX:+ResizeTLABJavaåº”ç”¨çº¿ç¨‹ä½¿ç”¨çš„æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å­˜å—é‡‡ç”¨åŠ¨æ€å€¼è¿˜æ˜¯é™æ€å€¼è¿›è¡Œè®¾ç½®æ˜¯ç”±è¿™ä¸ªé€‰é¡¹å†³å®šçš„,å®ƒé»˜è®¤æ˜¯å¼€å¯çš„,å³TLABå€¼ä¼šè¢«åŠ¨æ€è°ƒæ•´ã€‚ -XX:+ClassUnloadingWithConcurrentMarkè¿™ä¸ªé€‰é¡¹å¼€å¯åœ¨G1 GCå¹¶è¡Œå¾ªçŽ¯é˜¶æ®µå¸è½½ç±»,å°¤å…¶æ˜¯åœ¨è€å¹´ä»£çš„å¹¶è¡Œå›žæ”¶é˜¶æ®µ,é»˜è®¤æ˜¯å¼€å¯çš„ã€‚è¿™ä¸ªé€‰é¡¹å¼€å¯åŽä¼šåœ¨å¹¶è¡Œå¾ªçŽ¯çš„é‡æ ‡è®°é˜¶æ®µå¸è½½JVMæ²¡æœ‰ç”¨åˆ°çš„ç±»,è¿™äº›å·¥ä½œä¹Ÿå¯ä»¥æ”¾åœ¨Full GCé‡Œé¢åŽ»åš,ä½†æ˜¯æå‰åšäº†æœ‰å¾ˆå¤§çš„å¥½å¤„ã€‚ä½†å› ä¸ºå¼€å¯å®ƒæ„å‘³ç€é‡æ ‡è®°é˜¶æ®µçš„GCåœé¡¿æ—¶é—´ä¼šæ‹‰é•¿,è¿™æ—¶å€™æˆ‘ä»¬å°±è¦åˆ¤æ–­æ€§ä»·æ¯”äº†,å¦‚æžœGCåœé¡¿æ—¶é—´æ¯”æˆ‘ä»¬è®¾ç½®çš„æœ€å¤§GCåœé¡¿ç›®æ ‡æ—¶é—´è¿˜é•¿,å¹¶ä¸”éœ€è¦å¸è½½çš„ç±»ä¹Ÿä¸å¤š,é‚£è¿˜æ˜¯å…³é—­è¿™ä¸ªé€‰é¡¹å§ã€‚ -XX:+ClassUnloadingé»˜è®¤å€¼æ˜¯Ture,å†³å®šäº†JVMæ˜¯å¦ä¼šå¸è½½æ‰€æœ‰æ— ç”¨çš„ç±»,å¦‚æžœå…³é—­äº†è¿™ä¸ªé€‰é¡¹,æ— è®ºæ˜¯å¹¶è¡Œå›žæ”¶å¾ªçŽ¯,è¿˜æ˜¯Full GC,éƒ½ä¸ä¼šå†å¸è½½è¿™äº›ç±»äº†,æ‰€ä»¥éœ€è°¨æ…Žå…³é—­ã€‚ -XX:+UnlockDiagnosticVMOptionsè¿™ä¸ªé€‰é¡¹å†³å®šæ˜¯å¦å¼€å¯è¯Šæ–­é€‰é¡¹,é»˜è®¤å€¼æ˜¯False,å³ä¸å¼€å¯åœ¨GCé‡Œé¢æœ‰ä¸€äº›é€‰é¡¹ç§°ä¹‹ä¸ºè¯Šæ–­é€‰é¡¹(Diagnostic Options),é€šè¿‡-XX:+PrintFlagsFinal å’ŒXX:+Unlockã€‚DiagnosticVMOptionsè¿™ä¸¤ä¸ªé€‰é¡¹ç»„åˆèµ·æ¥è¿è¡Œ,å°±å¯ä»¥è¾“å‡ºå¹¶æŸ¥çœ‹è¿™äº›é€‰é¡¹ã€‚ -XX:+UnlockExperimentalVMOptionsé™¤äº†ä¹‹å‰è¯´çš„è¯Šæ–­é€‰é¡¹ä»¥å¤–,JVMè¿˜æœ‰ä¸€äº›å«ä½œè¯•éªŒé€‰é¡¹(Experimental Options),è¿™äº›é€‰é¡¹ä¹Ÿéœ€è¦é€šè¿‡XX:+UnlockExperimentalVMOptionsè¿™ä¸ªé€‰é¡¹å¼€å¯,é»˜è®¤æ˜¯å…³é—­çš„ã€‚ å’Œè¯Šæ–­é€‰é¡¹ä¸€æ ·,ä¹Ÿå¯ä»¥å’Œ-XX:+PrintFlagsFinalé€‰é¡¹è”åˆä½¿ç”¨,å³-XX:+PrintFlagsFinalå’Œ-XX:+UnlockExperimental VMOptionsè¿™ä¸¤ä¸ªé€‰é¡¹è”åˆä½¿ç”¨æ—¶å¯ä»¥è¾“å‡ºæ—¥å¿—,è¾“å‡ºçš„æ—¥å¿—å·²ç»åŒ…å«åœ¨äº†å‰ä¸€ä¸ªé€‰é¡¹-XX:+UnlockDiagnosticVMOptionsçš„è¿è¡Œè¾“å‡ºé‡Œ,è¿™é‡Œå°±ä¸å†é‡å¤ã€‚ æ€»çš„æ¥è¯´,è¿™äº›è¯•éªŒé€‰é¡¹å¯¹æ•´ä½“åº”ç”¨æ€§èƒ½å¯èƒ½ä¼šæœ‰äº›å¥½å¤„,ä½†æ˜¯å®ƒä»¬å¹¶æ²¡æœ‰ç»åŽ†å®Œæ•´çš„æµ‹è¯•çŽ¯èŠ‚,æ‰€ä»¥ç§°ä¸ºè¯•éªŒé€‰é¡¹ã€‚ -XX:+UnlockCommercialFeaturesè¿™ä¸ªé€‰é¡¹åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ Oracleç‰¹æœ‰çš„ç‰¹æ€§,é»˜è®¤æ˜¯å…³é—­çš„ã€‚ æœ‰ä¸€äº›å±žæ€§æ˜¯Oracleå…¬å¸é’ˆå¯¹Oracleçš„Javaè¿è¡Œæ—¶ç‹¬æœ‰çš„,æ²¡æœ‰è¢«åŒ…å«åœ¨OpenJDKé‡Œé¢ã€‚ä¸¾ä¸ªä¾‹å­,æ¯”å¦‚è¯´ Oracleçš„ç›‘æŽ§å’Œç®¡ç†å·¥å…·Java Mission Control,å®ƒæœ‰ä¸€ä¸ªç‰¹æ€§å«ä½œJava Flight Recorder,è¿™ä¸ªç‰¹æ€§ä½œä¸ºJava Mission Controlçš„ä¸€éƒ¨åˆ†,å±žäºŽäº‹ä»¶å›žæ”¶æ¡†æž¶,å¯ä»¥è¢«ç”¨æ¥æ˜¾ç¤ºåº”ç”¨ç¨‹åºå’ŒJVMçš„åº•å±‚ä¿¡æ¯ã€‚ æ·±å…¥G1 GCG1 GCæ¦‚å¿µç®€ä»‹èƒŒæ™¯çŸ¥è¯†G1ä½¿ç”¨äº†å…¨æ–°çš„åˆ†åŒºç®—æ³•,å…¶ç‰¹ç‚¹å¦‚ä¸‹æ‰€ç¤ºï¼š å¹¶è¡Œæ€§ï¼šG1åœ¨å›žæ”¶æœŸé—´,å¯ä»¥æœ‰å¤šä¸ªGCçº¿ç¨‹åŒæ—¶å·¥ä½œ,å¯ä»¥æœ‰æ•ˆåˆ©ç”¨å¤šæ ¸çš„è®¡ç®—èƒ½åŠ› å¹¶å‘æ€§ï¼šG1æ‹¥æœ‰ä¸Žåº”ç”¨ç¨‹åºäº¤æ›¿æ‰§è¡Œçš„èƒ½åŠ›,éƒ¨åˆ†å·¥ä½œå¯ä»¥å’Œåº”ç”¨ç¨‹åºåŒæ—¶æ‰§è¡Œ,å› æ­¤,ä¸€èˆ¬æ¥è¯´,ä¸ä¼šåœ¨æ•´ä¸ªå›žæ”¶é˜¶æ®µå‘ç”Ÿå®Œå…¨é˜»å¡žåº”ç”¨ç¨‹åºçš„æƒ…å†µã€‚ åˆ†ä»£GCï¼šG1ä¾ç„¶æ˜¯ä¸€ä¸ªåˆ†ä»£æ”¶é›†å™¨,ä½†æ˜¯å’Œä¹‹å‰çš„å„ç±»å›žæ”¶å™¨ä¸åŒ,å®ƒåŒæ—¶å…¼é¡¾äº†å¹´è½»ä»£å’Œè€å¹´ä»£ã€‚å¯¹æ¯”å…¶ä»–å›žæ”¶å™¨,å®ƒä»¬æˆ–è€…å·¥ä½œåœ¨å¹´è½»ä»£,æˆ–è€…å·¥ä½œåœ¨è€å¹´ä»£ã€‚ ç©ºé—´æ•´ç†ï¼šG1åœ¨å›žæ”¶è¿‡ç¨‹ä¸­,ä¼šè¿›è¡Œé€‚å½“çš„å¯¹è±¡ç§»åŠ¨,ä¸åƒCMSé‚£æ ·åªæ˜¯ç®€å•åœ°æ ‡è®°æ¸…ç†å¯¹è±¡ã€‚åœ¨è‹¥å¹²æ¬¡GCåŽ,CMSå¿…é¡»è¿›è¡Œä¸€æ¬¡ç¢Žç‰‡æ•´ç†ã€‚è€ŒG1ä¸åŒ,å®ƒæ¯æ¬¡å›žæ”¶éƒ½ä¼šæœ‰æ•ˆåœ°å¤åˆ¶å¯¹è±¡,å‡å°‘ç©ºé—´ç¢Žç‰‡,è¿›è€Œæå‡å†…éƒ¨å¾ªçŽ¯é€Ÿåº¦ã€‚ å¯é¢„è§æ€§ï¼šç”±äºŽåˆ†åŒºçš„åŽŸå› ,G1å¯ä»¥åªé€‰å–éƒ¨åˆ†åŒºåŸŸè¿›è¡Œå†…å­˜å›žæ”¶,è¿™æ ·ç¼©å°äº†å›žæ”¶çš„èŒƒå›´,å› æ­¤å¯¹äºŽå…¨å±€åœé¡¿æƒ…å†µçš„å‘ç”Ÿä¹Ÿèƒ½å¾—åˆ°è¾ƒå¥½çš„æŽ§åˆ¶ã€‚ éšç€G1 GCçš„å‡ºçŽ°,GCä»Žä¼ ç»Ÿçš„è¿žç»­å †å†…å­˜å¸ƒå±€é€æ¸èµ°å‘äº†ä¸è¿žç»­å†…å­˜å—å¸ƒå±€,è¿™æ˜¯é€šè¿‡å¼•å…¥Regionæ¦‚å¿µå®žçŽ°çš„,ä¹Ÿå°±æ˜¯è¯´,ç”±ä¸€å †ä¸è¿žç»­çš„Regionç»„æˆäº†å †å†…å­˜ã€‚å…¶å®žä¹Ÿä¸èƒ½è¯´æ˜¯ä¸è¿žç»­çš„,åªæ˜¯å®ƒä»Žä¼ ç»Ÿçš„ç‰©ç†è¿žç»­é€æ¸æ”¹å˜ä¸ºé€»è¾‘ä¸Šçš„è¿žç»­,è¿™æ˜¯é€šè¿‡Regionçš„åŠ¨æ€åˆ†é…æ–¹å¼å®žçŽ°çš„,å¯ä»¥æŠŠä¸€ä¸ªRegionåˆ†é…ç»™Edenã€Surviâ…³vorã€è€å¹´ä»£ã€å¤§å¯¹è±¡åŒºé—´ã€ç©ºé—²åŒºé—´ç­‰åŒºé—´çš„ä»»æ„ä¸€ä¸ª,è€Œä¸æ˜¯å›ºå®šå®ƒçš„ä½œç”¨,å› ä¸ºè¶Šæ˜¯å›ºå®š,è¶Šæ˜¯å‘†æ¿ã€‚ G1çš„åŒºé—´è®¾è®¡çµæ„Ÿåœ¨G1ä¸­,å †è¢«å¹³å‡åˆ†æˆè‹¥å¹²ä¸ªå¤§å°ç›¸ç­‰çš„åŒºåŸŸ(Region)ã€‚æ¯ä¸ªRegionéƒ½æœ‰ä¸ªå…³è”çš„Remembered Set(ç®€ç§°RS),RSçš„æ•°æ®ç»“æž„æ˜¯Hashè¡¨,é‡Œé¢çš„æ•°æ®æ˜¯Card Table(å †ä¸­æ¯512byteæ˜ å°„åœ¨card table 1byte)ã€‚ç®€å•åœ°è¯´,RSé‡Œé¢å­˜åœ¨çš„æ˜¯Regionä¸­å­˜æ´»å¯¹è±¡çš„æŒ‡é’ˆã€‚å½“Regionä¸­æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶,é¦–å…ˆåæ˜ åˆ°Card Tableä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªCardä¸Š,RSé€šè¿‡æ‰«æå†…éƒ¨çš„Card Tableå¾—çŸ¥Regionä¸­å†…å­˜ä½¿ç”¨æƒ…å†µå’Œå­˜æ´»å¯¹è±¡ã€‚åœ¨ä½¿ç”¨Regionè¿‡ç¨‹ä¸­,å¦‚æžœRegion è¢«å¡«æ»¡äº†,åˆ†é…å†…å­˜çš„çº¿ç¨‹ä¼šé‡æ–°é€‰æ‹©ä¸€ä¸ªæ–°çš„Region,ç©ºé—²Regionè¢«ç»„ç»‡åˆ°ä¸€ä¸ªåŸºäºŽé“¾è¡¨çš„æ•°æ®ç»“æž„(LinkedListé‡Œé¢,è¿™æ ·å¯ä»¥å¿«é€Ÿæ‰¾åˆ°æ–°çš„Regionã€‚ G1 GCåˆ†ä»£ç®¡ç†å¹´è½»ä»£é™¤éžæˆ‘ä»¬æ˜¾ç¤ºåœ°é€šè¿‡å‘½ä»¤è¡Œæ–¹å¼å£°æ˜Žäº†å¹´è½»ä»£çš„åˆå§‹åŒ–å€¼å’Œæœ€å¤§å€¼çš„å¤§å°,å¦åˆ™ï¼Œä¸€èˆ¬æ¥è¯´,åˆå§‹åŒ–å€¼é»˜è®¤æ˜¯æ•´ä¸ªJavaå †å¤§å°çš„5%(é€šè¿‡é€‰é¡¹-XX:G1NewSizePercentè®¾ç½®),æœ€å¤§å€¼é»˜è®¤æ˜¯æ•´ä¸ªJavaå †å¤§å°çš„60%(é€šè¿‡é€‰é¡¹-XX:G1MaxNewSizePercentè®¾ç½®)ã€‚ å›žæ”¶é›†åˆåŠå…¶é‡è¦æ€§ä»»ä½•ä¸€æ¬¡åžƒåœ¾å›žæ”¶éƒ½ä¼šé‡Šæ”¾CSeté‡Œé¢çš„æ‰€æœ‰åŒºé—´ã€‚ä¸€ä¸ªCSetç”±ä¸€ç³»åˆ—çš„ç­‰å¾…å›žæ”¶çš„åŒºé—´æ‰€ç»„æˆã€‚åœ¨ä¸€æ¬¡åžƒåœ¾å›žæ”¶è¿‡ç¨‹ä¸­,è¿™äº›å›žæ”¶å€™é€‰åŒºé—´çš„å­˜æ´»å¯¹è±¡ä¼šè¢«æ•´ä½“è¯„ä¼°,å¹¶ä¸”åœ¨å›žæ”¶ç»“æŸåŽè¿™äº›åŒºé—´ä¼šè¢«åŠ å…¥åˆ°ç©ºé—²åŒºé—´é˜Ÿåˆ—(LinkedListé˜Ÿåˆ—)ã€‚åœ¨ä¸€æ¬¡å¹´è½»ä»£å›žæ”¶è¿‡ç¨‹ä¸­,csetåªä¼šåŒ…å«å¹´è½»ä»£åŒºé—´,è€Œåœ¨ä¸€ä¸ªæ··åˆå›žæ”¶è¿‡ç¨‹ä¸­,CSetä¼šåœ¨å¹´è½»ä»£åŒºé—´åŸºç¡€ä¸Šå†åŒ…å«ä¸€äº›è€å¹´ä»£åŒºé—´,è¿™å°±æ˜¯æ–°å¢žçš„æ··åˆå›žæ”¶æ¦‚å¿µ,ä¸å†å¯¹å¹´è½»ä»£å’Œè€å¹´ä»£å®Œå…¨åˆ‡åˆ†ã€‚ G1 GCæä¾›äº†ä¸¤ä¸ªé€‰é¡¹ç”¨äºŽå¸®åŠ©é€‰æ‹©è¿›å…¥CSetçš„å€™é€‰è€å¹´ä»£åŒºé—´: -XX:G1MixedGCLiveThresholdPercent:JDK8u45é»˜è®¤å€¼ä¸ºä¸€ä¸ªG1 GCåŒºé—´çš„85%ã€‚è¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªå­˜æ´»å¯¹è±¡çš„é˜ˆå€¼,å¹¶ä¸”èµ·åˆ°äº†ä»Žæ··åˆå›žæ”¶çš„CSeté‡ŒæŽ’é™¤ä¸€äº›è€å¹´ä»£åŒºé—´çš„ä½œç”¨,å³å¯ä»¥ç†è§£ä¸ºG1 GCé™åˆ¶CSetä»…åŒ…å«ä½ŽäºŽè¿™ä¸ªé˜ˆå€¼(é»˜è®¤85%)çš„è€å¹´ä»£åŒºé—´,è¿™æ ·å¯ä»¥å‡å°‘åžƒåœ¾å›žæ”¶è¿‡ç¨‹ä¸­æ‹·è´å¯¹è±¡æ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚ -XX:G1OldCSetRegionThresholdPercent:JDK8u45é»˜è®¤å€¼ä¸ºæ•´ä¸ªJavaå †åŒºçš„10%ã€‚è¿™ä¸ªå€¼è®¾ç½®äº†å¯ä»¥è¢«ç”¨äºŽä¸€æ¬¡æ··åˆå›žæ”¶æš‚åœæ‰€å›žæ”¶çš„æœ€å¤§è€å¹´ä»£åŒºé—´æ•°é‡ã€‚è¿™ä¸ªé˜ˆå€¼å–å†³äºŽJVMè¿›ç¨‹æ‰€èƒ½ä½¿ç”¨çš„Javaå †çš„ç©ºé—²ç©ºé—´ã€‚ RSetåŠå…¶é‡è¦æ€§ä¸€ä¸ªRSetæ˜¯ä¸€ä¸ªæ•°æ®ç»“æž„,è¿™ä¸ªæ•°æ®ç»“æž„å¸®åŠ©ç»´æŠ¤å’Œè·Ÿè¸ªåœ¨å®ƒä»¬å•å…ƒå†…éƒ¨çš„å¯¹è±¡å¼•ç”¨ä¿¡æ¯,åœ¨G1 GCé‡Œ,è¿™ä¸ªå•å…ƒå°±æ˜¯åŒºé—´(Region),ä¹Ÿå°±æ˜¯è¯´,G1 GCé‡Œæ¯ä¸€ä¸ªRSetå¯¹åº”çš„æ˜¯ä¸€ä¸ªåŒºé—´å†…éƒ¨çš„å¯¹è±¡å¼•ç”¨æƒ…å†µã€‚æœ‰äº†RSet,å°±ä¸éœ€è¦æ‰«ææ•´ä¸ªå †å†…å­˜äº†,å½“G1 GCæ‰§è¡ŒSTWç‹¬å å›žæ”¶(å¹´è½»ä»£ã€æ··åˆä»£å›žæ”¶)æ—¶,åªéœ€è¦æ‰«ææ¯ä¸€ä¸ªåŒºé—´å†…éƒ¨çš„RSetå°±å¯ä»¥äº†ã€‚å› ä¸ºæ‰€æœ‰RSetéƒ½ä¿å­˜åœ¨CSeté‡Œé¢,å³Region-RSet-CSetè¿™æ ·çš„æ¦‚å¿µ,æ‰€ä»¥ä¸€æ—¦åŒºé—´å†…éƒ¨çš„å­˜æ´»å¯¹è±¡è¢«ç§»é™¤,RSeté‡Œé¢ä¿å­˜çš„å¼•ç”¨ä¿¡æ¯ä¹Ÿä¼šç«‹å³è¢«æ›´æ–°ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½å¤Ÿç†è§£RSetå°±æ˜¯ä¸€å¼ è™šæ‹Ÿçš„å¯¹è±¡å¼•ç”¨è¡¨äº†,æ¯ä¸ªåŒºé—´å†…éƒ¨éƒ½æœ‰è¿™ä¹ˆä¸€å¼ è¡¨å­˜åœ¨,å¸®åŠ©å¯¹åŒºé—´å†…éƒ¨çš„å¯¹è±¡å­˜æ´»æƒ…å†µã€åŸºæœ¬ä¿¡æ¯åšæœ‰åºé«˜æ•ˆçš„ç®¡ç†ã€‚ G1 GCçš„å¹´è½»ä»£å›žæ”¶æˆ–è€…æ··åˆå›žæ”¶é˜¶æ®µ,ç”±äºŽå¹´è½»ä»£è¢«å°½å¯èƒ½åœ°è®¾è®¡ä¸ºæœ€å¤§é‡çš„å›žæ”¶,è¿™æ ·çš„è®¾è®¡æ–¹å¼å‡å°‘äº†å¯¹äºŽRSetçš„ä¾èµ–,å³å‡å¼±äº†å¯¹äºŽå¹´è½»ä»£é‡Œé¢å­˜å‚¨çš„è·Ÿè¸ªå¼•ç”¨ä¿¡æ¯çš„ä¾èµ–ç¨‹åº¦,è¿›è€Œå‡å¼±äº†å¤šä½™RSetçš„æ¶ˆè€—ã€‚G1 GCåªåœ¨ä»¥ä¸‹ä¸¤ä¸ªåœºæ™¯ä¾èµ–RSetã€‚ è€å¹´ä»£åˆ°å¹´è½»ä»£çš„å¼•ç”¨ï¼šG1 GCç»´æŠ¤äº†ä»Žè€å¹´ä»£åŒºé—´åˆ°å¹´è½»ä»£åŒºé—´çš„æŒ‡é’ˆ,è¿™ä¸ªæŒ‡é’ˆä¿å­˜åœ¨å¹´è½»ä»£çš„RSeté‡Œé¢ã€‚ è€å¹´ä»£åˆ°è€å¹´ä»£çš„å¼•ç”¨ï¼šG1 GCç»´æŠ¤äº†ä»Žè€å¹´ä»£åŒºé—´åˆ°è€å¹´ä»£åŒºé—´çš„æŒ‡é’ˆ,è¿™ä¸ªæŒ‡é’ˆä¿å­˜åœ¨è€å¹´ä»£çš„RSeté‡Œé¢ã€‚ æ¯ä¸€ä¸ªåŒºé—´åªä¼šæœ‰ä¸€ä¸ªRSetç”±äºŽå¯¹äºŽå¯¹è±¡çš„å¼•ç”¨æ˜¯åŸºäºŽJavaåº”ç”¨ç¨‹åºçš„éœ€æ±‚çš„,æ‰€ä»¥æœ‰å¯èƒ½ä¼šå‡ºçŽ°RSetå†…éƒ¨çš„â€œçƒ­ç‚¹â€,å³ä¸€ä¸ªåŒºé—´å‡ºçŽ°å¾ˆå¤šæ¬¡çš„å¼•ç”¨æ›´æ–°,éƒ½å‡ºçŽ°åœ¨åŒä¸€ä¸ªä½ç½®çš„æƒ…å†µã€‚ å¯¹äºŽä¸€ä¸ªè®¿é—®å¾ˆé¢‘ç¹çš„åŒºé—´æ¥è¯´,è¿™æ ·çš„æ–¹å¼ä¼šå½±å“RSetçš„æ‰«ææ—¶é—´ã€‚ æ³¨æ„,åŒºé—´(Region)å¹¶ä¸æ˜¯æœ€å°å•å…ƒ,æ¯ä¸ªåŒºé—´ä¼šè¢«è¿›ä¸€æ­¥åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå—(Chunks)ã€‚åœ¨G1 GCåŒºé—´é‡Œ,æœ€å°çš„å•å…ƒæ˜¯ä¸€ä¸ª512ä¸ªå­—èŠ‚çš„å †å†…å­˜å—(Card)ã€‚G1 GCä¸ºæ¯ä¸ªåŒºé—´è®¾ç½®äº†ä¸€ä¸ªå…¨å±€å†…å­˜å—è¡¨æ¥å¸®åŠ©ç»´æŠ¤æ‰€æœ‰çš„å †å†…å­˜å—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å½“ä¸€ä¸ªæŒ‡é’ˆå¼•ç”¨åˆ°äº†RSeté‡Œé¢çš„ä¸€ä¸ªåŒºé—´æ—¶,åŒ…å«è¯¥æŒ‡é’ˆçš„å †å†…å­˜å—å°±ä¼šåœ¨PRTé‡Œé¢è¢«æ ‡è®°ã€‚å¦‚æžœéœ€è¦å¿«é€Ÿåœ°æ‰«æä¸€å¼ æ•°æ®è¡¨,æœ€å¥½çš„æ–¹å¼æ˜¯å»ºç«‹ç´¢å¼•,ä¸€ä¸ªç²—ç²’åº¦çš„PRTå°±æ˜¯åŸºäºŽå“ˆå¸Œè¡¨å»ºç«‹çš„ã€‚å¯¹äºŽä¸€ä¸ªç»†ç²’åº¦çš„PRTæ¥è¯´,å“ˆå¸Œè¡¨å†…éƒ¨çš„æ¯ä¸€ä¸ªå…¥å£å¯¹åº”ä¸€ä¸ªåŒºé—´,è€ŒåŒºé—´å†…éƒ¨çš„å†…å­˜å—ç´¢å¼•ä¹Ÿæ˜¯å­˜å‚¨åœ¨ä½å›¾é‡Œé¢çš„ã€‚å½“ç»†ç²’åº¦PRTçš„æœ€å¤§å€¼è¢«çªç ´çš„æ—¶å€™,æˆ‘ä»¬å°±ä¼šå¼€å§‹é‡‡ç”¨ç²—ç²’åº¦æ–¹å¼å¤„ç†PRTã€‚ åœ¨åžƒåœ¾å›žæ”¶è¿‡ç¨‹ä¸­,å½“æ‰«æRSetå¹¶ä¸”å†…å­˜å—ç¡®å®žå­˜åœ¨äºŽPRTé‡Œæ—¶,G1 GCä¼šåœ¨å…¨å±€å †å†…å­˜å—æ•°æ®è¡¨é‡Œæ ‡è®°å¯¹åº”çš„å…¥å£,è¿™ç§åšæ³•é¿å…äº†é‡æ–°æ‰«æè¿™ä¸ªå†…å­˜å—ã€‚G1 GCä¼šåœ¨å›žæ”¶å¾ªçŽ¯é˜¶æ®µé»˜è®¤æ¸…é™¤å†…å­˜å †è¡¨,åœ¨GCçº¿ç¨‹çš„å¹¶è¡Œå·¥ä½œ(ä¸»è¦åŒ…æ‹¬æ ¹å¤–éƒ¨æ‰«æã€æ›´æ–°å’Œæ‰«æRSetã€å¯¹è±¡æ‹·è´ã€ç»ˆæ­¢åè®®ç­‰)å®Œæˆä¹‹åŽç´§è·Ÿç€çš„å°±æ˜¯æ¸…é™¤å †å†…å­˜è¡¨æ ‡è®°(Clear CT)é˜¶æ®µã€‚Update RSå’ŒScan RSå¯¹åº”çš„æ˜¯RSetçš„æ›´æ–°å’Œæ‰«æåŠ¨ä½œã€‚ RSetçš„ä½œç”¨æ˜¯å¾ˆæ˜Žæ˜¾çš„,ä½†æ˜¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¹Ÿé‡åˆ°äº†å†™ä¿æŠ¤å’Œå¹¶è¡Œæ›´æ–°çº¿ç¨‹çš„ç»´æŠ¤æˆæœ¬ã€‚ OpenJDK HotSpotçš„å¹¶è¡Œè€å¹´ä»£å’ŒCMS GCéƒ½åœ¨æ‰§è¡ŒJVMçš„ä¸€ä¸ªå¯¹è±¡å¼•ç”¨å†™æ“ä½œæ—¶ä½¿ç”¨äº†å†™ä¿æŠ¤æœºåˆ¶,å¦‚ä»£ç object field = some_other_objectã€‚è¿˜è®°å¾—æˆ‘ä»¬å¯¹äºŽæ¯ä¸ªåŒºé—´æ˜¯é‡‡ç”¨é’ˆå¯¹æœ€å°å•å…ƒå †å†…å­˜å—è¿›è¡Œç®¡ç†çš„å—?è¿™ä¸ªå†™ä¿æŠ¤æœºåˆ¶ä¹Ÿä¼šé€šè¿‡æ›´æ–°ä¸€ä¸ªç±»ä¼¼äºŽå †å†…å­˜å—è¡¨çš„æ•°æ®ç»“æž„æ¥è·Ÿè¸ªè·¨å¹´ä»£å¼•ç”¨ã€‚å †å†…å­˜è¡¨åœ¨æœ€å°åžƒåœ¾å›žæ”¶æ—¶ä¼šè¢«æ‰«æã€‚å†™ä¿æŠ¤ç®—æ³•åŸºäºŽUrs Holzleçš„å¿«é€Ÿå†™ä¿æŠ¤ç®—æ³•,è¿™ä¸ªç®—æ³•å‡å°‘äº†ç¼–è¯‘ä»£ç æ—¶çš„å¤–éƒ¨æŒ‡ä»¤æ¶ˆè€—ã€‚ å½“è·¨è¶ŠåŒºé—´çš„æ›´æ–°å‘ç”Ÿçš„æ—¶å€™,G1 GCä¼šå°†è¿™äº›å¯¹åº”çš„å †å†…å­˜å—æ”¾å…¥ä¸€ä¸ªç¼“å­˜,æˆ‘ä»¬å¯ä»¥ç§°è¿™ä¸ªç¼“å­˜ä¸ºâ€œæ›´æ–°æ—¥å¿—ç¼“å­˜â€,å†™å…¥è¯¥ç¼“å­˜çš„æ–¹å¼å’Œå†™å…¥é˜Ÿåˆ—çš„æ–¹å¼ä¸€æ ·ã€‚G1 GCä¼šä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹ç»„åŽ»ç»´æŒRSetä¿¡æ¯,å®ƒä»¬çš„èŒè´£æ˜¯æ‰«æâ€œæ›´æ–°æ—¥å¿—ç¼“å­˜â€,ç„¶åŽæ›´æ–°RSetã€‚JDK8u45é‡‡ç”¨é€‰é¡¹-XX:G1ConcRefinementThreadsè®¾ç½®è¿™ä¸ªçº¿ç¨‹ç»„çš„æ•°é‡,å¦‚æžœä½ æ²¡æœ‰è®¾ç½®,é‚£ä¹ˆé»˜è®¤é‡‡ç”¨-XX:ParallelGCThreadsé€‰é¡¹ã€‚ ä¸€æ—¦â€œæ›´æ–°æ—¥å¿—ç¼“å­˜â€è¾¾åˆ°äº†æœ€å¤§å¯ç”¨,å®ƒä¼šè¢«æ”¾å…¥å…¨å±€åŒ–çš„æ»¡è½½é˜Ÿåˆ—å¹¶å¯ç”¨ä¸€ä¸ªæ–°çš„ç¼“å­˜å—ã€‚ä¸€æ—¦æ›´æ–°çº¿ç¨‹åœ¨å…¨å±€æ»¡è½½é˜Ÿåˆ—é‡Œé¢å‘çŽ°äº†å…¥å£,å®ƒä»¬å°±å¼€å§‹å¹¶è¡Œå¤„ç†æ•´ä¸ªæ»¡è½½ç¼“å­˜é˜Ÿåˆ—ã€‚ G1 GCé’ˆå¯¹å¹¶è¡Œæ›´æ–°çº¿ç¨‹é‡‡ç”¨çš„æ˜¯åˆ†å±‚æ–¹æ³•,ä¸ºäº†ä¿è¯æ›´æ–°é€Ÿåº¦ä¼šåŠ å…¥æ›´å¤šçš„çº¿ç¨‹,å¦‚æžœå®žåœ¨è·Ÿä¸ä¸Šé€Ÿåº¦,Javaåº”ç”¨ç¨‹åºçº¿ç¨‹ä¹Ÿä¼šåŠ å…¥æˆ˜æ–—,ä½†å°½é‡ä¸è¦å‡ºçŽ°è¿™æ ·çš„æƒ…å†µ,è¿™ç§æƒ…å†µæ˜¯å‘ç”Ÿäº†çº¿ç¨‹çªƒå–,ä¼šé€ æˆåº”ç”¨ç¨‹åºèŠ±è´¹äº†æœ¬å¯ä»¥ç”¨äºŽè‡ªèº«ç¨‹åºç®—æ³•è¿è¡Œçš„èƒ½åŠ›ã€‚ å¹¶è¡Œæ ‡è®°å¾ªçŽ¯å¹¶è¡Œæ ‡è®°å¾ªçŽ¯çš„è¿‡ç¨‹æ˜¯åˆå§‹æ ‡è®°é˜¶æ®µâ†’æ ¹åŒºé—´æ‰«æé˜¶æ®µâ†’å¹¶è¡Œæ ‡è®°é˜¶æ®µâ†’é‡æ ‡è®°é˜¶æ®µâ†’æ¸…é™¤é˜¶æ®µ,å…¶ä¸­ä¸€éƒ¨åˆ†æ˜¯å¯ä»¥ä¸Žåº”ç”¨ç¨‹åºå¹¶è¡Œæ‰§è¡Œçš„,ä¸€éƒ¨åˆ†æ˜¯ç‹¬å å¼çš„ã€‚ 1.åˆå§‹æ ‡è®°é˜¶æ®µè¿™ä¸ªé˜¶æ®µæ˜¯ç‹¬å å¼çš„,å®ƒä¼šåœæ­¢æ‰€æœ‰çš„Javaçº¿ç¨‹,ç„¶åŽå¼€å§‹æ ‡è®°æ ¹èŠ‚ç‚¹å¯åŠçš„æ‰€æœ‰å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µå¯ä»¥å’Œå¹´è½»ä»£å›žæ”¶åŒæ—¶æ‰§è¡Œ,è¿™æ ·çš„è®¾è®¡æ–¹å¼ä¸»è¦æ˜¯ä¸ºäº†åŠ å¿«ç‹¬å é˜¶æ®µçš„æ‰§è¡Œé€Ÿåº¦ã€‚ åœ¨è¿™ä¸ªé˜¶æ®µ,æ¯ä¸€ä¸ªåŒºé—´çš„NATMSå€¼ä¼šè¢«è®¾ç½®åœ¨åŒºé—´çš„é¡¶éƒ¨ã€‚ 2.æ ¹åŒºé—´æ‰«æé˜¶æ®µè®¾ç½®äº†æ¯ä¸ªåŒºé—´çš„TAMSå€¼ä¹‹åŽ,Javaåº”ç”¨ç¨‹åºçº¿ç¨‹é‡æ–°å¼€å§‹æ‰§è¡Œ,æ ¹åŒºé—´æ‰«æé˜¶æ®µä¹Ÿä¼šå’ŒJavaåº”ç”¨ç¨‹åºçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚åŸºäºŽæ ‡è®°ç®—æ³•åŽŸç†,åœ¨å¹´è½»ä»£å›žæ”¶çš„åˆå§‹æ ‡è®°é˜¶æ®µæ‹·è´åˆ°å¹¸å­˜è€…åŒºé—´çš„å¯¹è±¡éœ€è¦è¢«æ‰«æå¹¶è¢«å½“ä½œæ ‡è®°æ ¹å…ƒç´ ,ç›¸åº”åœ°,G1 GCå› æ­¤å¼€å§‹æ‰«æå¹¸å­˜è€…åŒºé—´ã€‚ä»»ä½•ä»Žå¹¸å­˜è€…åŒºé—´è¿‡æ¥çš„å¼•ç”¨éƒ½ä¼šè¢«æ ‡è®°,åŸºäºŽè¿™ä¸ªåŽŸç†,å¹¸å­˜è€…åŒºé—´ä¹Ÿè¢«ç§°ä¸ºæ ¹åŒºé—´ã€‚ æ ¹åŒºé—´æ‰«æé˜¶æ®µå¿…é¡»åœ¨ä¸‹ä¸€ä¸ªåžƒåœ¾å›žæ”¶æš‚åœä¹‹å‰å®Œæˆ,è¿™æ˜¯å› ä¸ºæ‰€æœ‰ä»Žå¹¸å­˜è€…åŒºé—´æ¥çš„å¼•ç”¨éœ€è¦åœ¨æ•´ä¸ªå †åŒºé—´æ‰«æä¹‹å‰å®Œæˆæ ‡è®°å·¥ä½œã€‚ 3.å¹¶è¡Œæ ‡è®°é˜¶æ®µé¦–å…ˆå¯ä»¥æ˜Žç¡®çš„æ˜¯,å¹¶è¡Œæ ‡è®°é˜¶æ®µæ˜¯ä¸€ä¸ªå¹¶è¡Œçš„ä¸”å¤šçº¿ç¨‹çš„é˜¶æ®µ,å¯ä»¥é€šè¿‡é€‰é¡¹-XX:ConcGCThreadsæ¥è®¾ç½®å¹¶è¡Œçº¿ç¨‹çš„æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹,G1 GCè®¾ç½®å¹¶è¡Œæ ‡è®°é˜¶æ®µçº¿ç¨‹æ•°é‡ä¸ºé€‰é¡¹-XX:ParallelGCThreads(å¹¶è¡ŒGCçº¿ç¨‹)çš„1/4ã€‚å¹¶è¡Œæ ‡è®°çº¿ç¨‹ä¸€æ¬¡åªæ‰«æä¸€ä¸ªåŒºé—´,æ‰«æå®Œæ¯•åŽä¼šé€šè¿‡æ ‡è®°ä½æ–¹å¼æ ‡è®°è¯¥åŒºé—´å·²ç»æ‰«æå®Œæ¯•ä¸ºäº†æ»¡è¶³SATBå¹¶è¡Œæ ‡è®°ç®—æ³•çš„è¦æ±‚,G1 GCé‡‡ç”¨ä¸€ä¸ªå†™å‰barrieræ‰§è¡Œç›¸åº”çš„åŠ¨ä½œã€‚ 4.é‡æ ‡è®°é˜¶æ®µé‡æ ‡è®°é˜¶æ®µæ˜¯æ•´ä¸ªæ ‡è®°é˜¶æ®µçš„æœ€åŽä¸€çŽ¯ã€‚è¿™ä¸ªé˜¶æ®µæ˜¯ä¸€ä¸ªç‹¬å å¼é˜¶æ®µ,åœ¨æ•´ä¸ªç‹¬å å¼è¿‡ç¨‹ä¸­,G1 GCå®Œå…¨å¤„ç†äº†é—ç•™çš„SATBæ—¥å¿—ç¼“å­˜ã€æ›´æ–°ã€‚è¿™ä¸ªé˜¶æ®µä¸»è¦çš„ç›®æ ‡æ˜¯ç»Ÿè®¡å­˜æ´»å¯¹è±¡çš„æ•°é‡,åŒæ—¶ä¹Ÿå¯¹å¼•ç”¨å¯¹è±¡è¿›è¡Œå¤„ç†ã€‚ G1 GCé‡‡ç”¨å¤šçº¿ç¨‹æ–¹å¼åŠ å¿«å¹¶è¡Œå¤„ç†æ—¥å¿—ç¼“å­˜æ–‡ä»¶,è¿™æ ·å¯ä»¥èŠ‚çœä¸‹æ¥å¾ˆå¤šæ—¶é—´,é€šè¿‡é€‰é¡¹-XX:ParallelGCThreadså¯ä»¥è®¾ç½®GCæ•°é‡ã€‚ æ³¨æ„,å¦‚æžœä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨äº†å¤§é‡çš„å¼•ç”¨å¯¹è±¡,ä¾‹å¦‚å¼±å¼•ç”¨ã€è½¯å¼•ç”¨ã€è™šå¼•ç”¨ã€å¼ºå¼•ç”¨,é‚£ä¹ˆè¿™ä¸ªé‡æ ‡è®°é˜¶æ®µçš„è€—æ—¶ä¼šæœ‰æ‰€å¢žåŠ ã€‚ 5.æ¸…é™¤é˜¶æ®µå‰é¢å„ä¸ªé˜¶æ®µåœ¨åšçš„ä¸»è¦äº‹æƒ…å°±æ˜¯ä¸ºäº†æ ‡è®°å¯¹è±¡,é‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦é’ˆå¯¹æ¯ä¸€ä¸ªåŒºé—´è¿›è¡Œæ ‡è®°å‘¢?è¿™æ˜¯å› ä¸ºå¦‚æžœæˆ‘ä»¬çŸ¥é“äº†æ¯ä¸ªåŒºé—´çš„å­˜æ´»å¯¹è±¡æ•°é‡,å¦‚æžœè¿™ä¸ªåŒºé—´æ²¡æœ‰ä¸€ä¸ªå­˜æ´»å¯¹è±¡,é‚£ä¹ˆå°±å¯ä»¥å¾ˆå¿«åœ°æ¸…é™¤RSet,å¹¶ä¸”ç«‹å³æ”¾å…¥ç©ºé—²åŒºé—´é˜Ÿåˆ—,è€Œä¸æ˜¯å°†è¿™ä¸ªåŒºé—´æ”¾å…¥æŽ’é˜Ÿåºåˆ—,ç­‰å¾…ä¸€ä¸ªæ··åˆåžƒåœ¾å›žæ”¶æš‚åœé˜¶æ®µçš„å›žæ”¶ã€‚RSetä¹Ÿå¯ä»¥è¢«ç”¨æ¥å¸®åŠ©æ£€æµ‹è¿‡æœŸå¼•ç”¨,ä¾‹å¦‚,å¦‚æžœæ ‡è®°é˜¶æ®µå‘çŽ°æ‰€æœ‰åœ¨ç‰¹å®šå †å—ä¸Šçš„å¯¹è±¡éƒ½å·²ç»æ­»äº¡,é‚£ä¹ˆRSetå¯ä»¥å¿«é€Ÿæ¸…é™¤è¿™å—å †å—ã€‚ ä¸€å¥è¯æ€»ç»“,æ¸…é™¤é˜¶æ®µä¼šè¯†åˆ«å¹¶æ¸…ç†å®Œå…¨ç©ºé—²çš„åŒºåŸŸã€‚å®ƒæ˜¯å¹¶å‘çš„æ¸…ç†,ä¸ä¼šå¼•èµ·åœé¡¿ã€‚ è¯„ä¼°å¤±è´¥å’Œå®Œå…¨å›žæ”¶å¦‚æžœåœ¨å¹´è½»ä»£åŒºé—´æˆ–è€…è€å¹´ä»£åŒºé—´æ‰§è¡Œæ‹·è´å­˜æ´»å¯¹è±¡æ“ä½œçš„æ—¶å€™,æ‰¾ä¸åˆ°ä¸€ä¸ªç©ºé—²çš„åŒºé—´,é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åœ¨GCæ—¥å¿—é‡Œçœ‹åˆ°è¯¸å¦‚â€œto-space exhaustedâ€è¿™æ ·çš„é”™è¯¯æ—¥å¿—æ‰“å°ã€‚ å‘ç”Ÿè¿™ä¸ªé”™è¯¯çš„åŒæ—¶,G1 GCä¼šå°è¯•åŽ»æ‰©å±•å¯ç”¨çš„Javaå †å†…å­˜å¤§å°ã€‚å¦‚æžœæ‰©å±•å¤±è´¥,G1 GCä¼šè§¦å‘å®ƒçš„å¤±è´¥ä¿æŠ¤æœºåˆ¶å¹¶ä¸”å¯åŠ¨å•çº¿ç¨‹çš„å®Œå…¨å›žæ”¶åŠ¨ä½œã€‚ åœ¨è¿™ä¸ªå®Œå…¨å›žæ”¶é˜¶æ®µ,å•çº¿ç¨‹ä¼šé’ˆå¯¹æ•´ä¸ªå †å†…å­˜é‡Œçš„æ‰€æœ‰åŒºé—´è¿›è¡Œæ ‡è®°ã€æ¸…é™¤ã€åŽ‹ç¼©ç­‰åŠ¨ä½œã€‚åœ¨å®Œæˆå›žæ”¶åŽ,å †å†…å­˜å°±å®Œå…¨ç”±å­˜æ´»å¯¹è±¡å¡«å……,å¹¶ä¸”æ‰€æœ‰çš„å¹´é¾„ä»£å¯¹åº”çš„åŒºé—´éƒ½å·²ç»å®Œæˆäº†åŽ‹ç¼©ä»»åŠ¡ã€‚ ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™ä¸ªå®Œå…¨å›žæ”¶æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„,æ‰€ä»¥å½“å †å†…å­˜å¾ˆå¤§æ—¶åŠ¿å¿…è€—æ—¶å¾ˆé•¿,æ‰€ä»¥éœ€è¦è°¨æ…Žä½¿ç”¨,æœ€å¥½ä¸è¦è®©å®ƒç»å¸¸å‘ç”Ÿ,ä»¥é¿å…ä¸å¿…è¦çš„é•¿æ—¶é—´çš„åº”ç”¨ç¨‹åºæš‚åœã€‚ G1 GCä½¿ç”¨åœºæ™¯å¦‚æžœåº”ç”¨ç¨‹åºå…·æœ‰å¦‚ä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å¾,é‚£ä¹ˆå°†åžƒåœ¾æ”¶é›†å™¨ä»ŽCMSæˆ–ParallelOldGCåˆ‡æ¢åˆ°G1å°†ä¼šå¤§å¤§æå‡æ€§èƒ½: Full GCæ¬¡æ•°å¤ªé¢‘ç¹æˆ–è€…æ¶ˆè€—æ—¶é—´å¤ªé•¿ å¯¹è±¡åˆ†é…çš„é¢‘çŽ‡æˆ–ä»£æ•°æå‡(promotion)æ˜¾è‘—å˜åŒ–ã€‚ å—å¤Ÿäº†å¤ªé•¿çš„åžƒåœ¾å›žæ”¶æˆ–å†…å­˜æ•´ç†æ—¶é—´(è¶…è¿‡0.5~1s) æ³¨æ„,å¦‚æžœæ­£åœ¨ä½¿ç”¨CMSæˆ–ParallelOldGC,è€Œåº”ç”¨ç¨‹åºçš„åžƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´å¹¶ä¸é•¿,é‚£ä¹ˆç»§ç»­ä½¿ç”¨çŽ°åœ¨çš„åžƒåœ¾æ”¶é›†å™¨æ˜¯ä¸ªå¥½ä¸»æ„ã€‚ G1 GCæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆG1çš„å¹´è½»ä»£å›žæ”¶External Root Regionså¤–éƒ¨æ ¹åŒºé—´æ‰«ææŒ‡çš„æ˜¯ä»Žæ ¹éƒ¨å¼€å§‹æ‰«æé€šè¿‡JNIä¸­æœ¬åœ°çš„ç±»ä¸­è°ƒç”¨Mallocå‡½æ•°åˆ†é…å‡ºçš„å†…å­˜ã€‚è¿™ä¸ªæ­¥éª¤æ˜¯å¹¶è¡Œä»»åŠ¡çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ã€‚è¿™ä¸ªé˜¶æ®µå †å¤–(off-heap)æ ¹èŠ‚ç‚¹è¢«å¼€å§‹æ‰«æ,è¿™äº›æ‰«æèŒƒå›´åŒ…æ‹¬JVMç³»ç»Ÿå­—å…¸ã€VMæ•°æ®ç»“æž„ã€JNIçº¿ç¨‹å¥æŸ„ã€ç¡¬ä»¶æ³¨å†Œå™¨ã€å…¨å±€å˜é‡,ä»¥åŠçº¿ç¨‹æ ˆæ ¹éƒ¨ç­‰,è¿™ä¸ªè¿‡ç¨‹ä¸»è¦æ˜¯ä¸ºäº†æ‰¾åˆ°å¹¶è¡Œæš‚åœé˜¶æ®µæ˜¯å¦å­˜åœ¨æŒ‡å‘å½“å‰æ”¶é›†é›†åˆ(CSet)çš„æŒ‡é’ˆã€‚ è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæƒ…å†µéœ€è¦å¼•èµ·å¤§å®¶çš„é‡è§†,å°±æ˜¯æŸ¥çœ‹å·¥ä½œçº¿ç¨‹æ˜¯å¦åœ¨å¤„ç†ä¸€ä¸ªå•ä¸€çš„æ ¹èŠ‚ç‚¹æ—¶è€—æ—¶è¿‡é•¿,å¯¼è‡´æ„Ÿè§‰ç±»ä¼¼æŒ‚èµ·çš„çŽ°è±¡ã€‚è¿™ä¸ªçŽ°è±¡å¯ä»¥é€šè¿‡æŸ¥çœ‹å·¥ä½œçº¿ç¨‹å¯¹åº”çš„â€œterminationâ€æ—¥å¿—çœ‹å‡ºæ¥ã€‚å¦‚æžœå­˜åœ¨è¿™ä¸ªçŽ°è±¡,ä½ éœ€è¦åŽ»æŸ¥çœ‹æ˜¯å¦å­˜åœ¨æ¯”è¾ƒå¤§çš„ç³»ç»Ÿå­—å…¸(JVM System Dictionary),å¦‚æžœè¿™ä¸ªç³»ç»Ÿå­—å…¸è¢«å½“æˆäº†ä¸€ä¸ªå•ä¸€æ ¹èŠ‚ç‚¹è¿›è¡Œå¤„ç†,é‚£ä¹ˆå½“å­˜åœ¨å¤§é‡çš„åŠ è½½ç±»æ—¶å°±ä¼šå‡ºçŽ°è¾ƒé•¿æ—¶é—´çš„è€—æ—¶ã€‚ Rememebered Sets and Processed BuffersRsetå¸®åŠ©ç»´æŠ¤å’Œè·Ÿè¸ªæŒ‡å‘G1åŒºé—´çš„å¼•ç”¨,è€Œè¿™äº›åŒºé—´æœ¬èº«æ‹¥æœ‰è¿™äº›RSetã€‚è¿˜è®°å¾—æˆ‘ä»¬åœ¨ç¬¬4ç« ä»‹ç»è¿‡çš„å¹¶è¡ŒRefinementçº¿ç¨‹å—?è¿™äº›çº¿ç¨‹çš„ä»»åŠ¡æ˜¯æ‰«ææ›´æ–°æ—¥å¿—ç¼“å­˜,å¹¶ä¸”æ›´æ–°åŒºé—´çš„RSetã€‚ä¸ºäº†æ›´åŠ æœ‰æ•ˆåœ°æ”¯æ´è¿™äº›Refinementçº¿ç¨‹çš„å·¥ä½œ,åœ¨å¹¶è¡Œå›žæ”¶é˜¶æ®µ,æ‰€æœ‰æœªè¢«å¤„ç†çš„ç¼“å­˜(å·²ç»æœ‰æ—¥å¿—å†™åœ¨é‡Œé¢äº†)éƒ½ä¼šè¢«å·¥ä½œçº¿ç¨‹æ‹¿æ¥å¤„ç†,è¿™äº›ç¼“å­˜ä¹Ÿè¢«ç§°ä¸ºæ—¥å¿—é‡Œé¢çš„å¤„ç†ç¼“å­˜ã€‚ ä¸ºäº†é™åˆ¶èŠ±è´¹åœ¨æ›´æ–°RSetä¸Šçš„æ—¶é—´,G1é€šè¿‡é€‰é¡¹-XX:MaxGCPauseMillsè®¾ç½®äº†ç›®æ ‡æš‚åœæ—¶é—´,é‡‡ç”¨ç›¸å¯¹äºŽæ•´ä¸ªåœé¡¿ç›®æ ‡æ—¶é—´ç™¾åˆ†æ¯”çš„æ–¹å¼,é™åˆ¶äº†æ›´æ–°RSetèŠ±è´¹çš„æ€»æ—¶é•¿,è®©è¯„ä¼°æš‚åœé˜¶æ®µæŠŠæœ€å¤§é‡çš„æ—¶å€™èŠ±è´¹åœ¨æ‹·è´å­˜æ´»å¯¹è±¡ä¸Šã€‚è¿™ä¸ªç›®æ ‡æ—¶é—´é»˜è®¤ä¸ºæ•´ä¸ªåœé¡¿æ—¶é—´çš„10%,ä¾‹å¦‚æ•´ä¸ªåœé¡¿æ—¶é—´æ˜¯10s,é‚£ä¹ˆèŠ±è´¹åœ¨æ›´æ–°RSetä¸Šçš„æ—¶é—´æœ€å¤§ä¸ºlsã€‚G1 GCçš„è®¾è®¡ç›®æ ‡æ˜¯è®©æ›´å¤šçš„åœé¡¿æ—¶é—´èŠ±è´¹åœ¨æ‹·è´å­˜æ´»å¯¹è±¡ä¸Šé¢,å› æ­¤æš‚åœæ—¶é—´çš„10%è¢«ç”¨äºŽæ›´æ–°RSetä¹Ÿæ˜¯æ¯”è¾ƒåˆç†çš„,ç™¾åˆ†æ¯”å¤§äº†,èŠ±åœ¨å¹²å…·ä½“ä¸šåŠ¡(å„é˜¶æ®µæ‹·è´å­˜æ´»å¯¹è±¡)ä¸Šçš„æ—¶é—´ä¹Ÿå°±å°‘äº†ã€‚ å¦‚æžœä½ å‘çŽ°è¿™ä¸ªå€¼ä¸å¤ªå‡†ç¡®æˆ–è€…ä¸ç¬¦åˆä½ çš„å®žé™…éœ€æ±‚,è¿™é‡Œå¯ä»¥é€šè¿‡æ›´æ–°é€‰é¡¹-XX:G1RSetUpdatingPauseTimePercentæ¥æ”¹å˜è¿™ä¸ªæ›´æ–°RSetçš„ç›®æ ‡æ—¶é—´å€¼ã€‚åˆ‡è®°,å¦‚æžœä½ æ”¹å˜äº†èŠ±è´¹åœ¨æ›´æ–°RSetä¸Šçš„æ—¶é—´,é‚£ä½ å¿…é¡»æœ‰æŠŠæ¡å·¥ä½œçº¿ç¨‹å¯ä»¥åœ¨å›žæ”¶æš‚åœé˜¶æ®µå®Œæˆå®ƒä»¬çš„å·¥ä½œ,å¦‚æžœä¸èƒ½,é‚£è¿™éƒ¨åˆ†å·¥ä½œä¼šè¢«æ”¾åˆ°å¹¶è¡ŒRefinementçº¿ç¨‹é‡Œé¢åŽ»æ‰§è¡Œ,è¿™ä¼šå¯¼è‡´å¹¶è¡Œå·¥ä½œé‡å¢žåŠ ã€å¹¶è¡Œå›žæ”¶æ¬¡æ•°å¢žå¤šã€‚æœ€åçš„æƒ…å†µæ˜¯å¦‚æžœå¹¶è¡ŒRefinementçº¿ç¨‹ä¹Ÿä¸èƒ½å®Œæˆä»»åŠ¡,é‚£ä¹ˆJavaåº”ç”¨ç¨‹åºå°±ä¼šè¢«æš‚åœ,åŽŸæœ¬è´Ÿè´£æ‰§è¡ŒJavaåº”ç”¨ç¨‹åºçš„èµ„æºå°±ä¼šç›´æŽ¥æŽ¥æ‰‹ä»»åŠ¡,è¿™ä¸ªç”»é¢â€œå¤ªç¾Žâ€ä¸æ•¢çœ‹!å¤§å®¶è¦å°½é‡é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿã€‚ æ³¨æ„,-XX:G1ConcRefinementThreadsé€‰é¡¹çš„å€¼é»˜è®¤å’Œ-XX:ParallelGCThreadsçš„å€¼ä¸€æ ·,è¿™æ„å‘³ç€å¯¹äºŽ-XX:ParallelGCThreadsé€‰é¡¹çš„ä¿®æ”¹ä¼šåŒæ ·æ”¹å˜-XX:G1ConcRefinementThreadsé€‰é¡¹çš„å€¼ã€‚ åœ¨å½“å‰CSeté‡Œé¢å›žæ”¶ä¹‹å‰,CSetå†…éƒ¨çš„æ¯ä¸ªåŒºé—´çš„Rsetéƒ½éœ€è¦è¢«æ‰«æ,ä¸»è¦ç›®çš„æ˜¯æ‰¾åˆ°CSetåŒºé—´å†…éƒ¨çš„å¼•ç”¨å…³ç³»ã€‚ä¸€ä¸ªæœ‰è¾ƒå¤šå­˜æ´»å¯¹è±¡çš„åŒºé—´å®¹æ˜“å¯¼è‡´Rsetçš„ç²’åº¦å˜ç»†,å³æ¯ä¸ªåŒºé—´å¯¹åº”çš„è¡¨æ ¼ä¼šä»Žç²—ç²’åº¦å˜ä¸ºç»†ç²’åº¦,ä¹Ÿå¯ä»¥ç†è§£ä¸ºé‡Œé¢å¯¹è±¡å¢žå¤šåŽæ‰«æä¸€ä¸ªRsetéœ€è¦æ›´é•¿çš„æ‰«ææ—¶é—´,è¿™æ ·ä½ å°±ä¼šçœ‹åˆ°æ›´å¤šçš„æ—¶é—´è¢«èŠ±è´¹åœ¨äº†æ‰«æRSetä¸Šé¢ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºæ‰«ææ—¶é—´å–å†³äºŽRSetæ•°æ®ç»“æž„çš„ç²—ç»†ç²’åº¦ã€‚ Summarizing Remembered SetsXX:+G1SummarizeRSetStatsé€‰é¡¹ç”¨äºŽç»Ÿè®¡RSetçš„å¯†åº¦æ•°é‡(ç»†ç²’åº¦æˆ–è€…ç²—ç²’åº¦),è¿™ä¸ªå¯†åº¦å¸®åŠ©å†³å®šæ˜¯å¦å¹¶è¡ŒRefinementçº¿ç¨‹æœ‰èƒ½åŠ›åŽ»åº”å¯¹æ›´æ–°ç¼“å­˜çš„å·¥ä½œ,å¹¶ä¸”æ”¶é›†æ›´å¤šå…³äºŽNmethodsçš„ä¿¡æ¯ã€‚è¿™ä¸ªé€‰é¡¹æ¯éš”næ¬¡GCæš‚åœæ”¶é›†ä¸€æ¬¡RSetçš„ç»Ÿè®¡ä¿¡æ¯,è¿™ä¸ªnæ¬¡ç”±é€‰é¡¹-XX:G1SummarizeRSetStatsPeriod=nå†³å®š,ä¹Ÿæ˜¯éœ€è¦é€šè¿‡é€‰é¡¹è¿›è¡Œè®¾ç½®çš„ã€‚ æ³¨æ„,-XX:+G1SummarizeRSetStatsé€‰é¡¹æ˜¯ä¸€ä¸ªè¯Šæ–­é€‰é¡¹,å› æ­¤å¿…é¡»å¯ç”¨-XX:+UnlockDiagnosticVMOptionsé€‰é¡¹æ‰å¯ä»¥å¯ç”¨-XX:+G1SummarizeRSetStatsé€‰é¡¹ã€‚ PDFä¹¦ç±ä¸‹è½½åœ°å€ï¼šhttps://github.com/jiankunking/books-recommendation/tree/master/Java]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>GC</tag>
        <tag>G1</tag>
        <tag>JVM</tag>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“ç´¢å¼•è®¾è®¡ä¸Žä¼˜åŒ– ç¬”è®°]]></title>
    <url>%2Frelational-database-index-design-and-the-optimizers-note.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ•´ç†è‡ªï¼šã€Šæ•°æ®åº“ç´¢å¼•è®¾è®¡ä¸Žä¼˜åŒ–ã€‹ ä½œè€…ï¼šTapio Lahdenmakiï¼ŒMichael Leach å‡ºç‰ˆæ—¶é—´ï¼š2015-06-01 æ¦‚è¿°ç´¢å¼•è¯¯åŒºè¯¯åŒº1ï¼šç´¢å¼•å±‚çº§ä¸è¦è¶…è¿‡5å±‚ç”±äºŽéžå¶å­é¡µé€šå¸¸éƒ½ä¼šç•™åœ¨å†…å­˜æˆ–è€…è¯»ç¼“å­˜ä¸­ï¼Œæ‰€ä»¥é€šå¸¸ç´¢å¼•ä»»æ„ä¸€ä¸ªå¶å­é¡µçš„æ—¶é—´ä¸º10ms~20msï¼Œè¿™æ˜¯å›ºå®šçš„ã€‚æ‰€ä»¥ï¼Œå¯¹ç´¢å¼•å±‚æ•°çš„é™åˆ¶æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„ã€‚ è¯¯åŒº2ï¼šå•è¡¨çš„ç´¢å¼•æ•°ä¸è¦è¶…è¿‡6ä¸ªæˆ‘å»ºè®®ä¸è¦ç»™è¡¨çš„ç´¢å¼•æ•°ç›®è®¾ç½®ä¸Šé™ã€‚ ä¿è¯æ‰€æœ‰çš„SQLè¯­å¥éƒ½èƒ½å¤Ÿæµç•…è¿è¡Œæ˜¯è®¾è®¡çš„åº•çº¿ã€‚æˆ‘ä»¬æ€»èƒ½æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥è¾¾åˆ°è¿™ä¸€ç‚¹ã€‚å¦‚æžœä¸ºäº†è¾¾åˆ°è¿™ä¸€ç‚¹éœ€è¦åœ¨è¡¨ä¸Šåˆ›å»º10ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆä½ å°±åº”è¯¥åœ¨è¡¨ä¸Šå»ºç«‹10ä¸ªç´¢å¼•ã€‚ è¯¯åŒº3ï¼šä¸åº”è¯¥ç´¢å¼•ä¸ç¨³å®šçš„åˆ—ç´¢å¼•è¡Œæ˜¯æŒ‰ç´¢å¼•é”®çš„é¡ºåºå­˜å‚¨çš„ï¼Œæ‰€ä»¥å½“ç´¢å¼•é”®ä¸­å­˜ä¸€åˆ—è¢«æ›´æ–°æ—¶ï¼ŒDBMSå¯èƒ½ä¸å¾—ä¸æŠŠç›¸åº”çš„è¡Œä»Žæ—§çš„ç´¢å¼•ä½ç½®ç§»åˆ°æ–°çš„ä½ç½®æ¥ä¿æŒè¿™ä¸€é¡ºåºã€‚è¿™ä¸ªæ–°çš„ä½è¿“å¯èƒ½ä¸Žæ—§çš„ä½æ™‹ä½äºŽç›¸åŒçš„å¶å­è´žä¸Šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªé¡µä¼šå—åˆ°å½±å“ã€‚ç„¶è€Œï¼Œå¦‚æžœè¢«ä¿®æ”¹çš„é”®æ˜¯ç¬¬ä¸€åˆ—æˆ–å”¯ä¸€çš„åˆ—ï¼Œé‚£ä¹ˆæ–°çš„ç´¢å¼•è¡Œå¯èƒ½å¿…é¡»è¢«è¿ç§»åˆ°ä¸€ä¸ªä¸åŒçš„å¶å­é¡µä¸Šï¼Œå³DBMSå¿…é¡»æ›´æ–°ä¸¤ä¸ªå¶å­é¡µã€‚ä¸‰åå¹´å‰ï¼Œå¦‚æžœè¿™ä¸ªç´¢å¼•ä¸ºä¸€ä¸ª4å±‚ç´¢å¼•ï¼Œè¿™ä¹Ÿè®¸éœ€è¦6æ¬¡ç£ç›˜éšæœºè¯»å–ï¼š3æ¬¡å¸¸è§„è¯»å–ï¼Œå³2æ¬¡éžå¶å­é¡µè¯»å–å’Œ1æ¬¡å¶å­é¡µè¯»å–ï¼ŒåŠ ä¸Šæ–°çš„ä½ç½®æ‰€æ¶‰åŠçš„3æ¬¡éšæœºè¯»å–ã€‚å½“ä¸€æ¬¡éšæœºè¯»å–è€—æ—¶30ms æ—¶ï¼Œè¿ç§»ä¸€ä¸ªç´¢å¼•è¡Œå¯èƒ½ä¼šç»™è¯¥æ›´æ–°æ“ä½œé¢å¤–å¢žåŠ 6 x 30ms =180ms çš„å“åº”æ—¶é—´ã€‚å› æ­¤ï¼Œä¸ç¨³å®šçš„åˆ—å¾ˆå°‘è¢«ç´¢å¼•å°±ä¸è¶³ä¸ºå¥‡äº†ã€‚ çŽ°åœ¨ï¼Œå½“å››å±‚ç´¢å¼•ä¸­ä¸‰ä¸ªå±‚çº§çš„éžå¶å­é¡µä¿ç•™åœ¨å†…å­˜ä¸­æ—¶ï¼Œä¸€æ¬¡ç£ç›˜éšæœºè¯»å–éœ€è¦ l0 ms ï¼Œå“åº”çš„æ—¶é—´å˜æˆäº† 2 x 10ms = 20ms ã€‚æ­¤å¤–ï¼Œè®¸å¤šç´¢å¼•ä¸ºå¤šåˆ—ç´¢å¼•ï¼Œä¹Ÿç§°ä½œå¤åˆæˆ–ç»„åˆç´¢å¼•ï¼Œå®ƒé€šå¸¸åŒ…å«å¤šåˆ—ï¼Œä»¥ä½¿å¾—ç´¢å¼•é”®å€¼å”¯ä¸€ã€‚å½“ä¸ç¨³å®šçš„åˆ—ä¸ºå¤åˆç´¢å¼•çš„å°¾åˆ—æ›´æ–°è¿™ä¸ªä¸ç¨³å®šçš„åˆ—ç»ä¸ä¼šå¯¼è‡´å…¶è¿ç§»åˆ°æ–°çš„å¶å­é¡µã€‚å› æ­¤ï¼Œåœ¨å½“å‰çš„ç£ç›˜æ¡ä»¶ä¸‹ï¼Œæ›´æ–°ä¸€ä¸ªä¸ç¨³å®šçš„åˆ—åªä¼šå¯¹è¯¥æ›´æ–°æ“ä½œå¢žåŠ 10msçš„å“åº”æ—¶é—´ã€‚ åœ¨å½“å‰ç£ç›˜æ¡ä»¶ä¸‹ï¼Œåªæœ‰åœ¨æ›´æ–°é¢‘çŽ‡å¤šäºŽ10æ¬¡/ç§’çš„æƒ…å†µä¸‹ï¼Œä¸ç¨³å®šåˆ—æ‰å¯èƒ½æˆä¸ºé—®é¢˜ã€‚ åˆ›å»ºç´¢å¼•çš„ç›®çš„åº”è¯¥æ˜¯åœ¨ç¡¬ä»¶å®¹é‡é™åˆ¶çš„å‰æä¸‹ä¿è¯æ‰€æœ‰çš„æ•°æ®åº“è°ƒç”¨è¿è¡Œçš„è¶³å¤Ÿå¿«ã€‚ ç³»ç»ŸåŒ–çš„ç´¢å¼•è®¾è®¡ æ‰¾åˆ°ç”±äºŽç´¢å¼•ä¸åˆé€‚è€Œå¯¼è‡´è¿è¡Œå¤ªæ…¢çš„æŸ¥è¯¢è¯­å¥ æœ€å·®è¾“å…¥ï¼šå¯¼è‡´æ‰§è¡Œæ—¶é—´æœ€é•¿çš„å˜é‡å€¼ è®¾è®¡ç´¢å¼•ï¼Œä½¿æ‰€æœ‰æŸ¥è¯¢è¯­å¥éƒ½è¿è¡Œçš„è¶³å¤Ÿå¿« è¡¨çš„ç»´æŠ¤ï¼ˆæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰ä¹Ÿå¿…é¡»è¶³å¤Ÿå¿« è¡¨å’Œç´¢å¼•ç»“æž„DBMS ä¼šæ„è¯†åˆ°å¤šä¸ªç´¢å¼•æˆ–è¡¨é¡µéœ€è¦è¢«é¡ºåºåœ°è¯»å–ï¼Œä¸”èƒ½è¯†åˆ¥å‡ºé‚£äº›ä¸åœ¨ç¼“å†²æ± ä¸­çš„é¡µã€‚éšåŽï¼Œå®ƒå°†å‘å‡ºå¤šé¡µI/Oè¯·æ±‚ï¼Œæ¯æ¬¡è¯·æ±‚çš„é¡µçš„æ•°é‡ç”±DBMSå†³å®šã€‚åªæœ‰é‚£äº›ä¸åœ¨ç¼“å†²æ± ä¸­çš„é¡µä¼šè¢«ä»Žç£ç›˜æœåŠ¡å™¨ä¸Šè¯»å–ï¼Œå› ä¸ºé‚£äº›å·²ç»åœ¨ç¼“å†²æ± ä¸­çš„é¡µä¸­å¯èƒ½åŒ…å«äº†å°šæœªè¢«å†™äººç£ç›˜çš„æ›´æ–°æ•°æ®ã€‚ SQLå¤„ç†è¿‡ç¨‹è°“è¯WHEREå­å¥ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªè°“è¯ï¼ˆæœç´¢å‚æ•°ï¼‰ç»„æˆã€‚ 123456# SQL 3.1WHERE SEX = &apos;M&apos; AND (WEIGHT &gt; 90 OR HEIGHT &gt; 190) SQL 3.1ä¸­æœ‰ä¸‰ä¸ªç®€å•è°“è¯ï¼Œå®ƒä»¬æ˜¯ï¼š SEX = â€˜Mâ€™ WEIGHT &gt; 90 HEIGHT &gt; 190 åŒæ ·ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸¤ä¸ªç»„åˆè°“è¯ï¼š WEIGHT &gt; 90 OR HEIGHT &gt; 190 SEX = â€˜Mâ€™ AND ( WEIGHT &gt; 90 OR HEIGHT &gt; 190 ) è°“è¯è¡¨è¾¾å¼æ˜¯ç´¢å¼•è®¾è®¡çš„ä¸»è¦å…¥æ‰‹ç‚¹ã€‚å¦‚æžœä¸€ä¸ªç´¢å¼•èƒ½å¤Ÿæ»¡è¶³SELECTæŸ¥è¯¢è¯­å¥çš„æ‰€æœ‰è°“è¯è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆä¼˜åŒ–å™¨å°±å¾ˆæœ‰å¯èƒ½å»ºç«‹èµ·ä¸€ä¸ªé«˜æ•ˆçš„è®¿é—®è·¯å¾„ã€‚ æ ¸å®žç¡®è®¤è®¿é—®è·¯å¾„ï¼ˆæ‰§è¡Œè®¡åˆ’ï¼‰ ä¸ºSELETEè¯­å¥åˆ›å»ºç†æƒ³çš„ç´¢å¼•ã€é‡ç‚¹ã€‘ å¾ˆå¤šè°ƒä¼˜äººå‘˜ï¼ˆå°½ç®¡æ²¡ç»éªŒï¼‰è®¤ä¸ºï¼Œå¦‚æžœä¸€ä¸ªSQLè¯­å¥ä½¿ç”¨äº†ç´¢å¼•ï¼Œé‚£è¿™ä¸ª SQLå°±æ˜¯è¢«å¾ˆå¥½åœ°ä¼˜åŒ–è¿‡çš„ï¼Œæˆ‘å¯¹æ­¤æ„Ÿåˆ°å¾ˆæƒŠè®¶ã€‚ä½ åº”è¯¥æ€»æ˜¯é—®è‡ªå·±ï¼Œâ€è¿™æ˜¯ä¸æ˜¯å¯ç”¨çš„æœ€å¥½çš„ç´¢å¼•ï¼Ÿâ€ æˆ– â€œå†æ·»åŠ å¦å¤–ä¸€ä¸ªç´¢å¼•èƒ½å¦æå‡å“åº”æ€§èƒ½ï¼Ÿâ€ï¼Œåˆæˆ–è€… â€œå…¨è¡¨æ‰«æä¼šä¸ä¼šæ›´å¿«åœ°è¿”å›žç»“æžœï¼Ÿâ€ ä¸‰æ˜Ÿç´¢å¼• ä¸‰æ˜Ÿç´¢å¼•ï¼šæŸ¥è¯¢è¯­å¥çš„ç†æƒ³ç´¢å¼•ã€‚ 1234567DECLARE CURSOR41 CURSOR FORSELECT CNO, FNAMEFROM CUSTWHERE LNAME = :LNAME AND CITY = :CITYORDER BY FNAME æ˜Ÿçº§æ˜¯å¦‚ä½•ç»™å®šçš„å¦‚æžœä¸Žä¸€ä¸ªæŸ¥è¯¢ç›¸å…³çš„ç´¢å¼•è¡Œæ˜¯ç›¸é‚»çš„ï¼Œæˆ–è€…è‡³å°‘ç›¸è·è¶³å¤Ÿé è¿‘çš„è¯ï¼Œé‚£è¿™ä¸ªç´¢å¼•å°±å¯ä»¥è¢«æ ‡è®°ä¸Šç¬¬ä¸€é¢—æ˜Ÿã€‚è¿™æœ€å°åŒ–äº†å¿…é¡»æ‰«æçš„ç´¢å¼•ç‰‡çš„å®½åº¦ã€‚ å¦‚æžœç´¢å¼•è¡Œçš„é¡ºåºä¸ŽæŸ¥è¯¢è¯­å¥çš„éœ€æ±‚ä¸€è‡´ï¼Œåˆ™ç´¢å¼•å¯ä»¥è¢«æ ‡è®°ä¸Šç¬¬äºŒé¢—æ˜Ÿã€‚è¿™æŽ’é™¤äº†æŽ’åºæ“ä½œã€‚ å¦‚æžœç´¢å¼•è¡ŒåŒ…å«çš„æŸ¥è¯¢è¯­å¥ä¸­çš„æ‰€æœ‰åˆ—ï¼Œé‚£ä¹ˆç´¢å¼•å°±å¯ä»¥è¢«æ ‡è®°ä¸Šç¬¬ä¸‰é¢—æ˜Ÿã€‚è¿™é¿å…äº†è®¿é—®è¡¨çš„æ“ä½œï¼šä»…è®¿é—®ç´¢å¼•å°±å¯ä»¥äº†ã€‚ å¯¹äºŽè¿™ä¸‰é¢—æ˜Ÿï¼Œç¬¬ä¸‰é¢—é€šå¸¸æ˜¯æœ€é‡è¦çš„ã€‚å°†ä¸€ä¸ªåˆ—æŽ’é™¤åœ¨ç´¢å¼•ä¹‹å¤–å¯èƒ½ä¼šå¯¼è‡´è®¸å¤šé€Ÿåº¦è¾ƒæ…¢çš„ç£ç›˜éšæœºè¯»ã€‚æˆ‘ä»¬æŠŠä¸€ä¸ªè‡³å°‘åŒ…å«ç¬¬ä¸‰é¢—æ˜Ÿçš„ç´¢å¼•ç§°ä¸ºå¯¹åº”æŸ¥è¯¢è¯­å¥çš„å®½ç´¢å¼•ã€‚ å®½ç´¢å¼•ï¼šå®½ç´¢å¼•æ˜¯æŒ‡ä¸€ä¸ªè‡³å°‘æ»¡è¶³ç¬¬ä¸‰é¢—æ˜Ÿçš„ç´¢å¼•ã€‚è¯¥ç´¢å¼•åŒ…å«äº†SELECTè¯­å¥æ‰€æ¶‰åŠçš„æ‰€æœ‰åˆ—ï¼Œå› è€Œèƒ½å¤Ÿä½¿å¾—æŸ¥è¯¢åªéœ€è®¿é—®ç´¢å¼•è€Œæ— éœ€è®¿é—®è¡¨ã€‚ ä¸ºäº†æ»¡è¶³ç¬¬ä¸€é¢—æ˜Ÿé¦–å…ˆå–å‡ºæ‰€æœ‰ç­‰å€¼è°“è¯çš„åˆ—ï¼ˆWHERE COL=â€¦ï¼‰ã€‚æŠŠè¿™äº›åˆ—ä½œä¸ºç´¢å¼•æœ€å¼€å¤´çš„åˆ—â€”â€”ä»¥ä»»æ„é¡ºåºéƒ½å¯ä»¥ã€‚å¯¹äºŽCURSOR41æ¥è¯´ï¼Œä¸‰æ˜Ÿç´¢å¼•å¯ä»¥ä»¥LNAMEã€CITYæˆ–è€…ä»¥CITYã€LNAMEå¼€å¤´ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»æ‰«æçš„ç´¢å¼•ç‰‡å®½åº¦å°†è¢«ç¼©å‡è‡³æœ€çª„ã€‚ ä¸ºäº†æ»¡è¶³ç¬¬äºŒé¢—æ˜Ÿå°†ORDER BYåˆ—åŠ å…¥åˆ°ç´¢å¼•ä¸­ã€‚ä¸è¦æ”¹å˜è¿™äº›åˆ—çš„é¡ºåºï¼Œä½†æ˜¯å¿½ç•¥é‚£äº›åœ¨ç¬¬ä¸€æ­¥ä¸­å·²ç»åŠ å…¥ç´¢å¼•çš„åˆ—ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœCURSOR41åœ¨ORDER BY ä¸­æœ‰é‡å¤çš„åˆ—ï¼Œå¦‚ORDER BY LNAMEã€FNAMEæˆ–è€…æ˜¯ORDER BY FNAMEã€CITYï¼Œåªæœ‰FNAMEéœ€è¦åœ¨è¿™æ­¥ä¸­è¢«åŠ å…¥åˆ°ç´¢å¼•ä¸­åŽ»ã€‚å½“FNAMEæ˜¯ç´¢å¼•çš„ç¬¬ä¸‰åˆ—æ—¶ï¼Œç»“æžœé›†ä¸­çš„è®°å½•æ— é¡»æŽ’åºå°±å·²ç»æ˜¯ä»¥æ­£ç¡®çš„é¡ºåºæŽ’åˆ—çš„äº†ã€‚ç¬¬ä¸€æ¬¡è¯»å–æ“ä½œå°†è¿”å›žFNAMEå€¼æœ€å°çš„é‚£ä¸€è¡Œã€‚ ä¸ºäº†æ»¡è¶³ç¬¬ä¸‰é¢—æ˜Ÿå°†æŸ¥è¯¢è¯­å¥ä¸­å‰©ä½™çš„åˆ—åŠ åˆ°ç´¢å¼•ä¸­åŽ»ï¼Œåˆ—åœ¨ç´¢å¼•ä¸­æ·»åŠ çš„é¡ºåºå¯¹æŸ¥è¯¢è¯­å¥çš„æ€§èƒ½æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯å°†æ˜“å˜çš„åˆ—æ”¾åœ¨æœ€åŽèƒ½é™ä½Žæ›´æ–°çš„æˆæœ¬ã€‚çŽ°åœ¨ï¼Œç´¢å¼•å·²åŒ…å«äº†æ»¡è¶³æ— é¡»å›žè¡¨çš„è®¿é—®è·¯å¾„æ‰€éœ€çš„æ‰€æœ‰åˆ—ã€‚ æœ€ç»ˆä¸‰æ˜Ÿç´¢å¼•å°†ä¼šæ˜¯ï¼š(LNAME, CITY, FNAME, CNO) æˆ– (CITY, LNAME, FNAME, CNO) CURSOR41åœ¨ä»¥ä¸‹æ–¹é¢æ˜¯æœ€ä¸ºæŒ‘å‰”çš„ï¼š WHERE æ¡ä»¶ä¸åŒ…å«èŒƒå›´è°“è¯ï¼ˆBETWEENã€&gt;ã€&gt;=ç­‰ï¼‰ FROM è¯­å¥åªæ¶‰åŠå•è¡¨ æ‰€æœ‰è°“è¯å¯¹äºŽä¼˜åŒ–å™¨æ¥è¯´éƒ½è¶³å¤Ÿç®€å• èŒƒå›´è°“è¯ä¸Žä¸‰æ˜Ÿç´¢å¼•1234567DECLARE CURSOR43 CURSOR FORSELECT CNO, FNAMEFROM CUSTWHERE LNAME BETWEEN :LNAME1 AND :LNAME2 AND CITY = :CITY ORDER BY FNAME è®©æˆ‘ä»¬å°è¯•ä¸ºè¿™ä¸ª CURSOR è®¾è®¡ä¸€ä¸ªä¸‰æ˜Ÿç´¢å¼•ã€‚å¤§éƒ¨åˆ†çš„æŽ¨è®ºä¸Ž CURSOR41 ç›¸åŒï¼Œä½†æ˜¯â€œBETWEEN è°“è¯â€å°†â€œ=è°“è¯â€æ›¿ä»£åŽå°†ä¼šæœ‰å¾ˆå¤§çš„å½±å“ã€‚æˆ‘ä»¬å°†ä¼šä»¥ç›¸åçš„é¡ºåºä¾æ¬¡è€ƒè™‘ä¸‰é¢—æ˜Ÿï¼ŒæŒ‰ç†è¯´ï¼Œè¿™ä»£è¡¨äº†ç†è§£çš„éš¾åº¦ã€‚ é¦–å…ˆæ˜¯æœ€ç®€å•çš„æ˜Ÿï¼ˆè™½ç„¶éžå¸¸é‡è¦ï¼‰ï¼Œç¬¬ä¸‰é¢—æ˜Ÿã€‚æŒ‰ç…§å…ˆå‰æ‰€è¿°ï¼Œç¡®ä¿æŸ¥è¯¢è¯­å¥ä¸­çš„æ‰€æœ‰åˆ—éƒ½åœ¨ç´¢å¼•ä¸­å°±èƒ½æ»¡è¶³ç¬¬ä¸‰é¢—æ˜Ÿã€‚è¿™æ ·ä¸éœ€è¦è®¿é—®è¡¨ï¼Œé‚£ä¹ˆåŒæ­¥è¯»ä¹Ÿå°±ä¸ä¼šé€ æˆé—®é¢˜ã€‚ æ·»åŠ  ORDER BY åˆ—èƒ½ä½¿ç´¢å¼•æ»¡è¶³ç¬¬äºŒé¢—æ˜Ÿï¼Œä½†æ˜¯è¿™ä¸ªä»…åœ¨å°†å…¶æ”¾åœ¨ BETWEEN è°“è¯åˆ— LNAME ä¹‹å‰çš„æƒ…å†µä¸‹æ‰æˆç«‹ï¼Œå¦‚ç´¢å¼• (CITY, FNAME, LNAME)ã€‚ç”±äºŽ CITY çš„å€¼åªæœ‰ä¸€ä¸ªï¼ˆ=è°“è¯ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨è¿™ä¸ªç´¢å¼•å¯ä»¥ä½¿ç»“æžœé›†ä»¥ FNAME çš„é¡ºåºæŽ’åˆ—ï¼Œè€Œä¸éœ€è¦é¢å¤–çš„æŽ’åºã€‚ä½†æ˜¯å¦‚æžœ ORDER BY å­—æ®µåŠ åœ¨ BETWEEN è°“è¯åˆ— LNAME åŽé¢ï¼Œå¦‚ç´¢å¼• (CITY, LNAME, FNAME)ï¼Œé‚£ä¹ˆç´¢å¼•è¡Œä¸æ˜¯æŒ‰ FNAME é¡ºåºæŽ’åˆ—çš„ï¼Œå› è€Œå°±éœ€è¦è¿›è¡ŒæŽ’åºæ“ä½œã€‚å› æ­¤ï¼Œä¸ºäº†æ»¡è¶³ç¬¬äºŒé¢—æ˜Ÿï¼ŒFNAME å¿…é¡»åœ¨ BETWEEN è°“è¯åˆ— LNAME å‰é¢ï¼Œå¦‚ç´¢å¼• (FNAME, â€¦) æˆ–ç´¢å¼• (CITY, FNAME, â€¦)ã€‚ å†è€ƒè™‘ç¬¬ä¸€é¢—æ˜Ÿï¼Œå¦‚æžœ CITY æ˜¯ç´¢å¼•çš„ç¬¬ä¸€ä¸ªåˆ—ï¼Œé‚£æˆ‘ä»¬å°†ä¼šæœ‰ä¸€ä¸ªç›¸å¯¹è¾ƒçª„çš„ç´¢å¼•ç‰‡éœ€è¦æ‰«æï¼ˆMC=1ï¼‰ï¼Œè¿™å–å†³äºŽ CITY çš„è¿‡æ»¤å› å­ã€‚ä½†æ˜¯å¦‚æžœç”¨ç´¢å¼• (CITY, LNAME, â€¦) çš„è¯ï¼Œç´¢å¼•ç‰‡ä¼šæ›´çª„ï¼Œè¿™æ ·åœ¨æœ‰ä¸¤ä¸ªåŒ¹é…åˆ—çš„æƒ…å†µä¸‹æˆ‘ä»¬åªéœ€è¦è®¿é—®çœŸæ­£éœ€è¦çš„ç´¢å¼•è¡Œã€‚ä½†æ˜¯ï¼Œä¸ºäº†åšåˆ°è¿™æ ·ï¼Œå¹¶ä»Žä¸€ä¸ªå¾ˆçª„çš„ç´¢å¼•ç‰‡ä¸­èŽ·ç›Šï¼Œå…¶ä»–åˆ—ï¼ˆå¦‚ FNAMEï¼‰å°±ä¸èƒ½æ”¾åœ¨è¿™ä¸¤åˆ—ä¹‹é—´ã€‚ MC:match columnï¼ˆåŒ¹é…åˆ—ï¼‰ æ‰€ä»¥æˆ‘ä»¬çš„ç†æƒ³ç´¢å¼•ä¼šæœ‰å‡ é¢—æ˜Ÿå‘¢ï¼Ÿé¦–å…ˆå®ƒä¸€å®šèƒ½æœ‰ç¬¬ä¸‰é¢—æ˜Ÿï¼Œä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘ä»¬åˆšæ‰æ‰€è¯´ï¼Œæˆ‘ä»¬åªèƒ½æœ‰ç¬¬ä¸€é¢—æ˜Ÿæˆ–è€…ç¬¬äºŒé¢—æ˜Ÿï¼Œè€Œä¸èƒ½åŒæ—¶æ‹¥æœ‰ä¸¤è€…ï¼æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬åªèƒ½äºŒé€‰ä¸€ï¼š é¿å…æŽ’åº â€” æ‹¥æœ‰ç¬¬äºŒé¢—æ˜Ÿ æ‹¥æœ‰å¯èƒ½çš„æœ€çª„ç´¢å¼•ç‰‡ï¼Œä¸ä»…å°†éœ€è¦å¤„ç†çš„ç´¢å¼•è¡Œæ•°é™è‡³æœ€ä½Žï¼Œè€Œä¸”å°†åŽç»­å¤„ç†é‡ï¼Œç‰¹åˆ«æ˜¯è¡¨ä¸­æ•°æ®è¡Œçš„åŒæ­¥è¯»ï¼Œå‡å°‘åˆ°æœ€å°‘ â€” æ‹¥æœ‰ç¬¬ä¸€é¢—æ˜Ÿ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒBETWEEN è°“è¯æˆ–è€…ä»»ä½•å…¶ä»–èŒƒå›´è°“è¯çš„å‡ºçŽ°ï¼Œæ„å‘³ç€æˆ‘ä»¬ä¸èƒ½åŒæ—¶æ‹¥æœ‰ç¬¬ä¸€é¢—æ˜Ÿå’Œç¬¬äºŒé¢—æ˜Ÿã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸èƒ½æ‹¥æœ‰ä¸€ä¸ªä¸‰æ˜Ÿç´¢å¼•ã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬éœ€è¦åœ¨ç¬¬ä¸€é¢—æ˜Ÿå’Œç¬¬äºŒé¢—æ˜Ÿä¸­åšå‡ºé€‰æ‹©ã€‚é€šå¸¸è¿™ä¸æ˜¯ä¸€ä¸ªå›°éš¾çš„é€‰æ‹©ï¼Œå› ä¸ºç¬¬ä¸€é¢—æ˜Ÿä¸€èˆ¬æ¯”ç¬¬äºŒé¢—æ˜Ÿæ›´é‡è¦ï¼Œè™½ç„¶å¹¶ä¸æ€»æ˜¯è¿™æ ·ã€‚ ä¸ºæŸ¥è¯¢è¯­å¥è®¾è®¡æœ€ä½³ç´¢å¼•çš„ç®—æ³•æ ¹æ®ä»¥ä¸Šçš„è®¨è®ºï¼Œç†æƒ³çš„ç´¢å¼•æ˜¯ä¸€ä¸ªä¸‰æ˜Ÿç´¢å¼•ã€‚ç„¶è€Œï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œå½“å­˜åœ¨èŒƒå›´è°“è¯æ—¶ï¼Œè¿™æ˜¯ä¸å¯èƒ½å®žçŽ°çš„ã€‚æˆ‘ä»¬ï¼ˆä¹Ÿè®¸ï¼‰ä¸å¾—ä¸ç‰ºç‰²ç¬¬äºŒé¢—æ˜Ÿæ¥æ»¡è¶³ä¸€ä¸ªæ›´çª„çš„ç´¢å¼•ç‰‡ï¼ˆç¬¬ä¸€é¢—æ˜Ÿï¼‰ï¼Œè¿™æ ·ï¼Œæœ€ä½³ç´¢å¼•å°±åªæ‹¥æœ‰ä¸¤é¢—æ˜Ÿã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä»”ç»†åŒºåˆ†ç†æƒ³å’Œæœ€ä½³ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ç†æƒ³ç´¢å¼•æ˜¯ä¸å¯èƒ½å®žçŽ°çš„ã€‚å°†è¿™å±‚å› ç´ è€ƒè™‘åœ¨å†…ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ‰€æœ‰æƒ…å†µä¸‹åˆ›å»ºæœ€ä½³ç´¢å¼•ï¼ˆä¹Ÿè®¸ä¸æ˜¯ç†æƒ³ç´¢å¼•ï¼‰çš„è¿‡ç¨‹å…¬å¼åŒ–ã€‚åˆ›å»ºå‡ºçš„ç´¢å¼•å°†æ‹¥æœ‰ä¸‰é¢—æ˜Ÿæˆ–è€…ä¸¤é¢—æ˜Ÿã€‚ é¦–å…ˆè®¾è®¡ä¸€ä¸ªç´¢å¼•ç‰‡å°½å¯èƒ½çª„ï¼ˆç¬¬ä¸€é¢—æ˜Ÿï¼‰çš„å®½ç´¢å¼•ï¼ˆç¬¬ä¸‰é¢—æ˜Ÿï¼‰ã€‚å¦‚æžœæŸ¥è¯¢ä½¿ç”¨è¿™ä¸ªç´¢å¼•æ—¶ä¸éœ€è¦æŽ’åºï¼ˆç¬¬äºŒé¢—æ˜Ÿï¼‰ï¼Œé‚£è¿™ä¸ªç´¢å¼•å°±æ˜¯ä¸‰æ˜Ÿç´¢å¼•ã€‚å¦åˆ™è¿™ä¸ªç´¢å¼•åªèƒ½æ˜¯äºŒæ˜Ÿç´¢å¼•ï¼Œç‰ºç‰²ç¬¬äºŒé¢—æ˜Ÿã€‚æˆ–è€…é‡‡ç”¨å¦ä¸€ç§é€‰æ‹©ï¼Œé¿å…æŽ’åºï¼Œç‰ºç‰²ç¬¬ä¸€é¢—æ˜Ÿä¿ç•™ç¬¬äºŒé¢—æ˜Ÿã€‚è¿™ç§äºŒæ˜Ÿç´¢å¼•ä¸­çš„ä¸€ä¸ªå°†ä¼šæ˜¯ç›¸åº”æŸ¥è¯¢è¯­å¥çš„æœ€ä½³ç´¢å¼•ã€‚ ä¸ºæŸ¥è¯¢è¯­å¥åˆ›å»ºæœ€ä½³ç´¢å¼•çš„ç®—æ³•å€™é€‰ A å–å‡ºå¯¹äºŽä¼˜åŒ–å™¨æ¥è¯´ä¸è¿‡åˆ†å¤æ‚çš„ç­‰å€¼è°“è¯åˆ—ã€‚å°†è¿™äº›åˆ—ä½œä¸ºç´¢å¼•çš„å‰å¯¼åˆ—(ä»¥ä»»æ„é¡ºåºçš†å¯)ã€‚ å°†é€‰æ‹©æ€§æœ€å¥½çš„èŒƒå›´è°“è¯ä½œä¸ºç´¢å¼•çš„ä¸‹ä¸€ä¸ªåˆ—ï¼Œå¦‚æžœå­˜åœ¨çš„è¯ã€‚æœ€å¥½çš„é€‰æ‹©æ€§æ˜¯æŒ‡å¯¹äºŽæœ€å·®çš„è¾“å…¥å€¼æœ‰æœ€ä½Žçš„è¿‡æ»¤å› å­ã€‚åªè€ƒè™‘å¯¹äºŽä¼˜åŒ–å™¨æ¥è¯´ä¸è¿‡åˆ†å¤æ‚çš„èŒƒå›´è°“è¯ã€‚ ä»¥æ­£ç¡®çš„é¡ºåºæ·»åŠ ORDER BYè¯­åˆ—ï¼Œå¿½ç•¥åœ¨ç¬¬ä¸€æ­¥æˆ–è€…ç¬¬äºŒæ­¥å·²æ·»åŠ çš„åˆ—ã€‚ ä»¥ä»»æ„é¡ºåºå°† SELECT è¯­å¥ä¸­å…¶ä½™çš„åˆ—æ·»åŠ è‡³ç´¢å¼•ä¸­ï¼ˆä½†æ˜¯éœ€è¦ä»¥ä¸æ˜“å˜çš„åˆ—å¼€å§‹ï¼‰ã€‚ ä¸¾ä¾‹ï¼šCURSOR43 å€™é€‰ A ä¸º (CITY, LNAME, FNAME, NCNO)ã€‚ ç”±äºŽ FNAME åœ¨èŒƒå›´è°“è¯åˆ— LNAME çš„åŽé¢ï¼Œå€™é€‰ A å¼•èµ·äº† CURSOR43 çš„ä¸€æ¬¡æŽ’åºæ“ä½œã€‚ å€™é€‰ Bå¦‚æžœå€™é€‰ A å¼•èµ·äº†æ‰€ç»™æŸ¥è¯¢è¯­å¥çš„ä¸€æ¬¡æŽ’åºæ“ä½œï¼Œé‚£ä¹ˆè¿˜å¯ä»¥è®¾è®¡å€™é€‰ Bã€‚æ ¹æ®å®šä¹‰ï¼Œå¯¹äºŽå€™é€‰ B æ¥è¯´ç¬¬äºŒé¢—æ˜Ÿæ¯”ç¬¬ä¸€é¢—æ˜Ÿæ›´é‡è¦ã€‚ å–å‡ºå¯¹äºŽä¼˜åŒ–å™¨æ¥è¯´ä¸è¿‡åˆ†å¤æ‚çš„ç­‰å€¼è°“è¯åˆ—ã€‚å°†è¿™äº›åˆ—ä½œä¸ºç´¢å¼•çš„å‰å¯¼åˆ—(ä»¥ä»»æ„é¡ºåºçš†å¯)ã€‚ ä»¥æ­£ç¡®é¡ºåºæ·»åŠ  ORDER BY åˆ—ï¼ˆå¦‚æžœ ORDER BY åˆ—æœ‰ DESC çš„è¯ï¼ŒåŠ ä¸Š DESCï¼‰ã€‚å¿½ç•¥åœ¨ç¬¬1æ­¥ä¸­å·²ç»æ·»åŠ çš„åˆ—ã€‚ ä»¥ä»»æ„é¡ºåºå°† SELECT è¯­å¥ä¸­å…¶ä½™çš„åˆ—æ·»åŠ è‡³ç´¢å¼•ä¸­ï¼ˆä½†æ˜¯éœ€è¦ä»¥ä¸æ˜“å˜çš„åˆ—å¼€å§‹ï¼‰ã€‚ ä¸¾ä¾‹ï¼šCURSOR43 å€™é€‰ B ä¸º (CITY, FNAME, LNAME, CNO)ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€åšçš„åªæ˜¯è®¾è®¡ç†æƒ³ç´¢å¼•æˆ–æ˜¯æœ€ä½³ç´¢å¼•ã€‚ä½†æ˜¯è¿™æ˜¯å¦æ˜¯å®žé™…å¯è¡Œçš„ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªé˜¶æ®µè¿˜ä¸å¥½è¯´ã€‚ å‰çž»æ€§çš„ç´¢å¼•è®¾è®¡åŸºæœ¬æ¦‚å¿µè®¿é—®æ ¹æ®å®šä¹‰ï¼ŒDBMSè¯»å–ä¸€ä¸ªç´¢å¼•è¡Œæˆ–ä¸€ä¸ªè¡¨è¡Œçš„æˆæœ¬ç§°ä¸ºä¸€æ¬¡è®¿é—® : ç´¢å¼•è®¿é—®æˆ–è¡¨è®¿é—®ã€‚å¦‚æžœDBMSæ‰«æç´¢å¼•æˆ–è¡¨çš„ä¸€ä¸ªç‰‡æ®µ(è¢«è¯»å–çš„è¡Œåœ¨ç‰©ç†ä¸Šæ˜¯å½¼æ­¤ç›¸é‚»çš„)ï¼Œé‚£ä¹ˆç¬¬ä¸€è¡Œçš„è¯»å–å³ä¸ºä¸€æ¬¡éšæœºè®¿é—®ã€‚å¯¹äºŽåŽç»­è¡Œçš„è¯»å–ï¼Œæ¯è¡Œéƒ½æ˜¯ä¸€æ¬¡é¡ºåºè®¿é—®ã€‚åœ¨å½“å‰çš„ç¡¬ä»¶æ¡ä»¶ä¸‹ï¼Œé¡ºåºè®¿é—®çš„æˆæœ¬æ¯”éšæœºè®¿é—®çš„æˆæœ¬ä½Žå¾—å¤šã€‚ä¸€æ¬¡ç´¢å¼•è®¿é—®çš„æˆæœ¬ä¸Žä¸€æ¬¡è¡¨è®¿é—®çš„æˆæœ¬åŸºæœ¬ä¸Šæ˜¯ç›¸åŒçš„ã€‚ è¯»å–ä¸€ç»„è¿žç»­çš„ç´¢å¼•è¡Œç‰©ç†ä¸Šå½¼æ­¤ç›¸é‚»æ˜¯ä»€ä¹ˆæ„æ€? ç´¢å¼•ä¸Šçš„æ‰€æœ‰è¡Œéƒ½é€šè¿‡æŒ‡é’ˆé“¾æŽ¥åœ¨ä¸€èµ·ï¼Œé“¾æŽ¥çš„å…ˆåŽé¡ºåºç”±ç´¢å¼•çš„é”®å€¼ä¸¥æ ¼å®šä¹‰ã€‚å½“å‡ ä¸ªç´¢å¼•è¡Œçš„é”®å€¼ç›¸åŒæ—¶ï¼Œå°±æ ¹æ®ç´¢å¼•è¡Œå­˜å‚¨çš„æŒ‡é’ˆå€¼è¿›è¡Œé“¾æŽ¥ã€‚åœ¨ä¼ ç»Ÿçš„ç´¢å¼•è®¾è®¡(ä»ŽæŸä¸ªè§’åº¦çœ‹ï¼Œæ˜¯ç†æƒ³åŒ–çš„)ä¸­ï¼Œé“¾è¡¨ä»ŽLP1(å¶å­é¡µ1)å¼€å§‹ï¼ŒéšåŽé“¾æŽ¥LP2ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚è¿™æ ·(å‡è®¾æ¯ä¸ªç£é“å¯ä»¥æ”¾12ä¸ªå¶å­é¡µï¼Œå½“å‰çš„ç¡¬ä»¶é€šå¸¸å¯ä»¥å®¹çº³æ›´å¤š)ï¼Œå¶å­é¡µå°±ç»„æˆäº†ä¸€ä¸ªè¿žç»­çš„æ–‡ä»¶ï¼ŒLP1è‡³LP12å­˜å‚¨åœ¨ç£ç›˜æŸ±é¢çš„ç¬¬ä¸€ä¸ªç£é“ï¼ŒLP13è‡³LP24å­˜å‚¨åœ¨ä¸‹ä¸€ä¸ªç£é“ï¼Œå¦‚æ­¤ç»§ç»­ï¼Œå½“ç¬¬ä¸€ä¸ªæŸ±é¢å­˜æ»¡åŽï¼Œä¸‹ä¸€ç»„LPå°±ä¼šè¢«å­˜å‚¨åœ¨ä¸‹ä¸€ä¸ªæŸ±é¢çš„é¦–ä¸ªç£é“ä¸Šã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¶å­é¡µä¹‹é—´æ²¡æœ‰å…¶ä»–é¡µã€‚ çŽ°åœ¨ï¼Œè¯»å–ä¸€ä¸ªè¿žç»­çš„ç´¢å¼•è¡Œ(å³ä¸€ä¸ªç´¢å¼•ç‰‡ï¼Œæˆ–è€…åŒ…å«äº†å•ä¸ªé”®å€¼æˆ–è€…ä¸€ä¸ªèŒƒå›´çš„é”®å€¼æ‰€å¯¹åº”çš„ç´¢å¼•è¡Œ)å°±éžå¸¸å¿«äº†ã€‚ä¸€æ¬¡ç£ç›˜æ—‹è½¬ä¼šå°†å¤šä¸ªå¶å­é¡µè¯»å–è¿›å†…å­˜ä¸­ï¼Œè€Œä¸”åªæœ‰åœ¨ç£ç›˜æŒ‡é’ˆç§»åˆ°ä¸‹ä¸€ä¸ªæŸ±é¢æ—¶æ‰éœ€è¦è¿›è¡Œä¸€æ¬¡çŸ­æš‚çš„å¯»å€ã€ ä¸è¿‡ï¼Œè¿™ä¸ªå®Œç¾Žçš„é¡ºåºè¿˜æ˜¯ä¼šè¢«æ‰“ç ´çš„ï¼Œè‡³å°‘æœ‰ä»¥ä¸‹ä¸‰ä¸ªå½±å“å› ç´  : å¦‚æžœä¸€ä¸ªå¶å­é¡µæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜å‚¨æ–°æ’å…¥çš„ç´¢å¼•è¡Œï¼Œé‚£ä¹ˆå¶å­é¡µå°±å¿…é¡»è¢«åˆ†è£‚ã€‚ä¹‹åŽé“¾è¡¨ä»ä¼šæŒ‰ç…§æ­£ç¡®çš„é¡ºåºé“¾æŽ¥ç´¢å¼•è¡Œï¼Œä½†æ˜¯è¿™ä¸Žåº•å±‚çš„ç‰©ç†å­˜å‚¨é¡ºåºå°±ä¸å†ä¸€è‡´äº†ï¼Œä¸€äº›æŒ‰é“ç†åº”è¯¥æ˜¯é¡ºåºçš„è®¿é—®å°±å˜æˆéšæœºè®¿é—®äº†ã€‚ä¸è¿‡ç´¢å¼•çš„å……è¶³å¯ä»¥å†æ¬¡æ¢å¤æœ€ç†æƒ³çš„é¡ºåºã€‚ æ„å‘ä¸åˆ°çš„æ•°æ®å¢žé•¿å¯èƒ½ä¼šå¡«æ»¡åŽŸæœ¬è¿žç»­çš„ç©ºé—´(åŒºæˆ–ç±»ä¼¼çš„æ¦‚å¿µ)ã€‚æ“ä½œç³»ç»ŸäºŽæ˜¯å°±ä¼šå¯»æ‰¾å¦å¤–æœ‰ä¸€ä¸ªè¿žç»­çš„ç©ºé—´ï¼Œå¹¶å°†å®ƒè¿žæŽ¥åˆ°åŽŸæ¥ç©ºé—´çš„åŽé¢ã€‚è¿™æ—¶å€™ä»Žç¬¬ä¸€ä¸ªåŒºè·¨åˆ°ç¬¬äºŒä¸ªåŒºè®¿é—®å°±ä¼šäº§ç”Ÿä¸€æ¬¡éšæœºè®¿é—®ï¼Œä¸è¿‡è¿™ç§æƒ…å†µå½±å“ä¸å¤§ã€‚ RAID 5æ¡å¸¦ä¼šå°†å‰å‡ ä¸ªå¶å­é¡µå­˜å‚¨åœ¨ä¸€ä¸ªé©±åŠ¨å™¨ä¸Šï¼Œå°†åŽé¢çš„å¶å­é¡µå­˜æ”¾åœ¨å¦å¤–çš„é©±åŠ¨å™¨ä¸Šã€‚è¿™å°±ä¼šäº§ç”Ÿé¢å¤–çš„éšæœºè¯»ï¼Œä½†å®žé™…ä¸Šæ¡å¸¦çš„ç§¯æžä½œç”¨è¦å¤§è¿‡éšæœºè¯»å¸¦æ¥çš„æ€§èƒ½æ¶åŒ–ï¼Œä¸€ä¸ªæ™ºèƒ½çš„ç£ç›˜æœåŠ¡å™¨å¯ä»¥å°†åŽç»­çš„å¶å­é¡µå¹¶è¡Œçš„ä»Žå¤šä¸ªé©±åŠ¨å™¨ä¸Šè¯»å–è‡³ç£ç›˜ç¼“å­˜ä¸­ï¼Œä»Žè€Œå¤§å¤§é™ä½Žäº†å•ä¸ªå¶å­é¡µçš„I/Oæ—¶é—´ã€‚æ­¤å¤–ï¼Œåœ¨RAID 5æ¡å¸¦ç­–ç•¥ä¸‹ï¼Œä¸€ä¸ªè¢«é¢‘ç¹è®¿é—®çš„ç´¢å¼•çš„ä¸å¤ªå¯èƒ½å¯¼è‡´æŸä¸€ä¸ªç£ç›˜è´Ÿè½½è¿‡é«˜ï¼Œå› ä¸ºI/Oè¯·æ±‚ä¼šè¢«å‡åŒ€ä½Žåˆ†å¸ƒåˆ°RAID 5é˜µåˆ—å†…çš„å¤šä¸ªç£ç›˜é©±åŠ¨å™¨ã€‚ å¿½ç•¥ä¸Šè¿°æƒ…å†µï¼Œæˆ‘ä»¬ä»ç„¶å‡è®¾ï¼Œå¦‚æžœä¸¤ä¸ªç´¢å¼•è¡Œåœ¨é“¾è¡¨ä¸Šå½¼æ­¤ç›¸é‚»(æˆ–è€…åœ¨å”¯ä¸€ç´¢å¼•ä¸­ï¼Œç›¸åŒé”®å€¼çš„è¡ŒæŒ‡é’ˆæ„å‘³ç€å½¼æ­¤ç›¸é‚»)ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºè¿™ä¸¤è¡Œåœ¨ç‰©ç†ä¸Šä¹Ÿç›¸é‚»ã€‚è¿™å°±æ„å‘³ç€QUBEè®¤ä¸ºæ‰€æœ‰çš„ç´¢å¼•éƒ½æœ‰æœ€ç†æƒ³çš„é¡ºåºã€‚ è¯»å–ä¸€ç»„è¿žç»­çš„è¡¨è¡Œè¯»å–ä¸€ç»„è¿žç»­çš„è¡¨è¡Œæœ‰å¦‚ä¸‹ä¸¤ç§æƒ…å†µï¼š å…¨è¡¨æ‰«æä»ŽTP1(è¡¨é¡µ1)å¼€å§‹ï¼Œè¯»å–è¯¥é¡µä¸Šæ‰€æœ‰çš„è®°å½•ï¼Œç„¶åŽå†è®¿é—®TP2ï¼Œä¸€æ¬¡ç±»æŽ¨ã€‚æŒ‰ç…§è®°å½•åœ¨è¡¨é¡µä¸­å­˜å‚¨çš„é¡ºåºè¿›è¡Œè¯»å–ï¼Œæ²¡æœ‰å…¶ä»–ç‰¹æ®Šçš„é¡ºåºã€‚ èšç°‡ç´¢å¼•æ‰«æè¯»å–ç´¢å¼•ç‰‡ä¸Šç¬¬ä¸€ä¸ªç´¢å¼•è¡Œï¼Œç„¶åŽèŽ·å–ç›¸åº”çš„è¡¨è¡Œï¼Œå†è®¿é—®ç¬¬äºŒä¸ªç´¢å¼•è¡Œï¼Œä»¥æ­¤ç±»æŽ¨ã€‚å¦‚æžœç´¢å¼•è¡Œä¸Žå¯¹åº”çš„è¡¨è¡Œè®°å½•é¡ºåºå®Œå…¨ä¸€è‡´(èšç°‡çŽ‡ä¸º100%)ï¼Œé‚£ä¹ˆé™¤äº†ç¬¬ä¸€æ¬¡ä¹‹å¤–çš„æ‰€æœ‰è¡¨è®¿é—®å°±éƒ½æ˜¯é¡ºåºè®¿é—®ã€‚è¡¨è®°å½•çš„é“¾æŽ¥æ–¹å¼è·Ÿç´¢å¼•ä¸ä¸€æ ·ã€‚å•ä¸ªè¡¨é¡µä¸­è®°å½•çš„é¡ºåºæ— å…³ç´§è¦ï¼Œåªè¦è®¿é—®çš„ä¸‹ä¸€ä¸ªè¡¨è®°å½•åœ¨åŒä¸€ä¸ªè¡¨é¡µæˆ–è€…ç›¸é‚»çš„ä¸‹ä¸€ä¸ªè¡¨é¡µå†…å°±å¯ä»¥äº†ã€‚ åŒç´¢å¼•ä¸€æ ·ï¼Œå­˜å‚¨è¡¨çš„ä¼ ç»Ÿæ–¹å¼ä¹Ÿæ˜¯å°†æ‰€æœ‰è¡¨é¡µä¿ç•™åœ¨ä¸€ä¸ªè¿žç»­çš„ç©ºé—´å†…ã€‚å¼•èµ·é¡ºåºæ‚ä¹±æˆ–ç¢Žç‰‡åŒ–çš„å› ç´ ä¹Ÿå’Œç´¢å¼•ä¸­çš„ç›¸ä¼¼ï¼Œä½†åˆä¸¤ä¸ªåœ°æ–¹ä¸åŒï¼š å¦‚æžœå¾€è¡¨ä¸­æ’å…¥çš„è®°å½•åœ¨èšç°‡ç´¢å¼•æ‰€å®šä¹‰çš„ä¸»é¡µä¸­è£…ä¸ä¸‹ï¼Œåˆ™é€šå¸¸ä¸ä¼šç§»åŠ¨çŽ°æœ‰çš„è¡Œï¼Œè€Œæ˜¯ä¼šå°†æ–°æ’å…¥çš„è®°å½•å­˜å‚¨åˆ°ç¦»ä¸»é¡µå°½å¯èƒ½è¿‘çš„è¡¨é¡µä¸­ã€‚å¯¹ç¬¬äºŒä¸ªé¡µçš„éšæœºI/Oä¼šä½¿èšç°‡ç´¢å¼•æ‰«æå˜å¾—æ›´æ…¢ï¼Œä½†æ˜¯å¦‚æžœè¿™æ¡è®°å½•ç¦»ä¸»é¡µå¾ˆè¿‘ï¼Œè¿™äº›é¢å¤–çš„å¼€é”€å°±å¯ä»¥è¢«é¿å…ï¼Œå› ä¸ºé¡ºé¢„è¯»åŠŸèƒ½ä¼šä¸€æ¬¡æ€§å°†å¤šä¸ªè¡¨é¡µè£…è½½åˆ°æ•°æ®åº“ç¼“å­˜ä¸­ã€‚å³ä½¿é¡ºåºé¢„è¯»åŠŸèƒ½æ²¡æœ‰ä½¿ç”¨ï¼Œä¹Ÿåªæœ‰å½“è¯¥é¡µåœ¨æ•°æ®åº“ç¼“å­˜è¢«è¦†ç›–çš„æƒ…å†µä¸‹æ‰ä¼šå‘ç”Ÿé¢å¤–çš„éšæœºI/Oã€‚ ä¸€æ¡è®°å½•è¢«æ›´æ–°åŽï¼Œå¯èƒ½å› ä¸ºè¡¨è¡Œè¿‡é•¿å¯¼è‡´å…¶æ— æ³•å†å­˜å‚¨äºŽå½“å‰çš„è¡¨é¡µä¸­ã€‚è¿™æ˜¯DBMAå°±å¿…é¡»å°†è¯¥è¡Œè®°å½•è¿ç§»è‡³å¦å¤–ä¸€ä¸ªè¡¨é¡µä¸­ï¼ŒåŒæ—¶åœ¨åŽŸæœ‰çš„è¡¨é¡µä¸­å­˜å‚¨æŒ‡å‘æ–°è¡¨é¡µçš„æŒ‡é’ˆã€‚å½“è¯¥è¡Œè¢«è®¿é—®æ—¶ï¼Œä¼šå¼•å…¥é¢å¤–çš„éšæœºè®¿é—®ã€‚è¡¨å¯ä»¥é€šè¿‡é‡ç»„æ¥è¿˜åŽŸè¡Œè®°å½•çš„é¡ºåºï¼Œä»Žè€Œå‡å°‘ä¸å¿…è¦çš„éšæœºè®¿é—®ã€‚ è®¡ç®—è®¿é—®æ¬¡æ•°éšæœºè®¿é—®æˆ‘ä»¬é¦–å…ˆæ€è€ƒä¸€ä¸‹ç£ç›˜è¯»ä¸Žè®¿é—®çš„åŒºåˆ«ã€‚ä¸€æ¬¡ç£ç›˜è¯»æ‰€è®¿é—®çš„å¯¹è±¡æ˜¯ä¸€ä¸ªé¡µï¼Œè€Œä¸€æ¬¡è®¿é—®çš„è®¿é—®å¯¹è±¡åˆ™æ˜¯ä¸€è¡Œã€‚ä¸€æ¬¡éšæœºç£ç›˜è¯»ä¼šå°†ä¸€æ•´é¡µ(é€šå¸¸ä¼šåŒ…å«å¾ˆå¤šè¡Œ)è¯»å–è‡³æ•°æ®åº“çš„ç¼“å†²æ± ä¸­ï¼Œä½†æ˜¯æ ¹æ®å®šä¹‰ï¼Œå‰åŽä¸¤æ¬¡éšæœºè¯»ä¸å¤ªå¯èƒ½ä¼šè®¿é—®åˆ°åŒä¸€ä¸ªé¡µã€‚ ä½¿ç”¨æ»¡è¶³éœ€æ±‚çš„æˆæœ¬æœ€ä½Žçš„ç´¢å¼•è¿˜æ˜¯æ‰€èƒ½è¾¾åˆ°çš„æœ€æœ‰ç´¢å¼•å½“æœ‰å¤šä¸ªç­‰å€¼è°“è¯ä½œä¸ºåŒ¹é…åˆ—æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘è¿™äº›åˆ—åœ¨ç´¢å¼•ä¸Šçš„å…ˆåŽé¡ºåºã€‚ç»å¸¸å˜åŒ–çš„åˆ—åº”å½“å°½å¯èƒ½çš„æŽ’åœ¨åŽé¢ã€‚ æ›´æ”¹çŽ°æœ‰ç´¢å¼•åˆ—çš„é¡ºåºå’Œåœ¨çŽ°æœ‰ç´¢å¼•åˆ—ä¹‹é—´æ·»åŠ æ–°åˆ—åŒæ ·å±é™©ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼ŒçŽ°æœ‰çš„selectçš„æ‰§è¡Œé€Ÿåº¦éƒ½å¯èƒ½ä¼šæ€¥å‰§ä¸‹é™ï¼Œå› ä¸ºåŒ¹é…åˆ—å‡å°‘äº†ï¼Œæˆ–è€…å¼•å…¥äº†æŽ’åº(å¯¼è‡´è¿‡æ—©äº§ç”Ÿç»“æžœé›†) åŠå®½ç´¢å¼•(æœ€å¤§åŒ–ç´¢å¼•è¿‡æ»¤)åœ¨çŽ°æœ‰ç´¢å¼•çš„æœ«ç«¯æ·»åŠ ç¼ºå°‘çš„è°“è¯åˆ—å¯ä»¥æ¶ˆé™¤å¤§é‡çš„éšæœºè®¿é—®ï¼Œå› ä¸ºè¿™æ ·èƒ½å¼•å…¥ç´¢å¼•è¿‡æ»¤è¿‡ç¨‹ã€‚ å½±å“ç´¢å¼•è®¾è®¡è¿‡ç¨‹çš„å› ç´ I/Oæ—¶é—´ä¼°ç®—: éšæœºè¯»å– 10ms(é¡µçš„å¤§å°ä¸º4KBæˆ–8KB) é¡ºåºè¯»å– 40MB/s è¿™äº›æ•°æ®æ˜¯å‡å®šç³»ç»Ÿä½¿ç”¨å½“å‰ç¡¬ä»¶å¹¶åœ¨ä¸€ä¸ªåˆç†çš„è´Ÿè½½ä¸‹è¿è¡Œæ—¶çš„å€¼ã€‚ä¸€äº›ç³»ç»Ÿå¯èƒ½è¿è¡Œçš„æ›´æ…¢æˆ–å¤„ç†è¶…è´Ÿè·çŠ¶æ€ã€‚ å›°éš¾è°“è¯å¤§ä½“ä¸Šï¼Œå‡è®¾ä¸€ä¸ªè°“è¯çš„åˆ¤å®šç»“æžœä¸ºfalseï¼Œè€Œè¿™æ—¶å¦‚æžœä¸æ£€æŸ¥å…¶ä»–è°“è¯å°±ä¸èƒ½ç¡®å®šåœ°å°†ä¸€è¡Œè®°å½•æŽ’é™¤åœ¨å¤–ï¼Œé‚£ä¹ˆè¿™ç±»è°“è¯å¯¹ä¼˜åŒ–å™¨è€Œè¨€å°±æ˜¯å¤ªè¿‡å›°éš¾çš„ã€‚ è¿‡æ»¤å› å­éšæ‚£å½“ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶ï¼Œè¿™ç§è¿‡æ»¤å› å­éšæ‚£å¯èƒ½ä¼šäº§ç”Ÿ : è®¿é—®è·¯å¾„ä¸­æ²¡æœ‰æŽ’åº ç¬¬ä¸€å±ç»“æžœä¸€å»ºç«‹å°±å›žåº” ä¸æ˜¯æ‰€æœ‰çš„è°“è¯å­—æ®µéƒ½å‚ä¸Žå®šä¹‰å¸¦æ‰«æçš„ç´¢å¼•ç‰‡â€“æ¢å¥è¯è¯´å°±æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯åŒ¹é…å­—æ®µã€‚ è¢«åŠ¨å¼ç´¢å¼•è®¾è®¡ è¢«åŠ¨å¼çš„æ–¹æ³•ä¸ŽèŽ±ç‰¹å…„å¼Ÿåˆ›é€ å®ˆæž¶é£žæœºçš„ç»åŽ†éžå¸¸ç›¸ä¼¼ã€‚æœ¬è´¨ä¸Šå°±æ˜¯æŠŠæŸ¥è¯¢æ”¾åœ¨ä¸€èµ·ï¼ŒæŽ¨ä¸‹æ‚¬å´–ï¼Œç„¶åŽçœ‹ä»–èƒ½å¦èµ·é£žã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ä¸ºåº”ç”¨è®¾è®¡ä¸€ä¸ªæ²¡æœ‰ç´¢å¼•çš„åŽŸåž‹ï¼Œç„¶åŽå¼€å§‹è¿è¡Œä¸€äº›æŸ¥è¯¢ã€‚åˆæˆ–è€…ï¼Œåˆ›å»ºåŽŸå§‹ç´¢å¼•é›†ï¼Œç„¶åŽé€šè¿‡è¿è¡Œåº”ç”¨æ¥çœ‹é‚£äº›ç´¢å¼•è¢«ç”¨åˆ°ï¼Œé‚£äº›æ²¡æœ‰è¢«ç”¨åˆ°ã€‚å³ä½¿æ˜¯ä¸€ä¸ªå°åž‹çš„æ•°æ®åº“ç³»ç»Ÿï¼Œè¿è¡Œé€Ÿåº¦æ…¢çš„æŸ¥è¯¢ä¹Ÿä¼šè¢«å¾ˆå¿«å‡¸æ˜¾å‡ºæ¥ã€‚ è¢«åŠ¨å¼è°ƒä¼˜çš„æ–¹æ³•ä¹Ÿè¢«ç”¨æ¥ç†è§£å’Œè°ƒä¼˜ä¸€ä¸ªæ€§èƒ½æ²¡æœ‰æ»¡è¶³é¢„æœŸçš„å·²æœ‰åº”ç”¨ã€‚ å¯¹ç»“æžœé›†æŽ’åºé™¤äº†å…¨è¡¨æ‰«æå’Œå…¨ç´¢å¼•æ‰«æï¼Œç»“æžœé›†çš„æŽ’åºå°±æ˜¯æœ€æœ‰ç”¨çš„è­¦ç¤ºä¿¡å·äº†ã€‚å¼•èµ·æŽ’åºçš„åŽŸå› å¯èƒ½æœ‰ä»¥ä¸‹ä¸¤ç§: æ²¡æœ‰å¯ä½¿æŸ¥è¯¢è¯­å¥é¿å…æŽ’åºçš„ç´¢å¼•ã€‚ ä¼˜åŒ–å™¨æ‰€é€‰æ‹©çš„è®¿é—®è·¯å¾„åŒ…å«äº†ä¸€æ¬¡å¤šä½™çš„æŽ’åºã€‚ æœ‰å¾ˆå¤šæ•°æ®åº“é¡¾é—®å°†æŽ’åºè§†ä¸ºæ•Œäººã€‚æˆ‘ä»¬è®¤ä¸ºï¼Œå“ªäº›å¼ºè°ƒéšæœºI/Oå¸¦æ¥è‡´å‘½å½±å“çš„é¡¾é—®æ›´å€¼å¾—ä¿¡ä»»ã€‚ æˆæœ¬ä¼°ç®—ä¸€äº›æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„EXPLAINåŠŸèƒ½æ˜¾ç¤ºäº†ä¼˜åŒ–å™¨å¯¹æ‰€é€‰è®¿é—®è·¯å¾„çš„æœ¬åœ°å“åº”æ—¶é—´çš„ä¼°ç®—ï¼Œæˆ–è‡³å°‘æ˜¾ç¤ºäº†å¯¹CPUæ—¶é—´çš„ä¼°ç®—ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œä»¥ä¸‹ä¸¤ä¸ªä¸¥é‡é—®é¢˜é™åˆ¶äº†ä½¿ç”¨æˆæœ¬ä¼°ç®—æ–¹æ³•çš„ä»·å€¼: ä¼˜åŒ–å™¨æ‰€åšå‡ºçš„çš„æœ¬åœ°å“åº”æ—¶é—´ä¼°ç®—å¯èƒ½ä¸Žå®žé™…ç›¸å·®å¾ˆå¤§ å½“è°“è¯ä½¿ç”¨ç»‘å®šå˜é‡æ—¶(æ˜¾ç„¶è¿™æ˜¯å¾ˆæ™®éçš„)ï¼Œä¼˜åŒ–å™¨å¯¹è¿‡æ»¤å› å­çš„ä¼°ç®—æ˜¯åŸºäºŽå¹³å‡è¾“å…¥å€¼çš„ï¼Œæˆ–æ›´å·®æƒ…å†µä¸‹ï¼ŒåŸºäºŽé»˜è®¤å€¼ã€‚ä¸ºäº†èŽ·å–æ›´æœ‰ä»·å€¼çš„æœ€å·®æƒ…å†µä¼°å€¼ï¼ŒEXPLAINä¸­çš„ç»‘å®šå˜é‡å¿…é¡»ç”¨æœ€å·®æƒ…å†µä¸‹çš„è¾“å…¥å€¼æ¥ä»£æ›¿ã€‚è¿™æ˜¯ä¸€ä¸ªéœ€è¦åº”ç”¨çŸ¥è¯†çš„ç´¯äººæ“ä½œã€‚ ä¸ºè¡¨è¿žæŽ¥è®¾è®¡ç´¢å¼•é¢„æµ‹è¡¨çš„è®¿é—®é¡ºåºåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç»éªŒæ³•åˆ™æ¥é¢„æµ‹æœ€ä½³çš„è¡¨è®¿é—®é¡ºåº : å°†åŒ…å«æœ€ä½Žæ•°é‡æœ¬åœ°è¡Œçš„è¡¨ä½œä¸ºå¤–å±‚è¡¨ã€‚ æœ¬åœ°è¡Œçš„æ•°é‡æ˜¯æŒ‡æœ€å¤§è¿‡æ»¤å› å­è¿‡æ»¤æœ¬åœ°è°“è¯ä¹‹åŽæ‰€å‰©ä½™çš„è¡Œæ•°ã€‚ ç»éªŒæ³•åˆ™å¿½ç•¥äº†ä»¥ä¸‹å› ç´ : æŽ’åºã€‚ å¾ˆå°çš„è¡¨ã€‚éžå¸¸å°çš„è¡¨åŠå…¶ç´¢å¼•å¯èƒ½é•¿æœŸå­˜åœ¨äºŽæ•°æ®åº“çš„ç¼“å†²æ± ä¸­ï¼Œè‡³å°‘åœ¨ä¸€ä¸ªè¿žæŽ¥æŸ¥è¯¢ä¸­ï¼Œæ²¡æœ‰é¡µä¼šè¢«è¯»å–å¤šæ¬¡ã€‚åœ¨è¿™æ ·çš„è¡¨å’Œç´¢å¼•ä¸Šè¿›è¡Œéšæœºè¯»å–æ‰€è€—è´¹çš„æ—¶é—´å°äºŽ0.1msï¼Œè‡³å°‘åœ¨é¡µè¢«ç¬¬ä¸€æ¬¡è¯»å–ä¹‹åŽæ˜¯è¿™æ ·çš„ã€‚æ‰€ä»¥ï¼Œå½“è¿™æ ·çš„è¡¨ä¸æ˜¯å¤–å±‚è¡¨æ—¶ï¼Œå¯¹å…¶å¤§é‡çš„éšæœºè¯»å–ä¹Ÿä¸ä¼šç§°ä¸ºé—®é¢˜ã€‚ èšç°‡æ¯”ä¾‹ã€‚ç´¢å¼•ä¸­è¡Œçš„é¡ºåºå’Œè¡¨ä¸­è¡Œçš„é¡ºåºçš„å…³è”æ€§(å¯¹äºŽèšç°‡ç´¢å¼•è€Œè¨€ï¼Œè¯¥å…³è”æ€§åœ¨è¡¨é‡ç»„åŽä¸º100%)ï¼Œå¯èƒ½ä¼šå½±å“å¯¹æœ€ä½³è®¿é—®é¡ºåºçš„é€‰æ‹©ï¼Œå½“ç„¶ï¼Œé™¤éžç´¢å¼•æ˜¯å®½ç´¢å¼•ã€‚ æœ€å¥½çš„åŸºäºŽæˆæœ¬çš„ä¼˜åŒ–å™¨åœ¨è¿›è¡Œè·¯å¾„é€‰æ‹©æ—¶ä¼šæŠŠè¿™äº›å› ç´ è€ƒè™‘è¿›æ¥ã€‚å› æ­¤ï¼Œä»–æ‰¾å‡ºçš„è®¿é—®é¡ºåºå¯èƒ½æ¯”æˆ‘ä»¬åŸºäºŽæœ¬åœ°è¡Œçš„æ•°é‡çš„ç»éªŒæ‰€å¾—å‡ºçš„ç»“æžœæ›´ä¼˜ã€‚ åˆå¹¶æ‰«æè¿žæŽ¥å’Œå“ˆå¸Œè¿žæŽ¥åˆå¹¶æ‰«æè¿žæŽ¥æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ æ‰§è¡Œè¡¨æˆ–ç´¢å¼•æ‰«æä»¥æ‰¾å‡ºæ»¡è¶³æœ¬åœ°è°“è¯çš„æ‰€æœ‰è¡Œã€‚ éšåŽå¯èƒ½ä¼šè¿›è¡ŒæŽ’åºï¼Œå¦‚æžœè¿™äº›æ‰«ææœªæŒ‰æ‰€è¦æ±‚çš„é¡ºåºæä¾›ç»“æžœé›†ã€‚ å¯¹å‰ä¸¤è€…ç”Ÿæˆçš„ä¸´æ—¶è¡¨è¿›è¡Œåˆå¹¶ã€‚ åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œåˆå¹¶æ‰«æä¼šæ¯”åµŒå¥—å¾ªçŽ¯å¿«ã€‚ ç”¨äºŽè¿žæŽ¥çš„å­—æ®µä¸Šæ²¡æœ‰å¯ç”¨çš„ç´¢å¼•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‹¥ä½¿ç”¨åµŒå¥—å¾ªçŽ¯ï¼Œé‚£ä¹ˆå†…å±‚è¡¨å¯èƒ½éœ€è¦è¢«æ‰«æå¾ˆå¤šæ¬¡ã€‚åœ¨å®žé™…æƒ…å†µä¸­ï¼Œç”¨äºŽè¿žæŽ¥çš„åˆ—ä¸Šé¢æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µå¾ˆå°‘è§ï¼Œå› ä¸ºå¤§éƒ¨åˆ†è¿žæŽ¥è°“è¯éƒ½æ˜¯åŸºäºŽâ€œä¸»é”®ç­‰äºŽå¤–é”®â€è¿™ä¸€æ¡ä»¶çš„ã€‚ ç»“æžœè¡¨å¾ˆå¤§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‹¥ä½¿ç”¨åµŒå¥—å¾ªçŽ¯è¿žæŽ¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç›¸åŒçš„é¡µè¢«ä¸æ–­çš„é‡å¤è®¿é—®ã€‚ è¿žæŽ¥æŸ¥è¯¢ä¸­ä¸æ­¢ä¸€å¼ è¡¨çš„è¿‡æ»¤å› å­å¾ˆä½Žã€‚å¦‚æˆ‘ä»¬æ‰€è§ï¼ŒåµŒå¥—å¾ªçŽ¯å¯èƒ½å¯¼è‡´å¯¹å†…å±‚è¡¨(æˆ–è€…å†…å±‚è¡¨ç´¢å¼•)çš„å¤§é‡éšæœºè®¿é—®ã€‚ ä¾‹å¦‚ï¼š 12345678DECLARE CURSOR81 CURSOR FORSELECT CNAME, CTYPE, INO, IEURFROM CUST, INVOICEWHERE CUST.CTYPE = :CTYPE AND IDATE &gt; :IDATE AND CUST.CNO = INVOICE.CNO å“ˆå¸Œè¿žæŽ¥å“ˆå¸Œè¿žæŽ¥æœ¬è´¨ä¸Šæ˜¯ç”¨å“ˆå¸Œç®—æ³•ä»£æ›¿æŽ’åºç®—æ³•çš„åˆå¹¶æ‰«æè¿žæŽ¥ã€‚é¦–å…ˆï¼Œå¯¹è¾ƒå°çš„ç»“æžœé›†ç”¨å“ˆå¸Œç®—æ³•è®¡ç®—å…¶è¿žæŽ¥å­—æ®µï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨ä¸€ä¸ªä¸´æ—¶è¡¨ä¸­ï¼›ç„¶åŽï¼Œå†æ‰«æå…¶ä»–çš„è¡¨(æˆ–ç´¢å¼•ç‰‡)ï¼Œå¹¶é€šè¿‡(è®¡ç®—å¾—åˆ°çš„)å“ˆå¸Œå€¼å°†æ»¡è¶³æœ¬åœ°è°“è¯æ¡ä»¶çš„æ¯ä¸€è¡Œè®°å½•ä¸Žä¸´æ—¶è¡¨ä¸­ç›¸åº”çš„è¡Œè¿›è¡ŒåŒ¹é…ã€‚ è‹¥ç»“æžœè¡Œé›†å·²åœ¨ç´¢å¼•ä¸­æ»¡è¶³äº†æ‰€è¦æ±‚çš„é¡ºåºï¼Œé‚£ä¹ˆåˆå¹¶æ‰«æçš„é€Ÿåº¦å°†æ›´å¿«ã€‚è‹¥åˆå¹¶æ‰«æéœ€è¦è¿›è¡ŒæŽ’åºï¼Œé‚£ä¹ˆå“ˆå¸Œè¿žæŽ¥çš„é€Ÿåº¦å¯èƒ½æ›´å¿«ï¼Œå°¤å…¶æ˜¯å½“å…¶ä¸­ä¸€ä¸ªè¡Œé›†èƒ½å¤Ÿå…¨éƒ¨ç•™åœ¨å†…å­˜ä¸­æ—¶(å¯¹ä¸€ä¸ªå“ˆå¸Œè¡¨è¿›è¡Œä¸€æ¬¡éšæœºè®¿é—®æ‰€èŠ±è´¹çš„CPUæ—¶é—´ï¼Œé€šå¸¸ä¼šæ¯”æŽ’åºå’Œåˆå¹¶ä¸€è¡Œæ‰€èŠ±è´¹çš„æ—¶é—´å°‘)ã€‚å¦‚æžœä¸¤ä¸ªè¡Œé›†å¾ˆå¤§ï¼Œé‚£ä¹ˆå“ˆå¸Œè¡¨ä¼šæ ¹æ®å¯ç”¨å†…å­˜çš„å¤§å°å¯¹å“ˆå¸Œè¡¨è¿›è¡Œåˆ†åŒº(åŒä¸€æ—¶é—´å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªåˆ†åŒº)ï¼Œè€Œå¦å¤–ä¸€ä¸ªè¡Œé›†ä¼šè¢«æ‰«æå¤šæ¬¡ã€‚ ä¸ºä»€ä¹ˆè¿žæŽ¥çš„æ€§èƒ½è¡¨çŽ°è¾ƒå·®æ¨¡ç³Šçš„ç´¢å¼•è®¾è®¡â€œåœ¨è¿žæŽ¥å­—æ®µä¸Šå»ºç´¢å¼•â€æ˜¯æœ€å¤è€çš„ç´¢å¼•å»ºè®®ä¹‹ä¸€ã€‚äº‹å®žä¸Šï¼Œè¿™æ˜¯åŸºäºŽå»ºè®®çš„ä¸€ä¸ªæ‰©å±• : â€œä¸ºä¸»é”®åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œå¹¶ä¸”ä¸ºæ¯ä¸€ä¸ªå¤–é”®åˆ›å»ºä¸€ä¸ªç”±æ­¤å¤–é”®ä½œä¸ºå‰å¯¼åˆ—çš„ç´¢å¼•â€ã€‚åœ¨è¿žæŽ¥è°“è¯ä¸Šå»ºç´¢å¼•ä½¿å¾—åµŒå¥—å¾ªçŽ¯ç§°ä¸ºä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆï¼Œä½†åŒ…å«è¿žæŽ¥è°“è¯åˆ—å¹¶ä¸ä¸€å®šèƒ½å¤Ÿæä¾›å®Œå…¨å¯æŽ¥å—çš„å“åº”æ—¶é—´ã€‚è¿žæŽ¥è°“è¯åˆ—ä¸Šçš„ç´¢å¼•å’Œæœ¬åœ°è°“è¯ä¸Šçš„ç´¢å¼•é€šå¸¸éƒ½éœ€è¦æ˜¯å®½ç´¢å¼•ã€‚è€Œä¸”ï¼Œä¸åŒçš„è¡¨è®¿é—®é¡ºåºå¯èƒ½å¯¼è‡´å®Œå…¨ä¸åŒçš„ç´¢å¼•éœ€æ±‚ã€‚ ä¸ºå­æŸ¥è¯¢è®¾è®¡ç´¢å¼•ä»Žæ€§èƒ½çš„è§’åº¦çœ‹ï¼Œå­æŸ¥è¯¢ä¸Žè¿žæŽ¥ååˆ†ç›¸ä¼¼ã€‚å®žé™…ä¸Šï¼ŒçŽ°ä»Šçš„ä¼˜åŒ–å™¨é€šå¸¸ä¼šåœ¨è¿›è¡Œè®¿é—®è·¯å¾„çš„é€‰æ‹©ä¹‹å‰ï¼Œå…ˆå°†å­æŸ¥è¯¢é‡å†™ä¸ºä¸€ä¸ªè¿žæŽ¥ã€‚è‹¥ä¼˜åŒ–å™¨æ²¡æœ‰è¿›è¡Œé‡å†™ï¼Œé‚£ä¹ˆå­æŸ¥è¯¢çš„ç±»åž‹æœ¬èº«å¯èƒ½å°±å†³å®šäº†è¡¨è®¿é—®é¡ºåºã€‚å†…å¤–å±‚æ— å…³è”çš„å­æŸ¥è¯¢é€šå¸¸ä¼šä»Žæœ€å†…å±‚çš„SELECTå¼€å§‹æ‰§è¡Œã€‚ç»“æžœé›†è¢«ä¿å­˜åœ¨ä¸€å¼ ä¸´æ—¶è¡¨ä¸­ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªSELECTçš„è®¿é—®ã€‚å†…å¤–å±‚æœ‰å…³è”çš„å­æŸ¥è¯¢é€šå¸¸ä¼šä»Žæœ€å†…å±‚çš„SELECTå¼€å§‹æ‰§è¡Œã€‚æ— è®ºæ˜¯ä½•ç§æƒ…å†µï¼ŒåŒè¿žæŽ¥ä¸€æ ·ï¼Œåº”å½“åŸºäºŽèƒ½å¤Ÿå½¢æˆæœ€å¿«è®¿é—®è·¯å¾„çš„è¡¨è®¿é—®é¡ºåºè¿›è¡Œç´¢å¼•è®¾è®¡ã€‚è‹¥æœ€ä½³çš„è¡¨è®¿é—®é¡ºåºæœªè¢«é€‰ä¸­ï¼Œé‚£ä¹ˆç¨‹åºå¼€å‘äººå‘˜å¯èƒ½éœ€è¦å¯¹è¯­å¥è¿›è¡Œé‡å†™ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹è¿˜å¯èƒ½è¦ä½¿ç”¨è¿žæŽ¥ã€‚ ä¸ºUNIONè¯­å¥è®¾è®¡ç´¢å¼•é€šè¿‡UNIONæˆ–UNION ALLè¿žæŽ¥çš„SELECTè¯­å¥æ˜¯é€ä¸ªåˆ†åˆ«è¿›è¡Œä¼˜åŒ–å’ŒæŒ‡å‘çš„ã€‚å› æ­¤ï¼Œåº”è¯¥ä¸ºæ¯ä¸ªç‹¬ç«‹çš„SELECTè®¾è®¡åˆé€‚çš„ç´¢å¼•ã€‚éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¸¦ORDER BYçš„UNIONå¯èƒ½ä¼šå¯¼è‡´æå‰ç‰©åŒ–ã€‚ å¯¹äºŽè¡¨è®¾è®¡çš„æ€è€ƒå†—ä½™æ•°æ®æœ‰ä¸¤ç§é€šè¿‡å†—ä½™æ•°æ®ä¼˜åŒ–è¿žæŽ¥é€Ÿåº¦çš„æ–¹æ³•ï¼š å°†æŸåˆ—æ‹·è´è‡³ä¾èµ–è¡¨(å‘ä¸‹åèŒƒå¼æ³•)ã€‚ å°†æ±‡æ€»æ•°æ®æ·»åŠ è‡³çˆ¶è¡¨(å‘ä¸ŠåèŒƒå¼æ³•)ã€‚ å‘ä¸‹åèŒƒå¼åŒ–ä¸è¿‡ï¼Œæ€»ä½“è€Œè¨€ï¼Œå½“æˆ‘ä»¬è€ƒè™‘å¼•å…¥å‘ä¸‹åèŒƒå¼åŒ–æ—¶ï¼Œéœ€è¦é¢„æµ‹ä¸€ä¸‹å†—ä½™å­—æ®µæ›´æ–°æ—¶å¯èƒ½ä¼šå¯¼è‡´æœ€å·®æƒ…å†µä¸‹çš„ç´¢å¼•éšæœºè®¿é—®æ¬¡æ•°ã€‚ åèŒƒå¼åŒ–çš„æˆæœ¬è€ƒè™‘æ€§èƒ½æ—¶æœ€ä»¤äººå…³æ³¨çš„é€šå¸¸æ˜¯ï¼Œä¸ºäº†æ›´æ–°è¡¨åŠç´¢å¼•ä¸Šçš„å†—ä½™å­—æ®µé”å¸¦æ¥çš„I/Oæ—¶é—´ã€‚åœ¨å‘ä¸‹åèŒƒå¼åŒ–ä¸­ï¼Œè¿™å¯èƒ½éœ€è¦ç§»åŠ¨å¤§é‡çš„ç´¢å¼•è¡Œï¼Œä»Žè€Œå¯¼è‡´ä¸€ä¸ªç®€å•çš„UPDATEè¿è¡Œçš„å¾ˆæ…¢ã€‚å‘ä¸ŠåèŒƒå¼åŒ–ä¸å¤ªå¯èƒ½å› ä¸ºä¸€æ¬¡ç®€å•çš„æ›´æ–°æ“ä½œè€Œå¼•å‘I/Oå‰§å¢žã€‚ä¸è¿‡INSERTï¼ŒUPDATEå’ŒDELETEå¯èƒ½å¯¼è‡´çˆ¶è¡¨åŠå…¶ç´¢å¼•ä¸Šçš„ä¸€äº›é¢å¤–I/Oã€‚åœ¨æžç«¯æƒ…å†µä¸‹ï¼Œå¦‚æ¯ç§’10æ¬¡ä»¥ä¸Šçš„INSERTæˆ–UPDATEï¼Œç”±è¿™äº›I/Oå¸¦æ¥çš„ç£ç›˜è´Ÿè½½å¯èƒ½ä¼šæˆä¸ºé—®é¢˜ã€‚ åµŒå¥—å¾ªçŽ¯è¿žæŽ¥å’Œåˆå¹¶æ‰«æè¿žæŽ¥/å“ˆå¸Œè¿žæŽ¥ VS åèŒƒå¼åŒ–è®¸å¤šæ•°æ®åº“ä¸“å®¶ä¸æ„¿æ„å°†å†—ä½™åˆ—æ·»åŠ è‡³äº‹åŠ¡åž‹è¡¨ä¸Šï¼Œè¿™æ˜¯å¯ä»¥ç†è§£çš„ã€‚åèŒƒå¼åŒ–ä¸ä»…ä»…æ˜¯æŸ¥è¯¢é€Ÿåº¦å’Œæ›´æ–°é€Ÿåº¦ä¹‹é—´çš„ä¸€ä¸ªæƒè¡¡ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œä»–è¿˜æ˜¯æ€§èƒ½å’Œæ•°æ®å®Œæ•´æ€§ä¹‹é—´çš„ä¸€ä¸ªæƒè¡¡ï¼Œå³ä½¿åœ¨ä½¿ç”¨è§¦å‘å™¨æ¥ç»´æŠ¤å†—ä½™æ•°æ®çš„æƒ…å†µä¸‹ã€‚ç„¶è€Œï¼Œå½“åµŒå¥—å¾ªçŽ¯å¼•å…¥äº†è¿‡å¤šçš„éšæœºè®¿é—®ï¼Œä¸”MS/HJè€—è´¹äº†è¿‡å¤šçš„CPUæ—¶é—´æ—¶ï¼ŒåèŒƒå¼åŒ–å¯èƒ½æˆä¸ºå”¯ä¸€çš„é€‰æ‹©ã€‚å°½ç®¡å¦‚æ­¤ï¼Œåœ¨å†³å®šé‡‡ç”¨è¿™ä¸€æžç«¯çš„æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿æ‰€æœ‰èƒ½å¤Ÿé¿å…è¿™ä¸€æ–¹æ¡ˆçš„æ–¹æ³•éƒ½å·²ç»è€ƒè™‘è¿‡äº†ã€‚ æ— æ„è¯†çš„è¡¨è®¾è®¡ä»Žæ€§èƒ½çš„è§’åº¦çœ‹ï¼Œæˆ‘ä»¬éžå¸¸éš¾ä»¥ç†è§£ä¸ºä½•æœ‰é‚£ä¹ˆå¤šçš„æ•°æ®åº“ä¸­å­˜åœ¨å…·æœ‰1 : 1æˆ–1: C(C = æœ‰æ¡ä»¶çš„;å³0æˆ–1)å…³ç³»çš„è¡¨ã€‚ ä¸ºä½•è¦å»ºå››å¼ è¡¨è€Œéžåªå»ºä¸€å¼ CUSTè¡¨ï¼Ÿåªè¦å…³ç³»æ°¸è¿œä¸ä¼šå˜æˆ1 : Mï¼Œé‚£ä¹ˆçµæ´»æ€§å°±ä¸ä¼šæˆä¸ºé—®é¢˜ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®¢æˆ·è¦ä¹ˆæ˜¯å…¬å¸ï¼Œè¦ä¹ˆæ˜¯ä¸ªäººï¼Œä¸”ä¸ä¼šæœ‰å®¢æˆ·æ­»äº¡ä¸¤æ¬¡! å°†è¿™å››å¼ è¡¨åˆæˆä¸€å¼ éƒ¨åˆ†å­—æ®µä¸ºç©ºçš„è¡¨(å¯¹äºŽæ¯ä¸€è¡Œï¼Œè¦ä¹ˆå…¬å¸ç›¸å…³çš„å­—æ®µä¸ºç©ºï¼Œè¦ä¹ˆä¸ªäººç›¸å…³çš„å­—æ®µä¸ºç©ºï¼›åŒæ ·ï¼Œæ‰€æœ‰æ´»ç€çš„å®¢æˆ·çš„æ­»äº¡ç›¸å…³çš„å­—æ®µä¸ºç©º)ï¼Œè¿™æ˜¯å­˜å‚¨ç©ºé—´å’Œæ€§èƒ½(éšæœºè®¿é—®çš„æ¬¡æ•°)ä¹‹é—´çš„æƒè¡¡ã€‚ä¸ºç©ºçš„æ•°æ®å¹¶ä¸è¿åèŒƒå¼ã€‚ åœ¨ä¸è€ƒè™‘ç¡¬ä»¶æ€§èƒ½çš„æƒ…å†µä¸‹è®¾è®¡è¡¨å¯èƒ½ä¼šæœ‰å¦‚ä¸‹é—®é¢˜ : å³ä¾¿æ˜¯åœ¨æœ€ä½³ç´¢å¼•æ¡ä»¶ä¸‹ï¼Œéšæœºè®¿é—®çš„æ¬¡æ•°ä»å¯èƒ½ä¼šå¾ˆé«˜ã€‚ å¤æ‚è¿žæŽ¥å¯èƒ½ä½¿å¾—ç´¢å¼•è®¾è®¡å˜å¾—éžå¸¸å›°éš¾ã€‚ ä¼˜åŒ–å™¨å¯èƒ½å¯¹å¤æ‚è¿žæŽ¥åšå‡ºé”™è¯¯çš„è®¿é—®è·¯å¾„é€‰æ‹©ã€‚ æ˜Ÿåž‹è¿žæŽ¥ä»‹ç»æ˜Ÿåž‹è¿žæŽ¥ä¸Žæ™®é€šè¿žæŽ¥çš„å·®åˆ«ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹é¢ï¼š å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä½äºŽæ˜Ÿåž‹ç»“æž„ä¸­å¿ƒä½ç½®çš„è¡¨ç§°ä¸ºäº‹å®žè¡¨ï¼Œå®ƒçš„æ•°æ®é‡è¿œå¤§äºŽå®ƒå‘¨å›´çš„è¡¨â€”ç»´åº¦è¡¨ã€‚ æœ€ä½³çš„è®¿é—®è·¯å¾„é€šå¸¸æ˜¯åŒ…å«ç»´åº¦è¡¨çš„ç¬›å¡å°”ç§¯ï¼Œè¿™æ„å‘³ç€ä»–ä»¬æ²¡æœ‰ç›¸åŒçš„å†—ä½™åˆ—ï¼Œæ»¡è¶³æœ¬åœ°è°“è¯çš„ç»´åº¦è¡¨æ•°æ®è¡Œéƒ½ä¼šå‚ä¸Žè¿žæŽ¥ã€‚ SALES é”€å”®è®°å½•STORE å‡ºå”®çš„åº—é“ºITEM å‡ºå”®çš„å•†å“DATE å‡ºå”®çš„æ—¶é—´CUST å‡ºå”®çš„å®¢æˆ· åœ¨æ˜Ÿåž‹è¿žæŽ¥ä¸­ï¼Œäº‹å®žè¡¨çš„æ•°æ®é‡é€šè¿‡éƒ½æ¯”è¾ƒå¤§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‡³å°‘ä¾æ®ç»éªŒæ³•åˆ™ï¼Œäº‹å®žè¡¨åº”è¯¥ä½œä¸ºåµŒå¥—å¾ªçŽ¯è¿žæŽ¥æ–¹å¼ä¸­æœ€å†…å±‚çš„è¡¨ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æœªè¯»è¡¨éƒ½æ²¡æœ‰å…±åŒçš„åˆ—ï¼Œæ‰€ä»¥è¿™ç§é“¾æŽ¥é¡ºåºæ„å‘³ç€æ˜¯ç¬›å¡å°”è¿žæŽ¥ã€‚ äº‹å®žè¡¨çš„ç´¢å¼•äº‹å®žä¸Šï¼Œå®½ç´¢å¼•é€šå¸¸æ¯”äº‹å®žè¡¨è¿˜å¤§ï¼ŒåŽŸå› æœ‰ä¸¤ä¸ª : è¡¨é€šå¸¸éƒ½è¿›è¡Œäº†åŽ‹ç¼©å¤„ç†ï¼Œè€Œç´¢å¼•æ²¡æœ‰ã€‚ æ–°å¢žä¸€æ¡è®°å½•é€šå¸¸éƒ½è¿½åŠ åˆ°è¡¨çš„å°¾éƒ¨ï¼Œå› æ­¤äº‹å®žè¡¨å¹¶ä¸éœ€è¦åˆ†æ•£çš„ç©ºé—²ç©ºé—´ã€‚ä½†æ’å…¥åˆ°ç´¢å¼•(é™¤äº†èšç°‡ç´¢å¼•)ä¸Šçš„ä½ç½®æ˜¯éšæœºçš„ã€‚ä¸ºäº†é¿å…é¢‘ç¹çš„ç´¢å¼•é‡ç»„ï¼Œåœ¨å½“å‰ç¡¬ä»¶æ¡ä»¶ä¸‹ï¼Œé€šå¸¸10äº¿è¡Œçš„è¡¨å°†èŠ±è´¹å‡ ä¸ªå°æ—¶ï¼Œå¤§å¤šæ•°çš„ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹ä¸Šéƒ½éœ€è¦ç•™å‡ºè¶³å¤Ÿçš„ç©ºé—²ç©ºé—´ï¼Œå¯èƒ½ä¸º30% ~ 40%ã€‚ æ±‡æ€»è¡¨å³ä½¿æ˜¯åœ¨ç†æƒ³ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œä¸€äº›é’ˆå¯¹10äº¿æ¡è®°å½•çš„äº‹å®žè¡¨è¿›è¡Œçš„æŸ¥è¯¢ä¹Ÿä¼šå¯¼è‡´å¤§é‡çš„I/Oè®¿é—®ã€‚æé«˜è¿™ç±»æŸ¥è¯¢çš„æ€§èƒ½çš„å”¯ä¸€æ–¹å¼å°±æ˜¯ä½¿ç”¨æ±‡æ€»è¡¨(æŸ¥è¯¢è¡¨)ã€‚è¿™ç±»è¡¨æ˜¯åèŒƒå¼åŒ–çš„äº‹å®žè¡¨ã€‚å¦‚æžœè¡¨ä¸æ˜¯ç‰¹åˆ«å¤§(æ¯”å¦‚åªåŒ…å«å‡ ç™¾ä¸‡è¡Œæ•°æ®)ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¯è¡Œçš„æ–¹æ¡ˆï¼Œå› ä¸ºåæ¨¡å¼åŒ–æŸ¥è¯¢åªéœ€é’ˆå¯¹æ±‡æ€»è¡¨ï¼Œè€Œä¸éœ€è¦å¤šè¡¨å…³è”ã€‚ å¦‚æžœé¢‘ç¹æŸ¥è¯¢æ¯å‘¨çš„é”€å”®æƒ…å†µï¼Œé‚£ä¹ˆå¯ä»¥é’ˆå¯¹æ¯å‘¨çš„æ¶ˆè´¹è®°å½•å»ºç«‹ä¸€å¼ æ±‡æ€»è¡¨ã€‚æ¯”è¾ƒå¥½çš„æ±‡æ€»è¡¨è®¾è®¡æ˜¯æ ¹æ®å‘¨ï¼Œå•†å“ï¼Œå•†åº—æ±‡æ€»ä¸€æ¡è®°å½•ã€‚æ±‡æ€»è¡¨æ ¹æ®å‘¨å’Œå•†å“è¿›è¡Œæ±‡æ€»åŽï¼Œæ•°æ®é‡å¯ä»¥å¤§å¹…åº¦å‡å°‘ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢çš„å“åº”æ—¶é—´å¯èƒ½é™ä½Žåˆ°ä¸åˆ°1ç§’é’Ÿã€‚ æ±‡æ€»è¡¨ä¸Šçš„ç´¢å¼•é€šå¸¸ä¼šæ¯”è¾ƒå°ï¼Œä»–å”¯ä¸€çš„æ˜¾ç¤ºå› ç´ å°±æ˜¯åˆ·æ–°æ­¤è¡¨æ‰€éœ€çš„æ—¶é—´ã€‚å¦‚åŒæ‰€æœ‰æ–°é²œäº‹ç‰©ä¸€æ ·ï¼Œæ±‡æ€»è¡¨çš„æ–¹æ¡ˆä¹Ÿä¼šå¸¦æ¥æ–°çš„é—®é¢˜ã€‚ å¦‚æžœç”¨æˆ·çš„æŸ¥è¯¢éœ€æ±‚å¤šæ ·ï¼Œæ±‡æ€»è¡¨çš„è®¾è®¡ä¼šæ¯”ç´¢å¼•çš„è®¾è®¡æ›´å›°éš¾ï¼Œä¸è¿‡ï¼Œå·²ç»æœ‰ä¸€äº›å·¥å…·åŸºäºŽæŸ¥è¯¢æ—¥å¿—æ¥ååŠ©æ±‡æ€»è¡¨çš„è®¾è®¡ã€‚ å¦‚æžœä¼˜åŒ–å™¨ä¸èƒ½é€‰æ‹©æ­£ç¡®çš„æ±‡æ€»è¡¨ï¼Œé‚£ä¹ˆæ±‡æ€»è¡¨çš„æ„ä¹‰å°±ä¸å¤§ï¼›æˆ‘ä»¬ä¸èƒ½æŒ‡æœ›ç”¨æˆ·æ¥æŒ‡å®šæŸ¥è¯¢ä½¿ç”¨æŸä¸ªåˆé€‚çš„æ±‡æ€»è¡¨ã€‚æœ€å¥½çš„ä¼˜åŒ–å™¨å·²ç»åœ¨è¯•ç€è®¿é—®åˆé€‚çš„è¡¨äº†ï¼Œè™½ç„¶SELECTè¯­å¥å®žé™…ä¸ŠæŸ¥è¯¢çš„æ˜¯äº‹å®žè¡¨ã€‚å¦‚æžœä¼˜åŒ–å™¨ä¸å…·å¤‡è¿™ä¸ªèƒ½åŠ›ï¼Œæˆ–è€…å®ƒçš„æ­£ç¡®çŽ‡ä¸å¤Ÿé«˜ï¼Œé‚£ä¹ˆå¯èƒ½å°±ä¸å¾—ä¸å¼ºåˆ¶æŒ‡å®šæ¯ä¸ªç”¨æˆ·åªèƒ½è®¿é—®ä¸€ä¸ªæ±‡æ€»è¡¨ã€‚ç”¨æˆ·ä¸å¾—ä¸è‡ªå·±é€‰æ‹©è¦ä½¿ç”¨çš„æ±‡æ€»è¡¨ã€‚ä¼˜åŒ–å™¨èƒ½è‡ªåŠ¨è¯†åˆ«çš„æ±‡æ€»è¡¨é€šå¸¸è¢«ç§°ä¸ºè‡ªåŠ¨æ±‡æ€»è¡¨æˆ–ç‰©åŒ–è§†å›¾ã€‚ å¤šç´¢å¼•è®¿é—®ç®€ä»‹è®¸å¤šæ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ”¯æŒä»Žä¸€å¼ è¡¨çš„å¤šä¸ªç´¢å¼•å¤„æ”¶é›†åˆ¶ä½œï¼Œæˆ–æ˜¯ä»Žå•ä¸ªç´¢å¼•çš„å‡ ä¸ªç´¢å¼•ç‰‡æ”¶é›†ï¼Œç„¶åŽæ¯”è¾ƒè¿™äº›æŒ‡é’ˆé›†å¹¶è®¿é—®æ»¡è¶³WHEREè¯­å¥ä¸­æ‰€æœ‰è°“è¯æ¡ä»¶çš„æ•°æ®è¡Œã€‚è¿™ä¸€èƒ½åŠ›è¢«ç§°ä¸ºå¤šç´¢å¼•è®¿é—®ï¼Œæˆ–è¢«ç§°ä¸ºç´¢å¼•ä¸Ž(ç´¢å¼•äº¤é›†)å’Œç´¢å¼•æˆ–(ç´¢å¼•å¹¶é›†)ã€‚ å¤šç´¢å¼•è®¿é—®çš„æ€æƒ³æ˜¯ï¼šå¯¹è¡¨ä¸­æ•°æ®åˆ†åˆ«ä½¿ç”¨å„ä¸ªç´¢å¼•ï¼Œæœ€åŽå°†æ»¡è¶³æ¡ä»¶çš„è¿›è¡Œäº¤é›†æˆ–å¹¶é›†æ“ä½œã€‚ ç´¢å¼•å’Œç´¢å¼•é‡ç»„DBMSå¦‚ä½•æŸ¥æ‰¾ç´¢å¼•è¡Œåœ¨å½“å‰çš„ç¡¬ä»¶æ¡ä»¶ä¸‹ï¼Œéžå¶å­é¡µå¾ˆå¯èƒ½å·²ç»è¢«ç¼“å­˜åœ¨æ•°æ®åº“ç¼“å†²æ± ä¸­ï¼Œæˆ–è€…è‡³å°‘åœ¨ç£ç›˜çš„è¯»ç¼“å­˜ä¸­ï¼Œå› ä¸ºå®ƒä»¬ç»å¸¸è¢«é¢‘ç¹çš„è®¿é—®ã€‚ æ’å…¥ä¸€è¡Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå¦‚æžœä¸€å¼ è¡¨æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œé‚£ä¹ˆDBMSä¼šæ ¹æ®èšç°‡ç´¢å¼•çš„é”®å€¼å°è¯•å°†æ’å…¥çš„è®°å½•æ”¾åœ¨å®ƒæ‰€å±žçš„è¡¨é¡µ(ä¸»é¡µ)ä¸­ã€‚å¦‚æžœè¿™è¡Œè®°å½•åœ¨ä¸»é¡µé‡Œæ”¾ä¸ä¸‹ï¼Œæˆ–è€…å½“å‰é¡µè¢«é”ä½ï¼Œé‚£ä¹ˆDBMSå°†ä¼šæ£€æŸ¥é‚»è¿‘çš„é¡µã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œæ–°çš„è¡Œä¼šè¢«æ’å…¥åˆ°æ ‡çš„æœ€åä¸€é¡µã€‚ä¾èµ–äºŽDBMSå’Œè¡¨çš„ç±»åž‹ï¼Œå·²ç»æ’å…¥çš„è¡Œé€šå¸¸éƒ½ä¸ä¼šè¢«ç§»åŠ¨ï¼Œå¦åˆ™è¿™å°†æ„å‘³ç€æ›´æ–°è¡¨ä¸Šå·²ç»å»ºç«‹çš„æ‰€æœ‰ç´¢å¼•ä¸Šçš„ç›¸å…³æŒ‡é’ˆã€‚å½“æœ‰è®¸å¤šè¡¨è¡Œæœªèƒ½å­˜åœ¨åœ¨ä¸»é¡µä¸­æ—¶ï¼Œå¦‚æžœè¡¨è¡Œçš„é¡ºåºå¾ˆé‡è¦ï¼Œåˆ™éœ€è¦å¯¹è¿™ä¸ªè¡¨è¿›è¡Œé‡ç»„â€”å¯¹äºŽé‚£äº›æ¶‰åŠå¤šå¼ å¤§è¡¨çš„å¤§è§„æ¨¡æ‰¹å¤„ç†ä»»åŠ¡è€Œè¨€ï¼Œé€šå¸¸éœ€è¦è¿™ä¹ˆåšã€‚ å½“å¾€è¡¨ä¸­æ’å…¥ä¸€æ¡è®°å½•æ—¶ï¼ŒDBMSä¼šå°è¯•å°†ç´¢å¼•è¡Œæ·»åŠ è‡³å…¶ç´¢å¼•å»ºæ‰€å±žçš„å¶å­é¡µä¸Šï¼Œä½†æ˜¯è¯¥ç´¢å¼•é¡µå¯èƒ½æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—²ç©ºé—´æ¥å­˜æ”¾è¿™ä¸ªç´¢å¼•è¡Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒDBMSå°†ä¼šåˆ†è£‚è¯¥å¶å­é¡µã€‚å…¶ä¸­ä¸€åŠçš„è¡Œå°†è¢«ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°çš„å¶å­é¡µä¸Šï¼Œå¹¶å°½å¯èƒ½åœ°é è¿‘è¢«åˆ†è£‚çš„é¡µï¼Œä½†æ˜¯åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªç´¢å¼•é¡µå¯èƒ½ä¼šè¢«æ”¾ç½®åœ¨ç´¢å¼•çš„æœ«å°¾ã€‚é™¤äº†åœ¨æ¯ä¸ªå¶å­é¡µä¸Šé¢„ç•™éƒ¨åˆ†æ¯”ä¾‹çš„ç©ºé—²ç©ºé—´å¤–ï¼Œä¹Ÿè®¸å¯ä»¥åœ¨ç´¢å¼•è¢«åˆ›å»ºæˆ–é‡ç»„æ—¶ï¼Œæ¯nä¸ªé¡µé¢é¢„ç•™ä¸€ä¸ªç©ºé¡µâ€”å½“ç´¢å¼•åˆ†è£‚æ— æ³•é¿å…æ—¶ï¼Œè¿™ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„åŠžæ³•ã€‚ å½“ä¸€ä¸ªç´¢å¼•æœ‰ä¸€ä¸ªä¸æ–­å¢žé•¿çš„é”®å€¼æ—¶ï¼Œæ–°è¡Œå°†è¢«æ·»åŠ åˆ°ç´¢å¼•é¡µçš„æœ€åŽï¼Œç´¢å¼•é¡µå¯èƒ½æ°¸è¿œä¹Ÿä¸ä¼šè¿›è¡Œåˆ†è£‚,è¿™æ ·çš„ç´¢å¼•å¯èƒ½ä¸éœ€è¦ä»»ä½•ç©ºé—²ç©ºé—´ã€‚ å¶å­é¡µçš„åˆ†è£‚ä¸¥é‡å—ï¼Ÿåˆ†è£‚ä¸€ä¸ªç´¢å¼•é¡µåªéœ€ä¸€æ¬¡é¢å¤–çš„åŒæ­¥è¯»ï¼Œçº¦10msã€‚é™¤äº†ä¸¤ä¸ªå¶å­é¡µä»¥å¤–ï¼ŒDBMSé€šå¸¸è¿˜å¿…é¡»æ›´æ–°ä¸€ä¸ªéžå¶å­é¡µï¼Œè€Œå®ƒå¾ˆå¯èƒ½å·²ç»åœ¨å†…å­˜æˆ–è€…è¯»ç¼“å­˜ä¸­äº†ã€‚ åœ¨å¶å­é¡µåˆ†è£‚åŽï¼ŒæŸ¥è¯¢ä»»ä½•ä¸€æ¡ç´¢å¼•è¡Œçš„é€Ÿåº¦å¾ˆå¯èƒ½åŒä¹‹å‰ä¸€æ ·å¿«ã€‚åœ¨æœ€åæƒ…å†µä¸‹ï¼Œä¸€æ¬¡åˆ†è£‚ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•å±‚çº§ï¼Œä½†æ˜¯å¦‚æžœä¸æ˜¯ä»Žç£ç›˜è¯»å–éžå¶å­é¡µçš„è¯ï¼Œè¿™åªä¼šå¢žåŠ å¾ˆå°‘çš„CPUæ—¶é—´ã€‚ ç„¶è€Œï¼Œå¶å­é¡µçš„åˆ†è£‚ä¼šå¯¼è‡´ä¸€ä¸ªç´¢å¼•ç‰‡å˜å¾—æ›´æ…¢ã€‚ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åœ¨æ‰€æœ‰çš„åœºæ™¯ä¸­éƒ½å‡è®¾ä¸²è”ç´¢å¼•è¡Œçš„é“¾æŒ‡é’ˆæ€»æ˜¯æŒ‡å‘åŒä¸€é¡µæˆ–è€…ä¸‹ä¸€é¡µï¼Œè¿™äº›é¡µå¯èƒ½å·²è¢«DBMSé¢„è¯»å–ã€‚åœ¨ç´¢å¼•è¢«åˆ›å»ºæˆ–è€…é‡ç»„åŽï¼Œè¿™ç§å‡è®¾æ˜¯æŽ¥è¿‘çœŸå®žæƒ…å†µçš„ï¼Œä½†æ˜¯ç´¢å¼•ç‰‡ä¸Šçš„æ¯å¤„å¶å­é¡µåˆ†è£‚éƒ½å¯èƒ½ä¼šå¢žåŠ é¢å¤–çš„ä¸¤æ¬¡éšæœºè®¿é—®â€”ä¸€æ¬¡æ˜¯ä¸ºäº†æŸ¥æ‰¾ç´¢å¼•è¡Œè¢«ç§»åŠ¨è‡³çš„ç´¢å¼•é¡µï¼Œä¸€æ¬¡æ˜¯ä¸ºäº†è¿”å›žåˆ°æ‰«æçš„åŽŸå§‹ä½ç½®ã€‚å…¶ä¸­ç¬¬ä¸€æ¬¡éšæœºè®¿é—®å¾ˆå¯èƒ½ä¼šå¯¼è‡´ä¸€æ¬¡ç£ç›˜çš„éšæœºè¯»å–(10ms)ã€‚ ä»€ä¹ˆæ—¶å€™åº”è¯¥å¯¹ç´¢å¼•è¿›è¡Œé‡ç»„ï¼Ÿæ’å…¥æ¨¡å¼ç´¢å¼•é‡ç»„æ˜¯ä¸ºäº†æ¢å¤ç´¢å¼•è¡Œæ­£ç¡®çš„ç‰©ç†ä½ç½®ï¼Œä»–å¯¹äºŽç´¢å¼•ç‰‡æ‰«æå’Œå…¨ç´¢å¼•æ‰«æçš„æ€§èƒ½è€Œè¨€å¾ˆé‡è¦ã€‚å› ä¸ºæ’å…¥æ¨¡å¼çš„ä¸åŒï¼Œå¢žåŠ çš„ç´¢å¼•è¡Œå¯èƒ½ä¼šä»¥æ— åºçš„æ–¹å¼æ¥åˆ›å»ºã€‚æˆ‘ä»¬éœ€è¦è®°ä½ï¼Œæ›´æ–°ä¸€ä¸ªåˆ—æ„å‘³ç€éœ€è¦åˆ é™¤æ—§çš„ç´¢å¼•è¡Œï¼Œå¹¶å¢žåŠ ä¸€ä¸ªæ–°çš„ç´¢å¼•è¡Œï¼Œæ–°ç´¢å¼•è¡Œçš„ä½ç½®ç”±æ–°çš„ç´¢å¼•é”®å€¼æ¥ç¡®å®šã€‚ ä¸‹æ–‡å¯¹ä¸‰ç§åŸºæœ¬æ’å…¥æ¨¡å¼çš„è®¨è®ºåŸºäºŽå¦‚ä¸‹å‡è®¾ ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•ã€‚ è¢«åˆ é™¤çš„ç´¢å¼•è¡Œé”è…¾å‡ºçš„ç©ºé—´åœ¨é‡ç»„ä¹‹å‰å¯ä»¥è¢«æ–°çš„ç´¢å¼•è¡Œé‡ç”¨ã€‚ æ–°ç´¢å¼•è¡Œè¢«æ·»åŠ è‡³ç´¢å¼•çš„å°¾éƒ¨(æ°¸è¿œé€’å¢žçš„é”®)å‡è®¾æ’å…¥äº†ä¸€ä¸ªç´¢å¼•è¡Œï¼Œå…¶ç´¢å¼•é”®å€¼æ¯”ä»»ä½•å·²ç»å­˜åœ¨çš„ç´¢å¼•é”®å€¼éƒ½è¦å¤§ï¼Œåˆ™DBMSå°±ä¸ä¼šåˆ†ç±»æœ€åŽçš„å¶å­é¡µï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ç©ºé—²çš„ç©ºé—´æˆ–è€…è¿›è¡Œç´¢å¼•é‡ç»„äº†ã€‚ç„¶è€Œï¼Œå¦‚æžœåœ¨ç´¢å¼•å‰é¢çš„ç´¢å¼•è¡Œè¢«å®šæœŸåœ°åˆ é™¤ï¼Œé‚£ä¹ˆä¸ºäº†å›žæ”¶ç©ºé—²çš„ç©ºé—´ï¼Œç´¢å¼•å¯èƒ½ä¸å¾—ä¸è¿›è¡Œé‡ç»„(ä¸€ä¸ªâ€œçˆ¬è¡Œâ€çš„ç´¢å¼•)ã€‚ éšæœºæ’å…¥æ¨¡å¼æˆ‘ä»¬ç¨åŽå°†ä¼šçœ‹åˆ°ï¼Œå°½ç®¡è€ƒè™‘äº†ç©ºé—²ç©ºé—´å’Œé‡ç»„ï¼Œå¯¹äºŽä¸åŒçš„ç´¢å¼•è¡Œé•¿åº¦(çŸ­ï¼Œä¸­ï¼Œé•¿)çš„å¤„ç†ä¹Ÿæ˜¯ä¸åŒçš„ã€‚è¶Šé•¿çš„ç´¢å¼•è¡Œè¶Šéš¾å¤„ç†ï¼Œè¶ŠçŸ­çš„è¶Šå¥½å¤„ç†ã€‚ æœ‰ä¸€ä¸ªé‡è¦çš„ä¾‹å¤–åœºæ™¯ : å¦‚æžœç´¢å¼•è¡Œæ˜¯å˜é•¿çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦æœ‰ç©ºé—²çš„ç©ºé—´åŽ»é€‚åº”ä»»ä½•ç´¢å¼•è¡Œçš„å¢žé•¿ã€‚ ç´¢å¼•é‡ç»„çš„ä»£ä»·ä¸€ä¸ªç´¢å¼•å¯ä»¥ä»¥å¤šç§æ–¹å¼è¿›è¡Œé‡ç»„ï¼š å…¨ç´¢å¼•æ‰«æï¼ˆéšæœºè®¿é—®ä¸”æ— é¡»æŽ’åºï¼Œæˆ–è€…é¡ºåºè®¿é—®å¹¶æŽ’åºï¼‰ã€‚ å…¨è¡¨æ‰«æï¼ˆç±»ä¼¼ CREATE INDEX; é¡ºåºè®¿é—®åŠä¸€æ¬¡æŽ’åºï¼‰ã€‚ ç”±ç´¢å¼•é‡ç»„äº§ç”Ÿçš„é”ç­‰å¾…ä¾èµ–äºŽå…·ä½“çš„æ•°æ®åº“å’Œé€‰é¡¹ã€‚å¦‚æžœä½¿ç”¨çš„æ˜¯ç®€æ˜“çš„å·¥å…·,é‚£ä¹ˆå½“è¡¨æˆ–è€…ç´¢å¼•æ­£åœ¨è¢«æ‰«æå‹ï¼Œæ•´ä¸ªè¡¨å¯èƒ½è¢«åŠ ä¸Šä¸€ä¸ªSé”(æ›´æ–°æ“ä½œä¼šè¢«é˜»å¡žï¼‰ã€‚å¦‚æžœå·¥å…·èƒ½åœ¨æ‰«ææœŸé—´å°†æ›´æ–°æ“ä½œä¿å­˜ä¸‹æ¥ï¼Œå¹¶åœ¨æŽ’åºå‰å°†å®ƒä»¬åº”ç”¨åˆ°æ•°æ®è¡Œä¸Šï¼Œé‚£ä¹ˆé”ç­‰å¾…çš„æ—¶é—´å°†ä¼šç¼©çŸ­å¾ˆå¤šã€‚ æœ‰äº›æ—¶å€™ï¼Œå¤§çš„ç´¢å¼•å¯èƒ½ä¸å¾—ä¸åœ¨ä¸åˆé€‚çš„æ—¶é—´è¢«é‡ç»„ã€‚åœ¨æœ€åæƒ…å†µä¸‹ï¼Œé”çš„é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„é‡ç»„æ— æ³•å®žçŽ°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ ï¼Œ ä¸€äº›æ˜“å˜çš„ç´¢å¼•å¯èƒ½å¿…éœ€è¢«å¼ºåˆ¶ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼ˆå°†å…¶å›ºå®šåœ¨å†…å­˜ä¸­ï¼‰ã€‚ æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç›¸å…³çš„ç´¢å¼•é™åˆ¶ç´¢å¼•åˆ—çš„æ•°é‡èƒ½å¤Ÿå¤åˆ¶åˆ°ç´¢å¼•ä¸Šçš„åˆ—çš„ä¸ªæ•°ä¸Šé™åœ¨16è‡³64ä¹‹é—´ã€‚å¹¶éžæ¯ä¸ªäººéƒ½å°†è¿™è§†ä¸ºä¸€ä¸ªé—®é¢˜ã€‚ Gulutzan å’Œ Pelzeræå‡ºäº†ä¸€ä¸ªå‡ºäººæ„æ–™çš„å»ºè®®ï¼Œå¦‚ä¸‹: é’ˆå¯¹æ‰€æœ‰æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„æ€»ä½“å»ºè®®ä¸ºï¼šåœ¨ä¸€ä¸ªå¤åˆç´¢å¼•ä¸­æœ€å¤šä½¿ç”¨5åˆ—ã€‚è™½ç„¶ä½ èƒ½å¤Ÿç¡®å®šæ•°æ®åº“ç®¡ç†ç³»ç»Ÿè‡³å°‘èƒ½å¤Ÿæ”¯æŒ16åˆ—ï¼Œä½†æ˜¯5åˆ—æ˜¯ä¸€äº›ä¸“å®¶æ‰€è®¤ä¸ºçš„åˆç†ä¸Šé™ã€‚ ç´¢å¼•åˆ—çš„æ€»é•¿åº¦å¤åˆ¶åˆ°ç´¢å¼•çš„åˆ—çš„æ€»é•¿åº¦å­˜åœ¨ä¸€ä¸ªä¸Šé™ï¼Œè¯¥ä¸Šé™çš„å€¼å–å†³äºŽæ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚éšç€å®½ç´¢å¼•å˜å¾—è¶Šæ¥è¶Šæµè¡Œï¼Œè¿™ä¸€ä¸Šé™åœ¨æ•°æ®åº“ç­²ç†ç³»ç»Ÿçš„æ–°ç‰ˆæœ¬ä¸­åœ¨å˜å¤§ã€‚ å•è¡¨ç´¢å¼•æ•°é‡ä¸Šé™åœ¨å•è¡¨ç´¢å¼•æ•°é‡é™åˆ¶æ–¹é¢ï¼Œè®¸å¤šæ•°æ®åº“äº§å“è¦ä¹ˆæ²¡æœ‰ä¸Šé™ï¼Œè¦ä¹ˆä¸Šé™å¤ªé«˜ä»¥è‡³äºŽæ— å…³ç´§è¦ã€‚ ç´¢å¼•å¤§å°ä¸Šé™å…¸åž‹çš„ç´¢å¼•å¤§å°ä¸Šé™ä¸ºå‡ GB,è€Œä¸”è¿™ä¸€ä¸Šé™æ­£åœ¨æŒç»­å¢žå¤§ã€‚å°±åƒå¤§è¡¨ä¸€æ ·ï¼Œå¤§ç´¢å¼•é€šå¸¸æ˜¯åˆ†åŒºçš„ï¼Œè¿™æ ·èƒ½å¤Ÿä½¿æ‰§è¡Œç»´æŠ¤ç¨‹åºçš„æˆæœ¬æœ€å°åŒ–ï¼Œå¹¶ä¸”èƒ½å°†ç´¢å¼•åˆ†æ•£åˆ°å¤šä¸ªç£ç›˜é©±åŠ¨å™¨æˆ–RAIDç»„ä¸Šã€‚ ç´¢å¼•é”å®šä»Žæ›´æ–°çš„æ—¶é—´ç‚¹åˆ°æäº¤çš„æ—¶é—´ç‚¹å†…ï¼Œå¦‚æžœæ•°æ®åº“ç®¡ç†ç³»ç»Ÿç»™ä¸€ä¸ªç´¢å¼•é¡µæˆ–è€…ä¸€ä¸ªç´¢å¼•é¡µçš„ä¸€éƒ¨åˆ†ï¼ˆå¦‚ä¸€ä¸ªå­é¡µï¼‰åŠ äº†é”ï¼Œé‚£ä¹ˆè¯¥ç´¢å¼•é¡µæˆ–å­é¡µå¾ˆèƒ½ä¼šæˆä¸ºç“¶é¢ˆï¼Œå› ä¸ºæ’å…¥æ“ä½œå°†ä¼šå˜ä¸ºé¡ºåºçš„ã€‚ä¾‹å¦‚ï¼ŒSQL Server 2000å°±æ˜¯è¿™æ ·åšçš„ï¼Œä½†å¦‚æžœä¸Šé”çš„ç²’åº¦ä»…ä¸ºä¸€è¡Œï¼Œé‚£ä¹ˆè¿™ä¸å¯èƒ½ä¼šæˆä¸€ä¸ªé—®é¢˜ã€‚ åœ¨DB2æ•°æ®åº“çš„z/OSç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨é—©é”æ¥ä¿è¯ç´¢å¼•é¡µçš„ç‰©ç†å®Œå¹£æ€§ã€‚å½“ç”¨é—©é”å¯¹ä¸€ä¸ªç¼“å†²æ± ä¸­çš„é¡µåŠ é”æ—¶ï¼Œå®žé™…ä¸Šæ˜¯åœ¨æ•°æ®åº“ç¼“å†²æ± ä¸­è¿›è¡Œäº†ä¸€æ¬¡ç½®ä½æ“ä½œï¼Œå½“é‡Šæ”¾é—©é”æ—¶å†è¿›è¡Œé‡ç½®ã€‚ä¸€ä¸ªé¡µåªæœ‰åœ¨è¯»å–æˆ–ä¿®æ”¹æ—¶æ‰ä¼šè¢«åŠ ä¸Šé—©é”ï¼Œåœ¨å½“å‰çš„å¤„ç†å™¨æ¡ä»¶ä¸‹è€—è´¹æ—¶é—´ä¸åˆ°ä¸€å¾®ç§’ã€‚è€Œæ•°æ®å®Œå¹£æ€§æ˜¯é€šè¿‡å¯¹ç´¢å¼•è¡Œæ‰€æŒ‡å‘çš„è¡¨é¡µæˆ–è¡¨è¡ŒåŠ ä¸Šæ™®é€šé”æ¥ä¿è¯çš„ï¼ˆä»…å¯¹æ•°æ®ä¸Šé”ï¼‰ã€‚å½“ç¨‹åºä¿®æ”¹ä¸€ä¸ªè¡¨è¡Œæˆ–è¡¨é¡µã€‚è¿™äº›é”ä¸€ç›´ä¸ä¼šé‡Šæ”¾ï¼Œç›´è‡³ä¿®æ”¹è¢«æäº¤ã€‚ æ•°æ®åº“ç´¢å¼•é€‰é¡¹ç´¢å¼•é”®å†³å®šäº†è¿™ä¸€ç´¢å¼•è¡Œåœ¨ç´¢å¼•ç»“æž„ä¸­çš„ä½ç½®ã€‚å½“ç´¢å¼•é”®è¢«ä¿®æ”¹åŽ,DBMSä¼šåˆ é™¤åŽŸæ¥çš„ç´¢å¼•è¡Œï¼Œå¹¶å°†å…¶æ’å…¥åˆ°æ–°çš„ä½ç½®ä¸Šã€‚åœ¨æœ€å·®æƒ…å†µä¸‹ï¼Œç´¢å¼•è¡Œä¼šè¢«ç§»åŠ¨åˆ°å…¶ä»–çš„å¶å­é¡µä¸Šã€‚ å…¶ä»–è¯„ä¼°äº‹é¡¹å®½ç´¢å¼•è¿˜æ˜¯ç†æƒ³ç´¢å¼•å•çº¯ä»Žå“åº”æ—¶é—´æ¥çœ‹ï¼Œç†æƒ³çš„ç´¢å¼•å¹¶éžå…·æœ‰å®Œå…¨çš„ä¼˜åŠ¿ï¼Œæˆ‘ä»¬ç»™å‡ºäº†å¦‚ä¸‹ç»“è®º : è™½ç„¶ä¸‰æ˜Ÿç´¢å¼•æœ‰ä¸€å®šçš„ä¼˜åŠ¿ï¼Œå°¤å…¶æ˜¯åœ¨ç»“æžœé›†ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œä½†æ˜¯è¿™ä¸ªä¼˜åŠ¿å¹¶ä¸ä¹Ÿåˆ«æ˜Žæ˜¾ï¼Œè€Œä¸”ä¼šå¸¦æ¥ä¸Žæ–°å¢žç´¢å¼•ç›¸å…³çš„é¢å¤–å¼€é”€ã€‚ ç»„ç»‡ç´¢å¼•è®¾è®¡è¿‡ç¨‹ç®€ä»‹åœ¨å¤§å…¬å¸é‡Œï¼Œä¸€ä¸ªåˆç†çš„æŠ˜ä¸­æ–¹æ¡ˆæ˜¯è˜ç”¨50/50çš„ä¸“å®¶ï¼Œä»–ä»¬ä¼šå°†50%çš„æ—¶é—´ç”¨æ¥åº”ç”¨ç¨‹åºå¼€å‘ï¼Œå¦å¤–50%çš„æ—¶é—´ç”¨äºŽååŠ©åŒäº‹è¿›è¡Œç´¢å¼•è¯„ä¼°åŠå…¶ä»–æ€§èƒ½é—®é¢˜çš„å¤„ç†ï¼ˆæ¯”å¦‚æ ¹æ®EXPLAINçš„è¾“å‡ºå†…å®¹è§£å†³æŸä¸ªä¼˜åŒ–å™¨é—®é¢˜ï¼‰ã€‚ç»éªŒæ˜¾ç¤ºï¼Œä¸ºæ¯5è‡³10ä½åº”ç”¨å¼€å‘è€…é…ä¸€å50/50ä¸“å®¶çš„æ–¹å¼æ•ˆæžœå¾ˆå¥½ã€‚ ç´¢å¼•è®¾è®¡éœ€è¦åŒäº‹æŽŒæ¡æŠ€æœ¯æŠ€èƒ½ä»¥åŠåº”ç”¨ç³»ç»ŸçŸ¥è¯†ã€‚ç›¸æ¯”è®©æ•°æ®åº“ä¸“å®¶ç†Ÿæ‚‰åº”ç”¨ç³»ç»Ÿçš„ç»†èŠ‚è€Œè¨€ï¼Œæ•™ä¼šå¼€å‘äººå‘˜ç´¢å¼•æŠ€èƒ½æ˜¯æ›´å®¹æ˜“çš„ã€‚ PDFä¹¦ç±ä¸‹è½½åœ°å€ï¼šhttps://github.com/jiankunking/books-recommendation/tree/master/Database]]></content>
      <categories>
        <category>Database</category>
      </categories>
      <tags>
        <tag>Design</tag>
        <tag>MySQL</tag>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
        <tag>Database</tag>
        <tag>Oracle</tag>
        <tag>SQL Server</tag>
        <tag>DB2</tag>
        <tag>Index</tag>
        <tag>Optimizers</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaæ€§èƒ½ä¼˜åŒ–æƒå¨æŒ‡å— ç¬”è®°]]></title>
    <url>%2Fjava-performance-note.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ•´ç†è‡ªï¼šã€ŠJavaæ€§èƒ½ä¼˜åŒ–æƒå¨æŒ‡å—ã€‹ ä½œè€…ï¼šCharlie Hunt / Binu John å‡ºç‰ˆæ—¶é—´ï¼š2014-03 æ“ä½œç³»ç»Ÿæ€§èƒ½ç›‘æŽ§CPUä½¿ç”¨çŽ‡å¤§å¤šæ•°çš„æ“ä½œç³»ç»Ÿçš„CPUä½¿ç”¨çŽ‡åˆ†ä¸ºç”¨æˆ·æ€CPUä½¿ç”¨çŽ‡å’Œç³»ç»Ÿæ€CPUä½¿ç”¨çŽ‡ã€‚ ç”¨æˆ·æ€CPUä½¿ç”¨çŽ‡æ˜¯æŒ‡æ‰§è¡Œåº”ç”¨ç¨‹åºä»£ç çš„æ—¶é—´å æ€»CPUæ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚ ç³»ç»Ÿæ€CPUä½¿ç”¨çŽ‡æ˜¯æŒ‡åº”ç”¨æ‰§è¡Œæ“ä½œç³»ç»Ÿè°ƒç”¨çš„æ—¶é—´å æ€»CPUæ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚ç³»ç»Ÿæ€CPUä½¿ç”¨çŽ‡é«˜æ„å‘³ç€å…±äº«èµ„æºæœ‰ç«žäº‰æˆ–è€…I/Oè®¾å¤‡ä¹‹é—´æœ‰å¤§é‡çš„äº¤äº’ã€‚ æ—¢ç„¶åŽŸæœ¬ç”¨äºŽæ‰§è¡Œæ“ä½œç³»ç»Ÿå†…æ ¸è°ƒç”¨çš„CPUå‘¨æœŸä¹Ÿå¯ä»¥ç”¨æ¥æ‰§è¡Œåº”ç”¨ä»£ç ï¼Œæ‰€ä»¥ç†æƒ³æƒ…å†µä¸‹ï¼Œåº”ç”¨è¾¾åˆ°æœ€é«˜æ€§èƒ½å’Œæ‰©å±•æ€§æ—¶ï¼Œå®ƒçš„ç³»ç»Ÿæ€CPUä½¿ç”¨çŽ‡ä¸º0%ï¼Œæ‰€ä»¥æé«˜åº”ç”¨æ€§èƒ½å’Œæ‰©å±•æ€§çš„ä¸€ä¸ªç›®æ ‡æ˜¯å°½å¯èƒ½é™ä½Žç³»ç»Ÿæ€CPUä½¿ç”¨çŽ‡ã€‚ å¯¹äºŽè®¡ç®—å¯†é›†åž‹åº”ç”¨æ¥è¯´ï¼Œä¸ä»…è¦ç›‘æŽ§ç”¨æˆ·æ€å’Œç³»ç»Ÿæ€CPUä½¿ç”¨çŽ‡ï¼Œè¿˜è¦è¿›ä¸€æ­¥ç›‘æŽ§æ¯æ—¶é’ŸæŒ‡ä»¤æ•°ï¼ˆInstructions Per Clockï¼ŒIPCï¼‰æˆ–æ¯æŒ‡ä»¤æ—¶é’Ÿå‘¨æœŸï¼ˆCycles Per Instructionï¼ŒCPIï¼‰ç­‰æŒ‡æ ‡ã€‚è¿™ä¸¤ä¸ªæŒ‡æ ‡å¯¹äºŽè®¡ç®—å¯†é›†åž‹åº”ç”¨æ¥è¯´å¾ˆé‡è¦ï¼Œå› ä¸ºçŽ°ä»£æ“ä½œç³»ç»Ÿè‡ªå¸¦çš„CPUä½¿ç”¨çŽ‡ç›‘æŽ§å·¥å…·åªèƒ½æŠ¥å‘ŠCPUä½¿ç”¨çŽ‡ï¼Œè€Œæ²¡æœ‰CPUæ‰§è¡ŒæŒ‡ä»¤å ç”¨CPUæ—¶é’Ÿå‘¨æœŸçš„ç™¾åˆ†æ¯”ï¼Œè¿™æ„å‘³ç€ï¼Œå³ä¾¿CPUåœ¨ç­‰å¾…ç€å†…å­˜ä¸­çš„æ•°æ®ï¼Œæ“ä½œç³»ç»Ÿå·¥å…·ä»ç„¶ä¼šæŠ¥å‘ŠCPUç¹å¿™ã€‚è¿™ç§æƒ…å†µé€šå¸¸è¢«ç§°ä¸ºåœæ»žã€‚å½“CPUæ‰§è¡ŒæŒ‡ä»¤æ‰€ç”¨çš„æ“ä½œæ•°æ®ä¸åœ¨å¯„å­˜å™¨æˆ–è€…ç¼“å­˜ä¸­æ—¶ï¼Œå°±ä¼šå‘ç”Ÿåœæ»žï¼Œç”±äºŽæŒ‡ä»¤æ‰§è¡Œå‰å¿…é¡»ç­‰å¾…æ•°æ®ä»Žå†…å­˜ä¸­è£…å…¥CPUå¯„å­˜å™¨ï¼Œæ‰€ä»¥ä¸€æ—¦å‘ç”Ÿåœæ»žï¼Œå°±ä¼šæµªè´¹æ—¶é’Ÿå‘¨æœŸã€‚CPUåœæ»žé€šå¸¸ä¼šç­‰å¾…å¥½å‡ ç™¾ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œå› æ­¤æé«˜è®¡ç®—å¯†é›†åž‹åº”ç”¨æ€§èƒ½çš„ç­–ç•¥å°±æ˜¯å‡å°‘åœæ»žæˆ–è€…æ”¹å–„CPUé«˜é€Ÿç¼“å­˜ä½¿ç”¨çŽ‡ï¼Œä»Žè€Œå‡å°‘CPUåœ¨ç­‰å¾…å†…å­˜æ•°æ®æ—¶æµªè´¹çš„æ—¶é’Ÿå‘¨æœŸã€‚ CPUè°ƒåº¦ç¨‹åºè¿è¡Œé˜Ÿåˆ—ç›‘æŽ§CPUè°ƒåº¦ç¨‹åºè¿è¡Œé˜Ÿåˆ—å¯¹äºŽåˆ†è¾¨ç³»ç»Ÿæ˜¯å¦æ»¡è´Ÿè·ä¹Ÿæœ‰é‡è¦æ„ä¹‰ã€‚è¿è¡Œé˜Ÿåˆ—ä¸­å°±æ˜¯é‚£äº›å·²å‡†å¤‡å¥½è¿è¡Œã€æ­£ç­‰å¾…å¯ç”¨CPUçš„è½»é‡çº§è¿›ç¨‹ã€‚å¦‚æžœå‡†å¤‡è¿è¡Œçš„è½»é‡çº§è¿›ç¨‹æ•°è¶…è¿‡ç³»ç»Ÿæ‰€èƒ½å¤„ç†çš„ä¸Šé™ï¼Œè¿è¡Œé˜Ÿåˆ—å°±ä¼šå¾ˆé•¿ã€‚è¿è¡Œé˜Ÿåˆ—é•¿è¡¨æ˜Žç³»ç»Ÿè´Ÿè½½å¯èƒ½é¥±å’Œã€‚ç³»ç»Ÿè¿è¡Œé˜Ÿåˆ—é•¿åº¦ç­‰äºŽè™šæ‹Ÿæœºå¤„ç†å™¨çš„ä¸ªæ•°æ—¶ï¼Œç”¨æˆ·ä¸ä¼šæ˜Žæ˜¾æ„Ÿè§‰åˆ°æ€§èƒ½ä¸‹é™ã€‚æ­¤å¤„è™šæ‹Ÿå¤„ç†å™¨çš„ä¸ªæ•°å°±æ˜¯ç³»ç»Ÿç¡¬ä»¶çº¿ç¨‹çš„ä¸ªæ•°ï¼Œä¹Ÿæ˜¯Java API Runtime.availableProcessors()çš„è¿”å›žå€¼ã€‚å½“è¿è¡Œé˜Ÿåˆ—é•¿åº¦è¾¾åˆ°è™šæ‹Ÿå¤„ç†çš„4å€æˆ–è€…æ›´å¤šæ—¶ï¼Œç³»ç»Ÿçš„å“åº”å°±éžå¸¸è¿Ÿç¼“äº†ã€‚ ä¸€èˆ¬æ€§çš„æŒ‡å¯¼åŽŸåˆ™æ˜¯ï¼šå¦‚æžœåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œè¿è¡Œé˜Ÿåˆ—çš„é•¿åº¦ä¸€ç›´éƒ½è¶…è¿‡è™šæ‹Ÿå¤„ç†å™¨ä¸ªæ•°çš„1å€ï¼Œå°±éœ€è¦å…³æ³¨äº†ï¼Œåªæ˜¯æš‚æ—¶è¿˜ä¸éœ€è¦ç«‹åˆ»é‡‡å–è¡ŒåŠ¨ã€‚å¦‚æžœåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œè¿è¡Œé˜Ÿåˆ—é•¿åº¦è¾¾åˆ°è™šæ‹Ÿå¤„ç†å™¨ä¸ªæ•°çš„3~4å€æˆ–æ›´é«˜ï¼Œåˆ™éœ€è¦ç«‹åˆ»å¼•èµ·æ³¨æ„å’Œé‡‡å–è¡ŒåŠ¨ã€‚ å†…å­˜ä½¿ç”¨çŽ‡ç³»ç»Ÿåœ¨è¿›è¡Œé¡µé¢äº¤æ¢æˆ–è€…ä½¿ç”¨è™šæ‹Ÿå†…å­˜æ—¶ï¼ŒJavaåº”ç”¨æˆ–JVMä¼šè¡¨çŽ°å‡ºæ˜Žæ˜¾çš„æ€§èƒ½é—®é¢˜ã€‚å½“åº”ç”¨è¿è¡Œæ‰€éœ€çš„å†…å­˜è¶…è¿‡å¯ç”¨ç‰©ç†å†…å­˜æ—¶ï¼Œå°±ä¼šå‘ç”Ÿé¡µé¢äº¤æ¢ã€‚ä¸ºäº†åº”å¯¹è¿™ç§å¯èƒ½å‡ºçŽ°çš„æƒ…å†µï¼Œé€šå¸¸è¦ä¸ºç³»ç»Ÿé…ç½®swapç©ºé—´ã€‚swapç©ºé—´ä¸€èˆ¬ä¼šåœ¨ä¸€ä¸ªç‹¬ç«‹çš„ç£ç›˜åˆ†åŒºä¸Šã€‚å½“åº”ç”¨è€—å°½å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†åº”ç”¨çš„ä¸€éƒ¨åˆ†ç½®æ¢åˆ°ç£ç›˜ä¸Šçš„swapç©ºé—´ã€‚é€šå¸¸æ˜¯åº”ç”¨ä¸­æœ€å°‘è¿è¡Œçš„éƒ¨åˆ†ï¼Œä»¥å…å½±å“æ•´ä¸ªåº”ç”¨æˆ–è€…åº”ç”¨æœ€å¿™çš„é‚£éƒ¨åˆ†ã€‚å½“è®¿é—®åº”ç”¨ä¸­è¢«ç½®æ¢å‡ºåŽ»çš„éƒ¨åˆ†æ—¶ï¼Œå°±å¿…é¡»å°†å®ƒä»Žç£ç›˜ç½®æ¢è¿›å†…å­˜ï¼Œè€Œè¿™ç§ç½®æ¢æ´»åŠ¨ä¼šå¯¹åº”ç”¨çš„å“åº”æ€§å’Œåžåé‡é€ æˆå¾ˆå¤§å½±å“ã€‚ JVMåžƒåœ¾æ”¶é›†å™¨åœ¨ç³»ç»Ÿé¡µé¢äº¤æ¢æ—¶çš„æ€§èƒ½ä¹Ÿå¾ˆå·®ï¼Œè¿™æ˜¯ç”±äºŽåžƒåœ¾æ”¶é›†å™¨ä¸ºäº†å›žæ”¶ä¸å¯è¾¾å¯¹è±¡æ‰€å ç”¨çš„ç©ºé—´ï¼Œéœ€è¦è®¿é—®å¤§é‡çš„å†…å­˜ã€‚å¦‚æžœJavaå †å¾—ä¸€éƒ¨åˆ†è¢«ç½®æ¢å‡ºåŽ»ï¼Œå°±å¿…é¡»å…ˆç½®æ¢è¿›å†…å­˜ä»¥ä¾¿åžƒåœ¾æ”¶é›†å™¨æ‰«æå­˜æ´»å¯¹è±¡ï¼Œè¿™ä¼šå¢žåŠ åžƒåœ¾æ”¶é›†çš„æŒç»­æ—¶é—´ã€‚åžƒåœ¾æ”¶é›†æ˜¯ä¸€ç§Stop-The-Worldæ“ä½œï¼Œå³åœæ­¢æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„åº”ç”¨çº¿ç¨‹ï¼Œå¦‚æžœæ­¤æ—¶ç³»ç»Ÿæ­£åœ¨è¿›è¡Œé¡µé¢äº¤æ¢ï¼Œåˆ™ä¼šå¼•èµ·JVMé•¿æ—¶é—´çš„åœé¡¿ã€‚ ç›‘æŽ§æŠ¢å å¼ä¸Šä¸‹æ–‡åˆ‡æ¢è®©æ­¥å¼ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶æŒ‡æ‰§è¡Œçº¿ç¨‹ä¸»åŠ¨é‡Šæ”¾CPUï¼ŒæŠ¢å å¼ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶æŒ‡çº¿ç¨‹å› ä¸ºåˆ†é…çš„æ—¶é—´ç‰‡ç”¨å°½è€Œè¢«è¿«æ”¾å¼ƒCPUæˆ–è€…è¢«å…¶ä»–ä¼˜å…ˆçº§æ›´é«˜çš„çº¿ç¨‹é”æŠ¢å ã€‚pidstatçš„è¾“å‡ºç»“æžœä¸­cswch/sæ˜¯æ¯ç§’çš„è®©æ­¥å¼ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œnvccswch/sæ˜¯æŠ¢å å¼ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ ç›‘æŽ§çº¿ç¨‹è¿ç§»æˆ‘ä»¬å‘çŽ°ï¼Œå¾…è¿è¡Œçº¿ç¨‹åœ¨å¤„ç†å™¨ä¹‹å‰çš„è¿ç§»ä¹Ÿä¼šå¯¼è‡´æ€§èƒ½çš„ä¸‹é™ã€‚å¤§å¤šæ•°æ“ä½œç³»ç»Ÿçš„CPUè°ƒåº¦ç¨‹åºä¼šå°†å¾…è¿è¡Œçº¿ç¨‹åˆ†é…ç»™ä¸Šæ¬¡è¿è¡Œå®ƒçš„è™šæ‹Ÿå¤„ç†å™¨ã€‚å¦‚æžœè¿™ä¸ªè™šæ‹Ÿå¤„ç†å™¨å¿™ï¼Œè°ƒåº¦ç¨‹åºå°±ä¼šå°†å¾…å¤„ç†çº¿ç¨‹è¿ç§»åˆ°å…¶ä»–å¯ç”¨çš„è™šæ‹Ÿå¤„ç†å™¨ã€‚çº¿ç¨‹è¿ç§»ä¼šå¯¹åº”ç”¨æ€§èƒ½é€ æˆå½±å“ï¼Œè¿™æ˜¯å› ä¸ºæ–°çš„è™šæ‹Ÿå¤„ç†å™¨ç¼“å­˜ä¸­å¯èƒ½æ²¡æœ‰å¾…è¿è¡Œçº¿ç¨‹æ‰€éœ€çš„æ•°æ®æˆ–çŠ¶æ€ä¿¡æ¯ã€‚å¤šæ ¸ç³»ç»Ÿä¸Šè¿è¡ŒJavaåº”ç”¨å¯èƒ½ä¼šå‘ç”Ÿå¤§é‡çš„çº¿ç¨‹è¿ç§»ï¼Œå‡å°‘è¿ç§»çš„ç­–ç•¥æ˜¯åˆ›å»ºå¤„ç†å™¨ç»„å¹¶å°†åº”ç”¨åˆ†é…ç»™è¿™äº›å¤„ç†å™¨ç»„ã€‚ä¸€èˆ¬æ€§å‡†åˆ™æ˜¯ï¼Œå¦‚æžœæ¨ªè·¨å¤šæ ¸æˆ–è™šæ‹Ÿå¤„ç†å™¨çš„Javaåº”ç”¨æ¯ç§’è¿ç§»è¶…è¿‡500æ¬¡ï¼Œå°†Javaåº”ç”¨ç»‘å®šåœ¨å¤„ç†å™¨ç»„ä¸Šå°±æœ‰å¥½å¤„ã€‚ ç½‘ç»œI/Oä½¿ç”¨çŽ‡åº”ç”¨æ€§èƒ½æ”¹è¿›çš„è€ƒè™‘å•æ¬¡è¯»å†™æ•°æ®é‡å°è€Œç½‘ç»œè¯»å†™é‡å¤§çš„åº”ç”¨ä¼šæ¶ˆè€—å¤§é‡çš„ç³»ç»Ÿæ€CPUï¼Œäº§ç”Ÿå¤§é‡çš„ç³»ç»Ÿè°ƒç”¨ã€‚å¯¹äºŽè¿™ç±»åº”ç”¨ï¼Œå‡å°‘ç³»ç»Ÿæ€CPUçš„ç­–ç•¥æ˜¯å‡å°‘ç½‘ç»œè¯»å†™çš„ç³»ç»Ÿè°ƒç”¨ã€‚æ­¤å¤–ï¼Œä½¿ç”¨éžé˜»å¡žçš„Java NIOè€Œä¸æ˜¯é˜»å¡žçš„java.net.Socketï¼Œå‡å°‘å¤„ç†è¯·æ±‚å’Œå‘é€ç›¸åº”çš„çº¿ç¨‹æ•°ï¼Œä¹Ÿå¯ä»¥æ”¹å–„åº”ç”¨æ€§èƒ½ã€‚ ä»Žéžé˜»å¡žSocketä¸­è¯»å–æ•°æ®çš„ç­–ç•¥æ˜¯ï¼Œåº”ç”¨åœ¨æ¯æ¬¡è¯»è¯·æ±‚æ—¶å°½å¯èƒ½å¤šåœ°è¯»å–æ•°æ®ã€‚åŒæ ·ï¼Œå½“å¾€Socketä¸­å†™æ•°æ®æ—¶ï¼Œæ¯ä¸ªå†™è°ƒç”¨åº”è¯¥å°½å¯èƒ½å¤šåœ°å†™ã€‚ JVMæ¦‚è§ˆHotSpot è¿è¡Œæ—¶å‘½ä»¤è¡Œé€‰é¡¹HotSpot VM å‘½ä»¤è¡Œé€‰é¡¹æœ‰3ç±»ï¼š æ ‡å‡†é€‰é¡¹ï¼ˆStandard optionï¼‰ï¼šæ ‡å‡†é€‰é¡¹æ˜¯Java virtual Machine Specificationè¦æ±‚æ‰€æœ‰java JVM éƒ½å¿…é¡»å®žçŽ°çš„é€‰é¡¹ã€‚ éžæ ‡å‡†é€‰é¡¹ï¼ˆNonStandard optionï¼‰ï¼šéžæ ‡å‡†é€‰é¡¹(ä»¥â€“Xä¸ºå‰ç¼€)ï¼Œä¸ä¿è¯ä¹Ÿä¸å¼ºåˆ¶æ‰€æœ‰JVMå®žçŽ°éƒ½å¿…é¡»æ”¯æŒã€‚ éžç¨³å®šé€‰é¡¹ï¼ˆDeveloper optionï¼‰ï¼šéžç¨³å®šé€‰é¡¹(ä»¥-XXä¸ºå‰ç¼€),é€šå¸¸ä¸ºäº†ç‰¹å®šéœ€è¦è€Œå¯¹JVMçš„è¿è¡Œè¿›è¡ŒçŸ«æ­£ã€‚é€‰é¡¹åç§°å‰+ä»£è¡¨ trueå¯ç”¨ï¼Œ-ä»£è¡¨falseå…³é—­ã€‚ VMç”Ÿå‘½å‘¨æœŸå¯åŠ¨å™¨å¯åŠ¨HotSpot VMæ—¶ä¼šæ‰§è¡Œä¸€ç³»åˆ—æ“ä½œã€‚æ­¥éª¤æ¦‚è¿°å¦‚ä¸‹ï¼š è§£æžå‘½ä»¤è¡Œé€‰é¡¹ è®¾ç½®å †çš„å¤§å°å’ŒJITç¼–è¯‘å™¨å¦‚æžœå‘½ä»¤è¡Œæ²¡æœ‰æ˜Žç¡®è®¾ç½®å †çš„å¤§å°å’ŒJITç¼–è¯‘å™¨ï¼Œå¯åŠ¨å™¨åˆ™é€šè¿‡è‡ªåŠ¨ä¼˜åŒ–è¿›è¡Œè®¾ç½®ã€‚ è®¾å®šçŽ¯å¢ƒå˜é‡å¦‚ï¼šLD_LIBRARY_PATHå’ŒCLASSPATH å¦‚æžœå‘½ä»¤è¡Œæœ‰-jaré€‰é¡¹ï¼Œå¯åŠ¨å™¨åˆ™ä»ŽæŒ‡å®šJARçš„manifestä¸­æŸ¥æ‰¾Main-Classï¼Œå¦åˆ™ä»Žå‘½ä»¤è¡Œè¯»å–Main-Class ä½¿ç”¨æ ‡å‡†Javaæœ¬åœ°æŽ¥å£ï¼ˆJava Native Interfaceï¼ŒJNIï¼‰æ–¹æ³•JNI_CreateJavaVMåœ¨æ–°åˆ›å»ºçš„çº¿ç¨‹ä¸­åˆ›å»ºHotSpot VM ä¸€æ—¦åˆ›å»ºå¹¶åˆå§‹åŒ–å·HotSpot VMï¼Œå°±ä¼šåŠ è½½Java Main-Classï¼Œå¯åŠ¨å™¨ä¹Ÿä¼šä»ŽJava Main-Classä¸­å–å¾—Java mainæ–¹æ³•çš„å‚æ•° HotSpot VMé€šè¿‡JNIæ–¹æ³•CallStartVoidMethodè°ƒç”¨Java mainæ–¹æ³•ï¼Œå¹¶å°†å‘½ä»¤è¡Œé€‰é¡¹ä¼ ç»™å®ƒ VMç±»åŠ è½½é˜¶æ®µç±»åŠ è½½é˜¶æ®µå¯¹äºŽç»™å®šçš„Javaç±»æˆ–æŽ¥å£ï¼Œç±»åŠ è½½æ—¶ä¼šä¾æ®å®ƒçš„åå­—æ‰¾åˆ°Javaç±»çš„äºŒè¿›åˆ¶ç±»æ–‡ä»¶ï¼Œå®šä¹‰Javaç±»ï¼Œç„¶åŽåˆ›å»ºä»£è¡¨è¿™ä¸ªç±»æˆ–è€…æŽ¥å£çš„java.lang.Classå¯¹è±¡ã€‚å¦‚æžœæ²¡æœ‰æ‰¾åˆ°Javaç±»æˆ–æŽ¥å£çš„äºŒè¿›åˆ¶è¡¨ç¤ºå°±ä¼šæŠ›å‡ºNoClassDefFoundã€‚æ­¤å¤–ï¼Œç±»åŠ è½½é˜¶æ®µä¼šå¯¹ç±»çš„æ ¼å¼è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼Œå¦‚æžœæœ‰é”™ï¼Œåˆ™ä¼šæŠ›å‡ºClassFormatErroræˆ–UnsupportedClassVersionErrorã€‚Javaç±»åŠ è½½å‰ï¼ŒHotSpot VMå¿…é¡»å…ˆåŠ è½½å®ƒçš„æ‰€æœ‰è¶…ç±»å’Œè¶…æŽ¥å£ï¼Œå¦‚æžœç±»çš„ç»§æ‰¿å±‚æ¬¡æœ‰é”™ï¼Œä¾‹å¦‚Javaç±»æ˜¯å®ƒè‡ªå·±çš„è¶…ç±»æˆ–è¶…æŽ¥å£ï¼ˆç±»å±‚æ¬¡é€’å½’ï¼‰,HotSpot VMåˆ™ä¼šæŠ›å‡ºClassCircularityErrorã€‚å¦‚æžœæ‰€å¼•ç”¨çš„ç›´æŽ¥è¶…æŽ¥å£æœ¬èº«å¹¶ä¸æ˜¯æŽ¥å£ï¼Œæˆ–è€…ç›´æŽ¥è¶…ç±»å®žé™…ä¸Šæ˜¯æŽ¥å£ï¼ŒHotSpot VMåˆ™ä¼šæŠ›å‡ºIncompatibleClassChangeErrorã€‚ é“¾æŽ¥çš„ç¬¬ä¸€æ­¥æ˜¯éªŒè¯ï¼Œæ£€æŸ¥ç±»æ–‡ä»¶çš„è¯­ä¹‰ã€å¸¸é‡æ± ç¬¦å·ä»¥åŠç±»åž‹ã€‚å¦‚æžœæ£€æŸ¥æœ‰é”™ï¼Œå°±ä¼šæŠ›å‡ºVerifyErrorã€‚é“¾æŽ¥çš„ä¸‹ä¸€æ­¥æ˜¯å‡†å¤‡ï¼Œå®ƒä¼šåˆ›å»ºé™æ€å­—æ®µï¼Œåˆå§‹åŒ–ä¸ºæ ‡å‡†é»˜è®¤å€¼ï¼Œä»¥åŠåˆ†é…æ–¹æ³•è¡¨ã€‚è¯·æ³¨æ„ï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰æ‰§è¡Œä»»ä½•Javaä»£ç ã€‚æŽ¥ä¸‹æ¥è§£æžç¬¦å·å¼•ç”¨ï¼Œè¿™ä¸€æ­¥æ˜¯å¯é€‰çš„ã€‚ç„¶åŽåˆå§‹åŒ–ç±»ï¼Œè¿è¡Œç±»æž„é€ å™¨ã€‚è¿™æ˜¯è¿„ä»Šä¸ºæ­¢ï¼Œç±»ä¸­è¿è¡Œçš„ç¬¬ä¸€æ®µJavaä»£ç ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåˆå§‹åŒ–ç±»éœ€è¦é¦–å…ˆåˆå§‹åŒ–è¶…ç±»ï¼ˆä¸ä¼šåˆå§‹åŒ–è¶…æŽ¥å£ï¼‰ã€‚ å¦‚ï¼šintçš„æ ‡å‡†é»˜è®¤å€¼ä¸º0ï¼›public static int alue=123ï¼Œå‡†å¤‡é˜¶æ®µå°†å…¶åˆå§‹åŒ–ä¸º0è€Œä¸æ˜¯123ï¼Œvalue=123çš„èµ‹å€¼æ“ä½œåœ¨ç±»æž„é€ å™¨&lt;clinit&gt;()ä¸­ã€‚public static final int value=123ï¼Œç¼–è¯‘æ—¶ä¼šä¸ºvalueåœ¨å­—æ®µå±žæ€§è¡¨ä¸­ç”ŸæˆConstantValueï¼Œä»Žè€Œåœ¨å‡†å¤‡é˜¶æ®µå°±è¢«åˆå§‹åŒ–æˆ123ã€‚ Java Virtual Machine Specificationè§„å®šé¦–æ¬¡ä½¿ç”¨ç±»æ—¶è¿›è¡Œç±»åˆå§‹åŒ–ï¼Œè€ŒJava Language Specificationåˆ™å…è®¸åœ¨é“¾æŽ¥é˜¶æ®µç¬¦å·è§£æžæ—¶çµæ´»å¤„ç†ï¼Œåªè¦ä¿æŒè¯­è¨€çš„è¯­ä¹‰ä¸å˜ï¼ŒJVMä¾æ¬¡æ‰§è¡ŒåŠ è½½ã€é“¾æŽ¥å’Œåˆå§‹åŒ–ï¼Œä¿è¯åŠæ—¶æŠ›å‡ºé”™è¯¯å³å¯ã€‚å‡ºäºŽæ€§èƒ½ä¼˜åŒ–çš„è€ƒè™‘ï¼Œé€šå¸¸ç›´åˆ°ç±»åˆå§‹åŒ–æ—¶HotspotVMæ‰ä¼šåŠ è½½å’Œé“¾æŽ¥ç±»ã€‚è¿™æ„å‘³ç€ï¼Œç±»Aå¼•ç”¨ç±»Bã€‚åŠ è½½Aä¸ä¸€å®šå¯¼è‡´åŠ è½½Bï¼ˆé™¤éžBéœ€è¦éªŒè¯ï¼‰ã€‚æ‰§è¡ŒBçš„ç¬¬ä¸€æ¡æŒ‡ä»¤ä¼šå¯¼è‡´åˆå§‹åŒ–Bï¼Œä»Žè€ŒåŠ è½½å’Œé“¾æŽ¥Bã€‚ ç±»åŠ è½½å™¨å§”æ´¾å½“è¯·æ±‚ç±»åŠ è½½å™¨æŸ¥æ‰¾å’ŒåŠ è½½æŸä¸ªç±»æ—¶ï¼Œè¯¥ç±»åŠ è½½å™¨å¯ä»¥è½¬è€Œè¯·æ±‚åˆ«çš„ç±»åŠ è½½å™¨æ¥åŠ è½½ã€‚è¿™è¢«ç§°ä¸ºç±»åŠ è½½å™¨å§”æ´¾ã€‚ç±»çš„é¦–ä¸ªç±»åŠ æ‰¾å™¨ç§°ä¸ºåˆå§‹ç±»åŠ è½½å™¨ï¼ˆInitiating ClassLoader)ï¼Œæœ€ç»ˆå®šä¹‰ç±»çš„ç±»åŠ è½½å™¨ç§°ä¸ºå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆDefining ClassLoaderï¼‰ã€‚å°±å­—èŠ‚ç è§£æžè€Œè¨€ï¼ŒæŸä¸ªç±»çš„åˆå§‹ç±»åŠ è½½å™¨æ˜¯æŒ‡å¯¹è¯¥ç±»è¿›è¡Œå¸¸é‡æ± ç¬¦å·è§£æžçš„ç±»åŠ è½½å™¨ã€‚ ç±»åŠ è½½å™¨ä¹‹é—´æ˜¯å±‚çº§åŒ–å…³ç³»ï¼Œæ¯ä¸ªç±»åŠ è½½å™¨éƒ½å¯ä»¥å§”æ´¾ç»™ä¸Šä¸€çº§ç±»åŠ è½½å™¨ã€‚è¿™ç§å§”æ´¾å…³ç³»å®šä¹‰äº†äºŒè¿›åˆ¶ç±»çš„æŸ¥æ‰¾é¡ºåºã€‚Java SEç±»åŠ è½½å™¨çš„å±‚çº§æŸ¥æ‰¾é¡ºåºä¸ºå¯åŠ¨ç±»åŠ è½½å™¨ã€æ‰©å±•ç±»åŠ è½½å™¨åŠç³»ç»Ÿç±»åŠ è½½å™¨ã€‚ç³»ç»Ÿç±»åŠ è½½å™¨æ˜¯é»˜è®¤çš„åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå®ƒåŠ è½½Javaç±»çš„mainæ–¹æ³•å¹¶ä»Žclasspathä¸ŠåŠ è½½ç±»ã€‚åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨å¯ä»¥æ˜¯Java SEç³»ç»Ÿè‡ªå¸¦çš„ç±»åŠ è½½å™¨ï¼Œæˆ–è€…ç”±åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›ã€‚æ‰©å±•ç±»åŠ è½½å™¨åˆ™JavaSEç³»ç»Ÿå®žçŽ°ï¼Œå®ƒè´Ÿè´£ä»ŽJRE(Java Runtime Environment,Javaè¿è¡ŒçŽ¯å¢ƒï¼‰çš„lib/extç›®å½•ä¸‹åŠ è½½ç±»ã€‚ å¯åŠ¨ç±»åŠ è½½å™¨å¯åŠ¨ç±»åŠ è½½å™¨æ˜¯ç”±HotSpot VMå®žçŽ°çš„ï¼Œè´Ÿè´£åŠ è½½BOOTCLASSPATHè·¯å¾„ä¸­çš„ç±»ï¼Œå¦‚åŒ…å«Java SEç±»åº“çš„rt.jarã€‚ä¸ºäº†åŠ å¿«å¯åŠ¨é€Ÿåº¦ï¼ŒClientæ¨¡å¼çš„HotSpot VMå¯ä»¥é€šè¿‡ç§°ä¸ºç±»æ•™æ®å…±äº«ï¼ˆClass Data Sharingï¼‰çš„ç‰¹æ€§ä½¿ç”¨å·²ç»é¢„åŠ è½½çš„ç±»ã€‚è¿™ä¸ªç‰¹æ€§é»˜è®¤ä¸ºå¼€å¯ï¼Œå¯ç”±HotSpot VMå‘½ä»¤è¡Œå¼€å…³-Xshare:onå¼€å¯ï¼Œ-Xshare:offå…³é—­ã€‚åˆ°æœ¬ä¹¦ç¼–å†™æ—¶ä¸ºæ­¢ï¼ŒServeræ¨¡å¼çš„HotSpot VMè¿˜ä¸æ”¯æŒç±»æ•°æ®å…±äº«ï¼Œè€Œä¸”å³ä¾¿æ˜¯Clientæ¨¡å¼ï¼Œä¹Ÿåªæœ‰ä½¿ç”¨Serialæ”¶é›†å™¨æ—¶æ‰æ”¯æŒè¯¥æœºåˆ¶ã€‚ ç±»åž‹å®‰å…¨Javaç±»æˆ–æŽ¥å£çš„åå­—ä¸ºå…¨é™å®šåï¼ˆåŒ…æ‹¬åŒ…åï¼‰ã€‚Javaçš„ç±»åž‹ç”±å…¨é™å®šåå’Œç±»åŠ è½½å™¨å”¯ä¸€ç¡®å®šã€‚ HotSpotç±»å…ƒæ•°æ®ç±»åŠ è½½æ—¶ï¼ŒHotSpot VMä¼šåœ¨æ°¸ä¹…ä»£åˆ›å»ºç±»çš„å†…éƒ¨è¡¨ç¤ºinstanceKlassæˆ–arrayKlassã€‚instanceKlassåº”ç”¨äº†ä¸Žä¹‹å¯¹åº”çš„java.lang.Classå®žä¾‹ï¼ŒåŽè€…æ˜¯å‰è€…çš„Javaé•œåƒã€‚HotSpot VMå†…éƒ¨ä½¿ç”¨ç§°ä¸ºklassOopçš„æ•°æ®ç»“æž„è®¿é—®instanceKlassã€‚åŽç¼€â€œOopâ€è¡¨ç¤ºæ™®é€šå¯¹è±¡æŒ‡é’ˆï¼Œæ‰€ä»¥klassOopæ˜¯åº”ç”¨java.lang.Classçš„HotSpotå†…éƒ¨æŠ½è±¡ï¼Œå®ƒæ˜¯æŒ‡å‘Klassï¼ˆä¸ŽJavaç±»å¯¹åº”çš„å†…éƒ¨è¡¨ç¤ºï¼‰çš„æ™®é€šå¯¹è±¡æŒ‡é’ˆã€‚ å†…éƒ¨çš„ç±»åŠ è½½æ•°æ®ç±»åŠ è½½è¿‡ç¨‹ä¸­ï¼ŒHotSpot VMç»´æŠ¤äº†3å¼ æ•£åˆ—è¡¨ã€‚SystemDictionaryåŒ…å«å·²åŠ è½½çš„ç±»ï¼Œå®ƒå°†å»ºç«‹ç±»å/ç±»åŠ è½½å™¨ï¼ˆåŒ…æ‹¬åˆå§‹ç±»åŠ è½½å™¨å’Œå®šä¹‰ç±»åŠ è½½å™¨ï¼‰ä¸ŽklassOopå¯¹è±¡ä¹‹é—´çš„æ˜ å°„ã€‚ç›®å‰åªæœ‰åœ¨å®‰å…¨ç‚¹äº‹æ‰èƒ½ç§»é™¤SystemDictionaryä¸­çš„å…ƒç´ ã€‚Placeholder-TableåŒ…å«å½“å‰æ­£åœ¨åŠ è½½çš„ç±»ï¼Œå®ƒç”¨äºŽæ£€æŸ¥ClassCircularityErrorï¼Œå¤šçº¿ç¨‹ç±»åŠ è½½å™¨å¹¶è¡ŒåŠ è½½ç±»æ—¶ä¹Ÿä¼šç”¨åˆ°å®ƒã€‚LoaderConstraintTableç”¨äºŽè¿½è¸ªç±»åž‹å®‰å…¨æ£€æŸ¥çš„çº¦æŸæ¡ä»¶ã€‚è¿™äº›æ•£åˆ—è¡¨éƒ½éœ€è¦åŠ é”ä¿è¯è®¿é—®å®‰å…¨ï¼Œåœ¨HotSpot VMä¸­ï¼Œè¿™ä¸ªé”ç§°ä¸ºSystemDictionary_lockã€‚é€šå¸¸ï¼ŒHotSpot VMå€ŸåŠ©ç±»åŠ è½½å™¨å¯¹è±¡é”å¯¹åŠ è½½ç±»çš„è¿‡ç¨‹è¿›è¡Œåºåˆ—åŒ–ã€‚ å­—èŠ‚ç éªŒè¯Javaæ˜¯ä¸€é—¨ç±»åž‹å®‰å…¨è¯­è¨€ï¼Œå®˜æ–¹æ ‡å‡†çš„Javaç¼–è¯‘å™¨ï¼ˆjavacï¼‰å¯ä»¥ç”Ÿæˆåˆæ³•çš„ç±»æ–‡ä»¶å’Œç±»åž‹å®‰å…¨çš„å­—èŠ‚ç ï¼Œä½†Javaè™šæ‹Ÿæœºæ— æ³•ç¡®ä¿å­—èŠ‚ç ä¸€å®šæ˜¯ç”±å¯ä¿¡çš„javacç¼–è¯‘å™¨äº§ç”Ÿçš„ï¼Œæ‰€ä»¥åœ¨é“¾æŽ¥æ—¶å¿…é¡»è¿›è¡Œå­—èŠ‚ç éªŒè¯ä»¥ä¿éšœç±»åž‹å®‰å…¨ã€‚ ç±»æ•°æ®å…±äº«ç±»æ•°æ®å…±äº«æ˜¯Java 5å¼•äººçš„ç‰¹æ€§ï¼Œä»¥ç¼©çŸ­Javaç¨‹åºï¼ˆç‰¹åˆ¥æ˜¯å°ç¨‹åºï¼‰çš„å¯åŠ¨æ—¶é—´ï¼ŒåŒæ—¶ä¹Ÿèƒ½å‡å°‘å®ƒä»¬çš„å†…å­˜å ç”¨ã€‚ä½¿ç”¨Java HotSpot JREå®‰è£…ç¨‹åºåœ¨32ä½å¹³å°ä¸Šå®‰è£…Javaè¿è¡ŒçŽ¯å¢ƒï¼ˆJRE)æ—¶ï¼Œå®‰è£…ç¨‹åºä¼šåŠ è½½ç³»ç»Ÿjarä¸­çš„éƒ¨åˆ†ç±»ï¼Œå˜æˆç§æœ‰çš„å†…éƒ¨è¡¨ç¤ºå¹¶è½¬å‚¨æˆæ–‡ä»¶ï¼Œç§°ä¸ºå…±äº«æ–‡æ¡£(Shared Archive)ã€‚å¦‚æžœè¿‡æ²¡æœ‰ä½¿ç”¨Java HotSpot JREå®‰è£…ç¨‹åºï¼Œä¹Ÿå¯ä»¥æ‰‹å·¥ç”Ÿæˆè¯¥æ–‡ä»¶ã€‚ä¹‹åŽè°ƒç”¨Javaè™šæ‹Ÿæœºæ—¶ï¼Œå…±äº«æ–‡æ¡£ä¼šæ˜ å°„åˆ°JVMå†…å­˜ä¸­ï¼Œä»Žè€Œå‡å°‘å‡å°‘åŠ è½½è¿™äº›ç±»çš„å¼€é”€ï¼Œä¹Ÿä½¿å¾—è¿™äº›ç±»çš„å¤§éƒ¨åˆ†JVMå…æ•°æ¤èƒ½åœ¨å¤šä¸ªJVMè¿›ç¨‹é—´å…±äº«ã€‚ è§£é‡Šå™¨HotSpot VMè§£é‡Šå™¨æ˜¯ä¸€ç§åŸºäºŽæ¨¡æ¿çš„è§£é‡Šå™¨ã€‚JVMå¯åŠ¨æ—¶ï¼ŒHotSpot VMè¿è¡Œæ—¶ç³»ç»Ÿåˆ©ç”¨å†…éƒ¨TemplateTableä¸­çš„ä¿¡æ¯åœ¨å†…å­˜ä¸­ç”Ÿæˆè§£æžå™¨ã€‚TemplateTableåŒ…å«äºŽæ¯ä¸ªå­—èŠ‚ç å¯¹åº”çš„æœºå™¨ä»£ç ï¼Œæ¯ä¸ªæ¨¡æ¿æè¿°ä¸€ä¸ªå­—èŠ‚ç ã€‚ HotSpot VMè§£é‡Šå™¨å ªäºŽæ¨¡æ¿çš„è®¾è®¡è¦å¥½äºŽä¼ ç»Ÿçš„switchè¯­å¥å¾ªçŽ¯æ–¹å¼ã€‚switchè¯­å¥éœ€è¦é‡å¤æ‰§è¡Œæ¯”è¾ƒæ“ä½œï¼Œæœ€å·®æƒ…å†µéœ€è¦å’Œæ‰€å†‡å­—èŠ‚ç æ¯”è¾ƒã€‚æ­¤å¤–ï¼Œswitchè¯­å¥å¿…é¡»ä½¿ç”¨å•ç‹¬çš„è½¯ä»¶æ ˆä¼ é€’ Java å‚æ•°ã€‚HotSpot VMä½¿ç”¨æœ¬åœ°Cæ ˆä¼ é€’ Java å‚æ•°ã€‚ä¸€äº›å­˜å‚¨åœ¨Cå˜é‡ä¸­çš„HotSpot VMå†…éƒ¨å˜é‡ï¼Œä¾‹å¦‚Javaçº¿ç¨‹çš„ç¨‹åºè®¡æ•°å™¨æˆ–æ ˆæŒ‡é’ˆï¼Œå¹¶ä¸èƒ½ä¿è¯æ€»æ˜¯å­˜å‚¨åœ¨åº•å±‚ç¡¬ä»¶å¯„å­˜å™¨ä¸­ã€‚ç»“æžœï¼Œç®¡ç†è¿™äº›è½¯ä»¶è§£é‡Šå™¨æ•°æ®ç»“æž„å°±ä¼šå åŽ»æ€»æ‰§è¡Œæ—¶é—´çš„ç›¸å½“å¤§ä¸€éƒ¨åˆ†ã€‚ä¸è¿‡æ€»ä½“æ¥è¯´ï¼ŒHotSpotè§£é‡Šå™¨æ˜¾è‘—ç¼©çŸ­HotSpot VMå’Œå®žä½“æœºä¹‹é—´çš„æ€§èƒ½å·®è·ï¼Œè§£é‡Šé€Ÿåº¦ä¹Ÿæ˜Žæ˜¾å˜å¿«äº†ï¼Œç„¶è€Œä»£ä»·æ˜¯å¤§é‡ä¸Žæœºå™¨ç›¸å…³çš„ä»£ç ã€‚ä¾‹å¦‚ï¼ŒIntel X86å¹³å°ç‰¹å®šçš„ä»£ç å¤§çº¦æœ‰10000è¡Œï¼ŒSPARCå¹³å°ä¸“ç”¨çš„ä»£ç å¤§çº¦æ‰“14000è¡Œã€‚ç”±äºŽéœ€è¦æ”¯æŒåŠ¨æ€ä»£ç ç”Ÿæˆï¼ˆJITç¼–è¯‘ï¼‰ï¼Œæ•´ä½“çš„ä»£ç é‡å’Œå¤æ‚åº¦ä¹Ÿæ˜¾è‘—å˜å¤§ã€‚å¹¶ä¸”è°ƒ è¯•åŠ¨æ€ç”Ÿæˆçš„æœºå™¨ç ï¼ˆ JITç¼–è¯‘ä»£ç ï¼‰æ¯”è°ƒè¯•é™æ€ä»£ç å›°éš¾å¤šäº†ã€‚è™½ç„¶è¿™äº›ä¸åˆ©äºŽè¿è¡Œæ—¶ç³»ç»Ÿçš„æ”¹å–„ï¼Œä½†ä¹Ÿå¹¶éžä¸å¯èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚ å¼‚å¸¸å¤„ç†å½“ä¸ŽJavaçš„è¯­ä¹‰çº¦æŸå†²çªæ—¶ï¼ŒJavaè™šæ‹Ÿæœºä¼šç”¨å¼‚å¸¸é€šçŸ¥ç¨‹åºã€‚å¼‚å¸¸å¤„ç†ç”±HotSpot VMè§£é‡Šå™¨ã€JITç¼–è¯‘å™¨å’Œå…¶ä»–HotSpot VMç»„ä»¶ä¸€èµ·åä½œå®žçŽ°ã€‚å¼‚å¸¸å¤„ç†ä¸»è¦æœ‰ä¸¤ç§æƒ…å½¢ï¼ŒåŒä¸€æ–¹æ³•ä¸­æŠ›å‡ºå’Œæ•èŽ·å¼‚å¸¸ï¼Œæˆ–ç”±è°ƒç”¨æ–¹æ³•æ•èŽ·å¼‚å¸¸ã€‚å¼‚å¸¸å¯ä»¥ç”±æŠ›å‡ºå­—èŠ‚ç ã€VMå†…éƒ¨è°ƒç”¨è¿”å›žã€JNIè°ƒç”¨è¿”å›žæˆ–Javaè°ƒç”¨è¿”å›žæ‰€å¼•å‘ã€‚ çº¿ç¨‹ç®¡ç†HotSpot VMé€šè¿‡åä½œã€è½®è¯¢çš„æœºåˆ¶åˆ›å»ºå®‰å…¨ç‚¹ã€‚ç®€ä¸­æ¥è¯´ï¼Œçº¿ç¨‹ä¼šç»å¸¸è¯¢é—®ï¼šâ€œæˆ‘è¯¥åœ¨å®‰å…¨ç‚¹åœä½ä¹ˆï¼Ÿ â€é«˜æ•ˆåœ°è¯¢é—®è¿™ä¸ªé—®é¢˜å¹¶ä¸æ˜¯ä»¶å®¹æ˜“çš„äº‹ã€‚çº¿ç¨‹åœ¨çŠ¶æ€å˜è¿çš„è¿‡ç¨‹ä¸­ï¼Œä¼šç»å¸¸è¯¢é—®è¿™ä¸ªé—®é¢˜ï¼Œä½†å¹¶éžæ‰€æœ‰çš„çŠ¶æ€å˜è¿éƒ½ä¼šå¦‚æ­¤è¯¢é—®ï¼Œæ¯”å¦‚çº¿ç¨‹ç¦»å¼€HotSpot VMè¿›å…¥æœ¬åœ°ä»£ç çš„æƒ…å†µã€‚æ­¤å¤–ï¼ŒJITç¼–è¯‘ä»£ç ä»Žjavaæ–¹æ³•ä¸­è¿”å›žæˆ–æ­£ä½œå¾ªçŽ¯è¿­ä»£çš„æŸä¸ªé˜¶æ®µæ—¶ï¼Œçº¿ç¨‹ä¹Ÿä¼šè¯¢é—®â€œæˆ‘è¯¥åœ¨å®‰å…¨ç‚¹åœä½å—ï¼Ÿ â€ã€‚æ­£åœ¨æ‰§è¡Œè§£é‡Šä»£ç çš„çº¿ç¨‹é€šå¸¸ä¸ä¼šè¯¢é—®å®ƒä»¬æ˜¯å¦è¯¥åœ¨å®‰å…¨ç‚¹åœä½ã€‚ç›¸åï¼Œå½“è§£é‡Šå™¨åˆ‡æ¢åˆ°ä¸åŒçš„åˆ†é…è¡¨æ—¶ï¼Œä¼šè¯·æ±‚å®‰å…¨ç‚¹ã€‚åˆ‡æ¢æ“ä½œä¸­åŒ…å«ä¸€éƒ¨åˆ†ä»£ç ï¼Œç”¨ä»¥è¯¢é—®ä½•æ—¶ç¦»å¼€å®‰å…¨ç‚¹ã€‚å½“ç¦»å¼€å®‰å…¨ç‚¹æ—¶ï¼Œåˆ†é…è¡¨ä¼šå†æ¬¡åˆ‡æ¢å›žæ¥ã€‚ä¸€æ—¦è¯·æ±‚äº†å®‰å…¨ç‚¹ï¼ŒVMThreadå°±å¿…é¡»åœ¨ç»§ç»­æ‰§è¡ŒVMæ“ä½œå‰ç­‰å¾…ï¼Œç›´åˆ°ç¡®å®šæ‰€è¡Œçº¿ç¨‹éƒ½å·²è¿›å…¥å®‰å…¨ç‚¹ä¿å…¨çŠ¶æ€ä¸ºæ­¢ã€‚åœ¨å®‰å…¨ç‚¹æ—¶ï¼ŒVMThreadç”¨Threads_locké˜»å¡žæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼ŒVMæ“ä½œå®ŒæˆåŽ , VMThreadé‡Šæ”¾Threads_lockã€‚ Javaæœ¬åœ°æŽ¥å£ï¼ˆJNIï¼‰åˆ‡è®°ï¼Œä¸€æ—¦åœ¨åº”ç”¨ä¸­ä½¿ç”¨JNIï¼Œå°±æ„å‘³ç€ä¸§å¤±äº†Javaå¹³å°çš„ä¸¤ä¸ªå¥½å¤„ã€‚é¦–å…ˆï¼Œä¾èµ–JNIçš„Javaåº”ç”¨éš¾ä»¥åœ¨å¤šç§å¼‚æž„çš„ç¡¬ä»¶å¹³å°ä¸Šè¿è¡Œã€‚å³ä¾¿åº”ç”¨ä¸­Javaè¯­è¨€ç¼–å†™çš„éƒ¨åˆ†å¯ä»¥ç§»æ¤åˆ°å¤šç§ç¡¬ä»¶å¹³å°ï¼Œé‡‡ç”¨æœ¬åœ°ç¼–ç¨‹è¯­è¨€çš„éƒ¨åˆ†ä¹Ÿéœ€è¦é‡æ–°ç¼–è¯‘ã€‚æ¢å¥è¯è¯´ï¼Œä¸€æ—¦ä½¿ç”¨JNIå°±å¤±åŽ»äº†Javaæ‰¿è¯ºçš„ç‰¹æ€§ï¼Œå³â€œä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œâ€ã€‚å…¶æ¬¡ï¼ŒJavaæ˜¯å¼ºç±»åž‹å’Œå®‰å…¨çš„è¯­è¨€,æœ¬åœ°è¯­è¨€å¦‚Cæˆ–C++åˆ™ä¸æ˜¯ã€‚å› æ­¤ï¼ŒJavaå¼€å‘è€…ç”¨JNIç¼–å†™åº”ç”¨æ—¶å¿…é¡»æ ¼å¤–å°å¿ƒã€‚è¯¯ç”¨æœ¬åœ°æ–¹æ³•å¯èƒ½ç ´åæ•´ä¸ªåº”ç”¨ã€‚é‰´äºŽæ­¤ï¼Œåœ¨è°ƒJNIæ–¹æ³•å‰ï¼ŒJavaåº”ç”¨å¸¸å¸¸éœ€è¦å®‰ä»æ£€æŸ¥ã€‚é¢å¤–çš„å®‰å…¨æ£€æŸ¥ä»¥åŠHotSpot VMåœ¨Javaä¸ŽJNIä¹‹é—´çš„æ•°æ®å¤åˆ¶ä¼šé™ä½Žåº”ç”¨çš„æ€§èƒ½ã€‚ HotSpot VMè¿½è¸ªæ­£åœ¨æ‰§è¡Œæœ¬åœ°æ–¹æ³•çš„çº¿ç¨‹æ—¶å¿…é¡»ç‰¹åˆ¥å°å¿ƒã€‚åœ¨HotSpot VMçš„æŸäº›æ´»åŠ¨è¿‡ç¨‹ä¸­ï¼Œå°¤å…¶æ˜¯åžƒåœ¾æ”¶é›†çš„æŸäº›é˜¶æ®µï¼Œçº¿ç¨‹å¿…é¡»åœ¨å®‰å…¨ç‚¹æ—¶æš‚åœï¼Œä»¥ä¿è¯Javaå†…å­˜å †ä¸è¢«æ›´æ”¹ï¼Œç¡®ä¿åžƒåœ¾æ”¶é›†çš„å‡†ç¡®æ€§ã€‚å½“HotSpot VMçº¿ç¨‹æ‰§è¡Œæœ¬åœ°ä»£ç åˆ°è¾¾å®‰å…¨ç‚¹æ—¶ï¼Œçº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œæœ¬åœ°ä»£ç ï¼Œç›´åˆ°å®ƒJavaä»£ç æˆ–è€…å‘èµ·JNIè°ƒç”¨ä¸ºæ­¢ã€‚ VMè‡´å‘½é”™è¯¯å¤„ç†HotSpotå†…éƒ¨ä½¿ç”¨ä¿¡å·è¿›è¡Œé€šä¿¡ã€‚å½“æ— æ³•è¯†åˆ«ä¿¡å·æ—¶ï¼Œå°†è°ƒç”¨è‡´å‘½é”™è¯¯å¤„ç†ç¨‹åºã€‚åœ¨æ— æ³•è¯†åˆ«çš„æƒ…å†µä¸‹ï¼Œå®ƒå¯èƒ½æ¥è‡ªåº”ç”¨ç¨‹åºJNIä»£ç ï¼ŒOSæœ¬åœ°åº“ï¼ŒJREæœ¬åœ°åº“æˆ–JVMæœ¬èº«çš„é”™è¯¯ã€‚ HotSpot VMåžƒåœ¾æ”¶é›†å™¨åˆ†ä»£åžƒåœ¾æ”¶é›†åžƒåœ¾æ”¶é›†å™¨ä¸éœ€è¦æ‰«ææ•´ä¸ªï¼ˆå¯èƒ½æ¯”æ–°ç”Ÿä»£æ›´å¤§ï¼‰è€å¹´ä»£å°±èƒ½è¯†åˆ«æ–°ç”Ÿä»£ä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œä»Žè€Œç¼©çŸ­Minor GCçš„æ—¶é—´ã€‚HotSpot VMçš„åžƒåœ¾æ”¶é›†å™¨ä½¿ç”¨ç§°ä¸ºå¡è¡¨ï¼ˆCardTable)çš„æ•°æ®ç»“æž„æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚è€å¹´ä»£ä»¥512å­—èŠ‚ä¸ºå—åˆ’åˆ†æˆè‹¥åå¼ å¡ï¼ˆCard)ã€‚å¡è¡¨æ˜¯ä¸ªå•å­—èŠ‚æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ å¯¹åº”å †ä¸­çš„ä¸€å¼ å¡ã€‚æ¯æ¬¡è€å¹´ä»£å¯¹è±¡ä¸­æŸä¸ªå¼•ç”¨æ–°ç”Ÿä»£çš„å­—æ®µå‘ç”Ÿå˜åŒ–æ—¶ï¼ŒHotSpot VMå°±å¿…é¡»å°†è¯¥å¡æ‰€å¯¹ä½çš„å¡è¡¨å…ƒç´ è®¾ç½®ä¸ºé€‚å½“çš„å€¼ï¼Œä»Žè€Œå°†è¯¥å¼•ç”¨å­—æ®µæ‰€åœ¨çš„å¡æ ‡è®°ä¸ºè„ã€‚åœ¨Minor GCè¿‡ç¨‹ä¸­ï¼Œåžƒåœ¾æ”¶é›†å™¨åªä¼šåœ¨è„å¡ä¸­æ‰«ææŸ¥æ‰¾è€å¹´ä»£-æ–°ç”Ÿä»£å¼•ç”¨ã€‚ HotSpot VMçš„å­—èŠ‚ç è§£é‡Šå™¨å’ŒJITç¼–è¯‘å™¨ä½¿ç”¨å†™å±éšœ(Write Barrier)ç»´æŠ¤å¡è¡¨ã€‚å†™å±éšœæ˜¯ä¸€å°æ®µå°†å¡çŠ¶æ€è®¾ç½ä¸ºè„çš„ä»£ç ã€‚è§£é‡Šå™¨æ¯æ¬¡æ‰§è¡Œæ›´æ–°å¼•ç”¨çš„å­—èŠ‚ç æ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€æ®µå†™å±éšœï¼›JIT ç¼–è¯‘å™¨åœ¨ç”Ÿæˆæ›´æ–°å¼•ç”¨çš„ä»£ç åŽï¼Œä¹Ÿä¼šç”Ÿæˆä¸€æ®µå†™å±éšœã€‚è™½ç„¶å†™å±éšœä½¿å¾—åº”ç”¨çº¿ç¨‹å¢žåŠ äº†ä¸€äº›æ€§èƒ½å¼€é”€ï¼Œä½†Minor GCå˜å¿«äº†è®¸å¤šï¼Œæ•´å¤©çš„åžƒåœ¾æ”¶é›†æ•ˆçŽ‡ä¹Ÿæé«˜äº†è®¸å¤šã€‚é€šå¸¸åº”ç”¨çš„åžåé‡ä¹Ÿä¼šæœ‰æ‰€æ”¹å–„ã€‚ æ–°ç”Ÿä»£éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œåœ¨Minor GCè¿‡ç¨‹ä¸­ï¼ŒSurvivorå¯èƒ½ä¸è¶³ä»¥å®¹çº³Edenå’Œå¦ä¸€ä¸ªSurvivorä¸­çš„å­˜æ´»å¯¹è±¡ã€‚å¦‚æžœSurvivor ä¸­çš„å­˜æ´»å¯¹è±¡æº¢å‡ºï¼Œå¤šä½™çš„å¯¹è±¡å°†è¢«ç§»åˆ°è€å¹´ä»£ã€‚è¿™ç§°ä¸ºè¿‡æ—©æå‡(Premature Promotion)ã€‚è¿™ä¼šå¯¼è‡´è€å¹´ä»£ä¸­çŸ­æœŸå­˜æ´»å¯¹è±¡çš„å¢žé•¿ï¼Œå¯èƒ½ä¼šå¼•å‘ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚å†è¿›ä¸€æ­¥è¯´ï¼Œåœ¨Minor GCè¿‡ç¨‹ä¸­ï¼Œå¦‚æžœè€å¹´ä»£æ»¡äº†è€Œæ— æ³•å®¹çº³æ›´å¤šçš„å¯¹è±¡ï¼ŒMinor GCä¹‹åŽé€šå¸¸å°±ä¼šè¿›è¡ŒFull GC,è¿™å°†å¯¼è‡´éåŽ†æ•´ä¸ªJavaå †ã€‚è¿™ç§°ä¸ºæå‡å¤±è´¥ï¼ˆPromotion Failureï¼‰ã€‚ å¿«é€Ÿå†…å­˜åˆ†é…å¯¹è±¡å†…å­˜åˆ†é…å™¨çš„æ“ä½œéœ€è¦å’Œåžƒåœ¾æ”¶é›†å™¨ç´§å¯†é…åˆã€‚åžƒåœ¾æ”¶é›†å™¨å¿…é¡»è®°å½•å®ƒå†‹æ”¶çš„ç©ºé—´ï¼Œè€Œåˆ†é…å™¨åœ¨é‡ç”¨å †ç©ºé—´ä¹‹å‰éœ€è¦æ‰¾åˆ°å¯ä»¥æ»¡è¶³å…¶åˆ†é…éœ€æ±‚çš„ç©ºé—²ç©ºé—´ã€‚åžƒåœ¾æ”¶é›†å™¨ä»¥å¤åˆ¶æ–¹å¼å›žæ”¶HotSpot VMæ–°ç”Ÿä»£ï¼Œå…¶å¥½å¤„åœ¨äºŽå›žæ”¶ä»¥åŽEdenæ€»ä¸ºç©ºï¼Œåœ¨Edenä¸­è¿ç”¨è¢«ç§°ä¸ºæŒ‡è®¡ç¢°æ’ž(Bump-the-Pointer)çš„æŠ€æœ¯å°±å¯ä»¥æœ‰æ•ˆåœ°åˆ†é…ç©ºé—´ã€‚è¿™ç§æŠ€æœ¯è¿½è¸ªæœ€åŽä¸€ä¸ªåˆ†é…çš„å¯¹è±¡ï¼ˆå¸¸ç§°ä¸ºtop),å½“æœ‰æ–°çš„åˆ†é…è¯·æ±‚æ—¶ï¼Œåˆ†é…å™¨åªéœ€è¦æ£€æŸ¥topå’Œedenæœªç«¯ä¹‹é—´çš„ç©ºé—´æ˜¯å¦èƒ½å®¹çº³ã€‚å¦‚æžœèƒ½å®¹çº³ï¼Œtopåˆ™è·³åˆ°æ–°è¿‘åˆ†é…å¯¹è±¡çš„æœªç«¯ã€‚ é‡è¦çš„Javaåº”ç”¨å¤§å¤šæ˜¯å¤šçº¿ç¨‹çš„ï¼Œå› æ­¤å†…å­˜åˆ†é…çš„æ“ä½œéœ€è¦è€ƒè™‘å¤šçº¿ç¨‹å®‰å…¨ã€‚å¦‚æžœåªç”¨å…¨å±€é”ï¼Œåœ¨Edenä¸­çš„åˆ†é…æ“ä½œå°±ä¼šæˆä¸ºç“¶é¢ˆè€Œé™ä½Žæ€§èƒ½ã€‚HotSpot VMæ²¡æœ‰é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œè€Œæ˜¯ä»¥ä¸€ç§ç§°ä¸ºçº¿ç¨‹æœ¬åœ°åˆ†é…ç¼“å†²åŒºï¼ˆthread-Local Allocation Buffer,TLAB)çš„æŠ€æœ¯ï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹è®¾è®¾ç½®å„è‡ªçš„ç¼“å†²åŒº(å³Edençš„ä¸€å°å—ï¼‰ï¼Œä»¥æ­¤æ”¹å–„å¤šçº¿ç¨‹åˆ†é…çš„åžåé‡ã€‚å› ä¸ºæ¯ä¸ªTLABéƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä»Žä¸­åˆ†é…å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æŒ‡é’ˆç¢°æ’žæŠ€æœ¯å¿«é€Ÿåˆ†é…è€Œä¸éœ€è¦ä»»ä½•é”ã€‚ç„¶è€Œå½“çº¿ç¨‹çš„TLABå¡«æ»¡éœ€è¦èŽ·å–æ–°çš„ç©ºé—´æ—¶ï¼ˆä¸å¸¸è§ï¼‰ï¼Œå®ƒå°±éœ€è¦é‡‡ç”¨å¤šçº¿ç¨‹å®‰å…¨çš„æ–¹å¼äº†ã€‚å¤§éƒ¨åˆ†æ—¶å€™ï¼ŒHotSpot VMçš„new Object()æ“ä½œåªéœ€è¦å¤§çº¦åæ¡æŒ‡ä»¤ã€‚åžƒåœ¾æ”¶é›†å™¨æ¸…ç©ºEdenåŒºåŸŸï¼Œç„¶åŽå°±å¯ä»¥æ”¯æŒå¿«é€Ÿå†…å­˜åˆ†é…äº†ã€‚ HotSpot VM JITç¼–è¯‘å™¨ç»å…¸çš„å¯„å­˜å™¨åˆ†é…ç­–ç•¥æ˜¯å›¾ç€è‰²ç®—æ³•ï¼Œé€šå¸¸å¯ä»¥ä½¿æœºå™¨å¯„å­˜å™¨çš„ä½¿ç”¨çŽ‡è¾¾åˆ°æœ€é«˜ï¼Œè€Œä¸”å¤šä½™çš„å€¼å¾ˆå°‘ä¼šå¸è½½åˆ°æ ˆä¸­ã€‚å›¾è¡¨ç¤ºçš„æ˜¯åŒæ—¶æœ‰å“ªäº›å˜é‡åœ¨ä½¿ç”¨ï¼Žä»¥åŠå“ªäº›å¯„å­˜å™¨å¯ä»¥å­˜æ”¾è¿™äº›å˜è™½ã€‚å¦‚æžœåŒæ—¶å­˜æ´»çš„å˜é‡æ•°è¶…è¿‡äº†å¯ç”¨çš„å¯„å­˜å™¨æ•°ï¼Œé‡è¦æ€§æœ€ä½Žçš„å˜é‡å°†è¢«ç§»åˆ°æ ˆä¸­ï¼Œä½¿å¾—å…¶ä»–å˜é‡å¯ä»¥ä½¿ç”¨å¯„å­˜å™¨ã€‚æŒ‡æ´¾æŸä¸ªå˜é‡ç»™å¯„å­˜å™¨é€šå¸¸éœ€è¦æ¥å›žå‡ æ¬¡æž„å»ºå›¾å’Œç€è‰²ã€‚è¿™ä¹Ÿå¯¼è‡´äº†å®ƒçš„ä¸è¶³ï¼Œå›¾ç€è‰²ç®—æ³•èŠ±è´¹çš„æ—¶é—´ã€æ•°æ®ç»“æž„æ‰€éœ€çš„ç©ºé—´éƒ½æ¯”è¾ƒæ˜‚è´µã€‚ JVMæ€§èƒ½ç›‘æŽ§åžƒåœ¾æ”¶é›†é‡è¦çš„åžƒåœ¾æ”¶é›†æ•°æ®é‡è¦çš„åžƒåœ¾æ”¶é›†æ•°æ®åŒ…æ‹¬ï¼š å½“å‰ä½¿ç”¨çš„åžƒåœ¾æ”¶é›†å™¨ Javaå †çš„å¤§å° æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„å¤§å° æ°¸ä¹…ä»£çš„å¤§å° Minor GCçš„æŒç»­æ—¶é—´ Minor GCçš„é¢‘çŽ‡ Minor GCçš„ç©ºé—´å›žæ”¶é‡ Full GCçš„æŒç»­æ—¶é—´ Full GCçš„é¢‘çŽ‡ æ¯ä¸ªå¹¶å‘åžƒåœ¾æ”¶é›†å‘¨æœŸå†…çš„ç©ºé—´å›žæ”¶é‡ åžƒåœ¾æ”¶é›†å‰åŽJavaå †çš„å ç”¨é‡ åžƒåœ¾æ”¶é›†å‰åŽæ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„å ç”¨é‡ åžƒåœ¾æ”¶é›†å‰åŽæ°¸ä¹…ä»£çš„å ç”¨é‡ æ˜¯å¦è€å¹´ä»£æˆ–æ°¸ä¹…ä»£çš„å ç”¨è§¦å‘äº† Full GC åº”ç”¨æ˜¯å¦æ˜¾å¼è°ƒç”¨äº† System.gc() åžƒåœ¾å›žæ”¶æŠ¥å‘ŠJITç¼–è¯‘å™¨å¯ä»¥ä½¿ç”¨-XX:+PrintCompilationç›‘æŽ§HotSpot JITç¼–è¯‘å™¨ã€‚-XX:+PrintCompilationä¸ºæ¯æ¬¡ç¼–è¯‘ç”Ÿæˆä¸€è¡Œæ—¥å¿—ã€‚ æ—¥å¿—æ ·ä¾‹å¦‚ä¸‹: 123456787 java. lang String: indexOf (151 bytes)8% ! sun. awt. image. PNGImageDecoder: produceImage a 960 (1920 bytes)9 ! sun awt. image. PNGImageDecoder: produceImage (1920 bytes)10 java. lang. AbstractStringBuilder: append(40 bytes)11 n java. lang System: arraycopy (static)12 s java util. Hashtable: get (69 bytes)13 b java util. HashMap: indexFor (6 bytes)14 made zombie java. awt. geom. Path2DSIterator: isDone (20 bytes) JVMæ€§èƒ½è°ƒä¼˜å…¥é—¨åº”ç”¨ç¨‹åºçš„ç³»ç»Ÿéœ€æ±‚åžåé‡åžåé‡æ˜¯å¯¹å•ä½æ—¶é—´å†…å¤„ç†å·¥ä½œé‡çš„åº¦é‡ã€‚è®¾è®¡åžåé‡éœ€æ±‚æ—¶,æˆ‘ä»¬ä¸€èˆ¬ä¸è€ƒè™‘å®ƒå¯¹å»¶è¿Ÿæˆ–è€…å“åº”æ—¶é—´çš„å½±å“ã€‚é€šå¸¸æƒ…å†µä¸‹,å¢žåŠ åžåé‡çš„ä»£ä»·æ˜¯å»¶è¿Ÿçš„å¢žåŠ æˆ–å†…å­˜ä½¿ç”¨çš„å¢žåŠ ã€‚ åžåé‡æ€§èƒ½éœ€æ±‚çš„ä¸€ä¸ªå…¸åž‹ä¾‹å­æ˜¯,åº”ç”¨ç¨‹åºæ¯ç§’éœ€è¦å®Œæˆ2500æ¬¡äº‹åŠ¡ã€‚ å»¶è¿Ÿæˆ–å“åº”æ€§å»¶è¿Ÿ,æˆ–è€…å“åº”æ€§,æ˜¯å¯¹åº”ç”¨ç¨‹åºæ”¶åˆ°æŒ‡ä»¤å¼€å§‹å·¥ä½œç›´åˆ°å®Œæˆè¯¥å·¥ä½œæ‰€æ¶ˆè€—æ—¶é—´çš„åº¦é‡ã€‚ å®šä¹‰å»¶è¿Ÿæˆ–å“åº”æ€§éœ€æ±‚æ—¶å¹¶ä¸è€ƒè™‘ç¨‹åºçš„åžåé‡ã€‚é€šå¸¸æƒ…å†µä¸‹,æé«˜å“åº”æ€§æˆ–ç¼©å°å»¶è¿Ÿçš„ä»£ä»·æ˜¯æ›´ä½Žçš„åžåé‡ã€æˆ–è€…æ›´å¤šçš„å†…å­˜æ¶ˆè€—(æˆ–è€…äºŒè€…åŒæ—¶å‘ç”Ÿ) å»¶è¿Ÿæˆ–å“åº”éœ€æ±‚çš„ä¸€ä¸ªå…¸åž‹ä¾‹å­æ˜¯,åº”ç”¨ç¨‹åºåº”è¯¥åœ¨60æ¯«ç§’å†…å®Œæˆäº¤æ˜“è¯·æ±‚çš„å¤„ç†å·¥ä½œã€‚ å†…å­˜å ç”¨å†…å­˜å ç”¨æŒ‡åœ¨åŒç­‰ç¨‹åº¦çš„åžåé‡ã€å»¶è¿Ÿã€å¯ç”¨æ€§å’Œå¯ç®¡ç†æ€§å‰æä¸‹,è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„å†…å­˜å¤§å°ã€‚å†…å­˜å ç”¨é€šå¸¸ä»¥è¿è¡Œåº”ç”¨ç¨‹åºéœ€è¦çš„Javaå †å¤§å°æˆ–è€…è¿è¡Œåº”ç”¨ç¨‹åºéœ€è¦çš„æ€»å†…å­˜å¤§å°æ¥è¡¨è¿°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹,é€šè¿‡å¢žå¤§Javaå †çš„æ–¹å¼å¢žåŠ å¯ç”¨å†…å­˜èƒ½å¤Ÿæé«˜åžåé‡ã€é™ä½Žå»¶è¿Ÿæˆ–è€…å…¼é¡¾äºŒè€…ã€‚åº”ç”¨ç¨‹åºçš„å¯ç”¨å†…å­˜å‡å°‘æ—¶,åžåé‡å’Œå»¶è¿Ÿé€šå¸¸éƒ½ä¼šå—åˆ°å½±å“ã€‚åº”ç”¨ç¨‹åºçš„å†…å­˜å ç”¨é™åˆ¶äº†å›ºå®šå†…å­˜çš„æœºå™¨ä¸Šèƒ½åŒæ—¶è¿è¡Œçš„åº”ç”¨ç¨‹åºå®žä¾‹æ•°ã€‚ å†…å­˜å ç”¨éœ€æ±‚çš„ä¸€ä¸ªå…¸åž‹ä¾‹å­æ˜¯,åº”ç”¨ç¨‹åºéœ€è¦åœ¨æ‹¥æœ‰8GBå†…å­˜çš„ç³»ç»Ÿä¸Šä»¥å•ä¸ªå®žä¾‹æ–¹å¼è¿è¡Œæˆ–è€…åœ¨24GBå†…å­˜çš„ç³»ç»Ÿä¸Šä»¥3ä¸ªåº”ç”¨ç¨‹åºå®žä¾‹æ–¹å¼è¿è¡Œã€‚ æ€§èƒ½æ”¶é›†è°ƒä¼˜åŸºç¡€æ€§èƒ½å±žæ€§ åžåé‡:æ˜¯è¯„ä»·åžƒåœ¾æ”¶é›†å™¨èƒ½åŠ›çš„é‡è¦æŒ‡æ ‡ä¹‹ä¸€,æŒ‡ä¸è€ƒè™‘åžƒåœ¾æ”¶é›†å¼•èµ·çš„åœé¡¿æ—¶é—´æˆ–å†…å­˜æ¶ˆè€—,åžƒåœ¾æ”¶é›†å™¨èƒ½æ”¯æ’‘åº”ç”¨ç¨‹åºè¾¾åˆ°çš„æœ€é«˜æ€§èƒ½æŒ‡æ ‡ã€‚ å»¶è¿Ÿ:ä¹Ÿæ˜¯è¯„ä»·åžƒåœ¾æ”¶é›†å™¨èƒ½åŠ›çš„é‡è¦æŒ‡æ ‡,åº¦é‡æ ‡å‡†æ˜¯ç¼©çŸ­ç”±äºŽåžƒåœ¾æ”¶é›†å¼•èµ·çš„åœé¡¿æ—¶é—´æˆ–å®Œå…¨æ¶ˆé™¤å› åžƒåœ¾æ”¶é›†æ‰€å¼•èµ·çš„åœé¡¿,é¿å…åº”ç”¨ç¨‹åºè¿è¡Œæ—¶å‘ç”ŸæŠ–åŠ¨ã€‚ å†…å­˜å ç”¨:åžƒåœ¾æ”¶é›†å™¨æµç•…è¿è¡Œæ‰€éœ€è¦çš„å†…å­˜æ•°é‡ã€‚ è¿™å…¶ä¸­ä»»ä½•ä¸€ä¸ªå±žæ€§æ€§èƒ½çš„æé«˜å‡ ä¹Žéƒ½æ˜¯ä»¥å¦ä¸€ä¸ªæˆ–ä¸¤ä¸ªå±žæ€§æ€§èƒ½çš„æŸå¤±ä½œä»£ä»·çš„ã€‚æ¢å¥è¯è¯´,æŸä¸€ä¸ªå±žæ€§ä¸Šçš„æ€§èƒ½æé«˜æ€»ä¼šç‰ºç‰²å¦ä¸€ä¸ªæˆ–ä¸¤ä¸ªå±žæ€§ã€‚ç„¶è€Œ,å¯¹å¤§å¤šæ•°çš„åº”ç”¨è€Œè¨€,æžå°‘å‡ºçŽ°è¿™ä¸‰ä¸ªå±žæ€§çš„é‡è¦ç¨‹åº¦éƒ½åŒç­‰çš„æƒ…å†µã€‚å¾ˆå¤šæ—¶å€™,æŸä¸€ä¸ªæˆ–ä¸¤ä¸ªå±žæ€§çš„æ€§èƒ½è¦æ¯”å¦ä¸€ä¸ªé‡è¦ã€‚ æˆ‘ä»¬éœ€è¦äº†è§£å¯¹åº”ç”¨ç¨‹åºè€Œè¨€å“ªäº›ç³»ç»Ÿéœ€æ±‚æ˜¯æœ€é‡è¦çš„,ä¹Ÿéœ€è¦çŸ¥é“å¯¹åº”ç”¨ç¨‹åºè€Œè¨€è¿™ä¸‰ä¸ªæ€§èƒ½å±žæ€§å“ªäº›æ˜¯æœ€é‡è¦çš„ã€‚ç¡®å®šå“ªäº›å±žæ€§æœ€é‡è¦,å¹¶å°†å…¶æ˜ å°„åˆ°åº”ç”¨ç¨‹åºçš„ç³»ç»Ÿéœ€æ±‚,å¯¹åº”ç”¨ç¨‹åºè€Œè¨€éžå¸¸é‡è¦ã€‚ åŽŸåˆ™è°ˆåˆ°JVMåžƒåœ¾æ”¶é›†å™¨è°ƒä¼˜ä¹Ÿæœ‰ä¸‰ä¸ªéœ€è¦ç†è§£çš„åŸºæœ¬åŽŸåˆ™ã€‚ æ¯æ¬¡Minor GCéƒ½å°½å¯èƒ½å¤šåœ°æ”¶é›†åžƒåœ¾å¯¹è±¡ã€‚æˆ‘ä»¬æŠŠè¿™ç§°ä½œâ€œMinor GCå›žæ”¶åŽŸåˆ™â€ã€‚éµå®ˆè¿™åŽŸåˆ™å¯ä»¥å‡å°‘åº”ç”¨ç¨‹åºå‘ç”Ÿ Full GCçš„é¢‘çŽ‡ã€‚Full GCçš„æŒç»­æ—¶é—´æ€»æ˜¯æœ€é•¿çš„,æ˜¯åº”ç”¨ç¨‹åºæ— æ³•è¾¾åˆ°å…¶å»¶è¿Ÿæˆ–åžåé‡è¦æ±‚çš„ç½ªé­ç¥¸é¦–ã€‚ å¤„ç†åžåé‡å’Œå»¶è¿Ÿé—®é¢˜æ—¶,åžƒåœ¾å¤„ç†å™¨èƒ½ä½¿ç”¨çš„å†…å­˜è¶Šå¤§,å³Javaå †ç©ºé—´è¶Šå¤§,åžƒåœ¾æ”¶é›†çš„æ•ˆæžœè¶Šå¥½,åº”ç”¨ç¨‹åºè¿è¡Œä¹Ÿè¶Šæµç•…ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œGCå†…å­˜æœ€å¤§åŒ–åŽŸåˆ™â€ã€‚ åœ¨è¿™ä¸‰ä¸ªæ€§èƒ½å±žæ€§(åžåé‡ã€å»¶è¿Ÿã€å†…å­˜å ç”¨)ä¸­ä»»æ„é€‰æ‹©ä¸¤ä¸ªè¿›è¡ŒJVMåžƒåœ¾æ”¶é›†å™¨è°ƒä¼˜ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œGCè°ƒä¼˜çš„3é€‰2åŽŸåˆ™â€ã€‚ è°ƒä¼˜JVMåžƒåœ¾æ”¶é›†çš„è¿‡ç¨‹ä¸­è°¨è®°è¿™ä¸‰æ¡åŽŸåˆ™èƒ½å¸®åŠ©ä½ æ›´è½»æ¾åœ°è°ƒä¼˜åžƒåœ¾æ”¶é›†,è¾¾åˆ°åº”ç”¨ç¨‹åºçš„æ€§èƒ½è¦æ±‚ã€‚ ç¡®å®šå†…å­˜å ç”¨HotSpot VMå †å¸ƒå±€é€šè¿‡-Xmnå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è®¾å®šæ–°ç”Ÿä»£ç©ºé—´çš„åˆå§‹å€¼å’Œæœ€å¤§å€¼ã€‚æœ‰ä¸€ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„,å¦‚æžœ-Xmså’Œ-â…ªmxå¹¶æ²¡æœ‰è®¾å®šä¸ºåŒä¸€ä¸ªå€¼,ä½¿ç”¨-Xmné€‰é¡¹æ—¶,Javaå †çš„å¤§å°å˜åŒ–ä¸ä¼šå½±å“æ–°ç”Ÿä»£ç©ºé—´,å³æ–°ç”Ÿä»£ç©ºé—´çš„å¤§å°æ€»ä¿æŒæ’å®š,è€Œä¸æ˜¯éšç€Javaå †å¤§å°çš„æ‰©å±•æˆ–ç¼©å‡åšç›¸åº”çš„è°ƒæ•´ã€‚å› æ­¤,è¯·æ³¨æ„,åªæœ‰åœ¨-Xmsä¸Ž-Xmxè®¾å®šä¸ºåŒä¸€å€¼æ—¶æ‰ä½¿ç”¨-Xmné€‰é¡¹ã€‚ è€å¹´ä»£ç©ºé—´çš„å¤§å°ä¼šæ ¹æ®æ–°ç”Ÿä»£çš„å¤§å°éšå¼è®¾å®šã€‚è€å¹´ä»£ç©ºé—´çš„åˆå§‹å€¼ä¸º-Xmxçš„å€¼å‡åŽ»XX: NewSizeçš„å€¼ã€‚è€å¹´ä»£ç©ºé—´çš„æœ€å°å€¼ä¸º-Xmxçš„å€¼å‡åŽ»-XX:MaxNewSizeçš„å€¼ã€‚å¦‚æžœ-Xmsä¸ŽXmxè®¾ç½®ä¸ºåŒä¸€å€¼,åŒæ—¶ä½¿ç”¨äº†-Xmn,æˆ–è€…-XX:NewSizeä¸Ž-XX:MaxNewsizeä¸€æ ·,åˆ™è€å¹´ä»£çš„å¤§å°ä¸º-Xmx(æˆ–-Xms)çš„å€¼å‡åŽ»-Xmnã€‚ å®žé™…ä¸Š,å½“HotSpot VMå‘çŽ°å½“å‰å¯ç”¨ç©ºé—´ä¸è¶³ä»¥å®¹çº³ä¸‹ä¸€æ¬¡Minor GCæå‡çš„å¯¹è±¡æ—¶å°±ä¼šè¿›è¡ŒFull GCã€‚ä¸Žå› ç©ºé—´é—®é¢˜å¯¼è‡´çš„Minor GCè¿‡ç¨‹ä¸­çš„å¯¹è±¡æå‡å¤±è´¥æ¯”è¾ƒèµ·æ¥,è¿™ç§æ–¹å¼çš„ä»£ä»·è¦å°å¾—å¤šã€‚ä»Žå¤±è´¥çš„å¯¹è±¡æå‡ä¸­æ¢å¤æ˜¯ä¸€ä¸ªå¾ˆæ˜‚è´µçš„æ“ä½œã€‚æ°¸ä¹…ä»£æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜å‚¨æ–°çš„VMæˆ–ç±»å…ƒæ•°æ®æ—¶ä¹Ÿä¼šå‘ç”ŸFull GCã€‚ å¦‚æžœFull GCç¼˜äºŽè€å¹´ä»£ç©ºé—´å·²æ»¡,å³ä½¿æ°¸ä¹…ä»£ç©ºé—´å¹¶æ²¡æœ‰ç”¨å°½,è€å¹´ä»£å’Œæ°¸ä¹…ä»£éƒ½ä¼šè¿›è¡Œåžƒåœ¾æ”¶é›†ã€‚åŒæ ·,å¦‚æžœFull GCç”±æ°¸ä¹…ä»£ç©ºé—´ç”¨å°½å¼•èµ·,è€å¹´ä»£å’Œæ°¸ä¹…ä»£ä¹Ÿéƒ½ä¼šè¿›è¡Œåžƒåœ¾æ”¶é›†,æ— è®ºè€å¹´ä»£æ˜¯å¦è¿˜æœ‰ç©ºé—²ç©ºé—´ã€‚å¼€å¯-XX:+UseParallelGCæˆ–-XX:+UseParallelOldGCæ—¶,å¦‚æžœå…³é—­-XX:-ScavengeBeforeFullGC, HotSpot VMåœ¨Full GCä¹‹å‰ä¸ä¼šè¿›è¡ŒMinor GC,ä½†Full GCè¿‡ç¨‹ä¸­ä¾ç„¶ä¼šæ”¶é›†æ–°ç”Ÿä»£;å¦‚æžœå¼€å¯-XX:+ScavengeBeforeFullGC, HotSpot VMåœ¨Full GCå‰ä¼šå…ˆåšä¸€æ¬¡Minor GC,åˆ†æ‹…ä¸€éƒ¨åˆ†Full GCåŽŸæœ¬è¦åšçš„å·¥ä½œã€‚ å †å¤§å°è°ƒä¼˜ç€çœ¼ç‚¹å¦‚æžœä½ ä½¿ç”¨çš„HotSpot VMä¸æŽ¥å—-XX:+UseParallelOldGCé€‰é¡¹,å¯ä»¥ä½¿ç”¨-XX:+UseParallelGCä»£æ›¿ã€‚å¦‚æžœä½ å¾ˆæ¸…æ¥šJavaåº”ç”¨ç¨‹åºè¦ä½¿ç”¨å¤šå¤§çš„Javaå †ç©ºé—´,å¯ä»¥å°†Javaå †å¤§å°ä½œä¸ºè°ƒä¼˜çš„å…¥æ‰‹ç‚¹,ä½¿ç”¨-Xmxå’Œ-Xmsè®¾ç½®Javaå †çš„å¤§å°ã€‚å¦‚æžœä½ ä¸æ¸…æ¥šJavaåº”ç”¨ç¨‹åºåˆ°åº•éœ€è¦ä½¿ç”¨å¤šå¤§çš„Javaå †,å¯ä»¥åˆ©ç”¨HotSpot VMè‡ªåŠ¨é€‰å–Javaå †çš„å¤§å°ã€‚å¯åŠ¨Javaåº”ç”¨ç¨‹åºæ—¶ä¸æŒ‡å®š-Xmxæˆ–-Xmsçš„å€¼, HotSpot VMä¼šè‡ªåŠ¨è®¾å®šJavaå †å¤§å°çš„åˆå§‹å€¼ã€‚æ¢å¥è¯è¯´,è¿™æ˜¯ä¸€ä¸ªèµ·å§‹ç‚¹ã€‚éšç€è°ƒä¼˜è¿‡ç¨‹,åŽé¢ä¼šé€æ¸è°ƒæ•´Javaå †çš„å¤§å°ã€‚ é€šè¿‡HotSpotå‘½ä»¤è¡Œé€‰é¡¹-XX:+PrintCommandLineFlagsè¿˜å¯ä»¥æŸ¥çœ‹å †çš„åˆå§‹å€¼åŠæœ€å¤§å€¼ã€‚-XX:+PrintCommandlineFlagsé€‰é¡¹å¯ä»¥è¾“å‡ºHotSpot VMåˆå§‹åŒ–æ—¶ä½¿ç”¨-XX:InitialHeapSize=&lt;n&gt; -XX:MaxHeapSize=&lt;m&gt;æŒ‡å®šçš„å †çš„åˆå§‹å€¼åŠæœ€å¤§å€¼,å…¶ä¸­&lt;n&gt;æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„åˆå§‹Javaå †å¤§å°,&lt;m&gt;æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„å †çš„æœ€å¤§å€¼ã€‚ è®¡ç®—æ´»è·ƒæ•°æ®å¤§å°æ´»è·ƒæ•°æ®å¤§å°æ˜¯åº”ç”¨ç¨‹åºè¿è¡ŒäºŽç¨³å®šæ€æ—¶,é•¿æœŸå­˜æ´»çš„å¯¹è±¡åœ¨Javaå †ä¸­å ç”¨çš„ç©ºé—´å¤§å°ã€‚æ¢å¥è¯è¯´,æ´»è·ƒæ•°æ®å¤§å°æ˜¯åº”ç”¨ç¨‹åºè¿è¡ŒäºŽç¨³å®šæ€,Full GCä¹‹åŽJavaå †ä¸­è€å¹´ä»£å’Œæ°¸ä¹…ä»£å ç”¨çš„ç©ºé—´å¤§å°ã€‚ Javaåº”ç”¨çš„æ´»è·ƒæ•°æ®å¤§å°å¯ä»¥é€šè¿‡GCæ—¥å¿—æ”¶é›†ã€‚æ´»è·ƒæ•°æ®å¤§å°åŒ…æ‹¬ä¸‹é¢çš„å†…å®¹: åº”ç”¨ç¨‹åºè¿è¡ŒäºŽç¨³å®šæ€æ—¶,è€å¹´ä»£å ç”¨çš„Javaå †å¤§å°; åº”ç”¨ç¨‹åºè¿è¡ŒäºŽç¨³å®šæ€æ—¶,æ°¸ä¹…ä»£å ç”¨çš„Javaå †å¤§å°ã€‚ é™¤äº†æ´»è·ƒæ•°æ®å¤§å°,ç¨³å®šæ€çš„Full GCä¹Ÿä¼šå¯¹å»¶è¿Ÿå¸¦æ¥ä¸¥é‡å½±å“ã€‚ ä¸ºäº†æ›´å¥½åœ°åº¦é‡åº”ç”¨ç¨‹åºçš„æ´»è·ƒæ•°æ®å¤§å°,æœ€å¥½åœ¨å¤šæ¬¡Full GCä¹‹åŽå†æŸ¥çœ‹Javaå †çš„å ç”¨æƒ…å†µã€‚å¦å¤–,éœ€è¦ç¡®ä¿Full GCå‘ç”Ÿæ—¶,åº”ç”¨ç¨‹åºæ­£å¤„äºŽç¨³å®šæ€ã€‚ å¦‚æžœåº”ç”¨ç¨‹åºæ²¡æœ‰å‘ç”ŸFull GCæˆ–è€…ä¸ç»å¸¸å‘ç”ŸFull GC,ä½ å¯ä»¥ä½¿ç”¨JVMç›‘æŽ§å·¥å…·Visual VMæˆ–JConsoleäººå·¥è§¦å‘Full GCã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨HotSpot JDKå‘è¡Œç‰ˆä¸­æä¾›çš„jmapå‘½ä»¤,é€šè¿‡å‘½ä»¤è¡Œå¼ºåˆ¶è¿›è¡ŒFull GCã€‚ä¸ºäº†å®žçŽ°è¿™ä¸ªç›®çš„,jmapéœ€è¦ä½¿ç”¨- histo:liveå‘½ä»¤è¡Œé€‰é¡¹åŠJVMè¿›ç¨‹å·ã€‚JVMè¿›ç¨‹å·å¯ä»¥é€šè¿‡JDKçš„jså‘½ä»¤èŽ·å¾—ã€‚ä¾‹å¦‚,Javaåº”ç”¨ç¨‹åºçš„JMè¿›ç¨‹å·æ˜¯348,ä½¿ç”¨jmapè§¦å‘Full GCçš„å‘½ä»¤è¡Œå¦‚ä¸‹: 1jmap -histo: live 348 jmapå‘½ä»¤è§¦å‘ Full GCçš„åŒæ—¶ä¹Ÿç”Ÿæˆä¸€ä»½åŒ…å«å¯¹è±¡åˆ†é…ä¿¡æ¯çš„å †åˆ†æžæ–‡ä»¶ã€‚ä¸ºäº†ä¸“æ³¨æœ¬æ­¥æ“ä½œ,ä½ å¯ä»¥å¿½ç•¥ç”Ÿæˆçš„å †åˆ†æžæ–‡ä»¶ã€‚ åˆå§‹åŒ–å †å¤§å°é…ç½®æŽ¨èçš„åšæ³•æ˜¯åŸºäºŽæœ€å·®å»¶è¿Ÿè¿›è¡Œä¼°ç®—ã€‚ ç©ºé—´ å‘½ä»¤è¡Œé€‰é¡¹ å ç”¨å€æ•° Javaå † -Xmså’Œ-Xmx 3-4å€Full GCåŽçš„è€å¹´ä»£ç©ºé—´å ç”¨é‡ æ°¸ä¹…ä»£ -XX:Permsize-XX:MaxPermSize 1.2-1.5å€Full GCåŽçš„æ°¸ä¹…ä»£ç©ºé—´å ç”¨é‡ æ–°ç”Ÿä»£ -Xmn 1~1.5å€ Full GCåŽçš„è€å¹´ä»£ç©ºé—´å ç”¨é‡ è€å¹´ä»£ Javaå †å¤§å°å‡æ–°ç”Ÿä»£å¤§å° 2-3å€Full GCåŽçš„è€å¹´ä»£ç©ºé—´å ç”¨é‡ è°ƒä¼˜å»¶è¿Ÿ/å“åº”æ€§è¾“å…¥è¿™ä¸€æ­¥è°ƒä¼˜æœ‰å¤šä¸ªè¾“å…¥,éƒ½æºäºŽåº”ç”¨ç¨‹åºçš„ç³»ç»Ÿæ€§éœ€æ±‚ã€‚ åº”ç”¨ç¨‹åºå¯æŽ¥å—çš„å¹³å‡åœæ»žæ—¶é—´ã€‚å¹³å‡åœæ»žæ—¶é—´å°†ä¸Žæµ‹é‡å‡ºçš„Minor GCæŒç»­æ—¶é—´è¿›è¡Œæ¯”è¾ƒã€‚ å¯æŽ¥å—çš„Minor GC(ä¼šå¯¼è‡´å»¶è¿Ÿ)é¢‘çŽ‡ã€‚ Minor GCçš„é¢‘çŽ‡å°†ä¸Žå¯å®¹å¿çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚å¯¹åº”ç”¨ç¨‹åºå¹²ç³»äººè€Œè¨€,GCæŒç»­çš„æ—¶é—´å¾€å¾€æ¯”GCå‘ç”Ÿçš„é¢‘çŽ‡æ›´é‡è¦ã€‚ åº”ç”¨ç¨‹åºå¹²ç³»äººå¯æŽ¥å—çš„åº”ç”¨ç¨‹åºçš„æœ€å¤§åœé¡¿æ—¶é—´ã€‚æœ€å¤§åœé¡¿æ—¶é—´å°†ä¸Žæœ€å·®æƒ…å†µä¸‹Full GCçš„æŒç»­æ—¶é—´è¿›è¡Œæ¯”è¾ƒã€‚ åº”ç”¨ç¨‹åºå¹²ç³»äººå¯æŽ¥å—çš„æœ€å¤§åœé¡¿å‘ç”Ÿçš„é¢‘çŽ‡ã€‚æœ€å¤§åœé¡¿å‘ç”Ÿçš„é¢‘çŽ‡åŸºæœ¬ä¸Šå°±æ˜¯Full GCçš„é¢‘çŽ‡ã€‚åŒæ ·,å¯¹äºŽå¤§å¤šæ•°åº”ç”¨ç¨‹åºå¹²ç³»äººè€Œè¨€,ç›¸å¯¹äºŽGCçš„é¢‘çŽ‡,ä»–ä»¬æ›´å…³å¿ƒGCæŒç»­çš„å¹³å‡åœé¡¿æ—¶é—´å’Œæœ€å¤§åœé¡¿æ—¶é—´ã€‚ ä¼˜åŒ–æ–°ç”Ÿä»£çš„å¤§å°è°ƒæ•´æ–°ç”Ÿä»£ç©ºé—´æ—¶,éœ€è¦è°¨è®°ä¸‹é¢å‡ ä¸ªå‡†åˆ™ï¼š è€å¹´ä»£ç©ºé—´å¤§å°ä¸åº”è¯¥å°äºŽæ´»è·ƒæ•°æ®å¤§å°çš„1.5å€ã€‚ æ–°ç”Ÿä»£ç©ºé—´è‡³å°‘åº”ä¸ºJavaå †å¤§å°çš„10%,é€šè¿‡Xmxå’Œ-Xmså¯ä»¥è®¾å®šè¯¥å€¼ã€‚æ–°ç”Ÿä»£è¿‡å°å¯èƒ½é€‚å¾—å…¶å,ä¼šå¯¼è‡´é¢‘ç¹çš„Minor GCã€‚ å¢žå¤§Javaå †å¤§å°æ—¶,éœ€è¦æ³¨æ„ä¸è¦è¶…è¿‡JVMå¯ç”¨çš„ç‰©ç†å†…å­˜æ•°ã€‚å †å ç”¨è¿‡å¤šå†…å­˜å°†å¯¼è‡´åº•å±‚ç³»ç»Ÿäº¤æ¢åˆ°è™šæ‹Ÿå†…å­˜,åè€Œä¼šé€ æˆåžƒåœ¾æ”¶é›†å™¨å’Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½ä½Žä¸‹ã€‚ ç›‘æŽ§æ™‹å‡é˜ˆå€¼æœ€å¤§æ™‹å‡é˜ˆå€¼å¯ä»¥é€šè¿‡HotSpot VMçš„å‘½ä»¤è¡Œé€‰é¡¹-XX: MaxTenuringThreshold=&lt;n&gt;è®¾ç½®ã€‚ä½¿ç”¨HotSpot VMçš„å‘½ä»¤è¡Œé€‰é¡¹ 1-XX: +PrintTenuringDistribution å¯ä»¥ç›‘æŽ§æ™‹å‡çš„åˆ†å¸ƒæˆ–è€…å¯¹è±¡å¹´é¾„åˆ†å¸ƒ,å¹¶ä»¥æ­¤ä¸ºä¾æ®ç¡®å®šæœ€ä¼˜çš„æœ€å¤§æ™‹å‡é˜ˆå€¼å€¼ã€‚ é€šè¿‡-XX:+PrintTenuringDistributionå‘½ä»¤è¡Œé€‰é¡¹å¯ä»¥è§‚å¯ŸSurvivorç©ºé—´ä¸­çš„å¯¹è±¡æ˜¯å¦‚ä½•è€åŒ–çš„ã€‚åœ¨-XX:+PrintTenuringDistributionç”Ÿæˆçš„è¾“å‡ºä¸­,æˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯éšç€å¯¹è±¡å¹´é¾„çš„å¢žåŠ ,å„å¯¹è±¡å¹´é¾„ä¸Šå­—èŠ‚æ•°å‡å°‘çš„æƒ…å†µ,ä»¥åŠ HotSpot VMè®¡ç®—å‡ºçš„æ™‹å‡é˜ˆå€¼æ˜¯å¦ç­‰äºŽæˆ–æŽ¥è¿‘è®¾ç½®çš„æœ€å¤§æ™‹å‡é˜ˆå€¼ã€‚ XX:+PrintTenuringDistributionä¼šè¾“å‡ºæ¯æ¬¡Minor GCæ—¶æ™‹å‡åˆ†å¸ƒçš„æƒ…å†µã€‚å®ƒä¹Ÿå¯ä»¥å’Œå…¶ä»–çš„åžƒåœ¾æ”¶é›†å‘½ä»¤è¡Œé€‰é¡¹,ä¾‹å¦‚-XX:+PrintGCDateStampsã€-XX:+PrintGcTime Stampsæˆ–-XX:+PrintgCDetailsé…åˆä½¿ç”¨ã€‚å¯¹Survivorç©ºé—´çš„æœ‰æ•ˆå¯¹è±¡è€åŒ–è¿›è¡Œå¾®è°ƒæ—¶,åº”è¯¥ä½¿ç”¨é€‰é¡¹XX:+PrintTenuringDistributionåœ¨åžƒåœ¾æ”¶é›†æ—¥å¿—ä¸­åŒ…å«æ™‹å‡åˆ†å¸ƒçš„ç»Ÿè®¡ä¿¡æ¯ã€‚åŒæ ·,å¦‚æžœéœ€è¦åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­åˆ¤æ–­ä¸€ä¸ªåº”ç”¨ç¨‹åºäº‹ä»¶æ˜¯å¦æºäºŽä¸€æ¬¡Stop-The-WorldåŽ‹ç¼©å¼åžƒåœ¾æ”¶é›†,å¾€å¾€ä¹Ÿéœ€è¦èŽ·å–æ™‹å‡åˆ†å¸ƒçš„æ—¥å¿—ä¿¡æ¯,ä½¿ç”¨è¯¥é€‰é¡¹æ˜¯éžå¸¸æœ‰å¸®åŠ©çš„ã€‚ é€šå¸¸æƒ…å†µä¸‹,è§‚å¯Ÿåˆ°æ–°çš„æ™‹å‡é˜ˆå€¼æŒç»­å°äºŽæœ€å¤§æ™‹å‡é˜ˆå€¼,æˆ–è€…è§‚å¯Ÿåˆ° Survivorç©ºé—´å¤§å°å°äºŽæ€»çš„å­˜æ´»å¯¹è±¡å¤§å°éƒ½è¡¨æ˜Ž Survivorç©ºé—´è¿‡å°ã€‚ è°ƒæ•´ Survivorç©ºé—´çš„å®¹é‡è°ƒæ•´Survivorç©ºé—´å®¹é‡ä¸€ä¸ªåº”è¯¥è°¨è®°äºŽå¿ƒçš„é‡è¦åŽŸåˆ™:è°ƒæ•´Survivorç©ºé—´å®¹é‡æ—¶,å¦‚æžœæ–°ç”Ÿä»£ç©ºé—´å¤§å°ä¸å˜,å¢žå¤§Survivorç©ºé—´ä¼šå‡å°‘Edenç©ºé—´;è€Œå‡å°‘Edenç©ºé—´ä¼šå¢žåŠ Minor GCçš„é¢‘çŽ‡ã€‚å› æ­¤,ä¸ºäº†åŒæ—¶æ»¡è¶³åº”ç”¨ç¨‹åºMinor GCé¢‘çŽ‡çš„è¦æ±‚,å°±éœ€è¦å¢žå¤§å½“å‰æ–°ç”Ÿä»£ç©ºé—´çš„å¤§å°;å³å¢žå¤§Survivorç©ºé—´å¤§å°æ—¶,Edenç©ºé—´çš„å¤§å°åº”è¯¥ä¿æŒä¸å˜ã€‚æ¢å¥è¯è¯´,æ¯å½“ Survivorç©ºé—´å¢žåŠ æ—¶,æ–°ç”Ÿä»£ç©ºé—´éƒ½åº”è¯¥å¢žå¤§ã€‚å¦‚æžœå¯ä»¥å¢žå¤§Minor GCçš„é¢‘çŽ‡,ä½ å¯ä»¥é€‰æ‹©ç”¨ä¸€éƒ¨åˆ†Edenç©ºé—´æ¥å¢žå¤§Survivorç©ºé—´,æˆ–è€…ç›´æŽ¥å¢žå¤§æ–°ç”Ÿä»£ç©ºé—´å¤§å°ã€‚å¦‚æžœå†…å­˜è¶³å¤Ÿ,ç›¸å¯¹äºŽå‡å°‘Edenç©ºé—´.å¢žåŠ æ–°ç”Ÿä»£å¤§å°é€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ä¿æŒEdenç©ºé—´å¤§å°æ’å®š, Minor GCçš„é¢‘çŽ‡å°±ä¸ä¼šç”±äºŽSurvivorç©ºé—´å¢žå¤§è€Œå‘ç”Ÿå˜åŒ–ã€‚ å¦‚æžœä½ è§‚å¯Ÿåˆ°åžƒåœ¾æ”¶é›†ä¸­æ™‹å‡åˆ†å¸ƒæžå°‘å‡ºçŽ°å¯¹è±¡å¹´é¾„ä¸º15çš„æƒ…å†µ,å¹¶ä¸”ä¹Ÿæ²¡æœ‰å‘ç”ŸSurviâ…³vorç©ºé—´æº¢å‡º,é‚£ä¹ˆåº”è¯¥è®¾ç½®æœ€å¤§æ™‹å‡é˜ˆå€¼ä¸ºå…¶é»˜è®¤å€¼15ã€‚è¿™ç§åœºæ™¯ä¸‹,å¯¹è±¡éƒ½ä¸æ˜¯é•¿æœŸå­˜æ´»å¯¹è±¡,åœ¨å¹´é¾„å¾ˆå°çš„æ—¶å€™å°±è¢«å›žæ”¶äº†,æ ¹æœ¬ä¸ä¼šç”Ÿå­˜åˆ°æœ€å¤§æ™‹å‡å¹´é™çš„å¹´é¾„15ã€‚ è°ƒæ•´ç›®æ ‡Survivorç©ºé—´å ç”¨ç›®æ ‡Survivorç©ºé—´å ç”¨æ˜¯HotSpot VMå°è¯•åœ¨Minor GCä¹‹åŽä»ç„¶ç»´æŒçš„Survivorç©ºé—´å ç”¨ã€‚é€šè¿‡ HotSpot VMçš„å‘½ä»¤è¡Œé€‰é¡¹-XX:TargetSurvivorRatio=&lt;percent&gt;å¯ä»¥å¯¹è¯¥å€¼è¿›è¡Œè°ƒæ•´ã€‚é€šè¿‡å‘½ä»¤è¡Œé€‰é¡¹æŒ‡å®šçš„å‚æ•°å®žé™…ä¸Šæ˜¯Survivorç©ºé—´å ç”¨çš„ç™¾åˆ†æ¯”è€Œä¸æ˜¯ä¸€ä¸ªæ¯”çŽ‡ã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯50ã€‚ HotSpot VMç ”å‘å›¢é˜Ÿå¯¹ä¸åŒç±»åž‹çš„åº”ç”¨ç¨‹åºè¿›è¡Œäº†å¤§é‡çš„è´Ÿè·æµ‹è¯•,ç»“æžœè¡¨æ˜Ž50%çš„ç›®æ ‡Survivorç©ºé—´å ç”¨èƒ½é€‚åº”å¤§å¤šæ•°çš„åº”ç”¨ç¨‹åº,è¿™æ˜¯å› ä¸ºå®ƒèƒ½åº”å¯¹Minor GCæ—¶å­˜æ´»å¯¹è±¡çš„æ€¥é€Ÿå¢žåŠ ã€‚ æžå°‘å‘ç”Ÿéœ€è¦å¯¹ç›®æ ‡Survivorç©ºé—´å ç”¨è¿›è¡Œè°ƒä¼˜çš„æƒ…å†µã€‚ä½†æ˜¯,å¦‚æžœåº”ç”¨ç¨‹åºæœ‰ä¸€ä¸ªç›¸å¯¹ç¨³å®šçš„å¯¹è±¡åˆ†é…é€ŸçŽ‡,å¯ä»¥è€ƒè™‘æé«˜ç›®æ ‡Survivorç©ºé—´å ç”¨åˆ°80~90ã€‚è¿™æ ·å¯ä»¥å‡å°‘ç”¨äºŽè€åŒ–å¯¹è±¡çš„Survivorç©ºé—´çš„æ•°é‡ã€‚å°†-XX:TargetSurvivorRatio=&lt;percent&gt;è®¾ç½®å¾—å¤§äºŽé»˜è®¤å€¼ä¼šå¸¦æ¥çš„å†‹é¢˜æ˜¯ä¸èƒ½å¾ˆå¦¤çš„é€‚åº”è¿…é€Ÿä¸Šæ¶¨çš„å¯¹è±¡åˆ†é…é€ŸçŽ‡,å¯¼è‡´æå‡å¯¹è±¡çš„æ—¶æœºæ¯”é¢„æœŸæ›´æ—©ã€‚ä½¿ç”¨CMSæ—¶,å¦‚æžœå¯¹è±¡æå‡è¿‡å¿«ä¼šå¯¼è‡´è€å¹´ä»£å ç”¨å¢žå¤§,ç”±äºŽæå‡äº†ä¸€äº›éžé•¿æœŸå­˜æ´»çš„å¯¹è±¡,è¿™äº›å¯¹è±¡åœ¨å°†æ¥çš„å¹¶å‘åžƒåœ¾æ”¶é›†å‘¨æœŸä¸­ä¸€å®šä¼šè¢«å›žæ”¶,å¯¼è‡´å‡ºçŽ°å†…å­˜ç¢Žç‰‡çš„æ¦‚çŽ‡è¾ƒé«˜ã€‚ç¢Žç‰‡æ˜¯æˆ‘ä»¬è¦å°½é‡é¿å…çš„,å› ä¸ºå®ƒæœ€ç»ˆä¼šå¯¼è‡´Stop-The-WorldåŽ‹ç¼©å¼åžƒåœ¾æ”¶é›†ã€‚ æˆåŠŸçš„CMSæ”¶é›†å™¨è°ƒä¼˜è¦èƒ½ä»¥å¯¹è±¡ä»Žæ–°ç”Ÿä»£æå‡åˆ°è€å¹´ä»£çš„åŒç­‰é€Ÿåº¦å¯¹è€å¹´ä»£ä¸­çš„å¯¹è±¡è¿›è¡Œåžƒåœ¾æ”¶é›†ã€‚è¾¾ä¸åˆ°è¿™ä¸ªæ ‡å‡†åˆ™ç§°ä¹‹ä¸ºâ€œå¤±é€Ÿâ€(Lost the Race)å¤±é€Ÿçš„ç»“æžœå°±ä¼šå‘ç”ŸStop-The-WorldåŽ‹ç¼©å¼åžƒåœ¾æ”¶é›†ã€‚é¿å…å¤±é€Ÿçš„å…³é”®æ˜¯è¦ç»“åˆè¶³å¤Ÿå¤§çš„è€å¹´ä»£ç©ºé—´å’Œè¶³å¤Ÿå¿«åœ°åˆå§‹åŒ–CMSåžƒåœ¾æ”¶é›†å‘¨æœŸ,è®©å®ƒä»¥æ¯”æå‡é€ŸçŽ‡æ›´å¿«çš„é€Ÿåº¦å›žæ”¶ç©ºé—´ã€‚ CMSå‘¨æœŸçš„åˆå§‹åŒ–åŸºäºŽè€å¹´ä»£ç©ºé—´çš„å ç”¨æƒ…å†µã€‚å¦‚æžœCMSå‘¨æœŸå¼€å§‹å¾—å¤ªæ™š,å°±ä¼šå‘ç”Ÿå¤±é€Ÿã€‚å¦‚æžœå®ƒæ— æ³•ä»¥è¶³å¤Ÿå¿«çš„é€Ÿåº¦å›žæ”¶å¯¹è±¡,å°±æ— æ³•é¿å…è€å¹´ä»£ç©ºé—´ç”¨å°½ã€‚ä½†æ˜¯CMSå‘¨æœŸå¼€å§‹å¾—è¿‡æ—©åˆä¼šå¼•èµ·æ— ç”¨çš„æ¶ˆè€—,å½±å“åº”ç”¨ç¨‹åºçš„åžåé‡ã€‚é€šå¸¸,æ—©å¯åŠ¨CMSå‘¨æœŸè¦æ¯”æ™šå¯åŠ¨CMSå¥½,å› ä¸ºå¯åŠ¨å¤ªæ™šçš„ç»“æžœæ¯”å¯åŠ¨è¿‡æ—©çš„ç»“æžœè¦æ¶åŠ£å¾—å¤šã€‚ å¦‚æžœGCæ—¥å¿—ä¸­å‘çŽ°concurrent mode failureså­—æ ·,å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¡Œé€‰é¡¹é€šçŸ¥HotSpotåœ¨æ›´æ—©çš„æ—¶é—´å¯åŠ¨CMSåžƒåœ¾æ”¶é›†å‘¨æœŸã€‚ 1-XX: CMSInitiatingOccupancyFraction=&lt;percent&gt; è®¾å®šçš„å€¼æ˜¯CMSåžƒåœ¾æ”¶é›†å‘¨æœŸåœ¨è€å¹´ä»£ç©ºé—´å ç”¨è¾¾åˆ°å¤šå°‘ç™¾åˆ†æ¯”æ—¶å¯åŠ¨ã€‚ä¾‹å¦‚,å¦‚æžœä½ å¸Œæœ›CMSå‘¨æœŸåœ¨è€å¹´ä»£ç©ºé—´å ç”¨è¾¾åˆ°65%æ—¶å¼€å§‹,å¯ä»¥è®¾ç½®-XX:CMSInitiatingOccupancyFraction=65ã€‚ å¦ä¸€ä¸ªå¯ä»¥ä¸Ž-XX:CMSInitiatingOccupancyFraction=&lt;percent&gt;ä¸€èµ·ä½¿ç”¨å¦ä¸€ä¸ªHotspotå‘½ä»¤è¡Œé€‰é¡¹æ˜¯ 1-XX:+UseCMSInitiatingOccupancyOnly -XX:+UseCMSInitiatingOccupancyOnlyå‘ŠçŸ¥HotSpot VMæ€»æ˜¯ä½¿ç”¨-XX:CMSInitiatingOccupancyFractionè®¾å®šçš„å€¼ä½œä¸ºå¯åŠ¨CMSå‘¨æœŸçš„è€å¹´ä»£ç©ºé—´å ç”¨é˜ˆå€¼ã€‚ä¸ä½¿ç”¨-XX:+UseRs InitiatingOccupancyOnly, HotSpot VMä»…åœ¨å¯åŠ¨çš„ç¬¬ä¸€ä¸ªCMSå‘¨æœŸé‡Œä½¿ç”¨-XX:CMSInitiatingOccupancyFractionè®¾å®šçš„å€¼ä½œä¸ºå ç”¨æ¯”çŽ‡,ä¹‹åŽçš„å‘¨æœŸä¸­åˆè½¬å‘è‡ªé€‚åº”åœ°å¯åŠ¨CMSå‘¨æœŸ,å³ç¬¬ä¸€æ¬¡CMSå‘¨æœŸä¹‹åŽå°±ä¸å†ä½¿ç”¨-XX:CMSInitiatingoccupancy Fractionè®¾å®šçš„å€¼ã€‚ è¿‡é€‰é¡¹è®¾ç½®ä½•æ—¶å¯åŠ¨CMSå‘¨æœŸæ—¶,æœ€å¥½åŒæ—¶ä½¿ç”¨-XX:CMSInitiatingOccupancyFraction=&lt;percent&gt;å’Œ-XX:+UseCMSInitiatingOccupancyOnly é€‰é¡¹-XX:CMSInitiatingOccupancyFractionè®¾å®šçš„ç©ºé—´å ç”¨å€¼åº”è¯¥å¤§äºŽè€å¹´ä»£å ç”¨ç©ºé—´å’Œæ´»è·ƒæ•°æ®å¤§å°ä¹‹æ¯”ã€‚åº”ç”¨ç¨‹åºçš„æ´»è·ƒæ•°æ®å¤§å°å°±æ˜¯ä¸€æ¬¡Full GCä¹‹åŽå †æ‰€å ç”¨çš„ç©ºé—´å¤§å°ã€‚å¦‚æžœä½¿ç”¨-XX:CMSInitiatingOccupancyFractionè®¾ç½®çš„å€¼å°äºŽæ´»è·ƒæ•°æ®çš„å ç”¨ç™¾åˆ†æ¯”,CMSæ”¶é›†å™¨ä¸€ç›´è¿è¡Œé™·å…¥æ­»å¾ªçŽ¯ã€‚å› æ­¤-XX:CMSInitiatingoccupancyFractionè®¾ç½®çš„ä¸€ä¸ªé€šç”¨åŽŸåˆ™æ˜¯è€å¹´ä»£å ç”¨ç™¾åˆ†æ¯”åº”è¯¥è‡³å°‘åº”è¯¥æ˜¯æ´»è·ƒæ•°æ®å¤§å°çš„1.5å€ã€‚ ä½•æ—¶(æå‰æˆ–æŽ¨è¿Ÿ)å¯åŠ¨CMSå‘¨æœŸå–å†³äºŽå¯¹è±¡ä»Žæ–°ç”Ÿä»£æå‡è‡³è€å¹´ä»£çš„é€ŸçŽ‡,å³è€å¹´ä»£ç©ºé—´çš„å¢žé•¿çŽ‡ã€‚å¦‚æžœè€å¹´ä»£ç©ºé—´æ¶ˆè€—å¾—æ¯”è¾ƒæ…¢,å¯ä»¥åœ¨ç¨æ™©çš„æ—¶å€™å¯åŠ¨CMSå‘¨æœŸã€‚å¦‚æžœè€å¹´ä»£ç©ºé—´æ¶ˆè€—è¿…é€Ÿ,ä½ åº”è¯¥åœ¨è¾ƒæ—©çš„æ—¶å€™å¯åŠ¨CMSå‘¨æœŸ,ä½†æ˜¯ä¹Ÿä¸åº”ä½ŽäºŽæ´»è·ƒæ•°æ®çš„å ç”¨çš„æ¯”çŽ‡ã€‚ä¸åº”è¯¥å°†å¯åŠ¨CMSå‘¨æœŸçš„å€¼è®¾ç½®å¾—æ¯”æ´»è·ƒæ•°æ®çš„å¤§å°ä½Ž,è§£å†³è¿™ä¸ªé—®é¢˜æ›´å¥½çš„æ–¹æ³•æ˜¯å¢žå¤§è€å¹´ä»£ç©ºé—´çš„å¤§å°ã€‚ æ˜¾å¼çš„åžƒåœ¾æ”¶é›†ä½¿ç”¨CMSæ—¶,å¦‚æžœä½ è§‚å¯Ÿåˆ°ç”±æ˜¾å¼è°ƒç”¨System.gc()è§¦å‘çš„Full GC,æœ‰2ç§å¤„ç†çš„æ–¹æ³•ã€‚ 1ã€å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„ HotSpot VMå‘½ä»¤è¡Œé€‰é¡¹,æŒ‡å®š HotSpot VMä»¥CMSåžƒåœ¾æ”¶é›†å‘¨æœŸçš„æ–¹å¼æ‰§è¡Œ -XX:+ExplicitGCInvokesConcurrent æˆ–è€… -XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses å‰è€…éœ€è¦Java6åŠä»¥ä¸Šç‰ˆæœ¬ã€‚åŽè€…éœ€è¦Java6 Update4åŠä»¥ä¸Šç‰ˆæœ¬ã€‚å¦‚æžœä½ çš„JKç‰ˆæœ¬æ”¯æŒ,æœ€å¥½ä½¿ç”¨-XX:+ExplicitGCInvokesConcurrentAndUnloadsClassesé€‰é¡¹ã€‚ 2ã€ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¡Œé€šçŸ¥HotSpot VMå¿½ç•¥æ˜¾å¼çš„ System.gc()è°ƒç”¨ -XX:+DisableExplicitGC è¦ç•™æ„çš„æ˜¯,ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ä¹Ÿä¼šå¯¼è‡´å…¶ä»– HotSpot VMçš„åžƒåœ¾æ”¶é›†å™¨å¿½ç•¥æ˜¾å¼çš„System.gc()è°ƒç”¨ã€‚ ç¦ç”¨æ˜¾å¼çš„åžƒåœ¾æ”¶é›†æ—¶åº”è¯¥æ…Žé‡,å®ƒå¯èƒ½ä¼šå¯¹åº”ç”¨ç¨‹åºçš„æ€§èƒ½é€ æˆè¾ƒå¤§å½±å“ã€‚è¿˜æœ‰å¯èƒ½å‡ºçŽ°è¿™æ ·çš„åœºæ™¯,ä½ éœ€è¦åŠæ—¶å¯¹å¯¹è±¡å¼•ç”¨åšå¤„ç†,ä½†ä¸Žä¹‹å¯¹åº”çš„åžƒåœ¾æ”¶é›†å´è·Ÿä¸ä¸Šå…¶èŠ‚å¥ã€‚ä½¿ç”¨Java RMIçš„åº”ç”¨ç¨‹åºå°¤å…¶å®¹æ˜“ç¢°åˆ°è¿™ç§é—®é¢˜ã€‚æˆ‘ä»¬å»ºè®®é™¤éžæœ‰éžå¸¸æ˜Žç¡®çš„ç†ç”±,å¦åˆ™ä¸è¦è½»æ˜“åœ°ç¦ç”¨æ˜¾å¼çš„åžƒåœ¾æ”¶é›†ã€‚ä¸Žæ­¤åŒæ—¶,ä¹Ÿå»ºè®®åªåœ¨æœ‰æ˜Žç¡®ç†ç”±çš„æƒ…å†µä¸‹æ‰åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨System.gc()ã€‚ 1234562010-12-16T23:04:39.452-0600:[Full GC(System)CMS:418061K-&gt;428608K(16384K),0.2539726 secs418749K-&gt;4288608K(31168K),[CMS Perm:32428K-&gt;32428K(65536K)],0.2540393 secs][Times: user=0. 12 sys=0. 01, real=0. 25 secs] è¯·ç•™æ„Full GCä¹‹åŽçš„(System)æ ‡ç­¾,å®ƒè¡¨æ˜ŽSystem.gc()è§¦å‘äº†æœ¬æ¬¡ Full GCã€‚å¦‚æžœåœ¨åžƒåœ¾æ”¶é›†æ—¥å¿—ä¸­å‘çŽ°äº†æ˜¾å¼çš„Full GC,ä½ éœ€è¦å…ˆåˆ¤æ–­ä¸ºä»€ä¹ˆå®ƒä¼šå‘ç”Ÿ,ä¹‹åŽå†å†³å®šæ˜¯å¦è¦ç¦ç”¨,æ˜¯å¦è¦æŠŠè¯¥è°ƒç”¨ä»Žä»£ç ä¸­ç§»é™¤,æˆ–è€…æ˜¯å¦æœ‰å¿…è¦æŒ‡å®šä¸€ä¸ªæ¡ä»¶æ¥è§¦å‘CMSå¹¶å‘åžƒåœ¾æ”¶é›†å‘¨æœŸã€‚ åº”ç”¨ç¨‹åºåžåé‡è°ƒä¼˜ ä¸€ä¸ªé€šç”¨åŽŸåˆ™æ˜¯ä½¿ç”¨ Throughputæ”¶é›†å™¨æ—¶,åžƒåœ¾æ”¶é›†çš„å¼€é”€åº”è¯¥å°äºŽ5%ã€‚å¦‚æžœå¯ä»¥å°†åžƒåœ¾æ”¶é›†çš„å¼€é”€å‡å°‘åˆ°1%ç”šè‡³æ›´å°‘,é‚£åŸºæœ¬ä¸Šå°±å·²ç»åˆ°äº†æžé™,è¿›ä¸€æ­¥ä¼˜åŒ–èŠ±è´¹çš„ä»£ä»·å¾ˆå¤§ã€‚ è°ƒä¼˜å¹¶è¡Œåžƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œåžƒåœ¾æ”¶é›†å™¨ä½¿ç”¨çš„çº¿ç¨‹æ•°ä¹Ÿåº”è¯¥ä¾æ®ç³»ç»Ÿä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºæ•°ä»¥åŠåº•å±‚çš„ç¡¬ä»¶å¹³å°è¿›è¡Œç›¸åº”çš„è°ƒä¼˜ã€‚å¤šä¸ªåº”ç”¨ç¨‹åºè¿è¡ŒäºŽåŒä¸€ä¸ªç³»ç»Ÿä¸Šæ—¶,å»ºè®®é€šè¿‡å‘½ä»¤è¡Œé€‰é¡¹-XX:ParallelGCThreads=&lt;n&gt;å°†å¹¶è¡Œåžƒåœ¾æ”¶é›†çš„çº¿ç¨‹æ•°è®¾ç½®ä¸ºå°äºŽå…¶é»˜è®¤å€¼ã€‚ å¦åˆ™,ç”±äºŽå¤§é‡çš„åžƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶è¿è¡Œ,å…¶ä»–åº”ç”¨ç¨‹åºçš„æ€§èƒ½å°†å—åˆ°ä¸¥é‡å½±å“ã€‚æˆªè‡³Java6 Update23,é»˜è®¤æƒ…å†µä¸‹å¹¶è¡Œåžƒåœ¾æ”¶é›†çš„çº¿ç¨‹æ•°ç­‰äºŽJava API Runtime.availableProcessors()çš„è¿”å›žå€¼(å¦‚æžœè¯¥è¿”å›žå€¼å°äºŽç­‰äºŽ8),å¦åˆ™å…¶ç­‰äºŽ8+(Runtime.availableProcessors()-8)*5/8ã€‚å¤šä¸ªåº”ç”¨ç¨‹åºè¿è¡ŒäºŽåŒä¸€ç³»ç»Ÿä¸Šæ—¶è®¾ç½®å¹¶è¡Œåžƒåœ¾æ”¶é›†çº¿ç¨‹çš„ä¸€ä¸ªé€šç”¨åŽŸåˆ™æ˜¯ç”¨è™šæ‹Ÿå¤„ç†å™¨çš„æ•°ç›® (Runtime.availableProcessors()çš„è¿”å›žå€¼)é™¤ä»¥è¯¥ç³»ç»Ÿä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºæ•°ã€‚è¿™é‡Œæˆ‘ä»¬å‡è®¾è¿™äº›åº”ç”¨ç¨‹åºçš„è´Ÿè·åŠå †å¤§å°çš„æƒ…å†µç›¸å·®ä¸å¤§ã€‚å¦‚æžœåº”ç”¨ç¨‹åºçš„è´Ÿè·åŠJavaå †å¤§å°å·®å¼‚å¾ˆå¤§,é‚£ä¹ˆä¸ºæ¯ä¸ªJavaåº”ç”¨è®¾ç½®ä¸åŒæƒé‡,å¹¶æ®æ­¤è®¾ç½®å¹¶è¡Œåžƒåœ¾çº¿ç¨‹æ•°æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹æ³•ã€‚ åœ¨NUMAç³»ç»Ÿä¸Šéƒ¨ç½²å¦‚æžœåº”ç”¨ç¨‹åºéœ€è¦åœ¨NUMA(éžä¸€è‡´æ€§å†…å­˜æž¶æž„)ç³»ç»Ÿä¸Šéƒ¨ç½²,è¿˜æœ‰ä¸€ä¸ªå¯ä»¥ä¸ŽThroughputæ”¶é›†å™¨ä¸€èµ·ä½¿ç”¨çš„HotSpotå‘½ä»¤è¡Œé€‰é¡¹æ˜¯: 1-XX:+UseNUMA è¯¥å‘½ä»¤è¡Œé€‰é¡¹æ ¹æ®CPUä¸Žå†…å­˜ä½ç½®çš„å…³ç³»åœ¨åˆ†é…çº¿ç¨‹è¿è¡Œçš„æœ¬åœ°å†…å­˜ä¸­åˆ†é…å¯¹è±¡ã€‚è¿™é‡Œä¾æ®çš„å‡è®¾æ˜¯åˆ†é…å¯¹è±¡çš„çº¿ç¨‹æ˜¯è¿‘æœŸæœ€æœ‰å¯èƒ½è®¿é—®è¯¥å¯¹è±¡çš„çº¿ç¨‹ã€‚ç›¸å¯¹äºŽè¿œç¨‹çš„å†…å­˜è€Œè¨€,åœ¨åŒä¸€çº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¸­åˆ†é…å¯¹è±¡ç”¨æ›´çŸ­çš„æ—¶é—´å³èƒ½è®¿é—®è¯¥å¯¹è±¡çš„å†…å®¹ã€‚ åªæœ‰å½“JVMçš„éƒ¨ç½²è·¨CPUã€ä¸åŒCPUè®¿é—®å†…å­˜çš„æ‹“æ‰‘æœ‰æ‰€ä¸åŒ,å¯¼è‡´è®¿é—®æ—¶é—´ä¹Ÿæœ‰æ‰€å·®åˆ«çš„çŽ¯å¢ƒä¸‹æ‰é€‰æ‹©ä½¿ç”¨-XX:+UseNUMAé€‰é¡¹ã€‚ä¾‹å¦‚,è™½ç„¶JVMéƒ¨ç½²åˆ°NUMAç³»ç»Ÿçš„ä¸€ä¸ªå¤„ç†å™¨é›†ä¸Š,ä½†æ˜¯è¿™ä¸ªå¤„ç†å™¨é›†å¹¶ä¸å­˜åœ¨è·¨CPUè®¿é—®å†…å­˜çš„æ‹“æ‰‘,æ²¡æœ‰è®¿é—®æ—¶é—´çš„å·®åˆ«,é‚£ä¹ˆå°±ä¸åº”è¯¥ä½¿ç”¨-XX:+UseNUMAé€‰é¡¹ã€‚ ç®€è€Œè¨€ä¹‹,æ”´æŒNUMAçš„VMä¼šæ ¹æ®NUMAèŠ‚ç‚¹åˆ’åˆ†å †,çº¿ç¨‹åˆ›å»ºæ–°çš„å¯¹è±¡æ—¶,åªä¼šåœ¨è¯¥çº¿ç¨‹è¿è¡Œæ‰€åœ¨æ ¸çš„NUMAèŠ‚ç‚¹ä¸Šåˆ†é…å¯¹è±¡,åŽç»­è¯¥çº¿ç¨‹å¦‚æžœéœ€è¦ä½¿ç”¨è¿™ä¸ªå¯¹è±¡,å°±ç›´æŽ¥ä»Žæœ¬åœ°å†…å­˜ä¸­è®¿é—®ã€‚é€šå¸¸æƒ…å†µä¸‹,å¦‚æžœæ²¡æœ‰ä½¿ç”¨å‘½ä»¤,è‡‚å¦‚RHELä¸‹ä½¿ç”¨numactl,è®¾ç½®CPUçš„äº²å’Œæ€§(Affinity),é»˜è®¤å°±è·¨å¤šä¸ªå†…å­˜èŠ‚ç‚¹,æ»¡è¶³-XX:+UseNUMAçš„ä½¿ç”¨æ¡ä»¶ã€‚ æ³¨ï¼šThroughput garbage collector,å®žé™…æŒ‡çš„æ˜¯Parallelæ”¶é›†å™¨ å…¶å®ƒæ€§èƒ½å‘½ä»¤è¡Œé€‰é¡¹å¤§é¡µé¢æ”¯æŒè®¡ç®—æœºç³»ç»Ÿçš„å†…å­˜è¢«åˆ’åˆ†æˆç§°ä¸ºâ€œé¡µâ€çš„å›ºå®šå¤§å°çš„å—ã€‚ç¨‹åŽ…è®¿é—®å†…å­˜çš„è¿‡ç¨‹ä¸­ä¼šå°†è™šæ‹Ÿå†…å­˜åœ°å€è½¬æ¢æˆç‰©ç†å†…å­˜åœ°å€ã€‚è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢æ˜¯é€šè¿‡è¡¨å®Œæˆçš„ã€‚ä¸ºäº†å‡å°‘æ¯æ¬¡å†…å­˜è®¿é—®æ—¶è®¿é—®é¡µè¡¨çš„ä»£ä»·,é€šå¸¸çš„åšæ³•æ˜¯ä½¿ç”¨ä¸€å—å¿«é€Ÿç¼“å­˜,å¯¹è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢è¿›è¡Œç¼“å­˜ã€‚è¿™å—ç¼“å­˜è¢«ç§°ä¸ºè½¬è¯‘å¿«æŸ¥ç¼“å­˜(TLB)ã€‚ ä½¿ç”¨TLBå®Œæˆä»Žè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„æ¯”éåŽ†æ•´ä¸ªé¡µè¡¨çš„æ–¹å¼è¦å¿«å¾—å¤šã€‚TLBé€šå¸¸åªèƒ½å®¹çº³å›ºå®šæ•°é‡çš„æ¡ç›®ã€‚TLBä¸­çš„ä¸€æ¡è®°å½•å°±æ˜¯æŒ‰é¡µé¢å¤§å°ç»Ÿè®¡çš„ä¸€å—å†…å­˜åœ°å€åŒºé—´çš„æ˜ å°„ã€‚å› æ­¤ç³»ç»Ÿçš„é¡µé¢è¶Šå¤§,æ¯ä¸ªæ¡ç›®èƒ½æ˜ å°„çš„å†…å­˜åœ°å€åŒºé—´è¶Šå¤§,æ¯ä¸ªTLBèƒ½ç®¡ç†çš„ç©ºé—´ä¹Ÿè¶Šå¤§ã€‚TLBä»£è¡¨çš„åœ°å€åŒºé—´è¶Šå¤§,åœ°å€è½¬è¯‘è¯·æ±‚åœ¨TLBä¸­å¤±æ•ˆçš„å¯èƒ½æ€§å°±è¶Šå°ã€‚å½“ä¸€ä¸ªåœ°å€è½¬è¯‘è¯·æ±‚æ— æ³•åœ¨TLBä¸­æ‰¾åˆ°åŒ¹é…é¡¹æ—¶,æˆ‘ä»¬ç§°ä¹‹å‘ç”Ÿäº†â€œTLBå¤±æ•ˆâ€ã€‚TLBå¤±æ•ˆäº‹ä»¶å‘ç”Ÿæ—¶å¸¸å¸¸éœ€è¦éåŽ†å†…å­˜ä¸­çš„é¡µè¡¨,æŸ»æ‰¾è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ã€‚ä¸Žåœ¨TLBä¸­æŸ¥æ‰¾åœ°å€æ˜ å°„æ¯”è¾ƒèµ·æ¥,éåŽ†é¡µè¡¨æ˜¯ä¸€é¡¹éžå¸¸æ˜‚è´µçš„æ“ä½œã€‚ç”±æ­¤å¯è§,ä½¿ç”¨å¤§é¡µé¢çš„å¥½å¤„æ˜¯å…¶å‡å°äº†TLBå¤±æ•ˆçš„å‡ çŽ‡ã€‚ HotSpotè™šæ‹Ÿæœºåœ¨Oracle solaris(è¿™ä¹‹åŽç§°ä¸ºSolaris)ã€ Linuxå’Œ Windowsä¸Šéƒ½æ”¯æŒå¤§é¡µé¢ã€‚é¡µé¢å¤§å°è¿˜å¯èƒ½éšç€å¤„ç†å™¨çš„ä¸åŒæœ‰æ‰€ä¸åŒã€‚å¦å¤–,ä¸ºäº†ä½¿ç”¨å¤§é¡µé¢è¿˜å¯èƒ½éœ€è¦å¯¹æ“ä½œç³»ç»Ÿè¿›è¡Œé…ç½®ã€‚ Java åº”ç”¨çš„åŸºå‡†æµ‹è¯•åŸºå‡†æµ‹è¯•æ‰€é¢ä¸´çš„æŒ‘æˆ˜åŸºå‡†æµ‹è¯•çš„é¢„çƒ­é˜¶æ®µæ‰§è¡ŒåŸºå‡†æµ‹è¯•æ—¶ä½¿ç”¨HotSpot VMå‘½ä»¤è¡Œé€‰é¡¹-XX:+PrintCompilationæ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯,ä½¿ç”¨è¯¥å‘½ä»¤è¡Œé€‰é¡¹çš„è¾“å²€å¯ä»¥åˆ¤æ–­JITç¼–è¯‘å™¨ä½•æ—¶å®Œæˆäº†é¢„çƒ­é˜¶æ®µ,ç¡®ä¿åœ¨ HotSpotç¼–è¯‘å™¨åˆ°è¾¾ç¨³å®šæ€åŽ,å³å·²ç»å®Œæˆå®ƒçš„ä¼˜åŒ–å·¥ä½œ(ç”Ÿæˆäº†é€‚åˆåŸºå‡†æµ‹è¯•çš„ä¼˜åŒ–æœºå™¨ç )åŽå†å¼€å§‹åŸºå‡†æ•°æ®é‡‡æ ·ã€‚-XX:+PrintCompilationé€‰é¡¹é€šçŸ¥VMä¸ºæ¯ä¸ªå®ƒä¼˜åŒ–æˆ–é€†ä¼˜åŒ–çš„å‡½æ•°è¾“å‡ºä¸€æ¡æ—¥å¿—ã€‚ä¸‹é¢æ˜¯åœ¨ä¸€æ®µå¾®åŸºå‡†æµ‹è¯•ä¸­ä½¿ç”¨-XX:+PrintCompilationé€‰é¡¹è¾“å‡ºçš„æ—¥å¿—ç‰‡æ®µ: 123456789101112131411 java.util.Random:: nextInt (60 bytes)12 java.util.Random: next (47 bytes13 java.util.concurrent atomic Atomi CLong: get (5 bytes)14 java.util.HashSet: contains (9 bytes)15 java.util.HashMap: transfer (83 bytes)16 java.util.Arrays SArrayList: set (16 bytes)17 java.util.Arrays SArrayList: set (16 bytes)18 java.util.Collections: swap (25 bytes)19 java.util.Arrays SArrayList: get (7 bytes)20 java.lang.Long: &lt;init&gt; (10 bytes)21 java.lang.Integer: longvalue (6 bytes)22 java.lang.Long: valueOf (36 bytes)23 java.lang.Integer: stringSize (21 bytes)24 java.lang.Integer: getChars (131 bytes) è§‚å¯Ÿæ—¥å¿—ä¸­å·²ç»ä¸å†æœ‰-XX:+PrintCompilationè¾“å‡ºçš„ä¿¡æ¯(è¡¨æ˜ŽJITç¼–è¯‘å™¨çš„ä¼˜åŒ–å·¥ä½œå·²ç»å®Œæˆ)ä¹‹åŽæ‰æ­£å¼å¼€å§‹é‡‡æ ·æ•°æ®ã€‚æ­¤å¤–,åŸºå‡†æµ‹è¯•è¿˜åº”è¯¥åœ¨ä¸ä½¿ç”¨-XX:+PrintCompilationé€‰é¡¹çš„æƒ…å†µä¸‹è¿è¡Œå‡ æ¬¡,æ¯”è¾ƒå…¶æ€§èƒ½ä¸Žä½¿ç”¨-XX:+ PrintCompilationé€‰é¡¹çš„ç»“æžœæ˜¯å¦ä¸€è‡´ã€‚å¦‚æžœäºŒè€…ä¸ä¸€è‡´,å¯èƒ½åœ¨åˆ›å»ºåŸºå‡†æµ‹è¯•æˆ–å¾®åŸºå‡†æµ‹è¯•æ—¶å—åˆ°äº†å…¶ä»–å› ç´ çš„å½±å“ã€‚ å¾®åŸºå‡†æµ‹è¯•ä¸­æœ‰ä¸€ä¸ªæƒ¯ä¾‹,å³åœ¨å¼€å§‹é‡‡æ ·é—´éš”å¼€å§‹è®¡æ—¶ä¹‹å‰,å…ˆè°ƒç”¨å‡ æ¬¡ System.gc()ã€‚å¤šæ¬¡è°ƒç”¨ System.gc()çš„ç›®çš„æ˜¯å¸Œæœ›é€šè¿‡Javaå¯¹è±¡çš„ç»ˆç»“æ–¹æ³•é‡Šæ”¾å†…å­˜,è€Œè¿™å¾€å¾€éœ€è¦è¿›è¡Œå¤šæ¬¡åžƒåœ¾æ”¶é›†æ‰èƒ½å®Œæˆã€‚æ­¤å¤–,å½“å¯¹è±¡ä¸å¯è¾¾,å¯¼è‡´ç»ˆç»“æ–¹æ³•ä¸€ç›´å¤„äºŽç­‰å¾…é˜Ÿåˆ—,æˆ–è€…éƒ¨åˆ†æ‰§è¡Œé˜Ÿåˆ—ä¸­,è°ƒç”¨System.runFinalization()æŽ¥å£å¯ä»¥è¯·æ±‚JVMæ‰§è¡Œå…¶fina1ize()æ–¹æ³•,å®Œæˆåžƒåœ¾æ”¶é›†ã€‚ ä½¿ç”¨Java TimeæŽ¥å£å¼•å…¥æ–°çš„System.nanoTime()æŽ¥å£ä¹‹å‰,å¤§å¤šæ•°çš„JavaåŸºå‡†æµ‹è¯•æˆ–å¾®åŸºå‡†æµ‹è¯•éƒ½ä½¿ç”¨System.currentTimeMillis()æŽ¥å£èŽ·å–é‡‡æ ·é—´éš”çš„å¼€å§‹å’Œç»ˆæ­¢æ—¶é—´,æ ¹æ®ç»ˆæ­¢æ—¶é—´ä¸Žå¼€å§‹æ—¶é—´çš„é—´éš”å¾—åˆ°è¿è¡Œå…³æ³¨çš„ä»£ç æ‰€æ¶ˆè€—çš„æ—¶é—´ä½¿ç”¨Javaçš„System.currentTimeMillis()å’ŒSystem.nanoTime()æŽ¥å£éƒ½æœ‰ä¸€å®šç¨‹åº¦çš„ç²¾åº¦é—®é¢˜ã€‚è™½ç„¶ System.currentTimeMillis()çš„è¿”å›žå€¼æ˜¯ä»¥äº³ç§’è®¡çš„å½“å‰æ—¶é—´,ä½†æ¯«ç§’çº§çš„ç²¾åº¦å´å–å†³äºŽæ“ä½œç³»ç»Ÿã€‚Java API Specificationä¸­å¯¹äºŽSystem.currentTimeMillis()æœ‰æ˜Žç¡®çš„é™ˆè¿°:è™½ç„¶è¯¥æŽ¥å£çš„è¿”å›žå€¼æ˜¯æ¯«ç§’,ä½†è¿”å›žå€¼çš„ç²’åº¦å–å†³äºŽåº•å±‚çš„æ“ä½œç³»ç»Ÿã€‚è¿™ä¸€è§„èŒƒä¸ºæ“ä½œç³»ç»Ÿä½¿ç”¨è‡ªèº«çš„äº³ç§’çº§ç³»ç»ŸæŽ¥å£æä¾›äº†æ–¹ä¾¿,ä½†æ˜¯å¯èƒ½å­˜åœ¨è¿™æ ·çš„æƒ…å†µ,å°½ç®¡ä½¿ç”¨çš„æ˜¯æ¯«ç§’è®¡æ•°å™¨,ä½†æ˜¯æ›´æ–°é—´éš”å´è¿‡å¤§,è­¬å¦‚æ¯30æ¯«ç§’æ›´æ–°ä¸€æ¬¡ã€‚è¿™ä¸ªè§„èŒƒæœ‰æ„åœ°è§„å®šå¾—æ¯”è¾ƒå®½æ¾,è¯•å›¾è®©Java APIå°½å¯èƒ½åœ°æ”¯æŒæ›´å¤šçš„æ“ä½œç³»ç»Ÿ,å…¶ä¸­å°±åŒ…å«ä¸€äº›æ— æ³•æä¾›æ¯«ç§’çº§æ—¶é’Ÿç²¾åº¦çš„æ“ä½œç³»ç»Ÿã€‚ä½¿ç”¨Java API System. nanoTime()ä¹Ÿæœ‰ç±»ä¼¼çš„é—®é¢˜ã€‚è™½ç„¶è¯¥æ–¹æ³•æä¾›äº†çº³ç§’çº§çš„ç²¾åº¦,ä½†æŽ¥å£å¹¶ä¸ä¿è¯æä¾›çº³ç§’çº§çš„ç²¾åº¦: System.nanoTime()çš„ Java API Specificationä¸­æ˜Žç¡®æåˆ°ä¸ä¿è¯System.nanoTime()è¿”å›žå€¼çš„æ›´æ–°é¢‘åº¦ã€‚ å› æ­¤,ä½¿ç”¨System.currentTimeMillis()è®¡ç®—æ—¶é—´æ¶ˆè€—æ—¶,é‡‡æ ·çš„æ—¶é—´é—´éš”åº”è¯¥è¶³å¤Ÿå¤§,å°½é‡å‡å°‘System, currentTimeMillis()ç²¾åº¦å¸¦æ¥çš„å½±å“ã€‚ä¹Ÿå³æ˜¯è¯´,é‡‡æ ·çš„æ—¶é—´é—´éš”éœ€è¦æ¯”æ¯«ç§’å¤§(è­¬å¦‚å‡ ç§’ã€æˆ–è€…å°½å¯èƒ½å‡ åˆ†é’Ÿ)åŒæ ·çš„åŽŸåˆ™ä¹Ÿé€‚ç”¨äºŽ System.nanoTime()ã€‚æ ¹æ® jJava API Specification,System.nanoTime()ä¾èµ–åº•å±‚çš„æ“ä½œç³»ç»Ÿ,è¿”å›žç³»ç»Ÿä¸­å¯ç”¨çš„æœ€ç²¾ç¡®æ—¶é’Ÿçš„å½“å‰å€¼ã€‚ç„¶è€Œ,æœ€ç²¾ç¡®çš„å¯ç”¨ç³»ç»Ÿæ—¶é’Ÿå¯èƒ½ä¹Ÿæ²¡æœ‰çº³ç§’çº§çš„ç²¾åº¦ã€‚è¿›è¡ŒåŸºå‡†æµ‹è¯•æ—¶,å»ºè®®é¦–å…ˆæ‘¸æ¸…æ¥šè¿™ä¸¤ä¸ªJava APIåœ¨å¯¹åº”å¹³å°æˆ–æ“ä½œç³»ç»Ÿä¸Šçš„ç²’åº¦æˆ–ç²¾åº¦ã€‚å¦‚æžœä½ ä¸æ˜¯å¾ˆæ¸…æ¥š,ä½†æ‰‹é‡Œæœ‰æºä»£ç ,å¯ä»¥é€šè¿‡æŸ¥çœ‹è¿™ä¸¤ä¸ªAPIçš„åº•å±‚å®žçŽ°,äº†è§£å…¶ç²’åº¦å’Œç²¾åº¦ã€‚å¦‚æžœä½ ä½¿ç”¨ System.currentTimeMillis(æˆ–System.nanoTime())ã€‚è€Œä¸”é‡‡æ ·æ—¶é—´é—´éš”å¾ˆçŸ­(ç›¸å¯¹äºŽæ¯«ç§’æˆ–çº³ç§’æ¥è®²),è¦ç‰¹åˆ«æ³¨æ„è¿™ä¸ªé—®é¢˜ã€‚ å¾®åŸºå‡†æµ‹è¯•æ—¶,ä½¿ç”¨System.nanoTime()èŽ·å–å¯åŠ¨å’Œç»ˆæ­¢æ—¶é—´è®¡ç®—é‡‡æ ·é—´éš”æ˜¯ä¸€ç§å¥½æ–¹æ³•ã€‚æŽ¥ç€è®¡ç®—ç»ˆæ­¢ä¸Žå¯åŠ¨çš„æ—¶é—´å·®å°±å¯ä»¥å¾—åˆ°å¾®åŸºå‡†æµ‹è¯•çš„è€—æ—¶,ä»¥åŠæ¯æ¬¡æ“ä½œé€‰ä»£æ‰€æ¶ˆè€—çš„çº³ç§’æ•°æˆ–è€…æ¯ç§’æ‰€å‘ç”Ÿçš„è¿­ä»£æ¬¡æ•°ã€‚æœ€é‡è¦çš„æ˜¯è¦ç¡®ä¿å¾®åŸºå‡†æµ‹è¯•è¿è¡Œçš„æ—¶é—´è¦è¶³å¤Ÿé•¿,ç¡®ä¿åº”ç”¨ç¨‹åºè¿è¡Œå·²è¾¾ç¨³å®šæ€ä¸”é‡‡æ ·çš„æ—¶é—´ä¹Ÿè¶³å¤Ÿé•¿ã€‚ å‰”é™¤æ— æ•ˆä»£ç ä¸ºäº†é¿å…å¾®åŸºå‡†æµ‹è¯•ä¸­çš„ä»£ç è¢«å®šæ€§ä¸ºæ— æ•ˆä»£ç ,å¼•å‘è¿‡åº¦ç®€åŒ–çš„é—®é¢˜,å¯ä»¥é‡‡ç”¨ä¸‹é¢çš„ç¼–ç¨‹å®žè·µï¼š è®©è¯¥æ–¹æ³•å˜å¾—å¿…ä¸å¯å°‘ åœ¨é‡†æ ·é˜¶æ®µç»“æŸæ—¶ç›´æŽ¥è¾“å‡ºè®¡ç®—çš„ç»“æžœ,æˆ–è€…ä¿å­˜è¯¥è®¡ç®—ç»“æžœ,åœ¨é‡‡æ ·é˜¶æ®µç»“æŸåŽè¾“å‡ºè¯¥å€¼ è¦ä½¿è®¡ç®—æœ‰æ„ä¹‰,å°±è¦å‘è¢«æµ‹æ–¹æ³•ä¼ å…¥å‚æ•°,å¹¶ä»Žè¢«æµ‹æ–¹æ³•è¿”å›žè®¡ç®—ç»“æžœã€‚æ­¤å¤–,åœ¨åŸºå‡†æµ‹è¯•é‡‡æ ·é˜¶æ®µå†…æˆ–åœ¨å¤šä¸ªä¸åŒçš„åŸºå‡†æµ‹è¯•é‡‡æ ·é˜¶æ®µé—´å˜æ¢è¿­ä»£æ¬¡æ•°ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ³•,ç„¶åŽæ¯”è¾ƒæ¯æ¯«ç§’å†…å‘ç”Ÿçš„è¿­ä»£æ¬¡æ•°,åˆ¤æ–­è¿­ä»£æ¬¡æ•°æ˜¯å¦ä¿æŒæ’å®š,åŒæ—¶ä½¿ç”¨-XX:+PrintCompilationé€‰é¡¹è¿½è¸ªè®°å½•JITç¼–è¯‘å™¨çš„çŠ¶æ€ã€‚ å†…è”HotSpot VMçš„Clientå’ŒServer JITç¼–è¯‘å™¨éƒ½èƒ½å¯¹æ–¹æ³•è¿›è¡Œå†…è”ã€‚è¿™æ„å‘³ç€è°ƒç”¨è¿‡ç¨‹ä¸­,ç›®æ ‡æ–¹æ³•ä¼šè¢«å±•å¼€åˆ°è°ƒç”¨æ–¹æ³•ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±Jç¼–è¯‘å™¨å®Œæˆçš„,Jç¼–è¯‘å™¨é€šè¿‡é™ä½Žæ–¹æ³•è°ƒç”¨çš„å¼€é”€æå‡æ‰§è¡Œæ€§èƒ½ã€‚æ­¤å¤–,å†…è”çš„ä»£ç å¯èƒ½æä¾›æ›´å¤šçš„ä¼˜åŒ–æœºä¼š,æ•´åˆåŽçš„ä»£ç å¯èƒ½æ›´ç®€å•,æˆ–è€…æ¶ˆé™¤äº†æ— æ•ˆè°ƒç”¨,è€Œè¿™äº›åœ¨ä¸å†…è”çš„æƒ…å†µä¸‹æ˜¯æ— æ³•å®žçŽ°çš„ã€‚å†…è”åœ¨å¾®åŸºå‡†æµ‹è¯•ä¸­è¿˜å¯èƒ½å®žçŽ°è®©äººçœ¼å‰ä¸€äº®çš„æ€§èƒ½æå‡ã€‚ 12-XX:+PrintInlining-XX:MaxInlineSize=N é€†ä¼˜åŒ–JITç¼–è¯‘å™¨ä»¥å…¶æ‰§è¡Œä¼˜åŒ–çš„èƒ½åŠ›è€Œè‘—ç§°äºŽä¸–ã€‚ä½†æ˜¯,æŸäº›åœºæ™¯ä¸‹JITç¼–è¯‘å™¨ä¹Ÿä¼šè¿›è¡Œâ€œé€†ä¼˜åŒ–â€ã€‚è­¬å¦‚,Javaåº”ç”¨ä¸€æ—¦å¼€å§‹è¿è¡Œ,æ–¹æ³•è°ƒç”¨å˜å¾—é¢‘ç¹;JITç¼–è¯‘å™¨å°±å¯ä»¥æ ¹æ®ä»Žç¨‹åºè¿‡ç¨‹ä¸­äº†è§£åˆ°çš„ä¿¡æ¯åšå‡ºä¼˜åŒ–å†³ç­–ã€‚æœ‰äº›æ—¶å€™,ä¼˜åŒ–çš„å†³ç­–åœ¨åŽç»­å¯èƒ½è¢«è¯æ˜Žæ˜¯é”™è¯¯çš„ã€‚å½“JITç¼–è¯‘å™¨å‘çŽ°ä¹‹å‰çš„ä¼˜åŒ–ä½œäº†é”™è¯¯çš„ä¼˜åŒ–å†³ç­–æ—¶å°±ä¼šè¿›è¡Œé€†ä¼˜åŒ–ã€‚å¾ˆå¤šæ—¶å€™,åœ¨JITç¼–è¯‘å™¨é€†ä¼˜åŒ–ä¸ä¹…ä¹‹åŽ(ä¸€æ—¦è¾¾åˆ°ä¸€å®šçš„æ‰§è¡Œæ¬¡æ•°é˜ˆå€¼)å°±ä¼šæŽ¥ç€å†æ¬¡è¿›è¡Œä¼˜åŒ–ã€‚å¿½è§†å‘ç”Ÿçš„é€†ä¼˜åŒ–å¯èƒ½å¾—å‡ºé”™è¯¯çš„æ€§èƒ½ç»“è®ºã€‚ ä½¿ç”¨-XX:+PrintCompilationé€‰é¡¹å¯ä»¥å¸®åŠ©ç¡®å®šæ˜¯å¦å‘ç”Ÿäº†é€†ä¼˜åŒ–ã€‚-XX:+Printcompilationé€‰é¡¹çš„è¾“å‡ºä¸­å¦‚æžœåŒ…å«â€œmad not entrantâ€,å³è¡¨æ˜Žä¹‹å‰çš„ç¼–è¯‘ä¼˜åŒ–è¢«ä¸¢å¼ƒäº†,æ–¹æ³•å°†é€šè¿‡è§£é‡Šå™¨è¿è¡Œ,ç›´åˆ°è¯¥æ–¹æ³•æ‰§è¡Œè¶³å¤Ÿçš„æ¬¡æ•°å†è§¦å‘ä¼˜åŒ–ã€‚ è½¯ä»¶å¼€å‘è€…åº”è¯¥ä¸“æ³¨äºŽä¼˜ç§€çš„è½¯ä»¶æž¶æž„ã€è®¾è®¡ä»¥åŠå®žçŽ°,æ²¡æœ‰å¿…è¦è¿‡åº¦æ‹…å¿§çŽ°ä»£JITç¼–è¯‘å™¨çš„å½±å“ã€‚å¦‚æžœå¯¹è½¯ä»¶æž¶æž„ã€è®¾è®¡æˆ–å®žçŽ°çš„ä¿®æ”¹æ˜¯ä¸ºäº†å…‹æœJITç¼–è¯‘å™¨çš„ä¸€äº›æ€§è´¨,å°±åº”è¯¥è€ƒè™‘è¿™æ˜¯JITç¼–è¯‘å™¨çš„ç¼ºé™·æˆ–ä¸è¶³ã€‚ åˆ›å»ºå¾®åŸºå‡†æµ‹è¯•çš„æ³¨æ„äº‹é¡¹ æ˜Žç¡®ä½ éœ€è¦äº†è§£çš„æ€§èƒ½æŒ‡æ ‡æ˜¯ä»€ä¹ˆ,è®¾è®¡ç›¸åº”çš„å®žéªŒå†‹ç­”ä½ éœ€è¦è§£å†³çš„å†‹é¢˜ã€‚ä¸è¦å—äº›æ— å…³ç—›ç—’çš„å› ç´ å½±å“è€Œå¿½ç•¥äº†ä½ çœŸæ­£éœ€è¦è§£å†³çš„é—®é¢˜ã€‚ ç¡®ä¿é‡‡æ ·é˜¶æ®µä¸­æ¯æ¬¡ä½¿ç”¨åŒæ ·çš„å·¥ä½œé‡ã€‚ è®¡ç®—å¹¶æ”¶é›†å¤šç§æ€§èƒ½æŒ‡æ ‡,è­¬å¦‚æ¶ˆè€—æ—¶é—´ã€å•ä½æ—¶å†‹è¿­ä»£æ¬¡æ•°æˆ–æ¯æ¬¡è¿­ä»£çš„æ¶ˆè€—æ—¶é—´ç”¨åœ¨é¢„çƒ­é˜¶æ®µä¹‹åŽ,é‡‡æ ·é˜¶æ®µæœŸé—´è®°å½•çš„æ€§èƒ½æŒ‡æ ‡ã€‚ç•™æ„åº¦é‡æ—¶é—´çš„ç²¾åº¦å’Œç²’åº¦,ç‰¹åˆ«æ˜¯ä½¿ç”¨äº†System.currentTimeMi1lis()å’Œ System.nanoTime()å†µã€‚å¤šæ¬¡è¿è¡Œè¯•éªŒ,å¹¶å˜æ¢é‡‡æ ·çš„å‘¨æœŸæ•°æˆ–é‡†æ ·çš„æŒç»­æ—¶é—´ã€‚ä¹‹åŽå†æ¯”è¾ƒå…¶æ‰€æ¶ˆè€—çš„æ—¶é—´,å¯†åˆ‡æ³¨æ„å•ä½æ—¶é—´è¿­ä»£æ¬¡æ•°æˆ–æ¯è¿­ä»£æ¶ˆè€—æ—¶é—´æŒ‡æ ‡çš„å˜åŒ–ã€‚å¾®åŸºå‡†æµ‹è¯•ç»åŽ†äº†è¶³å¤Ÿçš„é¢„çƒ­ã€è¾¾åˆ°ç¨³å®šæ€æ—¶,åŽä¸€ä¸ªæŒ‡æ ‡å‡ ä¹Žåº”è¯¥ä¸Žé‡†æ ·é˜¶æ®µæŒç»­æ—¶é—´çš„å˜åŒ–ä¿æŒä¸€è‡´ã€‚ å¼€å§‹é‡†æ ·ä¹‹å‰ç¡®è®¤å¾®åŸºå‡†æµ‹è¯•å·²ç»åˆ°è¾¾ç¨³å®šæ€ã€‚å¯éµå¾ªçš„ä¸€æ¡é€šç”¨åŽŸåˆ™æ˜¯,ç¡®ä¿å¾®åŸºå‡†æµ‹è¯•è‡³å°‘è¿è¡Œ10ç§’ä»¥ä¸Šã€‚ä½¿ç”¨ HotSpotçš„-XX:+PrintCompilationé€‰é¡¹é€šè¿‡æ’å…¥è¡¨ç¤ºå¾®åŸºå‡†æµ‹è¯•æ‰§è¡Œé˜¶æ®µçš„å·¥å…·å¯ä»¥å¸®åŠ©ç¡®è®¤åŸºå‡†æµ‹è¯•å·²ç»åˆ°è¾¾ç¨³å®šæ€ã€‚è¿™ä¸€æ­¥çš„æ—¥çš„æ˜¯ç¡®ä¿åœ¨å¼€å§‹é‡‡æ ·ä¹‹å‰,å¾®åŸºå‡†æµ‹è¯•ç»è¿‡å……åˆ†é¢„çƒ­,åœ¨é‡‡æ ·é˜¶æ®µä¸ä¼šå‘ç”Ÿè¿›ä¸€æ­¥çš„ä¼˜åŒ–æˆ–é€†ä¼˜åŒ–äº‹ä»¶ã€‚ å¤šæ¬¡è¿è¡ŒåŸºå‡†æµ‹è¯•ä»¥ç¡®ä¿è§‚æµ‹çš„ç»“æžœæ˜¯å¯é‡å¤çš„ã€‚å¤šæ¬¡è¿è¡Œå¯ä»¥ä¸ºä½ æœ€ç»ˆçš„ç»“è®ºæä¾›æœ‰åŠ›æ”¯æŒã€‚ è¿è¡Œå®žéªŒåŠè§‚æµ‹ç»“æžœæ—¶ç‰¹åˆ«è¦ç•™æ„å¾—åˆ°çš„ç»“æžœæ˜¯å¦åˆç†ã€‚å¦‚æžœç¢°åˆ°æ— æ³•è§£é‡Šæˆ–å¯ç–‘çš„ç»“æžœ,è¦èŠ±æ—¶é—´åŽ»ç ”ç©¶ã€å›žé¡¾å®žéªŒçš„è®¾è®¡,ç¡®ä¿è§‚å¯Ÿçš„ç»“æžœåˆç†ã€‚ é€šè¿‡ä¼ é€’éšæ—¶å˜åŒ–çš„å‚æ•°åˆ°å…³æ³¨çš„æ–¹æ³•ä¸­ã€è¿”å›žå…³æ³¨æ–¹æ³•çš„æ‰§è¡Œç»“æžœã€åœ¨é‡‡æ ·å‘¨æœŸä¹‹å¤–æ‰“å°è¾“å‡ºè®¡ç®—ç»“æžœä½¿è®¡ç®—æ›´æœ‰æ„ä¹‰,é¿å…åœ¨å¾®åŸºå‡†æµ‹è¯•ä¸­åˆ›å»ºæ— æ•ˆä»£ç ã€‚ ç•™æ„å†…è”å¯èƒ½å¯¹å¾®åŸºå‡†æµ‹è¯•äº§ç”Ÿçš„å½±å“ã€‚å¦‚æžœå¯¹ç»“æžœå­˜ç–‘,å¯ä»¥é€šè¿‡XX:+PrintInliningå’Œ-XX:+PrintCompilationå‘½ä»¤è¡Œé€‰é¡¹,åˆ©ç”¨HotSpot Debug VMè§‚å¯ŸHotSpot JITç¼–è¯‘å™¨è¿›è¡Œå†…è”å†³ç­–çš„è¿‡ç¨‹ã€‚ ç¡®ä¿æ‰§è¡Œå¾®åŸºå‡†æµ‹è¯•æ—¶å…¶ä»–çš„åº”ç”¨ç¨‹åºä¸ä¼šå¯¹ç³»ç»Ÿé€ æˆå½±å“ã€‚æ‰§è¡Œå¾®åŸºå‡†æµ‹è¯•æ—¶å³ä½¿å‘æ¡Œé¢çª—å£ç®¡ç†å™¨ä¸­æ·»åŠ å¾ˆå°æˆ–è€…å¾ˆç®€å•çš„åº”ç”¨ç¨‹åº(è­¬å¦‚å¤©æ°”åº”ç”¨æˆ–è€…è‚¡ç¥¨è¡Œæƒ…è®°å½•è½¯ä»¶),éƒ½ä¼šå¯¹ç³»ç»Ÿæ€§èƒ½é€ æˆå½±å“ã€‚ å½“ä½ éœ€è¦å¾ˆæ˜Žç¡®åœ°äº†è§£JITç¼–è¯‘å™¨ç”Ÿæˆäº†ä»€ä¹ˆæ ·çš„ä¼˜åŒ–ä»£ç æ—¶,å¯ä»¥ä½¿ç”¨Oracle Solaris Studio Performance Analyzeræˆ–è€…HotSpot Debug VM(ä½¿ç”¨-XX:+PrintOptoAssemblyé€‰é¡¹)æŸ¥çœ‹ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ã€‚ é‡‡ç”¨å°æ•°æ®é›†æˆ–æ•°æ®ç»“æž„çš„å¾®åŸºå‡†æµ‹è¯•å—ç¼“å­˜çš„å½±å“å¾ˆå¤§ã€‚å¾®åŸºå‡†æµ‹è¯•çš„ç»“æžœå¯èƒ½æ¯æ¬¡æ‰§è¡Œéƒ½ä¸ä¸€æ ·,åœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œç»“æžœä¹Ÿå·®åˆ«å¾ˆå¤§ã€‚ å¯¹äºŽé‡‡ç”¨å¤šçº¿ç¨‹çš„å¾®åŸºå‡†æµ‹è¯•éœ€è¦æ„è¯†åˆ°çº¿ç¨‹è°ƒåº¦å¯èƒ½ä¸æ˜¯ç¡®å®šæ€§çš„,ç‰¹åˆ«æ˜¯åœ¨è´Ÿè·è¾ƒé‡çš„æƒ…å†µä¸‹ã€‚ PDFä¹¦ç±ä¸‹è½½åœ°å€ï¼šhttps://github.com/jiankunking/books-recommendation/tree/master/Java]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Performance</tag>
        <tag>GC</tag>
        <tag>JVM</tag>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Arthas å­¦ä¹ ç¬”è®°]]></title>
    <url>%2Farthas-learning-notes.html</url>
    <content type="text"><![CDATA[é˜¿é‡Œ Arthas å­¦ä¹ ç¬”è®° threadæŸ¥çœ‹å½“å‰çº¿ç¨‹ä¿¡æ¯ï¼ŒæŸ¥çœ‹çº¿ç¨‹çš„å †æ ˆã€‚ å‚æ•°è¯´æ˜Žï¼š å‚æ•°åç§° å‚æ•°è¯´æ˜Ž ç¤ºä¾‹ id çº¿ç¨‹id [n:] æŒ‡å®šæœ€å¿™çš„å‰Nä¸ªçº¿ç¨‹å¹¶æ‰“å°å †æ ˆ thread -n 3 [b] æ‰¾å‡ºå½“å‰é˜»å¡žå…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹ thread -b [i ] æŒ‡å®šcpuå æ¯”ç»Ÿè®¡çš„é‡‡æ ·é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’ æ³¨æ„ï¼Œ ç›®å‰åªæ”¯æŒæ‰¾å‡ºsynchronizedå…³é”®å­—é˜»å¡žä½çš„çº¿ç¨‹ï¼Œ å¦‚æžœæ˜¯java.util.concurrent.Lockï¼Œ ç›®å‰è¿˜ä¸æ”¯æŒã€‚ jvmæŸ¥çœ‹å½“å‰JVMä¿¡æ¯ã€‚ ä½¿ç”¨å‚è€ƒï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293$ jvm RUNTIME ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- MACHINE-NAME 1@9db2689bb4d6 JVM-START-TIME 2019-07-16 18:18:06 MANAGEMENT-SPEC-VERSION 2.0 SPEC-NAME Java Virtual Machine Specification SPEC-VENDOR Oracle Corporation SPEC-VERSION 12 VM-NAME OpenJDK 64-Bit Server VM VM-VENDOR Oracle Corporation VM-VERSION 12.0.1+12 INPUT-ARGUMENTS -XX:G1PeriodicGCInterval=120000 -XX:G1PeriodicGCSystemLoadThreshold=0 CLASS-PATH application.jar BOOT-CLASS-PATH LIBRARY-PATH /usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- CLASS-LOADING ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- LOADED-CLASS-COUNT 11046 TOTAL-LOADED-CLASS-COUNT 11377 UNLOADED-CLASS-COUNT 331 IS-VERBOSE false ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- COMPILATION ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- NAME HotSpot 64-Bit Tiered Compilers TOTAL-COMPILE-TIME 74558(ms) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- GARBAGE-COLLECTORS ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- G1 Young Generation 12027/52593(ms) [count/time] G1 Old Generation 0/0(ms) [count/time] ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- MEMORY-MANAGERS ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- CodeCacheManager CodeHeap &apos;non-nmethods&apos; CodeHeap &apos;profiled nmethods&apos; CodeHeap &apos;non-profiled nmethods&apos; Metaspace Manager Metaspace Compressed Class Space G1 Young Generation G1 Eden Space G1 Survivor Space G1 Old Gen G1 Old Generation G1 Eden Space G1 Survivor Space G1 Old Gen ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- MEMORY ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- HEAP-MEMORY-USAGE 184549376(176.00 MiB)/2113929216(1.97 GiB)/32178700288(29.97 GiB)/60812520(58.00 MiB) [committed/init/max/used] NO-HEAP-MEMORY-USAGE 115539968(110.19 MiB)/7667712(7.31 MiB)/-1(-1 B)/108227072(103.21 MiB) [committed/init/max/used] PENDING-FINALIZE-COUNT 0 ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- OPERATING-SYSTEM ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- OS Linux ARCH amd64 PROCESSORS-COUNT 32 LOAD-AVERAGE 2.25 VERSION 3.10.0-514.26.2.el7.x86_64 ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- THREAD ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- COUNT 1060 DAEMON-COUNT 25 PEAK-COUNT 1062 STARTED-COUNT 2463 DEADLOCK-COUNT 0 ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- FILE-DESCRIPTOR ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- MAX-FILE-DESCRIPTOR-COUNT -1 OPEN-FILE-DESCRIPTOR-COUNT -1 Affect(row-cnt:0) cost in 14 ms. syspropæŸ¥çœ‹å½“å‰JVMçš„ç³»ç»Ÿå±žæ€§(System Property)ã€‚ ä¸Žjinfo ä¿¡æ¯ç±»ä¼¼ï¼Œä¸è¿‡syspropæä¾›ä¿®æ”¹å•ä¸ªå±žæ€§å€¼çš„åŠŸèƒ½ã€‚ æŸ¥çœ‹å•ä¸ªå±žæ€§ï¼Œæ”¯æŒé€šè¿‡TABé”®è‡ªåŠ¨è¡¥å…¨ã€‚ sysenvæŸ¥çœ‹å½“å‰JVMçš„çŽ¯å¢ƒå±žæ€§(System Environment Variables)ã€‚ æŸ¥çœ‹å•ä¸ªå±žæ€§ï¼Œæ”¯æŒé€šè¿‡TABé”®è‡ªåŠ¨è¡¥å…¨ã€‚ scã€smã€jadscæŸ¥çœ‹JVMå·²åŠ è½½çš„ç±»ä¿¡æ¯,å¯ä»¥packageå‰ç¼€æ¨¡ç³ŠåŒ¹é…ã€‚ smæŸ¥çœ‹å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯ã€‚ 1234567891011121314$ monitor com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWordPress Q or Ctrl+C to abort.Affect(class-cnt:1 , method-cnt:1) cost in 90 ms. timestamp class method total success fail avg-rt(ms) fail-rate --------------------------------------------------------------------------------------------------------------------------------------------- 2019-08-02 10:37:50 com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWord 61 61 0 96.68 0.00% timestamp class method total success fail avg-rt(ms) fail-rate --------------------------------------------------------------------------------------------------------------------------------------------- 2019-08-02 10:38:50 com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWord 27 27 0 51.06 0.00% timestamp class method total success fail avg-rt(ms) fail-rate --------------------------------------------------------------------------------------------------------------------------------------------- 2019-08-02 10:39:50 com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWord 0 0 0 0.00 0.00% jadåç¼–è¯‘æŒ‡å®šå·²åŠ è½½ç±»çš„æºç ã€‚ jad å‘½ä»¤å°† JVM ä¸­å®žé™…è¿è¡Œçš„ class çš„ byte code åç¼–è¯‘æˆ java ä»£ç ï¼Œä¾¿äºŽä½ ç†è§£ä¸šåŠ¡é€»è¾‘ï¼› åœ¨ Arthas Console ä¸Šï¼Œåç¼–è¯‘å‡ºæ¥çš„æºç æ˜¯å¸¦è¯­æ³•é«˜äº®çš„ï¼Œé˜…è¯»æ›´æ–¹ä¾¿ å½“ç„¶ï¼Œåç¼–è¯‘å‡ºæ¥çš„ java ä»£ç å¯èƒ½ä¼šå­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œä½†ä¸å½±å“ä½ è¿›è¡Œé˜…è¯»ç†è§£ scã€smã€jad ä¸‰ä¸ªå‘½ä»¤å¯ä»¥ç»“åˆä½¿ç”¨ã€‚ classloaderæŸ¥çœ‹classloaderçš„ç»§æ‰¿æ ‘ï¼Œurlsï¼Œç±»åŠ è½½ä¿¡æ¯ã€‚ classloader å‘½ä»¤å°† JVM ä¸­æ‰€æœ‰çš„classloaderçš„ä¿¡æ¯ç»Ÿè®¡å‡ºæ¥ï¼Œå¹¶å¯ä»¥å±•ç¤ºç»§æ‰¿æ ‘ï¼Œurlsç­‰ã€‚ å¯ä»¥è®©æŒ‡å®šçš„classloaderåŽ»getResourcesï¼Œæ‰“å°å‡ºæ‰€æœ‰æŸ¥æ‰¾åˆ°çš„resourcesçš„urlã€‚å¯¹äºŽResourceNotFoundExceptionæ¯”è¾ƒæœ‰ç”¨ã€‚ mcã€redefinemcMemory Compiler/å†…å­˜ç¼–è¯‘å™¨ï¼Œç¼–è¯‘.javaæ–‡ä»¶ç”Ÿæˆ.classã€‚ redefineåŠ è½½å¤–éƒ¨çš„.classæ–‡ä»¶ï¼Œredefine jvmå·²åŠ è½½çš„ç±»ã€‚ mcã€redefine å¯ä»¥ç»“åˆä½¿ç”¨ monitor1234567891011121314$ monitor com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWordPress Q or Ctrl+C to abort.Affect(class-cnt:1 , method-cnt:1) cost in 90 ms. timestamp class method total success fail avg-rt(ms) fail-rate --------------------------------------------------------------------------------------------------------------------------------------------- 2019-08-02 10:37:50 com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWord 61 61 0 96.68 0.00% timestamp class method total success fail avg-rt(ms) fail-rate --------------------------------------------------------------------------------------------------------------------------------------------- 2019-08-02 10:38:50 com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWord 27 27 0 51.06 0.00% timestamp class method total success fail avg-rt(ms) fail-rate --------------------------------------------------------------------------------------------------------------------------------------------- 2019-08-02 10:39:50 com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWord 0 0 0 0.00 0.00% watchæ–¹æ³•æ‰§è¡Œæ•°æ®è§‚æµ‹ã€‚ è®©ä½ èƒ½æ–¹ä¾¿çš„è§‚å¯Ÿåˆ°æŒ‡å®šæ–¹æ³•çš„è°ƒç”¨æƒ…å†µã€‚èƒ½è§‚å¯Ÿåˆ°çš„èŒƒå›´ä¸ºï¼šè¿”å›žå€¼ã€æŠ›å‡ºå¼‚å¸¸ã€å…¥å‚ï¼Œé€šè¿‡ç¼–å†™OGNL è¡¨è¾¾å¼è¿›è¡Œå¯¹åº”å˜é‡çš„æŸ¥çœ‹ã€‚ è¿™ä¸ªæœ‰ç‚¹å¼ºå¤§å•Š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152$ watch com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWord &quot;&#123;params,target,returnObj&#125;&quot; -x 2 -b -s -n 2Press Q or Ctrl+C to abort.Affect(class-cnt:1 , method-cnt:1) cost in 111 ms.ts=2019-08-02 10:48:48; [cost=0.006503ms] result=@ArrayList[ @Object[][ @String[monitor], @String[console], null, @String[all], @String[all], null, null, @Integer[100], @Long[1564713816522], @Long[1564714116522], null, @[desc], ], @LogSearchService[ log=@Logger[Logger[com.jiankunking.logsearch.services.LogSearchService]], esFilterService=@ESFilterService[com.jiankunking.logsearch.services.ESFilterService@58ebfd03], indexPrefixService=@IndexPrefixService[com.jiankunking.logsearch.services.IndexPrefixService@19fb8826], searchAfterSort=@String[][isEmpty=false;size=3], ], null,]ts=2019-08-02 10:48:48; [cost=91.878471ms] result=@ArrayList[ @Object[][ @String[monitor], @String[console], null, @String[all], @String[all], null, null, @Integer[100], @Long[1564713816522], @Long[1564714116522], null, @[desc], ], @LogSearchService[ log=@Logger[Logger[com.jiankunking.logsearch.services.LogSearchService]], esFilterService=@ESFilterService[com.jiankunking.logsearch.services.ESFilterService@58ebfd03], indexPrefixService=@IndexPrefixService[com.jiankunking.logsearch.services.IndexPrefixService@19fb8826], searchAfterSort=@String[][isEmpty=false;size=3], ], @SearchResult[ metadata=@MetaData[MetaData(total=21431)], items=@ArrayList[isEmpty=false;size=100], ],] traceæ–¹æ³•å†…éƒ¨è°ƒç”¨è·¯å¾„ï¼Œå¹¶è¾“å‡ºæ–¹æ³•è·¯å¾„ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè€—æ—¶ trace å‘½ä»¤èƒ½ä¸»åŠ¨æœç´¢ class-patternï¼method-pattern å¯¹åº”çš„æ–¹æ³•è°ƒç”¨è·¯å¾„ï¼Œæ¸²æŸ“å’Œç»Ÿè®¡æ•´ä¸ªè°ƒç”¨é“¾è·¯ä¸Šçš„æ‰€æœ‰æ€§èƒ½å¼€é”€å’Œè¿½è¸ªè°ƒç”¨é“¾è·¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384$ trace com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWord Press Q or Ctrl+C to abort.Affect(class-cnt:1 , method-cnt:1) cost in 182 ms.`---ts=2019-08-02 10:53:36;thread_name=http-nio-8080-exec-8;id=42d;is_daemon=true;priority=5;TCCL=org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@1095194 `---[416.520613ms] com.jiankunking.logsearch.services.LogSearchService:queryStringByKeyWord() +---[0.019415ms] org.elasticsearch.search.builder.SearchSourceBuilder:&lt;init&gt;() #78 +---[0.011853ms] org.elasticsearch.index.query.QueryBuilders:boolQuery() #79 +---[0.02617ms] com.jiankunking.logsearch.services.ESFilterService:addProjectFilter() #80 +---[0.005593ms] com.jiankunking.logsearch.util.StringUtils:isEmpty() #81 +---[0.006519ms] java.lang.String:equals() #81 +---[0.002157ms] com.jiankunking.logsearch.util.StringUtils:isEmpty() #84 +---[0.002046ms] java.lang.String:equals() #84 +---[0.004284ms] com.jiankunking.logsearch.util.StringUtils:isNotEmpty() #87 +---[0.002342ms] com.jiankunking.logsearch.util.StringUtils:isNotEmpty() #90 +---[0.002066ms] com.jiankunking.logsearch.util.StringUtils:isNotEmpty() #98 +---[0.005008ms] org.elasticsearch.index.query.QueryBuilders:rangeQuery() #114 +---[0.005904ms] com.jiankunking.logsearch.util.TimeUtils:toDate() #115 +---[0.006666ms] org.elasticsearch.index.query.RangeQueryBuilder:gte() #115 +---[0.002128ms] com.jiankunking.logsearch.util.TimeUtils:toDate() #116 +---[0.004161ms] org.elasticsearch.index.query.RangeQueryBuilder:lte() #116 +---[0.347063ms] org.elasticsearch.index.query.BoolQueryBuilder:must() #117 +---[min=0.002196ms,max=0.030129ms,total=0.036436ms,count=3] org.elasticsearch.search.builder.SearchSourceBuilder:sort() #126 +---[0.005683ms] org.elasticsearch.search.builder.SearchSourceBuilder:fetchSource() #131 +---[0.003406ms] org.elasticsearch.search.builder.SearchSourceBuilder:size() #133 +---[0.003613ms] org.elasticsearch.search.builder.SearchSourceBuilder:query() #133 +---[0.321264ms] org.elasticsearch.search.builder.SearchSourceBuilder:toString() #134 +---[0.00689ms] org.springframework.http.HttpMethod:name() #136 +---[0.172438ms] com.jiankunking.logsearch.services.IndexPrefixService:getIndexPrefix() #136 +---[0.012968ms] com.jiankunking.logsearch.util.ESQueryUtils:getEndpoint() #136 +---[398.953869ms] com.jiankunking.logsearch.util.ESQueryUtils:performRequest() #136 +---[0.336319ms] com.alibaba.fastjson.JSON:parse() #138 +---[min=0.002461ms,max=0.013798ms,total=0.016259ms,count=2] java.util.Map:get() #140 +---[0.006434ms] java.lang.Integer:intValue() #140 +---[min=0.001908ms,max=0.002073ms,total=0.003981ms,count=2] java.util.Map:get() #141 +---[0.007532ms] com.jiankunking.logsearch.dto.SearchResult:&lt;init&gt;() #145 +---[0.004286ms] java.util.ArrayList:&lt;init&gt;() #146 +---[0.005725ms] com.alibaba.fastjson.JSONArray:iterator() #148 +---[min=8.07E-4ms,max=0.010324ms,total=0.124433ms,count=101] java.util.Iterator:hasNext() #148 +---[min=8.16E-4ms,max=0.009674ms,total=0.114893ms,count=100] java.util.Iterator:next() #148 +---[min=8.38E-4ms,max=0.013835ms,total=0.130734ms,count=100] com.alibaba.fastjson.JSONObject:get() #150 +---[min=8.69E-4ms,max=0.005654ms,total=0.112518ms,count=100] com.jiankunking.logsearch.util.MapUtils:getSize() #151 +---[min=7.84E-4ms,max=0.005522ms,total=0.106345ms,count=100] java.util.HashMap:&lt;init&gt;() #151 +---[min=8.4E-4ms,max=0.016457ms,total=0.12907ms,count=100] com.alibaba.fastjson.JSONArray:iterator() #152 +---[min=8.21E-4ms,max=0.002612ms,total=0.106495ms,count=100] java.util.Iterator:hasNext() #152 +---[min=8.07E-4ms,max=0.018355ms,total=0.143992ms,count=100] java.util.Iterator:next() #152 +---[min=8.72E-4ms,max=0.008687ms,total=0.132524ms,count=100] java.lang.String:valueOf() #153 +---[min=8.07E-4ms,max=0.008049ms,total=0.110329ms,count=100] java.lang.String:contains() #153 +---[min=8.46E-4ms,max=0.002612ms,total=0.109295ms,count=100] java.lang.String:valueOf() #156 +---[min=8.86E-4ms,max=0.041239ms,total=0.178986ms,count=100] java.util.HashMap:put() #156 +---[min=7.96E-4ms,max=0.008521ms,total=0.113489ms,count=100] com.alibaba.fastjson.JSONObject:get() #159 +---[min=8.2E-4ms,max=0.016801ms,total=0.125154ms,count=100] java.util.Map:get() #159 +---[min=8.39E-4ms,max=0.002089ms,total=0.106842ms,count=100] java.util.HashMap:put() #159 +---[min=7.86E-4ms,max=0.002836ms,total=0.104852ms,count=100] com.alibaba.fastjson.JSONObject:get() #160 +---[min=8.4E-4ms,max=0.003068ms,total=0.10763ms,count=100] java.util.HashMap:put() #160 +---[min=8.02E-4ms,max=0.020112ms,total=0.122423ms,count=100] com.alibaba.fastjson.JSONObject:get() #161 +---[min=8.22E-4ms,max=0.001939ms,total=0.104809ms,count=100] java.util.HashMap:put() #161 +---[min=7.99E-4ms,max=0.00186ms,total=0.10316ms,count=100] com.alibaba.fastjson.JSONObject:get() #162 +---[min=8.17E-4ms,max=0.012238ms,total=0.115955ms,count=100] java.util.Map:get() #162 +---[min=8.14E-4ms,max=0.018342ms,total=0.124331ms,count=100] java.util.HashMap:put() #162 +---[min=8.47E-4ms,max=0.003852ms,total=0.113692ms,count=100] com.alibaba.fastjson.JSONObject:containsKey() #164 +---[min=8.11E-4ms,max=0.017145ms,total=0.122375ms,count=100] com.alibaba.fastjson.JSONObject:containsKey() #167 +---[min=7.85E-4ms,max=0.002459ms,total=0.10233ms,count=100] com.alibaba.fastjson.JSONObject:get() #167 +---[min=8.57E-4ms,max=0.005959ms,total=0.11281ms,count=100] java.util.Map:containsKey() #167 +---[min=7.86E-4ms,max=0.016889ms,total=0.116022ms,count=100] com.alibaba.fastjson.JSONObject:get() #171 +---[min=8.27E-4ms,max=0.007969ms,total=0.121529ms,count=100] java.util.Map:get() #171 +---[min=8.24E-4ms,max=0.017969ms,total=0.126264ms,count=100] java.util.Map:containsKey() #171 +---[min=7.83E-4ms,max=0.001924ms,total=0.101244ms,count=100] com.alibaba.fastjson.JSONObject:get() #172 +---[min=7.92E-4ms,max=0.247702ms,total=0.502606ms,count=200] java.util.Map:get() #172 +---[min=8.61E-4ms,max=0.010095ms,total=0.124106ms,count=100] java.util.HashMap:put() #172 +---[min=7.84E-4ms,max=0.002789ms,total=0.100561ms,count=100] com.alibaba.fastjson.JSONObject:get() #174 +---[min=8.18E-4ms,max=0.003825ms,total=0.105746ms,count=100] java.util.Map:get() #174 +---[min=8.17E-4ms,max=0.003044ms,total=0.108946ms,count=100] java.util.Map:containsKey() #174 +---[min=7.83E-4ms,max=0.010689ms,total=0.10957ms,count=100] com.alibaba.fastjson.JSONObject:get() #175 +---[min=7.92E-4ms,max=0.018299ms,total=0.225606ms,count=200] java.util.Map:get() #175 +---[min=8.53E-4ms,max=0.002182ms,total=0.108485ms,count=100] java.util.HashMap:put() #175 +---[min=7.84E-4ms,max=0.005874ms,total=0.103371ms,count=100] com.alibaba.fastjson.JSONObject:get() #177 +---[min=8.02E-4ms,max=0.002017ms,total=0.101695ms,count=100] java.util.Map:get() #177 +---[min=8.26E-4ms,max=0.002735ms,total=0.106121ms,count=100] java.util.Map:containsKey() #177 +---[min=8.0E-4ms,max=0.017176ms,total=0.130393ms,count=100] com.alibaba.fastjson.JSONObject:get() #178 +---[min=8.03E-4ms,max=0.003318ms,total=0.204767ms,count=200] java.util.Map:get() #178 +---[min=8.55E-4ms,max=0.008081ms,total=0.115006ms,count=100] java.util.HashMap:put() #178 +---[min=9.11E-4ms,max=0.014017ms,total=0.136197ms,count=100] java.util.List:add() #180 +---[0.005288ms] com.jiankunking.logsearch.dto.SearchResult:setItems() #182 `---[0.002643ms] com.jiankunking.logsearch.dto.SearchResult:setTotal() #183 stackè¾“å‡ºå½“å‰æ–¹æ³•è¢«è°ƒç”¨çš„è°ƒç”¨è·¯å¾„ã€‚ å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½çŸ¥é“ä¸€ä¸ªæ–¹æ³•è¢«æ‰§è¡Œï¼Œä½†è¿™ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„è·¯å¾„éžå¸¸å¤šï¼Œæˆ–è€…ä½ æ ¹æœ¬å°±ä¸çŸ¥é“è¿™ä¸ªæ–¹æ³•æ˜¯ä»Žé‚£é‡Œè¢«æ‰§è¡Œäº†ï¼Œæ­¤æ—¶ä½ éœ€è¦çš„æ˜¯ stack å‘½ä»¤ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475$ stack com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWord Press Q or Ctrl+C to abort.Affect(class-cnt:1 , method-cnt:1) cost in 173 ms.ts=2019-08-02 10:55:44;thread_name=http-nio-8080-exec-1;id=426;is_daemon=true;priority=5;TCCL=org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@1095194 @com.jiankunking.logsearch.controller.LogSearchController.searchByKeyWord() at com.jiankunking.logsearch.controller.LogSearchController$$FastClassBySpringCGLIB$$61775844.invoke(&lt;generated&gt;:-1) at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:746) at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88) at com.jiankunking.logsearch.aspect.ControllerTimeConsumeAspect.doAround(ControllerTimeConsumeAspect.java:34) at jdk.internal.reflect.GeneratedMethodAccessor91.invoke(null:-1) at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:567) at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644) at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633) at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70) at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:174) at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92) at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:185) at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688) at com.jiankunking.logsearch.controller.LogSearchController$$EnhancerBySpringCGLIB$$2f145034.searchByKeyWord(&lt;generated&gt;:-1) at jdk.internal.reflect.GeneratedMethodAccessor97.invoke(null:-1) at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:567) at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:209) at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:136) at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102) at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:891) at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:797) at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:991) at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:925) at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:974) at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:866) at javax.servlet.http.HttpServlet.service(HttpServlet.java:635) at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:851) at javax.servlet.http.HttpServlet.service(HttpServlet.java:742) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) at org.springframework.web.filter.HttpPutFormContentFilter.doFilterInternal(HttpPutFormContentFilter.java:109) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:198) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:493) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:81) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:800) at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66) at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:806) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1498) at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) at java.lang.Thread.run(Thread.java:835) ttæ–¹æ³•æ‰§è¡Œæ•°æ®çš„æ—¶ç©ºéš§é“ï¼Œè®°å½•ä¸‹æŒ‡å®šæ–¹æ³•æ¯æ¬¡è°ƒç”¨çš„å…¥å‚å’Œè¿”å›žä¿¡æ¯ï¼Œå¹¶èƒ½å¯¹è¿™äº›ä¸åŒçš„æ—¶é—´ä¸‹è°ƒç”¨è¿›è¡Œè§‚æµ‹ã€‚ optionså…¨å±€å¼€å…³ åç§° é»˜è®¤å€¼ æè¿° unsafe false æ˜¯å¦æ”¯æŒå¯¹ç³»ç»Ÿçº§åˆ«çš„ç±»è¿›è¡Œå¢žå¼ºï¼Œæ‰“å¼€è¯¥å¼€å…³å¯èƒ½å¯¼è‡´æŠŠJVMæžæŒ‚ï¼Œè¯·æ…Žé‡é€‰æ‹©ï¼ dump false æ˜¯å¦æ”¯æŒè¢«å¢žå¼ºäº†çš„ç±»dumpåˆ°å¤–éƒ¨æ–‡ä»¶ä¸­ï¼Œå¦‚æžœæ‰“å¼€å¼€å…³ï¼Œclassæ–‡ä»¶ä¼šè¢«dumpåˆ°/${application dir}/arthas-class-dump/ç›®å½•ä¸‹ï¼Œå…·ä½“ä½ç½®è¯¦è§æŽ§åˆ¶å°è¾“å‡º batch-re-transform true æ˜¯å¦æ”¯æŒæ‰¹é‡å¯¹åŒ¹é…åˆ°çš„ç±»æ‰§è¡Œretransformæ“ä½œ json-format false æ˜¯å¦æ”¯æŒjsonåŒ–çš„è¾“å‡º disable-sub-class false æ˜¯å¦ç¦ç”¨å­ç±»åŒ¹é…ï¼Œé»˜è®¤åœ¨åŒ¹é…ç›®æ ‡ç±»çš„æ—¶å€™ä¼šé»˜è®¤åŒ¹é…åˆ°å…¶å­ç±»ï¼Œå¦‚æžœæƒ³ç²¾ç¡®åŒ¹é…ï¼Œå¯ä»¥å…³é—­æ­¤å¼€å…³ debug-for-asm false æ‰“å°ASMç›¸å…³çš„è°ƒè¯•ä¿¡æ¯ save-result false æ˜¯å¦æ‰“å¼€æ‰§è¡Œç»“æžœå­˜æ—¥å¿—åŠŸèƒ½ï¼Œæ‰“å¼€ä¹‹åŽæ‰€æœ‰å‘½ä»¤çš„è¿è¡Œç»“æžœéƒ½å°†ä¿å­˜åˆ°/home/admin/logs/arthas/arthas.logä¸­ job-timeout id å¼‚æ­¥åŽå°ä»»åŠ¡çš„é»˜è®¤è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œä»»åŠ¡è‡ªåŠ¨åœæ­¢ï¼›æ¯”å¦‚è®¾ç½® 1d, 2h, 3m, 25sï¼Œåˆ†åˆ«ä»£è¡¨å¤©ã€å°æ—¶ã€åˆ†ã€ç§’]]></content>
      <categories>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>JVM</tag>
        <tag>Arthas</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç¨‹åºå‘˜å¸¸ç”¨è¯æ±‡]]></title>
    <url>%2Fcoder-vocabulary.html</url>
    <content type="text"><![CDATA[ä¸‹é¢æ˜¯å·¥ä½œä¸­ï¼Œç»å¸¸ç”¨åˆ°çš„ä¸€äº›è¯æ±‡ï¼ŒæŒç»­æ›´æ–° 1, abbreviation [É™briËvÉªâ€™eÉªÊƒ(É™)n]n. ç¼©å†™ï¼›ç¼©å†™è¯2, abruptlyadv. çªç„¶åœ°ï¼›å”çªåœ°3, absence [â€˜Ã¦bsns]n. æ²¡æœ‰ï¼›ç¼ºä¹ï¼›ç¼ºå¸­ï¼›ä¸æ³¨æ„4, absent [ËˆÃ¦bsnt;(for v.)É™bËˆsÉ›nt]adj. ç¼ºå¸­çš„ï¼›ç¼ºå°‘çš„ï¼›å¿ƒä¸åœ¨ç„‰çš„ï¼›èŒ«ç„¶çš„vt. ä½¿ç¼ºå¸­5, absorber [É™bâ€™sÉ”ËbÉ™]n. å‡éœ‡å™¨ï¼›å¸æ”¶å™¨ï¼›å¸æ”¶ä½“6, accessible [É™kâ€™sesÉªb(É™)l]adj. æ˜“æŽ¥è¿‘çš„ï¼›å¯è¿›å…¥çš„ï¼›å¯ç†è§£çš„7, accidental [Ã¦ksÉªâ€™dent(É™)l]adj. æ„å¤–çš„ï¼›å¶ç„¶çš„ï¼›é™„å±žçš„ï¼›ä¸´æ—¶è®°å·çš„;n. æ¬¡è¦æ–¹é¢ï¼›éžä¸»è¦çš„ç‰¹æ€§ï¼›ä¸´æ—¶è®°å·8, accomplished [É™â€™kÊŒmplÉªÊƒt; É™â€™kÉ’m-]adj. å®Œæˆçš„ï¼›ç†Ÿç»ƒçš„ï¼Œæœ‰æŠ€å·§çš„ï¼›æœ‰ä¿®å…»çš„ï¼›æœ‰å­¦é—®çš„9, accumulate [É™â€™kjumjÉ™let]vi. ç´¯ç§¯ï¼›ç§¯èšvt. ç§¯æ”’10, accumulation [É™,kjÊŠmjÉ™â€™leÊƒÉ™n]n. ç§¯èšï¼Œç´¯ç§¯ï¼›å †ç§¯ç‰©11, accuracy [â€˜Ã¦kjÊŠrÉ™sÉª]n. [æ•°] ç²¾ç¡®åº¦ï¼Œå‡†ç¡®æ€§12, actually [â€˜Ã¦ktjÊŠÉ™lÉª; -tÊƒÊŠ-]adv. å®žé™…ä¸Šï¼›äº‹å®žä¸Š13, Actually [â€˜Ã¦ktjÊŠÉ™lÉª; -tÊƒÊŠ-]adv. å®žé™…ä¸Šï¼›äº‹å®žä¸Š14, actuator [â€˜Ã¦ktÊƒÊŠ,etÉš]n. [è‡ª] æ‰§è¡Œæœºæž„ï¼›æ¿€åŠ±è€…ï¼›ä¿ƒåŠ¨å™¨15, Adapteeè¢«é€‚é…è€…16, additionally [É™â€™dÉªÊƒÉ™nÉ™lÉª]adv. æ­¤å¤–ï¼›åˆï¼ŒåŠ ä¹‹17, Additivity [,Ã¦dÉªâ€™tÉªvÉ™tÉª]n. æ·»åŠ ï¼›ç›¸åŠ æ€§18, addon [addon]n. æ’ä»¶19, adequate [ËˆÃ¦dÉªkwÉ™t]adj. å……è¶³çš„ï¼›é€‚å½“çš„ï¼›èƒœä»»çš„20, adjacent [É™â€™dÊ’esnt]adj. é‚»è¿‘çš„ï¼Œæ¯—è¿žçš„21, adopt [É™â€™dÉ’pt]vt. é‡‡å–ï¼›æŽ¥å—ï¼›æ”¶å…»ï¼›æ­£å¼é€šè¿‡;vi. é‡‡å–ï¼›è¿‡ç»§22, Advice [É™dâ€™vaÉªs]n. å»ºè®®ï¼›å¿ å‘Šï¼›åŠå‘Šï¼›é€šçŸ¥23, advisable [É™dâ€™vaÉªzÉ™b(É™)l]adj. æ˜Žæ™ºçš„ï¼Œå¯å–çš„ï¼Œé€‚å½“çš„24, advisor [É™dâ€™vaÉªzÉ™]n. é¡¾é—®ï¼›æŒ‡å¯¼æ•™å¸ˆï¼›åŠå‘Šè€…25, affinity [É™â€™fÉªnÉ™ti]n. å¯†åˆ‡å…³ç³»ï¼›å¸å¼•åŠ›ï¼›å§»äº²å…³ç³»ï¼›ç±»åŒ26, affliction [É™â€™flÉªkÊƒ(É™)n]n. è‹¦éš¾ï¼›è‹¦æ¼ï¼›æŠ˜ç£¨27, afford [É™â€™fÉ”rd]vt. ç»™äºˆï¼Œæä¾›ï¼›ä¹°å¾—èµ·n. (Afford)äººåï¼›(è‹±)é˜¿ç¦å¾·28, agenda [É™â€™dÊ’É›ndÉ™]n. è®®ç¨‹ï¼›æ—¥å¸¸å·¥ä½œäº‹é¡¹29, aggregation [,Ã¦grÉªâ€™geÊƒÉ™n]n. [åœ°è´¨][æ•°] èšåˆï¼Œèšé›†ï¼›èšé›†ä½“ï¼Œé›†åˆä½“30, agnostic [Ã¦gâ€™nÉ’stÉªk]n. ä¸å¯çŸ¥è®ºè€…;adj. ä¸å¯çŸ¥è®ºçš„31, aligned [É™â€™laÉªn]adj. å¯¹é½çš„ï¼›å‡è¡¡çš„v. ç»“ç›Ÿï¼ˆalignçš„è¿‡åŽ»å¼ï¼‰ï¼›ä½¿æˆä¸€ç›´çº¿32, Alliance [É™â€™laÉªÉ™ns]n. è”ç›Ÿï¼Œè”åˆï¼›è”å§»33, allocation [,Ã¦lÉ™â€™keÊƒÉ™n]n. åˆ†é…ï¼Œé…ç½®ï¼›å®‰ç½®34, allowable [É™â€™laÊŠÉ™bl]adj. è®¸å¯çš„ï¼›æ­£å½“çš„ï¼›å¯æ‰¿è®¤çš„ï¼›å¯èŽ·å®½å…35, along withæ²¿ï¼ˆé¡ºï¼‰ç€ï¼›è¿žåŒâ€¦ä¸€èµ·ï¼›ä¸Žâ€¦ä¸€é“ï¼›éšåŒâ€¦ä¸€èµ·36, alternative [É”Ëlâ€™tÉœËnÉ™tÉªv; É’l-]adj. ä¾›é€‰æ‹©çš„ï¼›é€‰æ‹©æ€§çš„ï¼›äº¤æ›¿çš„;n. äºŒä¸­æ‹©ä¸€ï¼›ä¾›æ›¿ä»£çš„é€‰æ‹©37, ambassador [Ã¦mâ€™bÃ¦sÉ™dÉš]n. å¤§ä½¿ï¼›ä»£è¡¨ï¼›ä½¿èŠ‚38, ameliorate [É™â€™milÉªÉ™â€™ret]vt. æ”¹å–„ï¼›å‡è½»ï¼ˆç—›è‹¦ç­‰ï¼‰ï¼›æ”¹è‰¯vi. å˜å¾—æ›´å¥½39, amend [É™â€™mend]vt. ä¿®æ”¹ï¼›æ”¹å–„ï¼Œæ”¹è¿›vi. æ”¹æ­£ï¼Œæ”¹å–„ï¼›æ”¹è¿‡è‡ªæ–°n. (Amend)äººåï¼›(å¾·ã€è‹±)é˜¿é—¨å¾·40, amendedadj. ä¿®æ­£çš„v. ä¿®è®¢ï¼›æ”¹è¿›ï¼ˆamendçš„è¿‡åŽ»åˆ†è¯ï¼‰41, amid [ç¾Ž/É™â€™mÉªd/]prep. åœ¨å…¶ä¸­ï¼Œåœ¨å…¶é—´;n. (Amid)äººåï¼›(æ³•ã€é˜¿æ‹‰ä¼¯)é˜¿ç±³å¾·;42, among [É™â€™mÊŒÅ‹]prep. åœ¨â€¦ä¸­é—´ï¼›åœ¨â€¦ä¹‹ä¸­43, analogous [É™â€™nÃ¦lÉ™gÉ™s]adj. ç±»ä¼¼çš„ï¼›[æ˜†] åŒåŠŸçš„ï¼›å¯æ¯”æ‹Ÿçš„44, analysts [â€˜Ã¦n(É™)lÉªsts]n. åˆ†æžå¸ˆï¼›åˆ†æžå®¶ï¼›[åˆ†åŒ–] åˆ†æžå‘˜ï¼ˆanalystçš„å¤æ•°ï¼‰45, Analyzer [â€˜Ã¦nÉ™laÉªzÉ™]n. [è®¡] åˆ†æžå™¨ï¼›åˆ†æžè€…ï¼›æ£€åé•œ46, anatomy [É™â€™nÃ¦tÉ™mi]n. è§£å‰–ï¼›è§£å‰–å­¦ï¼›å‰–æžï¼›éª¨éª¼47, ancestor [â€˜Ã¦nsÉ›stÉš]n. å§‹ç¥–ï¼Œç¥–å…ˆï¼›è¢«ç»§æ‰¿äºº48, animate [â€˜Ã¦nÉªmeÉªt]vt. ä½¿æœ‰ç”Ÿæ°”ï¼›ä½¿æ´»æ³¼ï¼›é¼“èˆžï¼›æŽ¨åŠ¨;adj. æœ‰ç”Ÿå‘½çš„49, animation [,Ã¦nÉªâ€™meÊƒÉ™n]n. æ´»æ³¼ï¼Œç”Ÿæ°”ï¼›æ¿€åŠ±ï¼›å¡é€šç‰‡ç»˜åˆ¶50, Annotation [Ã¦nÉ™â€™teÉªÊƒ(É™)n]n. æ³¨é‡Šï¼›æ³¨è§£ï¼›é‡Šæ–‡51, annotations []é‡Šæ–‡52, announce [É™â€™naÊŠns]vt. å®£å¸ƒï¼›è¿°è¯´ï¼›é¢„ç¤ºï¼›æ’­æŠ¥vi. å®£å¸ƒå‚åŠ ç«žé€‰ï¼›å½“æ’­éŸ³å‘˜53, anomaliesn. å¼‚å¸¸çŽ°è±¡ï¼Œåå¸¸çŽ°è±¡ï¼ˆanomaly å¤æ•°å½¢å¼ï¼‰54, approach [É™â€™protÊƒ]n. æ–¹æ³•ï¼›é€”å¾„ï¼›æŽ¥è¿‘vt. æŽ¥è¿‘ï¼›ç€æ‰‹å¤„ç†vi. é è¿‘55, appropriate [É™â€™prÉ™ÊŠprÉªÉ™t]adj. é€‚å½“çš„ï¼›æ°å½“çš„ï¼›åˆé€‚çš„;vt. å ç”¨ï¼Œæ‹¨å‡º56, approve [É™â€™pruËv]vt. æ‰¹å‡†ï¼›èµžæˆï¼›ä¸ºâ€¦æä¾›è¯æ®;vi. æ‰¹å‡†ï¼›èµžæˆï¼›æ»¡æ„57, approximately [É™â€™prÉ’ksÉªmÉ™tlÉª]adv. å¤§çº¦ï¼Œè¿‘ä¼¼åœ°ï¼›è¿‘äºŽ58, approximation [É™,prÉ’ksÉªâ€™meÉªÊƒn]n. [æ•°] è¿‘ä¼¼æ³•ï¼›æŽ¥è¿‘ï¼›[æ•°] è¿‘ä¼¼å€¼59, approximations [approximations][æ•°] è¿‘ä¼¼å€¼60, apsaran. (Apsara)äººåï¼›(æ³•)é˜¿æ™®è¨æ‹‰61, arbitrarily [,É‘rbÉ™â€™trÉ›rÉ™li]adv. æ­¦æ–­åœ°ï¼›åå¤æ— å¸¸åœ°ï¼›ä¸“æ¨ªåœ°62, arbitrary [â€˜É‘ËbÉªt(rÉ™)rÉª]adj. [æ•°] ä»»æ„çš„ï¼›æ­¦æ–­çš„ï¼›ä¸“åˆ¶çš„63, arbitrate [â€˜É‘ËbÉªtreÉªt]vt. ä»²è£ï¼›å…¬æ–­64, archetype [â€˜É‘ËkÉªtaÉªp]n. åŽŸåž‹65, architectural [,É‘ËkÉªâ€™tektÊƒÉ™rÉ™l]adj. å»ºç­‘å­¦çš„ï¼›å»ºç­‘ä¸Šçš„ï¼›ç¬¦åˆå»ºç­‘æ³•çš„66, archive [â€˜É‘rkaÉªv]n. æ¡£æ¡ˆé¦†ï¼›æ¡£æ¡ˆæ–‡ä»¶;vt. æŠŠâ€¦å­˜æ¡£67, Archive [â€˜É‘rkaÉªv]n. æ¡£æ¡ˆé¦†ï¼›æ¡£æ¡ˆæ–‡ä»¶;vt. æŠŠâ€¦å­˜æ¡£68, arguably [â€˜É‘rÉ¡juÉ™bli]adv. å¯è®ºè¯åœ°ï¼›å¯äº‰è¾©åœ°ï¼›æ­£å¦‚å¯æå‡ºè¯æ®åŠ ä»¥è¯æ˜Žçš„é‚£æ ·åœ°[å¹¿ä¹‰ç”¨æ³•]å¯èƒ½ï¼Œå¤§æ¦‚69, ark [É‘rk]n. çº¦æŸœï¼›æ–¹èˆŸï¼›ï¼ˆç¾Žï¼‰å¹³åº•èˆ¹ï¼›é¿éš¾æ‰€n. (Ark)äººåï¼›(ä¿„ã€åœŸ)é˜¿å°”å…‹70, artifact [â€˜É‘:tÉ™ËŒfÃ¦kt]n. äººå·¥åˆ¶å“ï¼›æ‰‹å·¥è‰ºå“71, artifacts [â€˜a:rtifÃ¦kts]n. å²å‰å¤å™¨ç‰©ï¼›äººå·¥äº§å“72, Artifacts [â€˜a:rtifÃ¦kts]n. å²å‰å¤å™¨ç‰©ï¼›äººå·¥äº§å“73, Artificial [É‘ËtÉªâ€™fÉªÊƒ(É™)l]adj. äººé€ çš„ï¼›ä»¿é€ çš„ï¼›è™šä¼ªçš„ï¼›éžåŽŸäº§åœ°çš„ï¼›æ­¦æ–­çš„74, Aspect [â€˜Ã¦spekt]n. æ–¹é¢ï¼›æ–¹å‘ï¼›å½¢åŠ¿ï¼›å¤–è²Œ75, assailed [É™â€™seÉªl]vt. æ”»å‡»ï¼›è´¨é—®ï¼›ç€æ‰‹è§£å†³76, asset [â€˜Ã¦set]n. èµ„äº§ï¼›ä¼˜ç‚¹ï¼›æœ‰ç”¨çš„ä¸œè¥¿ï¼›æœ‰åˆ©æ¡ä»¶ï¼›è´¢äº§ï¼›æœ‰ä»·å€¼çš„äººæˆ–ç‰© n. ï¼ˆæ³•ï¼‰é˜¿å¡žï¼ˆäººåï¼‰77, Assets []n. èµ„äº§ï¼›[ç»] è´¢äº§ï¼›æœ‰åˆ©æ¡ä»¶ï¼ˆassetçš„å¤æ•°ï¼‰78, asshole [â€˜Ã¦shÉ™ÊŠl]n. å±çœ¼å„¿ï¼Œè‚›é—¨ï¼›ä»¤äººè®¨åŽŒçš„äººadj. æ„šè ¢çš„ï¼›çªå›Šçš„ï¼›å¯æ¶çš„79, assign [É™â€™saÉªn]vt. åˆ†é…ï¼›æŒ‡æ´¾ï¼›[è®¡][æ•°] èµ‹å€¼;vi. å°†è´¢äº§è¿‡æˆ·ï¼ˆå°¤æŒ‡è¿‡æˆ·ç»™å€ºæƒäººï¼‰80, assignee [Ã¦sÉªâ€™niË; -saÉª-]n. ä»£ç†äººï¼›å—æ‰˜äººï¼›åˆ†é…åˆ°ä»»åŠ¡çš„äºº81, association [É™sÉ™ÊŠsÉªâ€™eÉªÊƒ(É™)n; -ÊƒÉª-]n. åä¼šï¼Œè”ç›Ÿï¼Œç¤¾å›¢ï¼›è”åˆï¼›è”æƒ³82, assume [É™â€™sjuËm]vt. æ‰¿æ‹…ï¼›å‡å®šï¼›é‡‡å–ï¼›å‘ˆçŽ°;vi. è£…è…”ä½œåŠ¿ï¼›å¤šç®¡é—²äº‹83, asterisk [â€˜Ã¦stÉ™rÉªsk]n. æ˜Ÿå·vt. æ³¨ä¸Šæ˜Ÿå·ï¼›ç”¨æ˜Ÿå·æ ‡å‡º84, async [É™ËˆsÉªÅ‹k]abbr. å¼‚æ­¥ï¼ŒéžåŒæ­¥ï¼ˆasynchronousï¼‰85, asynchronous [É™â€™sÉªÅ‹krÉ™nÉ™s; eÉª-]adj. [ç”µ] å¼‚æ­¥çš„ï¼›ä¸åŒæ—¶çš„ï¼›ä¸åŒæœŸçš„86, Asynchronous [É™â€™sÉªÅ‹krÉ™nÉ™s; eÉª-]adj. [ç”µ] å¼‚æ­¥çš„ï¼›ä¸åŒæ—¶çš„ï¼›ä¸åŒæœŸçš„87, atlassian 88, atop [É™â€™tÉ’p]prep. åœ¨â€¦çš„é¡¶ä¸Š;adv. åœ¨é¡¶ä¸Š89, attach [É™â€™tÃ¦tÊƒ]vt. ä½¿ä¾é™„ï¼›è´´ä¸Šï¼›ç³»ä¸Šï¼›ä½¿ä¾æ‹;vi. é™„åŠ ï¼›é™„å±žï¼›ä¼´éš90, attendance [É™â€™tend(É™)ns]n. å‡ºå¸­ï¼›åˆ°åœºï¼›å‡ºå¸­äººæ•°ï¼›è€ƒå‹¤91, attendeesn. å‚åŠ è€…ï¼›å‡ºå¸­è€…ï¼ˆattendeeçš„å¤æ•°ï¼‰92, atypical [eÉªâ€™tÉªpÉªk(É™)l; Ã¦-]adj. éžå…¸åž‹çš„ï¼›ä¸åˆè§„åˆ™çš„93, audit [â€˜É”ËdÉªt]vi. å®¡è®¡ï¼›[å®¡è®¡] æŸ¥è´¦;n. å®¡è®¡ï¼›[å®¡è®¡] æŸ¥è´¦;vt. ï¼ˆç¾Žï¼‰æ—å¬94, authentication [É”Ë,Î¸entÉªâ€™keÉªÊƒÉ™n]n. è¯æ˜Žï¼›é‰´å®šï¼›è¯å®ž95, Authentication [É”Ë,Î¸entÉªâ€™keÉªÊƒÉ™n]n. è¯æ˜Žï¼›é‰´å®šï¼›è¯å®ž96, authorization [É”ËÎ¸É™raÉªâ€™zeÉªÊƒ(É™)n]n. æŽˆæƒï¼Œè®¤å¯ï¼›æ‰¹å‡†ï¼Œå§”ä»»97, Authorization [É”ËÎ¸É™raÉªâ€™zeÉªÊƒ(É™)n]n. æŽˆæƒï¼Œè®¤å¯ï¼›æ‰¹å‡†ï¼Œå§”ä»»98, authorize [â€˜É”Î¸É™raÉªz]vt. æ‰¹å‡†ï¼Œè®¤å¯ï¼›æŽˆæƒç»™ï¼›å§”æ‰˜ä»£æ›¿99, automata [É”â€™tÉ‘mÉ™tÉ™]n. è‡ªåŠ¨è£…ç½®ï¼›æœºå™¨äºº ï¼ˆautomatonçš„å¤æ•°ï¼‰100, Automation [É”ËtÉ™â€™meÉªÊƒ(É™)n]n. è‡ªåŠ¨åŒ–ï¼›è‡ªåŠ¨æ“ä½œ101, autowiren. è‡ªåŠ¨è£…é…102, auxiliary [É”Ëgâ€™zÉªlÉªÉ™rÉª; É’g-]n. åŠ©åŠ¨è¯ï¼›è¾…åŠ©è€…ï¼Œè¾…åŠ©ç‰©ï¼›é™„å±žæœºæž„;adj. è¾…åŠ©çš„ï¼›å‰¯çš„ï¼›é™„åŠ çš„103, avail [É™â€™veÉªl]n. æ•ˆç”¨ï¼Œåˆ©ç›Š;vt. æœ‰ç›ŠäºŽï¼Œæœ‰ç›ŠäºŽï¼›ä½¿å¯¹æŸäººæœ‰åˆ©ã€‚;vi. æœ‰ç›ŠäºŽï¼Œæœ‰ç›ŠäºŽï¼›ä½¿å¯¹æŸäººæœ‰åˆ©ã€‚104, await [É™â€™weÉªt]vt. ç­‰å€™ï¼Œç­‰å¾…ï¼›æœŸå¾…105, Aware [É™â€™weÉ™]adj. æ„è¯†åˆ°çš„ï¼›çŸ¥é“çš„ï¼›æœ‰â€¦æ–¹é¢çŸ¥è¯†çš„ï¼›æ‡‚ä¸–æ•…çš„;n. (Aware)äººåï¼›(é˜¿æ‹‰ä¼¯ã€ç´¢)é˜¿ç“¦é›·106, awesome [â€˜É”Ës(É™)m]ã€ç½‘ç»œã€‘å¦äººç«Ÿä¸ºçš„ï¼›ç”Ÿç•ï¼›çœŸäº†ä¸èµ·ï¼›å‚²æ£®107, Awesome [â€˜É”Ës(É™)m]adj. ä»¤äººæ•¬ç•çš„ï¼›ä½¿äººç•æƒ§çš„ï¼›å¯æ€•çš„ï¼›æžå¥½çš„108, axis [â€˜Ã¦ksÉªs]n. è½´ï¼›è½´çº¿ï¼›è½´å¿ƒå›½109, backslash [backslash]n. åæ–œæ ï¼Œåæ–œçº¿ç¬¦å·110, backwards [â€˜bÃ¦kwÉšdz]adv. å€’ï¼›å‘åŽï¼›é€†111, Badge [bÃ¦dÊ’]n. å¾½ç« ï¼›è¯ç« ï¼›æ ‡è®°;vt. æŽˆç»™â€¦å¾½ç« 112, banner [â€˜bÃ¦nÉš]n. æ¨ªå¹…å›¾ç‰‡çš„å¹¿å‘Šæ¨¡å¼n. æ——å¸œï¼Œæ¨ªå¹…,æ ‡è¯­n. äººå(è‹±ã€å¾·ã€ç½—)ç­çº³113, barge [bÉ‘rdÊ’]vi. è¹’è·šï¼›é—¯å…¥n. é©³èˆ¹ï¼›æ¸¸è‰‡vt. ç”¨èˆ¹è¿è¾“ï¼›è›®ä¸è®²ç†åœ°é—¯å…¥æˆ–æ‰“æ‰°æŸäº‹ç‰©n. (Barge)äººåï¼›(è‹±)å·´å¥‡ï¼›(å¾·)å·´æ ¼ï¼›(è¥¿)å·´å°”èµ«ï¼›(æ³•ã€è‘¡)å·´å°”çƒ­114, Barter [â€˜bÉ‘ËtÉ™]vi. è¿›è¡Œæ˜“è´§è´¸æ˜“ï¼›[è´¸æ˜“] ä½œç‰©ç‰©äº¤æ¢ï¼›è®¨ä»·è¿˜ä»·;vt. ä»¥â€¦ä½œä¸ºäº¤æ¢ï¼›æ‹¿â€¦è¿›è¡Œæ˜“è´§è´¸æ˜“;n. æ˜“è´§è´¸æ˜“ï¼›ç‰©ç‰©äº¤æ¢ï¼›å®žç‰©äº¤æ˜“;n. (Barter)äººåï¼›(è‹±)å·´ç‰¹115, Bash [bÃ¦Êƒ]vt. çŒ›å‡»ï¼Œç—›å‡»ï¼›æ€’æ®´;n. çŒ›çƒˆçš„ä¸€å‡»ï¼Œç—›å‡»;n. (Bash)äººåï¼›(è‹±ã€ä¿„ã€å·´åŸº)å·´ä»€116, be populated withç”¨â€¦å¡«å……117, be responsible for []å¯¹â€¦â€¦è´Ÿè´£ï¼›æ˜¯â€¦â€¦çš„åŽŸå› Be responsible for: è´Ÿè´£ å¯¹ æ‰¿æ‹…è´£ä»»118, bear [bÉ›r]vt. ç»“æžœå®žï¼Œå¼€èŠ±ï¼ˆæ­£å¼ï¼‰vt. å¿å—ï¼›æ‰¿å—ï¼›å…·æœ‰ï¼›æ”¯æ’‘n. ç†Šn. (Bear)äººåï¼›(è‹±)è´å°”119, bearer [â€˜bÉ›rÉš]n. æŒç¥¨äººï¼›[å»º] æ‰¿æœ¨ï¼›[æœº] æ‰˜æž¶ï¼›é€ä¿¡äººï¼›æ¬è¿å·¥äºº120, beast [biËst]n. é‡Žå…½ï¼›ç•œç”Ÿï¼Œäººé¢å…½å¿ƒçš„äºº121, behalf [bÉªâ€™hÉ‘Ëf]n. ä»£è¡¨ï¼›åˆ©ç›Š122, benchmarks [benchmarks]n. [è®¡] åŸºå‡†ï¼›æ ‡ç«¿ï¼›æ°´å‡†ç‚¹ï¼›åŸºå‡†æµ‹è¯•ç¨‹åºæ•°å€¼ï¼ˆbenchmarkçš„å¤æ•°å½¢å¼ï¼‰v. æµ‹å®šåŸºå‡†ç‚¹ï¼ˆbenchmarkçš„ä¸‰å•å½¢å¼ï¼‰123, bend [bend]vt. ä½¿å¼¯æ›²ï¼›ä½¿å±ˆæœï¼›ä½¿è‡´åŠ›ï¼›ä½¿æœå‘;vi. å¼¯æ›²ï¼Œè½¬å¼¯ï¼›å±ˆæœï¼›å€¾å‘ï¼›ä¸“å¿ƒäºŽ;n. å¼¯æ›²;n. (Bend)äººåï¼›(ç‘žå…¸)æœ¬å¾·124, beware [bÉªâ€™wÉ›r]vi. å½“å¿ƒï¼Œå°å¿ƒvt. æ³¨æ„ï¼Œå½“å¿ƒï¼›æé˜²125, bin [bÉªn]n. ç®±å­ï¼Œå®¹å™¨ï¼›äºŒè¿›åˆ¶;vt. æŠŠâ€¦æ”¾å…¥ç®±ä¸­;n. (Bin)äººåï¼›(æ„ã€æŸ¬)å®¾ï¼›(æ—¥)æ•(å)ï¼›(ä¸œå—äºšå›½å®¶åŽè¯­)æ°‘126, Binary [â€˜baÉªnÉ™rÉª]adj. [æ•°] äºŒè¿›åˆ¶çš„ï¼›äºŒå…ƒçš„ï¼ŒäºŒæ€çš„127, Binary DistributionsäºŒè¿›åˆ¶å‘è¡Œç‰ˆ128, bio [â€˜baÉªÉ™ÊŠ]n. ä¸ªäººç®€åŽ†ï¼Œå°ä¼  n. (Bio)äººåï¼›(æ³•ã€æ„ã€è‘¡ã€åœŸã€åˆš(é‡‘)ã€å¡žæ‹‰)æ¯”å¥¥129, bitwisen. æŒ‰ä½130, biz [bÉªz]n. å•†ä¸šï¼ˆç­‰äºŽbusinessï¼‰131, blazing [â€˜bleÉªzÉªÅ‹]adj. ç‡ƒçƒ§çš„ï¼›å¼ºçƒˆçš„ï¼›é—ªè€€çš„;adv. éžå¸¸;v. ç‡ƒçƒ§ï¼›é—ªè€€ï¼›è¿¸å‘ï¼›å…¬å¼€ï¼ˆblazeçš„ingå½¢å¼ï¼‰132, block [blÉ’k]n. å—ï¼›è¡—åŒºï¼›å¤§åŽ¦ï¼›éšœç¢ç‰©;vt. é˜»æ­¢ï¼›é˜»å¡žï¼›é™åˆ¶ï¼›å°ç›–;adj. æˆæ‰¹çš„ï¼Œå¤§å—çš„ï¼›äº¤é€šå µå¡žçš„;n. (Block)äººåï¼›(è‹±ã€æ³•ã€å¾·ã€è¥¿ã€è‘¡ã€èŠ¬ã€ç½—)å¸ƒæ´›å…‹133, Block [blÉ’k]n. å—ï¼›è¡—åŒºï¼›å¤§åŽ¦ï¼›éšœç¢ç‰©;vt. é˜»æ­¢ï¼›é˜»å¡žï¼›é™åˆ¶;adj. æˆæ‰¹çš„ï¼Œå¤§å—çš„ï¼›äº¤é€šå µå¡žçš„;n. (Block)äººåï¼›(è‹±ã€æ³•ã€å¾·ã€è¥¿ã€è‘¡ã€èŠ¬ã€ç½—)å¸ƒæ´›å…‹134, blueprint [â€˜blÊŠâ€™prÉªnt]vt. è®¡åˆ’ï¼›åˆ¶æˆè“å›¾n. è“å›¾ï¼Œè®¾è®¡å›¾ï¼›è®¡åˆ’135, blur [blÉœË]vt. æ¶‚æ±¡ï¼›ä½¿â€¦æ¨¡ç³Šä¸æ¸…ï¼›ä½¿æš—æ·¡ï¼›çŽ·æ±¡;vi. æ²¾ä¸Šæ±¡è¿¹ï¼›å˜æ¨¡ç³Š;n. æ±¡è¿¹ï¼›æ¨¡ç³Šä¸æ¸…çš„äº‹ç‰©136, board [bÉ”rd]n. è‘£äº‹ä¼šï¼›æœ¨æ¿ï¼›ç”²æ¿ï¼›è†³é£Ÿvt. ä¸Šï¼ˆé£žæœºã€è½¦ã€èˆ¹ç­‰ï¼‰ï¼›ç”¨æ¿ç›–ä¸Šï¼›ç»™æä¾›è†³å®¿vi. å¯„å®¿n. (Board)äººåï¼›(è‹±ã€è¥¿)åšå¾·137, boilerplate [â€˜bÉ”ÉªlÉšplet]n. æ ·æ¿æ–‡ä»¶ï¼›å¼•ç”¨138, boilsn. ç”Ÿç––ï¼Œç–®ï¼ˆboilå¤æ•°ï¼‰139, bold [bold]adj. å¤§èƒ†çš„ï¼Œè‹±å‹‡çš„ï¼›é»‘ä½“çš„ï¼›åŽšé¢œæ— è€»çš„ï¼›é™©å³»çš„n. (Bold)äººåï¼›(è‹±ã€å¾·ã€ç½—ã€æ·ã€ç‘žå…¸)åšå°”å¾·140, bolt [bÉ™ÊŠlt]n. èžºæ “ï¼Œèžºé’‰ï¼›é—ªç”µï¼Œé›·ç”µï¼›é—¨é—©ï¼›å¼©ç®­;ï¼ˆå¸ƒçš„ï¼‰ä¸€åŒ¹ï¼Œä¸€å·vt. ç­›é€‰ï¼›å›«å›µåžä¸‹ï¼›ï¼ˆæŠŠé—¨ã€çª—ç­‰ï¼‰é—©ä¸Šï¼›çªç„¶è¯´å‡ºï¼Œè„±å£è¯´å‡ºvi. ï¼ˆé—¨çª—ç­‰ï¼‰é—©ä¸Šï¼Œæ‹´ä½ï¼›å†²å‡ºï¼Œè·³å‡ºï¼›ï¼ˆé©¬ç­‰çš„ï¼‰è„±ç¼°ï¼›å›«å›µåžä¸‹adv. çªç„¶åœ°ï¼›åƒç®­ä¼¼åœ°ï¼›ç›´ç«‹åœ°141, boost [buËst]vt. ä¿ƒè¿›ï¼›å¢žåŠ ï¼›æ”¯æ´;vi. å®£æ‰¬ï¼›å·çªƒ;n. æŽ¨åŠ¨ï¼›å¸®åŠ©ï¼›å®£æ‰¬;n. (Boost)äººåï¼›(è‹±)å¸ƒæ–¯ç‰¹ï¼›(å¾·)åšæ–¯ç‰¹142, boot [buËt]vt. å¼•å¯¼ï¼›è¸¢ï¼›è§£é›‡ï¼›ä½¿ç©¿é´;n. é´å­ï¼›è¸¢ï¼›æ±½è½¦è¡ŒæŽç®±;n. (Boot)äººåï¼›(è‹±)å¸ƒç‰¹ï¼›(å¾·)åšç‰¹143, bootstrap [â€˜buËtstrÃ¦p]n. [è®¡] å¼•å¯¼ç¨‹åºï¼Œè¾…åŠ©ç¨‹åºï¼›è§£é´å¸¦144, Bootstrap [â€˜buËtstrÃ¦p]n. [è®¡] å¼•å¯¼ç¨‹åºï¼Œè¾…åŠ©ç¨‹åºï¼›è§£é´å¸¦145, BootStrap [â€˜buËtstrÃ¦p]n. [è®¡] å¼•å¯¼ç¨‹åºï¼Œè¾…åŠ©ç¨‹åºï¼›è§£é´å¸¦146, bootupn. å¯åŠ¨147, borrow [â€˜bÉ’rÉ™ÊŠ]vi. å€Ÿï¼›å€Ÿç”¨ï¼›ä»Žå…¶ä»–è¯­è¨€ä¸­å¼•å…¥ vt. å€Ÿï¼›å€Ÿç”¨ n. (Borrow)äººåï¼›(è‹±)åšç½—148, bottleneck [â€˜bÉ‘tlnÉ›k]n. ç“¶é¢ˆï¼›éšœç¢ç‰©149, bound [baÊŠnd]adj. æœ‰ä¹‰åŠ¡çš„ï¼›å—çº¦æŸçš„ï¼›è£…æœ‰å°é¢çš„;vt. æŸç¼šï¼›ä½¿è·³è·ƒ;n. èŒƒå›´ï¼›è·³è·ƒ;vi. é™åˆ¶ï¼›å¼¹èµ·150, bourne [buÉ™n]n. å°æºªï¼›ç›®çš„åœ°ï¼›è¾¹ç•Œn. (Bourne)äººåï¼›(è‹±)ä¼¯æ©ï¼›(è¥¿)åšå°”å†…151, Bourne [buÉ™n]n. å°æºªï¼›ç›®çš„åœ°ï¼›è¾¹ç•Œ;n. (Bourne)äººåï¼›(è‹±)ä¼¯æ©ï¼›(è¥¿)åšå°”å†…152, breakthrough [â€˜breÉªkÎ¸ruË]n. çªç ´ï¼›çªç ´æ€§è¿›å±•153, brevity [â€˜brÉ›vÉ™ti]n. ç®€æ´ï¼Œç®€çŸ­ï¼›çŸ­æš‚ï¼ŒçŸ­ä¿ƒ154, brew [brÊŠ]vt. é…¿é€ ï¼›é…é…¿vi. é…¿é…’ï¼›è¢«å†²æ³¡ï¼›å³å°†å‘ç”Ÿn. å•¤é…’ï¼›è´¨åœ°n. (Brew)äººåï¼›(è‹±)å¸ƒé²155, brief [brif]adj. ç®€çŸ­çš„ï¼Œç®€æ´çš„ï¼›çŸ­æš‚çš„ï¼Œè‰çŽ‡çš„n. æ‘˜è¦ï¼Œç®€æŠ¥ï¼›æ¦‚è¦ï¼Œè¯‰ä¹¦vt. ç®€æŠ¥ï¼Œæ‘˜è¦ï¼›ä½œâ€¦çš„æè¦n. (Brief)äººåï¼›(è‹±)å¸ƒé‡Œå¤«156, brilliant [â€˜brÉªlj(É™)nt]adj. ç¿çƒ‚çš„ï¼Œé—ªè€€çš„ï¼›æ°å‡ºçš„ï¼›æœ‰æ‰æ°”çš„ï¼›ç²¾å½©çš„ï¼Œç»å¦™çš„157, brittle [â€˜brÉªt(É™)l]adj. æ˜“ç¢Žçš„ï¼Œè„†å¼±çš„ï¼›æ˜“ç”Ÿæ°”çš„158, broker [â€˜brokÉš]n. ç»çºªäººï¼ŒæŽ®å®¢vi. ä½œä¸ºæƒåŠ›ç»çºªäººè¿›è¡Œè°ˆåˆ¤vt. ä»¥ä¸­é—´äººç­‰èº«åˆ†å®‰æŽ’â€¦n. (Broker)äººåï¼›(è‹±)å¸ƒç½—å…‹ï¼›(ä¿„)å¸ƒç½—å…‹å°”159, bucket [â€˜bÊŒkÉªt]n. æ¡¶ï¼Œæ°´æ¡¶ï¼›é“²æ–—ï¼›ä¸€æ¡¶çš„é‡v. å€¾ç›†è€Œä¸‹ï¼›é¢ ç°¸ç€è¡Œè¿›n. (Bucket)äººåï¼›(å¾·)å¸ƒå…‹ç‰¹160, buddy [â€˜bÊŒdÉª]n. ä¼™ä¼´ï¼Œå¥½æœ‹å‹ï¼›å¯†å‹ï¼›å°ç”·å­©;vi. åšå¥½æœ‹å‹ï¼Œäº¤æœ‹å‹;n. (Buddy)äººåï¼›(è‹±)å·´è¿ª161, budget [â€˜bÊŒdÊ’Éªt]n. é¢„ç®—ï¼Œé¢„ç®—è´¹vt. å®‰æŽ’ï¼Œé¢„å®šï¼›æŠŠâ€¦ç¼–å…¥é¢„ç®—vi. ç¼–é¢„ç®—ï¼Œåšé¢„ç®—adj. å»‰ä»·çš„162, bulk [bÊŒlk]n. ä½“ç§¯ï¼Œå®¹é‡ï¼›å¤§å¤šæ•°ï¼Œå¤§éƒ¨åˆ†ï¼›å¤§å—vt. ä½¿æ‰©å¤§ï¼Œä½¿å½¢æˆå¤§é‡ï¼›ä½¿æ˜¾å¾—é‡è¦n. (Bulk)äººåï¼›(åœŸ)å¸ƒå°”å…‹163, bunch [bÊŒn(t)Êƒ]n. ç¾¤ï¼›ä¸²ï¼›çªå‡ºç‰© vi. éš†èµ·ï¼›æ‰“è¤¶ï¼›å½¢æˆä¸€ä¸² vt. ä½¿æˆä¸€ä¸²ï¼›ä½¿æ‰“è¤¶ n. (Bunch)äººåï¼›(è‹±)é‚¦å¥‡164, bundle [â€˜bÊŒnd(É™)l]n. æŸï¼›æ†;vt. æ†;vi. åŒ†å¿™ç¦»å¼€165, Bundle [â€˜bÊŒnd(É™)l]n. æŸï¼›æ†;vt. æ†;vi. åŒ†å¿™ç¦»å¼€166, burst [bÉœËst]vi. çˆ†å‘ï¼Œçªå‘ï¼›çˆ†ç‚¸ vt. çˆ†å‘ï¼Œçªå‘ï¼›çˆ†ç‚¸ n. çˆ†å‘ï¼Œçªå‘ï¼›çˆ†ç‚¸ n. (Burst)äººåï¼›(å¾·ã€ç½—)å¸ƒå°”æ–¯ç‰¹167, byzantine [baÉªËˆzntaÉªn;ËˆbÉªzÉ™ntaÉªn]adj. æ‹œå åº­å¼çš„ï¼›ä¸œç½—é©¬å¸å›½çš„n. æ‹œå åº­äººï¼Œæ‹œå åº­æ´¾çš„å»ºç­‘å¸ˆ168, Callable [â€˜kÉ”ËlÉ™b(É™)l]adj. éšæ—¶å¯å¿è¿˜çš„ï¼›è¯·æ±‚å³ä»˜çš„169, Campaign [kÃ¦mâ€™peÉªn]vi. ä½œæˆ˜ï¼›å‚åŠ ç«žé€‰ï¼›å‚åŠ æ´»åŠ¨n. è¿åŠ¨ï¼›æ´»åŠ¨ï¼›æˆ˜å½¹170, canary [kÉ™â€™nÉ›ri]n. [é¸Ÿ] é‡‘ä¸é›€ï¼›æ·¡é»„è‰²n. (Canary)äººåï¼›(è‹±)å¡çº³é‡Œ171, candidate [â€˜kÃ¦ndÉªdeÉªt; -dÉ™t]n. å€™é€‰äººï¼Œå€™è¡¥è€…ï¼›åº”è¯•è€…172, canonical [kÉ™â€™nÉ’nÉªk(É™)l]adj. ä¾æ•™è§„çš„ï¼›æƒå¨çš„ï¼›ç‰§å¸ˆçš„n. ç‰§å¸ˆç¤¼æœ173, Canonical [kÉ™â€™nÉ’nÉªk(É™)l]adj. ä¾æ•™è§„çš„ï¼›æƒå¨çš„ï¼›ç‰§å¸ˆçš„;n. ç‰§å¸ˆç¤¼æœ174, Canvas [â€˜kÃ¦nvÉ™s]n. å¸†å¸ƒ;vt. ç”¨å¸†å¸ƒè¦†ç›–ï¼Œç”¨å¸†å¸ƒè£…å¤‡;adj. å¸†å¸ƒåˆ¶çš„175, Capable [â€˜keÉªpÉ™b(É™)l]adj. èƒ½å¹²çš„ï¼Œèƒ½èƒœä»»çš„ï¼›æœ‰æ‰åŽçš„176, capitalized [capitalized]å¤§å†™çš„177, capped [capped]v. ç»™â€¦æˆ´å¸½ï¼›åŽ»è’‚ï¼›è¦†ä»¥â€¦ï¼›é™¤åŽ»ç›–å­ï¼›èƒœè¿‡ï¼ˆcapçš„è¿‡åŽ»åˆ†è¯å½¢å¼ï¼‰adj. åŒ…è¿‡çš„ï¼›åŠ ç›–çš„ï¼›åŽ»è’‚çš„178, cardinality [kÉ‘ËdÉªâ€™nÃ¦lÉªtÉª]n. åŸºæ•°ï¼›é›†çš„åŠ¿179, caret [â€˜kÃ¦rÉ™t]n. è„±å­—ç¬¦å·ï¼›æ’å…¥ç¬¦å·;n. (Caret)äººåï¼›(æ³•)å¡é›·ï¼›(è‹±)å¡é›·ç‰¹180, Caret [â€˜kÃ¦rÉ™t]n. è„±å­—ç¬¦å·ï¼›æ’å…¥ç¬¦å·;n. (Caret)äººåï¼›(æ³•)å¡é›·ï¼›(è‹±)å¡é›·ç‰¹181, carrot [â€˜kÃ¦rÉ™t]n. èƒ¡èåœ;è¯±é¥µ182, cascading [kÃ¦â€™skeÉªdÉªÅ‹]n. [ç”µ] çº§è”ï¼›ä¸²æŽ¥ï¼›é˜¶å¼æ¸—é€ v. ç€‘å¸ƒèˆ¬è½ä¸‹ï¼›ä¸²è”ï¼›ä¼ é€’ä¿¡æ¯ï¼ˆcascadeçš„ingå½¢å¼ï¼‰183, catalina [,kÃ¦tÉ™â€™li:nÉ™]n. è¿œç¨‹è½°ç‚¸æœº;n. (Catalina)äººåï¼›(æ³•ã€è¥¿)å¡å¡”åˆ©å¨œï¼›(è‹±)å¡å¡”èŽ‰å¨œ184, cave [keÉªv]vt. ä½¿å‡¹é™·ï¼Œä½¿å¡Œè½ï¼›åœ¨â€¦æŒ–æ´žç©´vi. å‡¹é™·ï¼Œå¡Œè½ï¼›æŠ•é™n. æ´žç©´ï¼Œçª‘æ´žn. (Cave)äººåï¼›(è¥¿)å¡éŸ¦ï¼›(è‹±)å‡¯å¤«ï¼›(æ³•)å¡å¤«185, caveat [â€˜kÃ¦vÉªÃ¦t; â€˜ke-]n. è­¦å‘Šï¼›ä¸­æ­¢è¯‰è®¼æ‰‹ç»­çš„ç”³è¯·ï¼›è´§ç‰©å‡ºé—¨æ¦‚ä¸é€€æ¢ï¼›åœæ­¢æ”¯ä»˜çš„å¹¿å‘Š186, caveatsn. è­¦å‘Šï¼›è¯´æ˜Žï¼ˆcaveatçš„å¤æ•°ï¼‰187, cellular [â€˜sÉ›ljÉ™lÉš]adj. ç»†èƒžçš„ï¼›å¤šå­”çš„ï¼›ç”±ç»†èƒžç»„æˆçš„n. ç§»åŠ¨ç”µè¯ï¼›å•å…ƒ188, Celsius [â€˜sÉ›lsÉªÉ™s]adj. æ‘„æ°çš„n. æ‘„æ°åº¦189, characteristic [kÃ¦rÉ™ktÉ™â€™rÉªstÉªk]adj. å…¸åž‹çš„ï¼›ç‰¹æœ‰çš„ï¼›è¡¨ç¤ºç‰¹æ€§çš„n. ç‰¹å¾ï¼›ç‰¹æ€§ï¼›ç‰¹è‰²190, Characteristics [,kÃ¦rÉ™ktÉ™â€™rÉªstÉªks]n. ç‰¹æ€§ï¼Œç‰¹å¾ï¼›ç‰¹è‰²ï¼ˆcharacteristicçš„å¤æ•°ï¼‰ï¼›ç‰¹è´¨191, charcuterie [ÊƒÉ‘Ëâ€™kuËt(É™)rÉª]n. ç†Ÿé£Ÿåº—ï¼›çŒªè‚‰åº—;n. (Charcuterie)äººåï¼›(æ³•)æ²™å°”å±ˆç‰¹é‡Œ192, chase [tÊƒeÉªs]vt. è¿½é€ï¼›è¿½æ•ï¼›è¯•å›¾èµ¢å¾—ï¼›é›•é•‚;vi. è¿½é€ï¼›è¿½èµ¶ï¼›å¥”è·‘;n. è¿½é€ï¼›è¿½èµ¶ï¼›è¿½å‡»;n. (Chase)äººåï¼›(è‹±)è”¡æ–¯ï¼›(æ³•)æ²™æ–¯193, chaser [â€˜tÊƒeÉªsÉ™]n. é©±é€èˆ°ï¼›çŒŽäººï¼›é¥®çƒˆé…’åŽå–çš„é¥®æ–™ï¼›[æœº] èžºçº¹æ¢³åˆ€194, chefs [Êƒefs]n.å¤§åŽ¨ï¼›ä¸»åŽ¨ï¼ˆchefçš„å¤æ•°ï¼‰195, Choreographies Processesç»„åˆæµç¨‹196, choreography [,kÉ’rÉªâ€™É’grÉ™fÉª]n. ç¼–èˆžï¼›èˆžè¹ˆè‰ºæœ¯ï¼›èˆžè‰º197, chronicle [â€˜krÉ’nÉªk(É™)l]n.ç¼–å¹´å²ï¼Œå¹´ä»£è®°ï¼›è®°å½•vt.è®°å½•ï¼›æŠŠâ€¦è½½å…¥ç¼–å¹´å²198, chronology [krÉ™â€™nÉ’lÉ™dÊ’Éª]n. å¹´è¡¨ï¼›å¹´ä»£å­¦Chronology: å¹´ä»£å­¦ å¹´ä»£å­¦ å¹´è¡¨199, chubby [â€˜tÊƒÊŒbi]adj. åœ†èƒ–çš„ï¼Œä¸°æ»¡çš„200, chunk [tÊƒÊŒÅ‹k]n.å¤§å—ï¼›çŸ®èƒ–çš„äººæˆ–ç‰©201, churn [tÊƒÉœËn]vi.æ…æ‹Œï¼›æ…åŠ¨vt.æ…æ‹Œï¼›æ…åŠ¨n.æ…ä¹³å™¨202, cipher [â€˜saÉªfÉ™]n. å¯†ç ï¼›æš—å·ï¼›é›¶ vi. ä½¿ç”¨å¯†ç ï¼›è®¡ç®—ï¼›åšç®—æœ¯ vt. è®¡ç®—ï¼›åšç®—æœ¯ï¼›å°†â€¦è¯‘æˆå¯†ç 203, circuit [â€˜sÉkÉªt]n. [ç”µå­] ç”µè·¯ï¼Œå›žè·¯ï¼›å·¡å›žï¼›ä¸€åœˆï¼›çŽ¯é“ vi. çŽ¯è¡Œ vt. ç»•å›žâ€¦çŽ¯è¡Œ204, circumstance [ËˆsÉâ€‹kÉ™mËŒstÉ™ns]n. çŽ¯å¢ƒï¼Œæƒ…å†µï¼›äº‹ä»¶ï¼›å¢ƒé‡205, citrus [â€˜sÉªtrÉ™s]n. [å›­è‰º] æŸ‘æ©˜å±žæžœæ ‘ï¼›æŸ‘æ©˜ç±»çš„æ¤ç‰©;adj. æŸ‘æ©˜å±žæ¤ç‰©çš„206, claim [kleÉªm]vi. æå‡ºè¦æ±‚;vt. è¦æ±‚ï¼›å£°ç§°ï¼›éœ€è¦ï¼›è®¤é¢†;n. è¦æ±‚ï¼›å£°ç§°ï¼›ç´¢èµ”ï¼›æ–­è¨€ï¼›å€¼å¾—207, clamp [klÃ¦mp]vt. å¤¹ç´§ï¼Œå›ºå®šä½n. å¤¹é’³ï¼Œèžºä¸é’³208, clarity [â€˜klÃ¦rÉªtÉª]n. æ¸…æ¥šï¼Œæ˜Žæ™°ï¼›é€æ˜Ž;n. (Clarity)äººåï¼›(è‹±)å…‹æ‹‰é‡Œè’‚209, Clip [klÉªp]vt. ä¿®å‰ªï¼›å¤¹ç‰¢ï¼›ç—›æ‰“;vi. ä¿®å‰ª;n. ä¿®å‰ªï¼›å¤¹å­ï¼›å›žå½¢é’ˆ210, clove [klÉ™ÊŠv]n. [æ¤][ä¸­åŒ»] ä¸é¦™v. åŠˆå¼€ï¼ˆcleaveçš„è¿‡åŽ»å¼ï¼‰211, clue [klÊŠ]n. çº¿ç´¢ï¼›ï¼ˆæ•…äº‹ç­‰çš„ï¼‰æƒ…èŠ‚vt. ä¸ºâ€¦æä¾›çº¿ç´¢ï¼›ä¸ºâ€¦æä¾›æƒ…å†µ212, cluster [â€˜klÊŒstÉ™]n. ç¾¤ï¼›ç°‡ï¼›ä¸›ï¼›ä¸²vi. ç¾¤èšï¼›ä¸›ç”Ÿvt. ä½¿èšé›†ï¼›èšé›†åœ¨æŸäººçš„å‘¨å›´n. (Cluster)äººåï¼›(è‹±)å…‹æ‹‰æ–¯ç‰¹213, co-branding [kÉ™uâ€™brÃ¦ndiÅ‹]n. è”åˆå“ç‰Œï¼›åˆä½œå“ç‰Œ214, coalescedåˆå¹¶ï¼ˆcoalesceçš„è¿‡åŽ»å¼å’Œè¿‡åŽ»åˆ†è¯ï¼‰215, coarse [kÉ”rs]adj. ç²—ç³™çš„ï¼›ç²—ä¿—çš„ï¼›ä¸‹ç­‰çš„216, coerce [kÉ™ÊŠâ€™ÉœËs]vt. å¼ºåˆ¶ï¼Œè¿«ä½¿217, coexist [,kÉ™ÊŠÉªgâ€™zÉªst]vi. å…±å­˜ï¼›å’Œå¹³å…±å¤„218, cognitive [â€˜kÉ’É¡nÉªtÉªv]adj. è®¤çŸ¥çš„ï¼Œè®¤è¯†çš„219, coherency [coherency]n. é™„ç€ï¼›å‡èšï¼›è”æŽ¥ï¼›ç›¸å‚æ€§220, coherent [kÉ™(ÊŠ)â€™hÉªÉ™r(É™)nt]adj. è¿žè´¯çš„ï¼Œä¸€è‡´çš„ï¼›æ˜Žäº†çš„ï¼›æ¸…æ™°çš„ï¼›å‡èšæ€§çš„ï¼›äº’ç›¸è€¦åˆçš„ï¼›ç²˜åœ¨ä¸€èµ·çš„221, cohesive [kÉ™ÊŠâ€™hiËsÉªv]adj. æœ‰ç»“åˆåŠ›çš„ï¼›ç´§å¯†ç»“åˆçš„ï¼›æœ‰ç²˜ç€åŠ›çš„222, collaboration [kÉ™lÃ¦bÉ™â€™reÉªÊƒn]n. åˆä½œï¼›å‹¾ç»“ï¼›é€šæ•Œ223, collapsar [kÉ™â€™lÃ¦psÉ‘Ë]n. é»‘æ´žï¼ˆç­‰äºŽblack holeï¼‰224, collapse [kÉ™â€™lÃ¦ps]vi.å€’å¡Œï¼›ç“¦è§£ï¼›æš´è·Œvt.ä½¿å€’å¡Œï¼Œä½¿å´©æºƒï¼›ä½¿èŽé™·ï¼›æŠ˜å n.å€’å¡Œï¼›å¤±è´¥ï¼›è¡°ç«­225, collide [kÉ™â€™laÉªd]vi. ç¢°æ’žï¼›æŠµè§¦ï¼Œå†²çª;vt. ä½¿ç¢°æ’žï¼›ä½¿ç›¸æ’ž226, collision [kÉ™â€™lÉªÊ’(É™)n]n. ç¢°æ’žï¼›å†²çªï¼›ï¼ˆæ„è§ï¼Œçœ‹æ³•ï¼‰çš„æŠµè§¦ï¼›ï¼ˆæ”¿å…šç­‰çš„ï¼‰å€¾è½§227, collisions [collisions]n. [ç‰©] ç¢°æ’žï¼›å†²çªï¼›æ’žå‡»ï¼ˆcollisionçš„å¤æ•°å½¢å¼ï¼‰228, colloquially [kÉ™â€™lÉ™ukwiÉ™li]adv. å£è¯­åœ°ï¼›ç”¨é€šä¿—è¯­229, collyvt. ï¼ˆè‹±ï¼‰æŠŠâ€¦å¼„é»‘n. é”…ç°ï¼›ç…¤ç°n. (Colly)äººåï¼›(è‹±ã€æ³•)ç§‘åˆ©230, colon [â€˜kolÉ™n]n. [è§£å‰–] ç»“è‚ ï¼›å†’å·ï¼ˆç”¨äºŽå¼•è¯­ã€è¯´æ˜Žã€ä¾‹è¯ç­‰ä¹‹å‰ï¼‰ï¼›ç§‘éƒŽï¼ˆå“¥æ–¯è¾¾é»ŽåŠ è´§å¸å•ä½ï¼‰231, comma [â€˜kÉ‘mÉ™]n. é€—å·ï¼›åœé¡¿232, Commerce [â€˜kÉ’mÉœËs]n. è´¸æ˜“ï¼Œå•†ä¸š233, commercial [kÉ™â€™mÉœËÊƒ(É™)l]adj. å•†ä¸šçš„ï¼›è¥åˆ©çš„ï¼›é å¹¿å‘Šæ”¶å…¥çš„;n. å•†ä¸šå¹¿å‘Š234, communicating [kÉ™â€™mjÊŠnÉ™,ketÉªÅ‹]adj. äº¤æµçš„ï¼›é€šä¿¡çš„v. äº¤æµï¼›ä¼ æ’­ï¼ˆcommunicateçš„çŽ°åœ¨åˆ†è¯ï¼‰ï¼›ä¼ é€’235, comparison [kÉ™mâ€™pÃ¦rÉªs(É™)n]n. æ¯”è¾ƒï¼›å¯¹ç…§ï¼›æ¯”å–»ï¼›æ¯”è¾ƒå…³ç³»236, compatible [kÉ™mâ€™pÃ¦tÉªb(É™)l]adj. å…¼å®¹çš„ï¼›èƒ½å…±å¤„çš„ï¼›å¯å¹¶ç«‹çš„237, compensate [â€˜kÉ’mpenseÉªt]vi. è¡¥å¿ï¼Œèµ”å¿ï¼›æŠµæ¶ˆ;vt. è¡¥å¿ï¼Œèµ”å¿ï¼›ä»˜æŠ¥é…¬238, Compensation [kÉ’mpenâ€™seÉªÊƒ(É™)n]n. è¡¥å¿ï¼›æŠ¥é…¬ï¼›èµ”å¿é‡‘239, comply [kÉ™mâ€™plaÉª]vi. éµå®ˆï¼›é¡ºä»Žï¼Œéµä»Žï¼›ç­”åº”240, compound [â€˜kÉ’mpaÊŠnd]n. [åŒ–å­¦] åŒ–åˆç‰©ï¼›æ··åˆç‰©ï¼›å¤åˆè¯ adj. å¤åˆçš„ï¼›æ··åˆçš„ v. åˆæˆï¼›æ··åˆï¼›æ¶åŒ–ï¼ŒåŠ é‡ï¼›å’Œè§£ï¼Œå¦¥å241, comprehensive [kÉ’mprÉªâ€™hensÉªv]adj. ç»¼åˆçš„ï¼›å¹¿æ³›çš„ï¼›æœ‰ç†è§£åŠ›çš„;n. ç»¼åˆå­¦æ ¡ï¼›ä¸“ä¸šç»¼åˆæµ‹éªŒ242, Comprehensive [kÉ’mprÉªâ€™hensÉªv]adj. ç»¼åˆçš„ï¼›å¹¿æ³›çš„ï¼›æœ‰ç†è§£åŠ›çš„;n. ç»¼åˆå­¦æ ¡ï¼›ä¸“ä¸šç»¼åˆæµ‹éªŒ243, compulsive [kÉ™mâ€™pÊŒlsÉªv]adj. å¼ºåˆ¶çš„ï¼›å¼ºè¿«çš„244, computation [kÉ’mpjÊŠâ€™teÉªÊƒ(É™)n]n. ä¼°è®¡ï¼Œè®¡ç®—245, concatenate [kÉ‘nâ€™kÃ¦tÉ™,net]vt. è¿žç»“ï¼›ä½¿è¿žé”adj. è¿žç»“çš„ï¼›è¿žé”çš„246, conclusions [kÉ™nâ€™klÊŠÊ’É™nz]n. ç»“è®ºï¼Œæ€»ç»“ï¼›å†³å®šï¼ˆconclusionçš„å¤æ•°ï¼‰247, concrete [â€˜kÉ’Å‹kriËt]adj. æ··å‡åœŸçš„ï¼›å®žåœ¨çš„ï¼Œå…·ä½“çš„ï¼›æœ‰å½¢çš„;vi. å‡ç»“;vt. ä½¿å‡å›ºï¼›ç”¨æ··å‡åœŸä¿®ç­‘;n. å…·ä½“ç‰©ï¼›å‡ç»“ç‰©248, Concrete [â€˜kÉ’Å‹kriËt]adj. æ··å‡åœŸçš„ï¼›å®žåœ¨çš„ï¼Œå…·ä½“çš„ï¼›æœ‰å½¢çš„;vi. å‡ç»“;vt. ä½¿å‡å›ºï¼›ç”¨æ··å‡åœŸä¿®ç­‘;n. å…·ä½“ç‰©ï¼›å‡ç»“ç‰©249, condense [kÉ™nâ€™dens]vi. æµ“ç¼©ï¼›å‡ç»“;vt. ä½¿æµ“ç¼©ï¼›ä½¿åŽ‹ç¼©250, confidentiality [,kÉ‘nfÉª,dÉ›nÊƒÉªâ€™Ã¦lÉ™ti]n. æœºå¯†ï¼Œ[è®¡] æœºå¯†æ€§251, confinement [kÉ™nâ€™faÉªnmÉ™nt]n. é™åˆ¶ï¼›ç›‘ç¦ï¼›åˆ†å¨©252, confluence [â€˜kÉ‘nfluÉ™ns]n. ï¼ˆæ²³æµçš„ï¼‰æ±‡åˆã€æ±‡æµç‚¹ï¼›ï¼ˆäººæˆ–ç‰©çš„ï¼‰èšé›†253, conjunction [kÉ™nâ€™dÊ’ÊŒÅ‹kÊƒÉ™n]n. ç»“åˆï¼›[è¯­] è¿žæŽ¥è¯ï¼›åŒæ—¶å‘ç”Ÿ254, consecutive [kÉ™nâ€™sekjÊŠtÉªv]adj. è¿žè´¯çš„ï¼›è¿žç»­ä¸æ–­çš„255, conservative [kÉ™nâ€™sÉvÉ™tÉªv]adj. ä¿å®ˆçš„n. ä¿å®ˆæ´¾ï¼Œå®ˆæ—§è€…256, consistent [kÉ™nâ€™sÉªstÉ™nt]adj. å§‹ç»ˆå¦‚ä¸€çš„ï¼Œä¸€è‡´çš„ï¼›åšæŒçš„257, constant [â€˜kÉ’nst(É™)nt]adj. ä¸å˜çš„ï¼›æ’å®šçš„ï¼›ç»å¸¸çš„;n. [æ•°] å¸¸æ•°ï¼›æ’é‡;n. (Constant)äººåï¼›(å¾·)åº·æ–¯å¦ç‰¹258, Constant [â€˜kÉ’nst(É™)nt]adj. ä¸å˜çš„ï¼›æ’å®šçš„ï¼›ç»å¸¸çš„;n. [æ•°] å¸¸æ•°ï¼›æ’é‡;n. (Constant)äººåï¼›(å¾·)åº·æ–¯å¦ç‰¹259, consult [kÉ™nâ€™sÊŒlt]vt. æŸ¥é˜…ï¼›å•†é‡ï¼›å‘â€¦è¯·æ•™;vi. è¯·æ•™ï¼›å•†è®®ï¼›å½“é¡¾é—®260, consumption [kÉ™nâ€™sÊŒm(p)Êƒ(É™)n]n. æ¶ˆè´¹ï¼›æ¶ˆè€—ï¼›è‚ºç—¨261, contend [kÉ™nâ€™tÉ›nd]vi. ç«žäº‰ï¼›å¥‹æ–—ï¼›æ–—äº‰ï¼›äº‰è®ºvt. ä¸»å¼ ï¼›ä¸ºâ€¦æ–—äº‰262, contention [kÉ™nâ€™tÉ›nÊƒÉ™n]n. äº‰è®ºï¼Œäº‰è¾©ï¼›äº‰å¤ºï¼›è®ºç‚¹263, contiguous [kÉ™nâ€™tÉªgjÊŠÉ™s]adj. è¿žç»­çš„ï¼›é‚»è¿‘çš„ï¼›æŽ¥è§¦çš„264, continual [kÉ™nâ€™tÉªnjÊŠÉ™l]adj. æŒç»­ä¸æ–­çš„ï¼›é¢‘ç¹çš„265, continuations [continuations]n. å»¶ç»­éƒ¨åˆ†ï¼›ï¼ˆä¹¦ç±çš„ï¼‰é™„å½•ï¼›ï¼ˆæ–‡å­¦ä½œå“çš„ï¼‰ç»­é›†ï¼ˆcontinuationçš„å¤æ•°ï¼‰266, convenient [kÉ™nâ€™viËnÉªÉ™nt]adj. æ–¹ä¾¿çš„ï¼›[åºŸè¯­]é€‚å½“çš„ï¼›[å£è¯­]è¿‘ä¾¿çš„ï¼›å®žç”¨çš„267, Convenient [kÉ™nâ€™viËnÉªÉ™nt]adj. æ–¹ä¾¿çš„;æ–¹ä¾¿;è¿‘ä¾¿çš„;è¿‘ä¾¿åœ°268, convention [kÉ™nâ€™venÊƒ(É™)n]n. å¤§ä¼šï¼›[æ³•] æƒ¯ä¾‹ï¼›[è®¡] çº¦å®šï¼›[æ³•] åå®šï¼›ä¹ ä¿—269, conversely [â€˜kÉ‘nvÉsli]adv. ç›¸ååœ°270, conveys [conveys]è¿è¾“è¡¨è¾¾271, coordinate [kÉ™ÊŠâ€™É”:dÉªneÉªt]n. åæ ‡ï¼›åŒç­‰çš„äººæˆ–ç‰©;adj. å¹¶åˆ—çš„ï¼›åŒç­‰çš„;vt. è°ƒæ•´ï¼›æ•´åˆ;vi. åè°ƒ272, coordinator [koâ€™É”rdn,etÉš]n. åè°ƒè€…ï¼›[è‡ª] åè°ƒå™¨ï¼›åŒç­‰çš„äººæˆ–ç‰©273, cordon [â€˜kÉ”rdn]n. è­¦æˆ’çº¿ï¼›ç»¶å¸¦ï¼›æŸå¸¦å±‚vt. ç”¨è­¦æˆ’çº¿å›´ä½ï¼›åŒ…å›´éš”ç¦»n. (Cordon)äººåï¼›(è‹±ã€è¥¿)ç§‘ç™»ï¼›(æ³•ã€è‘¡)ç§‘å°”ä¸œ274, cornerstone [â€˜kÉ”ËnÉ™stÉ™ÊŠn]n. åŸºç¡€ï¼›æŸ±çŸ³ï¼›åœ°åŸº275, coroutine [,kÉ™uru:â€™ti:n]n. ååŒç¨‹åº276, correspond [kÉ’rÉªâ€™spÉ’nd]vi. ç¬¦åˆï¼Œä¸€è‡´ï¼›ç›¸åº”ï¼›é€šä¿¡277, correspondingly [,kÉ”rÉ™â€™spÉ‘ndÉªÅ‹li]adv. ç›¸åº”åœ°ï¼Œç›¸å¯¹åœ°278, Cotton [â€˜kÉ’t(É™)n]n. æ£‰èŠ±ï¼›æ£‰å¸ƒï¼›æ£‰çº¿vi. ä¸€è‡´ï¼›ç†è§£ï¼›å’Œè°ï¼›äº²è¿‘adj. æ£‰çš„ï¼›æ£‰åˆ¶çš„n. (Cotton)äººåï¼›(è‹±ã€è¥¿ã€è‘¡)ç§‘é¡¿ï¼›(æ³•)æˆˆç™»279, counterintuitive [,kaÊŠntÉ™rÉªnâ€™tjuËÉªtÉªv]adj. è¿åç›´è§‰çš„280, counterpart [â€˜kaÊŠntÉ™pÉ‘Ët]n. å‰¯æœ¬ï¼›é…å¯¹ç‰©ï¼›æžç›¸ä¼¼çš„äººæˆ–ç‰©281, Courage [â€˜kÊŒrÉªdÊ’]n. å‹‡æ°”ï¼›èƒ†é‡;n. (Courage)äººåï¼›(è‹±)å¡é‡Œå¥‡ï¼›(æ³•)åº“æ‹‰çƒ­282, crap [krÃ¦p]n. åºŸè¯ï¼›åºŸç‰©ï¼›å±Žï¼›æ‹‰å±Žvi. æŽ·éª°å­ï¼›æ‹‰å±Žn. (Crap)äººåï¼›(è‹±)å…‹æ‹‰æ™®283, crater [â€˜kreÉªtÉ™]n. ç«å±±å£ï¼›å¼¹å‘;vt. åœ¨â€¦ä¸Šå½¢æˆå‘ï¼›å–æ¶ˆï¼›æ¯å;vi. å½¢æˆå‘ï¼›æ¶ˆäº¡284, crawler [â€˜krÉ”lÉš]n. çˆ¬è¡Œè€…ï¼›å±¥å¸¦ç‰µå¼•è£…ç½®285, creamy [â€˜kriËmÉª]adj.å¥¶æ²¹è‰²çš„ï¼›ä¹³è„‚çŠ¶çš„ï¼›å«ä¹³è„‚çš„286, crisp [krÉªsp]adj. è„†çš„ï¼›æ–°é²œçš„ï¼›æ˜“ç¢Žçš„;vt. ä½¿å·æ›²ï¼›ä½¿å‘è„†;vi. å·æ›²ï¼›å‘è„†;n. æ¾è„†ç‰©ï¼›æ²¹ç‚¸é©¬é“ƒè–¯ç‰‡;n. (Crisp)äººåï¼›(è‹±)å…‹é‡Œæ–¯æ™®287, criteria [kraÉªâ€™tÉªÉ™rÉªÉ™]n. æ ‡å‡†ï¼Œæ¡ä»¶ï¼ˆcriterionçš„å¤æ•°ï¼‰288, Criteria [kraÉªâ€™tÉªÉ™rÉªÉ™]n. æ ‡å‡†ï¼Œæ¡ä»¶ï¼ˆcriterionçš„å¤æ•°ï¼‰289, critical [â€˜krÉªtÉªk(É™)l]adj. é‰´å®šçš„ï¼›[æ ¸] ä¸´ç•Œçš„ï¼›æ‰¹è¯„çš„ï¼Œçˆ±æŒ‘å‰”çš„ï¼›å±é™©çš„ï¼›å†³å®šæ€§çš„ï¼›è¯„è®ºçš„290, criticize [â€˜krÉªtÉªsaÉªz]vt. æ‰¹è¯„ï¼›è¯„è®ºï¼›éžéš¾vi. æ‰¹è¯„ï¼›è¯„è®ºï¼›è‹›æ±‚291, cropper [â€˜krÉ’pÉ™]n. ç§æ¤è€…ï¼›å†œä½œç‰©ï¼›æ”¶å‰²æœºï¼›ä¿®å‰ªæœºn. (Cropper)äººåï¼›(æ„)å…‹ç½—ç€å°”ï¼›(è‹±)å…‹ç½—ç€292, crucial [â€˜kruËÊƒ(É™)l]adj. é‡è¦çš„ï¼›å†³å®šæ€§çš„ï¼›å®šå±€çš„ï¼›å†³æ–­çš„293, crunch [krÊŒn(t)Êƒ]n. å’¬ç¢Žï¼Œå’¬ç¢Žå£°ï¼›æ‰Žæ‰Žåœ°è¸vt. åŽ‹ç¢Žï¼›å˜Žæ‰Žå˜Žæ‰Žçš„å’¬åš¼ï¼›æ‰Žæ‰Žåœ°è¸è¿‡vi. å˜Žå±ä½œå“åœ°å’€åš¼ï¼›å˜Žå±å˜Žå±åœ°è¸è¿‡294, cryptography [krÉªpâ€™tÉ’grÉ™fÉª]n. å¯†ç å­¦ï¼›å¯†ç ä½¿ç”¨æ³•295, Cryptography [krÉªpâ€™tÉ’grÉ™fÉª]n. å¯†ç å­¦ï¼›å¯†ç ä½¿ç”¨æ³•296, cue [kjuË]n.æç¤ºï¼Œæš—ç¤ºï¼›çº¿ç´¢vt.ç»™â€¦æš—ç¤ºn.(Cue)äººåï¼›(è¥¿)åº“åŸƒ297, culprit [â€˜kÊŒlprÉªt]n. çŠ¯äººï¼Œç½ªçŠ¯ï¼›è¢«æŽ§çŠ¯ç½ªçš„äºº298, cumbersome [â€˜kÊŒmbÉ™s(É™)m]adj. ç¬¨é‡çš„ï¼›ç´¯èµ˜çš„ï¼›éš¾å¤„ç†çš„299, cumulative [â€˜kjumjÉ™letÉªv]adj. ç´¯ç§¯çš„300, cumulativelyadv. ç´¯ç§¯åœ°ï¼›æ¸å¢žåœ°301, curator [kjÊŠ(É™)â€™reÉªtÉ™]n. é¦†é•¿ï¼›ç›‘æŠ¤äººï¼›ç®¡ç†è€…302, curly [â€˜kÉœËlÉª]adj. å·æ›²çš„ï¼›å·æ¯›çš„ï¼›ï¼ˆæœ¨æï¼‰æœ‰çš±çŠ¶çº¹ç†çš„ï¼›èœ·ç¼©çš„303, curry [â€˜kÊŒrÉª]vt. ç”¨å’–å–±çƒ§ï¼Œç»™â€¦åŠ å’–å–±ç²‰ï¼›æ¢³åˆ·ï¼›éž­æ‰“;n. å’–å“©ç²‰ï¼Œå’–å–±ï¼›å’–å“©é¥­èœ304, cutoff [â€˜kÊŒt,É”Ëf]n. åˆ‡æŽ‰ï¼›ä¸­æ–­ï¼›æ·å¾„ adj. æˆªæ­¢çš„ï¼›ä¸­æ–­çš„305, cutting-edge [â€˜kÊŒtÉªÅ‹â€™edÊ’]n. (åˆ€ç‰‡çš„)åˆƒå£ï¼›å°–ç«¯ï¼›å‰æ²¿;adj. å…ˆè¿›çš„ï¼Œå°–ç«¯çš„306, Cycle [â€˜saÉªk(É™)l]n. å¾ªçŽ¯ï¼›å‘¨æœŸï¼›è‡ªè¡Œè½¦ï¼›æ•´å¥—ï¼›ä¸€æ®µæ—¶é—´;vt. ä½¿å¾ªçŽ¯ï¼›ä½¿è½®è½¬;vi. å¾ªçŽ¯ï¼›éª‘è‡ªè¡Œè½¦ï¼›è½®è½¬307, cyclone [â€˜saÉªklon]n. æ—‹é£Žï¼›[æ°”è±¡] æ°”æ—‹ï¼›é£“é£Ž308, dabble [â€˜dÃ¦bl]vt. æº…æ¹¿ï¼›æµ¸å…¥æ°´ä¸­vi. æ¶‰çŒŽï¼›æ¶‰è¶³ï¼›çŽ©æ°´309, daemon [â€˜diËmÉ™n]n. å®ˆæŠ¤è¿›ç¨‹ï¼›åŽå°ç¨‹åº310, dapper [â€˜dÃ¦pÉš]adj. çŸ­å°ç²¾æ‚çš„ï¼›è¡£å† æ¥šæ¥šçš„ï¼›æ•´æ´çš„ï¼›æ•´é½çš„n. (Dapper)äººåï¼›(è‹±)è¾¾ç€ï¼›(æ„)è¾¾ç€å°”ï¼›(å¾·)è¾¾ä½©å°”311, Dashboard [â€˜dÃ¦ÊƒbÉ”Ëd]n. æ±½è½¦ç­‰çš„ä»ªè¡¨æ¿ï¼›é©¬è½¦ç­‰å‰éƒ¨çš„æŒ¡æ³¥æ¿312, daunting [â€˜dÉ”ntÉªÅ‹]adj. ä½¿äººç•ç¼©çš„ï¼›ä½¿äººæ°”é¦çš„ï¼›ä»¤äººæ€¯æ­¥çš„313, deactivation [di:,Ã¦ktiâ€™veiÊƒÉ™n]n. [ç‰©åŒ–] å‡æ´»åŒ–ä½œç”¨ï¼›é’åŒ–ä½œç”¨314, dealt [delt]v. å¤„ç†ï¼ˆdealçš„è¿‡åŽ»å¼å’Œè¿‡åŽ»åˆ†è¯ï¼‰315, decade [â€˜dekeid]n. åå¹´ï¼Œåå¹´æœŸï¼›å316, decay [dÉªâ€™ke]vi. è¡°é€€ï¼Œ[æ ¸] è¡°å‡ï¼›è…çƒ‚ï¼Œè…æœ½n. è¡°é€€ï¼Œ[æ ¸] è¡°å‡ï¼›è…çƒ‚ï¼Œè…æœ½vt. ä½¿è…çƒ‚ï¼Œä½¿è…è´¥ï¼›ä½¿è¡°é€€ï¼Œä½¿è¡°è½n. (Decay)äººåï¼›(æ³•)å¾·å‡¯317, decaying [dÉªâ€™ke]n. [æ ¸] è¡°å‡ï¼›é¢“åï¼›è…èš€ä½œç”¨v. è…çƒ‚ï¼›è¡°é€€ï¼›æ¶ˆç˜¦ï¼ˆdecayçš„ingå½¢å¼ï¼‰adj. è¡°å‡çš„ï¼›è…çƒ‚çš„ï¼›æ¶ˆæ•£çš„318, declarations [,deklÉ™â€™reiÊƒÉ™nz]n. [æ³•] å£°æ˜Žï¼ˆdeclarationçš„å¤æ•°ï¼‰319, Declarative [dÉªâ€™klÃ¦rÉ™tÉªv]adj. å®£è¨€çš„ï¼›é™ˆè¿°çš„ï¼Œè¯´æ˜Žçš„320, decommission [diËkÉ™â€™mÉªÊƒ(É™)n]vt. ä½¿â€¦é€€å½¹ï¼›è§£é™¤â€¦çš„å†›èŒ321, decorate [â€˜dekÉ™reÉªt]vt. è£…é¥°ï¼›å¸ƒç½®ï¼›æŽˆå‹‹ç»™;vi. è£…é¥°ï¼›å¸ƒç½®322, decoration [dekÉ™â€™reÉªÊƒ(É™)n]n. è£…é¥°ï¼Œè£…æ½¢ï¼›è£…é¥°å“ï¼›å¥–ç« 323, decorator [â€˜dÉ›kÉ™retÉš]n. è£…é¥°è€…ï¼›å®¤å†…è£…æ½¢å¸ˆ324, decouple [diËâ€™kÊŒp(É™)l]vt. å‡å¼±éœ‡æ³¢;n. [ç”µ] åŽ»è€¦325, decoupling [di:â€™kÊŒpliÅ‹]n. åŽ»è€¦v. åŽ»è€¦ï¼ˆdecoupleçš„çŽ°åœ¨åˆ†è¯ï¼‰326, dedicate [â€˜dÉ›dÉªket]vt. è‡´åŠ›ï¼›çŒ®èº«ï¼›é¢˜çŒ®327, dedicated [â€˜dÉ›dÉ™â€™ketÉªd]adj. ä¸“ç”¨çš„ï¼›ä¸“æ³¨çš„ï¼›çŒ®èº«çš„v. ä»¥â€¦å¥‰çŒ®ï¼›æŠŠâ€¦ç”¨äºŽï¼ˆdedicateçš„è¿‡åŽ»å¼å’Œè¿‡åŽ»åˆ†è¯ï¼‰328, deem [diËm]vt. è®¤ä¸ºï¼Œè§†ä½œï¼›ç›¸ä¿¡ vi. è®¤ä¸ºï¼ŒæŒæŸç§çœ‹æ³•ï¼›ä½œæŸç§è¯„ä»· n. (Deem)äººåï¼›(è‹±)è¿ªå§†329, deemed [diËmd]v. è®¤ä¸ºï¼ˆdeemçš„è¿‡åŽ»å¼ï¼‰330, Defer [dÉªâ€™fÉœË]vi. æŽ¨è¿Ÿï¼›å»¶æœŸï¼›æœä»Ž;vt. ä½¿æŽ¨è¿Ÿï¼›ä½¿å»¶æœŸ;n. (Defer)äººåï¼›(æ³•)å¾·è´¹331, Deferred [dÉªâ€™fÉœËd]adj. å»¶æœŸçš„;v. æŽ¨è¿Ÿï¼ˆdeferçš„è¿‡åŽ»å¼åŠè¿‡åŽ»åˆ†è¯å½¢å¼ï¼‰332, deficiency [dÉªâ€™fÉªÊƒ(É™)nsÉª]n. ç¼ºé™·ï¼Œç¼ºç‚¹ï¼›ç¼ºä¹ï¼›ä¸è¶³çš„æ•°é¢333, deficient [dÉªâ€™fÉªÊƒ(É™)nt]adj. ä¸è¶³çš„ï¼›æœ‰ç¼ºé™·çš„ï¼›ä¸å……åˆ†çš„334, deflate [dÉªâ€™flet]vt. æ”¾æ°”ï¼›ä½¿ç¼©å°ï¼›ç´§ç¼©é€šè´§ï¼›æ‰“å‡»ï¼›ä½¿æ³„æ°”vi. ç¼©å°ï¼›ç‰©ä»·ä¸‹é™335, degree [dÉªâ€™griË]n. ç¨‹åº¦ï¼Œç­‰çº§ï¼›åº¦ï¼›å­¦ä½ï¼›é˜¶å±‚336, dejection [dÉªâ€™dÊ’ekÊƒ(É™)n]n. æ²®ä¸§ï¼›ç²ªä¾¿337, delimiter [dÉªâ€™lÉªmÉªtÉš]n. [è®¡] å®šç•Œç¬¦338, delta [â€˜dÉ›ltÉ™]n. ï¼ˆæ²³æµçš„ï¼‰ä¸‰è§’æ´²ï¼›å¾·è€³å¡”ï¼ˆå¸Œè…Šå­—æ¯çš„ç¬¬å››ä¸ªå­—ï¼‰n. (Delta)äººåï¼›(è‹±ã€ç½—ã€è‘¡)å¾·å°”å¡”339, demand [dÉªâ€™mÉ‘Ënd]vt. è¦æ±‚ï¼›éœ€è¦ï¼›æŸ¥è¯¢;vi. éœ€è¦ï¼›è¯·æ±‚ï¼›æŸ¥é—®;n. [ç»] éœ€æ±‚ï¼›è¦æ±‚ï¼›éœ€è¦;n. (Demand)äººåï¼›(å¾·)å¾·æ›¼å¾·340, demarcation [â€˜dimÉ‘râ€™keÊƒÉ™n]n. åˆ’åˆ†ï¼›åˆ’ç•Œï¼›é™ç•Œ341, democracy [dÉªËˆmÉ‘krÉ™si]n. æ°‘ä¸»ï¼Œæ°‘ä¸»ä¸»ä¹‰ï¼›æ°‘ä¸»æ”¿æ²»342, demonstrate [â€˜demÉ™nstreÉªt]vt. è¯æ˜Žï¼›å±•ç¤ºï¼›è®ºè¯vi. ç¤ºå¨343, demote [diËâ€™mÉ™ÊŠt]vt. ä½¿é™çº§ï¼›ä½¿é™èŒ344, denial [dÉªâ€™naÉªÉ™l]n. å¦è®¤ï¼›æ‹’ç»ï¼›èŠ‚åˆ¶ï¼›èƒŒå¼ƒ345, denotedè¡¨ç¤ºï¼ŒæŒ‡ç¤ºï¼ˆdenoteçš„è¿‡åŽ»å¼å’Œè¿‡åŽ»åˆ†è¯ï¼‰346, Denotes []ä¸ºâ€¦çš„ç¬¦å·ï¼Œè¡¨ç¤ºï¼ŒæŒ‡ç¤ºï¼ˆdenoteçš„ç¬¬ä¸‰äººç§°å•æ•°ï¼‰347, density [â€˜dÉ›nsÉ™ti]n. å¯†åº¦348, dentryç›®å½•é¡¹349, depict [dÉªâ€™pÉªkt]vt. æè¿°ï¼›æç”»350, Deploy [dÉªâ€™plÉ’Éª]vt. é…ç½®ï¼›å±•å¼€ï¼›ä½¿ç–å¼€;vi. éƒ¨ç½²ï¼›å±•å¼€;n. éƒ¨ç½²351, depot [â€˜depÉ™ÊŠ]n. ä»“åº“ï¼›åœè½¦åœºï¼›èˆªç©ºç«™;vt. æŠŠâ€¦å­˜æ”¾åœ¨å‚¨è—å¤„;adj. è¯æ€§æŒä¹…çš„;n. (Depot)äººåï¼›(åˆš(å¸ƒ))å¾·æ³¢ç‰¹352, deprecation [,depriâ€™keiÊƒÉ™n]n. ç¥ˆå…ï¼›è´¬ä½Žï¼›åå¯¹353, derivative [dÉªâ€™rÉªvÉ™tÉªv]n. [åŒ–å­¦] è¡ç”Ÿç‰©ï¼Œæ´¾ç”Ÿç‰©ï¼›å¯¼æ•°adj. æ´¾ç”Ÿçš„ï¼›å¼•å‡ºçš„354, descendant [dÉªâ€™sÉ›ndÉ™nt]adj. ä¸‹é™çš„ï¼›ç¥–ä¼ çš„n. åŽè£”ï¼›å­å­™355, descended [dÉªâ€™sendÉªd]adj. å‡ºèº«äºŽâ€¦çš„ï¼›ä»Žä¸€ä¸ªç¥–å…ˆä¼ ä¸‹æ¥çš„356, designate [â€˜dezÉªgneÉªt]vt. æŒ‡å®šï¼›æŒ‡æ´¾ï¼›æ ‡å‡ºï¼›æŠŠâ€¦å®šåä¸º;adj. æŒ‡å®šçš„ï¼›é€‰å®šçš„357, designated [â€˜dÉ›zÉªg,netÉªd]adj. æŒ‡å®šçš„ï¼›ç‰¹æŒ‡çš„358, desirable [dÉªâ€™zaÉªÉ™rÉ™bl]adj. ä»¤äººæ»¡æ„çš„ï¼›å€¼å¾—è¦çš„ n. åˆæ„çš„äººæˆ–äº‹ç‰©359, desire [dÉªâ€™zaÉªÉš]n. æ¬²æœ›ï¼›è¦æ±‚ï¼Œå¿ƒæ„¿ï¼›æ€§æ¬²vt. æƒ³è¦ï¼›è¦æ±‚ï¼›å¸Œæœ›å¾—åˆ°â€¦vi. æ¸´æœ›n. (Desire)äººåï¼›(åˆš(å¸ƒ)ã€è‹±)å¾·è¥¿é›·360, desired [dÉªâ€™zaÉªrd]adj. æ¸´æœ›çš„ï¼›æƒ³å¾—åˆ°çš„v. æ¸´æœ›ï¼Œè¦æ±‚ï¼ˆdesireçš„è¿‡åŽ»åˆ†è¯å½¢å¼ï¼‰361, destruction [dÉªâ€™strÊŒkÊƒ(É™)n]n. ç ´åï¼Œæ¯ç­ï¼›æ‘§æ¯362, detach [dÉªâ€™tÃ¦tÊƒ]vt. åˆ†ç¦»ï¼›æ´¾é£ï¼›ä½¿è¶…ç„¶363, detached [dÉªâ€™tÃ¦tÊƒt]adj. åˆ†ç¦»çš„ï¼Œåˆ†å¼€çš„ï¼›è¶…ç„¶çš„v. åˆ†ç¦»364, Detail [â€˜diËteÉªl]n. ç»†èŠ‚ï¼Œè¯¦æƒ…;vt. è¯¦è¿°ï¼›é€‰æ´¾;vi. ç”»è¯¦å›¾365, deviation [â€˜divÉªâ€™eÊƒÉ™n]n. åå·®ï¼›è¯¯å·®ï¼›èƒŒç¦»366, diagnose [â€˜daÉªÉ™gnÉ™ÊŠz; -â€˜nÉ™ÊŠz]vt. è¯Šæ–­ï¼›æ–­å®š vi. è¯Šæ–­ï¼›åˆ¤æ–­367, diagram [â€˜daÉªÉ™grÃ¦m]n. å›¾è¡¨ï¼›å›¾è§£vt. ç”¨å›¾è§£æ³•è¡¨ç¤ºdiagram: å›¾è¡¨ å›¾è§£ ç®€å›¾368, dial [â€˜daÉªÉ™l]n. è½¬ç›˜ï¼›åˆ»åº¦ç›˜ï¼›é’Ÿé¢vi. æ‹¨å·vt. ç»™â€¦æ‹¨å·æ‰“ç”µè¯n. (Dial)äººåï¼›(è‹±)æˆ´å°”369, dialect [â€˜daÉªÉ™lekt]n. æ–¹è¨€ï¼ŒåœŸè¯ï¼›åŒæºè¯­ï¼›è¡Œè¯ï¼›ä¸ªäººç”¨è¯­ç‰¹å¾ adj. æ–¹è¨€çš„370, Dialect [â€˜daÉªÉ™lekt]n. æ–¹è¨€ï¼ŒåœŸè¯ï¼›åŒæºè¯­ï¼›è¡Œè¯ï¼›ä¸ªäººç”¨è¯­ç‰¹å¾;adj. æ–¹è¨€çš„371, digest [daÉªâ€™dÊ’É›st]vt. æ¶ˆåŒ–ï¼›å¸æ”¶ï¼›èžä¼šè´¯é€švi. æ¶ˆåŒ–n. æ–‡æ‘˜ï¼›æ‘˜è¦372, Digest [daÉªâ€™dÊ’est; dÉª-]vt. æ¶ˆåŒ–ï¼›å¸æ”¶ï¼›èžä¼šè´¯é€š;vi. æ¶ˆåŒ–;n. æ–‡æ‘˜ï¼›æ‘˜è¦373, dimension [dÉªâ€™menÊƒ(É™)n; daÉª-]n. æ–¹é¢;[æ•°] ç»´ï¼›å°ºå¯¸ï¼›æ¬¡å…ƒï¼›å®¹ç§¯ vt. æ ‡å‡ºå°ºå¯¸;adj. è§„æ ¼çš„;adj. è§„æ ¼çš„374, dimensional [dÉªâ€™menÊƒÉ™nÉ™l]adj. ç©ºé—´çš„ï¼›å°ºå¯¸çš„375, dimensionality [daÉªmÉ›nÊƒÉ™â€™nÃ¦lÉ™ti]n. ç»´åº¦ï¼›å¹…å‘˜ï¼›å¹¿å»¶376, dimensions [dÉªâ€™mÉ›nÊƒÉ™nz]n. è§„æ¨¡ï¼Œå¤§å°377, directive [daÉªâ€™rÉ›ktÉªv]n. æŒ‡ç¤ºï¼›æŒ‡ä»¤adj. æŒ‡å¯¼çš„ï¼›ç®¡ç†çš„378, disambiguate [dÉªsÃ¦mâ€™bÉªgjÊŠeÉªt]vt. æ¶ˆé™¤ï¼ˆå­—å¥ç­‰çš„ï¼‰å«ç³Šæ„ä¹‰ï¼Œæ¶ˆé™¤â€¦çš„è™šæ— ä¸»ä¹‰379, disastrous [dÉªâ€™zÉ‘ËstrÉ™s]adj. ç¾éš¾æ€§çš„ï¼›æŸå¤±æƒ¨é‡çš„ï¼›æ‚²ä¼¤çš„380, discrepancy [dÉªsâ€™krep(É™)nsÉª]n. ä¸ç¬¦ï¼›çŸ›ç›¾ï¼›ç›¸å·®381, discretionary [dÉªâ€™skreÊƒ(É™)n(É™)rÉª]adj. ä»»æ„çš„ï¼›è‡ªç”±å†³å®šçš„382, discriminator [dÉªâ€™skrÉªmÉªneÉªtÉ™]n. [ç”µå­] é‰´åˆ«å™¨ï¼›è¾¨åˆ«è€…383, discuss [dÉªâ€™skÊŒs]vt. è®¨è®ºï¼›è®ºè¿°ï¼Œè¾©è®º384, dismiss [dÉªsâ€™mÉªs]vt. è§£æ•£ï¼›è§£é›‡ï¼›å¼€é™¤ï¼›è®©â€¦ç¦»å¼€ï¼›ä¸äºˆç†ä¼šã€ä¸äºˆè€ƒè™‘;vi. è§£æ•£385, Dismissal [dÉªsâ€™mÉªsl]n. è§£é›‡ï¼›å…èŒ386, Dispatcher [dÉªsâ€™pÃ¦tÊƒÉ™]n. è°ƒåº¦å‘˜ï¼›[è®¡] è°ƒåº¦ç¨‹åºï¼›[è®¡] åˆ†é…å™¨387, disperse [dÉªâ€™spÉœËs]vt. åˆ†æ•£ï¼›ä½¿æ•£å¼€ï¼›ä¼ æ’­;vi. åˆ†æ•£;adj. åˆ†æ•£çš„388, Displaced [dÉªsâ€™ples]adj. æ— å®¶å¯å½’çš„ï¼›ä½ç§»çš„ï¼›è¢«å–ä»£çš„n. æ— å®¶å¯å½’è€…v. å–ä»£ï¼ˆdisplaceçš„è¿‡åŽ»åˆ†è¯ï¼‰ï¼›ç§»åŠ¨â€¦çš„ä½ç½®ï¼›æ’¤æ¢389, disruption [dÉªsâ€™rÊŒpÊƒÉ™n]n. ç ´åï¼Œæ¯åï¼›åˆ†è£‚ï¼Œç“¦è§£390, disruptor [disruptor]n. ç ´åè€…ï¼Œåˆ†è£‚è€…391, Disruptor [dÉªsËˆrÊŒpt]n. ç ´åè€…ï¼Œåˆ†è£‚è€…392, dissect [dÉªËˆsÉ›kt, daÉª-, ËˆdaÉªËŒsÉ›kt]vt. åˆ‡ç»†ï¼›ä»”ç»†åˆ†æžvi. è¿›è¡Œè§£å‰–ï¼›è¿›è¡Œè¯¦ç»†åˆ†æž393, Dissector [dÉªâ€™sektÉ™]n. è§£å‰–å™¨ï¼›æžè±¡å™¨394, Dissipator [â€˜disipeitÉ™]n. æµªå­ï¼Œæ”¾è¡è€…395, distinguish [dÉªâ€™stÉªÅ‹gwÉªÊƒ]vi. åŒºåˆ«ï¼ŒåŒºåˆ†ï¼›è¾¨åˆ«vt. åŒºåˆ†ï¼›è¾¨åˆ«ï¼›ä½¿æ°å‡ºï¼Œä½¿è¡¨çŽ°çªå‡º396, Distributed [dÉªâ€™strÉªbjÊŠtÉªd]adj. åˆ†å¸ƒå¼çš„ï¼Œåˆ†æ•£å¼çš„397, Distributions [,dÉªstrÉ™â€™bjÊŠÊƒÉ™n]n. åˆ†æ´¾ï¼›åˆ†æ´¾ï¼›åˆ†é”€ï¼ˆdistributionçš„å¤æ•°å½¢å¼ï¼‰398, Distro [Distro]n. å‘è¡Œç‰ˆ399, divergence [daÉªâ€™vÉœËdÊ’(É™)ns]n. åˆ†æ­§400, Doctypen. æ–‡æ¡£ç±»åž‹401, Domestic [dÉ™â€™mestÉªk]adj. å›½å†…çš„ï¼›å®¶åº­çš„ï¼›é©¯å…»çš„ï¼›ä¸€å¿ƒåªç®¡å®¶åŠ¡çš„n. å›½è´§ï¼›ä½£äºº402, dominant [â€˜dÉ’mÉªnÉ™nt]adj. æ˜¾æ€§çš„ï¼›å ä¼˜åŠ¿çš„ï¼›æ”¯é…çš„ï¼Œç»Ÿæ²»çš„n. æ˜¾æ€§403, Donations [doÊŠâ€™neÉªÊƒnz]n. [ç»] æèµ ï¼ˆdonationçš„å¤æ•°ï¼‰ï¼›ææ¬¾404, dozensn. è®¸å¤šï¼ˆdozençš„å¤æ•°ï¼‰405, drain [dren]vi. æŽ’æ°´ï¼›æµå¹²vt. å–å…‰ï¼Œè€—å°½ï¼›ä½¿æµå‡ºï¼›æŽ’æŽ‰æ°´n. æŽ’æ°´ï¼›ä¸‹æ°´é“ï¼ŒæŽ’æ°´ç®¡ï¼›æ¶ˆè€—n. (Drain)äººåï¼›(è‹±)å¾·é›·æ©ï¼›(æ³•)å¾·å…°406, dramatically [drÉ™â€™mÃ¦tÉªkÉ™lÉª]adv. æˆå‰§åœ°ï¼›å¼•äººæ³¨ç›®åœ°;adv. æ˜¾è‘—åœ°ï¼Œå‰§çƒˆåœ°407, drastically [â€˜drÃ¦stikÉ™li]adv. å½»åº•åœ°ï¼›æ¿€çƒˆåœ°408, drawback [â€˜drÉ”bÃ¦k]n. ç¼ºç‚¹ï¼Œä¸åˆ©æ¡ä»¶ï¼›é€€ç¨Ž409, drench [dren(t)Êƒ]vt. ä½¿æ¹¿é€ï¼›ç»™ï¼ˆç‰²ç•œï¼‰çŒè¯;n. æ»‚æ²±å¤§é›¨ï¼›æµ¸æ¶²410, drill [drÉªl]n. è®­ç»ƒï¼›é’»å­”æœºï¼›é’»å­ï¼›æ’­ç§æœºvi. é’»å­”ï¼›è®­ç»ƒvt. é’»å­”ï¼›è®­ç»ƒï¼›æ¡æ’­n. (Drill)äººåï¼›(å¾·ã€è‹±)å¾·é‡Œå°”411, drip [drÉªp]vi. æ»´ä¸‹ï¼›å……æ»¡ï¼›æ¼ä¸‹n. æ°´æ»´ï¼Œæ»´æ°´å£°ï¼›é™è„‰æ»´æ³¨ï¼›ä½¿äººåŽŒçƒ¦çš„äººvt. ä½¿æ»´ä¸‹ï¼›æº¢å‡ºï¼Œå‘å‡º412, dual [â€˜djuËÉ™l]adj. åŒçš„ï¼›åŒé‡çš„;n. åŒæ•°ï¼›åŒæ•°è¯;n. (Dual)äººåï¼›(æ³•)è¿ªé˜¿å°”413, duckweed [â€˜dÊŒkwiËd]n. æµ®èï¼›æ°´è414, Duckweed [â€˜dÊŒkwiËd]n. æµ®èï¼›æ°´è415, ducky [â€˜dÊŒkÉª]adj. å¯å–œçš„ï¼›æžå¥½çš„ï¼›æžä¸ºæ„‰å¿«çš„416, dumb [dÊŒm]adj. å“‘çš„ï¼Œæ— è¯´è¯èƒ½åŠ›çš„ï¼›ä¸è¯´è¯çš„ï¼Œæ— å£°éŸ³çš„417, dummy [â€˜dÊŒmi]adj. è™šæ‹Ÿçš„ï¼›å‡çš„n. å‚€å„¡ï¼›å“‘å·´ï¼›ä»¿åˆ¶å“418, dust [dÊŒst]n. ç°å°˜ï¼›å°˜åŸƒï¼›å°˜åœŸ;vt. æ’’ï¼›æ‹‚åŽ»ç°å°˜;vi. æ‹‚åŽ»ç°å°˜ï¼›åŒ–ä¸ºç²‰æœ«;n. (Dust)äººåï¼›(å¾·ã€ä¿„)æœæ–¯ç‰¹419, Dutch [dÊŒtÊƒ]adj. è·å…°çš„ï¼›è·å…°äººçš„ï¼›è·å…°è¯­çš„n. è·å…°äººï¼›è·å…°è¯­adv. è´¹ç”¨å¹³æ‘Šåœ°ï¼›å„è‡ªä»˜è´¦åœ°420, dutiful [â€˜djuËtÉªfÊŠl; -f(É™)l]adj. å¿ å®žçš„ï¼›é¡ºä»Žçš„ï¼›å®ˆæœ¬åˆ†çš„421, E-Commerce [â€˜i:,kÉ’mÉœ:s]n. ç”µå­å•†åŠ¡422, ebook [â€˜i:buk]n. ç”µå­ä¹¦423, echo [â€˜É›ko]vt. åå°„ï¼›é‡å¤vi. éšå£°é™„å’Œï¼›å‘å‡ºå›žå£°n. å›žéŸ³ï¼›æ•ˆä»¿424, ecosystem [â€˜É›ko,sÉªstÉ™m]n. ç”Ÿæ€ç³»ç»Ÿ425, eden [â€˜i:dÉ™n]n. ä¼Šç”¸å›­ï¼ˆã€Šåœ£ç»ã€‹ä¸­äºšå½“å’Œå¤å¨ƒæœ€åˆå±…ä½çš„åœ°æ–¹ï¼‰426, edgesight 427, ego [â€˜iËgÉ™ÊŠ; â€˜e-]n. è‡ªæˆ‘ï¼›è‡ªè´Ÿï¼›è‡ªæˆ‘æ„è¯†;n. (Ego)äººåï¼›(æ—¥)ä¾æ€™ (å§“)ï¼›(æ³•)åŸƒæˆˆ428, elaborate [Éªâ€™lÃ¦bÉ™ret]adj. ç²¾å¿ƒåˆ¶ä½œçš„ï¼›è¯¦å°½çš„ï¼›ç…žè´¹è‹¦å¿ƒçš„vt. ç²¾å¿ƒåˆ¶ä½œï¼›è¯¦ç»†é˜è¿°ï¼›ä»Žç®€å•æˆåˆ†åˆæˆï¼ˆå¤æ‚æœ‰æœºç‰©ï¼‰vi. è¯¦ç»†æè¿°ï¼›å˜å¤æ‚429, elapse [Éªâ€™lÃ¦ps]vi. æ¶ˆé€ï¼›æ—¶é—´è¿‡åŽ»n. æµé€ï¼›æ—¶é—´çš„è¿‡åŽ»430, elapsedv. æ—¶é—´è¿‡åŽ»ï¼›æ¶ˆé€ï¼ˆelapseçš„è¿‡åŽ»åˆ†è¯ï¼‰431, elastic [Éªâ€™lÃ¦stÉªk]adj. æœ‰å¼¹æ€§çš„ï¼›çµæ´»çš„ï¼›æ˜“ä¼¸ç¼©çš„;n. æ¾ç´§å¸¦ï¼›æ©¡çš®åœˆ432, election [Éªâ€™lekÊƒ(É™)n]n. é€‰ä¸¾ï¼›å½“é€‰ï¼›é€‰æ‹©æƒï¼›ä¸Šå¸çš„é€‰æ‹”433, elector [Éªâ€™lÉ›ktÉš]n. é€‰ä¸¾äººï¼›æœ‰é€‰ä¸¾æƒçš„äººï¼›æ€»ç»Ÿé€‰ä¸¾äºº434, elide [Éªâ€™laÉªd]vt. çœç•¥ï¼›å–æ¶ˆï¼›åˆ åŽ»ï¼›ä¸äºˆè€ƒè™‘åˆ èŠ‚n. (Elide)äººåï¼›(æ„)åŸƒåˆ©å¾·435, eligible [â€˜elÉªdÊ’Éªb(É™)l]adj. åˆæ ¼çš„ï¼Œåˆé€‚çš„ï¼›ç¬¦åˆæ¡ä»¶çš„ï¼›æœ‰èµ„æ ¼å½“é€‰çš„n. åˆæ ¼è€…ï¼›é€‚ä»»è€…ï¼›æœ‰èµ„æ ¼è€…436, eliminate [Éªâ€™lÉªmÉªnet]vt. æ¶ˆé™¤ï¼›æŽ’é™¤437, elimination [Éª,lÉªmÉªâ€™neÉªÊƒÉ™n]n. æ¶ˆé™¤ï¼›æ·˜æ±°ï¼›é™¤åŽ»438, embed [Éªmâ€™bÉ›d]vt. æ ½ç§ï¼›ä½¿åµŒå…¥ï¼Œä½¿æ’å…¥ï¼›ä½¿æ·±ç•™è„‘ä¸­439, embedded [ÉªmËˆbÉ›dÉªd]adj. åµŒå…¥å¼çš„ï¼›æ¤å…¥çš„ï¼›å†…å«çš„v. åµŒå…¥ï¼ˆembedçš„è¿‡åŽ»å¼å’Œè¿‡åŽ»åˆ†è¯å½¢å¼ï¼‰440, Embedded [Éªmâ€™bedÉªd]adj. åµŒå…¥å¼çš„ï¼›æ¤å…¥çš„ï¼›å†…å«çš„;v. åµŒå…¥ï¼ˆembedçš„è¿‡åŽ»å¼å’Œè¿‡åŽ»åˆ†è¯å½¢å¼ï¼‰441, embellishment [Éªmâ€™belÉªÊƒmÉ™nt]n. è£…é¥°ï¼Œä¿®é¥°ï¼›æ¶¦è‰²442, emergency [Éªâ€™mÉœËdÊ’(É™)nsÉª]n. ç´§æ€¥æƒ…å†µï¼›çªå‘äº‹ä»¶ï¼›éžå¸¸æ—¶åˆ»adj. ç´§æ€¥çš„ï¼›å¤‡ç”¨çš„443, emit [Éªâ€™mÉªt]vt. å‘å‡ºï¼Œæ”¾å°„ï¼›å‘è¡Œï¼›å‘è¡¨444, empathy [â€˜empÉ™Î¸Éª]n. ç¥žå…¥ï¼›ç§»æƒ…ä½œç”¨ï¼›æ‰§ç€n. æ„ŸåŒèº«å—ï¼›åŒæ„Ÿï¼›å…±é¸£445, emphasis [â€˜É›mfÉ™sÉªs]n. é‡ç‚¹ï¼›å¼ºè°ƒï¼›åŠ å¼ºè¯­æ°”446, emphasis on []ç€é‡äºŽï¼›å¯¹â€¦çš„å¼ºè°ƒemphasis on: å¯¹ å¼ºè°ƒ å¯¹â€¦â€¦çš„å¼ºè°ƒ447, emphasize [â€˜É›mfÉ™saÉªz]vt. å¼ºè°ƒï¼Œç€é‡448, employ [Éªmâ€™plÉ’Éª; em-]vt. ä½¿ç”¨ï¼Œé‡‡ç”¨ï¼›é›‡ç”¨ï¼›ä½¿å¿™äºŽï¼Œä½¿ä»Žäº‹äºŽ n. ä½¿ç”¨ï¼›é›‡ç”¨449, empower [Éªmâ€™paÊŠÉ™; em-]vt. æŽˆæƒï¼Œå…è®¸ï¼›ä½¿èƒ½å¤Ÿ450, emulation [,emjÊŠâ€™leÉªÊƒÉ™n]n. [è®¡] ä»¿çœŸï¼›ç«žäº‰ï¼›æ•ˆæ³•451, encapsulate [Éªnâ€™kÃ¦psjÊŠleÉªt; en-]vt. åŽ‹ç¼©ï¼›å°†â€¦è£…å…¥èƒ¶å›Šï¼›å°†â€¦å°è¿›å†…éƒ¨ï¼›æ¦‚è¿°;vi. å½¢æˆèƒ¶å›Š452, encapsulated [Éªnâ€™kÃ¦psÉ™leÉªtÉªd]adj. å¯†å°çš„ï¼›åŒ…åœ¨èšè†œå†…çš„ v. åŽ‹ç¼©ï¼ˆencapsulateçš„è¿‡åŽ»åˆ†è¯ï¼‰ï¼›å°è¿›å†…éƒ¨ï¼›è£…å…¥èƒ¶å›Š453, encapsulates [Éªnâ€™kÃ¦psjÊŠleÉªt; en-]vt. åŽ‹ç¼©ï¼›å°†â€¦è£…å…¥èƒ¶å›Šï¼›å°†â€¦å°è¿›å†…éƒ¨;vi. å½¢æˆèƒ¶å›Š454, encapsulation [Éªn,kÃ¦psÉ™â€™leÊƒÉ™n]n. å°è£…ï¼›åŒ…è£…455, Encapsulation [Éªn,kÃ¦psÉ™â€™leÉªÊƒÉ™n]n. å°è£…ï¼›åŒ…è£…456, encompass [Éªnâ€™kÊŒmpÉ™s; en-]vt. åŒ…å«ï¼›åŒ…å›´ï¼ŒçŽ¯ç»•ï¼›å®Œæˆ457, encore [â€˜É’Å‹kÉ”Ë]n. å†æ¼”å”±çš„è¦æ±‚ï¼›ç»è¦æ±‚è€Œå†å”±vt. è¦æ±‚å†æ¼”æˆ–å”±int. å†æ¥ä¸€ä¸ª458, encounter [Éªnâ€™kaÊŠntÉ™; en-]vt. é­é‡ï¼Œé‚‚é€…ï¼›é‡åˆ°;n. é­é‡ï¼Œå¶ç„¶ç¢°è§;vi. é­é‡ï¼›å¶ç„¶ç›¸é‡459, encryptedv. æŠŠâ€¦ç¼–ç ï¼›æŠŠâ€¦åŠ å¯†ï¼ˆencryptçš„è¿‡åŽ»åˆ†è¯ï¼‰460, endeavour [Éªnâ€™devÉ™; en-]n. å°½åŠ›ï¼Œç«­åŠ›;vt. ç«­åŠ›åšåˆ°ï¼Œè¯•å›¾æˆ–åŠ›å›¾ï¼ˆåšæŸäº‹ï¼‰;vi. ç«­åŠ›ï¼›ä¼å›¾461, enormous [Éªâ€™nÉ”ËmÉ™s]adj. åºžå¤§çš„ï¼Œå·¨å¤§çš„ï¼›å‡¶æš´çš„ï¼Œæžæ¶çš„462, entail [Éªnâ€™tel]vt. ä½¿éœ€è¦ï¼Œå¿…éœ€ï¼›æ‰¿æ‹…ï¼›é—ä¼ ç»™ï¼›è•´å«n. å¼•èµ·ï¼›éœ€è¦ï¼›ç»§æ‰¿463, enthusiasm [Éªnâ€™Î¸juËzÉªÃ¦z(É™)m; en-]n. çƒ­å¿ƒï¼Œçƒ­å¿±ï¼Œçƒ­æƒ…464, enthusiastic [Éªn,Î¸juËzÉªâ€™Ã¦stÉªk; en-]adj. çƒ­æƒ…çš„ï¼›çƒ­å¿ƒçš„ï¼›ç‹‚çƒ­çš„465, entrance [â€˜entr(É™)ns]n. å…¥å£ï¼›è¿›å…¥;vt. ä½¿å‡ºç¥žï¼Œä½¿å…¥è¿·466, entrypoint [entrypoint]n. è¿›å…¥ç‚¹ï¼›å…¥å¢ƒç‚¹ï¼›å…¥å£ç‚¹467, envelope [â€˜envÉ™lÉ™ÊŠp; â€˜É’n-]n. ä¿¡å°ï¼Œå°çš®ï¼›åŒ…è†œï¼›[å¤©] åŒ…å±‚ï¼›åŒ…è¿¹468, ephemeral [É™â€™fÉ›mÉ™rÉ™l]adj. çŸ­æš‚çš„ï¼›æœç”Ÿæš®æ­»çš„n. åªç”Ÿå­˜ä¸€å¤©çš„äº‹ç‰©469, epoch [â€˜É›pÉ™k]n. [åœ°è´¨] ä¸–ï¼›æ–°çºªå…ƒï¼›æ–°æ—¶ä»£ï¼›æ—¶é—´ä¸Šçš„ä¸€ç‚¹470, equate [Éªâ€™kweÉªt]vt. ä½¿ç›¸ç­‰ï¼›è§†ä¸ºå¹³ç­‰;vi. ç­‰åŒ471, equates [Éªâ€™kweÉªt]vt. ä½¿ç›¸ç­‰ï¼›è§†ä¸ºå¹³ç­‰ vi. ç­‰åŒ472, equipment [Éªâ€™kwÉªpm(É™)nt]n. è®¾å¤‡ï¼Œè£…å¤‡ï¼›å™¨æ473, equivalent [Éªâ€™kwÉªv(É™)l(É™)nt]adj. ç­‰ä»·çš„ï¼Œç›¸ç­‰çš„ï¼›åŒæ„ä¹‰çš„;n. ç­‰ä»·ç‰©ï¼Œç›¸ç­‰ç‰©474, erase [Éªâ€™reÉªz]vt. æŠ¹åŽ»ï¼›æ“¦é™¤vi. è¢«æ“¦åŽ»ï¼Œè¢«æŠ¹æŽ‰475, erasure [Éªâ€™reÉªÊ’É™(r)]n. æ¶ˆé™¤ï¼›æ¶‚æ“¦çš„ç—•è¿¹ï¼›æ¶ˆç£476, estimate [â€˜É›stÉ™,met]vi. ä¼°è®¡ï¼Œä¼°ä»·n. ä¼°è®¡ï¼Œä¼°ä»·ï¼›åˆ¤æ–­ï¼Œçœ‹æ³•vt. ä¼°è®¡ï¼Œä¼°é‡ï¼›åˆ¤æ–­ï¼Œè¯„ä»·477, Estimate [â€˜estÉªmeÉªt]vi. ä¼°è®¡ï¼Œä¼°ä»·;n. ä¼°è®¡ï¼Œä¼°ä»·ï¼›åˆ¤æ–­ï¼Œçœ‹æ³•;vt. ä¼°è®¡ï¼Œä¼°é‡ï¼›åˆ¤æ–­ï¼Œè¯„ä»·478, estimated [É›stÉ™ËŒmetÉªd]adj. ä¼°è®¡çš„ï¼›é¢„è®¡çš„ï¼›ä¼°ç®—çš„479, estimation [,É›stÉªâ€™meÊƒÉ™n]n. ä¼°è®¡ï¼›å°Šé‡480, ethereal [Éªâ€™Î¸ÉªÉ™rÉªÉ™l]adj. ä¼˜é›…çš„ï¼›è½»é£˜çš„ï¼›ç¼¥ç¼ˆçš„ï¼›è¶…å‡¡çš„481, ethernet [â€˜iÎ¸ÉšnÉ›t]n. [è®¡] ä»¥å¤ªç½‘482, Ethernet [Ethernet]n. [è®¡] ä»¥å¤ªç½‘483, evacuate [Éªâ€™vÃ¦kjuet]vt. ç–æ•£ï¼Œæ’¤é€€ï¼›æŽ’æ³„vi. ç–æ•£ï¼›æ’¤é€€ï¼›æŽ’æ³„484, evacuated [Éªâ€™vÃ¦kjÊŠ,et]adj. ç–æ•£ï¼›æŽ’ç©ºçš„ï¼Œæ’¤é€€è€…çš„v. ç–æ•£ï¼›æ’¤å‡ºï¼›æŽ’æ³„ï¼ˆevacuateçš„è¿‡åŽ»å¼å’Œè¿‡åŽ»åˆ†è¯å½¢å¼ï¼‰485, evacuation [Éª,vÃ¦kjÊŠâ€™eÉªÊƒ(É™)n]n. ç–æ•£ï¼›æ’¤ç¦»ï¼›æŽ’æ³„486, eval [Éªâ€™vÃ¦l]n. é‡æ–°è¿ç®—æ±‚å‡ºå‚æ•°çš„å†…å®¹487, evaluate [Éªâ€™vÃ¦ljÊŠeÉªt]vt. è¯„ä»·ï¼›ä¼°ä»·ï¼›æ±‚â€¦çš„å€¼;vi. è¯„ä»·ï¼›ä¼°ä»·488, Evaluate [Éªâ€™vÃ¦ljÊŠeÉªt]vt. è¯„ä»·ï¼›ä¼°ä»·ï¼›æ±‚â€¦çš„å€¼;vi. è¯„ä»·ï¼›ä¼°ä»·489, evaluatedvi. è¯„ä¼°ï¼›ä¼°â€¦çš„ä»·ï¼ˆevaluateçš„è¿‡åŽ»åˆ†è¯å½¢å¼ï¼‰490, even [â€˜iËv(É™)n]adj. [æ•°] å¶æ•°çš„ï¼›å¹³å¦çš„ï¼›ç›¸ç­‰çš„;adv. ç”šè‡³ï¼›å³ä½¿ï¼›è¿˜ï¼›å®žé™…ä¸Š;vt. ä½¿å¹³å¦ï¼›ä½¿ç›¸ç­‰;vi. å˜å¹³ï¼›å˜å¾—å¯æ¯”è¾ƒï¼›æˆä¸ºç›¸ç­‰;n. (Even)äººåï¼›(æ³•)åŸƒæ—ºï¼›(å¾·)åŸƒæ–‡ï¼›(è‹±)åŸƒæ–‡491, eventually [Éªâ€™ventÊƒÊŠÉ™lÉª]adv. æœ€åŽï¼Œç»ˆäºŽ492, evict [Éªâ€™vÉªkt]vt. é©±é€ï¼›é€å‡º493, eviction [Éªâ€™vÉªkÊƒ(É™)n]n. é€å‡ºï¼›èµ¶å‡ºï¼›æ”¶å›ž494, Eviction [Éªâ€™vÉªkÊƒ(É™)n]n. é€å‡ºï¼›èµ¶å‡ºï¼›æ”¶å›ž495, evolve [Éªâ€™vÉ’lv]vt. å‘å±•ï¼Œè¿›åŒ–ï¼›è¿›åŒ–ï¼›ä½¿é€æ­¥å½¢æˆï¼›æŽ¨æ–­å‡º;vi. å‘å±•ï¼Œè¿›å±•ï¼›è¿›åŒ–ï¼›é€æ­¥å½¢æˆ496, Evolve [Éªâ€™vÉ’lv]vt. å‘å±•ï¼Œè¿›åŒ–ï¼›è¿›åŒ–ï¼›ä½¿é€æ­¥å½¢æˆï¼›æŽ¨æ–­å‡º;vi. å‘å±•ï¼Œè¿›å±•ï¼›è¿›åŒ–ï¼›é€æ­¥å½¢æˆ497, evolvedadj. è¿›åŒ–äº†çš„;vt. ä½¿é€æ­¥å½¢æˆï¼ˆevolveçš„è¿‡åŽ»åˆ†è¯ï¼‰498, exact [Éªgâ€™zÃ¦kt; eg-]adj. å‡†ç¡®çš„ï¼Œç²¾å¯†çš„ï¼›ç²¾ç¡®çš„;vt. è¦æ±‚ï¼›å¼ºæ±‚ï¼›æ€¥éœ€;vi. å‹’ç´¢é’±è´¢499, examine [Éªgâ€™zÃ¦mÉªn; eg-]vt. æ£€æŸ¥ï¼›è°ƒæŸ¥ï¼› æ£€æµ‹ï¼›è€ƒè¯•;vi. æ£€æŸ¥ï¼›è°ƒæŸ¥500, excitable [Éªkâ€™saÉªtÉ™b(É™)l; ek-]adj. æ˜“æ¿€åŠ¨çš„ï¼›æ˜“å…´å¥‹çš„ï¼›æ˜“æ€’çš„501, Exclusive [Éªkâ€™skluËsÉªv; ek-]adj. ç‹¬æœ‰çš„ï¼›æŽ’å¤–çš„ï¼›ä¸“ä¸€çš„;n. ç‹¬å®¶æ–°é—»ï¼›ç‹¬å®¶ç»è¥çš„é¡¹ç›®ï¼›æŽ’å¤–è€…502, exhaustive [Éªgâ€™zÉ”ËstÉªv; eg-]adj. è¯¦å°½çš„ï¼›å½»åº•çš„ï¼›æ¶ˆè€—çš„503, exotic [Éªgâ€™zÉ’tÉªk; eg-]adj. å¼‚å›½çš„ï¼›å¤–æ¥çš„ï¼›å¼‚å›½æƒ…è°ƒçš„504, experimental [ek,speriâ€™mentÉ™l; ekâ€™s-]adj. å®žéªŒçš„ï¼›æ ¹æ®å®žéªŒçš„ï¼›è¯•éªŒæ€§çš„505, explanatory [Éªkâ€™splÃ¦nÉ™tÉ”ri]adj. è§£é‡Šçš„ï¼›è¯´æ˜Žçš„506, explicitly [Éªkâ€™splÉªsÉªtli]adv. æ˜Žç¡®åœ°ï¼›æ˜Žç™½åœ°507, explode [Éªkâ€™splÉ™ÊŠd; ek-]vi. çˆ†ç‚¸ï¼Œçˆ†å‘ï¼›æ¿€å¢ž;vt. ä½¿çˆ†ç‚¸ï¼›çˆ†ç‚¸ï¼›æŽ¨ç¿»508, exponential [â€˜É›kspÉ™â€™nÉ›nÊƒÉ™l]adj. æŒ‡æ•°çš„n. æŒ‡æ•°509, exponentially [,É›kspoâ€™nÉ›nÊƒÉ™li]adv. ä»¥æŒ‡æ•°æ–¹å¼510, exponentiation [,ekspÉ™nenÊƒÉªâ€™eÉªÊƒ(É™)n]n. [æ•°] å–å¹‚ï¼Œæ±‚å¹‚ï¼›ä¹˜æ–¹511, expose [Éªkâ€™spÉ™ÊŠz; ek-]vt. æ­éœ²ï¼Œæ­å‘ï¼›ä½¿æ›å…‰ï¼›æ˜¾ç¤º512, expresso [ekâ€™spresÉ™ÊŠ]n. ï¼ˆè’¸æ±½åŠ åŽ‹ç…®å‡ºçš„ï¼‰æµ“å’–å•¡513, expunge [Éªkâ€™spÊŒndÊ’]vt. æ“¦åŽ»ï¼›åˆ æŽ‰514, Expunge [Éªkâ€™spÊŒn(d)Ê’; ek-]vt. æ“¦åŽ»ï¼›åˆ æŽ‰515, expunges [Éªkâ€™spÊŒn(d)Ê’; ek-]vt. æ“¦åŽ»ï¼›åˆ æŽ‰516, extensible [ekâ€™stensÉªbl; Éªkâ€™stensÉªb(É™)l]adj. å¯å»¶é•¿çš„ï¼›å¯æ‰©å¼ çš„517, Extensible [ekâ€™stensÉªbl; Éªkâ€™stensÉªb(É™)l]adj. å¯å»¶é•¿çš„ï¼›å¯æ‰©å¼ çš„518, extent [Éªkâ€™stent; ek-]n. ç¨‹åº¦ï¼›èŒƒå›´ï¼›é•¿åº¦519, extract [ËˆekstrÃ¦kt]vt. æå–ï¼›å–å‡ºï¼›æ‘˜å½•ï¼›æ¦¨å– n. æ±ï¼›æ‘˜å½•ï¼›æ¦¨å‡ºç‰©ï¼›é€‰ç²¹520, extrapolate [Éªkâ€™strÃ¦pÉ™â€™let]vt. å¤–æŽ¨ï¼›æŽ¨æ–­vi. å¤–æŽ¨ï¼›è¿›è¡ŒæŽ¨æ–­è¿‡åŽ»å¼:extrapolated; è¿‡åŽ»åˆ†è¯:extrapolated; çŽ°åœ¨åˆ†è¯:extrapolating521, extrapolatedv. æŽ¨æµ‹ï¼ˆextrapolateçš„è¿‡åŽ»åˆ†è¯ï¼‰adj. æŽ¨æµ‹çš„522, Extras [â€˜É›kstrÉ™]n. é™„åŠ è®¾å¤‡ï¼›é¢å¤–éƒ¨åˆ†ï¼›å¦å¤–æ”¶è´¹çš„éƒ¨åˆ†ï¼ˆextraçš„å¤æ•°ï¼‰523, facade [fÉ™â€™sÉ‘Ëd]n. æ­£é¢ï¼›è¡¨é¢ï¼›å¤–è§‚524, facilitate [fÉ™â€™sÉªlÉªteÉªt]vt. ä¿ƒè¿›ï¼›å¸®åŠ©ï¼›ä½¿å®¹æ˜“525, faint [feÉªnt]adj. æ¨¡ç³Šçš„ï¼›å¤´æ™•çš„ï¼›è™šå¼±çš„ï¼›[åŒ»] è¡°å¼±çš„ vi. æ˜å€’ï¼›å˜å¾—å¾®å¼±ï¼›å˜å¾—æ²¡æ°”åŠ› n. [ä¸­åŒ»] æ˜åŽ¥ï¼Œæ˜å€’526, Fake [feÉªk]n. å‡è´§ï¼›éª—å­ï¼›å‡åŠ¨ä½œ;vt. æé€ ï¼›å‡è£…â€¦çš„æ ·å­;vi. å‡è£…ï¼›åšå‡åŠ¨ä½œ;adj. ä¼ªé€ çš„;n. (Fake)äººåï¼›(è‹±)è´¹å…‹527, Fakes []n. èµå“ï¼›äº‘æ¯æ¿çŠ¶å²©ï¼›å‡å†’å•†å“ï¼ˆfakeçš„å¤æ•°ï¼‰;v. ä½¯è£…ï¼›å‡è£…ï¼ˆfakeçš„ä¸‰å•å½¢å¼ï¼‰;n. (Fakes)äººåï¼›(æ³•)æ³•å…‹528, fallback [â€˜fÉ”lbÃ¦k]n. å¯ä¾é çš„ä¸œè¥¿ï¼›åŽå¤‡ç‰©å“ï¼›æ’¤é€€ï¼Œé€€å´529, fame [feÉªm]n. åå£°ï¼Œåæœ›ï¼›ä¼ é—»ï¼Œä¼ è¯´;vt. ä½¿é—»åï¼Œä½¿æœ‰åæœ›530, fanatical [fÉ™â€™nÃ¦tÉªkÉ™l]adj. ç‹‚çƒ­çš„531, fancy [â€˜fÃ¦nsÉª]n. å¹»æƒ³ï¼›æƒ³è±¡åŠ›ï¼›çˆ±å¥½;adj. æƒ³è±¡çš„ï¼›å¥‡ç‰¹çš„ï¼›æ˜‚è´µçš„ï¼›ç²¾é€‰çš„;vt. æƒ³è±¡ï¼›å–œçˆ±ï¼›è®¾æƒ³ï¼›è‡ªè´Ÿ;vi. å¹»æƒ³ï¼›æƒ³è±¡;n. (Fancy)äººåï¼›(æ³•)æ–¹è¥¿532, fanout [fanout]n. æ‰‡å‡ºï¼›å±•å¼€ï¼›åˆ†åˆ—ï¼ˆè´¦æˆ·ï¼‰533, fatal [â€˜fetl]adj. è‡´å‘½çš„ï¼›é‡å¤§çš„ï¼›æ¯ç­æ€§çš„ï¼›å‘½ä¸­æ³¨å®šçš„ n. (Fatal)äººåï¼›(è‘¡ã€èŠ¬)æ³•å¡”å°”534, fault [fÉ”Ëlt; fÉ’lt]n. æ•…éšœï¼›[åœ°è´¨] æ–­å±‚ï¼›é”™è¯¯ï¼›ç¼ºç‚¹ï¼›æ¯›ç—…ï¼›ï¼ˆç½‘çƒç­‰ï¼‰å‘çƒå¤±è¯¯ vi. å¼„é”™ï¼›äº§ç”Ÿæ–­å±‚ vt. ï¼ˆé€šå¸¸ç”¨äºŽç–‘é—®å¥æˆ–å¦å®šå¥ï¼‰æŒ‘å‰”535, favor [â€˜feÉªvÉ™]vt. èµžæˆï¼›å–œæ¬¢ï¼›åƒï¼›èµäºˆï¼›è¯å®ž;n. å–œçˆ±ï¼›æ¬¢å¿ƒï¼›å¥½æ„Ÿ536, federate [â€˜fedÉ™reÉªt]adj. åŒç›Ÿçš„ï¼›è”é‚¦åˆ¶åº¦ä¸‹çš„ï¼›è”åˆçš„vt. ä½¿ç»“æˆåŒç›Ÿï¼›ä½¿ç»“æˆè”é‚¦vi. ç»“æˆè”é‚¦537, federated [â€˜fÉ›dÉ™,retÉªd]adj. è”é‚¦çš„ï¼›è”åˆçš„ï¼›ç»“æˆåŒç›Ÿçš„ v. ç»“æˆåŒç›Ÿï¼›æŒ‰è”é‚¦åˆ¶ç»„ç»‡èµ·æ¥ï¼ˆfederateçš„è¿‡åŽ»åˆ†è¯ï¼‰538, federation [fedÉ™â€™reÉªÊƒ(É™)n]n. è”åˆï¼›è”é‚¦ï¼›è”ç›Ÿï¼›è”é‚¦æ”¿åºœ539, fence [fens]n. æ …æ ï¼›å›´å¢™ï¼›å‰‘æœ¯vt. é˜²æŠ¤ï¼›ç”¨ç¯±ç¬†å›´ä½ï¼›ç»ƒä¹ å‰‘æœ¯vi. å‡»å‰‘ï¼›æªå¡žï¼›å›´ä»¥æ …æ ï¼›è·³è¿‡æ …æ 540, fetch [fetÊƒ]vt. å–æ¥ï¼›æŽ¥æ¥ï¼›åˆ°è¾¾ï¼›å¸å¼•;vi. æ‹¿ï¼›å–ç‰©ï¼›å–å¾—;n. å–å¾—ï¼›è¯¡è®¡541, fictional [â€˜fÉªkÊƒÉ™nl]adj. è™šæž„çš„ï¼›å°è¯´çš„542, fictitious [fÉªkâ€™tÉªÊƒÉ™s]adj. è™šæž„çš„ï¼›å‡æƒ³çš„ï¼›ç¼–é€ çš„ï¼›å‡è£…çš„543, final [â€˜faÉªn(É™)l]adj. æœ€ç»ˆçš„ï¼›å†³å®šæ€§çš„ï¼›ä¸å¯æ›´æ”¹çš„;n. å†³èµ›ï¼›æœŸæœ«è€ƒè¯•ï¼›å½“æ—¥æŠ¥çº¸çš„æœ«ç‰ˆ544, finer-grained [finer-grained]ç»†ç²’åº¦545, firework [â€˜faÉªÉšwÉk]n. çƒŸç«ï¼›æ¿€çƒˆæƒ…ç»ª546, flap [flÃ¦p]n. æ‹æ‰“ï¼Œæ‹æ‰“å£°ï¼›ç¥žç»ç´§å¼ ï¼›[èˆª] è¥Ÿç¿¼vi. æ‹åŠ¨ï¼›ç¥žç»ç´§å¼ ï¼›é¼“ç¿¼è€Œé£žï¼›ï¼ˆå¸½è¾¹ç­‰ï¼‰åž‚ä¸‹vt. æ‹æ‰“ï¼›æ‰”ï¼›æ‹‰ä¸‹å¸½è¾¹ï¼›é£˜åŠ¨547, flat [flÃ¦t]adj. å¹³çš„ï¼›å•è°ƒçš„ï¼›ä¸æ™¯æ°”çš„ï¼›å¹²è„†çš„ï¼›å¹³å¦çš„ï¼›æ‰å¹³çš„ï¼›æµ…çš„;adv. ï¼ˆå°¤æŒ‡è´´ç€å¦ä¸€è¡¨é¢ï¼‰å¹³ç›´åœ°ï¼›æ–­ç„¶åœ°ï¼›æ°´å¹³åœ°ï¼›ç›´æŽ¥åœ°ï¼Œå®Œå…¨åœ°;n. å¹³åœ°ï¼›å…¬å¯“ï¼›å¹³é¢;vt. ä½¿å˜å¹³ï¼›[éŸ³ä¹]ä½¿ï¼ˆéŸ³è°ƒï¼‰ä¸‹é™ï¼Œå°¤æŒ‡é™åŠéŸ³;vi. é€æ¸å˜å¹³ï¼›[éŸ³ä¹]ä»¥é™è°ƒå”±ï¼ˆæˆ–å¥ï¼‰;n. ï¼ˆæ³•ï¼‰å¼—æ‹‰ç‰¹ï¼ˆäººåï¼‰ï¼›ï¼ˆè‹±ï¼‰å¼—èŽ±ç‰¹ï¼ˆäººåï¼‰548, flatten [â€˜flÃ¦tn]vt. å‡»è´¥ï¼Œæ‘§æ¯ï¼›ä½¿â€¦â€¦å¹³å¦ vi. å˜å¹³ï¼›å˜å•è°ƒ n. (Flatten)äººåï¼›(å¾·)å¼—æ‹‰æ»•549, flatter [â€˜flÃ¦tÉ™]vt. å¥‰æ‰¿ï¼›è°„åªšï¼›ä½¿é«˜å…´550, flavorsn. é£Žå‘³è°ƒæ–™ï¼ˆflavorå¤æ•°ï¼‰v. æ·»åŠ å‘³é“ï¼ˆflavorçš„ä¸‰å•å½¢å¼ï¼‰551, flavourn. é¦™å‘³ï¼›æ»‹å‘³vt. ç»™â€¦â€¦è°ƒå‘³ï¼›ç»™â€¦â€¦å¢žæ·»é£Žè¶£552, fledged [fledÊ’d]adj. æˆç†Ÿçš„ï¼›å¿«ä¼šé£žçš„ï¼›ç¾½æ¯›ä¸°æ»¡çš„553, flood [flÊŒd]vt. æ·¹æ²¡ï¼›å……æ»¡ï¼›æº¢å‡ºvi. æ¶Œå‡ºï¼›æ¶Œè¿›ï¼›ä¸ºæ°´æ·¹æ²¡n. æ´ªæ°´ï¼›æ³›æ»¥ï¼›ä¸€å¤§æ‰¹n. (Flood)äººåï¼›(è‹±)å¼—å‹’å¾·ï¼›(ç‘žå…¸ã€èŠ¬)å¼—æ´›å¾·554, fluent [â€˜fluÉ™nt]adj. æµç•…çš„ï¼Œæµåˆ©çš„ï¼›æ¶²æ€çš„ï¼›ç•…æµçš„555, flute [fluËt]n. é•¿ç¬›ï¼›ã€å·¥ç¨‹è®¾è®¡ã€‘(åˆ€å…·çš„)å‡ºå±‘æ§½vt. ç”¨é•¿ç¬›å¹å¥vi. å¹é•¿ç¬›556, forcibly [â€˜fÉ”ËsÉªblÉª]adv. ç”¨åŠ›åœ°ï¼›å¼ºåˆ¶åœ°ï¼›æœ‰è¯´æœåŠ›åœ°557, foremost [â€˜fÉ”ËmÉ™ÊŠst]adj. æœ€é‡è¦çš„ï¼›æœ€å…ˆçš„adv. é¦–å…ˆï¼›å±…äºŽé¦–ä½åœ°558, forgesn. è½»ä¾¿é”»ç‚‰ï¼›ç†”ç‚‰ï¼ˆforgeçš„å¤æ•°ï¼‰ v. ä¼ªé€ ï¼ˆforgeçš„ç¬¬ä¸‰äººç§°å•æ•°ï¼‰ï¼›æ‰“åˆ¶ n. (Forges)äººåï¼›(æ³•)ç¦å°”çƒ­559, fork [fÉ”Ëk]n. å‰ï¼›é¤å‰ï¼›è€™;vt. å‰èµ·ï¼›ä½¿æˆå‰çŠ¶;vi. åˆ†å‰ï¼›åˆ†æ­§;n. (Fork)äººåï¼›(è‹±ã€å¾·)ç¦å…‹560, formerly [â€˜fÉ”ËmÉ™lÉª]adv. ä»¥å‰ï¼›åŽŸæ¥561, Fortress [â€˜fÉ”ËtrÉªs]n. å ¡åž’ï¼›è¦å¡ž;vt. ç­‘è¦å¡žï¼›ä»¥è¦å¡žé˜²å®ˆ562, Forwarding [â€˜fÉ”ËwÉ™dÉªÅ‹]v. ä¿ƒè¿›ï¼›å¯„å‘ï¼›è£…è®¢ï¼›è½¬é€’ï¼ˆforwardçš„ingå½¢å¼ï¼‰;n. è½¬å‘ï¼›ä¿ƒè¿›ï¼›è¿è¾“ä¸šåŠ¡ï¼›å„é¡¹è£…è®¢å·¥åº;adj. è¿è¾“çš„ï¼›è½¬å‘çš„563, foundry [â€˜faÊŠndri]n. é“¸é€ ï¼Œé“¸é€ ç±»ï¼›[æœº] é“¸é€ åŽ‚564, fractional [â€˜frÃ¦kÊƒÉ™nl]adj. éƒ¨åˆ†çš„ï¼›[æ•°] åˆ†æ•°çš„ï¼Œå°æ•°çš„565, fragile [â€˜frÃ¦dÊ’É™l]adj. è„†çš„ï¼›æ˜“ç¢Žçš„566, fragments [â€˜frÃ¦gmÉ™nt]n. ç¢Žç‰‡ï¼ˆfragmentçš„å¤æ•°ï¼‰ï¼›ç‰‡æ–­ï¼›[è®¡] åˆ†æ®µ;v. ç ´ç¢Žï¼ˆfragmentçš„ä¸‰å•å½¢å¼ï¼‰ï¼›æ‰“ç¢Ž567, frequency [â€˜frikwÉ™nsi]n. é¢‘çŽ‡ï¼›é¢‘ç¹568, fresh [freÊƒ]adj. æ–°é²œçš„ï¼›æ¸…æ–°çš„ï¼›æ·¡æ°´çš„ï¼›æ— ç»éªŒçš„;n. å¼€å§‹ï¼›æ–°ç”Ÿï¼›æ³›æ»¥;adv. åˆšåˆšï¼Œæ‰ï¼›æœ€æ–°åœ°569, frugal [â€˜fruËg(É™)l]adj. èŠ‚ä¿­çš„ï¼›æœ´ç´ çš„ï¼›èŠ±é’±å°‘çš„570, frustrate [frÊŒâ€™streÉªt; â€˜frÊŒs-]vt. æŒ«è´¥ï¼›é˜»æŒ ï¼›ä½¿æ„Ÿåˆ°ç°å¿ƒ;vi. å¤±è´¥ï¼›å—æŒ«;adj. æŒ«è´¥çš„ï¼›æ— ç›Šçš„571, fudge [fÊŒdÊ’]n. è½¯ç³–ï¼›èƒ¡è¯´ï¼›è°Žè¯vt. æé€ ï¼›ç²—åˆ¶æ»¥é€ ï¼›å›žé¿vi. é€ƒé¿è´£ä»»ï¼›æ¬ºéª—ï¼›è’™æ··int. èƒ¡è¯´å…«é“ï¼n. (Fudge)äººåï¼›(è‹±)å¯Œå¥‡572, functionality [fÊŒÅ‹kÊƒÉ™â€™nÃ¦lÉ™tÉª]n. åŠŸèƒ½ï¼›[æ•°] æ³›å‡½æ€§ï¼Œå‡½æ•°æ€§573, fundamental [fÊŒndÉ™â€™ment(É™)l]adj. åŸºæœ¬çš„ï¼Œæ ¹æœ¬çš„n. åŸºæœ¬åŽŸç†ï¼›åŸºæœ¬åŽŸåˆ™574, fuzzy [â€˜fÊŒzi]adj. æ¨¡ç³Šçš„ï¼›å¤±çœŸçš„ï¼›æœ‰ç»’æ¯›çš„n. (Fuzzy)äººåï¼›(è‹±)å¯Œé½[ æ¯”è¾ƒçº§:fuzzier æœ€é«˜çº§:fuzziest ]575, gain [geÉªn]n. å¢žåŠ ï¼›åˆ©æ¶¦ï¼›æ”¶èŽ·;vt. èŽ·å¾—ï¼›å¢žåŠ ï¼›èµšåˆ°;vi. å¢žåŠ ï¼›èŽ·åˆ©;n. (Gain)äººåï¼›(è‹±ã€åŒˆã€æ³•)ç›–æ©576, gauge [gedÊ’]n. è®¡é‡å™¨ï¼›æ ‡å‡†å°ºå¯¸ï¼›å®¹é‡è§„æ ¼vt. æµ‹é‡ï¼›ä¼°è®¡ï¼›ç»™â€¦å®šè§„æ ¼577, gear [É¡Éªr]n. é½¿è½®ï¼›è£…ç½®ï¼Œå·¥å…·ï¼›ä¼ åŠ¨è£…ç½® vi. é€‚åˆï¼›æ­ä¸Šé½¿è½®ï¼›å¼€å§‹å·¥ä½œ vt. å¼€åŠ¨ï¼›æ­ä¸Šé½¿è½®ï¼›ä½¿â€¦â€¦é€‚åˆï¼›ä½¿â€¦â€¦å‡†å¤‡å¥½ adj. å¥½æžäº† n. (Gear)äººåï¼›(è‹±)å‰å°”578, gem [dÊ’É›m]n. å®çŸ³ï¼Œçå®ï¼› ç²¾åŽï¼›å—äººé‡è§†è€…vi. ç‚¹ç¼€ï¼› ç”¨å®çŸ³è£…é¥°ï¼› é¥°ä»¥å®çŸ³adj. æœ€ä½³å“è´¨çš„n. (Gem)äººåï¼›(è‹±)æ°å§†579, geographically [dÊ’ÉªÉ™â€™grÃ¦fÉªkli]adv. åœ¨åœ°ç†ä¸Šï¼›åœ°ç†å­¦ä¸Š580, gigabytesn. åƒå…†å­—èŠ‚ï¼ˆgigabyteçš„å¤æ•°ï¼‰ï¼›åäº¿ä½å…ƒç»„581, glimpse [glÉªm(p)s]n. ä¸€çž¥ï¼Œä¸€çœ‹ vi. çž¥è§ vt. çž¥è§582, glossary [â€˜glÉ’s(É™)rÉª]n. æœ¯è¯­ï¼ˆç‰¹æ®Šç”¨è¯­ï¼‰è¡¨ï¼›è¯æ±‡è¡¨ï¼›ä¸“ä¸šè¯å…¸583, glossed [glÉ’s]n. å…‰å½©ï¼›æ³¨é‡Šï¼›å‡è±¡;vt. ä½¿å…‰å½©ï¼›æŽ©ç›–ï¼›æ³¨é‡Š;n. (Gloss)äººåï¼›(å¾·ã€è¥¿ã€æ·)æ ¼æ´›æ–¯584, goals [gÉ™ÊŠlz]n. ç›®æ ‡ï¼Œ[å¿ƒç†] ç›®çš„ï¼›è¿›çƒï¼Œå°„ä¸­æ¬¡æ•°585, gradient [â€˜greÉªdÉªÉ™nt]n. [æ•°][ç‰©] æ¢¯åº¦ï¼›å¡åº¦ï¼›å€¾æ–œåº¦;adj. å€¾æ–œçš„ï¼›æ­¥è¡Œçš„586, gradientsn. æ¸å˜ï¼Œ[æ•°][ç‰©] æ¢¯åº¦ï¼ˆgradientå¤æ•°å½¢å¼ï¼‰587, gradually [â€˜grÃ¦dÊ’ÊŠÉ™li]adv. é€æ­¥åœ°ï¼›æ¸æ¸åœ°588, grant [grÉ‘Ënt]vt. æŽˆäºˆï¼›å…è®¸ï¼›æ‰¿è®¤ vi. åŒæ„ n. æ‹¨æ¬¾ï¼›[æ³•] æŽˆäºˆç‰© n. (Grant)äººåï¼›(ç‘žå…¸ã€è‘¡ã€è¥¿ã€ä¿„ã€ç½—ã€è‹±ã€å¡žã€å¾·ã€æ„)æ ¼å…°ç‰¹ï¼›(æ³•)æ ¼æœ—589, granularityn. é—´éš”å°ºå¯¸ï¼Œ[å²©] ç²’åº¦590, graphical [â€˜grÃ¦fÉªk(É™)l]adj. å›¾è§£çš„ï¼›ç»˜ç”»çš„ï¼›ç”ŸåŠ¨çš„591, greedy [â€˜griËdÉª]adj. è´ªå©ªçš„ï¼›è´ªåƒçš„ï¼›æ¸´æœ›çš„592, grep [grep]n. UNIXå·¥å…·ç¨‹åºï¼›å¯åšæ–‡ä»¶å†…çš„å­—ç¬¦ä¸²æŸ¥æ‰¾;n. (Grep)äººåï¼›(è‹é‡Œ)æ ¼é›·æ™®593, grok [É¡rÉ‘k]vt. å‡­ç›´è§‰æ·±åˆ»äº†è§£ï¼›æ¬£èµï¼›ç¥žäº¤vi. å¿ƒæ„ç›¸é€šï¼›ä¸Žâ€¦ç¥žäº¤594, gross [É¡ros]adj. æ€»å…±çš„ï¼›ç²—é‡Žçš„ï¼›æ¶åŠ£çš„ï¼›æ˜¾è€Œæ˜“è§çš„vt. æ€»å…±æ”¶å…¥n. æ€»é¢ï¼Œæ€»æ•°n. (Gross)äººåï¼›(è‹±ã€æ³•ã€å¾·ã€æ„ã€è‘¡ã€è¥¿ã€ä¿„ã€èŠ¬ã€ç½—ã€æ·ã€åŒˆ)æ ¼ç½—æ–¯595, grumpy [â€˜É¡rÊŒmpi]adj. è„¾æ°”æš´èºçš„ï¼›æ€§æƒ…ä¹–æˆ¾çš„n. è„¾æ°”åçš„äººï¼›çˆ±æŠ±æ€¨çš„äºº596, guarantee [,É¡Ã¦rÉ™nâ€™ti]n. ä¿è¯ï¼›æ‹…ä¿ï¼›ä¿è¯äººï¼›ä¿è¯ä¹¦ï¼›æŠµæŠ¼å“vt. ä¿è¯ï¼›æ‹…ä¿597, guaranteed [â€˜gÃ¦rÉ™nâ€™tid]adj. æœ‰ä¿è¯çš„ï¼Œï¼›æœ‰äººæ‹…ä¿çš„;v. æ‹…ä¿ï¼ˆguaranteeçš„è¿‡åŽ»å¼å’Œè¿‡åŽ»åˆ†è¯ï¼‰598, guide [gaÉªd]n. æŒ‡å—ï¼›å‘å¯¼ï¼›å…¥é—¨ä¹¦;vt. å¼•å¯¼ï¼›å¸¦é¢†ï¼›æ“çºµ;vi. æ‹…ä»»å‘å¯¼;n. (Guide)äººåï¼›(æ³•ã€è‘¡)å‰å¾·599, Guvnor [â€˜É¡ÊŒvnÉ™]n. é›‡ä¸»ï¼›è€æ¿600, gym [dÊ’Éªm]n. å¥èº«æˆ¿ï¼›ä½“è‚²ï¼›ä½“è‚²é¦†601, hall [hÉ”Ël]n. è¿‡é“ï¼Œé—¨åŽ…ï¼Œèµ°å»Šï¼›ä¼šå ‚ï¼›é£Ÿå ‚ï¼›å­¦ç”Ÿå®¿èˆï¼›å¤§åŽ…ï¼Œå‰åŽ…ï¼›å¨±ä¹ä¸­å¿ƒï¼Œä¼šæ‰€;n. ï¼ˆåœŸï¼‰å“ˆå‹’ï¼ˆäººåï¼‰ï¼›ï¼ˆå¾·ã€æ³¢ã€ä¸¹ã€èŠ¬ã€ç‘žå…¸ï¼‰å“ˆå°”ï¼ˆäººåï¼‰ï¼›ï¼ˆè‹±ï¼‰éœå°”ï¼ˆäººåï¼‰ï¼›ï¼ˆæ³•ï¼‰é˜¿å°”ï¼ˆäººåï¼‰602, hallway [â€˜hÉ”ËlweÉª]n. èµ°å»Šï¼›é—¨åŽ…ï¼›çŽ„å…³603, haltedv. åœæ­¢ï¼Œåœé¡¿ï¼ˆhaltçš„è¿‡åŽ»å¼ï¼Œè¿‡åŽ»åˆ†è¯ï¼‰604, halve [hÉ‘Ëv]vt. äºŒç­‰åˆ†ï¼›æŠŠâ€¦â€¦å‡åŠ n. (Halve)äººåï¼›(èŠ¬)å“ˆå°”éŸ¦605, handlers []n. æ“ä½œè€…ï¼›ç»ç†äººï¼›é™¶å™¨å·¥äººï¼ˆhandlerçš„å¤æ•°ï¼‰606, handshake [â€˜hÃ¦n(d)ÊƒeÉªk]n. æ¡æ‰‹607, hashtag [ËˆhÃ¦ÊƒËŒtÃ¦É¡]n. æ ‡ç­¾608, hazard [â€˜hÃ¦zÉ™d]vt. èµŒè¿æ°”ï¼›å†’â€¦çš„å±é™©ï¼Œä½¿é­å—å±é™©n. å±é™©ï¼Œå†’é™©ï¼›å†’é™©çš„äº‹n. (Hazard)äººåï¼›(æ³•)é˜¿æ‰Žå°”ï¼›(è‹±)å“ˆæ³½å¾·609, headroom [â€˜hedruËm; -rÊŠm]n. å‡€ç©ºï¼›å‡€ç©ºé«˜åº¦ï¼›å¤´ä¸Šç©ºé—´610, heap [hiËp]n. å †ï¼›è®¸å¤šï¼›ç´¯ç§¯;vt. å †ï¼›å †ç§¯;vi. å †èµ·æ¥;n. (Heap)äººåï¼›(èŠ¬)æµ·äºšæ™®ï¼›(ä¸œå—äºšå›½å®¶åŽè¯­)åï¼›(è‹±)å¸Œæ™®611, heck [hek]int.çœŸè§é¬¼ï¼ˆhellçš„å§”å©‰è¯´æ³•ï¼‰n.é¥²è‰æž¶n.(Heck)äººåï¼›(å¾·)é»‘å…‹ï¼›(è‘¡ã€è¥¿ã€æ³•)åŸƒå…‹ï¼›(è‹±)èµ«å…‹612, Hence [hens]adv. å› æ­¤ï¼›ä»ŠåŽ613, hereby [hÉªÉ™â€™baÉª]adv. ä»¥æ­¤æ–¹å¼ï¼Œæ®æ­¤ï¼›ç‰¹æ­¤614, hesitant [â€˜hÉ›zÉªtÉ™nt]adj. è¿Ÿç–‘çš„ï¼›è¸Œèº‡çš„ï¼›çŠ¹è±«ä¸å®šçš„615, hesitate [ËˆhÉ›zÉ™tet]vi. è¸Œèº‡ï¼ŒçŠ¹è±«ï¼›ä¸æ„¿vt. è¸Œèº‡ï¼ŒçŠ¹è±«ï¼›æœ‰ç–‘è™‘ï¼Œä¸æ„¿æ„616, heterogeneous [,het(É™)rÉ™(ÊŠ)â€™dÊ’iËnÉªÉ™s; -â€˜dÊ’en-]adj. [åŒ–å­¦] å¤šç›¸çš„ï¼›å¼‚ç§çš„ï¼›[åŒ–å­¦] ä¸å‡åŒ€çš„ï¼›ç”±ä¸åŒæˆåˆ†å½¢æˆçš„617, heuristics [hjuâ€™rÉªstÉªks]n. å¯å‘æ³•ï¼›å¯å‘å¼æ•™å­¦æ³•618, hexadecimal [,hÉ›ksÉ™â€™dÉ›sÉªml]adj. åå…­è¿›åˆ¶çš„n. åå…­è¿›åˆ¶619, hierarchical [haÉªÉ™â€™rÉ‘ËkÉªk(É™)l]adj. åˆ†å±‚çš„ï¼›ç­‰çº§ä½“ç³»çš„620, hierarchy [â€˜haÉªÉ™rÉ‘ËkÉª]n. å±‚çº§ï¼›ç­‰çº§åˆ¶åº¦621, hint [hÉªnt]n. æš—ç¤ºï¼›çº¿ç´¢vt. æš—ç¤ºï¼›ç¤ºæ„vi. ç¤ºæ„n. (Hint)äººåï¼›(è‹±)æ¬£ç‰¹ï¼›(æ³•)å®‰ç‰¹622, histogram [â€˜hÉªstÉ™É¡rÃ¦m]n. [ç»Ÿè®¡] ç›´æ–¹å›¾ï¼›æŸ±çŠ¶å›¾623, hitchhiker [â€˜hÉªtÊƒhaÉªkÉ™]n. æ­ä¾¿è½¦çš„æ—…è¡Œè€…ï¼›é¡ºä¾¿æ’å…¥çš„å¹¿å‘Š624, hive [haÉªv]vi. ç¾¤å±…ï¼›å…¥èœ‚æˆ¿ï¼›ç”Ÿæ´»åœ¨èœ‚æˆ¿ä¸­n. èœ‚æˆ¿ï¼Œèœ‚å·¢ï¼›çƒ­é—¹çš„åœºæ‰€ï¼›ç†™æ”˜å–§é—¹çš„äººç¾¤vt. å…¥èœ‚ç®±ï¼›è´®å¤‡625, hoist [hÉ’Éªst]n. èµ·é‡æœºï¼›å‡èµ·ï¼ŒåŠèµ·;vi. å‡èµ·ï¼›åŠèµ·;vt. ï¼ˆç”¨ç»³ç´¢ï¼Œèµ·é‡æœºç­‰ï¼‰ä½¿å‡èµ·;n. (Hoist)äººåï¼›(è‹±)éœä¼Šæ–¯ç‰¹626, hole [hÉ™ÊŠl]n. æ´žï¼Œå­”ï¼›æ´žç©´ï¼Œç©´ï¼›çªç ´å£vi. å‡¿æ´žï¼Œç©¿å­”ï¼›ï¼ˆé«˜å°”å¤«çƒç­‰ï¼‰è¿›æ´žvt. å‡¿æ´žn. (Hole)äººåï¼›(ç‘žå…¸ã€æŒª)éœå‹’ï¼›(è‹±)éœå°”627, holt [holt]n. å°æž—ï¼›æž—ä¸˜ï¼›æ‚æœ¨æž—n. (Holt)äººåï¼›(è‹±ã€å¾·ã€ç½—ã€åŒˆã€ç‘žå…¸)éœå°”ç‰¹ï¼›(æ³•ã€è¥¿)å¥¥å°”ç‰¹628, homebrew [homebrew]n. è‡ªé…¿ï¼ˆå•¤ï¼‰é…’ï¼›å…¬å¸è‡ªäº§è‡ªç”¨629, honestly [â€˜É’nÉªstlÉª]adv. çœŸè¯šåœ°ï¼›å…¬æ­£åœ°630, hood [hÊŠd]n. å¤´å·¾ï¼›è¦†ç›–ï¼›å…œå¸½n. (Hood)äººåï¼›(è‹±)èƒ¡å¾·ï¼›(å¾·ã€è·)éœå¾·vt. ç½©ä¸Šï¼›ä»¥å¤´å·¾è¦†ç›–631, hostile [â€˜hÉ’staÉªl]adj. æ•Œå¯¹çš„ï¼Œæ•Œæ–¹çš„ï¼›æ€€æ•Œæ„çš„;n. æ•Œå¯¹632, hourly [â€˜aÊŠÉšli]adv. æ¯å°æ—¶åœ°ï¼›é¢‘ç¹åœ°ï¼Œéšæ—¶adj. æ¯å°æ—¶çš„ï¼Œä»¥é’Ÿç‚¹è®¡ç®—çš„ï¼›é¢‘ç¹çš„633, hydrant [â€˜haÉªdr(É™)nt]n. æ¶ˆé˜²æ “ï¼›æ°´é¾™å¤´ï¼›ç»™æ°´æ “634, ideally [aÉªâ€™diÉ™li]adv. ç†æƒ³åœ°ï¼›è§‚å¿µä¸Šåœ°635, idempotent [,aÉªdemâ€™pÉ™ÊŠt(É™)nt; aÉªâ€™dempÉ™t(É™)nt]adj. å¹‚ç­‰çš„ n. [æ•°] å¹‚ç­‰636, identify [aÉªâ€™dentÉªfaÉª]vt. ç¡®å®šï¼›é‰´å®šï¼›è¯†åˆ«ï¼Œè¾¨è®¤å‡ºï¼›ä½¿å‚ä¸Žï¼›æŠŠâ€¦çœ‹æˆä¸€æ · vi. ç¡®å®šï¼›è®¤åŒï¼›ä¸€è‡´;vi. ç¡®å®šï¼›è®¤åŒï¼›ä¸€è‡´637, idiom [â€˜ÉªdÉªÉ™m]n. æˆè¯­ï¼Œä¹ è¯­ï¼›åœŸè¯638, idiomatic [,ÉªdÉªÉ™â€™mÃ¦tÉªk]adj. æƒ¯ç”¨çš„ï¼›ç¬¦åˆè¯­è¨€ä¹ æƒ¯çš„ï¼›é€šé¡ºçš„639, idle [â€˜aÉªdl]adj. é—²ç½®çš„ï¼›æ‡’æƒ°çš„ï¼›åœé¡¿çš„ vi. æ— æ‰€äº‹äº‹ï¼›è™šåº¦ï¼›ç©ºè½¬ vt. è™šåº¦ï¼›ä½¿ç©ºè½¬640, Idle [â€˜aÉªd(É™)l]adj. é—²ç½®çš„ï¼›æ‡’æƒ°çš„ï¼›åœé¡¿çš„;vi. æ— æ‰€äº‹äº‹ï¼›è™šåº¦ï¼›ç©ºè½¬;vt. è™šåº¦ï¼›ä½¿ç©ºè½¬641, ignite [ÉªÉ¡â€™naÉªt]vt. ç‚¹ç‡ƒï¼›ä½¿ç‡ƒçƒ§ï¼›ä½¿æ¿€åŠ¨vi. ç‚¹ç«ï¼›ç‡ƒçƒ§642, illegal [Éªâ€™liËg(É™)l]n. éžæ³•ç§»æ°‘ï¼›é—´è°;adj. [æ³•] éžæ³•çš„ï¼›è¿æ³•çš„ï¼›è¿åè§„åˆ™çš„643, illustrate [â€˜ÉªlÉ™streÉªt]vi. ä¸¾ä¾‹vt. é˜æ˜Žï¼Œä¸¾ä¾‹è¯´æ˜Žï¼›å›¾è§£644, immutability [immutability]n. ä¸å˜ï¼›æ°¸æ’æ€§ï¼›ä¸å˜æ€§645, immutable [Éªâ€™mjuËtÉ™b(É™)l]adj. ä¸å˜çš„ï¼›ä¸å¯å˜çš„ï¼›ä¸èƒ½å˜çš„646, implement [â€˜ÉªmplÉªm(É™)nt]n. å·¥å…·ï¼Œå™¨å…·ï¼›æ‰‹æ®µvt. å®žæ–½ï¼Œæ‰§è¡Œï¼›å®žçŽ°ï¼Œä½¿ç”Ÿæ•ˆ647, implementation [ÉªmplÉªmenâ€™teÉªÊƒ(É™)n]n. [è®¡] å®žçŽ°ï¼›å±¥è¡Œï¼›å®‰è£…å¯ç”¨648, implementing []n. å®žæ–½ï¼Œæ‰§è¡Œï¼›å®žçŽ°v. è´¯å½»ï¼Œæ‰§è¡Œï¼ˆimplementçš„çŽ°åœ¨åˆ†è¯ï¼‰649, implicit [Éªmâ€™plÉªsÉªt]adj. å«è“„çš„ï¼›æš—ç¤ºçš„ï¼›ç›²ä»Žçš„650, inception [Éªnâ€™sÉ›pÊƒÉ™n]n. èµ·åˆï¼›èŽ·å¾—å­¦ä½n. ã€Šç›—æ¢¦ç©ºé—´ã€‹ï¼ˆç”µå½±åï¼‰651, inconvenience [ÉªnkÉ™nâ€™viËnÉªÉ™ns]n. ä¸ä¾¿ï¼›éº»çƒ¦;vt. éº»çƒ¦ï¼›æ‰“æ‰°652, incorporate [Éªnâ€™kÉ”ËpÉ™reÉªt]vt. åŒ…å«ï¼Œå¸æ”¶ï¼›ä½“çŽ°ï¼›æŠŠâ€¦â€¦åˆå¹¶;vi. åˆå¹¶ï¼›æ··åˆï¼›ç»„æˆå…¬å¸;adj. åˆå¹¶çš„ï¼›ä¸€ä½“åŒ–çš„ï¼›ç»„æˆå…¬å¸çš„653, incubator [â€˜ÉªÅ‹kjÊŠbeÉªtÉ™]n. [ç¦½] å­µåµå™¨ï¼›[å„¿ç§‘] ä¿æ¸©ç®±ï¼›æ—©äº§å„¿ä¿è‚²å™¨ï¼›ç»†èŒåŸ¹å…»å™¨654, indicate [â€˜ÉªndÉªkeÉªt]vt. è¡¨æ˜Žï¼›æŒ‡å‡ºï¼›é¢„ç¤ºï¼›è±¡å¾655, indicating [â€˜ÉªndÉªkeÉªtÉªÅ‹]n. è¡¨æ˜Žï¼›æŒ‡ç¤ºv. è¡¨æ˜Žï¼›æŒ‡ç¤ºï¼›è¦æ±‚ï¼ˆindicateçš„ingå½¢å¼ï¼‰adj. æŒ‡ç¤ºçš„656, indicator [â€˜ÉªndÉªketÉš]n. æŒ‡ç¤ºå™¨ï¼›[è¯•å‰‚] æŒ‡ç¤ºå‰‚ï¼›[è®¡] æŒ‡ç¤ºç¬¦ï¼›åŽ‹åŠ›è®¡657, indicen. æŒ‡æ•°ï¼›æ ‡è®°ä½“658, individual [ÉªndÉªâ€™vÉªdjÊŠ(É™)l]adj. ä¸ªäººçš„ï¼›ä¸ªåˆ«çš„ï¼›ç‹¬ç‰¹çš„;n. ä¸ªäººï¼Œä¸ªä½“659, individually [ËŒÉªndÉªËˆvÉªdÊ’uÉ™li]adv. ä¸ªåˆ«åœ°ï¼Œå•ç‹¬åœ°660, industry [â€˜ÉªndÉ™strÉª]n. äº§ä¸šï¼›å·¥ä¸šï¼›å‹¤å‹‰661, inevitably [Éªâ€™nevÉªtÉ™blÉª; Éªnâ€™evÉªtÉ™blÉª]adv. ä¸å¯é¿å…åœ°ï¼›å¿…ç„¶åœ°662, infection [Éªnâ€™fÉ›kÊƒÉ™n]n. æ„ŸæŸ“ï¼›ä¼ æŸ“ï¼›å½±å“ï¼›ä¼ æŸ“ç—…663, infer [Éªnâ€™fÉ]vt. æŽ¨æ–­ï¼›æŽ¨è®ºvi. æŽ¨æ–­ï¼›ä½œå‡ºæŽ¨è®º664, Infinite [â€˜ÉªnfÉªnÉ™t]adj. æ— é™çš„ï¼Œæ— ç©·çš„ï¼›æ— æ•°çš„ï¼›æžå¤§çš„;n. æ— é™ï¼›[æ•°] æ— ç©·å¤§ï¼›æ— é™çš„ä¸œè¥¿ï¼ˆå¦‚ç©ºé—´ï¼Œæ—¶é—´ï¼‰665, infrastructure [â€˜ÉªnfrÉ™strÊŒktÊƒÉ™]n. åŸºç¡€è®¾æ–½ï¼›å…¬å…±å»ºè®¾ï¼›ä¸‹éƒ¨æž„é€ 666, ingest [Éªnâ€™dÊ’est]vt. æ‘„å–ï¼›å’½ä¸‹ï¼›å¸æ”¶ï¼›æŽ¥å¾…667, ingress [â€˜Éªngres]n. è¿›å…¥ï¼›å…¥å£ï¼›å‡†è®¸è¿›å…¥ï¼›å…¥å¢ƒn. (Ingress)äººåï¼›(è‹±)è‹±æ ¼é›·æ–¯668, inherently [Éªnâ€™hÉªrÉ™ntli]adv. å†…åœ¨åœ°ï¼›å›ºæœ‰åœ°ï¼›å¤©æ€§åœ°669, inhibition [Éªn(h)Éªâ€™bÉªÊƒ(É™)n]n. æŠ‘åˆ¶ï¼›åŽ‹æŠ‘ï¼›ç¦æ­¢670, Initiative [Éªâ€™nÉªÊƒÉªÉ™tÉªv; -ÊƒÉ™-]n. ä¸»åŠ¨æƒï¼›é¦–åˆ›ç²¾ç¥ž;adj. ä¸»åŠ¨çš„ï¼›è‡ªå‘çš„ï¼›èµ·å§‹çš„671, initiator [Éªâ€™nÉªÊƒÉªeÉªtÉ™]n. å‘èµ·äººï¼Œåˆ›å§‹è€…ï¼›æ•™å¯¼è€…ï¼›[è®¡] å¯åŠ¨ç¨‹åºï¼›å¼•çˆ†å™¨672, innocent [â€˜ÉªnÉ™s(É™)nt]adj. æ— è¾œçš„ï¼›æ— ç½ªçš„ï¼›æ— çŸ¥çš„n. å¤©çœŸçš„äººï¼›ç¬¨è›‹n. (Innocent)äººåï¼›(è‹±ã€è¥¿)å› è¯ºæ£®ç‰¹ï¼›(æ³•)ä¼Šè¯ºæ¡‘673, inplacen. åŽŸåœ°674, insight [â€˜ÉªnsaÉªt]n. æ´žå¯ŸåŠ›ï¼›æ´žæ‚‰n. (Insight)äººåï¼›(è‹±)å› èµ›ç‰¹675, inspect [Éªnâ€™spekt]vt. æ£€æŸ¥ï¼›è§†å¯Ÿï¼›æ£€é˜…;vi. è¿›è¡Œæ£€æŸ¥ï¼›è¿›è¡Œè§†å¯Ÿ676, instant [â€˜ÉªnstÉ™nt]adj. ç«‹å³çš„ï¼›ç´§æ€¥çš„ï¼›ç´§è¿«çš„n. çž¬é—´ï¼›ç«‹å³ï¼›ç‰‡åˆ»677, instantaneous [,ÉªnstÉ™nâ€™tenÉªÉ™s]adj. çž¬é—´çš„ï¼›å³æ—¶çš„ï¼›çŒå‘çš„678, instantiate [Éªnâ€™stÃ¦nÊƒÉªeÉªt]vt. ä¾‹ç¤ºï¼Œä¸¾ä¾‹è¯´æ˜Ž679, instrument [â€˜ÉªnstrÊŠm(É™)nt]n. ä»ªå™¨ï¼›å·¥å…·ï¼›ä¹å™¨ï¼›æ‰‹æ®µï¼›å™¨æ¢°680, instrumental [,ÉªnstrÉ™â€™mÉ›ntl]adj. ä¹å™¨çš„ï¼›æœ‰å¸®åŠ©çš„ï¼›ä»ªå™¨çš„ï¼Œå™¨æ¢°çš„n. å™¨ä¹æ›²ï¼›å·¥å…·å­—ï¼Œå·¥å…·æ ¼681, insulation [ÉªnsjÊŠâ€™leÉªÊƒ(É™)n]n. ç»ç¼˜ï¼›éš”ç¦»ï¼Œå­¤ç«‹682, intact [Éªnâ€™tÃ¦kt]adj. å®Œæ•´çš„ï¼›åŽŸå°ä¸åŠ¨çš„ï¼›æœªå—æŸä¼¤çš„683, integrate [â€˜ÉªntÉªgreÉªt]vt. ä½¿â€¦å®Œæ•´ï¼›ä½¿â€¦æˆæ•´ä½“ï¼›æ±‚â€¦çš„ç§¯åˆ†ï¼›è¡¨ç¤ºâ€¦çš„æ€»å’Œ;vi. æ±‚ç§¯åˆ†ï¼›å–æ¶ˆéš”ç¦»ï¼›æˆä¸ºä¸€ä½“;adj. æ•´åˆçš„ï¼›å®Œå…¨çš„;n. ä¸€ä½“åŒ–ï¼›é›†æˆä½“684, integration [ÉªntÉªâ€™greÉªÊƒ(É™)n]n. é›†æˆï¼›ç»¼åˆ685, Integration [ÉªntÉªâ€™greÉªÊƒ(É™)n]n. é›†æˆï¼›ç»¼åˆ686, intense [Éªnâ€™tÉ›ns]adj. å¼ºçƒˆçš„ï¼›ç´§å¼ çš„ï¼›éžå¸¸çš„ï¼›çƒ­æƒ…çš„[ æ¯”è¾ƒçº§:more intenseæˆ– intenser æœ€é«˜çº§:most intenseæˆ– intensest ]687, intent [Éªnâ€™tent]n. æ„å›¾ï¼›ç›®çš„ï¼›å«ä¹‰;adj. ä¸“å¿ƒçš„ï¼›æ€¥åˆ‡çš„ï¼›åšå†³çš„688, intention [Éªnâ€™tenÊƒ(É™)n]n. æ„å›¾ï¼›ç›®çš„ï¼›æ„å‘ï¼›æ„ˆåˆ689, intentionallyadv. æ•…æ„åœ°ï¼Œæœ‰æ„åœ°690, interacting [,ÉªntÉ™â€™rÃ¦kt]n. ç›¸äº’ä½œç”¨ï¼›ç›¸äº’åˆ¶çº¦;v. äº’ç›¸å½±å“ï¼›äº’ç›¸ä½œç”¨ï¼ˆinteractçš„ingå½¢å¼ï¼‰691, interaction [ÉªntÉ™râ€™Ã¦kÊƒ(É™)n]n. ç›¸äº’ä½œç”¨ï¼›[æ•°] äº¤äº’ä½œç”¨n. äº’åŠ¨interaction: ç›¸äº’ä½œç”¨ äº¤äº’ äº¤äº’ä½œç”¨692, interactive [ÉªntÉ™râ€™Ã¦ktÉªv]adj. äº¤äº’å¼çš„ï¼›ç›¸äº’ä½œç”¨çš„693, Interactive [ÉªntÉ™râ€™Ã¦ktÉªv]adj. äº¤äº’å¼çš„ï¼›ç›¸äº’ä½œç”¨çš„694, intercept [,ÉªntÉ™â€™sept]vt. æ‹¦æˆªï¼›æˆªæ–­ï¼›çªƒå¬;n. æ‹¦æˆªï¼›[æ•°] æˆªè·ï¼›æˆªèŽ·çš„æƒ…æŠ¥695, interference [ÉªntÉ™â€™fÉªÉ™r(É™)ns]n. å¹²æ‰°ï¼Œå†²çªï¼›å¹²æ¶‰696, interleavingn. [è®¡] äº¤é”™ï¼›äº¤å‰ v. æ’å…¥ï¼›[è®¡] äº¤å‰å­˜å–ï¼ˆinterleaveçš„ingå½¢å¼ï¼‰697, Intermediate [,ÉªntÉ™â€™miËdÉªÉ™t]vi. èµ·åª’ä»‹ä½œç”¨;adj. ä¸­é—´çš„ï¼Œä¸­çº§çš„;n. [åŒ–å­¦] ä¸­é—´ç‰©ï¼›åª’ä»‹698, internallyadv. å†…éƒ¨åœ°ï¼›å›½å†…åœ°ï¼›å†…åœ¨åœ°699, Internationalization [â€˜ÉªntÉ™,nÃ¦ÊƒÉ™nÉ™laÉªâ€™zeÉªÊƒÉ™n]n. å›½é™…åŒ–700, Interopn. äº¤äº’æ“ä½œï¼›Interopè´¸æ˜“å±•ç¤ºä¼šï¼ˆæ¯å¹´åœ¨ç¾Žå›½ä¸¾åŠžçš„å…¨çƒæœ€å¤§çš„ç½‘ç»œä¸“ä¸šå±•è§ˆä¼šï¼‰701, Interoperability [â€˜ÉªntÉ™r,É’pÉ™rÉ™â€™bÉªlÉ™tÉª]n. [è®¡] äº’æ“ä½œæ€§ï¼›äº’ç”¨æ€§702, interoperableadj. å½¼æ­¤åä½œçš„ï¼›èƒ½å…±åŒæ“ä½œçš„ï¼›èƒ½å…±åŒä½¿ç”¨çš„703, interpolate [Éªnâ€™tÉpÉ™let]vt. ç¯¡æ”¹ï¼›æ’å…¥æ–°è¯­å¥vi. æ’å…¥ï¼›ç¯¡æ”¹704, interpolation [Éªn,tÉšpÉ™â€™leÊƒÉ™n]n. æ’å…¥ï¼›ç¯¡æ”¹ï¼›æ·»å†™705, Interpretable [inâ€™tÉ™:prÉ™tÉ™bl]adj. å¯è¯´æ˜Žçš„ï¼›å¯åˆ¤æ–­çš„ï¼›å¯ç¿»è¯‘çš„706, interrupt [ÉªntÉ™â€™rÊŒpt]vt. ä¸­æ–­ï¼›æ‰“æ–­ï¼›æ’å˜´ï¼›å¦¨ç¢vi. æ‰“æ–­ï¼›æ‰“æ‰°n. ä¸­æ–­707, interview [â€˜ÉªntÉ™vjuË]n. æŽ¥è§ï¼Œé‡‡è®¿ï¼›é¢è¯•ï¼Œé¢è°ˆ;vt. é‡‡è®¿ï¼›æŽ¥è§ï¼›å¯¹â€¦è¿›è¡Œé¢è°ˆï¼›å¯¹æŸäººè¿›è¡Œé¢è¯•708, intoxication [Éªn,tÉ’ksÉªâ€™keÉªÊƒn]n. [å†…ç§‘] ä¸­æ¯’ï¼›é™¶é†‰ï¼›å–é†‰709, intrinsic [Éªnâ€™trÉªnsÉªk]adj. æœ¬è´¨çš„ï¼Œå›ºæœ‰çš„710, introspection [ÉªntrÉ™(ÊŠ)â€™spekÊƒ(É™)n]n. å†…çœï¼›åçœ711, introspective [ÉªntrÉ™â€™spektÉªv]adj. å†…çœçš„ï¼›åçœçš„712, intuitive [Éªnâ€™tuÉªtÉªv]adj. ç›´è§‰çš„ï¼›å‡­ç›´è§‰èŽ·çŸ¥çš„713, intuitively [Éªnâ€™tjÊŠÉªtÉªvli]adv. ç›´è§‚åœ°ï¼›ç›´è§‰åœ°714, invariant [Éªnâ€™vÉ›rÉªÉ™nt]adj. ä¸å˜çš„n. [æ•°] ä¸å˜é‡ï¼›[è®¡] ä¸å˜å¼715, invasive [Éªnâ€™veÉªsÉªv]adj. ä¾µç•¥æ€§çš„ï¼›æ”»å‡»æ€§çš„716, inventory [â€˜Éªnv(É™)nt(É™)rÉª]n. å­˜è´§ï¼Œå­˜è´§æ¸…å•ï¼›è¯¦ç»†ç›®å½•ï¼›è´¢äº§æ¸…å†Œ717, Inventory [â€˜Éªnv(É™)nt(É™)rÉª]n. å­˜è´§ï¼Œå­˜è´§æ¸…å•ï¼›è¯¦ç»†ç›®å½•ï¼›è´¢äº§æ¸…å†Œ718, Inversion [Éªnâ€™vÉœËÊƒ(É™)n]n. å€’ç½®ï¼›åå‘ï¼›å€’è½¬719, inverted [Éªnâ€™vÉœËtÉªd]adj. å€’è½¬çš„ï¼Œåå‘çš„v. é¢ å€’ï¼ˆinvertçš„è¿‡åŽ»åˆ†è¯ï¼‰ï¼›ä½¿â€¦åå‘720, investigate [Éªnâ€™vestÉªgeÉªt]v. è°ƒæŸ¥ï¼›ç ”ç©¶721, invitation [ËŒÉªnvÉªËˆteÉªÊƒn]n. é‚€è¯·ï¼›å¼•è¯±722, invite [Éªnâ€™vaÉªt]vt. é‚€è¯·ï¼Œæ‹›å¾…ï¼›æ‹›è‡´;n. é‚€è¯·723, invocation [,ÉªnvÉ™(ÊŠ)â€™keÉªÊƒ(É™)n]n. ç¥ˆç¥·ï¼›ç¬¦å’’ï¼›ã€æ³•å¾‹ã€‘(æ³•é™¢å¯¹å¦æ¡ˆçš„)æ–‡ä»¶è°ƒå–ï¼›(æ³•æƒçš„)è¡Œä½¿724, Invocation [,ÉªnvÉ™(ÊŠ)â€™keÉªÊƒ(É™)n]n. ç¥ˆç¥·ï¼›ç¬¦å’’725, irrespective [,ÉªrÉªâ€™spÉ›ktÉªv]adj. æ— å…³çš„ï¼›ä¸è€ƒè™‘çš„ï¼›ä¸é¡¾çš„726, iteration [ÉªtÉ™â€™reÉªÊƒ(É™)n]n.[æ•°] è¿­ä»£ï¼›åå¤ï¼›é‡å¤727, iteratively [â€˜itÉ™,reitivli]adv. è¿­ä»£åœ°ï¼›åå¤åœ°728, iterator [ÉªtÉ™â€™retÉš]n. è¿­ä»£å™¨ï¼›è¿­ä»£ç¨‹åº729, Iterator [ÉªtÉ™â€™reÉªtÉ™]n. è¿­ä»£å™¨ï¼›è¿­ä»£ç¨‹åº730, jet [jÉ›t]n. å–·å°„ï¼Œå–·å˜´ï¼›å–·æ°”å¼é£žæœºï¼›é»‘çŽ‰adj. å¢¨é»‘çš„vt. å°„å‡ºvi. å°„å‡ºï¼›[èˆª] ä¹˜å–·æ°”å¼é£žæœº731, journal [â€˜dÊ’ÉœËn(É™)l]n. æ—¥æŠ¥ï¼Œæ‚å¿—ï¼›æ—¥è®°ï¼›åˆ†ç±»è´¦732, Jumbotron [â€˜dÊ’ÊŒmbÉ™utrÉ”n]n. ç”µè§†æœºçš„è¶…å¤§å±å¹•733, Kestrel [â€˜kestr(É™)l]n. ï¼ˆäº§äºŽæ¬§æ´²çš„ï¼‰èŒ¶éš¼734, kick [kÉªk]n. è¸¢ï¼›åå†²ï¼ŒåŽåº§åŠ›vt. è¸¢ï¼›åå†²ï¼ŒæœåŽåº§vi. è¸¢ï¼›åå†²n. (Kick)äººåï¼›(å¾·)åŸºå…‹735, knobsn. æŠŠæ‰‹ï¼ˆknobçš„å¤æ•°ï¼‰ï¼›å‡¸å²©736, knuckle [â€˜nÊŒk(É™)l]n. å…³èŠ‚ï¼›æŒ‡å…³èŠ‚ï¼›æŒ‡èŠ‚ï¼›è†å…³èŠ‚ï¼›è‚˜vi. å¼€å§‹è®¤çœŸå·¥ä½œvt. ç”¨æŒ‡å…³èŠ‚æ•²æ‰“737, lack [lÃ¦k]vt. ç¼ºä¹ï¼›ä¸è¶³ï¼›æ²¡æœ‰ï¼›éœ€è¦;vi. ç¼ºä¹ï¼›ä¸è¶³ï¼›æ²¡æœ‰;n. ç¼ºä¹ï¼›ä¸è¶³;n. (Lack)äººåï¼›(è€)æ‹‰ï¼›(è‹±ã€æ³•ã€æ„ã€è‘¡ã€åŒˆ)æ‹‰å…‹ï¼›(åŒˆ)æ´›å…‹738, landscape [â€˜lÃ¦n(d)skeÉªp]n. é£Žæ™¯ï¼›é£Žæ™¯ç”»ï¼›æ™¯è‰²ï¼›å±±æ°´ç”»ï¼›ä¹¡æ‘é£Žæ™¯ç”»ï¼›åœ°å½¢ï¼›ï¼ˆæ–‡ä»¶çš„ï¼‰æ¨ªå‘æ‰“å°æ ¼å¼;vt. å¯¹â€¦åšæ™¯è§‚ç¾ŽåŒ–ï¼Œç»™â€¦åšå›­æž—ç¾ŽåŒ–ï¼›ä»Žäº‹åº­å›­è®¾è®¡;vi. ç¾ŽåŒ–ï¼ˆçŽ¯å¢ƒç­‰ï¼‰ï¼Œä½¿æ™¯è‰²å®œäººï¼›ä»Žäº‹æ™¯è§‚ç¾ŽåŒ–å·¥ä½œï¼Œåšåº­å›­è®¾è®¡å¸ˆ739, lane [leÉªn]n. å°å··ï¼›[èˆª][æ°´è¿] èˆªçº¿ï¼›è½¦é“ï¼›ç½šçƒåŒºn. (Lane)äººåï¼›(è‹±ã€ä¿„)èŽ±æ©ï¼›(è€)å…°ï¼›(å¾·ã€æ³•ã€æ„ã€è‘¡ã€å¡žã€ç‘žå…¸)æ‹‰å†…740, Lantern [â€˜lÃ¦ntÉ™n]n. ç¯ç¬¼ï¼›æç¯ï¼›ç¯ç¬¼å¼å¤©çª—741, Laptops []ç¬”è®°æœ¬ç”µè„‘742, lark [lÉ‘Ëk]n. äº‘é›€ï¼›ç™¾çµé¸Ÿï¼›æ¬¢ä¹vi. éª‘é©¬çŽ©ä¹ï¼›å¬‰è€vt. æ„šå¼„n. (Lark)äººåï¼›(ä¸œå—äºšå›½å®¶åŽè¯­)å…­743, latch [lÃ¦tÊƒ]vi. å æœ‰ï¼ŒæŠ“ä½ï¼›é—­é”vt. é—©ä¸Šï¼›çº ç¼ ä½æŸäººn. é—¨é—©n. (Latch)äººåï¼›(è‹±)æ‹‰å¥‡744, Latch [lÃ¦tÊƒ]vi. å æœ‰ï¼ŒæŠ“ä½ï¼›é—­é”;vt. é—©ä¸Šï¼›çº ç¼ ä½æŸäºº;n. é—¨é—©;n. (Latch)äººåï¼›(è‹±)æ‹‰å¥‡745, latency [â€˜letnsi]n. æ½œä¼ï¼›æ½œåœ¨å› ç´ 746, latent [â€˜letnt]adj. æ½œåœ¨çš„ï¼›æ½œä¼çš„ï¼›éšè—çš„747, launching [â€˜lÉ”ËntÊƒÉªÅ‹]n. å‘å°„ï¼›ä¸‹æ°´ï¼›åˆ›è®¾;v. å‘å°„ï¼›å‘åŠ¨ï¼›å¼€å§‹ä»Žäº‹ï¼ˆlaunchçš„ingå½¢å¼ï¼‰748, lean [lin]vi. å€¾æ–œï¼›å€šé ï¼›å€¾å‘ï¼›ä¾èµ–adj. ç˜¦çš„ï¼›è´«ä¹çš„ï¼Œæ­‰æ”¶çš„vt. ä½¿å€¾æ–œn. ç˜¦è‚‰ï¼›å€¾æ–œï¼›å€¾æ–œåº¦n. (Lean)äººåï¼›(è¥¿)èŽ±å®‰ï¼›(æŸ¬)è¿žï¼›(è‹±)åˆ©æ©[ :è¿‡åŽ»å¼leanedæˆ– leant è¿‡åŽ»åˆ†è¯:leanedæˆ– leant çŽ°åœ¨åˆ†è¯:leaning ]749, leap [lip]vi. è·³ï¼Œè·³è·ƒn. é£žè·ƒï¼›è·³è·ƒvt. è·³è·ƒï¼Œè·³è¿‡ï¼›ä½¿è·ƒè¿‡n. (Leap)äººåï¼›(æ³•)èŽ±äºš750, ledger [â€˜ledÊ’É™]n.æ€»è´¦ï¼Œåˆ†æˆ·æ€»è´¦ï¼›[ä¼šè®¡] åˆ†ç±»è´¦ï¼›è´¦ç°¿ï¼›åº•è´¦ï¼›ï¼ˆæ‰‹è„šæž¶ä¸Šçš„ï¼‰æ¨ªæœ¨n.(Ledger)äººåï¼›(è‹±)èŽ±æ°751, legacy [â€˜legÉ™sÉª]n. é—èµ ï¼Œé—äº§752, Legacy [â€˜legÉ™sÉª]n. é—èµ ï¼Œé—äº§753, lenient [â€˜liËnÉªÉ™nt]adj. å®½å¤§çš„ï¼›ä»æ…ˆçš„ n. (Lenient)äººåï¼›(æ³•)å‹’å°¼å®‰754, leverage [â€˜lÉ›vÉ™rÉªdÊ’]n. æ‰‹æ®µï¼Œå½±å“åŠ›ï¼›æ æ†ä½œç”¨ï¼›æ æ†æ•ˆçŽ‡v. åˆ©ç”¨ï¼›ä¸¾å€ºç»è¥755, Lexical [â€˜leksÉªk(É™)l]adj. è¯æ±‡çš„ï¼›[è¯­] è¯å…¸çš„ï¼›è¯å…¸ç¼–çº‚çš„756, lexicographically 757, line upæŽ’åˆ—èµ·ï¼›æ•´é˜Ÿ758, linguistic [lÉªÅ‹â€™gwÉªstÉªk]adj. è¯­è¨€çš„ï¼›è¯­è¨€å­¦çš„759, literal [â€˜lÉªt(É™)r(É™)l]adj. æ–‡å­—çš„ï¼›é€å­—çš„ï¼›æ— å¤¸å¼ çš„760, loan [lÉ™ÊŠn]n. è´·æ¬¾ï¼›å€Ÿæ¬¾vi. å€Ÿå‡ºvt. å€Ÿï¼›å€Ÿç»™761, lobster [â€˜lÉ’bstÉ™]n. é¾™è™¾é¾™è™¾è‚‰762, lockup [â€˜lÉ’kÊŒp]n. æ‹˜ç•™æ‰€ï¼Œç›‘ç‹±ï¼›é”ä½ï¼›ç›‘ç¦763, looks up 764, lookup [â€˜lÊŠkÊŒp]n. æŸ¥æ‰¾ï¼›æ£€æŸ¥765, loop [luËp]vi. æ‰“çŽ¯ï¼›ç¿»ç­‹æ–—;n. çŽ¯ï¼›åœˆï¼›å¼¯æ›²éƒ¨åˆ†ï¼›ç¿»ç­‹æ–—;vt. ä½¿æˆçŽ¯ï¼›ä»¥çŽ¯è¿žç»“ï¼›ä½¿ç¿»ç­‹æ–—766, Loop [luËp]vi. æ‰“çŽ¯ï¼›ç¿»ç­‹æ–—;n. çŽ¯ï¼›åœˆï¼›å¼¯æ›²éƒ¨åˆ†ï¼›ç¿»ç­‹æ–—;vt. ä½¿æˆçŽ¯ï¼›ä»¥çŽ¯è¿žç»“ï¼›ä½¿ç¿»ç­‹æ–—767, loopback [loopback]n. [è®¡] å›žé€ï¼›å›žè·¯768, luggage [â€˜lÊŒgÉªdÊ’]n. è¡ŒæŽï¼›çš®ç®±769, lumberjack [â€˜lÊŒmbÉ™dÊ’Ã¦k]n. ä¼æœ¨å·¥äººï¼›æœ¨æå•†çš„ä½£å·¥ï¼›çŸ­èŒ„å…‹è¡«770, macro [â€˜mÃ¦kro]adj. å·¨å¤§çš„ï¼Œå¤§é‡çš„n. å®ï¼Œå·¨ï¼ˆè®¡ç®—æœºæœ¯è¯­ï¼‰n. (Macro)äººåï¼›(æ„)é©¬å…‹ç½—771, malformed [,mÃ¦lâ€™fÉ”rmd]adj. ç•¸å½¢çš„ï¼Œéš¾çœ‹çš„772, malicious [mÉ™â€™lÉªÊƒÉ™s]adj. æ¶æ„çš„ï¼›æ¶æ¯’çš„ï¼›è“„æ„çš„ï¼›æ€€æ¨çš„773, malwaren. æ¶æ„è½¯ä»¶774, mandatory [â€˜mÃ¦ndÉ™t(É™)rÉª]adj. å¼ºåˆ¶çš„ï¼›æ‰˜ç®¡çš„ï¼›å‘½ä»¤çš„ n. å—æ‰˜è€…ï¼ˆç­‰äºŽmandataryï¼‰775, manifest [â€˜mÃ¦nÉªfest]vt. è¯æ˜Žï¼Œè¡¨æ˜Žï¼›æ˜¾ç¤ºvi. æ˜¾ç¤ºï¼Œå‡ºçŽ°n. è½½è´§å•ï¼Œè´§å•ï¼›æ—…å®¢åå•adj. æ˜¾ç„¶çš„ï¼Œæ˜Žæ˜¾çš„ï¼›æ˜Žç™½çš„776, manipulate [mÉ™â€™nÉªpjÊŠleÉªt]vt. æ“çºµï¼›æ“ä½œï¼›å·§å¦™åœ°å¤„ç†ï¼›ç¯¡æ”¹777, Manipulation [mÉ™,nÉªpjÊŠâ€™leÉªÊƒ(É™)n]n. æ“çºµï¼›æ“ä½œï¼›å¤„ç†ï¼›ç¯¡æ”¹778, manner [â€˜mÃ¦nÉ™]n. æ–¹å¼ï¼›ä¹ æƒ¯ï¼›ç§ç±»ï¼›è§„çŸ©ï¼›é£Žä¿—;n. (Manner)äººåï¼›(å¾·ã€èŠ¬ã€ç‘žå…¸)æ›¼çº³779, manufacture [mÃ¦njÊŠâ€™fÃ¦ktÊƒÉ™]n. åˆ¶é€ ï¼›äº§å“ï¼›åˆ¶é€ ä¸švt. åˆ¶é€ ï¼›åŠ å·¥ï¼›æé€ vi. åˆ¶é€ 780, margin [â€˜mÉ‘ËdÊ’Éªn]n. è¾¹ç¼˜ï¼›åˆ©æ¶¦ï¼Œä½™è£•ï¼›é¡µè¾¹çš„ç©ºç™½;vt. åŠ è¾¹äºŽï¼›åŠ æ—æ³¨äºŽ;n. (Margin)äººåï¼›(ä¿„ã€æ„)é©¬å°”é‡‘781, marginally [â€˜mÉ‘rdÊ’ÉªnÉ™li]adv. å°‘é‡åœ°ï¼›æœ€ä½Žé™åº¦åœ°ï¼›åœ¨æ å¤–ï¼›åœ¨é¡µè¾¹782, Markup [â€˜mÉ‘ËkÊŒp]n. æ¶¨ä»·ï¼›åˆ©æ¶¦ï¼›å®¡å®š;n. (Markup)äººåï¼›(æ·ã€åŒˆ)é©¬å°”åº“æ™®783, marshalln. å…ƒå¸…ï¼›å…¸ç¤¼å®˜ï¼›æ‰§æ³•å®˜ï¼›æ³•å®˜çš„éšè¡Œå®˜å‘˜ï¼ˆç­‰äºŽjudgeâ€™s marshalï¼‰vt. å®‰æŽ’ï¼›å¼•é¢†ï¼›ç»Ÿå¸…vi. å„å°±å„ä½ï¼›æŒ‰æ¬¡åºæŽ’åˆ—æˆå½¢ï¼ˆç­‰äºŽmarshalï¼‰784, marshalled [marshalled]æ•´ç†ï¼ˆmarshalçš„è¿‡åŽ»å¼ä¸Žè¿‡åŽ»åˆ†è¯å½¢å¼ï¼‰ä½¿æŽ’åˆ—ï¼ˆmarshalçš„è¿‡åŽ»å¼ä¸Žè¿‡åŽ»åˆ†è¯å½¢å¼ï¼‰785, maskableadj. å¯å±è”½çš„786, master [â€˜mÉ‘ËstÉ™]vt. æŽ§åˆ¶ï¼›ç²¾é€šï¼›å¾æœ;n. ç¡•å£«ï¼›ä¸»äººï¼›å¤§å¸ˆï¼›æ•™å¸ˆ;adj. ä¸»äººçš„ï¼›ä¸»è¦çš„ï¼›ç†Ÿç»ƒçš„;n. (Master)äººåï¼›(è‹±)é©¬æ–¯ç‰¹787, mate [meÉªt]n. åŠ©æ‰‹ï¼Œå¤§å‰¯ï¼›é…å¶ï¼›åŒäº‹ï¼›é…å¯¹ç‰©vt. ä½¿é…å¯¹ï¼›ä½¿ä¸€è‡´ï¼›ç»“ä¼´vi. äº¤é…ï¼›æˆé…å¶ï¼›ç´§å¯†é…åˆn. (Mate)äººåï¼›(æ—¥)è›(å§“)ï¼›(è¥¿ã€æ„ã€å¡ž)é©¬ç‰¹ï¼›(æ³¢é»‘)é©¬ç‰¹ï¼›(ç½—ã€ä¿„)é©¬æ³°788, material [mÉ™â€™tÉªrÉªÉ™l]adj. é‡è¦çš„ï¼›ç‰©è´¨çš„ï¼Œå®žè´¨æ€§çš„ï¼›è‚‰ä½“çš„n. ææ–™ï¼ŒåŽŸæ–™ï¼›ç‰©èµ„ï¼›å¸ƒæ–™789, matrix [â€˜metrÉªks]n. [æ•°] çŸ©é˜µï¼›æ¨¡åž‹ï¼›[ç”Ÿç‰©][åœ°è´¨] åŸºè´¨ï¼›æ¯ä½“ï¼›å­å®«ï¼›[åœ°è´¨] è„‰çŸ³790, Matrix [â€˜meÉªtrÉªks]n. [æ•°] çŸ©é˜µï¼›æ¨¡åž‹ï¼›[ç”Ÿç‰©][åœ°è´¨] åŸºè´¨ï¼›æ¯ä½“ï¼›å­å®«ï¼›[åœ°è´¨] è„‰çŸ³791, mean [min]adj. å¹³å‡çš„ï¼›å‘é„™çš„ï¼›ä½ŽåŠ£çš„ï¼›åå•¬çš„vt. æ„å‘³ï¼›æƒ³è¦ï¼›æ„æ¬²n. å¹³å‡å€¼vi. ç”¨æ„n. (Mean)äººåï¼›(æŸ¬)æ£‰792, Measurable [â€˜meÊ’(É™)rÉ™b(É™)l]adj. å¯æµ‹é‡çš„ï¼›é‡è¦çš„ï¼›é‡å¤§çš„793, mechanism [â€˜mek(É™)nÉªz(É™)m]n. æœºåˆ¶ï¼›åŽŸç†ï¼Œé€”å¾„ï¼›è¿›ç¨‹ï¼›æœºæ¢°è£…ç½®ï¼›æŠ€å·§794, mechanisms [â€˜mÉ›kÉ™nÉªzÉ™mz]n. æœºåˆ¶ï¼›[æœº] æœºæž„ï¼ˆmechanismçš„å¤æ•°ï¼‰ï¼›æœºæ¢°ï¼›[æœº] æœºæž„å­¦795, median [â€˜midÉªÉ™n]n. n. ä¸­å€¼ï¼Œä¸­ä½æ•°ï¼›ä¸‰è§’å½¢ä¸­çº¿ï¼›æ¢¯å½¢ä¸­ä½çº¿adj. ä¸­å€¼çš„ï¼›ä¸­å¤®çš„n. (Median)äººåï¼›(é˜¿æ‹‰ä¼¯)è¿ˆè¿ªå®‰ï¼›(ç½—)æ¢…è¿ªå®‰796, mediocre [,miËdÉªâ€™É™ÊŠkÉ™]adj. æ™®é€šçš„ï¼›å¹³å‡¡çš„ï¼›ä¸­ç­‰çš„797, mediocrity [miËdÉªâ€™É’krÉªtÉª]n. å¹³åº¸ä¹‹æ‰ï¼›å¹³å¸¸798, mega [â€˜mÉ›É¡É™]n. ç™¾ä¸‡adj. è®¸å¤šï¼›å®å¤§çš„adv. éžå¸¸n. (Mega)äººåï¼›(è‘¡ã€æ„ã€æ·ã€å¡ž)æ¢…åŠ 799, megabyte [â€˜megÉ™baÉªt]n. [è®¡] å…†å­—èŠ‚800, melon [â€˜melÉ™n]n. ç“œï¼›ç”œç“œï¼›å¤§è‚šå­ï¼›åœ†é¼“é¼“åƒç“œä¼¼çš„ä¸œè¥¿ n. (Melon)äººåï¼›(æ„ã€è¥¿ã€è‘¡)æ¢…éš†801, memorization [,mÉ›mÉ™rÉªâ€™zeÊƒÉ™n]n. è®°ä½ï¼›æš—è®°802, mentor [â€˜mÉ›nâ€™tÉ”r]n. æŒ‡å¯¼è€…ï¼Œè‰¯å¸ˆç›Šå‹;vt. æŒ‡å¯¼803, merchant [â€˜mÉtÊƒÉ™nt]n. å•†äººï¼Œæ‰¹å‘å•†ï¼›åº—ä¸»adj. å•†ä¸šçš„ï¼Œå•†äººçš„n. (Merchant)äººåï¼›(è‹±)éº¦é’±ç‰¹804, merry [â€˜mÉ›ri]adj. æ„‰å¿«çš„ï¼›å¾®é†‰çš„ï¼›å¬‰æˆä½œä¹çš„ n. ç”œæ¨±æ¡ƒ n. (Merry)äººåï¼›(è‹±ã€æ³•ã€è¥¿)æ¢…é‡Œ805, mesh [mÉ›Êƒ]n. ç½‘çœ¼ï¼›ç½‘ä¸ï¼›åœˆå¥—vi. ç›¸å•®åˆvt. [æœº] å•®åˆï¼›ä»¥ç½‘æ•æ‰806, mess [mes]n.æ··ä¹±ï¼›é£Ÿå ‚ï¼Œä¼™é£Ÿå›¢ï¼›å›°å¢ƒï¼›è„ä¹±çš„ä¸œè¥¿vt.å¼„ä¹±ï¼Œå¼„è„ï¼›æ¯åï¼›ä½¿å°±é¤vi.æŠŠäº‹æƒ…å¼„ç³Ÿï¼›åˆ¶é€ è„ä¹±ï¼›çŽ©å¼„n.(Mess)äººåï¼›(å¾·ã€ç½—)æ¢…æ–¯807, messy [â€˜mesÉª]adj. å‡Œä¹±çš„ï¼Œæ•£ä¹±çš„ï¼›è‚®è„çš„ï¼Œæ±¡ç§½çš„ï¼›éº»çƒ¦çš„808, metric [â€˜mÉ›trÉªk]adj. å…¬åˆ¶çš„ï¼›ç±³åˆ¶çš„ï¼›å…¬å°ºçš„n. åº¦é‡æ ‡å‡†809, metrics [â€˜mÉ›trÉªks]n. åº¦é‡ï¼›ä½œè¯—æ³•ï¼›éŸµå¾‹å­¦810, Metrics [â€˜metrÉªks]n. åº¦é‡ï¼›ä½œè¯—æ³•ï¼›éŸµå¾‹å­¦811, migrate [maÉªâ€™greÉªt; â€˜maÉªgreÉªt]vi. ç§»åŠ¨ï¼›éšå­£èŠ‚è€Œç§»å±…ï¼›ç§»å¾€vt. ä½¿ç§»å±…ï¼›ä½¿ç§»æ¤812, Migrate [maÉªâ€™greÉªt; â€˜maÉªgreÉªt]vi. ç§»åŠ¨ï¼›éšå­£èŠ‚è€Œç§»å±…ï¼›ç§»å¾€;vt. ä½¿ç§»å±…ï¼›ä½¿ç§»æ¤813, migration [maÉªâ€™greÉªÊƒ(É™)n]n. è¿ç§»ï¼›ç§»æ°‘ï¼›ç§»åŠ¨814, milestonesn. é‡Œç¨‹ç¢‘ï¼›æ—¶é—´è¡¨815, mimic [â€˜mÉªmÉªk]vt. æ¨¡ä»¿ï¼Œæ‘¹æ‹Ÿn. æ•ˆé¢¦è€…ï¼Œæ¨¡ä»¿è€…ï¼›ä»¿åˆ¶å“ï¼›å°ä¸‘adj. æ¨¡ä»¿çš„ï¼Œæ¨¡æ‹Ÿçš„ï¼›å‡è£…çš„816, mind [maÉªnd]n. ç†æ™ºï¼Œç²¾ç¥žï¼›æ„è§ï¼›æ™ºåŠ›ï¼›è®°å¿†åŠ›vt. ä»‹æ„ï¼›ä¸“å¿ƒäºŽï¼›ç…§æ–™vi. ä»‹æ„ï¼›æ³¨æ„817, minify [â€˜mÉªnÉªfaÉª]vt. ä½¿å˜å°ï¼›è´¬ä½Ž818, minor [â€˜maÉªnÉ™]adj. æœªæˆå¹´çš„ï¼›æ¬¡è¦çš„ï¼›è¾ƒå°çš„ï¼›å°è°ƒçš„ï¼›äºŒæµçš„;n. æœªæˆå¹´äººï¼›å°è°ƒï¼›å‰¯ä¿®ç§‘ç›®;vi. å‰¯ä¿®;n. (Minor)äººåï¼›(è‹±)è¿ˆçº³ï¼›(å¾·ã€æ³•ã€æ³¢ã€ä¿„)ç±³è¯ºå°”819, Misc [â€˜mÉªsk]abbr. æ··æ‚çš„ï¼›å„è‰²å„æ ·æ··åœ¨ä¸€èµ·ï¼›å¤šæ‰å¤šè‰ºçš„ï¼ˆmiscellaneousï¼‰820, miscellaneous [â€˜mÉªsÉ™â€™lenÉªÉ™s]adj. æ··æ‚çš„ï¼Œå„ç§å„æ ·çš„ï¼›å¤šæ–¹é¢çš„ï¼Œå¤šæ‰å¤šè‰ºçš„821, misconception [mÉªskÉ™nâ€™sepÊƒ(É™)n]n. è¯¯è§£ï¼›é”™è§‰ï¼›é”™è¯¯æƒ³æ³•822, misfire [â€˜mÉªsâ€™faÉªr]vi. å¤±è´¥ï¼›ä¸å‘ç«n. å¤±è´¥ï¼›ä¸å‘ç«823, mitigated [â€˜mÉªtÉªgeÉªt]vt. ä½¿ç¼“å’Œï¼Œä½¿å‡è½» vi. å‡è½»ï¼Œç¼“å’Œä¸‹æ¥824, mitigation [mÉªtÉªâ€™geÉªÊƒ(É™)n]n. å‡è½»ï¼›ç¼“å’Œï¼›å¹³é™825, mix [mÉªks]vt. é…åˆ¶ï¼›æ··æ·†ï¼›ä½¿æ··å’Œï¼›ä½¿ç»“äº¤vi. å‚ä¸Žï¼›ç›¸æ··åˆï¼›äº¤å¾€n. æ··åˆï¼›æ··åˆç‰©ï¼›æ··ä¹±n. (Mix)äººåï¼›(å¾·ã€è‹±)ç±³å…‹æ–¯826, mock [mÉ’k]n. è‹±å›½æ¨¡æ‹Ÿè€ƒè¯•ï¼ˆmocksï¼‰vt. æ„šå¼„ï¼Œå˜²å¼„adj. ä»¿åˆ¶çš„ï¼Œæ¨¡æ‹Ÿçš„ï¼Œè™šå‡çš„ï¼Œä¸è¯šå®žçš„vt. ä¸å°Šé‡ï¼Œè”‘è§†827, Modal [â€˜mÉ™ÊŠd(É™)l]adj. æ¨¡å¼çš„ï¼›æƒ…æ€çš„ï¼›å½¢å¼çš„;n. èŽ«ä»£å°”ï¼ˆä¸€ç§æ–°åž‹çº¤ç»´ç´ çº¤ç»´ï¼‰828, Mon amour []æˆ‘çš„çˆ±829, monial [â€˜mÉ™uniÉ™l]n.ç«–æ¡†ï¼ˆç­‰äºŽmullionï¼‰830, monolith [â€˜mÉ’n(É™)lÉªÎ¸]n. æ•´å—çŸ³æ–™ï¼›åºžç„¶å¤§ç‰©831, monolithic [mÉ’nÉ™â€™lÉªÎ¸Éªk]adj. æ•´ä½“çš„ï¼›å·¨çŸ³çš„ï¼Œåºžå¤§çš„ï¼›å®Œå…¨ç»Ÿä¸€çš„ n. å•å—é›†æˆç”µè·¯ï¼Œå•ç‰‡ç”µè·¯832, monopolize [mÉ™â€™nÉ‘pÉ™â€™laÉªz]vt. åž„æ–­ï¼›ç‹¬å ï¼›æ‹¥æœ‰â€¦çš„ä¸“å–æƒ833, monotonically [mÉ’nÉ™â€™tÉ’nÉªklÉª]adv. å•è°ƒåœ°834, monotonicity [,mÉ”nÉ™tÉ™â€™nisÉ™ti]n. [æ•°] å•è°ƒæ€§835, mood [muËd]n. æƒ…ç»ªï¼Œè¯­æ°”ï¼›å¿ƒå¢ƒï¼›æ°”æ°›;n. (Mood)äººåï¼›(è‹±)ç©†å¾·ï¼›(ç‘žå…¸)èŽ«å¾·836, Moreover [mÉ”Ërâ€™É™ÊŠvÉ™]adv. è€Œä¸”ï¼›æ­¤å¤–837, mount [maÊŠnt]vt. å¢žåŠ ï¼›çˆ¬ä¸Šï¼›ä½¿éª‘ä¸Šé©¬ï¼›å®‰è£…ï¼Œæž¶ç½®ï¼›é•¶åµŒï¼ŒåµŒå…¥ï¼›å‡†å¤‡ä¸Šæ¼”ï¼›æˆç«‹ï¼ˆå†›é˜Ÿç­‰ï¼‰;vi. çˆ¬ï¼›å¢žåŠ ï¼›ä¸Šå‡;n. å±±å³°ï¼›åº•åº§ï¼›ä¹˜éª‘ç”¨é©¬ï¼›æ”€ï¼Œç™»ï¼›è¿è½½å·¥å…·ï¼›åº•åº§;n. ï¼ˆè‹±ï¼‰èŠ’ç‰¹ï¼ˆäººåï¼‰;v. ç™»ä¸Šï¼›éª‘ä¸Š838, mprotect 839, mule [mjuËl]n. éª¡ï¼›å€”å¼ºä¹‹äººï¼Œé¡½å›ºçš„äººï¼›æ‚äº¤ç§åŠ¨ç‰©;n. (Mule)äººåï¼›(æ„)ç©†èŽ±ï¼›(è‹±)ç±³å°”840, multiplexer [â€˜mÊŒltÉª,plÉ›ksÉš]n. [è®¡][é€šä¿¡] å¤šå·¥å™¨ï¼›å¤šè·¯å™¨ï¼›[é€šä¿¡] å¤šè·¯è½¬æŽ¥å™¨841, multiplicity [,mÊŒltÉªâ€™plÉªsÉ™ti]n. å¤šæ ·æ€§ï¼›[ç‰©] å¤šé‡æ€§842, mutable [â€˜mjutÉ™bl]adj. æ˜“å˜çš„ï¼Œä¸å®šçš„ï¼›æ€§æƒ…ä¸å®šçš„843, mutate [â€˜mjutet]vi. å˜åŒ–ï¼Œäº§ç”Ÿçªå˜vt. æ”¹å˜ï¼Œä½¿çªå˜844, mutative [â€˜mjuËtÉ™tÉªv]adj. å˜åŒ–çš„ï¼›ç”Ÿç‰©çªå˜çš„845, mutator [â€˜mju:teitÉ™]n. å¢žå˜åŸºå› 846, mute [mjuËt]adj. å“‘çš„ï¼›æ²‰é»˜çš„ï¼›æ— å£°çš„;vt. å‡å¼±â€¦â€¦çš„å£°éŸ³ï¼›ä½¿â€¦â€¦æŸ”å’Œ;n. å“‘å·´ï¼›å¼±éŸ³å™¨ï¼›é—­é”éŸ³;n. (Mute)äººåï¼›(å¡ž)ç©†ç‰¹847, mutex []n. äº’æ–¥ï¼›äº’æ–¥å…ƒï¼Œäº’æ–¥ä½“ï¼›äº’æ–¥é‡848, mutual [â€˜mjutÊƒuÉ™l]adj. å…±åŒçš„ï¼›ç›¸äº’çš„ï¼Œå½¼æ­¤çš„849, mutually [ËˆmjuËtÊƒuÉ™li]adv. äº’ç›¸åœ°ï¼›äº’åŠ©850, negate [nÉªâ€™geÉªt]vt. å¦å®šï¼›å–æ¶ˆï¼›ä½¿æ— æ•ˆ;vi. å¦å®šï¼›å¦è®¤ï¼›æ— æ•ˆ;n. å¯¹ç«‹é¢ï¼›åé¢851, negligible [â€˜neglÉªdÊ’Éªb(É™)l]adj. å¾®ä¸è¶³é“çš„ï¼Œå¯ä»¥å¿½ç•¥çš„852, Negotiate [nÉªâ€™gÉ™ÊŠÊƒÉªeÉªt]vt. è°ˆåˆ¤ï¼Œå•†è®®ï¼›è½¬è®©ï¼›è¶Šè¿‡;vi. è°ˆåˆ¤ï¼Œäº¤æ¶‰853, nest [nest]n. å·¢ï¼Œçªï¼›å®‰ä¹çªï¼›æ¸©åºŠ;vt. ç­‘å·¢ï¼›åµŒå¥—;vi. ç­‘å·¢ï¼›æ‰¾é¸Ÿå·¢;n. (Nest)äººåï¼›(å¾·)å†…ä¸ç‰¹ï¼›(è‹±)å†…ä¸ç‰¹(å¥³å­æ•™å Agnes å¨å°”å£«è¯­çš„æ˜µç§°)854, newbie [â€˜njuËbÉª]n. ç½‘ç»œæ–°æ‰‹ï¼›æ–°å…µ855, nick [nÉªk]vt. åˆ»ç—•äºŽï¼›æŒ‘æ¯›ç—…ï¼›ç”¨åˆ»ç—•è®° n. åˆ»ç—•ï¼›ç¼ºå£ vi. åˆ»ç—•ï¼›ç‹™å‡»856, nimbus [â€˜nÉªmbÉ™s]n. ï¼ˆäººå’Œç‰©äº§ç”Ÿçš„ï¼‰çµæ°”ï¼›å…‰è½®ï¼›[æ°”è±¡] é›¨äº‘ï¼›å…‰è¾‰ç¿çƒ‚çš„æ°”æ°›857, noisy [ËˆnÉ”ÉªzÉª]adj. å˜ˆæ‚çš„ï¼›å–§é—¹çš„ï¼›è’å™ªçš„n. å“å£°ï¼›å˜ˆæ‚å£°858, nonce [nÉ’ns]n. ç›®å‰ï¼›ç‰¹å®šåœºåˆï¼›å¼ºå¥¸çŠ¯ adj. ä¸´æ—¶çš„ï¼›ç‰¹å®šåœºåˆçš„859, nope [nÉ™ÊŠp]adv. ä¸æ˜¯ï¼Œæ²¡æœ‰ï¼›ä¸860, norm [nÉ”rm]n. æ ‡å‡†ï¼Œè§„èŒƒ861, notably [â€˜notÉ™bli]adv. æ˜¾è‘—åœ°ï¼›å°¤å…¶862, notation [noâ€™teÊƒÉ™n]n. ç¬¦å·ï¼›ä¹è°±ï¼›æ³¨é‡Šï¼›è®°å·æ³•863, Notation [nÉ™ÊŠâ€™teÉªÊƒ(É™)n]n. ç¬¦å·ï¼›ä¹è°±ï¼›æ³¨é‡Šï¼›è®°å·æ³•864, noticeable [â€˜nÉ™ÊŠtÉªsÉ™b(É™)l]adj. æ˜¾è€Œæ˜“è§çš„ï¼Œæ˜¾è‘—çš„ï¼›å€¼å¾—æ³¨æ„çš„865, notoriously [noËˆtÉ”ËriÉ™sli]adv. ä¼—æ‰€å‘¨çŸ¥åœ°ï¼›å£°åç‹¼è—‰åœ°ï¼›æ¶åæ˜­å½°åœ°866, noverflow 867, obey [É™â€™be]vt. æœä»Žï¼Œå¬ä»Žï¼›æŒ‰ç…§â€¦â€¦è¡ŒåŠ¨vi. æœä»Žï¼Œé¡ºä»Žï¼›å¬è¯n. (Obey)äººåï¼›(è‹±ã€æ³•)å¥¥è´868, obligation [,É‘blÉªâ€™É¡eÊƒÉ™n]n. ä¹‰åŠ¡ï¼›èŒè´£ï¼›å€ºåŠ¡869, observer [É™bâ€™zÉœËvÉ™]n. è§‚å¯Ÿè€…ï¼›[å¤©] è§‚æµ‹è€…ï¼›éµå®ˆè€…870, obsession [É™bâ€™seÊƒ(É™)n]n. ç—´è¿·ï¼›å›°æ‰°ï¼›[å†…ç§‘][å¿ƒç†] å¼ºè¿«è§‚å¿µ871, obtain [É™bâ€™teÉªn]vi. èŽ·å¾—ï¼›æµè¡Œ;vt. èŽ·å¾—872, obtuse [É™bâ€™tjuËs]adj. è¿Ÿé’çš„ï¼›åœ†å¤´çš„ï¼›ä¸é”‹åˆ©çš„873, occupied [â€˜É’kjÊŠpaÉªd]adj. å·²å ç”¨çš„ï¼›ä½¿ç”¨ä¸­çš„ï¼›æ— ç©ºé—²çš„v. å æœ‰ï¼ˆoccupyçš„è¿‡åŽ»åˆ†è¯ï¼‰874, occurrence [É™â€™kÊŒr(É™)ns]n. å‘ç”Ÿï¼›å‡ºçŽ°ï¼›äº‹ä»¶ï¼›å‘çŽ°875, odevity [odevity]å¥‡å¶æ€§876, offloading []n. å¸è½½ï¼›å¸è´§;vt. å¸è½½ï¼ˆoffloadçš„çŽ°åœ¨åˆ†è¯å½¢å¼ï¼‰877, omit [É™(ÊŠ)â€™mÉªt]vt. çœç•¥ï¼›é—æ¼ï¼›åˆ é™¤ï¼›ç–å¿½878, Onboardingadv. åœ¨èˆ¹ä¸Šï¼›åœ¨é£žæœºä¸Šï¼›åœ¨æ¿ä¸Šadj. éšè½¦æºå¸¦çš„879, onset [â€˜É‘nsÉ›t]n. å¼€å§‹ï¼Œç€æ‰‹ï¼›å‘ä½œï¼›æ”»å‡»ï¼Œè¿›æ”»880, onwards [â€˜É’nwÉ™dz]adv. å‘å‰ï¼›åœ¨å‰é¢881, opaque [oâ€™pek]adj. ä¸é€æ˜Žçš„ï¼›ä¸ä¼ çƒ­çš„ï¼›è¿Ÿé’çš„n. ä¸é€æ˜Žç‰©vt. ä½¿ä¸é€æ˜Žï¼›ä½¿ä¸åå…‰882, opinion [É™â€™pÉªnjÉ™n]n. æ„è§ï¼›ä¸»å¼ 883, opinionated [É™â€™pÉªnjÉ™netÉªd]adj. å›ºæ‰§å·±è§çš„ï¼›æ­¦æ–­çš„884, optimized [â€˜É’ptÉªmaÉªzd]adj. æœ€ä½³åŒ–çš„ï¼›å°½é‡å……åˆ†åˆ©ç”¨885, optimizer [â€˜É’ptÉªmaÉªzÉ™]n. [è®¡] ä¼˜åŒ–ç¨‹åºï¼›æœ€ä¼˜æŽ§åˆ¶å™¨886, orchestratingç²¾å¿ƒç­–åˆ’ ç»™ â€¦ é…ç®¡å¼¦ä¹æ›² ä½¿åè°ƒåœ°ç»“åˆåœ¨ä¸€èµ·887, orchestration [,É”kÉ›sâ€™treÊƒÉ™n]n. ç®¡å¼¦ä¹ç¼–æ›²ï¼›å’Œè°çš„ç»“åˆ888, orchestratorn. ç®¡å¼¦ä¹æ¼”å¥å®¶ï¼›ç®¡å¼¦ä¹ç¼–æ›²å®¶889, ordinarily [â€˜É”Ëd(É™),n(É™)rÉªlÉª; ,É”ËdÉªâ€™nerÉªlÉª]adv. é€šå¸¸åœ°ï¼›ä¸€èˆ¬åœ°890, Oriented [â€˜É”ËrÉªentÉªd]adj. å¯¼å‘çš„ï¼›å®šå‘çš„ï¼›ä»¥â€¦ä¸ºæ–¹å‘çš„;v. è°ƒæ•´ï¼›ä½¿æœå‘ï¼ˆorientçš„è¿‡åŽ»åˆ†è¯ï¼‰ï¼›ç¡®å®šâ€¦çš„æ–¹ä½891, orphans [â€˜É”rfÉ™n]n. å­¤å„¿ï¼ˆorphançš„å¤æ•°ï¼‰v. æˆä¸ºå­¤å„¿ï¼ˆorphançš„ä¸‰å•å½¢å¼ï¼‰892, outage [â€˜aÊŠtÉªdÊ’]n. å‚¨è¿æŸè€—ï¼›ä¸­æ–­ä¾›åº”ï¼›è¿è¡Œä¸­æ–­893, outgoing [â€˜aÊŠtgÉ™ÊŠÉªÅ‹]adj. å¯¹äººå‹å¥½çš„ï¼Œå¼€æœ—çš„ï¼›å‡ºå‘çš„ï¼Œå¤–å‡ºçš„ï¼›å³å°†ç¦»èŒçš„ï¼›ä¹äºŽåŠ©äººçš„;n. å¤–å‡ºï¼›æµå‡ºï¼›å¼€æ”¯;v. è¶…è¿‡ï¼›ä¼˜äºŽï¼ˆoutgoçš„ingå½¢å¼ï¼‰894, outnumber [aÊŠtâ€™nÊŒmbÉ™]vt. æ•°ç›®è¶…è¿‡ï¼›æ¯”â€¦å¤š895, outright [â€˜aÊŠtraÉªt]adv. å…¨éƒ¨åœ°ï¼›ç«‹åˆ»åœ°ï¼›çŽ‡ç›´åœ°ï¼›ä¸€ç›´å‘å‰ï¼›ç—›å¿«åœ°adj. å®Œå…¨çš„ï¼Œå½»åº•çš„ï¼›ç›´çŽ‡çš„ï¼›æ€»å…±çš„896, outstanding [aÊŠtâ€™stÃ¦ndÉªÅ‹]adj. æ°å‡ºçš„ï¼›æ˜¾è‘—çš„ï¼›æœªè§£å†³çš„ï¼›æœªå¿ä»˜çš„;n. æœªå¿è´·æ¬¾897, overlap [É™ÊŠvÉ™â€™lÃ¦p]n. é‡å ï¼›é‡å¤ vi. éƒ¨åˆ†é‡å ï¼›éƒ¨åˆ†çš„åŒæ—¶å‘ç”Ÿ vt. ä¸Žâ€¦é‡å ï¼›ä¸Žâ€¦åŒæ—¶å‘ç”Ÿ898, overlay [â€˜ovÉ™lÉ›i]n. è¦†ç›–å›¾ï¼›è¦†ç›–ç‰©vt. åœ¨è¡¨é¢ä¸Šé“ºä¸€è–„å±‚ï¼Œé•€899, overpopulate [É™ÊŠvÉ™â€™pÉ’pjÊŠleÉªt]vt. ä½¿äººå£è¿‡å‰©ï¼›ä½¿äººå£è¿‡å¯†900, overwhelm [ovÉšËˆhwÉ›lm]vt. æ·¹æ²¡ï¼›åŽ‹å€’ï¼›å—æ‰“å‡»ï¼›è¦†ç›–ï¼›åŽ‹åž®901, pacesetter [â€˜pessÉ›tÉš]n. æ ‡å…µï¼›å…ˆå¯¼è€…ï¼Œæ­¥è°ƒè°ƒæ•´è€…902, pad [pÃ¦d]n. è¡¬åž«ï¼›æŠ¤å…·ï¼›ä¾¿ç¬ºç°¿ï¼›å¡«è¡¥vi. æ­¥è¡Œï¼›æ”¾è½»è„šæ­¥èµ°vt. å¡«è¡¥ï¼›èµ°n. (Pad)äººåï¼›(è‹±)å¸•å¾·(ç”·å­æ•™å Patrick çš„æ˜µç§°)903, padding [â€˜pÃ¦dÉªÅ‹]n. å¡«æ–™ï¼›åž«æ–™;v. å¡«è¡¥ï¼ˆpadçš„ingå½¢å¼ï¼‰904, paddle [â€˜pÃ¦dl]n. åˆ’æ¡¨ï¼›æ˜Žè½®ç¿¼vt. æ‹Œï¼›æ…ï¼›ç”¨æ¡¨åˆ’vi. åˆ’æ¡¨ï¼›æˆæ°´ï¼›æ¶‰æ°´905, padlock [â€˜pÃ¦dlÉ’k]n. æŒ‚é”ï¼›å…³é—­ï¼›ç¦æ­¢è¿›å…¥;vt. ç”¨æŒ‚é”é”ä¸Šï¼›å…³é—­906, Page Viewè®¿é—®é‡907, Pagination [,pÃ¦dÊ’Éªâ€™neÉªÊƒ(É™)n]n. æ ‡è®°é¡µæ•°ï¼›é¡µç 908, painful [â€˜penfl]adj. ç—›è‹¦çš„ï¼›ç–¼ç—›çš„ï¼›ä»¤äººä¸å¿«çš„909, palette [â€˜pÃ¦lÉ™t]n. è°ƒè‰²æ¿ï¼›é¢œæ–™n. (Palette)äººåï¼›(æ³•)å¸•èŽ±ç‰¹910, pampas [â€˜pÃ¦mpÉ™s]n. è‰åŽŸï¼›è’²è‹‡ï¼ˆpampaçš„å¤æ•°å½¢å¼ï¼‰n. (Pampas)äººåï¼›(ç‘žå…¸)æ½˜å¸•æ–¯911, pan [ç¾Ž/pÃ¦n/]n. å¹³åº•é”…ï¼›ç›˜çŠ¶çš„å™¨çš¿ï¼›æ·˜ç›˜å­ï¼Œé‡‘ç›˜ï¼Œç§¤ç›˜;vt. æ·˜é‡‘ï¼›åœ¨æµ…é”…ä¸­çƒ¹è°ƒï¼ˆé£Ÿç‰©ï¼‰ï¼›[éžæ­£å¼ç”¨è¯­]ä¸¥åŽ‰çš„æ‰¹è¯„;vi. æ·˜é‡‘ï¼›åœ¨æ·˜æ´—ä¸­æ”¶èŽ·é‡‘å­;912, pane [peÉªn]n. çª—æ ¼ï¼›è¾¹ï¼›é¢ï¼›çª—æ ¼çŽ»ç’ƒï¼›åµŒæ¿;vt. è£…çª—çŽ»ç’ƒäºŽï¼›é•¶åµŒæ¿äºŽ;n. (Pane)äººåï¼›(è€)ç­ï¼›(è‹±)æ½˜æ©ï¼›(å¾·ã€è¥¿ã€æ„ã€å¡žã€å°å°¼)å¸•å†…913, panic [â€˜pÃ¦nÉªk]n. ææ…Œï¼ŒæƒŠæ…Œï¼›å¤§ææ…Œ;adj. ææ…Œçš„ï¼›æ²¡æœ‰ç†ç”±çš„;vt. ä½¿ææ…Œ;vi. ååˆ†æƒŠæ…Œ;n. (Panic)äººåï¼›(ç½—)å¸•å°¼å…‹914, paradise [â€˜pÃ¦rÉ™daÉªs]n. å¤©å ‚è‡³ç¦å¢ƒåœ°915, Paradise [â€˜pÃ¦rÉ™daÉªs]n. å¤©å ‚;è‡³ç¦å¢ƒåœ°916, paramount [â€˜pÃ¦rÉ™maÊŠnt]adj. æœ€é‡è¦çš„ï¼Œä¸»è¦çš„ï¼›è‡³é«˜æ— ä¸Šçš„ n. æœ€é«˜ç»Ÿæ²»è€…917, parasitic [,pÃ¦rÉ™â€™sÉªtÉªk]adj. å¯„ç”Ÿçš„ï¼ˆç­‰äºŽparasiticalï¼‰918, parentheses [pÉ™â€™rÉ›nÎ¸É™sÉªz]n. parenthesisçš„å¤æ•°å½¢å¼919, parenthesis [pÉ™â€™rÉ›nÎ¸É™sÉªs]n. æ’å…¥è¯­,æ’å…¥æˆåˆ†n. åœ†æ‹¬å·n. é—´æ­‡ï¼Œæ’æ›²920, parlance [â€˜pÉ‘Ël(É™)ns]n. è¯´æ³•ï¼›ç”¨è¯­ï¼›è¯­è°ƒï¼›å‘è¨€921, participant [pÉ‘Ëâ€™tÉªsÉªp(É™)nt]n. å‚ä¸Žè€…ï¼›å…³ç³»è€…adj. å‚ä¸Žçš„ï¼›æœ‰å…³ç³»çš„922, passenger [â€˜pÃ¦sÉªndÊ’É™]n. æ—…å®¢ï¼›ä¹˜å®¢ï¼›è¿‡è·¯äººï¼›ç¢æ‰‹ç¢è„šçš„äºº923, passive [â€˜pÃ¦sÉªv]adj. è¢«åŠ¨çš„ï¼Œæ¶ˆæžçš„ï¼›è¢«åŠ¨è¯­æ€çš„ n. è¢«åŠ¨è¯­æ€924, passphrase [passphrase]n. å¯†ç ï¼›é€šè¡Œç ï¼›å£ä»¤çŸ­è¯­925, peculiar [pÉªâ€™kjulÉªÉš]adj. ç‰¹æ®Šçš„ï¼›ç‹¬ç‰¹çš„ï¼›å¥‡æ€ªçš„ï¼›ç½•è§çš„n. ç‰¹æƒï¼›ç‰¹æœ‰è´¢äº§926, peek [pik]n. å·çœ‹ï¼›ä¸€çž¥ï¼Œçœ‹ä¸€çœ¼vi. çª¥è§†ï¼Œå·çœ‹n. (Peek)äººåï¼›(è‹±)çš®å…‹927, peer [pÉªÉ™]n. è´µæ—ï¼›åŒç­‰çš„äººï¼›åŒé¾„äºº vi. å‡è§†ï¼Œç›¯ç€çœ‹ï¼›çª¥è§† vt. å°ä¸ºè´µæ—ï¼›ä¸Žâ€¦åŒç­‰ n. (Peer)äººåï¼›(è‹±ã€å·´åŸº)çš®å°”928, pending [â€˜pendÉªÅ‹]adj. æœªå†³å®šçš„ï¼›è¡Œå°†å‘ç”Ÿçš„;prep. åœ¨â€¦æœŸé—´ï¼›ç›´åˆ°â€¦æ—¶ä¸ºæ­¢ï¼›åœ¨ç­‰å¾…â€¦ä¹‹é™…;v. å¾…å®šï¼›æ‚¬è€Œä¸å†³ï¼ˆpendçš„ingå½¢å¼ï¼‰;n. (Pending)äººåï¼›(ç‘žå…¸)å½­ä¸929, Pending [] 930, percentile [pÉšâ€™sÉ›ntaÉªl]adj. ç™¾åˆ†çŽ‡çš„ï¼›æŒ‰ç™¾ç­‰åˆ†æŽ’åˆ—çš„n. ç™¾åˆ†ä½931, percolate [â€˜pÉœËkÉ™leÉªt]vi. è¿‡æ»¤ï¼›æ¸—å‡ºï¼›æµ¸é€ vt. ä½¿æ¸—å‡ºï¼›ä½¿è¿‡æ»¤ n. æ»¤è¿‡æ¶²ï¼›æ¸—å‡ºæ¶²932, percolator [â€˜pÉœËkÉ™leÉªtÉ™]n. è¿‡æ»¤å™¨ï¼›æ¸—æ»¤å™¨ï¼›å’–å•¡æ¸—æ»¤å£¶933, perform [pÉ™â€™fÉ”Ëm]vt. æ‰§è¡Œï¼›å®Œæˆï¼›æ¼”å¥vi. æ‰§è¡Œï¼Œæœºå™¨è¿è½¬ï¼›è¡¨æ¼”perform: æ‰§è¡Œ è¡¨æ¼” å±¥è¡Œ934, Perform [pÉ™â€™fÉ”Ëm]vt. æ‰§è¡Œï¼›å®Œæˆï¼›æ¼”å¥;vi. æ‰§è¡Œï¼Œæœºå™¨è¿è½¬ï¼›è¡¨æ¼”935, performance [pÉ™â€™fÉ”Ëm(É™)ns]n. æ€§èƒ½ï¼›ç»©æ•ˆï¼›è¡¨æ¼”ï¼›æ‰§è¡Œ936, performing [pÉ™â€™fÉ”ËmÉªÅ‹]v. è¡¨æ¼”ï¼ˆperformçš„ingå½¢å¼ï¼‰ï¼›å±¥è¡Œadj. è¡¨æ¼”çš„ï¼›å±¥è¡Œçš„performing: æ‰§è¡Œ è¡¨æ¼”æ€§ è¡¨çŽ°937, period [â€˜pÉªÉ™rÉªÉ™d]n. å‘¨æœŸï¼ŒæœŸé—´ï¼›æ—¶æœŸï¼›æœˆç»ï¼›è¯¾æ—¶ï¼›ï¼ˆè¯­æ³•å­¦ï¼‰å¥ç‚¹ï¼Œå¥å· adj. æŸä¸€æ—¶ä»£çš„938, periodic [,pÉªÉ™rÉªâ€™É’dÉªk]adj. å‘¨æœŸçš„ï¼›å®šæœŸçš„939, periodically [pÉªrÉªËˆÉ‘dÉªklÉª]adv. å®šæœŸåœ°ï¼›å‘¨æœŸæ€§åœ°ï¼›å¶å°”ï¼›é—´æ­‡940, peripheral [pÉ™â€™rÉªfÉ™rÉ™l]adj. å¤–å›´çš„ï¼›æ¬¡è¦çš„ï¼›ï¼ˆç¥žç»ï¼‰æœ«æ¢¢åŒºåŸŸçš„n. å¤–éƒ¨è®¾å¤‡941, permanent [â€˜pÉœËm(É™)nÉ™nt]adj.æ°¸ä¹…çš„ï¼Œæ°¸æ’çš„ï¼›ä¸å˜çš„n.çƒ«å‘ï¼ˆç­‰äºŽpermanent waveï¼‰942, permission [pÉ™â€™mÉªÊƒ(É™)n]n. å…è®¸ï¼Œè®¸å¯943, Permission [pÉ™â€™mÉªÊƒ(É™)n]n. å…è®¸ï¼Œè®¸å¯944, permutation [â€˜pÉmjÊŠâ€™teÊƒÉ™n]n. [æ•°] æŽ’åˆ—ï¼›[æ•°] ç½®æ¢945, perpetual [pÉšâ€™pÉ›tÊƒuÉ™l]adj. æ°¸ä¹…çš„ï¼›ä¸æ–­çš„ï¼›å››å­£å¼€èŠ±çš„ï¼›æ— æœŸé™çš„946, personality [pÉœËsÉ™â€™nÃ¦lÉªtÉª]n. ä¸ªæ€§ï¼›å“æ ¼ï¼›åäºº947, perspective [pÉ™â€™spektÉªv]n. è§‚ç‚¹ï¼›è¿œæ™¯ï¼›é€è§†å›¾;adj. é€è§†çš„948, pertain [pÉ™â€™teÉªn]vi. å±žäºŽï¼›å…³äºŽï¼›é€‚åˆ949, phantom [â€˜fÃ¦ntÉ™m]n. å¹½çµï¼›å¹»å½±ï¼›è™šä½ adj. å¹½çµçš„ï¼›å¹»è§‰çš„ï¼›æœ‰åæ— å®žçš„950, Phantom [â€˜fÃ¦ntÉ™m]n. å¹½çµï¼›å¹»å½±ï¼›è™šä½;adj. å¹½çµçš„ï¼›å¹»è§‰çš„ï¼›æœ‰åæ— å®žçš„951, phase [feÉªz]n. ç›¸ï¼›é˜¶æ®µï¼›[å¤©] ä½ç›¸;vt. ä½¿å®šç›¸ï¼›é€æ­¥æ‰§è¡Œ;vi. é€æ­¥å‰è¿›952, phases [â€˜feÉªsiËz]n. é˜¶æ®µï¼Œæ—¶æœŸï¼ˆphaseçš„å¤æ•°å½¢å¼ï¼‰;v. é€æ­¥å®žè¡Œï¼ˆphaseçš„ä¸‰å•å½¢å¼ï¼‰953, philosophies [fÉªâ€™lÉ’sÉ™fÉª]n. å“²å­¦ï¼›å“²ç†ï¼›äººç”Ÿè§‚954, phrase [frez]n. çŸ­è¯­, ä¹ è¯­, æŽªè¾ž, ä¹å¥vt. æŽªè¯, å°†(ä¹æ›²)åˆ†æˆä¹å¥955, PHRASE [freÉªz]n. çŸ­è¯­, ä¹ è¯­, æŽªè¾ž, ä¹å¥;vt. æŽªè¯, å°†(ä¹æ›²)åˆ†æˆä¹å¥956, pier [pÉªr]n. ç å¤´ï¼Œç›´ç å¤´ï¼›æ¡¥å¢©ï¼›çª—é—´å£n. (Pier)äººåï¼›(è‹±ã€å¾·)çš®å°”ï¼›(è¥¿)å½¼å°”ï¼›(æ„)çš®è€¶å°”957, piggyback [â€˜pÉªÉ¡ÉªbÃ¦k]adj. èƒŒç€çš„ï¼›[èˆª] åœ¨èƒŒè‚©ä¸Šçš„adv. åœ¨èƒŒè‚©ä¸Šn. è‚©æ‰›ï¼›èƒŒè´Ÿå¼è¿è¾“vt. èƒŒè´Ÿå¼è£…è¿958, pilot [kÉ™â€™lekt]vt. æ”¶é›†ï¼›å‹Ÿævi. æ”¶é›†ï¼›èšé›†ï¼›å‹Ÿæadv. ç”±æ”¶ä»¶äººä»˜æ¬¾åœ°adj. ç”±æ”¶ä»¶äººä»˜æ¬¾çš„n. (Collect)äººåï¼›(è‹±)ç§‘èŽ±å…‹ç‰¹959, pin [pÉªn]n. å¤§å¤´é’ˆï¼Œåˆ«é’ˆï¼Œé’ˆï¼›æ “ï¼›çç¢Žç‰©vt. é’‰ä½ï¼›åŽ‹ä½ï¼›å°†â€¦â€¦ç”¨é’ˆåˆ«ä½960, pinned [â€˜pind]adj. ç”¨é’ˆåˆ«ä½çš„ï¼›è¢«åŽ‹åˆ¶çš„v. ç‰µåˆ¶ï¼›ç”¨é’ˆåˆ«ä½ï¼›åˆºç©¿ï¼ˆpinçš„è¿‡åŽ»åˆ†è¯ï¼‰961, pipeline [â€˜paÉªplaÉªn]n. ç®¡é“ï¼›è¾“æ²¹ç®¡ï¼›ä¼ é€’é€”å¾„è¿‡åŽ»å¼:pipelined; è¿‡åŽ»åˆ†è¯:pipelined; çŽ°åœ¨åˆ†è¯:pipelining962, placement [â€˜pleÉªsmÉ™nt]n. å¸ƒç½®ï¼›å®šä½çƒï¼›äººå‘˜é…ç½®963, plain [plen]adj. å¹³çš„ï¼›ç®€å•çš„ï¼›æœ´ç´ çš„ï¼›æ¸…æ™°çš„n. å¹³åŽŸï¼›æ— æ ¼å¼ï¼›æœ´å®žæ— åŽçš„ä¸œè¥¿adv. æ¸…æ¥šåœ°ï¼›å¹³æ˜“åœ°n. (Plain)äººåï¼›(è‹±)æ™®èŽ±æ©ï¼›(æ³•)æ™®å…°964, planet [â€˜plÃ¦nÉªt]n. è¡Œæ˜Ÿn. (Planet)äººåï¼›(æ³•)æ™®æ‹‰å†…ï¼›(è¥¿ã€è‘¡)æ™®æ‹‰å†…ç‰¹965, Plastic [â€˜plÃ¦stÉªk]adj. å¡‘æ–™çš„ï¼›ï¼ˆå¤–ç§‘ï¼‰é€ åž‹çš„ï¼›å¯å¡‘çš„n. å¡‘æ–™åˆ¶å“ï¼›æ•´å½¢ï¼›å¯å¡‘ä½“966, plenty [â€˜plentÉª]n. ä¸°å¯Œï¼Œå¤§é‡ï¼›å……è¶³;adj. è¶³å¤Ÿçš„ï¼Œå¾ˆå¤šçš„;adv. è¶³å¤Ÿ;n. (Plenty)äººåï¼›(è‹±)æ™®ä¼¦è’‚967, plot [plÉ‘t]n. æƒ…èŠ‚ï¼›å›¾ï¼›é˜´è°‹vt. å¯†è°‹ï¼›ç»˜å›¾ï¼›åˆ’åˆ†ï¼›æ ‡ç»˜vi. å¯†è°‹ï¼›ç­–åˆ’ï¼›ç»˜åˆ¶n. (Plot)äººåï¼›(æ·)æ™®æ´›ç‰¹ï¼›(æ³•)æ™®æ´›968, plotted [plotted]adj. æ ‡ç»˜çš„v. ç­–åˆ’ï¼ˆplotçš„è¿‡åŽ»åˆ†è¯ï¼‰ï¼›åˆ’åˆ†ï¼›ç»˜åˆ¶â€¦çš„åœ°å›¾969, plug [plÊŒg]n. æ’å¤´ï¼›å¡žå­ï¼›æ “;vi. å¡žä½ï¼›ç”¨æ’å¤´å°†ä¸Žç”µæºæŽ¥é€š;vt. æ’å…¥ï¼›å¡žä½ï¼›æŽ¥æ’å¤´970, plug in []æ’å…¥ï¼›æ’ä¸Šç”µæº971, pluggable [plÊŒgÉ™bl]adj. æ’æŽ¥å¼è¿žæŽ¥ï¼Œ[ç”µ] å¯æ’çš„972, Pluggable [plÊŒgÉ™bl]adj. æ’æŽ¥å¼è¿žæŽ¥ï¼Œ[ç”µ] å¯æ’çš„973, Plugin [plÊŒgÉªn]n. æ’ä»¶ï¼›ç›¸å…³æ’ä»¶;n. (Plugin)äººåï¼›(ä¿„)æ™®å¢é‡‘974, plural [â€˜plÊŠrÉ™l]adj. å¤æ•°çš„n. å¤æ•°975, poet [â€˜pÉ™ÊŠÉªt]n. è¯—äºº976, poetry [â€˜pÉ™ÊŠÉªtrÉª]n. è¯—ï¼›è¯—æ„ï¼Œè¯—æƒ…ï¼›è¯—æ­Œè‰ºæœ¯977, poison [â€˜pÉ”Éªzn]vt. æ±¡æŸ“ï¼›ä½¿ä¸­æ¯’ï¼Œæ”¾æ¯’äºŽï¼›è´¥åï¼›é˜»ç¢vi. æ”¾æ¯’ï¼Œä¸‹æ¯’n. æ¯’è¯ï¼Œæ¯’ç‰©ï¼›é…’ï¼›æœ‰æ¯’å®³çš„äº‹ç‰©ï¼›[åŠ©å‰‚] æŠ‘åˆ¶å‰‚adj. æœ‰æ¯’çš„n. (Poison)äººåï¼›(è¥¿)æ³¢ä¼Šæ¾978, polar [â€˜pÉ™ÊŠlÉ™]adj. æžåœ°çš„ï¼›ä¸¤æžçš„ï¼›æ­£å¥½ç›¸åçš„ n. æžé¢ï¼›æžçº¿ n. (Polar)äººåï¼›(å¾·ã€è¥¿)æ³¢æ‹‰å°”979, pollution [pÉ™â€™luÊƒÉ™n]n. æ±¡æŸ“æ±¡æŸ“ç‰©980, polymorphism [,pÉ‘lÉªâ€™mÉ”rfÉªzm]n. å¤šæ€æ€§ï¼›å¤šå½¢æ€§ï¼›åŒè´¨å¤šæ™¶981, popover [â€˜pÉ’pÉ™ÊŠvÉ™]n. ä¸€ç§æ·¡çƒ¤çš„é…¥é¥¼982, populated [ËˆpÉ‘ËpjuleÉªtid]adj. ç²’å­æ•°å¢žåŠ çš„;v. å±…ä½äºŽâ€¦ä¸­ï¼›æž„æˆâ€¦çš„äººå£ï¼ˆpopulateçš„è¿‡åŽ»åˆ†è¯ï¼‰983, portable [â€˜pÉ”rtÉ™bl]adj. æ‰‹æçš„ï¼Œä¾¿æºå¼çš„ï¼›è½»ä¾¿çš„n. æ‰‹æå¼æ‰“å­—æœº984, portal [â€˜pÉ”Ët(É™)l]n. å¤§é—¨ï¼Œå…¥å£;n. (Portal)äººåï¼›(æ³•ã€è¥¿ã€è‘¡)æ³¢å¡”å°”ï¼›(è‹±)æ³¢ç‰¹å°”985, portion [â€˜pÉ”ËÊƒ(É™)n]n. éƒ¨åˆ†ï¼›ä¸€ä»½ï¼›å‘½è¿ vt. åˆ†é…ï¼›ç»™â€¦å«å¦†986, portrait [â€˜pÉ”rtrÉªt]n. è‚–åƒï¼›æå†™ï¼›åŠèº«é›•å¡‘åƒn. (Portrait)äººåï¼›(æ³•)æ³¢ç‰¹é›·987, postpone [pÉ™ÊŠs(t)â€™pÉ™ÊŠn; pÉ™â€™spÉ™ÊŠn]vt. ä½¿â€¦å»¶æœŸï¼›æŠŠâ€¦æ”¾åœ¨æ¬¡è¦åœ°ä½ï¼›æŠŠâ€¦æ”¾åœ¨åŽé¢;vi. å»¶ç¼“ï¼Œå»¶è¿Ÿï¼›å»¶ç¼“å‘ä½œ988, pot [ç¾Ž/pÉ‘t/]n. å£¶ï¼›ç›†ï¼›ç½;vt. æŠŠâ€¦è£…ç½ï¼›å°„å‡»ï¼›èŠ‚ç•¥;vi. éšæ‰‹å°„å‡»;n. (Pot)äººåï¼›(æŸ¬)å¸ƒç‰¹ï¼›(æ·)æ³¢ç‰¹ï¼›(æ³•)æ³¢;989, potentially [pÉ™â€™tÉ›nÊƒÉ™li]adv.å¯èƒ½åœ°ï¼Œæ½œåœ¨åœ°990, practical [â€˜prÃ¦ktÉªk(É™)l]adj. å®žé™…çš„ï¼›å®žç”¨æ€§çš„991, pragmatic [prÃ¦gâ€™mÃ¦tÉªk]adj. å®žé™…çš„ï¼›å®žç”¨ä¸»ä¹‰çš„ï¼›å›½äº‹çš„992, prank [prÃ¦Å‹k]n. æ¶ä½œå‰§ï¼Œå¼€çŽ©ç¬‘ï¼›æˆè°‘;vt. è£…é¥°ï¼›æ‰“æ‰®;vi. ç‚«è€€è‡ªå·±ï¼›èƒ¡é—¹993, precaution [prÉªâ€™kÉ”ËÊƒ(É™)n]n. é¢„é˜²ï¼Œè­¦æƒ•ï¼›é¢„é˜²æŽªæ–½;vt. è­¦æƒ•ï¼›é¢„å…ˆè­¦å‘Š994, precede [prÉªâ€™siËd]vt. é¢†å…ˆï¼Œåœ¨â€¦ä¹‹å‰ï¼›ä¼˜äºŽï¼Œé«˜äºŽ;vi. é¢†å…ˆï¼Œåœ¨å‰é¢995, precedence [â€˜presÉªd(É™)ns; prÉªâ€™siËd(É™)ns]n. ä¼˜å…ˆï¼›å±…å…ˆ996, precision [prÉªâ€™sÉªÊ’n]n. ç²¾åº¦ï¼Œ[æ•°] ç²¾å¯†åº¦ï¼›ç²¾ç¡®adj. ç²¾å¯†çš„ï¼Œç²¾ç¡®çš„997, preclude [prÉªâ€™kluËd]vt. æŽ’é™¤ï¼›å¦¨ç¢ï¼›é˜»æ­¢998, predecessor [â€˜priËdÉªsesÉ™]n. å‰ä»»ï¼Œå‰è¾ˆ999, predictability [pri,diktÉ™â€™biliti]n. å¯é¢„æµ‹æ€§ï¼›å¯é¢„è¨€1000, preempt [,primpt]vt. å…ˆå ï¼›å…ˆå–ï¼›ä»¥å…ˆä¹°æƒèŽ·å¾—1001, preference [â€˜pref(É™)r(É™)ns]n. åçˆ±ï¼Œå€¾å‘ï¼›ä¼˜å…ˆæƒ1002, prefetch [prefetch]v. é¢„å–1003, preliminary [prÉªâ€™lÉªmÉªn(É™)rÉª]n. å‡†å¤‡ï¼›é¢„èµ›ï¼›åˆæ­¥æŽªæ–½adj. åˆæ­¥çš„ï¼›å¼€å§‹çš„ï¼›é¢„å¤‡çš„1004, premiered []ï¼ˆæˆå‰§ã€ç”µå½±ç­‰ï¼‰é¦–æ¬¡å…¬æ¼”ï¼ˆpremiereçš„è¿‡åŽ»å¼å’Œè¿‡åŽ»åˆ†è¯ï¼‰1005, premises [â€˜premÉªsÉªz]n.å‰æï¼›ç»è¥åœºå€ï¼›ä¸Šè¿°æˆ¿å±‹ï¼›å¥‘çº¦å‰è¨€ï¼ˆpremiseçš„å¤æ•°ï¼‰ v.æå‡ºâ€¦ä¸ºå‰æï¼›é¢„è¿°ï¼ˆpremiseçš„ç¬¬ä¸‰äººç§°å•æ•°ï¼‰1006, premium [â€˜priËmÉªÉ™m]n. é¢å¤–è´¹ç”¨ï¼›å¥–é‡‘ï¼›ä¿é™©è´¹;(å•†)æº¢ä»·;adj. é«˜ä»·çš„ï¼›ä¼˜è´¨çš„1007, preppy [â€˜prÉ›pi]n. é¢„ç§‘ç”Ÿï¼ˆç­‰äºŽpreppieï¼‰1008, prerequisite [priËâ€™rekwÉªzÉªt]n. å…ˆå†³æ¡ä»¶;adj. é¦–è¦å¿…å¤‡çš„1009, present [â€˜prez(É™)nt]vt. æå‡ºï¼›ä»‹ç»ï¼›å‘ˆçŽ°ï¼›èµ é€;vi. ä¸¾æžªçž„å‡†;adj. çŽ°åœ¨çš„ï¼›å‡ºå¸­çš„;n. çŽ°åœ¨ï¼›ç¤¼ç‰©ï¼›çž„å‡†1010, presentation [prez(É™)nâ€™teÉªÊƒ(É™)n]n. å±•ç¤ºï¼›æè¿°ï¼Œé™ˆè¿°ï¼›ä»‹ç»ï¼›èµ é€1011, Presentation [prez(É™)nâ€™teÉªÊƒ(É™)n]n. æè¿°ï¼Œé™ˆè¿°ï¼›ä»‹ç»ï¼›èµ é€1012, presenter [prÉªâ€™zÉ›ntÉš]n. æå‡ºè€…ï¼›æŽ¨èè€…ï¼›èµ é€è€…ï¼›ä»»å‘½è€…ï¼›ä¸»æŒäºº1013, prevent [prÉªâ€™vent]vt. é¢„é˜²ï¼Œé˜²æ­¢ï¼›é˜»æ­¢;vi. å¦¨ç¢ï¼Œé˜»æ­¢1014, primary [â€˜praÉªmÉ›ri]adj. ä¸»è¦çš„ï¼›åˆçº§çš„ï¼›åŸºæœ¬çš„n. åŽŸè‰²ï¼›æœ€ä¸»è¦è€…1015, Primordial [praÉªâ€™mÉ”ËdÉªÉ™l]adj. åŽŸå§‹çš„ï¼›æ ¹æœ¬çš„ï¼›åŽŸç”Ÿçš„1016, principal [â€˜prÉªnsÉ™p(É™)l]adj. ä¸»è¦çš„ï¼›èµ„æœ¬çš„;n. é¦–é•¿ï¼›æ ¡é•¿ï¼›èµ„æœ¬ï¼›å½“äº‹äºº1017, Principal [â€˜prÉªnsÉ™p(É™)l]adj. ä¸»è¦çš„ï¼›èµ„æœ¬çš„;n. é¦–é•¿ï¼›æ ¡é•¿ï¼›èµ„æœ¬ï¼›å½“äº‹äºº1018, principle [â€˜prÉªnsÉªp(É™)l]n. åŽŸç†ï¼ŒåŽŸåˆ™ï¼›ä¸»ä¹‰ï¼Œé“ä¹‰ï¼›æœ¬è´¨ï¼Œæœ¬ä¹‰ï¼›æ ¹æºï¼Œæºæ³‰1019, Principle [â€˜prÉªnsÉªp(É™)l]n. åŽŸç†ï¼ŒåŽŸåˆ™ï¼›ä¸»ä¹‰ï¼Œé“ä¹‰ï¼›æœ¬è´¨ï¼Œæœ¬ä¹‰ï¼›æ ¹æºï¼Œæºæ³‰1020, principle engineerã€ç½‘ç»œã€‘é¦–å¸­å·¥ç¨‹å¸ˆ1021, priority [praÉªâ€™É”rÉ™ti]n. ä¼˜å…ˆï¼›ä¼˜å…ˆæƒï¼›[æ•°] ä¼˜å…ˆæ¬¡åºï¼›ä¼˜å…ˆè€ƒè™‘çš„äº‹1022, Priority [praÉªâ€™É’rÉªtÉª]n. ä¼˜å…ˆï¼›ä¼˜å…ˆæƒï¼›[æ•°] ä¼˜å…ˆæ¬¡åºï¼›ä¼˜å…ˆè€ƒè™‘çš„äº‹1023, proactive [prÉ™ÊŠâ€™Ã¦ktÉªv]adj. å‰æ‘„çš„ï¼ˆå‰ä¸€æ´»åŠ¨ä¸­çš„å› ç´ å¯¹åŽä¸€æ´»åŠ¨é€ æˆå½±å“çš„ï¼‰ï¼›æœ‰å‰çž»æ€§çš„ï¼Œå…ˆè¡Œä¸€æ­¥çš„ï¼›ç§¯æžä¸»åŠ¨çš„1024, probe [prÉ™ÊŠb]n. æŽ¢é’ˆï¼›è°ƒæŸ¥vi. è°ƒæŸ¥ï¼›æŽ¢æµ‹vt. æŽ¢æŸ¥ï¼›ç”¨æŽ¢é’ˆæŽ¢æµ‹n. (Probe)äººåï¼›(æ³•)æ™®ç½—å¸ƒ1025, proceed [proâ€™sid]vi. å¼€å§‹ï¼›ç»§ç»­è¿›è¡Œï¼›å‘ç”Ÿï¼›è¡Œè¿›n. æ”¶å…¥ï¼ŒèŽ·åˆ©1026, Processing [â€˜prÉ‘sÉ›s]v. åŠ å·¥ï¼›[è‡ª] å¤„ç†ï¼›å¯¹â€¦èµ·è¯‰ï¼ˆprocessçš„ingå½¢å¼ï¼‰1027, Processors [prÉ”:â€™sesÉ™z]n. [è®¡] å¤„ç†å™¨ï¼Œ[è®¡] å¤„ç†æœºï¼ˆprocessorå¤æ•°ï¼‰1028, profile [â€˜profaÉªl]n. ä¾§é¢ï¼›è½®å»“ï¼›å¤–å½¢ï¼›å‰–é¢ï¼›ç®€å†µvt. æâ€¦çš„è½®å»“ï¼›æ‰¼è¦æè¿°vi. ç»™å‡ºè½®å»“1029, profiled []v.æç»˜â€¦è½®å»“ï¼Œè¯„è®ºäººç‰©ï¼ˆprofileçš„è¿‡åŽ»å¼ï¼‰1030, progressively [prÉ™â€™É¡rÉ›sÉªvli]adv. æ¸è¿›åœ°ï¼›æ—¥ç›Šå¢žå¤šåœ°1031, projection [prÉ™â€™dÊ’É›kÊƒÉ™n]n. æŠ•å°„ï¼›è§„åˆ’ï¼›çªå‡ºï¼›å‘å°„ï¼›æŽ¨æµ‹1032, promote [prÉ™â€™mÉ™ÊŠt]vt. ä¿ƒè¿›ï¼›æå‡ï¼›æŽ¨é”€ï¼›å‘æ‰¬vi. æˆä¸ºçŽ‹åŽæˆ–å…¶ä»–å¤§äºŽå’çš„å­1033, pronounce [prÉ™â€™naÊŠns]vt. å‘éŸ³ï¼›å®£åˆ¤ï¼›æ–­è¨€;vi. å‘éŸ³ï¼›ä½œå‡ºåˆ¤æ–­1034, propagation [,prÉ’pÉ™â€™É¡eÉªÊƒÉ™n]n. ä¼ æ’­ï¼›ç¹æ®–ï¼›å¢žæ®–1035, PROPAGATION [,prÉ’pÉ™â€™É¡eÉªÊƒÉ™n]n. ä¼ æ’­ï¼›ç¹æ®–ï¼›å¢žæ®–1036, proper [â€˜prÉ‘pÉš]adj. é€‚å½“çš„ï¼›æœ¬èº«çš„ï¼›ç‰¹æœ‰çš„ï¼›æ­£æ´¾çš„adv. å®Œå…¨åœ°n. (Proper)äººåï¼›(è‹±ã€å¾·)æ™®ç½—ç€1037, proportional [prÉ™â€™pÉ”ËÊƒ(É™)n(É™)l]adj. æ¯”ä¾‹çš„ï¼Œæˆæ¯”ä¾‹çš„ï¼›ç›¸ç§°çš„ï¼Œå‡è¡¡çš„;n. [æ•°] æ¯”ä¾‹é¡¹1038, proposal [prÉ™â€™pÉ™ÊŠz(É™)l]n. æè®®ï¼Œå»ºè®®ï¼›æ±‚å©š1039, prospector [prÉ™ÊŠâ€™spektÉ™]n. æŽ¢å‹˜è€…ï¼›é‡‡çŸ¿è€…1040, protocol [â€˜prÉ™ÊŠtÉ™kÉ’l]n. åè®®ï¼›è‰æ¡ˆï¼›ç¤¼ä»ª;vt. æ‹Ÿå®š;vi. æ‹Ÿå®š1041, Protocol [â€˜prÉ™ÊŠtÉ™kÉ’l]n. åè®®ï¼›è‰æ¡ˆï¼›ç¤¼ä»ª;vt. æ‹Ÿå®š;vi. æ‹Ÿå®š1042, provision [prÉ™â€™vÉªÊ’(É™)n]n. è§„å®šï¼›æ¡æ¬¾ï¼›å‡†å¤‡ï¼›[ç»] ä¾›åº”å“vt. ä¾›ç»™â€¦é£Ÿç‰©åŠå¿…éœ€å“1043, proxy [â€˜prÉ’ksÉª]n. ä»£ç†äººï¼›å§”æ‰˜ä¹¦ï¼›ä»£ç”¨å“1044, prune [pruËn]vi. åˆ é™¤ï¼›å‡å°‘vt. ä¿®å‰ªï¼›åˆ é™¤ï¼›å‰ªåŽ»n. æ·±ç´«çº¢è‰²ï¼›å‚»ç“œï¼›æŽå­å¹²n. (Prune)äººåï¼›(ç½—)æ™®é²å†…1045, pseudo [â€˜sjuËdÉ™ÊŠ]n. ä¼ªå›å­ï¼›å‡å†’çš„äºº;adj. å†’å……çš„ï¼Œå‡çš„1046, pump [pÊŒmp]vt. æ‰“æ°”ï¼›ç”¨æŠ½æ°´æœºæŠ½â€¦ n. æ³µï¼ŒæŠ½æ°´æœºï¼›æ‰“æ°”ç­’ vi. æŠ½æ°´ n. (Pump)äººåï¼›(æ·)è“¬æ™®ï¼›(è‹±)åºžæ™®1047, punch above [punch+above]è¶…è¶Š1048, punctuation [â€˜pÊŒÅ‹ktÊƒÊŠâ€™eÊƒÉ™n]n. æ ‡ç‚¹ï¼›æ ‡ç‚¹ç¬¦å·1049, puppet [â€˜pÊŒpÉªt]n. æœ¨å¶ï¼›å‚€å„¡ï¼›å—ä»–äººæ“çºµçš„äºº1050, Purchase [â€˜pÉœ:tÊƒÉ™s]n. è´­ä¹°ï¼›ç´§æ¡ï¼›èµ·é‡è£…ç½®;vt. è´­ä¹°ï¼›èµ¢å¾—;vi. è´­ä¹°ä¸œè¥¿1051, purge [pÉdÊ’]vi. å‡€åŒ–ï¼›é€šä¾¿vt. å‡€åŒ–ï¼›æ¸…æ´—ï¼›é€šä¾¿n. å‡€åŒ–ï¼›æ³»è¯1052, puzzle [â€˜pÊŒzl]vt. ä½¿â€¦å›°æƒ‘ï¼›ä½¿â€¦ä¸ºéš¾ï¼›è‹¦æ€è€Œå¾—å‡ºvi. è¿·æƒ‘ï¼›å†¥æ€è‹¦æƒ³n. è°œï¼›éš¾é¢˜ï¼›è¿·æƒ‘1053, quack [kwÃ¦k]n. åº¸åŒ»ï¼›é¸­å«å£°vi. ï¼ˆé¸­å­ï¼‰å˜Žå˜Žå«ï¼›å¹å˜˜ï¼›å¤§å£°é—²èŠadj. éª—äººçš„ï¼›å†’ç‰ŒåŒ»ç”Ÿçš„n. (Quack)äººåï¼›(å¾·)å¤¸å…‹1054, qualifier [â€˜kwÉ’lÉªfaÉªÉ™(r)]n. [è¯­] ä¿®é¥°è¯­n. èµ„æ ¼èµ›ï¼Œé¢„é€‰èµ›ï¼›å–å¾—èµ„æ ¼çš„äºº1055, quantilen. [è®¡] åˆ†ä½æ•°ï¼›åˆ†ä½ç‚¹1056, Quantity [â€˜kwÉ’ntÉªtÉª]n. é‡ï¼Œæ•°é‡ï¼›å¤§é‡ï¼›æ€»é‡1057, quiescent [kwÉªâ€™É›snt]adj. é™æ­¢çš„ï¼›ä¸æ´»åŠ¨çš„ï¼›æ²‰å¯‚çš„1058, quorum [â€˜kwÉ”rÉ™m]n. æ³•å®šäººæ•°1059, rack [rÃ¦k]n. [æœº] é½¿æ¡ï¼›æž¶å­ï¼›æ‹·é—®å° vi. å˜å½¢ï¼›éšé£Žé£˜ï¼›å°æ­¥è·‘ vt. æŠ˜ç£¨ï¼›æ¦¨å– n. (Rack)äººåï¼›(æ³•ã€å¾·ã€æ„ã€åŒˆ)æ‹‰å…‹1060, radically [â€˜rÃ¦dÉªkli]adv. æ ¹æœ¬ä¸Šï¼›å½»åº•åœ°ï¼›ä»¥æ¿€è¿›çš„æ–¹å¼1061, radius [â€˜reÉªdÉªÉ™s]n. åŠå¾„ï¼ŒåŠå¾„èŒƒå›´ï¼›[è§£å‰–] æ¡¡éª¨ï¼›è¾å°„å…‰çº¿ï¼›æœ‰æ•ˆèˆªç¨‹;n. (Radius)äººåï¼›(æ„ã€å°å°¼)æ‹‰è¿ªä¹Œæ–¯ï¼›(è‹±)é›·è¿ªåŽ„æ–¯ï¼›(æ³•)æ‹‰è¿ªäºŽæ–¯1062, raft [rÉ‘Ëft]n. ç­ï¼›æ•‘ç”Ÿè‰‡ï¼›ï¼ˆç¾Žï¼‰å¤§é‡vt. ç­è¿ï¼›åˆ¶æˆç­vi. ä¹˜ç­n. (Raft)äººåï¼›(åŒˆã€ç‘žå…¸)æ‹‰å¤«ç‰¹1063, raid [reÉªd]n. è¢­å‡»ï¼›çªè¢­ï¼›æœæ•ï¼›æŠ¢åŠ«vi. çªè¢­vt. è¢­å‡»ï¼Œçªè¢­n. (Raid)äººåï¼›(é˜¿æ‹‰ä¼¯)æ‹‰ä¼Šå¾·1064, rake [rek]vi. æœç´¢ï¼›ç”¨è€™å­è€™ï¼›æŽ è¿‡ï¼Œæ“¦è¿‡vt. å€¾æ–œï¼›æœç´¢ï¼›æŽ è¿‡ï¼›ç”¨è€™å­è€™n. è€™å­ï¼›æ–œåº¦ï¼›é’±è€™ï¼›æ”¾è¡çš„äººï¼Œæµªå­n. (Rake)äººåï¼›(è‹±)é›·å…‹ï¼›(å¡ž)æ‹‰å‡¯1065, rally [â€˜rÃ¦lÉª]vi. å›¢ç»“ï¼›é‡æ•´ï¼›æ¢å¤ï¼›ï¼ˆç½‘çƒç­‰ï¼‰è¿žç»­å¯¹æ‰“ vt. å›¢ç»“ï¼›é›†åˆï¼›æ¢å¤å¥åº·ã€åŠ›é‡ç­‰ n. é›†ä¼šï¼›å›žå¤ï¼›å…¬è·¯èµ›è½¦ä¼š n. (Rally)äººåï¼›(ç½—)æ‹‰åˆ©1066, rancher [â€˜rÃ¦ntÊƒÉš]n. å¤§å†œåœºç»è¥è€…ï¼›å¤§å†œåœºå·¥äººn. (Rancher)äººåï¼›(æ„)å…°å‡¯å°”1067, Range [reÉªn(d)Ê’]n. èŒƒå›´ï¼›å¹…åº¦ï¼›æŽ’ï¼›å±±è„‰;vi. å¹³è¡Œï¼Œåˆ—ä¸ºä¸€è¡Œï¼›å»¶ä¼¸ï¼›æ¼«æ¸¸ï¼›å°„ç¨‹è¾¾åˆ°;vt. æ¼«æ¸¸ï¼›æ”¾ç‰§ï¼›ä½¿å¹¶åˆ—ï¼›å½’ç±»äºŽï¼›æ¥å›žèµ°åŠ¨;n. (Range)äººåï¼›(è‘¡)å…°çƒ­ï¼›(ç‘žå…¸ã€å¾·)æœ—æ ¼1068, rare [reÉ™]adj. ç¨€æœ‰çš„ï¼›ç¨€è–„çš„ï¼›åŠç†Ÿçš„adj. æ°å‡ºçš„ï¼›æžåº¦çš„ï¼›éžå¸¸å¥½çš„adv. éžå¸¸ï¼›æžå…¶vi. ç”¨åŽè…¿ç«™èµ·ï¼›æ¸´æœ›1069, rather [â€˜rÉ‘ËÃ°É™]adv. å®å¯ï¼Œå®æ„¿ï¼›ç›¸å½“;int. å½“ç„¶å•¦ï¼ˆå›žç­”é—®é¢˜æ—¶ç”¨ï¼‰;n. (Rather)äººåï¼›(è‹±)æ‹‰ç‘Ÿ1070, raw [rÉ”Ë]adj. ç”Ÿçš„ï¼›æœªåŠ å·¥çš„ï¼›é˜´å†·çš„ï¼›åˆºç—›çš„ï¼›æ“¦æŽ‰çš®çš„ï¼›æ— ç»éªŒçš„ï¼›ï¼ˆåœ¨è‰ºæœ¯ç­‰æ–¹é¢ï¼‰ä¸æˆç†Ÿçš„;n. æ“¦ä¼¤å¤„;vt. æ“¦ä¼¤;n. (Raw)äººåï¼›(è‹±)ç½—1071, Raw [rÉ”Ë]adj. ç”Ÿçš„ï¼›æœªåŠ å·¥çš„ï¼›é˜´å†·çš„ï¼›åˆºç—›çš„ï¼›æ“¦æŽ‰çš®çš„ï¼›æ— ç»éªŒçš„ï¼›ï¼ˆåœ¨è‰ºæœ¯ç­‰æ–¹é¢ï¼‰ä¸æˆç†Ÿçš„;n. æ“¦ä¼¤å¤„;vt. æ“¦ä¼¤;n. (Raw)äººåï¼›(è‹±)ç½—1072, react [rÉªâ€™Ã¦kt]vi. ååº”ï¼›å½±å“ï¼›åæŠ—ï¼›èµ·åä½œç”¨;vt. ä½¿å‘ç”Ÿç›¸äº’ä½œç”¨ï¼›ä½¿èµ·åŒ–å­¦ååº”1073, Reactive [rÉªâ€™Ã¦ktÉªv]adj. ååº”çš„ï¼›ç”µæŠ—çš„ï¼›ååŠ¨çš„1074, realistic [rÉªÉ™â€™lÉªstÉªk]adj. çŽ°å®žçš„ï¼›çŽ°å®žä¸»ä¹‰çš„ï¼›é€¼çœŸçš„ï¼›å®žåœ¨è®ºçš„1075, realm [relm]n. é¢†åŸŸï¼ŒèŒƒå›´ï¼›çŽ‹å›½1076, Realm [relm]n. é¢†åŸŸï¼ŒèŒƒå›´ï¼›çŽ‹å›½1077, receiver [rÉªâ€™siËvÉ™]n. æŽ¥æ”¶å™¨ï¼›æŽ¥å—è€…ï¼›æ”¶ä¿¡æœºï¼›æ”¶æ¬¾å‘˜ï¼ŒæŽ¥å¾…è€…1078, reciprocate [rÉªâ€™sÉªprÉ™keÉªt]vt. æŠ¥ç­”ï¼›äº’æ¢ï¼›äº’ç»™vi. å¾€å¤è¿åŠ¨ï¼›äº’æ¢ï¼›é…¬ç­”ï¼›äº’ç»™1079, reclamation [,reklÉ™â€™meÉªÊƒÉ™n]n. å¼€åž¦ï¼›æ”¶å›žï¼›å†åˆ©ç”¨ï¼›çŸ«æ­£1080, recognition [rekÉ™gâ€™nÉªÊƒ(É™)n]n. è¯†åˆ«ï¼›æ‰¿è®¤ï¼Œè®¤å‡ºï¼›é‡è§†ï¼›èµžèª‰ï¼›å…¬è®¤1081, recommend [rekÉ™â€™mend]vt. æŽ¨èï¼Œä»‹ç»ï¼›åŠå‘Šï¼›ä½¿å—æ¬¢è¿Žï¼›æ‰˜ä»˜;vi. æŽ¨èï¼›å»ºè®®1082, reconcile [â€˜rÉ›kÉ™nsaÉªl]vt. ä½¿ä¸€è‡´ï¼›ä½¿å’Œè§£ï¼›è°ƒåœï¼Œè°ƒè§£ï¼›ä½¿é¡ºä»Ž1083, recruiter [rÉªâ€™kruËtÉ™]n. æ‹›è˜äººå‘˜ï¼Œå¾å…µäººå‘˜1084, rectangle [â€˜rektÃ¦Å‹g(É™)l]n. çŸ©å½¢ï¼›é•¿æ–¹å½¢1085, rectify [â€˜rektÉªfaÉª]vt. æ”¹æ­£ï¼›ç²¾é¦ï¼›æ•´æµ1086, recursen. é€’å½’ï¼ˆç®—æ³•ï¼‰v. é€’å½’1087, recursion [rÉªâ€™kÉœËÊƒ(É™)n]n. [æ•°] é€’å½’ï¼Œå¾ªçŽ¯ï¼›é€’å½’å¼1088, recursive [rÉªâ€™kÉœËsÉªv]adj. [æ•°] é€’å½’çš„ï¼›å¾ªçŽ¯çš„1089, Reduce [rÉªâ€™djuËs]vt. å‡å°‘ï¼›é™ä½Žï¼›ä½¿å¤„äºŽï¼›æŠŠâ€¦åˆ†è§£;vi. å‡å°‘ï¼›ç¼©å°ï¼›å½’çº³ä¸º1090, redundant [rÉªâ€™dÊŒnd(É™)nt]adj. å¤šä½™çš„ï¼Œè¿‡å‰©çš„ï¼›è¢«è§£é›‡çš„ï¼Œå¤±ä¸šçš„ï¼›å†—é•¿çš„ï¼Œç´¯èµ˜çš„1091, ReentrantLocké‡å…¥é”1092, reflexive [rÉªâ€™fleksÉªv]n. åèº«ä»£è¯ï¼›åèº«åŠ¨è¯;adj. åèº«çš„ï¼›[ç‰©] åå°„çš„1093, regardless [rÉªâ€™gÉ‘ËdlÉªs]adj. ä¸ç®¡çš„ï¼›ä¸é¡¾çš„ï¼›ä¸æ³¨æ„çš„;adv. ä¸é¡¾åŽæžœåœ°ï¼›ä¸ç®¡æ€Žæ ·ï¼Œæ— è®ºå¦‚ä½•ï¼›ä¸æƒœè´¹ç”¨åœ°1094, regardless ofä¸é¡¾ï¼Œä¸ç®¡regardless of: ä¸é¡¾ | ä¸ç®¡ | ä¸æƒœ1095, register [â€˜rÉ›dÊ’ÉªstÉš]vt. ç™»è®°ï¼›æ³¨å†Œï¼›è®°å½•ï¼›æŒ‚å·é‚®å¯„ï¼›æŠŠâ€¦æŒ‚å·ï¼›æ­£å¼æå‡º vi. ç™»è®°ï¼›æ³¨å†Œï¼›æŒ‚å· n. ç™»è®°ï¼›æ³¨å†Œï¼›è®°å½•ï¼›å¯„å­˜å™¨ï¼›ç™»è®°ç°¿ n. (Register)äººåï¼›(è‹±)é›·å‰æ–¯ç‰¹1096, registry [â€˜rÉ›dÊ’Éªstri]n. æ³¨å†Œï¼›ç™»è®°å¤„ï¼›æŒ‚å·å¤„ï¼›èˆ¹èˆ¶çš„å›½ç±1097, regular [â€˜regjÊŠlÉ™]adj. å®šæœŸçš„ï¼›æœ‰è§„å¾‹çš„ï¼›åˆæ ¼çš„ï¼›æ•´é½çš„ï¼›æ™®é€šçš„ n. å¸¸å®¢ï¼›æ­£å¼é˜Ÿå‘˜ï¼›ä¸­åšåˆ†å­ adv. å®šæœŸåœ°ï¼›ç»å¸¸åœ° n. (Regular)äººåï¼›(ä»¥)é›·å¤æ‹‰å°”1098, reinforce [riËÉªnâ€™fÉ”Ës]vt. åŠ å¼ºï¼ŒåŠ å›ºï¼›å¼ºåŒ–ï¼›è¡¥å……;vi. æ±‚æ´ï¼›å¾—åˆ°å¢žæ´ï¼›ç»™äºˆæ›´å¤šçš„æ”¯æŒ;n. åŠ å¼ºï¼›åŠ å›ºç‰©ï¼›åŠ å›ºææ–™1099, relevance [â€˜rÉ›lÉ™vÉ™ns]n. å…³è”ï¼›é€‚å½“ï¼›ä¸­è‚¯1100, remedy [â€˜remÉªdÉª]vt. è¡¥æ•‘ï¼›æ²»ç–—ï¼›çº æ­£ n. è¡¥æ•‘ï¼›æ²»ç–—ï¼›èµ”å¿1101, render [â€˜rendÉ™]vt. è‡´ä½¿ï¼›æå‡ºï¼›å®žæ–½ï¼›ç€è‰²ï¼›ä»¥â€¦å›žæŠ¥;vi. ç»™äºˆè¡¥å¿;n. æ‰“åº•ï¼›äº¤çº³ï¼›ç²‰åˆ·;n. (Render)äººåï¼›(è‹±ã€å¾·)ä¼¦å¾·å°”1102, rendering [â€˜rend(É™)rÉªÅ‹]n. ç¿»è¯‘ï¼›è¡¨çŽ°ï¼›è¡¨æ¼”ï¼›æå†™ï¼›æ‰“åº•ï¼›ï¼ˆå»ºç­‘ç‰©ç­‰ï¼‰é€è§†å›¾vt. è‡´ä½¿ï¼›è¡¨æ¼”ï¼›æ‰“åº•ï¼ˆrenderçš„ingå½¢å¼ï¼‰vi. ç»™äºˆè¡¥å¿ï¼ˆrenderçš„ingå½¢å¼ï¼‰1103, renouncement [renouncement]n. å¦è®¤ï¼›æ‹’ç»ï¼›æ”¾å¼ƒ1104, replica [â€˜rÉ›plÉªkÉ™]n. å¤åˆ¶å“ï¼Œå¤åˆ¶ç‰©1105, replicas [replicas][å¤] å¤åˆ¶å“å¤åž‹1106, repository [rÉªâ€™pÉ’zÉªt(É™)rÉª]n. è´®è—å®¤ï¼Œä»“åº“ï¼›çŸ¥è¯†åº“ï¼›æ™ºå›Šå›¢1107, represent [reprÉªâ€™zent]vt. ä»£è¡¨ï¼›è¡¨çŽ°ï¼›æç»˜ï¼›å›žå¿†ï¼›å†èµ é€vi. ä»£è¡¨ï¼›æå‡ºå¼‚è®®1108, representation [,reprÉªzenâ€™teÉªÊƒ(É™)n]n. ä»£è¡¨ï¼›è¡¨çŽ°ï¼›è¡¨ç¤ºæ³•ï¼›é™ˆè¿°1109, REQUIRED [rÉªâ€™kwaÉªÉ™d]adj. å¿…éœ€çš„ï¼›ï¼ˆç¾Žï¼‰å¿…ä¿®çš„;v. éœ€è¦ï¼ˆrequireçš„è¿‡åŽ»å¼åŠè¿‡åŽ»åˆ†è¯å½¢å¼ï¼‰ï¼›è¦æ±‚1110, reroute [riËâ€™ruËt]vt. å˜æ›´æ—…ç¨‹ï¼›æŒ‰æ–°çš„ç‰¹å®šè·¯çº¿è¿é€1111, rescue [â€˜reskjuË]vt. è¥æ•‘ï¼›æ´æ•‘;n. è¥æ•‘ï¼›æ´æ•‘ï¼›è§£æ•‘1112, reservation [rezÉ™â€™veÉªÊƒ(É™)n]n. é¢„çº¦ï¼Œé¢„è®¢ï¼›ä¿ç•™1113, reservoir [â€˜rÉ›zÉš,vÉ”r]n. æ°´åº“ï¼›è“„æ°´æ± 1114, resilience [rÉªâ€™zÉªlÉªÉ™ns]n. æ¢å¤åŠ›ï¼›å¼¹åŠ›ï¼›é¡ºåº”åŠ›1115, resiliency [rÉªâ€™zÉªlÉªÉ™nsÉª]n. å¼¹æ€§ï¼›è·³å›ž1116, Resiliency [rÉªâ€™zÉªlÉªÉ™nsÉª]n. å¼¹æ€§ï¼›è·³å›ž1117, resilient [rÉªâ€™zÉªlÉªÉ™nt]adj. å¼¹å›žçš„ï¼Œæœ‰å¼¹åŠ›çš„adj. èƒ½å¤åŽŸçš„ï¼›æœ‰å¤åŽŸåŠ›çš„1118, resist [rÉªâ€™zÉªst]vi. æŠµæŠ—ï¼ŒæŠ—æ‹’ï¼›å¿è€;vt. æŠµæŠ—ï¼›å¿è€ï¼Œå¿ä½;n. [åŠ©å‰‚] æŠ—èš€å‰‚ï¼›é˜²æŸ“å‰‚1119, resolute [â€˜rezÉ™luËt]adj. åšå†³çš„ï¼›æžœæ–­çš„1120, resolution [,rÉ›zÉ™â€™luÊƒÉ™n]n. [ç‰©] åˆ†è¾¨çŽ‡ï¼›å†³è®®ï¼›è§£å†³ï¼›å†³å¿ƒ1121, resolve [rÉªâ€™zÉ’lv]vt. å†³å®šï¼›æº¶è§£ï¼›ä½¿â€¦åˆ†è§£ï¼›å†³å¿ƒè¦åšâ€¦;vi. è§£å†³ï¼›å†³å¿ƒï¼›åˆ†è§£;n. åšå†³ï¼›å†³å®šè¦åšçš„äº‹1122, resolved [rÉªâ€™zÉ’lvd]adj. ä¸‹å®šå†³å¿ƒçš„ï¼›å·²è§£å†³çš„ï¼›æ–­ç„¶çš„;v. è§£å†³ï¼›å†³å®šï¼›åˆ†è§£ï¼›è½¬å˜ï¼ˆresolveçš„è¿‡åŽ»åˆ†è¯ï¼‰1123, Resolved [rÉªâ€™zÉ’lvd]adj. ä¸‹å®šå†³å¿ƒçš„ï¼›å·²è§£å†³çš„ï¼›æ–­ç„¶çš„;v. è§£å†³ï¼›å†³å®šï¼›åˆ†è§£ï¼›è½¬å˜ï¼ˆresolveçš„è¿‡åŽ»åˆ†è¯ï¼‰1124, Resolver [riËâ€™zÉ’lvÉ™]n. æº¶å‰‚ï¼›[ç”µå­] åˆ†è§£å™¨ï¼›ä¸‹å†³å¿ƒè€…1125, respect [rÉªâ€™spekt]n. å°Šæ•¬ï¼Œå°Šé‡ï¼›æ–¹é¢ï¼›æ•¬æ„;vt. å°Šæ•¬ï¼Œå°Šé‡ï¼›éµå®ˆ1126, response [rÉªâ€™spÉ’ns]n. å“åº”ï¼›ååº”ï¼›å›žç­”1127, responsible [rÉªâ€™spÉ’nsÉªb(É™)l]adj. è´Ÿè´£çš„ï¼Œå¯é çš„ï¼›æœ‰è´£ä»»çš„1128, responsive [rÉªâ€™spÉ’nsÉªv]adj. å“åº”çš„ï¼›åº”ç­”çš„ï¼›å›žç­”çš„1129, restored [riâ€™stÉ”:d]adj. ç²¾åŠ›å……æ²›çš„ï¼›ç²¾åŠ›æ¢å¤çš„;v. ä¿®å¤ï¼ˆrestoreçš„è¿‡åŽ»å¼ï¼‰ï¼›æ¢å¤å¥åº·1130, restrict [rÉªâ€™strÉªkt]vt. é™åˆ¶ï¼›çº¦æŸï¼›é™å®š1131, restriction [rÉªâ€™strÉªkÊƒ(É™)n]n. é™åˆ¶ï¼›çº¦æŸï¼›æŸç¼š1132, retention [rÉªâ€™tenÊƒ(É™)n]n. ä¿ç•™ï¼›æ‰£ç•™ï¼Œæ»žç•™ï¼›è®°å¿†åŠ›ï¼›é—­å°¿1133, Retention [rÉªâ€™tenÊƒ(É™)n]n. ä¿ç•™ï¼›æ‰£ç•™ï¼Œæ»žç•™ï¼›è®°å¿†åŠ›ï¼›é—­å°¿1134, retrieval [rÉªâ€™triËvl]n. æ£€ç´¢ï¼›æ¢å¤ï¼›å–å›žï¼›æ‹¯æ•‘1135, retrieve [rÉªâ€™triËv]vt. [è®¡] æ£€ç´¢ï¼›æ¢å¤ï¼›é‡æ–°å¾—åˆ°;vi. æ‰¾å›žçŒŽç‰©;n. [è®¡] æ£€ç´¢ï¼›æ¢å¤ï¼Œå–å›ž1136, Retype [ri:â€™taip]vt. é‡æ–°è¾“å…¥1137, Reuse [riËâ€™juËz]n. é‡æ–°ä½¿ç”¨ï¼Œå†ç”¨;vt. å†ä½¿ç”¨1138, revision [rÉªâ€™vÉªÊ’(É™)n]n. [å°åˆ·] ä¿®æ­£ï¼›å¤ä¹ ï¼›ä¿®è®¢æœ¬1139, revisions []n. æ ¡è®¢ï¼Œ[å°åˆ·] ä¿®æ­£ï¼›å¤ä¹ ï¼ˆrevisionçš„å¤æ•°å½¢å¼ï¼‰1140, revoke [rÉªâ€™vÉ™ÊŠk]vt. æ’¤å›žï¼Œå–æ¶ˆï¼›åºŸé™¤ vi. æœ‰ç‰Œä¸è·Ÿ n. æœ‰ç‰Œä¸è·Ÿ1141, rewind [,riâ€™waÉªnd]n. é‡ç»•ï¼›å€’å¸¦å™¨vt. å€’å›žï¼›é‡ç»•vi. å€’å›žï¼›é‡ç»•1142, rid [rÉªd]vt. ä½¿æ‘†è„±ï¼›ä½¿åŽ»æŽ‰;n. (Rid)äººåï¼›(è‹±)é‡Œå¾·1143, riddle [â€˜rÉªdl]vt. è§£è°œï¼›ç»™â€¦å‡ºè°œï¼›å……æ»¡äºŽn. è°œè¯­ï¼›ç²—ç­›ï¼›è°œä¸€èˆ¬çš„äººã€ä¸œè¥¿ã€äº‹æƒ…ç­‰vi. å‡ºè°œn. (Riddle)äººåï¼›(è‹±)é‡Œå¾·å°”1144, ridiculous [rÉªâ€™dÉªkjÊŠlÉ™s]adj. å¯ç¬‘çš„ï¼›è’è°¬çš„1145, rigid [â€˜rÉªdÊ’Éªd]adj. ä¸¥æ ¼çš„ï¼›åƒµç¡¬çš„ï¼Œæ­»æ¿çš„ï¼›åšç¡¬çš„ï¼›ç²¾ç¡®çš„1146, rigorously [â€˜rigÉ™rÉ™sli]adv.ä¸¥åŽ‰åœ°ï¼›æ®‹é…·åœ°1147, ripped [rÉªpt]adj. å–é†‰çš„ï¼›å—æ¯’å“éº»é†‰çš„;v. æ’•ï¼›æ‰¯ï¼ˆripçš„è¿‡åŽ»åˆ†è¯ï¼‰1148, rival [â€˜raÉªvl]n. å¯¹æ‰‹ï¼›ç«žäº‰è€…;vt. ä¸Žâ€¦ç«žäº‰ï¼›æ¯”å¾—ä¸ŠæŸäºº;vi. ç«žäº‰;adj. ç«žäº‰çš„;n. (Rival)äººåï¼›(è‹±ã€æ³•ã€è¥¿)é‡Œç“¦å°”1149, robust [rÉ™(ÊŠ)â€™bÊŒst]adj. å¼ºå¥çš„ï¼›å¥åº·çš„ï¼›ç²—é‡Žçš„ï¼›ç²—é²çš„1150, role [rÉ™ÊŠl]n. è§’è‰²ï¼›ä»»åŠ¡;n. (Role)äººåï¼›(æ„ã€å¡žã€èµ¤å‡ )ç½—èŽ±1151, rollover [â€˜rolovÉš]n. ç¿»è½¬ï¼›ï¼ˆè½¦ï¼‰ç¿»è¦†ï¼›å»¶æœŸä»˜æ¬¾1152, rotate [ËŒÃ¦plÉªâ€™keÉªÊƒ(É™)n]n. åº”ç”¨ï¼›ç”³è¯·ï¼›åº”ç”¨ç¨‹åºï¼›æ•·ç”¨ï¼›ï¼ˆå¯¹äº‹ç‰©ã€å­¦ä¹ ç­‰ï¼‰æŠ•å…¥1153, rotation [roâ€™teÊƒÉ™n]n. æ—‹è½¬ï¼›å¾ªçŽ¯ï¼Œè½®æµ1154, routesn. [è®¡] è·¯ç”±ï¼Œ[é€šä¿¡] è·¯å¾„ï¼›[äº¤] çº¿è·¯1155, rush [rÊŒÊƒ]n. å†²è¿›ï¼›åŒ†ä¿ƒï¼›æ€¥æµï¼›ç¯å¿ƒè‰ adj. æ€¥éœ€çš„ vt. ä½¿å†²ï¼›çªè¢­ï¼›åŒ†å¿™åœ°åšï¼›é£žè·ƒ vi. å†²ï¼›å¥”ï¼›é—¯ï¼›èµ¶ç´§ï¼›æ¶ŒçŽ° n. (Rush)äººåï¼›(è‹±)æ‹‰ä»€1156, saber [â€˜seÉªbÉ™]n. å†›åˆ€ï¼›ä½©å‰‘ï¼›éª‘å…µvt. ç”¨é©¬åˆ€ç æˆ–æ€n. (Saber)äººåï¼›(æ³•)è¨è´ï¼›(é˜¿æ‹‰ä¼¯)è¨æ¯”å°”1157, sacrifice [â€˜sÃ¦krÉªfaÉªs]n. ç‰ºç‰²ï¼›ç¥­å“ï¼›ä¾›å¥‰vt. ç‰ºç‰²ï¼›çŒ®ç¥­ï¼›äºæœ¬å‡ºå”®vi. çŒ®ç¥­ï¼›å¥‰çŒ®1158, sage [seÉªdÊ’]n.åœ£äººï¼›è´¤äººï¼›å“²äººadj.æ˜Žæ™ºçš„ï¼›è´¤æ˜Žçš„ï¼›å®¡æ…Žçš„n.(Sage)äººåï¼›(æ—¥)ä¸‰ä¸‹(å§“)ï¼›(è‹±)å¡žå¥‡ï¼›(æ„)è¨æ°ï¼›(å¾·)æ‰Žæ ¼ï¼›(æ³•)è¨çƒ­1159, sake [seÉªk]n. ç›®çš„ï¼›åˆ©ç›Šï¼›ç†ç”±ï¼›æ—¥æœ¬ç±³é…’n. (Sake)äººåï¼›(ç½—)è¨å…‹ï¼›(æ—¥)é…’(å§“)1160, salt [sÉ”lt]n. ç›ï¼›é£Žè¶£ï¼Œåˆºæ¿€æ€§adj. å’¸æ°´çš„ï¼›å«ç›çš„ï¼Œå’¸å‘³çš„ï¼›ç›è…Œçš„ï¼›çŒ¥äºµçš„vt. ç”¨ç›è…Œï¼›ç»™â€¦åŠ ç›ï¼›å°†ç›æ’’åœ¨é“è·¯ä¸Šä½¿å†°æˆ–é›ªèžåŒ–n. (Salt)äººåï¼›(è¥¿)è¨å°”ç‰¹ï¼›(è‹±)ç´¢å°”ç‰¹1161, salty [â€˜sÉ”ËltÉª; â€˜sÉ’-]adj. å’¸çš„ï¼›å«ç›çš„1162, salute [sÉ™â€™l(j)uËt]n. è‡´æ•¬ï¼Œæ¬¢è¿Žï¼›æ•¬ç¤¼;vt. è¡Œç¤¼è‡´æ•¬ï¼Œæ¬¢è¿Ž;vi. è‡´æ„ï¼Œæ‰“æ‹›å‘¼ï¼›è¡Œç¤¼1163, sanitizevt. ä½¿â€¦æ— å®³ï¼›ç»™â€¦æ¶ˆæ¯’ï¼›å¯¹â€¦é‡‡å–å«ç”ŸæŽªæ–½1164, sanitized [sanitized]v. æ¶ˆæ¯’ï¼›ä½¿æ¸…æ´ï¼ˆsanitizeçš„è¿‡åŽ»å¼ï¼‰1165, sanity [â€˜sÃ¦nÉªtÉª]n. æ˜Žæ™ºï¼›å¤´è„‘æ¸…æ¥šï¼›ç²¾ç¥žå¥å…¨ï¼›é€šæƒ…è¾¾ç†1166, saturate [â€˜sÃ¦tÊƒÉ™rÉªt]vt. æµ¸é€ï¼Œä½¿æ¹¿é€ï¼›ä½¿é¥±å’Œï¼Œä½¿å……æ»¡adj. æµ¸é€çš„ï¼Œé¥±å’Œçš„ï¼›æ·±é¢œè‰²çš„1167, saturated [â€˜sÃ¦tÊƒÉ™reÉªtÉªd]adj. é¥±å’Œçš„ï¼›æ¸—é€çš„ï¼›æ·±é¢œè‰²çš„ v. ä½¿æ¸—é€ï¼Œä½¿é¥±å’Œï¼ˆsaturateçš„è¿‡åŽ»å¼ï¼‰1168, saturation [â€˜sÃ¦tÊƒÉ™â€™reÊƒÉ™n]n. é¥±å’Œï¼›è‰²é¥±å’Œåº¦ï¼›æµ¸é€ï¼›ç£åŒ–é¥±å’Œ1169, scalability [,skeilÉ™â€™biliti]n. å¯æ‰©å±•æ€§ï¼›å¯ä¼¸ç¼©æ€§ï¼›å¯é‡æµ‹æ€§1170, scalable [â€˜skelÉ™bl]adj. å¯æ”€ç™»çš„ï¼›å¯åŽ»é³žçš„ï¼›å¯ç§°é‡çš„1171, scale [skeÉªl]n. è§„æ¨¡ï¼›æ¯”ä¾‹ï¼›é³žï¼›åˆ»åº¦ï¼›å¤©å¹³ï¼›æ•°å€¼èŒƒå›´;vi. è¡¡é‡ï¼›æ”€ç™»ï¼›å‰¥è½ï¼›ç”Ÿæ°´åž¢;vt. æµ‹é‡ï¼›æ”€ç™»ï¼›åˆ®é³žï¼›ä¾æ¯”ä¾‹å†³å®š;n. (Scale)äººåï¼›(æ„)æ–¯å¡èŽ±1172, scarf [skÉ‘Ëf]n. å›´å·¾ï¼›åµŒæŽ¥ï¼ŒåµŒæŽ¥å¤„ï¼›å¤´å·¾é¢†å·¾;vt. æŠ«åµŒæŽ¥ï¼›ç”¨å›´å·¾å›´;n. (Scarf)äººåï¼›(è‹±)æ–¯å¡å¤«1173, scenario [sÉªâ€™nÉ‘ËrÉªÉ™ÊŠ]n. æ–¹æ¡ˆï¼›æƒ…èŠ‚ï¼›å‰§æœ¬ï¼›è®¾æƒ³1174, scenarios [sÉªâ€™nÉ›rÉª,o]n. æƒ…èŠ‚ï¼›è„šæœ¬ï¼›æƒ…æ™¯ä»‹ç»ï¼ˆscenarioçš„å¤æ•°ï¼‰1175, scope [skÉ™ÊŠp]n. èŒƒå›´ï¼›ä½™åœ°ï¼›è§†é‡Žï¼›çœ¼ç•Œï¼›å¯¼å¼¹å°„ç¨‹;vt. å®¡è§†1176, Scope [skÉ™ÊŠp]n. èŒƒå›´ï¼›ä½™åœ°ï¼›è§†é‡Žï¼›çœ¼ç•Œï¼›å¯¼å¼¹å°„ç¨‹;vt. å®¡è§†1177, SCOPE [skÉ™ÊŠp]n. èŒƒå›´ï¼›ä½™åœ°ï¼›è§†é‡Žï¼›çœ¼ç•Œï¼›å¯¼å¼¹å°„ç¨‹;vt. å®¡è§†1178, scrape [skrep]n. åˆ®æŽ‰ï¼›æ“¦ç—•ï¼›å›°å¢ƒï¼›åˆ®æ“¦å£°vt. åˆ®ï¼›æ“¦ä¼¤ï¼›æŒ–æˆvi. åˆ®æŽ‰ï¼›åˆ®å‡ºåˆºè€³å£°1179, scratch [skrÃ¦tÊƒ]n. æ“¦ä¼¤ï¼›æŠ“ç—•ï¼›åˆ®æ“¦å£°ï¼›ä¹±å†™;adj. æ‰“è‰ç¨¿ç”¨çš„ï¼›å‡‘åˆçš„ï¼›ç¢°å·§çš„;vt. æŠ“ï¼›åˆ®ï¼›æŒ–å‡ºï¼›ä¹±æ¶‚;vi. æŠ“ï¼›æ”ï¼›å‘åˆ®æ“¦å£°ï¼›å‹‰å¼ºç³Šå£ï¼›é€€å‡ºæ¯”èµ›1180, screened [screened]adj. ç­›è¿‡çš„ï¼Œå±è”½çš„1181, screw [skruË]vt. æ—‹ï¼Œæ‹§ï¼›åŽ‹æ¦¨ï¼›å¼ºè¿«n. èžºæ—‹ï¼›èžºä¸é’‰ï¼›åå•¬é¬¼vi. è½¬åŠ¨ï¼Œæ‹§1182, scroll [skrÉ™ÊŠl]n. å·è½´ï¼Œç”»å·ï¼›åå†Œï¼›å·å½¢ç‰©;vi. æˆå·å½¢;vt. ä½¿æˆå·å½¢1183, scum [skÊŒm]n. æµ®æ¸£ï¼›æ³¡æ²«ï¼›ç³Ÿç²•vi. äº§ç”Ÿæ³¡æ²«ï¼›è¢«æµ®æ¸£è¦†ç›–vt. å°†æµ®æ¸£åŽ»é™¤æŽ‰1184, segment [â€˜segm(É™)nt]vi. åˆ†å‰²;n. æ®µï¼›éƒ¨åˆ†;vt. åˆ†å‰²1185, selfie []n. è‡ªæ‹ç…§1186, semantics [sÉªâ€™mÃ¦ntÉªks]n. [è¯­] è¯­ä¹‰å­¦ï¼›è¯­ä¹‰è®º1187, semaphore [â€˜semÉ™fÉ”Ë]vi. æ‰“æ——è¯­ï¼›å‘ä¿¡å·;n. ä¿¡å·ï¼›æ——è¯­ï¼›è‡‚æ¿ä¿¡å·æœº;vt. ç”¨ä¿¡å·è”ç»œ1188, semicolon [â€˜sÉ›mÉªkolÉ™n]n. åˆ†å·1189, sensation [senâ€™seÉªÊƒ(É™)n]n. æ„Ÿè§‰ï¼›è½°åŠ¨ï¼›æ„ŸåŠ¨1190, sensibly [â€˜sÉ›nsÉ™bli]adv. æ˜Žæ˜¾åœ°ï¼›å®¹æ˜“æ„ŸçŸ¥åœ°ï¼›èªæ˜Žåœ°1191, sentinel [â€˜sÉ›ntÉªnl]n. å“¨å…µvt. å®ˆå«ï¼Œæ”¾å“¨1192, serial [â€˜sÉªÉ™rÉªÉ™l]adj. è¿žç»­çš„ï¼›è¿žè½½çš„ï¼›åˆ†æœŸå¿è¿˜çš„;n. ç”µè§†è¿žç»­å‰§ï¼›[å›¾æƒ…] æœŸåˆŠï¼›è¿žè½½å°è¯´1193, severely [sÉªâ€™vÉªÉ™lÉª]adv. ä¸¥é‡åœ°ï¼›ä¸¥æ ¼åœ°ï¼Œä¸¥åŽ‰åœ°ï¼›çº¯æœ´åœ°1194, severity [sÉªâ€™verÉªtÉª]n. ä¸¥é‡ï¼›ä¸¥æ ¼ï¼›çŒ›çƒˆ1195, shell [Êƒel]n. å£³ï¼Œè´å£³ï¼›ç‚®å¼¹ï¼›å¤–å½¢vi. å‰¥è½ï¼›è®¾å®šå‘½ä»¤è¡Œè§£é‡Šå™¨çš„ä½ç½®vt. å‰¥çš®ï¼›ç‚®è½°1196, shelter [â€˜ÊƒÉ›ltÉš]n. åº‡æŠ¤ï¼›é¿éš¾æ‰€ï¼›é®ç›–ç‰©vt. ä¿æŠ¤ï¼›ä½¿æŽ©è”½vi. èº²é¿ï¼Œé¿éš¾n. (Shelter)äººåï¼›(è‹±)è°¢å°”ç‰¹1197, shelve [ÊƒÉ›lv]vt. å°†ï¼ˆä¹¦ç­‰ï¼‰æ”¾ç½®åœ¨æž¶å­ä¸Šï¼›æç½®ï¼Œå°†æŸäº‹æ”¾åˆ°ä¸€æ—ä¸äºˆè€ƒè™‘ï¼›å°†â€¦æåœ¨ä¸€è¾¹ï¼›è£…ææž¶äºŽï¼›ç½¢å…vi. ï¼ˆé™†åœ°ï¼‰é€æ¸å€¾æ–œ1198, shenandoah [,ÊƒenÉ™nâ€™dÉ™uÉ™]n. è°¢å—å¤šåŽ„æ²³ï¼ˆç¾Žå›½å¼—å‰å°¼äºšå·žæ²³æµï¼‰ï¼›è°¢å—å¤šåŽ„æ²³è°·ï¼ˆåœ°åï¼‰ï¼›æƒ…äººæ¸¡ï¼Œæ°´æ‰‹ç‘¶ï¼ˆæ­Œæ›²åï¼‰1199, shield [Êƒild]n. ç›¾ï¼›é˜²æŠ¤ç‰©ï¼›ä¿æŠ¤è€…vt. é®è”½ï¼›åŒ…åº‡ï¼›é¿å¼€ï¼›ä¿å«vi. é˜²å¾¡ï¼›èµ·ä¿æŠ¤ä½œç”¨n. (Shield)äººåï¼›(è‹±)å¸Œå°”å¾·1200, Shield [ÊƒiËld]n. ç›¾ï¼›é˜²æŠ¤ç‰©ï¼›ä¿æŠ¤è€… vt. é®è”½ï¼›åŒ…åº‡ï¼›é¿å¼€ï¼›ä¿å« vi. é˜²å¾¡ï¼›èµ·ä¿æŠ¤ä½œç”¨ n. (Shield)äººåï¼›(è‹±)å¸Œå°”å¾·1201, shim [ÊƒÉªm]vt. ç”¨æœ¨ç‰‡æˆ–å¤¹é“å¡«ï¼›å¤¹é“ n. å¡«éš™ç”¨æœ¨ç‰‡ï¼›å¤¹é“ n. (Shim)äººåï¼›(æœ)æ²ˆ1202, shipper [â€˜ÊƒÉªpÉš]n. æ‰˜è¿äººï¼›å‘è´§äººï¼›è´§ä¸»1203, shoehornn. éž‹æ‹” vt. ç¡¬å¡žè¿›1204, shot [ÊƒÉ’t]n. å‘å°„ï¼›ç‚®å¼¹ï¼›å°„æ‰‹ï¼›é•œå¤´;adj. ç”¨å°½çš„ï¼›ç ´æ—§çš„ï¼›æ‚è‰²çš„ï¼Œé—ªå…‰çš„;v. å°„å‡»ï¼ˆshootçš„è¿‡åŽ»å¼å’Œè¿‡åŽ»åˆ†è¯ï¼‰1205, shrimp [ÊƒrÉªmp]n. è™¾ï¼›å°è™¾ï¼›çŸ®å°çš„äººvi. æ•è™¾adj. æœ‰è™¾çš„ï¼›è™¾åˆ¶çš„1206, shrink [ÊƒrÉªÅ‹k]n. æ”¶ç¼©ï¼›ç•ç¼©ï¼›&lt;ä¿š&gt;ç²¾ç¥žç—…å­¦å®¶ vt. ä½¿ç¼©å°ï¼Œä½¿æ”¶ç¼© vi. æ”¶ç¼©ï¼›ç•ç¼©1207, shuffle [â€˜ÊƒÊŒfl]v. æ´—ç‰Œï¼›æŽ¨è¯¿ï¼ŒæŽ¨å¸ï¼›æ‹–æ›³ï¼Œæ…¢åžåžåœ°èµ°ï¼›æ…ä¹±n. æ´—ç‰Œï¼Œæ´—çº¸ç‰Œï¼›æ··ä¹±ï¼Œè’™æ··ï¼›æ‹–ç€è„šèµ°1208, sidecar [â€˜saÉªdkÉ‘r]n. è½»å¿«çš„åŒè½®é©¬è½¦ï¼›è·¨æ–—1209, sidetrack [â€˜saÉªdtrÃ¦k]vt. å°†ï¼ˆç«è½¦ï¼‰[å»º] è½¬åˆ°ä¾§çº¿ï¼›è½¬å˜ï¼ˆè¯é¢˜ï¼‰n. ï¼ˆé“è·¯ï¼‰ä¾§çº¿ï¼›æ¬¡è¦åœ°ä½vi. [å»º] è½¬åˆ°ä¾§çº¿ï¼›è½¬å˜è¯é¢˜1210, sierra [sÉªâ€™erÉ™; sÉªâ€™eÉ™rÉ™]n. [åœ°ç†] é”¯é½¿å±±è„Šï¼›å‘ˆé½¿çŠ¶èµ·ä¼çš„å±±è„‰n. (Sierra)äººåï¼›(æ„ã€è¥¿)è°¢æ‹‰ï¼›(è‹±)è¥¿æ‹‰1211, significant [sÉªÉ¡â€™nÉªfÉªkÉ™nt]adj. é‡å¤§çš„ï¼›æœ‰æ•ˆçš„ï¼›æœ‰æ„ä¹‰çš„ï¼›å€¼å¾—æ³¨æ„çš„ï¼›æ„å‘³æ·±é•¿çš„n. è±¡å¾ï¼›æœ‰æ„ä¹‰çš„äº‹ç‰©1212, silhouette [,sÉªluâ€™É›t]n. è½®å»“ï¼Œå‰ªå½±vt. ä½¿â€¦ç…§å‡ºå½±å­æ¥ï¼›ä½¿â€¦ä»…ä»…æ˜¾å‡ºè½®å»“n. (Silhouette)äººåï¼›(æ³•)è¥¿å¢åŸƒç‰¹1213, Silly [â€˜sÉªlÉª]adj. æ„šè ¢çš„n. å‚»ç“œn. (Silly)äººåï¼›(åŒˆ)å¸Œä¼Šï¼›(æ³•)è¥¿åˆ©1214, simulate [â€˜sÉªmjÊŠleÉªt]vt. æ¨¡ä»¿ï¼›å‡è£…ï¼›å†’å…… adj. æ¨¡ä»¿çš„ï¼›å‡è£…çš„1215, simultaneous [,saÉªmlâ€™tenÉªÉ™s]adj. åŒæ—¶çš„ï¼›è”ç«‹çš„ï¼›åŒæ—¶å‘ç”Ÿçš„n. åŒæ—¶è¯‘å‘˜1216, simultaneously [saÉªmÉ™lâ€™tenÉªÉ™sli]adv. åŒæ—¶åœ°1217, single-minded [â€˜siÅ‹É¡l,â€™maindid]adj. ä¸“å¿ƒçš„ï¼›çº¯çœŸçš„ï¼›çœŸè¯šçš„ï¼›çŽ‡ç›´çš„1218, singular [â€˜sÉªÅ‹gjÊŠlÉ™]adj. å•æ•°çš„ï¼›å•ä¸€çš„ï¼›éžå‡¡çš„ï¼›å¼‚å¸¸çš„ n. å•æ•°1219, singularity [sÉªÅ‹gjÊŠâ€™lÃ¦rÉªtÉª]n. å¥‡å¼‚ï¼›å¥‡ç‚¹ï¼›çªå‡ºï¼›ç¨€æœ‰1220, sink [sÉªÅ‹k]vi. ä¸‹æ²‰ï¼›æ¶ˆæ²‰ï¼›æ¸—é€vt. ä½¿ä¸‹æ²‰ï¼›æŒ–æŽ˜ï¼›ä½¿ä½Žè½n. æ°´æ§½ï¼›æ´—æ¶¤æ§½ï¼›æ±¡æ°´å‘n. (Sink)äººåï¼›(è‹±ã€ç‘žå…¸)è¾›å…‹1221, slack [slÃ¦k]adj. æ¾å¼›çš„ï¼›ç–å¿½çš„ï¼›ä¸æµç•…çš„vi. æ¾æ‡ˆï¼›å‡å¼±n. ç…¤æœ«ï¼›å³¡è°·vt. æ”¾æ¾ï¼›ä½¿ç¼“æ…¢adv. é©¬è™Žåœ°ï¼›ç¼“æ…¢åœ°n. (Slack)äººåï¼›(è‹±)æ–¯èŽ±å…‹1222, slash [slÃ¦Êƒ]vt. çŒ›ç ï¼›éž­æ‰“ï¼›ä¸¥åŽ‰æ‰¹è¯„ï¼›å¤§å¹…åº¦è£å‡æˆ–å‰Šå‡;vi. çŒ›ç ï¼›ä¸¥åŽ‰æ‰¹è¯„;n. å‰Šå‡ï¼›æ–œçº¿ï¼›çŒ›ç ï¼›ç ç—•ï¼›æ²¼æ³½ä½Žåœ°1223, slave [sleÉªv]n. å¥´éš¶ï¼›ä»ŽåŠ¨è£…ç½®;vi. è‹¦å¹²ï¼›æ‹¼å‘½å·¥ä½œ;n. (Slave)äººåï¼›(å¡žã€ç½—)æ–¯æ‹‰éŸ¦1224, slavishly [â€˜slevÉªÊƒli]adv. å¥´éš¶èˆ¬åœ°1225, sleuth [sluËÎ¸]n. ä¾¦æŽ¢ï¼›è­¦çŠ¬ vi. åšä¾¦æŽ¢ï¼›ä¾¦æŸ¥1226, slice [slaÉªs]n. è–„ç‰‡ï¼›éƒ¨åˆ†ï¼›èœåˆ€ï¼Œç«é“²;vt. åˆ‡ä¸‹ï¼›æŠŠâ€¦åˆ†æˆéƒ¨åˆ†ï¼›å°†â€¦åˆ‡æˆè–„ç‰‡;vi. åˆ‡å¼€ï¼›å‰²ç ´1227, slide [slaÉªd]n. æ»‘åŠ¨ï¼›å¹»ç¯ç‰‡ï¼›æ»‘æ¢¯ï¼›é›ªå´©;vi. æ»‘åŠ¨ï¼›æ»‘è½ï¼›ä¸çŸ¥ä¸è§‰é™·å…¥;vt. æ»‘åŠ¨ï¼›ä½¿æ»‘åŠ¨ï¼›æ‚„æ‚„åœ°è¿…é€Ÿæ”¾ç½®1228, sloped []adj. å€¾æ–œçš„;v. å€¾æ–œï¼›ä½¿å€¾æ–œï¼ˆslopeçš„è¿‡åŽ»å¼ï¼‰;1229, slot [slÉ’t]n. ä½ç½®ï¼›ç‹­æ§½ï¼›æ°´æ²Ÿï¼›ç¡¬å¸æŠ•å¸å£;vt. è·Ÿè¸ªï¼›å¼€æ§½äºŽ;n. (Slot)äººåï¼›(è‹±ã€è·)æ–¯æ´›ç‰¹1230, slurp [slÉœËp]vt. å‡ºå£°åœ°åƒæˆ–å– vi. å‡ºå£°åœ°åƒæˆ–å– n. åƒçš„å£°éŸ³ï¼›å•œé£Ÿå£°1231, snack [snÃ¦k]n. å°åƒï¼Œå¿«é¤ï¼›ä¸€ä»½ï¼Œéƒ¨åˆ†;vi. åƒå¿«é¤ï¼Œåƒç‚¹å¿ƒ1232, snap [snÃ¦p]vt. çªç„¶æŠ˜æ–­ï¼Œæ‹‰æ–­ï¼›çŒ›å’¬ï¼›å•ªåœ°å…³ä¸Š;vi. å’¬ï¼›åŽ‰å£°è¯´ï¼›å’¯å—’ä¸€å£°å…³ä¸Š;n. çŒ›å’¬ï¼›åŠˆå•ªå£°ï¼›çªç„¶æŠ˜æ–­;adj. çªç„¶çš„1233, SNAPSHOT [â€˜snÃ¦pÊƒÉ’t]n. å¿«ç…§ï¼Œå¿«ç›¸ï¼›æ€¥å°„ï¼Œé€Ÿå°„ï¼›ç®€å•å°è±¡;vt. ç»™â€¦æ‹å¿«ç…§;vi. æ‹å¿«ç…§1234, sneaker [â€˜sniËkÉ™]n. è¿åŠ¨éž‹ï¼›å‘é„™è€…ï¼›é¬¼é¬¼ç¥Ÿç¥Ÿåšäº‹çš„äºº1235, sneaky [â€˜sniki]adj. é¬¼é¬¼ç¥Ÿç¥Ÿçš„ï¼›æš—ä¸­çš„ï¼Œå‘é„™çš„1236, sniffer [snÉªfÉ™]n. å—…æŽ¢å™¨ï¼›å—…æŽ¢çŠ¬ï¼›ä»¥é¼»å¸æ¯’è€…1237, snippet [â€˜snÉªpÉªt]n. å°ç‰‡ï¼›ç‰‡æ–­ï¼›ä¸çŸ¥å¤©é«˜åœ°åŽšçš„å¹´è½»äºº1238, soap [sÉ™ÊŠp]n. è‚¥çš‚;vt. å°†è‚¥çš‚æ¶‚åœ¨â€¦â€¦ä¸Šï¼›å¯¹â€¦â€¦æ‹é©¬å±ï¼ˆä¿šè¯­ï¼‰;vi. ç”¨è‚¥çš‚æ“¦æ´—1239, sock [sÉ‘k]n. çŸ­è¢œï¼›ä¸€å‡»vt. é‡å‡»ï¼›ç»™â€¦â€¦ç©¿è¢œadv. æ­£ç€åœ°ï¼›ä¸åä¸å€šåœ°adj. éžå¸¸æˆåŠŸçš„n. (Sock)äººåï¼›(å¾·)ä½å…‹1240, sole [sol]n. éž‹åº•ï¼›è„šåº•ï¼›åŸºç¡€ï¼›é³Žç›®é±¼adj. å”¯ä¸€çš„ï¼›å•ç‹¬çš„ï¼›ä»…æœ‰çš„vt. è§¦åº•ï¼›ä¸Šéž‹åº•n. (Sole)äººåï¼›(æ„ã€è¥¿ã€èŠ¬ã€å¡žã€ç½—ã€å—éž)ç´¢èŽ±1241, solid [â€˜sÉ’lÉªd]adj. å›ºä½“çš„ï¼›å¯é çš„ï¼›ç«‹ä½“çš„ï¼›ç»“å®žçš„ï¼›ä¸€è‡´çš„;n. å›ºä½“ï¼›ç«‹æ–¹ä½“;n. (Solid)äººåï¼›(ç‘žå…¸)ç´¢åˆ©å¾·1242, sophisticated [sÉ™â€™fÉªstÉªkeÉªtÉªd]adj. å¤æ‚çš„ï¼›ç²¾è‡´çš„ï¼›ä¹…ç»ä¸–æ•…çš„ï¼›å¯Œæœ‰ç»éªŒçš„;v. ä½¿å˜å¾—ä¸–æ•…ï¼›ä½¿è¿·æƒ‘ï¼›ç¯¡æ”¹ï¼ˆsophisticateçš„è¿‡åŽ»åˆ†è¯å½¢å¼ï¼‰1243, sore [sÉ”Ë]adj. ç–¼ç—›çš„ï¼Œç—›å¿ƒçš„ï¼›å‰§çƒˆçš„ï¼Œæžåº¦çš„ï¼›æ¼ç«çš„ï¼Œå‘æ€’çš„ï¼›åŽ‰å®³çš„ï¼Œè¿«åˆ‡çš„n. æºƒç–¡ï¼Œç—›å¤„ï¼›æ¨äº‹ï¼Œä¼¤å¿ƒäº‹n. (Sore)äººåï¼›(æ³•)ç´¢å°”ï¼›(æ„)ç´¢é›·1244, spawn [spÉ”n]n. åµï¼›èŒä¸ï¼›äº§ç‰©vt. äº§åµï¼›é…¿æˆï¼Œé€ æˆï¼›å¤§é‡ç”Ÿäº§vi. äº§åµï¼›å¤§é‡ç”Ÿäº§1245, spec [spÉ›k]n. æŠ•æœºï¼›è¯´æ˜Žä¹¦ï¼›ç»†åˆ™1246, specific [spÉ™â€™sÉªfÉªk]adj. ç‰¹æ®Šçš„ï¼Œç‰¹å®šçš„ï¼›æ˜Žç¡®çš„ï¼›è¯¦ç»†çš„ï¼›[è¯] å…·æœ‰ç‰¹æ•ˆçš„;n. ç‰¹æ€§ï¼›ç»†èŠ‚ï¼›ç‰¹æ•ˆè¯1247, specification [,spesÉªfÉªâ€™keÉªÊƒ(É™)n]n. è§„æ ¼ï¼›è¯´æ˜Žä¹¦ï¼›è¯¦è¿°1248, Specification [,spesÉªfÉªâ€™keÉªÊƒ(É™)n]n. è§„æ ¼ï¼›è¯´æ˜Žä¹¦ï¼›è¯¦è¿°1249, spike [spaÉªk]n. é•¿é’‰ï¼Œé“é’‰ï¼›é’‰éž‹ï¼›ç»†é«˜è·Ÿvt. é˜»æ­¢ï¼›ä»¥å¤§é’‰é’‰ç‰¢ï¼›ç”¨å°–ç‰©åˆºç©¿n. (Spike)äººåï¼›(ç‘žå…¸)æ–¯çš®å…‹1250, Spinlock [Spinlock]è‡ªæ—‹é”1251, split [splÉªt]vt. åˆ†ç¦»ï¼›ä½¿åˆ†ç¦»ï¼›åŠˆå¼€ï¼›ç¦»å¼€ï¼›åˆ†è§£;vi. ç¦»å¼€ï¼›è¢«åŠˆå¼€ï¼›æ–­ç»å…³ç³»;n. åŠˆå¼€ï¼›è£‚ç¼;adj. åŠˆå¼€çš„1252, sponsor [â€˜spÉ’nsÉ™]n. èµžåŠ©è€…ï¼›ä¸»åŠžè€…ï¼›ä¿è¯äºº vt. èµžåŠ©ï¼›å‘èµ·1253, spouse [spaÊŠz; -s]n. é…å¶vt. å’Œâ€¦ç»“å©šn. (Spouse)äººåï¼›(è‹±)æ–¯æ³¢æ–¯1254, spout [spaÊŠt]n. å–·å£ï¼›æ°´é¾™å·ï¼›æ°´è½ç®¡ï¼›æ°´æŸ±vt. å–·å‡ºï¼›å–·å°„ï¼›æ»”æ»”ä¸ç»åœ°è®²ï¼›æŠŠâ€¦å…¸å½“æŽ‰vi. å–·å‡ºï¼›å–·å°„ï¼›æ»”æ»”ä¸ç»åœ°è®²1255, spurious [â€˜spjÊŠÉ™rÉªÉ™s]adj. å‡çš„ï¼›ä¼ªé€ çš„ï¼›æ¬ºéª—çš„1256, squash [skwÉ”Êƒ]vt. é•‡åŽ‹ï¼›æŠŠâ€¦åŽ‹æ‰ï¼›ä½¿æ²‰é»˜vi. å—æŒ¤åŽ‹ï¼›å‘å‡ºæŒ¤åŽ‹å£°ï¼›æŒ¤å…¥n. å£çƒï¼›æŒ¤åŽ‹ï¼›å’¯å±å£°ï¼›å—ç“œå±žæ¤ç‰©ï¼›ï¼ˆè‹±ï¼‰æžœæ±é¥®æ–™1257, stacked [stÃ¦kt]adj. å¦–è‰³çš„ï¼›ï¼ˆå¥³äººï¼‰èº«æä¸°æ»¡åŒ€ç§°çš„v. å †æ”¾ï¼ˆstackçš„è¿‡åŽ»åˆ†è¯ï¼‰1258, stage [steÉªdÊ’]n. é˜¶æ®µï¼›èˆžå°ï¼›æˆå‰§ï¼›é©¿ç«™ vt. ä¸¾è¡Œï¼›ä¸Šæ¼”ï¼›ç­¹åˆ’ vi. ä¸¾è¡Œï¼›é€‚äºŽä¸Šæ¼”ï¼›ä¹˜é©¿è½¦æ—…è¡Œ n. (Stage)äººåï¼›(è‹±)æ–¯ç‰¹å¥‡1259, stale [stel]adj. é™ˆè…çš„ï¼›ä¸æ–°é²œçš„vi. å˜é™ˆæ—§ï¼›æ’’å°¿ï¼›å˜å¾—ä¸æ–°é²œvt. ä½¿å˜æ—§ï¼›å˜å¾—ä¸æ–°é²œn. å°¿n. (Stale)äººåï¼›(å¡ž)æ–¯å¡”èŽ±1260, Stale [steÉªl]adj. é™ˆè…çš„ï¼›ä¸æ–°é²œçš„;vi. å˜é™ˆæ—§ï¼›æ’’å°¿ï¼›å˜å¾—ä¸æ–°é²œ;vt. ä½¿å˜æ—§ï¼›å˜å¾—ä¸æ–°é²œ;n. å°¿;n. (Stale)äººåï¼›(å¡ž)æ–¯å¡”èŽ±1261, staleness [staleness]n. è…è´¥ï¼›é™ˆè…ï¼›ä¸æ–°é²œï¼›æ³„æ°”1262, stamp [stÃ¦mp]n. é‚®ç¥¨ï¼›å°è®°ï¼›æ ‡å¿—ï¼›è·ºè„švt. é“­è®°ï¼›æ ‡å‡ºï¼›ç›–ç« äºŽâ€¦ï¼›è´´é‚®ç¥¨äºŽâ€¦ï¼›ç”¨è„šè¸©è¸vi. è·ºè„šï¼›æ£ç¢Žï¼›æ¯æŽ‰n. (Stamp)äººåï¼›(å¾·)æ–½å¦æ™®ï¼›(è‹±)æ–¯å¦æ™®1263, stamped [stÃ¦mpt]adj. é“­åˆ»çš„ï¼›ç›–ä¸Šé‚®æˆ³çš„ï¼›é¡¿è¶³çš„ v. è´´ä¸Šé‚®ç¥¨ï¼ˆstampçš„è¿‡åŽ»å¼ï¼‰ï¼›é¡¿è¶³1264, stand-alone [â€˜stÃ¦ndÉ™,lon]n. ç‹¬ç«‹ï¼›å•æœºadj. ç‹¬ç«‹çš„ï¼›ç‹¬ç«‹æ“ä½œçš„1265, standardization [,stÃ¦ndÉ™daÉªâ€™zeÉªÊƒÉ™n]n. æ ‡å‡†åŒ–ï¼›[æ•°] è§„æ ¼åŒ–ï¼›æ ¡å‡†1266, stashn. è—åŒ¿å¤„ï¼›è—åŒ¿ç‰©vt. å­˜æ”¾ï¼›è´®è—vi. å­˜æ”¾ï¼›è—èµ·æ¥1267, statement [â€˜steÉªtm(É™)nt]n. å£°æ˜Žï¼›é™ˆè¿°ï¼Œå™è¿°ï¼›æŠ¥è¡¨ï¼Œæ¸…å•1268, statistic [stÉ™â€™tÉªstÉªk]adj. ç»Ÿè®¡çš„ï¼Œç»Ÿè®¡å­¦çš„;n. ç»Ÿè®¡æ•°å€¼1269, statisticiann. ç»Ÿè®¡å­¦å®¶ï¼Œç»Ÿè®¡å‘˜1270, stdoutabbr. æ ‡å‡†è¾“å‡ºï¼ˆstandard outputï¼‰1271, STEADY [â€˜stedÉª]adj. ç¨³å®šçš„ï¼›ä¸å˜çš„ï¼›æ²‰ç€çš„;vi. ç¨³å›º;vt. ä½¿ç¨³å®šï¼›ç¨³å›ºï¼›ä½¿åšå®š;adv. ç¨³å®šåœ°ï¼›ç¨³å›ºåœ°;n. å…³ç³»å›ºå®šçš„æƒ…ä¾£ï¼›å›ºå®šæ”¯æž¶1272, stem [stem]n. å¹²ï¼›èŒŽï¼›èˆ¹é¦–ï¼›è¡€ç»Ÿ;vt. é˜»æ­¢ï¼›é™¤åŽ»â€¦çš„èŒŽï¼›ç»™â€¦è£…æŸ„;vi. é˜»æ­¢ï¼›èµ·æºäºŽæŸäº‹ç‰©ï¼›é€†è¡Œ1273, stereotype [â€˜stÉ›rÉªÉ™taÉªp]vt. ä½¿ç”¨é“…ç‰ˆï¼›å¥—ç”¨è€å¥—ï¼Œä½¿ä¸€æˆä¸å˜n. é™ˆè…”æ»¥è°ƒï¼Œè€å¥—ï¼›é“…ç‰ˆ1274, sticker [â€˜stÉªkÉ™]n. å°–åˆ€ï¼›éš¾é¢˜ï¼›å¼ è´´ç‰©ï¼›åšæŒä¸æ‡ˆçš„äºº;vt. ç»™â€¦è´´ä¸Šæ ‡ç­¾ä»·;adj. æ±½è½¦ä»·ç›®æ ‡ç­¾çš„ï¼›æ±½è½¦æ ‡ç­¾ä»·çš„;n. (Sticker)äººåï¼›(å¾·)æ–½è’‚å…‹1275, stitch [stÉªtÊƒ]n. é’ˆè„šï¼Œçº¿è¿¹ï¼›ä¸€é’ˆ vt. ç¼ï¼Œç¼åˆ vi. ç¼ï¼Œç¼åˆ1276, straightforward [streÉªtâ€™fÉ”ËwÉ™d]adj. ç®€å•çš„ï¼›å¦çŽ‡çš„ï¼›æ˜Žç¡®çš„ï¼›å¾„ç›´çš„ adv. ç›´æˆªäº†å½“åœ°ï¼›å¦çŽ‡åœ°1277, strange [strendÊ’]adj. å¥‡æ€ªçš„ï¼›é™Œç”Ÿçš„ï¼›å¤–è¡Œçš„adv. å¥‡æ€ªåœ°ï¼›é™Œç”Ÿåœ°ï¼Œå†·æ·¡åœ°n. (Strange)äººåï¼›(è‹±)æ–¯ç‰¹å…°å¥‡ï¼›(ç‘žå…¸ã€å¡ž)æ–¯ç‰¹æœ—æ ¼1278, strategist [â€˜strÃ¦tÉ™dÊ’Éªst]n. æˆ˜ç•¥å®¶ï¼›å†›äº‹å®¶1279, strategy [â€˜strÃ¦tÉªdÊ’Éª]n. æˆ˜ç•¥ï¼Œç­–ç•¥1280, stratum [â€˜strÉ‘ËtÉ™m; â€˜streÉªtÉ™m]n. ï¼ˆç»„ç»‡çš„ï¼‰å±‚ï¼›[åœ°è´¨] åœ°å±‚ï¼›ç¤¾ä¼šé˜¶å±‚1281, strict [strÉªkt]adj. ä¸¥æ ¼çš„ï¼›ç»å¯¹çš„ï¼›ç²¾ç¡®çš„ï¼›è¯¦ç»†çš„1282, stride [straÉªd]n. å¤§æ­¥ï¼›æ­¥å¹…ï¼›è¿›å±•vt. è·¨è¿‡ï¼›å¤§è¸æ­¥èµ°è¿‡ï¼›è·¨ååœ¨â€¦vi. è·¨ï¼›è·¨è¿‡ï¼›å¤§æ­¥è¡Œèµ°è¿‡åŽ»å¼:strode; è¿‡åŽ»åˆ†è¯:stridden; çŽ°åœ¨åˆ†è¯:striding1283, strip [strÉªp]vt. å‰¥å¤ºï¼›å‰¥åŽ»ï¼›è„±åŽ»è¡£æœn. å¸¦ï¼›æ¡çŠ¶ï¼›è„±è¡£èˆžvi. è„±åŽ»è¡£æœ1284, striped [straÉªpt]adj. æœ‰æ¡çº¹çš„ï¼›æœ‰æ–‘çº¹çš„;v. è¢«å‰¥åŽ»ï¼ˆstripçš„è¿‡åŽ»åˆ†è¯ï¼‰1285, structural [â€˜strÊŒktÊƒ(É™)r(É™)l]adj. ç»“æž„çš„ï¼›å»ºç­‘çš„1286, Stub [stÊŒb]n. å­˜æ ¹ï¼›çƒŸè’‚ï¼›æ ‘æ¡©ï¼›æ–­æ ª;vt. è¸©ç†„ï¼›è¿žæ ¹æ‹”é™¤;n. (Stub)äººåï¼›(æŒªã€ç‘žå…¸)æ–¯å›¾å¸ƒ1287, stuff [stÊŒf]n. ä¸œè¥¿ï¼›ææ–™ï¼›å¡«å……ç‰©ï¼›ç´ æèµ„æ–™vt. å¡žæ»¡ï¼›å¡«å¡žï¼›è®©åƒé¥±vi. åƒå¾—è¿‡å¤š1288, subdivide [â€˜sÊŒbdÉªvaÉªd]vi. ç»†åˆ†ï¼Œå†åˆ†vt. æŠŠâ€¦â€¦å†åˆ†ï¼ŒæŠŠâ€¦â€¦ç»†åˆ†1289, subject [â€˜sÊŒbdÊ’ekt; â€˜sÊŒbdÊ’Éªkt]n. ä¸»é¢˜ï¼›ç§‘ç›®ï¼›[è¯­] ä¸»è¯­ï¼›å›½æ°‘;adj. æœä»Žçš„ï¼›æ˜“æ‚£â€¦çš„ï¼›å—åˆ¶äºŽâ€¦çš„;vt. ä½¿â€¦éš¶å±žï¼›ä½¿å±ˆä»ŽäºŽâ€¦1290, subscribe [sÉ™bâ€™skraÉªb]vi. è®¢é˜…ï¼›ææ¬¾ï¼›è®¤è´­ï¼›èµžæˆï¼›ç­¾ç½² vt. ç­¾ç½²ï¼›èµžæˆï¼›æåŠ©1291, Subscription [sÉ™bâ€™skrÉªpÊƒ(É™)n]n. æçŒ®ï¼›è®¢é˜…ï¼›è®¢é‡‘ï¼›ç­¾ç½²1292, subsequent [â€˜sÊŒbsÉªkw(É™)nt]adj. åŽæ¥çš„ï¼ŒéšåŽçš„1293, substitute [â€˜sÊŒbstÉªtut]n. ä»£ç”¨å“ï¼›ä»£æ›¿è€…vi. æ›¿ä»£vt. ä»£æ›¿1294, suddenly [ËˆsÊŒdnlÉª]adv. çªç„¶åœ°ï¼›å¿½ç„¶1295, suit [suËt]vt. é€‚åˆï¼›ä½¿é€‚åº”n. è¯‰è®¼ï¼›æ³æ±‚ï¼›å¥—è£…ï¼›ä¸€å¥—å¤–è¡£vi. åˆé€‚ï¼›ç›¸ç§°1296, suite [sut; swit]n. ï¼ˆä¸€å¥—ï¼‰å®¶å…·ï¼›å¥—æˆ¿ï¼›ç»„æ›²ï¼›ï¼ˆä¸€æ‰¹ï¼‰éšå‘˜ï¼Œéšä»Ž1297, summedv. æ€»è®¡ï¼Œæ¦‚æ‹¬ï¼Œæ€»ç»“ï¼ˆsumçš„è¿‡åŽ»æ—¶å’Œè¿‡åŽ»åˆ†è¯ï¼‰1298, supercede [supercede]vt. å–ä»£ï¼›å»¶æœŸï¼›ç´§æŽ¥ç€â€¦è€Œåˆ°æ¥vi. æŽ¨è¿Ÿè¡ŒåŠ¨1299, supersededadj. ä½œåºŸçš„ï¼›è¢«å–ä»£çš„v. å–ä»£ï¼›å…‹åˆ¶ï¼›åºŸå¼ƒï¼ˆsupersedeçš„è¿‡åŽ»åˆ†è¯ï¼‰1300, superset [superset]n. [æ•°] è¶…é›†1301, supervise [â€˜suËpÉ™vaÉªz; â€˜sjuË-]vt. ç›‘ç£ï¼Œç®¡ç†ï¼›æŒ‡å¯¼vi. ç›‘ç£ï¼Œç®¡ç†ï¼›æŒ‡å¯¼1302, supervisor [â€˜supÉšvaÉªzÉš]n. ç›‘ç£äººï¼Œ[ç®¡ç†] ç®¡ç†äººï¼›æ£€æŸ¥å‘˜1303, supplemental [,sÊŒplÉ™â€™mÉ›ntl]adj. è¡¥å……çš„ï¼ˆç­‰äºŽsupplementaryï¼‰ï¼›è¿½åŠ çš„1304, supplier [sÉ™â€™plaÉªÉ™]n. ä¾›åº”åŽ‚å•†ï¼Œä¾›åº”å›½ï¼›ä¾›åº”è€…1305, supreme [suËâ€™priËm]adj.æœ€é«˜çš„ï¼›è‡³é«˜çš„ï¼›æœ€é‡è¦çš„n.è‡³é«˜ï¼›éœ¸æƒ1306, survey [ËˆsÉœËveÉª]n. è°ƒæŸ¥ï¼›æµ‹é‡ï¼›å®¡è§†ï¼›çºµè§ˆ;vt. è°ƒæŸ¥ï¼›å‹˜æµ‹ï¼›ä¿¯çž°;vi. æµ‹é‡åœŸåœ°1307, survivor [sÉ™â€™vaÉªvÉ™]n. å¹¸å­˜è€…ï¼›ç”Ÿè¿˜è€…ï¼›æ®‹å­˜ç‰©1308, susceptible [sÉ™â€™septÉªb(É™)l]adj. æ˜“å—å½±å“çš„ï¼›æ˜“æ„ŸåŠ¨çš„ï¼›å®¹è®¸â€¦çš„ n. æ˜“å¾—ç—…çš„äºº1309, symmetric [sÉªâ€™metrÉªk]adj. å¯¹ç§°çš„ï¼›åŒ€ç§°çš„1310, synonyms [ËˆsÉªnÉ™nÉªm]n. [è¯­] åŒä¹‰è¯ï¼ŒåŒä¹‰å­—ï¼›åŒä¸€æ€§ï¼ˆsynonymçš„å¤æ•°ï¼‰1311, synopsis [sÉªâ€™nÉ‘psÉªs]n. æ¦‚è¦ï¼Œå¤§çº²1312, syntactically [sÉªnâ€™tÃ¦ktÉªkli]adv. ä¾ç…§å¥æ³•åœ°ï¼›åœ¨è¯­å¥æž„æˆä¸Š1313, synthetic [sÉªnâ€™Î¸etÉªk]adj.ç»¼åˆçš„ï¼›åˆæˆçš„ï¼Œäººé€ çš„n.åˆæˆç‰©1314, systematic [sÉªstÉ™â€™mÃ¦tÉªk]adj. ç³»ç»Ÿçš„ï¼›ä½“ç³»çš„ï¼›æœ‰ç³»ç»Ÿçš„ï¼›[å›¾æƒ…] åˆ†ç±»çš„ï¼›ä¸€è´¯çš„ï¼Œæƒ¯å¸¸çš„1315, tactic [â€˜tÃ¦ktÉªk]n. ç­–ç•¥ï¼Œæˆ˜ç•¥adj. æŒ‰é¡ºåºçš„ï¼Œä¾æ¬¡æŽ’åˆ—çš„1316, tail [teÉªl]n. å°¾å·´ï¼›è¸ªè¿¹ï¼›è¾«å­ï¼›ç‡•å°¾æœvt. å°¾éšï¼›è£…ä¸Šå°¾å·´vi. è·Ÿè¸ªï¼›å˜å°‘æˆ–ç¼©å°adj. ä»ŽåŽé¢è€Œæ¥çš„ï¼›å°¾éƒ¨çš„1317, taint [tent]vt. æ±¡æŸ“ï¼›è…èš€ï¼›ä½¿æ„ŸæŸ“n. æ±¡ç‚¹ï¼›æ„ŸæŸ“vi. è´¥åï¼›è¢«æ±¡æŸ“1318, tamper [â€˜tÃ¦mpÉ™]vi. ç¯¡æ”¹ï¼›å¹²é¢„ï¼›æŸå®³ï¼›å‰Šå¼±ï¼›çŽ©å¼„ï¼›è´¿èµ‚;vt. ç¯¡æ”¹;n. å¡«å¡žè€…ï¼›æ£æ£’1319, Tarball [Tarball]n. åŽŸå§‹ç ï¼›ï¼ˆLinuxä¸‹æœ€æ–¹ä¾¿çš„ï¼‰æ‰“åŒ…å·¥å…·1320, tasty [â€˜teÉªstÉª]adj. ç¾Žå‘³çš„ï¼›é«˜é›…çš„ï¼›æœ‰è¶£çš„;n. å¯å£çš„ä¸œè¥¿ï¼›å¼•äººå…¥èƒœçš„ä¸œè¥¿1321, technique [tekâ€™niËk]n. æŠ€å·§ï¼ŒæŠ€æœ¯ï¼›æ‰‹æ³•1322, telemetry [tÉ™â€™lÉ›mÉ™tri]n. [è‡ª] é¥æµ‹æŠ€æœ¯ï¼›é¥æ„Ÿå‹˜æµ‹ï¼›è‡ªåŠ¨æµ‹é‡è®°å½•ä¼ å¯¼1323, tempo [â€˜tempÉ™ÊŠ]n. é€Ÿåº¦ï¼Œå‘å±•é€Ÿåº¦ï¼›æ‹å­n. (Tempo)äººåï¼›(æ„)æ»•æ³¢1324, temptation [tem(p)â€™teÉªÊƒ(É™)n]n. å¼•è¯±ï¼›è¯±æƒ‘ç‰©1325, tenant [â€˜tÉ›nÉ™nt]n. æ‰¿ç§Ÿäººï¼›æˆ¿å®¢ï¼›ä½ƒæˆ·ï¼›å±…ä½è€…vt. ç§Ÿå€Ÿï¼ˆå¸¸ç”¨äºŽè¢«åŠ¨è¯­æ€ï¼‰n. (Tenant)äººåï¼›(æ³•)ç‰¹å—1326, tenure [â€˜tenjÉ™]n. ä»»æœŸï¼›å æœ‰vt. æŽˆäºˆâ€¦ç»ˆèº«èŒä½1327, term [tÉm]n. æœ¯è¯­ï¼›å­¦æœŸï¼›æœŸé™ï¼›æ¡æ¬¾ï¼›(ä»£æ•°å¼ç­‰çš„)é¡¹vt. æŠŠâ€¦å«åšn. (Term)äººåï¼›(æ³°)ä¸1328, terminology [,tÉœËmÉªâ€™nÉ’lÉ™dÊ’Éª]n. æœ¯è¯­ï¼Œæœ¯è¯­å­¦ï¼›ç”¨è¾ž1329, terminus [â€˜tÉmÉªnÉ™s]n. ç»ˆç‚¹ï¼›ç»ˆç‚¹ç«™ï¼›ç•Œæ ‡ï¼›ç•ŒçŸ³1330, territory [â€˜terÉªt(É™)rÉª]n. é¢†åœŸï¼Œé¢†åŸŸï¼›èŒƒå›´ï¼›åœ°åŸŸï¼›ç‰ˆå›¾1331, testimonial [,testÉªâ€™mÉ™ÊŠnÉªÉ™l]n.è¯æ˜Žä¹¦ï¼›æŽ¨èä¹¦adj.è¯æ˜Žçš„ï¼›è¤’å¥–çš„ï¼›è¡¨æ‰¬çš„1332, theta [â€˜Î¸itÉ™]n. å¸Œè…Šå­—æ¯çš„ç¬¬å…«å­—ï¼›æ—¶é—´é€’è€—å€¼1333, thin [Î¸Éªn]adj. è–„çš„ï¼›ç˜¦çš„ï¼›ç¨€è–„çš„ï¼›å¾®å¼±çš„;vt. ä½¿ç˜¦ï¼›ä½¿æ·¡ï¼›ä½¿ç¨€ç–;vi. å˜è–„ï¼›å˜ç˜¦ï¼›å˜æ·¡;adv. ç¨€ç–åœ°ï¼›å¾®å¼±åœ°;n. ç»†å°éƒ¨åˆ†;n. (Thin)äººåï¼›(è¶Š)è¾°ï¼›(æŸ¬)å»·1334, threshold [â€˜Î¸reÊƒÉ™ÊŠld; â€˜Î¸reÊƒ,hÉ™ÊŠld]n. å…¥å£ï¼›é—¨æ§›ï¼›å¼€å§‹ï¼›æžé™ï¼›ä¸´ç•Œå€¼1335, thresholds [â€˜Î¸rÉ›Êƒhold]n. é˜ˆå€¼ï¼›[å»º] é—¨æ§›ï¼›ä¸´ç•Œå€¼å€¼ï¼ˆthresholdçš„å¤æ•°ï¼‰1336, thrift [Î¸rÉªft]n. èŠ‚ä¿­ï¼›èŠ‚çº¦ï¼›[æ¤] æµ·çŸ³ç«¹n. (Thrift)äººåï¼›(è‹±)æ€é‡Œå¤«ç‰¹1337, thrilled [Î¸rÉªld]adj. éžå¸¸å…´å¥‹çš„ï¼›æžä¸ºæ¿€åŠ¨çš„;v. æ¿€åŠ¨ï¼ˆthrillçš„è¿‡åŽ»å¼ï¼‰ï¼›[åŒ»] éœ‡é¢¤1338, throttle [â€˜Î¸rÉ‘tl]n. èŠ‚æµé˜€ï¼›[è½¦è¾†] é£Žé—¨ï¼›å–‰å’™vt. åŽ‹åˆ¶ï¼Œæ‰¼æ€ï¼›ä½¿â€¦â€¦çª’æ¯ï¼›ä½¿â€¦â€¦èŠ‚æµvi. èŠ‚æµï¼Œå‡é€Ÿï¼›çª’æ¯1339, throughput [â€˜Î¸rÊŠâ€™pÊŠt]n. ç”Ÿäº§é‡ï¼Œç”Ÿäº§èƒ½åŠ›1340, thumbnail [â€˜Î¸ÊŒmneÉªl]n. æ‹‡æŒ‡æŒ‡ç”²ï¼›æžå°çš„ä¸œè¥¿ï¼›çŸ­æ–‡;adj. æžå°çš„ï¼ŒæžçŸ­çš„1341, tick [tÉªk]vt. æ ‡è®°å·äºŽï¼›æ»´ç­”åœ°è®°å½•n. æ»´ç­”å£°ï¼›æ‰è™±ï¼›è®°å·ï¼›èµŠæ¬ vi. å‘å‡ºæ»´ç­”å£°ï¼›æ ‡ä»¥è®°å·n. (Tick)äººåï¼›(åŒˆã€èŠ¬)è’‚å…‹1342, tie [taÉª]vt. ç³»ï¼›çº¦æŸï¼›æ‰“ç»“ï¼›ä¸Žâ€¦æˆå¹³å±€vi. æ‰“ç»“ï¼›ä¸åˆ†èƒœè´Ÿï¼›è¢«ç”¨å¸¦ï¼ˆæˆ–ç»³å­ç­‰ï¼‰ç³»ä½n. é¢†å¸¦ï¼›å¹³å±€ï¼›éž‹å¸¦ï¼›é¢†ç»“ï¼›ä¸åˆ†èƒœè´Ÿn. (Tie)äººåï¼›(ä¸œå—äºšå›½å®¶åŽè¯­)æ²»ï¼›(è‹±)æ³°ä¼Šï¼›(æŸ¬)ç‹„1343, tie-breaking [tie-breaking]adj. å¹³å±€å†³èƒœçš„ï¼›æ‰“ç ´åƒµå±€çš„1344, tier [tÉªr]n. å±‚ï¼ŒæŽ’ï¼›è¡Œï¼Œåˆ—ï¼›ç­‰çº§vt. ä½¿å±‚å vi. æˆé€’å‡å¾˜åˆ—n. (Tier)äººåï¼›(è‹±)è’‚å°”1345, tiesn. ç»“v. ç»‘ï¼›è¿žç»“1346, toggle [â€˜tÉ’g(É™)l]vt. æ‹´ç‰¢ï¼Œç³»ç´§;n. å¼€å…³ï¼Œè§¦å‘å™¨ï¼›æ‹´æ‰£ï¼›[èˆ¹] å¥—ç´¢é’‰1347, Tokenizern. åˆ†è¯å™¨ï¼›ç¼–è¯‘å™¨1348, tolerable [â€˜tÉ’l(É™)rÉ™b(É™)l]adj. å¯ä»¥çš„ï¼›å¯å®¹å¿çš„1349, tolerate [â€˜tÉ’lÉ™reÉªt]vt. å¿å—ï¼›é»˜è®¸ï¼›å®½æ•1350, topology [tÉ™ËˆpÉ‘lÉ™dÊ’i]n. æ‹“æ‰‘å­¦1351, tracker [â€˜trÃ¦kÉ™]n. æ‹‰çº¤è€…ï¼Œçº¤å¤«ï¼›è¿½è¸ªç³»ç»Ÿï¼Œ[è‡ª] è·Ÿè¸ªè£…ç½®ï¼›è¿½è¸ªè€…1352, trade offæƒè¡¡ï¼›å–æŽ‰ï¼›äº¤æ›¿ä½¿ç”¨ï¼›äº¤æ›¿æ¢ä½1353, tradeoff [â€˜tred,É”f]n. æƒè¡¡ï¼›æŠ˜è¡·ï¼›ï¼ˆå…¬å¹³ï¼‰äº¤æ˜“ï¼ˆç­‰äºŽtrade-offï¼‰1354, tradeoffs [â€˜tred,É”f]n. æƒè¡¡ï¼›æŠ˜è¡·ï¼›ï¼ˆå…¬å¹³ï¼‰äº¤æ˜“ï¼ˆç­‰äºŽtrade-offï¼‰1355, transform [trÃ¦nsâ€™fÉ”Ëm; trÉ‘Ëns-; -nz-]vt. æ”¹å˜ï¼Œä½¿â€¦å˜å½¢ï¼›è½¬æ¢;vi. å˜æ¢ï¼Œæ”¹å˜ï¼›è½¬åŒ–1356, transformation [trÃ¦nsfÉ™â€™meÉªÊƒ(É™)n; trÉ‘Ëns-; -nz-]n. [é—] è½¬åŒ–ï¼›è½¬æ¢ï¼›æ”¹é©ï¼›å˜å½¢1357, transient [â€˜trÃ¦nzÉªÉ™nt]adj. çŸ­æš‚çš„ï¼›è·¯è¿‡çš„;n. çž¬å˜çŽ°è±¡ï¼›è¿‡å¾€æ—…å®¢ï¼›å€™é¸Ÿ1358, transition [trÃ¦nâ€™zÉªÊƒ(É™)n; trÉ‘Ën-; -â€˜sÉªÊƒ-]n. è¿‡æ¸¡ï¼›è½¬å˜ï¼›[åˆ†å­ç”Ÿç‰©] è½¬æ¢ï¼›å˜è°ƒ1359, transitive [â€˜trÃ¦nsÉªtÉªv; â€˜trÉ‘Ëns-; -nz-]adj. åŠç‰©çš„ï¼›è¿‡æ¸¡çš„ï¼›å¯è¿çš„;n. ä¼ é€’ï¼›åŠç‰©åŠ¨è¯1360, transparently [â€˜trÃ¦nsâ€™pÉ›rÉ™ntli]adv. æ˜¾ç„¶åœ°ï¼Œæ˜“è§‰å¯Ÿåœ°ï¼›æ˜Žäº®åœ°1361, traversal [trÉ™ËˆvÉ™rs(É™)l]n. [è®¡] éåŽ†ï¼›æ¨ªè¶Šï¼›æ¨ªæ–­ç‰©1362, traverse [â€˜trÃ¦vÉ™s; trÉ™â€™vÉœËs]n. ç©¿è¿‡ï¼›æ¨ªè´¯ï¼›æ¨ªæœ¨ vt. ç©¿è¿‡ï¼›åå¯¹ï¼›è¯¦ç»†ç ”ç©¶ï¼›åœ¨â€¦æ¥å›žç§»åŠ¨ vi. æ¨ªè¶Šï¼›æ—‹è½¬ï¼›æ¥å›žç§»åŠ¨ adj. æ¨ªè´¯çš„ n. (Traverse)äººåï¼›(è‹±)ç‰¹æ‹‰å¼—æ–¯ï¼›(æ³•)ç‰¹æ‹‰éŸ¦å°”æ–¯1363, traversing [â€˜trÃ¦vÉs]n. ç©¿è¶Šï¼Œé€šè¿‡;v. ç©¿è¿‡ï¼ˆtraverseçš„ingå½¢å¼ï¼‰ï¼›æ¨ªè¶Š1364, Tray [treÉª]n. æ‰˜ç›˜ï¼›æ–‡ä»¶ç›’ï¼›éš”åº•åŒ£ï¼›ï¼ˆæ— çº¿ç”µçš„ï¼‰å‘å°„ç®±1365, tremendously [trÉªâ€™mÉ›ndÉ™sli]adv. éžå¸¸åœ°ï¼›å¯æ€•åœ°ï¼›æƒŠäººåœ°1366, trends [trendz]n. åŠ¨æ€ï¼Œ[ç»Ÿè®¡] è¶‹åŠ¿1367, trial [â€˜traÉªÉ™l]n. è¯•éªŒï¼›å®¡è®¯ï¼›åŠªåŠ›ï¼›ç£¨ç‚¼;adj. è¯•éªŒçš„ï¼›å®¡è®¯çš„;n. (Trial)äººåï¼›(æ³•)ç‰¹é‡Œäºšå°”1368, tribe [traÉªb]n. éƒ¨è½ï¼›æ—ï¼›å®—æ—ï¼›ä¸€ä¼™n. (Tribe)äººåï¼›(è‹±)ç‰¹èµ–å¸ƒ1369, tricky [â€˜trÉªkÉª]adj. ç‹¡çŒ¾çš„ï¼›æœºè­¦çš„1370, trident [â€˜traÉªdnt]n. ä¸‰å‰æˆŸï¼›[æ•°] ä¸‰å‰çº¿ï¼›ä¸‰é½¿é±¼å‰1371, trillion [â€˜trÉªljÉ™n]n. [æ•°] ä¸‡äº¿ adj. ä¸‡äº¿çš„ num. [æ•°] ä¸‡äº¿1372, trivia [â€˜trÉªvÉªÉ™]n. çäº‹1373, trivial [â€˜trÉªvÉªÉ™l]adj. ä¸é‡è¦çš„ï¼Œçç¢Žçš„ï¼›çç»†çš„1374, tropic [â€˜trÉ’pÉªk]n. çƒ­å¸¦ï¼›å›žå½’çº¿adj. çƒ­å¸¦çš„1375, troubleshootingn. è§£å†³çº·äº‰ï¼›å‘çŽ°å¹¶ä¿®ç†æ•…éšœv. æ£€ä¿®ï¼ˆtroubleshootçš„ingå½¢å¼ï¼‰ï¼›å½“è°ƒè§£äºº1376, trunk [trÊŒÅ‹k]n. æ ‘å¹²ï¼›èº¯å¹²ï¼›è±¡é¼»ï¼›æ±½è½¦è½¦å°¾çš„è¡ŒæŽç®±;vt. æŠŠâ€¦æ”¾å…¥æ—…è¡Œç®±å†…;adj. å¹²çº¿çš„ï¼›èº¯å¹²çš„ï¼›ç®±å­çš„;n. (Trunk)äººåï¼›(å¾·ã€åŒˆã€è¥¿)ç‰¹ä¼¦å…‹1377, tunable [â€˜tjÊŠnÉ™bl]adj. å¯è°ƒè°çš„ï¼›å¯è°ƒéŸ³çš„ï¼›å’Œè°çš„ï¼›éŸ³è°ƒç¾Žçš„1378, tune [tun]n. æ›²è°ƒï¼›å’Œè°ï¼›å¿ƒæƒ…vt. è°ƒæ•´ï¼›ä½¿ä¸€è‡´ï¼›ä¸ºâ€¦è°ƒéŸ³vi. [ç”µå­][é€šä¿¡] è°ƒè°ï¼›åè°ƒn. (Tune)äººåï¼›(è‹±)å›¾æ©1379, tunnel [â€˜tÊŒnl]n. éš§é“ï¼›å‘é“ï¼›æ´žç©´é€šé“vt. æŒ–ï¼›åœ¨â€¦æ‰“å¼€é€šé“ï¼›åœ¨â€¦æŒ–æŽ˜éš§é“vi. æŒ–æŽ˜éš§é“ï¼›æ‰“å¼€é€šé“1380, tutorial [tjuËâ€™tÉ”ËrÉªÉ™l]adj. è¾…å¯¼çš„ï¼›å®¶åº­æ•™å¸ˆçš„ï¼Œä¸ªåˆ«æŒ‡å¯¼çš„;n. ä¸ªåˆ«æŒ‡å¯¼1381, tweak [twik]n. æ‰­ï¼›æ‹§ï¼›ç„¦æ€¥vt. æ‰­ï¼›ç”¨åŠ›æ‹‰ï¼›å¼€è¶³é©¬åŠ›1382, tweet [twiËt]n. å°é¸Ÿå«å£°ï¼›è‡ªå½•éŸ³å†çŽ°è£…ç½®å‘å‡ºçš„é«˜éŸ³ï¼›æŽ¨ç‰¹;vi. å±å±åœ°å«ï¼›å•¾é¸£1383, ubiquitous [juËâ€™bÉªkwÉªtÉ™s]adj. æ™®éå­˜åœ¨çš„ï¼›æ— æ‰€ä¸åœ¨çš„1384, unary [â€˜juËnÉ™rÉª]adj. [æ•°] ä¸€å…ƒçš„1385, unassignedadj. æœªæ´¾èŒåŠ¡çš„ï¼›æœªèµ‹å€¼çš„1386, uncle [â€˜ÊŒÅ‹k(É™)l]n. å”å”ï¼›ä¼¯çˆ¶ï¼›ä¼¯ä¼¯ï¼›èˆ…çˆ¶ï¼›å§¨ä¸ˆï¼›å§‘çˆ¶1387, undelivered [,ÊŒndÉªâ€™lÉªvÉšd]adj. æœªè¢«é‡Šæ”¾çš„ï¼›æœªé€è¾¾çš„1388, undergo [,ÊŒndÉšâ€™É¡o]vt. ç»åŽ†ï¼Œç»å—ï¼›å¿å—1389, underlying [ÊŒndÉ™â€™laÉªÉªÅ‹]adj. æ½œåœ¨çš„ï¼›æ ¹æœ¬çš„ï¼›åœ¨ä¸‹é¢çš„ï¼›ä¼˜å…ˆçš„;v. æ”¾åœ¨â€¦çš„ä¸‹é¢ï¼›ä¸ºâ€¦çš„åŸºç¡€ï¼›ä¼˜å…ˆäºŽï¼ˆunderlieçš„ingå½¢å¼ï¼‰1390, underpin [ÊŒndÉ™â€™pÉªn]vt. å·©å›ºï¼›æ”¯æŒï¼›ä»Žä¸‹é¢æ”¯æ’‘ï¼›åŠ å¼ºâ€¦çš„åŸºç¡€1391, underwear [â€˜ÊŒndÉ™weÉ™]n. å†…è¡£ç‰©1392, unfeasible [ÊŒnâ€™fiËzÉªb(É™)l]adj. éš¾å®žæ–½çš„ï¼Œä¸èƒ½å®žè¡Œçš„1393, unifiedadj. ç»Ÿä¸€çš„ï¼›ä¸€è‡´æ ‡å‡†çš„v. ç»Ÿä¸€ï¼›ä½¿ä¸€è‡´ï¼ˆunifyçš„è¿‡åŽ»åˆ†è¯ï¼‰1394, Unity [ËˆjuËnÉ™ti]n. å›¢ç»“ï¼›ä¸€è‡´ï¼›è”åˆï¼›ä¸ªä½“;n. (Unity)äººåï¼›(è‹±)å°¤å¦®è’‚1395, Until [É™nâ€™tÉªl]conj. åœ¨â€¦ä»¥å‰ï¼›ç›´åˆ°â€¦æ—¶;prep. åœ¨â€¦ä»¥å‰ï¼›åˆ°â€¦ä¸ºæ­¢1396, unusual [ÊŒnâ€™juËÊ’ÊŠÉ™l]adj. ä¸å¯»å¸¸çš„ï¼›ä¸Žä¼—ä¸åŒçš„ï¼›ä¸å¹³å¸¸çš„1397, upon [É™â€™pÉ‘n]prep. æ ¹æ®ï¼›æŽ¥è¿‘ï¼›åœ¨â€¦ä¹‹ä¸Š1398, usual [â€˜juËÊ’ÊŠÉ™l]adj. é€šå¸¸çš„ï¼Œæƒ¯ä¾‹çš„ï¼›å¹³å¸¸çš„1399, Utility [juËËˆtÉªlÉ™ti]n. å®žç”¨ï¼›æ•ˆç”¨ï¼›å…¬å…±è®¾æ–½ï¼›åŠŸç”¨;adj. å®žç”¨çš„ï¼›é€šç”¨çš„ï¼›æœ‰å¤šç§ç”¨é€”çš„1400, vacant [â€˜veÉªk(É™)nt]adj.ç©ºè™šçš„ï¼›ç©ºçš„ï¼›ç©ºç¼ºçš„ï¼›ç©ºé—²çš„ï¼›èŒ«ç„¶çš„n.(Vacant)äººåï¼›(æ³•)ç“¦åº·1401, Validation [,vÃ¦lÉªâ€™deÉªÊƒÉ™n]n. ç¡®è®¤ï¼›æ‰¹å‡†ï¼›ç”Ÿæ•ˆ1402, vanilla [vÉ™â€™nÉªlÉ™]n. é¦™å­å…°ï¼Œé¦™è‰adj. é¦™è‰å‘³çš„1403, variant [â€˜vÉ›rÉªÉ™nt]adj. ä¸åŒçš„ï¼›å¤šæ ·çš„n. å˜ä½“ï¼›è½¬åŒ–1404, variantsn. [è®¡] å˜ä½“ï¼›å˜å¼‚åž‹ï¼ˆvariantçš„å¤æ•°ï¼‰1405, Variation [veÉ™rÉªâ€™eÉªÊƒ(É™)n]n. å˜åŒ–ï¼›[ç”Ÿç‰©] å˜å¼‚ï¼Œå˜ç§1406, various [â€˜veÉ™rÉªÉ™s]adj. å„ç§å„æ ·çš„ï¼›å¤šæ–¹é¢çš„1407, vary [â€˜veÉ™rÉª]vi. å˜åŒ–ï¼›å˜å¼‚ï¼›è¿å;vt. æ”¹å˜ï¼›ä½¿å¤šæ ·åŒ–ï¼›å˜å¥;n. (Vary)äººåï¼›(è‹±ã€æ³•ã€ç½—ã€æŸ¬)ç“¦é‡Œ1408, vast [vÉ‘Ëst]adj. å¹¿é˜”çš„ï¼›å·¨å¤§çš„ï¼›å¤§é‡çš„ï¼›å·¨é¢çš„;n. æµ©ç€šï¼›å¹¿é˜”æ— åž çš„ç©ºé—´;n. (Vast)äººåï¼›(æ³•)ç“¦æ–¯ç‰¹1409, vastly [ËˆvÉ‘:stli]adv. æžå¤§åœ°ï¼›å¹¿å¤§åœ°ï¼›æ·±è¿œåœ°1410, vector [â€˜vÉ›ktÉš]n. çŸ¢é‡ï¼›å¸¦èŒè€…ï¼›èˆªçº¿vt. ç”¨æ— çº¿ç”µå¯¼èˆª1411, vehicle [â€˜viËÉªkl]n. [è½¦è¾†] è½¦è¾†ï¼›å·¥å…·ï¼›äº¤é€šå·¥å…·ï¼›è¿è½½å·¥å…·ï¼›ä¼ æ’­åª’ä»‹ï¼›åª’ä»‹ç‰©1412, velocity [vÉ™ËˆlÉ’sÉ™ti]n. ã€ç‰©ã€‘é€Ÿåº¦1413, Velocity [vÉ™ËˆlÉ’sÉ™ti]n. [åŠ›] é€ŸçŽ‡ï¼›è¿…é€Ÿï¼›å‘¨è½¬çŽ‡1414, vendor [â€˜vÉ›ndÉš]n. å–ä¸»ï¼›å°è´©ï¼›ä¾›åº”å•†ï¼›[è´¸æ˜“] è‡ªåŠ¨å”®è´§æœº1415, Venus [â€˜viËnÉ™s]n. [å¤©] é‡‘æ˜Ÿï¼›ç»´çº³æ–¯ï¼ˆçˆ±ä¸Žç¾Žçš„å¥³ç¥žï¼‰1416, verbose [vÉœËâ€™bÉ™ÊŠs]adj. å†—é•¿çš„ï¼›å•°å—¦çš„1417, verify [â€˜verÉªfaÉª]vt. æ ¸å®žï¼›æŸ¥è¯1418, versatile [â€˜vÉœËsÉ™taÉªl]adj. å¤šæ‰å¤šè‰ºçš„ï¼›é€šç”¨çš„ï¼Œä¸‡èƒ½çš„ï¼›å¤šé¢æ‰‹çš„1419, versus [â€˜vÉsÉ™s]prep. å¯¹ï¼›ä¸Žâ€¦ç›¸å¯¹ï¼›å¯¹æŠ—1420, vetting [vetting]n. å®¡æŸ¥ï¼Œå®¡æ ¸1421, via [ËˆvaÉªÉ™ï¼ŒËˆviËÉ™]prep. æ¸ é“ï¼Œé€šè¿‡ï¼›ç»ç”±1422, vigorously [â€˜vÉªgÉ™rÉ™sli]adv. ç²¾ç¥žæ—ºç››åœ°ï¼Œæ´»æ³¼åœ°1423, violation [vaÉªÉ™â€™leÉªÊƒn]n. è¿åï¼›å¦¨ç¢ï¼Œä¾µå®³ï¼›è¿èƒŒï¼›å¼ºå¥¸1424, virtue [â€˜vÉœËtjuË; -tÊƒuË]n. ç¾Žå¾·ï¼›ä¼˜ç‚¹ï¼›è´žæ“ï¼›åŠŸæ•ˆ;n. (Virtue)äººåï¼›(è‹±)å¼—ä¸˜1425, visual [â€˜vÉªÊ’jÊŠÉ™l; -zj-]adj. è§†è§‰çš„ï¼Œè§†åŠ›çš„ï¼›æ ©æ ©å¦‚ç”Ÿçš„1426, Visual [â€˜vÉªÊ’jÊŠÉ™l; -zj-]adj. è§†è§‰çš„ï¼Œè§†åŠ›çš„ï¼›æ ©æ ©å¦‚ç”Ÿçš„1427, volatile [â€˜vÉ’lÉ™taÉªl]adj. [åŒ–å­¦] æŒ¥å‘æ€§çš„ï¼›ä¸ç¨³å®šçš„ï¼›çˆ†ç‚¸æ€§çš„ï¼›åå¤æ— å¸¸çš„;n. æŒ¥å‘ç‰©ï¼›æœ‰ç¿…çš„åŠ¨ç‰©;n. (Volatile)äººåï¼›(æ„)æ²ƒæ‹‰è’‚èŽ±1428, volatility [,vÉ‘lÉ™â€™tÉªlÉ™ti]n. [åŒ–å­¦] æŒ¥å‘æ€§ï¼›æ˜“å˜ï¼›æ´»æ³¼1429, voltage [â€˜voltÉªdÊ’]n. [ç”µ] ç”µåŽ‹1430, vulnerabilitiesn. ç¼ºé™·ï¼ˆvulnerabilityçš„å¤æ•°å½¢å¼ï¼‰ï¼›è„†å¼±ç‚¹1431, walkthroughn. é¢„æŽ’ï¼Œé¢„æŽ’å·¥ä½œ1432, wall-mounted [,wÉ”:lâ€™mauntid]adj. å›ºå®šåœ¨å¢™ä¸Šçš„ï¼›å®‰è£…åœ¨å¢™ä¸Šçš„1433, warranty [â€˜wÉ”rÉ™nti]n. ä¿è¯ï¼›æ‹…ä¿ï¼›æŽˆæƒï¼›ï¼ˆæ­£å½“ï¼‰ç†ç”±1434, webcasts []n. ç½‘ç»œå¹¿æ’­ï¼ˆwebcastçš„å¤æ•°ï¼‰1435, webinar [â€˜webÉªnÉ‘Ë]n. ç½‘ç»œç ”è®¨ä¼šï¼›åœ¨çº¿ä¼šè®®1436, weighted [â€˜wetÉªd]adj. [æ•°] åŠ æƒçš„ï¼›åŠ é‡çš„ï¼›è¡¡é‡è¿‡çš„v. åŠ é‡é‡äºŽâ€¦ï¼›é‡åŽ‹ï¼ˆweightçš„è¿‡åŽ»åˆ†è¯ï¼‰1437, well-distributedå‡åŒ€1438, whence [wens]n. æ ¹æºadv. ä»Žä½•å¤„pron. ä½•å¤„conj. ç”±æ­¤1439, whoop [wuËp]n. å¤§å«ï¼›å“®å–˜å£°ï¼›å‘å–Šï¼›ä¸€ç‚¹ç‚¹vt. é«˜å£°è¯´ï¼›å”¤èµ·vi. å«å–Šï¼›å–˜æ¯1440, whore [hÉ”Ë]vi.å–æ·«ï¼Œå¨¼å¦“n.å¨¼å¦“ï¼Œæ·«å¦‡1441, wicked [â€˜wÉªkÉªd]adj. é‚ªæ¶çš„ï¼›æ¶åŠ£çš„ï¼›ä¸é“å¾·çš„ï¼›é¡½çš®çš„1442, widgets []n. å°å·¥å…·ï¼ˆwidgetçš„å¤æ•°ï¼‰ï¼›çª—ä½“å°éƒ¨ä»¶1443, wiggle [â€˜wÉªÉ¡l]vt. ä½¿â€¦â€¦æ‘†åŠ¨ï¼Œä½¿â€¦â€¦æ‰­åŠ¨vi. æ‘†åŠ¨n. æ‰­åŠ¨1444, wildcard [â€˜waÉªldkÉ‘rd]n. é€šé…ç¬¦1445, wipe [waÉªp]vt. æ“¦ï¼›æ¶ˆé™¤ï¼›æ¶‚ä¸Š;vi. æ“¦ï¼›æ‰“;n. æ“¦æ‹­ï¼›ç”¨åŠ›æ‰“1446, wizard [â€˜wÉªzÉ™d]n. ç”·å·«ï¼›æœ¯å£«ï¼›å¥‡æ‰ï¼›å‘å¯¼ç¨‹åº adj. ç”·å·«çš„ï¼›å·«æœ¯çš„1447, Wizard [â€˜wÉªzÉ™d]n. ç”·å·«ï¼›æœ¯å£«ï¼›å¥‡æ‰;adj. ç”·å·«çš„ï¼›å·«æœ¯çš„1448, workbench [â€˜wÉkbÉ›ntÊƒ]n. å·¥ä½œå°ï¼›æ‰‹å·¥å°1449, worthwhile [wÉœËÎ¸â€™waÉªl]adj. å€¼å¾—åšçš„ï¼Œå€¼å¾—èŠ±æ—¶é—´çš„1450, wrap [rÃ¦p]vt. åŒ…ï¼›ç¼ ç»•ï¼›éšè—ï¼›æŽ©æŠ¤;vi. åŒ…èµ·æ¥ï¼›ç¼ ç»•ï¼›ç©¿å¤–è¡£;n. å¤–å¥—ï¼›å›´å·¾1451, WRT [WRT]abbr. å…³äºŽï¼ˆWith Regard Toï¼‰1452, xenial [xenial]adj. å¼‚èŠ±å—ç²‰çš„ï¼›ä¸»å®¢å…³ç³»çš„ï¼›æ¬¾å¾…çš„1453, zap [zÃ¦p]n. æ´»åŠ›ï¼›æ„å¿—ï¼›æ€æ­»ï¼›éœ‡å‡» vt. æ”»å‡»ï¼›æ‰“è´¥ï¼›å¿«é€ŸæŽ¨åŠ¨ vi. å¿«é€Ÿç§»åŠ¨ int. å’ï¼ï¼›ç³Ÿäº†ï¼1454, æ¼”ç¤º [yÇŽn shÃ¬]demonstration;show-how;reproduction]]></content>
      <categories>
        <category>Words</category>
      </categories>
      <tags>
        <tag>Words</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[è¯‘]ZGC: ä¸€ä¸ªå¯ä¼¸ç¼©çš„ä½Žå»¶è¿Ÿåžƒåœ¾æ”¶é›†å™¨]]></title>
    <url>%2Fzgc-a-scalable-low-latency-garbage-collector.html</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ªï¼šJEP 333 åœ°å€ï¼šhttps://openjdk.java.net/jeps/333 ä¸€ã€æ‘˜è¦Zåžƒåœ¾æ”¶é›†å™¨ï¼Œä¹Ÿç§°ä¸ºZGCï¼Œæ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©çš„ä½Žå»¶è¿Ÿåžƒåœ¾æ”¶é›†å™¨ã€‚ äºŒã€ç›®æ ‡ GCæš‚åœæ—¶é—´ä¸è¶…è¿‡10ms èƒ½å¤„ç†å¤§å°ä»Žç›¸å¯¹è¾ƒå°(å‡ ç™¾MB)åˆ°éžå¸¸å¤§(TBçº§)çš„å † ä¸Žä½¿ç”¨G1ç›¸æ¯”ï¼Œåº”ç”¨ç¨‹åºåžåé‡å‡å°‘ä¸è¶…è¿‡15% æ–¹ä¾¿æ—¥åŽåœ¨æ­¤åŸºç¡€ä¸Šåˆ©ç”¨å½©è‰²æŒ‡é’ˆå’Œå†…å­˜å±éšœè¿›ä¸€æ­¥ä¼˜åŒ–æ”¶é›†å™¨åŠå®žçŽ°æ–°ç‰¹æ€§ã€‚ã€åŽŸæ–‡ï¼šLay a foundation for future GC features and optimizations leveraging colored pointers and load barriersã€‘ æ”¯æŒå¹³å°:Linux/x64 æ³¨ï¼šæ­¤å¤„åŠä¸‹æ–‡ä¸­çš„å†…å­˜å±éšœå³load barrierï¼Œåœ¨ZGCä¸­ç”¨çš„æ˜¯è¯»å±éšœã€‚ ä¸‰ã€åŠ¨æœºåžƒåœ¾æ”¶é›†æ˜¯Javaçš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€ã€‚ä½†æ˜¯ï¼Œå½“åžƒåœ¾æ”¶é›†æš‚åœå¤ªé•¿æ—¶ï¼Œå°±ä¼šå¯¹åº”ç”¨ç¨‹åºçš„å“åº”æ—¶é—´äº§ç”Ÿè´Ÿé¢å½±å“ã€‚é€šè¿‡å¤§å¹…åº¦ç¼©çŸ­åœé¡¿æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥è®©Javaé€‚ç”¨äºŽæ›´å¤šç±»åž‹çš„åº”ç”¨ç¨‹åºã€‚ æ­¤å¤–ï¼ŒçŽ°ä»£ç³»ç»Ÿä¸­å¯ç”¨çš„å†…å­˜æ•°é‡è¿˜åœ¨ç»§ç»­å¢žé•¿ã€‚ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¸Œæœ›JVMèƒ½å¤Ÿä»¥ä¸€ç§æœ‰æ•ˆçš„æ–¹å¼å……åˆ†åˆ©ç”¨è¿™ç§å†…å­˜ï¼Œå¹¶ä¸”ä¸ä¼šå‡ºçŽ°å¾ˆé•¿çš„GCæš‚åœæ—¶é—´ã€‚ å››ã€ æè¿°ZGCæ˜¯ä¸€ä¸ªå¹¶å‘çš„ã€å•ä»£ï¼ˆä¸å†åŒºåˆ†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼‰çš„ã€åŸºäºŽregionçš„ã€æ”¯æŒnumaçš„åŽ‹ç¼©æ”¶é›†å™¨ã€‚Stop-the-worldé˜¶æ®µä»…é™äºŽæ ¹æ‰«æï¼Œæ‰€ä»¥GCæš‚åœæ—¶é—´ä¸ä¼šéšç€å †æˆ–å­˜æ´»å¯¹è±¡çš„å¤šå°‘è€Œå¢žåŠ ã€‚ ZGCçš„ä¸€ä¸ªæ ¸å¿ƒè®¾è®¡åŽŸåˆ™æ˜¯ç»“åˆä½¿ç”¨å†…å­˜å±éšœå’Œå½©è‰²å¯¹è±¡æŒ‡é’ˆã€‚è¿™ä½¿å¾—ZGCèƒ½å¤Ÿåœ¨è¿è¡ŒJavaåº”ç”¨ç¨‹åºçº¿ç¨‹æ—¶æ‰§è¡Œå¹¶å‘æ“ä½œï¼Œæ¯”å¦‚å¯¹è±¡é‡å®šä½ã€‚ä»ŽJavaçº¿ç¨‹çš„è§’åº¦æ¥çœ‹ï¼Œåœ¨Javaå¯¹è±¡ä¸­åŠ è½½å¼•ç”¨å­—æ®µçš„è¡Œä¸ºå—åˆ°å†…å­˜å±éšœçš„é™åˆ¶ã€‚é™¤äº†å¯¹è±¡åœ°å€ä¹‹å¤–ï¼Œæœ‰è‰²å¯¹è±¡æŒ‡é’ˆè¿˜åŒ…å«å†…å­˜å±éšœéœ€è¦çš„ä¿¡æ¯ï¼Œç”¨äºŽç¡®å®šåœ¨å…è®¸Javaçº¿ç¨‹ä½¿ç”¨è¯¥æŒ‡é’ˆä¹‹å‰æ˜¯å¦éœ€è¦é‡‡å–æŸäº›æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¯¹è±¡å¯èƒ½å·²ç»è¢«é‡æ–°å®šä½ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå†…å­˜å±éšœå°†æ£€æµ‹æƒ…å†µå¹¶é‡‡å–é€‚å½“çš„æ“ä½œã€‚ ä¸Žå…¶ä»–æŠ€æœ¯ç›¸æ¯”ï¼Œæˆ‘ä»¬è®¤ä¸ºé¢œè‰²æŒ‡é’ˆæ–¹æ¡ˆæä¾›äº†ä¸€äº›éžå¸¸å¸å¼•äººçš„ç‰¹æ€§ã€‚ç‰¹åˆ«æ˜¯: è¿™å…è®¸æˆ‘ä»¬åœ¨ç§»åŠ¨å¯¹è±¡/æ•´ç†å†…å­˜é˜¶æ®µï¼Œåœ¨æŒ‡å‘å¯å›žæ”¶/é‡ç”¨åŒºåŸŸçš„æŒ‡é’ˆç¡®å®šä¹‹å‰å›žæ”¶/é‡ç”¨è¿™éƒ¨åˆ†å†…å­˜ã€åŽŸæ–‡ï¼šIt allows us to reclaim and reuse memory during the relocation/compaction phase, before pointers pointing into the reclaimed/reused regions have been fixed. ã€‘ã€‚è¿™æœ‰åŠ©äºŽé™ä½Žå †å¼€é”€ã€‚è¿™è¿˜æ„å‘³ç€ä¸éœ€è¦å®žçŽ°å•ç‹¬çš„æ ‡è®°åŽ‹ç¼©ç®—æ³•æ¥å¤„ç†å®Œæ•´çš„GCã€‚ è¿™å…è®¸æˆ‘ä»¬ä½¿ç”¨ç›¸å¯¹è¾ƒå°‘ä¸”ç®€å•çš„GCå±éšœã€‚è¿™æœ‰åŠ©äºŽé™ä½Žè¿è¡Œæ—¶å¼€é”€ã€‚è¿™è¿˜æ„å‘³ç€åœ¨è§£é‡Šå™¨å’ŒJITç¼–è¯‘å™¨ä¸­æ›´å®¹æ˜“å®žçŽ°ã€ä¼˜åŒ–å’Œç»´æŠ¤GC barrierä»£ç ã€‚ æˆ‘ä»¬ç›®å‰å°†æ ‡è®°å’Œé‡æ–°å®šä½ç›¸å…³ä¿¡æ¯å­˜å‚¨åœ¨å½©è‰²æŒ‡é’ˆä¸­ã€‚ç„¶è€Œï¼Œæ­¤æ–¹æ¡ˆçš„é€šç”¨æ€§å…è®¸æˆ‘ä»¬å­˜å‚¨ä»»ä½•ç±»åž‹çš„ä¿¡æ¯(åªè¦æˆ‘ä»¬èƒ½å°†å…¶æ”¾å…¥æŒ‡é’ˆä¸­)ï¼Œå¹¶å…è®¸å†…å­˜å±éšœæ ¹æ®è¯¥ä¿¡æ¯é‡‡å–å®ƒæƒ³è¦é‡‡å–çš„ä»»ä½•æ“ä½œã€‚æˆ‘ä»¬ç›¸ä¿¡è¿™å°†ä¸ºå°†æ¥çš„è®¸å¤šç‰¹æ€§æ‰“ä¸‹åŸºç¡€ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œåœ¨å¼‚æž„å†…å­˜çŽ¯å¢ƒä¸­ï¼Œè¿™å¯ä»¥ç”¨æ¥è·Ÿè¸ªå †è®¿é—®æ¨¡å¼ï¼Œä»¥æŒ‡å¯¼GCé‡æ–°å®šä½å†³ç­–ï¼Œå°†å¾ˆå°‘ä½¿ç”¨çš„å¯¹è±¡ç§»åŠ¨åˆ°å†·å­˜å‚¨(ä¸å¸¸è®¿é—®çš„å†…å­˜åŒºåŸŸ)ä¸­ã€åŽŸæ–‡ï¼šTo pick one example, in a heterogeneous memory environment, this could be used to track heap access patterns to guide GC relocation decisions to move rarely used objects to cold storage.ã€‘ã€‚ äº”ã€æ€§èƒ½æˆ‘ä»¬å·²ç»ä½¿ç”¨SPECjbb 2015[1]åšäº†å¸¸è§„æ€§èƒ½æµ‹è¯•ã€‚ä»Žåžåé‡å’Œå»¶è¿Ÿè§’åº¦æ¥çœ‹ï¼Œæ€§èƒ½éƒ½å¾ˆå¥½ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨128Gå †åœ¨å¤åˆæ¨¡å¼ä¸‹æ¯”è¾ƒZGCå’ŒG1çš„å…¸åž‹åŸºå‡†åˆ†æ•°(ä»¥ç™¾åˆ†æ¯”ä¸ºå•ä½ï¼Œæ ¹æ®ZGCçš„max-jOPSè¿›è¡Œæ ‡å‡†åŒ–)ã€åŽŸæ–‡ï¼šBelow are typical benchmark scores (in percent, normalized against ZGCâ€™s max-jOPS), comparing ZGC and G1, in composite mode using a 128G heap.ã€‘ï¼š è¶Šé«˜è¶Šå¥½ 1234567ZGC max-jOPS: 100% critical-jOPS: 76.1%G1 max-jOPS: 91.2% critical-jOPS: 54.7% ä¸‹é¢æ˜¯æ¥è‡ªç›¸åŒåŸºå‡†æµ‹è¯•çš„GCæš‚åœæ—¶é—´ã€‚ZGCè®¾æ³•ä¿æŒè¿œä½ŽäºŽ10msçš„ç›®æ ‡ã€‚æ³¨æ„ï¼Œç¡®åˆ‡çš„æ•°å­—å¯èƒ½ä¼šæ ¹æ®ä½¿ç”¨çš„æœºå™¨å’Œè®¾ç½®è€Œå˜åŒ–(ä¸Šä¸‹éƒ½æœ‰ï¼Œä½†ä¸æ˜¯å¾ˆæ˜Žæ˜¾)ã€‚ è¶Šä½Žè¶Šå¥½ 123456789101112131415ZGC avg: 1.091ms (+/-0.215ms) 95th percentile: 1.380ms 99th percentile: 1.512ms 99.9th percentile: 1.663ms 99.99th percentile: 1.681ms max: 1.681msG1 avg: 156.806ms (+/-71.126ms) 95th percentile: 316.672ms 99th percentile: 428.095ms 99.9th percentile: 543.846ms 99.99th percentile: 543.846ms max: 543.846ms æˆ‘ä»¬è¿˜å¯¹å…¶ä»–å„ç§SPECÂ®åŸºå‡†æµ‹è¯•å’Œå†…éƒ¨å·¥ä½œè´Ÿè½½è¿›è¡Œäº†ç‰¹åˆ«çš„æ€§èƒ½æµ‹é‡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒZGCèƒ½å¤Ÿç»´æŠ¤ä¸ªä½æ•°çš„æ¯«ç§’æš‚åœæ—¶é—´ã€‚ å…­ã€ å±€é™æ€§ZGCçš„åˆå§‹å®žéªŒç‰ˆæœ¬å°†ä¸æ”¯æŒç±»å¸è½½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œclassunloadå’ŒClassUnloadingWithConcurrentMarké€‰é¡¹å°†è¢«ç¦ç”¨ã€‚å³ä¾¿ä½ å¯ç”¨ä¹Ÿæ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚ æ­¤å¤–ï¼ŒZGCæœ€åˆä¸æ”¯æŒJVMCI(å³Graal)ã€‚å¦‚æžœå¯ç”¨EnableJVMCIé€‰é¡¹ï¼Œå°†æ‰“å°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ã€‚ è¿™äº›é™åˆ¶å°†åœ¨æœ¬é¡¹ç›®çš„åŽæœŸè§£å†³ã€‚ ä¸ƒã€ æž„å»ºå’Œä½¿ç”¨æŒ‰ç…§æƒ¯ä¾‹ï¼Œæž„å»ºç³»ç»Ÿé»˜è®¤ç¦ç”¨JVMä¸­çš„å®žéªŒæ€§ç‰¹æ€§ã€‚ZGCæ˜¯ä¸€ä¸ªå®žéªŒæ€§ç‰¹æ€§ï¼Œå› æ­¤ä¸ä¼šå‡ºçŽ°åœ¨JDKæž„å»ºä¸­ï¼Œé™¤éžåœ¨ç¼–è¯‘æ—¶ä½¿ç”¨configureé€‰é¡¹: 1--with-jvm-features=zgc æ˜¾å¼åœ°å¯ç”¨å®ƒã€‚ (ZGCå°†å‡ºçŽ°åœ¨Oracleå‘å¸ƒçš„æ‰€æœ‰Linux/x64 JDKç‰ˆæœ¬ä¸­) JVMä¸­çš„å®žéªŒç‰¹æ€§è¿˜éœ€è¦åœ¨è¿è¡Œæ—¶æ˜¾å¼åœ°è§£é”ã€‚å› æ­¤ï¼Œè¦å¯ç”¨/ä½¿ç”¨ZGCï¼Œéœ€è¦ä»¥ä¸‹JVMé€‰é¡¹: 1-XX:+ unlockexperimental alvmoptions -XX:+UseZGC æœ‰å…³å¦‚ä½•è®¾ç½®å’Œè°ƒä¼˜ZGCçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ZGCé¡¹ç›®Wikiï¼ˆwikiåœ°å€ï¼šhttps://wiki.openjdk.java.net/display/zgc/Mainï¼‰ã€‚ ZGC paperå¯ä»¥å‚è€ƒAzul Pauseless GC Algorithmï¼š https://github.com/jiankunking/books-recommendation/blob/master/GC/ZGC/Azul_Pauseless_GC_Algorithm.pdf ZGC ç®€ä»‹PPT: https://github.com/jiankunking/books-recommendation/blob/master/GC/ZGC/ZGC-FOSDEM-2018.pdf]]></content>
      <categories>
        <category>GC</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>GC</tag>
        <tag>ZGC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ElasticSearch æŸ¥è¯¢çš„ç§˜å¯†]]></title>
    <url>%2Felasticsearch-query-secret.html</url>
    <content type="text"><![CDATA[æœ€è¿‘åœ¨å‚ä¸Žä¸€ä¸ªåŸºäºŽElasticsearchä½œä¸ºåº•å±‚æ•°æ®æ¡†æž¶æä¾›å¤§æ•°æ®é‡(äº¿çº§)çš„å®žæ—¶ç»Ÿè®¡æŸ¥è¯¢çš„æ–¹æ¡ˆè®¾è®¡å·¥ä½œï¼ŒèŠ±äº†äº›æ—¶é—´å­¦ä¹ Elasticsearchçš„åŸºç¡€ç†è®ºçŸ¥è¯†ï¼Œæ•´ç†äº†ä¸€ä¸‹ï¼Œå¸Œæœ›èƒ½å¯¹Elasticsearchæ„Ÿå…´è¶£/æƒ³äº†è§£çš„åŒå­¦æœ‰æ‰€å¸®åŠ©ã€‚åŒæ—¶ä¹Ÿå¸Œæœ›æœ‰å‘çŽ°å†…å®¹ä¸æ­£ç¡®æˆ–è€…æœ‰ç–‘é—®çš„åœ°æ–¹ï¼Œæœ›æŒ‡æ˜Žï¼Œä¸€èµ·æŽ¢è®¨ï¼Œå­¦ä¹ ï¼Œè¿›æ­¥ã€‚ ä»‹ç» Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å¯æ‰©å±•çš„å®žæ—¶æœç´¢å’Œåˆ†æžå¼•æ“Ž. Elasticsearch æ˜¯ä¸€ä¸ªå»ºç«‹åœ¨å…¨æ–‡æœç´¢å¼•æ“Ž Apache Lucene(TM) åŸºç¡€ä¸Šçš„æœç´¢å¼•æ“Ž.å½“ç„¶ Elasticsearch å¹¶ä¸ä»…ä»…æ˜¯ Lucene é‚£ä¹ˆç®€å•ï¼Œå®ƒä¸ä»…åŒ…æ‹¬äº†å…¨æ–‡æœç´¢åŠŸèƒ½ï¼Œè¿˜å¯ä»¥è¿›è¡Œä»¥ä¸‹å·¥ä½œ: åˆ†å¸ƒå¼å®žæ—¶æ–‡ä»¶å­˜å‚¨ï¼Œå¹¶å°†æ¯ä¸€ä¸ªå­—æ®µéƒ½ç¼–å…¥ç´¢å¼•ï¼Œä½¿å…¶å¯ä»¥è¢«æœç´¢ã€‚ å®žæ—¶åˆ†æžçš„åˆ†å¸ƒå¼æœç´¢å¼•æ“Žã€‚ å¯ä»¥æ‰©å±•åˆ°ä¸Šç™¾å°æœåŠ¡å™¨ï¼Œå¤„ç†PBçº§åˆ«çš„ç»“æž„åŒ–æˆ–éžç»“æž„åŒ–æ•°æ®ã€‚ åŸºæœ¬æ¦‚å¿µå…ˆè¯´Elasticsearchçš„æ–‡ä»¶å­˜å‚¨ï¼ŒElasticsearchæ˜¯é¢å‘æ–‡æ¡£åž‹æ•°æ®åº“ï¼Œä¸€æ¡æ•°æ®åœ¨è¿™é‡Œå°±æ˜¯ä¸€ä¸ªæ–‡æ¡£ï¼Œç”¨JSONä½œä¸ºæ–‡æ¡£åºåˆ—åŒ–çš„æ ¼å¼ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ¡ç”¨æˆ·æ•°æ®ï¼š 12345678&#123; "name" : "John", "sex" : "Male", "age" : 25, "birthDate": "1990/05/01", "about" : "I love to go rock climbing", "interests": [ "sports", "music" ]&#125; ç”¨Mysqlè¿™æ ·çš„æ•°æ®åº“å­˜å‚¨å°±ä¼šå®¹æ˜“æƒ³åˆ°å»ºç«‹ä¸€å¼ Userè¡¨ï¼Œæœ‰balabalaçš„å­—æ®µç­‰ï¼Œåœ¨Elasticsearché‡Œè¿™å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£ï¼Œå½“ç„¶è¿™ä¸ªæ–‡æ¡£ä¼šå±žäºŽä¸€ä¸ªUserçš„ç±»åž‹ï¼Œå„ç§å„æ ·çš„ç±»åž‹å­˜åœ¨äºŽä¸€ä¸ªç´¢å¼•å½“ä¸­ã€‚è¿™é‡Œæœ‰ä¸€ä»½ç®€æ˜“çš„å°†Elasticsearchå’Œå…³ç³»åž‹æ•°æ®æœ¯è¯­å¯¹ç…§è¡¨: å…³ç³»æ•°æ®åº“ â‡’ æ•°æ®åº“ â‡’ è¡¨ â‡’ è¡Œ â‡’ åˆ—(Columns) Elasticsearch â‡’ ç´¢å¼• â‡’ ç±»åž‹ â‡’ æ–‡æ¡£ â‡’ å­—æ®µ(Fields) ä¸€ä¸ª Elasticsearch é›†ç¾¤å¯ä»¥åŒ…å«å¤šä¸ªç´¢å¼•(æ•°æ®åº“)ï¼Œä¹Ÿå°±æ˜¯è¯´å…¶ä¸­åŒ…å«äº†å¾ˆå¤šç±»åž‹(è¡¨)ã€‚è¿™äº›ç±»åž‹ä¸­åŒ…å«äº†å¾ˆå¤šçš„æ–‡æ¡£(è¡Œ)ï¼Œç„¶åŽæ¯ä¸ªæ–‡æ¡£ä¸­åˆåŒ…å«äº†å¾ˆå¤šçš„å­—æ®µ(åˆ—)ã€‚ Elasticsearchçš„äº¤äº’ï¼Œå¯ä»¥ä½¿ç”¨Java APIï¼Œä¹Ÿå¯ä»¥ç›´æŽ¥ä½¿ç”¨HTTPçš„Restful APIæ–¹å¼ï¼Œæ¯”å¦‚æˆ‘ä»¬æ‰“ç®—æ’å…¥ä¸€æ¡è®°å½•ï¼Œå¯ä»¥ç®€å•å‘é€ä¸€ä¸ªHTTPçš„è¯·æ±‚ï¼š 12345678PUT /megacorp/employee/1&#123; "name" : "John", "sex" : "Male", "age" : 25, "about" : "I love to go rock climbing", "interests": [ "sports", "music" ]&#125; æ›´æ–°ï¼ŒæŸ¥è¯¢ä¹Ÿæ˜¯ç±»ä¼¼è¿™æ ·çš„æ“ä½œï¼Œå…·ä½“æ“ä½œæ‰‹å†Œå¯ä»¥å‚è§Elasticsearchæƒå¨æŒ‡å— ç´¢å¼•Elasticsearchæœ€å…³é”®çš„å°±æ˜¯æä¾›å¼ºå¤§çš„ç´¢å¼•èƒ½åŠ›äº†ï¼Œå…¶å®žInfoQçš„è¿™ç¯‡æ—¶é—´åºåˆ—æ•°æ®åº“çš„ç§˜å¯†(2)â€”â€”ç´¢å¼•å†™çš„éžå¸¸å¥½ï¼Œæˆ‘è¿™é‡Œä¹Ÿæ˜¯å›´ç»•è¿™ç¯‡ç»“åˆè‡ªå·±çš„ç†è§£è¿›ä¸€æ­¥æ¢³ç†ä¸‹ï¼Œä¹Ÿå¸Œæœ›å¯ä»¥å¸®åŠ©å¤§å®¶æ›´å¥½çš„ç†è§£è¿™ç¯‡æ–‡ç« ã€‚ Elasticsearchç´¢å¼•çš„ç²¾é«“ï¼š ä¸€åˆ‡è®¾è®¡éƒ½æ˜¯ä¸ºäº†æé«˜æœç´¢çš„æ€§èƒ½ å¦ä¸€å±‚æ„æ€ï¼šä¸ºäº†æé«˜æœç´¢çš„æ€§èƒ½ï¼Œéš¾å…ä¼šç‰ºç‰²æŸäº›å…¶ä»–æ–¹é¢ï¼Œæ¯”å¦‚æ’å…¥/æ›´æ–°ï¼Œå¦åˆ™å…¶ä»–æ•°æ®åº“ä¸ç”¨æ··äº†:) å‰é¢çœ‹åˆ°å¾€Elasticsearché‡Œæ’å…¥ä¸€æ¡è®°å½•ï¼Œå…¶å®žå°±æ˜¯ç›´æŽ¥PUTä¸€ä¸ªjsonçš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æœ‰å¤šä¸ªfieldsï¼Œæ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­çš„name, sex, age, about, interestsï¼Œé‚£ä¹ˆåœ¨æ’å…¥è¿™äº›æ•°æ®åˆ°Elasticsearchçš„åŒæ—¶ï¼ŒElasticsearchè¿˜é»˜é»˜^1çš„ä¸ºè¿™äº›å­—æ®µå»ºç«‹ç´¢å¼•â€“å€’æŽ’ç´¢å¼•ï¼Œå› ä¸ºElasticsearchæœ€æ ¸å¿ƒåŠŸèƒ½æ˜¯æœç´¢ã€‚ Elasticsearchæ˜¯å¦‚ä½•åšåˆ°å¿«é€Ÿç´¢å¼•çš„InfoQé‚£ç¯‡æ–‡ç« é‡Œè¯´Elasticsearchä½¿ç”¨çš„å€’æŽ’ç´¢å¼•æ¯”å…³ç³»åž‹æ•°æ®åº“çš„B-Treeç´¢å¼•å¿«ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ ä»€ä¹ˆæ˜¯B-Treeç´¢å¼•?ä¸Šå¤§å­¦è¯»ä¹¦æ—¶è€å¸ˆæ•™è¿‡æˆ‘ä»¬ï¼ŒäºŒå‰æ ‘æŸ¥æ‰¾æ•ˆçŽ‡æ˜¯logNï¼ŒåŒæ—¶æ’å…¥æ–°çš„èŠ‚ç‚¹ä¸å¿…ç§»åŠ¨å…¨éƒ¨èŠ‚ç‚¹ï¼Œæ‰€ä»¥ç”¨æ ‘åž‹ç»“æž„å­˜å‚¨ç´¢å¼•ï¼Œèƒ½åŒæ—¶å…¼é¡¾æ’å…¥å’ŒæŸ¥è¯¢çš„æ€§èƒ½ã€‚ å› æ­¤åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå†ç»“åˆç£ç›˜çš„è¯»å–ç‰¹æ€§(é¡ºåºè¯»/éšæœºè¯»)ï¼Œä¼ ç»Ÿå…³ç³»åž‹æ•°æ®åº“é‡‡ç”¨äº†B-Tree/B+Treeè¿™æ ·çš„æ•°æ®ç»“æž„ï¼š ä¸ºäº†æé«˜æŸ¥è¯¢çš„æ•ˆçŽ‡ï¼Œå‡å°‘ç£ç›˜å¯»é“æ¬¡æ•°ï¼Œå°†å¤šä¸ªå€¼ä½œä¸ºä¸€ä¸ªæ•°ç»„é€šè¿‡è¿žç»­åŒºé—´å­˜æ”¾ï¼Œä¸€æ¬¡å¯»é“è¯»å–å¤šä¸ªæ•°æ®ï¼ŒåŒæ—¶ä¹Ÿé™ä½Žæ ‘çš„é«˜åº¦ã€‚ ä»€ä¹ˆæ˜¯å€’æŽ’ç´¢å¼•? ç»§ç»­ä¸Šé¢çš„ä¾‹å­ï¼Œå‡è®¾æœ‰è¿™ä¹ˆå‡ æ¡æ•°æ®(ä¸ºäº†ç®€å•ï¼ŒåŽ»æŽ‰about, interestsè¿™ä¸¤ä¸ªfield): ID Name Age Sex 1 Kate 24 Female 2 John 24 Male 3 Bill 29 Male IDæ˜¯Elasticsearchè‡ªå»ºçš„æ–‡æ¡£idï¼Œé‚£ä¹ˆElasticsearchå»ºç«‹çš„ç´¢å¼•å¦‚ä¸‹: Name: Term Posting List Kate 1 John 2 Bill 3 Age: Term Posting List 24 [1,2] 29 3 Sex: Term Posting List Female 1 Male [2,3] Posting ListElasticsearchåˆ†åˆ«ä¸ºæ¯ä¸ªfieldéƒ½å»ºç«‹äº†ä¸€ä¸ªå€’æŽ’ç´¢å¼•ï¼ŒKate, John, 24, Femaleè¿™äº›å«termï¼Œè€Œ[1,2]å°±æ˜¯Posting Listã€‚Posting listå°±æ˜¯ä¸€ä¸ªintçš„æ•°ç»„ï¼Œå­˜å‚¨äº†æ‰€æœ‰ç¬¦åˆæŸä¸ªtermçš„æ–‡æ¡£idã€‚ çœ‹åˆ°è¿™é‡Œï¼Œä¸è¦è®¤ä¸ºå°±ç»“æŸäº†ï¼Œç²¾å½©çš„éƒ¨åˆ†æ‰åˆšå¼€å§‹â€¦ é€šè¿‡posting listè¿™ç§ç´¢å¼•æ–¹å¼ä¼¼ä¹Žå¯ä»¥å¾ˆå¿«è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ¯”å¦‚è¦æ‰¾age=24çš„åŒå­¦ï¼Œçˆ±å›žç­”é—®é¢˜çš„å°æ˜Žé©¬ä¸Šå°±ä¸¾æ‰‹å›žç­”ï¼šæˆ‘çŸ¥é“ï¼Œidæ˜¯1ï¼Œ2çš„åŒå­¦ã€‚ä½†æ˜¯ï¼Œå¦‚æžœè¿™é‡Œæœ‰ä¸Šåƒä¸‡çš„è®°å½•å‘¢ï¼Ÿå¦‚æžœæ˜¯æƒ³é€šè¿‡nameæ¥æŸ¥æ‰¾å‘¢ï¼Ÿ Term DictionaryElasticsearchä¸ºäº†èƒ½å¿«é€Ÿæ‰¾åˆ°æŸä¸ªtermï¼Œå°†æ‰€æœ‰çš„termæŽ’ä¸ªåºï¼ŒäºŒåˆ†æ³•æŸ¥æ‰¾termï¼ŒlogNçš„æŸ¥æ‰¾æ•ˆçŽ‡ï¼Œå°±åƒé€šè¿‡å­—å…¸æŸ¥æ‰¾ä¸€æ ·ï¼Œè¿™å°±æ˜¯Term Dictionaryã€‚çŽ°åœ¨å†çœ‹èµ·æ¥ï¼Œä¼¼ä¹Žå’Œä¼ ç»Ÿæ•°æ®åº“é€šè¿‡B-Treeçš„æ–¹å¼ç±»ä¼¼å•Šï¼Œä¸ºä»€ä¹ˆè¯´æ¯”B-Treeçš„æŸ¥è¯¢å¿«å‘¢ï¼Ÿ Term IndexB-Treeé€šè¿‡å‡å°‘ç£ç›˜å¯»é“æ¬¡æ•°æ¥æé«˜æŸ¥è¯¢æ€§èƒ½ï¼ŒElasticsearchä¹Ÿæ˜¯é‡‡ç”¨åŒæ ·çš„æ€è·¯ï¼Œç›´æŽ¥é€šè¿‡å†…å­˜æŸ¥æ‰¾termï¼Œä¸è¯»ç£ç›˜ï¼Œä½†æ˜¯å¦‚æžœtermå¤ªå¤šï¼Œterm dictionaryä¹Ÿä¼šå¾ˆå¤§ï¼Œæ”¾å†…å­˜ä¸çŽ°å®žï¼ŒäºŽæ˜¯æœ‰äº†Term Indexï¼Œå°±åƒå­—å…¸é‡Œçš„ç´¢å¼•é¡µä¸€æ ·ï¼ŒAå¼€å¤´çš„æœ‰å“ªäº›termï¼Œåˆ†åˆ«åœ¨å“ªé¡µï¼Œå¯ä»¥ç†è§£term indexæ˜¯ä¸€é¢—æ ‘ï¼š è¿™æ£µæ ‘ä¸ä¼šåŒ…å«æ‰€æœ‰çš„termï¼Œå®ƒåŒ…å«çš„æ˜¯termçš„ä¸€äº›å‰ç¼€ã€‚é€šè¿‡term indexå¯ä»¥å¿«é€Ÿåœ°å®šä½åˆ°term dictionaryçš„æŸä¸ªoffsetï¼Œç„¶åŽä»Žè¿™ä¸ªä½ç½®å†å¾€åŽé¡ºåºæŸ¥æ‰¾ã€‚ æ‰€ä»¥term indexä¸éœ€è¦å­˜ä¸‹æ‰€æœ‰çš„termï¼Œè€Œä»…ä»…æ˜¯ä»–ä»¬çš„ä¸€äº›å‰ç¼€ä¸ŽTerm Dictionaryçš„blockä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œå†ç»“åˆFST(Finite State Transducers)çš„åŽ‹ç¼©æŠ€æœ¯ï¼Œå¯ä»¥ä½¿term indexç¼“å­˜åˆ°å†…å­˜ä¸­ã€‚ä»Žterm indexæŸ¥åˆ°å¯¹åº”çš„term dictionaryçš„blockä½ç½®ä¹‹åŽï¼Œå†åŽ»ç£ç›˜ä¸Šæ‰¾termï¼Œå¤§å¤§å‡å°‘äº†ç£ç›˜éšæœºè¯»çš„æ¬¡æ•°ã€‚ è¿™æ—¶å€™çˆ±æé—®çš„å°æ˜Žåˆä¸¾æ‰‹äº†:â€é‚£ä¸ªFSTæ˜¯ç¥žé©¬ä¸œä¸œå•Š?â€ ä¸€çœ‹å°±çŸ¥é“å°æ˜Žæ˜¯ä¸€ä¸ªä¸Šå¤§å­¦è¯»ä¹¦çš„æ—¶å€™è·Ÿæˆ‘ä¸€æ ·ä¸è®¤çœŸå¬è¯¾çš„å­©å­ï¼Œæ•°æ®ç»“æž„è€å¸ˆä¸€å®šè®²è¿‡ä»€ä¹ˆæ˜¯FSTã€‚ä½†æ²¡åŠžæ³•ï¼Œæˆ‘ä¹Ÿå¿˜äº†ï¼Œè¿™é‡Œå†è¡¥ä¸‹è¯¾ï¼š FSTs are finite-state machines that map a term (byte sequence) to an arbitrary output. å‡è®¾æˆ‘ä»¬çŽ°åœ¨è¦å°†mop, moth, pop, star, stop and top(term indexé‡Œçš„termå‰ç¼€)æ˜ å°„åˆ°åºå·ï¼š0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5(term dictionaryçš„blockä½ç½®)ã€‚æœ€ç®€å•çš„åšæ³•å°±æ˜¯å®šä¹‰ä¸ªMap&lt;String, Integer&gt;ï¼Œå¤§å®¶æ‰¾åˆ°è‡ªå·±çš„ä½ç½®å¯¹åº”å…¥åº§å°±å¥½äº†ï¼Œä½†ä»Žå†…å­˜å ç”¨å°‘çš„è§’åº¦æƒ³æƒ³ï¼Œæœ‰æ²¡æœ‰æ›´ä¼˜çš„åŠžæ³•å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ï¼šFST(ç†è®ºä¾æ®åœ¨æ­¤ï¼Œä½†æˆ‘ç›¸ä¿¡99%çš„äººä¸ä¼šè®¤çœŸçœ‹å®Œçš„) â­•ï¸è¡¨ç¤ºä¸€ç§çŠ¶æ€ â€“&gt;è¡¨ç¤ºçŠ¶æ€çš„å˜åŒ–è¿‡ç¨‹ï¼Œä¸Šé¢çš„å­—æ¯/æ•°å­—è¡¨ç¤ºçŠ¶æ€å˜åŒ–å’Œæƒé‡ å°†å•è¯åˆ†æˆå•ä¸ªå­—æ¯é€šè¿‡â­•ï¸å’Œâ€“&gt;è¡¨ç¤ºå‡ºæ¥ï¼Œ0æƒé‡ä¸æ˜¾ç¤ºã€‚å¦‚æžœâ­•ï¸åŽé¢å‡ºçŽ°åˆ†æ”¯ï¼Œå°±æ ‡è®°æƒé‡ï¼Œæœ€åŽæ•´æ¡è·¯å¾„ä¸Šçš„æƒé‡åŠ èµ·æ¥å°±æ˜¯è¿™ä¸ªå•è¯å¯¹åº”çš„åºå·ã€‚ FSTs are finite-state machines that map a term (byte sequence) to an arbitrary output. FSTä»¥å­—èŠ‚çš„æ–¹å¼å­˜å‚¨æ‰€æœ‰çš„termï¼Œè¿™ç§åŽ‹ç¼©æ–¹å¼å¯ä»¥æœ‰æ•ˆçš„ç¼©å‡å­˜å‚¨ç©ºé—´ï¼Œä½¿å¾—term indexè¶³ä»¥æ”¾è¿›å†…å­˜ï¼Œä½†è¿™ç§æ–¹å¼ä¹Ÿä¼šå¯¼è‡´æŸ¥æ‰¾æ—¶éœ€è¦æ›´å¤šçš„CPUèµ„æºã€‚ åŽé¢çš„æ›´ç²¾å½©ï¼Œçœ‹ç´¯äº†çš„åŒå­¦å¯ä»¥å–æ¯å’–å•¡â€¦â€¦ åŽ‹ç¼©æŠ€å·§Elasticsearché‡Œé™¤äº†ä¸Šé¢è¯´åˆ°ç”¨FSTåŽ‹ç¼©term indexå¤–ï¼Œå¯¹posting listä¹Ÿæœ‰åŽ‹ç¼©æŠ€å·§ã€‚å°æ˜Žå–å®Œå’–å•¡åˆä¸¾æ‰‹äº†:â€posting listä¸æ˜¯å·²ç»åªå­˜å‚¨æ–‡æ¡£idäº†å—ï¼Ÿè¿˜éœ€è¦åŽ‹ç¼©ï¼Ÿâ€ å—¯ï¼Œæˆ‘ä»¬å†çœ‹å›žæœ€å¼€å§‹çš„ä¾‹å­ï¼Œå¦‚æžœElasticsearchéœ€è¦å¯¹åŒå­¦çš„æ€§åˆ«è¿›è¡Œç´¢å¼•(è¿™æ—¶ä¼ ç»Ÿå…³ç³»åž‹æ•°æ®åº“å·²ç»å“­æ™•åœ¨åŽ•æ‰€â€¦â€¦)ï¼Œä¼šæ€Žæ ·ï¼Ÿå¦‚æžœæœ‰ä¸Šåƒä¸‡ä¸ªåŒå­¦ï¼Œè€Œä¸–ç•Œä¸Šåªæœ‰ç”·/å¥³è¿™æ ·ä¸¤ä¸ªæ€§åˆ«ï¼Œæ¯ä¸ªposting listéƒ½ä¼šæœ‰è‡³å°‘ç™¾ä¸‡ä¸ªæ–‡æ¡£idã€‚Elasticsearchæ˜¯å¦‚ä½•æœ‰æ•ˆçš„å¯¹è¿™äº›æ–‡æ¡£idåŽ‹ç¼©çš„å‘¢ï¼Ÿ Frame Of Reference å¢žé‡ç¼–ç åŽ‹ç¼©ï¼Œå°†å¤§æ•°å˜å°æ•°ï¼ŒæŒ‰å­—èŠ‚å­˜å‚¨ é¦–å…ˆï¼ŒElasticsearchè¦æ±‚posting listæ˜¯æœ‰åºçš„(ä¸ºäº†æé«˜æœç´¢çš„æ€§èƒ½ï¼Œå†ä»»æ€§çš„è¦æ±‚ä¹Ÿå¾—æ»¡è¶³)ï¼Œè¿™æ ·åšçš„ä¸€ä¸ªå¥½å¤„æ˜¯æ–¹ä¾¿åŽ‹ç¼©ï¼Œçœ‹ä¸‹é¢è¿™ä¸ªå›¾ä¾‹ï¼š å¦‚æžœæ•°å­¦ä¸æ˜¯ä½“è‚²è€å¸ˆæ•™çš„è¯ï¼Œè¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çœ‹å‡ºæ¥è¿™ç§åŽ‹ç¼©æŠ€å·§çš„ã€‚ åŽŸç†å°±æ˜¯é€šè¿‡å¢žé‡ï¼Œå°†åŽŸæ¥çš„å¤§æ•°å˜æˆå°æ•°ä»…å­˜å‚¨å¢žé‡å€¼ï¼Œå†ç²¾æ‰“ç»†ç®—æŒ‰bitæŽ’å¥½é˜Ÿï¼Œæœ€åŽé€šè¿‡å­—èŠ‚å­˜å‚¨ï¼Œè€Œä¸æ˜¯å¤§å¤§å’§å’§çš„å°½ç®¡æ˜¯2ä¹Ÿæ˜¯ç”¨int(4ä¸ªå­—èŠ‚)æ¥å­˜å‚¨ã€‚ Roaring bitmapsè¯´åˆ°Roaring bitmapsï¼Œå°±å¿…é¡»å…ˆä»Žbitmapè¯´èµ·ã€‚Bitmapæ˜¯ä¸€ç§æ•°æ®ç»“æž„ï¼Œå‡è®¾æœ‰æŸä¸ªposting listï¼š [1,3,4,7,10] å¯¹åº”çš„bitmapå°±æ˜¯ï¼š [1,0,1,1,0,0,1,0,0,1] éžå¸¸ç›´è§‚ï¼Œç”¨0/1è¡¨ç¤ºæŸä¸ªå€¼æ˜¯å¦å­˜åœ¨ï¼Œæ¯”å¦‚10è¿™ä¸ªå€¼å°±å¯¹åº”ç¬¬10ä½ï¼Œå¯¹åº”çš„bitå€¼æ˜¯1ï¼Œè¿™æ ·ç”¨ä¸€ä¸ªå­—èŠ‚å°±å¯ä»¥ä»£è¡¨8ä¸ªæ–‡æ¡£idï¼Œæ—§ç‰ˆæœ¬(5.0ä¹‹å‰)çš„Luceneå°±æ˜¯ç”¨è¿™æ ·çš„æ–¹å¼æ¥åŽ‹ç¼©çš„ï¼Œä½†è¿™æ ·çš„åŽ‹ç¼©æ–¹å¼ä»ç„¶ä¸å¤Ÿé«˜æ•ˆï¼Œå¦‚æžœæœ‰1äº¿ä¸ªæ–‡æ¡£ï¼Œé‚£ä¹ˆéœ€è¦12.5MBçš„å­˜å‚¨ç©ºé—´ï¼Œè¿™ä»…ä»…æ˜¯å¯¹åº”ä¸€ä¸ªç´¢å¼•å­—æ®µ(æˆ‘ä»¬å¾€å¾€ä¼šæœ‰å¾ˆå¤šä¸ªç´¢å¼•å­—æ®µ)ã€‚äºŽæ˜¯æœ‰äººæƒ³å‡ºäº†Roaring bitmapsè¿™æ ·æ›´é«˜æ•ˆçš„æ•°æ®ç»“æž„ã€‚ Bitmapçš„ç¼ºç‚¹æ˜¯å­˜å‚¨ç©ºé—´éšç€æ–‡æ¡£ä¸ªæ•°çº¿æ€§å¢žé•¿ï¼ŒRoaring bitmapséœ€è¦æ‰“ç ´è¿™ä¸ªé­”å’’å°±ä¸€å®šè¦ç”¨åˆ°æŸäº›æŒ‡æ•°ç‰¹æ€§ï¼š å°†posting listæŒ‰ç…§65535ä¸ºç•Œé™åˆ†å—ï¼Œæ¯”å¦‚ç¬¬ä¸€å—æ‰€åŒ…å«çš„æ–‡æ¡£idèŒƒå›´åœ¨065535ä¹‹é—´ï¼Œç¬¬äºŒå—çš„idèŒƒå›´æ˜¯65536131071ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚å†ç”¨&lt;å•†ï¼Œä½™æ•°&gt;çš„ç»„åˆè¡¨ç¤ºæ¯ä¸€ç»„idï¼Œè¿™æ ·æ¯ç»„é‡Œçš„idèŒƒå›´éƒ½åœ¨0~65535å†…äº†ï¼Œå‰©ä¸‹çš„å°±å¥½åŠžäº†ï¼Œæ—¢ç„¶æ¯ç»„idä¸ä¼šå˜å¾—æ— é™å¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æœ€æœ‰æ•ˆçš„æ–¹å¼å¯¹è¿™é‡Œçš„idå­˜å‚¨ã€‚ ç»†å¿ƒçš„å°æ˜Žè¿™æ—¶å€™åˆä¸¾æ‰‹äº†:â€ä¸ºä»€ä¹ˆæ˜¯ä»¥65535ä¸ºç•Œé™?â€ ç¨‹åºå‘˜çš„ä¸–ç•Œé‡Œé™¤äº†1024å¤–ï¼Œ65535ä¹Ÿæ˜¯ä¸€ä¸ªç»å…¸å€¼ï¼Œå› ä¸ºå®ƒ=2^16-1ï¼Œæ­£å¥½æ˜¯ç”¨2ä¸ªå­—èŠ‚èƒ½è¡¨ç¤ºçš„æœ€å¤§æ•°ï¼Œä¸€ä¸ªshortçš„å­˜å‚¨å•ä½ï¼Œæ³¨æ„åˆ°ä¸Šå›¾é‡Œçš„æœ€åŽä¸€è¡Œâ€œIf a block has more than 4096 values, encode as a bit set, and otherwise as a simple array using 2 bytes per valueâ€ï¼Œå¦‚æžœæ˜¯å¤§å—ï¼Œç”¨èŠ‚çœç‚¹ç”¨bitsetå­˜ï¼Œå°å—å°±è±ªçˆ½ç‚¹ï¼Œ2ä¸ªå­—èŠ‚æˆ‘ä¹Ÿä¸è®¡è¾ƒäº†ï¼Œç”¨ä¸€ä¸ªshort[]å­˜ç€æ–¹ä¾¿ã€‚ é‚£ä¸ºä»€ä¹ˆç”¨4096æ¥åŒºåˆ†é‡‡ç”¨æ•°ç»„è¿˜æ˜¯bitmapçš„é˜€å€¼å‘¢ï¼Ÿ è¿™ä¸ªæ˜¯ä»Žå†…å­˜å¤§å°è€ƒè™‘çš„ï¼Œå½“blockå—é‡Œå…ƒç´ è¶…è¿‡4096åŽï¼Œç”¨bitmapæ›´å‰©ç©ºé—´ï¼šé‡‡ç”¨bitmapéœ€è¦çš„ç©ºé—´æ˜¯æ’å®šçš„: 65536/8 = 8192bytesè€Œå¦‚æžœé‡‡ç”¨short[]ï¼Œæ‰€éœ€çš„ç©ºé—´æ˜¯: 2*N(Nä¸ºæ•°ç»„å…ƒç´ ä¸ªæ•°)å°æ˜Žæ‰‹æŒ‡ä¸€æŽN=4096åˆšå¥½æ˜¯è¾¹ç•Œ: è”åˆç´¢å¼•ä¸Šé¢è¯´äº†åŠå¤©éƒ½æ˜¯å•fieldç´¢å¼•ï¼Œå¦‚æžœå¤šä¸ªfieldç´¢å¼•çš„è”åˆæŸ¥è¯¢ï¼Œå€’æŽ’ç´¢å¼•å¦‚ä½•æ»¡è¶³å¿«é€ŸæŸ¥è¯¢çš„è¦æ±‚å‘¢ï¼Ÿ åˆ©ç”¨è·³è¡¨(Skip list)çš„æ•°æ®ç»“æž„å¿«é€Ÿåšâ€œä¸Žâ€è¿ç®—ï¼Œæˆ–è€… åˆ©ç”¨ä¸Šé¢æåˆ°çš„bitsetæŒ‰ä½â€œä¸Žâ€ å…ˆçœ‹çœ‹è·³è¡¨çš„æ•°æ®ç»“æž„ï¼š å°†ä¸€ä¸ªæœ‰åºé“¾è¡¨level0ï¼ŒæŒ‘å‡ºå…¶ä¸­å‡ ä¸ªå…ƒç´ åˆ°level1åŠlevel2ï¼Œæ¯ä¸ªlevelè¶Šå¾€ä¸Šï¼Œé€‰å‡ºæ¥çš„æŒ‡é’ˆå…ƒç´ è¶Šå°‘ï¼ŒæŸ¥æ‰¾æ—¶ä¾æ¬¡ä»Žé«˜levelå¾€ä½ŽæŸ¥æ‰¾ï¼Œæ¯”å¦‚55ï¼Œå…ˆæ‰¾åˆ°level2çš„31ï¼Œå†æ‰¾åˆ°level1çš„47ï¼Œæœ€åŽæ‰¾åˆ°55ï¼Œä¸€å…±3æ¬¡æŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾æ•ˆçŽ‡å’Œ2å‰æ ‘çš„æ•ˆçŽ‡ç›¸å½“ï¼Œä½†ä¹Ÿæ˜¯ç”¨äº†ä¸€å®šçš„ç©ºé—´å†—ä½™æ¥æ¢å–çš„ã€‚ å‡è®¾æœ‰ä¸‹é¢ä¸‰ä¸ªposting listéœ€è¦è”åˆç´¢å¼•ï¼š å¦‚æžœä½¿ç”¨è·³è¡¨ï¼Œå¯¹æœ€çŸ­çš„posting listä¸­çš„æ¯ä¸ªidï¼Œé€ä¸ªåœ¨å¦å¤–ä¸¤ä¸ªposting listä¸­æŸ¥æ‰¾çœ‹æ˜¯å¦å­˜åœ¨ï¼Œæœ€åŽå¾—åˆ°äº¤é›†çš„ç»“æžœã€‚ å¦‚æžœä½¿ç”¨bitsetï¼Œå°±å¾ˆç›´è§‚äº†ï¼Œç›´æŽ¥æŒ‰ä½ä¸Žï¼Œå¾—åˆ°çš„ç»“æžœå°±æ˜¯æœ€åŽçš„äº¤é›†ã€‚ æ€»ç»“å’Œæ€è€ƒElasticsearchçš„ç´¢å¼•æ€è·¯: å°†ç£ç›˜é‡Œçš„ä¸œè¥¿å°½é‡æ¬è¿›å†…å­˜ï¼Œå‡å°‘ç£ç›˜éšæœºè¯»å–æ¬¡æ•°(åŒæ—¶ä¹Ÿåˆ©ç”¨ç£ç›˜é¡ºåºè¯»ç‰¹æ€§)ï¼Œç»“åˆå„ç§å¥‡æŠ€æ·«å·§çš„åŽ‹ç¼©ç®—æ³•ï¼Œç”¨åŠå…¶è‹›åˆ»çš„æ€åº¦ä½¿ç”¨å†…å­˜ã€‚ æ‰€ä»¥ï¼Œå¯¹äºŽä½¿ç”¨Elasticsearchè¿›è¡Œç´¢å¼•æ—¶éœ€è¦æ³¨æ„: ä¸éœ€è¦ç´¢å¼•çš„å­—æ®µï¼Œä¸€å®šè¦æ˜Žç¡®å®šä¹‰å‡ºæ¥ï¼Œå› ä¸ºé»˜è®¤æ˜¯è‡ªåŠ¨å»ºç´¢å¼•çš„ åŒæ ·çš„é“ç†ï¼Œå¯¹äºŽStringç±»åž‹çš„å­—æ®µï¼Œä¸éœ€è¦analysisçš„ä¹Ÿéœ€è¦æ˜Žç¡®å®šä¹‰å‡ºæ¥ï¼Œå› ä¸ºé»˜è®¤ä¹Ÿæ˜¯ä¼šanalysisçš„ é€‰æ‹©æœ‰è§„å¾‹çš„IDå¾ˆé‡è¦ï¼Œéšæœºæ€§å¤ªå¤§çš„ID(æ¯”å¦‚javaçš„UUID)ä¸åˆ©äºŽæŸ¥è¯¢ å…³äºŽæœ€åŽä¸€ç‚¹ï¼Œä¸ªäººè®¤ä¸ºæœ‰å¤šä¸ªå› ç´ : å…¶ä¸­ä¸€ä¸ª(ä¹Ÿè®¸ä¸æ˜¯æœ€é‡è¦çš„)å› ç´ : ä¸Šé¢çœ‹åˆ°çš„åŽ‹ç¼©ç®—æ³•ï¼Œéƒ½æ˜¯å¯¹Posting listé‡Œçš„å¤§é‡IDè¿›è¡ŒåŽ‹ç¼©çš„ï¼Œé‚£å¦‚æžœIDæ˜¯é¡ºåºçš„ï¼Œæˆ–è€…æ˜¯æœ‰å…¬å…±å‰ç¼€ç­‰å…·æœ‰ä¸€å®šè§„å¾‹æ€§çš„IDï¼ŒåŽ‹ç¼©æ¯”ä¼šæ¯”è¾ƒé«˜ï¼› å¦å¤–ä¸€ä¸ªå› ç´ : å¯èƒ½æ˜¯æœ€å½±å“æŸ¥è¯¢æ€§èƒ½çš„ï¼Œåº”è¯¥æ˜¯æœ€åŽé€šè¿‡Posting listé‡Œçš„IDåˆ°ç£ç›˜ä¸­æŸ¥æ‰¾Documentä¿¡æ¯çš„é‚£æ­¥ï¼Œå› ä¸ºElasticsearchæ˜¯åˆ†Segmentå­˜å‚¨çš„ï¼Œæ ¹æ®IDè¿™ä¸ªå¤§èŒƒå›´çš„Termå®šä½åˆ°Segmentçš„æ•ˆçŽ‡ç›´æŽ¥å½±å“äº†æœ€åŽæŸ¥è¯¢çš„æ€§èƒ½ï¼Œå¦‚æžœIDæ˜¯æœ‰è§„å¾‹çš„ï¼Œå¯ä»¥å¿«é€Ÿè·³è¿‡ä¸åŒ…å«è¯¥IDçš„Segmentï¼Œä»Žè€Œå‡å°‘ä¸å¿…è¦çš„ç£ç›˜è¯»æ¬¡æ•°ï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡å¦‚ä½•é€‰æ‹©ä¸€ä¸ªé«˜æ•ˆçš„å…¨å±€IDæ–¹æ¡ˆ(è¯„è®ºä¹Ÿå¾ˆç²¾å½©) åŽç»­å†ç»“åˆå®žé™…å¼€å‘åŠè°ƒä¼˜å·¥ä½œåˆ†äº«æ›´å¤šå†…å®¹ï¼Œæ•¬è¯·æœŸå¾…ï¼ åŽŸæ–‡Elasticsearch å­¦ä¹ ç¬”è®°]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>ElasticSearch</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Epoll çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ]]></title>
    <url>%2Fepoll-principle.html</url>
    <content type="text"><![CDATA[ä»Žäº‹æœåŠ¡ç«¯å¼€å‘ï¼Œå°‘ä¸äº†è¦æŽ¥è§¦ç½‘ç»œç¼–ç¨‹ã€‚epoll ä½œä¸º Linux ä¸‹é«˜æ€§èƒ½ç½‘ç»œæœåŠ¡å™¨çš„å¿…å¤‡æŠ€æœ¯è‡³å…³é‡è¦ï¼Œnginxã€Redisã€Skynet å’Œå¤§éƒ¨åˆ†æ¸¸æˆæœåŠ¡å™¨éƒ½ä½¿ç”¨åˆ°è¿™ä¸€å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚ epoll å¾ˆé‡è¦ï¼Œä½†æ˜¯ epoll ä¸Ž select çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿepoll é«˜æ•ˆçš„åŽŸå› æ˜¯ä»€ä¹ˆï¼Ÿ ç½‘ä¸Šè™½ç„¶ä¹Ÿæœ‰ä¸å°‘è®²è§£ epollçš„æ–‡ç« ï¼Œä½†è¦ä¹ˆæ˜¯è¿‡äºŽæµ…æ˜¾ï¼Œæˆ–è€…é™·å…¥æºç è§£æžï¼Œå¾ˆå°‘èƒ½æœ‰é€šä¿—æ˜“æ‡‚çš„ã€‚ç¬”è€…äºŽæ˜¯å†³å®šç¼–å†™æ­¤æ–‡ï¼Œè®©ç¼ºä¹ä¸“ä¸šèƒŒæ™¯çŸ¥è¯†çš„è¯»è€…ä¹Ÿèƒ½å¤Ÿæ˜Žç™½ epoll çš„åŽŸç†ã€‚ æ–‡ç« æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šè¦è®©è¯»è€…æ¸…æ™°æ˜Žç™½ epoll ä¸ºä»€ä¹ˆæ€§èƒ½å¥½ã€‚ æœ¬æ–‡ä¼šä»Žç½‘å¡æŽ¥æ”¶æ•°æ®çš„æµç¨‹è®²èµ·ï¼Œä¸²è”èµ· CPU ä¸­æ–­ã€æ“ä½œç³»ç»Ÿè¿›ç¨‹è°ƒåº¦ç­‰çŸ¥è¯†ï¼›å†ä¸€æ­¥æ­¥åˆ†æžé˜»å¡žæŽ¥æ”¶æ•°æ®ã€select åˆ° epoll çš„è¿›åŒ–è¿‡ç¨‹ï¼›æœ€åŽæŽ¢ç©¶ epoll çš„å®žçŽ°ç»†èŠ‚ã€‚ ä¸€ã€ä»Žç½‘å¡æŽ¥æ”¶æ•°æ®è¯´èµ·ä¸‹è¾¹æ˜¯ä¸€ä¸ªå…¸åž‹çš„è®¡ç®—æœºç»“æž„å›¾ï¼Œè®¡ç®—æœºç”± CPUã€å­˜å‚¨å™¨ï¼ˆå†…å­˜ï¼‰ä¸Žç½‘ç»œæŽ¥å£ç­‰éƒ¨ä»¶ç»„æˆï¼Œäº†è§£ epoll æœ¬è´¨çš„ç¬¬ä¸€æ­¥ï¼Œè¦ä»Žç¡¬ä»¶çš„è§’åº¦çœ‹è®¡ç®—æœºæ€Žæ ·æŽ¥æ”¶ç½‘ç»œæ•°æ®ã€‚è®¡ç®—æœºç»“æž„å›¾ï¼ˆå›¾ç‰‡æ¥æºï¼šLinuxå†…æ ¸å®Œå…¨æ³¨é‡Šä¹‹å¾®åž‹è®¡ç®—æœºç»„æˆç»“æž„ï¼‰ ä¸‹å›¾å±•ç¤ºäº†ç½‘å¡æŽ¥æ”¶æ•°æ®çš„è¿‡ç¨‹ã€‚ åœ¨ â‘  é˜¶æ®µï¼Œç½‘å¡æ”¶åˆ°ç½‘çº¿ä¼ æ¥çš„æ•°æ®ï¼› ç»è¿‡ â‘¡ é˜¶æ®µçš„ç¡¬ä»¶ç”µè·¯çš„ä¼ è¾“ï¼› æœ€ç»ˆ â‘¢ é˜¶æ®µå°†æ•°æ®å†™å…¥åˆ°å†…å­˜ä¸­çš„æŸä¸ªåœ°å€ä¸Šã€‚ è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ° DMA ä¼ è¾“ã€IO é€šè·¯é€‰æ‹©ç­‰ç¡¬ä»¶æœ‰å…³çš„çŸ¥è¯†ï¼Œä½†æˆ‘ä»¬åªéœ€çŸ¥é“ï¼šç½‘å¡ä¼šæŠŠæŽ¥æ”¶åˆ°çš„æ•°æ®å†™å…¥å†…å­˜ã€‚ ç½‘å¡æŽ¥æ”¶æ•°æ®çš„è¿‡ç¨‹ é€šè¿‡ç¡¬ä»¶ä¼ è¾“ï¼Œç½‘å¡æŽ¥æ”¶çš„æ•°æ®å­˜æ”¾åˆ°å†…å­˜ä¸­ï¼Œæ“ä½œç³»ç»Ÿå°±å¯ä»¥åŽ»è¯»å–å®ƒä»¬ã€‚ äºŒã€å¦‚ä½•çŸ¥é“æŽ¥æ”¶äº†æ•°æ®ï¼Ÿäº†è§£ epoll æœ¬è´¨çš„ç¬¬äºŒæ­¥ï¼Œè¦ä»Ž CPU çš„è§’åº¦æ¥çœ‹æ•°æ®æŽ¥æ”¶ã€‚ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œè¦å…ˆäº†è§£ä¸€ä¸ªæ¦‚å¿µâ€”â€”ä¸­æ–­ã€‚ è®¡ç®—æœºæ‰§è¡Œç¨‹åºæ—¶ï¼Œä¼šæœ‰ä¼˜å…ˆçº§çš„éœ€æ±‚ã€‚æ¯”å¦‚ï¼Œå½“è®¡ç®—æœºæ”¶åˆ°æ–­ç”µä¿¡å·æ—¶ï¼Œå®ƒåº”ç«‹å³åŽ»ä¿å­˜æ•°æ®ï¼Œä¿å­˜æ•°æ®çš„ç¨‹åºå…·æœ‰è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼ˆç”µå®¹å¯ä»¥ä¿å­˜å°‘è®¸ç”µé‡ï¼Œä¾› CPU è¿è¡Œå¾ˆçŸ­çš„ä¸€å°æ®µæ—¶é—´ï¼‰ã€‚ ä¸€èˆ¬è€Œè¨€ï¼Œç”±ç¡¬ä»¶äº§ç”Ÿçš„ä¿¡å·éœ€è¦ CPU ç«‹é©¬åšå‡ºå›žåº”ï¼Œä¸ç„¶æ•°æ®å¯èƒ½å°±ä¸¢å¤±äº†ï¼Œæ‰€ä»¥å®ƒçš„ä¼˜å…ˆçº§å¾ˆé«˜ã€‚CPU ç†åº”ä¸­æ–­æŽ‰æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºï¼ŒåŽ»åšå‡ºå“åº”ï¼›å½“ CPU å®Œæˆå¯¹ç¡¬ä»¶çš„å“åº”åŽï¼Œå†é‡æ–°æ‰§è¡Œç”¨æˆ·ç¨‹åºã€‚ä¸­æ–­çš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼Œå®ƒå’Œå‡½æ•°è°ƒç”¨å·®ä¸å¤šï¼Œåªä¸è¿‡å‡½æ•°è°ƒç”¨æ˜¯äº‹å…ˆå®šå¥½ä½ç½®ï¼Œè€Œä¸­æ–­çš„ä½ç½®ç”±â€œä¿¡å·â€å†³å®šã€‚ä¸­æ–­ç¨‹åºè°ƒç”¨ ä»¥é”®ç›˜ä¸ºä¾‹ï¼Œå½“ç”¨æˆ·æŒ‰ä¸‹é”®ç›˜æŸä¸ªæŒ‰é”®æ—¶ï¼Œé”®ç›˜ä¼šç»™ CPU çš„ä¸­æ–­å¼•è„šå‘å‡ºä¸€ä¸ªé«˜ç”µå¹³ï¼ŒCPUèƒ½å¤Ÿæ•èŽ·è¿™ä¸ªä¿¡å·ï¼Œç„¶åŽæ‰§è¡Œé”®ç›˜ä¸­æ–­ç¨‹åºã€‚ä¸‹å›¾å±•ç¤ºäº†å„ç§ç¡¬ä»¶é€šè¿‡ä¸­æ–­ä¸Ž CPU äº¤äº’çš„è¿‡ç¨‹ã€‚CPU ä¸­æ–­ï¼ˆå›¾ç‰‡æ¥æºï¼šnet.pku.edu.cnï¼‰ çŽ°åœ¨å¯ä»¥å›žç­”â€œå¦‚ä½•çŸ¥é“æŽ¥æ”¶äº†æ•°æ®ï¼Ÿâ€è¿™ä¸ªé—®é¢˜äº†ï¼šå½“ç½‘å¡æŠŠæ•°æ®å†™å…¥åˆ°å†…å­˜åŽï¼Œç½‘å¡å‘ CPU å‘å‡ºä¸€ä¸ªä¸­æ–­ä¿¡å·ï¼Œæ“ä½œç³»ç»Ÿä¾¿èƒ½å¾—çŸ¥æœ‰æ–°æ•°æ®åˆ°æ¥ï¼Œå†é€šè¿‡ç½‘å¡ä¸­æ–­ç¨‹åºåŽ»å¤„ç†æ•°æ®ã€‚ ä¸‰ã€è¿›ç¨‹é˜»å¡žä¸ºä»€ä¹ˆä¸å ç”¨ CPU èµ„æºï¼Ÿäº†è§£ epoll æœ¬è´¨çš„ç¬¬ä¸‰æ­¥ï¼Œè¦ä»Žæ“ä½œç³»ç»Ÿè¿›ç¨‹è°ƒåº¦çš„è§’åº¦æ¥çœ‹æ•°æ®æŽ¥æ”¶ã€‚é˜»å¡žæ˜¯è¿›ç¨‹è°ƒåº¦çš„å…³é”®ä¸€çŽ¯ï¼ŒæŒ‡çš„æ˜¯è¿›ç¨‹åœ¨ç­‰å¾…æŸäº‹ä»¶ï¼ˆå¦‚æŽ¥æ”¶åˆ°ç½‘ç»œæ•°æ®ï¼‰å‘ç”Ÿä¹‹å‰çš„ç­‰å¾…çŠ¶æ€ï¼Œrecvã€select å’Œ epoll éƒ½æ˜¯é˜»å¡žæ–¹æ³•ã€‚ä¸‹è¾¹åˆ†æžä¸€ä¸‹è¿›ç¨‹é˜»å¡žä¸ºä»€ä¹ˆä¸å ç”¨ CPU èµ„æºï¼Ÿ ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä»Žæ™®é€šçš„ recv æŽ¥æ”¶å¼€å§‹åˆ†æžï¼Œå…ˆçœ‹çœ‹ä¸‹é¢ä»£ç ï¼š 123456789101112//åˆ›å»ºsocketint s = socket(AF_INET, SOCK_STREAM, 0); //ç»‘å®šbind(s, ...)//ç›‘å¬listen(s, ...)//æŽ¥å—å®¢æˆ·ç«¯è¿žæŽ¥int c = accept(s, ...)//æŽ¥æ”¶å®¢æˆ·ç«¯æ•°æ®recv(c, ...);//å°†æ•°æ®æ‰“å°å‡ºæ¥printf(...) è¿™æ˜¯ä¸€æ®µæœ€åŸºç¡€çš„ç½‘ç»œç¼–ç¨‹ä»£ç ï¼Œå…ˆæ–°å»º socket å¯¹è±¡ï¼Œä¾æ¬¡è°ƒç”¨ bindã€listen ä¸Ž acceptï¼Œæœ€åŽè°ƒç”¨ recv æŽ¥æ”¶æ•°æ®ã€‚recv æ˜¯ä¸ªé˜»å¡žæ–¹æ³•ï¼Œå½“ç¨‹åºè¿è¡Œåˆ° recv æ—¶ï¼Œå®ƒä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æŽ¥æ”¶åˆ°æ•°æ®æ‰å¾€ä¸‹æ‰§è¡Œã€‚ é‚£ä¹ˆé˜»å¡žçš„åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿ å·¥ä½œé˜Ÿåˆ—æ“ä½œç³»ç»Ÿä¸ºäº†æ”¯æŒå¤šä»»åŠ¡ï¼Œå®žçŽ°äº†è¿›ç¨‹è°ƒåº¦çš„åŠŸèƒ½ï¼Œä¼šæŠŠè¿›ç¨‹åˆ†ä¸ºâ€œè¿è¡Œâ€å’Œâ€œç­‰å¾…â€ç­‰å‡ ç§çŠ¶æ€ã€‚è¿è¡ŒçŠ¶æ€æ˜¯è¿›ç¨‹èŽ·å¾— CPU ä½¿ç”¨æƒï¼Œæ­£åœ¨æ‰§è¡Œä»£ç çš„çŠ¶æ€ï¼›ç­‰å¾…çŠ¶æ€æ˜¯é˜»å¡žçŠ¶æ€ï¼Œæ¯”å¦‚ä¸Šè¿°ç¨‹åºè¿è¡Œåˆ° recv æ—¶ï¼Œç¨‹åºä¼šä»Žè¿è¡ŒçŠ¶æ€å˜ä¸ºç­‰å¾…çŠ¶æ€ï¼ŒæŽ¥æ”¶åˆ°æ•°æ®åŽåˆå˜å›žè¿è¡ŒçŠ¶æ€ã€‚æ“ä½œç³»ç»Ÿä¼šåˆ†æ—¶æ‰§è¡Œå„ä¸ªè¿è¡ŒçŠ¶æ€çš„è¿›ç¨‹ï¼Œç”±äºŽé€Ÿåº¦å¾ˆå¿«ï¼Œçœ‹ä¸ŠåŽ»å°±åƒæ˜¯åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚ ä¸‹å›¾çš„è®¡ç®—æœºä¸­è¿è¡Œç€ Aã€B ä¸Ž C ä¸‰ä¸ªè¿›ç¨‹ï¼Œå…¶ä¸­è¿›ç¨‹ A æ‰§è¡Œç€ä¸Šè¿°åŸºç¡€ç½‘ç»œç¨‹åºï¼Œä¸€å¼€å§‹ï¼Œè¿™ 3 ä¸ªè¿›ç¨‹éƒ½è¢«æ“ä½œç³»ç»Ÿçš„å·¥ä½œé˜Ÿåˆ—æ‰€å¼•ç”¨ï¼Œå¤„äºŽè¿è¡ŒçŠ¶æ€ï¼Œä¼šåˆ†æ—¶æ‰§è¡Œã€‚å·¥ä½œé˜Ÿåˆ—ä¸­æœ‰ Aã€B å’Œ C ä¸‰ä¸ªè¿›ç¨‹ ç­‰å¾…é˜Ÿåˆ—å½“è¿›ç¨‹ A æ‰§è¡Œåˆ°åˆ›å»º socket çš„è¯­å¥æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªç”±æ–‡ä»¶ç³»ç»Ÿç®¡ç†çš„ socket å¯¹è±¡ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚è¿™ä¸ª socket å¯¹è±¡åŒ…å«äº†å‘é€ç¼“å†²åŒºã€æŽ¥æ”¶ç¼“å†²åŒºä¸Žç­‰å¾…é˜Ÿåˆ—ç­‰æˆå‘˜ã€‚ç­‰å¾…é˜Ÿåˆ—æ˜¯ä¸ªéžå¸¸é‡è¦çš„ç»“æž„ï¼Œå®ƒæŒ‡å‘æ‰€æœ‰éœ€è¦ç­‰å¾…è¯¥ socket äº‹ä»¶çš„è¿›ç¨‹ã€‚åˆ›å»º socket å½“ç¨‹åºæ‰§è¡Œåˆ° recv æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†è¿›ç¨‹ A ä»Žå·¥ä½œé˜Ÿåˆ—ç§»åŠ¨åˆ°è¯¥ socket çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚ç”±äºŽå·¥ä½œé˜Ÿåˆ—åªå‰©ä¸‹äº†è¿›ç¨‹ B å’Œ Cï¼Œä¾æ®è¿›ç¨‹è°ƒåº¦ï¼ŒCPU ä¼šè½®æµæ‰§è¡Œè¿™ä¸¤ä¸ªè¿›ç¨‹çš„ç¨‹åºï¼Œä¸ä¼šæ‰§è¡Œè¿›ç¨‹ A çš„ç¨‹åºã€‚æ‰€ä»¥è¿›ç¨‹ A è¢«é˜»å¡žï¼Œä¸ä¼šå¾€ä¸‹æ‰§è¡Œä»£ç ï¼Œä¹Ÿä¸ä¼šå ç”¨ CPU èµ„æºã€‚socket çš„ç­‰å¾…é˜Ÿåˆ— æ³¨ï¼šæ“ä½œç³»ç»Ÿæ·»åŠ ç­‰å¾…é˜Ÿåˆ—åªæ˜¯æ·»åŠ äº†å¯¹è¿™ä¸ªâ€œç­‰å¾…ä¸­â€è¿›ç¨‹çš„å¼•ç”¨ï¼Œä»¥ä¾¿åœ¨æŽ¥æ”¶åˆ°æ•°æ®æ—¶èŽ·å–è¿›ç¨‹å¯¹è±¡ã€å°†å…¶å”¤é†’ï¼Œè€Œéžç›´æŽ¥å°†è¿›ç¨‹ç®¡ç†çº³å…¥è‡ªå·±ä¹‹ä¸‹ã€‚ä¸Šå›¾ä¸ºäº†æ–¹ä¾¿è¯´æ˜Žï¼Œç›´æŽ¥å°†è¿›ç¨‹æŒ‚åˆ°ç­‰å¾…é˜Ÿåˆ—ä¹‹ä¸‹ã€‚ å”¤é†’è¿›ç¨‹å½“ socket æŽ¥æ”¶åˆ°æ•°æ®åŽï¼Œæ“ä½œç³»ç»Ÿå°†è¯¥ socket é˜Ÿåˆ—ä¸Šçš„è¿›ç¨‹é‡æ–°æ”¾å›žåˆ°å·¥ä½œé˜Ÿåˆ—ï¼Œè¯¥è¿›ç¨‹å˜æˆè¿è¡ŒçŠ¶æ€ï¼Œç»§ç»­æ‰§è¡Œä»£ç ã€‚åŒæ—¶ç”±äºŽ socket çš„æŽ¥æ”¶ç¼“å†²åŒºå·²ç»æœ‰äº†æ•°æ®ï¼Œrecv å¯ä»¥è¿”å›žæŽ¥æ”¶åˆ°çš„æ•°æ®ã€‚ å››ã€å†…æ ¸æŽ¥æ”¶ç½‘ç»œæ•°æ®å…¨è¿‡ç¨‹è¿™ä¸€æ­¥ï¼Œè´¯ç©¿ç½‘å¡ã€ä¸­æ–­ä¸Žè¿›ç¨‹è°ƒåº¦çš„çŸ¥è¯†ï¼Œå™è¿°é˜»å¡ž recv ä¸‹ï¼Œå†…æ ¸æŽ¥æ”¶æ•°æ®çš„å…¨è¿‡ç¨‹ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿›ç¨‹åœ¨ recv é˜»å¡žæœŸé—´ï¼Œè®¡ç®—æœºæ”¶åˆ°äº†å¯¹ç«¯ä¼ é€çš„æ•°æ®ï¼ˆæ­¥éª¤â‘ ï¼‰ï¼Œæ•°æ®ç»ç”±ç½‘å¡ä¼ é€åˆ°å†…å­˜ï¼ˆæ­¥éª¤â‘¡ï¼‰ï¼Œç„¶åŽç½‘å¡é€šè¿‡ä¸­æ–­ä¿¡å·é€šçŸ¥ CPU æœ‰æ•°æ®åˆ°è¾¾ï¼ŒCPU æ‰§è¡Œä¸­æ–­ç¨‹åºï¼ˆæ­¥éª¤â‘¢ï¼‰ã€‚ æ­¤å¤„çš„ä¸­æ–­ç¨‹åºä¸»è¦æœ‰ä¸¤é¡¹åŠŸèƒ½ï¼Œå…ˆå°†ç½‘ç»œæ•°æ®å†™å…¥åˆ°å¯¹åº” socket çš„æŽ¥æ”¶ç¼“å†²åŒºé‡Œé¢ï¼ˆæ­¥éª¤â‘£ï¼‰ï¼Œå†å”¤é†’è¿›ç¨‹ Aï¼ˆæ­¥éª¤â‘¤ï¼‰ï¼Œé‡æ–°å°†è¿›ç¨‹ A æ”¾å…¥å·¥ä½œé˜Ÿåˆ—ä¸­ã€‚å†…æ ¸æŽ¥æ”¶æ•°æ®å…¨è¿‡ç¨‹ å”¤é†’è¿›ç¨‹çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå”¤é†’è¿›ç¨‹ ä»¥ä¸Šæ˜¯å†…æ ¸æŽ¥æ”¶æ•°æ®å…¨è¿‡ç¨‹ï¼Œè¿™é‡Œæˆ‘ä»¬å¯èƒ½ä¼šæ€è€ƒä¸¤ä¸ªé—®é¢˜ï¼š å…¶ä¸€ï¼Œæ“ä½œç³»ç»Ÿå¦‚ä½•çŸ¥é“ç½‘ç»œæ•°æ®å¯¹åº”äºŽå“ªä¸ª socketï¼Ÿ å…¶äºŒï¼Œå¦‚ä½•åŒæ—¶ç›‘è§†å¤šä¸ª socket çš„æ•°æ®ï¼Ÿ ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šå› ä¸ºä¸€ä¸ª socket å¯¹åº”ç€ä¸€ä¸ªç«¯å£å·ï¼Œè€Œç½‘ç»œæ•°æ®åŒ…ä¸­åŒ…å«äº† ip å’Œç«¯å£çš„ä¿¡æ¯ï¼Œå†…æ ¸å¯ä»¥é€šè¿‡ç«¯å£å·æ‰¾åˆ°å¯¹åº”çš„ socketã€‚å½“ç„¶ï¼Œä¸ºäº†æé«˜å¤„ç†é€Ÿåº¦ï¼Œæ“ä½œç³»ç»Ÿä¼šç»´æŠ¤ç«¯å£å·åˆ° socket çš„ç´¢å¼•ç»“æž„ï¼Œä»¥å¿«é€Ÿè¯»å–ã€‚ ç¬¬äºŒä¸ªé—®é¢˜æ˜¯å¤šè·¯å¤ç”¨çš„é‡ä¸­ä¹‹é‡ï¼Œä¹Ÿæ­£æ˜¯æœ¬æ–‡åŽåŠéƒ¨åˆ†çš„é‡ç‚¹ã€‚ äº”ã€åŒæ—¶ç›‘è§†å¤šä¸ª socket çš„ç®€å•æ–¹æ³•æœåŠ¡ç«¯éœ€è¦ç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯è¿žæŽ¥ï¼Œè€Œ recv åªèƒ½ç›‘è§†å•ä¸ª socketï¼Œè¿™ç§çŸ›ç›¾ä¸‹ï¼Œäººä»¬å¼€å§‹å¯»æ‰¾ç›‘è§†å¤šä¸ª socket çš„æ–¹æ³•ã€‚epollçš„è¦ä¹‰å°±æ˜¯é«˜æ•ˆåœ°ç›‘è§†å¤šä¸ª socketã€‚ ä»ŽåŽ†å²å‘å±•è§’åº¦çœ‹ï¼Œå¿…ç„¶å…ˆå‡ºçŽ°ä¸€ç§ä¸å¤ªé«˜æ•ˆçš„æ–¹æ³•ï¼Œäººä»¬å†åŠ ä»¥æ”¹è¿›ï¼Œæ­£å¦‚ select ä¹‹äºŽ epollã€‚ å…ˆç†è§£ä¸å¤ªé«˜æ•ˆçš„ selectï¼Œæ‰èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£ epoll çš„æœ¬è´¨ã€‚ å‡å¦‚èƒ½å¤Ÿé¢„å…ˆä¼ å…¥ä¸€ä¸ª socket åˆ—è¡¨ï¼Œå¦‚æžœåˆ—è¡¨ä¸­çš„ socket éƒ½æ²¡æœ‰æ•°æ®ï¼ŒæŒ‚èµ·è¿›ç¨‹ï¼Œç›´åˆ°æœ‰ä¸€ä¸ª socket æ”¶åˆ°æ•°æ®ï¼Œå”¤é†’è¿›ç¨‹ã€‚è¿™ç§æ–¹æ³•å¾ˆç›´æŽ¥ï¼Œä¹Ÿæ˜¯ select çš„è®¾è®¡æ€æƒ³ã€‚ ä¸ºæ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å…ˆå¤ä¹  select çš„ç”¨æ³•ã€‚åœ¨ä¸‹è¾¹çš„ä»£ç ä¸­ï¼Œå…ˆå‡†å¤‡ä¸€ä¸ªæ•°ç»„ fdsï¼Œè®© fds å­˜æ”¾ç€æ‰€æœ‰éœ€è¦ç›‘è§†çš„ socketã€‚ç„¶åŽè°ƒç”¨ selectï¼Œå¦‚æžœ fds ä¸­çš„æ‰€æœ‰ socket éƒ½æ²¡æœ‰æ•°æ®ï¼Œselect ä¼šé˜»å¡žï¼Œç›´åˆ°æœ‰ä¸€ä¸ª socket æŽ¥æ”¶åˆ°æ•°æ®ï¼Œselect è¿”å›žï¼Œå”¤é†’è¿›ç¨‹ã€‚ç”¨æˆ·å¯ä»¥éåŽ† fdsï¼Œé€šè¿‡ FD_ISSET åˆ¤æ–­å…·ä½“å“ªä¸ª socket æ”¶åˆ°æ•°æ®ï¼Œç„¶åŽåšå‡ºå¤„ç†ã€‚ 1234567891011int s = socket(AF_INET, SOCK_STREAM, 0); bind(s, ...);listen(s, ...);int fds[] = å­˜æ”¾éœ€è¦ç›‘å¬çš„socket;while(1)&#123; int n = select(..., fds, ...) for(int i=0; i &lt; fds.count; i++)&#123; if(FD_ISSET(fds[i], ...))&#123; //fds[i]çš„æ•°æ®å¤„ç† &#125; &#125;&#125; select çš„æµç¨‹select çš„å®žçŽ°æ€è·¯å¾ˆç›´æŽ¥ï¼Œå‡å¦‚ç¨‹åºåŒæ—¶ç›‘è§†å¦‚ä¸‹å›¾çš„ sock1ã€sock2 å’Œ sock3 ä¸‰ä¸ª socketï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨ select ä¹‹åŽï¼Œæ“ä½œç³»ç»ŸæŠŠè¿›ç¨‹ A åˆ†åˆ«åŠ å…¥è¿™ä¸‰ä¸ª socket çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚æ“ä½œç³»ç»ŸæŠŠè¿›ç¨‹ A åˆ†åˆ«åŠ å…¥è¿™ä¸‰ä¸ª socket çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ å½“ä»»ä½•ä¸€ä¸ª socket æ”¶åˆ°æ•°æ®åŽï¼Œä¸­æ–­ç¨‹åºå°†å”¤èµ·è¿›ç¨‹ã€‚ä¸‹å›¾å±•ç¤ºäº† sock2 æŽ¥æ”¶åˆ°äº†æ•°æ®çš„å¤„ç†æµç¨‹ï¼š æ³¨ï¼šrecv å’Œ select çš„ä¸­æ–­å›žè°ƒå¯ä»¥è®¾ç½®æˆä¸åŒçš„å†…å®¹ã€‚ sock2 æŽ¥æ”¶åˆ°äº†æ•°æ®ï¼Œä¸­æ–­ç¨‹åºå”¤èµ·è¿›ç¨‹ A æ‰€è°“å”¤èµ·è¿›ç¨‹ï¼Œå°±æ˜¯å°†è¿›ç¨‹ä»Žæ‰€æœ‰çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤ï¼ŒåŠ å…¥åˆ°å·¥ä½œé˜Ÿåˆ—é‡Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå°†è¿›ç¨‹ A ä»Žæ‰€æœ‰ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œå†åŠ å…¥åˆ°å·¥ä½œé˜Ÿåˆ—é‡Œé¢ ç»ç”±è¿™äº›æ­¥éª¤ï¼Œå½“è¿›ç¨‹ A è¢«å”¤é†’åŽï¼Œå®ƒçŸ¥é“è‡³å°‘æœ‰ä¸€ä¸ª socket æŽ¥æ”¶äº†æ•°æ®ã€‚ç¨‹åºåªéœ€éåŽ†ä¸€é socket åˆ—è¡¨ï¼Œå°±å¯ä»¥å¾—åˆ°å°±ç»ªçš„ socketã€‚ è¿™ç§ç®€å•æ–¹å¼è¡Œä¹‹æœ‰æ•ˆï¼Œåœ¨å‡ ä¹Žæ‰€æœ‰æ“ä½œç³»ç»Ÿéƒ½æœ‰å¯¹åº”çš„å®žçŽ°ã€‚ ä½†æ˜¯ç®€å•çš„æ–¹æ³•å¾€å¾€æœ‰ç¼ºç‚¹ï¼Œä¸»è¦æ˜¯ï¼š å…¶ä¸€ï¼Œæ¯æ¬¡è°ƒç”¨ select éƒ½éœ€è¦å°†è¿›ç¨‹åŠ å…¥åˆ°æ‰€æœ‰ç›‘è§† socket çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œæ¯æ¬¡å”¤é†’éƒ½éœ€è¦ä»Žæ¯ä¸ªé˜Ÿåˆ—ä¸­ç§»é™¤ã€‚è¿™é‡Œæ¶‰åŠäº†ä¸¤æ¬¡éåŽ†ï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦å°†æ•´ä¸ª fds åˆ—è¡¨ä¼ é€’ç»™å†…æ ¸ï¼Œæœ‰ä¸€å®šçš„å¼€é”€ã€‚æ­£æ˜¯å› ä¸ºéåŽ†æ“ä½œå¼€é”€å¤§ï¼Œå‡ºäºŽæ•ˆçŽ‡çš„è€ƒé‡ï¼Œæ‰ä¼šè§„å®š select çš„æœ€å¤§ç›‘è§†æ•°é‡ï¼Œé»˜è®¤åªèƒ½ç›‘è§† 1024 ä¸ª socketã€‚ å…¶äºŒï¼Œè¿›ç¨‹è¢«å”¤é†’åŽï¼Œç¨‹åºå¹¶ä¸çŸ¥é“å“ªäº› socket æ”¶åˆ°æ•°æ®ï¼Œè¿˜éœ€è¦éåŽ†ä¸€æ¬¡ã€‚ é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰å‡å°‘éåŽ†çš„æ–¹æ³•ï¼Ÿæœ‰æ²¡æœ‰ä¿å­˜å°±ç»ª socket çš„æ–¹æ³•ï¼Ÿè¿™ä¸¤ä¸ªé—®é¢˜ä¾¿æ˜¯ epoll æŠ€æœ¯è¦è§£å†³çš„ã€‚ è¡¥å……è¯´æ˜Žï¼š æœ¬èŠ‚åªè§£é‡Šäº† select çš„ä¸€ç§æƒ…å½¢ã€‚å½“ç¨‹åºè°ƒç”¨ select æ—¶ï¼Œå†…æ ¸ä¼šå…ˆéåŽ†ä¸€é socketï¼Œå¦‚æžœæœ‰ä¸€ä¸ªä»¥ä¸Šçš„ socket æŽ¥æ”¶ç¼“å†²åŒºæœ‰æ•°æ®ï¼Œé‚£ä¹ˆ select ç›´æŽ¥è¿”å›žï¼Œä¸ä¼šé˜»å¡žã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ select çš„è¿”å›žå€¼æœ‰å¯èƒ½å¤§äºŽ 1 çš„åŽŸå› ä¹‹ä¸€ã€‚å¦‚æžœæ²¡æœ‰ socket æœ‰æ•°æ®ï¼Œè¿›ç¨‹æ‰ä¼šé˜»å¡žã€‚ å…­ã€epoll çš„è®¾è®¡æ€è·¯epoll æ˜¯åœ¨ select å‡ºçŽ° N å¤šå¹´åŽæ‰è¢«å‘æ˜Žçš„ï¼Œæ˜¯ select å’Œ pollï¼ˆpoll å’Œ select åŸºæœ¬ä¸€æ ·ï¼Œæœ‰å°‘é‡æ”¹è¿›ï¼‰çš„å¢žå¼ºç‰ˆæœ¬ã€‚epoll é€šè¿‡ä»¥ä¸‹ä¸€äº›æŽªæ–½æ¥æ”¹è¿›æ•ˆçŽ‡ï¼š æŽªæ–½ä¸€ï¼šåŠŸèƒ½åˆ†ç¦»select ä½Žæ•ˆçš„åŽŸå› ä¹‹ä¸€æ˜¯å°†â€œç»´æŠ¤ç­‰å¾…é˜Ÿåˆ—â€å’Œâ€œé˜»å¡žè¿›ç¨‹â€ä¸¤ä¸ªæ­¥éª¤åˆäºŒä¸ºä¸€ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯æ¬¡è°ƒç”¨ select éƒ½éœ€è¦è¿™ä¸¤æ­¥æ“ä½œï¼Œç„¶è€Œå¤§å¤šæ•°åº”ç”¨åœºæ™¯ä¸­ï¼Œéœ€è¦ç›‘è§†çš„ socket ç›¸å¯¹å›ºå®šï¼Œå¹¶ä¸éœ€è¦æ¯æ¬¡éƒ½ä¿®æ”¹ã€‚epoll å°†è¿™ä¸¤ä¸ªæ“ä½œåˆ†å¼€ï¼Œå…ˆç”¨ epoll_ctl ç»´æŠ¤ç­‰å¾…é˜Ÿåˆ—ï¼Œå†è°ƒç”¨ epoll_wait é˜»å¡žè¿›ç¨‹ã€‚æ˜¾è€Œæ˜“è§åœ°ï¼Œæ•ˆçŽ‡å°±èƒ½å¾—åˆ°æå‡ã€‚ ç›¸æ¯” selectï¼Œepoll æ‹†åˆ†äº†åŠŸèƒ½ ä¸ºæ–¹ä¾¿ç†è§£åŽç»­çš„å†…å®¹ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ epoll çš„ç”¨æ³•ã€‚å¦‚ä¸‹çš„ä»£ç ä¸­ï¼Œå…ˆç”¨ epoll_create åˆ›å»ºä¸€ä¸ª epoll å¯¹è±¡ epfdï¼Œå†é€šè¿‡ epoll_ctl å°†éœ€è¦ç›‘è§†çš„ socket æ·»åŠ åˆ° epfd ä¸­ï¼Œæœ€åŽè°ƒç”¨ epoll_wait ç­‰å¾…æ•°æ®ï¼š 12345678910111213int s = socket(AF_INET, SOCK_STREAM, 0); bind(s, ...)listen(s, ...)int epfd = epoll_create(...);epoll_ctl(epfd, ...); //å°†æ‰€æœ‰éœ€è¦ç›‘å¬çš„socketæ·»åŠ åˆ°epfdä¸­while(1)&#123; int n = epoll_wait(...) for(æŽ¥æ”¶åˆ°æ•°æ®çš„socket)&#123; //å¤„ç† &#125;&#125; åŠŸèƒ½åˆ†ç¦»ï¼Œä½¿å¾— epoll æœ‰äº†ä¼˜åŒ–çš„å¯èƒ½ã€‚ æŽªæ–½äºŒï¼šå°±ç»ªåˆ—è¡¨select ä½Žæ•ˆçš„å¦ä¸€ä¸ªåŽŸå› åœ¨äºŽç¨‹åºä¸çŸ¥é“å“ªäº› socket æ”¶åˆ°æ•°æ®ï¼Œåªèƒ½ä¸€ä¸ªä¸ªéåŽ†ã€‚å¦‚æžœå†…æ ¸ç»´æŠ¤ä¸€ä¸ªâ€œå°±ç»ªåˆ—è¡¨â€ï¼Œå¼•ç”¨æ”¶åˆ°æ•°æ®çš„ socketï¼Œå°±èƒ½é¿å…éåŽ†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè®¡ç®—æœºå…±æœ‰ä¸‰ä¸ª socketï¼Œæ”¶åˆ°æ•°æ®çš„ sock2 å’Œ sock3 è¢«å°±ç»ªåˆ—è¡¨ rdlist æ‰€å¼•ç”¨ã€‚å½“è¿›ç¨‹è¢«å”¤é†’åŽï¼Œåªè¦èŽ·å– rdlist çš„å†…å®¹ï¼Œå°±èƒ½å¤ŸçŸ¥é“å“ªäº› socket æ”¶åˆ°æ•°æ®ã€‚å°±ç»ªåˆ—è¡¨ç¤ºæ„å›¾ ä¸ƒã€epoll çš„åŽŸç†ä¸Žå·¥ä½œæµç¨‹æœ¬èŠ‚ä¼šä»¥ç¤ºä¾‹å’Œå›¾è¡¨æ¥è®²è§£ epoll çš„åŽŸç†å’Œå·¥ä½œæµç¨‹ã€‚ åˆ›å»º epoll å¯¹è±¡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“æŸä¸ªè¿›ç¨‹è°ƒç”¨ epoll_create æ–¹æ³•æ—¶ï¼Œå†…æ ¸ä¼šåˆ›å»ºä¸€ä¸ª eventpoll å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯ç¨‹åºä¸­ epfd æ‰€ä»£è¡¨çš„å¯¹è±¡ï¼‰ã€‚eventpoll å¯¹è±¡ä¹Ÿæ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€å‘˜ï¼Œå’Œ socket ä¸€æ ·ï¼Œå®ƒä¹Ÿä¼šæœ‰ç­‰å¾…é˜Ÿåˆ—ã€‚å†…æ ¸åˆ›å»º eventpoll å¯¹è±¡ åˆ›å»ºä¸€ä¸ªä»£è¡¨è¯¥ epoll çš„ eventpoll å¯¹è±¡æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºå†…æ ¸è¦ç»´æŠ¤â€œå°±ç»ªåˆ—è¡¨â€ç­‰æ•°æ®ï¼Œâ€œå°±ç»ªåˆ—è¡¨â€å¯ä»¥ä½œä¸º eventpoll çš„æˆå‘˜ã€‚ ç»´æŠ¤ç›‘è§†åˆ—è¡¨åˆ›å»º epoll å¯¹è±¡åŽï¼Œå¯ä»¥ç”¨ epoll_ctl æ·»åŠ æˆ–åˆ é™¤æ‰€è¦ç›‘å¬çš„ socketã€‚ä»¥æ·»åŠ  socket ä¸ºä¾‹ï¼Œå¦‚ä¸‹å›¾ï¼Œå¦‚æžœé€šè¿‡ epoll_ctl æ·»åŠ  sock1ã€sock2 å’Œ sock3 çš„ç›‘è§†ï¼Œå†…æ ¸ä¼šå°† eventpoll æ·»åŠ åˆ°è¿™ä¸‰ä¸ª socket çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚æ·»åŠ æ‰€è¦ç›‘å¬çš„ socket å½“ socket æ”¶åˆ°æ•°æ®åŽï¼Œä¸­æ–­ç¨‹åºä¼šæ“ä½œ eventpoll å¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æŽ¥æ“ä½œè¿›ç¨‹ã€‚ æŽ¥æ”¶æ•°æ®å½“ socket æ”¶åˆ°æ•°æ®åŽï¼Œä¸­æ–­ç¨‹åºä¼šç»™ eventpoll çš„â€œå°±ç»ªåˆ—è¡¨â€æ·»åŠ  socket å¼•ç”¨ã€‚å¦‚ä¸‹å›¾å±•ç¤ºçš„æ˜¯ sock2 å’Œ sock3 æ”¶åˆ°æ•°æ®åŽï¼Œä¸­æ–­ç¨‹åºè®© rdlist å¼•ç”¨è¿™ä¸¤ä¸ª socketã€‚ç»™å°±ç»ªåˆ—è¡¨æ·»åŠ å¼•ç”¨ eventpoll å¯¹è±¡ç›¸å½“äºŽ socket å’Œè¿›ç¨‹ä¹‹é—´çš„ä¸­ä»‹ï¼Œsocket çš„æ•°æ®æŽ¥æ”¶å¹¶ä¸ç›´æŽ¥å½±å“è¿›ç¨‹ï¼Œè€Œæ˜¯é€šè¿‡æ”¹å˜ eventpoll çš„å°±ç»ªåˆ—è¡¨æ¥æ”¹å˜è¿›ç¨‹çŠ¶æ€ã€‚ å½“ç¨‹åºæ‰§è¡Œåˆ° epoll_wait æ—¶ï¼Œå¦‚æžœ rdlist å·²ç»å¼•ç”¨äº† socketï¼Œé‚£ä¹ˆ epoll_wait ç›´æŽ¥è¿”å›žï¼Œå¦‚æžœ rdlist ä¸ºç©ºï¼Œé˜»å¡žè¿›ç¨‹ã€‚ é˜»å¡žå’Œå”¤é†’è¿›ç¨‹å‡è®¾è®¡ç®—æœºä¸­æ­£åœ¨è¿è¡Œè¿›ç¨‹ A å’Œè¿›ç¨‹ Bï¼Œåœ¨æŸæ—¶åˆ»è¿›ç¨‹ A è¿è¡Œåˆ°äº† epoll_wait è¯­å¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå†…æ ¸ä¼šå°†è¿›ç¨‹ A æ”¾å…¥ eventpoll çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œé˜»å¡žè¿›ç¨‹ã€‚epoll_wait é˜»å¡žè¿›ç¨‹ å½“ socket æŽ¥æ”¶åˆ°æ•°æ®ï¼Œä¸­æ–­ç¨‹åºä¸€æ–¹é¢ä¿®æ”¹ rdlistï¼Œå¦ä¸€æ–¹é¢å”¤é†’ eventpoll ç­‰å¾…é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ï¼Œè¿›ç¨‹ A å†æ¬¡è¿›å…¥è¿è¡ŒçŠ¶æ€ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚ä¹Ÿå› ä¸º rdlist çš„å­˜åœ¨ï¼Œè¿›ç¨‹ A å¯ä»¥çŸ¥é“å“ªäº› socket å‘ç”Ÿäº†å˜åŒ–ã€‚epoll å”¤é†’è¿›ç¨‹ å…«ã€epoll çš„å®žçŽ°ç»†èŠ‚è‡³æ­¤ï¼Œç›¸ä¿¡è¯»è€…å¯¹ epoll çš„æœ¬è´¨å·²ç»æœ‰ä¸€å®šçš„äº†è§£ã€‚ä½†æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ eventpoll çš„æ•°æ®ç»“æž„æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ æ­¤å¤–ï¼Œå°±ç»ªé˜Ÿåˆ—åº”è¯¥åº”ä½¿ç”¨ä»€ä¹ˆæ•°æ®ç»“æž„ï¼Ÿeventpoll åº”ä½¿ç”¨ä»€ä¹ˆæ•°æ®ç»“æž„æ¥ç®¡ç†é€šè¿‡ epoll_ctl æ·»åŠ æˆ–åˆ é™¤çš„ socketï¼Ÿ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œeventpoll åŒ…å«äº† lockã€mtxã€wqï¼ˆç­‰å¾…é˜Ÿåˆ—ï¼‰ä¸Ž rdlist ç­‰æˆå‘˜ï¼Œå…¶ä¸­ rdlist å’Œ rbr æ˜¯æˆ‘ä»¬æ‰€å…³å¿ƒçš„ã€‚epoll åŽŸç†ç¤ºæ„å›¾ï¼Œå›¾ç‰‡æ¥æºï¼šã€Šæ·±å…¥ç†è§£Nginxï¼šæ¨¡å—å¼€å‘ä¸Žæž¶æž„è§£æž(ç¬¬äºŒç‰ˆ)ã€‹ï¼Œé™¶è¾‰ å°±ç»ªåˆ—è¡¨çš„æ•°æ®ç»“æž„å°±ç»ªåˆ—è¡¨å¼•ç”¨ç€å°±ç»ªçš„ socketï¼Œæ‰€ä»¥å®ƒåº”èƒ½å¤Ÿå¿«é€Ÿçš„æ’å…¥æ•°æ®ã€‚ ç¨‹åºå¯èƒ½éšæ—¶è°ƒç”¨ epoll_ctl æ·»åŠ ç›‘è§† socketï¼Œä¹Ÿå¯èƒ½éšæ—¶åˆ é™¤ã€‚å½“åˆ é™¤æ—¶ï¼Œè‹¥è¯¥ socket å·²ç»å­˜æ”¾åœ¨å°±ç»ªåˆ—è¡¨ä¸­ï¼Œå®ƒä¹Ÿåº”è¯¥è¢«ç§»é™¤ã€‚æ‰€ä»¥å°±ç»ªåˆ—è¡¨åº”æ˜¯ä¸€ç§èƒ½å¤Ÿå¿«é€Ÿæ’å…¥å’Œåˆ é™¤çš„æ•°æ®ç»“æž„ã€‚ åŒå‘é“¾è¡¨å°±æ˜¯è¿™æ ·ä¸€ç§æ•°æ®ç»“æž„ï¼Œepoll ä½¿ç”¨åŒå‘é“¾è¡¨æ¥å®žçŽ°å°±ç»ªé˜Ÿåˆ—ï¼ˆå¯¹åº”ä¸Šå›¾çš„ rdllistï¼‰ã€‚ ç´¢å¼•ç»“æž„æ—¢ç„¶ epoll å°†â€œç»´æŠ¤ç›‘è§†é˜Ÿåˆ—â€å’Œâ€œè¿›ç¨‹é˜»å¡žâ€åˆ†ç¦»ï¼Œä¹Ÿæ„å‘³ç€éœ€è¦æœ‰ä¸ªæ•°æ®ç»“æž„æ¥ä¿å­˜ç›‘è§†çš„ socketï¼Œè‡³å°‘è¦æ–¹ä¾¿åœ°æ·»åŠ å’Œç§»é™¤ï¼Œè¿˜è¦ä¾¿äºŽæœç´¢ï¼Œä»¥é¿å…é‡å¤æ·»åŠ ã€‚çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæœç´¢ã€æ’å…¥å’Œåˆ é™¤æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(log(N))ï¼Œæ•ˆçŽ‡è¾ƒå¥½ï¼Œepoll ä½¿ç”¨äº†çº¢é»‘æ ‘ä½œä¸ºç´¢å¼•ç»“æž„ï¼ˆå¯¹åº”ä¸Šå›¾çš„ rbrï¼‰ã€‚ æ³¨ï¼šå› ä¸ºæ“ä½œç³»ç»Ÿè¦å…¼é¡¾å¤šç§åŠŸèƒ½ï¼Œä»¥åŠç”±æ›´å¤šéœ€è¦ä¿å­˜çš„æ•°æ®ï¼Œrdlist å¹¶éžç›´æŽ¥å¼•ç”¨ socketï¼Œè€Œæ˜¯é€šè¿‡ epitem é—´æŽ¥å¼•ç”¨ï¼Œçº¢é»‘æ ‘çš„èŠ‚ç‚¹ä¹Ÿæ˜¯ epitem å¯¹è±¡ã€‚åŒæ ·ï¼Œæ–‡ä»¶ç³»ç»Ÿä¹Ÿå¹¶éžç›´æŽ¥å¼•ç”¨ç€ socketã€‚ä¸ºæ–¹ä¾¿ç†è§£ï¼Œæœ¬æ–‡ä¸­çœç•¥äº†ä¸€äº›é—´æŽ¥ç»“æž„ã€‚ ä¹ã€å°ç»“epoll åœ¨ select å’Œ poll çš„åŸºç¡€ä¸Šå¼•å…¥äº† eventpoll ä½œä¸ºä¸­é—´å±‚ï¼Œä½¿ç”¨äº†å…ˆè¿›çš„æ•°æ®ç»“æž„ï¼Œæ˜¯ä¸€ç§é«˜æ•ˆçš„å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚è¿™é‡Œä¹Ÿä»¥è¡¨æ ¼å½¢å¼ç®€å•å¯¹æ¯”ä¸€ä¸‹ selectã€poll ä¸Ž epollï¼Œç»“æŸæ­¤æ–‡ã€‚å¸Œæœ›è¯»è€…èƒ½æœ‰æ‰€æ”¶èŽ·ã€‚ åŽŸæ–‡åœ°å€ï¼šhttps://my.oschina.net/editorial-story/blog/3052308]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Epoll</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java åŽŸå­æ“ä½œçš„å®žçŽ°åŽŸç†]]></title>
    <url>%2Fjava-atomic-operation-principle.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ•´ç†è‡ªã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ç¬¬äºŒç«  ä½œè€…ï¼šæ–¹è…¾é£ž é­é¹ ç¨‹æ™“æ˜Ž åŽŸå­ï¼ˆatomicï¼‰æœ¬æ„æ˜¯â€œä¸èƒ½è¢«è¿›ä¸€æ­¥åˆ†å‰²çš„æœ€å°ç²’å­â€ï¼Œè€ŒåŽŸå­æ“ä½œï¼ˆatomic operationï¼‰æ„ä¸ºâ€œä¸å¯è¢«ä¸­æ–­çš„ä¸€ä¸ªæˆ–ä¸€ç³»åˆ—æ“ä½œâ€ã€‚åœ¨å¤šå¤„ç†å™¨ä¸Šå®žçŽ°åŽŸå­æ“ä½œå°±å˜å¾—æœ‰ç‚¹å¤æ‚ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ¥èŠä¸€èŠåœ¨Intelå¤„ç†å™¨å’ŒJavaé‡Œæ˜¯å¦‚ä½•å®žçŽ°åŽŸå­æ“ä½œçš„ã€‚ æœ¯è¯­å®šä¹‰åœ¨äº†è§£åŽŸå­æ“ä½œçš„å®žçŽ°åŽŸç†å‰ï¼Œå…ˆè¦äº†è§£ä¸€ä¸‹ç›¸å…³çš„æœ¯è¯­: table th:first-of-type { width: 100px; } table th:nth-of-type(2) { width: 150px; } æœ¯è¯­åç§° è‹±æ–‡ è§£é‡Š ç¼“å­˜è¡Œ Cache line ç¼“å­˜çš„æœ€å°æ“ä½œå•ä½ æ¯”è¾ƒå¹¶äº¤æ¢ Compare and Swap CASæ“ä½œéœ€è¦è¾“å…¥ä¸¤ä¸ªæ•°å€¼ï¼Œä¸€ä¸ªæ—§å€¼(æœŸæœ›æ“ä½œå‰çš„å€¼)å’Œä¸€ä¸ªæ–°å€¼ï¼Œåœ¨æ“ä½œæœŸé—´å…ˆæ¯”è¾ƒæ—§å€¼æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æžœæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œæ‰äº¤æ¢æˆæ–°å€¼ï¼Œå‘ç”Ÿäº†å˜åŒ–åˆ™ä¸äº¤æ¢ã€‚ CPUæµæ°´çº¿ CPU pipeline CPUæµæ°´çº¿çš„å·¥ä½œæ–¹å¼å°±åƒå·¥ä¸šç”Ÿäº§ä¸Šçš„è£…é…æµæ°´çº¿ï¼Œåœ¨CPUä¸­ç”±5~6ä¸ªä¸åŒåŠŸèƒ½çš„ç”µè·¯å•å…ƒç»„æˆä¸€æ¡æŒ‡ä»¤å¤„ç†æµæ°´çº¿ï¼Œç„¶åŽå°†ä¸€æ¡X86æŒ‡ä»¤åˆ†æˆ5~6æ­¥åŽå†ç”±è¿™äº›ç”µè·¯å•å…ƒåˆ†åˆ«æ‰§è¡Œï¼Œè¿™æ ·å°±èƒ½å®žçŽ°åœ¨ä¸€ä¸ªCPUæ—¶é’Ÿå‘¨æœŸå®Œæˆä¸€æ¡æŒ‡ä»¤ï¼Œå› æ­¤æé«˜CPUçš„è¿ç®—é€Ÿåº¦ å†…å­˜é¡ºåºå†²çª Memory order violation å†…å­˜é¡ºåºå†²çªä¸€èˆ¬æ˜¯ç”±å‡å…±äº«å¼•èµ·çš„ï¼Œå‡å…±äº«æ˜¯æŒ‡å¤šä¸ªCPUåŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªç¼“å­˜è¡Œçš„ä¸åŒéƒ¨åˆ†è€Œå¼•èµ·å…¶ä¸­ä¸€ä¸ªCPUçš„æ“ä½œæ— æ•ˆï¼Œå½“å‡ºçŽ°è¿™ä¸ªå†…å­˜é¡ºåºå†²çªæ—¶ï¼ŒCPUå¿…é¡»æ¸…ç©ºæµæ°´çº¿ å¤„ç†å™¨å¦‚ä½•å®žçŽ°åŽŸå­æ“ä½œ32ä½IA-32å¤„ç†å™¨ä½¿ç”¨åŸºäºŽå¯¹ç¼“å­˜åŠ é”æˆ–æ€»çº¿åŠ é”çš„æ–¹å¼æ¥å®žçŽ°å¤šå¤„ç†å™¨ä¹‹é—´çš„åŽŸå­æ“ä½œã€‚é¦–å…ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨ä¿è¯åŸºæœ¬çš„å†…å­˜æ“ä½œçš„åŽŸå­æ€§ã€‚å¤„ç†å™¨ä¿è¯ä»Žç³»ç»Ÿå†…å­˜ä¸­è¯»å–æˆ–è€…å†™å…¥ä¸€ä¸ªå­—èŠ‚æ˜¯åŽŸå­çš„ï¼Œæ„æ€æ˜¯å½“ä¸€ä¸ªå¤„ç†å™¨è¯»å–ä¸€ä¸ªå­—èŠ‚æ—¶ï¼Œå…¶ä»–å¤„ç†å™¨ä¸èƒ½è®¿é—®è¿™ä¸ªå­—èŠ‚çš„å†…å­˜åœ°å€ã€‚Pentium 6å’Œæœ€æ–°çš„å¤„ç†å™¨èƒ½è‡ªåŠ¨ä¿è¯å•å¤„ç†å™¨å¯¹åŒä¸€ä¸ªç¼“å­˜è¡Œé‡Œè¿›è¡Œ16/32/64ä½çš„æ“ä½œæ˜¯åŽŸå­çš„ï¼Œä½†æ˜¯å¤æ‚çš„å†…å­˜æ“ä½œå¤„ç†å™¨æ˜¯ä¸èƒ½è‡ªåŠ¨ä¿è¯å…¶åŽŸå­æ€§çš„ï¼Œæ¯”å¦‚è·¨æ€»çº¿å®½åº¦ã€è·¨å¤šä¸ªç¼“å­˜è¡Œå’Œè·¨é¡µè¡¨çš„è®¿é—®ã€‚ä½†æ˜¯ï¼Œå¤„ç†å™¨æä¾›æ€»çº¿é”å®šå’Œç¼“å­˜é”å®šä¸¤ä¸ªæœºåˆ¶æ¥ä¿è¯å¤æ‚å†…å­˜æ“ä½œçš„åŽŸå­æ€§ã€‚ åœ¨Intel 2019å¹´çš„æ–‡æ¡£ä¸­ï¼Œè¯¥éƒ¨åˆ†é˜è¿°åŸºæœ¬ä¸å˜ï¼Œå…·ä½“å¯ä»¥æŸ¥è€ƒæ–‡æœ«Intelæ–‡æ¡£çš„2957é¡µ 8.1 LOCKED ATOMIC OPERATIONS ä½¿ç”¨æ€»çº¿é”ä¿è¯åŽŸå­æ€§ç¬¬ä¸€ä¸ªæœºåˆ¶æ˜¯é€šè¿‡æ€»çº¿é”ä¿è¯åŽŸå­æ€§ã€‚å¦‚æžœå¤šä¸ªå¤„ç†å™¨åŒæ—¶å¯¹å…±äº«å˜é‡è¿›è¡Œè¯»æ”¹å†™æ“ä½œï¼ˆi++å°±æ˜¯ç»å…¸çš„è¯»æ”¹å†™æ“ä½œï¼‰ï¼Œé‚£ä¹ˆå…±äº«å˜é‡å°±ä¼šè¢«å¤šä¸ªå¤„ç†å™¨åŒæ—¶è¿›è¡Œæ“ä½œï¼Œè¿™æ ·è¯»æ”¹å†™æ“ä½œå°±ä¸æ˜¯åŽŸå­çš„ï¼Œæ“ä½œå®Œä¹‹åŽå…±äº«å˜é‡çš„å€¼ä¼šå’ŒæœŸæœ›çš„ä¸ä¸€è‡´ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æžœi=1ï¼Œæˆ‘ä»¬è¿›è¡Œä¸¤æ¬¡i++æ“ä½œï¼Œæˆ‘ä»¬æœŸæœ›çš„ç»“æžœæ˜¯3ï¼Œä½†æ˜¯æœ‰å¯èƒ½ç»“æžœæ˜¯2ï¼Œå¦‚å›¾2-3æ‰€ç¤ºã€‚ åŽŸå› å¯èƒ½æ˜¯å¤šä¸ªå¤„ç†å™¨åŒæ—¶ä»Žå„è‡ªçš„ç¼“å­˜ä¸­è¯»å–å˜é‡iï¼Œåˆ†åˆ«è¿›è¡ŒåŠ 1æ“ä½œï¼Œç„¶åŽåˆ†åˆ«å†™å…¥ç³»ç»Ÿå†…å­˜ä¸­ã€‚é‚£ä¹ˆï¼Œæƒ³è¦ä¿è¯è¯»æ”¹å†™å…±äº«å˜é‡çš„æ“ä½œæ˜¯åŽŸå­çš„ï¼Œå°±å¿…é¡»ä¿è¯CPU1è¯»æ”¹å†™å…±äº«å˜é‡çš„æ—¶å€™ï¼ŒCPU2ä¸èƒ½æ“ä½œç¼“å­˜äº†è¯¥å…±äº«å˜é‡å†…å­˜åœ°å€çš„ç¼“å­˜ã€‚å¤„ç†å™¨ä½¿ç”¨æ€»çº¿é”å°±æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚æ‰€è°“æ€»çº¿é”å°±æ˜¯ä½¿ç”¨å¤„ç†å™¨æä¾›çš„ä¸€ä¸ªLOCKï¼ƒä¿¡å·ï¼Œå½“ä¸€ä¸ªå¤„ç†å™¨åœ¨æ€»çº¿ä¸Šè¾“å‡ºæ­¤ä¿¡å·æ—¶ï¼Œå…¶ä»–å¤„ç†å™¨çš„è¯·æ±‚å°†è¢«é˜»å¡žä½ï¼Œé‚£ä¹ˆè¯¥å¤„ç†å™¨å¯ä»¥ç‹¬å å…±äº«å†…å­˜ã€‚ Intelæ–‡æ¡£çš„2959é¡µ 8.1.2 Bus Locking ä½¿ç”¨ç¼“å­˜é”ä¿è¯åŽŸå­æ€§ç¬¬äºŒä¸ªæœºåˆ¶æ˜¯é€šè¿‡ç¼“å­˜é”å®šæ¥ä¿è¯åŽŸå­æ€§ã€‚åœ¨åŒä¸€æ—¶åˆ»ï¼Œæˆ‘ä»¬åªéœ€ä¿è¯å¯¹æŸä¸ªå†…å­˜åœ°å€çš„æ“ä½œæ˜¯åŽŸå­æ€§å³å¯ï¼Œä½†æ€»çº¿é”å®šæŠŠCPUå’Œå†…å­˜ä¹‹é—´çš„é€šä¿¡é”ä½äº†ï¼Œè¿™ä½¿å¾—é”å®šæœŸé—´ï¼Œå…¶ä»–å¤„ç†å™¨ä¸èƒ½æ“ä½œå…¶ä»–å†…å­˜åœ°å€çš„æ•°æ®ï¼Œæ‰€ä»¥æ€»çº¿é”å®šçš„å¼€é”€æ¯”è¾ƒå¤§ï¼Œç›®å‰å¤„ç†å™¨åœ¨æŸäº›åœºåˆä¸‹ä½¿ç”¨ç¼“å­˜é”å®šä»£æ›¿æ€»çº¿é”å®šæ¥è¿›è¡Œä¼˜åŒ–ã€‚ é¢‘ç¹ä½¿ç”¨çš„å†…å­˜ä¼šç¼“å­˜åœ¨å¤„ç†å™¨çš„L1ã€L2å’ŒL3é«˜é€Ÿç¼“å­˜é‡Œï¼Œé‚£ä¹ˆåŽŸå­æ“ä½œå°±å¯ä»¥ç›´æŽ¥åœ¨å¤„ç†å™¨å†…éƒ¨ç¼“å­˜ä¸­è¿›è¡Œï¼Œå¹¶ä¸éœ€è¦å£°æ˜Žæ€»çº¿é”ï¼Œåœ¨Pentium 6å’Œç›®å‰çš„å¤„ç†å™¨ä¸­å¯ä»¥ä½¿ç”¨â€œç¼“å­˜é”å®šâ€çš„æ–¹å¼æ¥å®žçŽ°å¤æ‚çš„åŽŸå­æ€§ã€‚æ‰€è°“â€œç¼“å­˜é”å®šâ€æ˜¯æŒ‡å†…å­˜åŒºåŸŸå¦‚æžœè¢«ç¼“å­˜åœ¨å¤„ç†å™¨çš„ç¼“å­˜è¡Œä¸­ï¼Œå¹¶ä¸”åœ¨Lockæ“ä½œæœŸé—´è¢«é”å®šï¼Œé‚£ä¹ˆå½“å®ƒæ‰§è¡Œé”æ“ä½œå›žå†™åˆ°å†…å­˜æ—¶ï¼Œå¤„ç†å™¨ä¸åœ¨æ€»çº¿ä¸Šå£°è¨€LOCKï¼ƒä¿¡å·ï¼Œè€Œæ˜¯ä¿®æ”¹å†…éƒ¨çš„å†…å­˜åœ°å€ï¼Œå¹¶å…è®¸å®ƒçš„ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶æ¥ä¿è¯æ“ä½œçš„åŽŸå­æ€§ï¼Œå› ä¸ºç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶ä¼šé˜»æ­¢åŒæ—¶ä¿®æ”¹ç”±ä¸¤ä¸ªä»¥ä¸Šå¤„ç†å™¨ç¼“å­˜çš„å†…å­˜åŒºåŸŸæ•°æ®ï¼Œå½“å…¶ä»–å¤„ç†å™¨å›žå†™å·²è¢«é”å®šçš„ç¼“å­˜è¡Œçš„æ•°æ®æ—¶ï¼Œä¼šä½¿ç¼“å­˜è¡Œæ— æ•ˆï¼Œåœ¨å¦‚å›¾2-3æ‰€ç¤ºçš„ä¾‹å­ä¸­ï¼Œå½“CPU1ä¿®æ”¹ç¼“å­˜è¡Œä¸­çš„iæ—¶ä½¿ç”¨äº†ç¼“å­˜é”å®šï¼Œé‚£ä¹ˆCPU2å°±ä¸èƒ½åŒæ—¶ç¼“å­˜içš„ç¼“å­˜è¡Œã€‚ ä½†æ˜¯æœ‰ä¸¤ç§æƒ…å†µä¸‹å¤„ç†å™¨ä¸ä¼šä½¿ç”¨ç¼“å­˜é”å®šï¼š ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼šå½“æ“ä½œçš„æ•°æ®ä¸èƒ½è¢«ç¼“å­˜åœ¨å¤„ç†å™¨å†…éƒ¨ï¼Œæˆ–æ“ä½œçš„æ•°æ®è·¨å¤šä¸ªç¼“å­˜è¡Œï¼ˆcache lineï¼‰æ—¶ï¼Œåˆ™å¤„ç†å™¨ä¼šè°ƒç”¨æ€»çº¿é”å®šã€‚ ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼šæœ‰äº›å¤„ç†å™¨ä¸æ”¯æŒç¼“å­˜é”å®šã€‚å¯¹äºŽIntel 486å’ŒPentiumå¤„ç†å™¨ï¼Œå°±ç®—é”å®šçš„å†…å­˜åŒºåŸŸåœ¨å¤„ç†å™¨çš„ç¼“å­˜è¡Œä¸­ä¹Ÿä¼šè°ƒç”¨æ€»çº¿é”å®šã€‚é’ˆå¯¹ä»¥ä¸Šä¸¤ä¸ªæœºåˆ¶ï¼Œæˆ‘ä»¬é€šè¿‡Intelå¤„ç†å™¨æä¾›äº†å¾ˆå¤šLockå‰ç¼€çš„æŒ‡ä»¤æ¥å®žçŽ°ã€‚ä¾‹å¦‚ï¼Œä½æµ‹è¯•å’Œä¿®æ”¹æŒ‡ä»¤ï¼šBTSã€BTRã€BTCï¼›äº¤æ¢æŒ‡ä»¤XADDã€CMPXCHGï¼Œä»¥åŠå…¶ä»–ä¸€äº›æ“ä½œæ•°å’Œé€»è¾‘æŒ‡ä»¤ï¼ˆå¦‚ADDã€ORï¼‰ç­‰ï¼Œè¢«è¿™äº›æŒ‡ä»¤æ“ä½œçš„å†…å­˜åŒºåŸŸå°±ä¼šåŠ é”ï¼Œå¯¼è‡´å…¶ä»–å¤„ç†å™¨ä¸èƒ½åŒæ—¶è®¿é—®å®ƒã€‚ Intelæ–‡æ¡£çš„2961é¡µ 8.1.4 Effects of a LOCK Operation on Internal Processor Caches Javaå¦‚ä½•å®žçŽ°åŽŸå­æ“ä½œåœ¨Javaä¸­å¯ä»¥é€šè¿‡é”å’Œå¾ªçŽ¯CASçš„æ–¹å¼æ¥å®žçŽ°åŽŸå­æ“ä½œã€‚ ä½¿ç”¨å¾ªçŽ¯CASå®žçŽ°åŽŸå­æ“ä½œJVMä¸­çš„CASæ“ä½œæ­£æ˜¯åˆ©ç”¨äº†å¤„ç†å™¨æä¾›çš„CMPXCHG(Compare and Exchange)æŒ‡ä»¤å®žçŽ°çš„ã€‚è‡ªæ—‹CASå®žçŽ°çš„åŸºæœ¬æ€è·¯å°±æ˜¯å¾ªçŽ¯è¿›è¡ŒCASæ“ä½œç›´åˆ°æˆåŠŸä¸ºæ­¢ï¼Œä»¥ä¸‹ä»£ç å®žçŽ°äº†ä¸€ä¸ªåŸºäºŽCASçº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨æ–¹æ³•safeCountå’Œä¸€ä¸ªéžçº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨countã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354private AtomicInteger atomicI = new AtomicInteger(0);private int i = 0;public static void main(String[] args) &#123; final Counter cas = new Counter(); List&lt;Thread&gt; ts = new ArrayList&lt;Thread&gt;(600); long start = System.currentTimeMillis(); for (int j = 0; j &lt; 100; j++) &#123; Thread t = new Thread(new Runnable() &#123; @Override public void run() &#123; for (int i = 0; i &lt; 10000; i++) &#123; cas.count(); cas.safeCount(); &#125; &#125; &#125;); ts.add(t); &#125; for (Thread t : ts) &#123; t.start(); &#125; // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæˆ for (Thread t : ts) &#123; try &#123; t.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; System.out.println(cas.i); System.out.println(cas.atomicI.get()); System.out.println(System.currentTimeMillis() - start);&#125;/** * ä½¿ç”¨CASå®žçŽ°çº¿ç¨‹å®‰å…¨è®¡æ•°å™¨ */private void safeCount() &#123; for (; ; ) &#123; int i = atomicI.get(); boolean suc = atomicI.compareAndSet(i, ++i); if (suc) &#123; break; &#125; &#125;&#125;/** * éžçº¿ç¨‹å®‰å…¨è®¡æ•°å™¨ */private void count() &#123; i++;&#125; ä»ŽJava 1.5å¼€å§‹ï¼ŒJDKçš„å¹¶å‘åŒ…é‡Œæä¾›äº†ä¸€äº›ç±»æ¥æ”¯æŒåŽŸå­æ“ä½œï¼Œå¦‚AtomicBooleanï¼ˆç”¨åŽŸå­æ–¹å¼æ›´æ–°çš„booleanå€¼ï¼‰ã€AtomicIntegerï¼ˆç”¨åŽŸå­æ–¹å¼æ›´æ–°çš„intå€¼ï¼‰å’ŒAtomicLongï¼ˆç”¨åŽŸå­æ–¹å¼æ›´æ–°çš„longå€¼ï¼‰ã€‚è¿™äº›åŽŸå­åŒ…è£…ç±»è¿˜æä¾›äº†æœ‰ç”¨çš„å·¥å…·æ–¹æ³•ï¼Œæ¯”å¦‚ä»¥åŽŸå­çš„æ–¹å¼å°†å½“å‰å€¼è‡ªå¢ž1å’Œè‡ªå‡1ã€‚ CASå®žçŽ°åŽŸå­æ“ä½œçš„ä¸‰å¤§é—®é¢˜åœ¨Javaå¹¶å‘åŒ…ä¸­æœ‰ä¸€äº›å¹¶å‘æ¡†æž¶ä¹Ÿä½¿ç”¨äº†è‡ªæ—‹CASçš„æ–¹å¼æ¥å®žçŽ°åŽŸå­æ“ä½œï¼Œæ¯”å¦‚LinkedTransferQueueç±»çš„Xferæ–¹æ³•ã€‚CASè™½ç„¶å¾ˆé«˜æ•ˆåœ°è§£å†³äº†åŽŸå­æ“ä½œï¼Œä½†æ˜¯CASä»ç„¶å­˜åœ¨ä¸‰å¤§é—®é¢˜ã€‚ABAé—®é¢˜ï¼Œå¾ªçŽ¯æ—¶é—´é•¿å¼€é”€å¤§ï¼Œä»¥åŠåªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŽŸå­æ“ä½œã€‚ ABAé—®é¢˜ã€‚å› ä¸ºCASéœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™ï¼Œæ£€æŸ¥å€¼æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æžœæ²¡æœ‰å‘ç”Ÿå˜åŒ–åˆ™æ›´æ–°ï¼Œä½†æ˜¯å¦‚æžœä¸€ä¸ªå€¼åŽŸæ¥æ˜¯Aï¼Œå˜æˆäº†Bï¼Œåˆå˜æˆäº†Aï¼Œé‚£ä¹ˆä½¿ç”¨CASè¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘çŽ°å®ƒçš„å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®žé™…ä¸Šå´å˜åŒ–äº†ã€‚ABAé—®é¢˜çš„è§£å†³æ€è·¯å°±æ˜¯ä½¿ç”¨ç‰ˆæœ¬å·ã€‚åœ¨å˜é‡å‰é¢è¿½åŠ ä¸Šç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™æŠŠç‰ˆæœ¬å·åŠ 1ï¼Œé‚£ä¹ˆAâ†’Bâ†’Aå°±ä¼šå˜æˆ1Aâ†’2Bâ†’3Aã€‚ä»ŽJava 1.5å¼€å§‹ï¼ŒJDKçš„AtomicåŒ…é‡Œæä¾›äº†ä¸€ä¸ªç±»AtomicStampedReferenceæ¥è§£å†³ABAé—®é¢˜ã€‚è¿™ä¸ªç±»çš„compareAndSetæ–¹æ³•çš„ä½œç”¨æ˜¯é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨æ˜¯å¦ç­‰äºŽé¢„æœŸå¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥å½“å‰æ ‡å¿—æ˜¯å¦ç­‰äºŽé¢„æœŸæ ‡å¿—ï¼Œå¦‚æžœå…¨éƒ¨ç›¸ç­‰ï¼Œåˆ™ä»¥åŽŸå­æ–¹å¼å°†è¯¥å¼•ç”¨å’Œè¯¥æ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚ 123456public boolean compareAndSet( V expectedReference, // é¢„æœŸå¼•ç”¨ V newReference, // æ›´æ–°åŽçš„å¼•ç”¨ int expectedStamp, // é¢„æœŸæ ‡å¿— int newStamp // æ›´æ–°åŽçš„æ ‡å¿—) å¾ªçŽ¯æ—¶é—´é•¿å¼€é”€å¤§ã€‚è‡ªæ—‹CASå¦‚æžœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥éžå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚å¦‚æžœJVMèƒ½æ”¯æŒå¤„ç†å™¨æä¾›çš„pauseæŒ‡ä»¤ï¼Œé‚£ä¹ˆæ•ˆçŽ‡ä¼šæœ‰ä¸€å®šçš„æå‡ã€‚pauseæŒ‡ä»¤æœ‰ä¸¤ä¸ªä½œç”¨ï¼šç¬¬ä¸€ï¼Œå®ƒå¯ä»¥å»¶è¿Ÿæµæ°´çº¿æ‰§è¡ŒæŒ‡ä»¤ï¼ˆde-pipelineï¼‰ï¼Œä½¿CPUä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„æ‰§è¡Œèµ„æºï¼Œå»¶è¿Ÿçš„æ—¶é—´å–å†³äºŽå…·ä½“å®žçŽ°çš„ç‰ˆæœ¬ï¼Œåœ¨ä¸€äº›å¤„ç†å™¨ä¸Šå»¶è¿Ÿæ—¶é—´æ˜¯é›¶ï¼›ç¬¬äºŒï¼Œå®ƒå¯ä»¥é¿å…åœ¨é€€å‡ºå¾ªçŽ¯çš„æ—¶å€™å› å†…å­˜é¡ºåºå†²çªï¼ˆMemory Order Violationï¼‰è€Œå¼•èµ·CPUæµæ°´çº¿è¢«æ¸…ç©ºï¼ˆCPU Pipeline Flushï¼‰ï¼Œä»Žè€Œæé«˜CPUçš„æ‰§è¡Œæ•ˆçŽ‡ã€‚ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŽŸå­æ“ä½œã€‚å½“å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¾ªçŽ¯CASçš„æ–¹å¼æ¥ä¿è¯åŽŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼Œå¾ªçŽ¯CASå°±æ— æ³•ä¿è¯æ“ä½œçš„åŽŸå­æ€§ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨é”ã€‚è¿˜æœ‰ä¸€ä¸ªå–å·§çš„åŠžæ³•ï¼Œå°±æ˜¯æŠŠå¤šä¸ªå…±äº«å˜é‡åˆå¹¶æˆä¸€ä¸ªå…±äº«å˜é‡æ¥æ“ä½œã€‚æ¯”å¦‚ï¼Œæœ‰ä¸¤ä¸ªå…±äº«å˜é‡iï¼2ï¼Œj=aï¼Œåˆå¹¶ä¸€ä¸‹ij=2aï¼Œç„¶åŽç”¨CASæ¥æ“ä½œijã€‚ä»ŽJava 1.5å¼€å§‹ï¼ŒJDKæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŽŸå­æ€§ï¼Œå°±å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡ŒCASæ“ä½œã€‚ ä½¿ç”¨é”æœºåˆ¶å®žçŽ°åŽŸå­æ“ä½œé”æœºåˆ¶ä¿è¯äº†åªæœ‰èŽ·å¾—é”çš„çº¿ç¨‹æ‰èƒ½å¤Ÿæ“ä½œé”å®šçš„å†…å­˜åŒºåŸŸã€‚JVMå†…éƒ¨å®žçŽ°äº†å¾ˆå¤šç§é”æœºåˆ¶ï¼Œæœ‰åå‘é”ã€è½»é‡çº§é”å’Œäº’æ–¥é”ã€‚æœ‰æ„æ€çš„æ˜¯é™¤äº†åå‘é”ï¼ŒJVMå®žçŽ°é”çš„æ–¹å¼éƒ½ç”¨äº†å¾ªçŽ¯CASï¼Œå³å½“ä¸€ä¸ªçº¿ç¨‹æƒ³è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ä½¿ç”¨å¾ªçŽ¯CASçš„æ–¹å¼æ¥èŽ·å–é”ï¼Œå½“å®ƒé€€å‡ºåŒæ­¥å—çš„æ—¶å€™ä½¿ç”¨å¾ªçŽ¯CASé‡Šæ”¾é”ã€‚ æŽ¨èé˜…è¯»IntelÂ® 64 and IA-32 architectures software developerâ€™s manual]]></content>
      <categories>
        <category>JDK</category>
      </categories>
      <tags>
        <tag>JDK</tag>
        <tag>Concurrent</tag>
        <tag>Atomic</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é˜¿é‡Œåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ Fescar è§£æž]]></title>
    <url>%2Falibaba-seata-design.html</url>
    <content type="text"><![CDATA[é€šè¿‡Fescarï¼ˆSeataï¼‰äº†è§£åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æž¶è®¾è®¡æ€è·¯ Fescar æ˜¯ é˜¿é‡Œå·´å·´ å¼€æºçš„ åˆ†å¸ƒå¼äº‹åŠ¡ä¸­é—´ä»¶ï¼Œä»¥ é«˜æ•ˆ å¹¶ä¸”å¯¹ä¸šåŠ¡ 0 ä¾µå…¥ çš„æ–¹å¼ï¼Œè§£å†³ å¾®æœåŠ¡ åœºæ™¯ä¸‹é¢ä¸´çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚ ä»€ä¹ˆæ˜¯å¾®æœåŠ¡åŒ–å¸¦æ¥çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Ÿé¦–å…ˆï¼Œè®¾æƒ³ä¸€ä¸ªä¼ ç»Ÿçš„å•ä½“åº”ç”¨ï¼ˆMonolithic Appï¼‰ï¼Œé€šè¿‡ 3 ä¸ª Moduleï¼Œåœ¨åŒä¸€ä¸ªæ•°æ®æºä¸Šæ›´æ–°æ•°æ®æ¥å®Œæˆä¸€é¡¹ä¸šåŠ¡ã€‚ å¾ˆè‡ªç„¶çš„ï¼Œæ•´ä¸ªä¸šåŠ¡è¿‡ç¨‹çš„æ•°æ®ä¸€è‡´æ€§ç”±æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯ã€‚ éšç€ä¸šåŠ¡éœ€æ±‚å’Œæž¶æž„çš„å˜åŒ–ï¼Œå•ä½“åº”ç”¨è¢«æ‹†åˆ†ä¸ºå¾®æœåŠ¡ï¼šåŽŸæ¥çš„ 3 ä¸ª Module è¢«æ‹†åˆ†ä¸º 3 ä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼Œåˆ†åˆ«ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®æºï¼ˆPattern: Database per serviceï¼‰ã€‚ä¸šåŠ¡è¿‡ç¨‹å°†ç”± 3 ä¸ªæœåŠ¡çš„è°ƒç”¨æ¥å®Œæˆã€‚ æ­¤æ—¶ï¼Œæ¯ä¸€ä¸ªæœåŠ¡å†…éƒ¨çš„æ•°æ®ä¸€è‡´æ€§ä»ç”±æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯ã€‚è€Œæ•´ä¸ªä¸šåŠ¡å±‚é¢çš„å…¨å±€æ•°æ®ä¸€è‡´æ€§è¦å¦‚ä½•ä¿éšœå‘¢ï¼Ÿè¿™å°±æ˜¯å¾®æœåŠ¡æž¶æž„ä¸‹é¢ä¸´çš„ï¼Œå…¸åž‹çš„åˆ†å¸ƒå¼äº‹åŠ¡éœ€æ±‚ï¼šæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆä¿éšœä¸šåŠ¡å…¨å±€çš„æ•°æ®ä¸€è‡´æ€§ã€‚ Fescar çš„å‘å±•åŽ†ç¨‹é˜¿é‡Œæ˜¯å›½å†…æœ€æ—©ä¸€æ‰¹è¿›è¡Œåº”ç”¨åˆ†å¸ƒå¼ï¼ˆå¾®æœåŠ¡åŒ–ï¼‰æ”¹é€ çš„ä¼ä¸šï¼Œæ‰€ä»¥å¾ˆæ—©å°±é‡åˆ°å¾®æœåŠ¡æž¶æž„ä¸‹çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚ 2014 å¹´ï¼Œé˜¿é‡Œä¸­é—´ä»¶å›¢é˜Ÿå‘å¸ƒ TXCï¼ˆTaobao Transaction Constructorï¼‰ï¼Œä¸ºé›†å›¢å†…åº”ç”¨æä¾›åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚ 2016 å¹´ï¼ŒTXC ç»è¿‡äº§å“åŒ–æ”¹é€ ï¼Œä»¥ GTSï¼ˆGlobal Transaction Serviceï¼‰ çš„èº«ä»½ç™»é™†é˜¿é‡Œäº‘ï¼Œæˆä¸ºå½“æ—¶ä¸šç•Œå”¯ä¸€ä¸€æ¬¾äº‘ä¸Šåˆ†å¸ƒå¼äº‹åŠ¡äº§å“ï¼Œåœ¨é˜¿äº‘é‡Œçš„å…¬æœ‰äº‘ã€ä¸“æœ‰äº‘è§£å†³æ–¹æ¡ˆä¸­ï¼Œå¼€å§‹æœåŠ¡äºŽä¼—å¤šå¤–éƒ¨å®¢æˆ·ã€‚ 2019 å¹´èµ·ï¼ŒåŸºäºŽ TXC å’Œ GTS çš„æŠ€æœ¯ç§¯ç´¯ï¼Œé˜¿é‡Œä¸­é—´ä»¶å›¢é˜Ÿå‘èµ·äº†å¼€æºé¡¹ç›® Fescarï¼ˆFast &amp; EaSy Commit And Rollback, FESCARï¼‰ï¼Œå’Œç¤¾åŒºä¸€èµ·å»ºè®¾è¿™ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚ TXC/GTS/Fescar ä¸€è„‰ç›¸æ‰¿ï¼Œä¸ºè§£å†³å¾®æœåŠ¡æž¶æž„ä¸‹çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜äº¤å‡ºäº†ä¸€ä»½ä¸Žä¼—ä¸åŒçš„ç­”å·ã€‚ è®¾è®¡åˆè¡·é«˜é€Ÿå¢žé•¿çš„äº’è”ç½‘æ—¶ä»£ï¼Œå¿«é€Ÿè¯•é”™ çš„èƒ½åŠ›å¯¹ä¸šåŠ¡æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ï¼š ä¸€æ–¹é¢ï¼Œä¸åº”è¯¥å› ä¸ºæŠ€æœ¯æž¶æž„ä¸Šçš„å¾®æœåŠ¡åŒ–å’Œåˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒçš„å¼•å…¥ï¼Œç»™ä¸šåŠ¡å±‚é¢å¸¦æ¥é¢å¤–çš„ç ”å‘è´Ÿæ‹…ã€‚ å¦ä¸€æ–¹é¢ï¼Œå¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒçš„ä¸šåŠ¡åº”è¯¥åŸºæœ¬ä¿æŒåœ¨åŒä¸€é‡çº§ä¸Šçš„æ€§èƒ½è¡¨çŽ°ï¼Œä¸èƒ½å› ä¸ºäº‹åŠ¡æœºåˆ¶æ˜¾è‘—æ‹–æ…¢ä¸šåŠ¡ã€‚ åŸºäºŽè¿™ä¸¤ç‚¹ï¼Œæˆ‘ä»¬è®¾è®¡ä¹‹åˆçš„æœ€é‡è¦çš„è€ƒé‡å°±åœ¨äºŽï¼š å¯¹ä¸šåŠ¡æ— ä¾µå…¥ï¼š è¿™é‡Œçš„ ä¾µå…¥ æ˜¯æŒ‡ï¼Œå› ä¸ºåˆ†å¸ƒå¼äº‹åŠ¡è¿™ä¸ªæŠ€æœ¯é—®é¢˜çš„åˆ¶çº¦ï¼Œè¦æ±‚åº”ç”¨åœ¨ä¸šåŠ¡å±‚é¢è¿›è¡Œè®¾è®¡å’Œæ”¹é€ ã€‚è¿™ç§è®¾è®¡å’Œæ”¹é€ å¾€å¾€ä¼šç»™åº”ç”¨å¸¦æ¥å¾ˆé«˜çš„ç ”å‘å’Œç»´æŠ¤æˆæœ¬ã€‚æˆ‘ä»¬å¸Œæœ›æŠŠåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜åœ¨ ä¸­é—´ä»¶ è¿™ä¸ªå±‚æ¬¡è§£å†³æŽ‰ï¼Œä¸è¦æ±‚åº”ç”¨åœ¨ä¸šåŠ¡å±‚é¢åšé¢å¤–çš„å·¥ä½œã€‚ é«˜æ€§èƒ½ï¼š å¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¿éšœï¼Œå¿…ç„¶ä¼šæœ‰é¢å¤–çš„å¼€é”€ï¼Œå¼•èµ·æ€§èƒ½çš„ä¸‹é™ã€‚æˆ‘ä»¬å¸Œæœ›æŠŠåˆ†å¸ƒå¼äº‹åŠ¡å¼•å…¥çš„æ€§èƒ½æŸè€—é™åˆ°éžå¸¸ä½Žçš„æ°´å¹³ï¼Œè®©åº”ç”¨ä¸å› ä¸ºåˆ†å¸ƒå¼äº‹åŠ¡çš„å¼•å…¥å¯¼è‡´ä¸šåŠ¡çš„å¯ç”¨æ€§å—å½±å“ã€‚ æ—¢æœ‰çš„è§£å†³æ–¹æ¡ˆä¸ºä»€ä¹ˆä¸æ»¡è¶³ï¼Ÿæ—¢æœ‰çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæŒ‰ç…§å¯¹ä¸šåŠ¡ä¾µå…¥æ€§åˆ†ä¸ºä¸¤ç±»ï¼Œå³ï¼šå¯¹ä¸šåŠ¡æ— ä¾µå…¥çš„å’Œå¯¹ä¸šåŠ¡æœ‰ä¾µå…¥çš„ã€‚ ä¸šåŠ¡æ— ä¾µå…¥çš„æ–¹æ¡ˆæ—¢æœ‰çš„ä¸»æµåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆä¸­ï¼Œå¯¹ä¸šåŠ¡æ— ä¾µå…¥çš„åªæœ‰åŸºäºŽ XA çš„æ–¹æ¡ˆï¼Œä½†åº”ç”¨ XA æ–¹æ¡ˆå­˜åœ¨ 3 ä¸ªæ–¹é¢çš„é—®é¢˜ï¼š è¦æ±‚æ•°æ®åº“æä¾›å¯¹ XA çš„æ”¯æŒã€‚å¦‚æžœé‡åˆ°ä¸æ”¯æŒ XAï¼ˆæˆ–æ”¯æŒå¾—ä¸å¥½ï¼Œæ¯”å¦‚ MySQL 5.7 ä»¥å‰çš„ç‰ˆæœ¬ï¼‰çš„æ•°æ®åº“ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨ã€‚ å—åè®®æœ¬èº«çš„çº¦æŸï¼Œäº‹åŠ¡èµ„æºï¼ˆæ•°æ®è®°å½•ã€æ•°æ®åº“è¿žæŽ¥ï¼‰çš„é”å®šå‘¨æœŸé•¿ã€‚é•¿å‘¨æœŸçš„èµ„æºé”å®šä»Žä¸šåŠ¡å±‚é¢æ¥çœ‹ï¼Œå¾€å¾€æ˜¯ä¸å¿…è¦çš„ï¼Œè€Œå› ä¸ºäº‹åŠ¡èµ„æºçš„ç®¡ç†å™¨æ˜¯æ•°æ®åº“æœ¬èº«ï¼Œåº”ç”¨å±‚æ— æ³•æ’æ‰‹ã€‚è¿™æ ·å½¢æˆçš„å±€é¢å°±æ˜¯ï¼ŒåŸºäºŽ XA çš„åº”ç”¨å¾€å¾€æ€§èƒ½ä¼šæ¯”è¾ƒå·®ï¼Œè€Œä¸”å¾ˆéš¾ä¼˜åŒ–ã€‚ å·²ç»è½åœ°çš„åŸºäºŽ XA çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œéƒ½ä¾æ‰˜äºŽé‡é‡çº§çš„åº”ç”¨æœåŠ¡å™¨ï¼ˆTuxedo/WebLogic/WebSphere ç­‰)ï¼Œè¿™æ˜¯ä¸é€‚ç”¨äºŽå¾®æœåŠ¡æž¶æž„çš„ã€‚ ä¾µå…¥ä¸šåŠ¡çš„æ–¹æ¡ˆå®žé™…ä¸Šï¼Œæœ€åˆåˆ†å¸ƒå¼äº‹åŠ¡åªæœ‰ XA è¿™ä¸ªå”¯ä¸€æ–¹æ¡ˆã€‚XA æ˜¯å®Œå¤‡çš„ï¼Œä½†åœ¨å®žè·µè¿‡ç¨‹ä¸­ï¼Œç”±äºŽç§ç§åŽŸå› ï¼ˆåŒ…å«ä½†ä¸é™äºŽä¸Šé¢æåˆ°çš„ 3 ç‚¹ï¼‰å¾€å¾€ä¸å¾—ä¸æ”¾å¼ƒï¼Œè½¬è€Œä»Žä¸šåŠ¡å±‚é¢ç€æ‰‹æ¥è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚æ¯”å¦‚ï¼š åŸºäºŽå¯é æ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ TCC Saga éƒ½å±žäºŽè¿™ä¸€ç±»ã€‚è¿™äº›æ–¹æ¡ˆçš„å…·ä½“æœºåˆ¶åœ¨è¿™é‡Œä¸åšå±•å¼€ï¼Œç½‘ä¸Šè¿™æ–¹é¢çš„è®ºè¿°æ–‡ç« éžå¸¸å¤šã€‚æ€»ä¹‹ï¼Œè¿™äº›æ–¹æ¡ˆéƒ½è¦æ±‚åœ¨åº”ç”¨çš„ä¸šåŠ¡å±‚é¢æŠŠåˆ†å¸ƒå¼äº‹åŠ¡æŠ€æœ¯çº¦æŸè€ƒè™‘åˆ°è®¾è®¡ä¸­ï¼Œé€šå¸¸æ¯ä¸€ä¸ªæœåŠ¡éƒ½éœ€è¦è®¾è®¡å®žçŽ°æ­£å‘å’Œåå‘çš„å¹‚ç­‰æŽ¥å£ã€‚è¿™æ ·çš„è®¾è®¡çº¦æŸï¼Œå¾€å¾€ä¼šå¯¼è‡´å¾ˆé«˜çš„ç ”å‘å’Œç»´æŠ¤æˆæœ¬ã€‚ ç†æƒ³çš„æ–¹æ¡ˆåº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿä¸å¯å¦è®¤ï¼Œä¾µå…¥ä¸šåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆéƒ½ç»è¿‡å¤§é‡å®žè·µéªŒè¯ï¼Œèƒ½æœ‰æ•ˆè§£å†³é—®é¢˜ï¼Œåœ¨å„è¡Œå„ä¸šçš„ä¸šåŠ¡åº”ç”¨ç³»ç»Ÿä¸­èµ·ç€é‡è¦ä½œç”¨ã€‚ä½†å›žåˆ°åŽŸç‚¹æ¥æ€è€ƒï¼Œè¿™äº›æ–¹æ¡ˆçš„é‡‡ç”¨å®žé™…ä¸Šéƒ½æ˜¯ è¿«äºŽæ— å¥ˆã€‚è®¾æƒ³ï¼Œå¦‚æžœåŸºäºŽ XA çš„æ–¹æ¡ˆèƒ½å¤Ÿä¸é‚£ä¹ˆ é‡ï¼Œå¹¶ä¸”èƒ½ä¿è¯ä¸šåŠ¡çš„æ€§èƒ½éœ€æ±‚ï¼Œç›¸ä¿¡ä¸ä¼šæœ‰äººæ„¿æ„æŠŠåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜æ‹¿åˆ°ä¸šåŠ¡å±‚é¢æ¥è§£å†³ã€‚ ä¸€ä¸ªç†æƒ³çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆåº”è¯¥ï¼šåƒä½¿ç”¨ æœ¬åœ°äº‹åŠ¡ ä¸€æ ·ç®€å•ï¼Œä¸šåŠ¡é€»è¾‘åªå…³æ³¨ä¸šåŠ¡å±‚é¢çš„éœ€æ±‚ï¼Œä¸éœ€è¦è€ƒè™‘äº‹åŠ¡æœºåˆ¶ä¸Šçš„çº¦æŸã€‚ åŽŸç†å’Œè®¾è®¡æˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ªå¯¹ä¸šåŠ¡æ— ä¾µå…¥çš„æ–¹æ¡ˆï¼Œæ‰€ä»¥ä»Žä¸šåŠ¡æ— ä¾µå…¥çš„ XA æ–¹æ¡ˆæ¥æ€è€ƒï¼š æ˜¯å¦å¯ä»¥åœ¨ XA çš„åŸºç¡€ä¸Šæ¼”è¿›ï¼Œè§£å†³æŽ‰ XA æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜å‘¢ï¼Ÿ å¦‚ä½•å®šä¹‰ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿé¦–å…ˆï¼Œå¾ˆè‡ªç„¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ç†è§£æˆä¸€ä¸ªåŒ…å«äº†è‹¥å¹² åˆ†æ”¯äº‹åŠ¡ çš„ å…¨å±€äº‹åŠ¡ã€‚å…¨å±€äº‹åŠ¡ çš„èŒè´£æ˜¯åè°ƒå…¶ä¸‹ç®¡è¾–çš„ åˆ†æ”¯äº‹åŠ¡ è¾¾æˆä¸€è‡´ï¼Œè¦ä¹ˆä¸€èµ·æˆåŠŸæäº¤ï¼Œè¦ä¹ˆä¸€èµ·å¤±è´¥å›žæ»šã€‚æ­¤å¤–ï¼Œé€šå¸¸ åˆ†æ”¯äº‹åŠ¡ æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ»¡è¶³ ACID çš„ æœ¬åœ°äº‹åŠ¡ã€‚è¿™æ˜¯æˆ‘ä»¬å¯¹åˆ†å¸ƒå¼äº‹åŠ¡ç»“æž„çš„åŸºæœ¬è®¤è¯†ï¼Œä¸Ž XA æ˜¯ä¸€è‡´çš„ã€‚ å…¶æ¬¡ï¼Œä¸Ž XA çš„æ¨¡åž‹ç±»ä¼¼ï¼Œæˆ‘ä»¬å®šä¹‰ 3 ä¸ªç»„ä»¶æ¥åè®®åˆ†å¸ƒå¼äº‹åŠ¡çš„å¤„ç†è¿‡ç¨‹ã€‚ Transaction Coordinator (TC)ï¼š äº‹åŠ¡åè°ƒå™¨ï¼Œç»´æŠ¤å…¨å±€äº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œè´Ÿè´£åè°ƒå¹¶é©±åŠ¨å…¨å±€äº‹åŠ¡çš„æäº¤æˆ–å›žæ»šã€‚ Transaction Manager (TM)ï¼š æŽ§åˆ¶å…¨å±€äº‹åŠ¡çš„è¾¹ç•Œï¼Œè´Ÿè´£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå¹¶æœ€ç»ˆå‘èµ·å…¨å±€æäº¤æˆ–å…¨å±€å›žæ»šçš„å†³è®®ã€‚ Resource Manager (RM)ï¼š æŽ§åˆ¶åˆ†æ”¯äº‹åŠ¡ï¼Œè´Ÿè´£åˆ†æ”¯æ³¨å†Œã€çŠ¶æ€æ±‡æŠ¥ï¼Œå¹¶æŽ¥æ”¶äº‹åŠ¡åè°ƒå™¨çš„æŒ‡ä»¤ï¼Œé©±åŠ¨åˆ†æ”¯ï¼ˆæœ¬åœ°ï¼‰äº‹åŠ¡çš„æäº¤å’Œå›žæ»šã€‚ ä¸€ä¸ªå…¸åž‹çš„åˆ†å¸ƒå¼äº‹åŠ¡è¿‡ç¨‹ï¼š TM å‘ TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ XIDã€‚ XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ã€‚ RM å‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾–ã€‚ TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›žæ»šå†³è®®ã€‚ TC è°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›žæ»šè¯·æ±‚ã€‚ è‡³æ­¤ï¼ŒFescar çš„åè®®æœºåˆ¶æ€»ä½“ä¸Šçœ‹ä¸Ž XA æ˜¯ä¸€è‡´çš„ã€‚ ä¸Ž XA çš„å·®åˆ«åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿæž¶æž„å±‚æ¬¡ XA æ–¹æ¡ˆçš„ RM å®žé™…ä¸Šæ˜¯åœ¨æ•°æ®åº“å±‚ï¼ŒRM æœ¬è´¨ä¸Šå°±æ˜¯æ•°æ®åº“è‡ªèº«ï¼ˆé€šè¿‡æä¾›æ”¯æŒ XA çš„é©±åŠ¨ç¨‹åºæ¥ä¾›åº”ç”¨ä½¿ç”¨ï¼‰ã€‚ è€Œ Fescar çš„ RM æ˜¯ä»¥äºŒæ–¹åŒ…çš„å½¢å¼ä½œä¸ºä¸­é—´ä»¶å±‚éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºè¿™ä¸€ä¾§çš„ï¼Œä¸ä¾èµ–ä¸Žæ•°æ®åº“æœ¬èº«å¯¹åè®®çš„æ”¯æŒï¼Œå½“ç„¶ä¹Ÿä¸éœ€è¦æ•°æ®åº“æ”¯æŒ XA åè®®ã€‚è¿™ç‚¹å¯¹äºŽå¾®æœåŠ¡åŒ–çš„æž¶æž„æ¥è¯´æ˜¯éžå¸¸é‡è¦çš„ï¼šåº”ç”¨å±‚ä¸éœ€è¦ä¸ºæœ¬åœ°äº‹åŠ¡å’Œåˆ†å¸ƒå¼äº‹åŠ¡ä¸¤ç±»ä¸åŒåœºæ™¯æ¥é€‚é…ä¸¤å¥—ä¸åŒçš„æ•°æ®åº“é©±åŠ¨ã€‚ è¿™ä¸ªè®¾è®¡ï¼Œå‰¥ç¦»äº†åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆå¯¹æ•°æ®åº“åœ¨ åè®®æ”¯æŒ ä¸Šçš„è¦æ±‚ã€‚ ä¸¤é˜¶æ®µæäº¤å…ˆæ¥çœ‹ä¸€ä¸‹ XA çš„ 2PC è¿‡ç¨‹ã€‚ æ— è®º Phase2 çš„å†³è®®æ˜¯ commit è¿˜æ˜¯ rollbackï¼Œäº‹åŠ¡æ€§èµ„æºçš„é”éƒ½è¦ä¿æŒåˆ° Phase2 å®Œæˆæ‰é‡Šæ”¾ã€‚ è®¾æƒ³ä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„ä¸šåŠ¡ï¼Œå¤§æ¦‚çŽ‡æ˜¯ 90% ä»¥ä¸Šçš„äº‹åŠ¡æœ€ç»ˆåº”è¯¥æ˜¯æˆåŠŸæäº¤çš„ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥åœ¨ Phase1 å°±å°†æœ¬åœ°äº‹åŠ¡æäº¤å‘¢ï¼Ÿè¿™æ · 90% ä»¥ä¸Šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥çœåŽ» Phase2 æŒé”çš„æ—¶é—´ï¼Œæ•´ä½“æé«˜æ•ˆçŽ‡ã€‚ åˆ†æ”¯äº‹åŠ¡ä¸­æ•°æ®çš„ æœ¬åœ°é” ç”±æœ¬åœ°äº‹åŠ¡ç®¡ç†ï¼Œåœ¨åˆ†æ”¯äº‹åŠ¡ Phase1 ç»“æŸæ—¶é‡Šæ”¾ã€‚ åŒæ—¶ï¼Œéšç€æœ¬åœ°äº‹åŠ¡ç»“æŸï¼Œè¿žæŽ¥ ä¹Ÿå¾—ä»¥é‡Šæ”¾ã€‚ åˆ†æ”¯äº‹åŠ¡ä¸­æ•°æ®çš„ å…¨å±€é” åœ¨äº‹åŠ¡åè°ƒå™¨ä¾§ç®¡ç†ï¼Œåœ¨å†³è®® Phase2 å…¨å±€æäº¤æ—¶ï¼Œå…¨å±€é”é©¬ä¸Šå¯ä»¥é‡Šæ”¾ã€‚åªæœ‰åœ¨å†³è®®å…¨å±€å›žæ»šçš„æƒ…å†µä¸‹ï¼Œå…¨å±€é” æ‰è¢«æŒæœ‰è‡³åˆ†æ”¯çš„ Phase2 ç»“æŸã€‚ è¿™ä¸ªè®¾è®¡ï¼Œæžå¤§åœ°å‡å°‘äº†åˆ†æ”¯äº‹åŠ¡å¯¹èµ„æºï¼ˆæ•°æ®å’Œè¿žæŽ¥ï¼‰çš„é”å®šæ—¶é—´ï¼Œç»™æ•´ä½“å¹¶å‘å’Œåžåçš„æå‡æä¾›äº†åŸºç¡€ã€‚ å½“ç„¶ï¼Œä½ è‚¯å®šä¼šé—®ï¼šPhase1 å³æäº¤çš„æƒ…å†µä¸‹ï¼ŒPhase2 å¦‚ä½•å›žæ»šå‘¢ï¼Ÿ åˆ†æ”¯äº‹åŠ¡å¦‚ä½•æäº¤å’Œå›žæ»šï¼Ÿé¦–å…ˆï¼Œåº”ç”¨éœ€è¦ä½¿ç”¨ Fescar çš„ JDBC æ•°æ®æºä»£ç†ï¼Œä¹Ÿå°±æ˜¯ Fescar çš„ RMã€‚ Phase1ï¼š Fescar çš„ JDBC æ•°æ®æºä»£ç†é€šè¿‡å¯¹ä¸šåŠ¡ SQL çš„è§£æžï¼ŒæŠŠä¸šåŠ¡æ•°æ®åœ¨æ›´æ–°å‰åŽçš„æ•°æ®é•œåƒç»„ç»‡æˆå›žæ»šæ—¥å¿—ï¼Œåˆ©ç”¨ æœ¬åœ°äº‹åŠ¡ çš„ ACID ç‰¹æ€§ï¼Œå°†ä¸šåŠ¡æ•°æ®çš„æ›´æ–°å’Œå›žæ»šæ—¥å¿—çš„å†™å…¥åœ¨åŒä¸€ä¸ª æœ¬åœ°äº‹åŠ¡ ä¸­æäº¤ã€‚ è¿™æ ·ï¼Œå¯ä»¥ä¿è¯ï¼šä»»ä½•æäº¤çš„ä¸šåŠ¡æ•°æ®çš„æ›´æ–°ä¸€å®šæœ‰ç›¸åº”çš„å›žæ»šæ—¥å¿—å­˜åœ¨ã€‚ åŸºäºŽè¿™æ ·çš„æœºåˆ¶ï¼Œåˆ†æ”¯çš„æœ¬åœ°äº‹åŠ¡ä¾¿å¯ä»¥åœ¨å…¨å±€äº‹åŠ¡çš„ Phase1 æäº¤ï¼Œé©¬ä¸Šé‡Šæ”¾æœ¬åœ°äº‹åŠ¡é”å®šçš„èµ„æºã€‚ Phase2ï¼š å¦‚æžœå†³è®®æ˜¯å…¨å±€æäº¤ï¼Œæ­¤æ—¶åˆ†æ”¯äº‹åŠ¡æ­¤æ—¶å·²ç»å®Œæˆæäº¤ï¼Œä¸éœ€è¦åŒæ­¥åè°ƒå¤„ç†ï¼ˆåªéœ€è¦å¼‚æ­¥æ¸…ç†å›žæ»šæ—¥å¿—ï¼‰ï¼ŒPhase2 å¯ä»¥éžå¸¸å¿«é€Ÿåœ°å®Œæˆã€‚ å¦‚æžœå†³è®®æ˜¯å…¨å±€å›žæ»šï¼ŒRM æ”¶åˆ°åè°ƒå™¨å‘æ¥çš„å›žæ»šè¯·æ±‚ï¼Œé€šè¿‡ XID å’Œ Branch ID æ‰¾åˆ°ç›¸åº”çš„å›žæ»šæ—¥å¿—è®°å½•ï¼Œé€šè¿‡å›žæ»šè®°å½•ç”Ÿæˆåå‘çš„æ›´æ–° SQL å¹¶æ‰§è¡Œï¼Œä»¥å®Œæˆåˆ†æ”¯çš„å›žæ»šã€‚ äº‹åŠ¡ä¼ æ’­æœºåˆ¶XID æ˜¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡çš„å”¯ä¸€æ ‡è¯†ï¼Œäº‹åŠ¡ä¼ æ’­æœºåˆ¶è¦åšçš„å°±æ˜¯æŠŠ XID åœ¨æœåŠ¡è°ƒç”¨é“¾è·¯ä¸­ä¼ é€’ä¸‹åŽ»ï¼Œå¹¶ç»‘å®šåˆ°æœåŠ¡çš„äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™æ ·ï¼ŒæœåŠ¡é“¾è·¯ä¸­çš„æ•°æ®åº“æ›´æ–°æ“ä½œï¼Œå°±éƒ½ä¼šå‘è¯¥ XID ä»£è¡¨çš„å…¨å±€äº‹åŠ¡æ³¨å†Œåˆ†æ”¯ï¼Œçº³å…¥åŒä¸€ä¸ªå…¨å±€äº‹åŠ¡çš„ç®¡è¾–ã€‚ åŸºäºŽè¿™ä¸ªæœºåˆ¶ï¼ŒFescar æ˜¯å¯ä»¥æ”¯æŒä»»ä½•å¾®æœåŠ¡ RPC æ¡†æž¶çš„ã€‚åªè¦åœ¨ç‰¹å®šæ¡†æž¶ä¸­æ‰¾åˆ°å¯ä»¥é€æ˜Žä¼ æ’­ XID çš„æœºåˆ¶å³å¯ï¼Œæ¯”å¦‚ï¼ŒDubbo çš„ Filter + RpcContextã€‚ å¯¹åº”åˆ° Java EE è§„èŒƒå’Œ Spring å®šä¹‰çš„äº‹åŠ¡ä¼ æ’­å±žæ€§ï¼ŒFescar çš„æ”¯æŒå¦‚ä¸‹ï¼š PROPAGATION_REQUIREDï¼š é»˜è®¤æ”¯æŒ PROPAGATION_SUPPORTSï¼š é»˜è®¤æ”¯æŒ PROPAGATION_MANDATORYï¼šåº”ç”¨é€šè¿‡ API æ¥å®žçŽ° PROPAGATION_REQUIRES_NEWï¼šåº”ç”¨é€šè¿‡ API æ¥å®žçŽ° PROPAGATION_NOT_SUPPORTEDï¼šåº”ç”¨é€šè¿‡ API æ¥å®žçŽ° PROPAGATION_NEVERï¼šåº”ç”¨é€šè¿‡ API æ¥å®žçŽ° PROPAGATION_NESTEDï¼šä¸æ”¯æŒ éš”ç¦»æ€§å…¨å±€äº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯å»ºç«‹åœ¨åˆ†æ”¯äº‹åŠ¡çš„æœ¬åœ°éš”ç¦»çº§åˆ«åŸºç¡€ä¹‹ä¸Šçš„ã€‚ åœ¨æ•°æ®åº“æœ¬åœ°éš”ç¦»çº§åˆ« è¯»å·²æäº¤ æˆ–ä»¥ä¸Šçš„å‰æä¸‹ï¼ŒFescar è®¾è®¡äº†ç”±äº‹åŠ¡åè°ƒå™¨ç»´æŠ¤çš„ å…¨å±€å†™æŽ’ä»–é”ï¼Œæ¥ä¿è¯äº‹åŠ¡é—´çš„ å†™éš”ç¦»ï¼Œå°†å…¨å±€äº‹åŠ¡é»˜è®¤å®šä¹‰åœ¨ è¯»æœªæäº¤ çš„éš”ç¦»çº§åˆ«ä¸Šã€‚ æˆ‘ä»¬å¯¹éš”ç¦»çº§åˆ«çš„å…±è¯†æ˜¯ï¼šå¾®æœåŠ¡åœºæ™¯äº§ç”Ÿçš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œç»å¤§éƒ¨åˆ†åº”ç”¨åœ¨ è¯»å·²æäº¤ çš„éš”ç¦»çº§åˆ«ä¸‹å·¥ä½œæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚è€Œå®žé™…ä¸Šï¼Œè¿™å½“ä¸­åˆæœ‰ç»å¤§å¤šæ•°çš„åº”ç”¨åœºæ™¯ï¼Œå®žé™…ä¸Šå·¥ä½œåœ¨ è¯»æœªæäº¤ çš„éš”ç¦»çº§åˆ«ä¸‹åŒæ ·æ²¡æœ‰é—®é¢˜ã€‚ åœ¨æžç«¯åœºæ™¯ä¸‹ï¼Œåº”ç”¨å¦‚æžœéœ€è¦è¾¾åˆ°å…¨å±€çš„ è¯»å·²æäº¤ï¼ŒFescar ä¹Ÿæä¾›äº†ç›¸åº”çš„æœºåˆ¶æ¥è¾¾åˆ°ç›®çš„ã€‚é»˜è®¤ï¼ŒFescar æ˜¯å·¥ä½œåœ¨ è¯»æœªæäº¤ çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¿è¯ç»å¤§å¤šæ•°åœºæ™¯çš„é«˜æ•ˆæ€§ã€‚ äº‹åŠ¡çš„ ACID å±žæ€§åœ¨ Fescar ä¸­çš„ä½“çŽ°æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¯é¢˜ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸“é—¨çš„æ–‡ç« æ¥æ·±å…¥åˆ†æžï¼Œè¿™é‡Œä¸åšè¿›ä¸€æ­¥å±•å¼€ã€‚ é€‚ç”¨åœºæ™¯åˆ†æžå‰æ–‡æ‰€è¿°çš„ Fescar çš„æ ¸å¿ƒåŽŸç†ä¸­æœ‰ä¸€ä¸ª é‡è¦å‰æï¼šåˆ†æ”¯äº‹åŠ¡ä¸­æ¶‰åŠçš„èµ„æºï¼Œå¿…é¡» æ˜¯æ”¯æŒ ACID äº‹åŠ¡çš„ å…³ç³»åž‹æ•°æ®åº“ã€‚åˆ†æ”¯çš„æäº¤å’Œå›žæ»šæœºåˆ¶ï¼Œéƒ½ä¾èµ–äºŽæœ¬åœ°äº‹åŠ¡çš„ä¿éšœã€‚æ‰€ä»¥ï¼Œå¦‚æžœåº”ç”¨ä½¿ç”¨çš„æ•°æ®åº“æ˜¯ä¸æ”¯æŒäº‹åŠ¡çš„ï¼Œæˆ–æ ¹æœ¬ä¸æ˜¯å…³ç³»åž‹æ•°æ®åº“ï¼Œå°±ä¸é€‚ç”¨ã€‚ å¦å¤–ï¼Œç›®å‰ Fescar çš„å®žçŽ°è¿˜å­˜åœ¨ä¸€äº›å±€é™ï¼Œæ¯”å¦‚ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«æœ€é«˜æ”¯æŒåˆ° è¯»å·²æäº¤ çš„æ°´å¹³ï¼ŒSQL çš„è§£æžè¿˜ä¸èƒ½æ¶µç›–å…¨éƒ¨çš„è¯­æ³•ç­‰ã€‚ ä¸ºäº†è¦†ç›– Fescar åŽŸç”Ÿæœºåˆ¶æš‚æ—¶ä¸èƒ½æ”¯æŒåº”ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬å®šä¹‰äº†å¦å¤–ä¸€ç§å·¥ä½œæ¨¡å¼ã€‚ ä¸Šé¢ä»‹ç»çš„ Fescar åŽŸç”Ÿå·¥ä½œæ¨¡å¼ç§°ä¸º ATï¼ˆAutomatic Transactionï¼‰æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æ˜¯å¯¹ä¸šåŠ¡æ— ä¾µå…¥çš„ã€‚ä¸Žä¹‹ç›¸åº”çš„å¦å¤–ä¸€ç§å·¥ä½œæ¨¡å¼ç§°ä¸º MTï¼ˆManual Transactionï¼‰æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œåˆ†æ”¯äº‹åŠ¡éœ€è¦åº”ç”¨è‡ªå·±æ¥å®šä¹‰ä¸šåŠ¡æœ¬èº«åŠæäº¤å’Œå›žæ»šçš„é€»è¾‘ã€‚ åˆ†æ”¯çš„åŸºæœ¬è¡Œä¸ºæ¨¡å¼ä½œä¸ºå…¨å±€äº‹åŠ¡ä¸€éƒ¨åˆ†çš„åˆ†æ”¯äº‹åŠ¡ï¼Œé™¤æœ¬èº«çš„ä¸šåŠ¡é€»è¾‘å¤–ï¼Œéƒ½åŒ…å« 4 ä¸ªä¸Žåè°ƒå™¨äº¤äº’çš„è¡Œä¸ºï¼š åˆ†æ”¯æ³¨å†Œï¼š åœ¨åˆ†æ”¯äº‹åŠ¡çš„æ•°æ®æ“ä½œè¿›è¡Œä¹‹å‰ï¼Œéœ€è¦å‘åè°ƒå™¨æ³¨å†Œï¼ŒæŠŠå³å°†è¿›è¡Œçš„åˆ†æ”¯äº‹åŠ¡æ•°æ®æ“ä½œï¼Œçº³å…¥ä¸€ä¸ªå·²ç»å¼€å¯çš„å…¨å±€äº‹åŠ¡çš„ç®¡ç†ä¸­åŽ»ï¼Œåœ¨åˆ†æ”¯æ³¨å†ŒæˆåŠŸåŽï¼Œæ‰å¯ä»¥è¿›è¡Œæ•°æ®æ“ä½œã€‚ çŠ¶æ€ä¸ŠæŠ¥ï¼š åœ¨åˆ†æ”¯äº‹åŠ¡çš„æ•°æ®æ“ä½œå®ŒæˆåŽï¼Œéœ€è¦å‘äº‹åŠ¡åè°ƒå™¨ä¸ŠæŠ¥å…¶æ‰§è¡Œç»“æžœã€‚ åˆ†æ”¯æäº¤ï¼šå“åº”åè°ƒå™¨å‘å‡ºçš„åˆ†æ”¯äº‹åŠ¡æäº¤çš„è¯·æ±‚ï¼Œå®Œæˆåˆ†æ”¯æäº¤ã€‚ åˆ†æ”¯å›žæ»šï¼šå“åº”åè°ƒå™¨å‘å‡ºçš„åˆ†æ”¯äº‹åŠ¡å›žæ»šçš„è¯·æ±‚ï¼Œå®Œæˆåˆ†æ”¯å›žæ»šã€‚ AT æ¨¡å¼åˆ†æ”¯çš„è¡Œä¸ºæ¨¡å¼ä¸šåŠ¡é€»è¾‘ä¸éœ€è¦å…³æ³¨äº‹åŠ¡æœºåˆ¶ï¼Œåˆ†æ”¯ä¸Žå…¨å±€äº‹åŠ¡çš„äº¤äº’è¿‡ç¨‹è‡ªåŠ¨è¿›è¡Œã€‚ MT æ¨¡å¼åˆ†æ”¯çš„è¡Œä¸ºæ¨¡å¼ä¸šåŠ¡é€»è¾‘éœ€è¦è¢«åˆ†è§£ä¸º Prepare/Commit/Rollback 3 éƒ¨åˆ†ï¼Œå½¢æˆä¸€ä¸ª MT åˆ†æ”¯ï¼ŒåŠ å…¥å…¨å±€äº‹åŠ¡ã€‚ MT æ¨¡å¼ä¸€æ–¹é¢æ˜¯ AT æ¨¡å¼çš„è¡¥å……ã€‚å¦å¤–ï¼Œæ›´é‡è¦çš„ä»·å€¼åœ¨äºŽï¼Œé€šè¿‡ MT æ¨¡å¼å¯ä»¥æŠŠä¼—å¤šéžäº‹åŠ¡æ€§èµ„æºçº³å…¥å…¨å±€äº‹åŠ¡çš„ç®¡ç†ä¸­ã€‚ æ··åˆæ¨¡å¼å› ä¸º AT å’Œ MT æ¨¡å¼çš„åˆ†æ”¯ä»Žæ ¹æœ¬ä¸Šè¡Œä¸ºæ¨¡å¼æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥å¯ä»¥å®Œå…¨å…¼å®¹ï¼Œå³ï¼Œä¸€ä¸ªå…¨å±€äº‹åŠ¡ä¸­ï¼Œå¯ä»¥åŒæ—¶å­˜åœ¨ AT å’Œ MT çš„åˆ†æ”¯ã€‚è¿™æ ·å°±å¯ä»¥è¾¾åˆ°å…¨é¢è¦†ç›–ä¸šåŠ¡åœºæ™¯çš„ç›®çš„ï¼šAT æ¨¡å¼å¯ä»¥æ”¯æŒçš„ï¼Œä½¿ç”¨ AT æ¨¡å¼ï¼›AT æ¨¡å¼æš‚æ—¶æ”¯æŒä¸äº†çš„ï¼Œç”¨ MT æ¨¡å¼æ¥æ›¿ä»£ã€‚å¦å¤–ï¼Œè‡ªç„¶çš„ï¼ŒMT æ¨¡å¼ç®¡ç†çš„éžäº‹åŠ¡æ€§èµ„æºä¹Ÿå¯ä»¥å’Œæ”¯æŒäº‹åŠ¡çš„å…³ç³»åž‹æ•°æ®åº“èµ„æºä¸€èµ·ï¼Œçº³å…¥åŒä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„ç®¡ç†ä¸­ã€‚ åº”ç”¨åœºæ™¯çš„è¿œæ™¯å›žåˆ°æˆ‘ä»¬è®¾è®¡çš„åˆè¡·ï¼šä¸€ä¸ªç†æƒ³çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæ˜¯ä¸åº”è¯¥ä¾µå…¥ä¸šåŠ¡çš„ã€‚MT æ¨¡å¼æ˜¯åœ¨ AT æ¨¡å¼æš‚æ—¶ä¸èƒ½å®Œå…¨è¦†ç›–æ‰€æœ‰åœºæ™¯çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ¯”è¾ƒè‡ªç„¶çš„è¡¥å……æ–¹æ¡ˆã€‚æˆ‘ä»¬å¸Œæœ›é€šè¿‡ AT æ¨¡å¼çš„ä¸æ–­æ¼”è¿›å¢žå¼ºï¼Œé€æ­¥æ‰©å¤§æ‰€æ”¯æŒçš„åœºæ™¯ï¼ŒMT æ¨¡å¼é€æ­¥æ”¶æ•›ã€‚æœªæ¥ï¼Œæˆ‘ä»¬ä¼šçº³å…¥å¯¹ XA çš„åŽŸç”Ÿæ”¯æŒï¼Œç”¨ XA è¿™ç§æ— ä¾µå…¥çš„æ–¹å¼æ¥è¦†ç›– AT æ¨¡å¼æ— æ³•è§¦è¾¾çš„åœºæ™¯ã€‚ æ‰©å±•ç‚¹å¾®æœåŠ¡æ¡†æž¶çš„æ”¯æŒäº‹åŠ¡ä¸Šä¸‹æ–‡åœ¨å¾®æœåŠ¡é—´çš„ä¼ æ’­éœ€è¦æ ¹æ®å¾®æœåŠ¡æ¡†æž¶æœ¬èº«çš„æœºåˆ¶ï¼Œè®¢åˆ¶æœ€ä¼˜çš„ï¼Œå¯¹åº”ç”¨å±‚é€æ˜Žçš„è§£å†³æ–¹æ¡ˆã€‚æœ‰å…´è¶£åœ¨è¿™æ–¹é¢å…±å»ºçš„å¼€å‘è€…å¯ä»¥å‚è€ƒå†…ç½®çš„å¯¹ Dubbo çš„æ”¯æŒæ–¹æ¡ˆï¼Œæ¥å®žçŽ°å¯¹å…¶ä»–å¾®æœåŠ¡æ¡†æž¶çš„æ”¯æŒã€‚ æ‰€æ”¯æŒçš„æ•°æ®åº“ç±»åž‹å› ä¸º AT æ¶‰åŠ SQL çš„è§£æžï¼Œæ‰€ä»¥åœ¨ä¸åŒç±»åž‹çš„æ•°æ®åº“ä¸Šå·¥ä½œï¼Œä¼šæœ‰ä¸€äº›ç‰¹å®šçš„é€‚é…ã€‚æœ‰å…´è¶£åœ¨è¿™æ–¹é¢å…±å»ºçš„å¼€å‘è€…å¯ä»¥å‚è€ƒå†…ç½®çš„å¯¹ MySQL çš„æ”¯æŒæ–¹æ¡ˆï¼Œæ¥å®žçŽ°å¯¹å…¶ä»–æ•°æ®åº“çš„æ”¯æŒã€‚ é…ç½®å’ŒæœåŠ¡æ³¨å†Œå‘çŽ°æ”¯æŒæŽ¥å…¥ä¸åŒçš„é…ç½®å’ŒæœåŠ¡æ³¨å†Œå‘çŽ°è§£å†³æ–¹æ¡ˆã€‚æ¯”å¦‚ï¼šNacosã€Eurekaã€ZooKeeper ç­‰ã€‚ MT æ¨¡å¼çš„åœºæ™¯æ‹“å±•MT æ¨¡å¼çš„ä¸€ä¸ªé‡è¦ä½œç”¨å°±æ˜¯ï¼Œå¯ä»¥æŠŠéžå…³ç³»åž‹æ•°æ®åº“çš„èµ„æºï¼Œé€šè¿‡ MT æ¨¡å¼åˆ†æ”¯çš„åŒ…è£…ï¼Œçº³å…¥åˆ°å…¨å±€äº‹åŠ¡çš„ç®¡è¾–ä¸­æ¥ã€‚æ¯”å¦‚ï¼ŒRedisã€HBaseã€RocketMQ çš„äº‹åŠ¡æ¶ˆæ¯ç­‰ã€‚æœ‰å…´è¶£åœ¨è¿™æ–¹é¢å…±å»ºçš„å¼€å‘è€…å¯ä»¥åœ¨è¿™é‡Œè´¡çŒ®ä¸€ç³»åˆ—ç›¸å…³ç”Ÿæ€çš„é€‚é…æ–¹æ¡ˆã€‚ äº‹åŠ¡åè°ƒå™¨çš„åˆ†å¸ƒå¼é«˜å¯ç”¨æ–¹æ¡ˆé’ˆå¯¹ä¸åŒåœºæ™¯ï¼Œæ”¯æŒä¸åŒçš„æ–¹å¼ä½œä¸ºäº‹åŠ¡åè°ƒå™¨ Server ç«¯çš„é«˜å¯ç”¨æ–¹æ¡ˆã€‚æ¯”å¦‚ï¼Œé’ˆå¯¹äº‹åŠ¡çŠ¶æ€çš„æŒä¹…åŒ–ï¼Œå¯ä»¥æ˜¯åŸºäºŽæ–‡ä»¶çš„å®žçŽ°æ–¹æ¡ˆï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºäºŽæ•°æ®åº“çš„å®žçŽ°æ–¹æ¡ˆï¼›é›†ç¾¤é—´çš„çŠ¶æ€åŒæ­¥ï¼Œå¯ä»¥æ˜¯åŸºäºŽ RPC é€šä¿¡çš„æ–¹æ¡ˆï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºäºŽé«˜å¯ç”¨ KV å­˜å‚¨çš„æ–¹æ¡ˆã€‚ RoadmapLanscape The green part is already open sourced, the yellow part will open source by Alibaba/AntFinancial, the blue part we want co-building with out community: Developers can refer to Seata implementation of MySQL support if you want to support different databases transaction Developers can refer to Seata implementation of Dubbo support if you want to support different microservices Developers can refer to Seata implementation of TCC support if you want to support different data source(such as MQ, NoSQL) Developers can refer to Seata implementation of TCC support if you want to support different data source(such as MQ, NoSQL) Developers can easily support configuration/registry services with just a little work The blue part is warmly welcome you, join it and contribute excellent solution We will support XA which is the standard of distributed transaction in our product roadmap Roadmapv0.1.0 Microservice framework support: Dubbo Database support: MySQL Spring AOP annotation Support Transaction coordinator: Stand-alone Server v0.5.x Rename Fescar to Seata Microservice framework support: SOFA, Spring Cloud Support TCC(Try Confirm Cancel) transaction mode Dynamic configuration Services discovery v0.6.x Transaction coordinator: Cluster Server with HA v0.8.x Promethus support Management console: Monitor, Deployment, Upgrating, etc. v1.0.0 Production ready v1.5.x Database support: Oracle, PostgreSQL, OceanBase Optimization of conflict datas Independent of Spring Annotation Multiple source of data transaction support: MessageQueue(RocketMQ), HBase, Redis, etc. v2.0.0 XA transaction mode support å½“ç„¶ï¼Œé¡¹ç›®è¿­ä»£æ¼”è¿›çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬æœ€é‡è§†çš„æ˜¯ç¤¾åŒºçš„å£°éŸ³ï¼Œè·¯çº¿å›¾ä¼šå’Œç¤¾åŒºå……åˆ†äº¤æµåŠæ—¶è¿›è¡Œè°ƒæ•´ã€‚ ç›¸å…³é“¾æŽ¥ FESCAR on GitHub GTS on Aliyun]]></content>
      <categories>
        <category>Architecture</category>
      </categories>
      <tags>
        <tag>Architecture</tag>
        <tag>Fescar</tag>
        <tag>Seata</tag>
        <tag>Distributed</tag>
        <tag>Transaction</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¼‚åœ°å¤šæ´»é«˜å¯ç”¨æž¶æž„è®¾è®¡]]></title>
    <url>%2Fmulti-live-high-available-architecture-design.html</url>
    <content type="text"><![CDATA[å¦‚æžœæž„å»ºåº”ç”¨çš„å¼‚åœ°å¤šæ´»ï¼Ÿ æ¦‚è¦éšç€ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•ï¼Œå¯¹äºŽå¾ˆå¤šå…¬å¸æ¥è¯´ï¼Œæž„å»ºäºŽå•åœ°åŸŸçš„æŠ€æœ¯ä½“ç³»æž¶æž„ï¼Œä¼šé¢ä¸´è¯¸å¦‚ä¸‹é¢çš„å¤šç§é—®é¢˜ï¼šç¡€è®¾æ–½çš„æœ‰é™æ€§é™åˆ¶äº†ä¸šåŠ¡çš„å¯æ‰©å±•æ€§ï¼›æœºæˆ¿ã€åŸŽå¸‚çº§åˆ«çš„æ•…éšœç¾å®³ï¼Œå½±å“æœåŠ¡çš„å¯æŒç»­æ€§ã€‚ ä¸ºè§£å†³é‡åˆ°çš„è¿™äº›é—®é¢˜ï¼Œå…¬å¸å¯ä»¥é€‰æ‹©æž„å»ºå¼‚åœ°å¤šæ´»æž¶æž„ï¼Œåœ¨åŒåŸŽ/å¼‚åœ°æž„å»ºå¤šä¸ªå•å…ƒ(ä¸šåŠ¡ä¸­å¿ƒ)ã€‚å„ä¸ªä¸šåŠ¡å•å…ƒå¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„åœ°åŸŸï¼Œä»Žè€Œæœ‰æ•ˆè§£å†³äº†å•åœ°åŸŸéƒ¨ç½²å¸¦æ¥çš„åŸºç¡€è®¾æ–½çš„æ‰©å±•é™åˆ¶ã€æœåŠ¡å¯æŒç»­æ€§ã€‚ å¼‚åœ°å¤šæ´»æ˜¯è¿‘å‡ å¹´æ¯”è¾ƒçƒ­é—¨çš„ä¸€ä¸ªè¯é¢˜ï¼Œé‚£ä¹ˆåœ¨å®žé™…ä¸šåŠ¡ä¸­ä»€ä¹ˆæ—¶å€™éœ€è¦åŽ»åšè¿™ä»¶äº‹ï¼Ÿå¦‚ä½•åŽ»åšï¼Ÿåšçš„æ—¶å€™éœ€è¦è€ƒè™‘ä»€ä¹ˆï¼Ÿ ä½•æ—¶åŽ»åšï¼Ÿä¸ªäººæ„Ÿè§‰å–å†³äºŽä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š ä¸šåŠ¡å‘å±• åŸºç¡€è®¾æ–½çŠ¶å†µ æŠ€æœ¯ç§¯æ·€ å¦‚ä½•åšï¼Ÿç›®å‰åœ¨ç½‘ä¸Šæœç´¢åˆ°çš„å¼‚åœ°å¤šæ´»æ–¹æ¡ˆæ¥çœ‹ï¼ŒåŸºæœ¬éƒ½æ˜¯é˜¿é‡Œã€é¥¿äº†ä¹ˆã€äº¬ä¸œã€å¾®åšè¿™äº›äº’è”ç½‘å¤§åŽ‚çš„å®žè·µï¼Œè¿™äº›å¤§åŽ‚çš„æ–¹æ¡ˆæœ‰ä¸€ä¸ªå…±åŒç‚¹å°±æ˜¯ï¼šå¤§é‡çš„è‡ªç ”ç»„ä»¶ï¼Œæ¥åšç›¸å…³çš„æ•°æ®åŒæ­¥ï¼Œä¸šåŠ¡åˆ‡åˆ†ç­‰ç­‰ï¼Œé‚£ä¹ˆï¼Œå¯¹äºŽå¾ˆå¤šä¼ ç»Ÿä¼ä¸šæˆ–è€…ç›¸å¯¹å°ä¸€äº›çš„ä¼ä¸šï¼Œåº”è¯¥å¦‚ä½•æ¥åšè¿™ä»¶äº‹ï¼Ÿ æ ¹æ®ä¸šåŠ¡ç‰¹æ€§å€ŸåŠ©åˆé€‚çš„å…¬æœ‰äº‘æœåŠ¡ åšçš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ çœŸæ­£éœ€è¦åšå¼‚åœ°å¤šæ´»çš„ä¸šåŠ¡æœ‰å“ªäº›ï¼Ÿ åŸºç¡€è®¾æ–½å¦‚ä½•ï¼Ÿ å¯¹äºŽä¸å¯ç”¨æ—¶é—´çš„å®¹å¿ç¨‹åº¦æ˜¯å¤šå°‘ï¼Ÿ ä¸šåŠ¡èƒŒæ™¯ åœ¨æ‰€æœ‰çš„ç³»ç»Ÿä¸­ç”¨æˆ·ä¸­å¿ƒéƒ½æ˜¯æ ¸å¿ƒä¸šåŠ¡ï¼Œå› ä¸ºå®ƒæ˜¯è¿›å…¥å…¶å®ƒå¾ˆå¤šä¸šåŠ¡å‰æã€‚ æˆ‘ä»¬è¿™è¾¹IDCä¸æ˜¯å¾ˆç¨³å®šï¼Œä¹‹å‰å‘ç”Ÿè¿‡å‡ æ¬¡æœºæˆ¿å¤§è§„æ¨¡æ•…éšœï¼Œæ¯”å¦‚æœºæˆ¿ç½‘ç»œæŒ‚äº†ï¼Œæ•´ä¸ªæœºæˆ¿å¯¹å¤–ä¸å¯ç”¨äº†ã€‚ ä»¥ä¸Šä¸¤ç‚¹æ˜¯æˆ‘ä»¬è¿™æ¬¡è¦åšç”¨æˆ·ä¸­å¿ƒå¼‚åœ°å®¹ç¾çš„å‡ºå‘ç‚¹ï¼Œä»¥ä¾¿åœ¨é¢å¯¹æœºæˆ¿çº§åˆ«æ•…éšœæ—¶ï¼Œä¿è¯æœåŠ¡å¯ç”¨æ€§ã€‚ ä¸šåŠ¡æ¢³ç†ç”¨æˆ·ä¸­å¿ƒä»Žæ•´ä½“æ¥çœ‹ï¼Œå¯¹å¤–ä¸»è¦æä¾›ï¼šæ³¨å†Œã€ç™»é™†ã€æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ç­‰æœåŠ¡ã€‚è¿™äº›æœåŠ¡åˆæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š ç™»é™†çš„ä¼˜å…ˆçº§æœ€é«˜ äº‹åŠ¡æ€§è¦æ±‚ä½Ž æ¶‰åŠçš„å…¬å…±ç»„ä»¶ä¸»è¦æœ‰ï¼š MySQLï¼šç”¨æˆ·æ•°æ®å­˜å‚¨ Redisï¼šAuthorization Codeã€çŸ­ä¿¡éªŒè¯ç ã€è´¦å·é”å®šã€access tokenç­‰çš„å­˜å‚¨ Zookeeperï¼šDubboä¾èµ– æ–¹æ¡ˆç”¨æˆ·ä¸­å¿ƒæ˜¯é€šè¿‡å¤–åŒ…çš„å½¢å¼è¿›è¡Œå¼€å‘çš„ï¼Œç›®å‰å·²ä¸Šçº¿å¹¶äº¤ä»˜ç»™å¦ä¸€ä¸ªå¤–åŒ…å•†è¿ç»´ï¼Œæ‰€ä»¥åœ¨è€ƒè™‘å®¹ç¾ä¸€æœŸæ–¹æ¡ˆçš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘å°½é‡ä¸åŠ¨ä»£ç ã€‚ ç›®æ ‡ä¸€æœŸç›®æ ‡å½“åŒ—äº¬æœºæˆ¿å‡ºçŽ°æ•…éšœçš„æ—¶å€™ï¼Œå¯ä»¥ä¸€å®šæ—¶é—´å†…æŠŠæµé‡åˆ‡åˆ°é’å²›æœºæˆ¿è¿™è¾¹ï¼Œä¿è¯ç”¨æˆ·ä¸­å¿ƒæ ¸å¿ƒæœåŠ¡çš„åŸºæœ¬å¯ç”¨ã€‚ äºŒæœŸç›®æ ‡ç”¨æˆ·ä¸­å¿ƒé€šè¿‡å¼‚åœ°å¤šæ´»ï¼Œå®žçŽ°é«˜å¯ç”¨ï¼ˆéœ€è¦é›†å›¢æ™ºèƒ½DNSæ”¯æŒï¼‰ã€‚ æž¶æž„è®¾è®¡ä¸€æœŸæž¶æž„å½“åŒ—äº¬æœºæˆ¿å‘ç”Ÿæ•…éšœçš„æ—¶å€™ï¼Œå¯ä»¥æŠŠæµé‡å¿«é€Ÿåˆ‡æ¢åˆ°é’å²›è¿™è¾¹ï¼Œä»¥ä¿éšœç”¨æˆ·ä¸­å¿ƒæ ¸å¿ƒæœåŠ¡å¯ç”¨ã€‚ å…·ä½“æ–¹æ¡ˆå¦‚ä¸‹ï¼š é€šè¿‡otterè¿‘å®žæ—¶çš„å°†åŒ—äº¬æœºæˆ¿æ ¸å¿ƒä¸šåŠ¡æ•°æ®åŒæ­¥åˆ°é’å²›æœºæˆ¿ã€‚ é’å²›æœºæˆ¿éƒ¨ç½²Redisã€ZooKeeperç­‰ä¸­é—´ä»¶ã€‚ é’å²›æœºæˆ¿éƒ¨ç½²ç”¨æˆ·ä¸­å¿ƒçš„æ ¸å¿ƒåº”ç”¨ï¼ˆå®žä¾‹æ­£å¸¸éƒ¨ç½²ã€è¿è¡Œï¼Œåªæ˜¯å¹³æ—¶ä¸ä¼šæœ‰è®¿é—®ï¼‰ã€‚ å…·ä½“æž¶æž„å¦‚ä¸‹ï¼š å¯ä»¥è¾¾åˆ°çš„æ•ˆæžœï¼š å½“åŒ—äº¬æœºæˆ¿å‡ºçŽ°æ•…éšœçš„æ—¶å€™ï¼Œå¯ä»¥åœ¨ä¸€å®šæ—¶é—´å†…æŠŠæµé‡åˆ‡åˆ°é’å²›æœºæˆ¿è¿™è¾¹ï¼Œä¿è¯ç”¨æˆ·ä¸­å¿ƒæ ¸å¿ƒæœåŠ¡çš„åŸºæœ¬å¯ç”¨ï¼Œä½†æ­¤æ—¶å·²ç™»å½•ç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•ã€‚ ä¸€å®šæ—¶é—´ï¼šå–å†³äºŽDNSä¿®æ”¹ipæ—¶é—´+DNS TTLæ—¶é—´ï¼Œç›®å‰æ¥çœ‹TTLæ˜¯10åˆ†é’Ÿï¼Œäººå·¥ä¿®æ”¹ipåº”è¯¥å¾ˆå¿«ï¼Œæ‰€ä»¥ä¸€å®šæ—¶é—´æ˜¯10~20åˆ†é’Ÿã€‚ å­˜åœ¨çš„ç¼ºç‚¹ï¼š åŒ—äº¬æœºæˆ¿éžæ•…éšœæœŸé—´ï¼Œé’å²›æœºæˆ¿çš„æœºå™¨ï¼Œä»…åšæ•°æ®åº“åŒæ­¥ï¼Œå­˜åœ¨ä¸€å®šçš„èµ„æºæµªè´¹ã€‚ å½“åŒ—äº¬æœºæˆ¿å‡ºçŽ°æ•…éšœï¼Œæµé‡åˆ‡æ¢åˆ°é’å²›æœºæˆ¿åŽï¼Œåªèƒ½ä¿è¯ç™»é™†è¿™ä¸€æ ¸å¿ƒæœåŠ¡çš„å¯ç”¨ã€‚å¯¹äºŽæ³¨å†Œç­‰éœ€è¦ä¿®æ”¹æ•°æ®åº“çš„æœåŠ¡ï¼Œå‡ä¸æ”¯æŒï¼Œå¦‚æžœåœ¨æ­¤æœŸé—´è®¿é—®è¿™ç±»æœåŠ¡ï¼Œä¼šå‘ç”Ÿå¼‚å¸¸ã€‚ äºŒæœŸæž¶æž„äºŒæœŸçš„ç›®çš„å°±æ˜¯ä¿®æ­£ä¸€æœŸæž¶æž„çš„ç¼ºç‚¹ï¼Œé€šè¿‡å¼‚åœ°å¤šæ´»ï¼Œå®žçŽ°é«˜å¯ç”¨ã€‚ äºŒæœŸé’å²›æœºæˆ¿ä¼šæ›¿æ¢ä¸ºé˜¿é‡Œäº‘æœºæˆ¿ã€‚ å…·ä½“æ–¹æ¡ˆå¦‚ä¸‹ï¼š é€šè¿‡é˜¿é‡Œäº‘DTSæœåŠ¡å®žçŽ°ä¸¤åœ°æœºæˆ¿æ•°æ®åº“åŒæ­¥ï¼Œä¿è¯åŒ—äº¬ã€é˜¿é‡Œäº‘æ•°æ®çš„è¿‘å®žæ—¶ä¸€è‡´æ€§ã€‚ åŒ—äº¬ã€é˜¿é‡Œäº‘ä¸¤åœ°æœºæˆ¿å‡æä¾›åœ¨çº¿æœåŠ¡ï¼Œæé«˜èµ„æºåˆ©ç”¨çŽ‡ã€‚ æ¢³ç†æœåŠ¡ä¼˜å…ˆçº§ï¼Œä¿®æ”¹åº”ç”¨ä»£ç ï¼Œæ”¯æŒæœåŠ¡é™çº§ã€‚ å½“æŸä¸ªæœºæˆ¿ï¼ˆé˜¿é‡Œäº‘æˆ–è€…åŒ—äº¬ï¼‰å‡ºçŽ°æ•…éšœçš„æ—¶å€™ï¼Œé€šè¿‡DNSæœåŠ¡æŠŠæµé‡åˆ‡æ¢åˆ°å¦ä¸€ä¸ªæœºæˆ¿ã€‚ å¦‚æžœä¸¤åœ°éƒ¨ç½²çš„æ—¶å€™ï¼Œæ²¡æœ‰å†—ä½™ä¸€å®šç¡¬ä»¶èµ„æºï¼Œåˆ™éœ€è¦å®žæ–½æœåŠ¡é™çº§ã€‚ ç›®å‰é›†å›¢DNSè§£æžï¼Œæ— æ³•æä¾›è‡ªåŠ¨æ£€æµ‹æœåŠ¡æ˜¯å¦å¯ç”¨çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ— æ³•è‡ªåŠ¨è¿›è¡Œåˆ‡æ¢ã€‚ æœåŠ¡å¯ç”¨æ€§ï¼Œå¯ä»¥é€šè¿‡æˆ‘ä»¬è¿™è¾¹çš„å¤šç‚¹æ‹¨æµ‹è¿›è¡Œç›‘æŽ§ï¼Œå½“å¤šç‚¹æ‹¨æµ‹ä¸å¯ç”¨çš„æ—¶å€™ï¼Œå‘é€å‘Šè­¦é€šçŸ¥ç»™ç›¸å…³äººå‘˜ï¼Œä»¥ä¾¿äººå·¥ä»‹å…¥ã€‚ å¤šç‚¹æ‹¨æµ‹å‘Šè­¦ï¼Œåº”è¯¥ä¼šæä¾›ä¸¤ç±»ï¼š1ã€æŸä¸ªæ‹¨æµ‹ç‚¹ä¸é€šçš„æ—¶å€™ 2ã€æ‰€æœ‰æ‹¨æµ‹ç‚¹å‡ä¸å¯ç”¨çš„æ—¶å€™ã€‚ ç›®å‰é›†å›¢DNSè§£æžï¼ŒTTLç”Ÿæ•ˆæœ€çŸ­æ—¶é—´æ˜¯10åˆ†é’Ÿï¼Œæ— æ³•è‡ªå®šä¹‰TTLæ—¶é—´ã€‚ å…·ä½“æž¶æž„å¦‚ä¸‹ï¼š å¯ä»¥è¾¾åˆ°çš„æ•ˆæžœï¼š å¦‚æžœé›†å›¢DNSå¯ä»¥æä¾›ï¼Œç±»ä¼¼é˜¿é‡Œäº‘äº‘è§£æžçš„ç½‘ç«™ç›‘æŽ§åŠŸèƒ½å¹¶èƒ½çµæ´»è®¾ç½®TTLæ—¶é—´ï¼Œè¿™æ—¶å½“åŒ—äº¬æœºæˆ¿æˆ–è€…é˜¿é‡Œäº‘æœºæˆ¿å‡ºçŽ°æ•…éšœåŽï¼Œå°±å¯ä»¥åœ¨å¾ˆçŸ­çš„æ—¶é—´ï¼ˆéƒ¨åˆ†æœåŠ¡æœ€å¤§å¼‚å¸¸æ—¶é—´ï¼‰å†…è‡ªåŠ¨è¿›è¡Œæµé‡åˆ‡æ¢ã€‚ æ­¤å¤„åªæ˜¯ä»¥é˜¿é‡Œäº‘äº‘è§£æžç¤ºä¾‹ï¼Œåªè¦èƒ½æä¾›ç±»ä¼¼çš„æœåŠ¡å‡å¯ã€‚ å¦‚æžœé›†å›¢DNSæ— æ³•æä¾›ç±»ä¼¼é˜¿é‡Œäº‘äº‘è§£æžçš„ç½‘ç«™ç›‘æŽ§åŠçµæ´»è®¾ç½®TTLæ—¶é—´çš„åŠŸèƒ½ï¼Œåˆ™éƒ¨åˆ†æœåŠ¡æœ€å¤§å¼‚å¸¸æ—¶é—´è¿˜æ˜¯å–å†³äºŽDNSä¿®æ”¹ipæ—¶é—´+DNS TTLæ—¶é—´ã€‚ åè¯è§£é‡Šä»€ä¹ˆæ˜¯ç½‘ç«™ç›‘æŽ§ï¼ŸHTTP/HTTPSå®žæ—¶æŽ¢æµ‹åŸŸåè§£æžè®°å½•ï¼Œæ”¯æŒè‡ªå®šä¹‰ç«¯å£ï¼Œå®žæ—¶å‘çŽ°å®•æœºç«‹å³å‘Šè­¦ï¼›å…¨ç½‘åˆ†å¸ƒå¼ç›‘æŽ§ï¼Œåœ¨ä¸­å›½å„ä¸ªåœ°åŒºæ¨¡æ‹Ÿç”¨æˆ·ç«¯çœŸå®žè¯·æ±‚ï¼Œç›‘æŽ§ç»“æžœçœŸå®žå¯é ï¼›æ”¯æŒå®•æœºæš‚åœã€å®¹ç¾åˆ‡æ¢ï¼Œæœ€å¤§é™åº¦çš„è§£å†³æœåŠ¡ä¸­æ–­å¯¹æ‚¨çš„ä¸šåŠ¡å¸¦æ¥çš„æŸå¤±ï¼›å®¹ç¾åˆ‡æ¢æ”¯æŒAè®°å½•ã€CNAMEåŸŸåï¼Œæ»¡è¶³å„ç§åœºæ™¯çš„å®¹ç¾åˆ‡æ¢éœ€æ±‚ï¼› ä»€ä¹ˆæƒ…å†µä¼šè¢«ç½‘ç«™ç›‘æŽ§åˆ¤æ–­ä¸ºå®•æœºå¹¶å‘é€å‘Šè­¦é€šçŸ¥ï¼Ÿç›‘æŽ§ç»“æžœä¸­ï¼ŒHTTP/HTTPSçš„è¿”å›žç å¤§äºŽ500çš„æœåŠ¡å™¨é”™è¯¯æƒ…å†µï¼Œæ‰ä¼šæŠ¥è­¦é€šçŸ¥ã€‚ä¸¾ä¾‹è¯´æ˜Žï¼šå¦‚æžœè®¾ç½®äº†å››ä¸ªæŽ¢æµ‹ç‚¹ åŒ—äº¬è”é€šã€æ·±åœ³é˜¿é‡Œå·´å·´ã€ä¸Šæµ·ç”µä¿¡ã€é‡åº†è”é€šã€‚åœºæ™¯ä¸€ï¼šå››ä¸ªæŽ¢æµ‹ç‚¹ä¸­50%çš„ç›‘æŽ§ç‚¹æ— æ³•æ”¶åˆ°æ‚¨æœåŠ¡å™¨çš„å“åº”ï¼Œæˆ–50%çš„ç›‘æŽ§ç‚¹æ”¶åˆ°è¿”å›žç å¤§äºŽç­‰äºŽ500æ—¶ï¼Œæ‰ä¼šåˆ¤æ–­æ‚¨çš„ç½‘ç«™ä¸ºå®•æœºæƒ…å†µã€‚åœºæ™¯äºŒï¼šå››ä¸ªæŽ¢æµ‹ç‚¹ä¸­æœ‰50%ä»¥ä¸Šçš„æŽ¢æµ‹ç‚¹æŽ¢æµ‹æ‚¨çš„ç½‘ç«™è¿”å›žç æ˜¯å°äºŽ500çš„æƒ…å†µï¼Œåˆ™ä¸ä¼šåˆ¤æ–­æ‚¨çš„ç½‘ç«™ä¸ºå®•æœºã€‚ äº‘è§£æžDNSâ€œæµé‡ç®¡ç†â€äº‘è§£æžâ€œæµé‡ç®¡ç†â€å¯ä»¥åœ¨æ‚¨è®¾ç½®çš„æ¯æ¡è§£æžçº¿è·¯ä¸‹ï¼Œæ ¹æ®æƒé‡æ¯”ä¾‹è½®è¯¢è¿”å›žè§£æžç»“æžœã€‚å½“çº¿è·¯ä¸‹çš„IPå®•æœºæ—¶å¯ä»¥é€šè¿‡ç›‘æŽ§è‡ªåŠ¨å‘çŽ°ï¼Œå¹¶å°†å®•æœºIPä»Žå½“å‰çº¿è·¯ä¸‹æ‘˜é™¤ï¼Œç›´åˆ°ç›‘æŽ§IPæ­£å¸¸æ—¶ä¼šæ¢å¤è§£æžã€‚åŒæ—¶ï¼Œå½“ä¸€æ¡è§£æžçº¿è·¯ä¸‹çš„æ‰€æœ‰IPéƒ½å®•æœºæ—¶ï¼Œå¯ä»¥åˆ‡æ¢è‡³å…¶ä»–æ­£å¸¸çº¿è·¯ã€‚æœ€å¤§ç¨‹åº¦ä¿è¯æ‚¨çš„ç½‘ç«™æœåŠ¡é«˜å¯ç”¨ï¼Œå‡å°æŸå¤±ã€‚ éƒ¨åˆ†æœåŠ¡æœ€å¤§å¼‚å¸¸æ—¶é—´æ¯”å¦‚åŒ—äº¬æœºæˆ¿å‡ºçŽ°å¼‚å¸¸ï¼Œè¿™æ—¶è½¬å‘åˆ°é˜¿é‡Œäº‘æœºæˆ¿çš„æµé‡æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œåªæœ‰è½¬å‘åˆ°åŒ—äº¬æœºæˆ¿çš„æµé‡æ˜¯å¼‚å¸¸çš„ã€‚ è¿™æ—¶å¦‚æžœä½¿ç”¨ç½‘ç«™ç›‘æŽ§æˆ–è€…ç±»ä¼¼æœåŠ¡ï¼Œè¿›è¡Œç›‘æŽ§ï¼Œå¹¶è®¾ç½®æ‹¨æµ‹é—´éš”ä¸º1åˆ†é’Ÿï¼ŒTTLç”Ÿæ•ˆæ—¶é—´ä¸º1ç§’ï¼Œé‚£ä¹ˆæœ€å¤šæœ‰60+1ç§’éƒ¨åˆ†æœåŠ¡å¼‚å¸¸æ—¶é—´ï¼Œä¹‹åŽDNSä¼šè‡ªåŠ¨æŠŠåŒ—äº¬æœºæˆ¿çš„ipè‡ªåŠ¨è¸¢æŽ‰ï¼Œæµé‡å…¨éƒ¨åˆ‡åˆ°é˜¿é‡Œäº‘ã€‚ è¡¥å…… ä¸€æœŸã€äºŒæœŸæ–¹æ¡ˆçš„å®žçŽ°å‡å¼ºä¾èµ–äºŽé›†å›¢çš„DNSæœåŠ¡ ç”¨æˆ·ä¸­å¿ƒé€šè¿‡ipæš´éœ²çš„æœåŠ¡ï¼Œä¸€ä½†å‡ºçŽ°æœºæˆ¿çº§åˆ«çš„æ•…éšœï¼Œä¸€æœŸã€äºŒæœŸæ–¹æ¡ˆå‡æ— æ³•ä¿è¯è¯¥éƒ¨åˆ†æœåŠ¡å¯ç”¨ã€‚ å…¶å®žé™¤äº†DNSè¿™ç§æ–¹æ¡ˆï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ¡ˆå°±æ˜¯ç”¨ç±»ä¼¼F5è¿™ç§è®¾å¤‡ï¼Œä½œè·¨æœºæˆ¿è´Ÿè½½ï¼Œä½†å¿…é¡»æ˜¯gslbï¼Œè€Œä¸”ä¸¤ç«¯å¿…é¡»æ˜¯ç›¸åŒçš„è®¾å¤‡ã€‚ å°ç»“å¯¹äºŽï¼Œéžä¸€çº¿äº’è”ç½‘å¤§åŽ‚çš„å…¬å¸è€Œè¨€ï¼Œæ˜¯å®žçŽ°å¼‚åœ°å®¹ç¾çš„æ—¶å€™ï¼Œå€ŸåŠ©å…¬æœ‰äº‘æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œæ¯”å¦‚ï¼š æ•°æ®è·¨æœºæˆ¿åŒæ­¥ï¼Œå¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘çš„DTS(Data Transmission Service) æœåŠ¡ï¼Œç›®å‰DTSæ”¯æŒå…³ç³»åž‹æ•°æ®åº“ã€NoSQLã€å¤§æ•°æ®(OLAP)ç­‰æ•°æ®æºé—´çš„æ•°æ®ä¼ è¾“ã€‚ å®ƒæ˜¯ä¸€ç§é›†æ•°æ®è¿ç§»ã€æ•°æ®è®¢é˜…åŠæ•°æ®å®žæ—¶åŒæ­¥äºŽä¸€ä½“çš„æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ è·¨æœºæˆ¿åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå¯ä»¥ä½¿ç”¨OceanBaseã€‚é‡‘èžçŽ¯å¢ƒä¸‹é€šå¸¸å¯¹æ•°æ®å¯é æ€§æœ‰æ›´é«˜çš„è¦æ±‚ï¼ŒOceanBaseæ¯ä¸€æ¬¡äº‹åŠ¡æäº¤ï¼Œå¯¹åº”æ—¥å¿—æ€»æ˜¯ä¼šåœ¨å¤šä¸ªæ•°æ®ä¸­å¿ƒå®žæ—¶åŒæ­¥ï¼Œå¹¶æŒä¹…åŒ–ã€‚å³ä½¿æ˜¯æ•°æ®ä¸­å¿ƒçº§åˆ«çš„ç¾éš¾å‘ç”Ÿï¼Œæ€»æ˜¯å¯ä»¥åœ¨å…¶ä»–çš„æ•°æ®ä¸­å¿ƒæ¢å¤æ¯ä¸€ç¬”å·²ç»å®Œæˆçš„äº¤æ˜“ï¼Œå®žçŽ°äº†çœŸæ­£é‡‘èžçº§åˆ«çš„å¯é æ€§è¦æ±‚ã€‚ å¼‚åœ°å¤šæ´»ç”±äºŽå„ä¸ªå…¬å¸çš„ä¸šåŠ¡ã€åŸºç¡€è®¾æ–½åŠè¦è§£å†³çš„é—®é¢˜çš†ä¸å°½ç›¸åŒï¼Œæ‰€ä»¥é€‰æ‹©é€‚åˆè‡ªå·±çš„å°±å¥½ã€‚ æˆ–è€…ç›´æŽ¥ä½¿ç”¨äº‘æ•°æ®åº“RDS MySQL ç‰ˆ]]></content>
      <categories>
        <category>Architecture</category>
      </categories>
      <tags>
        <tag>Architecture</tag>
        <tag>Multi-Live</tag>
        <tag>High-Available</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PaaSå¹³å°æž¶æž„è®¾è®¡]]></title>
    <url>%2Fpass-platform-architecture-design.html</url>
    <content type="text"><![CDATA[æž„å»ºä¸€ä¸ªPaaSå¹³å° èƒŒæ™¯ç›®å‰åœ¨ç”¨çš„PaaSå¹³å°æ˜¯ä¹‹å‰è´­ä¹°çš„ä¸€ä¸ªå•†ä¸šäº§å“ï¼Œä½†æ²¡æœ‰æºç ï¼Œè¿ç»´æœŸä¹Ÿæ—©å°±ç»“æŸäº†ï¼Œæ‰€ä»¥åœ¨åŽæœŸä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šé‡åˆ°ä¸€äº›å„ç§å„æ ·çš„é—®é¢˜ï¼Œå¯¹äºŽä½¿ç”¨ã€è¿ç»´éƒ½é€ æˆä¸€å®šçš„å›°æ‰°ã€‚ è€PaaSçš„æž¶æž„åŠåŸºæœ¬åŠŸèƒ½å¦‚ä¸‹ï¼š é‡æž„ä¸ºä»€ä¹ˆé€‰æ‹©é‡æž„PaaSå¹³å°è€Œä¸æ˜¯å…¨éƒ¨è¿ç§»kubernatesé›†ç¾¤ï¼Ÿkubernatesé›†ç¾¤çš„ç¡®æä¾›äº†å¾ˆå¤šä¼˜ç§€çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼šRCã€æ»šåŠ¨æ›´æ–°æˆ–å›žæ»šã€èµ„æºç›‘æŽ§å’Œæ—¥å¿—è®°å½•ã€è´Ÿè½½å‡è¡¡ç­‰ç­‰ã€‚ ä½†åœ¨ç›®å‰æˆ‘ä»¬è¿™è¾¹çš„çŽ¯å¢ƒæ¥çœ‹ï¼Œè¿ç§»kubernatesé›†ç¾¤æœ‰å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š æ— æ³•æ— æ„ŸçŸ¥è¿ç§»ï¼Œå³è¿ç§»åˆ°kubernatesé›†ç¾¤çš„è¿‡ç¨‹ä¸­åŠè¿ç§»åˆ°kubernatesé›†ç¾¤åŽï¼Œä¸å¢žåŠ ç”¨æˆ·çš„ä½¿ç”¨ã€å­¦ä¹ æˆæœ¬ï¼Œä½†åº”ç”¨å¼•å…¥kubernatesé›†ç¾¤ä¹‹åŽï¼Œå¾ˆéš¾ä¿è¯è¿™ä¸€ç‚¹ã€‚å› ä¸ºæˆ‘ä»¬è¿™è¾¹çš„ç”¨æˆ·å¤§å¤šæ˜¯æˆ‘ä»¬å…¬å¸çš„ä¾›åº”å•†ï¼Œä¾›åº”å•†å…¶å®žä¸å¤ªå…³å¿ƒï¼Œä½ å¹³å°æ‰€æä¾›çš„å„ç§æ–°ç‰¹æ€§ã€åŠŸèƒ½ï¼Œæ›´ä¸æƒ³å› ä¸ºè¿™äº›æ–°ç‰¹æ€§ã€åŠŸèƒ½å¢žåŠ ä»–ä»¬çš„ä½¿ç”¨ã€å­¦ä¹ æˆæœ¬ã€‚ æˆ‘ä»¬è¿™è¾¹å¾ˆå¤šé¡¹ç›®æœ¬èº«æ˜¯æœ‰ç¡¬è´Ÿè½½çš„ï¼Œæ¯”å¦‚F5ï¼Œæ‰€ä»¥kubernatesæä¾›çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¾çš„ä¸é‚£ä¹ˆé‡è¦ã€‚ æ—¥å¿—éƒ¨åˆ†ï¼Œæˆ‘ä»¬å·²ç»æ‰“é€šå„ä¸ªå¹³å°çš„æ—¥å¿—ã€ç›‘æŽ§ï¼Œä¸å†éœ€å…¶ä»–çš„ç»„ä»¶ã€‚ æ»šåŠ¨æ›´æ–°æˆ–å›žæ»šï¼Œè€PaaSå¹³å°æœ¨æœ‰ï¼Œé‡æž„åŽæ–°ç‰ˆä¸­å‡†å¤‡åŠ å…¥ï¼ˆäºŒæœŸï¼‰ã€‚ RCç±»ä¼¼åŠŸèƒ½ï¼Œç›®å‰ä¸æ‰“ç®—æ”¯æŒã€‚ æž¶æž„åŠç”¨åˆ°ç»„ä»¶æ¢³ç† æ–°PaaSåŠŸèƒ½ç‚¹æ¢³ç† è¿ç§»é€šè¿‡æ— ç¼è¿ç§»ï¼Œåœ¨ç”¨æˆ·æ— æ„ŸçŸ¥çš„æƒ…å†µä¸‹å®žçŽ°è¿ç§»ã€‚ ä¸ºä»€ä¹ˆè¦åšåˆ°æ— æ„ŸçŸ¥è¿ç§»ï¼Ÿè€PaaSä¸­ç›®å‰çš„é¡¹ç›®æ•°é‡æ˜¯ï¼š193ä¸ªï¼Œåº”ç”¨æ•°é‡æ˜¯ï¼š673ä¸ªæ€»å®žä¾‹æ•°ï¼š1485ï¼Œå…¶ä¸­ç”Ÿäº§çŽ¯å¢ƒçš„å®žä¾‹æ•°ï¼š894å¦‚æžœè¿™äº›é¡¹ç›®ã€åº”ç”¨ï¼Œå› ä¸ºä½ çš„é‡æž„éƒ½éœ€è¦æ”¹åŠ¨çš„è¯ï¼Œé‚£ä¹ˆæŽ¨å¹¿éš¾åº¦æ˜¯å¾ˆå¤§çš„ï¼Œæ‰€ä»¥éœ€è¦å°½é‡åšåˆ°ï¼Œå¯¹äºŽç”¨æˆ·æ¥è¯´æ— æ„ŸçŸ¥è¿ç§»ã€‚ ä»¥ä¸‹è¿ç§»éƒ¨åˆ†ï¼Œéƒ½éœ€è¦åœ¨æ–°PaaSä¸Šçº¿å‰å®Œæˆå¹¶åœ¨ä¸Šçº¿ä¸€æ®µæ—¶é—´å‡†å®žæ—¶åŒæ­¥è¿‡æ¥ã€‚]]></content>
      <categories>
        <category>Architecture</category>
      </categories>
      <tags>
        <tag>Architecture</tag>
        <tag>PaaS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java åžƒåœ¾å›žæ”¶ç®—æ³•ä¹‹G1]]></title>
    <url>%2Fjava-gc-g1.html</url>
    <content type="text"><![CDATA[G1(Garbage-First)å›žæ”¶å™¨æ˜¯åœ¨JDK1.7ä¸­æ­£å¼ä½¿ç”¨çš„å…¨æ–°åžƒåœ¾å›žæ”¶å™¨ï¼ŒG1æ‹¥æœ‰ç‹¬ç‰¹çš„åžƒåœ¾å›žæ”¶ç­–ç•¥ï¼Œä»Žåˆ†ä»£ä¸Šçœ‹ï¼ŒG1ä¾ç„¶å±žäºŽåˆ†ä»£åžƒåœ¾å›žæ”¶å™¨ï¼Œå®ƒä¼šåŒºåˆ†å¹´ä»£å’Œè€å¹´ä»£ï¼Œä¾ç„¶æœ‰edenå’ŒsurvivoråŒºï¼Œä½†ä»Žå †çš„ç»“æž„ä¸Šçœ‹ï¼Œå®ƒå¹¶ä¸è¦æ±‚æ•´ä¸ªedenåŒºã€å¹´æ¸…ä»£æˆ–è€…è€å¹´ä»£éƒ½è¿žç»­ã€‚å®ƒä½¿ç”¨äº†å…¨æ–°çš„åˆ†åŒºç®—æ³•ã€‚ å…¶ç‰¹ç‚¹å¦‚ä¸‹ï¼š å¹¶è¡Œæ€§ï¼šG1åœ¨å›žæ”¶æœŸé—´ï¼Œå¯ä»¥ç”±å¤šä¸ªGCçº¿ç¨‹åŒæ—¶å·¥ä½œï¼Œæœ‰æ•ˆåˆ©ç”¨å¤šæ ¸è®¡ç®—èƒ½åŠ›ã€‚ å¹¶å‘æ€§ï¼šG1æ‹¥æœ‰ä¸Žåº”ç”¨ç¨‹åºäº¤æ›¿æ‰§è¡Œçš„èƒ½åŠ›ï¼Œå› æ­¤ä¸€èˆ¬æ¥è¯´ï¼Œä¸ä¼šåœ¨æ•´ä¸ªå›žæ”¶æœŸé—´å®Œå…¨é˜»å¡žåº”ç”¨ç¨‹åºã€‚ åˆ†ä»£GCï¼šä¸Žä¹‹å‰å›žæ”¶å™¨ä¸åŒï¼Œå…¶ä»–å›žæ”¶å™¨ï¼Œå®ƒä»¬è¦ä¹ˆå·¥ä½œåœ¨å¹´è½»ä»£è¦ä¹ˆå·¥ä½œåœ¨è€å¹´ä»£ã€‚G1å¯ä»¥åŒæ—¶å…¼é¡¾å¹´è½»ä»£ä¸Žè€å¹´ä»£ã€‚ ç©ºé—´æ•´ç†ï¼šG1åœ¨å›žæ”¶è¿‡ç¨‹ä¸­ï¼Œä¼šè¿›è¡Œé€‚å½“çš„å¯¹è±¡ç§»åŠ¨ï¼Œä¸åƒCMSï¼Œåªæ˜¯ç®€å•çš„æ ‡è®°æ¸…é™¤ï¼Œåœ¨è‹¥å¹²æ¬¡GCåŽCMSå¿…é¡»è¿›è¡Œä¸€æ¬¡ç¢Žç‰‡æ•´ç†ï¼ŒG1åœ¨æ¯æ¬¡å›žæ”¶æ—¶éƒ½ä¼šæœ‰æ•ˆçš„å¤åˆ¶å¯¹è±¡ï¼Œå‡å°‘ç©ºé—´ç¢Žç‰‡ã€‚ å¯é¢„è§æ€§ï¼šç”±äºŽåˆ†åŒºçš„åŽŸå› ï¼ŒG1å¯ä»¥åªé€‰å–éƒ¨åˆ†åŒºåŸŸè¿›è¡Œå†…å­˜å›žæ”¶ï¼Œè¿™æ ·ç¼©å°äº†å›žæ”¶èŒƒå›´ï¼Œå› æ­¤å¯¹äºŽå…¨å±€åœé¡¿ä¹Ÿèƒ½å¾—åˆ°æ›´å¥½çš„æŽ§åˆ¶ã€‚ ä¸€ã€G1çš„å†…å­˜åˆ’åˆ†å’Œä¸»è¦æ”¶é›†è¿‡ç¨‹G1æ”¶é›†å›žæ”¶å™¨å°†å †è¿›è¡Œåˆ†åŒºï¼Œåˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªçš„åŒºåŸŸï¼Œæ¯æ¬¡æ”¶é›†çš„æ—¶å€™ï¼Œåªæ”¶é›†å…¶ä¸­å‡ ä¸ªåŒºåŸŸï¼Œä»¥æ­¤æ¥æŽ§åˆ¶åžƒåœ¾å›žæ”¶äº§ç”Ÿä¸€æ¬¡åœé¡¿æ—¶é—´ã€‚ G1çš„æ”¶é›†è¿‡ç¨‹å¯èƒ½æœ‰4ä¸ªé˜¶æ®µï¼š æ–°ç”Ÿä»£GC å¹¶å‘æ ‡è®°å‘¨æœŸ æ··åˆæ”¶é›† ï¼ˆå¦‚æžœéœ€è¦ï¼‰è¿›è¡ŒFull GCã€‚ äºŒã€G1çš„æ–°ç”Ÿä»£GCæ–°ç”Ÿä»£GCçš„ä¸»è¦å·¥ä½œæ˜¯å›žæ”¶edenåŒºå’ŒsurvivoråŒºã€‚ ä¸€æ—¦edenåŒºè¢«å æ»¡ï¼Œæ–°ç”Ÿä»£GCå°±ä¼šå¯åŠ¨ã€‚æ–°ç”Ÿä»£GCæ”¶é›†å‰åŽçš„å †æ•°æ®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­Eè¡¨ç¤ºedenåŒºï¼ŒSè¡¨ç¤ºsurvivoråŒºï¼ŒOè¡¨ç¤ºè€å¹´ä»£ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œæ–°ç”Ÿä»£GCåªå¤„ç†edenå’ŒsurvivoråŒºï¼Œå›žæ”¶åŽï¼Œæ‰€æœ‰çš„edenåŒºéƒ½åº”è¯¥è¢«æ¸…ç©ºï¼Œè€ŒsurvivoråŒºä¼šè¢«æ”¶é›†ä¸€éƒ¨åˆ†æ•°æ®ï¼Œä½†æ˜¯åº”è¯¥è‡³å°‘ä»ç„¶å­˜åœ¨ä¸€ä¸ªsurvivoråŒºï¼Œç±»æ¯”å…¶ä»–çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œè¿™ä¸€ç‚¹ä¼¼ä¹Žå¹¶æ²¡æœ‰å¤ªå¤§å˜åŒ–ã€‚å¦ä¸€ä¸ªé‡è¦çš„å˜åŒ–æ˜¯è€å¹´ä»£çš„åŒºåŸŸå¢žå¤šï¼Œå› ä¸ºéƒ¨åˆ†survivoråŒºæˆ–è€…edenåŒºçš„å¯¹è±¡å¯èƒ½ä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚ ä¸‰ã€G1å¹¶å‘æ ‡è®°å‘¨æœŸ G1çš„å¹¶å‘é˜¶æ®µå’ŒCMSæœ‰äº›ç±»ä¼¼ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸ºäº†é™ä½Žä¸€æ¬¡åœé¡¿æ—¶é—´ï¼Œè€Œå°†å¯ä»¥å’Œåº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œçš„éƒ¨åˆ†å•ç‹¬æå–å‡ºæ¥æ‰§è¡Œã€‚ å¹¶å‘æ ‡è®°å‘¨æœŸé’ˆå¯¹è€å¹´ä»£ å¹¶å‘æ ‡è®°å‘¨æœŸå¯åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š åˆå§‹æ ‡è®°ï¼šæ ‡è®°ä»Žæ ¹èŠ‚ç‚¹ç›´æŽ¥å¯è¾¾çš„å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µä¼šä¼´éšä¸€æ¬¡æ–°ç”Ÿä»£GCï¼Œå®ƒæ˜¯ä¼šäº§ç”Ÿå…¨å±€åœé¡¿çš„ï¼Œåº”ç”¨ç¨‹åºåœ¨è¿™ä¸ªé˜¶æ®µå¿…é¡»åœæ­¢æ‰§è¡Œã€‚ æ ¹åŒºåŸŸæ‰«æï¼šç”±äºŽåˆå§‹æ ‡è®°å¿…ç„¶ä¼šä¼´éšä¸€æ¬¡æ–°ç”Ÿä»£GCï¼Œæ‰€ä»¥åœ¨åˆå§‹åŒ–æ ‡è®°åŽï¼Œedenè¢«æ¸…ç©ºï¼Œå¹¶ä¸”å­˜æ´»å¯¹è±¡è¢«ç§»åˆ°survivoråŒºã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå°†æ‰«æç”±survivoråŒºç›´æŽ¥å¯è¾¾çš„è€å¹´ä»£åŒºåŸŸï¼Œå¹¶æ ‡è®°è¿™äº›ç›´æŽ¥å¯è¾¾çš„å¯¹è±¡ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å¯ä»¥å’Œåº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œçš„ã€‚ä½†æ˜¯æ ¹åŒºåŸŸæ‰«æä¸èƒ½å’Œæ–°ç”Ÿä»£GCåŒæ—¶å‘ç”Ÿï¼ˆå› ä¸ºæ ¹åŒºåŸŸæ‰«æä¾èµ–survivoråŒºçš„å¯¹è±¡ï¼Œè€Œæ–°ç”Ÿä»£GCä¼šä¿®æ”¹è¿™ä¸ªåŒºåŸŸï¼‰ï¼Œæ•…å¦‚æžœæ°å·§æ­¤æ—¶éœ€è¦æ–°ç”Ÿä»£GCï¼ŒGCå°±éœ€è¦ç­‰å¾…æ ¹åŒºåŸŸæ‰«æç»“æŸåŽæ‰èƒ½è¿›è¡Œï¼Œå¦‚æžœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œè¿™æ¬¡æ–°ç”Ÿä»£GCçš„æ—¶é—´å°±ä¼šå»¶é•¿ã€‚ å¹¶å‘æ ‡è®°ï¼šå’ŒCMSç±»ä¼¼ï¼Œå¹¶å‘æ ‡è®°å°†ä¼šæ‰«æå¹¶æŸ¥æ‰¾æ•´ä¸ªå †çš„å­˜æ´»å¯¹è±¡ï¼Œå¹¶åšå¥½æ ‡è®°ã€‚è¿™æ˜¯ä¸€ä¸ªå¹¶å‘è¿‡ç¨‹ï¼Œå¹¶ä¸”è¿™ä¸ªè¿‡ç¨‹å¯ä»¥è¢«ä¸€æ¬¡æ–°ç”Ÿä»£GCæ‰“æ–­ã€‚ é‡æ–°æ ‡è®°ï¼šå’ŒCMSä¸€æ ·ï¼Œé‡æ–°æ ‡è®°ä¹Ÿæ˜¯ä¼šä½¿åº”ç”¨ç¨‹åºåœé¡¿ï¼Œç”±äºŽåœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨ç¨‹åºä¾ç„¶è¿è¡Œï¼Œå› æ­¤æ ‡è®°ç»“æžœå¯èƒ½éœ€è¦ä¿®æ­£ï¼Œæ‰€ä»¥åœ¨æ­¤é˜¶æ®µå¯¹ä¸Šä¸€æ¬¡æ ‡è®°è¿›è¡Œè¡¥å……ã€‚åœ¨G1ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹ä½¿ç”¨SATBï¼ˆSnapshot-At-The-Beginingï¼‰ç®—æ³•å®Œæˆï¼Œå³G1ä¼šåœ¨æ ‡è®°ä¹‹åˆä¸ºå­˜æ´»å¯¹è±¡åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œè¿™ä¸ªå¿«ç…§æœ‰åŠ©äºŽåŠ é€Ÿé‡æ–°æ ‡è®°çš„é€Ÿåº¦ã€‚ ç‹¬å æ¸…ç†ï¼šé¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªé˜¶æ®µä¼šå¼•èµ·åœé¡¿ã€‚å®ƒå°†è®¡ç®—å„ä¸ªåŒºåŸŸçš„å­˜æ´»å¯¹è±¡å’ŒGCå›žæ”¶æ¯”ä¾‹å¹¶è¿›è¡ŒæŽ’åºï¼Œè¯†åˆ«å¯ä¾›æ··åˆå›žæ”¶çš„åŒºåŸŸã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œè¿˜ä¼šæ›´æ–°è®°å¿†é›†ã€‚è¯¥é˜¶æ®µç»™å‡ºäº†éœ€è¦è¢«æ··åˆå›žæ”¶çš„åŒºåŸŸå¹¶è¿›è¡Œäº†æ ‡è®°ï¼Œåœ¨æ··åˆå›žæ”¶é˜¶æ®µï¼Œéœ€è¦è¿™äº›ä¿¡æ¯ã€‚ å¹¶å‘æ¸…ç†é˜¶æ®µï¼šè¯†åˆ«å¹¶æ¸…ç†å®Œå…¨ç©ºé—²çš„åŒºåŸŸã€‚å®ƒæ˜¯å¹¶å‘çš„æ¸…ç†ï¼Œä¸ä¼šå¼•èµ·åœé¡¿ã€‚ SATBå…¨ç§°æ˜¯Snapshot-At-The-Beginningï¼Œç”±å­—é¢ç†è§£ï¼Œæ˜¯GCå¼€å§‹æ—¶æ´»ç€çš„å¯¹è±¡çš„ä¸€ä¸ªå¿«ç…§ã€‚å®ƒæ˜¯é€šè¿‡Root Tracingå¾—åˆ°çš„ï¼Œä½œç”¨æ˜¯ç»´æŒå¹¶å‘GCçš„æ­£ç¡®æ€§ã€‚é‚£ä¹ˆå®ƒæ˜¯æ€Žä¹ˆç»´æŒå¹¶å‘GCçš„æ­£ç¡®æ€§çš„å‘¢ï¼Ÿæ ¹æ®ä¸‰è‰²æ ‡è®°ç®—æ³•ï¼Œæˆ‘ä»¬çŸ¥é“å¯¹è±¡å­˜åœ¨ä¸‰ç§çŠ¶æ€ï¼šç™½ï¼šå¯¹è±¡æ²¡æœ‰è¢«æ ‡è®°åˆ°ï¼Œæ ‡è®°é˜¶æ®µç»“æŸåŽï¼Œä¼šè¢«å½“åšåžƒåœ¾å›žæ”¶æŽ‰ã€‚ç°ï¼šå¯¹è±¡è¢«æ ‡è®°äº†ï¼Œä½†æ˜¯å®ƒçš„fieldè¿˜æ²¡æœ‰è¢«æ ‡è®°æˆ–æ ‡è®°å®Œã€‚é»‘ï¼šå¯¹è±¡è¢«æ ‡è®°äº†ï¼Œä¸”å®ƒçš„æ‰€æœ‰fieldä¹Ÿè¢«æ ‡è®°å®Œäº†ã€‚ SATB åˆ©ç”¨ write barrier å°†æ‰€æœ‰å³å°†è¢«åˆ é™¤çš„å¼•ç”¨å…³ç³»çš„æ—§å¼•ç”¨è®°å½•ä¸‹æ¥ï¼Œæœ€åŽä»¥è¿™äº›æ—§å¼•ç”¨ä¸ºæ ¹ Stop The World åœ°é‡æ–°æ‰«æä¸€éå³å¯é¿å…æ¼æ ‡é—®é¢˜ã€‚ å› æ­¤G1 Remarké˜¶æ®µ Stop The World ä¸Ž CMSäº†çš„remarkæœ‰ä¸€ä¸ªæœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼Œé‚£å°±æ˜¯è¿™ä¸ªæš‚åœåªéœ€è¦æ‰«ææœ‰ write barrier æ‰€è¿½ä¸­å¯¹è±¡ä¸ºæ ¹çš„å¯¹è±¡ï¼Œ è€Œ CMS çš„remark éœ€è¦é‡æ–°æ‰«ææ•´ä¸ªæ ¹é›†åˆï¼Œå› è€ŒCMS remarkæœ‰å¯èƒ½ä¼šéžå¸¸æ…¢ã€‚ å››ã€æ··åˆå›žæ”¶åœ¨å¹¶å‘æ ‡è®°å‘¨æœŸä¸­ï¼Œè™½æœ‰éƒ¨åˆ†å¯¹è±¡è¢«å›žæ”¶ï¼Œä½†æ˜¯å›žæ”¶çš„æ¯”ä¾‹æ˜¯éžå¸¸ä½Žçš„ã€‚ä½†æ˜¯åœ¨å¹¶å‘æ ‡è®°å‘¨æœŸåŽï¼ŒG1å·²ç»æ˜Žç¡®çŸ¥é“å“ªäº›åŒºåŸŸå«æœ‰æ¯”è¾ƒå¤šçš„åžƒåœ¾å¯¹è±¡ï¼Œåœ¨æ··åˆå›žæ”¶é˜¶æ®µï¼Œå°±å¯ä»¥ä¸“é—¨é’ˆå¯¹è¿™äº›åŒºåŸŸè¿›è¡Œå›žæ”¶ã€‚å½“ç„¶G1ä¼šä¼˜å…ˆå›žæ”¶åžƒåœ¾æ¯”ä¾‹è¾ƒé«˜çš„åŒºåŸŸï¼ˆå›žæ”¶è¿™äº›åŒºåŸŸçš„æ€§ä»·æ¯”é«˜ï¼‰ï¼Œè¿™æ­£æ˜¯G1åå­—çš„ç”±æ¥ï¼ˆGarbage First Garbage Collectorï¼šè¯‘ä¸ºåžƒåœ¾ä¼˜å…ˆçš„åžƒåœ¾å›žæ”¶å™¨ï¼‰ï¼Œè¿™é‡Œçš„åžƒåœ¾ä¼˜å…ˆï¼ˆGarbage Firstï¼‰æŒ‡çš„æ˜¯å›žæ”¶æ—¶ä¼˜å…ˆé€‰å–åžƒåœ¾æ¯”ä¾‹æœ€é«˜çš„åŒºåŸŸã€‚ è¿™ä¸ªé˜¶æ®µå«åšæ··åˆå›žæ”¶ï¼Œæ˜¯å› ä¸ºåœ¨è¿™ä¸ªé˜¶æ®µï¼Œå³ä¼šæ‰§è¡Œæ­£å¸¸çš„å¹´è½»ä»£GC,åˆä¼šé€‰å–ä¸€äº›è¢«æ ‡è®°çš„è€å¹´ä»£åŒºåŸŸè¿›è¡Œå›žæ”¶ï¼ŒåŒæ—¶å¤„ç†äº†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚ æ··åˆå›žæ”¶ä¼šè¢«æ‰§è¡Œå¤šæ¬¡ï¼Œç›´åˆ°å›žæ”¶äº†è¶³å¤Ÿå¤šçš„å†…å­˜ç©ºé—´ï¼Œç„¶åŽï¼Œå®ƒä¼šè§¦å‘ä¸€æ¬¡æ–°ç”Ÿä»£GCã€‚æ–°ç”Ÿä»£GCåŽï¼Œåˆå¯èƒ½ä¼šå‘ç”Ÿä¸€æ¬¡å¹¶å‘æ ‡è®°å‘¨æœŸçš„å¤„ç†ï¼Œæœ€åŽåˆä¼šå¼•èµ·æ··åˆå›žæ”¶ï¼Œå› æ­¤æ•´ä¸ªè¿‡ç¨‹å¯èƒ½æ˜¯å¦‚ä¸‹å›¾ï¼š äº”ã€å¿…è¦æ—¶çš„Full GCå’ŒCMSç±»ä¼¼ï¼Œå¹¶å‘æ”¶é›†è®©åº”ç”¨ç¨‹åºå’ŒGCçº¿ç¨‹äº¤æ›¿å·¥ä½œï¼Œå› æ­¤åœ¨ç‰¹åˆ«ç¹å¿™çš„æƒ…å†µä¸‹æ— å¯é¿å…çš„ä¼šå‘ç”Ÿå›žæ”¶è¿‡ç¨‹ä¸­å†…å­˜ä¸è¶³çš„æƒ…å†µï¼Œå½“é‡åˆ°è¿™ç§æƒ…å†µï¼ŒG1ä¼šè½¬å…¥ä¸€ä¸ªFull GC è¿›è¡Œå›žæ”¶ã€‚ ä»¥ä¸‹4ç§æƒ…å†µä¼šè§¦å‘è¿™ç±»çš„Full GCï¼š 1ã€å¹¶å‘æ¨¡å¼å¤±æ•ˆG1å¯åŠ¨æ ‡è®°å‘¨æœŸï¼Œä½†åœ¨Mix GCä¹‹å‰ï¼Œè€å¹´ä»£å°±è¢«å¡«æ»¡ï¼Œè¿™æ—¶å€™G1ä¼šæ”¾å¼ƒæ ‡è®°å‘¨æœŸã€‚è¿™ç§æƒ…å½¢ä¸‹ï¼Œéœ€è¦å¢žåŠ å †å¤§å°ï¼Œæˆ–è€…è°ƒæ•´å‘¨æœŸï¼ˆä¾‹å¦‚å¢žåŠ çº¿ç¨‹æ•°-XX:ConcGCThreadsç­‰ï¼‰ã€‚ GCæ—¥å¿—å¦‚ä¸‹çš„ç¤ºä¾‹ï¼š è§£å†³åŠžæ³•ï¼šå‘ç”Ÿè¿™ç§å¤±è´¥æ„å‘³ç€å †çš„å¤§å°åº”è¯¥å¢žåŠ äº†ï¼Œæˆ–è€…G1æ”¶é›†å™¨çš„åŽå°å¤„ç†åº”è¯¥æ›´æ—©å¼€å§‹ï¼Œæˆ–è€…éœ€è¦è°ƒæ•´å‘¨æœŸï¼Œè®©å®ƒè¿è¡Œå¾—æ›´å¿«ï¼ˆå¦‚ï¼Œå¢žåŠ åŽå°å¤„ç†çš„çº¿ç¨‹æ•°ï¼‰ã€‚ 2ã€æ™‹å‡å¤±è´¥ï¼ˆto-space exhaustedæˆ–è€…to-space overflowï¼‰ G1æ”¶é›†å™¨å®Œæˆäº†æ ‡è®°é˜¶æ®µï¼Œå¼€å§‹å¯åŠ¨æ··åˆå¼åžƒåœ¾å›žæ”¶ï¼Œæ¸…ç†è€å¹´ä»£çš„åˆ†åŒºï¼Œä¸è¿‡ï¼Œè€å¹´ä»£ç©ºé—´åœ¨åžƒåœ¾å›žæ”¶é‡Šæ”¾å‡ºè¶³å¤Ÿå†…å­˜ä¹‹å‰å°±ä¼šè¢«è€—å°½ã€‚ï¼ˆG1åœ¨è¿›è¡ŒGCçš„æ—¶å€™æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ä¾›å­˜æ´»å¯¹è±¡æˆ–æ™‹å‡å¯¹è±¡ä½¿ç”¨ï¼‰ï¼Œç”±æ­¤è§¦å‘äº†Full GCã€‚ ä¸‹é¢æ—¥å¿—ä¸­ï¼ˆå¯ä»¥åœ¨æ—¥å¿—ä¸­çœ‹åˆ°(to-space exhausted)æˆ–è€…ï¼ˆto-space overflowï¼‰ï¼‰ï¼Œååº”çš„çŽ°è±¡æ˜¯æ··åˆå¼GCä¹‹åŽç´§æŽ¥ç€ä¸€æ¬¡Full GCã€‚ è¿™ç§å¤±è´¥é€šå¸¸æ„å‘³ç€æ··åˆå¼æ”¶é›†éœ€è¦æ›´è¿…é€Ÿçš„å®Œæˆåžƒåœ¾æ”¶é›†ï¼šæ¯æ¬¡æ–°ç”Ÿä»£åžƒåœ¾æ”¶é›†éœ€è¦å¤„ç†æ›´å¤šè€å¹´ä»£çš„åˆ†åŒºã€‚ è§£å†³è¿™ç§é—®é¢˜çš„æ–¹å¼æ˜¯ï¼š å¢žåŠ  -XX:G1ReservePercenté€‰é¡¹çš„å€¼ï¼ˆå¹¶ç›¸åº”å¢žåŠ æ€»çš„å †å¤§å°ï¼‰ï¼Œä¸ºâ€œç›®æ ‡ç©ºé—´â€å¢žåŠ é¢„ç•™å†…å­˜é‡ã€‚ é€šè¿‡å‡å°‘ -XX:InitiatingHeapOccupancyPercent æå‰å¯åŠ¨æ ‡è®°å‘¨æœŸã€‚ ä¹Ÿå¯ä»¥é€šè¿‡å¢žåŠ  -XX:ConcGCThreads é€‰é¡¹çš„å€¼æ¥å¢žåŠ å¹¶è¡Œæ ‡è®°çº¿ç¨‹çš„æ•°ç›®ã€‚ 3ã€ç–æ•£å¤±è´¥ï¼ˆto-space exhaustedæˆ–è€…to-space overflowï¼‰ è¿›è¡Œæ–°ç”Ÿä»£åžƒåœ¾æ”¶é›†æ˜¯ï¼ŒSurvivorç©ºé—´å’Œè€å¹´ä»£ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å®¹çº³æ‰€æœ‰çš„å¹¸å­˜å¯¹è±¡ã€‚è¿™ç§æƒ…å½¢åœ¨GCæ—¥å¿—ä¸­é€šå¸¸æ˜¯ï¼š è¿™æ¡æ—¥å¿—è¡¨æ˜Žå †å·²ç»å‡ ä¹Žå®Œå…¨ç”¨å°½æˆ–è€…ç¢Žç‰‡åŒ–äº†ã€‚G1æ”¶é›†å™¨ä¼šå°è¯•ä¿®å¤è¿™ä¸€å¤±è´¥ï¼Œä½†å¯ä»¥é¢„æœŸï¼Œç»“æžœä¼šæ›´åŠ æ¶åŒ–ï¼šG1æ”¶é›†å™¨ä¼šè½¬è€Œä½¿ç”¨Full GCã€‚ è§£å†³è¿™ç§é—®é¢˜çš„æ–¹å¼æ˜¯ï¼š å¢žåŠ  -XX:G1ReservePercenté€‰é¡¹çš„å€¼ï¼ˆå¹¶ç›¸åº”å¢žåŠ æ€»çš„å †å¤§å°ï¼‰ï¼Œä¸ºâ€œç›®æ ‡ç©ºé—´â€å¢žåŠ é¢„ç•™å†…å­˜é‡ã€‚ é€šè¿‡å‡å°‘ -XX:InitiatingHeapOccupancyPercent æå‰å¯åŠ¨æ ‡è®°å‘¨æœŸã€‚ ä¹Ÿå¯ä»¥é€šè¿‡å¢žåŠ  -XX:ConcGCThreads é€‰é¡¹çš„å€¼æ¥å¢žåŠ å¹¶è¡Œæ ‡è®°çº¿ç¨‹çš„æ•°ç›®ã€‚ 4ã€Humongous Object åˆ†é…å¤±è´¥å½“Humongous Object æ‰¾ä¸åˆ°åˆé€‚çš„ç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œå°±ä¼šå¯åŠ¨Full GCï¼Œæ¥é‡Šæ”¾ç©ºé—´ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥é¿å…åˆ†é…å¤§é‡çš„å·¨åž‹å¯¹è±¡ï¼Œå¢žåŠ å†…å­˜æˆ–è€…å¢žå¤§-XX:G1HeapRegionSizeï¼Œä½¿å·¨åž‹å¯¹è±¡ä¸å†æ˜¯å·¨åž‹å¯¹è±¡ã€‚ å¯¹äºŽHumongous Object çš„å¤„ç†è¿˜æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯åˆ‡æ¢GCç®—æ³•åˆ°ZGCï¼Œå› ä¸ºZGCä¸­å¯¹äºŽHumongous Object çš„å›žæ”¶ä¸ä¼šç‰¹æ®Šå¤„ç†ï¼ˆæ¯”å¦‚ä¸ä¼šå»¶è¿Ÿæ”¶é›†ï¼‰ã€‚ å…­ã€å·¨åž‹å¯¹è±¡Humongous Objectï¼šå·¨åž‹å¯¹è±¡Humongous regionsï¼šå·¨åž‹åŒºåŸŸ å¯¹äºŽG1è€Œè¨€ï¼Œåªè¦è¶…è¿‡reginå¤§å°çš„ä¸€åŠï¼Œå°±è¢«è®¤ä¸ºæ˜¯å·¨åž‹å¯¹è±¡ã€‚å·¨åž‹å¯¹è±¡ç›´æŽ¥è¢«åˆ†é…åˆ°è€å¹´ä»£ä¸­çš„â€œå·¨åž‹åŒºåŸŸâ€ã€‚è¿™äº›å·¨åž‹åŒºåŸŸæ˜¯ä¸€ä¸ªè¿žç»­çš„åŒºåŸŸé›†ã€‚StartsHumongous æ ‡è®°è¯¥è¿žç»­é›†çš„å¼€å§‹ï¼ŒContinuesHumongous æ ‡è®°å®ƒçš„å»¶ç»­ã€‚ åœ¨åˆ†é…å·¨åž‹å¯¹è±¡ä¹‹å‰å…ˆæ£€æŸ¥æ˜¯å¦è¶…è¿‡ initiating heap occupancy percentå’Œthe marking threshold, å¦‚æžœè¶…è¿‡çš„è¯ï¼Œå°±å¯åŠ¨global concurrent markingï¼Œä¸ºçš„æ˜¯ææ—©å›žæ”¶ï¼Œé˜²æ­¢ evacuation failures å’Œ Full GCã€‚ å¯¹äºŽå·¨åž‹å¯¹è±¡ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼š æ²¡æœ‰è¢«å¼•ç”¨çš„å·¨åž‹å¯¹è±¡ä¼šåœ¨æ ‡è®°æ¸…ç†é˜¶æ®µæˆ–è€…Full GCæ—¶è¢«é‡Šæ”¾æŽ‰ã€‚ ä¸ºäº†å‡å°‘æ‹·è´è´Ÿè½½ï¼Œåªæœ‰åœ¨Full GCçš„æ—¶å€™ï¼Œæ‰ä¼šåŽ‹ç¼©å¤§å¯¹è±¡regionã€‚ æ¯ä¸€ä¸ªregionä¸­éƒ½åªæœ‰ä¸€ä¸ªå·¨åž‹å¯¹è±¡ï¼Œè¯¥regionå‰©ä½™çš„éƒ¨åˆ†å¾—ä¸åˆ°åˆ©ç”¨ï¼Œä¼šå¯¼è‡´å †ç¢Žç‰‡åŒ–ã€‚ å¦‚æžœçœ‹åˆ°ç”±äºŽå¤§å¯¹è±¡åˆ†é…å¯¼è‡´é¢‘ç¹çš„å¹¶å‘å›žæ”¶ï¼Œéœ€è¦æŠŠå¤§å¯¹è±¡å˜ä¸ºæ™®é€šçš„å¯¹è±¡ï¼Œå»ºè®®å¢žå¤§Region sizeã€‚ï¼ˆæˆ–è€…åˆ‡æ¢åˆ°ZGCï¼‰ å¯¹äºŽå¢žå¤§Region sizeæœ‰ä¸€ä¸ªè´Ÿé¢å½±å“å°±æ˜¯ï¼šå‡å°‘äº†å¯ç”¨regionçš„æ•°é‡ã€‚å› æ­¤ï¼Œå¯¹äºŽè¿™ç§æƒ…å†µï¼Œä½ éœ€è¦è¿›è¡Œç›¸åº”çš„æµ‹è¯•ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦å®žé™…æé«˜äº†åº”ç”¨ç¨‹åºçš„åžåé‡æˆ–å»¶è¿Ÿã€‚ ä¸ƒã€å¸¸è§è°ƒä¼˜å‚æ•°1ã€-XX:MaxGCPauseMillis=Né»˜è®¤200æ¯«ç§’ å‰é¢ä»‹ç»è¿‡ä½¿ç”¨GCçš„æœ€åŸºæœ¬çš„å‚æ•°ï¼š -XX:+UseG1GC -Xmx32g -XX:MaxGCPauseMillis=200 å‰é¢2ä¸ªå‚æ•°éƒ½å¥½ç†è§£ï¼ŒåŽé¢è¿™ä¸ªMaxGCPauseMilliså‚æ•°è¯¥æ€Žä¹ˆé…ç½®å‘¢ï¼Ÿè¿™ä¸ªå‚æ•°ä»Žå­—é¢çš„æ„æ€ä¸Šçœ‹ï¼Œå°±æ˜¯å…è®¸çš„GCæœ€å¤§çš„æš‚åœæ—¶é—´ã€‚G1å°½é‡ç¡®ä¿æ¯æ¬¡GCæš‚åœçš„æ—¶é—´éƒ½åœ¨è®¾ç½®çš„MaxGCPauseMillisèŒƒå›´å†…ã€‚é‚£G1æ˜¯å¦‚ä½•åšåˆ°æœ€å¤§æš‚åœæ—¶é—´çš„å‘¢ï¼Ÿè¿™æ¶‰åŠåˆ°å¦ä¸€ä¸ªæ¦‚å¿µï¼ŒCSet(collection set)ã€‚å®ƒçš„æ„æ€æ˜¯åœ¨ä¸€æ¬¡åžƒåœ¾æ”¶é›†å™¨ä¸­è¢«æ”¶é›†çš„åŒºåŸŸé›†åˆã€‚ Young GCï¼šé€‰å®šæ‰€æœ‰æ–°ç”Ÿä»£é‡Œçš„regionã€‚é€šè¿‡æŽ§åˆ¶æ–°ç”Ÿä»£çš„regionä¸ªæ•°æ¥æŽ§åˆ¶young GCçš„å¼€é”€ã€‚ Mixed GCï¼šé€‰å®šæ‰€æœ‰æ–°ç”Ÿä»£é‡Œçš„regionï¼Œå¤–åŠ æ ¹æ®global concurrent markingç»Ÿè®¡å¾—å‡ºæ”¶é›†æ”¶ç›Šé«˜çš„è‹¥å¹²è€å¹´ä»£regionã€‚åœ¨ç”¨æˆ·æŒ‡å®šçš„å¼€é”€ç›®æ ‡èŒƒå›´å†…å°½å¯èƒ½é€‰æ‹©æ”¶ç›Šé«˜çš„è€å¹´ä»£regionã€‚ åœ¨ç†è§£äº†è¿™äº›åŽï¼Œæˆ‘ä»¬å†è®¾ç½®æœ€å¤§æš‚åœæ—¶é—´å°±æœ‰äº†æ–¹å‘ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬èƒ½å®¹å¿çš„æœ€å¤§æš‚åœæ—¶é—´æ˜¯æœ‰ä¸€ä¸ªé™åº¦çš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸ªé™åº¦èŒƒå›´å†…è®¾ç½®ã€‚ä½†æ˜¯åº”è¯¥è®¾ç½®çš„å€¼æ˜¯å¤šå°‘å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦åœ¨åžåé‡è·ŸMaxGCPauseMillisä¹‹é—´åšä¸€ä¸ªå¹³è¡¡ã€‚å¦‚æžœMaxGCPauseMillisè®¾ç½®çš„è¿‡å°ï¼Œé‚£ä¹ˆGCå°±ä¼šé¢‘ç¹ï¼Œåžåé‡å°±ä¼šä¸‹é™ã€‚å¦‚æžœMaxGCPauseMillisè®¾ç½®çš„è¿‡å¤§ï¼Œåº”ç”¨ç¨‹åºæš‚åœæ—¶é—´å°±ä¼šå˜é•¿ã€‚G1çš„é»˜è®¤æš‚åœæ—¶é—´æ˜¯200æ¯«ç§’ï¼Œæˆ‘ä»¬å¯ä»¥ä»Žè¿™é‡Œå…¥æ‰‹ï¼Œè°ƒæ•´åˆé€‚çš„æ—¶é—´ã€‚ 2ã€-XX:G1HeapRegionSize=nè®¾ç½®çš„ G1 åŒºåŸŸçš„å¤§å°ã€‚å€¼æ˜¯ 2 çš„å¹‚ï¼ŒèŒƒå›´æ˜¯ 1 MB åˆ° 32 MB ä¹‹é—´ã€‚ç›®æ ‡æ˜¯æ ¹æ®æœ€å°çš„ Java å †å¤§å°åˆ’åˆ†å‡ºçº¦ 2048 ä¸ªåŒºåŸŸã€‚ -XX:ParallelGCThreads=nï¼ˆè°ƒæ•´G1åžƒåœ¾æ”¶é›†çš„åŽå°çº¿ç¨‹æ•°ï¼‰ è®¾ç½® STW å·¥ä½œçº¿ç¨‹æ•°çš„å€¼ã€‚å°† n çš„å€¼è®¾ç½®ä¸ºé€»è¾‘å¤„ç†å™¨çš„æ•°é‡ã€‚n çš„å€¼ä¸Žé€»è¾‘å¤„ç†å™¨çš„æ•°é‡ç›¸åŒï¼Œæœ€å¤šä¸º 8ã€‚ å¦‚æžœé€»è¾‘å¤„ç†å™¨ä¸æ­¢å…«ä¸ªï¼Œåˆ™å°† n çš„å€¼è®¾ç½®ä¸ºé€»è¾‘å¤„ç†å™¨æ•°çš„ 5/8 å·¦å³ã€‚è¿™é€‚ç”¨äºŽå¤§å¤šæ•°æƒ…å†µï¼Œé™¤éžæ˜¯è¾ƒå¤§çš„ SPARC ç³»ç»Ÿï¼Œå…¶ä¸­ n çš„å€¼å¯ä»¥æ˜¯é€»è¾‘å¤„ç†å™¨æ•°çš„ 5/16 å·¦å³ã€‚ -XX:ConcGCThreads=nï¼ˆè°ƒæ•´G1åžƒåœ¾æ”¶é›†çš„åŽå°çº¿ç¨‹æ•°ï¼‰ è®¾ç½®å¹¶è¡Œæ ‡è®°çš„çº¿ç¨‹æ•°ã€‚å°† n è®¾ç½®ä¸ºå¹¶è¡Œåžƒåœ¾å›žæ”¶çº¿ç¨‹æ•° (ParallelGCThreads) çš„ 1/4 å·¦å³ã€‚ 3ã€ -XX:InitiatingHeapOccupancyPercent=45ï¼ˆè°ƒæ•´G1åžƒåœ¾æ”¶é›†è¿è¡Œé¢‘çŽ‡ï¼‰è®¾ç½®è§¦å‘æ ‡è®°å‘¨æœŸçš„ Java å †å ç”¨çŽ‡é˜ˆå€¼ã€‚é»˜è®¤å ç”¨çŽ‡æ˜¯æ•´ä¸ª Java å †çš„ 45%ã€‚ è¯¥å€¼è®¾ç½®å¤ªé«˜ï¼šä¼šé™·å…¥Full GCæ³¥æ½­ä¹‹ä¸­ï¼Œå› ä¸ºå¹¶å‘é˜¶æ®µæ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´åœ¨å‰©ä¸‹çš„å †ç©ºé—´è¢«å¡«æ»¡ä¹‹å‰å®Œæˆåžƒåœ¾æ”¶é›†ã€‚ å¦‚æžœè¯¥å€¼è®¾ç½®å¤ªå°ï¼šåº”ç”¨ç¨‹åºåˆä¼šä»¥è¶…è¿‡å®žé™…éœ€è¦çš„èŠ‚å¥è¿›è¡Œå¤§é‡çš„åŽå°å¤„ç†ã€‚ é¿å…ä½¿ç”¨ä»¥ä¸‹å‚æ•°ï¼šé¿å…ä½¿ç”¨ -Xmn é€‰é¡¹æˆ– -XX:NewRatio ç­‰å…¶ä»–ç›¸å…³é€‰é¡¹æ˜¾å¼è®¾ç½®å¹´è½»ä»£å¤§å°ã€‚å›ºå®šå¹´è½»ä»£çš„å¤§å°ä¼šè¦†ç›–æš‚åœæ—¶é—´ç›®æ ‡ã€‚ å…«ã€ç»†èŠ‚1ã€G1 mixed GCæ—¶æœºï¼Ÿmixed gcä¸­ä¹Ÿæœ‰ä¸€ä¸ªé˜ˆå€¼å‚æ•° -XX:InitiatingHeapOccupancyPercentï¼Œå½“è€å¹´ä»£å¤§å°å æ•´ä¸ªå †å¤§å°ç™¾åˆ†æ¯”è¾¾åˆ°è¯¥é˜ˆå€¼æ—¶ï¼Œä¼šè§¦å‘ä¸€æ¬¡mixed gc. åœ¨åˆ†é…humongous objectä¹‹å‰å…ˆæ£€æŸ¥æ˜¯å¦è¶…è¿‡ initiating heap occupancy percent, å¦‚æžœè¶…è¿‡çš„è¯ï¼Œå°±å¯åŠ¨global concurrent markingï¼Œä¸ºçš„æ˜¯ææ—©å›žæ”¶ï¼Œé˜²æ­¢ evacuation failures å’Œ Full GCã€‚ ä¸ºäº†å‡å°‘è¿žç»­H-objsåˆ†é…å¯¹GCçš„å½±å“ï¼Œéœ€è¦æŠŠå¤§å¯¹è±¡å˜ä¸ºæ™®é€šçš„å¯¹è±¡ï¼Œå»ºè®®å¢žå¤§Region sizeã€‚ ä¸€ä¸ªRegionçš„å¤§å°å¯ä»¥é€šè¿‡å‚æ•°-XX:G1HeapRegionSizeè®¾å®šï¼Œå–å€¼èŒƒå›´ä»Ž1Måˆ°32Mï¼Œä¸”æ˜¯2çš„æŒ‡æ•°ã€‚ 2ã€XXï¼šG1 HeapRegionSize é»˜è®¤å€¼ï¼Ÿé»˜è®¤æŠŠå †å†…å­˜æŒ‰ç…§2048ä»½å‡åˆ†ï¼Œæœ€åŽå¾—åˆ°ä¸€ä¸ªåˆç†çš„å¤§å°ã€‚ 3ã€ç›´æŽ¥å†…å­˜é…ç½®Q: ä»€ä¹ˆæ—¶å€™ç”¨ç›´æŽ¥å†…å­˜ï¼Ÿ A: è¯»å†™é¢‘ç¹çš„åœºåˆï¼Œå‡ºäºŽæ€§èƒ½è€ƒè™‘ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç›´æŽ¥å†…å­˜ã€‚ ç›´æŽ¥å†…å­˜ä¹Ÿæ˜¯ Java ç¨‹åºä¸­éžå¸¸é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯ NIO è¢«å¹¿æ³›ä½¿ç”¨ä¹‹åŽï¼Œç›´æŽ¥å†…å­˜å¯ä»¥è·³è¿‡ Java å †ï¼Œä½¿ Java ç¨‹åºå¯ä»¥ç›´æŽ¥è®¿é—®åŽŸç”Ÿå †ç©ºé—´ã€‚å› æ­¤å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸ŠåŠ å¿«å†…å­˜çš„è®¿é—®é€Ÿåº¦ã€‚ç›´æŽ¥å†…å­˜å¯ä»¥ç”¨ -XX:MaxDirectMemorySize è®¾ç½®ï¼Œé»˜è®¤å€¼ä¸ºæœ€å¤§å †ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ -Xmxã€‚å½“ç›´æŽ¥å†…å­˜è¾¾åˆ°æœ€å¤§å€¼çš„æ—¶å€™ï¼Œä¹Ÿä¼šè§¦å‘åžƒåœ¾å›žæ”¶ï¼Œå¦‚æžœåžƒåœ¾å›žæ”¶ä¸èƒ½æœ‰æ•ˆé‡Šæ”¾ç©ºé—´ï¼Œç›´æŽ¥å†…å­˜æº¢å‡ºä¾ç„¶ä¼šå¼•èµ·ç³»ç»Ÿçš„ OOMã€‚ ä¸€èˆ¬è€Œè¨€ç›´æŽ¥å†…å­˜åœ¨è®¿é—®è¯»å†™ä¸Šç›´æŽ¥å†…å­˜æœ‰è¾ƒå¤§ä¼˜åŠ¿ï¼ˆé€Ÿåº¦è¾ƒå¿«ï¼‰ï¼Œä½†æ˜¯åœ¨å†…å­˜ç©ºé—´ç”³è¯·çš„æ—¶å€™ï¼Œç›´æŽ¥å†…å­˜æ¯«æ— ä¼˜åŠ¿è€Œè¨€ã€‚ 4ã€RSetå…¨ç§°æ˜¯Remembered Setï¼Œæ˜¯è¾…åŠ©GCè¿‡ç¨‹çš„ä¸€ç§ç»“æž„ï¼Œå…¸åž‹çš„ç©ºé—´æ¢æ—¶é—´å·¥å…·ï¼Œå’ŒCard Tableæœ‰äº›ç±»ä¼¼ã€‚G1çš„RSetæ˜¯åœ¨Card Tableçš„åŸºç¡€ä¸Šå®žçŽ°çš„ï¼šæ¯ä¸ªRegionä¼šè®°å½•ä¸‹åˆ«çš„Regionæœ‰æŒ‡å‘è‡ªå·±çš„æŒ‡é’ˆï¼Œå¹¶æ ‡è®°è¿™äº›æŒ‡é’ˆåˆ†åˆ«åœ¨å“ªäº›Cardçš„èŒƒå›´å†…ã€‚è¿™ä¸ªRSetå…¶å®žæ˜¯ä¸€ä¸ªHash Tableï¼ŒKeyæ˜¯åˆ«çš„Regionçš„èµ·å§‹åœ°å€ï¼ŒValueæ˜¯ä¸€ä¸ªé›†åˆï¼Œé‡Œé¢çš„å…ƒç´ æ˜¯Card Tableçš„Indexã€‚ RSetç©¶ç«Ÿæ˜¯æ€Žä¹ˆè¾…åŠ©GCçš„å‘¢ï¼Ÿ åœ¨åšYGCçš„æ—¶å€™ï¼Œåªéœ€è¦é€‰å®šyoung generation regionçš„RSetä½œä¸ºæ ¹é›†ï¼Œè¿™äº›RSetè®°å½•äº†old-&gt;youngçš„è·¨ä»£å¼•ç”¨ï¼Œé¿å…äº†æ‰«ææ•´ä¸ªold generationã€‚è€Œmixed gcçš„æ—¶å€™ï¼Œold generationä¸­è®°å½•äº†old-&gt;oldçš„RSetï¼Œyoung-&gt;oldçš„å¼•ç”¨ç”±æ‰«æå…¨éƒ¨young generation regionå¾—åˆ°ï¼Œè¿™æ ·ä¹Ÿä¸ç”¨æ‰«æå…¨éƒ¨old generation regionã€‚æ‰€ä»¥RSetçš„å¼•å…¥å¤§å¤§å‡å°‘äº†GCçš„å·¥ä½œé‡ã€‚ ä¹ã€JDK 12ä¸­G1çš„æ–°ç‰¹æ€§1ã€å¯ä¸­æ–­ mixed GCå¦‚æžœ Mixed GC çš„ G1 å­˜åœ¨è¶…å‡ºæš‚åœç›®æ ‡çš„å¯èƒ½æ€§ï¼Œåˆ™ä½¿å…¶å¯è¢«ä¸­æ­¢ã€‚ 2ã€G1æœªä½¿ç”¨åˆ†é…å†…å­˜å³æ—¶è¿”å›žå¢žå¼º G1åžƒåœ¾æ”¶é›†å™¨ï¼Œä»¥ä¾¿åœ¨ç©ºé—²æ—¶è‡ªåŠ¨å°† Java å †å†…å­˜è¿”å›žç»™æ“ä½œç³»ç»Ÿã€‚ åã€GC å‘å±•è¶‹åŠ¿å…¶å®žå¯ä»¥çœ‹åˆ°Java åžƒåœ¾å›žæ”¶å™¨çš„è¶‹åŠ¿ï¼Œå°±æ˜¯åœ¨å¤§å†…å­˜å †çš„å‰æä¸‹å°½ GC å¯èƒ½çš„é™ä½Žå¯¹åº”ç”¨ç¨‹åºçš„å½±å“ï¼›ä»Ž CMS çš„åˆ†é˜¶æ®µå¢žé‡æ ‡è®°ï¼Œåˆ° G1 é€šè¿‡ SATB ç®—æ³•æ”¹æ­£ remark é˜¶æ®µçš„ Stop The World çš„å½±å“ï¼Œå†åˆ° ZGC/C4ç”šè‡³åœ¨æ ‡è®°é˜¶æ®µæ— éœ€ Stop The Worldï¼ŒèŽ«ä¸å¦‚æ­¤ã€‚ åä¸€ã€ç»“å°¾æŽ¨èå‡ ç§å­¦ä¹ è¿™ç§GCçš„æ–¹å¼ï¼š çœ‹JEPï¼ˆJDK Enhancement Proposalï¼‰çŸ¥é“å®ƒçš„æ¥é¾™åŽ»è„‰ã€‚ çœ‹ç›¸åº”ç®—æ³•çš„paperï¼ˆä¹‹å‰çœ‹Shenandoah GC Paperçš„æ—¶å€™ï¼Œå°±æœ‰ä¸€ç§æ”¶èŽ·å¾ˆå¤§çš„æ„Ÿè§‰ï¼Œå› ä¸ºShenandoah GCçš„å¤„ç†æ–¹å¼ï¼Œä»‹äºŽG1è·ŸZGCä¹‹é—´ï¼Œæ‰€ä»¥çœ‹äº†Shenandoah GC Paperæ„Ÿè§‰å¯¹äºŽG1ã€ZGCçš„ç†è§£ä¹Ÿæ›´åŠ æ·±å…¥äº†ï¼‰ã€‚ ä¼šåœ¨æ–‡ç« ç»“æŸï¼Œè¡¥å……ä¸ŠJEPå®˜ç½‘åœ°å€è·Ÿæˆ‘æ”¶é›†çš„ä¸€äº›GCèµ„æ–™ï¼ˆåŒ…å«éƒ¨åˆ†paperï¼‰githubåœ°å€ã€‚ è¡¥ä¸€ä¸ªæˆ‘è‡ªå·±å½’çº³çš„GCå›¾ï¼š å„ç§GCç®—æ³•éƒ½æ˜¯å›´ç»•ç€ï¼Œå›¾ä¸­å†…å®¹å±•å¼€çš„ï¼Œåªæ˜¯å„è‡ªçš„å¤„ç†æ–¹å¼ä¸åŒè€Œå·²ã€‚ èµ„æ–™æŽ¨èï¼š 1ã€GCç®—æ³•åŠpaper https://github.com/jiankunking/books-recommendation/tree/master/GC 2ã€Javaç›¸å…³ä¹¦ç±æŽ¨è https://github.com/jiankunking/books-recommendation/tree/master/Java å‚è€ƒæ–‡çŒ® 1ã€å®žæˆ˜JAVAè™šæ‹Ÿæœº JVMæ•…éšœè¯Šæ–­ä¸Žæ€§èƒ½ä¼˜åŒ– 2ã€jeps 3ã€å…¶å®ƒ https://www.oracle.com/technetwork/articles/java/g1gc-1984535.html https://plumbr.io/handbook/gc-tuning-in-practice/other-examples/humongous-allocations]]></content>
      <categories>
        <category>GC</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>GC</tag>
        <tag>G1</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SOFAMosn å¦‚ä½•æé«˜ GoLang çš„è½¬å‘æ€§èƒ½]]></title>
    <url>%2Fsofamosn-golang-performance.html</url>
    <content type="text"><![CDATA[é€šè¿‡SOFAMosnäº†è§£goroutineåªèƒ½åœ¨ä¸€å®šå¹¶å‘é‡çº§ä¸Šé™ä½Žå¹¶å‘ç¼–ç¨‹çš„éš¾åº¦(goroutineå†…å­˜å ç”¨2kb+)é«˜å¹¶å‘çš„åœºæ™¯è¿˜æ˜¯NIOæ¯”è¾ƒé€‚åˆ GoLang çš„è½¬å‘æ€§èƒ½æ¯”èµ· C++ è‚¯å®šæ˜¯ç¨æœ‰é€Šè‰²çš„ï¼Œä¸ºäº†å°½å¯èƒ½çš„æé«˜ MOSN çš„è½¬å‘æ€§èƒ½ï¼Œæˆ‘ä»¬åœ¨çº¿ç¨‹æ¨¡åž‹ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œå½“å‰ MOSN æ”¯æŒä¸¤ç§çº¿ç¨‹æ¨¡åž‹ï¼Œç”¨æˆ·å¯æ ¹æ®åœºæ™¯é€‰æ‹©å¼€å¯é€‚ç”¨çš„æ¨¡åž‹ã€‚ æ¨¡åž‹ä¸€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä½¿ç”¨ GoLang é»˜è®¤çš„ epoll æœºåˆ¶ï¼Œå¯¹æ¯ä¸ªè¿žæŽ¥åˆ†é…ç‹¬ç«‹çš„è¯»å†™åç¨‹è¿›è¡Œé˜»å¡žè¯»å†™æ“ä½œï¼Œproxy å±‚åšè½¬å‘æ—¶ï¼Œä½¿ç”¨å¸¸é©» worker åç¨‹æ± è´Ÿè´£å¤„ç† Stream Event æ­¤æ¨¡åž‹åœ¨ IO ä¸Šä½¿ç”¨ GoLang çš„è°ƒåº¦æœºåˆ¶ï¼Œé€‚ç”¨äºŽè¿žæŽ¥æ•°è¾ƒå°‘çš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼šmosn ä½œä¸º sidecarã€ä¸Ž client åŒæœºéƒ¨ç½²çš„åœºæ™¯ æ¨¡åž‹äºŒå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŸºäºŽ Netpoll é‡å†™ epoll æœºåˆ¶ï¼Œå°† IO å’Œ PROXY å‡è¿›è¡Œæ± åŒ–ï¼Œdownstream connection å°†è‡ªèº«çš„è¯»å†™äº‹ä»¶æ³¨å†Œåˆ° netpoll çš„ epoll/kqueue wait åç¨‹ï¼Œepoll/kqueue wait åç¨‹æŽ¥å—åˆ°å¯è¯»äº‹ä»¶ï¼Œè§¦å‘å›žè°ƒï¼Œä»Žåç¨‹æ± ä¸­æŒ‘é€‰ä¸€ä¸ªæ‰§è¡Œè¯»æ“ä½œã€‚ ä½¿ç”¨è‡ªå®šä¹‰ Netpoll IO æ± åŒ–æ“ä½œå¸¦æ¥çš„å¥½å¤„æ˜¯ï¼š å½“å¯è¯»äº‹ä»¶è§¦å‘æ—¶ï¼Œä»Žåç¨‹æ± ä¸­èŽ·å–ä¸€ä¸ª goroutine æ¥æ‰§è¡Œè¯»å¤„ç†ï¼Œè€Œä¸æ˜¯æ–°åˆ†é…ä¸€ä¸ª goroutineï¼Œä»¥æ­¤æ¥æŽ§åˆ¶é«˜å¹¶å‘ä¸‹çš„åç¨‹æ•°é‡ å½“æ”¶åˆ°é“¾æŽ¥å¯è¯»äº‹ä»¶æ—¶ï¼Œæ‰çœŸæ­£ä¸ºå…¶åˆ†é… read buffer ä»¥åŠç›¸åº”çš„æ‰§è¡Œåç¨‹ã€‚è¿™æ · GetBytes() å¯ä»¥é™ä½Žå› ä¸ºå¤§é‡ç©ºé—²é“¾æŽ¥åœºæ™¯å¯¼è‡´çš„é¢å¤–åç¨‹å’Œ read buffer å¼€é”€ æ­¤æ¨¡åž‹é€‚ç”¨äºŽè¿žæŽ¥æ•°è¾ƒå¤šã€å¯è¯»è¿žæŽ¥æ•°é‡å—é™çš„æƒ…å†µï¼Œä¾‹å¦‚ï¼šmosn ä½œä¸º api gateway çš„åœºæ™¯ æœ¬æ–‡æ•´ç†è‡ªSOFAMosnå®˜æ–¹æ–‡æ¡£]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>SOFAMosn</tag>
        <tag>Performance</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ReentrantReadWriteLockåŽŸç†è§£æž]]></title>
    <url>%2Fjava-reentrantreadwritelock.html</url>
    <content type="text"><![CDATA[Java JDK 11 ReentrantReadWriteLock åŽŸç†åˆ†æž 1ã€å‰è¨€å¸Œæœ›åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œå»ºè®®å…ˆçœ‹ä¸€ä¸‹ä»¥ä¸‹ä¸‰ç¯‡æ–‡ç« ï¼š 1ã€é¢è¯•å¿…å¤‡ï¼šJava AQS å®žçŽ°åŽŸç†ï¼ˆå›¾æ–‡ï¼‰åˆ†æž 2ã€é¢è¯•å¿…å¤‡ï¼šJava AQS Conditionçš„å®žçŽ°åˆ†æž 3ã€é¢è¯•å¿…å¤‡ï¼šJava volatileçš„å†…å­˜è¯­ä¹‰ä¸ŽAQSé”å†…å­˜å¯è§æ€§ è¯»å®Œäº†ä»¥ä¸Šä¸‰ç¯‡æ–‡ç« ï¼Œå…ˆçœ‹ä¸€ä¸‹ReentrantReadWriteLockçš„ä»£ç è·¯å¾„ï¼š 1package java.util.concurrent.locks; æ¥å…ˆçŒœä¸€ä¸‹ReentrantReadWriteLockä¼šå¦‚ä½•å®žçŽ°ï¼Ÿ éƒ½åœ¨java.util.concurrentåŒ…ä¸‹ï¼Œé‚£ä¹ˆå¯ä»¥æ˜Žç¡®ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯å…³äºŽé”çš„å®žçŽ°ï¼Œåº”è¯¥ç”¨çš„å°±æ˜¯AQSï¼Œé‚£ä¹ˆï¼Œè¯»é”ã€å†™é”ä¼šä¸ä¼šå¯¹åº”çš„å°±æ˜¯AQSä¸­çš„å…±äº«æ¨¡å¼ä¸Žç‹¬å æ¨¡å¼ï¼Ÿ 2ã€è¯»å†™é”ä½¿ç”¨åœºæ™¯è¯»æ˜¯å¤šäºŽå†™ï¼ˆæ¯”å¦‚cacheï¼‰ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¯»å†™é”çš„æ€§èƒ½éƒ½ä¼šæ¯”æŽ’å®ƒé”å¥½ï¼Œå› ä¸ºå¤§å¤šæ•°åœºæ™¯è¯»æ˜¯å¤šäºŽå†™çš„ã€‚åœ¨è¯»å¤šäºŽå†™çš„æƒ…å†µä¸‹ï¼Œè¯»å†™é”èƒ½å¤Ÿæä¾›æ¯”æŽ’å®ƒé”æ›´å¥½çš„å¹¶å‘æ€§å’Œåžåé‡ã€‚ 3ã€è¯»å†™é”æŽ¥å£ï¼šReadWriteLockä»£ç åœ°å€ï¼šReadWriteLock 123456789101112131415public interface ReadWriteLock &#123; /** * Returns the lock used for reading. * * @return the lock used for reading */ Lock readLock(); /** * Returns the lock used for writing. * * @return the lock used for writing */ Lock writeLock();&#125; 4ã€è¯»å†™é”çš„æŽ¥å£ä¸Žç¤ºä¾‹ ReadWriteLockä»…å®šä¹‰äº†èŽ·å–è¯»é”å’Œå†™é”çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå³readLock()æ–¹æ³•å’ŒwriteLock()æ–¹æ³•ï¼Œè€Œå…¶å®žçŽ°ï¼šReentrantReadWriteLockï¼Œé™¤äº†æŽ¥å£æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜æä¾›äº†ä¸€äº›ä¾¿äºŽå¤–ç•Œç›‘æŽ§å…¶å†…éƒ¨å·¥ä½œçŠ¶æ€çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä»¥åŠæè¿°å¦‚è¡¨æ‰€ç¤ºï¼š æŽ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªç¼“å­˜ç¤ºä¾‹è¯´æ˜Žè¯»å†™é”çš„ä½¿ç”¨æ–¹å¼ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940public class Cache &#123; static Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); static ReentrantReadWriteLock rwl = new ReentrantReadWriteLock(); static Lock r = rwl.readLock(); static Lock w = rwl.writeLock(); // èŽ·å–ä¸€ä¸ªkeyå¯¹åº”çš„value public static final Object get(String key) &#123; r.lock(); try &#123; return map.get(key); &#125; finally &#123; r.unlock(); &#125; &#125; // è®¾ç½®keyå¯¹åº”çš„valueï¼Œå¹¶è¿”å›žæ—§çš„value public static final Object put(String key, Object value) &#123; w.lock(); try &#123; return map.put(key, value); &#125; finally &#123; w.unlock(); &#125; &#125; // æ¸…ç©ºæ‰€æœ‰çš„å†…å®¹ public static final void clear() &#123; w.lock(); try &#123; map.clear(); &#125; finally &#123; w.unlock(); &#125; &#125;&#125; ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒCacheç»„åˆä¸€ä¸ªéžçº¿ç¨‹å®‰å…¨çš„HashMapä½œä¸ºç¼“å­˜çš„å®žçŽ°ï¼ŒåŒæ—¶ä½¿ç”¨è¯»å†™é”çš„è¯»é”å’Œå†™é”æ¥ä¿è¯Cacheæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨è¯»æ“ä½œget(String key)æ–¹æ³•ä¸­ï¼Œéœ€è¦èŽ·å–è¯»é”ï¼Œè¿™ä½¿å¾—å¹¶å‘è®¿é—®è¯¥æ–¹æ³•æ—¶ä¸ä¼šè¢«é˜»å¡žã€‚å†™æ“ä½œput(String key,Object value)æ–¹æ³•å’Œclear()æ–¹æ³•ï¼Œåœ¨æ›´æ–°HashMapæ—¶å¿…é¡»æå‰èŽ·å–å†™é”ï¼Œå½“èŽ·å–å†™é”åŽï¼Œå…¶ä»–çº¿ç¨‹å¯¹äºŽè¯»é”å’Œå†™é”çš„èŽ·å–å‡è¢«é˜»å¡žï¼Œè€Œåªæœ‰å†™é”è¢«é‡Šæ”¾ä¹‹åŽï¼Œå…¶ä»–è¯»å†™æ“ä½œæ‰èƒ½ç»§ç»­ã€‚Cacheä½¿ç”¨è¯»å†™é”æå‡è¯»æ“ä½œçš„å¹¶å‘æ€§ï¼Œä¹Ÿä¿è¯æ¯æ¬¡å†™æ“ä½œå¯¹æ‰€æœ‰çš„è¯»å†™æ“ä½œçš„å¯è§æ€§ï¼ŒåŒæ—¶ç®€åŒ–äº†ç¼–ç¨‹æ–¹å¼ã€‚ 5ã€ReentrantReadWriteLockè„‰ç»œæ¢³ç†ä»£ç åœ°å€ï¼šReentrantReadWriteLock å…ˆçœ‹ä¸€ä¸‹ç»§æ‰¿ç»“æž„ï¼š å†çœ‹ä¸€ä¸‹ä»£ç ç»“æž„ï¼š å›¾ä¸­å¯ä»¥çœ‹å‡ºReentrantReadWriteLockçš„å®žçŽ°è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæ‰€ä»¥æŽ¥ä¸‹æ¥ä¸»è¦åˆ†æžReentrantReadWriteLockå®žçŽ°å…³é”®ç‚¹ï¼ŒåŒ…æ‹¬ï¼š è¯»å†™çŠ¶æ€çš„è®¾è®¡ å†™é”çš„èŽ·å–ä¸Žé‡Šæ”¾ è¯»é”çš„èŽ·å–ä¸Žé‡Šæ”¾ é”é™çº§ 5.1 è¯»å†™çŠ¶æ€çš„è®¾è®¡è¯»å†™é”åŒæ ·ä¾èµ–è‡ªå®šä¹‰åŒæ­¥å™¨æ¥å®žçŽ°åŒæ­¥åŠŸèƒ½ï¼Œè€Œè¯»å†™çŠ¶æ€å°±æ˜¯å…¶åŒæ­¥å™¨çš„åŒæ­¥çŠ¶æ€ã€‚å›žæƒ³ReentrantLockä¸­è‡ªå®šä¹‰åŒæ­¥å™¨çš„å®žçŽ°ï¼ŒåŒæ­¥çŠ¶æ€è¡¨ç¤ºé”è¢«ä¸€ä¸ªçº¿ç¨‹é‡å¤èŽ·å–çš„æ¬¡æ•°ï¼Œè€Œè¯»å†™é”çš„è‡ªå®šä¹‰åŒæ­¥å™¨éœ€è¦åœ¨åŒæ­¥çŠ¶æ€ï¼ˆä¸€ä¸ªæ•´åž‹å˜é‡ï¼‰ä¸Šç»´æŠ¤å¤šä¸ªè¯»çº¿ç¨‹å’Œä¸€ä¸ªå†™çº¿ç¨‹çš„çŠ¶æ€ï¼Œä½¿å¾—è¯¥çŠ¶æ€çš„è®¾è®¡æˆä¸ºè¯»å†™é”å®žçŽ°çš„å…³é”®ã€‚ å¦‚æžœåœ¨ä¸€ä¸ªæ•´åž‹å˜é‡ä¸Šç»´æŠ¤å¤šç§çŠ¶æ€ï¼Œå°±ä¸€å®šéœ€è¦â€œæŒ‰ä½åˆ‡å‰²ä½¿ç”¨â€è¿™ä¸ªå˜é‡ï¼Œè¯»å†™é”å°†å˜é‡åˆ‡åˆ†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œé«˜16ä½è¡¨ç¤ºè¯»ï¼Œä½Ž16ä½è¡¨ç¤ºå†™ï¼Œåˆ’åˆ†æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤º: å½“å‰åŒæ­¥çŠ¶æ€è¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹å·²ç»èŽ·å–äº†å†™é”ï¼Œä¸”é‡è¿›å…¥äº†ä¸¤æ¬¡ï¼ŒåŒæ—¶ä¹Ÿè¿žç»­èŽ·å–äº†ä¸¤æ¬¡è¯»é”ã€‚è¯»å†™é”æ˜¯å¦‚ä½•è¿…é€Ÿç¡®å®šè¯»å’Œå†™å„è‡ªçš„çŠ¶æ€å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯é€šè¿‡ä½è¿ç®—ã€‚å‡è®¾å½“å‰åŒæ­¥çŠ¶æ€å€¼ä¸ºSï¼Œå†™çŠ¶æ€ç­‰äºŽS&amp;0x0000FFFFï¼ˆå°†é«˜16ä½å…¨éƒ¨æŠ¹åŽ»ï¼‰ï¼Œè¯»çŠ¶æ€ç­‰äºŽS&gt;&gt;&gt;16ï¼ˆæ— ç¬¦å·è¡¥0å³ç§»16ä½ï¼‰ã€‚å½“å†™çŠ¶æ€å¢žåŠ 1æ—¶ï¼Œç­‰äºŽS+1ï¼Œå½“è¯»çŠ¶æ€å¢žåŠ 1æ—¶ï¼Œç­‰äºŽS+(1&lt;&lt;16)ï¼Œä¹Ÿå°±æ˜¯S+0x00010000ã€‚ 1ã€0x0000FFFF=00000000000000001111111111111111ï¼ˆ16ä¸ª0 16ä¸ª1ï¼‰ 2ã€&gt;&gt;&gt;ï¼š æ— ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥0è¡¥é½ 3ã€0x00010000=10000000000000000ï¼ˆ1ä¸ª1 16ä¸ª0ï¼‰ æ ¹æ®çŠ¶æ€çš„åˆ’åˆ†èƒ½å¾—å‡ºä¸€ä¸ªæŽ¨è®ºï¼šSä¸ç­‰äºŽ0æ—¶ï¼Œå½“å†™çŠ¶æ€ï¼ˆS&amp;0x0000FFFFï¼‰ç­‰äºŽ0æ—¶ï¼Œåˆ™è¯»çŠ¶æ€ï¼ˆS&gt;&gt;&gt;16ï¼‰å¤§äºŽ0ï¼Œå³è¯»é”å·²è¢«èŽ·å–ã€‚ 5.2 å†™é”çš„èŽ·å–ä¸Žé‡Šæ”¾å†™é”æ˜¯ä¸€ä¸ªæ”¯æŒé‡è¿›å…¥çš„æŽ’å®ƒé”ã€‚å¦‚æžœå½“å‰çº¿ç¨‹å·²ç»èŽ·å–äº†å†™é”ï¼Œåˆ™å¢žåŠ å†™çŠ¶æ€ã€‚å¦‚æžœå½“å‰çº¿ç¨‹åœ¨èŽ·å–å†™é”æ—¶ï¼Œè¯»é”å·²ç»è¢«èŽ·å–ï¼ˆè¯»çŠ¶æ€ä¸ä¸º0ï¼‰æˆ–è€…è¯¥çº¿ç¨‹ä¸æ˜¯å·²ç»èŽ·å–å†™é”çš„çº¿ç¨‹ï¼Œåˆ™å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ŒèŽ·å–å†™é”çš„ä»£ç å¦‚ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031protected final boolean tryAcquire(int acquires) &#123; /* * Walkthrough: * 1. If read count nonzero or write count nonzero * and owner is a different thread, fail. * 2. If count would saturate, fail. (This can only * happen if count is already nonzero.) * 3. Otherwise, this thread is eligible for lock if * it is either a reentrant acquire or * queue policy allows it. If so, update state * and set owner. */ Thread current = Thread.currentThread(); int c = getState(); int w = exclusiveCount(c); if (c != 0) &#123; // å­˜åœ¨è¯»é”æˆ–è€…å½“å‰èŽ·å–çº¿ç¨‹ä¸æ˜¯å·²ç»èŽ·å–å†™é”çš„çº¿ç¨‹ if (w == 0 || current != getExclusiveOwnerThread()) return false; if (w + exclusiveCount(acquires) &gt; MAX_COUNT) throw new Error(&quot;Maximum lock count exceeded&quot;); // Reentrant acquire setState(c + acquires); return true; &#125; if (writerShouldBlock() || !compareAndSetState(c, c + acquires)) return false; setExclusiveOwnerThread(current); return true; &#125; è¯¥æ–¹æ³•é™¤äº†é‡å…¥æ¡ä»¶ï¼ˆå½“å‰çº¿ç¨‹ä¸ºèŽ·å–äº†å†™é”çš„çº¿ç¨‹ï¼‰ä¹‹å¤–ï¼Œå¢žåŠ äº†ä¸€ä¸ªè¯»é”æ˜¯å¦å­˜åœ¨çš„åˆ¤æ–­ã€‚å¦‚æžœå­˜åœ¨è¯»é”ï¼Œåˆ™å†™é”ä¸èƒ½è¢«èŽ·å–ï¼ŒåŽŸå› åœ¨äºŽï¼šè¯»å†™é”è¦ç¡®ä¿å†™é”çš„æ“ä½œå¯¹è¯»é”å¯è§ï¼Œå¦‚æžœå…è®¸è¯»é”åœ¨å·²è¢«èŽ·å–çš„æƒ…å†µä¸‹å¯¹å†™é”çš„èŽ·å–ï¼Œé‚£ä¹ˆæ­£åœ¨è¿è¡Œçš„å…¶ä»–è¯»çº¿ç¨‹å°±æ— æ³•æ„ŸçŸ¥åˆ°å½“å‰å†™çº¿ç¨‹çš„æ“ä½œã€‚å› æ­¤ï¼Œåªæœ‰ç­‰å¾…å…¶ä»–è¯»çº¿ç¨‹éƒ½é‡Šæ”¾äº†è¯»é”ï¼Œå†™é”æ‰èƒ½è¢«å½“å‰çº¿ç¨‹èŽ·å–ï¼Œè€Œå†™é”ä¸€æ—¦è¢«èŽ·å–ï¼Œåˆ™å…¶ä»–è¯»å†™çº¿ç¨‹çš„åŽç»­è®¿é—®å‡è¢«é˜»å¡žã€‚ å†™é”çš„é‡Šæ”¾ä¸ŽReentrantLockçš„é‡Šæ”¾è¿‡ç¨‹åŸºæœ¬ç±»ä¼¼ï¼Œæ¯æ¬¡é‡Šæ”¾å‡å‡å°‘å†™çŠ¶æ€ï¼Œå½“å†™çŠ¶æ€ä¸º0æ—¶è¡¨ç¤ºå†™é”å·²è¢«é‡Šæ”¾ï¼Œä»Žè€Œç­‰å¾…çš„è¯»å†™çº¿ç¨‹èƒ½å¤Ÿç»§ç»­è®¿é—®è¯»å†™é”ï¼ŒåŒæ—¶å‰æ¬¡å†™çº¿ç¨‹çš„ä¿®æ”¹å¯¹åŽç»­è¯»å†™çº¿ç¨‹å¯è§ã€‚ 5.3 è¯»é”çš„èŽ·å–ä¸Žé‡Šæ”¾è¯»é”æ˜¯ä¸€ä¸ªæ”¯æŒé‡è¿›å…¥çš„å…±äº«é”ï¼Œå®ƒèƒ½å¤Ÿè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶èŽ·å–ï¼Œåœ¨æ²¡æœ‰å…¶ä»–å†™çº¿ç¨‹è®¿é—®ï¼ˆæˆ–è€…å†™çŠ¶æ€ä¸º0ï¼‰æ—¶ï¼Œè¯»é”æ€»ä¼šè¢«æˆåŠŸåœ°èŽ·å–ï¼Œè€Œæ‰€åšçš„ä¹Ÿåªæ˜¯ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰å¢žåŠ è¯»çŠ¶æ€ã€‚å¦‚æžœå½“å‰çº¿ç¨‹å·²ç»èŽ·å–äº†è¯»é”ï¼Œåˆ™å¢žåŠ è¯»çŠ¶æ€ã€‚å¦‚æžœå½“å‰çº¿ç¨‹åœ¨èŽ·å–è¯»é”æ—¶ï¼Œå†™é”å·²è¢«å…¶ä»–çº¿ç¨‹èŽ·å–ï¼Œåˆ™è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚èŽ·å–è¯»é”çš„å®žçŽ°ä»ŽJava 5åˆ°Java 6å˜å¾—å¤æ‚è®¸å¤šï¼Œä¸»è¦åŽŸå› æ˜¯æ–°å¢žäº†ä¸€äº›åŠŸèƒ½ï¼Œä¾‹å¦‚getReadHoldCount()æ–¹æ³•ï¼Œä½œç”¨æ˜¯è¿”å›žå½“å‰çº¿ç¨‹èŽ·å–è¯»é”çš„æ¬¡æ•°ã€‚è¯»çŠ¶æ€æ˜¯æ‰€æœ‰çº¿ç¨‹èŽ·å–è¯»é”æ¬¡æ•°çš„æ€»å’Œï¼Œè€Œæ¯ä¸ªçº¿ç¨‹å„è‡ªèŽ·å–è¯»é”çš„æ¬¡æ•°åªèƒ½é€‰æ‹©ä¿å­˜åœ¨ThreadLocalä¸­ï¼Œç”±çº¿ç¨‹è‡ªèº«ç»´æŠ¤ï¼Œè¿™ä½¿èŽ·å–è¯»é”çš„å®žçŽ°å˜å¾—å¤æ‚ã€‚å› æ­¤ï¼Œè¿™é‡Œå°†èŽ·å–è¯»é”çš„ä»£ç åšäº†åˆ å‡ï¼Œä¿ç•™å¿…è¦çš„éƒ¨åˆ†ï¼Œå¦‚ä»£ç å¦‚ä¸‹ï¼š 123456789101112protected final int tryAcquireShared(int unused) &#123; for (;;) &#123; int c = getState(); int nextc = c + (1 &lt;&lt; 16); if (nextc &lt; c) throw new Error(&quot;Maximum lock count exceeded&quot;); if (exclusiveCount(c) != 0 &amp;&amp; owner != Thread.currentThread()) return -1; if (compareAndSetState(c, nextc)) return 1; &#125;&#125; åœ¨tryAcquireShared(int unused)æ–¹æ³•ä¸­ï¼Œå¦‚æžœå…¶ä»–çº¿ç¨‹å·²ç»èŽ·å–äº†å†™é”ï¼Œåˆ™å½“å‰çº¿ç¨‹èŽ·å–è¯»é”å¤±è´¥ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚å¦‚æžœå½“å‰çº¿ç¨‹èŽ·å–äº†å†™é”æˆ–è€…å†™é”æœªè¢«èŽ·å–ï¼Œåˆ™å½“å‰çº¿ç¨‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼Œä¾é CASä¿è¯ï¼‰å¢žåŠ è¯»çŠ¶æ€ï¼ŒæˆåŠŸèŽ·å–è¯»é”ã€‚ è¯»é”çš„æ¯æ¬¡é‡Šæ”¾ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼Œå¯èƒ½æœ‰å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶é‡Šæ”¾è¯»é”ï¼‰å‡å‡å°‘è¯»çŠ¶æ€ï¼Œå‡å°‘çš„å€¼æ˜¯ï¼ˆ1&lt;&lt;16ï¼‰ã€‚ 5.4 é”é™çº§é”é™çº§æŒ‡çš„æ˜¯å†™é”é™çº§æˆä¸ºè¯»é”ã€‚å¦‚æžœå½“å‰çº¿ç¨‹æ‹¥æœ‰å†™é”ï¼Œç„¶åŽå°†å…¶é‡Šæ”¾ï¼Œæœ€åŽå†èŽ·å–è¯»é”ï¼Œè¿™ç§åˆ†æ®µå®Œæˆçš„è¿‡ç¨‹ä¸èƒ½ç§°ä¹‹ä¸ºé”é™çº§ã€‚é”é™çº§æ˜¯æŒ‡æŠŠæŒä½ï¼ˆå½“å‰æ‹¥æœ‰çš„ï¼‰å†™é”ï¼Œå†èŽ·å–åˆ°è¯»é”ï¼ŒéšåŽé‡Šæ”¾ï¼ˆå…ˆå‰æ‹¥æœ‰çš„ï¼‰å†™é”çš„è¿‡ç¨‹ã€‚ æŽ¥ä¸‹æ¥çœ‹ä¸€ä¸ªé”é™çº§çš„ç¤ºä¾‹ã€‚å› ä¸ºæ•°æ®ä¸å¸¸å˜åŒ–ï¼Œæ‰€ä»¥å¤šä¸ªçº¿ç¨‹å¯ä»¥å¹¶å‘åœ°è¿›è¡Œæ•°æ®å¤„ç†ï¼Œå½“æ•°æ®å˜æ›´åŽï¼Œå¦‚æžœå½“å‰çº¿ç¨‹æ„ŸçŸ¥åˆ°æ•°æ®å˜åŒ–ï¼Œåˆ™è¿›è¡Œæ•°æ®çš„å‡†å¤‡å·¥ä½œï¼ŒåŒæ—¶å…¶ä»–å¤„ç†çº¿ç¨‹è¢«é˜»å¡žï¼Œç›´åˆ°å½“å‰çº¿ç¨‹å®Œæˆæ•°æ®çš„å‡†å¤‡å·¥ä½œï¼Œå¦‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516171819202122232425public void processData() &#123; readLock.lock(); if (!update) &#123; // å¿…é¡»å…ˆé‡Šæ”¾è¯»é” readLock.unlock(); // é”é™çº§ä»Žå†™é”èŽ·å–åˆ°å¼€å§‹ writeLock.lock(); try &#123; if (!update) &#123; // å‡†å¤‡æ•°æ®çš„æµç¨‹ï¼ˆç•¥ï¼‰ update = true; &#125; readLock.lock(); &#125; finally &#123; writeLock.unlock(); &#125; // é”é™çº§å®Œæˆï¼Œå†™é”é™çº§ä¸ºè¯»é” &#125; try &#123; // ä½¿ç”¨æ•°æ®çš„æµç¨‹ï¼ˆç•¥ï¼‰ &#125; finally &#123; readLock.unlock(); &#125; &#125; ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå½“æ•°æ®å‘ç”Ÿå˜æ›´åŽï¼Œupdateå˜é‡ï¼ˆå¸ƒå°”ç±»åž‹ä¸”volatileä¿®é¥°ï¼‰è¢«è®¾ç½®ä¸ºfalseï¼Œæ­¤æ—¶æ‰€æœ‰è®¿é—®processData()æ–¹æ³•çš„çº¿ç¨‹éƒ½èƒ½å¤Ÿæ„ŸçŸ¥åˆ°å˜åŒ–ï¼Œä½†åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸèŽ·å–åˆ°å†™é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šè¢«é˜»å¡žåœ¨è¯»é”å’Œå†™é”çš„lock()æ–¹æ³•ä¸Šã€‚å½“å‰çº¿ç¨‹èŽ·å–å†™é”å®Œæˆæ•°æ®å‡†å¤‡ä¹‹åŽï¼Œå†èŽ·å–è¯»é”ï¼ŒéšåŽé‡Šæ”¾å†™é”ï¼Œå®Œæˆé”é™çº§ã€‚ é”é™çº§ä¸­è¯»é”çš„èŽ·å–æ˜¯å¦å¿…è¦å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¿…è¦çš„ã€‚ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œå¦‚æžœå½“å‰çº¿ç¨‹ä¸èŽ·å–è¯»é”è€Œæ˜¯ç›´æŽ¥é‡Šæ”¾å†™é”ï¼Œå‡è®¾æ­¤åˆ»å¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆè®°ä½œçº¿ç¨‹Tï¼‰èŽ·å–äº†å†™é”å¹¶ä¿®æ”¹äº†æ•°æ®ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹æ— æ³•æ„ŸçŸ¥çº¿ç¨‹Tçš„æ•°æ®æ›´æ–°ã€‚å¦‚æžœå½“å‰çº¿ç¨‹èŽ·å–è¯»é”ï¼Œå³éµå¾ªé”é™çº§çš„æ­¥éª¤ï¼Œåˆ™çº¿ç¨‹Tå°†ä¼šè¢«é˜»å¡žï¼Œç›´åˆ°å½“å‰çº¿ç¨‹ä½¿ç”¨æ•°æ®å¹¶é‡Šæ”¾è¯»é”ä¹‹åŽï¼Œçº¿ç¨‹Tæ‰èƒ½èŽ·å–å†™é”è¿›è¡Œæ•°æ®æ›´æ–°ã€‚ RentrantReadWriteLockä¸æ”¯æŒé”å‡çº§ï¼ˆæŠŠæŒè¯»é”ã€èŽ·å–å†™é”ï¼Œæœ€åŽé‡Šæ”¾è¯»é”çš„è¿‡ç¨‹ï¼‰ã€‚ç›®çš„ä¹Ÿæ˜¯ä¿è¯æ•°æ®å¯è§æ€§ï¼Œå¦‚æžœè¯»é”å·²è¢«å¤šä¸ªçº¿ç¨‹èŽ·å–ï¼Œå…¶ä¸­ä»»æ„çº¿ç¨‹æˆåŠŸèŽ·å–äº†å†™é”å¹¶æ›´æ–°äº†æ•°æ®ï¼Œåˆ™å…¶æ›´æ–°å¯¹å…¶ä»–èŽ·å–åˆ°è¯»é”çš„çº¿ç¨‹æ˜¯ä¸å¯è§çš„ã€‚ 6ã€å°ç»“RentrantReadWriteLockçš„å…·ä½“æµç¨‹æ¢³ç†å®Œäº†ï¼Œå›žè¿‡å¤´æ¥æƒ³ä¸€ä¸‹å‰è¨€çš„é—®é¢˜ï¼Œå¥½åƒå¹¶æ²¡æœ‰å¾—åˆ°ç­”æ¡ˆï¼Œé‚£ä¹ˆæ¥åˆ°ReentrantReadWriteLockä»£ç ä¸­ï¼Œæ­¤å¤„ä¸»è¦çœ‹ä¸€ä¸‹è¯»é”çš„èŽ·å–ã€é‡Šæ”¾æ˜¯å¦å¯¹åº”AQSä¸­çš„å…±äº«æ¨¡å¼ã€‚ 6.1 è¯»é”çš„èŽ·å–ã€é‡Šæ”¾12345678public void lock() &#123; //çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯å°±æ˜Žç™½äº†ï¼Œæˆ‘ä»¬çš„çŒœæƒ³æ˜¯æ­£ç¡®çš„ sync.acquireShared(1); &#125; public void unlock() &#123; //çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯å°±æ˜Žç™½äº†ï¼Œæˆ‘ä»¬çš„çŒœæƒ³æ˜¯æ­£ç¡®çš„ sync.releaseShared(1); &#125; å…ˆæ¥çœ‹ä¸€ä¸‹ReadLockçš„å…·ä½“å®žçŽ°ï¼Œåœ¨ReentrantReadWriteLockåˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šåœ¨æž„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ReadLockã€WriteLockï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š 12345678public ReentrantReadWriteLock() &#123; this(false); &#125; public ReentrantReadWriteLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync(); readerLock = new ReadLock(this); writerLock = new WriteLock(this); &#125; ä»ŽReentrantReadWriteLockæž„é€ å‡½æ•°çš„ä»£ç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ReadLockåˆå§‹åŒ–çš„å‚æ•°æ˜¯ReentrantReadWriteLockï¼Œé‚£ä¹ˆReadLockéœ€è¦ReentrantReadWriteLockæ¥åšä»€ä¹ˆå‘¢ï¼Ÿ æ¥çœ‹ä¸€ä¸‹ReadLockï¼š 1234private final Sync sync; protected ReadLock(ReentrantReadWriteLock lock) &#123; sync = lock.sync; &#125; ä»ŽReadLockçš„æž„é€ å‡½æ•°ä¸­ï¼Œå¯ä»¥çœ‹å‡ºï¼ŒReadLockéœ€è¦èŽ·å–åˆ°Syncï¼Œé‚£ä¹ˆSyncæ˜¯è°ï¼Œåˆæ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿ å…¶å®žï¼Œå¦‚æžœçœ‹è¿‡JUCä¸‹é¢ä»£ç çš„è¯ï¼Œçœ‹åˆ°Syncï¼Œå°±æ˜Žç™½å®ƒåº”è¯¥å°±æ˜¯AQSçš„å®žçŽ°ç±»ï¼Œé€šè¿‡å®ƒæ¥å®žçŽ°ç›¸å…³é”çš„æ“ä½œã€‚ æ¥çœ‹ä¸€ä¸‹ä»£ç éªŒè¯ä¸€ä¸‹ï¼š 1234567/** * Synchronization implementation for ReentrantReadWriteLock. * Subclassed into fair and nonfair versions. */ abstract static class Sync extends AbstractQueuedSynchronizer &#123; //å…·ä½“ä»£ç ç•¥ &#125; çœ‹åˆ°è¿™é‡Œå¯ä»¥å¤§ä½“å¾—å‡ºè¿™ä¹ˆä¸€ä¸ªç»“æžœï¼šReadLockèŽ·å–é”çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡ReentrantReadWriteLock å†…éƒ¨Syncç±»æ¥èŽ·å–çš„å…±äº«é”ï¼Œä¹Ÿå°±æ˜¯è¯»é”çš„èŽ·å–æ˜¯å¯¹åº”AQSä¸­çš„å…±äº«æ¨¡å¼ã€‚ ç‚¹è¿› sync.acquireShared(1)æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯è°ƒç”¨Syncçš„çˆ¶ç±»AQSä¸­æ–¹æ³•ï¼š 1234public final void acquireShared(int arg) &#123; if (tryAcquireShared(arg) &lt; 0) doAcquireShared(arg); &#125; çœ‹åˆ°è¿™é‡Œï¼Œä¹Ÿå°±æ˜Žç™½ä¸ºå•¥AQSå­ç±»éœ€è¦é‡å†™ï¼š tryAcquire tryRelease tryReleaseShared isHeldExclusively ç­‰æ–¹æ³•äº†ã€‚ 7ã€å‚è€ƒèµ„æ–™æœ¬æ–‡ç¬¬4ã€5å°èŠ‚æ•´ç†è‡ªï¼šã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹]]></content>
      <categories>
        <category>JUC</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JUC</tag>
        <tag>AQS</tag>
        <tag>JDK</tag>
        <tag>ReentrantReadWriteLock</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java AQS Conditionçš„å®žçŽ°åˆ†æž]]></title>
    <url>%2Fjava-aqs-condition.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ•´ç†è‡ªã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ç¬¬äº”ç«  ä½œè€…ï¼šæ–¹è…¾é£ž é­é¹ ç¨‹æ™“æ˜Ž AQS:AbstractQueuedSynchronizer ConditionObjectæ˜¯åŒæ­¥å™¨AQSçš„å†…éƒ¨ç±»ï¼Œå› ä¸ºConditionçš„æ“ä½œéœ€è¦èŽ·å–ç›¸å…³è”çš„é”ï¼Œæ‰€ä»¥ä½œä¸ºåŒæ­¥å™¨çš„å†…éƒ¨ç±»ä¹Ÿè¾ƒä¸ºåˆç†ã€‚æ¯ä¸ªConditionå¯¹è±¡éƒ½åŒ…å«ç€ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆä»¥ä¸‹ç§°ä¸ºç­‰å¾…é˜Ÿåˆ—ï¼‰ï¼Œè¯¥é˜Ÿåˆ—æ˜¯Conditionå¯¹è±¡å®žçŽ°ç­‰å¾…/é€šçŸ¥åŠŸèƒ½çš„å…³é”®ã€‚ ä¸‹é¢å°†åˆ†æžConditionçš„å®žçŽ°ï¼Œä¸»è¦åŒ…æ‹¬ï¼šç­‰å¾…é˜Ÿåˆ—ã€ç­‰å¾…å’Œé€šçŸ¥ï¼Œä¸‹é¢æåˆ°çš„Conditionå¦‚æžœä¸åŠ è¯´æ˜Žå‡æŒ‡çš„æ˜¯ConditionObjectã€‚ 1ã€ç­‰å¾…é˜Ÿåˆ—ç­‰å¾…é˜Ÿåˆ—æ˜¯ä¸€ä¸ªFIFOçš„é˜Ÿåˆ—ï¼Œåœ¨é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†ä¸€ä¸ªçº¿ç¨‹å¼•ç”¨ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯åœ¨Conditionå¯¹è±¡ä¸Šç­‰å¾…çš„çº¿ç¨‹ï¼Œå¦‚æžœä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†Condition.await()æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°†ä¼šé‡Šæ”¾é”ã€æž„é€ æˆèŠ‚ç‚¹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚äº‹å®žä¸Šï¼ŒèŠ‚ç‚¹çš„å®šä¹‰å¤ç”¨äº†åŒæ­¥å™¨ä¸­èŠ‚ç‚¹çš„å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒæ­¥é˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—ä¸­èŠ‚ç‚¹ç±»åž‹éƒ½æ˜¯åŒæ­¥å™¨çš„é™æ€å†…éƒ¨ç±»AbstractQueuedSynchronizer.Nodeã€‚ ä¸€ä¸ªConditionåŒ…å«ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼ŒConditionæ‹¥æœ‰é¦–èŠ‚ç‚¹ï¼ˆfirstWaiterï¼‰å’Œå°¾èŠ‚ç‚¹ï¼ˆlastWaiterï¼‰ã€‚å½“å‰çº¿ç¨‹è°ƒç”¨Condition.await()æ–¹æ³•ï¼Œå°†ä¼šä»¥å½“å‰çº¿ç¨‹æž„é€ èŠ‚ç‚¹ï¼Œå¹¶å°†èŠ‚ç‚¹ä»Žå°¾éƒ¨åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œç­‰å¾…é˜Ÿåˆ—çš„åŸºæœ¬ç»“æž„å¦‚å›¾5-9æ‰€ç¤ºã€‚ å¦‚å›¾æ‰€ç¤ºï¼ŒConditionæ‹¥æœ‰é¦–å°¾èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œè€Œæ–°å¢žèŠ‚ç‚¹åªéœ€è¦å°†åŽŸæœ‰çš„å°¾èŠ‚ç‚¹nextWaiteræŒ‡å‘å®ƒï¼Œå¹¶ä¸”æ›´æ–°å°¾èŠ‚ç‚¹å³å¯ã€‚ä¸Šè¿°èŠ‚ç‚¹å¼•ç”¨æ›´æ–°çš„è¿‡ç¨‹å¹¶æ²¡æœ‰ä½¿ç”¨CASä¿è¯ï¼ŒåŽŸå› åœ¨äºŽè°ƒç”¨await()æ–¹æ³•çš„çº¿ç¨‹å¿…å®šæ˜¯èŽ·å–äº†é”çš„çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥è¿‡ç¨‹æ˜¯ç”±é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ã€‚ åœ¨Objectçš„ç›‘è§†å™¨æ¨¡åž‹ä¸Šï¼Œä¸€ä¸ªå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—ï¼Œè€Œå¹¶å‘åŒ…ä¸­çš„Lockï¼ˆæ›´ç¡®åˆ‡åœ°è¯´æ˜¯åŒæ­¥å™¨\ï¼‰æ‹¥æœ‰ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—å’Œå¤šä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå…¶å¯¹åº”å…³ç³»å¦‚å›¾5-10æ‰€ç¤ºã€‚ 2ã€ç­‰å¾…è°ƒç”¨Conditionçš„await()æ–¹æ³•ï¼ˆæˆ–è€…ä»¥awaitå¼€å¤´çš„æ–¹æ³•ï¼‰ï¼Œä¼šä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…é˜Ÿåˆ—å¹¶é‡Šæ”¾é”ï¼ŒåŒæ—¶çº¿ç¨‹çŠ¶æ€å˜ä¸ºç­‰å¾…çŠ¶æ€ã€‚å½“ä»Žawait()æ–¹æ³•è¿”å›žæ—¶ï¼Œå½“å‰çº¿ç¨‹ä¸€å®šèŽ·å–äº†Conditionç›¸å…³è”çš„é”ã€‚ å¦‚æžœä»Žé˜Ÿåˆ—ï¼ˆåŒæ­¥é˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—ï¼‰çš„è§’åº¦çœ‹await()æ–¹æ³•ï¼Œå½“è°ƒç”¨await()æ–¹æ³•æ—¶ï¼Œç›¸å½“äºŽåŒæ­¥é˜Ÿåˆ—çš„é¦–èŠ‚ç‚¹ï¼ˆèŽ·å–äº†é”çš„èŠ‚ç‚¹ï¼‰ç§»åŠ¨åˆ°Conditionçš„ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚ Conditionçš„await()æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314151617181920public final void await() throws InterruptedException &#123; if (Thread.interrupted()) throw new InterruptedException(); // å½“å‰çº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ— Node node = addConditionWaiter(); // é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯é‡Šæ”¾é” int savedState = fullyRelease(node); int interruptMode = 0; while (!isOnSyncQueue(node)) &#123; LockSupport.park(this); if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) break; &#125; if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) interruptMode = REINTERRUPT; if (node.nextWaiter != null) unlinkCancelledWaiters(); if (interruptMode != 0) reportInterruptAfterWait(interruptMode); &#125; è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹æˆåŠŸèŽ·å–äº†é”çš„çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯åŒæ­¥é˜Ÿåˆ—ä¸­çš„é¦–èŠ‚ç‚¹ï¼Œè¯¥æ–¹æ³•ä¼šå°†å½“å‰çº¿ç¨‹æž„é€ æˆèŠ‚ç‚¹å¹¶åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç„¶åŽé‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œå”¤é†’åŒæ­¥é˜Ÿåˆ—ä¸­çš„åŽç»§èŠ‚ç‚¹ï¼Œç„¶åŽå½“å‰çº¿ç¨‹ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚ å½“ç­‰å¾…é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹è¢«å”¤é†’ï¼Œåˆ™å”¤é†’èŠ‚ç‚¹çš„çº¿ç¨‹å¼€å§‹å°è¯•èŽ·å–åŒæ­¥çŠ¶æ€ã€‚å¦‚æžœä¸æ˜¯é€šè¿‡å…¶ä»–çº¿ç¨‹è°ƒç”¨Condition.signal()æ–¹æ³•å”¤é†’ï¼Œè€Œæ˜¯å¯¹ç­‰å¾…çº¿ç¨‹è¿›è¡Œä¸­æ–­ï¼Œåˆ™ä¼šæŠ›å‡ºInterruptedExceptionã€‚ å¦‚æžœä»Žé˜Ÿåˆ—çš„è§’åº¦åŽ»çœ‹ï¼Œå½“å‰çº¿ç¨‹åŠ å…¥Conditionçš„ç­‰å¾…é˜Ÿåˆ—ï¼Œè¯¥è¿‡ç¨‹å¦‚å›¾5-11ç¤ºã€‚ å¦‚å›¾æ‰€ç¤ºï¼ŒåŒæ­¥é˜Ÿåˆ—çš„é¦–èŠ‚ç‚¹å¹¶ä¸ä¼šç›´æŽ¥åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œè€Œæ˜¯é€šè¿‡addConditionWaiter()æ–¹æ³•æŠŠå½“å‰çº¿ç¨‹æž„é€ æˆä¸€ä¸ªæ–°çš„èŠ‚ç‚¹å¹¶å°†å…¶åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚ 3ã€é€šçŸ¥è°ƒç”¨Conditionçš„signal()æ–¹æ³•ï¼Œå°†ä¼šå”¤é†’åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…æ—¶é—´æœ€é•¿çš„èŠ‚ç‚¹ï¼ˆé¦–èŠ‚ç‚¹ï¼‰ï¼Œåœ¨å”¤é†’èŠ‚ç‚¹ä¹‹å‰ï¼Œä¼šå°†èŠ‚ç‚¹ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚ Conditionçš„signal()æ–¹æ³•ï¼Œå¦‚ä»£ç æ¸…å•5-23æ‰€ç¤ºã€‚ä»£ç æ¸…å•5-23 ConditionObjectçš„signalæ–¹æ³• 12345678public final void signal() &#123; //isHeldExclusively() AQS å­ç±»å®žçŽ° if (!isHeldExclusively()) throw new IllegalMonitorStateException(); Node first = firstWaiter; if (first != null) doSignal(first); &#125; è°ƒç”¨è¯¥æ–¹æ³•çš„å‰ç½®æ¡ä»¶æ˜¯å½“å‰çº¿ç¨‹å¿…é¡»èŽ·å–äº†é”ï¼Œå¯ä»¥çœ‹åˆ°signal()æ–¹æ³•è¿›è¡Œäº†isHeldExclusively()æ£€æŸ¥ï¼Œä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹å¿…é¡»æ˜¯èŽ·å–äº†é”çš„çº¿ç¨‹ã€‚æŽ¥ç€èŽ·å–ç­‰å¾…é˜Ÿåˆ—çš„é¦–èŠ‚ç‚¹ï¼Œå°†å…¶ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—å¹¶ä½¿ç”¨LockSupportå”¤é†’èŠ‚ç‚¹ä¸­çš„çº¿ç¨‹ã€‚ èŠ‚ç‚¹ä»Žç­‰å¾…é˜Ÿåˆ—ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—çš„è¿‡ç¨‹å¦‚å›¾5-12æ‰€ç¤ºã€‚ é€šè¿‡è°ƒç”¨åŒæ­¥å™¨çš„enq(Node node)æ–¹æ³•ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­çš„å¤´èŠ‚ç‚¹çº¿ç¨‹å®‰å…¨åœ°ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ã€‚å½“èŠ‚ç‚¹ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—åŽï¼Œå½“å‰çº¿ç¨‹å†ä½¿ç”¨LockSupportå”¤é†’è¯¥èŠ‚ç‚¹çš„çº¿ç¨‹ã€‚ è¢«å”¤é†’åŽçš„çº¿ç¨‹ï¼Œå°†ä»Žawait()æ–¹æ³•ä¸­çš„whileå¾ªçŽ¯ä¸­é€€å‡ºï¼ˆisOnSyncQueue(Node node)æ–¹æ³•è¿”å›žtrueï¼ŒèŠ‚ç‚¹å·²ç»åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ï¼‰ï¼Œè¿›è€Œè°ƒç”¨åŒæ­¥å™¨çš„acquireQueued()æ–¹æ³•åŠ å…¥åˆ°èŽ·å–åŒæ­¥çŠ¶æ€çš„ç«žäº‰ä¸­ã€‚ æˆåŠŸèŽ·å–åŒæ­¥çŠ¶æ€ï¼ˆæˆ–è€…è¯´é”ï¼‰ä¹‹åŽï¼Œè¢«å”¤é†’çš„çº¿ç¨‹å°†ä»Žå…ˆå‰è°ƒç”¨çš„await()æ–¹æ³•è¿”å›žï¼Œæ­¤æ—¶è¯¥çº¿ç¨‹å·²ç»æˆåŠŸåœ°èŽ·å–äº†é”ã€‚ Conditionçš„signalAll()æ–¹æ³•ï¼Œç›¸å½“äºŽå¯¹ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å‡æ‰§è¡Œä¸€æ¬¡signal()æ–¹æ³•ï¼Œæ•ˆæžœå°±æ˜¯å°†ç­‰å¾…é˜Ÿåˆ—ä¸­æ‰€æœ‰èŠ‚ç‚¹å…¨éƒ¨ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå¹¶å”¤é†’æ¯ä¸ªèŠ‚ç‚¹çš„çº¿ç¨‹ã€‚]]></content>
      <categories>
        <category>JUC</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JUC</tag>
        <tag>AQS</tag>
        <tag>JDK</tag>
        <tag>Condition</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL InnoDBå­˜å‚¨å¼•æ“Žï¼šå¤–é”®ä¸Žé”]]></title>
    <url>%2Fmysql-innodb-foreign-key-lock.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ•´ç†è‡ªï¼šã€ŠMySQLæŠ€æœ¯å†…å¹•:InnoDBå­˜å‚¨å¼•æ“Žã€‹ ç¬¬äºŒç‰ˆ ä½œè€…ï¼šå§œæ‰¿å°§ å‡ºç‰ˆæ—¶é—´ï¼š2013-05 å¤–é”®ä¸»è¦ç”¨äºŽå¼•ç”¨å®Œæ•´æ€§çš„çº¦æŸæ£€æŸ¥åœ¨InnoDBå­˜å‚¨å¼•æ“Žä¸­ï¼Œå¯¹äºŽä¸€ä¸ªå¤–é”®åˆ—ï¼Œå¦‚æžœæ²¡æœ‰æ˜¾å¼åœ°å¯¹è¿™ä¸ªåˆ—åŠ ç´¢å¼•ï¼ŒInnoDBå­˜å‚¨å¼•æ“Žä¼šè‡ªåŠ¨å¯¹å…¶åŠ ä¸€ä¸ªç´¢å¼•ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥é¿å…è¡¨é”ã€‚ è¿™æ¯”Oracleæ•°æ®åº“åšå¾—å¥½ï¼ŒOracleæ•°æ®åº“ä¸ä¼šè‡ªåŠ¨æ·»åŠ ç´¢å¼•ï¼Œç”¨æˆ·å¿…é¡»è‡ªå·±æ‰‹åŠ¨æ·»åŠ ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†Oracleæ•°æ®åº“ä¸­å¯èƒ½äº§ç”Ÿæ­»é”ã€‚ å¯¹äºŽå¤–é”®å€¼çš„æ’å…¥æˆ–æ›´æ–°ï¼Œé¦–å…ˆéœ€è¦æ£€æŸ¥çˆ¶è¡¨ä¸­çš„è®°å½•ï¼Œæ—¢SELECTçˆ¶è¡¨ã€‚ä½†æ˜¯å¯¹äºŽçˆ¶è¡¨çš„SELECTæ“ä½œï¼Œä¸æ˜¯ä½¿ç”¨ä¸€è‡´æ€§éžé”å®šè¯»çš„æ–¹å¼ï¼Œå› ä¸ºè¿™ä¼šå‘ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå› æ­¤è¿™æ—¶ä½¿ç”¨çš„æ˜¯SELECTâ€¦LOCK IN SHARE MODEæ–¹å¼ï¼Œå³ä¸»åŠ¨å¯¹çˆ¶è¡¨åŠ ä¸€ä¸ªSé”ã€‚å¦‚æžœè¿™æ—¶çˆ¶è¡¨ä¸Šå·²ç»è¿™æ ·åŠ Xé”ï¼Œå­è¡¨ä¸Šçš„æ“ä½œä¼šè¢«é˜»å¡žï¼Œå¦‚ä¸‹ï¼šåœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œä¸¤ä¸ªä¼šè¯ä¸­çš„äº‹åŠ¡éƒ½æ²¡æœ‰è¿›è¡ŒCOMMITæˆ–ROLLBACKæ“ä½œï¼Œè€Œä¼šè¯Bçš„æ“ä½œä¼šè¢«é˜»å¡žã€‚è¿™æ˜¯å› ä¸º idä¸º3çš„çˆ¶è¡¨åœ¨ä¼šè¯ Aä¸­å·²ç»åŠ äº†ä¸€ä¸ªXé”ï¼Œè€Œæ­¤æ—¶åœ¨ä¼šè¯ Bä¸­ç”¨æˆ·åˆéœ€è¦å¯¹çˆ¶è¡¨ä¸­ idä¸º3çš„è¡ŒåŠ ä¸€ä¸ª Sé”ï¼Œè¿™æ—¶ INSERTçš„æ“ä½œä¼šè¢«é˜»å¡žã€‚è®¾æƒ³å¦‚æžœè®¿é—®çˆ¶è¡¨æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ä¸€è‡´æ€§çš„éžé”å®šè¯»ï¼Œè¿™æ—¶Session Bä¼šè¯»åˆ°çˆ¶è¡¨æœ‰id=3çš„è®°å½•ï¼Œå¯ä»¥è¿›è¡Œæ’å…¥æ“ä½œã€‚ä½†æ˜¯å¦‚æžœä¼šè¯Aå¯¹äº‹åŠ¡æäº¤äº†ï¼Œåˆ™çˆ¶è¡¨ä¸­å°±ä¸å­˜åœ¨idä¸º3çš„è®°å½•ã€‚æ•°æ®åœ¨çˆ¶ã€å­è¡¨å°±ä¼šå­˜åœ¨ä¸ä¸€è‡´çš„æƒ…å†µã€‚]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>InnoDB</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL InnoDBå­˜å‚¨å¼•æ“Žï¼šè¡Œé”çš„3ç§ç®—æ³•]]></title>
    <url>%2Fmysql-innodb-row-lock-algorithm.html</url>
    <content type="text"><![CDATA[è¡Œé”çš„ä¸‰ç§ç®—æ³•InnoDBå­˜å‚¨å¼•æ“Žæœ‰3ç§è¡Œé”çš„ç®—æ³•ï¼Œå…¶åˆ†åˆ«æ˜¯ï¼š Record Lockï¼šå•ä¸ªè¡Œè®°å½•ä¸Šçš„èŒƒå›´ Gap Lockï¼šé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä½†ä¸åŒ…å«è®°å½•æœ¬èº« Next-Key Lockï¼šGap Lock + Record Lockï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº« Record Lockæ€»æ˜¯ä¼šé”ä½ç´¢å¼•è®°å½•ï¼Œå¦‚æžœInnoDBå­˜å‚¨å¼•æ“Žå»ºç«‹çš„æ—¶å€™æ²¡æœ‰è®¾ç½®ä»»ä½•ä¸€ä¸ªç´¢å¼•ï¼Œè¿™æ—¶InnoDBå­˜å‚¨å¼•æ“Žä¼šä½¿ç”¨éšå¼çš„ä¸»é”®æ¥è¿›è¡Œé”å®šã€‚ Next-Key Lockæ˜¯ç»“åˆäº†Gap Lockå’ŒRecord Lockçš„ä¸€ç§é”å®šç®—æ³•ï¼Œåœ¨Next-Key Lockç®—æ³•ä¸‹ï¼Œinnodbå¯¹äºŽè¡Œçš„æŸ¥è¯¢éƒ½æ˜¯é‡‡ç”¨è¿™ç§é”å®šç®—æ³•ã€‚ä¾‹å¦‚ä¸€ä¸ªç´¢å¼•æœ‰9,11,13,20è¿™4ä¸ªå€¼ï¼Œé‚£ä¹ˆè¯¥ç´¢å¼•å¯èƒ½è¢«Next-Key Lockingçš„èŒƒå›´ä¸ºï¼ˆå·¦å¼€å³é—­ ï¼‰ï¼š(- &amp;ï¼Œ9](9,11](13,20](20,+ &amp;) é‡‡ç”¨Next-Key Lockçš„é”å®šæŠ€æœ¯ç§°ä¸ºNext-Key Lockingã€‚è¿™ç§è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³å¹»è¯»ï¼ˆPhantom Problemï¼‰ã€‚åˆ©ç”¨è¿™ç§é”å®šæŠ€æœ¯ï¼Œé”å®šçš„ä¸æ˜¯å•ä¸ªå€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªèŒƒå›´ã€‚ å½“æŸ¥è¯¢çš„ç´¢å¼•å«æœ‰å”¯ä¸€å±žæ€§æ—¶ï¼Œinnodbå­˜å‚¨å¼•æ“Žä¼šå¯¹Next-Key Lockè¿›è¡Œä¼˜åŒ–ï¼Œå°†å…¶é™çº§ä¸ºRecord Lockï¼Œå³é”ä½ç´¢å¼•è®°å½•æœ¬èº«ï¼Œè€Œä¸å†æ˜¯èŒƒå›´ã€‚å¯¹äºŽå”¯ä¸€ç´¢å¼•ï¼Œå…¶åŠ ä¸Šçš„æ˜¯Record Lockï¼Œä»…é”ä½è®°å½•æœ¬èº«ã€‚ä½†ä¹Ÿæœ‰ç‰¹åˆ«æƒ…å†µï¼Œé‚£å°±æ˜¯å”¯ä¸€ç´¢å¼•ç”±å¤šä¸ªåˆ—ç»„æˆï¼Œè€ŒæŸ¥è¯¢ä»…æ˜¯æŸ¥æ‰¾å¤šä¸ªå”¯ä¸€ç´¢å¼•åˆ—ä¸­çš„å…¶ä¸­ä¸€ä¸ªï¼Œé‚£ä¹ˆåŠ é”çš„æƒ…å†µä¾ç„¶æ˜¯Next-key lockã€‚ 12345678910DROP TABLEIF EXISTS t;CREATE TABLE t (a INT PRIMARY KEY);INSERT INTO tVALUES (1), (2), (5); è¡¨tä¸­å…±æœ‰1ã€2ã€5ä¸‰ä¸ªå€¼ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåœ¨ä¼šè¯Aä¸­é¦–å…ˆå¯¹a=5è¿›è¡ŒXé”å®šã€‚è€Œç”±äºŽaæ˜¯ä¸»é”®ä¸”å”¯ä¸€ï¼Œå› æ­¤é”å®šçš„ä»…æ˜¯5è¿™ä¸ªå€¼ï¼Œè€Œä¸æ˜¯(2,5)è¿™ä¸ªèŒƒå›´ï¼Œè¿™æ ·åœ¨ä¼šè¯Bä¸­æ’å…¥å€¼4è€Œä¸ä¼šé˜»å¡žï¼Œå¯ä»¥ç«‹å³æ’å…¥å¹¶è¿”å›žã€‚å³é”å®šç”±Next-Key Lockç®—æ³•é™çº§ä¸ºäº†Record Lockï¼Œä»Žè€Œæé«˜åº”ç”¨çš„å¹¶å‘æ€§ã€‚æ­£å¦‚å‰é¢æ‰€ä»‹ç»çš„ï¼ŒNext-Keyé™çº§ä¸ºRecord Lockä»…åœ¨æŸ¥è¯¢çš„åˆ—æ˜¯å”¯ä¸€ç´¢å¼•çš„æƒ…å†µä¸‹ã€‚è‹¥æ˜¯è¾…åŠ©ç´¢å¼•ï¼Œåˆ™æƒ…å†µä¼šå®Œå…¨ä¸åŒã€‚åŒæ ·ï¼Œé¦–å…ˆæ ¹æ®å¦‚ä¸‹ä»£ç åˆ›å»ºæµ‹è¯•è¡¨zï¼š 1234567891011121314CREATE TABLE Z ( a INT, b INT, PRIMARY KEY (a), KEY (b));INSERT INTO ZVALUES (1, 1), (3, 1), (5, 3), (7, 6), (10, 8); è¡¨zçš„åˆ—bæ˜¯è¾…åŠ©ç´¢å¼•ï¼Œè‹¥åœ¨ä¼šè¯Aä¸­æ‰§è¡Œä¸‹é¢çš„SQLè¯­å¥ï¼š 1SELECT * FROM Z WHERE b=3 FOR UPDATE; å¾ˆæ˜Žæ˜¾ï¼Œè¿™æ—¶SQLè¯­å¥é€šè¿‡ç´¢å¼•åˆ—bè¿›è¡ŒæŸ¥è¯¢ï¼Œå› æ­¤å…¶ä½¿ç”¨ä¼ ç»Ÿçš„Next-Key LockingæŠ€æœ¯åŠ é”ï¼Œå¹¶ä¸”ç”±äºŽæœ‰ä¸¤ä¸ªç´¢å¼•ï¼Œå…¶éœ€è¦åˆ†åˆ«è¿›è¡Œé”å®šã€‚å¯¹äºŽèšé›†ç´¢å¼•ï¼Œå…¶ä»…å¯¹åˆ—aç­‰äºŽ5çš„ç´¢å¼•åŠ ä¸ŠRecord Lockã€‚è€Œå¯¹äºŽè¾…åŠ©ç´¢å¼•ï¼Œå…¶åŠ ä¸Šçš„æ˜¯Next-Key Lockingï¼Œé”å®šçš„èŒƒå›´æ˜¯(1,3),ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒInnoDBå­˜å‚¨å¼•æ“Žä¼šå¯¹è¾…åŠ©ç´¢å¼•ä¸‹ä¸€ä¸ªé”®å€¼åŠ ä¸Šgap lockï¼Œå³è¿˜æœ‰ä¸€ä¸ªè¾…åŠ©ç´¢å¼•èŒƒå›´ä¸º(3,6)çš„é”ã€‚ å› æ­¤ï¼Œè‹¥åœ¨æ–°ä¼šè¯Bä¸­è¿è¡Œä¸‹é¢çš„SQLè¯­å¥ï¼Œéƒ½ä¼šè¢«é˜»å¡žï¼š 123SELECT * FROM Z WHERE a=5 LOCK IN SHARE MODE;INSERT INTO Z SELECT 4,2;INSERT INTO Z SELECT 6,5; ç¬¬ä¸€ä¸ªSQLè¯­å¥ä¸èƒ½æ‰§è¡Œï¼Œå› ä¸ºåœ¨ä¼šè¯Aä¸­æ‰§è¡Œçš„SQLè¯­å¥å·²ç»èšé›†ç´¢å¼•ä¸­åˆ—a=5çš„å€¼åŠ ä¸ŠXé”ï¼Œå› æ­¤æ‰§è¡Œä¼šè¢«é˜»å¡žã€‚ç¬¬äºŒä¸ªSQLè¯­å¥ï¼Œä¸»é”®æ’å…¥4ï¼Œæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ’å…¥çš„è¾…åŠ©ç´¢å¼•å€¼2åœ¨é”å®šçš„èŒƒå›´ï¼ˆ1ï¼Œ3ï¼‰ä¸­å› æ­¤æ‰§è¡ŒåŒæ ·ä¼šè¢«é˜»å¡žã€‚ç¬¬ä¸‰ä¸ªSQLè¯­å¥ï¼Œæ’å…¥çš„ä¸»é”®6æ²¡æœ‰è¢«é”å®šï¼Œ5ä¹Ÿä¸åœ¨èŒƒå›´ï¼ˆ1ï¼Œ3ï¼‰ä¹‹é—´ã€‚ä½†æ’å…¥çš„å€¼5åœ¨å¦ä¸€ä¸ªé”å®šèŒƒå›´ï¼ˆ3ï¼Œ6ï¼‰ä¸­ï¼Œæ•…åŒæ ·éœ€è¦ç­‰å¾…ã€‚è€Œä¸‹é¢çš„SQLè¯­å¥ï¼Œä¸ä¼šè¢«é˜»å¡žï¼Œå¯ä»¥ç«‹å³æ‰§è¡Œï¼š 123INSERT INTO Z SELECT 8,6;INSERT INTO Z SEELCT 2,0;INSERT INTO Z SELECT 6,7; ä»Žä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒGap Lockçš„ä½œç”¨æ˜¯ä¸ºäº†é˜»æ­¢å¤šä¸ªäº‹åŠ¡å°†è®°å½•æ’å…¥åˆ°åŒä¸€ä¸ªèŒƒå›´å†…ï¼Œè€Œè¿™ä¼šå¯¼è‡´Phantom Problemé—®é¢˜çš„äº§ç”Ÿã€‚ ä¾‹å¦‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¼šè¯Aä¸­ç”¨æˆ·å·²ç»é”å®šäº†b=3çš„è®°å½•ã€‚è‹¥æ­¤æ—¶æ²¡æœ‰Gap Locké”å®šï¼ˆ3ï¼Œ6ï¼‰ï¼Œé‚£ä¹ˆç”¨æˆ·å¯ä»¥æ’å…¥ç´¢å¼•båˆ—ä¸º3çš„è®°å½•ï¼Œè¿™ä¼šå¯¼è‡´ä¼šè¯Aä¸­çš„ç”¨æˆ·å†æ¬¡æ‰§è¡ŒåŒæ ·æŸ¥è¯¢æ—¶ä¼šè¿”å›žä¸åŒçš„è®°å½•ï¼Œå¯¼è‡´Phantom Problemé—®é¢˜çš„äº§ç”Ÿã€‚ ç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥æ˜¾å¼åœ°å…³é—­Gap Lockï¼š å°†äº‹åŠ¡çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºREAD COMMITTED å°†å‚æ•°innodb_locks_unsafe_for_binlogè®¾ç½®ä¸º1 åœ¨ä¸Šè¿°çš„é…ç½®ä¸‹ï¼Œé™¤äº†å¤–é”®çº¦æŸå’Œå”¯ä¸€æ€§æ£€æŸ¥ä¾ç„¶éœ€è¦çš„Gap Lockï¼Œå…¶ä½™æƒ…å†µä»…ä½¿ç”¨Record Lockè¿›è¡Œé”å®šã€‚ä½†éœ€è¦ç‰¢è®°çš„æ˜¯ï¼Œä¸Šè¿°è®¾ç½®ç ´åäº†äº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œå¹¶ä¸”å¯¹äºŽreplicationï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸»ä»Žæ•°æ®çš„ä¸ä¸€è‡´ã€‚æ­¤å¤–ï¼Œä»Žæ€§èƒ½ä¸Šæ¥çœ‹ï¼ŒREAD COMMITTEDä¹Ÿä¸ä¼šä¼˜äºŽé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«READ REPEATABLEã€‚ åœ¨InnoDBå­˜å‚¨å¼•æ“Žä¸­ï¼Œå¯¹äºŽINSERTçš„æ“ä½œï¼Œå…¶ä¼šæ£€æŸ¥æ’å…¥è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•æ˜¯å¦è¢«é”å®šï¼Œè‹¥å·²è¢«é”å®šï¼Œåˆ™ä¸å…è®¸æŸ¥è¯¢ã€‚å¯¹äºŽä¸Šé¢çš„ä¾‹å­ï¼Œä¼šè¯Aå·²ç»é”å®šäº†è¡¨zä¸­b=3çš„è®°å½•ï¼Œå³å·²ç»é”å®šäº†ï¼ˆ1ï¼Œ3ï¼‰çš„èŒƒå›´ï¼Œè¿™æ—¶è‹¥åœ¨å…¶ä»–ä¼šè¯ä¸­è¿›è¡Œå¦‚ä¸‹çš„æ’å…¥åŒæ ·ä¼šå¯¼è‡´é˜»å¡žï¼š 1INSERT INTO Z SELECT 2,2; å› ä¸ºåœ¨è¾…åŠ©ç´¢å¼•åˆ—bä¸Šæ’å…¥å€¼ä¸º2çš„è®°å½•æ—¶ï¼Œä¼šç›‘æµ‹åˆ°ä¸‹ä¸€ä¸ªè®°å½•3å·²ç»è¢«ç´¢å¼•ã€‚è€Œå°†æ’å…¥ä¿®æ”¹ä¸ºå¦‚ä¸‹çš„å€¼ï¼Œå¯ä»¥ç«‹å³æ‰§è¡Œï¼š 1INSERT INTO Z SELECT 2,0; æœ€åŽå†æ¬¡æé†’çš„æ˜¯ï¼Œå¯¹äºŽå”¯ä¸€é”®å€¼çš„é”å®š,Next-Key Locké™çº§ä¸ºRecord Lockä»…å­˜åœ¨äºŽæŸ¥è¯¢æ‰€æœ‰çš„å”¯ä¸€ç´¢å¼•ä¸€åˆ—ã€‚è‹¥å”¯ä¸€ç´¢å¼•ç”±å¤šä¸ªåˆ—ç»„æˆï¼Œè€ŒæŸ¥è¯¢æ˜¯æŸ¥æ‰¾å¤šä¸ªå”¯ä¸€ç´¢å¼•åˆ—ä¸­çš„å…¶ä¸­ä¸€ä¸ªï¼Œé‚£ä¹ˆæŸ¥è¯¢å…¶å®žæ˜¯rangeç±»åž‹æŸ¥è¯¢ï¼Œè€Œä¸æ˜¯pointç±»åž‹æŸ¥è¯¢æ•…InnoDBå­˜å‚¨å¼•æ“Žä¾ç„¶ä½¿ç”¨Next-Key Lockè¿›è¡Œé”å®šã€‚ è§£å†³ Phantom Problemåœ¨é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œå³REPEATABLE READä¸‹ï¼ŒInnoDBå­˜å‚¨å¼•æ“Žé‡‡ç”¨Next-Key Lockingæœºåˆ¶æ¥é¿å…Phantom Problem (å¹»åƒé—®é¢˜ï¼‰ã€‚è¿™ç‚¹å¯èƒ½ä¸åŒäºŽä¸Žå…¶ä»–çš„æ•°æ®åº“ï¼Œå¦‚Oracleæ•°æ®åº“ï¼Œå› ä¸ºå…¶å¯èƒ½éœ€è¦åœ¨SERIALIZABLEçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹æ‰èƒ½è§£å†³ Phantom Problemã€‚ Phantom Problemæ˜¯æŒ‡åœ¨åŒä¸€äº‹åŠ¡ä¸‹ï¼Œè¿žç»­æ‰§è¡Œä¸¤æ¬¡åŒæ ·çš„SQLè¯­å¥å¯èƒ½å¯¼è‡´ä¸åŒçš„ç»“æžœï¼Œç¬¬äºŒæ¬¡çš„SQLè¯­å¥å¯èƒ½ä¼šè¿”å›žä¹‹å‰ä¸å­˜åœ¨çš„è¡Œã€‚ ä¸‹é¢å°†æ¼”ç¤ºè¿™ä¸ªä¾‹å­ï¼Œä½¿ç”¨å‰ä¸€å°èŠ‚æ‰€åˆ›å»ºçš„è¡¨tã€‚è¡¨tç”±1ã€2ã€5è¿™ä¸‰ä¸ªå€¼ç»„æˆï¼š 12345678910DROP TABLEIF EXISTS t;CREATE TABLE t (a INT PRIMARY KEY);INSERT INTO tVALUES (1), (2), (5); è‹¥è¿™æ—¶äº‹åŠ¡T1æ‰§è¡Œå¦‚ä¸‹çš„SQLè¯­å¥: 1SELECT * FROM t WHERE a&gt; 2 FOR UPDATE; æ³¨æ„è¿™æ—¶äº‹åŠ¡T1å¹¶æ²¡æœ‰è¿›è¡Œæäº¤æ“ä½œï¼Œä¸Šè¿°åº”è¯¥è¿”å›ž5è¿™ä¸ªç»“æžœã€‚è‹¥ä¸Žæ­¤åŒæ—¶,å¦ä¸€ä¸ªäº‹åŠ¡T2æ’å…¥äº† 4è¿™ä¸ªå€¼ï¼Œå¹¶ä¸”æ•°æ®åº“å…è®¸è¯¥æ“ä½œï¼Œé‚£ä¹ˆäº‹åŠ¡T1å†æ¬¡æ‰§è¡Œä¸Šè¿°SQLè¯­å¥ä¼šå¾—åˆ°ç»“æžœ4å’Œ5ã€‚è¿™ä¸Žç¬¬ä¸€æ¬¡å¾—åˆ°çš„ç»“æžœä¸åŒï¼Œè¿åäº†äº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œå³å½“å‰äº‹åŠ¡èƒ½å¤Ÿçœ‹åˆ°å…¶ä»–äº‹åŠ¡çš„ç»“æžœã€‚å…¶è¿‡ç¨‹å¦‚è¡¨6-13æ‰€ç¤ºï¼šInnoDBå­˜å‚¨å¼•æ“Žé‡‡ç”¨Next-Key Lockingçš„ç®—æ³•é¿å…Phantom Problemã€‚å¯¹äºŽä¸Šè¿°çš„SQLè¯­å¥SELECT * FROM t WHERE a&gt;2 FOR UPDATE,å…¶é”ä½çš„ä¸æ˜¯5è¿™å•ä¸ªå€¼ï¼Œè€Œæ˜¯å¯¹ï¼ˆ2, +ã€‡ã€‡)è¿™ä¸ªèŒƒå›´åŠ äº† Xé”ã€‚å› æ­¤ä»»ä½•å¯¹äºŽè¿™ä¸ªèŒƒå›´çš„æ’å…¥éƒ½æ˜¯ä¸è¢«å…è®¸çš„ï¼Œä»Žè€Œé¿å… Phantom Problemã€‚ InnoDBå­˜å‚¨å¼•æ“Žé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯REPEATABLE READ,åœ¨è¯¥éš”ç¦»çº§åˆ«ä¸‹,å…¶é‡‡ç”¨Next-Key Lockingçš„æ–¹å¼æ¥åŠ é”ã€‚è€Œåœ¨äº‹åŠ¡éš”ç¦»çº§åˆ«READ COMMITTEDä¸‹,å…¶ä»…é‡‡ç”¨Record Lockï¼Œå› æ­¤åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œä¼šè¯Aéœ€è¦å°†äº‹åŠ¡çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºREAD COMMITTEDã€‚ æ­¤å¤–ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡InnoDBå­˜å‚¨å¼•æ“Žçš„Next-Key Lockingæœºåˆ¶åœ¨åº”ç”¨å±‚é¢å®žçŽ°å”¯ä¸€æ€§çš„æ£€æŸ¥ã€‚ ä¾‹å¦‚ï¼š 1234SELECT * FROM table WHERE col=xxx LOCK IN SHARE MODE;If not found any row:# unique for insert valueINSERT INTO table VALUES (...); å¦‚æžœç”¨æˆ·é€šè¿‡ç´¢å¼•æŸ»è¯¢ä¸€ä¸ªå€¼ï¼Œå¹¶å¯¹è¯¥è¡ŒåŠ ä¸Šä¸€ä¸ªSLockï¼Œé‚£ä¹ˆå³ä½¿æŸ»è¯¢çš„å€¼ä¸åœ¨ï¼Œå…¶é”å®šçš„ä¹Ÿæ˜¯ä¸€ä¸ªèŒƒå›´ï¼Œå› æ­¤è‹¥æ²¡æœ‰è¿”å›žä»»ä½•è¡Œï¼Œé‚£ä¹ˆæ–°æ’äººçš„å€¼ä¸€å®šæ˜¯å”¯ä¸€çš„ã€‚ä¹Ÿè®¸æœ‰è¯»è€…ä¼šæœ‰ç–‘é—®ï¼Œå¦‚æžœåœ¨è¿›è¡Œç¬¬ä¸€æ­¥SELECT â€¢â€¢â€¢LOCK IN SHARE MODEæ“ä½œæ—¶ï¼Œæœ‰å¤šä¸ªäº‹åŠ¡å¹¶å‘æ“ä½œï¼Œé‚£ä¹ˆè¿™ç§å”¯ä¸€æ€§æ£€æŸ»æœºåˆ¶æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚å…¶å®žå¹¶ä¸ä¼šï¼Œå› ä¸ºè¿™æ—¶ä¼šå¯¼è‡´æ­»é”ï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡çš„æ’äººæ“ä½œä¼šæˆåŠŸï¼Œè€Œå…¶ä½™çš„äº‹åŠ¡ä¼šæŠ›å‡ºæ­»é”çš„é”™è¯¯ï¼Œå¦‚è¡¨6-14æ‰€ç¤ºã€‚]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>InnoDB</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL InnoDBå­˜å‚¨å¼•æ“Žï¼šåˆ†åŒºè¡¨]]></title>
    <url>%2Fmysql-innodb-partition-table.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ•´ç†è‡ªï¼šã€ŠMySQLæŠ€æœ¯å†…å¹•:InnoDBå­˜å‚¨å¼•æ“Žã€‹ ç¬¬äºŒç‰ˆ ä½œè€…ï¼šå§œæ‰¿å°§ å‡ºç‰ˆæ—¶é—´ï¼š2013-05 MySQLåˆ†åŒºè¡¨ä»‹ç»åˆ†åŒºæ˜¯ä¸€ç§è¡¨çš„è®¾è®¡æ¨¡å¼ï¼Œæ­£ç¡®çš„åˆ†åŒºå¯ä»¥æžå¤§åœ°æå‡æ•°æ®åº“çš„æŸ¥è¯¢æ•ˆçŽ‡ï¼Œå®Œæˆæ›´é«˜è´¨é‡çš„SQLç¼–ç¨‹ã€‚ä½†æ˜¯å¦‚æžœé”™è¯¯åœ°ä½¿ç”¨åˆ†åŒºï¼Œé‚£ä¹ˆåˆ†åŒºå¯èƒ½å¸¦æ¥æ¯ç­æ€§çš„çš„ç»“æžœã€‚ åˆ†åŒºåŠŸèƒ½å¹¶ä¸æ˜¯åœ¨å­˜å‚¨å¼•æ“Žå±‚å®Œæˆçš„ï¼Œå› æ­¤ä¸åªæœ‰InnoDBå­˜å‚¨å¼•æ“Žæ”¯æŒåˆ†åŒºï¼Œå¸¸è§çš„å­˜å‚¨å¼•æ“ŽMyISAMã€NDBç­‰éƒ½æ”¯æŒåˆ†åŒºã€‚ ä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„å­˜å‚¨å¼•æ“Žéƒ½æ”¯æŒï¼Œå¦‚CSVã€FEDORATEDã€MERGEç­‰å°±ä¸æ”¯æŒåˆ†åŒºã€‚åœ¨ä½¿ç”¨æ­¤åˆ†åŒºåŠŸèƒ½å‰ï¼Œåº”è¯¥å¯¹é€‰æ‹©çš„å­˜å‚¨å¼•æ“Žå¯¹åˆ†åŒºçš„æ”¯æŒæœ‰æ‰€äº†è§£ã€‚ MySQLæ•°æ®åº“åœ¨5.1ç‰ˆæœ¬æ—¶æ·»åŠ äº†å¯¹åˆ†åŒºçš„æ”¯æŒï¼Œåˆ†åŒºçš„è¿‡ç¨‹æ˜¯å°†ä¸€ä¸ªè¡¨æˆ–ç´¢å¼•åˆ†è§£ä¸ºå¤šä¸ªæ›´å°ã€æ›´å¯ç®¡ç†çš„éƒ¨åˆ†ã€‚å°±è®¿é—®æ•°æ®åº“çš„åº”ç”¨è€Œè¨€ï¼Œä»Žé€»è¾‘ä¸Šè®²ï¼Œåªæœ‰ä¸€ä¸ªè¡¨æˆ–ä¸€ä¸ªç´¢å¼•ï¼Œä½†æ˜¯åœ¨ç‰©ç†ä¸Šè¿™ä¸ªè¡¨æˆ–ç´¢å¼•å¯èƒ½ç”±æ•°åä¸ªç‰©ç†åˆ†åŒºç»„æˆã€‚æ¯ä¸ªåˆ†åŒºéƒ½æ˜¯ç‹¬ç«‹çš„å¯¹è±¡ï¼Œå¯ä»¥ç‹¬è‡ªå¤„ç†ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªæ›´å¤§å¯¹è±¡çš„ä¸€éƒ¨åˆ†è¿›è¡Œå¤„ç†ã€‚ MySQLæ•°æ®åº“æ”¯æŒçš„åˆ†åŒºç±»åž‹ä¸ºæ°´å¹³åˆ†åŒºï¼ˆæŒ‡å°†åŒä¸€ä¸ªè¡¨ä¸­ä¸åŒè¡Œçš„è®°å½•åˆ†é…åˆ°ä¸åŒçš„ç‰©ç†æ–‡ä»¶ä¸­ï¼‰ï¼Œå¹¶ä¸æ”¯æŒåž‚ç›´åˆ†åŒºï¼ˆæŒ‡å°†åŒä¸€è¡¨ä¸­ä¸åŒåˆ—çš„è®°å½•åˆ†é…åˆ°ä¸åŒçš„ç‰©ç†æ–‡ä»¶ä¸­ï¼‰ã€‚æ­¤å¤–ï¼ŒMySQLæ•°æ®åº“çš„åˆ†åŒºæ˜¯å±€éƒ¨åˆ†åŒºç´¢å¼•ï¼Œä¸€ä¸ªåˆ†åŒºä¸­æ—¢å­˜æ”¾äº†æ•°æ®åˆå­˜æ”¾äº†ç´¢å¼•ã€‚è€Œå…¨å±€åˆ†åŒºæ˜¯æŒ‡ï¼Œæ•°æ®å­˜æ”¾åœ¨å„ä¸ªåˆ†åŒºä¸­ï¼Œä½†æ˜¯æ‰€æœ‰æ•°æ®çš„ç´¢å¼•æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚ç›®å‰ï¼ŒMySQLæ•°æ®åº“è¿˜ä¸æ”¯æŒå…¨å±€åˆ†åŒºã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰æ•°æ®åº“æ˜¯å¦å¯ç”¨äº†åˆ†åŒºåŠŸèƒ½ï¼š 123456789101112131415mysql&gt; show global variables like &apos;%partition%&apos;;+-------------------+-------+| Variable_name | Value |+-------------------+-------+| have_partitioning | YES |+-------------------+-------+1 row in set (0.04 sec) mysql&gt; show plugins*************************** 43. row *************************** Name: partition Status: ACTIVE Type: STORAGE ENGINELibrary: NULLLicense: GPL æœ‰æ—¶å€™å¯èƒ½ä¼šæœ‰è¿™ä¹ˆä¸€ç§è¯¯åŒºï¼Œåªè¦å¯ç”¨äº†åˆ†åŒºï¼Œæ•°æ®åº“å°±ä¼šè¿è¡Œçš„æ›´å¿«ã€‚è¿™ä¸ªç»“è®ºç»“è®ºæ˜¯å­˜åœ¨å¾ˆå¤šé—®é¢˜çš„ï¼Œå°±ç»éªŒæ¥çœ‹ï¼Œåˆ†åŒºå¯èƒ½ä¼šç»™æŸäº›SQLè¯­å¥æ€§èƒ½å¸¦æ¥æé«˜ï¼Œä½†æ˜¯åˆ†åŒºä¸»è¦ç”¨äºŽæ•°æ®åº“é«˜å¯ç”¨æ€§çš„ç®¡ç†ã€‚åœ¨OLTPåº”ç”¨ä¸­ï¼Œå¯¹äºŽåˆ†åŒºçš„ä½¿ç”¨åº”è¯¥éžå¸¸å°å¿ƒï¼Œæ€»ä¹‹ï¼Œå¦‚æžœåªæ˜¯ä¸€å‘³åœ°ä½¿ç”¨åˆ†åŒºï¼Œè€Œä¸ç†è§£åˆ†åŒºæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä¹Ÿä¸æ¸…æ¥šä½ çš„åº”ç”¨å¦‚ä½•ä½¿ç”¨åˆ†åŒºï¼Œé‚£ä¹ˆåˆ†åŒºæžæœ‰å¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢çš„å½±å“ã€‚ MySQLåˆ†åŒºç±»åž‹RANGEåˆ†åŒºRANGEåˆ†åŒºï¼Œæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§åˆ†åŒºç±»åž‹ï¼ŒåŸºäºŽå±žäºŽä¸€ä¸ªç»™å®šè¿žç»­åŒºé—´çš„åˆ—å€¼ï¼ŒæŠŠå¤šè¡Œåˆ†é…ç»™åˆ†åŒºã€‚è¿™äº›åŒºé—´è¦è¿žç»­ä¸”ä¸èƒ½ç›¸äº’é‡å ï¼Œä½¿ç”¨VALUES LESS THANæ“ä½œç¬¦æ¥è¿›è¡Œå®šä¹‰ã€‚ LISTåˆ†åŒºLISTåˆ†åŒºå’ŒRANGEåˆ†åŒºç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºŽLISTåˆ†åŒºæ˜¯åŸºäºŽåˆ—å€¼åŒ¹é…ä¸€ä¸ªç¦»æ•£å€¼é›†åˆä¸­çš„æŸä¸ªå€¼æ¥è¿›è¡Œé€‰æ‹©ï¼Œè€Œéžè¿žç»­çš„ã€‚ LISTåˆ†åŒºé€šè¿‡ä½¿ç”¨â€œPARTITION BY LIST(expr)â€æ¥å®žçŽ°ï¼Œå…¶ä¸­â€œexprâ€ æ˜¯æŸåˆ—å€¼æˆ–ä¸€ä¸ªåŸºäºŽæŸä¸ªåˆ—å€¼ã€å¹¶è¿”å›žä¸€ä¸ªæ•´æ•°å€¼çš„è¡¨è¾¾å¼ï¼Œç„¶åŽé€šè¿‡â€œVALUES IN (value_list)â€çš„æ–¹å¼æ¥å®šä¹‰æ¯ä¸ªåˆ†åŒºï¼Œå…¶ä¸­â€œvalue_listâ€æ˜¯ä¸€ä¸ªé€šè¿‡é€—å·åˆ†éš”çš„æ•´æ•°åˆ—è¡¨ã€‚ HASHåˆ†åŒºHASHåˆ†åŒºçš„ç›®çš„æ˜¯å°†æ•°æ®å‡åŒ€åœ°åˆ†å¸ƒåˆ°é¢„å…ˆå®šä¹‰çš„å„ä¸ªåˆ†åŒºä¸­ï¼Œä¿è¯å„åˆ†åŒºçš„æ•°æ®é‡å¤§è‡´éƒ½æ˜¯ä¸€æ ·çš„ã€‚åœ¨RANGEå’ŒLISTåˆ†åŒºä¸­ï¼Œå¿…é¡»æ˜Žç¡®æŒ‡å®šä¸€ä¸ªç»™å®šçš„åˆ—å€¼æˆ–åˆ—å€¼é›†åˆåº”è¯¥ä¿å­˜åœ¨å“ªä¸ªåˆ†åŒºä¸­ï¼›è€Œåœ¨HASHåˆ†åŒºä¸­ï¼ŒMySQLè‡ªåŠ¨å®Œæˆè¿™äº›å·¥ä½œï¼Œç”¨æˆ·æ‰€è¦åšçš„åªæ˜¯åŸºäºŽå°†è¦è¿›è¡Œå“ˆå¸Œåˆ†åŒºçš„åˆ—å€¼æŒ‡å®šä¸€ä¸ªåˆ—å€¼æˆ–è¡¨è¾¾å¼ï¼Œä»¥åŠæŒ‡å®šè¢«åˆ†åŒºçš„è¡¨å°†è¦è¢«åˆ†éš”æˆçš„åˆ†åŒºæ•°é‡ã€‚ è¦ä½¿ç”¨HASHåˆ†åŒºæ¥åˆ†å‰²ä¸€ä¸ªè¡¨ï¼Œè¦åœ¨CREATE TABLE è¯­å¥ä¸Šæ·»åŠ ä¸€ä¸ªâ€œPARTITION BY HASH (expr)â€å­å¥ï¼Œå…¶ä¸­â€œexprâ€æ˜¯ä¸€ä¸ªè¿”å›žä¸€ä¸ªæ•´æ•°çš„è¡¨è¾¾å¼ã€‚å®ƒå¯ä»¥ä»…ä»…æ˜¯å­—æ®µç±»åž‹ä¸ºMySQL æ•´åž‹çš„ä¸€åˆ—çš„åå­—ã€‚æ­¤å¤–ï¼Œä½ å¾ˆå¯èƒ½éœ€è¦åœ¨åŽé¢å†æ·»åŠ ä¸€ä¸ªâ€œPARTITIONS numâ€å­å¥ï¼Œå…¶ä¸­numæ˜¯ä¸€ä¸ªéžè´Ÿçš„æ•´æ•°ï¼Œå®ƒè¡¨ç¤ºè¡¨å°†è¦è¢«åˆ†å‰²æˆåˆ†åŒºçš„æ•°é‡ï¼Œå¦‚æžœæ²¡æœ‰åŒ…æ‹¬ä¸€ä¸ªPARTITIONSå­å¥ï¼Œé‚£ä¹ˆåˆ†åŒºçš„æ•°é‡å°†é»˜è®¤ä¸º1ã€‚ LINER HASHMySQLè¿˜æ”¯æŒçº¿æ€§å“ˆå¸ŒåŠŸèƒ½ï¼Œå®ƒä¸Žå¸¸è§„å“ˆå¸Œçš„åŒºåˆ«åœ¨äºŽï¼Œçº¿æ€§å“ˆå¸ŒåŠŸèƒ½ä½¿ç”¨çš„ä¸€ä¸ªçº¿æ€§çš„2çš„å¹‚ï¼ˆpowers-of-twoï¼‰è¿ç®—æ³•åˆ™ï¼Œè€Œå¸¸è§„å“ˆå¸Œä½¿ç”¨çš„æ˜¯æ±‚å“ˆå¸Œå‡½æ•°å€¼çš„æ¨¡æ•°ã€‚çº¿æ€§å“ˆå¸Œåˆ†åŒºå’Œå¸¸è§„å“ˆå¸Œåˆ†åŒºåœ¨è¯­æ³•ä¸Šçš„å”¯ä¸€åŒºåˆ«åœ¨äºŽï¼Œåœ¨â€œPARTITION BYâ€ å­å¥ä¸­æ·»åŠ â€œLINEARâ€å…³é”®å­—ã€‚ KEYåˆ†åŒºKEYåˆ†åŒºå’ŒHASHåˆ†åŒºç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºŽHASHåˆ†åŒºä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„å‡½æ•°è¿›è¡Œåˆ†åŒºï¼Œæ”¯æŒå­—ç¬¦ä¸²HASHåˆ†åŒºï¼ŒKEYåˆ†åŒºä½¿ç”¨MySQLæ•°æ®åº“æä¾›çš„å‡½æ•°è¿›è¡Œåˆ†åŒºï¼Œè¿™äº›å‡½æ•°åŸºäºŽä¸ŽPASSWORD()ä¸€æ ·çš„è¿ç®—æ³•åˆ™ã€‚ COLUMNSåœ¨å‰é¢è¯´äº†RANGEã€LISTã€HASHå’ŒKEYè¿™å››ç§åˆ†åŒºä¸­ï¼Œåˆ†åŒºçš„æ¡ä»¶æ˜¯ï¼šæ•°æ®å¿…é¡»ä¸ºæ•´å½¢ï¼ˆintergerï¼‰ï¼Œå¦‚æžœä¸æ˜¯æ•´å½¢ï¼Œé‚£åº”è¯¥éœ€è¦é€šè¿‡å‡½æ•°å°†å…¶è½¬åŒ–ä¸ºæ•´å½¢ï¼Œå¦‚YEAR()ï¼ŒTO_DAYS()ï¼ŒMONTH()ç­‰å‡½æ•°ã€‚MySQL5.5ç‰ˆæœ¬å¼€å§‹æ”¯æŒCOLUMNSåˆ†åŒºï¼Œå¯è§†ä¸ºRANGEåˆ†åŒºå’ŒLISTåˆ†åŒºçš„ä¸€ç§è¿›åŒ–ã€‚COLUMNSåˆ†åŒºå¯ä»¥ç›´æŽ¥ä½¿ç”¨éžæ•´å½¢çš„æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œåˆ†åŒºæ ¹æ®ç±»åž‹ç›´æŽ¥æ¯”è¾ƒè€Œå¾—ï¼Œä¸éœ€è¦è½¬åŒ–ä¸ºæ•´å½¢ã€‚æ­¤å¤–ï¼ŒRANGE COLUMNSåˆ†åŒºå¯ä»¥å¯¹å¤šä¸ªåˆ—çš„å€¼è¿›è¡Œåˆ†åŒºã€‚ COLUMNSåˆ†åŒºæ”¯æŒä»¥ä¸‹çš„æ•°æ®ç±»åž‹ï¼š æ‰€æœ‰çš„æ•´å½¢ç±»åž‹ï¼Œå¦‚INTã€SMALLINTã€TINYINTå’ŒBIGINTã€‚è€ŒFLOATå’ŒDECIMALåˆ™ä¸äºˆæ”¯æŒã€‚ æ—¥æœŸç±»åž‹ï¼Œå¦‚DATEä½•DATETIMEã€‚å…¶ä½™çš„æ—¥æœŸç±»åž‹ä¸äºˆæ”¯æŒã€‚ å­—ç¬¦ä¸²ç±»åž‹ï¼Œå¦‚CHARã€VARCHARã€BINARYå’ŒVARBINARYã€‚è€ŒBLOBå’ŒTEXTç±»åž‹ä¸äºˆæ”¯æŒã€‚ åˆ†åŒºä¸­çš„NULLå€¼MySQLæ•°æ®åº“å…è®¸å¯¹NULLå€¼åšåˆ†åŒºï¼Œä½†æ˜¯å¤„ç†çš„æ–¹æ³•ä¸Žå…¶ä»–æ•°æ®åº“å¯èƒ½å®Œå…¨ä¸åŒã€‚MySQLæ•°æ®åº“çš„åˆ†åŒºæ€»æ˜¯è§†NULLå€¼å°äºŽä»»ä½•çš„ä¸€ä¸ªéžNULLå€¼ï¼Œè¿™å’ŒMySQLæ•°æ®åº“ä¸­å¤„ç†NULLå€¼çš„ORDER BYæ“ä½œæ˜¯ä¸€æ ·çš„ã€‚ å› æ­¤å¯¹äºŽä¸åŒçš„åˆ†åŒºç±»åž‹ï¼ŒMySQLæ•°æ®åº“å¯¹äºŽNULLå€¼çš„å¤„ç†ä¹Ÿæ˜¯å„ä¸ç›¸åŒã€‚ å¯¹äºŽRANGEåˆ†åŒºï¼Œå¦‚æžœå‘åˆ†åŒºåˆ—æ’å…¥äº†NULLå€¼ï¼Œåˆ™MySQLæ•°æ®åº“ä¼šå°†è¯¥å€¼æ”¾å…¥æœ€å·¦è¾¹çš„åˆ†åŒºã€‚ å¯¹äºŽLISTåˆ†åŒºï¼Œå¦‚æžœå‘åˆ†åŒºåˆ—æ’å…¥äº†NULLå€¼ï¼Œåˆ™å¿…é¡»æ˜¾ç¤ºåœ°æŒ‡å‡ºå“ªä¸ªåˆ†åŒºæ”¾å…¥NULLå€¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚å¯¹äºŽLISTåˆ†åŒºï¼Œå¦‚æžœå‘åˆ†åŒºåˆ—æ’å…¥äº†NULLå€¼ï¼Œåˆ™å¿…é¡»æ˜¾ç¤ºåœ°æŒ‡å‡ºå“ªä¸ªåˆ†åŒºæ”¾å…¥NULLå€¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ å¯¹äºŽHASHå’ŒKEYåˆ†åŒºï¼Œå¯¹äºŽNULLå€¼çš„å¤„ç†æ–¹æ³•å’ŒRANGEåˆ†åŒºã€LISTåˆ†åŒºä¸ä¸€æ ·ã€‚ä»»ä½•åˆ†åŒºå‡½æ•°éƒ½ä¼šå°†å«æœ‰NULLå€¼çš„è®°å½•è¿”å›žä¸º0ã€‚ åˆ†åŒºå’Œæ€§èƒ½åˆ†åŒºçœŸçš„ä¼šåŠ å¿«æ•°æ®åº“çš„æŸ¥è¯¢å—ï¼Ÿå®žé™…ä¸Šå¯èƒ½æ ¹æœ¬æ„Ÿè§‰ä¸åˆ°æŸ¥è¯¢é€Ÿåº¦çš„æå‡ï¼Œç”šè‡³ä¼šå‘çŽ°æŸ¥è¯¢é€Ÿåº¦æ€¥å‰§ä¸‹é™ï¼Œå› æ­¤åœ¨åˆç†ä½¿ç”¨åˆ†åŒºä¹‹å‰ï¼Œå¿…é¡»äº†è§£åˆ†åŒºçš„ä½¿ç”¨çŽ¯å¢ƒã€‚ æ•°æ®åº“çš„åº”ç”¨åˆ†ä¸ºä¸¤ç±»ï¼šä¸€ç±»æ˜¯OLTPï¼ˆåœ¨çº¿äº‹åŠ¡å¤„ç†ï¼‰ï¼Œå¦‚Blogã€ç”µå­å•†åŠ¡ã€ç½‘ç»œæ¸¸æˆç­‰ï¼›å¦ä¸€ç±»æ˜¯OLAPï¼ˆåœ¨çº¿åˆ†æžå¤„ç†ï¼‰ï¼Œå¦‚æ•°æ®ä»“åº“ã€æ•°æ®é›†å¸‚ã€‚å¯¹äºŽOLAPçš„åº”ç”¨ï¼Œåˆ†åŒºçš„ç¡®æ˜¯å¯ä»¥å¾ˆå¥½åœ°æé«˜æŸ¥è¯¢çš„æ€§èƒ½ï¼Œå› ä¸ºOLAPåº”ç”¨å¤§å¤šæ•°æŸ¥è¯¢éœ€è¦é¢‘ç¹åœ°æ‰«æä¸€å¼ å¾ˆå¤§çš„è¡¨ã€‚å‡è®¾æœ‰ä¸€å¼ 1äº¿è¡Œçš„è¡¨ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ—¶é—´æˆ³å±žæ€§åˆ—ã€‚ç”¨æˆ·çš„æŸ¥è¯¢éœ€è¦ä»Žè¿™å¼ è¡¨ä¸­èŽ·å–ä¸€å¹´çš„æ•°æ®ã€‚å¦‚æžœæŒ‰æ—¶é—´æˆ³è¿›è¡Œåˆ†åŒºï¼Œåˆ™åªéœ€è¦æ‰«æç›¸åº”çš„åˆ†åŒºå³å¯ã€‚è¿™å°±æ˜¯å‰é¢ä»‹ç»çš„åˆ†åŒºä¿®å‰ªæŠ€æœ¯ã€‚ å¯¹äºŽOLTPçš„åº”ç”¨ï¼Œåˆ†åŒºåº”è¯¥éžå¸¸å°å¿ƒã€‚åœ¨è¿™ç§åº”ç”¨ä¸‹ï¼Œé€šå¸¸ä¸å¯èƒ½ä¼šèŽ·å–ä¸€å¼ å¤§è¡¨10%çš„æ•°æ®ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯é€šè¿‡ç´¢å¼•è¿”å›žå‡ æ¡è®°å½•å³å¯ã€‚è€Œæ ¹æ®B+æ ‘ç´¢å¼•çš„åŽŸç†å¯çŸ¥ï¼Œå¯¹äºŽä¸€å¼ å¤§è¡¨ï¼Œä¸€èˆ¬çš„B+æ ‘éœ€è¦2~3æ¬¡çš„ç£ç›˜IOã€‚å› æ­¤B+æ ‘å¯ä»¥å¾ˆå¥½åœ°å®Œæˆæ“ä½œï¼Œä¸éœ€è¦åˆ†åŒºçš„å¸®åŠ©ï¼Œå¹¶ä¸”è®¾è®¡ä¸å¥½çš„åˆ†åŒºä¼šå¸¦æ¥ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚ å¦‚å¾ˆå¤šå¼€å‘å›¢é˜Ÿä¼šè®¤ä¸ºå«æœ‰1000wè¡Œçš„è¡¨æ˜¯ä¸€å¼ éžå¸¸å·¨å¤§çš„è¡¨ï¼Œæ‰€ä»¥ä»–ä»¬å¾€å¾€ä¼šé€‰æ‹©é‡‡ç”¨åˆ†åŒºï¼Œå¦‚å¯¹ä¸»é”®åš10ä¸ªHASHçš„åˆ†åŒºï¼Œè¿™æ ·æ¯ä¸ªåˆ†åŒºå°±åªæœ‰100wçš„æ•°æ®äº†ï¼Œå› æ­¤æŸ¥è¯¢åº”è¯¥å˜å¾—æ›´å¿«äº†ã€‚å¦‚select * from table where pk=@pkã€‚ä½†æ˜¯æœ‰æ²¡æœ‰è€ƒè™‘è¿‡è¿™æ ·ä¸€ç§æƒ…å†µï¼š100wå’Œ1000wè¡Œçš„æ•°æ®æœ¬èº«æž„æˆçš„B+æ ‘çš„å±‚æ¬¡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¯èƒ½éƒ½æ˜¯2~3å±‚ã€‚é‚£ä¹ˆä¸Šè¿°èµ°ä¸»é”®åˆ†åŒºçš„ç´¢å¼•å¹¶ä¸ä¼šå¸¦æ¥æ€§èƒ½çš„æé«˜ã€‚å¥½çš„ï¼Œå¦‚æžœ1000wçš„B+æ ‘é«˜åº¦æ˜¯3,100wçš„B+æ ‘é«˜åº¦æ˜¯2ï¼Œé‚£ä¹ˆä¸Šè¿°æŒ‰ä¸»é”®åˆ†åŒºçš„ç´¢å¼•å¯ä»¥é¿å…1æ¬¡IOï¼Œä»Žè€Œæé«˜æŸ¥è¯¢çš„æ•ˆçŽ‡ã€‚è¿™æ²¡é—®é¢˜ï¼Œä½†æ˜¯è¿™å¼ è¡¨åªæœ‰ä¸»é”®ç´¢å¼•ï¼Œæ²¡æœ‰ä»»ä½•å…¶ä»–çš„åˆ—éœ€è¦æŸ¥è¯¢çš„ã€‚å¦‚æžœè¿˜æœ‰ç±»ä¼¼å¦‚ä¸‹çš„SQLï¼šselect * from table where key=@keyï¼Œè¿™æ—¶å¯¹äºŽkeyçš„æŸ¥è¯¢éœ€è¦æ‰«ææ‰€æœ‰çš„10ä¸ªåˆ†åŒºï¼Œå³ä½¿æ¯ä¸ªåˆ†åŒºçš„æŸ¥è¯¢å¼€é”€ä¸º2æ¬¡IOï¼Œåˆ™ä¸€å…±éœ€è¦20æ¬¡IOã€‚è€Œå¯¹äºŽåŽŸæ¥å•è¡¨çš„è®¾è®¡ï¼Œå¯¹äºŽKEYçš„æŸ¥è¯¢åªéœ€è¦2~3æ¬¡IOã€‚ ç”±ä»¥ä¸Šç»“è®ºå¯ä»¥çœ‹å‡ºï¼Œå¯¹äºŽåœ¨OLTPåœºæ™¯ä¸­ä½¿ç”¨åˆ†åŒºä¸€å®šè¦ç‰¹åˆ«å°å¿ƒäº†ã€‚ MySQL 5.7å¯¹åˆ†åŒºçš„æ”¹è¿›åœ¨MySQL 5.6é‡Œé¢ï¼Œåˆ†åŒºçš„ä¿¡æ¯æ˜¯åœ¨MySQL Serverå±‚ç»´æŠ¤çš„ï¼ˆåœ¨.paræ–‡ä»¶é‡Œé¢ï¼‰ï¼ŒInnoDBå¼•æ“Žå±‚æ˜¯ä¸çŸ¥é“æœ‰åˆ†åŒºè¿™ä¸ªæ¦‚å¿µçš„ï¼ŒInnoDBå¼•æ“Žå±‚æŠŠæ¯ä¸€ä¸ªåˆ†åŒºéƒ½å½“æˆä¸€å¼ æ™®é€šçš„InnoDBè¡¨ã€‚åœ¨æ‰“å¼€ä¸€ä¸ªåˆ†åŒºè¡¨æ—¶ï¼Œä¼šæ‰“å¼€å¾ˆå¤šä¸ªåˆ†åŒºï¼Œæ‰“å¼€è¿™äº›åˆ†åŒºè¡¨å°±ç›¸å½“äºŽæ‰“å¼€äº†åŒç­‰æ•°é‡çš„InnoDBè¡¨ï¼Œè¿™éœ€è¦æ›´å¤šå†…å­˜å­˜æ”¾InnoDBè¡¨çš„å…ƒæ•°æ®å’Œå„ç§ä¸Žibdæ–‡ä»¶æ‰“å¼€ç›¸å…³çš„å„ç§cacheä¸Žhandlerçš„ä¿¡æ¯ã€‚åœ¨MySQL 5.7é‡Œé¢ï¼ŒInnoDBå¼•å…¥äº†Native Partitioningï¼Œå®ƒæŠŠåˆ†åŒºçš„ä¿¡æ¯ä»ŽServerå±‚ç§»åˆ°äº†InnoDBå±‚ï¼Œæ‰“å¼€ä¸€ä¸ªåˆ†åŒºè¡¨å’Œæ‰“å¼€ä¸€ä¸ªInnoDBè¡¨çš„å†…å­˜å¼€é”€åŸºæœ¬æ˜¯ä¸€æ ·çš„ã€‚]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>InnoDB</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL InnoDBå­˜å‚¨å¼•æ“Žï¼šä¸€è‡´æ€§é”å®šè¯»]]></title>
    <url>%2Fmysql-innodb-consistent-locking-read.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ•´ç†è‡ªï¼šã€ŠMySQLæŠ€æœ¯å†…å¹•:InnoDBå­˜å‚¨å¼•æ“Žã€‹ ç¬¬äºŒç‰ˆ ä½œè€…ï¼šå§œæ‰¿å°§ å‡ºç‰ˆæ—¶é—´ï¼š2013-05 åœ¨å‰ä¸€å°èŠ‚ä¸­è®²åˆ°ï¼Œåœ¨é»˜è®¤é…ç½®ä¸‹ï¼Œå³äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä¸º REPEATABLE READ æ¨¡å¼ä¸‹ï¼Œ InnoDB å­˜å‚¨å¼•æ“Žçš„ SELECT æ“ä½œä½¿ç”¨ä¸€è‡´æ€§éžé”å®šè¯»ã€‚ä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·éœ€è¦æ˜¾å¼åœ°å¯¹æ•°æ®åº“è¯»å–æ“ä½œè¿›è¡ŒåŠ é”ä»¥ä¿è¯æ•°æ®é€»è¾‘çš„ä¸€è‡´æ€§ã€‚è€Œè¿™è¦æ±‚æ•°æ®åº“æ”¯æŒåŠ é”è¯­å¥ï¼Œå³ä½¿æ˜¯å¯¹äºŽSELECTçš„åªè¯»æ“ä½œã€‚InnoDBå­˜å‚¨å¼•æ“Žå¯¹äºŽSELECTè¯­å¥æ”¯æŒä¸¤ç§ä¸€è‡´æ€§çš„é”å®šè¯»ï¼ˆlocking read)æ“ä½œï¼š 12SELECT......FOR UPDATESELECT......LOCK IN SHARE MODE SELECTâ€¦FOR UPDATEå¯¹è¯»å–çš„è¡Œè®°å½•åŠ ä¸€ä¸ªXé”ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½å¯¹å·²é”å®šçš„è¡ŒåŠ ä¸Šä»»ä½•é”ã€‚SELECTâ€¦LOCK IN SHARE MODEå¯¹è¯»å–çš„è¡Œè®°å½•åŠ ä¸€ä¸ªSé”ï¼Œå…¶ä»–äº‹åŠ¡å¯ä»¥å‘è¢«é”å®šçš„è¡ŒåŠ Sé”ï¼Œä½†æ˜¯å¦‚æžœåŠ Xé”ï¼Œåˆ™ä¼šè¢«é˜»å¡žã€‚ å¯¹äºŽä¸€è‡´æ€§éžé”å®šè¯»ï¼Œå³ä½¿è¯»å–çš„è¡Œå·²è¢«æ‰§è¡Œäº† SELECTâ€¦FOR UPDATE,ä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œè¯»å–çš„ï¼Œè¿™å’Œä¹‹å‰è®¨è®ºçš„æƒ…å†µä¸€æ ·ã€‚æ­¤å¤–ï¼ŒSELECTâ€¦FOR UPDATE, SELECTâ€¦LOCK IN SHARE MODEå¿…é¡»åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå½“äº‹åŠ¡æäº¤äº†ï¼Œé”ä¹Ÿå°±é‡Šæ”¾äº†ã€‚å› æ­¤åœ¨ä½¿ç”¨ä¸Šè¿°ä¸¤å¥SELECTé”å®šè¯­å¥æ—¶ï¼ŒåŠ¡å¿…åŠ ä¸ŠBEGIN,START TRANSACTION æˆ–è€…SET AUTOCOMMIT =0 ã€‚]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>InnoDB</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL InnoDBå­˜å‚¨å¼•æ“Žï¼šä¸€è‡´æ€§éžé”å®šè¯»]]></title>
    <url>%2Fmysql-innodb-consistent-nonlocking-read.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ•´ç†è‡ªï¼šã€ŠMySQLæŠ€æœ¯å†…å¹•:InnoDBå­˜å‚¨å¼•æ“Žã€‹ ç¬¬äºŒç‰ˆ ä½œè€…ï¼šå§œæ‰¿å°§ å‡ºç‰ˆæ—¶é—´ï¼š2013-05 ä¸€è‡´æ€§çš„éžé”å®šè¡Œè¯»ï¼ˆconsistent nonlocking readï¼‰æ˜¯æŒ‡InnoDBå­˜å‚¨å¼•æ“Žé€šè¿‡è¡Œå¤šç‰ˆæœ¬æŽ§åˆ¶ï¼ˆmulti versioningï¼‰çš„æ–¹å¼æ¥è¯»å–å½“å‰æ‰§è¡Œæ—¶é—´æ•°æ®åº“ä¸­è¡Œçš„æ•°æ®ã€‚å¦‚æžœè¯»å–çš„è¡Œæ­£åœ¨æ‰§è¡ŒDELETEã€UPDATEæ“ä½œï¼Œè¿™æ˜¯è¯»å–æ“ä½œä¸ä¼šå› æ­¤è€Œä¼šç­‰å¾…è¡Œä¸Šé”çš„é‡Šæ”¾ï¼Œç›¸åï¼ŒInnoDBä¼šåŽ»è¯»å–è¡Œçš„ä¸€ä¸ªå¿«ç…§æ•°æ®ã€‚ ä¸‹å›¾ç›´è§‚å±•ç¤ºäº†ä¸€è‡´æ€§çš„éžé”å®šè¡Œè¯»ï¼š ä¹‹æ‰€ä»¥ç§°å…¶ä¸ºéžé”å®šè¯»ï¼Œå› ä¸ºä¸éœ€è¦ç­‰å¾…è®¿é—®çš„è¡Œä¸ŠXé”çš„é‡Šæ”¾ã€‚å¿«ç…§æ•°æ®æ˜¯æŒ‡è¯¥è¡Œçš„ä¹‹å‰ç‰ˆæœ¬çš„æ•°æ®ï¼Œè¯¥å®žçŽ°æ˜¯é€šè¿‡undoæ®µæ¥å®Œæˆã€‚è€Œundoæ®µç”¨æ¥åœ¨æ­¤äº‹åŠ¡ä¸­å›žæ»šæ•°æ®ï¼Œå› æ­¤å¿«ç…§æ•°æ®æœ¬èº«æ˜¯æ²¡æœ‰é¢å¤–çš„å¼€é”€ã€‚æ­¤å¤–ï¼Œè¯»å–å¿«ç…§æ•°æ®æ˜¯ä¸éœ€è¦ä¸Šé”çš„ï¼Œå› ä¸ºæ²¡æœ‰äº‹åŠ¡éœ€è¦å¯¹åŽ†å²çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œã€‚ å¯ä»¥çœ‹åˆ°ï¼Œéžé”å®šè¯»æœºåˆ¶æžå¤§åœ°æé«™äº†æ•°æ®åº“çš„å¹¶å‘æ€§ã€‚åœ¨InnoDBå­˜å‚¨å¼•æ“Žçš„é»˜è®¤è®¾ç½®ä¸‹ï¼Œè¿™æ˜¯é»˜è®¤çš„è¯»å–æ–¹å¼ï¼Œå³è¯»å–ä¸ä¼šå ç”¨å’Œç­‰å¾…è¡¨ä¸Šçš„é”ã€‚ä½†æ˜¯åœ¨ä¸åŒäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¯»å–çš„æ–¹å¼ä¸åŒï¼Œå¹¶ä¸æ˜¯åœ¨æ¯ä¸ªäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹éƒ½æ˜¯é‡‡ç”¨éžé”å®šçš„ä¸€è‡´æ€§è¯»ã€‚æ­¤å¤–ï¼Œå³ä½¿éƒ½æ˜¯ä½¿ç”¨éžé”å®šçš„ä¸€è‡´æ€§è¯»ï¼Œä½†æ˜¯å¯¹äºŽå¿«ç…§æ•°æ®çš„å®šä¹‰ä¹Ÿå„ä¸ç›¸åŒã€‚ é€šè¿‡å›¾6-4å¯ä»¥çŸ¥é“ï¼Œå¿«ç…§æ•°æ®å…¶å®žå°±æ˜¯å½“å‰è¡Œæ•°æ®ä¹‹å‰çš„åŽ†å²ç‰ˆæœ¬ï¼Œæ¯è¡Œè®°å½•å¯èƒ½æœ‰å¤šä¸ªç‰ˆæœ¬ã€‚å°±å›¾6-4æ‰€æ˜¾ç¤ºçš„ï¼Œä¸€ä¸ªè¡Œè®°å½•å¯èƒ½æœ‰ä¸æ­¢ä¸€ä¸ªå¿«ç…§æ•°æ®ï¼Œä¸€èˆ¬ç§°è¿™ç§æŠ€æœ¯ä¸ºè¡Œå¤šç‰ˆæœ¬æŠ€æœ¯ã€‚ç”±æ­¤å¸¦æ¥çš„å¹¶å‘æŽ§åˆ¶ï¼Œç§°ä¹‹ä¸ºå¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶ï¼ˆMultiVersionConcurrencyControl MVCCï¼‰ã€‚ åœ¨äº‹åŠ¡éš”ç¦»çº§åˆ«READ COMMITTEDå’ŒREPEATABLE READ(InnoDBå­˜å‚¨å¼•æ“Žçš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼‰ä¸‹ï¼ŒInnoDBå­˜å‚¨å¼•æ“Žä½¿ç”¨éžé”å®šçš„ä¸€è‡´æ€§è¯»ã€‚ç„¶è€Œï¼Œå¯¹äºŽå¿«ç…§æ•°æ®çš„å®šä¹‰å´ä¸ç›¸åŒã€‚åœ¨READ COMMITTEDäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯¹äºŽå¿«ç…§æ•°æ®ï¼Œéžä¸€è‡´æ€§è¯»æ€»æ˜¯è¯»å–è¢«é”å®šè¡Œçš„æœ€æ–°ä¸€ä»½å¿«ç…§æ•°æ®ã€‚è€Œåœ¨REPEATABLE READäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯¹äºŽå¿«ç…§æ•°æ®ï¼Œéžä¸€è‡´æ€§è¯»æ€»æ˜¯è¯»å–äº‹åŠ¡å¼€å§‹æ—¶çš„è¡Œæ•°æ®ç‰ˆæœ¬ï¼ˆå…³é”®åœ¨äºŽäº‹åŠ¡ä¹‹é—´çš„éš”ç¦»æ€§ï¼‰ã€‚æ¥çœ‹ä¸‹é¢çš„ä¸€ä¸ªä¾‹å­ï¼Œé¦–å…ˆåœ¨å½“å‰MySQLæ•°æ®åº“çš„è¿žæŽ¥ä¼šè¯Aä¸­æ‰§è¡Œå¦‚ä¸‹SQLè¯­å¥ï¼š 1234567891011# Session Amysql&gt; BEGIN;Query OK, 0 rows affected (0.00 sec)Sql&gt; SELECT * FROM parent WHERE id =1;+----+| id |+----+| 1 |+----+1 row in set (0.00 sec) ä¼šè¯Aä¸­å·²é€šè¿‡æ˜¾å¼åœ°æ‰§è¡Œå‘½ä»¤BEGINå¼€å¯äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶è¯»å–äº†è¡¨parentä¸­idä¸º1çš„æ•°æ®ï¼Œä½†æ˜¯äº‹åŠ¡å¹¶æ²¡æœ‰ç»“æŸã€‚ä¸Žæ­¤åŒæ—¶ï¼Œç”¨æˆ·å†å¼€å¯å¦ä¸€ä¸ªä¼šè¯Bï¼Œè¿™æ ·å¯ä»¥æ¨¡æ‹Ÿå¹¶å‘çš„æƒ…å†µï¼Œç„¶åŽå¯¹ä¼šè¯Båšå¦‚ä¸‹çš„æ“ä½œï¼š 123456mysql&gt; BEGIN;Query OK, 0 rows affected (0.00 sec)mysql&gt; UPDATE parent SET id=3 WHERE id=l;Query OK, 1 row affected (0.00 sec)Rows matched: 1 Changed: 1 warnings: 0 åœ¨ä¼šè¯Bä¸­å°†äº‹åŠ¡è¡¨parentä¸­idä¸º1çš„è®°å½•ä¿®æ”¹ä¸ºid=3ï¼Œä½†æ˜¯äº‹åŠ¡åŒæ ·æ²¡æœ‰æäº¤ï¼Œè¿™æ ·id=1çš„è¡Œå…¶å®žåŠ äº†ä¸€ä¸ªXé”ã€‚è¿™æ—¶å¦‚æžœåœ¨ä¼šè¯Aä¸­å†æ¬¡è¯»å–idä¸º1çš„è®°å½•ï¼Œæ ¹æ®InnoDBå­˜å‚¨å¼•æ“Žçš„ç‰¹æ€§ï¼Œå³åœ¨READ COMMITTEDå’ŒREPEATETABLE READçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ä¼šä½¿ç”¨éžé”å®šçš„ä¸€è‡´æ€§è¯»ã€‚å›žåˆ°ä¹‹å‰çš„ä¼šè¯A,æŽ¥ç€ä¸Šæ¬¡æœªæäº¤çš„äº‹åŠ¡ï¼Œæ‰§è¡ŒSQLè¯­å¥SELECT * FROM parent WHERE id=1çš„æ“ä½œï¼Œè¿™æ—¶ä¸ç®¡ä½¿ç”¨READ COMMITTEDè¿˜æ˜¯REPEATABLE READçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œæ˜¾ç¤ºçš„æ•°æ®åº”è¯¥éƒ½æ˜¯ï¼š 1234567mysql&gt; SELECT FROM parent WHERE id =l;+----+| id |+----+| 1 |+----+1 row in set (0.00 sec) ç”±äºŽå½“å‰id=1çš„æ•°æ®è¢«ä¿®æ”¹äº†1æ¬¡ï¼Œå› æ­¤åªæœ‰ä¸€ä¸ªè¡Œç‰ˆæœ¬çš„è®°å½•ã€‚æŽ¥ç€ï¼Œåœ¨ä¼šè¯Bä¸­æäº¤ä¸Šæ¬¡çš„äº‹åŠ¡ã€‚ 123# Session Bmysql&gt; commitQuery OK, 0 rows affected (0.01 sec) åœ¨ä¼šè¯Bæäº¤äº‹åŠ¡åŽï¼Œè¿™æ—¶åœ¨ä¼šè¯Aä¸­å†è¿è¡ŒSELECT * FROM parent WHERE id=1çš„SQLè¯­å¥ï¼Œåœ¨READ COMMITTEDå’ŒREPEATABLEäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹å¾—åˆ°ç»“æžœ å°±ä¸ä¸€æ ·äº†ã€‚å¯¹äºŽREAD COMMITTEDçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå®ƒæ€»æ˜¯è¯»å–è¡Œçš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¦‚æžœè¡Œè¢«é”å®šäº†ï¼Œåˆ™è¯»å–è¯¥è¡Œç‰ˆæœ¬çš„æœ€æ–°ä¸€ä¸ªå¿«ç…§ï¼ˆfresh snapshotï¼‰ã€‚åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå› ä¸ºä¼šè¯Bå·²ç»æäº¤äº†äº‹åŠ¡ï¼Œæ‰€ä»¥READ COMMITTEDäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æžœï¼š 1234567mysql&gt;SELECT @@tx_isolation\G;**************************** 1.row ****************************@@tx_isolation: READ-COMMITTED1 row in set (0.00 sec)mysql&gt; SELECT FROM parent WHERE id=1:Empty set (0.00 sec) è€Œå¯¹äºŽREPEATETABLE çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œæ€»æ˜¯è¯»å–äº‹åŠ¡å¼€å§‹æ—¶çš„è¡Œæ•°æ®ã€‚å› æ­¤å¯¹äºŽREPEATETABLE READäº‹åŠ¡éš”ç¦»çº§åˆ«,å…¶å¾—åˆ°çš„ç»“æžœå¦‚ä¸‹ï¼š 123456789101112mysql&gt; SELECT @@tx_isolation\G;**************************** 1.row ****************************@@tx_isolation: REPEATABLE-READ1 row in set (0.00 sec)mysql&gt; SELECT FROM parent WHERE id=1;+----+| id |+----+| 1 |+----+1 row in set (0.00 sec) ä¸‹é¢å°†ä»Žæ—¶é—´çš„è§’åº¦å±•çŽ°ä¸Šè¿°æ¼”ç¤ºçš„ç¤ºä¾‹è¿‡ç¨‹ï¼Œå¦‚è¡¨6-8æ‰€ç¤ºã€‚éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºŽREAD COMMITTED çš„äº‹åŠ¡éš”ç¦»çº§åˆ«è€Œè¨€ï¼Œä»Žæ•°æ®åº“ç†è®ºçš„è§’åº¦æ¥çœ‹ï¼Œå…¶è¿åäº†äº‹åŠ¡ACIDä¸­çš„Içš„ç‰¹æ€§ï¼Œå³éš”ç¦»æ€§ã€‚]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>InnoDB</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ—¥å¿—æœåŠ¡æž¶æž„è®¾è®¡]]></title>
    <url>%2Flog-service-architecture-design.html</url>
    <content type="text"><![CDATA[åœ¨æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„å‰æä¸‹ï¼Œä»£ç ã€æž¶æž„ï¼Œè¶Šç®€å•ï¼Œè¶Šç¨³å®šã€‚ æœ€è¿‘æƒ³æŠŠä¹‹å‰åšè¿‡çš„æ—¥å¿—é¡¹ç›®åŠä¸ªäººçš„æ€è€ƒæ¢³ç†ä¸€ä¸‹ï¼ŒäºŽæ˜¯æœ‰äº†æœ¬æ–‡ã€‚ èƒŒæ™¯æˆ‘ä»¬è¿™è¾¹åº”ç”¨éƒ¨ç½²çš„çŽ¯å¢ƒæ¯”è¾ƒå¤æ‚ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š æœºå™¨ç›´æŽ¥éƒ¨ç½² é€šè¿‡åŽŸç”Ÿdockeréƒ¨ç½² é€šè¿‡kubernatesé›†ç¾¤éƒ¨ç½² éƒ¨ç½²çŽ¯å¢ƒä¸ç»Ÿä¸€ï¼Œå¯¼è‡´æŸ¥çœ‹åº”ç”¨æ—¥å¿—å¾ˆä¸æ–¹ä¾¿ã€‚ ä¸šåŠ¡éœ€æ±‚ä¸Žéƒ¨ç½²çŽ¯å¢ƒå¯¹åº”ï¼Œå¯¹äºŽæ—¥å¿—æ”¶é›†éœ€æ±‚åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š æœºå™¨ä¸Šçš„æ–‡æœ¬æ—¥å¿—ï¼ˆç›´æŽ¥è¿è¡Œåœ¨ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºä¸­çš„åº”ç”¨æ—¥å¿—ï¼‰ è¿è¡Œåœ¨dockerå®¹å™¨ä¸­çš„åº”ç”¨æ—¥å¿— è¿è¡Œåœ¨kubernatesé›†ç¾¤ä¸­çš„åº”ç”¨æ—¥å¿— å…·ä½“ä¸šåŠ¡éœ€æ±‚å¯ä»¥æ‹†åˆ†ä¸ºï¼š æŒ‰ç…§é¡¹ç›®ã€åº”ç”¨ã€å®žä¾‹ç»´åº¦æ£€ç´¢æ—¥å¿—å¹¶æ”¯æŒæœç´¢å…³é”®å­—é«˜äº®ï¼ˆå› ä¸ºå¤§å®¶æ£€ç´¢æ—¥å¿—çš„æ—¶å€™ï¼Œè‚¯å®šæ˜¯æ£€ç´¢æŸä¸ªé¡¹ç›®ã€æŸä¸ªåº”ç”¨ã€æŸä¸ªå®žä¾‹çš„æ—¥å¿—ï¼‰ æ”¯æŒæ£€ç´¢å‡ºæŸæ¡æƒ³è¦çš„æ—¥å¿—åŽï¼Œå¯ä»¥æŸ¥çœ‹ä¸Šä¸‹æ–‡ï¼ˆæŸ¥çœ‹è¯¥æ—¥å¿—æ‰€åœ¨æ—¥å¿—æ–‡ä»¶çš„æ—¥å¿—ä¸Šä¸‹æ–‡ï¼‰ æ”¯æŒæ—¥å¿—ä¸‹è½½ï¼ˆç›®å‰æ”¯æŒä¸¤ç§åœºæ™¯ï¼šæœç´¢ç»“æžœä¸‹è½½ã€ä¸Šä¸‹æ–‡ä¸‹è½½ï¼›æ”¯æŒä¸¤ç§æ–¹å¼ï¼šåœ¨çº¿ä¸‹è½½ã€ç¦»çº¿ä¸‹è½½ï¼‰ æ”¯æŒè‡ªåŠ¨åŒ–æ‰¹é‡éƒ¨ç½²ã€å¸è½½Agentï¼Œéƒ¨ç½²ã€å¸è½½è¿‡ç¨‹å¯è§†åŒ– å•å®žä¾‹æ”¯æŒå¤šelasticsearché›†ç¾¤ æ”¯æŒæ–‡æœ¬æ—¥å¿—ã€dockeræ—¥å¿—ã€k8sæ—¥å¿—å¹¶èƒ½ä¸Žå°†æ—¥å¿—ä¸Žå…¶ä¸šåŠ¡æ„ä¹‰å¯¹åº”ä¸Šã€‚ï¼ˆå³ä¸ç®¡æ˜¯å“ªç§æ—¥å¿—å½¢å¼ã€æ¥æºï¼Œæœ€ç»ˆéƒ½éœ€è¦ä¸Žä¸šåŠ¡æ„ä¹‰ä¸Šçš„é¡¹ç›®ã€åº”ç”¨ã€å®žä¾‹å¯¹åº”èµ·æ¥ï¼Œå› ä¸ºå¯¹äºŽæ—¥å¿—çš„ä½¿ç”¨è€…æ¥è¯´ï¼ŒæŸ¥è¯¢æ—¥å¿—çš„å‡ºå‘ç‚¹è‚¯å®šæ˜¯æŸ¥è¯¢æŸä¸ªé¡¹ç›®ã€æŸä¸ªåº”ç”¨ï¼ˆå¯ä»¥ä¸é€‰ï¼‰ã€æŸä¸ªå®žä¾‹ï¼ˆå¯ä»¥ä¸é€‰ï¼‰ã€æŸæ®µæ—¶é—´çš„æ—¥å¿—ã€‚ï¼‰ æ”¯æŒéƒ¨ç½²åˆ°ä¸šåŠ¡è‡ªå·±çš„é›†ç¾¤ä¸­ éœ€æ±‚å·²ç»æ˜Žç¡®äº†ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹ä¸šç•Œæ–¹æ¡ˆã€‚ ä¸šç•Œæ—¥å¿—ç³»ç»Ÿæž¶æž„ Collectorçš„ä½œç”¨æ˜¯ï¼š æ¸…æ´—ã€æ±‡èšæ•°æ®ï¼Œå‡å°‘å¯¹äºŽåŽç«¯é›†ç¾¤çš„åŽ‹åŠ›ã€‚ å®‰å…¨ï¼Œä¸å…è®¸Agentç›´è¿žkafkaç­‰å†…éƒ¨é›†ç¾¤ï¼Œä¿è¯ä¸€å®šçš„å®‰å…¨æ€§ï¼Œå³ä½¿åŽç«¯å‘ç”Ÿè°ƒæ•´ä¹Ÿèƒ½ä¿è¯å¯¹äºŽAgentè¿žæŽ¥ã€è®¤è¯æ–¹å¼çš„ç¨³å®šã€‚ MQçš„ä½œç”¨æ˜¯å‰Šå³°å¡«è°·ã€è§£è€¦ã€å¤šæ¬¡æ¶ˆè´¹ã€‚ ä¸Šå›¾çš„æž¶æž„æ˜¯ä¸šç•Œæ¯”è¾ƒé€šç”¨çš„ä¸€ç§æž¶æž„ï¼Œå¯¹äºŽå„ç§åœºæ™¯éƒ½è€ƒè™‘çš„æ¯”è¾ƒå…¨ã€‚ æ—¢ç„¶ä¸šç•Œçš„æž¶æž„å·²ç»è¿™ä¹ˆå®Œå¤‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å°±ç›´æŽ¥é‡‡ç”¨å‘¢ï¼Ÿ å¯¹äºŽæˆ‘ä»¬è€Œè¨€ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š æ¶‰åŠçš„ç»„ä»¶æ¯”è¾ƒå¤šï¼Œé“¾è·¯æ¯”è¾ƒé•¿ï¼Œè¿ç»´æ¯”è¾ƒéº»çƒ¦ è¿™ä¸€æ•´å¥—æž¶æž„ï¼Œä¸åˆ©äºŽå•ç‹¬éƒ¨ç½²ï¼ˆæ¯”å¦‚æŸä¸ªä¸šåŠ¡åº”ç”¨éƒ¨ç½²æœºæˆ¿ç½‘ç»œæ˜¯éš”ç¦»çš„ï¼Œè€Œä¸”é¡¹ç›®åˆä¸å¤§ï¼Œåªèƒ½æä¾›æœ‰é™çš„å‡ å°æœºå™¨ï¼Œè¿™æ—¶å€™å¦‚æžœéœ€è¦éƒ¨ç½²ä¸šç•Œè¿™å¥—æž¶æž„çš„è¯ï¼Œèµ„æºå°±ä¼šæ¯”è¾ƒå—é™ï¼Œå¦‚æžœæƒ³åšåˆ°å³æ”¯æŒä¸šç•Œæž¶æž„ç»„ä»¶çš„å¯æ’æ‹”ï¼ˆæ¯”å¦‚å¯çµæ´»çš„å†³å®šæ˜¯å¦éœ€è¦Collectorã€MQï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿ç»´å‡ å¥—é…ç½®æˆ–ä»£ç ï¼‰ æœ€å…³é”®çš„å°±æ˜¯å…¶ä¸­ç»„ä»¶æä¾›çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬ç›®å‰ç”¨ä¸åˆ°ã€‚æ¯”å¦‚MQçš„å‰Šå³°å¡«è°·ã€å¤šæ¬¡æ¶ˆè´¹ã€‚ ç»„ä»¶é€‰æ‹©é€‰æ‹©ç»„ä»¶ï¼Œæˆ‘ä»¬è¿™è¾¹ä¸»è¦æ˜¯ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè€ƒé‡çš„ï¼š ç»„ä»¶å¯¹åº”çš„å¼€æºç”Ÿæ€å®Œæ•´ã€æ´»è·ƒåº¦é«˜ å¯¹åº”çš„æŠ€æœ¯æ ˆæ˜¯æˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„ï¼Œæˆ‘ä»¬è¿™è¾¹è¯­è¨€æŠ€æœ¯æ ˆä¸»è¦æ˜¯Javaã€Goï¼Œå¦‚æžœç»„ä»¶è¯­è¨€æ˜¯Cã€Rubyï¼Œåº”è¯¥å°±è¢«æŽ’é™¤äº†ã€‚ è¿ç»´æˆæœ¬ æ˜“éƒ¨ç½²ã€æ€§èƒ½å¥½ Agentä¸€æåˆ°æ—¥å¿—æ”¶é›†æ–¹æ¡ˆï¼Œå¤§å®¶ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„è‚¯å®šæ˜¯ELK(Elasticsearchã€Logstashã€Kibana )ï¼Œä½†Logstashä¾èµ–äºŽJVMä¸ç®¡æ˜¯æ€§èƒ½è¿˜æ˜¯ç®€æ´æ€§ï¼Œéƒ½ä¸æ˜¯æ—¥å¿—æ”¶é›†agentçš„é¦–é€‰ã€‚ ä¸ªäººæ„Ÿè§‰ä¸€ä¸ªå¥½çš„agentåº”è¯¥æ˜¯èµ„æºå ç”¨å°‘ï¼Œæ€§èƒ½å¥½ï¼Œä¸ä¾èµ–åˆ«çš„ç»„ä»¶ï¼Œå¯ä»¥ç‹¬ç«‹éƒ¨ç½²ã€‚è€ŒLogstashæ˜Žæ˜¾ä¸ç¬¦åˆè¿™å‡ ç‚¹è¦æ±‚ï¼Œä¹Ÿè®¸æ­£æ˜¯åŸºäºŽè¿™äº›è€ƒè™‘elasticæŽ¨å‡ºäº†Filebeatã€‚ Collectorã€MQElasticsearché›†ç¾¤åœ¨éƒ¨ç½²çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½æ˜¯æå‰ä¼°è®¡å¥½å®¹é‡ã€æœºå™¨ã€shardç­‰ä¿¡æ¯ï¼Œå› ä¸ºElasticsearché›†ç¾¤è¿è¡ŒåŽï¼Œå†æ°´å¹³æ‹“å±•ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œæˆ‘ä»¬è¿™è¾¹ç”±äºŽä¸šåŠ¡åŠæˆæœ¬é™åˆ¶æ— æ³•å¾ˆå¥½çš„é¢„ä¼°å®¹é‡ï¼Œæ‰€ä»¥å°±ç»“åˆå…¬å¸å®žé™…è¦æ±‚ï¼šä½¿ç”¨æ—¥å¿—æœåŠ¡çš„ä¸šåŠ¡æ–¹è‡ªå¸¦æœºå™¨ï¼Œä¹Ÿå°±æ˜¯ä¸šåŠ¡æ–¹ä¼šæœ‰ç‹¬ç«‹çš„Elasticsearché›†ç¾¤ã€‚ æ¯ä¸ªä¸šåŠ¡æ–¹éƒ½ä½¿ç”¨è‡ªå·±çš„Elasticsearché›†ç¾¤ï¼Œæ‰€ä»¥é›†ç¾¤åŽ‹åŠ›ä¸ä¼šå¾ˆå¤§ï¼Œä»Žè€ŒCollectorã€MQè¿™ä¸¤ä¸ªç»„ä»¶å¯¹äºŽæˆ‘ä»¬çš„ä½œç”¨ä¹Ÿå°±å¾ˆå°äº†ã€‚ ETLå› ä¸ºElasticsearch Ingest Nodeå®Œå…¨å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„è§£æžéœ€æ±‚ï¼Œæ‰€ä»¥å°±æ²¡æœ‰å¿…è¦å†å¼•å…¥Logstashç­‰ç›¸å…³ç»„ä»¶äº†ã€‚ åˆ°è¿™é‡Œï¼ŒåŸºæœ¬å¯ä»¥çœ‹å‡ºæˆ‘ä»¬çš„æž¶æž„å¦‚ä¸‹ï¼š æž¶æž„è®¾è®¡çš„å‡ ä¸ªåŽŸåˆ™ï¼š åˆé€‚ä¼˜äºŽä¸šç•Œé¢†å…ˆ ç®€å•ä¼˜äºŽå¤æ‚ æ¼”åŒ–ä¼˜äºŽä¸€æ­¥åˆ°ä½ å…·ä½“å®žçŽ°åŸºäºŽéœ€æ±‚åŠEFKå¥—ä»¶ï¼Œæ¢³ç†æˆ‘ä»¬åœºæ™¯ä¸­ç‰¹æœ‰çš„ä¸œè¥¿ï¼š dockeræ—¥å¿—çš„åœºæ™¯æ¯”è¾ƒå•ä¸€ï¼Œéƒ½æ˜¯é€šè¿‡ä¹‹å‰ä¸€ä¸ªäº§å“Aå‘å¸ƒéƒ¨ç½²çš„ï¼Œå…¶dockerå‘½åè§„åˆ™æ¯”è¾ƒç»Ÿä¸€ï¼Œå¯ä»¥é€šè¿‡æˆªå–docker.container.nameæ¥èŽ·å–åº”ç”¨åå­—ï¼›åŒæ—¶åœ¨éƒ¨ç½²çš„æ—¶å€™ï¼Œå¯ä»¥çŸ¥é“éƒ¨ç½²ç›®æ ‡æœºå™¨çš„ipï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡åº”ç”¨+ipæ¥ä½œä¸ºå®žä¾‹åç§°ã€‚ k8såœºæ™¯ä¹Ÿæ¯”è¾ƒç»Ÿä¸€ï¼Œéƒ½æ˜¯é€šè¿‡ä¹‹å‰ä¸€ä¸ªäº§å“Bå‘å¸ƒéƒ¨ç½²çš„ï¼Œå…¶podå‘½åè§„åˆ™æ¯”è¾ƒç»Ÿä¸€ï¼Œå¯ä»¥é€šè¿‡æˆªå–kubernetes.pod.nameæ¥èŽ·å–åº”ç”¨åå­—ï¼ˆä½†éœ€è¦é€šè¿‡namespaceså…³è”åˆ°tenantï¼Œå†é€šè¿‡tenantä¸Žé¡¹ç›®ä¸€ä¸€å¯¹åº”ï¼‰ï¼›k8sä¸­çš„pod.nameå°±æ˜¯å”¯ä¸€çš„ï¼Œä»¥æ­¤æ¥ä½œä¸ºå®žä¾‹åç§°å³å¯ã€‚ æ–‡æœ¬æ—¥å¿—ï¼šå› ä¸ºæ–‡æœ¬æ—¥å¿—ä¸»è¦çš„åœºæ™¯æ˜¯å·²ç»è£¸æœºéƒ¨ç½²çš„åº”ç”¨ï¼Œè¿™ç§åœºæ™¯ä¸‹ï¼Œä¸å­˜åœ¨åº”ç”¨è‡ªåŠ¨è¿ç§»çš„æƒ…å†µï¼Œæ‰€ä»¥æ–‡æœ¬æ—¥å¿—çš„åº”ç”¨åç§°ã€å®žä¾‹åç§°å¯ä»¥åœ¨éƒ¨ç½²çš„æ—¶å€™æ‰“ä¸Šæ ‡ç­¾å³å¯ã€‚ å…·ä½“è§„åˆ™åŠè§£æžè§ä¸‹å›¾ï¼ˆå®žä¾‹éƒ¨åˆ†å¤„ç†æš‚æœªæ ‡æ³¨ï¼‰ï¼š æŽ¨èå†™æ—¥å¿—åˆ°æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨æ ‡å‡†è¾“å‡ºå°±å¥½ã€‚ åˆ°è¿™é‡Œå¯ä»¥å‘çŽ°æˆ‘ä»¬é€‰æ‹©Filebeatæ¥ä½œä¸ºæ—¥å¿—çš„æ”¶é›†ç«¯ï¼ŒElasticsearchæ¥å­˜å‚¨æ—¥å¿—å¹¶æä¾›æ£€ç´¢èƒ½åŠ›ã€‚ é‚£ä¹ˆï¼Œæ—¥å¿—çš„æ¸…æ´—åœ¨å“ªé‡Œåšå‘¢ï¼Ÿ æ—¥å¿—çš„æ¸…æ´—ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š å…ˆæŠŠæ—¥å¿—æ”¶é›†åˆ°kafkaï¼Œå†é€šè¿‡Logstashæ¶ˆè´¹kafkaçš„æ•°æ®ï¼Œæ¥æ¸…æ´—æ•°æ® ç›´æŽ¥é€šè¿‡Elasticsearchçš„[Ingest Node]æ¥æ¸…æ´—æ•°æ®ï¼Œå› ä¸ºIngest Nodeä¹Ÿæ”¯æŒGrokè¡¨è¾¾å¼ å¯¹äºŽï¼Œæˆ‘ä»¬çš„åœºæ™¯è€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦æ¸…æ´—æ•°æ®çš„è¦æ±‚æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯åº”ç”¨ã€å®žä¾‹åç§°çš„æˆªå–è¿˜æœ‰æ–‡æœ¬æ—¥å¿—ä¸­æ—¥å¿—æ—¶é—´çš„å¤„ç†ï¼ˆ@timestampé‡ç½®ï¼Œæ—¶åŒºå¤„ç†ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©äº†æ–¹æ¡ˆ2ã€‚ åœ¨æˆ‘ä»¬çš„æ–¹æ¡ˆä¸­ï¼Œå¹¶æ²¡æœ‰æä¾›Kibana çš„ç•Œé¢ç›´æŽ¥ç»™ç”¨æˆ·ç”¨ï¼Œè€Œæ˜¯æˆ‘ä»¬è‡ªå·±æ ¹æ®å…¬å¸ä¸šåŠ¡ç‹¬ç«‹å¼€å‘çš„ã€‚ å‰ç«¯ç•Œé¢ä¸ºä»€ä¹ˆä¸é‡‡ç”¨Kibanaï¼Œè€Œéœ€è¦è‡ªå·±å¼€å‘ï¼Ÿ kibanaå¯¹äºŽä¸šåŠ¡å¼€å‘äººå‘˜æœ‰ä¸€å®šçš„å­¦ä¹ æˆæœ¬ kibanaç•Œé¢æ²¡æœ‰å¾ˆå¥½çš„å°†æ—¥å¿—å†…å®¹ä¸Žä¸šåŠ¡æ„ä¹‰å…³è”èµ·æ¥ï¼ˆç•Œé¢é€‰æ‹©æ€»æ¯”ä¸€æ¬¡æ¬¡çš„è¾“å…¥è¦å¥½ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å°†æ—¥å¿—çš„é¡¹ç›®ã€åº”ç”¨ã€å®žä¾‹ç­‰ä¸šåŠ¡ä¿¡æ¯è§£æžå‡ºæ¥çš„åŽŸå› ï¼‰ log-searchæ”¯æŒQuery Stringï¼Œå› æ­¤å¯¹äºŽç†Ÿæ‚‰kibanaçš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œåœ¨æˆ‘ä»¬è‡ªå·±å¼€å‘çš„å‰ç«¯ç•Œé¢æ£€ç´¢æ•ˆæžœæ˜¯ä¸€æ ·çš„ã€‚ log-searchæä¾›çš„åŠŸèƒ½å¯ä»¥å‚è§githubï¼šhttps://github.com/jiankunking/log-search å¦‚æžœæ—¥å¿—éœ€è¦æ¸…æ´—çš„æ¯”è¾ƒå¤šï¼Œå¯ä»¥é‡‡ç”¨æ–¹æ¡ˆ1ï¼Œæˆ–è€…å…ˆä¸æ¸…æ´—ï¼Œå…ˆæŠŠæ•°æ®è½åˆ°Elasticsearchï¼Œç„¶åŽåœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œè¿›è¡Œå¤„ç†ã€‚æ¯”å¦‚åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ï¼Œå¯ä»¥å…ˆæŠŠæ—¥å¿—è½åˆ°Elasticsearchä¸­ï¼Œç„¶åŽåœ¨éœ€è¦æ£€ç´¢åº”ç”¨åç§°çš„æ—¶å€™ï¼Œé€šè¿‡ä»£ç æ¥å¤„ç†å¹¶èŽ·å–appåå­—ã€‚ ç›‘æŽ§ã€å‘Šè­¦å…¶å®žåŸºäºŽæ—¥å¿—å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚ï¼š åŸºäºŽæ—¥å¿—åšç›‘æŽ§ï¼ˆGoogle Dapperï¼‰ åŸºäºŽæ—¥å¿—åšå‘Šè­¦ åŸºäºŽæ—¥å¿—åšMachine Learning å…·ä½“æ€è·¯ï¼Œå¯ä»¥å‚è§ä¸‹å›¾ï¼š å‰æï¼šèƒ½è¦æ±‚ä½¿ç”¨æ–¹ï¼ŒæŒ‰ç…§æŸç§è§„åˆ™æ‰“å°æ—¥å¿—ã€‚ç›‘æŽ§å‘å±•ï¼šç›‘æŽ§åŸºæœ¬å°±æ˜¯å…ˆæ‰“é€šé“¾è·¯traceï¼Œç„¶åŽå†åœ¨ä¸ŠæŠ¥ä¿¡æ¯æˆ–è€…æ—¥å¿—ä¿¡æ¯ä¸­ï¼ŒåŠ å¼ºä¸šåŠ¡æ–¹é¢æ ‡è¯†ï¼Œå³ç»™ç›‘æŽ§æ·»åŠ ä¸šåŠ¡ç»´åº¦æ–¹é¢çš„è§†è§’ã€‚ å…¶å®ƒDaemonSetä»¥DaemonSetæ–¹å¼éƒ¨ç½²Filebeatæ¥æ”¶é›†æ—¥å¿—ï¼Œå…¶å®žæ”¶é›†ä¹Ÿæ˜¯å®¿ä¸»æœº/var/lib/docker/containersç›®å½•ä¸‹çš„æ—¥å¿—ã€‚Running Filebeat on Kubernetes Sidecarä¸€ä¸ªPODä¸­è¿è¡Œä¸€ä¸ªsidecarçš„æ—¥å¿—agentå®¹å™¨ï¼Œç”¨äºŽé‡‡é›†è¯¥PODä¸»å®¹å™¨äº§ç”Ÿçš„æ—¥å¿—ã€‚ èŽ«åæƒ³èµ·äº†istioã€‚ Filebeatå¯ä»¥ä»¥sidecaræ¨¡å¼æ¥è¿›è¡Œå®¹å™¨æ—¥å¿—çš„æ”¶é›†ï¼Œä¹Ÿå°±æ˜¯filebeatå’Œå…·ä½“çš„æœåŠ¡å®¹å™¨éƒ¨ç½²åœ¨åŒä¸€ä¸ªpodå†…ï¼ŒæŒ‡å®šæ”¶é›†æ—¥å¿—çš„è·¯å¾„æˆ–æ–‡ä»¶ï¼Œ&gt; å³å¯å°†æ—¥å¿—å‘é€åˆ°æŒ‡å®šä½ç½®æˆ–Elasticsearchè¿™ç±»çš„æœç´¢å¼•æ“Žã€‚æ¯ä¸ªpodå†…éƒ¨ç½²filebeatçš„æ¨¡å¼ï¼Œå¥½å¤„æ˜¯å’Œå…·ä½“çš„åº”ç”¨æœåŠ¡ä½Žè€¦åˆï¼Œå¯æ‰©å±•æ€§å¼ºï¼Œä¸è¿‡éœ€è¦åœ¨yamlè¿›è¡Œé¢å¤–é…ç½®ã€‚]]></content>
      <categories>
        <category>Architecture</category>
      </categories>
      <tags>
        <tag>Architecture</tag>
        <tag>Log</tag>
        <tag>Elasticsearch</tag>
        <tag>Filebeat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å½“ä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ google.com å¹¶ä¸”æŒ‰ä¸‹å›žè½¦ä¹‹åŽå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ]]></title>
    <url>%2Fwhat-happens-when.html</url>
    <content type="text"><![CDATA[å½“ä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ google.com å¹¶ä¸”æŒ‰ä¸‹å›žè½¦ä¹‹åŽå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿæ•´ç†è‡ª https://github.com/skyline75489/what-happens-when-zh_CN å½“Â·Â·Â·æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿè¿™ä¸ªä»“åº“è¯•å›¾å›žç­”ä¸€ä¸ªå¤è€çš„é¢è¯•é—®é¢˜ï¼šå½“ä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ google.com å¹¶ä¸”æŒ‰ä¸‹å›žè½¦ä¹‹åŽå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ ä¸è¿‡æˆ‘ä»¬ä¸å†å±€é™äºŽå¹³å¸¸çš„å›žç­”ï¼Œè€Œæ˜¯æƒ³åŠžæ³•å›žç­”åœ°å°½å¯èƒ½å…·ä½“ï¼Œä¸é—æ¼ä»»ä½•ç»†èŠ‚ã€‚ ç›®å½•æŒ‰ä¸‹â€gâ€é”®æŽ¥ä¸‹æ¥çš„å†…å®¹ä»‹ç»äº†ç‰©ç†é”®ç›˜å’Œç³»ç»Ÿä¸­æ–­çš„å·¥ä½œåŽŸç†ï¼Œä½†æ˜¯æœ‰ä¸€éƒ¨åˆ†å†…å®¹å´æ²¡æœ‰æ¶‰åŠã€‚å½“ä½ æŒ‰ä¸‹â€œgâ€é”®ï¼Œæµè§ˆå™¨æŽ¥æ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯ä¹‹åŽï¼Œä¼šè§¦å‘è‡ªåŠ¨å®Œæˆæœºåˆ¶ã€‚æµè§ˆå™¨æ ¹æ®è‡ªå·±çš„ç®—æ³•ï¼Œä»¥åŠä½ æ˜¯å¦å¤„äºŽéšç§æµè§ˆæ¨¡å¼ï¼Œä¼šåœ¨æµè§ˆå™¨çš„åœ°å€æ¡†ä¸‹æ–¹ç»™å‡ºè¾“å…¥å»ºè®®ã€‚å¤§éƒ¨åˆ†ç®—æ³•ä¼šä¼˜å…ˆè€ƒè™‘æ ¹æ®ä½ çš„æœç´¢åŽ†å²å’Œä¹¦ç­¾ç­‰å†…å®¹ç»™å‡ºå»ºè®®ã€‚ä½ æ‰“ç®—è¾“å…¥â€google.comâ€ï¼Œå› æ­¤ç»™å‡ºçš„å»ºè®®å¹¶ä¸åŒ¹é…ã€‚ä½†æ˜¯è¾“å…¥è¿‡ç¨‹ä¸­ä»ç„¶æœ‰å¤§é‡çš„ä»£ç åœ¨åŽå°è¿è¡Œï¼Œä½ çš„æ¯ä¸€æ¬¡æŒ‰é”®éƒ½ä¼šä½¿å¾—ç»™å‡ºçš„å»ºè®®æ›´åŠ å‡†ç¡®ã€‚ç”šè‡³æœ‰å¯èƒ½åœ¨ä½ è¾“å…¥ä¹‹å‰ï¼Œæµè§ˆå™¨å°±å°†â€google.comâ€ å»ºè®®ç»™ä½ ã€‚ å›žè½¦é”®æŒ‰ä¸‹ä¸ºäº†ä»Žé›¶å¼€å§‹ï¼Œæˆ‘ä»¬é€‰æ‹©é”®ç›˜ä¸Šçš„å›žè½¦é”®è¢«æŒ‰åˆ°æœ€ä½Žå¤„ä½œä¸ºèµ·ç‚¹ã€‚åœ¨è¿™ä¸ªæ—¶åˆ»ï¼Œä¸€ä¸ªä¸“ç”¨äºŽå›žè½¦é”®çš„ç”µæµå›žè·¯è¢«ç›´æŽ¥åœ°æˆ–è€…é€šè¿‡ç”µå®¹å™¨é—´æŽ¥åœ°é—­åˆäº†ï¼Œä½¿å¾—å°‘é‡çš„ç”µæµè¿›å…¥äº†é”®ç›˜çš„é€»è¾‘ç”µè·¯ç³»ç»Ÿã€‚è¿™ä¸ªç³»ç»Ÿä¼šæ‰«ææ¯ä¸ªé”®çš„çŠ¶æ€ï¼Œå¯¹äºŽæŒ‰é”®å¼€å…³çš„ç”µä½å¼¹è·³å˜åŒ–è¿›è¡Œå™ªéŸ³æ¶ˆé™¤(debounce)ï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸ºé”®ç›˜ç å€¼ã€‚åœ¨è¿™é‡Œï¼Œå›žè½¦çš„ç å€¼æ˜¯13ã€‚é”®ç›˜æŽ§åˆ¶å™¨åœ¨å¾—åˆ°ç å€¼ä¹‹åŽï¼Œå°†å…¶ç¼–ç ï¼Œç”¨äºŽä¹‹åŽçš„ä¼ è¾“ã€‚çŽ°åœ¨è¿™ä¸ªä¼ è¾“è¿‡ç¨‹å‡ ä¹Žéƒ½æ˜¯é€šè¿‡é€šç”¨ä¸²è¡Œæ€»çº¿(USB)æˆ–è€…è“ç‰™(Bluetooth)æ¥è¿›è¡Œçš„ï¼Œä»¥å‰æ˜¯é€šè¿‡PS/2æˆ–è€…ADBè¿žæŽ¥è¿›è¡Œã€‚ USBé”®ç›˜ï¼š é”®ç›˜çš„USBå…ƒä»¶é€šè¿‡è®¡ç®—æœºä¸Šçš„USBæŽ¥å£ä¸ŽUSBæŽ§åˆ¶å™¨ç›¸è¿žæŽ¥ï¼ŒUSBæŽ¥å£ä¸­çš„ç¬¬ä¸€å·é’ˆä¸ºå®ƒæä¾›äº†5Vçš„ç”µåŽ‹ é”®ç å€¼å­˜å‚¨åœ¨é”®ç›˜å†…éƒ¨ç”µè·¯ä¸€ä¸ªå«åšâ€endpointâ€çš„å¯„å­˜å™¨å†… USBæŽ§åˆ¶å™¨å¤§æ¦‚æ¯éš”10msä¾¿æŸ¥è¯¢ä¸€æ¬¡â€endpointâ€ä»¥å¾—åˆ°å­˜å‚¨çš„é”®ç å€¼æ•°æ®ï¼Œè¿™ä¸ªæœ€çŸ­æ—¶é—´é—´éš”ç”±é”®ç›˜æä¾› é”®å€¼ç å€¼é€šè¿‡USBä¸²è¡ŒæŽ¥å£å¼•æ“Žè¢«è½¬æ¢æˆä¸€ä¸ªæˆ–è€…å¤šä¸ªéµå¾ªä½Žå±‚USBåè®®çš„USBæ•°æ®åŒ… è¿™äº›æ•°æ®åŒ…é€šè¿‡D+é’ˆæˆ–è€…D-é’ˆ(ä¸­é—´çš„ä¸¤ä¸ªé’ˆ)ï¼Œä»¥æœ€é«˜1.5Mb/sçš„é€Ÿåº¦ä»Žé”®ç›˜ä¼ è¾“è‡³è®¡ç®—æœºã€‚é€Ÿåº¦é™åˆ¶æ˜¯å› ä¸ºäººæœºäº¤äº’è®¾å¤‡æ€»æ˜¯è¢«å£°æ˜Žæˆâ€ä½Žé€Ÿè®¾å¤‡â€ï¼ˆUSB 2.0 complianceï¼‰ è¿™ä¸ªä¸²è¡Œä¿¡å·åœ¨è®¡ç®—æœºçš„USBæŽ§åˆ¶å™¨å¤„è¢«è§£ç ï¼Œç„¶åŽè¢«äººæœºäº¤äº’è®¾å¤‡é€šç”¨é”®ç›˜é©±åŠ¨è¿›è¡Œè¿›ä¸€æ­¥è§£é‡Šã€‚ä¹‹åŽæŒ‰é”®çš„ç å€¼è¢«ä¼ è¾“åˆ°æ“ä½œç³»ç»Ÿçš„ç¡¬ä»¶æŠ½è±¡å±‚ è™šæ‹Ÿé”®ç›˜ï¼ˆè§¦å±è®¾å¤‡ï¼‰ï¼š åœ¨çŽ°ä»£ç”µå®¹å±ä¸Šï¼Œå½“ç”¨æˆ·æŠŠæ‰‹æŒ‡æ”¾åœ¨å±å¹•ä¸Šæ—¶ï¼Œä¸€å°éƒ¨åˆ†ç”µæµä»Žä¼ å¯¼å±‚çš„é™ç”µåŸŸç»è¿‡æ‰‹æŒ‡ä¼ å¯¼ï¼Œå½¢æˆäº†ä¸€ä¸ªå›žè·¯ï¼Œä½¿å¾—å±å¹•ä¸Šè§¦æŽ§çš„é‚£ä¸€ç‚¹ç”µåŽ‹ä¸‹é™ï¼Œå±å¹•æŽ§åˆ¶å™¨äº§ç”Ÿä¸€ä¸ªä¸­æ–­ï¼ŒæŠ¥å‘Šè¿™æ¬¡â€œç‚¹å‡»â€çš„åæ ‡ ç„¶åŽç§»åŠ¨æ“ä½œç³»ç»Ÿé€šçŸ¥å½“å‰æ´»è·ƒçš„åº”ç”¨ï¼Œæœ‰ä¸€ä¸ªç‚¹å‡»äº‹ä»¶å‘ç”Ÿåœ¨å®ƒçš„æŸä¸ªGUIéƒ¨ä»¶ä¸Šäº†ï¼ŒçŽ°åœ¨è¿™ä¸ªéƒ¨ä»¶æ˜¯è™šæ‹Ÿé”®ç›˜çš„æŒ‰é’® è™šæ‹Ÿé”®ç›˜å¼•å‘ä¸€ä¸ªè½¯ä¸­æ–­ï¼Œè¿”å›žç»™OSä¸€ä¸ªâ€œæŒ‰é”®æŒ‰ä¸‹â€æ¶ˆæ¯ è¿™ä¸ªæ¶ˆæ¯åˆè¿”å›žæ¥å‘å½“å‰æ´»è·ƒçš„åº”ç”¨é€šçŸ¥ä¸€ä¸ªâ€œæŒ‰é”®æŒ‰ä¸‹â€äº‹ä»¶ äº§ç”Ÿä¸­æ–­[éžUSBé”®ç›˜]é”®ç›˜åœ¨å®ƒçš„ä¸­æ–­è¯·æ±‚çº¿(IRQ)ä¸Šå‘é€ä¿¡å·ï¼Œä¿¡å·ä¼šè¢«ä¸­æ–­æŽ§åˆ¶å™¨æ˜ å°„åˆ°ä¸€ä¸ªä¸­æ–­å‘é‡ï¼Œå®žé™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ•´åž‹æ•°ã€‚CPUä½¿ç”¨ä¸­æ–­æè¿°ç¬¦è¡¨(IDT)æŠŠä¸­æ–­å‘é‡æ˜ å°„åˆ°å¯¹åº”å‡½æ•°ï¼Œè¿™äº›å‡½æ•°è¢«ç§°ä¸ºä¸­æ–­å¤„ç†å™¨ï¼Œå®ƒä»¬ç”±æ“ä½œç³»ç»Ÿå†…æ ¸æä¾›ã€‚å½“ä¸€ä¸ªä¸­æ–­åˆ°è¾¾æ—¶ï¼ŒCPUæ ¹æ®IDTå’Œä¸­æ–­å‘é‡ç´¢å¼•åˆ°å¯¹åº”çš„ä¸­æ–­å¤„ç†å™¨ï¼Œç„¶åŽæ“ä½œç³»ç»Ÿå†…æ ¸å‡ºåœºäº†ã€‚ (Windows)ä¸€ä¸ª WM_KEYDOWN æ¶ˆæ¯è¢«å‘å¾€åº”ç”¨ç¨‹åºHIDæŠŠé”®ç›˜æŒ‰ä¸‹çš„äº‹ä»¶ä¼ é€ç»™ KBDHID.sysé©±åŠ¨ï¼ŒæŠŠHIDçš„ä¿¡å·è½¬æ¢æˆä¸€ä¸ªæ‰«æç (Scancode)ï¼Œè¿™é‡Œå›žè½¦çš„æ‰«æç æ˜¯VK_RETURN(0x0d)ã€‚ KBDHID.sys é©±åŠ¨å’Œ KBDCLASS.sys(é”®ç›˜ç±»é©±åŠ¨,keyboard class driver)è¿›è¡Œäº¤äº’ï¼Œè¿™ä¸ªé©±åŠ¨è´Ÿè´£å®‰å…¨åœ°å¤„ç†æ‰€æœ‰é”®ç›˜å’Œå°é”®ç›˜çš„è¾“å…¥äº‹ä»¶ã€‚ä¹‹åŽå®ƒåˆåŽ»è°ƒç”¨Win32K.sysï¼Œåœ¨è¿™ä¹‹å‰æœ‰å¯èƒ½æŠŠæ¶ˆæ¯ä¼ é€’ç»™å®‰è£…çš„ç¬¬ä¸‰æ–¹é”®ç›˜è¿‡æ»¤å™¨ã€‚è¿™äº›éƒ½æ˜¯å‘ç”Ÿåœ¨å†…æ ¸æ¨¡å¼ã€‚ Win32K.sys é€šè¿‡ GetForegroundWindow()APIå‡½æ•°æ‰¾åˆ°å½“å‰å“ªä¸ªçª—å£æ˜¯æ´»è·ƒçš„ã€‚è¿™ä¸ªAPIå‡½æ•°æä¾›äº†å½“å‰æµè§ˆå™¨çš„åœ°å€æ çš„å¥æŸ„ã€‚Windowsç³»ç»Ÿçš„â€message pumpâ€æœºåˆ¶è°ƒç”¨ SendMessage(hWnd, WM_KEYDOWN, VK_RETURN, lParam) å‡½æ•°ï¼ŒlParamæ˜¯ä¸€ä¸ªç”¨æ¥æŒ‡ç¤ºè¿™ä¸ªæŒ‰é”®çš„æ›´å¤šä¿¡æ¯çš„æŽ©ç ï¼Œè¿™äº›ä¿¡æ¯åŒ…æ‹¬æŒ‰é”®é‡å¤æ¬¡æ•°ï¼ˆè¿™é‡Œæ˜¯0ï¼‰ï¼Œå®žé™…æ‰«æç ï¼ˆå¯èƒ½ä¾èµ–äºŽOEMåŽ‚å•†ï¼Œä¸è¿‡é€šå¸¸ä¸ä¼šæ˜¯VK_RETURN ï¼‰ï¼ŒåŠŸèƒ½é”®ï¼ˆalt, shift, ctrlï¼‰æ˜¯å¦è¢«æŒ‰ä¸‹ï¼ˆåœ¨è¿™é‡Œæ²¡æœ‰ï¼‰ï¼Œä»¥åŠä¸€äº›å…¶ä»–çŠ¶æ€ã€‚ Windowsçš„ SendMessage APIç›´æŽ¥å°†æ¶ˆæ¯æ·»åŠ åˆ°ç‰¹å®šçª—å£å¥æŸ„ hWndçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œä¹‹åŽèµ‹ç»™ hWnd çš„ä¸»è¦æ¶ˆæ¯å¤„ç†å‡½æ•° WindowProcå°†ä¼šè¢«è°ƒç”¨ï¼Œç”¨äºŽå¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚ å½“å‰æ´»è·ƒçš„å¥æŸ„ hWnd å®žé™…ä¸Šæ˜¯ä¸€ä¸ªedit controlæŽ§ä»¶ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒWindowProc æœ‰ä¸€ä¸ªç”¨äºŽå¤„ç† WM_KEYDOWNæ¶ˆæ¯çš„å¤„ç†å™¨ï¼Œè¿™æ®µä»£ç ä¼šæŸ¥çœ‹ SendMessage ä¼ å…¥çš„ç¬¬ä¸‰ä¸ªå‚æ•° wParamï¼Œå› ä¸ºè¿™ä¸ªå‚æ•°æ˜¯ VK_RETURN ï¼ŒäºŽæ˜¯å®ƒçŸ¥é“ç”¨æˆ·æŒ‰ä¸‹äº†å›žè½¦é”®ã€‚ (Mac OS X)ä¸€ä¸ª KeyDown NSEventè¢«å‘å¾€åº”ç”¨ç¨‹åºä¸­æ–­ä¿¡å·å¼•å‘äº†I/O Kit Kexté”®ç›˜é©±åŠ¨çš„ä¸­æ–­å¤„ç†äº‹ä»¶ï¼Œé©±åŠ¨æŠŠä¿¡å·ç¿»è¯‘æˆé”®ç å€¼ï¼Œç„¶åŽä¼ ç»™OS Xçš„WindowServer è¿›ç¨‹ã€‚ç„¶åŽï¼Œ WindowServerå°†è¿™ä¸ªäº‹ä»¶é€šè¿‡Machç«¯å£åˆ†å‘ç»™åˆé€‚çš„ï¼ˆæ´»è·ƒçš„ï¼Œæˆ–è€…æ­£åœ¨ç›‘å¬çš„ï¼‰åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªä¿¡å·ä¼šè¢«æ”¾åˆ°åº”ç”¨ç¨‹åºçš„æ¶ˆæ¯é˜Ÿåˆ—é‡Œã€‚é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å¯ä»¥è¢«æ‹¥æœ‰è¶³å¤Ÿé«˜æƒé™çš„çº¿ç¨‹ä½¿ç”¨mach_ipc_dispatch å‡½æ•°è¯»å–åˆ°ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸æ˜¯ç”± NSApplicationä¸»äº‹ä»¶å¾ªçŽ¯äº§ç”Ÿå¹¶ä¸”å¤„ç†çš„ï¼Œé€šè¿‡ NSEventType ä¸º KeyDown çš„ NSEventã€‚ (GNU/Linux)Xorg æœåŠ¡å™¨ç›‘å¬é”®ç å€¼å½“ä½¿ç”¨å›¾å½¢åŒ–çš„ X Server æ—¶ï¼ŒX Serverä¼šæŒ‰ç…§ç‰¹å®šçš„è§„åˆ™æŠŠé”®ç å€¼å†ä¸€æ¬¡æ˜ å°„ï¼Œæ˜ å°„æˆæ‰«æç ã€‚å½“è¿™ä¸ªæ˜ å°„è¿‡ç¨‹å®Œæˆä¹‹åŽï¼ŒX Server æŠŠè¿™ä¸ªæŒ‰é”®å­—ç¬¦å‘é€ç»™çª—å£ç®¡ç†å™¨(DWMï¼Œmetacity,i3ç­‰ç­‰)ï¼Œçª—å£ç®¡ç†å™¨å†æŠŠå­—ç¬¦å‘é€ç»™å½“å‰çª—å£ã€‚å½“å‰çª—å£ä½¿ç”¨æœ‰å…³å›¾å½¢APIæŠŠæ–‡å­—æ‰“å°åœ¨è¾“å…¥æ¡†å†…ã€‚ è§£æžURL æµè§ˆå™¨é€šè¿‡ URL èƒ½å¤ŸçŸ¥é“ä¸‹é¢çš„ä¿¡æ¯ï¼š Protocol â€œhttpâ€ä½¿ç”¨HTTPåè®® Resource â€œ/â€œè¯·æ±‚çš„èµ„æºæ˜¯ä¸»é¡µ(index) è¾“å…¥çš„æ˜¯ URL è¿˜æ˜¯æœç´¢çš„å…³é”®å­—ï¼Ÿå½“åè®®æˆ–ä¸»æœºåä¸åˆæ³•æ—¶ï¼Œæµè§ˆå™¨ä¼šå°†åœ°å€æ ä¸­è¾“å…¥çš„æ–‡å­—ä¼ ç»™é»˜è®¤çš„æœç´¢å¼•æ“Žã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œåœ¨æŠŠæ–‡å­—ä¼ é€’ç»™æœç´¢å¼•æ“Žçš„æ—¶å€™ï¼ŒURLä¼šå¸¦æœ‰ç‰¹å®šçš„ä¸€ä¸²å­—ç¬¦ï¼Œç”¨æ¥å‘Šè¯‰æœç´¢å¼•æ“Žè¿™æ¬¡æœç´¢æ¥è‡ªè¿™ä¸ªç‰¹å®šæµè§ˆå™¨ã€‚ è½¬æ¢éž ASCII çš„ Unicode å­—ç¬¦ æµè§ˆå™¨æ£€æŸ¥è¾“å…¥æ˜¯å¦å«æœ‰ä¸æ˜¯ a-zï¼Œ A-Zï¼Œ0-9ï¼Œ - æˆ–è€… . çš„å­—ç¬¦ è¿™é‡Œä¸»æœºåæ˜¯ google.comï¼Œæ‰€ä»¥æ²¡æœ‰éžASCIIçš„å­—ç¬¦ï¼›å¦‚æžœæœ‰çš„è¯ï¼Œæµè§ˆå™¨ä¼šå¯¹ä¸»æœºåéƒ¨åˆ†ä½¿ç”¨Punycode ç¼–ç  æ£€æŸ¥ HSTS åˆ—è¡¨ æµè§ˆå™¨æ£€æŸ¥è‡ªå¸¦çš„â€œé¢„åŠ è½½ HSTSï¼ˆHTTPä¸¥æ ¼ä¼ è¾“å®‰å…¨ï¼‰â€åˆ—è¡¨ï¼Œè¿™ä¸ªåˆ—è¡¨é‡ŒåŒ…å«äº†é‚£äº›è¯·æ±‚æµè§ˆå™¨åªä½¿ç”¨HTTPSè¿›è¡Œè¿žæŽ¥çš„ç½‘ç«™ å¦‚æžœç½‘ç«™åœ¨è¿™ä¸ªåˆ—è¡¨é‡Œï¼Œæµè§ˆå™¨ä¼šä½¿ç”¨ HTTPS è€Œä¸æ˜¯ HTTPåè®®ï¼Œå¦åˆ™ï¼Œæœ€åˆçš„è¯·æ±‚ä¼šä½¿ç”¨HTTPåè®®å‘é€ æ³¨æ„ï¼Œä¸€ä¸ªç½‘ç«™å“ªæ€•ä¸åœ¨ HSTS åˆ—è¡¨é‡Œï¼Œä¹Ÿå¯ä»¥è¦æ±‚æµè§ˆå™¨å¯¹è‡ªå·±ä½¿ç”¨ HSTS æ”¿ç­–è¿›è¡Œè®¿é—®ã€‚æµè§ˆå™¨å‘ç½‘ç«™å‘å‡ºç¬¬ä¸€ä¸ªHTTPè¯·æ±‚ä¹‹åŽï¼Œç½‘ç«™ä¼šè¿”å›žæµè§ˆå™¨ä¸€ä¸ªå“åº”ï¼Œè¯·æ±‚æµè§ˆå™¨åªä½¿ç”¨ HTTPS å‘é€è¯·æ±‚ã€‚ç„¶è€Œï¼Œå°±æ˜¯è¿™ç¬¬ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œå´å¯èƒ½ä¼šä½¿ç”¨æˆ·å—åˆ°downgrade attack_ çš„å¨èƒï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆçŽ°ä»£æµè§ˆå™¨éƒ½é¢„ç½®äº† HSTS åˆ—è¡¨ã€‚ DNS æŸ¥è¯¢ æµè§ˆå™¨æ£€æŸ¥åŸŸåæ˜¯å¦åœ¨ç¼“å­˜å½“ä¸­ï¼ˆè¦æŸ¥çœ‹ Chrome å½“ä¸­çš„ç¼“å­˜ï¼Œ æ‰“å¼€chrome://net-internals/#dnsï¼‰ã€‚ å¦‚æžœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œå°±åŽ»è°ƒç”¨ gethostbynameåº“å‡½æ•°ï¼ˆæ“ä½œç³»ç»Ÿä¸åŒå‡½æ•°ä¹Ÿä¸åŒï¼‰è¿›è¡ŒæŸ¥è¯¢ã€‚ gethostbyname å‡½æ•°åœ¨è¯•å›¾è¿›è¡ŒDNSè§£æžä¹‹å‰é¦–å…ˆæ£€æŸ¥åŸŸåæ˜¯å¦åœ¨æœ¬åœ°Hosts é‡Œï¼ŒHosts çš„ä½ç½®ä¸åŒçš„æ“ä½œç³»ç»Ÿæœ‰æ‰€ä¸åŒ å¦‚æžœ gethostbyname æ²¡æœ‰è¿™ä¸ªåŸŸåçš„ç¼“å­˜è®°å½•ï¼Œä¹Ÿæ²¡æœ‰åœ¨ hostsé‡Œæ‰¾åˆ°ï¼Œå®ƒå°†ä¼šå‘ DNS æœåŠ¡å™¨å‘é€ä¸€æ¡ DNS æŸ¥è¯¢è¯·æ±‚ã€‚DNSæœåŠ¡å™¨æ˜¯ç”±ç½‘ç»œé€šä¿¡æ ˆæä¾›çš„ï¼Œé€šå¸¸æ˜¯æœ¬åœ°è·¯ç”±å™¨æˆ–è€… ISP çš„ç¼“å­˜ DNS æœåŠ¡å™¨ã€‚ æŸ¥è¯¢æœ¬åœ° DNS æœåŠ¡å™¨ å¦‚æžœ DNS æœåŠ¡å™¨å’Œæˆ‘ä»¬çš„ä¸»æœºåœ¨åŒä¸€ä¸ªå­ç½‘å†…ï¼Œç³»ç»Ÿä¼šæŒ‰ç…§ä¸‹é¢çš„ ARP è¿‡ç¨‹å¯¹ DNS æœåŠ¡å™¨è¿›è¡Œ ARPæŸ¥è¯¢ å¦‚æžœ DNS æœåŠ¡å™¨å’Œæˆ‘ä»¬çš„ä¸»æœºåœ¨ä¸åŒçš„å­ç½‘ï¼Œç³»ç»Ÿä¼šæŒ‰ç…§ä¸‹é¢çš„ ARP è¿‡ç¨‹å¯¹é»˜è®¤ç½‘å…³è¿›è¡ŒæŸ¥è¯¢ ARP è¿‡ç¨‹è¦æƒ³å‘é€ ARPï¼ˆåœ°å€è§£æžåè®®ï¼‰å¹¿æ’­ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªç›®æ ‡ IPåœ°å€ï¼ŒåŒæ—¶è¿˜éœ€è¦çŸ¥é“ç”¨äºŽå‘é€ ARP å¹¿æ’­çš„æŽ¥å£çš„ MAC åœ°å€ã€‚ é¦–å…ˆæŸ¥è¯¢ ARP ç¼“å­˜ï¼Œå¦‚æžœç¼“å­˜å‘½ä¸­ï¼Œæˆ‘ä»¬è¿”å›žç»“æžœï¼šç›®æ ‡ IP = MAC å¦‚æžœç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼š æŸ¥çœ‹è·¯ç”±è¡¨ï¼Œçœ‹çœ‹ç›®æ ‡ IP åœ°å€æ˜¯ä¸æ˜¯åœ¨æœ¬åœ°è·¯ç”±è¡¨ä¸­çš„æŸä¸ªå­ç½‘å†…ã€‚æ˜¯çš„è¯ï¼Œä½¿ç”¨è·Ÿé‚£ä¸ªå­ç½‘ç›¸è¿žçš„æŽ¥å£ï¼Œå¦åˆ™ä½¿ç”¨ä¸Žé»˜è®¤ç½‘å…³ç›¸è¿žçš„æŽ¥å£ã€‚ æŸ¥è¯¢é€‰æ‹©çš„ç½‘ç»œæŽ¥å£çš„ MAC åœ°å€ æˆ‘ä»¬å‘é€ä¸€ä¸ªäºŒå±‚ï¼ˆ OSI æ¨¡åž‹_ ä¸­çš„æ•°æ®é“¾è·¯å±‚ï¼‰ARP è¯·æ±‚ï¼š ARP Request: Sender MAC: interface:mac:address:here Sender IP: interface.ip.goes.here Target MAC: FF:FF:FF:FF:FF:FF (Broadcast) Target IP: target.ip.goes.hereæ ¹æ®è¿žæŽ¥ä¸»æœºå’Œè·¯ç”±å™¨çš„ç¡¬ä»¶ç±»åž‹ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µï¼š ç›´è¿žï¼š å¦‚æžœæˆ‘ä»¬å’Œè·¯ç”±å™¨æ˜¯ç›´æŽ¥è¿žæŽ¥çš„ï¼Œè·¯ç”±å™¨ä¼šè¿”å›žä¸€ä¸ª ARP Replyï¼ˆè§ä¸‹é¢ï¼‰ã€‚ é›†çº¿å™¨ï¼š å¦‚æžœæˆ‘ä»¬è¿žæŽ¥åˆ°ä¸€ä¸ªé›†çº¿å™¨ï¼Œé›†çº¿å™¨ä¼šæŠŠ ARP è¯·æ±‚å‘æ‰€æœ‰å…¶å®ƒç«¯å£å¹¿æ’­ï¼Œå¦‚æžœè·¯ç”±å™¨ä¹Ÿâ€œè¿žæŽ¥â€åœ¨å…¶ä¸­ï¼Œå®ƒä¼šè¿”å›žä¸€ä¸ª ARP Reply ã€‚ äº¤æ¢æœºï¼š å¦‚æžœæˆ‘ä»¬è¿žæŽ¥åˆ°äº†ä¸€ä¸ªäº¤æ¢æœºï¼Œäº¤æ¢æœºä¼šæ£€æŸ¥æœ¬åœ° CAM/MAC è¡¨ï¼Œçœ‹çœ‹å“ªä¸ªç«¯å£æœ‰æˆ‘ä»¬è¦æ‰¾çš„é‚£ä¸ª MACåœ°å€ï¼Œå¦‚æžœæ²¡æœ‰æ‰¾åˆ°ï¼Œäº¤æ¢æœºä¼šå‘æ‰€æœ‰å…¶å®ƒç«¯å£å¹¿æ’­è¿™ä¸ª ARP è¯·æ±‚ã€‚ å¦‚æžœäº¤æ¢æœºçš„ MAC/CAM è¡¨ä¸­æœ‰å¯¹åº”çš„æ¡ç›®ï¼Œäº¤æ¢æœºä¼šå‘æœ‰æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢çš„ MAC åœ°å€çš„é‚£ä¸ªç«¯å£å‘é€ ARP è¯·æ±‚ å¦‚æžœè·¯ç”±å™¨ä¹Ÿâ€œè¿žæŽ¥â€åœ¨å…¶ä¸­ï¼Œå®ƒä¼šè¿”å›žä¸€ä¸ª ARP Reply ARP Reply: Sender MAC: target:mac:address:here Sender IP: target.ip.goes.here Target MAC: interface:mac:address:here Target IP: interface.ip.goes.hereçŽ°åœ¨æˆ‘ä»¬æœ‰äº† DNS æœåŠ¡å™¨æˆ–è€…é»˜è®¤ç½‘å…³çš„ IP åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­ DNS è¯·æ±‚äº†ï¼š ä½¿ç”¨ 53 ç«¯å£å‘ DNS æœåŠ¡å™¨å‘é€ UDP è¯·æ±‚åŒ…ï¼Œå¦‚æžœå“åº”åŒ…å¤ªå¤§ï¼Œä¼šä½¿ç”¨ TCP åè®® å¦‚æžœæœ¬åœ°/ISP DNSæœåŠ¡å™¨æ²¡æœ‰æ‰¾åˆ°ç»“æžœï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªé€’å½’æŸ¥è¯¢è¯·æ±‚ï¼Œä¸€å±‚ä¸€å±‚å‘é«˜å±‚DNSæœåŠ¡å™¨åšæŸ¥è¯¢ï¼Œç›´åˆ°æŸ¥è¯¢åˆ°èµ·å§‹æŽˆæƒæœºæž„ï¼Œå¦‚æžœæ‰¾åˆ°ä¼šæŠŠç»“æžœè¿”å›ž ä½¿ç”¨å¥—æŽ¥å­—å½“æµè§ˆå™¨å¾—åˆ°äº†ç›®æ ‡æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œä»¥åŠ URL ä¸­ç»™å‡ºæ¥ç«¯å£å·ï¼ˆhttp åè®®é»˜è®¤ç«¯å£å·æ˜¯ 80ï¼Œ https é»˜è®¤ç«¯å£å·æ˜¯ 443ï¼‰ï¼Œå®ƒä¼šè°ƒç”¨ç³»ç»Ÿåº“å‡½æ•°socket ï¼Œè¯·æ±‚ä¸€ä¸ª TCPæµå¥—æŽ¥å­—ï¼Œå¯¹åº”çš„å‚æ•°æ˜¯ AF_INET/AF_INET6 å’ŒSOCK_STREAM ã€‚ è¿™ä¸ªè¯·æ±‚é¦–å…ˆè¢«äº¤ç»™ä¼ è¾“å±‚ï¼Œåœ¨ä¼ è¾“å±‚è¯·æ±‚è¢«å°è£…æˆ TCP segmentã€‚ç›®æ ‡ç«¯å£ä¼šè¢«åŠ å…¥å¤´éƒ¨ï¼Œæºç«¯å£ä¼šåœ¨ç³»ç»Ÿå†…æ ¸çš„åŠ¨æ€ç«¯å£èŒƒå›´å†…é€‰å–ï¼ˆLinuxä¸‹æ˜¯ip_local_port_range) TCP segment è¢«é€å¾€ç½‘ç»œå±‚ï¼Œç½‘ç»œå±‚ä¼šåœ¨å…¶ä¸­å†åŠ å…¥ä¸€ä¸ª IP å¤´éƒ¨ï¼Œé‡Œé¢åŒ…å«äº†ç›®æ ‡æœåŠ¡å™¨çš„IPåœ°å€ä»¥åŠæœ¬æœºçš„IPåœ°å€ï¼ŒæŠŠå®ƒå°è£…æˆä¸€ä¸ªIP packetã€‚ è¿™ä¸ª TCP packet æŽ¥ä¸‹æ¥ä¼šè¿›å…¥é“¾è·¯å±‚ï¼Œé“¾è·¯å±‚ä¼šåœ¨å°åŒ…ä¸­åŠ å…¥ frame å¤´éƒ¨ï¼Œé‡Œé¢åŒ…å«äº†æœ¬åœ°å†…ç½®ç½‘å¡çš„MACåœ°å€ä»¥åŠç½‘å…³ï¼ˆæœ¬åœ°è·¯ç”±å™¨ï¼‰çš„ MAC åœ°å€ã€‚åƒå‰é¢è¯´çš„ä¸€æ ·ï¼Œå¦‚æžœå†…æ ¸ä¸çŸ¥é“ç½‘å…³çš„ MAC åœ°å€ï¼Œå®ƒå¿…é¡»è¿›è¡Œ ARP å¹¿æ’­æ¥æŸ¥è¯¢å…¶åœ°å€ã€‚ åˆ°äº†çŽ°åœ¨ï¼ŒTCP å°åŒ…å·²ç»å‡†å¤‡å¥½äº†ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼è¿›è¡Œä¼ è¾“ï¼š ä»¥å¤ªç½‘ WiFi èœ‚çªæ•°æ®ç½‘ç»œ å¯¹äºŽå¤§éƒ¨åˆ†å®¶åº­ç½‘ç»œå’Œå°åž‹ä¼ä¸šç½‘ç»œæ¥è¯´ï¼Œå°åŒ…ä¼šä»Žæœ¬åœ°è®¡ç®—æœºå‡ºå‘ï¼Œç»è¿‡æœ¬åœ°ç½‘ç»œï¼Œå†é€šè¿‡è°ƒåˆ¶è§£è°ƒå™¨æŠŠæ•°å­—ä¿¡å·è½¬æ¢æˆæ¨¡æ‹Ÿä¿¡å·ï¼Œä½¿å…¶é€‚äºŽåœ¨ç”µè¯çº¿è·¯ï¼Œæœ‰çº¿ç”µè§†å…‰ç¼†å’Œæ— çº¿ç”µè¯çº¿è·¯ä¸Šä¼ è¾“ã€‚åœ¨ä¼ è¾“çº¿è·¯çš„å¦ä¸€ç«¯ï¼Œæ˜¯å¦å¤–ä¸€ä¸ªè°ƒåˆ¶è§£è°ƒå™¨ï¼Œå®ƒæŠŠæ¨¡æ‹Ÿä¿¡å·è½¬æ¢å›žæ•°å­—ä¿¡å·ï¼Œäº¤ç”±ä¸‹ä¸€ä¸ªç½‘ç»œèŠ‚ç‚¹å¤„ç†ã€‚èŠ‚ç‚¹çš„ç›®æ ‡åœ°å€å’Œæºåœ°å€å°†åœ¨åŽé¢è®¨è®ºã€‚ å¤§åž‹ä¼ä¸šå’Œæ¯”è¾ƒæ–°çš„ä½å®…é€šå¸¸ä½¿ç”¨å…‰çº¤æˆ–ç›´æŽ¥ä»¥å¤ªç½‘è¿žæŽ¥ï¼Œè¿™ç§æƒ…å†µä¸‹ä¿¡å·ä¸€ç›´æ˜¯æ•°å­—çš„ï¼Œä¼šè¢«ç›´æŽ¥ä¼ åˆ°ä¸‹ä¸€ä¸ªç½‘ç»œèŠ‚ç‚¹è¿›è¡Œå¤„ç†ã€‚ æœ€ç»ˆå°åŒ…ä¼šåˆ°è¾¾ç®¡ç†æœ¬åœ°å­ç½‘çš„è·¯ç”±å™¨ã€‚åœ¨é‚£é‡Œå‡ºå‘ï¼Œå®ƒä¼šç»§ç»­ç»è¿‡è‡ªæ²»åŒºåŸŸ(autonomous system, ç¼©å†™AS)çš„è¾¹ç•Œè·¯ç”±å™¨ï¼Œå…¶ä»–è‡ªæ²»åŒºåŸŸï¼Œæœ€ç»ˆåˆ°è¾¾ç›®æ ‡æœåŠ¡å™¨ã€‚ä¸€è·¯ä¸Šç»è¿‡çš„è¿™äº›è·¯ç”±å™¨ä¼šä»ŽIPæ•°æ®æŠ¥å¤´éƒ¨é‡Œæå–å‡ºç›®æ ‡åœ°å€ï¼Œå¹¶å°†å°åŒ…æ­£ç¡®åœ°è·¯ç”±åˆ°ä¸‹ä¸€ä¸ªç›®çš„åœ°ã€‚IPæ•°æ®æŠ¥å¤´éƒ¨time to live (TTL)åŸŸçš„å€¼æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨å°±å‡1ï¼Œå¦‚æžœå°åŒ…çš„TTLå˜ä¸º0ï¼Œæˆ–è€…è·¯ç”±å™¨ç”±äºŽç½‘ç»œæ‹¥å µç­‰åŽŸå› å°åŒ…é˜Ÿåˆ—æ»¡äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…ä¼šè¢«è·¯ç”±å™¨ä¸¢å¼ƒã€‚ ä¸Šé¢çš„å‘é€å’ŒæŽ¥å—è¿‡ç¨‹åœ¨ TCP è¿žæŽ¥æœŸé—´ä¼šå‘ç”Ÿå¾ˆå¤šæ¬¡ï¼š å®¢æˆ·ç«¯é€‰æ‹©ä¸€ä¸ªåˆå§‹åºåˆ—å·(ISN)ï¼Œå°†è®¾ç½®äº† SYN ä½çš„å°åŒ…å‘é€ç»™æœåŠ¡å™¨ç«¯ï¼Œè¡¨æ˜Žè‡ªå·±è¦å»ºç«‹è¿žæŽ¥å¹¶è®¾ç½®äº†åˆå§‹åºåˆ—å· æœåŠ¡å™¨ç«¯æŽ¥æ”¶åˆ° SYN åŒ…ï¼Œå¦‚æžœå®ƒå¯ä»¥å»ºç«‹è¿žæŽ¥ï¼š - æœåŠ¡å™¨ç«¯é€‰æ‹©å®ƒè‡ªå·±çš„åˆå§‹åºåˆ—å· - æœåŠ¡å™¨ç«¯è®¾ç½® SYN ä½ï¼Œè¡¨æ˜Žè‡ªå·±é€‰æ‹©äº†ä¸€ä¸ªåˆå§‹åºåˆ—å· - æœåŠ¡å™¨ç«¯æŠŠ (å®¢æˆ·ç«¯ISN + 1) å¤åˆ¶åˆ° ACK åŸŸï¼Œå¹¶ä¸”è®¾ç½® ACK ä½ï¼Œè¡¨æ˜Žè‡ªå·±æŽ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„ç¬¬ä¸€ä¸ªå°åŒ… å®¢æˆ·ç«¯é€šè¿‡å‘é€ä¸‹é¢ä¸€ä¸ªå°åŒ…æ¥ç¡®è®¤è¿™æ¬¡è¿žæŽ¥ï¼š - è‡ªå·±çš„åºåˆ—å·+1 - æŽ¥æ”¶ç«¯ ACK+1 - è®¾ç½® ACK ä½ æ•°æ®é€šè¿‡ä¸‹é¢çš„æ–¹å¼ä¼ è¾“ï¼š - å½“ä¸€æ–¹å‘é€äº†Nä¸ª Bytes çš„æ•°æ®ä¹‹åŽï¼Œå°†è‡ªå·±çš„ SEQ åºåˆ—å·ä¹Ÿå¢žåŠ N - å¦ä¸€æ–¹ç¡®è®¤æŽ¥æ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…ï¼ˆæˆ–è€…ä¸€ç³»åˆ—æ•°æ®åŒ…ï¼‰ä¹‹åŽï¼Œå®ƒå‘é€ä¸€ä¸ª ACKåŒ…ï¼ŒACKçš„å€¼è®¾ç½®ä¸ºæŽ¥æ”¶åˆ°çš„æ•°æ®åŒ…çš„æœ€åŽä¸€ä¸ªåºåˆ—å· å…³é—­è¿žæŽ¥æ—¶ï¼š - è¦å…³é—­è¿žæŽ¥çš„ä¸€æ–¹å‘é€ä¸€ä¸ª FIN åŒ… - å¦ä¸€æ–¹ç¡®è®¤è¿™ä¸ª FIN åŒ…ï¼Œå¹¶ä¸”å‘é€è‡ªå·±çš„ FIN åŒ… - è¦å…³é—­çš„ä¸€æ–¹ä½¿ç”¨ ACK åŒ…æ¥ç¡®è®¤æŽ¥æ”¶åˆ°äº† FIN TLS æ¡æ‰‹ å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª ClientHello æ¶ˆæ¯åˆ°æœåŠ¡å™¨ç«¯ï¼Œæ¶ˆæ¯ä¸­åŒæ—¶åŒ…å«äº†å®ƒçš„Transport Layer Security (TLS) ç‰ˆæœ¬ï¼Œå¯ç”¨çš„åŠ å¯†ç®—æ³•å’ŒåŽ‹ç¼©ç®—æ³•ã€‚ æœåŠ¡å™¨ç«¯å‘å®¢æˆ·ç«¯è¿”å›žä¸€ä¸ª ServerHelloæ¶ˆæ¯ï¼Œæ¶ˆæ¯ä¸­åŒ…å«äº†æœåŠ¡å™¨ç«¯çš„TLSç‰ˆæœ¬ï¼ŒæœåŠ¡å™¨æ‰€é€‰æ‹©çš„åŠ å¯†å’ŒåŽ‹ç¼©ç®—æ³•ï¼Œä»¥åŠæ•°å­—è¯ä¹¦è®¤è¯æœºæž„ï¼ˆCertificate Authorityï¼Œç¼©å†™CAï¼‰ç­¾å‘çš„æœåŠ¡å™¨å…¬å¼€è¯ä¹¦ï¼Œè¯ä¹¦ä¸­åŒ…å«äº†å…¬é’¥ã€‚å®¢æˆ·ç«¯ä¼šä½¿ç”¨è¿™ä¸ªå…¬é’¥åŠ å¯†æŽ¥ä¸‹æ¥çš„æ¡æ‰‹è¿‡ç¨‹ï¼Œç›´åˆ°åå•†ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹ç§°å¯†é’¥ å®¢æˆ·ç«¯æ ¹æ®è‡ªå·±çš„ä¿¡ä»»CAåˆ—è¡¨ï¼ŒéªŒè¯æœåŠ¡å™¨ç«¯çš„è¯ä¹¦æ˜¯å¦å¯ä¿¡ã€‚å¦‚æžœè®¤ä¸ºå¯ä¿¡ï¼Œå®¢æˆ·ç«¯ä¼šç”Ÿæˆä¸€ä¸²ä¼ªéšæœºæ•°ï¼Œä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥åŠ å¯†å®ƒã€‚è¿™ä¸²éšæœºæ•°ä¼šè¢«ç”¨äºŽç”Ÿæˆæ–°çš„å¯¹ç§°å¯†é’¥ æœåŠ¡å™¨ç«¯ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†ä¸Šé¢æåˆ°çš„éšæœºæ•°ï¼Œç„¶åŽä½¿ç”¨è¿™ä¸²éšæœºæ•°ç”Ÿæˆè‡ªå·±çš„å¯¹ç§°ä¸»å¯†é’¥ å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª Finishedæ¶ˆæ¯ç»™æœåŠ¡å™¨ç«¯ï¼Œä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†è¿™æ¬¡é€šè®¯çš„ä¸€ä¸ªæ•£åˆ—å€¼ æœåŠ¡å™¨ç«¯ç”Ÿæˆè‡ªå·±çš„ hash å€¼ï¼Œç„¶åŽè§£å¯†å®¢æˆ·ç«¯å‘é€æ¥çš„ä¿¡æ¯ï¼Œæ£€æŸ¥è¿™ä¸¤ä¸ªå€¼æ˜¯å¦å¯¹åº”ã€‚å¦‚æžœå¯¹åº”ï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªFinished æ¶ˆæ¯ï¼Œä¹Ÿä½¿ç”¨åå•†å¥½çš„å¯¹ç§°å¯†é’¥åŠ å¯† ä»ŽçŽ°åœ¨å¼€å§‹ï¼ŒæŽ¥ä¸‹æ¥æ•´ä¸ª TLS ä¼šè¯éƒ½ä½¿ç”¨å¯¹ç§°ç§˜é’¥è¿›è¡ŒåŠ å¯†ï¼Œä¼ è¾“åº”ç”¨å±‚ï¼ˆHTTPï¼‰å†…å®¹ HTTP åè®®å¦‚æžœæµè§ˆå™¨æ˜¯ Google å‡ºå“çš„ï¼Œå®ƒä¸ä¼šä½¿ç”¨ HTTP åè®®æ¥èŽ·å–é¡µé¢ä¿¡æ¯ï¼Œè€Œæ˜¯ä¼šä¸ŽæœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚ï¼Œå•†è®¨ä½¿ç”¨ SPDY åè®®ã€‚ å¦‚æžœæµè§ˆå™¨ä½¿ç”¨ HTTP åè®®è€Œä¸æ”¯æŒ SPDY åè®®ï¼Œå®ƒä¼šå‘æœåŠ¡å™¨å‘é€è¿™æ ·çš„ä¸€ä¸ªè¯·æ±‚: GET / HTTP/1.1 Host: google.com Connection: close [å…¶ä»–å¤´éƒ¨]â€œå…¶ä»–å¤´éƒ¨â€åŒ…å«äº†ä¸€ç³»åˆ—çš„ç”±å†’å·åˆ†å‰²å¼€çš„é”®å€¼å¯¹ï¼Œå®ƒä»¬çš„æ ¼å¼ç¬¦åˆHTTPåè®®æ ‡å‡†ï¼Œå®ƒä»¬ä¹‹é—´ç”±ä¸€ä¸ªæ¢è¡Œç¬¦åˆ†å‰²å¼€æ¥ã€‚ï¼ˆè¿™é‡Œæˆ‘ä»¬å‡è®¾æµè§ˆå™¨æ²¡æœ‰è¿åHTTPåè®®æ ‡å‡†çš„bugï¼ŒåŒæ—¶å‡è®¾æµè§ˆå™¨ä½¿ç”¨HTTP/1.1 åè®®ï¼Œä¸ç„¶çš„è¯å¤´éƒ¨å¯èƒ½ä¸åŒ…å« Host å­—æ®µï¼ŒåŒæ—¶ GETè¯·æ±‚ä¸­çš„ç‰ˆæœ¬å·ä¼šå˜æˆ HTTP/1.0 æˆ–è€… HTTP/0.9 ã€‚ï¼‰ HTTP/1.1 å®šä¹‰äº†â€œå…³é—­è¿žæŽ¥â€çš„é€‰é¡¹â€closeâ€ï¼Œå‘é€è€…ä½¿ç”¨è¿™ä¸ªé€‰é¡¹æŒ‡ç¤ºè¿™æ¬¡è¿žæŽ¥åœ¨å“åº”ç»“æŸä¹‹åŽä¼šæ–­å¼€ã€‚ä¾‹å¦‚ï¼š Connection:close ä¸æ”¯æŒæŒä¹…è¿žæŽ¥çš„ HTTP/1.1 åº”ç”¨å¿…é¡»åœ¨æ¯æ¡æ¶ˆæ¯ä¸­éƒ½åŒ…å« â€œcloseâ€ é€‰é¡¹ã€‚ åœ¨å‘é€å®Œè¿™äº›è¯·æ±‚å’Œå¤´éƒ¨ä¹‹åŽï¼Œæµè§ˆå™¨å‘é€ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œè¡¨ç¤ºè¦å‘é€çš„å†…å®¹å·²ç»ç»“æŸäº†ã€‚ æœåŠ¡å™¨ç«¯è¿”å›žä¸€ä¸ªå“åº”ç ï¼ŒæŒ‡ç¤ºè¿™æ¬¡è¯·æ±‚çš„çŠ¶æ€ï¼Œå“åº”çš„å½¢å¼æ˜¯è¿™æ ·çš„: 200 OK [å“åº”å¤´éƒ¨]ç„¶åŽæ˜¯ä¸€ä¸ªæ¢è¡Œï¼ŒæŽ¥ä¸‹æ¥æœ‰æ•ˆè½½è·(payload)ï¼Œä¹Ÿå°±æ˜¯ www.google.comçš„HTMLå†…å®¹ã€‚æœåŠ¡å™¨ä¸‹é¢å¯èƒ½ä¼šå…³é—­è¿žæŽ¥ï¼Œå¦‚æžœå®¢æˆ·ç«¯è¯·æ±‚ä¿æŒè¿žæŽ¥çš„è¯ï¼ŒæœåŠ¡å™¨ç«¯ä¼šä¿æŒè¿žæŽ¥æ‰“å¼€ï¼Œä»¥ä¾›ä¹‹åŽçš„è¯·æ±‚é‡ç”¨ã€‚ å¦‚æžœæµè§ˆå™¨å‘é€çš„HTTPå¤´éƒ¨åŒ…å«äº†è¶³å¤Ÿå¤šçš„ä¿¡æ¯ï¼ˆä¾‹å¦‚åŒ…å«äº† Etag å¤´éƒ¨ï¼‰ï¼Œä»¥è‡³äºŽæœåŠ¡å™¨å¯ä»¥åˆ¤æ–­å‡ºï¼Œæµè§ˆå™¨ç¼“å­˜çš„æ–‡ä»¶ç‰ˆæœ¬è‡ªä»Žä¸Šæ¬¡èŽ·å–ä¹‹åŽæ²¡æœ‰å†æ›´æ”¹è¿‡ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šè¿”å›žè¿™æ ·çš„å“åº”: 304 Not Modified [å“åº”å¤´éƒ¨]è¿™ä¸ªå“åº”æ²¡æœ‰æœ‰æ•ˆè½½è·ï¼Œæµè§ˆå™¨ä¼šä»Žè‡ªå·±çš„ç¼“å­˜ä¸­å–å‡ºæƒ³è¦çš„å†…å®¹ã€‚ åœ¨è§£æžå®Œ HTMLä¹‹åŽï¼Œæµè§ˆå™¨å’Œå®¢æˆ·ç«¯ä¼šé‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œç›´åˆ°HTMLé¡µé¢å¼•å…¥çš„æ‰€æœ‰èµ„æºï¼ˆå›¾ç‰‡ï¼ŒCSSï¼Œfavicon.icoç­‰ç­‰ï¼‰å…¨éƒ¨éƒ½èŽ·å–å®Œæ¯•ï¼ŒåŒºåˆ«åªæ˜¯å¤´éƒ¨çš„GET / HTTP/1.1 ä¼šå˜æˆ GET /$(ç›¸å¯¹www.google.comçš„URL) HTTP/1.1 ã€‚ å¦‚æžœHTMLå¼•å…¥äº† www.google.comåŸŸåä¹‹å¤–çš„èµ„æºï¼Œæµè§ˆå™¨ä¼šå›žåˆ°ä¸Šé¢è§£æžåŸŸåé‚£ä¸€æ­¥ï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤å¾€ä¸‹ä¸€æ­¥ä¸€æ­¥æ‰§è¡Œï¼Œè¯·æ±‚ä¸­çš„Host å¤´éƒ¨ä¼šå˜æˆå¦å¤–çš„åŸŸåã€‚ HTTP æœåŠ¡å™¨è¯·æ±‚å¤„ç†HTTPD(HTTP Daemon)åœ¨æœåŠ¡å™¨ç«¯å¤„ç†è¯·æ±‚/å“åº”ã€‚æœ€å¸¸è§çš„ HTTPD æœ‰ Linuxä¸Šå¸¸ç”¨çš„ Apache å’Œ nginxï¼Œä»¥åŠ Windows ä¸Šçš„ IISã€‚ HTTPD æŽ¥æ”¶è¯·æ±‚ æœåŠ¡å™¨æŠŠè¯·æ±‚æ‹†åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªå‚æ•°ï¼š - HTTP è¯·æ±‚æ–¹æ³•(`GET`, `POST`, `HEAD`, `PUT`, `DELETE`, `CONNECT`, `OPTIONS`, æˆ–è€… `TRACE`)ã€‚ç›´æŽ¥åœ¨åœ°å€æ ä¸­è¾“å…¥ URL è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„æ˜¯ GET æ–¹æ³• - åŸŸåï¼šgoogle.com - è¯·æ±‚è·¯å¾„/é¡µé¢ï¼š/ (æˆ‘ä»¬æ²¡æœ‰è¯·æ±‚google.comä¸‹çš„æŒ‡å®šçš„é¡µé¢ï¼Œå› æ­¤ / æ˜¯é»˜è®¤çš„è·¯å¾„) æœåŠ¡å™¨éªŒè¯å…¶ä¸Šå·²ç»é…ç½®äº† google.com çš„è™šæ‹Ÿä¸»æœº æœåŠ¡å™¨éªŒè¯ google.com æŽ¥å— GET æ–¹æ³• æœåŠ¡å™¨éªŒè¯è¯¥ç”¨æˆ·å¯ä»¥ä½¿ç”¨ GET æ–¹æ³•(æ ¹æ® IP åœ°å€ï¼Œèº«ä»½ä¿¡æ¯ç­‰) å¦‚æžœæœåŠ¡å™¨å®‰è£…äº† URL é‡å†™æ¨¡å—ï¼ˆä¾‹å¦‚ Apache çš„ mod_rewrite å’Œ IIS çš„URL Rewriteï¼‰ï¼ŒæœåŠ¡å™¨ä¼šå°è¯•åŒ¹é…é‡å†™è§„åˆ™ï¼Œå¦‚æžœåŒ¹é…ä¸Šçš„è¯ï¼ŒæœåŠ¡å™¨ä¼šæŒ‰ç…§è§„åˆ™é‡å†™è¿™ä¸ªè¯·æ±‚ æœåŠ¡å™¨æ ¹æ®è¯·æ±‚ä¿¡æ¯èŽ·å–ç›¸åº”çš„å“åº”å†…å®¹ï¼Œè¿™ç§æƒ…å†µä¸‹ç”±äºŽè®¿é—®è·¯å¾„æ˜¯ â€œ/â€œ,ä¼šè®¿é—®é¦–é¡µæ–‡ä»¶ï¼ˆä½ å¯ä»¥é‡å†™è¿™ä¸ªè§„åˆ™ï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ï¼‰ã€‚ æœåŠ¡å™¨ä¼šä½¿ç”¨æŒ‡å®šçš„å¤„ç†ç¨‹åºåˆ†æžå¤„ç†è¿™ä¸ªæ–‡ä»¶ï¼Œå‡å¦‚ Google ä½¿ç”¨PHPï¼ŒæœåŠ¡å™¨ä¼šä½¿ç”¨ PHP è§£æž indexæ–‡ä»¶ï¼Œå¹¶æ•èŽ·è¾“å‡ºï¼ŒæŠŠ PHPçš„è¾“å‡ºç»“æžœè¿”å›žç»™è¯·æ±‚è€… æµè§ˆå™¨èƒŒåŽçš„æ•…äº‹å½“æœåŠ¡å™¨æä¾›äº†èµ„æºä¹‹åŽï¼ˆHTMLï¼ŒCSSï¼ŒJSï¼Œå›¾ç‰‡ç­‰ï¼‰ï¼Œæµè§ˆå™¨ä¼šæ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼š è§£æž â€”â€” HTMLï¼ŒCSSï¼ŒJS æ¸²æŸ“ â€”â€” æž„å»º DOM æ ‘ -&gt; æ¸²æŸ“ -&gt; å¸ƒå±€ -&gt; ç»˜åˆ¶ æµè§ˆå™¨æµè§ˆå™¨çš„åŠŸèƒ½æ˜¯ä»ŽæœåŠ¡å™¨ä¸Šå–å›žä½ æƒ³è¦çš„èµ„æºï¼Œç„¶åŽå±•ç¤ºåœ¨æµè§ˆå™¨çª—å£å½“ä¸­ã€‚èµ„æºé€šå¸¸æ˜¯HTML æ–‡ä»¶ï¼Œä¹Ÿå¯èƒ½æ˜¯PDFï¼Œå›¾ç‰‡ï¼Œæˆ–è€…å…¶ä»–ç±»åž‹çš„å†…å®¹ã€‚èµ„æºçš„ä½ç½®é€šè¿‡ç”¨æˆ·æä¾›çš„ URI(Uniform Resource Identifier) æ¥ç¡®å®šã€‚ æµè§ˆå™¨è§£é‡Šå’Œå±•ç¤º HTML æ–‡ä»¶çš„æ–¹æ³•ï¼Œåœ¨ HTML å’Œ CSSçš„æ ‡å‡†ä¸­æœ‰è¯¦ç»†ä»‹ç»ã€‚è¿™äº›æ ‡å‡†ç”± Web æ ‡å‡†ç»„ç»‡ W3C(World Wide Web Consortium) ç»´æŠ¤ã€‚ ä¸åŒæµè§ˆå™¨çš„ç”¨æˆ·ç•Œé¢å¤§éƒ½ååˆ†æŽ¥è¿‘ï¼Œæœ‰å¾ˆå¤šå…±åŒçš„ UI å…ƒç´ ï¼š ä¸€ä¸ªåœ°å€æ  åŽé€€å’Œå‰è¿›æŒ‰é’® ä¹¦ç­¾é€‰é¡¹ åˆ·æ–°å’Œåœæ­¢æŒ‰é’® ä¸»é¡µæŒ‰é’® æµè§ˆå™¨é«˜å±‚æž¶æž„ ç»„æˆæµè§ˆå™¨çš„ç»„ä»¶æœ‰ï¼š ç”¨æˆ·ç•Œé¢ ç”¨æˆ·ç•Œé¢åŒ…å«äº†åœ°å€æ ï¼Œå‰è¿›åŽé€€æŒ‰é’®ï¼Œä¹¦ç­¾èœå•ç­‰ç­‰ï¼Œé™¤äº†è¯·æ±‚é¡µé¢ä¹‹å¤–æ‰€æœ‰ä½ çœ‹åˆ°çš„å†…å®¹éƒ½æ˜¯ç”¨æˆ·ç•Œé¢çš„ä¸€éƒ¨åˆ† æµè§ˆå™¨å¼•æ“Ž æµè§ˆå™¨å¼•æ“Žè´Ÿè´£è®© UI å’Œæ¸²æŸ“å¼•æ“Žåè°ƒå·¥ä½œ æ¸²æŸ“å¼•æ“Ž æ¸²æŸ“å¼•æ“Žè´Ÿè´£å±•ç¤ºè¯·æ±‚å†…å®¹ã€‚å¦‚æžœè¯·æ±‚çš„å†…å®¹æ˜¯HTMLï¼Œæ¸²æŸ“å¼•æ“Žä¼šè§£æž HTML å’Œ CSSï¼Œç„¶åŽå°†å†…å®¹å±•ç¤ºåœ¨å±å¹•ä¸Š ç½‘ç»œç»„ä»¶ ç½‘ç»œç»„ä»¶è´Ÿè´£ç½‘ç»œè°ƒç”¨ï¼Œä¾‹å¦‚ HTTPè¯·æ±‚ç­‰ï¼Œä½¿ç”¨ä¸€ä¸ªå¹³å°æ— å…³æŽ¥å£ï¼Œä¸‹å±‚æ˜¯é’ˆå¯¹ä¸åŒå¹³å°çš„å…·ä½“å®žçŽ° UIåŽç«¯ UI åŽç«¯ç”¨äºŽç»˜åˆ¶åŸºæœ¬ UI ç»„ä»¶ï¼Œä¾‹å¦‚ä¸‹æ‹‰åˆ—è¡¨æ¡†å’Œçª—å£ã€‚UIåŽç«¯æš´éœ²ä¸€ä¸ªç»Ÿä¸€çš„å¹³å°æ— å…³çš„æŽ¥å£ï¼Œä¸‹å±‚ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ UI æ–¹æ³•å®žçŽ° Javascript å¼•æ“Ž Javascript å¼•æ“Žç”¨äºŽè§£æžå’Œæ‰§è¡Œ Javascript ä»£ç  æ•°æ®å­˜å‚¨ æ•°æ®å­˜å‚¨ç»„ä»¶æ˜¯ä¸€ä¸ªæŒä¹…å±‚ã€‚æµè§ˆå™¨å¯èƒ½éœ€è¦åœ¨æœ¬åœ°å­˜å‚¨å„ç§å„æ ·çš„æ•°æ®ï¼Œä¾‹å¦‚Cookie ç­‰ã€‚æµè§ˆå™¨ä¹Ÿéœ€è¦æ”¯æŒè¯¸å¦‚ localStorageï¼ŒIndexedDBï¼ŒWebSQL å’Œ FileSystem ä¹‹ç±»çš„å­˜å‚¨æœºåˆ¶ HTML è§£æžæµè§ˆå™¨æ¸²æŸ“å¼•æ“Žä»Žç½‘ç»œå±‚å–å¾—è¯·æ±‚çš„æ–‡æ¡£ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ–‡æ¡£ä¼šåˆ†æˆ8kBå¤§å°çš„åˆ†å—ä¼ è¾“ã€‚ HTML è§£æžå™¨çš„ä¸»è¦å·¥ä½œæ˜¯å¯¹ HTML æ–‡æ¡£è¿›è¡Œè§£æžï¼Œç”Ÿæˆè§£æžæ ‘ã€‚ è§£æžæ ‘æ˜¯ä»¥ DOM å…ƒç´ ä»¥åŠå±žæ€§ä¸ºèŠ‚ç‚¹çš„æ ‘ã€‚DOMæ˜¯æ–‡æ¡£å¯¹è±¡æ¨¡åž‹(Document Object Model)çš„ç¼©å†™ï¼Œå®ƒæ˜¯ HTML æ–‡æ¡£çš„å¯¹è±¡è¡¨ç¤ºï¼ŒåŒæ—¶ä¹Ÿæ˜¯ HTML å…ƒç´ é¢å‘å¤–éƒ¨(å¦‚Javascript)çš„æŽ¥å£ã€‚æ ‘çš„æ ¹éƒ¨æ˜¯â€Documentâ€å¯¹è±¡ã€‚æ•´ä¸ª DOM å’ŒHTML æ–‡æ¡£å‡ ä¹Žæ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚ è§£æžç®—æ³• HTMLä¸èƒ½ä½¿ç”¨å¸¸è§çš„è‡ªé¡¶å‘ä¸‹æˆ–è‡ªåº•å‘ä¸Šæ–¹æ³•æ¥è¿›è¡Œåˆ†æžã€‚ä¸»è¦åŽŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹: è¯­è¨€æœ¬èº«çš„â€œå®½å®¹â€ç‰¹æ€§ HTMLæœ¬èº«å¯èƒ½æ˜¯æ®‹ç¼ºçš„ï¼Œå¯¹äºŽå¸¸è§çš„æ®‹ç¼ºï¼Œæµè§ˆå™¨éœ€è¦æœ‰ä¼ ç»Ÿçš„å®¹é”™æœºåˆ¶æ¥æ”¯æŒå®ƒä»¬ è§£æžè¿‡ç¨‹éœ€è¦åå¤ã€‚å¯¹äºŽå…¶ä»–è¯­è¨€æ¥è¯´ï¼Œæºç ä¸ä¼šåœ¨è§£æžè¿‡ç¨‹ä¸­å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å¯¹äºŽHTML æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç ï¼Œä¾‹å¦‚è„šæœ¬å…ƒç´ ä¸­åŒ…å«çš„ document.write()æ–¹æ³•ä¼šåœ¨æºç ä¸­æ·»åŠ å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè§£æžè¿‡ç¨‹å®žé™…ä¸Šä¼šæ”¹å˜è¾“å…¥çš„å†…å®¹ ç”±äºŽä¸èƒ½ä½¿ç”¨å¸¸ç”¨çš„è§£æžæŠ€æœ¯ï¼Œæµè§ˆå™¨åˆ›é€ äº†ä¸“é—¨ç”¨äºŽè§£æž HTMLçš„è§£æžå™¨ã€‚è§£æžç®—æ³•åœ¨ HTML5æ ‡å‡†è§„èŒƒä¸­æœ‰è¯¦ç»†ä»‹ç»ï¼Œç®—æ³•ä¸»è¦åŒ…å«äº†ä¸¤ä¸ªé˜¶æ®µï¼šæ ‡è®°åŒ–ï¼ˆtokenizationï¼‰å’Œæ ‘çš„æž„å»ºã€‚ è§£æžç»“æŸä¹‹åŽ æµè§ˆå™¨å¼€å§‹åŠ è½½ç½‘é¡µçš„å¤–éƒ¨èµ„æºï¼ˆCSSï¼Œå›¾åƒï¼ŒJavascript æ–‡ä»¶ç­‰ï¼‰ã€‚ æ­¤æ—¶æµè§ˆå™¨æŠŠæ–‡æ¡£æ ‡è®°ä¸ºå¯äº¤äº’çš„ï¼ˆinteractiveï¼‰ï¼Œæµè§ˆå™¨å¼€å§‹è§£æžå¤„äºŽâ€œæŽ¨è¿Ÿï¼ˆdeferredï¼‰â€æ¨¡å¼çš„è„šæœ¬ï¼Œä¹Ÿå°±æ˜¯é‚£äº›éœ€è¦åœ¨æ–‡æ¡£è§£æžå®Œæ¯•ä¹‹åŽå†æ‰§è¡Œçš„è„šæœ¬ã€‚ä¹‹åŽæ–‡æ¡£çš„çŠ¶æ€ä¼šå˜ä¸ºâ€œå®Œæˆï¼ˆcompleteï¼‰â€ï¼Œæµè§ˆå™¨ä¼šè§¦å‘â€œåŠ è½½ï¼ˆloadï¼‰â€äº‹ä»¶ã€‚ æ³¨æ„è§£æž HTML ç½‘é¡µæ—¶æ°¸è¿œä¸ä¼šå‡ºçŽ°â€œæ— æ•ˆè¯­æ³•ï¼ˆInvalid Syntaxï¼‰â€é”™è¯¯ï¼Œæµè§ˆå™¨ä¼šä¿®å¤æ‰€æœ‰é”™è¯¯å†…å®¹ï¼Œç„¶åŽç»§ç»­è§£æžã€‚ CSS è§£æž æ ¹æ® CSSè¯æ³•å’Œå¥æ³•åˆ†æžCSSæ–‡ä»¶å’Œ &lt;style&gt; æ ‡ç­¾åŒ…å«çš„å†…å®¹ä»¥åŠ style å±žæ€§çš„å€¼ æ¯ä¸ªCSSæ–‡ä»¶éƒ½è¢«è§£æžæˆä¸€ä¸ªæ ·å¼è¡¨å¯¹è±¡ï¼ˆStyleSheet objectï¼‰ï¼Œè¿™ä¸ªå¯¹è±¡é‡ŒåŒ…å«äº†å¸¦æœ‰é€‰æ‹©å™¨çš„CSSè§„åˆ™ï¼Œå’Œå¯¹åº”CSSè¯­æ³•çš„å¯¹è±¡ CSSè§£æžå™¨å¯èƒ½æ˜¯è‡ªé¡¶å‘ä¸‹çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ä½¿ç”¨è§£æžå™¨ç”Ÿæˆå™¨ç”Ÿæˆçš„è‡ªåº•å‘ä¸Šçš„è§£æžå™¨ é¡µé¢æ¸²æŸ“ é€šè¿‡éåŽ†DOMèŠ‚ç‚¹æ ‘åˆ›å»ºä¸€ä¸ªâ€œFrameæ ‘â€æˆ–â€œæ¸²æŸ“æ ‘â€ï¼Œå¹¶è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å„ä¸ªCSSæ ·å¼å€¼ é€šè¿‡ç´¯åŠ å­èŠ‚ç‚¹çš„å®½åº¦ï¼Œè¯¥èŠ‚ç‚¹çš„æ°´å¹³å†…è¾¹è·(padding)ã€è¾¹æ¡†(border)å’Œå¤–è¾¹è·(margin)ï¼Œè‡ªåº•å‘ä¸Šçš„è®¡ç®—â€Frameæ ‘â€ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„é¦–é€‰(preferred)å®½åº¦ é€šè¿‡è‡ªé¡¶å‘ä¸‹çš„ç»™æ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ†é…å¯è¡Œå®½åº¦ï¼Œè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å®žé™…å®½åº¦ é€šè¿‡åº”ç”¨æ–‡å­—æŠ˜è¡Œã€ç´¯åŠ å­èŠ‚ç‚¹çš„é«˜åº¦å’Œæ­¤èŠ‚ç‚¹çš„å†…è¾¹è·(padding)ã€è¾¹æ¡†(border)å’Œå¤–è¾¹è·(margin)ï¼Œè‡ªåº•å‘ä¸Šçš„è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„é«˜åº¦ ä½¿ç”¨ä¸Šé¢çš„è®¡ç®—ç»“æžœæž„å»ºæ¯ä¸ªèŠ‚ç‚¹çš„åæ ‡ å½“å­˜åœ¨å…ƒç´ ä½¿ç”¨ floatedï¼Œä½ç½®æœ‰ absolutely æˆ– relatively å±žæ€§çš„æ—¶å€™ï¼Œä¼šæœ‰æ›´å¤šå¤æ‚çš„è®¡ç®—ï¼Œè¯¦è§http://dev.w3.org/csswg/css2/ å’Œ http://www.w3.org/Style/CSS/current-work åˆ›å»ºlayer(å±‚)æ¥è¡¨ç¤ºé¡µé¢ä¸­çš„å“ªäº›éƒ¨åˆ†å¯ä»¥æˆç»„çš„è¢«ç»˜åˆ¶ï¼Œè€Œä¸ç”¨è¢«é‡æ–°æ …æ ¼åŒ–å¤„ç†ã€‚æ¯ä¸ªå¸§å¯¹è±¡éƒ½è¢«åˆ†é…ç»™ä¸€ä¸ªå±‚ é¡µé¢ä¸Šçš„æ¯ä¸ªå±‚éƒ½è¢«åˆ†é…äº†çº¹ç†(?) æ¯ä¸ªå±‚çš„å¸§å¯¹è±¡éƒ½ä¼šè¢«éåŽ†ï¼Œè®¡ç®—æœºæ‰§è¡Œç»˜å›¾å‘½ä»¤ç»˜åˆ¶å„ä¸ªå±‚ï¼Œæ­¤è¿‡ç¨‹å¯èƒ½ç”±CPUæ‰§è¡Œæ …æ ¼åŒ–å¤„ç†ï¼Œæˆ–è€…ç›´æŽ¥é€šè¿‡D2D/SkiaGLåœ¨GPUä¸Šç»˜åˆ¶ ä¸Šé¢æ‰€æœ‰æ­¥éª¤éƒ½å¯èƒ½åˆ©ç”¨åˆ°æœ€è¿‘ä¸€æ¬¡é¡µé¢æ¸²æŸ“æ—¶è®¡ç®—å‡ºæ¥çš„å„ä¸ªå€¼ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä¸å°‘è®¡ç®—é‡ è®¡ç®—å‡ºå„ä¸ªå±‚çš„æœ€ç»ˆä½ç½®ï¼Œä¸€ç»„å‘½ä»¤ç”±Direct3D/OpenGLå‘å‡ºï¼ŒGPUå‘½ä»¤ç¼“å†²åŒºæ¸…ç©ºï¼Œå‘½ä»¤ä¼ è‡³GPUå¹¶å¼‚æ­¥æ¸²æŸ“ï¼Œå¸§è¢«é€åˆ°Window Serverã€‚ GPU æ¸²æŸ“ åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œå›¾å½¢å¤„ç†å±‚å¯èƒ½ä½¿ç”¨é€šç”¨ç”¨é€”çš„CPUï¼Œä¹Ÿå¯èƒ½ä½¿ç”¨å›¾å½¢å¤„ç†å™¨ GPU å½“ä½¿ç”¨ GPUç”¨äºŽå›¾å½¢æ¸²æŸ“æ—¶ï¼Œå›¾å½¢é©±åŠ¨è½¯ä»¶ä¼šæŠŠä»»åŠ¡åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œè¿™æ ·å¯ä»¥å……åˆ†åˆ©ç”¨GPU å¼ºå¤§çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œç”¨äºŽåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è¿›è¡Œå¤§é‡çš„æµ®ç‚¹è®¡ç®—ã€‚ Window ServeråŽæœŸæ¸²æŸ“ä¸Žç”¨æˆ·å¼•å‘çš„å¤„ç†æ¸²æŸ“ç»“æŸåŽï¼Œæµè§ˆå™¨æ ¹æ®æŸäº›æ—¶é—´æœºåˆ¶è¿è¡ŒJavaScriptä»£ç (æ¯”å¦‚Google DoodleåŠ¨ç”»)æˆ–ä¸Žç”¨æˆ·äº¤äº’(åœ¨æœç´¢æ è¾“å…¥å…³é”®å­—èŽ·å¾—æœç´¢å»ºè®®)ã€‚ç±»ä¼¼Flashå’ŒJavaçš„æ’ä»¶ä¹Ÿä¼šè¿è¡Œï¼Œå°½ç®¡Googleä¸»é¡µé‡Œæ²¡æœ‰ã€‚è¿™äº›è„šæœ¬å¯ä»¥è§¦å‘ç½‘ç»œè¯·æ±‚ï¼Œä¹Ÿå¯èƒ½æ”¹å˜ç½‘é¡µçš„å†…å®¹å’Œå¸ƒå±€ï¼Œäº§ç”Ÿåˆä¸€è½®æ¸²æŸ“ä¸Žç»˜åˆ¶ã€‚]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>Network</tag>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[APIç½‘å…³æž¶æž„è®¾è®¡]]></title>
    <url>%2Fapi-gateway-design.html</url>
    <content type="text"><![CDATA[æž„å»ºä¸€ä¸ªAPIç½‘å…³ å®šä¹‰API Gatewayä¸€ä¸ªæ¯”è¾ƒå¹¿æ³›çš„å®šä¹‰å¦‚ä¸‹ï¼š APIç½‘å…³æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ˜¯ç³»ç»Ÿçš„å”¯ä¸€å…¥å£ã€‚ä»Žé¢å‘å¯¹è±¡è®¾è®¡çš„è§’åº¦çœ‹ï¼Œå®ƒä¸Žå¤–è§‚æ¨¡å¼ç±»ä¼¼ã€‚APIç½‘å…³å°è£…äº†ç³»ç»Ÿå†…éƒ¨æž¶æž„ï¼Œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æä¾›ä¸€ä¸ªå®šåˆ¶çš„APIã€‚APIç½‘å…³æ–¹å¼çš„æ ¸å¿ƒè¦ç‚¹æ˜¯ï¼Œæ‰€æœ‰çš„å®¢æˆ·ç«¯å’Œæ¶ˆè´¹ç«¯éƒ½é€šè¿‡ç»Ÿä¸€çš„ç½‘å…³æŽ¥å…¥å¾®æœåŠ¡ï¼Œåœ¨ç½‘å…³å±‚å¤„ç†æ‰€æœ‰çš„éžä¸šåŠ¡åŠŸèƒ½ã€‚é€šå¸¸ï¼Œç½‘å…³ä¹Ÿæ˜¯æä¾›REST/HTTPçš„è®¿é—®APIã€‚æœåŠ¡ç«¯é€šè¿‡API-GWæ³¨å†Œå’Œç®¡ç†æœåŠ¡ã€‚ ä»Žå®šä¹‰ä¸­å¯ä»¥å½’çº³å‡ºä¸€ä¸‹å‡ ä¸ªæ ¸å¿ƒç‚¹ï¼š æœåŠ¡è°ƒç”¨çš„ç»Ÿä¸€å…¥å£ AuthNï¼ˆAuthentication is establishing the your identity.ï¼‰ AuthZ ï¼ˆAuthorization is establishing your privileges.ï¼‰ ç›‘æŽ§ï¼ˆè¯·æ±‚å»¶è¿Ÿã€å¼‚å¸¸æ•°ã€å®¡è®¡æ—¥å¿—ã€è®¿é—®æ—¥å¿—ï¼‰ é«˜å¯ç”¨ ç™½åå•ã€é»‘åå• é™æµ ç†”æ–­ æœåŠ¡å‘çŽ° åè®®æ”¯æŒ ï¼ˆåè®®è½¬æ¢ï¼‰ â€¦ æ€ç»´å¯¼å›¾ ä»‹ç»å‡ ä¸ªæ¦‚å¿µï¼š å…ˆè¯´RCï¼ˆReplication Controllerï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ RCä¿è¯åœ¨åŒä¸€æ—¶é—´èƒ½å¤Ÿè¿è¡ŒæŒ‡å®šæ•°é‡çš„Podå‰¯æœ¬ï¼Œä¿è¯Podæ€»æ˜¯å¯ç”¨ã€‚å¦‚æžœå®žé™…Podæ•°é‡æ¯”æŒ‡å®šçš„å¤šå°±ç»“æŸæŽ‰å¤šä½™çš„ï¼Œå¦‚æžœå®žé™…æ•°é‡æ¯”æŒ‡å®šçš„å°‘å°±å¯åŠ¨ç¼ºå°‘çš„ã€‚å½“Podå¤±è´¥ã€è¢«åˆ é™¤æˆ–è¢«ç»ˆç»“æ—¶RCä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„Podæ¥ä¿è¯å‰¯æœ¬æ•°é‡ã€‚æ‰€ä»¥å³ä½¿åªæœ‰ä¸€ä¸ªPodä¹Ÿåº”è¯¥ä½¿ç”¨RCæ¥è¿›è¡Œç®¡ç†ã€‚ HPA Horizontal Pod Autoscalingï¼Œç®€ç§°HPAï¼Œæ˜¯Kubernetesä¸­å®žçŽ°PODæ°´å¹³è‡ªåŠ¨ä¼¸ç¼©çš„åŠŸèƒ½ã€‚ HPAæ˜¯kubernetesé‡Œé¢podå¼¹æ€§ä¼¸ç¼©çš„å®žçŽ°,å®ƒèƒ½æ ¹æ®è®¾ç½®çš„ç›‘æŽ§é˜€å€¼è¿›è¡Œpodçš„å¼¹æ€§æ‰©ç¼©å®¹ï¼Œç›®å‰é»˜è®¤HPAåªèƒ½æ”¯æŒcpuå’Œå†…å­˜çš„é˜€å€¼æ£€æµ‹æ‰©ç¼©å®¹ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡custom metric api è°ƒç”¨prometheuså®žçŽ°è‡ªå®šä¹‰metric æ¥æ›´åŠ çµæ´»çš„ç›‘æŽ§æŒ‡æ ‡å®žçŽ°å¼¹æ€§ä¼¸ç¼©ã€‚ å–èˆå–èˆä¹Ÿå°±æ˜¯å¦‚ä½•æž„å»ºé€‚åˆè‡ªå·±çš„API Gatewayï¼Ÿ å…¶å®žï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿå¯ä»¥æ‹“å±•ä¸ºå¦‚ä½•å¼€å‘é€‚åº”è‡ªå·±ä¸šåŠ¡çš„æŸç³»ç»Ÿï¼Œä¸ªäººæ„Ÿè§‰åº”è¯¥ä»Žä»¥ä¸‹å‡ ç‚¹è€ƒè™‘ï¼š è‡ªå·±çš„ä¸šåŠ¡ç³»ç»Ÿéœ€è¦ä»€ä¹ˆæ ·çš„åŠŸèƒ½ï¼Ÿ ä¸šç•Œä¸­è¯¥ç±»ç³»ç»Ÿéƒ½æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ è‡ªå·±çš„åŸºç¡€è®¾æ–½æƒ…å†µï¼ˆä¸»è¦æ˜¯PaaSåŠä¸­é—´ä»¶ï¼‰å¦‚ä½•ï¼Ÿ ç»¼åˆ1ã€2è€ƒè™‘ï¼Œåœ¨æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„å‰æä¸‹ï¼Œå¾€è¿œäº†è€ƒè™‘ï¼Œå¾€ç®€å•äº†å®žçŽ°ï¼ˆæ—¢æ»¡è¶³ç›®å‰çš„åŠŸèƒ½ï¼Œåˆæ–¹ä¾¿ä»¥åŽæ‹“å±•ï¼‰ã€‚å›žåˆ°API Gatewayè¿™ä¸ªè¯é¢˜ï¼Œé‚£å°±éœ€è¦è€ƒè™‘ä¸€ä¸‹ï¼Œè‡ªå·±çš„ä¸šåŠ¡ç³»ç»Ÿæ˜¯å¦éœ€è¦ä»¥ä¸Šåˆ—å‡ºçš„æ‰€æœ‰åŠŸèƒ½ç‚¹ï¼Ÿå¦‚æžœä¸æ˜¯æˆ–è€…ç›®å‰ä¸æ˜¯ï¼Œé‚£æˆ‘åº”è¯¥å…ˆå®žçŽ°å“ªä¸€éƒ¨åˆ†ï¼Ÿ å…¶ä¸­ï¼Œä½œä¸ºä¸€ä¸ªGatewayï¼Œä»¥ä¸‹å‡ ç‚¹åº”è¯¥æ˜¯åŸºç¡€åŠŸèƒ½ï¼š æœåŠ¡è°ƒç”¨çš„ç»Ÿä¸€å…¥å£ AuthNï¼ˆAuthentication is establishing the your identity.ï¼‰ AuthZ ï¼ˆAuthorization is establishing your privileges.ï¼‰ ç›‘æŽ§ï¼ˆè¯·æ±‚å»¶è¿Ÿã€å¼‚å¸¸æ•°ã€å®¡è®¡æ—¥å¿—ã€è®¿é—®æ—¥å¿—ï¼‰ é«˜å¯ç”¨ å‰©ä¸‹çš„åŠŸèƒ½å®žçŽ°å°±è¦çœ‹ä¸šåŠ¡éœ€è¦åŠæ—¶é—´äº†ã€‚å¦‚æžœç³»ç»Ÿæœ¬èº«çš„è®¿é—®é‡ä¸å¤§ï¼Œé‚£ä¹ˆé™æµã€ç†”æ–­æ˜¯å¦å°±å¯ä»¥å…ˆä¸å®žçŽ°ï¼Ÿ ä¸ºä»€ä¹ˆéœ€è¦å…³æ³¨è‡ªå·±çš„åŸºç¡€è®¾æ–½æƒ…å†µï¼ˆä¸»è¦æ˜¯PaaSåŠä¸­é—´ä»¶ï¼‰ï¼Ÿæ¯”å¦‚åŸºç¡€è®¾æ–½ä¸­å·²æä¾›Kubernetesé›†ç¾¤æœåŠ¡ï¼Œé‚£ä¹ˆæ¯«æ— ç–‘é—®çš„é«˜å¯ç”¨æ–¹æ¡ˆï¼Œåº”è¯¥é€‰æ‹©RCæ–¹æ¡ˆã€‚å¦‚æžœæ²¡æœ‰Kubernetesé›†ç¾¤æœåŠ¡ï¼Œé‚£ä¹ˆé«˜å¯ç”¨å°±éœ€è¦è€ƒè™‘åˆ«çš„æ–¹æ¡ˆäº†ã€‚ å¯ä»¥å‘çŽ°å…¶å®žæ‰‹æ’•ä¸€ä¸ªapiç½‘å…³ï¼Œä¹Ÿä¸æ˜¯å¤šä¹ˆéš¾çš„äº‹æƒ…ï¼Œå…¶ä¸­å¾ˆå¤šç‚¹ï¼Œåº•å±‚åŒ…éƒ½å·²ç»æä¾›äº†æ”¯æŒï¼Œåªæ˜¯éœ€è¦æ”¯æŒçš„åŠŸèƒ½æ¯”è¾ƒå¤šã€‚]]></content>
      <categories>
        <category>Architecture</category>
      </categories>
      <tags>
        <tag>Architecture</tag>
        <tag>Gateway</tag>
        <tag>Design</tag>
        <tag>API</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java volatileçš„å†…å­˜è¯­ä¹‰ä¸ŽAQSé”å†…å­˜å¯è§æ€§]]></title>
    <url>%2Fjava-volatile-aqs.html</url>
    <content type="text"><![CDATA[æåˆ°volatileé¦–å…ˆæƒ³åˆ°å°±æ˜¯ï¼š ä¿è¯æ­¤å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§ï¼Œè¿™é‡Œçš„ â€œå¯è§æ€§â€æ˜¯æŒ‡å½“ä¸€æ¡çº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œæ–°å€¼å¯¹äºŽå…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯å¯ä»¥ç«‹å³å¾—çŸ¥çš„ã€‚ ç¦æ­¢æŒ‡ä»¤é‡æŽ’åºä¼˜åŒ–ã€‚ åˆ°è¿™é‡Œå¤§å®¶æ„Ÿè§‰è‡ªå·±å¯¹volatileç†è§£äº†å—ï¼Ÿ å¦‚æžœç†è§£äº†ï¼Œå¤§å®¶è€ƒè™‘è¿™ä¹ˆä¸€ä¸ªé—®é¢˜ï¼šReentrantLockï¼ˆæˆ–è€…å…¶å®ƒåŸºäºŽAQSå®žçŽ°çš„é”ï¼‰æ˜¯å¦‚ä½•ä¿è¯ä»£ç æ®µä¸­å˜é‡ï¼ˆå˜é‡ä¸»è¦æ˜¯æŒ‡å…±äº«å˜é‡ï¼Œå­˜åœ¨ç«žäº‰é—®é¢˜çš„å˜é‡ï¼‰çš„å¯è§æ€§ï¼Ÿ 1234567891011121314private static ReentrantLock reentrantLock = new ReentrantLock();private static intcount = 0;//...// å¤šçº¿ç¨‹ run å¦‚ä¸‹ä»£ç reentrantLock.lock();try&#123; count++;&#125; finally&#123; reentrantLock.unlock();&#125;//... æ—¢ç„¶æåˆ°äº†å¯è§æ€§ï¼Œé‚£å°±å…ˆç†Ÿæ‚‰å‡ ä¸ªæ¦‚å¿µï¼š 1ã€JMMJMMï¼šJava Memory Model å³ Java å†…å­˜æ¨¡åž‹ The Java Memory Model describes what behaviors are legal in multithreaded code, and how threads may interact through memory. It describes the relationship between variables in a program and the low-level details of storing and retrieving them to and from memory or registers in a real computer system. It does this in a way that can be implemented correctly using a wide variety of hardware and a wide variety of compiler optimizations. Javaå†…å­˜æ¨¡åž‹çš„ä¸»è¦ç›®æ ‡æ˜¯å®šä¹‰ç¨‹åºä¸­å„ä¸ªå˜é‡çš„è®¿é—®è§„åˆ™ï¼Œå³åœ¨è™šæ‹Ÿæœºä¸­å°†å˜é‡å­˜å‚¨åˆ°å†…å­˜å’Œä»Žå†…å­˜ä¸­å–å‡ºå˜é‡è¿™æ ·çš„åº•å±‚ç»†èŠ‚ã€‚æ­¤å¤„çš„å˜é‡ä¸»è¦æ˜¯æŒ‡å…±äº«å˜é‡ï¼Œå­˜åœ¨ç«žäº‰é—®é¢˜çš„å˜é‡ã€‚Javaå†…å­˜æ¨¡åž‹è§„å®šæ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œè€Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œï¼ˆè¯»å–ã€èµ‹å€¼ç­‰ï¼‰éƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æŽ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ï¼ˆæ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒçš„è§„å®šï¼Œvolatileå˜é‡ä¾ç„¶æœ‰å…±äº«å†…å­˜çš„æ‹·è´ï¼Œä½†æ˜¯ç”±äºŽå®ƒç‰¹æ®Šçš„æ“ä½œé¡ºåºæ€§è§„å®šâ€”â€”ä»Žå·¥ä½œå†…å­˜ä¸­è¯»å†™æ•°æ®å‰ï¼Œå¿…é¡»å…ˆå°†ä¸»å†…å­˜ä¸­çš„æ•°æ®åŒæ­¥åˆ°å·¥ä½œå†…å­˜ä¸­ï¼Œæ‰€æœ‰çœ‹èµ·æ¥å¦‚åŒç›´æŽ¥åœ¨ä¸»å†…å­˜ä¸­è¯»å†™è®¿é—®ä¸€èˆ¬ï¼Œå› æ­¤è¿™é‡Œçš„æè¿°å¯¹äºŽvolatileä¹Ÿä¸ä¾‹å¤–ï¼‰ã€‚ä¸åŒçº¿ç¨‹ä¹‹é—´ä¹Ÿæ— æ³•ç›´æŽ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡å€¼å¾—ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚ 2ã€é‡æŽ’åºåœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤åšé‡æŽ’åºã€‚é‡æŽ’åºåˆ†3ç§ç±»åž‹ï¼š ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æŽ’åºã€‚ç¼–è¯‘å™¨åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ç¨‹åºè¯­ä¹‰çš„å‰æä¸‹ï¼Œå¯ä»¥é‡æ–°å®‰æŽ’è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚ æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æŽ’åºã€‚çŽ°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯ï¼ˆInstruction-Level Parallelismï¼ŒILPï¼‰æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æžœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚ å†…å­˜ç³»ç»Ÿçš„é‡æŽ’åºã€‚ç”±äºŽå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯»/å†™ç¼“å†²åŒºï¼Œè¿™ä½¿å¾—åŠ è½½å’Œå­˜å‚¨æ“ä½œçœ‹ä¸ŠåŽ»å¯èƒ½æ˜¯åœ¨ä¹±åºæ‰§è¡Œã€‚ ä»ŽJavaæºä»£ç åˆ°æœ€ç»ˆå®žé™…æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ï¼Œä¼šåˆ†åˆ«ç»åŽ†ä¸‹é¢3ç§é‡æŽ’åºï¼š å¯¹äºŽç¼–è¯‘å™¨ï¼ŒJMMçš„ç¼–è¯‘å™¨é‡æŽ’åºè§„åˆ™ä¼šç¦æ­¢ç‰¹å®šç±»åž‹çš„ç¼–è¯‘å™¨é‡æŽ’åºï¼ˆä¸æ˜¯æ‰€æœ‰çš„ç¼–è¯‘å™¨é‡æŽ’åºéƒ½è¦ç¦æ­¢ï¼‰ã€‚å¯¹äºŽå¤„ç†å™¨é‡æŽ’åºï¼ŒJMMçš„å¤„ç†å™¨é‡æŽ’åºè§„åˆ™ä¼šè¦æ±‚Javaç¼–è¯‘å™¨åœ¨ç”ŸæˆæŒ‡ä»¤åºåˆ—æ—¶ï¼Œæ’å…¥ç‰¹å®šç±»åž‹çš„å†…å­˜å±éšœï¼ˆMemory Barriersï¼ŒIntelç§°ä¹‹ä¸ºMemory Fenceï¼‰æŒ‡ä»¤ï¼Œé€šè¿‡å†…å­˜å±éšœæŒ‡ä»¤æ¥ç¦æ­¢ç‰¹å®šç±»åž‹çš„å¤„ç†å™¨é‡æŽ’åºã€‚ JMMå±žäºŽè¯­è¨€çº§çš„å†…å­˜æ¨¡åž‹ï¼Œå®ƒç¡®ä¿åœ¨ä¸åŒçš„ç¼–è¯‘å™¨å’Œä¸åŒçš„å¤„ç†å™¨å¹³å°ä¹‹ä¸Šï¼Œé€šè¿‡ç¦æ­¢ç‰¹å®šç±»åž‹çš„ç¼–è¯‘å™¨é‡æŽ’åºå’Œå¤„ç†å™¨é‡æŽ’åºï¼Œä¸ºç¨‹åºå‘˜æä¾›ä¸€è‡´çš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚ 3ã€happens-before ç¨‹åºé¡ºåºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œï¼Œhappens-beforeäºŽè¯¥çº¿ç¨‹ä¸­çš„ä»»æ„åŽç»­æ“ä½œã€‚ ç›‘è§†å™¨é”è§„åˆ™ï¼šå¯¹ä¸€ä¸ªé”çš„è§£é”ï¼Œhappens-beforeäºŽéšåŽå¯¹è¿™ä¸ªé”çš„åŠ é”ã€‚ volatileå˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileåŸŸçš„å†™ï¼Œhappens-beforeäºŽä»»æ„åŽç»­å¯¹è¿™ä¸ªvolatileåŸŸçš„è¯»ã€‚ï¼ˆå¯¹ä¸€ä¸ªvolatileå˜é‡çš„è¯»ï¼Œæ€»æ˜¯èƒ½çœ‹åˆ°ã€ä»»æ„çº¿ç¨‹ã€‘å¯¹è¿™ä¸ªvolatileå˜é‡æœ€åŽçš„å†™å…¥ï¼‰ ä¼ é€’æ€§ï¼šå¦‚æžœA happens-before Bï¼Œä¸”B happens-before Cï¼Œé‚£ä¹ˆA happens-before Cã€‚ ä¸¤ä¸ªæ“ä½œä¹‹é—´å…·æœ‰happens-beforeå…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€å‰ä¸€ä¸ªæ“ä½œå¿…é¡»è¦åœ¨åŽä¸€ä¸ªæ“ä½œä¹‹å‰æ‰§è¡Œï¼happens-beforeä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œï¼ˆæ‰§è¡Œçš„ç»“æžœï¼‰å¯¹åŽä¸€ä¸ªæ“ä½œå¯è§ï¼Œä¸”å‰ä¸€ä¸ªæ“ä½œæŒ‰é¡ºåºæŽ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ï¼ˆthe first is visible to and ordered before the secondï¼‰ã€‚ 4ã€å†…å­˜å±éšœ ç¡¬ä»¶å±‚çš„å†…å­˜å±éšœåˆ†ä¸ºä¸¤ç§ï¼šLoad Barrier å’Œ Store Barrierå³è¯»å±éšœå’Œå†™å±éšœã€‚ å¯¹äºŽLoad Barrieræ¥è¯´ï¼Œåœ¨æŒ‡ä»¤å‰æ’å…¥Load Barrierï¼Œå¯ä»¥è®©é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®å¤±æ•ˆï¼Œå¼ºåˆ¶ä»Žæ–°ä»Žä¸»å†…å­˜åŠ è½½æ•°æ®ï¼› å¯¹äºŽStore Barrieræ¥è¯´ï¼Œåœ¨æŒ‡ä»¤åŽæ’å…¥Store Barrierï¼Œèƒ½è®©å†™å…¥ç¼“å­˜ä¸­çš„æœ€æ–°æ•°æ®æ›´æ–°å†™å…¥ä¸»å†…å­˜ï¼Œè®©å…¶ä»–çº¿ç¨‹å¯è§ã€‚ å†…å­˜å±éšœæœ‰ä¸¤ä¸ªä½œç”¨ï¼š é˜»æ­¢å±éšœä¸¤ä¾§çš„æŒ‡ä»¤é‡æŽ’åºï¼› å¼ºåˆ¶æŠŠå†™ç¼“å†²åŒº/é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®ç­‰å†™å›žä¸»å†…å­˜ï¼Œè®©ç¼“å­˜ä¸­ç›¸åº”çš„æ•°æ®å¤±æ•ˆã€‚5ã€volatileçš„å†…å­˜è¯­ä¹‰ ä»ŽJSR-133å¼€å§‹ï¼ˆå³ä»ŽJDK5å¼€å§‹ï¼‰ï¼Œvolatileå˜é‡çš„å†™-è¯»å¯ä»¥å®žçŽ°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ ä»Žå†…å­˜è¯­ä¹‰çš„è§’åº¦æ¥è¯´ï¼Œvolatileçš„å†™-è¯»ä¸Žé”çš„é‡Šæ”¾-èŽ·å–æœ‰ç›¸åŒçš„å†…å­˜æ•ˆæžœï¼š volatileå†™å’Œé”çš„é‡Šæ”¾æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ï¼› volatileè¯»ä¸Žé”çš„èŽ·å–æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ã€‚ volatileä»…ä»…ä¿è¯å¯¹å•ä¸ªvolatileå˜é‡çš„è¯»/å†™å…·æœ‰åŽŸå­æ€§ï¼Œè€Œé”çš„äº’æ–¥æ‰§è¡Œçš„ç‰¹æ€§å¯ä»¥ç¡®ä¿å¯¹æ•´ä¸ªä¸´ç•ŒåŒºä»£ç çš„æ‰§è¡Œå…·æœ‰åŽŸå­æ€§ã€‚åœ¨åŠŸèƒ½ä¸Šï¼Œé”æ¯”volatileæ›´å¼ºå¤§ï¼›åœ¨å¯ä¼¸ç¼©æ€§å’Œæ‰§è¡Œæ€§èƒ½ä¸Šï¼Œvolatileæ›´æœ‰ä¼˜åŠ¿ã€‚ volatileå˜é‡è‡ªèº«å…·æœ‰ä¸‹åˆ—ç‰¹æ€§ï¼š å¯è§æ€§ã€‚å¯¹ä¸€ä¸ªvolatileå˜é‡çš„è¯»ï¼Œæ€»æ˜¯èƒ½çœ‹åˆ°ï¼ˆä»»æ„çº¿ç¨‹ï¼‰å¯¹è¿™ä¸ªvolatileå˜é‡æœ€åŽçš„å†™å…¥ã€‚ åŽŸå­æ€§ï¼šå¯¹ä»»æ„å•ä¸ªvolatileå˜é‡çš„è¯»/å†™å…·æœ‰åŽŸå­æ€§ï¼Œå³ä½¿æ˜¯64ä½çš„longåž‹å’Œdoubleåž‹å˜é‡ï¼Œåªè¦å®ƒæ˜¯volatileå˜é‡ï¼Œå¯¹è¯¥å˜é‡çš„è¯»/å†™å°±å…·æœ‰åŽŸå­æ€§ã€‚å¦‚æžœæ˜¯å¤šä¸ªvolatileæ“ä½œæˆ–ç±»ä¼¼äºŽvolatile++è¿™ç§å¤åˆæ“ä½œï¼Œè¿™äº›æ“ä½œæ•´ä½“ä¸Šä¸å…·æœ‰åŽŸå­æ€§ã€‚ volatileå†™å’Œvolatileè¯»çš„å†…å­˜è¯­ä¹‰ï¼š çº¿ç¨‹Aå†™ä¸€ä¸ªvolatileå˜é‡ï¼Œå®žè´¨ä¸Šæ˜¯çº¿ç¨‹Aå‘æŽ¥ä¸‹æ¥å°†è¦è¯»è¿™ä¸ªvolatileå˜é‡çš„æŸä¸ªçº¿ç¨‹å‘å‡ºäº†ï¼ˆå…¶å¯¹å…±äº«å˜é‡æ‰€åšä¿®æ”¹çš„ï¼‰æ¶ˆæ¯ã€‚ çº¿ç¨‹Bè¯»ä¸€ä¸ªvolatileå˜é‡ï¼Œå®žè´¨ä¸Šæ˜¯çº¿ç¨‹BæŽ¥æ”¶äº†ä¹‹å‰æŸä¸ªçº¿ç¨‹å‘å‡ºçš„ï¼ˆåœ¨å†™è¿™ä¸ªvolatileå˜é‡ä¹‹å‰å¯¹å…±äº«å˜é‡æ‰€åšä¿®æ”¹çš„ï¼‰æ¶ˆæ¯ã€‚ çº¿ç¨‹Aå†™ä¸€ä¸ªvolatileå˜é‡ï¼ŒéšåŽçº¿ç¨‹Bè¯»è¿™ä¸ªvolatileå˜é‡ï¼Œè¿™ä¸ªè¿‡ç¨‹å®žè´¨ä¸Šæ˜¯çº¿ç¨‹Aé€šè¿‡ä¸»å†…å­˜å‘çº¿ç¨‹Bå‘é€æ¶ˆæ¯ã€‚ JMMé’ˆå¯¹ç¼–è¯‘å™¨åˆ¶å®šçš„volatileé‡æŽ’åºè§„åˆ™è¡¨ å½“ç¬¬äºŒä¸ªæ“ä½œæ˜¯volatileå†™æ—¶ï¼Œä¸ç®¡ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æŽ’åºã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿volatileå†™ä¹‹å‰çš„æ“ä½œä¸ä¼šè¢«ç¼–è¯‘å™¨é‡æŽ’åºåˆ°volatileå†™ä¹‹åŽã€‚ å½“ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯volatileè¯»æ—¶ï¼Œä¸ç®¡ç¬¬äºŒä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æŽ’åºã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿volatileè¯»ä¹‹åŽçš„æ“ä½œä¸ä¼šè¢«ç¼–è¯‘å™¨é‡æŽ’åºåˆ°volatileè¯»ä¹‹å‰ã€‚ å½“ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯volatileå†™ï¼Œç¬¬äºŒä¸ªæ“ä½œæ˜¯volatileè¯»æ—¶ï¼Œä¸èƒ½é‡æŽ’åºã€‚ ä¸ºäº†å®žçŽ°volatileçš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­æ’å…¥å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šç±»åž‹çš„å¤„ç†å™¨é‡æŽ’åºã€‚å¯¹äºŽç¼–è¯‘å™¨æ¥è¯´ï¼Œå‘çŽ°ä¸€ä¸ªæœ€ä¼˜å¸ƒç½®æ¥æœ€å°åŒ–æ’å…¥å±éšœå‡ ä¹Žæ˜¯ä¸å¯èƒ½çš„ã€‚ä¸ºæ­¤ï¼ŒJMMé‡‡å–ä¿å®ˆç­–ç•¥ã€‚ä¸‹é¢æ˜¯åŸºäºŽä¿å®ˆç­–ç•¥çš„JMMå†…å­˜å±éšœæ’å…¥ç­–ç•¥ã€‚ åœ¨æ¯ä¸ªvolatileå†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ªStoreStoreå±éšœã€‚ åœ¨æ¯ä¸ªvolatileå†™æ“ä½œçš„åŽé¢æ’å…¥ä¸€ä¸ªStoreLoadå±éšœã€‚ åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œçš„åŽé¢æ’å…¥ä¸€ä¸ªLoadLoadå±éšœã€‚ åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œçš„åŽé¢æ’å…¥ä¸€ä¸ªLoadStoreå±éšœã€‚ LoadLoadå±éšœï¼šå¯¹äºŽè¿™æ ·çš„è¯­å¥Load1; LoadLoad; Load2ï¼Œåœ¨Load2åŠåŽç»­è¯»å–æ“ä½œè¦è¯»å–çš„æ•°æ®è¢«è®¿é—®å‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚ StoreStoreå±éšœï¼šå¯¹äºŽè¿™æ ·çš„è¯­å¥Store1; StoreStore; Store2ï¼Œåœ¨Store2åŠåŽç»­å†™å…¥æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥æ“ä½œå¯¹å…¶å®ƒå¤„ç†å™¨å¯è§ã€‚ LoadStoreå±éšœï¼šå¯¹äºŽè¿™æ ·çš„è¯­å¥Load1; LoadStore; Store2ï¼Œåœ¨Store2åŠåŽç»­å†™å…¥æ“ä½œè¢«åˆ·å‡ºå‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚ StoreLoadå±éšœï¼šå¯¹äºŽè¿™æ ·çš„è¯­å¥Store1; StoreLoad; Load2ï¼Œåœ¨Load2åŠåŽç»­æ‰€æœ‰è¯»å–æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥å¯¹æ‰€æœ‰å¤„ç†å™¨å¯è§ã€‚å®ƒçš„å¼€é”€æ˜¯å››ç§å±éšœä¸­æœ€å¤§çš„ã€‚åœ¨å¤§å¤šæ•°å¤„ç†å™¨çš„å®žçŽ°ä¸­ï¼Œè¿™ä¸ªå±éšœæ˜¯ä¸ªä¸‡èƒ½å±éšœï¼Œå…¼å…·å…¶å®ƒä¸‰ç§å†…å­˜å±éšœçš„åŠŸèƒ½ã€‚ä¸Šè¿°å†…å­˜å±éšœæ’å…¥ç­–ç•¥éžå¸¸ä¿å®ˆï¼Œä½†å®ƒå¯ä»¥ä¿è¯åœ¨ä»»æ„å¤„ç†å™¨å¹³å°ï¼Œä»»æ„çš„ç¨‹åºä¸­éƒ½èƒ½å¾—åˆ°æ­£ç¡®çš„volatileå†…å­˜è¯­ä¹‰ã€‚ ä¸‹é¢æ˜¯ä¿å®ˆç­–ç•¥ä¸‹ï¼Œvolatileå†™æ’å…¥å†…å­˜å±éšœåŽç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾. å›¾ä¸­çš„StoreStoreå±éšœå¯ä»¥ä¿è¯åœ¨volatileå†™ä¹‹å‰ï¼Œå…¶å‰é¢çš„æ‰€æœ‰æ™®é€šå†™æ“ä½œå·²ç»å¯¹ä»»æ„å¤„ç†å™¨å¯è§äº†ã€‚è¿™æ˜¯å› ä¸ºStoreStoreå±éšœå°†ä¿éšœä¸Šé¢æ‰€æœ‰çš„æ™®é€šå†™åœ¨volatileå†™ä¹‹å‰åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚ è¿™é‡Œæ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ï¼Œvolatileå†™åŽé¢çš„StoreLoadå±éšœã€‚æ­¤å±éšœçš„ä½œç”¨æ˜¯é¿å…volatileå†™ä¸ŽåŽé¢å¯èƒ½æœ‰çš„volatileè¯»/å†™æ“ä½œé‡æŽ’åºã€‚å› ä¸ºç¼–è¯‘å™¨å¸¸å¸¸æ— æ³•å‡†ç¡®åˆ¤æ–­åœ¨ä¸€ä¸ªvolatileå†™çš„åŽé¢æ˜¯å¦éœ€è¦æ’å…¥ä¸€ä¸ªStoreLoadå±éšœï¼ˆæ¯”å¦‚ï¼Œä¸€ä¸ªvolatileå†™ä¹‹åŽæ–¹æ³•ç«‹å³returnï¼‰ã€‚ä¸ºäº†ä¿è¯èƒ½æ­£ç¡®å®žçŽ°volatileçš„å†…å­˜è¯­ä¹‰ï¼ŒJMMåœ¨é‡‡å–äº†ä¿å®ˆç­–ç•¥ï¼šåœ¨æ¯ä¸ªvolatileå†™çš„åŽé¢ï¼Œæˆ–è€…åœ¨æ¯ä¸ªvolatileè¯»çš„å‰é¢æ’å…¥ä¸€ä¸ªStoreLoadå±éšœã€‚ä»Žæ•´ä½“æ‰§è¡Œæ•ˆçŽ‡çš„è§’åº¦è€ƒè™‘ï¼ŒJMMæœ€ç»ˆé€‰æ‹©äº†åœ¨æ¯ä¸ªvolatileå†™çš„åŽé¢æ’å…¥ä¸€ä¸ªStoreLoadå±éšœã€‚å› ä¸ºvolatileå†™-è¯»å†…å­˜è¯­ä¹‰çš„å¸¸è§ä½¿ç”¨æ¨¡å¼æ˜¯ï¼šä¸€ä¸ªå†™çº¿ç¨‹å†™volatileå˜é‡ï¼Œå¤šä¸ªè¯»çº¿ç¨‹è¯»åŒä¸€ä¸ªvolatileå˜é‡ã€‚å½“è¯»çº¿ç¨‹çš„æ•°é‡å¤§å¤§è¶…è¿‡å†™çº¿ç¨‹æ—¶ï¼Œé€‰æ‹©åœ¨volatileå†™ä¹‹åŽæ’å…¥StoreLoadå±éšœå°†å¸¦æ¥å¯è§‚çš„æ‰§è¡Œæ•ˆçŽ‡çš„æå‡ã€‚ä»Žè¿™é‡Œå¯ä»¥çœ‹åˆ°JMMåœ¨å®žçŽ°ä¸Šçš„ä¸€ä¸ªç‰¹ç‚¹ï¼šé¦–å…ˆç¡®ä¿æ­£ç¡®æ€§ï¼Œç„¶åŽå†åŽ»è¿½æ±‚æ‰§è¡Œæ•ˆçŽ‡ã€‚ ä¸‹é¢æ˜¯åœ¨ä¿å®ˆç­–ç•¥ä¸‹ï¼Œvolatileè¯»æ’å…¥å†…å­˜å±éšœåŽç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾:å›¾ä¸­çš„LoadLoadå±éšœç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŠŠä¸Šé¢çš„volatileè¯»ä¸Žä¸‹é¢çš„æ™®é€šè¯»é‡æŽ’åºã€‚LoadStoreå±éšœç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŠŠä¸Šé¢çš„volatileè¯»ä¸Žä¸‹é¢çš„æ™®é€šå†™é‡æŽ’åºã€‚ ä¸Šè¿°volatileå†™å’Œvolatileè¯»çš„å†…å­˜å±éšœæ’å…¥ç­–ç•¥éžå¸¸ä¿å®ˆã€‚åœ¨å®žé™…æ‰§è¡Œæ—¶ï¼Œåªè¦ä¸æ”¹å˜volatileå†™-è¯»çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨å¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µçœç•¥ä¸å¿…è¦çš„å±éšœã€‚ 6ã€AQSå¯¹äºŽAQSéœ€è¦äº†è§£è¿™ä¹ˆå‡ ç‚¹ï¼š é”çš„çŠ¶æ€é€šè¿‡volatile int stateæ¥è¡¨ç¤ºã€‚ èŽ·å–ä¸åˆ°é”çš„çº¿ç¨‹ä¼šè¿›å…¥AQSçš„é˜Ÿåˆ—ç­‰å¾…ã€‚ å­ç±»éœ€è¦é‡å†™tryAcquireã€tryReleaseç­‰æ–¹æ³•ã€‚ AQS è¯¦è§£å‚è§ï¼šé¢è¯•å¿…å¤‡ï¼šJava AQS å®žçŽ°åŽŸç†ï¼ˆå›¾æ–‡ï¼‰åˆ†æž 7ã€ReentrantLockä»¥å…¬å¹³é”ä¸ºä¾‹ï¼Œçœ‹çœ‹ ReentrantLock èŽ·å–é” &amp; é‡Šæ”¾é”çš„å…³é”®ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243/** * The synchronization state. */private volatile int state;/** * Returns the current value of synchronization state. * This operation has memory semantics of a &#123;@code volatile&#125; read. * @return current state value */protected final int getState() &#123; return state;&#125;protected final boolean tryRelease(int releases) &#123; int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) &#123; free = true; setExclusiveOwnerThread(null); &#125; setState(c);// é‡Šæ”¾é”çš„æœ€åŽï¼Œå†™volatileå˜é‡state return free;&#125; protected final boolean tryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState();// èŽ·å–é”çš„å¼€å§‹ï¼Œé¦–å…ˆè¯»volatileå˜é‡state if (c == 0) &#123; if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) throw new Error(&quot;Maximum lock count exceeded&quot;); setState(nextc); return true; &#125; return false;&#125; å…¬å¹³é”åœ¨é‡Šæ”¾é”çš„æœ€åŽå†™volatileå˜é‡stateï¼Œåœ¨èŽ·å–é”æ—¶é¦–å…ˆè¯»è¿™ä¸ªvolatileå˜é‡ã€‚æ ¹æ®volatileçš„happens-beforeè§„åˆ™ï¼Œé‡Šæ”¾é”çš„çº¿ç¨‹åœ¨å†™volatileå˜é‡ä¹‹å‰å¯è§çš„å…±äº«å˜é‡ï¼Œåœ¨èŽ·å–é”çš„çº¿ç¨‹è¯»å–åŒä¸€ä¸ªvolatileå˜é‡åŽå°†ç«‹å³å˜å¾—å¯¹èŽ·å–é”çš„çº¿ç¨‹å¯è§ã€‚ä»Žè€Œä¿è¯äº†ä»£ç æ®µä¸­å˜é‡ï¼ˆå˜é‡ä¸»è¦æ˜¯æŒ‡å…±äº«å˜é‡ï¼Œå­˜åœ¨ç«žäº‰é—®é¢˜çš„å˜é‡ï¼‰çš„å¯è§æ€§ã€‚ 8ã€å°ç»“ å¦‚æžœæˆ‘ä»¬ä»”ç»†åˆ†æžconcurrentåŒ…çš„æºä»£ç å®žçŽ°ï¼Œä¼šå‘çŽ°ä¸€ä¸ªé€šç”¨åŒ–çš„å®žçŽ°æ¨¡å¼ã€‚ é¦–å…ˆï¼Œå£°æ˜Žå…±äº«å˜é‡ä¸ºvolatileã€‚ ç„¶åŽï¼Œä½¿ç”¨CASçš„åŽŸå­æ¡ä»¶æ›´æ–°æ¥å®žçŽ°çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚ åŒæ—¶ï¼Œé…åˆä»¥volatileçš„è¯»/å†™å’ŒCASæ‰€å…·æœ‰çš„volatileè¯»å’Œå†™çš„å†…å­˜è¯­ä¹‰æ¥å®žçŽ°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ å‰æ–‡æˆ‘ä»¬æåˆ°è¿‡ï¼Œç¼–è¯‘å™¨ä¸ä¼šå¯¹volatileè¯»ä¸Žvolatileè¯»åŽé¢çš„ä»»æ„å†…å­˜æ“ä½œé‡æŽ’åºï¼›ç¼–è¯‘å™¨ä¸ä¼šå¯¹volatileå†™ä¸Žvolatileå†™å‰é¢çš„ä»»æ„å†…å­˜æ“ä½œé‡æŽ’åºã€‚ç»„åˆè¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œæ„å‘³ç€ä¸ºäº†åŒæ—¶å®žçŽ°volatileè¯»å’Œvolatileå†™çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨ä¸èƒ½å¯¹CASä¸ŽCASå‰é¢å’ŒåŽé¢çš„ä»»æ„å†…å­˜æ“ä½œé‡æŽ’åºã€‚ æœ¬æ–‡å‚è€ƒï¼š 1ã€ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ æ–¹è…¾é£ž é­é¹ ç¨‹æ™“æ˜Ž è‘— 2ã€Java å¯é‡å…¥é”å†…å­˜å¯è§æ€§åˆ†æž]]></content>
      <categories>
        <category>JUC</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JUC</tag>
        <tag>AQS</tag>
        <tag>JDK</tag>
        <tag>Volatile</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java Lambdaè¡¨è¾¾å¼ å®žçŽ°åŽŸç†åˆ†æž]]></title>
    <url>%2Fjava-lambda.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡åˆ†æžåŸºäºŽJDK 9 ä¸€ã€ç›®æ ‡æœ¬æ–‡ä¸»è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š 1ã€å‡½æ•°å¼æŽ¥å£ åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ 2ã€Lambdaè¡¨è¾¾å¼æ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ å…ˆä»‹ç»ä¸€ä¸ªjdkçš„binç›®å½•ä¸‹çš„ä¸€ä¸ªå­—èŠ‚ç æŸ¥çœ‹å·¥å…·åŠåç¼–è¯‘å·¥å…·ï¼šjavap äºŒã€å‡½æ•°å¼æŽ¥å£1234@FunctionalInterfaceinterface IFunctionTest&lt;T&gt; &#123; public void print(T x);&#125; é€šè¿‡javap åç¼–è¯‘IFunctionTest.class å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯: 12345$C:\Users\Code\Java\study&gt;javap -p IFunctionTest.classCompiled from &quot;FunctionTest.java&quot;interface IFunctionTest&lt;T&gt; &#123; public abstract void print(T);&#125; å¯ä»¥çœ‹åˆ°å‡½æ•°å¼æŽ¥å£ç¼–è¯‘å®Œä¹‹åŽä¾ç„¶æ˜¯ä¸€ä¸ªæŽ¥å£ï¼Œè¿™ä¸ªæŽ¥å£å…·æœ‰å”¯ä¸€çš„ä¸€ä¸ªæŠ½åƒæ–¹æ³•ã€‚ ä¸ºä»€ä¹ˆè¯´éœ€è¦æ˜¯å”¯ä¸€ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Ÿ 12345@FunctionalInterfaceinterface IFunctionTest&lt;T&gt; &#123; public void print(T x); public void print22(T x,int rr);&#125; è™½ç„¶ä¸èƒ½åœ¨å‡½æ•°å¼æŽ¥å£ä¸­å®šä¹‰å¤šä¸ªæ–¹æ³•ï¼Œä½†å¯ä»¥å®šä¹‰é»˜è®¤æ–¹æ³•ã€é™æ€æ–¹æ³•ã€å®šä¹‰java.lang.Objecté‡Œçš„publicæ–¹æ³•ï¼š 123456789101112@FunctionalInterfaceinterface Print&lt;T&gt; &#123; public void print(T x); default void doSomeMoreWork1()&#123; // Method body &#125; static void printHello()&#123; System.out.println(&quot;Hello&quot;); &#125; @Override boolean equals(Object obj);&#125; åç¼–è¯‘æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 12345678$C:\Users\Code\Java\study&gt;javap -p IFunctionTest.classCompiled from &quot;FunctionTest.java&quot;interface IFunctionTest&lt;T&gt; &#123; public abstract void print(T); public void doSomeMoreWork1(); public static void printHello(); public abstract boolean equals(java.lang.Object);&#125; ä¸‰ã€Lambda3.1 ç¤ºä¾‹ä»£ç 12345678910111213public class LambdaTest &#123; public static void printString(String s, Print&lt;String&gt; print) &#123; print.print(s); &#125; public static void main(String[] args) &#123; printString(&quot;test&quot;, (x) -&gt; System.out.println(x)); &#125;&#125;@FunctionalInterfaceinterface Print&lt;T&gt; &#123; public void print(T x);&#125; é€šè¿‡javacç¼–è¯‘LambdaTest.javaæ–‡ä»¶ï¼Œä¼šç”ŸæˆLambdaTest.classã€Print.classä¸¤ä¸ªclassæ–‡ä»¶ã€‚ 1javac LambdaTest.java 3.2 å¯¹äºŽlambdaå®žçŽ°çš„çŒœæµ‹é‚£ä¹ˆç¼–è¯‘å™¨å¯¹Lambda éƒ½åšäº†ä»€ä¹ˆï¼Ÿåç¼–è¯‘ä¸€ä¸‹ä»£ç å¦‚ä¸‹ï¼š 12345678C:\Users\Code\Java\study&gt;javap -p LambdaTest.classCompiled from &quot;LambdaTest.java&quot;public class LambdaTest &#123; public LambdaTest(); public static void printString(java.lang.String, Print&lt;java.lang.String&gt;); public static void main(java.lang.String[]); private static void lambda$main$0(java.lang.String);&#125; ç”±ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºç¼–è¯‘å™¨ä¼šæ ¹æ®Lambdaè¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªç§æœ‰çš„é™æ€å‡½æ•°ï¼š 1private static void lambda$main$0(java.lang.String); ä¸ºäº†éªŒè¯ä¸Šé¢çš„è½¬åŒ–æ˜¯å¦æ­£ç¡®? æˆ‘ä»¬åœ¨ä»£ç ä¸­å®šä¹‰ä¸€ä¸ªlambda$main$0è¿™ä¸ªçš„å‡½æ•°ï¼Œæœ€ç»ˆä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112131415public class LambdaTest &#123; public static void printString(String s, Print&lt;String&gt; print) &#123; print.print(s); &#125; public static void main(String[] args) &#123; printString(&quot;test&quot;, (x) -&gt; System.out.println(x)); &#125; private static void lambda$main$0(String s) &#123; &#125;&#125;@FunctionalInterfaceinterface Print&lt;T&gt; &#123; public void print(T x);&#125; ä¸Šé¢çš„ä»£ç åœ¨ç¼–è¯‘æ—¶ä¼šæŠ¥é”™ï¼Œé”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š 12345678910C:\Users\Code\Java\study&gt;javac LambdaTest.javaLambdaTest.java:8: é”™è¯¯: ç¬¦å·lambda$main$0(String)ä¸ŽLambdaTestä¸­çš„ compiler-synthesized ç¬¦å·å†²çª private static void lambda$main$0(String s) &#123; ^LambdaTest.java:1: é”™è¯¯: ç¬¦å·lambda$main$0(String)ä¸ŽLambdaTestä¸­çš„ compiler-synthesized ç¬¦å·å†²çªpublic class LambdaTest &#123;^2 ä¸ªé”™è¯¯ æœ‰äº†ä¸Šé¢çš„å†…å®¹ï¼Œå¯ä»¥çŸ¥é“çš„æ˜¯Lambdaè¡¨è¾¾å¼åœ¨Java 9ä¸­é¦–å…ˆä¼šç”Ÿæˆä¸€ä¸ªç§æœ‰çš„é™æ€å‡½æ•°ï¼Œè¿™ä¸ªç§æœ‰çš„é™æ€å‡½æ•°å¹²çš„å°±æ˜¯Lambdaè¡¨è¾¾å¼é‡Œé¢çš„å†…å®¹ï¼Œé‚£ä¹ˆåˆæ˜¯å¦‚ä½•è°ƒç”¨çš„ç”Ÿæˆçš„ç§æœ‰é™æ€å‡½æ•°ï¼ˆlambda$main$0(String s)ï¼‰å‘¢ï¼Ÿ 3.3 åç¼–è¯‘ä»£ç è¯¦è§£æŸ¥çœ‹æ›´åŠ è¯¦ç»†çš„åç¼–è¯‘ç»“æžœï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133$C:\Users\Code\Java\study&gt; javap -p -v -c LambdaTest.classClassfile /C:/Users/Code/Java/study/LambdaTest.class Last modified 2018-4-5; size 1184 bytes MD5 checksum b144b5a936a04a7c975eae93c7370174 Compiled from &quot;LambdaTest.java&quot;public class LambdaTest minor version: 0 major version: 52 flags: ACC_PUBLIC, ACC_SUPERConstant pool: #1 = Methodref #9.#24 // java/lang/Object.&quot;&lt;init&gt;&quot;:()V #2 = InterfaceMethodref #25.#26 // Print.print:(Ljava/lang/Object;)V #3 = String #27 // test #4 = InvokeDynamic #0:#33 // #0:print:()LPrint; #5 = Methodref #8.#34 // LambdaTest.printString:(Ljava/lang/String;LPrint;)V #6 = Fieldref #35.#36 // java/lang/System.out:Ljava/io/PrintStream; #7 = Methodref #37.#38 // java/io/PrintStream.println:(Ljava/lang/String;)V #8 = Class #39 // LambdaTest #9 = Class #40 // java/lang/Object #10 = Utf8 &lt;init&gt; #11 = Utf8 ()V #12 = Utf8 Code #13 = Utf8 LineNumberTable #14 = Utf8 printString #15 = Utf8 (Ljava/lang/String;LPrint;)V #16 = Utf8 Signature #17 = Utf8 (Ljava/lang/String;LPrint&lt;Ljava/lang/String;&gt;;)V #18 = Utf8 main #19 = Utf8 ([Ljava/lang/String;)V #20 = Utf8 lambda$main$0 #21 = Utf8 (Ljava/lang/String;)V #22 = Utf8 SourceFile #23 = Utf8 LambdaTest.java #24 = NameAndType #10:#11 // &quot;&lt;init&gt;&quot;:()V #25 = Class #41 // Print #26 = NameAndType #42:#43 // print:(Ljava/lang/Object;)V #27 = Utf8 test #28 = Utf8 BootstrapMethods #29 = MethodHandle #6:#44 // invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite; #30 = MethodType #43 // (Ljava/lang/Object;)V #31 = MethodHandle #6:#45 // invokestatic LambdaTest.lambda$main$0:(Ljava/lang/String;)V #32 = MethodType #21 // (Ljava/lang/String;)V #33 = NameAndType #42:#46 // print:()LPrint; #34 = NameAndType #14:#15 // printString:(Ljava/lang/String;LPrint;)V #35 = Class #47 // java/lang/System #36 = NameAndType #48:#49 // out:Ljava/io/PrintStream; #37 = Class #50 // java/io/PrintStream #38 = NameAndType #51:#21 // println:(Ljava/lang/String;)V #39 = Utf8 LambdaTest #40 = Utf8 java/lang/Object #41 = Utf8 Print #42 = Utf8 print #43 = Utf8 (Ljava/lang/Object;)V #44 = Methodref #52.#53 // java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite; #45 = Methodref #8.#54 // LambdaTest.lambda$main$0:(Ljava/lang/String;)V #46 = Utf8 ()LPrint; #47 = Utf8 java/lang/System #48 = Utf8 out #49 = Utf8 Ljava/io/PrintStream; #50 = Utf8 java/io/PrintStream #51 = Utf8 println #52 = Class #55 // java/lang/invoke/LambdaMetafactory #53 = NameAndType #56:#60 // metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite; #54 = NameAndType #20:#21 // lambda$main$0:(Ljava/lang/String;)V #55 = Utf8 java/lang/invoke/LambdaMetafactory #56 = Utf8 metafactory #57 = Class #62 // java/lang/invoke/MethodHandles$Lookup #58 = Utf8 Lookup #59 = Utf8 InnerClasses #60 = Utf8 (Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite; #61 = Class #63 // java/lang/invoke/MethodHandles #62 = Utf8 java/lang/invoke/MethodHandles$Lookup #63 = Utf8 java/lang/invoke/MethodHandles&#123; public LambdaTest(); descriptor: ()V flags: ACC_PUBLIC Code: stack=1, locals=1, args_size=1 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return LineNumberTable: line 1: 0 public static void printString(java.lang.String, Print&lt;java.lang.String&gt;); descriptor: (Ljava/lang/String;LPrint;)V flags: ACC_PUBLIC, ACC_STATIC Code: stack=2, locals=2, args_size=2 0: aload_1 1: aload_0 2: invokeinterface #2, 2 // InterfaceMethod Print.print:(Ljava/lang/Object;)V 7: return LineNumberTable: line 3: 0 line 4: 7 Signature: #17 // (Ljava/lang/String;LPrint&lt;Ljava/lang/String;&gt;;)V public static void main(java.lang.String[]); descriptor: ([Ljava/lang/String;)V flags: ACC_PUBLIC, ACC_STATIC Code: stack=2, locals=1, args_size=1 0: ldc #3 // String test 2: invokedynamic #4, 0 // InvokeDynamic #0:print:()LPrint; 7: invokestatic #5 // Method printString:(Ljava/lang/String;LPrint;)V 10: return LineNumberTable: line 6: 0 line 7: 10 private static void lambda$main$0(java.lang.String); descriptor: (Ljava/lang/String;)V flags: ACC_PRIVATE, ACC_STATIC, ACC_SYNTHETIC Code: stack=2, locals=1, args_size=1 0: getstatic #6 // Field java/lang/System.out:Ljava/io/PrintStream; 3: aload_0 4: invokevirtual #7 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 7: return LineNumberTable: line 6: 0&#125;SourceFile: &quot;LambdaTest.java&quot;InnerClasses: public static final #58= #57 of #61; //Lookup=class java/lang/invoke/MethodHandles$Lookup of class java/lang/invoke/MethodHandlesBootstrapMethods: 0: #29 invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;Method arguments: #30 (Ljava/lang/Object;)V #31 invokestatic LambdaTest.lambda$main$0:(Ljava/lang/String;)V #32 (Ljava/lang/String;)V è¿™ä¸ª class æ–‡ä»¶å±•ç¤ºäº†ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼šå¸¸é‡æ± ã€æž„é€ å™¨æ–¹æ³•å’Œ printStringã€mainã€lambdamainmain0æ–¹æ³•è¿˜æœ‰lambdaè¡¨è¾¾å¼ç”Ÿæˆçš„å†…éƒ¨ç±»ã€‚ 3.3.1 åŠ¨æ€é“¾æŽ¥æ¯ä¸ªæ ˆå¸§éƒ½æœ‰ä¸€ä¸ªè¿è¡Œæ—¶å¸¸é‡æ± çš„å¼•ç”¨ã€‚è¿™ä¸ªå¼•ç”¨æŒ‡å‘æ ˆå¸§å½“å‰è¿è¡Œæ–¹æ³•æ‰€åœ¨ç±»çš„å¸¸é‡æ± ã€‚é€šè¿‡è¿™ä¸ªå¼•ç”¨æ”¯æŒåŠ¨æ€é“¾æŽ¥ï¼ˆdynamic linkingï¼‰ã€‚ C/C++ ä»£ç ä¸€èˆ¬è¢«ç¼–è¯‘æˆå¯¹è±¡æ–‡ä»¶ï¼Œç„¶åŽå¤šä¸ªå¯¹è±¡æ–‡ä»¶è¢«é“¾æŽ¥åˆ°ä¸€èµ·äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶æˆ–è€… dllã€‚åœ¨é“¾æŽ¥é˜¶æ®µï¼Œæ¯ä¸ªå¯¹è±¡æ–‡ä»¶çš„ç¬¦å·å¼•ç”¨è¢«æ›¿æ¢æˆäº†æœ€ç»ˆæ‰§è¡Œæ–‡ä»¶çš„ç›¸å¯¹åç§»å†…å­˜åœ°å€ã€‚åœ¨ Javaä¸­ï¼Œé“¾æŽ¥é˜¶æ®µæ˜¯è¿è¡Œæ—¶åŠ¨æ€å®Œæˆçš„ã€‚ å½“ Java ç±»æ–‡ä»¶ç¼–è¯‘æ—¶ï¼Œæ‰€æœ‰å˜é‡å’Œæ–¹æ³•çš„å¼•ç”¨éƒ½è¢«å½“åšç¬¦å·å¼•ç”¨å­˜å‚¨åœ¨è¿™ä¸ªç±»çš„å¸¸é‡æ± ä¸­ã€‚ç¬¦å·å¼•ç”¨æ˜¯ä¸€ä¸ªé€»è¾‘å¼•ç”¨ï¼Œå®žé™…ä¸Šå¹¶ä¸æŒ‡å‘ç‰©ç†å†…å­˜åœ°å€ã€‚JVM å¯ä»¥é€‰æ‹©ç¬¦å·å¼•ç”¨è§£æžçš„æ—¶æœºï¼Œä¸€ç§æ˜¯å½“ç±»æ–‡ä»¶åŠ è½½å¹¶æ ¡éªŒé€šè¿‡åŽï¼Œè¿™ç§è§£æžæ–¹å¼è¢«ç§°ä¸ºé¥¥é¥¿æ–¹å¼ã€‚å¦å¤–ä¸€ç§æ˜¯ç¬¦å·å¼•ç”¨åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™è¢«è§£æžï¼Œè¿™ç§è§£æžæ–¹å¼ç§°ä¸ºæƒ°æ€§æ–¹å¼ã€‚æ— è®ºå¦‚ä½• ï¼ŒJVM å¿…é¡»è¦åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨ç¬¦å·å¼•ç”¨æ—¶å®Œæˆè§£æžå¹¶æŠ›å‡ºå¯èƒ½å‘ç”Ÿçš„è§£æžé”™è¯¯ã€‚ç»‘å®šæ˜¯å°†å¯¹è±¡åŸŸã€æ–¹æ³•ã€ç±»çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æŽ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ç»‘å®šåªä¼šå‘ç”Ÿä¸€æ¬¡ã€‚ä¸€æ—¦ç»‘å®šï¼Œç¬¦å·å¼•ç”¨ä¼šè¢«å®Œå…¨æ›¿æ¢ã€‚å¦‚æžœä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨è¿˜æ²¡æœ‰è¢«è§£æžï¼Œé‚£ä¹ˆå°±ä¼šè½½å…¥è¿™ä¸ªç±»ã€‚æ¯ä¸ªç›´æŽ¥å¼•ç”¨éƒ½è¢«å­˜å‚¨ä¸ºç›¸å¯¹äºŽå­˜å‚¨ç»“æž„ï¼ˆä¸Žè¿è¡Œæ—¶å˜é‡æˆ–æ–¹æ³•çš„ä½ç½®ç›¸å…³è”çš„ï¼‰åç§»é‡ã€‚ 3.3.2 å¸¸é‡æ± JVM ç»´æŠ¤äº†ä¸€ä¸ªæŒ‰ç±»åž‹åŒºåˆ†çš„å¸¸é‡æ± ï¼Œä¸€ä¸ªç±»ä¼¼äºŽç¬¦å·è¡¨çš„è¿è¡Œæ—¶æ•°æ®ç»“æž„ã€‚å°½ç®¡å®ƒåŒ…å«æ›´å¤šæ•°æ®ã€‚Java å­—èŠ‚ç éœ€è¦æ•°æ®ã€‚è¿™ä¸ªæ•°æ®ç»å¸¸å› ä¸ºå¤ªå¤§ä¸èƒ½ç›´æŽ¥å­˜å‚¨åœ¨å­—èŠ‚ç ä¸­ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ï¼Œå­—èŠ‚ç åŒ…å«è¿™ä¸ªå¸¸é‡æ± çš„å¼•ç”¨ã€‚ å¸¸é‡æ± ä¸­å¯ä»¥å­˜å‚¨å¤šç§ç±»åž‹çš„æ•°æ®ï¼š æ•°å­—åž‹ å­—ç¬¦ä¸²åž‹ ç±»å¼•ç”¨åž‹ åŸŸå¼•ç”¨åž‹ æ–¹æ³•å¼•ç”¨ 3.3.3 æ–¹æ³•æ¯ä¸€ä¸ªæ–¹æ³•åŒ…å«å››ä¸ªåŒºåŸŸï¼š ç­¾åå’Œè®¿é—®æ ‡ç­¾ å­—èŠ‚ç  LineNumberTableï¼šä¸ºè°ƒè¯•å™¨æä¾›æºç ä¸­çš„æ¯ä¸€è¡Œå¯¹åº”çš„å­—èŠ‚ç ä¿¡æ¯ LocalVariableTableï¼šåˆ—å‡ºäº†æ‰€æœ‰æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡ æ“ä½œç  ä½œç”¨ aload0 è¿™ä¸ªæ“ä½œç æ˜¯aloadæ ¼å¼æ“ä½œç ä¸­çš„ä¸€ä¸ªã€‚å®ƒä»¬ç”¨æ¥æŠŠå¯¹è±¡å¼•ç”¨åŠ è½½åˆ°æ“ä½œç æ ˆã€‚è¡¨ç¤ºæ­£åœ¨è¢«è®¿é—®çš„å±€éƒ¨å˜é‡æ•°ç»„çš„ä½ç½®ï¼Œä½†åªèƒ½æ˜¯0ã€1ã€2ã€3 ä¸­çš„ä¸€ä¸ªã€‚è¿˜æœ‰ä¸€äº›å…¶å®ƒç±»ä¼¼çš„æ“ä½œç ç”¨æ¥è½½å…¥éžå¯¹è±¡å¼•ç”¨çš„æ•°æ®ï¼Œå¦‚iload, lload, float å’Œ dloadã€‚å…¶ä¸­ i è¡¨ç¤º intï¼Œl è¡¨ç¤º longï¼Œf è¡¨ç¤º floatï¼Œd è¡¨ç¤º doubleã€‚å±€éƒ¨å˜é‡æ•°ç»„ä½ç½®å¤§äºŽ 3 çš„å±€éƒ¨å˜é‡å¯ä»¥ç”¨ iload, lload, float, dload å’Œ aload è½½å…¥ã€‚è¿™äº›æ“ä½œç éƒ½åªéœ€è¦ä¸€ä¸ªæ“ä½œæ•°ï¼Œå³æ•°ç»„ä¸­çš„ä½ç½®ã€‚ ldc è¿™ä¸ªæ“ä½œç ç”¨æ¥å°†å¸¸é‡ä»Žè¿è¡Œæ—¶å¸¸é‡æ± åŽ‹æ ˆåˆ°æ“ä½œæ•°æ ˆã€‚ getstatic è¿™ä¸ªæ“ä½œç ç”¨æ¥æŠŠä¸€ä¸ªé™æ€å˜é‡ä»Žè¿è¡Œæ—¶å¸¸é‡æ± çš„é™æ€å˜é‡åˆ—è¡¨ä¸­åŽ‹æ ˆåˆ°æ“ä½œæ•°æ ˆã€‚ return è¿™ä¸ªæ“ä½œç å±žäºŽireturnã€lreturnã€freturnã€dreturnã€areturn å’Œ return æ“ä½œç ç»„ã€‚æ¯ä¸ªæ“ä½œç è¿”å›žä¸€ç§ç±»åž‹çš„è¿”å›žå€¼ï¼Œå…¶ä¸­ i è¡¨ç¤º intï¼Œl è¡¨ç¤º longï¼Œf è¡¨ç¤º floatï¼Œd è¡¨ç¤º doubleï¼Œa è¡¨ç¤º å¯¹è±¡å¼•ç”¨ã€‚æ²¡æœ‰å‰ç¼€ç±»åž‹å­—æ¯çš„ return è¡¨ç¤ºè¿”å›ž voidã€‚ å‡½æ•°è°ƒç”¨æ“ä½œç  ä½œç”¨ invokestatic è°ƒç”¨ç±»æ–¹æ³•ï¼ˆé™æ€ç»‘å®šï¼Œé€Ÿåº¦å¿«ï¼‰ invokevirtual æŒ‡ä»¤è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„å®žä¾‹æ–¹æ³•ï¼ˆåŠ¨æ€ç»‘å®šï¼‰ invokespecial æŒ‡ä»¤è°ƒç”¨å®žä¾‹åˆå§‹åŒ–æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€çˆ¶ç±»æ–¹æ³•ã€‚ï¼ˆé™æ€ç»‘å®šï¼Œé€Ÿåº¦å¿«ï¼‰ invokeinterface è°ƒç”¨å¼•ç”¨ç±»åž‹ä¸ºinterfaceçš„å®žä¾‹æ–¹æ³•ï¼ˆåŠ¨æ€ç»‘å®šï¼‰ invokedynamic JDK 7å¼•å…¥çš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒåŠ¨æ€è¯­è¨€çš„æ–¹æ³•è°ƒç”¨ 3.3.4 ä»£ç åˆ†æžæ³¨æ„åç¼–è¯‘åŽmainæ–¹æ³•éƒ¨åˆ†ï¼š 123456789101112public static void main(java.lang.String[]); descriptor: ([Ljava/lang/String;)V flags: ACC_PUBLIC, ACC_STATIC Code: stack=2, locals=1, args_size=1 // ldc è¿™ä¸ªæ“ä½œç ç”¨æ¥å°†å¸¸é‡ä»Žè¿è¡Œæ—¶å¸¸é‡æ± åŽ‹æ ˆåˆ°æ“ä½œæ•°æ ˆ 0: ldc #3 // String test // æ³¨æ„ä¸‹é¢ä¸¤å¥ï¼šé€šè¿‡å®žä¾‹è°ƒç”¨ print 2: invokedynamic #4, 0 // InvokeDynamic #0:print:()LPrint; //è°ƒç”¨é™æ€æ–¹æ³• printString 7: invokestatic #5 // Method printString:(Ljava/lang/String;LPrint;)V 10: return é‚£ä¹ˆï¼Œæ—¢ç„¶æ˜¯è°ƒç”¨å®žä¾‹æ–¹æ³•ï¼Œé‚£ä¹ˆå®žä¾‹åœ¨å“ªï¼Ÿ 12345678910InnerClasses: public static final #58= #57 of #61; //Lookup=class java/lang/invoke/MethodHandles$Lookup of class java/lang/invoke/MethodHandlesBootstrapMethods: 0: #29 invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite; Method arguments: //å¯¹è±¡ç±»åž‹ç»ˆç»“ç¬¦ä¸º L å’Œ ; //Object V #30 (Ljava/lang/Object;)V #31 invokestatic LambdaTest.lambda$main$0:(Ljava/lang/String;)V #32 (Ljava/lang/String;)V å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ ä¸Š-Djdk.internal.lambda.dumpProxyClassesï¼ŒåŠ ä¸Šè¿™ä¸ªå‚æ•°åŽï¼Œè¿è¡Œæ—¶ï¼Œä¼šå°†ç”Ÿæˆçš„å†…éƒ¨ç±»classç è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ 1java -Djdk.internal.lambda.dumpProxyClasses LambdaTest é€šè¿‡jadåç¼–è¯‘LambdaTest$$Lambda$1.classæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 1234567891011// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.// Jad home page: http://www.kpdus.com/jad.html// Decompiler options: packimports(3) final class LambdaTest$$Lambda$1 implements Print &#123; private LambdaTest$$Lambda$1() &#123; &#125; public void print(Object obj) &#123; LambdaTest.lambda$main$0((String) obj); &#125;&#125; 3.3.5 ä»£ç è¿˜åŽŸè‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŽ¨æ–­å‡ºæœ€ç»ˆæ‰§è¡Œä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š 123456789101112131415161718192021222324252627public class LambdaTest &#123; public static void PrintString(String s, Print&lt;String&gt; print) &#123; print.print(s); &#125; public static void main(String[] args) &#123; PrintString(&quot;test&quot;, new LambdaTest$$Lambda$1()); &#125; private static void lambda$main$0(String x) &#123; System.out.println(x); &#125; static final class LambdaTest$$Lambda$1 implements Print &#123; public void print(Object obj) &#123; LambdaTest.lambda$main$0((String) obj); &#125; private LambdaTest$$Lambda$1() &#123; &#125; &#125;&#125;@FunctionalInterfaceinterface Print&lt;T&gt; &#123; public void print(T x);&#125; å››ã€æ€»ç»“ åœ¨ç±»ç¼–è¯‘æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªç§æœ‰é™æ€æ–¹æ³•+ä¸€ä¸ªå†…éƒ¨ç±»ï¼› åœ¨å†…éƒ¨ç±»ä¸­å®žçŽ°äº†å‡½æ•°å¼æŽ¥å£ï¼Œåœ¨å®žçŽ°æŽ¥å£çš„æ–¹æ³•ä¸­ï¼Œä¼šè°ƒç”¨ç¼–è¯‘å™¨ç”Ÿæˆçš„é™æ€æ–¹æ³•ï¼› åœ¨ä½¿ç”¨lambdaè¡¨è¾¾å¼çš„åœ°æ–¹ï¼Œé€šè¿‡ä¼ é€’å†…éƒ¨ç±»å®žä¾‹ï¼Œæ¥è°ƒç”¨å‡½æ•°å¼æŽ¥å£æ–¹æ³•ã€‚ å°±æ˜¯ä¼ é€’ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œåœ¨Javaä¸­æžå¾—è¿™ä¹ˆå¤æ‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ å‚è€ƒèµ„æ–™ï¼š https://www.cnblogs.com/WJ5888/p/4667086.html https://www.jianshu.com/p/57bffc6e7acd http://www.importnew.com/17770.html]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Lambda</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java AQS å®žçŽ°åŽŸç†ï¼ˆå›¾æ–‡ï¼‰åˆ†æž]]></title>
    <url>%2Fjava-aqs.html</url>
    <content type="text"><![CDATA[AQSï¼šAbstractQueuedSynchronizer 1ã€AQSè®¾è®¡ç®€ä»‹ AQSçš„å®žçŽ°æ˜¯åŸºäºŽä¸€ä¸ªFIFOçš„ç­‰å¾…é˜Ÿåˆ—ã€‚ ä½¿ç”¨å•ä¸ªåŽŸå­å˜é‡æ¥è¡¨ç¤ºèŽ·å–ã€é‡Šæ”¾é”çŠ¶æ€ï¼ˆfinal intï¼‰æ”¹å˜è¯¥intå€¼ä½¿ç”¨çš„æ˜¯CASã€‚ï¼ˆæ€è€ƒï¼šä¸ºä»€ä¹ˆä¸€ä¸ªintå€¼å¯ä»¥ä¿è¯å†…å­˜å¯è§æ€§ï¼Ÿï¼‰ å­ç±»åº”è¯¥å®šä¹‰ä¸€ä¸ªéžå…¬å¼€çš„å†…éƒ¨ç±»ç»§æ‰¿AQSï¼Œå¹¶å®žçŽ°å…¶ä¸­æ–¹æ³•ã€‚ AQSæ”¯æŒexclusiveä¸Žsharedä¸¤ç§æ¨¡å¼ã€‚ å†…éƒ¨ç±»ConditionObjectç”¨äºŽæ”¯æŒå­ç±»å®žçŽ°exclusiveæ¨¡å¼ å­ç±»éœ€è¦é‡å†™ï¼š tryAcquire tryRelease tryReleaseShared isHeldExclusivelyç­‰æ–¹æ³•ï¼Œå¹¶ç¡®ä¿æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ è´¯ç©¿å…¨æ–‡çš„å›¾ï¼ˆæ ¸å¿ƒï¼‰ï¼š æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼šå®šä¹‰ä¸€ä¸ªæ“ä½œä¸­ç®—æ³•çš„éª¨æž¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤çš„å®žçŽ°å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚ 2ã€ç±»ç»“æž„ ConditionObjectç±» Nodeç±» Nå¤šæ–¹æ³• 3ã€FIFOé˜Ÿåˆ—ç­‰å¾…é˜Ÿåˆ—æ˜¯CLHï¼ˆCraig, Landin, and Hagerstenï¼‰é”é˜Ÿåˆ—ã€‚ é€šè¿‡èŠ‚ç‚¹ä¸­çš„â€œçŠ¶æ€â€å­—æ®µæ¥åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦åº”è¯¥é˜»å¡žã€‚å½“è¯¥èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹é‡Šæ”¾é”çš„æ—¶å€™ï¼Œè¯¥èŠ‚ç‚¹ä¼šè¢«å”¤é†’ã€‚ 12345private transient volatile Node head;private transient volatile Node tail;//The synchronization state.//åœ¨äº’æ–¥é”ä¸­å®ƒè¡¨ç¤ºç€çº¿ç¨‹æ˜¯å¦å·²ç»èŽ·å–äº†é”ï¼Œ0æœªèŽ·å–ï¼Œ1å·²ç»èŽ·å–äº†ï¼Œå¤§äºŽ1è¡¨ç¤ºé‡å…¥æ•°ã€‚private volatile int state; AQSç»´æŠ¤äº†ä¸€ä¸ªvolatile int stateï¼ˆä»£è¡¨å…±äº«èµ„æºï¼‰å’Œä¸€ä¸ªFIFOçº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—ï¼ˆå¤šçº¿ç¨‹äº‰ç”¨èµ„æºè¢«é˜»å¡žæ—¶ä¼šè¿›å…¥æ­¤é˜Ÿåˆ—ï¼‰ã€‚ stateçš„è®¿é—®æ–¹å¼æœ‰ä¸‰ç§: getState() setState() compareAndSetState() AQSå®šä¹‰ä¸¤ç§èµ„æºå…±äº«æ–¹å¼ï¼šExclusiveï¼ˆç‹¬å ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ReentrantLockï¼‰å’ŒShareï¼ˆå…±äº«ï¼Œå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚Semaphore/CountDownLatchï¼‰ã€‚ ä¸åŒçš„è‡ªå®šä¹‰åŒæ­¥å™¨äº‰ç”¨å…±äº«èµ„æºçš„æ–¹å¼ä¹Ÿä¸åŒã€‚è‡ªå®šä¹‰åŒæ­¥å™¨åœ¨å®žçŽ°æ—¶åªéœ€è¦å®žçŽ°å…±äº«èµ„æºstateçš„èŽ·å–ä¸Žé‡Šæ”¾æ–¹å¼å³å¯ï¼Œè‡³äºŽå…·ä½“çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—çš„ç»´æŠ¤ï¼ˆå¦‚èŽ·å–èµ„æºå¤±è´¥å…¥é˜Ÿ/å”¤é†’å‡ºé˜Ÿç­‰ï¼‰ï¼ŒAQSå·²ç»åœ¨é¡¶å±‚å®žçŽ°å¥½äº†ã€‚ è‡ªå®šä¹‰åŒæ­¥å™¨å®žçŽ°æ—¶ä¸»è¦å®žçŽ°ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š isHeldExclusively()ï¼šè¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºã€‚åªæœ‰ç”¨åˆ°conditionæ‰éœ€è¦åŽ»å®žçŽ°å®ƒã€‚ tryAcquire(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•èŽ·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›žtrueï¼Œå¤±è´¥åˆ™è¿”å›žfalseã€‚ tryRelease(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›žtrueï¼Œå¤±è´¥åˆ™è¿”å›žfalseã€‚ tryAcquireShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•èŽ·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æºã€‚ tryReleaseShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼Œå¦‚æžœé‡Šæ”¾åŽå…è®¸å”¤é†’åŽç»­ç­‰å¾…ç»“ç‚¹è¿”å›žtrueï¼Œå¦åˆ™è¿”å›žfalseã€‚ ä»¥ReentrantLockä¸ºä¾‹ï¼Œstateåˆå§‹åŒ–ä¸º0ï¼Œè¡¨ç¤ºæœªé”å®šçŠ¶æ€ã€‚Açº¿ç¨‹lock()æ—¶ï¼Œä¼šè°ƒç”¨tryAcquire()ç‹¬å è¯¥é”å¹¶å°†state+1ã€‚æ­¤åŽï¼Œå…¶ä»–çº¿ç¨‹å†tryAcquire()æ—¶å°±ä¼šå¤±è´¥ï¼Œç›´åˆ°Açº¿ç¨‹unlock()åˆ°state=0ï¼ˆå³é‡Šæ”¾é”ï¼‰ä¸ºæ­¢ï¼Œå…¶å®ƒçº¿ç¨‹æ‰æœ‰æœºä¼šèŽ·å–è¯¥é”ã€‚å½“ç„¶ï¼Œé‡Šæ”¾é”ä¹‹å‰ï¼ŒAçº¿ç¨‹è‡ªå·±æ˜¯å¯ä»¥é‡å¤èŽ·å–æ­¤é”çš„ï¼ˆstateä¼šç´¯åŠ ï¼‰ï¼Œè¿™å°±æ˜¯å¯é‡å…¥çš„æ¦‚å¿µã€‚ä½†è¦æ³¨æ„ï¼ŒèŽ·å–å¤šå°‘æ¬¡å°±è¦é‡Šæ”¾å¤šä¹ˆæ¬¡ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯stateæ˜¯èƒ½å›žåˆ°é›¶æ€çš„ã€‚ å†ä»¥CountDownLatchä»¥ä¾‹ï¼Œä»»åŠ¡åˆ†ä¸ºNä¸ªå­çº¿ç¨‹åŽ»æ‰§è¡Œï¼Œstateä¹Ÿåˆå§‹åŒ–ä¸ºNï¼ˆæ³¨æ„Nè¦ä¸Žçº¿ç¨‹ä¸ªæ•°ä¸€è‡´ï¼‰ã€‚è¿™Nä¸ªå­çº¿ç¨‹æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®ŒåŽcountDown()ä¸€æ¬¡ï¼Œstateä¼šCASå‡1ã€‚ç­‰åˆ°æ‰€æœ‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®ŒåŽ(å³state=0)ï¼Œä¼šunpark()ä¸»è°ƒç”¨çº¿ç¨‹ï¼Œç„¶åŽä¸»è°ƒç”¨çº¿ç¨‹å°±ä¼šä»Žawait()å‡½æ•°è¿”å›žï¼Œç»§ç»­åŽç»­åŠ¨ä½œã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œè‡ªå®šä¹‰åŒæ­¥å™¨è¦ä¹ˆæ˜¯ç‹¬å æ–¹æ³•ï¼Œè¦ä¹ˆæ˜¯å…±äº«æ–¹å¼ï¼Œä»–ä»¬ä¹Ÿåªéœ€å®žçŽ°ï¼štryAcquire-tryReleasetryAcquireShared-tryReleaseSharedä¸­çš„ä¸€ç§å³å¯ã€‚ å½“ç„¶AQSä¹Ÿæ”¯æŒè‡ªå®šä¹‰åŒæ­¥å™¨åŒæ—¶å®žçŽ°ç‹¬å å’Œå…±äº«ä¸¤ç§æ–¹å¼ï¼Œå¦‚ReentrantReadWriteLockã€‚ ä»¥ä¸‹éƒ¨åˆ†æ¥è‡ªæºç æ³¨é‡Šï¼š æ¯æ¬¡è¿›å…¥CLHé˜Ÿåˆ—æ—¶ï¼Œéœ€è¦å¯¹å°¾èŠ‚ç‚¹è¿›å…¥é˜Ÿåˆ—è¿‡ç¨‹ï¼Œæ˜¯ä¸€ä¸ªåŽŸå­æ€§æ“ä½œã€‚åœ¨å‡ºé˜Ÿåˆ—æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ–°headèŠ‚ç‚¹å³å¯ã€‚åœ¨èŠ‚ç‚¹ç¡®å®šå®ƒçš„åŽç»§èŠ‚ç‚¹æ—¶ï¼Œ éœ€è¦èŠ±ä¸€äº›åŠŸå¤«ï¼Œç”¨äºŽå¤„ç†é‚£äº›ï¼Œç”±äºŽç­‰å¾…è¶…æ—¶æ—¶é—´ç»“æŸæˆ–ä¸­æ–­ç­‰åŽŸå› ï¼Œ è€Œå–æ¶ˆç­‰å¾…é”çš„çº¿ç¨‹ã€‚ èŠ‚ç‚¹çš„å‰é©±æŒ‡é’ˆï¼Œä¸»è¦ç”¨äºŽå¤„ç†ï¼Œå–æ¶ˆç­‰å¾…é”çš„çº¿ç¨‹ã€‚å¦‚æžœä¸€ä¸ªèŠ‚ç‚¹å–æ¶ˆç­‰å¾…é”ï¼Œåˆ™æ­¤èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹çš„åŽç»§æŒ‡é’ˆï¼Œè¦æŒ‡å‘ï¼Œæ­¤èŠ‚ç‚¹åŽç»§èŠ‚ç‚¹ä¸­ï¼Œéžå–æ¶ˆç­‰å¾…é”çš„çº¿ç¨‹ï¼ˆæœ‰æ•ˆç­‰å¾…é”çš„çº¿ç¨‹èŠ‚ç‚¹ï¼‰ã€‚ æˆ‘ä»¬ç”¨nextæŒ‡é’ˆè¿žæŽ¥å®žçŽ°é˜»å¡žæœºåˆ¶ã€‚æ¯ä¸ªèŠ‚ç‚¹å‡æŒæœ‰è‡ªå·±çº¿ç¨‹ï¼ŒèŠ‚ç‚¹é€šè¿‡èŠ‚ç‚¹çš„åŽç»§è¿žæŽ¥å”¤é†’å…¶åŽç»§èŠ‚ç‚¹ã€‚ CLHé˜Ÿåˆ—éœ€è¦ä¸€ä¸ªå‚€å„¡ç»“ç‚¹ä½œä¸ºå¼€å§‹èŠ‚ç‚¹ã€‚æˆ‘ä»¬ä¸ä¼šå†æž„é€ å‡½æ•°ä¸­åˆ›å»ºå®ƒï¼Œå› ä¸ºå¦‚æžœæ²¡æœ‰çº¿ç¨‹ç«žäº‰é”ï¼Œé‚£ä¹ˆï¼ŒåŠªåŠ›å°±ç™½è´¹äº†ã€‚å–è€Œä»£ä¹‹çš„æ–¹æ¡ˆæ˜¯ï¼Œå½“æœ‰ç¬¬ä¸€ä¸ªç«žäº‰è€…æ—¶ï¼Œæˆ‘ä»¬æ‰æž„é€ å¤´æŒ‡é’ˆå’Œå°¾æŒ‡é’ˆã€‚ çº¿ç¨‹é€šè¿‡åŒä¸€èŠ‚ç‚¹ç­‰å¾…æ¡ä»¶ï¼Œä½†æ˜¯ç”¨å¦å¤–ä¸€ä¸ªè¿žæŽ¥ã€‚æ¡ä»¶åªéœ€è¦æ”¾åœ¨ä¸€ä¸ªéžå¹¶å‘çš„è¿žæŽ¥é˜Ÿåˆ—ä¸ŽèŠ‚ç‚¹å…³è”ï¼Œå› ä¸ºåªæœ‰å½“çº¿ç¨‹ç‹¬å æŒæœ‰é”çš„æ—¶å€™ï¼Œæ‰ä¼šåŽ»è®¿é—®æ¡ä»¶ã€‚å½“ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…æ¡ä»¶çš„æ—¶å€™ï¼ŒèŠ‚ç‚¹å°†ä¼šæ’å…¥åˆ°æ¡ä»¶é˜Ÿåˆ—ä¸­ã€‚å½“æ¡ä»¶è§¦å‘æ—¶ï¼ŒèŠ‚ç‚¹å°†ä¼šè½¬ç§»åˆ°ä¸»é˜Ÿåˆ—ä¸­ã€‚ç”¨ä¸€ä¸ªçŠ¶æ€å€¼ï¼Œæè¿°èŠ‚ç‚¹åœ¨å“ªä¸€ä¸ªé˜Ÿåˆ—ä¸Šã€‚ 4ã€Node123456789101112131415161718192021222324252627282930313233static final class Node &#123; //è¯¥ç­‰å¾…èŠ‚ç‚¹å¤„äºŽå…±äº«æ¨¡å¼ static final Node SHARED = new Node(); //è¯¥ç­‰å¾…èŠ‚ç‚¹å¤„äºŽç‹¬å æ¨¡å¼ static final Node EXCLUSIVE = null; //è¡¨ç¤ºèŠ‚ç‚¹çš„çº¿ç¨‹æ˜¯å·²è¢«å–æ¶ˆçš„ static final int CANCELLED = 1; //è¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„åŽç»§èŠ‚ç‚¹çš„çº¿ç¨‹éœ€è¦è¢«å”¤é†’ static final int SIGNAL = -1; //è¡¨ç¤ºçº¿ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸ªæ¡ä»¶ static final int CONDITION = -2; //è¡¨ç¤ºä¸‹ä¸€ä¸ªå…±äº«æ¨¡å¼çš„èŠ‚ç‚¹åº”è¯¥æ— æ¡ä»¶çš„ä¼ æ’­ä¸‹åŽ» static final int PROPAGATE = -3; //çŠ¶æ€ä½ ï¼Œåˆ†åˆ«å¯ä»¥ä½¿CANCELLEDã€SINGNALã€CONDITIONã€PROPAGATEã€0 volatile int waitStatus; volatile Node prev;//å‰é©±èŠ‚ç‚¹ volatile Node next;//åŽç»§èŠ‚ç‚¹ volatile Thread thread;//ç­‰å¾…é”çš„çº¿ç¨‹ //ConditionObjecté“¾è¡¨çš„åŽç»§èŠ‚ç‚¹æˆ–è€…ä»£è¡¨å…±äº«æ¨¡å¼çš„èŠ‚ç‚¹ã€‚ //å› ä¸ºConditioné˜Ÿåˆ—åªèƒ½åœ¨ç‹¬å æ¨¡å¼ä¸‹è¢«èƒ½è¢«è®¿é—®,æˆ‘ä»¬åªéœ€è¦ç®€å•çš„ä½¿ç”¨é“¾è¡¨é˜Ÿåˆ—æ¥é“¾æŽ¥æ­£åœ¨ç­‰å¾…æ¡ä»¶çš„èŠ‚ç‚¹ã€‚ //ç„¶åŽå®ƒä»¬ä¼šè¢«è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ï¼ˆAQSé˜Ÿåˆ—ï¼‰å†æ¬¡é‡æ–°èŽ·å–ã€‚ //ç”±äºŽæ¡ä»¶é˜Ÿåˆ—åªèƒ½åœ¨ç‹¬å æ¨¡å¼ä¸‹ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è¡¨ç¤ºå…±äº«æ¨¡å¼çš„èŠ‚ç‚¹çš„è¯åªè¦ä½¿ç”¨ç‰¹æ®Šå€¼SHAREDæ¥æ ‡æ˜Žå³å¯ã€‚ Node nextWaiter; //Returns true if node is waiting in shared mode final boolean isShared() &#123; return nextWaiter == SHARED; &#125; .......&#125; waitStatusä¸åŒå€¼å«ä¹‰ï¼š SIGNAL(-1)ï¼šå½“å‰èŠ‚ç‚¹çš„åŽç»§èŠ‚ç‚¹å·²ç» (æˆ–å³å°†)è¢«é˜»å¡žï¼ˆé€šè¿‡parkï¼‰ , æ‰€ä»¥å½“å½“å‰èŠ‚ç‚¹é‡Šæ”¾æˆ–åˆ™è¢«å–æ¶ˆæ—¶å€™ï¼Œä¸€å®šè¦unparkå®ƒçš„åŽç»§èŠ‚ç‚¹ã€‚ä¸ºäº†é¿å…ç«žäº‰ï¼ŒèŽ·å–æ–¹æ³•ä¸€å®šè¦é¦–å…ˆè®¾ç½®nodeä¸ºsignalï¼Œç„¶åŽå†æ¬¡é‡æ–°è°ƒç”¨èŽ·å–æ–¹æ³•ï¼Œå¦‚æžœå¤±è´¥ï¼Œåˆ™é˜»å¡žã€‚ CANCELLED(1)ï¼šå½“å‰èŠ‚ç‚¹ç”±äºŽè¶…æ—¶æˆ–è€…è¢«ä¸­æ–­è€Œè¢«å–æ¶ˆã€‚ä¸€æ—¦èŠ‚ç‚¹è¢«å–æ¶ˆåŽï¼Œé‚£ä¹ˆå®ƒçš„çŠ¶æ€å€¼ä¸åœ¨ä¼šè¢«æ”¹å˜ï¼Œä¸”å½“å‰èŠ‚ç‚¹çš„çº¿ç¨‹ä¸ä¼šå†æ¬¡è¢«é˜»å¡žã€‚ CONDITION(-2) ï¼šè¯¥èŠ‚ç‚¹çš„çº¿ç¨‹å¤„äºŽç­‰å¾…æ¡ä»¶çŠ¶æ€,ä¸ä¼šè¢«å½“ä½œæ˜¯åŒæ­¥é˜Ÿåˆ—ä¸Šçš„èŠ‚ç‚¹,ç›´åˆ°è¢«å”¤é†’(signal),è®¾ç½®å…¶å€¼ä¸º0,é‡æ–°è¿›å…¥é˜»å¡žçŠ¶æ€. PROPAGATE(-3ï¼š)å…±äº«æ¨¡å¼ä¸‹çš„é‡Šæ”¾æ“ä½œåº”è¯¥è¢«ä¼ æ’­åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚è¯¥çŠ¶æ€å€¼åœ¨doReleaseSharedæ–¹æ³•ä¸­è¢«è®¾ç½®çš„ã€‚ 0ï¼šä»¥ä¸Šéƒ½ä¸æ˜¯ è¯¥çŠ¶æ€å€¼ä¸ºäº†ç®€ä¾¿ä½¿ç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨äº†æ•°å€¼ç±»åž‹ã€‚éžè´Ÿæ•°å€¼æ„å‘³ç€è¯¥èŠ‚ç‚¹ä¸éœ€è¦è¢«å”¤é†’ã€‚æ‰€ä»¥ï¼Œå¤§å¤šæ•°ä»£ç ä¸­ä¸éœ€è¦æ£€æŸ¥è¯¥çŠ¶æ€å€¼çš„ç¡®å®šå€¼ã€‚ ä¸€ä¸ªæ­£å¸¸çš„Nodeï¼Œå®ƒçš„waitStatusåˆå§‹åŒ–å€¼æ˜¯0ã€‚å¦‚æžœæƒ³è¦ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨AQSæä¾›CASè¿›è¡Œä¿®æ”¹ã€‚ 5ã€ç‹¬å æ¨¡å¼ä¸Žå…±äº«æ¨¡å¼åœ¨é”çš„èŽ·å–æ—¶ï¼Œå¹¶ä¸ä¸€å®šåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½æŒæœ‰è¿™ä¸ªé”ï¼ˆæˆ–è€…ç§°ä¸ºåŒæ­¥çŠ¶æ€ï¼‰ï¼Œæ‰€ä»¥æ­¤æ—¶æœ‰äº†ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼çš„åŒºåˆ«ï¼Œä¹Ÿå°±æ˜¯åœ¨NodeèŠ‚ç‚¹ä¸­ç”±nextWaiteræ¥æ ‡è¯†ã€‚æ¯”å¦‚ReentrantLockå°±æ˜¯ä¸€ä¸ªç‹¬å é”ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èŽ·å¾—é”ï¼Œè€ŒWriteAndReadLockçš„è¯»é”åˆ™èƒ½ç”±å¤šä¸ªçº¿ç¨‹åŒæ—¶èŽ·å–ï¼Œä½†å®ƒçš„å†™é”åˆ™åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚ 5.1ã€ç‹¬å æ¨¡å¼5.1.1 ç‹¬å æ¨¡å¼åŒæ­¥çŠ¶æ€çš„èŽ·å–123456789//å¿½ç•¥ä¸­æ–­çš„ï¼ˆå³ä¸æ‰‹åŠ¨æŠ›å‡ºInterruptedExceptionå¼‚å¸¸ï¼‰ç‹¬å æ¨¡å¼ä¸‹çš„èŽ·å–æ–¹æ³•ã€‚//è¯¥æ–¹æ³•åœ¨æˆåŠŸè¿”å›žå‰è‡³å°‘ä¼šè°ƒç”¨ä¸€æ¬¡tryAcquire()æ–¹æ³•(è¯¥æ–¹æ³•æ˜¯å­ç±»é‡å†™çš„æ–¹æ³•ï¼Œå¦‚æžœè¿”å›žtrueåˆ™ä»£è¡¨èƒ½æˆåŠŸèŽ·å–).//å¦åˆ™å½“å‰çº¿ç¨‹ä¼šè¿›å…¥é˜Ÿåˆ—æŽ’é˜Ÿï¼Œé‡å¤çš„é˜»å¡žå’Œå”¤é†’ç­‰å¾…å†æ¬¡æˆåŠŸèŽ·å–åŽè¿”å›ž, //è¯¥æ–¹æ³•å¯ä»¥ç”¨æ¥å®žçŽ°Lock.lockpublic final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt(); &#125; è¯¥æ–¹æ³•é¦–å…ˆå°è¯•èŽ·å–é”( tryAcquire(arg)çš„å…·ä½“å®žçŽ°å®šä¹‰åœ¨äº†å­ç±»ä¸­),å¦‚æžœèŽ·å–åˆ°,åˆ™æ‰§è¡Œå®Œæ¯•,å¦åˆ™é€šè¿‡addWaiter(Node.EXCLUSIVE), arg)æ–¹æ³•æŠŠå½“å‰èŠ‚ç‚¹æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—æœ«å°¾,å¹¶è®¾ç½®ä¸ºç‹¬å æ¨¡å¼ã€‚ 1234567891011121314151617181920212223242526272829303132private Node addWaiter(Node mode) &#123; //æŠŠå½“å‰çº¿ç¨‹åŒ…è£…ä¸ºnode,è®¾ä¸ºç‹¬å æ¨¡å¼ Node node = new Node(Thread.currentThread(), mode); // å°è¯•å¿«é€Ÿå…¥é˜Ÿï¼Œå³æ— ç«žäº‰æ¡ä»¶ä¸‹è‚¯å®šæˆåŠŸã€‚å¦‚æžœå¤±è´¥ï¼Œåˆ™è¿›å…¥enqè‡ªæ—‹é‡è¯•å…¥é˜Ÿ Node pred = tail; if (pred != null) &#123; node.prev = pred; //CASæ›¿æ¢å½“å‰å°¾éƒ¨ã€‚æˆåŠŸåˆ™è¿”å›ž if (compareAndSetTail(pred, node)) &#123; pred.next = node; return node; &#125; &#125; enq(node); return node; &#125;//æ’å…¥èŠ‚ç‚¹åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æžœé˜Ÿåˆ—æœªåˆå§‹åŒ–åˆ™åˆå§‹åŒ–ï¼Œç„¶åŽå†æ’å…¥ã€‚private Node enq(final Node node) &#123; for (;;) &#123; Node t = tail; if (t == null) &#123; // Must initialize if (compareAndSetHead(new Node())) tail = head; &#125; else &#123; node.prev = t; if (compareAndSetTail(t, node)) &#123; t.next = node; return t; &#125; &#125; &#125; &#125; å¦‚æžœtailèŠ‚ç‚¹ä¸ºç©º,æ‰§è¡Œenq(node);é‡æ–°å°è¯•,æœ€ç»ˆæŠŠnodeæ’å…¥.åœ¨æŠŠnodeæ’å…¥é˜Ÿåˆ—æœ«å°¾åŽ,å®ƒå¹¶ä¸ç«‹å³æŒ‚èµ·è¯¥èŠ‚ç‚¹ä¸­çº¿ç¨‹,å› ä¸ºåœ¨æ’å…¥å®ƒçš„è¿‡ç¨‹ä¸­,å‰é¢çš„çº¿ç¨‹å¯èƒ½å·²ç»æ‰§è¡Œå®Œæˆ,æ‰€ä»¥å®ƒä¼šå…ˆè¿›è¡Œè‡ªæ—‹æ“ä½œacquireQueued(node, arg),å°è¯•è®©è¯¥çº¿ç¨‹é‡æ–°èŽ·å–é”!å½“æ¡ä»¶æ»¡è¶³èŽ·å–åˆ°äº†é”åˆ™å¯ä»¥ä»Žè‡ªæ—‹è¿‡ç¨‹ä¸­é€€å‡ºï¼Œå¦åˆ™ç»§ç»­ã€‚ 12345678910111213141516171819202122232425final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); //å¦‚æžœå®ƒçš„å‰ç»§èŠ‚ç‚¹ä¸ºå¤´ç»“ç‚¹,å°è¯•èŽ·å–é”,èŽ·å–æˆåŠŸåˆ™è¿”å›ž if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; // help GC failed = false; return interrupted; &#125; //åˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„çº¿ç¨‹æ˜¯å¦åº”è¯¥è¢«æŒ‚èµ·ï¼Œå¦‚æžœåº”è¯¥è¢«æŒ‚èµ·åˆ™æŒ‚èµ·ã€‚ //ç­‰å¾…releaseå”¤é†’é‡Šæ”¾ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) //åœ¨é˜Ÿåˆ—ä¸­å–æ¶ˆå½“å‰èŠ‚ç‚¹ cancelAcquire(node); &#125; &#125; å¦‚æžœæ²¡èŽ·å–åˆ°é”,åˆ™åˆ¤æ–­æ˜¯å¦åº”è¯¥æŒ‚èµ·,è€Œè¿™ä¸ªåˆ¤æ–­åˆ™å¾—é€šè¿‡å®ƒçš„å‰é©±èŠ‚ç‚¹çš„waitStatusæ¥ç¡®å®š: 12345678910111213141516171819202122232425262728private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) &#123; int ws = pred.waitStatus; //è¯¥èŠ‚ç‚¹å¦‚æžœçŠ¶æ€å¦‚æžœä¸ºSIGNALã€‚åˆ™è¿”å›žtrueï¼Œç„¶åŽparkæŒ‚èµ·çº¿ç¨‹ if (ws == Node.SIGNAL) return true; //è¡¨æ˜Žè¯¥èŠ‚ç‚¹å·²ç»è¢«å–æ¶ˆï¼Œå‘å‰å¾ªçŽ¯é‡æ–°è°ƒæ•´é“¾è¡¨èŠ‚ç‚¹ if (ws &gt; 0) &#123; /* * Predecessor was cancelled. Skip over predecessors and * indicate retry. */ do &#123; node.prev = pred = pred.prev; &#125; while (pred.waitStatus &gt; 0); pred.next = node; &#125; else &#123; //æ‰§è¡Œåˆ°è¿™é‡Œä»£è¡¨èŠ‚ç‚¹æ˜¯0æˆ–è€…PROPAGATEï¼Œç„¶åŽæ ‡è®°ä»–ä»¬ä¸ºSIGNALï¼Œä½†æ˜¯ //è¿˜ä¸èƒ½parkæŒ‚èµ·çº¿ç¨‹ã€‚éœ€è¦é‡è¯•æ˜¯å¦èƒ½èŽ·å–ï¼Œå¦‚æžœä¸èƒ½ï¼Œåˆ™æŒ‚èµ·ã€‚ compareAndSetWaitStatus(pred, ws, Node.SIGNAL); &#125; return false; &#125; //æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œä¸”è¿”å›žçº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€private final boolean parkAndCheckInterrupt() &#123; LockSupport.park(this); return Thread.interrupted(); &#125; æœ€åŽ,æˆ‘ä»¬å¯¹èŽ·å–ç‹¬å å¼é”è¿‡ç¨‹å¯¹åšä¸ªæ€»ç»“: AQSçš„æ¨¡æ¿æ–¹æ³•acquireé€šè¿‡è°ƒç”¨å­ç±»è‡ªå®šä¹‰å®žçŽ°çš„tryAcquireèŽ·å–åŒæ­¥çŠ¶æ€å¤±è´¥åŽ-&gt;å°†çº¿ç¨‹æž„é€ æˆNodeèŠ‚ç‚¹(addWaiter)-&gt;å°†NodeèŠ‚ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—å¯¹å°¾(addWaiter)-&gt;èŠ‚ç‚¹ä»¥è‡ªæ—‹çš„æ–¹æ³•èŽ·å–åŒæ­¥çŠ¶æ€(acquirQueued)ã€‚åœ¨èŠ‚ç‚¹è‡ªæ—‹èŽ·å–åŒæ­¥çŠ¶æ€æ—¶ï¼Œåªæœ‰å…¶å‰é©±èŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹çš„æ—¶å€™æ‰ä¼šå°è¯•èŽ·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æžœè¯¥èŠ‚ç‚¹çš„å‰é©±ä¸æ˜¯å¤´èŠ‚ç‚¹æˆ–è€…è¯¥èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹å•èŽ·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼Œåˆ™åˆ¤æ–­å½“å‰çº¿ç¨‹éœ€è¦é˜»å¡žï¼Œå¦‚æžœéœ€è¦é˜»å¡žåˆ™éœ€è¦è¢«å”¤é†’è¿‡åŽæ‰è¿”å›žã€‚ èŽ·å–é”çš„è¿‡ç¨‹ï¼š å½“çº¿ç¨‹è°ƒç”¨acquire()ç”³è¯·èŽ·å–é”èµ„æºï¼Œå¦‚æžœæˆåŠŸï¼Œåˆ™è¿›å…¥ä¸´ç•ŒåŒºã€‚ å½“èŽ·å–é”å¤±è´¥æ—¶ï¼Œåˆ™è¿›å…¥ä¸€ä¸ªFIFOç­‰å¾…é˜Ÿåˆ—ï¼Œç„¶åŽè¢«æŒ‚èµ·ç­‰å¾…å”¤é†’ã€‚ å½“é˜Ÿåˆ—ä¸­çš„ç­‰å¾…çº¿ç¨‹è¢«å”¤é†’ä»¥åŽå°±é‡æ–°å°è¯•èŽ·å–é”èµ„æºï¼Œå¦‚æžœæˆåŠŸåˆ™è¿›å…¥ä¸´ç•ŒåŒºï¼Œå¦åˆ™ç»§ç»­æŒ‚èµ·ç­‰å¾…ã€‚ 5.1.2 ç‹¬å æ¨¡å¼åŒæ­¥çŠ¶æ€çš„é‡Šæ”¾æ—¢ç„¶æ˜¯é‡Šæ”¾,é‚£è‚¯å®šæ˜¯æŒæœ‰é”çš„è¯¥çº¿ç¨‹æ‰§è¡Œé‡Šæ”¾æ“ä½œ,å³headèŠ‚ç‚¹ä¸­çš„çº¿ç¨‹é‡Šæ”¾é”. AQSä¸­çš„releaseé‡Šæ”¾åŒæ­¥çŠ¶æ€å’ŒacquireèŽ·å–åŒæ­¥çŠ¶æ€ä¸€æ ·ï¼Œéƒ½æ˜¯æ¨¡æ¿æ–¹æ³•ï¼ŒtryReleaseé‡Šæ”¾çš„å…·ä½“æ“ä½œéƒ½æœ‰å­ç±»åŽ»å®žçŽ°ï¼Œçˆ¶ç±»AQSåªæä¾›ä¸€ä¸ªç®—æ³•éª¨æž¶ã€‚ 12345678910111213141516171819202122232425public final boolean release(int arg) &#123; if (tryRelease(arg)) &#123; Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) unparkSuccessor(h); return true; &#125; return false;&#125;//å¦‚æžœnodeçš„åŽç»§èŠ‚ç‚¹ä¸ä¸ºç©ºä¸”ä¸æ˜¯ä½œåºŸçŠ¶æ€,åˆ™å”¤é†’è¿™ä¸ªåŽç»§èŠ‚ç‚¹,//å¦åˆ™ä»Žæœ«å°¾å¼€å§‹å¯»æ‰¾åˆé€‚çš„èŠ‚ç‚¹,å¦‚æžœæ‰¾åˆ°,åˆ™å”¤é†’private void unparkSuccessor(Node node) &#123; int ws = node.waitStatus; if (ws &lt; 0) compareAndSetWaitStatus(node, ws, 0); Node s = node.next; if (s == null || s.waitStatus &gt; 0) &#123; s = null; for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; &#125; if (s != null) LockSupport.unpark(s.thread); &#125; è¿‡ç¨‹ï¼šé¦–å…ˆè°ƒç”¨å­ç±»çš„tryRelease()æ–¹æ³•é‡Šæ”¾é”ï¼Œç„¶åŽå”¤é†’åŽç»§èŠ‚ç‚¹ï¼Œåœ¨å”¤é†’çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦åˆ¤æ–­åŽç»§èŠ‚ç‚¹æ˜¯å¦æ»¡è¶³æƒ…å†µï¼Œå¦‚æžœåŽç»§èŠ‚ç‚¹ä¸ä¸ºç©ºä¸”ä¸æ˜¯ä½œåºŸçŠ¶æ€ï¼Œåˆ™å”¤é†’è¿™ä¸ªåŽç»§èŠ‚ç‚¹ï¼Œå¦åˆ™ä»ŽtailèŠ‚ç‚¹å‘å‰å¯»æ‰¾åˆé€‚çš„èŠ‚ç‚¹ï¼Œå¦‚æžœæ‰¾åˆ°ï¼Œåˆ™å”¤é†’ã€‚ é‡Šæ”¾é”è¿‡ç¨‹ï¼š å½“çº¿ç¨‹è°ƒç”¨release()è¿›è¡Œé”èµ„æºé‡Šæ”¾æ—¶ï¼Œå¦‚æžœæ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨ç­‰å¾…é”èµ„æºï¼Œåˆ™é‡Šæ”¾å®Œæˆã€‚ å¦‚æžœé˜Ÿåˆ—ä¸­æœ‰å…¶ä»–ç­‰å¾…é”èµ„æºçš„çº¿ç¨‹éœ€è¦å”¤é†’ï¼Œåˆ™å”¤é†’é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªç­‰å¾…èŠ‚ç‚¹ï¼ˆå…ˆå…¥å…ˆå‡ºï¼‰ã€‚ 5.2ã€å…±äº«æ¨¡å¼5.2.1 å…±äº«æ¨¡å¼åŒæ­¥çŠ¶æ€çš„èŽ·å– å½“çº¿ç¨‹è°ƒç”¨acquireShared()ç”³è¯·èŽ·å–é”èµ„æºæ—¶ï¼Œå¦‚æžœæˆåŠŸï¼Œåˆ™è¿›å…¥ä¸´ç•ŒåŒºã€‚ å½“èŽ·å–é”å¤±è´¥æ—¶ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªå…±äº«ç±»åž‹çš„èŠ‚ç‚¹å¹¶è¿›å…¥ä¸€ä¸ªFIFOç­‰å¾…é˜Ÿåˆ—ï¼Œç„¶åŽè¢«æŒ‚èµ·ç­‰å¾…å”¤é†’ã€‚ å½“é˜Ÿåˆ—ä¸­çš„ç­‰å¾…çº¿ç¨‹è¢«å”¤é†’ä»¥åŽå°±é‡æ–°å°è¯•èŽ·å–é”èµ„æºï¼Œå¦‚æžœæˆåŠŸåˆ™å”¤é†’åŽé¢è¿˜åœ¨ç­‰å¾…çš„å…±äº«èŠ‚ç‚¹å¹¶æŠŠè¯¥å”¤é†’äº‹ä»¶ä¼ é€’ä¸‹åŽ»ï¼Œå³ä¼šä¾æ¬¡å”¤é†’åœ¨è¯¥èŠ‚ç‚¹åŽé¢çš„æ‰€æœ‰å…±äº«èŠ‚ç‚¹ï¼Œç„¶åŽè¿›å…¥ä¸´ç•ŒåŒºï¼Œå¦åˆ™ç»§ç»­æŒ‚èµ·ç­‰å¾…ã€‚ 5.2.2 å…±äº«æ¨¡å¼åŒæ­¥çŠ¶æ€çš„é‡Šæ”¾ å½“çº¿ç¨‹è°ƒç”¨releaseShared()è¿›è¡Œé”èµ„æºé‡Šæ”¾æ—¶ï¼Œå¦‚æžœé‡Šæ”¾æˆåŠŸï¼Œåˆ™å”¤é†’é˜Ÿåˆ—ä¸­ç­‰å¾…çš„èŠ‚ç‚¹ï¼Œå¦‚æžœæœ‰çš„è¯ã€‚ 6. AQSå°ç»“java.util.concurrentä¸­çš„å¾ˆå¤šå¯é˜»å¡žç±»ï¼ˆæ¯”å¦‚ReentrantLockï¼‰éƒ½æ˜¯åŸºäºŽAQSæ¥å®žçŽ°çš„ã€‚AQSæ˜¯ä¸€ä¸ªåŒæ­¥æ¡†æž¶ï¼Œå®ƒæä¾›é€šç”¨æœºåˆ¶æ¥åŽŸå­æ€§ç®¡ç†åŒæ­¥çŠ¶æ€ã€é˜»å¡žå’Œå”¤é†’çº¿ç¨‹ï¼Œä»¥åŠç»´æŠ¤è¢«é˜»å¡žçº¿ç¨‹çš„é˜Ÿåˆ—ã€‚ JDKä¸­AQSè¢«å¹¿æ³›ä½¿ç”¨ï¼ŒåŸºäºŽAQSå®žçŽ°çš„åŒæ­¥å™¨åŒ…æ‹¬ï¼š ReentrantLock Semaphore ReentrantReadWriteLockï¼ˆåŽç»­ä¼šå‡ºæ–‡ç« è®²è§£ï¼‰ CountDownLatch FutureTask æ¯ä¸€ä¸ªåŸºäºŽAQSå®žçŽ°çš„åŒæ­¥å™¨éƒ½ä¼šåŒ…å«ä¸¤ç§ç±»åž‹çš„æ“ä½œï¼Œå¦‚ä¸‹ï¼š è‡³å°‘ä¸€ä¸ªacquireæ“ä½œã€‚è¿™ä¸ªæ“ä½œé˜»å¡žè°ƒç”¨çº¿ç¨‹ï¼Œé™¤éž/ç›´åˆ°AQSçš„çŠ¶æ€å…è®¸è¿™ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚ è‡³å°‘ä¸€ä¸ªreleaseæ“ä½œã€‚è¿™ä¸ªæ“ä½œæ”¹å˜AQSçš„çŠ¶æ€ï¼Œæ”¹å˜åŽçš„çŠ¶æ€å¯å…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªé˜»å¡žçº¿ç¨‹è¢«è§£é™¤é˜»å¡žã€‚ åŸºäºŽâ€œå¤åˆä¼˜å…ˆäºŽç»§æ‰¿â€çš„åŽŸåˆ™ï¼ŒåŸºäºŽAQSå®žçŽ°çš„åŒæ­¥å™¨ä¸€èˆ¬éƒ½æ˜¯ï¼šå£°æ˜Žä¸€ä¸ªå†…éƒ¨ç§æœ‰çš„ç»§æ‰¿äºŽAQSçš„å­ç±»Syncï¼Œå¯¹åŒæ­¥å™¨æ‰€æœ‰å…¬æœ‰æ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šå§”æ‰˜ç»™è¿™ä¸ªå†…éƒ¨å­ç±»ã€‚ 7.åŽç»­åŽé¢ä¼šæŽ¨å‡ºä»¥ä¸‹æœ‰å…³AQSçš„æ–‡ç« ï¼Œå·²åŠ æ·±å¯¹äºŽAQSçš„ç†è§£ AQS ConditionObjectå¯¹è±¡è§£æž AQS åº”ç”¨æ¡ˆä¾‹ ReentrantReadWriteLockè§£æž Java volatileçš„å†…å­˜è¯­ä¹‰ä¸ŽAQSé”å†…å­˜å¯è§æ€§ 8.æ„Ÿè°¢æœ¬æ–‡å¾ˆå¤šå†…å®¹æ•´ç†è‡ªç½‘ç»œï¼Œå‚è€ƒæ–‡çŒ®ï¼šhttps://segmentfault.com/a/1190000011376192https://segmentfault.com/a/1190000011391092https://zhuanlan.zhihu.com/p/27134110https://blog.csdn.net/wojiaolinaaa/article/details/50070031https://www.cnblogs.com/waterystone/p/4920797.html FIFOé˜Ÿåˆ—:https://www.cnblogs.com/waterystone/p/4920797.html]]></content>
      <categories>
        <category>JUC</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JUC</tag>
        <tag>AQS</tag>
        <tag>JDK</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TCPä¸ŽUDP ç¬”è®°]]></title>
    <url>%2Ftcp-and-udp-note.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ•´ç†è‡ªï¼šã€Šå›¾è§£TCP/IP ç¬¬5ç‰ˆã€‹ä½œè€…ï¼š[æ—¥] ç«¹ä¸‹éš†å²ï¼Œ[æ—¥] æ‘å±±å…¬ä¿ï¼Œ[æ—¥] è’äº•é€ï¼Œ[æ—¥] è‹…ç”°å¹¸é›„ è‘—è¯‘è€…ï¼šä¹Œå°¼æ—¥å…¶å…¶æ ¼å‡ºç‰ˆæ—¶é—´ï¼š2013-07 ä¼ è¾“å±‚çš„ä½œç”¨TCPæä¾›å¯é çš„é€šä¿¡ä¼ è¾“ï¼Œè€ŒUDPåˆ™å¸¸è¢«ç”¨äºŽè®©å¹¿æ’­å’Œç»†èŠ‚æŽ§åˆ¶äº¤ç»™åº”ç”¨çš„é€šä¿¡ä¼ è¾“ã€‚ ä¸¤ç§ä¼ è¾“å±‚åè®®TCPå’ŒUDPTCPTCPæ˜¯é¢å‘è¿žæŽ¥çš„ã€å¯é çš„æµåè®®ã€‚æµå°±æ˜¯æŒ‡ä¸é—´æ–­çš„æ•°æ®ç»“æž„ï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆæŽ’æ°´ç®¡é“ä¸­çš„æ°´æµã€‚TCPä¸ºæä¾›å¯é æ€§ä¼ è¾“ï¼Œå®žè¡Œâ€œé¡ºåºæŽ§åˆ¶â€æˆ–â€œé‡å‘æŽ§åˆ¶â€æœºåˆ¶ã€‚æ­¤å¤–è¿˜å…·å¤‡â€œæµæŽ§åˆ¶ï¼ˆæµé‡æŽ§åˆ¶ï¼‰â€ã€â€œæ‹¥å¡žæŽ§åˆ¶â€ã€æé«˜ç½‘ç»œåˆ©ç”¨çŽ‡ç­‰ä¼—å¤šåŠŸèƒ½ã€‚ UDPUDPæ˜¯ä¸å…·æœ‰å¯é æ€§çš„æ•°æ®æŠ¥åè®®ã€‚ç»†å¾®çš„å¤„ç†å®ƒä¼šäº¤ç»™ä¸Šå±‚çš„åº”ç”¨åŽ»å®Œæˆã€‚UDPæƒ…å†µä¸‹ï¼Œè™½ç„¶å¯ä»¥ç¡®ä¿å‘é€æ¶ˆæ¯çš„å¤§å°ï¼Œå´ä¸èƒ½ä¿è¯æ¶ˆæ¯ä¸€å®šä¼šåˆ°è¾¾ã€‚å› æ­¤ï¼Œåº”ç”¨æœ‰æ—¶ä¼šæ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œé‡å‘å¤„ç†ã€‚ TCPä¸ŽUDPåŒºåˆ†TCPç”¨äºŽåœ¨ä¼ è¾“å±‚æœ‰å¿…è¦å®žçŽ°å¯é æ€§ä¼ è¾“çš„æƒ…å†µã€‚ç”±äºŽå®ƒæ˜¯é¢å‘æœ‰è¿žæŽ¥å¹¶å…·å¤‡é¡ºåºæŽ§åˆ¶ã€é‡å‘æŽ§åˆ¶ç­‰æœºåˆ¶çš„ã€‚æ‰€ä»¥å®ƒå¯ä»¥ä¸ºåº”ç”¨æä¾›å¯é ä¼ è¾“ã€‚ UDPä¸»è¦ç”¨äºŽé‚£äº›å¯¹é«˜é€Ÿä¼ è¾“å’Œå®žæ—¶æ€§æœ‰è¾ƒé«˜è¦æ±‚çš„é€šä¿¡æˆ–å¹¿æ’­é€šä¿¡ã€‚ä¸¾ä¸€ä¸ªIPç”µè¯è¿›è¡Œé€šè¯çš„ä¾‹å­ã€‚å¦‚æžœä½¿ç”¨TCPï¼Œæ•°æ®åœ¨ä¼ é€é€”ä¸­å¦‚æžœä¸¢å¤±ä¼šè¢«é‡å‘ï¼Œä½†æ˜¯è¿™æ ·æ— æ³•æµç•…åœ°ä¼ è¾“é€šè¯äººçš„å£°éŸ³ï¼Œä¼šå¯¼è‡´æ— æ³•è¿›è¡Œæ­£å¸¸äº¤æµã€‚è€Œé‡‡ç”¨UDPï¼Œå®ƒä¸ä¼šè¿›è¡Œé‡å‘å¤„ç†ã€‚ä»Žè€Œä¹Ÿå°±ä¸ä¼šæœ‰å£°éŸ³å¤§å¹…åº¦å»¶è¿Ÿåˆ°è¾¾çš„é—®é¢˜ã€‚å³ä½¿æœ‰éƒ¨åˆ†æ•°æ®ä¸¢å¤±ï¼Œä¹Ÿåªæ˜¯å½±å“æŸä¸€å°éƒ¨åˆ†çš„é€šè¯ã€‚æ­¤å¤–ï¼Œåœ¨å¤šæ’­ä¸Žå¹¿æ’­é€šä¿¡ä¸­ä¹Ÿä½¿ç”¨UDPè€Œä¸æ˜¯TCPã€‚RIPã€DHCPç­‰åŸºäºŽå¹¿æ’­çš„åè®®ä¹Ÿè¦ä¾èµ–äºŽUDPã€‚ ç«¯å£å·ç«¯å£å·å®šä¹‰æ•°æ®é“¾è·¯å’ŒIPä¸­çš„åœ°å€ï¼Œåˆ†åˆ«æŒ‡çš„æ˜¯MACåœ°å€å’ŒIPåœ°å€ã€‚å‰è€…ç”¨æ¥è¯†åˆ«åŒä¸€é“¾è·¯ä¸­ä¸åŒçš„è®¡ç®—æœºï¼ŒåŽè€…ç”¨æ¥è¯†åˆ«TCP/IPç½‘ç»œä¸­äº’è¿žçš„ä¸»æœºå’Œè·¯ç”±å™¨ã€‚ä¼ è¾“å±‚ä¹Ÿæœ‰ç±»ä¼¼æ¦‚å¿µï¼Œå°±æ˜¯ç«¯å£å·ã€‚ç«¯å£å·ç”¨æ¥è¯†åˆ«åŒä¸€å°è®¡ç®—æœºä¸­è¿›è¡Œé€šä¿¡çš„ä¸åŒåº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œå®ƒä¹Ÿè¢«ç§°ä¸ºç¨‹åºåœ°å€ã€‚ é€šè¿‡IPåœ°å€ã€ç«¯å£å·ã€åè®®å·è¿›è¡Œé€šä¿¡è¯†åˆ«TCP/IPæˆ–UDP/IPé€šä¿¡ä¸­é€šå¸¸é‡‡ç”¨5ä¸ªä¿¡æ¯æ¥è¯†åˆ«ä¸€ä¸ªé€šä¿¡ã€‚å®ƒä»¬æ˜¯â€œæºIPåœ°å€â€ã€â€œç›®æ ‡IPåœ°å€â€ã€â€œåè®®å·â€ã€â€œæºç«¯å£å·â€ã€â€œç›®æ ‡ç«¯å£å·â€ã€‚åªè¦å…¶ä¸­æŸä¸€é¡¹ä¸åŒï¼Œåˆ™è¢«è®¤ä¸ºæ˜¯å…¶ä»–é€šä¿¡ã€‚ ç«¯å£å·ä¸Žåè®®ç«¯å£å·ç”±å…¶ä½¿ç”¨çš„ä¼ è¾“å±‚åè®®å†³å®šã€‚å› æ­¤ï¼Œä¸åŒçš„ä¼ è¾“åè®®å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ç«¯å£å·ã€‚ä¾‹å¦‚ï¼ŒTCPä¸ŽUDPä½¿ç”¨åŒä¸€ä¸ªç«¯å£å·ï¼Œä½†ä½¿ç”¨ç›®çš„å„ä¸ç›¸åŒã€‚ æ•°æ®åˆ°è¾¾IPå±‚åŽï¼Œä¼šå…ˆæ£€æŸ¥IPé¦–éƒ¨ä¸­çš„åè®®å·ï¼Œå†ä¼ ç»™ç›¸åº”åè®®çš„æ¨¡å—ã€‚ä¼ ç»™TCPæˆ–UDPåŽ»åšç«¯å£å·å¤„ç†ã€‚å³ä½¿æ˜¯åŒä¸€ä¸ªç«¯å£å·ï¼Œç”±äºŽä¼ è¾“åè®®æ˜¯å„è‡ªç‹¬ç«‹åœ°è¿›è¡Œå¤„ç†ï¼Œå› æ­¤ç›¸äº’ä¹‹é—´ä¸ä¼šå½±å“ã€‚ UDPUDPæ˜¯User Datagram Protocolçš„ç¼©å†™ï¼Œå³ç”¨æˆ·æ•°æ®åŒ…åè®®ã€‚ UDPä¸æä¾›å¤æ‚æŽ§åˆ¶æœºåˆ¶ï¼Œåˆ©ç”¨IPæä¾›é¢å‘æ— è¿žæŽ¥çš„é€šä¿¡æœåŠ¡ã€‚ä¸”å®ƒæ˜¯å°†åº”ç”¨ç¨‹åºå‘æ¥çš„æ•°æ®åœ¨æ”¶åˆ°çš„é‚£ä¸€åˆ»ï¼Œç«‹å³æŒ‰ç…§åŽŸæ ·å‘é€åˆ°ç½‘ç»œä¸Šçš„ä¸€ç§æœºåˆ¶ã€‚ UDPé¢å‘æ— è¿žæŽ¥ï¼Œå¯ä»¥éšæ—¶å‘é€æ•°æ®ã€‚å®ƒå¸¸ç”¨äºŽå‡ ä¸ªæ–¹é¢ï¼š åŒ…æ€»é‡è¾ƒå°‘çš„é€šä¿¡ï¼ˆDNSã€SNMPç­‰ï¼‰ è§†é¢‘ã€éŸ³é¢‘ç­‰å¤šåª’ä½“é€šä¿¡ï¼ˆå³æ—¶é€šä¿¡ï¼‰ é™å®šäºŽLANç­‰ç‰¹å®šç½‘ç»œä¸­çš„åº”ç”¨é€šä¿¡ å¹¿æ’­é€šä¿¡ï¼ˆå¹¿æ’­ã€å¤šæ’­ï¼‰ TCPTCPæ˜¯Transmission Control Protocolçš„ç¼©å†™ï¼Œä¼ è¾“æŽ§åˆ¶åè®®ã€‚ TCPå……åˆ†å®žçŽ°äº†æ•°æ®ä¼ è¾“æ—¶å„ç§æŽ§åˆ¶åŠŸèƒ½ï¼Œå¯ä»¥è¿›è¡Œä¸¢åŒ…çš„é‡å‘æŽ§åˆ¶ï¼Œè¿˜å¯ä»¥å¯¹æ¬¡åºä¹±æŽ‰çš„åˆ†åŒ…è¿›è¡Œé¡ºåºæŽ§åˆ¶ã€‚æ­¤å¤–ï¼ŒTCPä½œä¸ºä¸€ç§é¢å‘æœ‰è¿žæŽ¥çš„åè®®ï¼Œåªæœ‰åœ¨ç¡®è®¤é€šä¿¡å¯¹ç«¯å­˜åœ¨æ—¶æ‰ä¼šå‘é€æ•°æ®ï¼Œä»Žè€Œå¯ä»¥æŽ§åˆ¶é€šä¿¡æµé‡çš„æµªè´¹ã€‚ è¿žæŽ¥è¿žæŽ¥æ˜¯æŒ‡å„ç§è®¾å¤‡ã€çº¿è·¯,æˆ–ç½‘ç»œä¸­è¿›è¡Œé€šä¿¡çš„ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¸ºäº†ç›¸äº’ä¼ é€’æ¶ˆæ¯è€Œä¸“æœ‰çš„ã€è™šæ‹Ÿçš„é€šä¿¡çº¿è·¯,ä¹Ÿå«åšè™šæ‹Ÿç”µè·¯ã€‚ä¸€æ—¦å»ºç«‹äº†è¿žæŽ¥,è¿›è¡Œé€šä¿¡çš„åº”ç”¨ç¨‹åºåªæ˜¯ç”¨è¿™ä¸ªè™šæ‹Ÿçš„é€šä¿¡çº¿è·¯å‘é€å’ŒæŽ¥æ”¶æ•°æ®,å°±å¯ä»¥ä¿éšœä¿¡æ¯çš„ä¼ è¾“ã€‚åº”ç”¨ç¨‹åºä¸ç”¨é¡¾è™‘IPç½‘ç»œä¸Šå¯èƒ½å‘ç”Ÿçš„å„ç§é—®é¢˜,ä¾ç„¶å¯ä»¥è½¬å‘æ•°æ®ã€‚TCPåˆ™è´Ÿè´£æŽ§åˆ¶é“¾æŽ¥çš„å»ºç«‹ã€æ–­å¼€ã€ä¿æŒç­‰ç®¡ç†å·¥ä½œã€‚ TCPçš„ç‰¹ç‚¹åŠå…¶ç›®çš„ä¸ºäº†é€šè¿‡æ•°æ®åŒ…å®žçŽ°å¯é æ€§ä¼ è¾“,éœ€è¦è€ƒè™‘å¾ˆå¤šäº‹æƒ…,ä¾‹å¦‚æ•°æ®çš„ç ´åã€ä¸¢åŒ…ã€é‡å¤è®°å¿†åˆ†ç‰‡é¡ºåºæ··ä¹±ç­‰é—®é¢˜ã€‚å¦‚ä¸èƒ½è§£å†³è¿™äº›é—®é¢˜,ä¹Ÿå°±æ— ä»Žè°ˆèµ·å¯é ä¼ è¾“ã€‚ TCPé€šè¿‡æ£€éªŒå’Œã€åºåˆ—å·ã€ç¡®è®¤åº”ç­”ã€é‡å‘æŽ§åˆ¶ã€è¿žæŽ¥ç®¡ç†ä»¥åŠçª—å£æŽ§åˆ¶ç­‰æœºåˆ¶å®žçŽ°å¯é æ€§ä¼ è¾“ã€‚ é€šè¿‡åºåˆ—å·ä¸Žç¡®è®¤åº”ç­”æé«˜å¯é æ€§åœ¨TCPä¸­ï¼Œå½“å‘é€ç«¯æ•°æ®åˆ°è¾¾æŽ¥å—ä¸»æœºæ—¶ï¼ŒæŽ¥æ”¶ç«¯ä¸»æœºä¼šè¿”å›žä¸€ä¸ªå·²æ”¶åˆ°çš„æ¶ˆæ¯çš„é€šçŸ¥ã€‚è¿™ä¸ªæ¶ˆæ¯å«åšç¡®è®¤åº”ç­”ï¼ˆACK Positive Acknowledgementï¼‰ã€‚ TCPé€šè¿‡è‚¯å®šçš„ç¡®è®¤åº”ç­”ï¼ˆACKï¼‰å®žçŽ°å¯é çš„æ•°æ®ä¼ è¾“ã€‚å½“å‘é€ç«¯å°†æ•°æ®å‘å‡ºä¹‹åŽä¼šç­‰å¾…å¯¹ç«¯çš„ç¡®è®¤åº”ç­”ã€‚å¦‚æžœæœ‰ç¡®è®¤åº”ç­”ï¼Œè¯´æ˜Žæ•°æ®å·²ç»æˆåŠŸåˆ°è¾¾å¯¹ç«¯ã€‚ åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰ç­‰åˆ°ç¡®è®¤åº”ç­”ï¼Œå‘é€ç«¯å°±å¯ä»¥è®¤ä¸ºæ•°æ®å·²ç»ä¸¢å¤±ï¼Œå¹¶è¿›è¡Œé‡å‘ã€‚ç”±æ­¤ï¼Œå³ä½¿äº§ç”Ÿäº†ä¸¢åŒ…ï¼Œä»ç„¶èƒ½å¤Ÿä¿è¯æ•°æ®èƒ½å¤Ÿåˆ°è¾¾å¯¹ç«¯ï¼Œå®žçŽ°å¯é ä¼ è¾“ã€‚ æœªç¡®è®¤åº”ç­”å¹¶ä¸æ„å‘³ç€æ•°æ®ä¸€å®šä¸¢å¤±ã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯æ•°æ®å¯¹æ–¹å·²ç»æ”¶åˆ°ï¼Œåªæ˜¯è¿”å›žçš„ç¡®è®¤åº”ç­”åœ¨é€”ä¸­ä¸¢å¤±ã€‚ ä¸ºäº†é˜²æ­¢å‡ºçŽ°éšæ„é‡å‘çš„æƒ…å†µï¼Œå°±éœ€è¦å¼•å…¥ä¸€ç§æœºåˆ¶ï¼Œå®ƒèƒ½å¤Ÿè¯†åˆ«æ˜¯å¦å·²ç»æŽ¥æ”¶æ•°æ®ï¼Œåˆèƒ½åˆ¤æ–­æ˜¯å¦éœ€è¦æŽ¥æ”¶ã€‚ è¿™äº›ç¡®è®¤åº”ç­”å¤„ç†ã€é‡å‘æŽ§åˆ¶ä»¥åŠé‡å¤æŽ§åˆ¶ç­‰åŠŸèƒ½éƒ½å¯ä»¥é€šè¿‡åºåˆ—å·å®žçŽ°ã€‚åºåˆ—å·æ˜¯æŒ‰ç…§é¡ºåºç»™å‘é€æ•°æ®çš„æ¯ä¸ªå­—èŠ‚ï¼ˆ8ä½å­—èŠ‚ï¼‰éƒ½æ ‡ä¸Šå·ç çš„ç¼–å·ï¼ˆåºåˆ—å·çš„åˆå§‹å€¼å¹¶éžä¸º0ã€‚è€Œæ˜¯åœ¨å»ºç«‹è¿žæŽ¥ä»¥åŽç”±éšæœºæ•°ç”Ÿæˆã€‚è€ŒåŽé¢çš„è®¡ç®—åˆ™æ˜¯å¯¹æ¯ä¸€å­—èŠ‚åŠ ä¸€ï¼‰ã€‚æŽ¥æ”¶ç«¯æŸ¥è¯¢æŽ¥æ”¶æ•°æ®TCPé¦–éƒ¨ä¸­åºåˆ—å·å’Œæ•°æ®çš„é•¿åº¦ï¼Œå°†è‡ªå·±ä¸‹ä¸€æ­¥åº”è¯¥æŽ¥æ”¶çš„åºåˆ—å·ä½œä¸ºç¡®è®¤åº”ç­”è¿”é€å›žåŽ»ã€‚è¿™æ ·ï¼Œé€šè¿‡åºåˆ—å·å’Œç¡®è®¤åº”ç­”å·ï¼ŒTCPå¯ä»¥å®žçŽ°å¯é ä¼ è¾“ã€‚ é‡å‘è¶…æ—¶å¦‚ä½•ç¡®å®šé‡å‘è¶…æ—¶æ˜¯æŒ‡åœ¨é‡å‘æ•°æ®ä¹‹å‰ï¼Œç­‰å¾…ç¡®è®¤åº”ç­”åˆ°æ¥çš„é‚£ä¸ªç‰¹å®šæ—¶é—´é—´éš”ã€‚å¦‚æžœè¶…è¿‡äº†è¿™ä¸ªæ—¶é—´ä»æœªæ”¶åˆ°ç¡®è®¤åº”ç­”ï¼Œå‘é€ç«¯å°†è¿›è¡Œæ•°æ®é‡å‘ã€‚é‚£ä¹ˆè¿™ä¸ªé‡å‘è¶…æ—¶çš„å…·ä½“æ—¶é—´é•¿åº¦åˆæ˜¯å¦‚ä½•ç¡®å®šçš„å‘¢ï¼Ÿ æœ€ç†æƒ³çš„æ˜¯ï¼Œæ‰¾åˆ°ä¸€ä¸ªæœ€å°æ—¶é—´ï¼Œå®ƒèƒ½ä¿è¯â€œç¡®è®¤åº”ç­”ä¸€å®šèƒ½åœ¨è¿™ä¸ªæ—¶é—´å†…è¿”å›žâ€ã€‚ç„¶è€Œè¿™ä¸ªæ—¶é—´é•¿çŸ­éšç€æ•°æ®åŒ…é€”å¾„çš„ç½‘ç»œçŽ¯å¢ƒçš„ä¸åŒè€Œæœ‰æ‰€å˜åŒ–ã€‚ä¾‹å¦‚åœ¨é«˜é€Ÿçš„LANä¸­æ—¶é—´ç›¸å¯¹è¾ƒçŸ­ï¼Œè€Œåœ¨é•¿è·ç¦»çš„é€šä¿¡å½“ä¸­åº”è¯¥æ¯”LANè¦é•¿ä¸€äº›ã€‚å³ä½¿æ˜¯åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ï¼Œæ ¹æ®ä¸åŒæ—¶æ®µçš„ç½‘ç»œå µå¡žç¨‹åº¦æ—¶é—´çš„é•¿çŸ­ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚TCPè¦æ±‚ä¸è®ºå¤„åœ¨ä½•ç§ç½‘ç»œçŽ¯å¢ƒä¸‹éƒ½è¦æä¾›é«˜æ€§èƒ½é€šä¿¡ï¼Œå¹¶ä¸”æ— è®ºç½‘ç»œæ‹¥å µæƒ…å†µå‘ç”Ÿä½•ç§å˜åŒ–ï¼Œéƒ½å¿…é¡»ä¿æŒè¿™ä¸€ç‰¹æ€§ã€‚ä¸ºæ­¤ï¼Œå®ƒåœ¨æ¯æ¬¡å‘åŒ…æ—¶éƒ½ä¼šè®¡ç®—å¾€è¿”æ—¶é—´åŠå…¶åå·®ã€‚å°†è¿™ä¸ªå¾€è¿”æ—¶é—´å’Œåå·®ç›¸åŠ é‡å‘è¶…æ—¶çš„æ—¶é—´ï¼Œå°±æ˜¯æ¯”è¿™ä¸ªæ€»å’Œè¦ç¨å¤§ä¸€ç‚¹çš„å€¼ã€‚ åœ¨BSDçš„Unixä»¥åŠWindowsç³»ç»Ÿä¸­ï¼Œè¶…æ—¶éƒ½ä»¥0.5ç§’ä¸ºå•ä½è¿›è¡ŒæŽ§åˆ¶ï¼Œå› æ­¤é‡å‘è¶…æ—¶éƒ½æ˜¯0.5ç§’çš„æ•´æ•°å€ã€‚ä¸è¿‡ï¼Œç”±äºŽæœ€åˆçš„æ•°æ®åŒ…è¿˜ä¸çŸ¥é“å¾€è¿”æ—¶é—´ï¼Œæ‰€ä»¥å…¶é‡å‘è¶…æ—¶ä¸€èˆ¬è®¾ç½®ä¸º6ç§’å·¦å³ã€‚æ•°æ®è¢«é‡å‘ä¹‹åŽè‹¥è¿˜æ˜¯æ”¶ä¸åˆ°ç¡®è®¤åº”ç­”ï¼Œåˆ™è¿›è¡Œå†æ¬¡å‘é€ã€‚æ­¤æ—¶ï¼Œç­‰å¾…ç¡®è®¤åº”ç­”çš„æ—¶é—´å°†ä¼šä»¥2å€ã€4å€çš„æŒ‡æ•°å‡½æ•°å»¶é•¿ã€‚æ­¤å¤–ï¼Œæ•°æ®ä¹Ÿä¸ä¼šè¢«æ— é™ã€åå¤åœ°é‡å‘ã€‚è¾¾åˆ°ä¸€å®šé‡å‘æ¬¡æ•°ä¹‹åŽï¼Œå¦‚æžœä»æ²¡æœ‰ä»»ä½•ç¡®è®¤åº”ç­”è¿”å›žï¼Œå°±ä¼šåˆ¤æ–­ä¸ºç½‘ç»œæˆ–å¯¹ç«¯ä¸»æœºå‘ç”Ÿäº†å¼‚å¸¸ï¼Œå¼ºåˆ¶å…³é—­è¿žæŽ¥ã€‚å¹¶ä¸”é€šçŸ¥åº”ç”¨é€šä¿¡å¼‚å¸¸å¼ºè¡Œç»ˆæ­¢ã€‚ è¿žæŽ¥ç®¡ç†TCPæä¾›é¢å‘æœ‰è¿žæŽ¥çš„é€šä¿¡ä¼ è¾“ã€‚é¢å‘æœ‰è¿žæŽ¥æ˜¯æŒ‡åœ¨æ•°æ®é€šä¿¡å¼€å§‹ä¹‹å‰å…ˆåšå¥½é€šä¿¡ä¸¤ç«¯ä¹‹é—´çš„å‡†å¤‡å·¥ä½œã€‚ UDPæ˜¯ä¸€ç§é¢å‘æ— è¿žæŽ¥çš„é€šä¿¡åè®®ï¼Œå› æ­¤ä¸æ£€æŸ¥å¯¹ç«¯æ˜¯å¦å¯ä»¥é€šä¿¡ï¼Œç›´æŽ¥å°†UDPåŒ…å‘å‡ºåŽ»ã€‚TCPä¸Žæ­¤ç›¸åï¼Œå®ƒä¼šåœ¨æ•°æ®é€šä¿¡ä¹‹å‰ï¼Œé€šè¿‡TCPé¦–éƒ¨å‘é€ä¸€ä¸ªSYNåŒ…ä½œä¸ºå»ºç«‹è¿žæŽ¥çš„è¯·æ±‚ç­‰å¾…ç¡®è®¤åº”ç­”ï¼ˆTCPä¸­å‘é€ç¬¬ä¸€ä¸ªSYNåŒ…çš„ä¸€æ–¹å«å®¢æˆ·ç«¯ï¼ŒæŽ¥æ”¶è¿™ä¸ªçš„ä¸€æ–¹å«æœåŠ¡ç«¯ï¼‰ã€‚å¦‚æžœå¯¹ç«¯å‘æ¥ç¡®è®¤åº”ç­”ï¼Œåˆ™è®¤ä¸ºå¯ä»¥è¿›è¡Œæ•°æ®é€šä¿¡ã€‚å¦‚æžœå¯¹ç«¯çš„ç¡®è®¤åº”ç­”æœªèƒ½åˆ°è¾¾ï¼Œå°±ä¸ä¼šè¿›è¡Œæ•°æ®é€šä¿¡ã€‚æ­¤å¤–ï¼Œåœ¨é€šä¿¡ç»“æŸæ—¶ä¼šè¿›è¡Œæ–­å¼€è¿žæŽ¥çš„å¤„ç†ï¼ˆFINåŒ…ï¼‰ã€‚ å¯ä»¥ä½¿ç”¨TCPé¦–éƒ¨ç”¨äºŽæŽ§åˆ¶çš„å­—æ®µæ¥ç®¡ç†TCPè¿žæŽ¥ï¼ˆä¹Ÿå«æŽ§åˆ¶åŸŸï¼‰ã€‚ä¸€ä¸ªè¿žæŽ¥çš„å»ºç«‹ä¸Žæ–­å¼€ï¼Œæ­£å¸¸è¿‡ç¨‹è‡³å°‘éœ€è¦æ¥å›žå‘é€7ä¸ªåŒ…æ‰èƒ½å®Œæˆã€‚ï¼ˆå»ºç«‹ä¸€ä¸ªTCPè¿žæŽ¥éœ€è¦å‘é€3ä¸ªåŒ…ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿç§°ä¸º3æ¬¡æ¡æ‰‹ï¼‰ TCPä»¥æ®µä¸ºå•ä½å‘é€æ•°æ®åœ¨å»ºç«‹TCPè¿žæŽ¥çš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥ç¡®å®šå‘é€æ•°æ®åŒ…çš„å•ä½ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç§°å…¶ä¸ºâ€œæœ€å¤§æ¶ˆæ¯é•¿åº¦â€ï¼ˆMSSï¼šMaximum Segment Sizeï¼‰ã€‚ æœ€ç†æƒ³çš„æƒ…å†µæ˜¯ï¼Œæœ€å¤§æ¶ˆæ¯é•¿åº¦æ­£å¥½æ˜¯IPä¸­ä¸ä¼šè¢«åˆ†ç‰‡å¤„ç†çš„æœ€å¤§æ•°æ®é•¿åº¦ã€‚ TCPåœ¨ä¼ è¾“å¤§é‡æ•°æ®æ—¶ï¼Œæ˜¯ä»¥MSSçš„å¤§å°å°†æ•°æ®è¿›è¡Œåˆ†å‰²å‘é€çš„ã€‚è¿›è¡Œé‡å‘æ—¶ä¹Ÿæ˜¯ä»¥MSSä¸ºå•ä½ã€‚ MSSæ˜¯åœ¨ä¸‰æ¬¡æ¡æ‰‹çš„æ—¶å€™ï¼Œåœ¨ä¸¤ç«¯ä¸»æœºä¹‹é—´è¢«è®¡ç®—å¾—å‡ºã€‚ä¸¤ç«¯çš„ä¸»æœºåœ¨å‘å‡ºå»ºç«‹è¿žæŽ¥çš„è¯·æ±‚æ—¶ï¼Œä¼šåœ¨TCPé¦–éƒ¨ä¸­å†™å…¥MSSé€‰é¡¹ï¼Œå‘Šè¯‰å¯¹æ–¹è‡ªå·±çš„æŽ¥å£èƒ½å¤Ÿé€‚åº”çš„MSSçš„å¤§å°ï¼ˆä¸ºé™„åŠ MSSé€‰é¡¹ï¼ŒTCPé¦–éƒ¨å°†ä¸å†æ˜¯20å­—èŠ‚ï¼Œè€Œæ˜¯4å­—èŠ‚çš„æ•´æ•°å€ï¼‰ã€‚ç„¶åŽä¼šåœ¨ä¸¤è€…ä¹‹é—´é€‰æ‹©ä¸€ä¸ªè¾ƒå°çš„å€¼æŠ•å…¥ä½¿ç”¨ã€‚ åˆ©ç”¨çª—å£æŽ§åˆ¶æé«˜é€Ÿåº¦TCPä»¥1ä¸ªæ®µä¸ºå•ä½ï¼Œæ¯å‘ä¸€ä¸ªæ®µè¿›è¡Œä¸€æ¬¡ç¡®è®¤åº”ç­”çš„å¤„ç†ï¼Œå¦‚ä¸‹å›¾ï¼Œè¿™æ ·ä¼ è¾“çš„ç¼ºç‚¹æ˜¯ï¼ŒåŒ…çš„å¾€è¿”æ—¶é—´è¶Šé•¿é€šä¿¡æ€§èƒ½å°±è¶Šä½Žã€‚ ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒTCPå¼•å…¥äº†çª—å£è¿™ä¸ªæ¦‚å¿µã€‚å¦‚ä¸‹å›¾ï¼Œç¡®è®¤åº”ç­”ä¸å†æ˜¯ä»¥æ¯ä¸ªåˆ†æ®µï¼Œè€Œæ˜¯ä»¥æ›´å¤§çš„å•ä½è¿›è¡Œç¡®è®¤æ—¶ï¼Œè½¬å‘æ—¶é—´å°†ä¼šè¢«å¤§å¹…åº¦çš„ç¼©çŸ­ã€‚å°±æ˜¯è¯´ï¼Œå‘é€ç«¯ä¸»æœºï¼Œåœ¨å‘é€äº†ä¸€ä¸ªæ®µä»¥åŽä¸å¿…è¦ä¸€ç›´ç­‰å¾…ç¡®è®¤åº”ç­”ï¼Œè€Œæ˜¯ç»§ç»­å‘é€ã€‚ çª—å£å¤§å°å°±æ˜¯æŒ‡æ— éœ€ç­‰å¾…ç¡®è®¤åº”ç­”è€Œå¯ä»¥ç»§ç»­å‘é€æ•°æ®çš„æœ€å¤§å€¼ã€‚ å¦‚ä¸‹å›¾ä¸­ï¼Œçª—å£å¤§å°ä¸º4ä¸ªæ®µã€‚ è¿™ä¸ªæœºåˆ¶å®žçŽ°äº†ä½¿ç”¨å¤§é‡çš„ç¼“å†²åŒºï¼ˆBuffer åœ¨æ­¤å¤„æ ‡è¯†ä¸´æ—¶ä¿å­˜æ”¶å‘æ•°æ®çš„åœºæ‰€ã€‚é€šå¸¸æ˜¯åœ¨è®¡ç®—æœºå†…å­˜ä¸­å¼€è¾Ÿçš„ä¸€éƒ¨åˆ†ç©ºé—´ï¼‰ï¼Œé€šè¿‡å¯¹å¤šä¸ªæ®µåŒæ—¶è¿›è¡Œç¡®è®¤åº”ç­”çš„åŠŸèƒ½ã€‚ ç”¨æ»‘åŠ¨çª—å£æ–¹å¼å¹¶è¡Œå¤„ç†ï¼š ä¸‹é¢çš„å›¾ä¸­å‘é€æ•°æ®ä¸­é«˜äº®åœˆèµ·çš„éƒ¨åˆ†æ­£æ˜¯å‰é¢æ‰€æåˆ°çš„çª—å£ã€‚åœ¨è¿™ä¸ªçª—å£å†…çš„æ•°æ®å³ä¾¿æ²¡æœ‰æ”¶åˆ°ç¡®è®¤åº”ç­”ä¹Ÿå¯ä»¥å‘é€å‡ºåŽ»ã€‚æ­¤å¤–ï¼Œä»Žè¯¥çª—å£ä¸­èƒ½çœ‹åˆ°çš„æ•°æ®å› å…¶æŸç§æ•°æ®å·²åœ¨ä¼ è¾“ä¸­ä¸¢å¤±ï¼Œæ‰€ä»¥å‘é€ç«¯æ‰èƒ½æ”¶åˆ°ç¡®è®¤åº”ç­”ï¼Œè¿™ç§æƒ…å†µä¹Ÿéœ€è¦é‡å‘ã€‚ä¸ºæ­¤ï¼Œå‘é€ç«¯ä¸»æœºåœ¨ç­‰åˆ°ç¡®è®¤åº”ç­”è¿”å›žä¹‹å‰ï¼Œå¿…é¡»åœ¨ç¼“å†²åŒºä¸­ä¿ç•™è¿™éƒ¨åˆ†æ•°æ®ã€‚ åœ¨æ»‘åŠ¨çª—å£ä»¥å¤–çš„éƒ¨åˆ†åŒ…æ‹¬å°šæœªå‘é€çš„æ•°æ®ä»¥åŠå·²ç»ç¡®è®¤å¯¹ç«¯å·²æ”¶åˆ°çš„æ•°æ®ã€‚å½“æ•°æ®å‘å‡ºåŽè‹¥å¦‚æœŸæ”¶åˆ°ç¡®è®¤åº”ç­”å°±å¯ä»¥ä¸ç”¨å†é‡å‘ï¼Œæ­¤æ—¶æ•°æ®çš†å¯ä»¥ä»Žç¼“å†²åŒºæ¸…é™¤ã€‚ æ”¶åˆ°ç¡®è®¤åº”ç­”ï¼Œå°†çª—å£æ»‘åŠ¨åˆ°ç¡®è®¤åº”ç­”ä¸­çš„åºåˆ—å·çš„ä½ç½®ã€‚è¿™æ ·å¯ä»¥é¡ºåºåœ°å°†å¤šä¸ªæ®µåŒæ—¶å‘é€æé«˜é€šä¿¡æ€§èƒ½ã€‚è¿™ç§æœºåˆ¶ä¹Ÿè¢«ç§°ä¸ºæ»‘åŠ¨çª—å£æŽ§åˆ¶ã€‚ æ»‘åŠ¨çª—å£æ–¹å¼ï¼š çª—å£æŽ§åˆ¶ä¸Žé‡å‘æŽ§åˆ¶ä½¿ç”¨çª—å£æŽ§åˆ¶ä¸­ï¼Œ å¦‚æžœå‡ºçŽ°æ®µä¸¢å¤±æ€Žä¹ˆåŠžï¼Ÿ é¦–å…ˆè€ƒè™‘ç¡®è®¤åº”ç­”æœªèƒ½è¿”å›žçš„æƒ…å†µã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®å·²ç»è¾¾åˆ°å¯¹ç«¯ï¼Œæ˜¯ä¸éœ€è¦è¿›è¡Œé‡å‘çš„ã€‚ç„¶è€Œï¼Œåœ¨æ²¡æœ‰ä½¿ç”¨çª—å£æŽ§åˆ¶çš„æ—¶å€™ï¼Œæ²¡æœ‰æ”¶åˆ°ç¡®è®¤åº”ç­”çš„æ•°æ®ä¼šè¢«é‡å‘ã€‚è€Œä½¿ç”¨äº†çª—å£æŽ§åˆ¶ï¼Œå¦‚ä¸‹å›¾ï¼ŒæŸäº›ç¡®è®¤åº”ç­”å³ä¾¿ä¸¢å¤±ä¹Ÿæ— éœ€é‡å‘ã€‚ å…¶æ¬¡ï¼Œè€ƒè™‘ä¸€ä¸‹æŸä¸ªæŠ¥æ–‡æ®µä¸¢å¤±çš„æƒ…å†µã€‚å¦‚ä¸‹å›¾ï¼ŒæŽ¥æ”¶ä¸»æœºå¦‚æžœæ”¶åˆ°ä¸€ä¸ªè‡ªå·±åº”è¯¥æŽ¥æ”¶çš„åºå·ä»¥å¤–çš„æ•°æ®æ—¶ï¼Œä¼šé’ˆå¯¹å½“å‰ä½ç½®æ”¶åˆ°æ•°æ®è¿”å›žç¡®è®¤åº”ç­”ï¼ˆä¸è¿‡å³ä½¿æŽ¥æ”¶ç«¯ä¸»æœºæ”¶åˆ°çš„åŒ…åºå·å¹¶ä¸è¿žç»­ï¼Œä¹Ÿä¸ä¼šå°†æ•°æ®ä¸¢å¼ƒè€Œæ˜¯æš‚æ—¶ä¿å­˜è‡³ç¼“å†²åŒºä¸­ï¼‰ã€‚ å½“æŸä¸€æŠ¥æ–‡æ®µä¸¢å¤±åŽï¼Œå‘é€ç«¯ä¼šä¸€ç›´æ”¶åˆ°åºå·ä¸º1001çš„ç¡®è®¤åº”ç­”ï¼Œè¿™ä¸ªç¡®è®¤åº”ç­”å¥½åƒåœ¨æé†’å‘é€ç«¯â€œæˆ‘æƒ³æŽ¥æ”¶çš„æ˜¯ä»Ž1001å¼€å§‹çš„æ•°æ®â€ã€‚å› æ­¤ï¼Œåœ¨çª—å£æ¯”è¾ƒå¤§ï¼Œåˆå‡ºçŽ°æŠ¥æ–‡æ®µä¸¢å¤±çš„æƒ…å†µä¸‹ï¼ŒåŒä¸€ä¸ªåºå·çš„ç¡®è®¤åº”ç­”å°†ä¼šè¢«é‡å¤ä¸æ–­åœ°è¿”å›žã€‚è€Œå‘é€ç«¯ä¸»æœºå¦‚æžœè¿žç»­3æ¬¡æ”¶åˆ°åŒä¸€ä¸ªç¡®è®¤åº”ç­”ï¼ˆä¹‹æ‰€ä»¥è¿žç»­æ”¶åˆ°3æ¬¡è€Œä¸æ˜¯ä¸¤æ¬¡çš„ç†ç”±æ˜¯å› ä¸ºï¼Œå³ä½¿æ•°æ®æ®µçš„åºå·è¢«æ›¿æ¢ä¸¤æ¬¡ä¹Ÿä¸ä¼šè§¦å‘é‡å‘æœºåˆ¶ï¼‰ã€‚å°±ä¼šå°†å…¶æ‰€å¯¹åº”çš„æ•°æ®è¿›è¡Œé‡å‘ã€‚è¿™ç§æœºåˆ¶æ¯”ä¹‹å‰æåˆ°çš„è¶…æ—¶ç®¡ç†æ›´åŠ é«˜æ•ˆï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œé«˜é€Ÿé‡å‘æŽ§åˆ¶ã€‚ æµæŽ§åˆ¶å‘é€ç«¯æ ¹æ®è‡ªå·±çš„å®žé™…æƒ…å†µå‘é€æ•°æ®ã€‚ä½†æ˜¯ï¼ŒæŽ¥æ”¶ç«¯å¯èƒ½æ”¶åˆ°çš„æ˜¯ä¸€ä¸ªæ¯«æ— å…³ç³»çš„æ•°æ®åŒ…æœ‰å¯èƒ½ä¼šåœ¨å¤„ç†å…¶ä»–é—®é¢˜ä¸ŠèŠ±è´¹ä¸€äº›æ—¶é—´ã€‚å› æ­¤åœ¨ä¸ºè¿™ä¸ªæ•°æ®åŒ…åšå…¶ä»–å¤„ç†æ—¶ä¼šè€—è´¹ä¸€äº›æ—¶é—´ï¼Œç”šè‡³åœ¨é«˜è´Ÿè·æƒ…å†µä¸‹æ— æ³•æŽ¥æ”¶ä»»ä½•æ•°æ®ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œå¦‚æžœæŽ¥æ”¶ç«¯å°†æœ¬åº”è¯¥æŽ¥æ”¶çš„æ•°æ®ä¸¢å¼ƒçš„è¯ï¼Œå°±åˆä¼šè§¦å‘é‡å‘æœºåˆ¶ï¼Œä»Žè€Œå¯¼è‡´ç½‘ç»œæµé‡çš„æµªè´¹ã€‚ ä¸ºäº†é˜²æ­¢è¿™ç§çŽ°è±¡å‘ç”Ÿï¼ŒTCPæä¾›ä¸€ç§æœºåˆ¶å¯ä»¥è®©å‘é€ç«¯æ ¹æ®æŽ¥æ”¶ç«¯çš„å®žé™…æŽ¥æ”¶èƒ½åŠ›æŽ§åˆ¶å‘é€çš„æ•°æ®é‡ã€‚è¿™å°±æ˜¯æ‰€è°“çš„æµæŽ§åˆ¶ã€‚å®ƒçš„å…·ä½“æ“ä½œæ—¶ï¼ŒæŽ¥æ”¶ç«¯ä¸»æœºå‘å‘é€ç«¯ä¸»æœºé€šçŸ¥è‡ªå·±å¯ä»¥æŽ¥æ”¶æ•°æ®çš„å¤§å°ï¼ŒäºŽæ˜¯å‘é€ç«¯ä¼šå‘é€ä¸è¶…è¿‡è¿™ä¸ªé™åˆ¶çš„æ•°æ®ã€‚è¯¥å¤§å°é™åº¦å°±è¢«ç§°ä¸ºçª—å£å¤§å°ã€‚ TCPé¦–éƒ¨ä¸­ï¼Œä¸“é—¨æœ‰ä¸€ä¸ªå­—æ®µç”¨æ¥é€šçŸ¥çª—å£å¤§å°ã€‚æŽ¥æ”¶ä¸»æœºå°†è‡ªå·±çš„å¯ä»¥æŽ¥æ”¶çš„ç¼“å†²åŒºå¤§å°æ”¾å…¥è¿™ä¸ªå­—æ®µé€šçŸ¥ç»™å‘é€ç«¯ã€‚è¿™ä¸ªå€¼è¶Šå¤§ï¼Œè¯´æ˜Žç½‘ç»œçš„åžåé‡è¶Šé«˜ã€‚ ä¸è¿‡ï¼ŒæŽ¥æ”¶ç«¯è¿™ä¸ªç¼“å†²åŒºä¸€æ—¦é¢ä¸´æ•°æ®æº¢å‡ºæ—¶ï¼Œçª—å£å¤§å°çš„å€¼ä¹Ÿä¼šéšä¹‹è¢«è®¾ç½®ä¸ºä¸€ä¸ªæ›´å°çš„å€¼é€šçŸ¥ç»™å‘é€ç«¯ï¼Œä»Žè€ŒæŽ§åˆ¶æ•°æ®å‘é€é‡ã€‚å°±æ˜¯è¯´ï¼Œå‘é€ç«¯ä¸»æœºä¼šæ ¹æ®æŽ¥æ”¶ç«¯ä¸»æœºçš„æŒ‡ç¤ºï¼Œå¯¹å‘é€æ•°æ®çš„é‡è¿›è¡ŒæŽ§åˆ¶ã€‚è¿™ä¹Ÿå½¢æˆäº†ä¸€ä¸ªå®Œæ•´çš„TCPæµæŽ§åˆ¶ï¼ˆæµé‡æŽ§åˆ¶ï¼‰ã€‚ æ ¹æ®çª—å£å¤§å°æŽ§åˆ¶æµé‡è¿‡ç¨‹ç¤ºä¾‹ï¼š å½“æŽ¥æ”¶ç«¯æ”¶åˆ°ä»Ž3001å·å¼€å§‹çš„æ•°æ®æ®µåŽå…¶ç¼“å†²åŒºå³æ»¡ï¼Œä¸å¾—ä¸æš‚æ—¶åœæ­¢æŽ¥æ”¶æ•°æ®ã€‚ä¹‹åŽï¼Œåœ¨æ”¶åˆ°å‘é€çª—å£æ›´æ–°é€šçŸ¥åŽé€šä¿¡æ‰å¾—ä»¥ç»§ç»­è¿›è¡Œã€‚å¦‚æžœè¿™ä¸ªçª—å£æ›´æ–°é€šçŸ¥åœ¨ä¼ è¾“é€”ä¸­ä¸¢å¤±ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ— æ³•ç»§ç»­é€šä¿¡ã€‚ä¸ºé¿å…æ­¤ç±»é—®é¢˜ï¼Œå‘é€ç«¯ä¸»æœºä¼šæ—¶ä¸æ—¶å‘é€ä¸€ä¸ªå«åšçª—å£æŽ¢æµ‹çš„æ•°æ®æ®µï¼Œæ­¤æ•°æ®æ®µä»…å«ä¸€ä¸ªå­—èŠ‚ä»¥èŽ·å–æœ€æ–°çš„çª—å£å¤§å°ä¿¡æ¯ã€‚ æ‹¥å¡žæŽ§åˆ¶æœ‰äº†TCPçª—å£æŽ§åˆ¶ï¼Œæ”¶å‘ä¸»æœºä¹‹é—´å³ä½¿ä¸å†ä»¥ä¸€ä¸ªæ•°æ®æ®µä¸ºå•ä½å‘é€ç¡®è®¤åº”ç­”ï¼Œä¹Ÿèƒ½å¤Ÿè¿žç»­å‘é€å¤§é‡æ•°æ®åŒ…ã€‚ç„¶è€Œï¼Œå¦‚æžœåœ¨é€šä¿¡åˆšå¼€å§‹å°±å‘é€å¤§é‡æ•°æ®ï¼Œä¹Ÿå¯èƒ½ä¼šå¼•å‘å…¶ä»–é—®é¢˜ã€‚ TCPä¸ºäº†é˜²æ­¢è¯¥é—®é¢˜çš„å‡ºçŽ°ï¼Œåœ¨é€šä¿¡ä¸€å¼€å§‹å°±ä¼šé€šè¿‡ä¸€ä¸ªå«åšæ…¢å¯åŠ¨çš„ç®—æ³•å¾—å‡ºçš„æ•°å€¼ï¼Œå¯¹å‘é€æ•°æ®é‡è¿›è¡ŒæŽ§åˆ¶ã€‚ é¦–å…ˆï¼Œä¸ºäº†åœ¨å‘é€ç«¯è°ƒèŠ‚æ‰€è¦å‘é€æ•°æ®çš„é‡ï¼Œå®šä¹‰äº†ä¸€ä¸ªå«åšâ€œæ‹¥å¡žçª—å£â€çš„æ¦‚å¿µã€‚äºŽæ˜¯åœ¨æ…¢å¯åŠ¨çš„æ—¶å€™ï¼Œå°†è¿™ä¸ªæ‹¥å¡žçª—å£çš„å¤§å°è®¾ç½®ä¸º1ä¸ªæ•°æ®æ®µï¼ˆ1MSSï¼‰å‘é€æ•°æ®ï¼Œä¹‹åŽæ¯æ”¶åˆ°ä¸€æ¬¡ç¡®è®¤åº”ç­”ï¼ˆACKï¼‰ï¼Œæ‹¥å¡žçª—å£çš„å€¼å°±åŠ 1ã€‚åœ¨å‘é€æ•°æ®åŒ…æ—¶ï¼Œå°†æ‹¥å¡žçª—å£çš„å¤§å°ä¸ŽæŽ¥æ”¶ç«¯ä¸»æœºé€šçŸ¥çš„çª—å£å¤§å°åšæ¯”è¾ƒï¼Œç„¶åŽæŒ‰ç…§å®ƒä»¬å½“ä¸­è¾ƒå°çš„é‚£ä¸ªå€¼ï¼Œå‘é€æ¯”å…¶è¿˜è¦å°çš„æ•°æ®é‡ã€‚ å¦‚æžœé‡å‘é‡‡ç”¨è¶…æ—¶æœºåˆ¶,é‚£ä¹ˆæ‹¥å¡žçª—å£çš„åˆå§‹å€¼å¯ä»¥è®¾ç½®ä¸º1ä»¥åŽå†è¿›è¡Œæ…¢å¯åŠ¨ä¿®æ­£ã€‚æœ‰äº†ä¸Šè¿°è¿™äº›æœºåˆ¶,å°±å¯ä»¥æœ‰é™çš„å‡å°‘é€šä¿¡å¼€å§‹æ—¶è¿žç»­å‘åŒ…å¯¼è‡´çš„ç½‘ç»œæ‹¥å µ,è¿˜å¯ä»¥é¿å…ç½‘ç»œæ‹¥å¡žæƒ…å†µçš„å‘ç”Ÿã€‚ ä¸è¿‡,éšç€åŒ…çš„æ¯æ¬¡å¾€è¿”,æ‹¥å¡žçª—å£ä¹Ÿä¼šä»¥1ã€2ã€4ç­‰æŒ‡æ•°å‡½æ•°çš„å¢žé•¿,æ‹¥å µçŠ¶å†µæ¿€å¢žç”šè‡³å¯¼è‡´ç½‘ç»œæ‹¥å¡žçš„å‘ç”Ÿã€‚ä¸ºäº†é˜²æ­¢è¿™äº›,å¼•å…¥äº†æ…¢å¯åŠ¨é˜€å€¼çš„æ¦‚å¿µã€‚åªè¦æ‹¥å¡žçª—å£çš„å€¼è¶…å‡ºè¿™ä¸ªé˜€å€¼,åœ¨æ¯æ”¶åˆ°ä¸€æ¬¡ç¡®è®¤åº”ç­”æ—¶,åªå…è®¸ä»¥ä¸‹é¢è¿™ç§æ¯”ä¾‹æ–¹æ³•æ‹¥å¡žçª—å£: æ‹¥å¡žçª—å£è¶Šå¤§ï¼Œç¡®è®¤åº”ç­”çš„æ•°ç›®ä¹Ÿä¼šå¢žåŠ ï¼Œä¸è¿‡éšç€æ¯æ”¶åˆ°ä¸€ä¸ªç¡®è®¤åº”ç­”ï¼Œå…¶æ¶¨å¹…ä¹Ÿä¼šé€æ¸å‡å°‘ï¼Œç”šè‡³å°è¿‡æ¯”ä¸€ä¸ªæ•°æ®æ®µè¿˜è¦å°çš„å­—èŠ‚æ•°ã€‚æ‰€ä»¥ï¼Œæ‹¥å¡žçª—å£çš„å¤§å°ä¼šå‘ˆç›´çº¿ä¸Šå‡çš„è¶‹åŠ¿ã€‚ TCPé€šä¿¡å¼€å§‹æ—¶ï¼Œå¹¶æ²¡æœ‰è®¾ç½®ç›¸åº”çš„æ…¢å¯åŠ¨é˜ˆå€¼ï¼ˆä¸Žçª—å£çš„æœ€å¤§å€¼ç›¸åŒ)ï¼Œè€Œæ˜¯åœ¨è¶…æ—¶é‡å‘æ—¶æ‰ä¼šè®¾ç½®ä¸ºå½“æ—¶æ‹¥å¡žçª—å£ä¸€åŠçš„å¤§å°ã€‚ ç”±é‡å‘ç¡®è®¤åº”ç­”è€Œè§¦å‘çš„é«˜é€Ÿé‡å‘ä¸Žè¶…æ—¶é‡å‘æœºåˆ¶çš„å¤„ç†å¤šå°‘æœ‰äº›ä¸åŒã€‚å› ä¸ºå‰è€…è¦æ±‚è‡³å°‘3æ¬¡çš„ç¡®è®¤åº”ç­”æ•°æ®æ®µåˆ°è¾¾å¯¹æ–¹ä¸»æœºåŽæ‰ä¼šè§¦å‘ï¼Œç›¸æ¯”åŽè€…ç½‘ç»œçš„æ‹¥å µè¦è½»ä¸€äº›ã€‚ è€Œç”±é‡å¤ç¡®è®¤åº”ç­”è¿›è¡Œé«˜é€Ÿé‡å‘æŽ§åˆ¶æ—¶ï¼Œæ…¢å¯åŠ¨é˜ˆå€¼çš„å¤§å°è¢«è®¾ç½®ä¸ºå½“æ—¶çª—å£å¤§å°çš„ä¸€åŠï¼ˆä¸¥æ ¼æ¥è¯´ï¼Œæ˜¯è®¾ç½®ä¸ºâ€œå®žé™…å·²å‘é€ä½†æœªæ”¶åˆ°ç¡®è®¤åº”ç­”çš„æ•°æ®é‡â€çš„ä¸€åŠï¼‰ã€‚ç„¶åŽå°†çª—å£çš„å¤§å°è®¾ç½®ä¸ºè¯¥æ…¢å¯åŠ¨é˜ˆå€¼+3ä¸ªæ•°æ®æ®µçš„å¤§å°ã€‚ æœ‰äº†è¿™æ ·ä¸€ç§æŽ§åˆ¶ï¼ŒTCPçš„æ‹¥å¡žçª—å£å¦‚ä¸Šå›¾æ‰€ç¤ºå‘ç”Ÿå˜åŒ–ã€‚ç”±äºŽçª—å£çš„å¤§å°ä¼šç›´æŽ¥å½±å“æ•°æ®è¢«è½¬å‘çš„åžåé‡ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œçª—å£è¶Šå¤§ï¼Œè¶Šä¼šå½¢æˆé«˜åžåé‡çš„é€šä¿¡ã€‚ å½“TCPé€šä¿¡å¼€å§‹ä»¥åŽ,ç½‘ç»œåžåé‡ä¼šé€æ¸ä¸Šå‡,ä½†æ˜¯éšç€ç½‘ç»œæ‹¥å µçš„å‘ç”Ÿåžåé‡ä¹Ÿä¼šæ€¥å‰§ä¸‹é™ã€‚äºŽæ˜¯ä¼šå†æ¬¡è¿›å…¥åžåé‡æ…¢æ…¢ä¸Šå‡çš„è¿‡ç¨‹ã€‚å› æ­¤æ‰€è°“TCPçš„åžåé‡çš„ç‰¹ç‚¹å°±å¥½åƒæ˜¯åœ¨é€æ­¥å é¢†ç½‘ç»œå¸¦å®½çš„æ„Ÿè§‰ã€‚ UDPé¦–éƒ¨çš„æ ¼å¼ä¸‹å›¾å±•ç¤ºäº†UDPé¦–éƒ¨çš„æ ¼å¼ã€‚é™¤åŽ»æ•°æ®çš„éƒ¨åˆ†æ­£å¼UDPçš„é¦–éƒ¨ã€‚UDPé¦–éƒ¨ç”±æºç«¯å£å·ï¼Œç›®æ ‡ç«¯å£å·ï¼ŒåŒ…é•¿å’Œæ ¡éªŒå’Œç»„æˆã€‚ æºç«¯å£å·ï¼ˆSource Portï¼‰è¡¨ç¤ºå‘é€ç«¯ç«¯å£å·ï¼Œå­—æ®µé•¿16ä½ã€‚è¯¥å­—æ®µæ˜¯å¯é€‰é¡¹ï¼Œæœ‰æ—¶å¯èƒ½ä¸ä¼šè®¾ç½®æºç«¯å£å·ã€‚æ²¡æœ‰æºç«¯å£å·çš„æ—¶å€™è¯¥å­—æ®µçš„å€¼è®¾ç½®ä¸º0ã€‚å¯ç”¨äºŽä¸éœ€è¦è¿”å›žçš„é€šä¿¡ä¸­ã€‚ ç›®æ ‡ç«¯å£å·ï¼ˆDestination Portï¼‰è¡¨ç¤ºæŽ¥æ”¶ç«¯ç«¯å£ï¼Œå­—æ®µé•¿åº¦16ä½ã€‚ åŒ…é•¿åº¦ï¼ˆLengthï¼‰è¯¥å­—æ®µä¿å­˜äº†UDPé¦–éƒ¨çš„é•¿åº¦è·Ÿæ•°æ®çš„é•¿åº¦ä¹‹å’Œã€‚å•ä½ä¸ºå­—èŠ‚ï¼ˆ8ä½å­—èŠ‚ï¼‰ã€‚ æ ¡éªŒå’Œï¼ˆChecksumï¼‰æ ¡éªŒå’Œæ˜¯ä¸ºäº†æä¾›å¯é çš„UDPé¦–éƒ¨å’Œæ•°æ®è€Œè®¾è®¡ã€‚åœ¨è®¡ç®—æ ¡éªŒå’Œæ—¶ï¼Œé™„åŠ åœ¨UDPä¼ªé¦–éƒ¨ä¸ŽUDPæ•°æ®æŠ¥ä¹‹å‰ã€‚é€šè¿‡åœ¨æœ€åŽä¸€ä½å¢žåŠ ä¸€ä¸ªâ€œ0â€å°†å…¨é•¿å¢žåŠ 16å€ã€‚æ­¤æ—¶å°†UDPé¦–éƒ¨çš„æ ¡éªŒå’Œå­—æ®µè®¾ç½®ä¸ºâ€œ0â€ã€‚ç„¶åŽä»¥16æ¯”ç‰¹ä¸ºå•ä½è¿›è¡Œ1çš„è¡¥ç å’Œï¼Œå¹¶å°†æ‰€å¾—åˆ°çš„1çš„è¡¥ç å’Œå†™å…¥æ ¡éªŒå’Œå­—æ®µã€‚ æŽ¥æ”¶ä¸»æœºåœ¨æ”¶åˆ°UDPæ•°æ®æŠ¥ä»¥åŽï¼Œä»ŽIPé¦–éƒ¨èŽ·çŸ¥IPåœ°å€ä¿¡æ¯æž„é€ UDPä¼ªé¦–éƒ¨ï¼Œå†è¿›è¡Œæ ¡éªŒå’Œè®¡ç®—ã€‚æ ¡éªŒå’Œåˆ¶åº¦æŒ‰çš„å€¼æ˜¯æ ¡éªŒå’Œå­—æ®µä»¥å¤–ä½™ä¸‹éƒ¨åˆ†çš„1çš„è¡¥ç å’Œã€‚å› æ­¤ï¼ŒåŒ…æ‹¬æ ¡éªŒå’Œå­—æ®µåœ¨å†…çš„æ‰€æœ‰æ•°æ®ä¹‹å’Œç»“æžœä¸ºâ€œ16ä½å…¨éƒ¨ä¸º1â€æ—¶ï¼Œæ‰ä¼šè¢«è®¤ä¸ºæ‰€æ”¶åˆ°çš„æ•°æ®æ—¶æ­£ç¡®çš„ã€‚ å¦å¤–ï¼ŒUDPä¹Ÿå¯æœ‰å¯èƒ½ä¸ç”¨æ ¡éªŒå’Œã€‚æ­¤æ—¶ï¼Œæ ¡éªŒå’Œå­—æ®µä¸­å¡«å…¥0ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºŽä¸è¿›è¡Œæ ¡éªŒå’Œè®¡ç®—ï¼Œåè®®å¤„ç†çš„å¼€é”€ï¼ˆåœ¨å¤„ç†å®žé™…æ•°æ®ä¹‹å¤–ï¼Œä¸ºäº†è¿›è¡Œé€šä¿¡æŽ§åˆ¶çš„å¤„ç†è€Œä¸å¾—ä¸ä»˜å‡ºçš„å¿…è¦çš„æ¶ˆè€—éƒ¨åˆ†ï¼‰å°±ä¼šé™ä½Žï¼Œä»Žè€Œæé«˜æ•°æ®è½¬å‘çš„é€Ÿåº¦ã€‚ç„¶è€Œï¼Œå¦‚æžœUDPé¦–éƒ¨çš„ç«¯å£å·æˆ–æ˜¯IPé¦–éƒ¨çš„IPåœ°å€é‡åˆ°æŸåï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¹å…¶ä»–é€šä¿¡é€ æˆä¸å¥½çš„å½±å“ã€‚å› æ­¤ï¼Œåœ¨äº’è”ç½‘ä¸­æ¯”è¾ƒæŽ¨èä½¿ç”¨æ ¡éªŒå’Œæ£€æŸ¥ã€‚ æ ¡éªŒå’Œè®¡ç®—ä¸­è®¡ç®—UDPä¼ªé¦–éƒ¨çš„ç†ç”±TCP/IPä¸­è¯†åˆ«ä¸€ä¸ªé€šä¿¡çš„åº”ç”¨éœ€è¦5å¤§è¦ç´ ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯â€œæºIPåœ°å€â€ã€â€œç›®æ ‡IPåœ°å€â€ã€â€œæºç«¯å£â€ã€â€œç›®æ ‡ç«¯å£â€ã€â€œåè®®å·â€ã€‚ç„¶è€Œï¼Œåœ¨UDPçš„é¦–éƒ¨ä¸­åªåŒ…å«å®ƒä»¬å½“ä¸­çš„ä¸¤é¡¹ï¼ˆæºç«¯å£å’Œç›®æ ‡ç«¯å£ï¼‰ï¼Œä½™ä¸‹çš„3é¡¹éƒ½åŒ…å«åœ¨IPé¦–éƒ¨é‡Œã€‚å‡å®šå…¶ä»–3é¡¹éƒ½è¢«ç ´åï¼Ÿæ˜¾ç„¶ï¼Œè¿™æžæœ‰å¯èƒ½ä¼šå¯¼è‡´åº”è¯¥æ”¶åŒ…çš„åº”ç”¨æ”¶ä¸åˆ°åŒ…ï¼Œä¸è¯¥æ”¶åˆ°åŒ…çš„åº”ç”¨å´æ”¶åˆ°äº†åŒ…ã€‚ä¸ºäº†é¿å…è¿™ç±»é—®é¢˜ï¼Œæœ‰å¿…è¦éªŒè¯ä¸€ä¸ªé€šä¿¡ä¸­å¿…è¦çš„5é¡¹è¯†åˆ«ç æ˜¯å¦æ­£ç¡®ã€‚ä¸ºæ­¤ï¼Œåœ¨æ ¡éªŒå’Œçš„è®¡ç®—ä¸­å°±å¼•å…¥å’Œä¼ªé¦–éƒ¨çš„æ¦‚å¿µã€‚æ­¤å¤–ï¼ŒIPv6ä¸­çš„IPé¦–éƒ¨æ²¡æœ‰æ£€éªŒå’Œå­—æ®µã€‚TCPå’ŒUDPé€šè¿‡ä¼ªé¦–éƒ¨ï¼Œå¾—ä»¥å¯¹5é¡¹æ•°å­—è¿›è¡Œæ ¡éªŒï¼Œä»Žè€Œå®žçŽ°å³ä½¿åœ¨IPé¦–éƒ¨å¹¶ä¸å¯é çš„æƒ…å†µä¸‹ä»ç„¶èƒ½å¤Ÿæä¾›å¯é çš„é€šä¿¡ä¼ è¾“ã€‚ TCPé¦–éƒ¨æ ¼å¼ TCPä¸­æ²¡æœ‰è¡¨ç¤ºåŒ…é•¿åº¦å’Œæ•°æ®é•¿åº¦çš„å­—æ®µã€‚å¯ç”±IPå±‚èŽ·çŸ¥TCPçš„åŒ…é•¿ï¼Œç”±TCOçš„åŒ…é•¿å¯çŸ¥æ•°æ®çš„é•¿åº¦ã€‚ æºç«¯å£å·ï¼ˆSource Portï¼‰è¡¨ç¤ºå‘é€ç«¯ç«¯å£å·ï¼Œå­—æ®µé•¿16ä½ã€‚ ç›®æ ‡ç«¯å£å·ï¼ˆDestination Portï¼‰è¡¨ç¤ºæŽ¥æ”¶ç«¯ç«¯å£å·ï¼Œå­—æ®µé•¿åº¦16ä½ã€‚ åºåˆ—å·ï¼ˆSequence Numberï¼‰å­—æ®µé•¿32ä½ã€‚åºåˆ—å·ï¼ˆåºå·ï¼‰æ˜¯æŒ‡å‘é€æ•°æ®çš„ä½ç½®ï¼Œæ¯å‘é€ä¸€æ¬¡æ•°æ®ï¼Œå°±ç´¯åŠ ä¸€æ¬¡è¯¥æ•°æ®å­—èŠ‚æ•°çš„å¤§å°ã€‚ åºåˆ—å·ä¸ä¼šä»Ž0æˆ–1å¼€å§‹ï¼Œè€Œæ˜¯å»ºç«‹è¿žæŽ¥æ—¶ç”±è®¡ç®—æœºç”Ÿæˆçš„éšæœºæ•°ä½œä¸ºå…¶åˆå§‹å€¼ï¼Œé€šè¿‡SYNåŒ…ä¼ ç»™æŽ¥æ”¶ç«¯ä¸»æœºã€‚ç„¶åŽå†å°†æ¯è½¬å‘è¿‡åŽ»çš„å­—èŠ‚æ•°ç´¯åŠ åˆ°åˆå§‹å€¼ä¸Šè¡¨ç¤ºæ•°æ®çš„ä½ç½®ã€‚æ­¤å¤–ï¼Œåœ¨å»ºç«‹è¿žæŽ¥å’Œæ–­å¼€è¿žæŽ¥æ—¶å‘é€çš„SYNåŒ…å’ŒFINåŒ…è™½ç„¶å¹¶ä¸æºå¸¦æ•°æ®ï¼Œä½†æ˜¯ä¹Ÿä¼šä½œä¸ºä¸€ä¸ªå­—èŠ‚å¢žåŠ å¯¹åº”çš„åºåˆ—å·ã€‚ ç¡®è®¤åº”ç­”å·ï¼ˆAcknowledgement Numberï¼‰ç¡®è®¤åº”ç­”å·å­—æ®µé•¿åº¦32ä½ã€‚æ˜¯æŒ‡ä¸‹ä¸€æ¬¡åº”è¯¥å—åˆ°çš„æ•°æ®çš„åºåˆ—å·ã€‚å®žé™…ä¸Šï¼Œå®ƒæ˜¯æŒ‡å·²æ”¶åˆ°ç¡®è®¤åº”ç­”å·å‡ä¸€ä¸ºæ­¢çš„æ•°æ®ã€‚å‘é€ç«¯æ”¶åˆ°è¿™ä¸ªç¡®è®¤åº”ç­”ä»¥åŽå¯ä»¥è®¤ä¸ºåœ¨è¿™ä¸ªåºå·ä»¥å‰çš„æ•°æ®éƒ½å·²ç»è¢«æ­£å¸¸æŽ¥æ”¶ã€‚ æ•°æ®åç§»ï¼ˆData Offsetï¼‰è¯¥å­—æ®µè¡¨ç¤ºTCPæ‰€ä¼ è¾“çš„æ•°æ®éƒ¨åˆ†åº”è¯¥ä»ŽTCPåŒ…çš„å“ªä¸ªä½å¼€å§‹è®¡ç®—ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŠŠå®ƒçœ‹åšTCPé¦–éƒ¨çš„é•¿åº¦ã€‚è¯¥å­—æ®µé•¿4ä½ï¼Œå•ä½ä¸º4å­—èŠ‚ï¼ˆå³32ä½ï¼‰ã€‚ ä¿ç•™ï¼ˆReservedï¼‰è¯¥å­—æ®µä¸»è¦æ˜¯ä¸ºäº†ä»¥åŽæ‰©å±•æ—¶ä½¿ç”¨ï¼Œå…¶é•¿åº¦ä¸º4ä½ã€‚ä¸€èˆ¬è®¾ç½®ä¸º0ï¼Œä½†å³ä½¿æ”¶åˆ°çš„åŒ…åœ¨è¯¥å­—æ®µä¸ä¸º0ï¼Œæ­¤åŒ…ä¹Ÿä¸ä¼šè¢«ä¸¢å¼ƒã€‚ æŽ§åˆ¶ä½ï¼ˆControl Flagï¼‰å­—æ®µé•¿ä¸º8ä½ï¼Œæ¯ä¸€ä½ä»Žå·¦è‡³å³åˆ†åˆ«ä¸ºCWRã€ECEã€URGã€ACKã€PSHã€RSTã€SYNã€FINã€‚è¿™äº›æŽ§åˆ¶æ ‡å¿—ä¹Ÿå«ä½œæŽ§åˆ¶ä½ã€‚ CWRï¼ˆCongestion Window Reducedï¼‰CWRæ ‡å¿—ä¸ŽåŽé¢çš„ECEæ ‡å¿—éƒ½ç”¨äºŽIPé¦–éƒ¨çš„ECNå­—æ®µã€‚ECEæ ‡å¿—ä¸º1æ—¶ï¼Œåˆ™é€šçŸ¥å¯¹æ–¹å·²å°†æ‹¥å¡žçª—å£ç¼©å°ã€‚ ECEï¼ˆECN-Echoï¼‰ECEæ ‡å¿—è¡¨ç¤ºECN-Echoã€‚ç½®ä¸º1ä¼šé€šçŸ¥é€šä¿¡å¯¹æ–¹ï¼Œä»Žå¯¹æ–¹åˆ°è¿™è¾¹çš„ç½‘ç»œæœ‰æ‹¥å¡žã€‚åœ¨æ”¶åˆ°æ•°æ®åŒ…çš„IPé¦–éƒ¨ä¸­ECNä¸º1æ—¶å°†TCPé¦–éƒ¨ä¸­çš„ECEè®¾ç½®ä¸º1ã€‚ URGï¼ˆUrgent Flagï¼‰è¯¥ä½ä¸º1æ—¶ï¼Œç¡®è®¤åº”ç­”çš„å­—æ®µå˜ä¸ºæœ‰æ•ˆã€‚TCPè§„å®šé™¤äº†æœ€åˆå»ºç«‹è¿žæŽ¥æ—¶çš„SYNåŒ…ä¹‹å¤–è¯¥ä½å¿…é¡»è®¾ç½®ä¸º1ã€‚ PSHï¼ˆPush Flagï¼‰è¯¥ä½ä¸º1æ—¶ï¼Œè¡¨ç¤ºéœ€è¦å°†å—åˆ°çš„æ•°æ®ç«‹å³ä¼ ç»™ä¸Šå±‚åº”ç”¨åè®®ã€‚PSHä¸º0æ—¶ï¼Œåˆ™ä¸éœ€è¦ç«‹å³ä¼ è€Œæ˜¯å…ˆè¿›æ€§ç¼“å­˜ã€‚ RSTï¼ˆReset Flagï¼‰è¯¥ä½ä¸º1æ—¶è¡¨ç¤ºTCPè¿žæŽ¥ä¸­å‡ºçŽ°å¼‚å¸¸å¿…é¡»å¼ºåˆ¶æ–­å¼€è¿žæŽ¥ã€‚ SYNï¼ˆSynchronize Flagï¼‰ç”¨äºŽå»ºç«‹è¿žæŽ¥ã€‚SYNä¸º1 è¡¨ç¤ºå¸Œæœ›å»ºç«‹è¿žæŽ¥ï¼Œå¹¶åœ¨å…¶åºåˆ—å·çš„å­—æ®µè¿›è¡Œåºåˆ—å·åˆå§‹å€¼çš„è®¾å®šã€‚ FINï¼ˆFin Flagï¼‰è¯¥ä½ä¸º1æ—¶ï¼Œè¡¨ç¤ºä»ŠåŽä¸ä¼šå†æœ‰æ•°æ®å‘é€ï¼Œå¸Œæœ›æ–­å¼€è¿žæŽ¥ã€‚çª—å£å¤§å°ï¼ˆWindow Sizeï¼‰ çª—å£å¤§å°ï¼ˆWindow Sizeï¼‰è¯¥å­—æ®µé•¿ä¸º16ä½ã€‚ç”¨äºŽé€šçŸ¥ä»Žç›¸åŒTCPé¦–éƒ¨çš„ç¡®è®¤åº”ç­”å·æ‰€æŒ‡ä½ç½®å¼€å§‹èƒ½å¤ŸæŽ¥æ”¶çš„æ•°æ®å¤§å°ï¼ˆ8ä½å­—èŠ‚ï¼‰ã€‚TCPä¸å…è®¸å‘é€è¶…è¿‡æ­¤å¤„æ‰€ç¤ºå¤§å°çš„æ•°æ®ã€‚ä¸è¿‡ï¼Œå¦‚æžœçª—å£ä¸º0ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥å‘é€çª—å£æŽ¢æµ‹ï¼Œä»¥äº†è§£æœ€æ–°çš„çª—å£å¤§å°ã€‚ä½†è¿™ä¸ªæ•°æ®å¿…é¡»æ˜¯1ä¸ªå­—èŠ‚ã€‚ æ ¡éªŒå’Œï¼ˆChecksumï¼‰TCPçš„æ ¡éªŒå’Œä¸ŽUDPç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºŽTCPçš„æ ¡éªŒå’Œæ— æ³•å…³é—­ã€‚TCPå’ŒUDPä¸€æ ·åœ¨è®¡ç®—æ ¡éªŒå’Œçš„æ—¶å€™ä½¿ç”¨TCPä¼ªé¦–éƒ¨ã€‚ æŽ¥æ”¶ç«¯åœ¨æ”¶åˆ°TCPæ•°æ®æ®µä»¥åŽï¼Œä»ŽIPé¦–éƒ¨èŽ·å–IPåœ°å€ä¿¡æ¯æž„é€ TCPä¼ªé¦–éƒ¨ï¼Œå†è¿›è¡Œæ ¡éªŒå’Œè®¡ç®—ã€‚ç”±äºŽæ ¡éªŒå’Œå­—æ®µé‡Œä¿å­˜ç€é™¤æœ¬å­—æ®µä»¥å¤–æ´½è°ˆéƒ¨åˆ†çš„å’Œçš„è¡¥ç å€¼ï¼Œä¸€æ¬¡å¦‚æžœè®¡ç®—æ ¡éªŒå’Œå­—æ®µåœ¨å†…çš„æ‰€æœ‰æ•°æ®çš„16ä½å’Œä»¥åŽï¼Œå¾—å‡ºçš„ç»“æžœæ˜¯â€œ16ä½å…¨éƒ¨ä¸º1â€è¯´æ˜Žæ‰€æ”¶åˆ°æ•°æ®æ˜¯æ­£ç¡®çš„ã€‚ ç´§æ€¥æŒ‡é’ˆï¼ˆUrgent Pointerï¼‰ç•¥ é€‰é¡¹ï¼ˆOptionsï¼‰ç•¥]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>Network</tag>
        <tag>TCP</tag>
        <tag>UDP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç†è§£ Go Channels]]></title>
    <url>%2Fgo-channels.html</url>
    <content type="text"><![CDATA[Golang Channel ä¸€ã€è§†é¢‘ä¿¡æ¯1ã€è§†é¢‘è§‚çœ‹åœ°å€https://www.youtube.com/watch?v=KBZlN0izeiY 2ã€PPTä¸‹è½½åœ°å€http://download.csdn.net/download/xunzaosiyecao/10212884 3ã€åšæ–‡https://about.sourcegraph.com/go/understanding-channels-kavya-joshi/ äºŒã€Go çš„å¹¶å‘ç‰¹æ€§ goroutines: ç‹¬ç«‹æ‰§è¡Œæ¯ä¸ªä»»åŠ¡ï¼Œå¹¶å¯èƒ½å¹¶è¡Œæ‰§è¡Œ channels: ç”¨äºŽ goroutines ä¹‹é—´çš„é€šè®¯ã€åŒæ­¥ 1ã€ä¸€ä¸ªç®€å•çš„äº‹åŠ¡å¤„ç†çš„ä¾‹å­å¯¹äºŽä¸‹é¢è¿™æ ·çš„éžå¹¶å‘çš„ç¨‹åºï¼š 1234567func main() &#123; tasks := getTasks() // å¤„ç†æ¯ä¸ªä»»åŠ¡ for _, task := range tasks &#123; process(task) &#125;&#125; å°†å…¶è½¬æ¢ä¸º Go çš„å¹¶å‘æ¨¡å¼å¾ˆå®¹æ˜“ï¼Œä½¿ç”¨å…¸åž‹çš„ Task Queue çš„æ¨¡å¼ï¼š 123456789101112131415161718192021func main() &#123; // åˆ›å»ºå¸¦ç¼“å†²çš„ channel ch := make(chan Task, 3) // è¿è¡Œå›ºå®šæ•°é‡çš„ workers for i := 0; i &lt; numWorkers; i++ &#123; go worker(ch) &#125; // å‘é€ä»»åŠ¡åˆ° workers hellaTasks := getTasks() for _, task := range hellaTasks &#123; ch &lt;- task &#125; ...&#125;func worker(ch chan Task) &#123; for &#123; // æŽ¥æ”¶ä»»åŠ¡ task := &lt;-ch process(task) &#125;&#125; 2ã€channels çš„ç‰¹æ€§ goroutine-safeï¼Œå¤šä¸ª goroutine å¯ä»¥åŒæ—¶è®¿é—®ä¸€ä¸ª channelã€‚ å¯ä»¥ç”¨äºŽåœ¨ goroutine ä¹‹é—´å­˜å‚¨å’Œä¼ é€’å€¼ å…¶è¯­ä¹‰æ˜¯å…ˆå…¥å…ˆå‡ºï¼ˆFIFOï¼‰ å¯ä»¥å¯¼è‡´ goroutine çš„ block å’Œ unblock ä¸‰ã€è§£æž1ã€æž„é€  channel1234// å¸¦ç¼“å†²çš„ channelch := make(chan Task, 3)// æ— ç¼“å†²çš„ channelch := make(chan Task) å›žé¡¾å‰é¢æåˆ°çš„ channel çš„ç‰¹æ€§ï¼Œç‰¹åˆ«æ˜¯å‰ä¸¤ä¸ªã€‚å¦‚æžœå¿½ç•¥å†…ç½®çš„ channelï¼Œè®©ä½ è®¾è®¡ä¸€ä¸ªå…·æœ‰ goroutines-safe å¹¶ä¸”å¯ä»¥ç”¨æ¥å­˜å‚¨ã€ä¼ é€’å€¼çš„ä¸œè¥¿ï¼Œä½ ä¼šæ€Žä¹ˆåšï¼Ÿå¾ˆå¤šäººå¯èƒ½è§‰å¾—æˆ–è®¸å¯ä»¥ç”¨ä¸€ä¸ªå¸¦é”çš„é˜Ÿåˆ—æ¥åšã€‚æ²¡é”™ï¼Œäº‹å®žä¸Šï¼Œchannel å†…éƒ¨å°±æ˜¯ä¸€ä¸ªå¸¦é”çš„é˜Ÿåˆ—ã€‚https://golang.org/src/runtime/chan.go 123456789type hchan struct &#123; ... buf unsafe.Pointer // æŒ‡å‘ä¸€ä¸ªçŽ¯å½¢é˜Ÿåˆ— ... sendx uint // å‘é€ index recvx uint // æŽ¥æ”¶ index ... lock mutex // äº’æ–¥é‡&#125; buf çš„å…·ä½“å®žçŽ°å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªçŽ¯å½¢é˜Ÿåˆ—çš„å®žçŽ°ã€‚sendx å’Œ recvx åˆ†åˆ«ç”¨æ¥è®°å½•å‘é€ã€æŽ¥æ”¶çš„ä½ç½®ã€‚ç„¶åŽç”¨ä¸€ä¸ª lock äº’æ–¥é”æ¥ç¡®ä¿æ— ç«žäº‰å†’é™©ã€‚ å¯¹äºŽæ¯ä¸€ä¸ª ch := make(chan Task, 3) è¿™ç±»æ“ä½œï¼Œéƒ½ä¼šåœ¨å †ä¸­ï¼Œåˆ†é…ä¸€ä¸ªç©ºé—´ï¼Œå»ºç«‹å¹¶åˆå§‹åŒ–ä¸€ä¸ª hchan ç»“æž„å˜é‡ï¼Œè€Œ ch åˆ™æ˜¯æŒ‡å‘è¿™ä¸ª hchan ç»“æž„çš„æŒ‡é’ˆã€‚ å› ä¸º ch æœ¬èº«å°±æ˜¯ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰å¯ä»¥åœ¨ goroutine å‡½æ•°è°ƒç”¨çš„æ—¶å€™ç›´æŽ¥å°† ch ä¼ é€’è¿‡åŽ»ï¼Œè€Œä¸ç”¨å† &amp;ch å–æŒ‡é’ˆäº†ï¼Œæ‰€ä»¥æ‰€æœ‰ä½¿ç”¨åŒä¸€ä¸ª ch çš„ goroutine éƒ½æŒ‡å‘äº†åŒä¸€ä¸ªå®žé™…çš„å†…å­˜ç©ºé—´ã€‚ 2ã€å‘é€ã€æŽ¥æ”¶ä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬ç”¨ G1 è¡¨ç¤º main() å‡½æ•°çš„ goroutineï¼Œè€Œ G2 è¡¨ç¤º worker çš„ goroutineã€‚ 123456789101112131415// G1func main() &#123; ... for _, task := range tasks &#123; ch &lt;- task &#125; ...&#125;// G2func worker(ch chan Task) &#123; for &#123; task :=&lt;-ch process(task) &#125;&#125; 2.1 ç®€å•çš„å‘é€ã€æŽ¥æ”¶é‚£ä¹ˆ G1 ä¸­çš„ ch &lt;- task0 å…·ä½“æ˜¯æ€Žä¹ˆåšçš„å‘¢ï¼Ÿ èŽ·å–é” enqueue(task0)ï¼ˆè¿™é‡Œæ˜¯å†…å­˜å¤åˆ¶ task0ï¼‰ é‡Šæ”¾é” è¿™ä¸€æ­¥å¾ˆç®€å•ï¼ŒæŽ¥ä¸‹æ¥çœ‹ G2 çš„ t := &lt;- ch æ˜¯å¦‚ä½•è¯»å–æ•°æ®çš„ã€‚ èŽ·å–é” t = dequeue()ï¼ˆåŒæ ·ï¼Œè¿™é‡Œä¹Ÿæ˜¯å†…å­˜å¤åˆ¶ï¼‰ é‡Šæ”¾é” è¿™ä¸€æ­¥ä¹Ÿéžå¸¸ç®€å•ã€‚ä½†æ˜¯æˆ‘ä»¬ä»Žè¿™ä¸ªæ“ä½œä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰ goroutine ä¸­å…±äº«çš„éƒ¨åˆ†åªæœ‰è¿™ä¸ª hchan çš„ç»“æž„ä½“ï¼Œè€Œæ‰€æœ‰é€šè®¯çš„æ•°æ®éƒ½æ˜¯å†…å­˜å¤åˆ¶ã€‚è¿™éµå¾ªäº† Go å¹¶å‘è®¾è®¡ä¸­å¾ˆæ ¸å¿ƒçš„ä¸€ä¸ªç†å¿µï¼š Do not communicate by sharing memory;instead, share memory by communicating å†…å­˜å¤åˆ¶æŒ‡çš„æ˜¯ï¼š 12345678910111213141516171819// typedmemmove copies a value of type t to dst from src.// Must be nosplit, see #16026.//go:nosplitfunc typedmemmove(typ *_type, dst, src unsafe.Pointer) &#123; if typ.kind&amp;kindNoPointers == 0 &#123; bulkBarrierPreWrite(uintptr(dst), uintptr(src), typ.size) &#125; // There&apos;s a race here: if some other goroutine can write to // src, it may change some pointer in src after we&apos;ve // performed the write barrier but before we perform the // memory copy. This safe because the write performed by that // other goroutine must also be accompanied by a write // barrier, so at worst we&apos;ve unnecessarily greyed the old // pointer that was in src. memmove(dst, src, typ.size) if writeBarrier.cgo &#123; cgoCheckMemmove(typ, dst, src, 0, typ.size) &#125;&#125; 3ã€é˜»å¡žå’Œæ¢å¤3.1 å‘é€æ–¹è¢«é˜»å¡žå‡è®¾ G2 éœ€è¦å¾ˆé•¿æ—¶é—´çš„å¤„ç†ï¼Œåœ¨æ­¤æœŸé—´ï¼ŒG1 ä¸æ–­çš„å‘é€ä»»åŠ¡ï¼š 123ch &lt;- task1ch &lt;- task2ch &lt;- task3 ä½†æ˜¯å½“å†ä¸€æ¬¡ ch &lt;- task4 çš„æ—¶å€™ï¼Œç”±äºŽ ch çš„ç¼“å†²åªæœ‰ 3 ä¸ªï¼Œæ‰€ä»¥æ²¡æœ‰åœ°æ–¹æ”¾äº†ï¼ŒäºŽæ˜¯ G1 è¢« block äº†ï¼Œå½“æœ‰äººä»Žé˜Ÿåˆ—ä¸­å–èµ°ä¸€ä¸ª Task çš„æ—¶å€™ï¼ŒG1 æ‰ä¼šè¢«æ¢å¤ã€‚è¿™æ˜¯æˆ‘ä»¬éƒ½çŸ¥é“çš„ï¼Œä¸è¿‡æˆ‘ä»¬ä»Šå¤©å…³å¿ƒçš„ä¸æ˜¯å‘ç”Ÿäº†ä»€ä¹ˆï¼Œè€Œæ˜¯å¦‚ä½•åšåˆ°çš„ï¼Ÿ 3.2 goroutine çš„è¿è¡Œæ—¶è°ƒåº¦é¦–å…ˆï¼Œgoroutine ä¸æ˜¯æ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œè€Œæ˜¯ ç”¨æˆ·ç©ºé—´çº¿ç¨‹ã€‚å› æ­¤ goroutine æ˜¯ç”± Go runtime æ¥åˆ›å»ºå¹¶ç®¡ç†çš„ï¼Œè€Œä¸æ˜¯ OSï¼Œæ‰€ä»¥è¦æ¯”æ“ä½œç³»ç»Ÿçº¿ç¨‹è½»é‡çº§ã€‚ å½“ç„¶ï¼Œgoroutine æœ€ç»ˆè¿˜æ˜¯è¦è¿è¡ŒäºŽæŸä¸ªçº¿ç¨‹ä¸­çš„ï¼ŒæŽ§åˆ¶ goroutine å¦‚ä½•è¿è¡ŒäºŽçº¿ç¨‹ä¸­çš„æ˜¯ Go runtime ä¸­çš„ scheduler ï¼ˆè°ƒåº¦å™¨ï¼‰ã€‚ Go çš„è¿è¡Œæ—¶è°ƒåº¦å™¨æ˜¯ M:N è°ƒåº¦æ¨¡åž‹ï¼Œæ—¢ N ä¸ª goroutineï¼Œä¼šè¿è¡ŒäºŽ M ä¸ª OS çº¿ç¨‹ä¸­ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ª OS çº¿ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šè¿è¡Œå¤šä¸ª goroutineã€‚ Go çš„ M:N è°ƒåº¦ä¸­ä½¿ç”¨äº†3ä¸ªç»“æž„ï¼š M: OS çº¿ç¨‹ G: goroutine P: è°ƒåº¦ä¸Šä¸‹æ–‡ P æ‹¥æœ‰ä¸€ä¸ªè¿è¡Œé˜Ÿåˆ—ï¼Œé‡Œé¢æ˜¯æ‰€æœ‰å¯ä»¥è¿è¡Œçš„ goroutine åŠå…¶ä¸Šä¸‹æ–‡ 3.3 goroutine è¢«é˜»å¡žçš„å…·ä½“è¿‡ç¨‹é‚£ä¹ˆå½“ ch &lt;- task4 æ‰§è¡Œçš„æ—¶å€™ï¼Œchannel ä¸­å·²ç»æ»¡äº†ï¼Œéœ€è¦ pause G1ã€‚è¿™ä¸ªæ—¶å€™ï¼š G1 ä¼šè°ƒç”¨è¿è¡Œæ—¶çš„ gopark ç„¶åŽ Go çš„è¿è¡Œæ—¶è°ƒåº¦å™¨å°±ä¼šæŽ¥ç®¡ å°† G1 çš„çŠ¶æ€è®¾ç½®ä¸º waiting æ–­å¼€ G1 å’Œ M ä¹‹é—´çš„å…³ç³»ï¼ˆswitch out)ï¼Œå› æ­¤ G1 è„±ç¦» Mï¼Œæ¢å¥è¯è¯´ï¼ŒM ç©ºé—²äº†ï¼Œå¯ä»¥å®‰æŽ’åˆ«çš„ä»»åŠ¡äº†ã€‚ ä»Ž P çš„è¿è¡Œé˜Ÿåˆ—ä¸­ï¼Œå–å¾—ä¸€ä¸ªå¯è¿è¡Œçš„ goroutine G å»ºç«‹æ–°çš„ G å’Œ M çš„å…³ç³»ï¼ˆSwitch in)ï¼Œå› æ­¤ G å°±å‡†å¤‡å¥½è¿è¡Œäº†ã€‚ å½“è°ƒåº¦å™¨è¿”å›žçš„æ—¶å€™ï¼Œæ–°çš„ G å°±å¼€å§‹è¿è¡Œäº†ï¼Œè€Œ G1 åˆ™ä¸ä¼šè¿è¡Œï¼Œä¹Ÿå°±æ˜¯ block äº†ã€‚ ä»Žä¸Šé¢çš„æµç¨‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºŽ goroutine æ¥è¯´ï¼ŒG1 è¢«é˜»å¡žäº†ï¼Œæ–°çš„ G å¼€å§‹è¿è¡Œäº†ï¼›è€Œå¯¹äºŽæ“ä½œç³»ç»Ÿçº¿ç¨‹ M æ¥è¯´ï¼Œåˆ™æ ¹æœ¬æ²¡æœ‰è¢«é˜»å¡žã€‚ æˆ‘ä»¬çŸ¥é“ OS çº¿ç¨‹è¦æ¯” goroutine è¦æ²‰é‡çš„å¤šï¼Œå› æ­¤è¿™é‡Œå°½é‡é¿å… OS çº¿ç¨‹é˜»å¡žï¼Œå¯ä»¥æé«˜æ€§èƒ½ã€‚ 3.4 goroutine æ¢å¤æ‰§è¡Œçš„å…·ä½“è¿‡ç¨‹å‰é¢ç†è§£äº†é˜»å¡žï¼Œé‚£ä¹ˆæŽ¥ä¸‹æ¥ç†è§£ä¸€ä¸‹å¦‚ä½•æ¢å¤è¿è¡Œã€‚ä¸è¿‡ï¼Œåœ¨ç»§ç»­äº†è§£å¦‚ä½•æ¢å¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè¿›ä¸€æ­¥ç†è§£ hchan è¿™ä¸ªç»“æž„ã€‚å› ä¸ºï¼Œå½“ channel ä¸åœ¨æ»¡çš„æ—¶å€™ï¼Œè°ƒåº¦å™¨æ˜¯å¦‚ä½•çŸ¥é“è¯¥è®©å“ªä¸ª goroutine ç»§ç»­è¿è¡Œå‘¢ï¼Ÿè€Œä¸” goroutine åˆæ˜¯å¦‚ä½•çŸ¥é“è¯¥ä»Žå“ªå–æ•°æ®å‘¢ï¼Ÿ åœ¨ hchan ä¸­ï¼Œé™¤äº†ä¹‹å‰æåˆ°çš„å†…å®¹å¤–ï¼Œè¿˜å®šä¹‰æœ‰ sendq å’Œ recvq ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œåˆ†åˆ«è¡¨ç¤ºç­‰å¾…å‘é€ã€æŽ¥æ”¶çš„ goroutineï¼ŒåŠå…¶ç›¸å…³ä¿¡æ¯ã€‚ 123456789type hchan struct &#123; ... buf unsafe.Pointer // æŒ‡å‘ä¸€ä¸ªçŽ¯å½¢é˜Ÿåˆ— ... sendq waitq // ç­‰å¾…å‘é€çš„é˜Ÿåˆ— recvq waitq // ç­‰å¾…æŽ¥æ”¶çš„é˜Ÿåˆ— ... lock mutex // äº’æ–¥é‡&#125; å…¶ä¸­ waitq æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æž„çš„é˜Ÿåˆ—ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ª sudog çš„ç»“æž„ï¼Œå…¶å®šä¹‰å¤§è‡´ä¸ºï¼š 12345type sudog struct &#123; g *g // æ­£åœ¨ç­‰å€™çš„ goroutine elem unsafe.Pointer // æŒ‡å‘éœ€è¦æŽ¥æ”¶ã€å‘é€çš„å…ƒç´  ...&#125; https://golang.org/src/runtime/runtime2.go?h=sudog#L270 æ‰€ä»¥åœ¨ä¹‹å‰çš„é˜»å¡ž G1 çš„è¿‡ç¨‹ä¸­ï¼Œå®žé™…ä¸Šï¼š G1 ä¼šç»™è‡ªå·±åˆ›å»ºä¸€ä¸ª sudog çš„å˜é‡ ç„¶åŽè¿½åŠ åˆ° sendq çš„ç­‰å€™é˜Ÿåˆ—ä¸­ï¼Œæ–¹ä¾¿å°†æ¥çš„receiver æ¥ä½¿ç”¨è¿™äº›ä¿¡æ¯æ¢å¤ G1ã€‚ è¿™äº›éƒ½æ˜¯å‘ç”Ÿåœ¨è°ƒç”¨è°ƒåº¦å™¨ä¹‹å‰ã€‚ é‚£ä¹ˆçŽ°åœ¨å¼€å§‹çœ‹ä¸€ä¸‹å¦‚ä½•æ¢å¤ã€‚ å½“ G2 è°ƒç”¨ t := &lt;- ch çš„æ—¶å€™ï¼Œchannel çš„çŠ¶æ€æ˜¯ï¼Œç¼“å†²æ˜¯æ»¡çš„ï¼Œè€Œä¸”è¿˜æœ‰ä¸€ä¸ª G1 åœ¨ç­‰å€™å‘é€é˜Ÿåˆ—é‡Œï¼Œç„¶åŽ G2 æ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼š G2 å…ˆæ‰§è¡Œ dequeue() ä»Žç¼“å†²é˜Ÿåˆ—ä¸­å–å¾— task1 ç»™ t G2 ä»Ž sendq ä¸­å¼¹å‡ºä¸€ä¸ªç­‰å€™å‘é€çš„ sudog å°†å¼¹å‡ºçš„ sudog ä¸­çš„ elem çš„å€¼ enqueue() åˆ° buf ä¸­ å°†å¼¹å‡ºçš„ sudog ä¸­çš„ goroutineï¼Œä¹Ÿå°±æ˜¯ G1ï¼ŒçŠ¶æ€ä»Ž waiting æ”¹ä¸º runnable ç„¶åŽï¼ŒG2 éœ€è¦é€šçŸ¥è°ƒåº¦å™¨ G1 å·²ç»å¯ä»¥è¿›è¡Œè°ƒåº¦äº†ï¼Œå› æ­¤è°ƒç”¨ goready(G1)ã€‚ è°ƒåº¦å™¨å°† G1 çš„çŠ¶æ€æ”¹ä¸º runnable è°ƒåº¦å™¨å°† G1 åŽ‹å…¥ P çš„è¿è¡Œé˜Ÿåˆ—ï¼Œå› æ­¤åœ¨å°†æ¥çš„æŸä¸ªæ—¶åˆ»è°ƒåº¦çš„æ—¶å€™ï¼ŒG1 å°±ä¼šå¼€å§‹æ¢å¤è¿è¡Œã€‚ è¿”å›žåˆ° G2 æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ç”± G2 æ¥è´Ÿè´£å°† G1 çš„ elem åŽ‹å…¥ buf çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªä¼˜åŒ–ã€‚è¿™æ ·å°†æ¥ G1 æ¢å¤è¿è¡ŒåŽï¼Œå°±ä¸å¿…å†æ¬¡èŽ·å–é”ã€enqueue()ã€é‡Šæ”¾é”äº†ã€‚è¿™æ ·å°±é¿å…äº†å¤šæ¬¡é”çš„å¼€é”€ã€‚ 3.5 å¦‚æžœæŽ¥æ”¶æ–¹å…ˆé˜»å¡žå‘¢ï¼Ÿæ›´é…·çš„åœ°æ–¹æ˜¯æŽ¥æ”¶æ–¹å…ˆé˜»å¡žçš„æµç¨‹ã€‚ å¦‚æžœ G2 å…ˆæ‰§è¡Œäº† t := &lt;- chï¼Œæ­¤æ—¶ buf æ˜¯ç©ºçš„ï¼Œå› æ­¤ G2 ä¼šè¢«é˜»å¡žï¼Œä»–çš„æµç¨‹æ˜¯è¿™æ ·ï¼š G2 ç»™è‡ªå·±åˆ›å»ºä¸€ä¸ª sudog ç»“æž„å˜é‡ã€‚å…¶ä¸­ g æ˜¯è‡ªå·±ï¼Œä¹Ÿå°±æ˜¯ G2ï¼Œè€Œ elem åˆ™æŒ‡å‘ t å°†è¿™ä¸ª sudog å˜é‡åŽ‹å…¥ recvq ç­‰å€™æŽ¥æ”¶é˜Ÿåˆ— G2 éœ€è¦å‘Šè¯‰ goroutineï¼Œè‡ªå·±éœ€è¦ pause äº†ï¼ŒäºŽæ˜¯è°ƒç”¨ gopark(G2) å’Œä¹‹å‰ä¸€æ ·ï¼Œè°ƒåº¦å™¨å°†å…¶ G2 çš„çŠ¶æ€æ”¹ä¸º waiting æ–­å¼€ G2 å’Œ M çš„å…³ç³» ä»Ž P çš„è¿è¡Œé˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ª goroutine å»ºç«‹æ–°çš„ goroutine å’Œ M çš„å…³ç³» è¿”å›žï¼Œå¼€å§‹ç»§ç»­è¿è¡Œæ–°çš„ goroutine è¿™äº›åº”è¯¥å·²ç»ä¸é™Œç”Ÿäº†ï¼Œé‚£ä¹ˆå½“ G1 å¼€å§‹å‘é€æ•°æ®çš„æ—¶å€™ï¼Œæµç¨‹æ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿ G1 å¯ä»¥å°† enqueue(task)ï¼Œç„¶åŽè°ƒç”¨ goready(G2)ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥æ›´èªæ˜Žä¸€äº›ã€‚ æˆ‘ä»¬æ ¹æ® hchan ç»“æž„çš„çŠ¶æ€ï¼Œå·²ç»çŸ¥é“ task è¿›å…¥ buf åŽï¼ŒG2 æ¢å¤è¿è¡ŒåŽï¼Œä¼šè¯»å–å…¶å€¼ï¼Œå¤åˆ¶åˆ° t ä¸­ã€‚é‚£ä¹ˆ G1 å¯ä»¥æ ¹æœ¬ä¸èµ° bufï¼ŒG1 å¯ä»¥ç›´æŽ¥æŠŠæ•°æ®ç»™ G2ã€‚ Goroutine é€šå¸¸éƒ½æœ‰è‡ªå·±çš„æ ˆï¼Œäº’ç›¸ä¹‹é—´ä¸ä¼šè®¿é—®å¯¹æ–¹çš„æ ˆå†…æ•°æ®ï¼Œé™¤äº† channelã€‚è¿™é‡Œï¼Œç”±äºŽæˆ‘ä»¬å·²ç»çŸ¥é“äº† t çš„åœ°å€ï¼ˆé€šè¿‡ elemæŒ‡é’ˆï¼‰ï¼Œè€Œä¸”ç”±äºŽ G2 ä¸åœ¨è¿è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾ˆå®‰å…¨çš„ç›´æŽ¥èµ‹å€¼ã€‚å½“ G2 æ¢å¤è¿è¡Œçš„æ—¶å€™ï¼Œæ—¢ä¸éœ€è¦å†æ¬¡èŽ·å–é”ï¼Œä¹Ÿä¸éœ€è¦å¯¹ buf è¿›è¡Œæ“ä½œã€‚ä»Žè€ŒèŠ‚çº¦äº†å†…å­˜å¤åˆ¶ã€ä»¥åŠé”æ“ä½œçš„å¼€é”€ã€‚ 4ã€æ€»ç»“ goroutine-safe hchan ä¸­çš„ lock mutex å­˜å‚¨ã€ä¼ é€’å€¼ï¼ŒFIFO é€šè¿‡ hchan ä¸­çš„çŽ¯å½¢ç¼“å†²åŒºæ¥å®žçŽ° å¯¼è‡´ goroutine çš„é˜»å¡žå’Œæ¢å¤ hchan ä¸­çš„ sendqå’Œrecvqï¼Œä¹Ÿå°±æ˜¯ sudog ç»“æž„çš„é“¾è¡¨é˜Ÿåˆ— è°ƒç”¨è¿è¡Œæ—¶è°ƒåº¦å™¨ (gopark(), goready())å››ã€å…¶å®ƒ channel çš„æ“ä½œ1ã€æ— ç¼“å†² channelæ— ç¼“å†²çš„ channel è¡Œä¸ºå°±å’Œå‰é¢è¯´çš„ç›´æŽ¥å‘é€çš„ä¾‹å­ä¸€æ ·ï¼š æŽ¥æ”¶æ–¹é˜»å¡ž â†’ å‘é€æ–¹ç›´æŽ¥å†™å…¥æŽ¥æ”¶æ–¹çš„æ ˆ å‘é€æ–¹é˜»å¡ž â†’ æŽ¥å—æ³•ç›´æŽ¥ä»Žå‘é€æ–¹çš„ sudog ä¸­è¯»å– 2ã€selecthttps://golang.org/src/runtime/select.go å…ˆæŠŠæ‰€æœ‰éœ€è¦æ“ä½œçš„ channel ä¸Šé” ç»™è‡ªå·±åˆ›å»ºä¸€ä¸ª sudogï¼Œç„¶åŽæ·»åŠ åˆ°æ‰€æœ‰ channel çš„ sendqæˆ–recvqï¼ˆå–å†³äºŽæ˜¯å‘é€è¿˜æ˜¯æŽ¥æ”¶ï¼‰ æŠŠæ‰€æœ‰çš„ channel è§£é”ï¼Œç„¶åŽ pause å½“å‰è°ƒç”¨ select çš„ goroutineï¼ˆgopark()ï¼‰ ç„¶åŽå½“æœ‰ä»»æ„ä¸€ä¸ª channel å¯ç”¨æ—¶ï¼Œselect çš„è¿™ä¸ª goroutine å°±ä¼šè¢«è°ƒåº¦æ‰§è¡Œã€‚ resuming mirrors the pause sequence äº”ã€ä¸ºä»€ä¹ˆ Go ä¼šè¿™æ ·è®¾è®¡ï¼Ÿ1ã€Simplicityæ›´å€¾å‘äºŽå¸¦é”çš„é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯æ— é”çš„å®žçŽ°ã€‚ æ€§èƒ½æå‡ä¸æ˜¯å‡­ç©ºè€Œæ¥çš„ï¼Œæ˜¯éšç€å¤æ‚åº¦å¢žåŠ è€Œå¢žåŠ çš„ã€‚ dvyokovåŽè€…è™½ç„¶æ€§èƒ½å¯èƒ½ä¼šæ›´å¥½ï¼Œä½†æ˜¯è¿™ä¸ªä¼˜åŠ¿ï¼Œå¹¶ä¸ä¸€å®šèƒ½å¤Ÿæˆ˜èƒœéšä¹‹è€Œæ¥çš„å®žçŽ°ä»£ç çš„å¤æ‚åº¦æ‰€å¸¦æ¥çš„åŠ£åŠ¿ã€‚ 2ã€Performance è°ƒç”¨ Go è¿è¡Œæ—¶è°ƒåº¦å™¨ï¼Œè¿™æ ·å¯ä»¥ä¿æŒ OS çº¿ç¨‹ä¸è¢«é˜»å¡žè·¨ goroutine çš„æ ˆè¯»ã€å†™ã€‚ å¯ä»¥è®© goroutine é†’æ¥åŽä¸å¿…èŽ·å–é”ã€‚ å¯ä»¥é¿å…ä¸€äº›å†…å­˜å¤åˆ¶ã€‚ å½“ç„¶ï¼Œä»»ä½•ä¼˜åŠ¿éƒ½ä¼šæœ‰å…¶ä»£ä»·ã€‚è¿™é‡Œçš„ä»£ä»·æ˜¯å®žçŽ°çš„å¤æ‚åº¦ï¼Œæ‰€ä»¥è¿™é‡Œæœ‰æ›´å¤æ‚çš„å†…å­˜ç®¡ç†æœºåˆ¶ã€åžƒåœ¾å›žæ”¶ä»¥åŠæ ˆæ”¶ç¼©æœºåˆ¶ã€‚ åœ¨è¿™é‡Œæ€§èƒ½çš„æé«˜ä¼˜åŠ¿ï¼Œè¦æ¯”å¤æ‚åº¦çš„æé«˜å¸¦æ¥çš„åŠ£åŠ¿è¦å¤§ã€‚ æ‰€ä»¥åœ¨ channel å®žçŽ°çš„å„ç§ä»£ç ä¸­ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è§åˆ°è¿™ç§simplicity vs performance çš„æƒè¡¡åŽçš„ç»“æžœã€‚ æœ¬æ–‡è½¬è½½è‡ªï¼šhttps://blog.lab99.org/post/golang-2017-10-04-video-understanding-channels.html#fa-song-jie-shou]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>Channel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Go 1.9 Sync Map]]></title>
    <url>%2Fgo-sync-map.html</url>
    <content type="text"><![CDATA[åŸºäºŽGo 1.9 è§£æžSync Map æ¦‚è¦Package æœ¬æ–‡ä¸»è¦é˜è¿°ï¼šLoadã€Storeã€Deleteï¼Œæ›´åŠ è¯¦ç»†çš„é˜è¿°å¯ä»¥å‚è€ƒæºç æè¿°ï¼ˆå»ºè®®å…ˆå¤§ä½“æµè§ˆä¸€ä¸‹Mapæºç ï¼‰ã€‚ å®žçŽ°æ€è·¯ ç©ºé—´æ¢æ—¶é—´ã€‚ é€šè¿‡å†—ä½™çš„ä¸¤ä¸ªæ•°æ®ç»“æž„(readã€dirty),å®žçŽ°åŠ é”å¯¹æ€§èƒ½çš„å½±å“ã€‚ ä½¿ç”¨åªè¯»æ•°æ®(read)ï¼Œé¿å…è¯»å†™å†²çªã€‚ åŠ¨æ€è°ƒæ•´ï¼Œmissæ¬¡æ•°å¤šäº†ä¹‹åŽï¼Œå°†dirtyæ•°æ®æå‡ä¸ºreadã€‚ double-checkingã€‚ å»¶è¿Ÿåˆ é™¤ã€‚ åˆ é™¤ä¸€ä¸ªé”®å€¼åªæ˜¯æ‰“æ ‡è®°ï¼ˆä¼šå°†keyå¯¹åº”valueçš„pointerç½®ä¸ºnilï¼Œä½†readä¸­ä»ç„¶æœ‰è¿™ä¸ªkey:key;value:nilçš„é”®å€¼å¯¹ï¼‰ï¼Œåªæœ‰åœ¨æå‡dirtyçš„æ—¶å€™æ‰æ¸…ç†åˆ é™¤çš„æ•°æ®ã€‚ ä¼˜å…ˆä»Žreadè¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼Œå› ä¸ºå¯¹readçš„è¯»å–ä¸éœ€è¦é”ã€‚ è™½ç„¶readå’Œdirtyæœ‰å†—ä½™æ•°æ®ï¼Œä½†è¿™äº›æ•°æ®æ˜¯é€šè¿‡æŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªæ•°æ®ï¼Œæ‰€ä»¥å°½ç®¡Mapçš„valueä¼šå¾ˆå¤§ï¼Œä½†æ˜¯å†—ä½™çš„ç©ºé—´å ç”¨è¿˜æ˜¯æœ‰é™çš„ã€‚ æ•°æ®ç»“æž„Map1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162// Map is a concurrent map with amortized-constant-time loads, stores, and deletes.// It is safe for multiple goroutines to call a Map&apos;s methods concurrently.//// It is optimized for use in concurrent loops with keys that are// stable over time, and either few steady-state stores, or stores// localized to one goroutine per key.//// For use cases that do not share these attributes, it will likely have// comparable or worse performance and worse type safety than an ordinary// map paired with a read-write mutex.//// The zero Map is valid and empty.//// A Map must not be copied after first use.//è¯¥ Map æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¯»å–ï¼Œæ’å…¥ï¼Œåˆ é™¤ä¹Ÿéƒ½ä¿æŒç€å¸¸æ•°çº§çš„æ—¶é—´å¤æ‚åº¦ã€‚//å¤šä¸ª goroutines åç¨‹åŒæ—¶è°ƒç”¨ Map æ–¹æ³•ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è¯¥ Map çš„é›¶å€¼æ˜¯æœ‰æ•ˆçš„ï¼Œ//å¹¶ä¸”é›¶å€¼æ˜¯ä¸€ä¸ªç©ºçš„ Map ã€‚çº¿ç¨‹å®‰å…¨çš„ Map åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨ä¹‹åŽï¼Œä¸å…è®¸è¢«æ‹·è´ã€‚type Map struct &#123; mu Mutex // read contains the portion of the map&apos;s contents that are safe for // concurrent access (with or without mu held). // // The read field itself is always safe to load, but must only be stored with // mu held. // // Entries stored in read may be updated concurrently without mu, but updating // a previously-expunged entry requires that the entry be copied to the dirty // map and unexpunged with mu held. // ä¸€ä¸ªåªè¯»çš„æ•°æ®ç»“æž„ï¼Œå› ä¸ºåªè¯»ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰è¯»å†™å†²çªã€‚ // æ‰€ä»¥ä»Žè¿™ä¸ªæ•°æ®ä¸­è¯»å–æ€»æ˜¯å®‰å…¨çš„ã€‚ // å®žé™…ä¸Šï¼Œå®žé™…ä¹Ÿä¼šæ›´æ–°è¿™ä¸ªæ•°æ®çš„entries,å¦‚æžœentryæ˜¯æœªåˆ é™¤çš„(unexpunged), å¹¶ä¸éœ€è¦åŠ é”ã€‚å¦‚æžœentryå·²ç»è¢«åˆ é™¤äº†ï¼Œéœ€è¦åŠ é”ï¼Œä»¥ä¾¿æ›´æ–°dirtyæ•°æ®ã€‚ read atomic.Value // readOnly // dirty contains the portion of the map&apos;s contents that require mu to be // held. To ensure that the dirty map can be promoted to the read map quickly, // it also includes all of the non-expunged entries in the read map. // // Expunged entries are not stored in the dirty map. An expunged entry in the // clean map must be unexpunged and added to the dirty map before a new value // can be stored to it. // // If the dirty map is nil, the next write to the map will initialize it by // making a shallow copy of the clean map, omitting stale entries. // dirtyæ•°æ®åŒ…å«å½“å‰çš„mapåŒ…å«çš„entries,å®ƒåŒ…å«æœ€æ–°çš„entries(åŒ…æ‹¬readä¸­æœªåˆ é™¤çš„æ•°æ®,è™½æœ‰å†—ä½™ï¼Œä½†æ˜¯æå‡dirtyå­—æ®µä¸ºreadçš„æ—¶å€™éžå¸¸å¿«ï¼Œä¸ç”¨ä¸€ä¸ªä¸€ä¸ªçš„å¤åˆ¶ï¼Œè€Œæ˜¯ç›´æŽ¥å°†è¿™ä¸ªæ•°æ®ç»“æž„ä½œä¸ºreadå­—æ®µçš„ä¸€éƒ¨åˆ†),æœ‰äº›æ•°æ®è¿˜å¯èƒ½æ²¡æœ‰ç§»åŠ¨åˆ°readå­—æ®µä¸­ã€‚ // å¯¹äºŽdirtyçš„æ“ä½œéœ€è¦åŠ é”ï¼Œå› ä¸ºå¯¹å®ƒçš„æ“ä½œå¯èƒ½ä¼šæœ‰è¯»å†™ç«žäº‰ã€‚ // å½“dirtyä¸ºç©ºçš„æ—¶å€™ï¼Œ æ¯”å¦‚åˆå§‹åŒ–æˆ–è€…åˆšæå‡å®Œï¼Œä¸‹ä¸€æ¬¡çš„å†™æ“ä½œä¼šå¤åˆ¶readå­—æ®µä¸­æœªåˆ é™¤çš„æ•°æ®åˆ°è¿™ä¸ªæ•°æ®ä¸­ã€‚ dirty map[interface&#123;&#125;]*entry // misses counts the number of loads since the read map was last updated that // needed to lock mu to determine whether the key was present. // // Once enough misses have occurred to cover the cost of copying the dirty // map, the dirty map will be promoted to the read map (in the unamended // state) and the next store to the map will make a new dirty copy. // å½“ä»ŽMapä¸­è¯»å–entryçš„æ—¶å€™ï¼Œå¦‚æžœreadä¸­ä¸åŒ…å«è¿™ä¸ªentry,ä¼šå°è¯•ä»Ždirtyä¸­è¯»å–ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå°†missesåŠ ä¸€ï¼Œ // å½“missesç´¯ç§¯åˆ° dirtyçš„é•¿åº¦çš„æ—¶å€™ï¼Œ å°±ä¼šå°†dirtyæå‡ä¸ºread,é¿å…ä»Ždirtyä¸­misså¤ªå¤šæ¬¡ã€‚å› ä¸ºæ“ä½œdirtyéœ€è¦åŠ é”ã€‚ misses int&#125; readOnly1234567// readOnly is an immutable struct stored atomically in the Map.read field.type readOnly struct &#123; m map[interface&#123;&#125;]*entry // true if the dirty map contains some key not in m. // å¦‚æžœMap.dirtyæœ‰äº›æ•°æ®ä¸åœ¨ä¸­çš„æ—¶å€™ï¼Œè¿™ä¸ªå€¼ä¸ºtrue amended bool &#125; entry123456789101112131415161718192021222324252627// An entry is a slot in the map corresponding to a particular key.type entry struct &#123; // p points to the interface&#123;&#125; value stored for the entry. // // If p == nil, the entry has been deleted and m.dirty == nil. // // If p == expunged, the entry has been deleted, m.dirty != nil, and the entry // is missing from m.dirty. // // Otherwise, the entry is valid and recorded in m.read.m[key] and, if m.dirty // != nil, in m.dirty[key]. // // An entry can be deleted by atomic replacement with nil: when m.dirty is // next created, it will atomically replace nil with expunged and leave // m.dirty[key] unset. // // An entry&apos;s associated value can be updated by atomic replacement, provided // p != expunged. If p == expunged, an entry&apos;s associated value can be updated // only after first setting m.dirty[key] = e so that lookups using the dirty // map find the entry. //pæœ‰ä¸‰ç§å€¼ï¼š //nil: entryå·²è¢«åˆ é™¤äº†ï¼Œå¹¶ä¸”m.dirtyä¸ºnil //expunged: entryå·²è¢«åˆ é™¤äº†ï¼Œå¹¶ä¸”m.dirtyä¸ä¸ºnilï¼Œè€Œä¸”è¿™ä¸ªentryä¸å­˜åœ¨äºŽm.dirtyä¸­ //å…¶å®ƒï¼š entryæ˜¯ä¸€ä¸ªæ­£å¸¸çš„å€¼ p unsafe.Pointer // *interface&#123;&#125;&#125; Value1234567891011// A Value provides an atomic load and store of a consistently typed value.// Values can be created as part of other data structures.// The zero value for a Value returns nil from Load.// Once Store has been called, a Value must not be copied.//// A Value must not be copied after first use.type Value struct &#123; noCopy noCopy v interface&#123;&#125;&#125; Loadæ®æŒ‡å®šçš„key,æŸ¥æ‰¾å¯¹åº”çš„å€¼value,å¦‚æžœä¸å­˜åœ¨ï¼Œé€šè¿‡okåæ˜ ã€‚ 123456789101112131415161718192021222324252627282930313233343536func (m *Map) Load(key interface&#123;&#125;) (value interface&#123;&#125;, ok bool) &#123; read, _ := m.read.Load().(readOnly) e, ok := read.m[key] // å¦‚æžœæ²¡æ‰¾åˆ°ï¼Œå¹¶ä¸”m.dirtyä¸­æœ‰æ–°æ•°æ®ï¼Œéœ€è¦ä»Žm.dirtyæŸ¥æ‰¾ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦åŠ é” if !ok &amp;&amp; read.amended &#123; m.mu.Lock() // Avoid reporting a spurious miss if m.dirty got promoted while we were // blocked on m.mu. (If further loads of the same key will not miss, it&apos;s // not worth copying the dirty map for this key.) //double check,é¿å…åŠ é”çš„æ—¶å€™m.dirtyæå‡ä¸ºm.read,è¿™ä¸ªæ—¶å€™m.readå¯èƒ½è¢«æ›¿æ¢äº†ã€‚ read, _ = m.read.Load().(readOnly) e, ok = read.m[key] if !ok &amp;&amp; read.amended &#123; e, ok = m.dirty[key] // Regardless of whether the entry was present, record a miss: this key // will take the slow path until the dirty map is promoted to the read // map. m.missLocked() &#125; m.mu.Unlock() &#125; if !ok &#123; return nil, false &#125; return e.load()&#125;func (m *Map) missLocked() &#123; m.misses++ if m.misses &lt; len(m.dirty) &#123; return &#125; m.read.Store(readOnly&#123;m: m.dirty&#125;) m.dirty = nil m.misses = 0&#125; Storeæ›´æ–°æˆ–è€…æ–°å¢žä¸€ä¸ªentry 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091// Store sets the value for a key.func (m *Map) Store(key, value interface&#123;&#125;) &#123; read, _ := m.read.Load().(readOnly) // ä»Ž read map ä¸­è¯»å– key æˆåŠŸå¹¶ä¸”å–å‡ºçš„ entry å°è¯•å­˜å‚¨ value æˆåŠŸï¼Œç›´æŽ¥è¿”å›ž if e, ok := read.m[key]; ok &amp;&amp; e.tryStore(&amp;value) &#123; return &#125; m.mu.Lock() read, _ = m.read.Load().(readOnly) if e, ok := read.m[key]; ok &#123; if e.unexpungeLocked() &#123;//ç¡®ä¿æœªè¢«æ ‡è®°æˆåˆ é™¤ï¼Œå³e æŒ‡å‘çš„æ˜¯éž nil çš„ // The entry was previously expunged, which implies that there is a // non-nil dirty map and this entry is not in it. //m.dirtyä¸­ä¸å­˜åœ¨è¿™ä¸ªé”®ï¼Œæ‰€ä»¥åŠ å…¥m.dirty m.dirty[key] = e &#125; e.storeLocked(&amp;value) &#125; else if e, ok := m.dirty[key]; ok &#123; e.storeLocked(&amp;value) &#125; else &#123; if !read.amended &#123; // We&apos;re adding the first new key to the dirty map. // Make sure it is allocated and mark the read-only map as incomplete. m.dirtyLocked() m.read.Store(readOnly&#123;m: read.m, amended: true&#125;) &#125; m.dirty[key] = newEntry(value) &#125; m.mu.Unlock()&#125;// tryStore stores a value if the entry has not been expunged.//// If the entry is expunged, tryStore returns false and leaves the entry// unchanged.func (e *entry) tryStore(i *interface&#123;&#125;) bool &#123; p := atomic.LoadPointer(&amp;e.p) if p == expunged &#123; return false &#125; for &#123; if atomic.CompareAndSwapPointer(&amp;e.p, p, unsafe.Pointer(i)) &#123; return true &#125; p = atomic.LoadPointer(&amp;e.p) if p == expunged &#123; return false &#125; &#125;&#125;func (m *Map) dirtyLocked() &#123; if m.dirty != nil &#123; return &#125; read, _ := m.read.Load().(readOnly) m.dirty = make(map[interface&#123;&#125;]*entry, len(read.m)) for k, e := range read.m &#123; if !e.tryExpungeLocked() &#123; m.dirty[k] = e &#125; &#125;&#125;func (e *entry) tryExpungeLocked() (isExpunged bool) &#123; p := atomic.LoadPointer(&amp;e.p) for p == nil &#123; // å°†å·²ç»åˆ é™¤æ ‡è®°ä¸ºnilçš„æ•°æ®æ ‡è®°ä¸ºexpunged if atomic.CompareAndSwapPointer(&amp;e.p, nil, expunged) &#123; return true &#125; p = atomic.LoadPointer(&amp;e.p) &#125; return p == expunged&#125;// unexpungeLocked ensures that the entry is not marked as expunged.// If the entry was previously expunged, it must be added to the dirty map// before m.mu is unlocked.// unexpungeLocked å‡½æ•°ç¡®ä¿äº† entry æ²¡æœ‰è¢«æ ‡è®°æˆå·²è¢«æ¸…é™¤ã€‚// å¦‚æžœ entry å…ˆå‰è¢«æ¸…é™¤è¿‡äº†ï¼Œé‚£ä¹ˆåœ¨ mutex è§£é”ä¹‹å‰ï¼Œå®ƒä¸€å®šè¦è¢«åŠ å…¥åˆ° dirty map ä¸­//å¦‚æžœ entry çš„ unexpungeLocked è¿”å›žä¸º trueï¼Œé‚£ä¹ˆå°±è¯´æ˜Ž entry //ä¹‹å‰è¢«æ ‡è®°æˆäº† expungedï¼Œå¹¶ç»è¿‡ CAS æ“ä½œæˆåŠŸæŠŠå®ƒç½®ä¸º nilã€‚func (e *entry) unexpungeLocked() (wasExpunged bool) &#123; return atomic.CompareAndSwapPointer(&amp;e.p, expunged, nil)&#125; Deleteåˆ é™¤ä¸€ä¸ªé”®å€¼ 12345678910111213141516171819202122232425262728293031// Delete deletes the value for a key.func (m *Map) Delete(key interface&#123;&#125;) &#123; read, _ := m.read.Load().(readOnly) e, ok := read.m[key] if !ok &amp;&amp; read.amended &#123; m.mu.Lock() read, _ = m.read.Load().(readOnly) e, ok = read.m[key] if !ok &amp;&amp; read.amended &#123; delete(m.dirty, key) &#125; m.mu.Unlock() &#125; if ok &#123; e.delete() &#125;&#125;func (e *entry) delete() (hadValue bool) &#123; for &#123; p := atomic.LoadPointer(&amp;e.p) // å·²æ ‡è®°ä¸ºåˆ é™¤ if p == nil || p == expunged &#123; return false &#125; // åŽŸå­æ“ä½œï¼Œe.pæ ‡è®°ä¸ºnil if atomic.CompareAndSwapPointer(&amp;e.p, p, nil) &#123; return true &#125; &#125;&#125; ç–‘é—®å·²ç»åˆ é™¤çš„key,å†æ¬¡Loadçš„æ—¶å€™ï¼Œä¼šæ€Žä¹ˆæ ·ï¼Ÿ1234567func (e *entry) load() (value interface&#123;&#125;, ok bool) &#123; p := atomic.LoadPointer(&amp;e.p) if p == nil || p == expunged &#123; return nil, false &#125; return *(*interface&#123;&#125;)(p), true&#125; åœ¨Map Loadæ–¹æ³•ä¸­è°ƒç”¨e.load()æ—¶ï¼Œloadæ–¹æ³•ä¼šè¯†åˆ«è¯¥å€¼æ˜¯å¦å·²è¢«åˆ é™¤ Referencehttps://studygolang.com/articles/10511http://www.jianshu.com/p/43e66dab535b]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>Sync</tag>
        <tag>Map</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºŽSpring AOPä¸ŽIOCçš„ä¸ªäººæ€è€ƒ]]></title>
    <url>%2Fspring-aop-ioc-think.html</url>
    <content type="text"><![CDATA[åœ¨é˜…è¯»æœ¬æ–‡å‰ï¼Œå¼ºçƒˆå»ºè®®é˜…è¯»ï¼šJava JDK åŠ¨æ€ä»£ç†ï¼ˆAOPï¼‰ä½¿ç”¨åŠå®žçŽ°åŽŸç†åˆ†æž AOPæ˜¯Springæä¾›çš„å…³é”®ç‰¹æ€§ä¹‹ä¸€ã€‚AOPå³é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯OOPç¼–ç¨‹çš„æœ‰æ•ˆè¡¥å……ã€‚ä½¿ç”¨AOPæŠ€æœ¯ï¼Œå¯ä»¥å°†ä¸€äº›ç³»ç»Ÿæ€§ç›¸å…³çš„ç¼–ç¨‹å·¥ä½œï¼Œç‹¬ç«‹æå–å‡ºæ¥ï¼Œç‹¬ç«‹å®žçŽ°ï¼Œç„¶åŽé€šè¿‡åˆ‡é¢åˆ‡å…¥è¿›ç³»ç»Ÿã€‚ä»Žè€Œé¿å…äº†åœ¨ä¸šåŠ¡é€»è¾‘çš„ä»£ç ä¸­æ··å…¥å¾ˆå¤šçš„ç³»ç»Ÿç›¸å…³çš„é€»è¾‘â€”â€”æ¯”å¦‚æƒé™ç®¡ç†ï¼Œäº‹ç‰©ç®¡ç†ï¼Œæ—¥å¿—è®°å½•ç­‰ç­‰ã€‚è¿™äº›ç³»ç»Ÿæ€§çš„ç¼–ç¨‹å·¥ä½œéƒ½å¯ä»¥ç‹¬ç«‹ç¼–ç å®žçŽ°ï¼Œç„¶åŽé€šè¿‡AOPæŠ€æœ¯åˆ‡å…¥è¿›ç³»ç»Ÿå³å¯ã€‚ä»Žè€Œè¾¾åˆ°äº†å°†ä¸åŒçš„å…³æ³¨ç‚¹åˆ†ç¦»å‡ºæ¥çš„æ•ˆæžœã€‚æœ¬æ–‡æ·±å…¥å‰–æžSpringçš„AOPçš„åŽŸç†ã€‚ ä¸€ã€AOP çš„å®žçŽ°åŽŸç†AOPåˆ†ä¸ºé™æ€AOPå’ŒåŠ¨æ€AOPã€‚ é™æ€AOPæ˜¯æŒ‡AspectJå®žçŽ°çš„AOPï¼Œä»–æ˜¯å°†åˆ‡é¢ä»£ç ç›´æŽ¥ç¼–è¯‘åˆ°Javaç±»æ–‡ä»¶ä¸­ã€‚ åŠ¨æ€AOPæ˜¯æŒ‡å°†åˆ‡é¢ä»£ç è¿›è¡ŒåŠ¨æ€ç»‡å…¥å®žçŽ°çš„AOPã€‚ Springçš„AOPä¸ºåŠ¨æ€AOPï¼Œå®žçŽ°çš„æŠ€æœ¯ä¸ºï¼šJDKæä¾›çš„åŠ¨æ€ä»£ç†æŠ€æœ¯ å’Œ CGLIB(åŠ¨æ€å­—èŠ‚ç å¢žå¼ºæŠ€æœ¯)ã€‚å°½ç®¡å®žçŽ°æŠ€æœ¯ä¸ä¸€æ ·ï¼Œä½†éƒ½æ˜¯åŸºäºŽä»£ç†æ¨¡å¼ï¼Œéƒ½æ˜¯ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚ 1ã€JDKåŠ¨æ€ä»£ç†JDKéƒ¨åˆ†è§£æžå‚è€ƒï¼šJava JDK åŠ¨æ€ä»£ç†ï¼ˆAOPï¼‰ä½¿ç”¨åŠå®žçŽ°åŽŸç†åˆ†æž 2ã€CGLIBï¼ˆcode generate libaryï¼‰å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯å®žçŽ°AOPï¼Œå…¶å®žå°±æ˜¯ç»§æ‰¿è¢«ä»£ç†å¯¹è±¡ï¼Œç„¶åŽOverrideéœ€è¦è¢«ä»£ç†çš„æ–¹æ³•ï¼Œåœ¨è¦†ç›–è¯¥æ–¹æ³•æ—¶ï¼Œè‡ªç„¶æ˜¯å¯ä»¥æ’å…¥æˆ‘ä»¬è‡ªå·±çš„ä»£ç çš„ã€‚ å› ä¸ºéœ€è¦Overrideè¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œæ‰€ä»¥è‡ªç„¶CGLIBæŠ€æœ¯å®žçŽ°AOPæ—¶ï¼Œå°±å¿…é¡»è¦æ±‚éœ€è¦è¢«ä»£ç†çš„æ–¹æ³•ä¸èƒ½æ˜¯finalæ–¹æ³•ï¼Œå› ä¸ºfinalæ–¹æ³•ä¸èƒ½è¢«å­ç±»è¦†ç›–ã€‚ 12345678910111213141516171819202122232425262728package net.aazj.aop;import java.lang.reflect.Method;import net.sf.cglib.proxy.Enhancer;import net.sf.cglib.proxy.MethodInterceptor;import net.sf.cglib.proxy.MethodProxy;public class CGProxy implements MethodInterceptor&#123; private Object target; // è¢«ä»£ç†å¯¹è±¡ public CGProxy(Object target)&#123; this.target = target; &#125; public Object intercept(Object obj, java.lang.reflect.Method method, Object[] args, MethodProxy proxy) throws Throwable &#123; System.out.println(&quot;do sth before....&quot;); Object result = proxy.invokeSuper(obj, args); System.out.println(&quot;do sth after....&quot;); return result; &#125; public Object getProxyObject() &#123; Enhancer enhancer = new Enhancer(); // è®¾ç½®çˆ¶ç±» enhancer.setSuperclass(this.target.getClass()); // è®¾ç½®å›žè°ƒ enhancer.setCallback(this); // åœ¨è°ƒç”¨çˆ¶ç±»æ–¹æ³•æ—¶ï¼Œå›žè°ƒ this.intercept() // åˆ›å»ºä»£ç†å¯¹è±¡ return enhancer.create(); &#125;&#125; æµ‹è¯•ï¼š 123456789101112131415161718192021222324252627public interface UserService &#123; public void addUser(User user); public User getUser(int id);&#125;public class UserServiceImpl implements UserService &#123; public void addUser(User user) &#123; System.out.println(&quot;add user into database.&quot;); &#125; public User getUser(int id) &#123; User user = new User(); user.setId(id); System.out.println(&quot;getUser from database.&quot;); return user; &#125;&#125;public class CGProxyTest &#123; public static void main(String[] args)&#123; // è¢«ä»£ç†çš„å¯¹è±¡ Object proxyedObject = new UserServiceImpl(); CGProxy cgProxy = new CGProxy(proxyedObject); UserService proxyObject = (UserService) cgProxy.getProxyObject(); proxyObject.getUser(1); proxyObject.addUser(new User()); &#125;&#125; è¾“å‡ºç»“æžœï¼š 123456do sth before....getUser from database.do sth after....do sth before....add user into database.do sth after.... å®ƒçš„åŽŸç†æ˜¯ï¼šç”Ÿæˆä¸€ä¸ªçˆ¶ç±»enhancer.setSuperclass(this.target.getClass())çš„å­ç±»enhancer.create(),ç„¶åŽå¯¹çˆ¶ç±»çš„æ–¹æ³•è¿›è¡Œæ‹¦æˆªenhancer.setCallback(this). äºŒã€æ€è€ƒä»Žä»¥ä¸Šä¸¤ç§ä»£ç†æ–¹å¼å¯ä»¥çœ‹å‡ºï¼Œå®žçŽ°AOPçš„å…³é”®æ˜¯ï¼šåŠ¨æ€ä»£ç†ï¼Œå³å°†éœ€è¦ç”¨çš„æŽ¥å£ã€ç±»å†åŒ…è£…ä¸€å±‚ï¼Œé€šè¿‡åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç æ–‡ä»¶å®žçŽ°å„ç§æ‹¦æˆªä¸Žé€šçŸ¥ã€‚ æ³¨æ„ï¼Œä¸¤è€…(JDKåŠ¨æ€ä»£ç†ã€CGLIB)éƒ½éœ€è¦ï¼šè¦ä»£ç†çœŸå®žå¯¹è±¡çš„å®žä¾‹ã€‚ æ¯”å¦‚ï¼šåœ¨Spring MVCçš„Controllerå±‚ä¸€èˆ¬@Autowiredæ˜¯ServiceæŽ¥å£ï¼Œä½†å¸¦æœ‰@Serviceæ ‡è¯†çš„å´æ˜¯å®žçŽ°ServiceæŽ¥å£çš„å®žä½“ç±»ï¼Œè¿™æ ·å¯¹äºŽJDKåŠ¨æ€ä»£ç†æ¥è¯´å·²ç»è¶³ä»¥ç”Ÿæˆä»£ç†ç±»äº†(å…¶å®žï¼Œä¸è¿‡æ˜¯cglibè¿˜æ˜¯jdkçš„åŠ¨æ€ä»£ç†ï¼Œä½ ç›´æŽ¥@Autowired ServiceæŽ¥å£å®žçŽ°ç±»ï¼Œä¹Ÿæ˜¯å¯ä»¥æ³¨å…¥æˆåŠŸçš„ï¼Œä½†ä¸å¦‚æ³¨å…¥ServiceæŽ¥å£çµæ´»)ï¼Œå¤§å®¶åœ¨è·Ÿè¸ªä»£ç çš„æ—¶å€™å¯ä»¥çœ‹ä¸€ä¸‹Springæ³¨å…¥çš„beançœŸæ­£çš„ç±»åž‹ï¼Œä½ å°±å¯ä»¥å‘çŽ°å®ƒæ˜¯ä»£ç†ç”Ÿæˆçš„å®žä¾‹ã€‚ æ¯”å¦‚è¿™ç§ï¼š å¸¦æœ‰æ³¨è§£æ ‡è¯†çš„æŽ¥å£æˆ–è€…åœ¨Spring.XMLä¸­é…ç½®çš„beanä¼šåœ¨Springåˆå§‹åŒ–çš„æ—¶å€™ï¼Œè¢«Springé€šè¿‡åå°„åŠ è½½å®žä¾‹åŒ–åˆ°Springå®¹å™¨ä¸­ã€‚ åšè¿‡Client/Serveræž¶æž„å¼€å‘çš„æœ‹å‹åº”è¯¥çŸ¥é“ï¼Œåœ¨Applicationè¿è¡Œè¿‡ç¨‹ä¸­ä¸€èˆ¬éƒ½ä¼šæœ‰ä¸€ä¸ªåº”ç”¨ä¸Šä¸‹æ–‡Contextï¼Œä¸€èˆ¬å°†ä¸€äº›ç³»ç»Ÿä¿¡æ¯æ”¾åœ¨é‡Œé¢ï¼Œæ¯”å¦‚ä¸€äº›ç™»å½•ä¿¡æ¯ã€WCFè¿žæŽ¥å®žä¾‹ç­‰ã€‚è¿™äº›ä¿¡æ¯åœ¨ç³»ç»Ÿçš„ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥å–åˆ°ï¼ˆå…¶å®žå°±æ˜¯ä¸€äº›é¡¶çº§å˜é‡é›†åˆï¼Œç”Ÿå‘½å‘¨æœŸæœ€é•¿çš„ä¸€äº›å®¶ä¼™ï¼‰ã€‚ æ¢ä¸ªè§’åº¦æƒ³ä¸€ä¸‹ï¼Œå¦‚æžœæˆ‘ä»¬åœ¨Applicationåˆå§‹åŒ–çš„æ—¶å€™ï¼Œç”¨åå°„ï¼ˆèŽ·å–è¦ä»£ç†å¯¹è±¡çš„å®žä¾‹ï¼‰å’ŒåŠ¨æ€ä»£ç†èŽ·å–æœ‰æ³¨è§£æ ‡è¯†æˆ–è€…åœ¨xmlä¸­é…ç½®beançš„å®žä¾‹ï¼Œå¹¶æ”¾åˆ°åº”ç”¨ä¸Šä¸‹æ–‡Contextä¸­ï¼Œåœ¨éœ€è¦çš„åœ°æ–¹éƒ½èƒ½å–åˆ°ï¼Œè¿™ä¸å°±æ˜¯ä¸€ä¸ªç®€å•ç‰ˆçš„Spring å®¹å™¨å—ï¼Ÿ]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>JDK</tag>
        <tag>Spring</tag>
        <tag>AOP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java HashMap]]></title>
    <url>%2Fjava-hashmap.html</url>
    <content type="text"><![CDATA[ä»£ç åŸºäºŽ Jdk1.8 æœ€è¿‘åœ¨å·¥ä½œç”¨åˆ°Mapç­‰ä¸€ç³»åˆ—çš„é›†åˆï¼ŒäºŽæ˜¯ï¼Œæƒ³ä»”ç»†çœ‹ä¸€ä¸‹å…¶å…·ä½“å®žçŽ°ã€‚ ç»“æž„12public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable æŠ½è±¡ç±»AbstractMap1public abstract class AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt; è¯¥ç±»å®žçŽ°äº†MapæŽ¥å£ï¼Œå…·ä½“ç»“æž„å¦‚ä¸‹ï¼šè¯¥ç±»ä»£ç å¾ˆç®€å•ï¼Œä¸å†èµ˜è¿°ã€‚ åºåˆ—åŒ–æŽ¥å£ï¼šSerializableè¯¥æŽ¥å£æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œä½†é€šè¿‡è¯¥æŽ¥å£ï¼Œå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆHashMapæ€»ä¸€äº›å­—æ®µæ˜¯ç”¨transientæ¥ä¿®é¥°ã€‚ ä¸€æ—¦å˜é‡è¢«transientä¿®é¥°ï¼Œå˜é‡å°†ä¸å†æ˜¯å¯¹è±¡æŒä¹…åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥å˜é‡å†…å®¹åœ¨åºåˆ—åŒ–åŽæ— æ³•èŽ·å¾—è®¿é—®ã€‚ é˜…è¯»JDKä¸­ç±»æ³¨é‡ŠHashMapæ˜¯æ— åºçš„å¦‚æžœå¸Œæœ›ä¿æŒå…ƒç´ çš„è¾“å…¥é¡ºåºåº”è¯¥ä½¿ç”¨LinkedHashMap é™¤äº†éžåŒæ­¥å’Œå…è®¸ä½¿ç”¨nullä¹‹å¤–ï¼ŒHashMapä¸ŽHashtableåŸºæœ¬ä¸€è‡´ã€‚æ­¤å¤„çš„éžåŒæ­¥æŒ‡çš„æ˜¯å¤šçº¿ç¨‹è®¿é—®ï¼Œå¹¶è‡³å°‘ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹HashMapç»“æž„ã€‚ç»“æž„ä¿®æ”¹åŒ…æ‹¬ä»»ä½•æ–°å¢žã€åˆ é™¤æ˜ å°„ï¼Œä½†ä»…ä»…ä¿®æ”¹HashMapä¸­å·²å­˜åœ¨é¡¹å€¼å¾—æ“ä½œä¸å±žäºŽç»“æž„ä¿®æ”¹ã€‚ åˆå§‹å®¹é‡ä¸ŽåŠ è½½å› å­æ˜¯å½±å“HashMapçš„ä¸¤ä¸ªé‡è¦å› ç´ ã€‚1public HashMap(int initialCapacity, float loadFactor) åˆå§‹å®¹é‡é»˜è®¤å€¼ï¼š 1234/** * The default initial capacity - MUST be a power of two. */static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16 åŠ è½½å› å­é»˜è®¤å€¼ï¼š 1234/** * The load factor used when none specified in constructor. */static final float DEFAULT_LOAD_FACTOR = 0.75f; å®¹é‡æ˜¯HashMapåœ¨åˆ›å»ºæ—¶â€œæ¡¶â€çš„æ•°é‡ï¼Œè€Œåˆå§‹å®¹é‡æ˜¯å“ˆå¸Œè¡¨åœ¨åˆ›å»ºæ—¶åˆ†é…çš„ç©ºé—´å¤§å°ã€‚åŠ è½½å› å­æ˜¯å“ˆå¸Œè¡¨åœ¨å…¶å®¹é‡è‡ªåŠ¨å¢žåŠ æ—¶èƒ½è¾¾åˆ°å¤šæ»¡çš„è¡¡é‡å°ºåº¦ï¼ˆæ¯”å¦‚é»˜è®¤ä¸º0.75ï¼Œå³æ¡¶ä¸­æ•°æ®è¾¾åˆ°3/4å°±ä¸èƒ½å†æ”¾æ•°æ®äº†ï¼‰ã€‚ é»˜è®¤çš„è´Ÿè½½å› å­å¤§å°ä¸º0.75ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ªmapå¡«æ»¡äº†75%çš„bucketæ—¶å€™ï¼Œå’Œå…¶å®ƒé›†åˆç±»(å¦‚ArrayListç­‰)ä¸€æ ·ï¼Œå°†ä¼šåˆ›å»ºåŽŸæ¥HashMapå¤§å°çš„ä¸¤å€çš„bucketæ•°ç»„ï¼Œæ¥é‡æ–°è°ƒæ•´mapçš„å¤§å°ï¼Œå¹¶å°†åŽŸæ¥çš„å¯¹è±¡æ”¾å…¥æ–°çš„bucketæ•°ç»„ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹å«ä½œrehashingï¼Œå› ä¸ºå®ƒè°ƒç”¨hashæ–¹æ³•æ‰¾åˆ°æ–°çš„bucketä½ç½®ã€‚å½“é‡æ–°è°ƒæ•´HashMapå¤§å°çš„æ—¶å€™ï¼Œä¼šå­˜åœ¨æ¡ä»¶ç«žäº‰ï¼Œå› ä¸ºå¦‚æžœä¸¤ä¸ªçº¿ç¨‹éƒ½å‘çŽ°HashMapéœ€è¦é‡æ–°è°ƒæ•´å¤§å°äº†ï¼Œå®ƒä»¬ä¼šåŒæ—¶è¯•ç€è°ƒæ•´å¤§å°ã€‚åœ¨è°ƒæ•´å¤§å°çš„è¿‡ç¨‹ä¸­ï¼Œå­˜å‚¨åœ¨é“¾è¡¨ä¸­çš„å…ƒç´ çš„æ¬¡åºä¼šåè¿‡æ¥ï¼Œå› ä¸ºç§»åŠ¨åˆ°æ–°çš„bucketä½ç½®çš„æ—¶å€™ï¼ŒHashMapå¹¶ä¸ä¼šå°†å…ƒç´ æ”¾åœ¨é“¾è¡¨çš„å°¾éƒ¨ï¼Œè€Œæ˜¯æ”¾åœ¨å¤´éƒ¨ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å°¾éƒ¨éåŽ†(tail traversing)ã€‚å¦‚æžœæ¡ä»¶ç«žäº‰å‘ç”Ÿäº†ï¼Œé‚£ä¹ˆå°±æ­»å¾ªçŽ¯äº†ã€‚æ‰€ä»¥ HashMapåº”è¯¥é¿å…åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ä½¿ç”¨ã€‚ é»˜è®¤0.75è¿™æ˜¯æ—¶é—´å’Œç©ºé—´æˆæœ¬ä¸Šä¸€ç§æŠ˜è¡·ï¼šå¢žå¤§è´Ÿè½½å› å­å¯ä»¥å‡å°‘ Hash è¡¨ï¼ˆå°±æ˜¯é‚£ä¸ª Entry æ•°ç»„ï¼‰æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œä½†ä¼šå¢žåŠ æŸ¥è¯¢æ•°æ®çš„æ—¶é—´å¼€é”€ï¼Œè€ŒæŸ¥è¯¢æ˜¯æœ€é¢‘ç¹çš„çš„æ“ä½œï¼ˆHashMap çš„ get() ä¸Ž put() æ–¹æ³•éƒ½è¦ç”¨åˆ°æŸ¥è¯¢ï¼‰ï¼›å‡å°è´Ÿè½½å› å­ä¼šæé«˜æ•°æ®æŸ¥è¯¢çš„æ€§èƒ½ï¼Œä½†ä¼šå¢žåŠ  Hash è¡¨æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ å­˜å‚¨å½¢å¼é“¾è¡¨å½¢å¼å­˜å‚¨ï¼Ÿæ ‘å½¢ç»“æž„ï¼Ÿ 123456* This map usually acts as a binned (bucketed) hash table, but* when bins get too large, they are transformed into bins of* TreeNodes, each structured similarly to those in* java.util.TreeMap. Most methods try to use normal bins, but* relay to TreeNode methods when applicable (simply by checking* instanceof a node). æºç é˜…è¯»æ·»åŠ å…ƒç´ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879/** * Associates the specified value with the specified key in this map. * If the map previously contained a mapping for the key, the old * value is replaced. * * @param key key with which the specified value is to be associated * @param value value to be associated with the specified key * @return the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or * &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;. * (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map * previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.) */ public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true); &#125; /** * Implements Map.put and related methods * * @param hash hash for key * @param key the key * @param value the value to put * @param onlyIfAbsent if true, don&apos;t change existing value * @param evict if false, the table is in creation mode. * @return previous value, or null if none */ final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; //hashmapç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ ï¼Œè°ƒç”¨resize()æ–¹æ³•åˆå§‹åŒ–table if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; //é€šè¿‡ä¸Žè¿ç®—åˆ¤æ–­tab[hash]ä½ç½®æ˜¯å¦æœ‰å€¼ //ä»ŽnewNodeè¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œhashmapä¸­key valueæ˜¯ä»¥Node&lt;K,V&gt;å®žä¾‹çš„å½¢å¼å­˜æ”¾çš„ if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); //tab[i]æœ‰å…ƒç´ ï¼Œåˆ™éœ€è¦éåŽ†ç»“ç‚¹åŽå†æ·»åŠ  else &#123; Node&lt;K,V&gt; e; K k; // hashã€keyå‡ç­‰ï¼Œè¯´æ˜Žå¾…æ’å…¥å…ƒç´ å’Œç¬¬ä¸€ä¸ªå…ƒç´ ç›¸ç­‰ï¼Œç›´æŽ¥æ›´æ–° if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; else if (p instanceof TreeNode)//å¦‚æžœpç±»åž‹ä¸ºTreeNodeï¼Œè°ƒç”¨æ ‘çš„æ·»åŠ å…ƒç´ æ–¹æ³•(çº¢é»‘æ ‘å†²çªæ’å…¥) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); else &#123; //ä¸æ˜¯TreeNode,å³ä¸ºé“¾è¡¨,éåŽ†é“¾è¡¨ï¼ŒæŸ¥æ‰¾ç»™å®šå…³é”®å­— for (int binCount = 0; ; ++binCount) &#123; if ((e = p.next) == null) &#123; //åˆ°è¾¾é“¾è¡¨çš„å°¾ç«¯ä¹Ÿæ²¡æœ‰æ‰¾åˆ°keyå€¼ç›¸åŒçš„èŠ‚ç‚¹ï¼Œåˆ™ç”Ÿæˆä¸€ä¸ªæ–°çš„Node p.next = newNode(hash, key, value, null); //åˆ›å»ºæ–°èŠ‚ç‚¹åŽè‹¥è¶…å‡ºæ ‘å½¢åŒ–é˜ˆå€¼ï¼Œåˆ™è½¬æ¢ä¸ºæ ‘å½¢å­˜å‚¨ if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash);//å½“æ¡¶ä¸­é“¾è¡¨çš„æ•°é‡&gt;=9çš„æ—¶å€™ï¼Œåº•å±‚åˆ™æ”¹ä¸ºçº¢é»‘æ ‘å®žçŽ° break; &#125; //å¦‚æžœæ‰¾åˆ°å…³é”®å­—ç›¸åŒçš„ç»“ç‚¹ if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; //æ›´æ–°pæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ p = e; &#125; &#125; // eä¸ä¸ºç©ºï¼Œå³mapä¸­å­˜åœ¨è¦æ·»åŠ çš„å…³é”®å­— if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount; if (++size &gt; threshold) resize();//æ‰©å®¹ afterNodeInsertion(evict); return null; &#125; å°æ³¨ï¼š1ã€å›žè°ƒ 12afterNodeAccess(e);afterNodeInsertion(evict); æ˜¯ä¸ºLinkedHashMapå›žè°ƒå‡†å¤‡çš„ã€‚2ã€è®¡ç®—hashå€¼ 1234567891011121314151617181920 /** * Computes key.hashCode() and spreads (XORs) higher bits of hash * to lower. Because the table uses power-of-two masking, sets of * hashes that vary only in bits above the current mask will * always collide. (Among known examples are sets of Float keys * holding consecutive whole numbers in small tables.) So we * apply a transform that spreads the impact of higher bits * downward. There is a tradeoff between speed, utility, and * quality of bit-spreading. Because many common sets of hashes * are already reasonably distributed (so don&apos;t benefit from * spreading), and because we use trees to handle large sets of * collisions in bins, we just XOR some shifted bits in the * cheapest possible way to reduce systematic lossage, as well as * to incorporate impact of the highest bits that would otherwise * never be used in index calculations because of table bounds. */static final int hash(Object key) &#123; int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125; â€˜&gt;&gt;&gt;â€™ï¼šæ— ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥0è¡¥é½ value &gt;&gt;&gt; num â€“ num æŒ‡å®šè¦ç§»ä½å€¼value ç§»åŠ¨çš„ä½æ•°ã€‚ å³æŒ‰äºŒè¿›åˆ¶å½¢å¼æŠŠæ‰€æœ‰çš„æ•°å­—å‘å³ç§»åŠ¨å¯¹åº”ä½æ•°ï¼Œä½Žä½ç§»å‡ºï¼ˆèˆå¼ƒï¼‰ï¼Œé«˜ä½çš„ç©ºä½è¡¥é›¶ã€‚å¯¹äºŽæ­£æ•°æ¥è¯´å’Œå¸¦ç¬¦å·å³ç§»ç›¸åŒï¼Œå¯¹äºŽè´Ÿæ•°æ¥è¯´ä¸åŒã€‚ ^å¼‚æˆ–ï¼šä¸¤ä¸ªæ“ä½œæ•°çš„ä½ä¸­ï¼Œç›¸åŒåˆ™ç»“æžœä¸º0ï¼Œä¸åŒåˆ™ç»“æžœä¸º1ã€‚ è¿™ä¹Ÿæ­£å¥½è§£é‡Šäº†ä¸ºä»€ä¹ˆHashMapåº•å±‚æ•°ç»„çš„é•¿åº¦æ€»æ˜¯ 2 çš„ n æ¬¡æ–¹ã€‚å› ä¸ºè¿™æ ·ï¼ˆæ•°ç»„é•¿åº¦-1ï¼‰æ­£å¥½ç›¸å½“äºŽä¸€ä¸ªâ€œä½Žä½æŽ©ç â€ã€‚â€œå¼‚æˆ–â€æ“ä½œçš„ç»“æžœå°±æ˜¯æ•£åˆ—å€¼çš„é«˜ä½å…¨éƒ¨å½’é›¶ï¼Œåªä¿ç•™ä½Žä½å€¼ï¼Œç”¨æ¥åšæ•°ç»„ä¸‹æ ‡è®¿é—®ã€‚ä»¥åˆå§‹é•¿åº¦16ä¸ºä¾‹ï¼Œ16-1=15ã€‚2è¿›åˆ¶è¡¨ç¤ºæ˜¯00000000 00000000 00001111ã€‚å’ŒæŸhashå€¼åšâ€œå¼‚æˆ–â€æ“ä½œå¦‚ä¸‹ï¼Œç»“æžœå°±æ˜¯æˆªå–äº†æœ€ä½Žçš„å››ä½å€¼ã€‚ 123410100101 11000100 0010010100000000 00000000 00001111----------------------------------00000000 00000000 00000101 //é«˜ä½å…¨éƒ¨å½’é›¶ï¼Œåªä¿ç•™æœ«å››ä½ æ›´è¯¦ç»†çš„æ­¥éª¤å¦‚ä¸‹ï¼š 3ã€å­˜å‚¨ç»“æž„ èŽ·å–å…ƒç´ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152/** * Returns the value to which the specified key is mapped, * or &#123;@code null&#125; if this map contains no mapping for the key. * * &lt;p&gt;More formally, if this map contains a mapping from a key * &#123;@code k&#125; to a value &#123;@code v&#125; such that &#123;@code (key==null ? k==null : * key.equals(k))&#125;, then this method returns &#123;@code v&#125;; otherwise * it returns &#123;@code null&#125;. (There can be at most one such mapping.) * * &lt;p&gt;A return value of &#123;@code null&#125; does not &lt;i&gt;necessarily&lt;/i&gt; * indicate that the map contains no mapping for the key; it&apos;s also * possible that the map explicitly maps the key to &#123;@code null&#125;. * The &#123;@link #containsKey containsKey&#125; operation may be used to * distinguish these two cases. * * @see #put(Object, Object) */ public V get(Object key) &#123; Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? null : e.value; &#125; /** * Implements Map.get and related methods * * @param hash hash for key * @param key the key * @return the node, or null if none */ final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; //hash &amp; length-1 å®šä½æ•°ç»„ä¸‹æ ‡ (first = tab[(n - 1) &amp; hash]) != null) &#123; if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; if ((e = first.next) != null) &#123; //ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯TreeNode,åˆ™é‡‡ç”¨ä½æ¡¶+çº¢é»‘æ ‘ç»“æž„ï¼Œ //è°ƒç”¨TreeNode.getTreeNode(hash,key), //éåŽ†çº¢é»‘æ ‘ï¼Œå¾—åˆ°èŠ‚ç‚¹çš„value if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; return null; &#125; æ ‘èŠ‚ç‚¹çš„æŸ¥æ‰¾ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041/** * Calls find for root node. */final TreeNode&lt;K,V&gt; getTreeNode(int h, Object k) &#123; return ((parent != null) ? root() : this).find(h, k, null);&#125;/** * Finds the node starting at root p with the given hash and key. * The kc argument caches comparableClassFor(key) upon first use * comparing keys. *é€šè¿‡hashå€¼çš„æ¯”è¾ƒï¼Œé€’å½’çš„åŽ»éåŽ†çº¢é»‘æ ‘ï¼Œ compareableClassFor(Class k)ï¼šåˆ¤æ–­å®žä¾‹kå¯¹åº”çš„ç±»æ˜¯å¦å®žçŽ°äº†ComparableæŽ¥å£ï¼Œå¦‚æžœå®žçŽ°äº†è¯¥æŽ¥å£å¹¶ åœ¨æŸäº›æ—¶å€™å¦‚æžœçº¢é»‘æ ‘èŠ‚ç‚¹çš„å…ƒç´ are of the same &quot;class C implements Comparable&lt;C&gt;&quot; type *åˆ©ç”¨ä»–ä»¬çš„compareTo()æ–¹æ³•æ¥æ¯”è¾ƒå¤§å°ï¼Œè¿™é‡Œéœ€è¦é€šè¿‡åå°„æœºåˆ¶æ¥checkä»–ä»¬åˆ°åº•æ˜¯ä¸æ˜¯å±žäºŽåŒä¸€ä¸ªç±»,æ˜¯ä¸æ˜¯å…·æœ‰å¯æ¯”è¾ƒæ€§. */final TreeNode&lt;K,V&gt; find(int h, Object k, Class&lt;?&gt; kc) &#123; TreeNode&lt;K,V&gt; p = this; do &#123; int ph, dir; K pk; TreeNode&lt;K,V&gt; pl = p.left, pr = p.right, q; if ((ph = p.hash) &gt; h) p = pl; else if (ph &lt; h) p = pr; else if ((pk = p.key) == k || (k != null &amp;&amp; k.equals(pk))) return p; else if (pl == null) p = pr; else if (pr == null) p = pl; else if ((kc != null || (kc = comparableClassFor(k)) != null) &amp;&amp; (dir = compareComparables(kc, k, pk)) != 0) p = (dir &lt; 0) ? pl : pr; else if ((q = pr.find(h, k, kc)) != null) return q; else p = pl; &#125; while (p != null); return null;&#125; å…ƒç´ åŒ…å«containsKey1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889/** * Returns &lt;tt&gt;true&lt;/tt&gt; if this map contains a mapping for the * specified key. * * @param key The key whose presence in this map is to be tested * @return &lt;tt&gt;true&lt;/tt&gt; if this map contains a mapping for the specified * key. */public boolean containsKey(Object key) &#123; return getNode(hash(key), key) != null;&#125;/** * Implements Map.get and related methods * * @param hash hash for key * @param key the key * @return the node, or null if none */final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; //åˆ¤æ–­tab[hash]ä½ç½®æ˜¯å¦æœ‰å€¼ (first = tab[(n - 1) &amp; hash]) != null) &#123; if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; if ((e = first.next) != null) &#123; if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); //éåŽ†å¯»æ‰¾ do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; return null;&#125; /** * Calls find for root node. */ final TreeNode&lt;K,V&gt; getTreeNode(int h, Object k) &#123; return ((parent != null) ? root() : this).find(h, k, null); &#125; /** * Returns root of tree containing this node. * èŽ·å–çº¢é»‘æ ‘çš„æ ¹ */ final TreeNode&lt;K,V&gt; root() &#123; for (TreeNode&lt;K,V&gt; r = this, p;;) &#123; if ((p = r.parent) == null) return r; r = p; &#125; &#125; /** * Finds the node starting at root p with the given hash and key. * The kc argument caches comparableClassFor(key) upon first use * comparing keys. */ final TreeNode&lt;K,V&gt; find(int h, Object k, Class&lt;?&gt; kc) &#123;// kå³keyï¼Œkcä¸ºnull TreeNode&lt;K,V&gt; p = this; do &#123; int ph, dir; K pk; TreeNode&lt;K,V&gt; pl = p.left, pr = p.right, q; if ((ph = p.hash) &gt; h)// phå­˜å½“å‰èŠ‚ç‚¹hash p = pl; else if (ph &lt; h) // æ‰€æŸ¥hashæ¯”å½“å‰èŠ‚ç‚¹hashå¤§ p = pr;// æŸ¥å³å­æ ‘ else if ((pk = p.key) == k || (k != null &amp;&amp; k.equals(pk))) return p;// hashã€keyå‡ç›¸åŒï¼Œã€æ‰¾åˆ°äº†ï¼ã€‘è¿”å›žå½“å‰èŠ‚ç‚¹ else if (pl == null)// hashç­‰ï¼Œkeyä¸ç­‰ï¼Œä¸”å½“å‰èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹null p = pr;//æŸ¥å³å­æ ‘ else if (pr == null) p = pl; //get-&gt;getTreeNodeä¼ é€’çš„kcä¸ºnullã€‚||é€»è¾‘æˆ–,çŸ­è·¯è¿ç®—,æœ‰çœŸå³å¯ // false || (false &amp;&amp; ï¼Ÿï¼Ÿ) else if ((kc != null || (kc = comparableClassFor(k)) != null) &amp;&amp; (dir = compareComparables(kc, k, pk)) != 0) p = (dir &lt; 0) ? pl : pr; else if ((q = pr.find(h, k, kc)) != null) return q; else p = pl; &#125; while (p != null); return null; &#125; ç§»é™¤remove123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174/** * Removes the mapping for the specified key from this map if present. * * @param key key whose mapping is to be removed from the map * @return the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or * &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;. * (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map * previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.) */ public V remove(Object key) &#123; Node&lt;K,V&gt; e; return (e = removeNode(hash(key), key, null, false, true)) == null ? null : e.value; &#125; /** * Implements Map.remove and related methods * * @param hash hash for key * @param key the key * @param value the value to match if matchValue, else ignored * @param matchValue if true only remove if value is equal * @param movable if false do not move other nodes while removing * @return the node, or null if none */ final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, index; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (p = tab[index = (n - 1) &amp; hash]) != null) &#123; Node&lt;K,V&gt; node = null, e; K k; V v; if (p.hash == hash &amp;&amp; //å…ˆæ¯”è¾ƒå†…å­˜åœ°å€ï¼Œå¦‚æžœåœ°å€ä¸ä¸€è‡´ï¼Œå†è°ƒç”¨equalsè¿›è¡Œæ¯”è¾ƒ ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p; else if ((e = p.next) != null) &#123; //å¦‚æžœæ˜¯ä»¥çº¢é»‘æ ‘å¤„ç†å†²çªï¼Œåˆ™é€šè¿‡getTreeNodeæŸ¥æ‰¾ if (p instanceof TreeNode) node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key); else &#123; //å¦‚æžœæ˜¯ä»¥é“¾å¼çš„æ–¹å¼å¤„ç†å†²çªï¼Œåˆ™é€šè¿‡éåŽ†é“¾è¡¨æ¥å¯»æ‰¾èŠ‚ç‚¹ do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) &#123; node = e; break; &#125; p = e; &#125; while ((e = e.next) != null); &#125; &#125; //æ¯”å¯¹æ‰¾åˆ°çš„keyçš„valueè·Ÿè¦åˆ é™¤çš„æ˜¯å¦åŒ¹é… if (node != null &amp;&amp; (!matchValue || (v = node.value) == value || (value != null &amp;&amp; value.equals(v)))) &#123; if (node instanceof TreeNode) ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable); else if (node == p) tab[index] = node.next; else p.next = node.next; //å·²ä»Žç»“æž„ä¸Šä¿®æ”¹ æ­¤åˆ—è¡¨çš„æ¬¡æ•° ++modCount; --size; //å›žè°ƒ afterNodeRemoval(node); return node; &#125; &#125; return null; &#125; /** * Removes the given node, that must be present before this call. * This is messier than typical red-black deletion code because we * cannot swap the contents of an interior node with a leaf * successor that is pinned by &quot;next&quot; pointers that are accessible * independently during traversal. So instead we swap the tree * linkages. If the current tree appears to have too few nodes, * the bin is converted back to a plain bin. (The test triggers * somewhere between 2 and 6 nodes, depending on tree structure). */ final void removeTreeNode(HashMap&lt;K,V&gt; map, Node&lt;K,V&gt;[] tab, boolean movable) &#123; int n; if (tab == null || (n = tab.length) == 0) return; int index = (n - 1) &amp; hash; TreeNode&lt;K,V&gt; first = (TreeNode&lt;K,V&gt;)tab[index], root = first, rl; TreeNode&lt;K,V&gt; succ = (TreeNode&lt;K,V&gt;)next, pred = prev; if (pred == null) tab[index] = first = succ; else pred.next = succ; if (succ != null) succ.prev = pred; if (first == null) return; if (root.parent != null) root = root.root(); if (root == null || root.right == null || (rl = root.left) == null || rl.left == null) &#123; tab[index] = first.untreeify(map); // too small return; &#125; TreeNode&lt;K,V&gt; p = this, pl = left, pr = right, replacement; if (pl != null &amp;&amp; pr != null) &#123; TreeNode&lt;K,V&gt; s = pr, sl; while ((sl = s.left) != null) // find successor s = sl; boolean c = s.red; s.red = p.red; p.red = c; // swap colors TreeNode&lt;K,V&gt; sr = s.right; TreeNode&lt;K,V&gt; pp = p.parent; if (s == pr) &#123; // p was s&apos;s direct parent p.parent = s; s.right = p; &#125; else &#123; TreeNode&lt;K,V&gt; sp = s.parent; if ((p.parent = sp) != null) &#123; if (s == sp.left) sp.left = p; else sp.right = p; &#125; if ((s.right = pr) != null) pr.parent = s; &#125; p.left = null; if ((p.right = sr) != null) sr.parent = p; if ((s.left = pl) != null) pl.parent = s; if ((s.parent = pp) == null) root = s; else if (p == pp.left) pp.left = s; else pp.right = s; if (sr != null) replacement = sr; else replacement = p; &#125; else if (pl != null) replacement = pl; else if (pr != null) replacement = pr; else replacement = p; if (replacement != p) &#123; TreeNode&lt;K,V&gt; pp = replacement.parent = p.parent; if (pp == null) root = replacement; else if (p == pp.left) pp.left = replacement; else pp.right = replacement; p.left = p.right = p.parent = null; &#125; TreeNode&lt;K,V&gt; r = p.red ? root : balanceDeletion(root, replacement); if (replacement == p) &#123; // detach TreeNode&lt;K,V&gt; pp = p.parent; p.parent = null; if (pp != null) &#123; if (p == pp.left) pp.left = null; else if (p == pp.right) pp.right = null; &#125; &#125; if (movable) moveRootToFront(tab, r); &#125; å°ç»“åœ¨åˆ›å»º HashMap æ—¶æ ¹æ®å®žé™…éœ€è¦é€‚å½“åœ°è°ƒæ•´ load factor çš„å€¼ï¼›å¦‚æžœç¨‹åºæ¯”è¾ƒå…³å¿ƒç©ºé—´å¼€é”€ã€å†…å­˜æ¯”è¾ƒç´§å¼ ï¼Œå¯ä»¥é€‚å½“åœ°å¢žåŠ è´Ÿè½½å› å­ï¼›å¦‚æžœç¨‹åºæ¯”è¾ƒå…³å¿ƒæ—¶é—´å¼€é”€ï¼Œå†…å­˜æ¯”è¾ƒå®½è£•åˆ™å¯ä»¥é€‚å½“çš„å‡å°‘è´Ÿè½½å› å­ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç¨‹åºå‘˜æ— éœ€æ”¹å˜è´Ÿè½½å› å­çš„å€¼ã€‚ å¦‚æžœå¼€å§‹å°±çŸ¥é“ HashMap ä¼šä¿å­˜å¤šä¸ª key-value å¯¹ï¼Œå¯ä»¥åœ¨åˆ›å»ºæ—¶å°±ä½¿ç”¨è¾ƒå¤§çš„åˆå§‹åŒ–å®¹é‡ï¼Œå¦‚æžœ HashMap ä¸­ Entry çš„æ•°é‡ä¸€ç›´ä¸ä¼šè¶…è¿‡æžé™å®¹é‡ï¼ˆcapacity * load factorï¼‰ï¼ŒHashMap å°±æ— éœ€è°ƒç”¨ resize() æ–¹æ³•é‡æ–°åˆ†é… table æ•°ç»„ï¼Œä»Žè€Œä¿è¯è¾ƒå¥½çš„æ€§èƒ½ã€‚å½“ç„¶ï¼Œå¼€å§‹å°±å°†åˆå§‹å®¹é‡è®¾ç½®å¤ªé«˜å¯èƒ½ä¼šæµªè´¹ç©ºé—´ï¼ˆç³»ç»Ÿéœ€è¦åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º capacity çš„ Entry æ•°ç»„ï¼‰ï¼Œå› æ­¤åˆ›å»º HashMap æ—¶åˆå§‹åŒ–å®¹é‡è®¾ç½®ä¹Ÿéœ€è¦å°å¿ƒå¯¹å¾…ã€‚ HashMapé«˜æ€§èƒ½éœ€è¦ä»¥ä¸‹å‡ ç‚¹ï¼š é«˜æ•ˆçš„hashç®—æ³• ä¿è¯hashå€¼åˆ°å†…å­˜åœ°å€ï¼ˆæ•°ç»„ç´¢å¼•ï¼‰çš„æ˜ å°„é€Ÿåº¦ æ ¹æ®å†…å­˜åœ°å€ï¼ˆæ•°ç»„ç´¢å¼•ï¼‰å¯ä»¥ç›´æŽ¥å¾—åˆ°ç›¸åº”çš„å€¼]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>HashMap</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java-JDK-åŠ¨æ€ä»£ç†ï¼ˆAOPï¼‰ä½¿ç”¨åŠå®žçŽ°åŽŸç†åˆ†æž]]></title>
    <url>%2Fjava-jdk-aop.html</url>
    <content type="text"><![CDATA[ä¸€ã€ä»€ä¹ˆæ˜¯ä»£ç†ï¼Ÿä»£ç†æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œå…¶ç›®çš„å°±æ˜¯ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ä»¥æŽ§åˆ¶å¯¹æŸä¸ªå¯¹è±¡çš„è®¿é—®ã€‚ä»£ç†ç±»è´Ÿè´£ä¸ºå§”æ‰˜ç±»é¢„å¤„ç†æ¶ˆæ¯ï¼Œè¿‡æ»¤æ¶ˆæ¯å¹¶è½¬å‘æ¶ˆæ¯ï¼Œä»¥åŠè¿›è¡Œæ¶ˆæ¯è¢«å§”æ‰˜ç±»æ‰§è¡ŒåŽçš„åŽç»­å¤„ç†ã€‚ ä»£ç†æ¨¡å¼UMLå›¾ï¼š ç®€å•ç»“æž„ç¤ºæ„å›¾ï¼š ä¸ºäº†ä¿æŒè¡Œä¸ºçš„ä¸€è‡´æ€§ï¼Œä»£ç†ç±»å’Œå§”æ‰˜ç±»é€šå¸¸ä¼šå®žçŽ°ç›¸åŒçš„æŽ¥å£ï¼Œæ‰€ä»¥åœ¨è®¿é—®è€…çœ‹æ¥ä¸¤è€…æ²¡æœ‰ä¸æ¯«çš„åŒºåˆ«ã€‚é€šè¿‡ä»£ç†ç±»è¿™ä¸­é—´ä¸€å±‚ï¼Œèƒ½æœ‰æ•ˆæŽ§åˆ¶å¯¹å§”æ‰˜ç±»å¯¹è±¡çš„ç›´æŽ¥è®¿é—®ï¼Œä¹Ÿå¯ä»¥å¾ˆå¥½åœ°éšè—å’Œä¿æŠ¤å§”æ‰˜ç±»å¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿä¸ºå®žæ–½ä¸åŒæŽ§åˆ¶ç­–ç•¥é¢„ç•™äº†ç©ºé—´ï¼Œä»Žè€Œåœ¨è®¾è®¡ä¸ŠèŽ·å¾—äº†æ›´å¤§çš„çµæ´»æ€§ã€‚Java åŠ¨æ€ä»£ç†æœºåˆ¶ä»¥å·§å¦™çš„æ–¹å¼è¿‘ä¹Žå®Œç¾Žåœ°å®žè·µäº†ä»£ç†æ¨¡å¼çš„è®¾è®¡ç†å¿µã€‚ äºŒã€Java åŠ¨æ€ä»£ç†ç±»JavaåŠ¨æ€ä»£ç†ç±»ä½äºŽjava.lang.reflectåŒ…ä¸‹ï¼Œä¸€èˆ¬ä¸»è¦æ¶‰åŠåˆ°ä»¥ä¸‹ä¸¤ä¸ªç±»ï¼š (1)Interface InvocationHandlerï¼šè¯¥æŽ¥å£ä¸­ä»…å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³• 1public object invoke(Object obj,Method method, Object[] args) åœ¨å®žé™…ä½¿ç”¨æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°objä¸€èˆ¬æ˜¯æŒ‡ä»£ç†ç±»ï¼Œmethodæ˜¯è¢«ä»£ç†çš„æ–¹æ³•ï¼Œå¦‚ä¸Šä¾‹ä¸­çš„request()ï¼Œargsä¸ºè¯¥æ–¹æ³•çš„å‚æ•°æ•°ç»„ã€‚è¿™ä¸ªæŠ½è±¡æ–¹æ³•åœ¨ä»£ç†ç±»ä¸­åŠ¨æ€å®žçŽ°ã€‚ (2)Proxyï¼šè¯¥ç±»å³ä¸ºåŠ¨æ€ä»£ç†ç±»ï¼Œå…¶ä¸­ä¸»è¦åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š protected Proxy(InvocationHandler h)ï¼šæž„é€ å‡½æ•°ï¼Œç”¨äºŽç»™å†…éƒ¨çš„hèµ‹å€¼ã€‚ static Class getProxyClass( ClassLoader loader, Class[] interfaces)ï¼šèŽ·å¾—ä¸€ä¸ªä»£ç†ç±»ï¼Œå…¶ä¸­loaderæ˜¯ç±»è£…è½½å™¨ï¼Œinterfacesæ˜¯çœŸå®žç±»æ‰€æ‹¥æœ‰çš„å…¨éƒ¨æŽ¥å£çš„æ•°ç»„ã€‚ static Object newProxyInstance(ClassLoaderloader, Class[] interfaces,InvocationHandler h)ï¼šè¿”å›žä»£ç†ç±»çš„ä¸€ä¸ªå®žä¾‹ï¼Œè¿”å›žåŽçš„ä»£ç†ç±»å¯ä»¥å½“ä½œè¢«ä»£ç†ç±»ä½¿ç”¨(å¯ä½¿ç”¨è¢«ä»£ç†ç±»çš„åœ¨SubjectæŽ¥å£ä¸­å£°æ˜Žè¿‡çš„æ–¹æ³•) æ‰€è°“DynamicProxyæ˜¯è¿™æ ·ä¸€ç§classï¼šå®ƒæ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„classï¼Œåœ¨ç”Ÿæˆå®ƒæ—¶ä½ å¿…é¡»æä¾›ä¸€ç»„interfaceç»™å®ƒï¼Œç„¶åŽè¯¥classå°±å®£ç§°å®ƒå®žçŽ°äº†è¿™äº›interfaceã€‚ä½ å½“ç„¶å¯ä»¥æŠŠè¯¥classçš„å®žä¾‹å½“ä½œè¿™äº›interfaceä¸­çš„ä»»ä½•ä¸€ä¸ªæ¥ç”¨ã€‚å½“ç„¶ï¼Œè¿™ä¸ªDynamicProxyå…¶å®žå°±æ˜¯ä¸€ä¸ªProxyï¼Œå®ƒä¸ä¼šæ›¿ä½ ä½œå®žè´¨æ€§çš„å·¥ä½œï¼Œåœ¨ç”Ÿæˆå®ƒçš„å®žä¾‹æ—¶ä½ å¿…é¡»æä¾›ä¸€ä¸ªhandlerï¼Œç”±å®ƒæŽ¥ç®¡å®žé™…çš„å·¥ä½œã€‚ åœ¨ä½¿ç”¨åŠ¨æ€ä»£ç†ç±»æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»å®žçŽ°InvocationHandleræŽ¥å£ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œè¢«ä»£ç†çš„å¯¹è±¡(RealSubject)å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ”¹å˜ï¼Œéœ€è¦æŽ§åˆ¶çš„æŽ¥å£(SubjectæŽ¥å£)å¯ä»¥åœ¨è¿è¡Œæ—¶æ”¹å˜ï¼ŒæŽ§åˆ¶çš„æ–¹å¼(DynamicSubjectç±»)ä¹Ÿå¯ä»¥åŠ¨æ€æ”¹å˜ï¼Œä»Žè€Œå®žçŽ°äº†éžå¸¸çµæ´»çš„åŠ¨æ€ä»£ç†å…³ç³»ã€‚ åŠ¨æ€ä»£ç†æ­¥éª¤ï¼š åˆ›å»ºä¸€ä¸ªå®žçŽ°æŽ¥å£InvocationHandlerçš„ç±»ï¼Œå®ƒå¿…é¡»å®žçŽ°invokeæ–¹æ³• åˆ›å»ºè¢«ä»£ç†çš„ç±»ä»¥åŠæŽ¥å£ é€šè¿‡Proxyçš„é™æ€æ–¹æ³• newProxyInstance(ClassLoaderloader,Class[]interfaces,InvocationHandler h)åˆ›å»ºä¸€ä¸ªä»£ç† é€šè¿‡ä»£ç†è°ƒç”¨æ–¹æ³• ä¸‰ã€JDKçš„åŠ¨æ€ä»£ç†æ€Žä¹ˆä½¿ç”¨ï¼Ÿ1ã€éœ€è¦åŠ¨æ€ä»£ç†çš„æŽ¥å£ï¼š 123456789101112131415161718192021package jiankunking;/** * éœ€è¦åŠ¨æ€ä»£ç†çš„æŽ¥å£ */public interface Subject &#123; /** * ä½ å¥½ * * @param name * @return */ public String SayHello(String name); /** * å†è§ * * @return */ public String SayGoodBye();&#125; 2ã€éœ€è¦ä»£ç†çš„å®žé™…å¯¹è±¡ 1234567891011121314151617181920212223242526272829package jiankunking;/** * å®žé™…å¯¹è±¡ */public class RealSubject implements Subject &#123; /** * ä½ å¥½ * * @param name * @return */ @Override public String SayHello(String name) &#123; return &quot;hello &quot; + name; &#125; /** * å†è§ * * @return */ @Override public String SayGoodBye() &#123; return &quot; good bye &quot;; &#125;&#125; 3ã€è°ƒç”¨å¤„ç†å™¨å®žçŽ°ç±»ï¼ˆæœ‰æœ¨æœ‰æ„Ÿè§‰è¿™é‡Œå°±æ˜¯ä¼ è¯´ä¸­çš„AOPå•Šï¼‰ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package jiankunking;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;/** * è°ƒç”¨å¤„ç†å™¨å®žçŽ°ç±» * æ¯æ¬¡ç”ŸæˆåŠ¨æ€ä»£ç†ç±»å¯¹è±¡æ—¶éƒ½éœ€è¦æŒ‡å®šä¸€ä¸ªå®žçŽ°äº†è¯¥æŽ¥å£çš„è°ƒç”¨å¤„ç†å™¨å¯¹è±¡ */public class InvocationHandlerImpl implements InvocationHandler &#123; /** * è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬è¦ä»£ç†çš„çœŸå®žå¯¹è±¡ */ private Object subject; /** * æž„é€ æ–¹æ³•ï¼Œç»™æˆ‘ä»¬è¦ä»£ç†çš„çœŸå®žå¯¹è±¡èµ‹åˆå€¼ * * @param subject */ public InvocationHandlerImpl(Object subject) &#123; this.subject = subject; &#125; /** * è¯¥æ–¹æ³•è´Ÿè´£é›†ä¸­å¤„ç†åŠ¨æ€ä»£ç†ç±»ä¸Šçš„æ‰€æœ‰æ–¹æ³•è°ƒç”¨ã€‚ * è°ƒç”¨å¤„ç†å™¨æ ¹æ®è¿™ä¸‰ä¸ªå‚æ•°è¿›è¡Œé¢„å¤„ç†æˆ–åˆ†æ´¾åˆ°å§”æ‰˜ç±»å®žä¾‹ä¸Šåå°„æ‰§è¡Œ * * @param proxy ä»£ç†ç±»å®žä¾‹ * @param method è¢«è°ƒç”¨çš„æ–¹æ³•å¯¹è±¡ * @param args è°ƒç”¨å‚æ•° * @return * @throws Throwable */ @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; //åœ¨ä»£ç†çœŸå®žå¯¹è±¡å‰æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€äº›è‡ªå·±çš„æ“ä½œ System.out.println(&quot;åœ¨è°ƒç”¨ä¹‹å‰ï¼Œæˆ‘è¦å¹²ç‚¹å•¥å‘¢ï¼Ÿ&quot;); System.out.println(&quot;Method:&quot; + method); //å½“ä»£ç†å¯¹è±¡è°ƒç”¨çœŸå®žå¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå…¶ä¼šè‡ªåŠ¨çš„è·³è½¬åˆ°ä»£ç†å¯¹è±¡å…³è”çš„handlerå¯¹è±¡çš„invokeæ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ Object returnValue = method.invoke(subject, args); //åœ¨ä»£ç†çœŸå®žå¯¹è±¡åŽæˆ‘ä»¬ä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›è‡ªå·±çš„æ“ä½œ System.out.println(&quot;åœ¨è°ƒç”¨ä¹‹åŽï¼Œæˆ‘è¦å¹²ç‚¹å•¥å‘¢ï¼Ÿ&quot;); return returnValue; &#125;&#125; 4ã€æµ‹è¯• 12345678910111213141516171819202122232425262728293031323334package jiankunking;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;/** * åŠ¨æ€ä»£ç†æ¼”ç¤º */public class DynamicProxyDemonstration &#123; public static void main(String[] args) &#123; //ä»£ç†çš„çœŸå®žå¯¹è±¡ Subject realSubject = new RealSubject(); /** * InvocationHandlerImpl å®žçŽ°äº† InvocationHandler æŽ¥å£ï¼Œå¹¶èƒ½å®žçŽ°æ–¹æ³•è°ƒç”¨ä»Žä»£ç†ç±»åˆ°å§”æ‰˜ç±»çš„åˆ†æ´¾è½¬å‘ * å…¶å†…éƒ¨é€šå¸¸åŒ…å«æŒ‡å‘å§”æ‰˜ç±»å®žä¾‹çš„å¼•ç”¨ï¼Œç”¨äºŽçœŸæ­£æ‰§è¡Œåˆ†æ´¾è½¬å‘è¿‡æ¥çš„æ–¹æ³•è°ƒç”¨. * å³ï¼šè¦ä»£ç†å“ªä¸ªçœŸå®žå¯¹è±¡ï¼Œå°±å°†è¯¥å¯¹è±¡ä¼ è¿›åŽ»ï¼Œæœ€åŽæ˜¯é€šè¿‡è¯¥çœŸå®žå¯¹è±¡æ¥è°ƒç”¨å…¶æ–¹æ³• */ InvocationHandler handler = new InvocationHandlerImpl(realSubject); ClassLoader loader = handler.getClass().getClassLoader(); Class&lt;?&gt;[] interfaces = realSubject.getClass().getInterfaces(); /** * è¯¥æ–¹æ³•ç”¨äºŽä¸ºæŒ‡å®šç±»è£…è½½å™¨ã€ä¸€ç»„æŽ¥å£åŠè°ƒç”¨å¤„ç†å™¨ç”ŸæˆåŠ¨æ€ä»£ç†ç±»å®žä¾‹ */ Subject subject = (Subject) Proxy.newProxyInstance(loader, interfaces, handler); System.out.println(&quot;åŠ¨æ€ä»£ç†å¯¹è±¡çš„ç±»åž‹ï¼š&quot; + subject.getClass().getName()); String hello = subject.SayHello(&quot;jiankunking&quot;); System.out.println(hello);// String goodbye = subject.SayGoodBye();// System.out.println(goodbye); &#125;&#125; 5ã€è¾“å‡ºç»“æžœå¦‚ä¸‹ï¼š å››ã€åŠ¨æ€ä»£ç†æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿä»Žä½¿ç”¨ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå…³é”®ç‚¹åœ¨ï¼š 1Subject subject = (Subject) Proxy.newProxyInstance(loader, interfaces, handler); é€šè¿‡è·Ÿè¸ªæç¤ºä»£ç å¯ä»¥çœ‹å‡ºï¼šå½“ä»£ç†å¯¹è±¡è°ƒç”¨çœŸå®žå¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå…¶ä¼šè‡ªåŠ¨çš„è·³è½¬åˆ°ä»£ç†å¯¹è±¡å…³è”çš„handlerå¯¹è±¡çš„invokeæ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä»£ç æ‰§è¡Œåˆ°ï¼šsubject.SayHello(â€œjiankunkingâ€)è¿™å¥è¯æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨InvocationHandlerImplçš„invokeæ–¹æ³•ã€‚è¿™æ˜¯ä¸ºå•¥å‘¢ï¼Ÿ ä¸‹é¢æ˜¯ä»£ç è·Ÿåˆ†æžçš„è¿‡ç¨‹ï¼Œä¸æƒ³çœ‹çš„æœ‹å‹å¯ä»¥ç›´æŽ¥çœ‹ç»“è®º ä»¥ä¸‹ä»£ç æ¥è‡ª:JDK1.8.0_92 æ—¢ç„¶ç”Ÿæˆä»£ç†å¯¹è±¡æ˜¯ç”¨çš„Proxyç±»çš„é™æ€æ–¹newProxyInstanceï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åŽ»å®ƒçš„æºç é‡Œçœ‹ä¸€ä¸‹å®ƒåˆ°åº•éƒ½åšäº†äº›ä»€ä¹ˆï¼Ÿ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596/** * Returns an instance of a proxy class for the specified interfaces * that dispatches method invocations to the specified invocation * handler. * * &lt;p&gt;&#123;@code Proxy.newProxyInstance&#125; throws * &#123;@code IllegalArgumentException&#125; for the same reasons that * &#123;@code Proxy.getProxyClass&#125; does. * * @param loader the class loader to define the proxy class * @param interfaces the list of interfaces for the proxy class * to implement * @param h the invocation handler to dispatch method invocations to * @return a proxy instance with the specified invocation handler of a * proxy class that is defined by the specified class loader * and that implements the specified interfaces * @throws IllegalArgumentException if any of the restrictions on the * parameters that may be passed to &#123;@code getProxyClass&#125; * are violated * @throws SecurityException if a security manager, &lt;em&gt;s&lt;/em&gt;, is present * and any of the following conditions is met: * &lt;ul&gt; * &lt;li&gt; the given &#123;@code loader&#125; is &#123;@code null&#125; and * the caller&apos;s class loader is not &#123;@code null&#125; and the * invocation of &#123;@link SecurityManager#checkPermission * s.checkPermission&#125; with * &#123;@code RuntimePermission(&quot;getClassLoader&quot;)&#125; permission * denies access;&lt;/li&gt; * &lt;li&gt; for each proxy interface, &#123;@code intf&#125;, * the caller&apos;s class loader is not the same as or an * ancestor of the class loader for &#123;@code intf&#125; and * invocation of &#123;@link SecurityManager#checkPackageAccess * s.checkPackageAccess()&#125; denies access to &#123;@code intf&#125;;&lt;/li&gt; * &lt;li&gt; any of the given proxy interfaces is non-public and the * caller class is not in the same &#123;@linkplain Package runtime package&#125; * as the non-public interface and the invocation of * &#123;@link SecurityManager#checkPermission s.checkPermission&#125; with * &#123;@code ReflectPermission(&quot;newProxyInPackage.&#123;package name&#125;&quot;)&#125; * permission denies access.&lt;/li&gt; * &lt;/ul&gt; * @throws NullPointerException if the &#123;@code interfaces&#125; array * argument or any of its elements are &#123;@code null&#125;, or * if the invocation handler, &#123;@code h&#125;, is * &#123;@code null&#125; */@CallerSensitive public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException &#123; //æ£€æŸ¥h ä¸ä¸ºç©ºï¼Œå¦åˆ™æŠ›å¼‚å¸¸ Objects.requireNonNull(h); final Class&lt;?&gt;[] intfs = interfaces.clone(); final SecurityManager sm = System.getSecurityManager(); if (sm != null) &#123; checkProxyAccess(Reflection.getCallerClass(), loader, intfs); &#125; /* * èŽ·å¾—ä¸ŽæŒ‡å®šç±»è£…è½½å™¨å’Œä¸€ç»„æŽ¥å£ç›¸å…³çš„ä»£ç†ç±»ç±»åž‹å¯¹è±¡ */ Class&lt;?&gt; cl = getProxyClass0(loader, intfs); /* * é€šè¿‡åå°„èŽ·å–æž„é€ å‡½æ•°å¯¹è±¡å¹¶ç”Ÿæˆä»£ç†ç±»å®žä¾‹ */ try &#123; if (sm != null) &#123; checkNewProxyPermission(Reflection.getCallerClass(), cl); &#125; //èŽ·å–ä»£ç†å¯¹è±¡çš„æž„é€ æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯$Proxy0(InvocationHandler h)ï¼‰ final Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams); final InvocationHandler ih = h; if (!Modifier.isPublic(cl.getModifiers())) &#123; AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123; public Void run() &#123; cons.setAccessible(true); return null; &#125; &#125;); &#125; //ç”Ÿæˆä»£ç†ç±»çš„å®žä¾‹å¹¶æŠŠInvocationHandlerImplçš„å®žä¾‹ä¼ ç»™å®ƒçš„æž„é€ æ–¹æ³• return cons.newInstance(new Object[]&#123;h&#125;); &#125; catch (IllegalAccessException|InstantiationException e) &#123; throw new InternalError(e.toString(), e); &#125; catch (InvocationTargetException e) &#123; Throwable t = e.getCause(); if (t instanceof RuntimeException) &#123; throw (RuntimeException) t; &#125; else &#123; throw new InternalError(t.toString(), t); &#125; &#125; catch (NoSuchMethodException e) &#123; throw new InternalError(e.toString(), e); &#125; &#125; æˆ‘ä»¬å†è¿›åŽ»getProxyClass0æ–¹æ³•çœ‹ä¸€ä¸‹ï¼š 123456789101112131415/** * Generate a proxy class. Must call the checkProxyAccess method * to perform permission checks before calling this. */private static Class&lt;?&gt; getProxyClass0(ClassLoader loader, Class&lt;?&gt;... interfaces) &#123; if (interfaces.length &gt; 65535) &#123; throw new IllegalArgumentException(&quot;interface limit exceeded&quot;); &#125; // If the proxy class defined by the given loader implementing // the given interfaces exists, this will simply return the cached copy; // otherwise, it will create the proxy class via the ProxyClassFactory return proxyClassCache.get(loader, interfaces);&#125; çœŸç›¸è¿˜æ˜¯æ²¡æœ‰æ¥åˆ°ï¼Œç»§ç»­ï¼Œçœ‹ä¸€ä¸‹ proxyClassCache 1234 /** * a cache of proxy classes */private static final WeakCache&lt;ClassLoader, Class&lt;?&gt;[], Class&lt;?&gt;&gt; proxyClassCache = new WeakCache&lt;&gt;(new KeyFactory(), new ProxyClassFactory()); å¥¥ï¼ŒåŽŸæ¥ç”¨äº†ä¸€ä¸‹ç¼“å­˜å•Š é‚£ä¹ˆå®ƒå¯¹åº”çš„getæ–¹æ³•å•¥æ ·å‘¢ï¼Ÿ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172/** * Look-up the value through the cache. This always evaluates the * &#123;@code subKeyFactory&#125; function and optionally evaluates * &#123;@code valueFactory&#125; function if there is no entry in the cache for given * pair of (key, subKey) or the entry has already been cleared. * * @param key possibly null key * @param parameter parameter used together with key to create sub-key and * value (should not be null) * @return the cached value (never null) * @throws NullPointerException if &#123;@code parameter&#125; passed in or * &#123;@code sub-key&#125; calculated by * &#123;@code subKeyFactory&#125; or &#123;@code value&#125; * calculated by &#123;@code valueFactory&#125; is null. */public V get(K key, P parameter) &#123; Objects.requireNonNull(parameter); expungeStaleEntries(); Object cacheKey = CacheKey.valueOf(key, refQueue); // lazily install the 2nd level valuesMap for the particular cacheKey ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; valuesMap = map.get(cacheKey); if (valuesMap == null) &#123; //putIfAbsentè¿™ä¸ªæ–¹æ³•åœ¨keyä¸å­˜åœ¨çš„æ—¶å€™åŠ å…¥ä¸€ä¸ªå€¼,å¦‚æžœkeyå­˜åœ¨å°±ä¸æ”¾å…¥ ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; oldValuesMap = map.putIfAbsent(cacheKey,valuesMap = new ConcurrentHashMap&lt;&gt;()); if (oldValuesMap != null) &#123; valuesMap = oldValuesMap; &#125; &#125; // create subKey and retrieve the possible Supplier&lt;V&gt; stored by that // subKey from valuesMap Object subKey = Objects.requireNonNull(subKeyFactory.apply(key, parameter)); Supplier&lt;V&gt; supplier = valuesMap.get(subKey); Factory factory = null; while (true) &#123; if (supplier != null) &#123; // supplier might be a Factory or a CacheValue&lt;V&gt; instance V value = supplier.get(); if (value != null) &#123; return value; &#125; &#125; // else no supplier in cache // or a supplier that returned null (could be a cleared CacheValue // or a Factory that wasn&apos;t successful in installing the CacheValue) // lazily construct a Factory if (factory == null) &#123; factory = new Factory(key, parameter, subKey, valuesMap); &#125; if (supplier == null) &#123; supplier = valuesMap.putIfAbsent(subKey, factory); if (supplier == null) &#123; // successfully installed Factory supplier = factory; &#125; // else retry with winning supplier &#125; else &#123; if (valuesMap.replace(subKey, supplier, factory)) &#123; // successfully replaced // cleared CacheEntry / unsuccessful Factory // with our Factory supplier = factory; &#125; else &#123; // retry with current supplier supplier = valuesMap.get(subKey); &#125; &#125; &#125;&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒè°ƒç”¨äº† supplier.get(); èŽ·å–åŠ¨æ€ä»£ç†ç±»ï¼Œå…¶ä¸­supplieræ˜¯Factory,è¿™ä¸ªç±»å®šä¹‰åœ¨WeakCachçš„å†…éƒ¨ã€‚ æ¥çž…çž…ï¼Œgeté‡Œé¢åˆåšäº†ä»€ä¹ˆï¼Ÿ 1234567891011121314151617181920212223242526272829303132333435363738394041public synchronized V get() &#123; // serialize access // re-check Supplier&lt;V&gt; supplier = valuesMap.get(subKey); if (supplier != this) &#123; // something changed while we were waiting: // might be that we were replaced by a CacheValue // or were removed because of failure -&gt; // return null to signal WeakCache.get() to retry // the loop return null; &#125; // else still us (supplier == this) // create new value V value = null; try &#123; value = Objects.requireNonNull(valueFactory.apply(key, parameter)); &#125; finally &#123; if (value == null) &#123; // remove us on failure valuesMap.remove(subKey, this); &#125; &#125; // the only path to reach here is with non-null value assert value != null; // wrap value with CacheValue (WeakReference) CacheValue&lt;V&gt; cacheValue = new CacheValue&lt;&gt;(value); // try replacing us with CacheValue (this should always succeed) if (valuesMap.replace(subKey, this, cacheValue)) &#123; // put also in reverseMap reverseMap.put(cacheValue, Boolean.TRUE); &#125; else &#123; throw new AssertionError(&quot;Should not reach here&quot;); &#125; // successfully replaced us with new CacheValue -&gt; return the value // wrapped by it return value; &#125; &#125; å‘çŽ°é‡ç‚¹è¿˜æ˜¯æœ¨æœ‰å‡ºçŽ°ï¼Œä½†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒè°ƒç”¨äº†valueFactory.apply(key, parameter)æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899 /** * A factory function that generates, defines and returns the proxy class given * the ClassLoader and array of interfaces. */private static final class ProxyClassFactory implements BiFunction&lt;ClassLoader, Class&lt;?&gt;[], Class&lt;?&gt;&gt; &#123; // prefix for all proxy class names private static final String proxyClassNamePrefix = &quot;$Proxy&quot;; // next number to use for generation of unique proxy class names private static final AtomicLong nextUniqueNumber = new AtomicLong(); @Override public Class&lt;?&gt; apply(ClassLoader loader, Class&lt;?&gt;[] interfaces) &#123; Map&lt;Class&lt;?&gt;, Boolean&gt; interfaceSet = new IdentityHashMap&lt;&gt;(interfaces.length); for (Class&lt;?&gt; intf : interfaces) &#123; /* * Verify that the class loader resolves the name of this * interface to the same Class object. */ Class&lt;?&gt; interfaceClass = null; try &#123; interfaceClass = Class.forName(intf.getName(), false, loader); &#125; catch (ClassNotFoundException e) &#123; &#125; if (interfaceClass != intf) &#123; throw new IllegalArgumentException( intf + &quot; is not visible from class loader&quot;); &#125; /* * Verify that the Class object actually represents an * interface. */ if (!interfaceClass.isInterface()) &#123; throw new IllegalArgumentException( interfaceClass.getName() + &quot; is not an interface&quot;); &#125; /* * Verify that this interface is not a duplicate. */ if (interfaceSet.put(interfaceClass, Boolean.TRUE) != null) &#123; throw new IllegalArgumentException( &quot;repeated interface: &quot; + interfaceClass.getName()); &#125; &#125; String proxyPkg = null; // package to define proxy class in int accessFlags = Modifier.PUBLIC | Modifier.FINAL; /* * Record the package of a non-public proxy interface so that the * proxy class will be defined in the same package. Verify that * all non-public proxy interfaces are in the same package. */ for (Class&lt;?&gt; intf : interfaces) &#123; int flags = intf.getModifiers(); if (!Modifier.isPublic(flags)) &#123; accessFlags = Modifier.FINAL; String name = intf.getName(); int n = name.lastIndexOf(&apos;.&apos;); String pkg = ((n == -1) ? &quot;&quot; : name.substring(0, n + 1)); if (proxyPkg == null) &#123; proxyPkg = pkg; &#125; else if (!pkg.equals(proxyPkg)) &#123; throw new IllegalArgumentException( &quot;non-public interfaces from different packages&quot;); &#125; &#125; &#125; if (proxyPkg == null) &#123; // if no non-public proxy interfaces, use com.sun.proxy package proxyPkg = ReflectUtil.PROXY_PACKAGE + &quot;.&quot;; &#125; /* * Choose a name for the proxy class to generate. */ long num = nextUniqueNumber.getAndIncrement(); String proxyName = proxyPkg + proxyClassNamePrefix + num; /* * Generate the specified proxy class. */ byte[] proxyClassFile = ProxyGenerator.generateProxyClass( proxyName, interfaces, accessFlags); try &#123; return defineClass0(loader, proxyName, proxyClassFile, 0, proxyClassFile.length); &#125; catch (ClassFormatError e) &#123; /* * A ClassFormatError here means that (barring bugs in the * proxy class generation code) there was some other * invalid aspect of the arguments supplied to the proxy * class creation (such as virtual machine limitations * exceeded). */ throw new IllegalArgumentException(e.toString()); &#125; &#125;&#125; é€šè¿‡çœ‹ä»£ç ç»ˆäºŽæ‰¾åˆ°äº†é‡ç‚¹ï¼š 12//ç”Ÿæˆå­—èŠ‚ç byte[] proxyClassFile = ProxyGenerator.generateProxyClass(proxyName, interfaces, accessFlags); é‚£ä¹ˆæŽ¥ä¸‹æ¥æˆ‘ä»¬ä¹Ÿä½¿ç”¨æµ‹è¯•ä¸€ä¸‹ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ç”Ÿæˆçš„å­—èŠ‚ç æ˜¯ä¸ªä»€ä¹ˆæ ·å­ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960package jiankunking; import sun.misc.ProxyGenerator; import java.io.File;import java.io.FileNotFoundException;import java.io.FileOutputStream;import java.io.IOException;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy; /** * åŠ¨æ€ä»£ç†æ¼”ç¤º */public class DynamicProxyDemonstration &#123; public static void main(String[] args) &#123; //ä»£ç†çš„çœŸå®žå¯¹è±¡ Subject realSubject = new RealSubject(); /** * InvocationHandlerImpl å®žçŽ°äº† InvocationHandler æŽ¥å£ï¼Œå¹¶èƒ½å®žçŽ°æ–¹æ³•è°ƒç”¨ä»Žä»£ç†ç±»åˆ°å§”æ‰˜ç±»çš„åˆ†æ´¾è½¬å‘ * å…¶å†…éƒ¨é€šå¸¸åŒ…å«æŒ‡å‘å§”æ‰˜ç±»å®žä¾‹çš„å¼•ç”¨ï¼Œç”¨äºŽçœŸæ­£æ‰§è¡Œåˆ†æ´¾è½¬å‘è¿‡æ¥çš„æ–¹æ³•è°ƒç”¨. * å³ï¼šè¦ä»£ç†å“ªä¸ªçœŸå®žå¯¹è±¡ï¼Œå°±å°†è¯¥å¯¹è±¡ä¼ è¿›åŽ»ï¼Œæœ€åŽæ˜¯é€šè¿‡è¯¥çœŸå®žå¯¹è±¡æ¥è°ƒç”¨å…¶æ–¹æ³• */ InvocationHandler handler = new InvocationHandlerImpl(realSubject); ClassLoader loader = handler.getClass().getClassLoader(); Class[] interfaces = realSubject.getClass().getInterfaces(); /** * è¯¥æ–¹æ³•ç”¨äºŽä¸ºæŒ‡å®šç±»è£…è½½å™¨ã€ä¸€ç»„æŽ¥å£åŠè°ƒç”¨å¤„ç†å™¨ç”ŸæˆåŠ¨æ€ä»£ç†ç±»å®žä¾‹ */ Subject subject = (Subject) Proxy.newProxyInstance(loader, interfaces, handler); System.out.println(&quot;åŠ¨æ€ä»£ç†å¯¹è±¡çš„ç±»åž‹ï¼š&quot;+subject.getClass().getName()); String hello = subject.SayHello(&quot;jiankunking&quot;); System.out.println(hello); // å°†ç”Ÿæˆçš„å­—èŠ‚ç ä¿å­˜åˆ°æœ¬åœ°ï¼Œ createProxyClassFile(); &#125; private static void createProxyClassFile()&#123; String name = &quot;ProxySubject&quot;; byte[] data = ProxyGenerator.generateProxyClass(name,new Class[]&#123;Subject.class&#125;); FileOutputStream out =null; try &#123; out = new FileOutputStream(name+&quot;.class&quot;); System.out.println((new File(&quot;hello&quot;)).getAbsolutePath()); out.write(data); &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;finally &#123; if(null!=out) try &#123; out.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; å¯ä»¥çœ‹ä¸€ä¸‹è¿™é‡Œä»£ç†å¯¹è±¡çš„ç±»åž‹ï¼š æˆ‘ä»¬ç”¨jd-jui å·¥å…·å°†ç”Ÿæˆçš„å­—èŠ‚ç åç¼–è¯‘ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;import java.lang.reflect.UndeclaredThrowableException;import jiankunking.Subject; public final class ProxySubject extends Proxy implements Subject &#123; private static Method m1; private static Method m3; private static Method m4; private static Method m2; private static Method m0; public ProxySubject(InvocationHandler paramInvocationHandler) &#123; super(paramInvocationHandler); &#125; public final boolean equals(Object paramObject)&#123; try &#123; return ((Boolean)this.h.invoke(this, m1, new Object[] &#123; paramObject &#125;)).booleanValue(); &#125; catch (Error|RuntimeException localError)&#123; throw localError; &#125; catch (Throwable localThrowable) &#123; throw new UndeclaredThrowableException(localThrowable); &#125; &#125; public final String SayGoodBye() &#123; try&#123; return (String)this.h.invoke(this, m3, null); &#125; catch (Error|RuntimeException localError) &#123; throw localError; &#125; catch (Throwable localThrowable) &#123; throw new UndeclaredThrowableException(localThrowable); &#125; &#125; public final String SayHello(String paramString) &#123; try &#123; return (String)this.h.invoke(this, m4, new Object[] &#123; paramString &#125;); &#125; catch (Error|RuntimeException localError)&#123; throw localError; &#125; catch (Throwable localThrowable)&#123; throw new UndeclaredThrowableException(localThrowable); &#125; &#125; public final String toString() &#123; try &#123; return (String)this.h.invoke(this, m2, null); &#125; catch (Error|RuntimeException localError) &#123; throw localError; &#125; catch (Throwable localThrowable) &#123; throw new UndeclaredThrowableException(localThrowable); &#125; &#125; public final int hashCode() &#123; try &#123; return ((Integer)this.h.invoke(this, m0, null)).intValue(); &#125; catch (Error|RuntimeException localError) &#123; throw localError; &#125; catch (Throwable localThrowable) &#123; throw new UndeclaredThrowableException(localThrowable); &#125; &#125; static &#123; try &#123; m1 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;equals&quot;, new Class[] &#123; Class.forName(&quot;java.lang.Object&quot;) &#125;); m3 = Class.forName(&quot;jiankunking.Subject&quot;).getMethod(&quot;SayGoodBye&quot;, new Class[0]); m4 = Class.forName(&quot;jiankunking.Subject&quot;).getMethod(&quot;SayHello&quot;, new Class[] &#123; Class.forName(&quot;java.lang.String&quot;) &#125;); m2 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;toString&quot;, new Class[0]); m0 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;hashCode&quot;, new Class[0]); return; &#125; catch (NoSuchMethodException localNoSuchMethodException) &#123; throw new NoSuchMethodError(localNoSuchMethodException.getMessage()); &#125; catch (ClassNotFoundException localClassNotFoundException) &#123; throw new NoClassDefFoundError(localClassNotFoundException.getMessage()); &#125; &#125;&#125; è¿™å°±æ˜¯æœ€ç»ˆçœŸæ­£çš„ä»£ç†ç±»ï¼Œå®ƒç»§æ‰¿è‡ªProxyå¹¶å®žçŽ°äº†æˆ‘ä»¬å®šä¹‰çš„SubjectæŽ¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š 1Subject subject = (Subject) Proxy.newProxyInstance(loader, interfaces, handler); è¿™é‡Œçš„subjectå®žé™…æ˜¯è¿™ä¸ªç±»çš„ä¸€ä¸ªå®žä¾‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬è°ƒç”¨å®ƒçš„ï¼š 1public final String SayHello(String paramString) å°±æ˜¯è°ƒç”¨æˆ‘ä»¬å®šä¹‰çš„InvocationHandlerImplçš„ invokeæ–¹æ³•ï¼š ä¸Šé¢æ˜¯ä»£ç è·Ÿåˆ†æžçš„è¿‡ç¨‹ï¼Œä¸æƒ³çœ‹çš„æœ‹å‹å¯ä»¥ç›´æŽ¥çœ‹ç»“è®º äº”ã€ç»“è®ºåˆ°äº†è¿™é‡Œï¼Œç»ˆäºŽè§£ç­”äº†ï¼š subject.SayHello(â€œjiankunkingâ€)è¿™å¥è¯æ—¶ï¼Œä¸ºä»€ä¹ˆä¼šè‡ªåŠ¨è°ƒç”¨InvocationHandlerImplçš„invokeæ–¹æ³•ï¼Ÿ å› ä¸ºJDKç”Ÿæˆçš„æœ€ç»ˆçœŸæ­£çš„ä»£ç†ç±»ï¼Œå®ƒç»§æ‰¿è‡ªProxyå¹¶å®žçŽ°äº†æˆ‘ä»¬å®šä¹‰çš„SubjectæŽ¥å£ï¼Œåœ¨å®žçŽ°SubjectæŽ¥å£æ–¹æ³•çš„å†…éƒ¨ï¼Œé€šè¿‡åå°„è°ƒç”¨äº†InvocationHandlerImplçš„invokeæ–¹æ³•ã€‚ é€šè¿‡åˆ†æžä»£ç å¯ä»¥çœ‹å‡ºJava åŠ¨æ€ä»£ç†ï¼Œå…·ä½“æœ‰å¦‚ä¸‹å››æ­¥éª¤ï¼š é€šè¿‡å®žçŽ° InvocationHandler æŽ¥å£åˆ›å»ºè‡ªå·±çš„è°ƒç”¨å¤„ç†å™¨ï¼› é€šè¿‡ä¸º Proxy ç±»æŒ‡å®š ClassLoader å¯¹è±¡å’Œä¸€ç»„ interface æ¥åˆ›å»ºåŠ¨æ€ä»£ç†ç±»ï¼› é€šè¿‡åå°„æœºåˆ¶èŽ·å¾—åŠ¨æ€ä»£ç†ç±»çš„æž„é€ å‡½æ•°ï¼Œå…¶å”¯ä¸€å‚æ•°ç±»åž‹æ˜¯è°ƒç”¨å¤„ç†å™¨æŽ¥å£ç±»åž‹ï¼› é€šè¿‡æž„é€ å‡½æ•°åˆ›å»ºåŠ¨æ€ä»£ç†ç±»å®žä¾‹ï¼Œæž„é€ æ—¶è°ƒç”¨å¤„ç†å™¨å¯¹è±¡ä½œä¸ºå‚æ•°è¢«ä¼ å…¥ã€‚ æ¼”ç¤ºä»£ç ä¸‹è½½ï¼šhttps://github.com/jiankunking/DynamicProxyDemo]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>JDK</tag>
        <tag>Spring</tag>
        <tag>AOP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€šè¿‡ILåˆ†æžC#ä¸­çš„å§”æ‰˜ã€äº‹ä»¶ã€Funcã€Actionã€Predicateä¹‹é—´çš„åŒºåˆ«ä¸Žè”ç³»]]></title>
    <url>%2Fcsharp-il-delegate-event-func-action-predicate.html</url>
    <content type="text"><![CDATA[ä¸€ç›´ä»¥æ¥éƒ½æ˜¯å¯¹äºŽäº‹ä»¶ä¸Žå§”æ‰˜æ¯”è¾ƒæ··æ·†ï¼Œè€Œä¸”ä¸å¤ªä¼šç”¨ã€‚æ‰¾äº†ä¸ªæ—¶é—´ï¼Œæ€»ç»“äº†ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ¸…æ™°äº†å¾ˆå¤šã€‚ å…ˆè¯´ä¸€ä¸‹ä¸ªäººç†è§£çš„ç»“è®ºå§ï¼š delegateæ˜¯C#ä¸­çš„ä¸€ç§ç±»åž‹ï¼Œå®ƒå®žé™…ä¸Šæ˜¯ä¸€ä¸ªèƒ½å¤ŸæŒæœ‰å¯¹æŸä¸ªæ–¹æ³•çš„å¼•ç”¨çš„ç±»ã€‚ delegateå£°æ˜Žçš„å˜é‡ä¸Ždelegateå£°æ˜Žçš„äº‹ä»¶ï¼Œå¹¶æ²¡æœ‰æœ¬è´¨çš„åŒºåˆ«ï¼Œäº‹ä»¶æ˜¯åœ¨delegateå£°æ˜Žå˜é‡çš„åŸºç¡€ä¸ŠåŒ…è£…è€Œæˆçš„ï¼Œç±»ä¼¼äºŽå˜é‡ä¸Žå±žæ€§çš„å…³ç³»ï¼ˆåœ¨ILä»£ç ä¸­å¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ªdelegateå£°æ˜Žçš„äº‹ä»¶éƒ½å¯¹åº”æ˜¯ç§æœ‰çš„delegateå£°æ˜Žçš„å˜é‡ï¼‰ï¼Œæå‡äº†å®‰å…¨æ€§ã€‚ Action ä¸ŽFuncï¼šè¿™ä¸¤ä¸ªå…¶å®žè¯´ç™½äº†å°±æ˜¯ç³»ç»Ÿå®šä¹‰å¥½çš„Delegateï¼Œä»–æœ‰å¾ˆå¤šé‡è½½çš„æ–¹æ³•ï¼Œä¾¿äºŽå„ç§åº”ç”¨æƒ…å†µä¸‹çš„è°ƒç”¨ã€‚ä»–åœ¨ç³»ç»Ÿçš„Systemå‘½åç©ºé—´ä¸‹ï¼Œå› æ­¤å…¨å±€å¯è§ã€‚ é¦–å…ˆäº†è§£ä¸€ä¸‹ï¼Œ ILDasmä¸­å›¾æ ‡å«ä¹‰ï¼šè¯¥å›¾æ¥è‡ªï¼šhttp://www.cnblogs.com/zery/p/3366175.html å§”æ‰˜åˆ›å»ºæ­¥éª¤ï¼š ç”¨delegateå…³é”®å­—åˆ›å»ºä¸€ä¸ªå§”æ‰˜ï¼ŒåŒ…æ‹¬å£°æ˜Žè¿”å›žå€¼å’Œå‚æ•°ç±»åž‹ã€‚ ä½¿ç”¨çš„åœ°æ–¹æŽ¥æ”¶è¿™ä¸ªå§”æ‰˜ã€‚ åˆ›å»ºè¿™ä¸ªå§”æ‰˜çš„å®žä¾‹å¹¶æŒ‡å®šä¸€ä¸ªè¿”å›žå€¼å’Œå‚æ•°ç±»åž‹åŒ¹é…çš„æ–¹æ³•ä¼ é€’è¿‡åŽ»ã€‚ ä¸€ã€äº‹ä»¶ä¸Žå§”æ‰˜æ–°å»ºä¸€ä¸ªäº‹ä»¶å§”æ‰˜æµ‹è¯•é¡¹ç›®ï¼šEventDelegateTestã€‚ å…·ä½“ä»£ç å¦‚ä¸‹ï¼š 123456789namespace EventDelegateTest&#123; public class TestClass &#123; public delegate int delegateAction(); public event delegateAction OnActionEvent; public delegateAction daNew; &#125;&#125; ç¼–è¯‘ä»£ç åŽï¼Œä½¿ç”¨ Visual Studio 2010è‡ªå¸¦çš„ILDASM.EXEï¼š æ‰“å¼€è¯¥dllï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š ä»Žä¸Šå›¾å¯ä»¥çœ‹å‡ºå¦‚ä¸‹å‡ ç‚¹ä¿¡æ¯ï¼š 1ã€delegateå§”æ‰˜ public delegate int delegateAction();åœ¨ILä¸­æ˜¯ä»¥ç±»ï¼ˆdelegateActionï¼‰çš„å½¢å¼å­˜åœ¨çš„.NETå°†å§”æ‰˜å®šä¹‰ä¸ºä¸€ä¸ªå¯†å°ç±»ï¼Œæ´¾ç”Ÿè‡ªåŸºç±»System.MulticastDelegateï¼Œå¹¶ç»§æ‰¿äº†åŸºç±»çš„ä¸‰ä¸ªæ–¹æ³•: 2ã€eventpublic event delegateAction OnActionEvent;åœ¨ILä¸­ä¸ä»…ä»…å¯¹åº”event OnActionEventè€Œä¸”è¿˜å¯¹åº”ä¸€ä¸ªfield OnActionEvent;è€Œfield OnActionEventä¸Ž public delegateAction daNewç”Ÿæˆçš„field daNewæ˜¯ä¸€æ ·çš„.éƒ½æ˜¯ä»¥å­—æ®µï¼ˆfield ï¼‰çš„å½¢å¼å­˜åœ¨çš„ã€‚åŒå‡»event OnActionEventå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š åœ¨ILä¸­äº‹ä»¶è¢«å°è£…æˆäº†åŒ…å«ä¸€ä¸ªadd_å‰ç¼€å’Œä¸€ä¸ªremove_å‰ç¼€çš„çš„ä»£ç æ®µã€‚å…¶ä¸­ï¼Œadd_å‰ç¼€çš„æ–¹æ³•å…¶å®žæ˜¯é€šè¿‡è°ƒç”¨Delegate.Combine()æ–¹æ³•æ¥å®žçŽ°çš„ï¼Œç»„æˆäº†ä¸€ä¸ªå¤šæ’­å§”æ‰˜ï¼›remove_å°±æ˜¯è°ƒç”¨Delegate.Remove()æ–¹æ³•ï¼Œç”¨äºŽç§»é™¤å¤šæ’­å§”æ‰˜ä¸­çš„æŸä¸ªå§”æ‰˜ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼šäº‹ä»¶å…¶å®žå°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¤šæ’­å§”æ‰˜ã€‚ é‚£ä¹ˆå¯¹äºŽäº‹ä»¶è¿›è¡Œè¿™ä¸€æ¬¡å°è£…æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ1ã€å› ä¸ºdelegateå¯ä»¥æ”¯æŒçš„æ“ä½œéžå¸¸å¤šï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å†™onXXXChanged += aaaFuncï¼ŒæŠŠæŸä¸ªå‡½æ•°æŒ‡é’ˆæŒ‚è½½åˆ°è¿™ä¸ªå§”æ‰˜ä¸Šé¢ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥ç®€å•ç²—æš´åœ°ç›´æŽ¥å†™onXXXChanged = aaaFuncï¼Œè®©è¿™ä¸ªå§”æ‰˜åªåŒ…å«è¿™ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚ä¸è¿‡è¿™æ ·ä¸€æ¥ä¼šäº§ç”Ÿä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼šå¦‚æžœæˆ‘ä»¬ç”¨onXXXChanged = aaaFuncè¿™æ ·çš„å†™æ³•ï¼Œé‚£ä¹ˆä¼šæŠŠè¿™ä¸ªå§”æ‰˜å·²æ‹¥æœ‰çš„å…¶ä»–å‡½æ•°æŒ‡é’ˆç»™è¦†ç›–æŽ‰ï¼Œè¿™å¤§æ¦‚ä¸æ˜¯å®šä¹‰onXXXChangedçš„ç¨‹åºå‘˜æƒ³è¦çœ‹åˆ°çš„ç»“æžœã€‚ å°æ³¨ï¼šè™½ç„¶äº‹ä»¶ä¸èƒ½ç›´æŽ¥=æŸä¸ªå‡½æ•°ï¼Œä¹Ÿä¸å¯ä»¥ç›´æŽ¥=null 2ã€è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯onXXXChangedè¿™ä¸ªå§”æ‰˜åº”è¯¥ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼ˆå³è°ƒç”¨å®ƒæ‰€åŒ…å«çš„å‡½æ•°æŒ‡é’ˆï¼‰ã€‚ä»Žé¢å‘å¯¹è±¡çš„è§’åº¦æ¥è¯´ï¼ŒXXXæ”¹å˜äº†è¿™ä¸ªäº‹å®žï¼ˆå³onXXXChanedçš„å­—é¢å«ä¹‰ï¼‰åº”è¯¥ç”±åŒ…å«å®ƒçš„é‚£ä¸ªå¯¹è±¡æ¥å†³å®šã€‚ä½†å®žé™…ä¸Šæˆ‘ä»¬å¯ä»¥ä»Žè¿™ä¸ªå¯¹è±¡çš„å¤–éƒ¨çŽ¯å¢ƒè°ƒç”¨onXXXChangedï¼Œè¿™æ—¢äº§ç”Ÿäº†å®‰å…¨é—®é¢˜ä¹Ÿä¸ç¬¦åˆé¢å‘å¯¹è±¡çš„åˆè¡·ã€‚è¯´åˆ°è¿™é‡Œå¯¹äºŽäº‹ä»¶ä¸Žå§”æ‰˜çš„ç®¡ç†ç®—æ˜¯è¯´æ˜Žç™½äº†ï¼Œé‚£ä¹ˆå¹³æ—¶å¸¸ç”¨çš„Actionä¸ŽFuncï¼Œä¸Žå§”æ‰˜åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ äºŒã€Action ä¸ŽFuncAction å§”æ‰˜ï¼šå°è£…ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…·æœ‰å‚æ•°ï¼ˆ0åˆ°16ä¸ªå‚æ•°ï¼‰å¹¶ä¸”ä¸è¿”å›žå€¼ã€‚å…·ä½“å½¢å¼å¦‚ä¸‹ï¼šhttps://msdn.microsoft.com/zh-cn/library/system.action(v=vs.110).aspx Func&lt;T, TResult&gt; å§”æ‰˜ï¼šå°è£…ä¸€ä¸ªå…·æœ‰å‚æ•°ï¼ˆ0åˆ°16ä¸ªå‚æ•°ï¼‰å¹¶è¿”å›ž TResult å‚æ•°æŒ‡å®šçš„ç±»åž‹å€¼çš„æ–¹æ³•ã€‚å…·ä½“å½¢å¼å¦‚ä¸‹ï¼šhttps://msdn.microsoft.com/zh-cn/library/bb534960(v=vs.110).aspx é‚£ä¹ˆè¿™Actionä¸ŽFuncæ˜¯æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Ÿ1ã€Actionï¼ˆä»¥Action&lt;T1, T2&gt; å§”æ‰˜ï¼šå°è£…ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…·æœ‰ä¸¤ä¸ªå‚æ•°å¹¶ä¸”ä¸è¿”å›žå€¼ä¸ºä¾‹ï¼‰ä»Žå¾®è½¯å…¬å¸ƒçš„æºç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¦‚ä¸‹å®žçŽ°ï¼š 1public Action&lt;bool,bool&gt; ac; ä¸Šé¢è¿™ä¸ªå£°æ˜Žå°±æ˜¯ï¼šè¯¥æ–¹æ³•å…·æœ‰ä¸¤ä¸ªå‚æ•°å¹¶ä¸”ä¸è¿”å›žå€¼çš„å§”æ‰˜ã€‚å…¶ä½™ä½¿ç”¨æ–¹å¼ä¸Žå§”æ‰˜å˜é‡ä¸€æ ·ã€‚2ã€Funcï¼ˆä»¥Func&lt;T1, T2, TResult&gt; å§”æ‰˜ï¼šå°è£…ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªå‚æ•°å¹¶è¿”å›ž TResult å‚æ•°æŒ‡å®šçš„ç±»åž‹å€¼çš„æ–¹æ³•ä¸ºä¾‹ï¼‰ä»Žå¾®è½¯å…¬å¸ƒçš„æºç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¦‚ä¸‹å®žçŽ°ï¼š æ­¤å¤„ï¼Œå¯ä»¥çœ‹å‡ºFuncä¸ŽActionæ˜¯ç±»ä¼¼çš„ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ï¼ŒFuncå¿…é¡»æŒ‡å®šè¿”å›žå€¼çš„ç±»åž‹ï¼Œä½¿ç”¨æ–¹å¼ä¸Žå§”æ‰˜å’±ä»¬è‡ªå·±ä½¿ç”¨å§”æ‰˜å˜é‡æ˜¯ä¸€æ ·çš„ï¼Œç›´æŽ¥ä½¿ç”¨ç›¸åº”å‚æ•°çš„Funcæˆ–è€…Actionå£°æ˜Žå˜é‡ï¼Œ=æˆ–è€…+=æŒ‚è½½å‡½æ•°ï¼ˆæ–¹æ³•å³å¯ï¼‰è¿™ä¸¤ä¸ªå…¶å®žè¯´ç™½äº†å°±æ˜¯ç³»ç»Ÿå®šä¹‰å¥½çš„Delegateï¼Œä»–æœ‰å¾ˆå¤šé‡è½½çš„æ–¹æ³•ï¼Œä¾¿äºŽå„ç§åº”ç”¨æƒ…å†µä¸‹çš„è°ƒç”¨ã€‚ä»–åœ¨ç³»ç»Ÿçš„Systemå‘½åç©ºé—´ä¸‹ï¼Œå› æ­¤å…¨å±€å¯è§ã€‚ ä¸‰ã€Predicateæ˜¯è¿”å›žboolåž‹çš„æ³›åž‹å§”æ‰˜ï¼ŒPredicateæœ‰ä¸”åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›žå€¼å›ºå®šä¸ºboolã€‚è¡¨ç¤ºå®šä¹‰ä¸€ç»„æ¡ä»¶å¹¶ç¡®å®šæŒ‡å®šå¯¹è±¡æ˜¯å¦ç¬¦åˆè¿™äº›æ¡ä»¶çš„æ–¹æ³•ã€‚ æ­¤æ–¹æ³•å¸¸åœ¨é›†åˆï¼ˆArray å’Œ Listï¼‰çš„æŸ¥æ‰¾ä¸­è¢«ç”¨åˆ°ï¼Œå¦‚ï¼šæ•°ç»„ï¼Œæ­£åˆ™æ‹¼é…çš„ç»“æžœé›†ä¸­è¢«ç”¨åˆ°ã€‚ å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.microsoft.com/zh-cn/dotnet/api/system.predicate-1?redirectedfrom=MSDN&amp;view=netframework-4.8 å…·ä½“ç”¨æ³•demoå¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637using System;using System.Collections.Generic;using System.ComponentModel;using System.Data;using System.Drawing;using System.Linq;using System.Text;using System.Windows.Forms; namespace IconTest&#123; public partial class Form2 : Form &#123; Predicate&lt;int&gt; myPredicate; int[] myNum = new int[8] &#123; 12, 33, 89, 21, 15, 29, 40, 52 &#125;; public int[] myResult; public Form2() &#123; InitializeComponent(); myPredicate = delegate(int curNum) &#123; if (curNum % 2 == 0) &#123; return true; &#125; else &#123; return false; &#125; &#125;; &#125; private void Form2_Load(object sender, EventArgs e) &#123; myResult = Array.FindAll(myNum, myPredicate); &#125; &#125;&#125; ä¸Šä¾‹ä¸­è¯´æ˜Žäº†Predicateçš„ä½¿ç”¨ï¼ŒFindAllæ–¹æ³•ä¸­ï¼Œå‚æ•°2å³æ˜¯ä¸€ä¸ªPredicateï¼Œåœ¨å…·ä½“çš„æ‰§è¡Œä¸­ï¼Œæ¯ä¸€ä¸ªæ•°ç»„çš„å…ƒç´ éƒ½ä¼šæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ï¼Œå¦‚æžœæ»¡è¶³è¦æ±‚è¿”å›žtrueï¼Œå¹¶ä¼šè¢«å­˜æ”¾åœ¨ç»“æžœé›†ä¸­ï¼Œä¸ç¬¦åˆçš„åˆ™è¢«å‰”é™¤ï¼Œæœ€ç»ˆè¿”å›žçš„é›†åˆï¼Œå³æ˜¯ç»“æžœåˆ¤æ–­åŽæƒ³è¦çš„é›†åˆã€‚Array.FindAll æ³›åž‹æ–¹æ³•ï¼šhttps://docs.microsoft.com/zh-cn/dotnet/api/system.array.findall?redirectedfrom=MSDN&amp;view=netframework-4.8#System_Array_FindAll__1___0___System_Predicate___0__ä»¥ä¸Šä»£ç æ‰§è¡Œç»“æžœä¸ºï¼šé‚£ä¹ˆPredicateä¸Žå§”æ‰˜åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ ä»Žå¾®è½¯æºç ä¸­å¯ä»¥çœ‹å‡ºPredicateæ˜¯è¿”å›žboolåž‹çš„æ³›åž‹å§”æ‰˜ï¼Œä»Žæœ¬è´¨ä¸Šæ¥è¯´ä¸ŽFuncã€Actionã€äº‹ä»¶ã€å§”æ‰˜å˜é‡å¹¶æ— æœ¬è´¨åŒºåˆ«ã€‚ å››ã€èµ„æ–™å‚è€ƒæ–‡ç« ï¼šhttp://www.zhihu.com/question/28932542 å…³äºŽäº‹ä»¶éƒ¨åˆ†åº”ç”¨æ³¨æ„å¯ä»¥å‚è€ƒï¼šhttp://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html .NET Framework æºç ï¼šhttps://referencesource.microsoft.comDelegate ç±»:https://docs.microsoft.com/zh-cn/dotnet/api/system.delegate?redirectedfrom=MSDN&amp;view=netframework-4.8]]></content>
      <categories>
        <category>C#</category>
      </categories>
      <tags>
        <tag>C#</tag>
        <tag>Delegate</tag>
        <tag>Action</tag>
        <tag>Predicate</tag>
      </tags>
  </entry>
</search>
