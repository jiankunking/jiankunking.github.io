<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å¦‚ä½•æ­£ç¡®ä½¿ç”¨ Context</title>
      <link href="/how-to-correctly-use-package-context.html"/>
      <url>/how-to-correctly-use-package-context.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>Golang Context</p></blockquote><a id="more"></a><h1 id="è§†é¢‘ä¿¡æ¯"><a href="#è§†é¢‘ä¿¡æ¯" class="headerlink" title="è§†é¢‘ä¿¡æ¯"></a>è§†é¢‘ä¿¡æ¯</h1><p>How to correctly use package context<br>by Jack Lindamood<br>at Golang UK Conf. 2017</p><p>è§†é¢‘ï¼š<a href="https://www.youtube.com/watch?v=-_B5uQ4UGi0" target="_blank" rel="noopener">https://www.youtube.com/watch?v=-_B5uQ4UGi0</a><br>åšæ–‡ï¼š<a href="https://medium.com/@cep21/how-to-correctly-use-context-context-in-go-1-7-8f2c0fafdf39" target="_blank" rel="noopener">https://medium.com/@cep21/how-to-correctly-use-context-context-in-go-1-7-8f2c0fafdf39</a></p><h1 id="ä¸ºä»€ä¹ˆéœ€è¦-Context"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-Context" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ Context"></a>ä¸ºä»€ä¹ˆéœ€è¦ Context</h1><ul><li>æ¯ä¸€ä¸ª<font color="DeepPink">é•¿è¯·æ±‚</font>éƒ½åº”è¯¥æœ‰ä¸ª<font color="DeepPink">è¶…æ—¶é™åˆ¶</font></li><li>éœ€è¦åœ¨è°ƒç”¨ä¸­ä¼ é€’è¿™ä¸ªè¶…æ—¶<ul><li>æ¯”å¦‚å¼€å§‹å¤„ç†è¯·æ±‚çš„æ—¶å€™æˆ‘ä»¬è¯´æ˜¯ 3 ç§’é’Ÿè¶…æ—¶</li><li>é‚£ä¹ˆåœ¨å‡½æ•°è°ƒç”¨ä¸­é—´ï¼Œè¿™ä¸ªè¶…æ—¶è¿˜å‰©å¤šå°‘æ—¶é—´äº†ï¼Ÿ</li><li>éœ€è¦åœ¨ä»€ä¹ˆåœ°æ–¹å­˜å‚¨è¿™ä¸ªä¿¡æ¯ï¼Œè¿™æ ·è¯·æ±‚å¤„ç†ä¸­é—´å¯ä»¥åœæ­¢</li></ul></li></ul><p>å¦‚æœè¿›ä¸€æ­¥è€ƒè™‘ã€‚<br><img alt data-src="/images/how-to-correctly-use-package-context/rpc-fails-1.svg"><br>å¦‚ä¸Šå›¾è¿™æ ·çš„ RPC è°ƒç”¨ï¼Œå¼€å§‹è°ƒç”¨ RPC 1 åï¼Œé‡Œé¢åˆ†åˆ«è°ƒç”¨äº† RPC 2, RPC 3, RPC 4ï¼Œç­‰æ‰€æœ‰ RPC ç”¨æˆåŠŸåï¼Œè¿”å›ç»“æœã€‚</p><p>è¿™æ˜¯æ­£å¸¸çš„æ–¹å¼ï¼Œä½†æ˜¯å¦‚æœ RPC 2 è°ƒç”¨å¤±è´¥äº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ<br><img alt data-src="/images/how-to-correctly-use-package-context/rpc-fails-2.svg"></p><p>RPC 2 å¤±è´¥åï¼Œå¦‚æœæ²¡æœ‰ Context çš„å­˜åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½ä¾æ—§ä¼šç­‰æ‰€æœ‰çš„ RPC æ‰§è¡Œå®Œæ¯•ï¼Œä½†æ˜¯ç”±äº RPC 2 è´¥äº†ï¼Œæ‰€ä»¥å…¶å®å…¶å®ƒçš„ RPC ç»“æœæ„ä¹‰ä¸å¤§äº†ï¼Œæˆ‘ä»¬ä¾æ—§éœ€è¦ç»™ç”¨æˆ·è¿”å›é”™è¯¯ã€‚å› æ­¤æˆ‘ä»¬ç™½ç™½çš„æµªè´¹äº† 10msï¼Œå®Œå…¨æ²¡å¿…è¦å»ç­‰å¾…å…¶å®ƒ RPC æ‰§è¡Œå®Œæ¯•ã€‚</p><p>é‚£å¦‚æœæˆ‘ä»¬åœ¨ RPC 2 å¤±è´¥åï¼Œå°±ç›´æ¥ç»™ç”¨æˆ·è¿”å›å¤±è´¥å‘¢ï¼Ÿ<br><img alt data-src="/images/how-to-correctly-use-package-context/rpc-fails-3.svg"><br>ç”¨æˆ·æ˜¯åœ¨ 30ms çš„ä½ç½®æ”¶åˆ°äº†é”™è¯¯æ¶ˆæ¯ï¼Œå¯æ˜¯ RPC 3 å’Œ RPC 4 ä¾ç„¶åœ¨æ²¡æ„ä¹‰çš„è¿è¡Œï¼Œè¿˜åœ¨æµªè´¹è®¡ç®—å’ŒIOèµ„æºã€‚<br><img alt data-src="/images/how-to-correctly-use-package-context/rpc-fails-4.svg"></p><p>æ‰€ä»¥ç†æƒ³çŠ¶æ€åº”è¯¥æ˜¯å¦‚ä¸Šå›¾ï¼Œå½“ RPC 2 å‡ºé”™åï¼Œé™¤äº†è¿”å›ç”¨æˆ·é”™è¯¯ä¿¡æ¯å¤–ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥æœ‰æŸç§æ–¹å¼å¯ä»¥é€šçŸ¥ RPC 3 å’Œ RPC 4ï¼Œè®©ä»–ä»¬ä¹Ÿåœæ­¢è¿è¡Œï¼Œä¸å†æµªè´¹èµ„æºã€‚</p><p>æ‰€ä»¥è§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼š</p><ul><li>ç”¨ä¿¡å·çš„æ–¹å¼æ¥é€šçŸ¥è¯·æ±‚è¯¥åœäº†</li><li>åŒ…å«ä¸€äº›å…³äºä»€ä¹ˆæ—¶é—´è¯·æ±‚å¯èƒ½ä¼šç»“æŸçš„æç¤ºï¼ˆè¶…æ—¶ï¼‰</li><li>ç”¨ channel æ¥é€šçŸ¥è¯·æ±‚ç»“æŸäº†</li></ul><p>é‚£å¹²è„†è®©æˆ‘ä»¬æŠŠå˜é‡ä¹Ÿæ‰”é‚£å§ã€‚ğŸ˜ˆ</p><ul><li>åœ¨ Go ä¸­æ²¡æœ‰çº¿ç¨‹/go routine å˜é‡<ul><li>å…¶å®æŒºåˆç†çš„ï¼Œå› ä¸ºè¿™æ ·å°±ä¼šè®© goroutine äº’ç›¸äº§ç”Ÿä¾èµ–</li></ul></li><li><font color="DeepPink">éå¸¸å®¹æ˜“è¢«æ»¥ç”¨</font></li></ul><h1 id="Context-å®ç°ç»†èŠ‚"><a href="#Context-å®ç°ç»†èŠ‚" class="headerlink" title="Context å®ç°ç»†èŠ‚"></a>Context å®ç°ç»†èŠ‚</h1><p>context.Contextï¼š</p><ul><li>æ˜¯ä¸å¯å˜çš„(immutable)æ ‘èŠ‚ç‚¹</li><li>Cancel ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¼šè¿å¸¦ Cancel å…¶æ‰€æœ‰å­èŠ‚ç‚¹ ï¼ˆ<font color="DeepPink">ä»ä¸Šåˆ°ä¸‹</font>ï¼‰</li><li>Context values æ˜¯ä¸€ä¸ªèŠ‚ç‚¹</li><li>Value æŸ¥æ‰¾æ˜¯å›æº¯æ ‘çš„æ–¹å¼ ï¼ˆ<font color="DeepPink">ä»ä¸‹åˆ°ä¸Š</font>ï¼‰</li></ul><h2 id="ç¤ºä¾‹-Context-é“¾"><a href="#ç¤ºä¾‹-Context-é“¾" class="headerlink" title="ç¤ºä¾‹ Context é“¾"></a>ç¤ºä¾‹ Context é“¾</h2><p>å®Œæ•´ä»£ç ï¼š<a href="https://play.golang.org/p/ddpofBV1QS" target="_blank" rel="noopener">https://play.golang.org/p/ddpofBV1QS</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line">func tree() &#123;</span><br><span class="line">  ctx1 := context.Background()</span><br><span class="line">  ctx2, _ := context.WithCancel(ctx1)</span><br><span class="line">  ctx3, _ := context.WithTimeout(ctx2, time.Second * 5)</span><br><span class="line">  ctx4, _ := context.WithTimeout(ctx3, time.Second * 3)</span><br><span class="line">  ctx5, _ := context.WithTimeout(ctx3, time.Second * 6)</span><br><span class="line">  ctx6 := context.WithValue(ctx5, &quot;userID&quot;, 12)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™æ ·æ„æˆçš„ Context é“¾ï¼Œå…¶å½¢å¦‚ä¸‹å›¾ï¼š<br><img alt data-src="/images/how-to-correctly-use-package-context/context-chain-1.svg"><br>é‚£ä¹ˆå½“ 3 ç§’è¶…æ—¶åˆ°äº†æ—¶å€™ï¼š<br><img alt data-src="/images/how-to-correctly-use-package-context/context-chain-2.svg"><br>å¯ä»¥çœ‹åˆ° ctx4 è¶…æ—¶é€€å‡ºäº†ã€‚</p><p>å½“ 5ç§’é’Ÿ è¶…æ—¶åˆ°è¾¾æ—¶ï¼š<br><img alt data-src="/images/how-to-correctly-use-package-context/context-chain-3.svg"><br>å¯ä»¥çœ‹åˆ°ï¼Œä¸ä»…ä»… ctx3 é€€å‡ºäº†ï¼Œå…¶æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œæ¯”å¦‚ ctx5 å’Œ ctx6 ä¹Ÿéƒ½é€€å‡ºäº†ã€‚</p><h2 id="context-Context-API"><a href="#context-Context-API" class="headerlink" title="context.Context API"></a>context.Context API</h2><p>åŸºæœ¬ä¸Šæ˜¯ä¸¤ç±»æ“ä½œï¼š</p><ul><li>3ä¸ªå‡½æ•°ç”¨äº<font color="DeepPink">é™å®šä»€ä¹ˆæ—¶å€™ä½ çš„å­èŠ‚ç‚¹é€€å‡º</font>ï¼›</li><li>1ä¸ªå‡½æ•°ç”¨äº<font color="DeepPink">è®¾ç½®è¯·æ±‚èŒƒç•´çš„å˜é‡</font><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type Context interface &#123;</span><br><span class="line">  //  å•¥æ—¶å€™é€€å‡º</span><br><span class="line">  Deadline() (deadline time.Time, ok bool)</span><br><span class="line">  Done() &lt;-chan struct&#123;&#125;</span><br><span class="line">  Err() error</span><br><span class="line">  //  è®¾ç½®å˜é‡</span><br><span class="line">  Value(key interface&#123;&#125;) interface&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨-Contextï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨-Contextï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ Contextï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ Contextï¼Ÿ</h2><ul><li>æ¯ä¸€ä¸ª RPC è°ƒç”¨éƒ½åº”è¯¥æœ‰<font color="DeepPink">è¶…æ—¶é€€å‡º</font>çš„èƒ½åŠ›ï¼Œè¿™æ˜¯æ¯”è¾ƒåˆç†çš„ API è®¾è®¡</li><li><font color="DeepPink">ä¸ä»…ä»…</font> æ˜¯è¶…æ—¶ï¼Œä½ è¿˜éœ€è¦æœ‰èƒ½åŠ›å»ç»“æŸé‚£äº›ä¸å†éœ€è¦æ“ä½œçš„è¡Œä¸º</li><li>context.Context æ˜¯ Go æ ‡å‡†çš„è§£å†³æ–¹æ¡ˆ</li><li>ä»»ä½•å‡½æ•°å¯èƒ½è¢«é˜»å¡ï¼Œæˆ–è€…éœ€è¦å¾ˆé•¿æ—¶é—´æ¥å®Œæˆçš„ï¼Œéƒ½åº”è¯¥æœ‰ä¸ª context.Context</li></ul><h2 id="å¦‚ä½•åˆ›å»º-Contextï¼Ÿ"><a href="#å¦‚ä½•åˆ›å»º-Contextï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ›å»º Contextï¼Ÿ"></a>å¦‚ä½•åˆ›å»º Contextï¼Ÿ</h2><ul><li>åœ¨ RPC å¼€å§‹çš„æ—¶å€™ï¼Œä½¿ç”¨ context.Background()<ul><li>æœ‰äº›äººæŠŠåœ¨ main() é‡Œè®°å½•ä¸€ä¸ª context.Background()ï¼Œç„¶åæŠŠè¿™ä¸ªæ”¾åˆ°æœåŠ¡å™¨çš„æŸä¸ªå˜é‡é‡Œï¼Œç„¶åè¯·æ±‚æ¥äº†åä»è¿™ä¸ªå˜é‡é‡Œç»§æ‰¿ contextã€‚è¿™ä¹ˆåšæ˜¯<font color="DeepPink">ä¸å¯¹çš„</font>ã€‚ç›´æ¥æ¯ä¸ªè¯·æ±‚ï¼Œæºè‡ªè‡ªå·±çš„ context.Background() å³å¯ã€‚</li></ul></li><li>å¦‚æœä½ æ²¡æœ‰ contextï¼Œå´éœ€è¦è°ƒç”¨ä¸€ä¸ª context çš„å‡½æ•°çš„è¯ï¼Œç”¨ context.TODO()</li><li>å¦‚æœæŸæ­¥æ“ä½œéœ€è¦è‡ªå·±çš„è¶…æ—¶è®¾ç½®çš„è¯ï¼Œç»™å®ƒä¸€ä¸ªç‹¬ç«‹çš„ sub-contextï¼ˆå¦‚å‰é¢çš„ä¾‹å­ï¼‰</li></ul><h2 id="å¦‚ä½•é›†æˆåˆ°-API-é‡Œï¼Ÿ"><a href="#å¦‚ä½•é›†æˆåˆ°-API-é‡Œï¼Ÿ" class="headerlink" title="å¦‚ä½•é›†æˆåˆ° API é‡Œï¼Ÿ"></a>å¦‚ä½•é›†æˆåˆ° API é‡Œï¼Ÿ</h2><ul><li>å¦‚æœæœ‰ Contextï¼Œ<font color="DeepPink">å°†å…¶ä½œä¸ºç¬¬ä¸€ä¸ªå˜é‡</font>ã€‚<ul><li>å¦‚ func (d* Dialer) DialContext(ctx context.Context, network, address string) (Conn, error)</li><li>æœ‰äº›äººæŠŠ context æ”¾åˆ°ä¸­é—´çš„æŸä¸ªå˜é‡é‡Œå»ï¼Œè¿™å¾ˆä¸åˆä¹ æƒ¯ï¼Œä¸è¦é‚£ä¹ˆåšï¼Œæ”¾åˆ°ç¬¬ä¸€ä¸ªå»ã€‚</li></ul></li><li>å°†å…¶ä½œä¸º<font color="DeepPink">å¯é€‰çš„</font>æ–¹å¼ï¼Œç”¨ request ç»“æ„ä½“æ–¹å¼ã€‚<ul><li>å¦‚ï¼šfunc (r *Request) WithContext(ctx context.Context) *Request</li></ul></li><li>Context çš„å˜é‡åè¯·ç”¨ ctxï¼ˆä¸è¦èµ·ä¸€äº›è¯¡å¼‚çš„åå­—ğŸ˜“ï¼‰</li></ul><h2 id="Context-æ”¾å“ªï¼Ÿ"><a href="#Context-æ”¾å“ªï¼Ÿ" class="headerlink" title="Context æ”¾å“ªï¼Ÿ"></a>Context æ”¾å“ªï¼Ÿ</h2><ul><li>æŠŠ Context æƒ³è±¡ä¸ºä¸€æ¡æ²³æµæµè¿‡ä½ çš„ç¨‹åºï¼ˆå¦ä¸€ä¸ªæ„æ€å°±æ˜¯è¯´ä¸è¦å–æ²³é‡Œçš„æ°´â€¦â€¦ğŸ™Šï¼‰</li><li>ç†æƒ³æƒ…å†µä¸‹ï¼ŒContext å­˜åœ¨äºè°ƒç”¨æ ˆï¼ˆCall Stackï¼‰ ä¸­</li><li>ä¸è¦æŠŠ Context å­˜å‚¨åˆ°ä¸€ä¸ª struct é‡Œ<ul><li>é™¤éä½ ä½¿ç”¨çš„æ˜¯åƒ http.Request ä¸­çš„ request ç»“æ„ä½“çš„æ–¹å¼</li></ul></li><li>request ç»“æ„ä½“åº”è¯¥ä»¥ Request ç»“æŸä¸ºç”Ÿå‘½ç»ˆæ­¢</li><li>å½“ RPC è¯·æ±‚å¤„ç†ç»“æŸåï¼Œåº”è¯¥å»æ‰å¯¹ Context å˜é‡çš„å¼•ç”¨ï¼ˆUnreferenceï¼‰</li><li>Request ç»“æŸï¼ŒContext å°±åº”è¯¥ç»“æŸã€‚ï¼ˆè¿™ä¿©æ˜¯ä¸€å¯¹å„¿ï¼Œä¸æ±‚åŒå¹´åŒæœˆåŒæ—¥ç”Ÿï¼Œä½†æ±‚åŒå¹´åŒæœˆåŒæ—¥æ­»â€¦â€¦ğŸ’•ï¼‰</li></ul><h2 id="Context-åŒ…çš„æ³¨æ„äº‹é¡¹"><a href="#Context-åŒ…çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="Context åŒ…çš„æ³¨æ„äº‹é¡¹"></a>Context åŒ…çš„æ³¨æ„äº‹é¡¹</h2><ul><li><p>è¦å…»æˆå…³é—­ Context çš„ä¹ æƒ¯</p><ul><li><font color="DeepPink">ç‰¹åˆ«æ˜¯</font> è¶…æ—¶çš„ Contexts</li></ul></li><li><p>å¦‚æœä¸€ä¸ª context è¢« GC è€Œä¸æ˜¯ cancel äº†ï¼Œé‚£ä¸€èˆ¬æ˜¯ä½ åšé”™äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctx, cancel := context.WithTimeout(parentCtx, time.Second * 2)</span><br><span class="line">defer cancel()</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ Timeout ä¼šå¯¼è‡´å†…éƒ¨ä½¿ç”¨ time.AfterFuncï¼Œä»è€Œä¼šå¯¼è‡´ context åœ¨è®¡æ—¶å™¨åˆ°æ—¶ä¹‹å‰éƒ½ä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚</p></li><li><p>åœ¨å»ºç«‹ä¹‹åï¼Œç«‹å³ defer cancel() æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚</p></li></ul><h2 id="ç»ˆæ­¢è¯·æ±‚-Request-Cancellation"><a href="#ç»ˆæ­¢è¯·æ±‚-Request-Cancellation" class="headerlink" title="ç»ˆæ­¢è¯·æ±‚ (Request Cancellation)"></a>ç»ˆæ­¢è¯·æ±‚ (Request Cancellation)</h2><p>å½“ä½ ä¸å†å…³å¿ƒæ¥ä¸‹æ¥è·å–çš„ç»“æœçš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼š Cancel ä¸€ä¸ª Contextï¼Ÿ</p><p>ä»¥ golang.org/x/sync/errgroup ä¸ºä¾‹ï¼Œerrgroup ä½¿ç”¨ Context æ¥æä¾› RPC çš„ç»ˆæ­¢è¡Œä¸ºã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type Group struct &#123;</span><br><span class="line">cancel  func()</span><br><span class="line">wg      sync.WaitGroup</span><br><span class="line">errOnce sync.Once</span><br><span class="line">err     error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ª group å’Œ contextï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">func WithContext(ctx context.Context) (*Group, context.Context) &#123;</span><br><span class="line">  ctx, cancel := context.WithCancel(ctx)</span><br><span class="line">  return &amp;Group&#123;cancel: cancel&#125;, ctx</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±è¿”å›äº†ä¸€ä¸ªå¯ä»¥è¢«æå‰ cancel çš„ groupã€‚</p><p>è€Œè°ƒç”¨çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯ç›´æ¥è°ƒç”¨ go func()ï¼Œè€Œæ˜¯è°ƒç”¨ Go()ï¼Œå°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ è¿›å»ï¼Œç”¨é«˜é˜¶å‡½æ•°çš„å½¢å¼æ¥è°ƒç”¨ï¼Œå…¶å†…éƒ¨æ‰æ˜¯ go func() å¼€å¯ goroutineã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">func (g *Group) Go(f func() error) &#123;</span><br><span class="line">  g.wg.Add(1)</span><br><span class="line">  go func() &#123;</span><br><span class="line">    defer g.wg.Done()</span><br><span class="line">    if err := f(); err != nil &#123;</span><br><span class="line">      g.errOnce.Do(func() &#123;</span><br><span class="line">        g.err = err</span><br><span class="line">        if g.cancel != nil &#123;</span><br><span class="line">          g.cancel()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç»™å…¥å‡½æ•° f è¿”å›é”™è¯¯ï¼Œåˆ™ä½¿ç”¨ sync.Once æ¥ cancel contextï¼Œè€Œé”™è¯¯è¢«ä¿å­˜äº g.err ä¹‹ä¸­ï¼Œåœ¨éšåçš„ Wait() å‡½æ•°ä¸­è¿”å›ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func (g *Group) Wait() error &#123;</span><br><span class="line">  g.wg.Wait()</span><br><span class="line">  if g.cancel != nil &#123;</span><br><span class="line">    g.cancel()</span><br><span class="line">  &#125;</span><br><span class="line">  return g.err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¿™é‡Œåœ¨ Wait() ç»“æŸåï¼Œè°ƒç”¨äº†ä¸€æ¬¡ cancel()ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line">func DoTwoRequestsAtOnce(ctx context.Context) error &#123;</span><br><span class="line">  eg, egCtx := errgroup.WithContext(ctx)</span><br><span class="line">  var resp1, resp2 *http.Response</span><br><span class="line">  f := func(loc string, respIn **http.Response) func() error &#123;</span><br><span class="line">    return func() error &#123;</span><br><span class="line">      reqCtx, cancel := context.WithTimeout(egCtx, time.Second)</span><br><span class="line">      defer cancel()</span><br><span class="line">      req, _ := http.NewRequest(&quot;GET&quot;, loc, nil)</span><br><span class="line">      var err error</span><br><span class="line">      *respIn, err = http.DefaultClient.Do(req.WithContext(reqCtx))</span><br><span class="line">      if err == nil &amp;&amp; (*respIn).StatusCode &gt;= 500 &#123;</span><br><span class="line">        return errors.New(&quot;unexpected!&quot;)</span><br><span class="line">      &#125;</span><br><span class="line">      return err</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  eg.Go(f(&quot;http://localhost:8080/fast_request&quot;, &amp;resp1))</span><br><span class="line">  eg.Go(f(&quot;http://localhost:8080/slow_request&quot;, &amp;resp2))</span><br><span class="line">  return eg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåŒæ—¶å‘èµ·äº†ä¸¤ä¸ª RPC è°ƒç”¨ï¼Œå½“ä»»ä½•ä¸€ä¸ªè°ƒç”¨è¶…æ—¶æˆ–è€…å‡ºé”™åï¼Œä¼šç»ˆæ­¢å¦ä¸€ä¸ª RPC è°ƒç”¨ã€‚è¿™é‡Œå°±æ˜¯åˆ©ç”¨å‰é¢è®²åˆ°çš„ errgroup æ¥å®ç°çš„ï¼Œåº”å¯¹æœ‰å¾ˆå¤šå¹¶éè¯·æ±‚ï¼Œå¹¶éœ€è¦é›†ä¸­å¤„ç†è¶…æ—¶ã€å‡ºé”™ç»ˆæ­¢å…¶å®ƒå¹¶å‘ä»»åŠ¡çš„æ—¶å€™ï¼Œè¿™ä¸ª pattern ä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ã€‚</p><h2 id="Context-Value-Request-èŒƒç•´çš„å€¼"><a href="#Context-Value-Request-èŒƒç•´çš„å€¼" class="headerlink" title="Context.Value - Request èŒƒç•´çš„å€¼"></a>Context.Value - Request èŒƒç•´çš„å€¼</h2><h3 id="context-Value-API-çš„ä¸‡é‡‘æ²¹ï¼ˆduct-tape"><a href="#context-Value-API-çš„ä¸‡é‡‘æ²¹ï¼ˆduct-tape" class="headerlink" title="context.Value API çš„ä¸‡é‡‘æ²¹ï¼ˆduct tape)"></a>context.Value API çš„ä¸‡é‡‘æ²¹ï¼ˆduct tape)</h3><p>èƒ¶å¸¦ï¼ˆduct tape) å‡ ä¹å¯ä»¥ä¿®ä»»ä½•ä¸œè¥¿ï¼Œä»ç ´ç®±å­ï¼Œåˆ°äººçš„ä¼¤å£ï¼Œåˆ°æ±½è½¦å¼•æ“ï¼Œç”šè‡³åˆ°NASAç™»æœˆä»»åŠ¡ä¸­çš„é˜¿æ³¢ç½—13å·é£èˆ¹ï¼ˆYeah! True Story)ã€‚æ‰€ä»¥åœ¨è¥¿æ–¹æ–‡åŒ–é‡Œï¼Œèƒ¶å¸¦æ˜¯ä¸ªâ€œä¸‡èƒ½â€çš„ä¸œè¥¿ã€‚åœ¨ä¸­æ–‡é‡Œï¼Œææ€•ä¸‡é‡‘æ²¹æ˜¯æ›´åˆé€‚çš„å¯¹åº”è¯æ±‡ï¼Œä»å¤´ç–¼ã€è„‘çƒ­ï¼Œæ„Ÿå†’å‘çƒ§ï¼Œåˆ°è·Œæ‰“æŸä¼¤å‡ ä¹æ— æ‰€ä¸æ²»ã€‚</p><p>å½“ç„¶ï¼Œ<font color="DeepPink">æ²»æ ‡ä¸æ²»æœ¬</font>ï¼Œè¿™ç‚¹ä¸œè¥¿æ–¹æ–‡åŒ–ä¸­çš„æ½œå°è¯éƒ½æ˜¯ä¸€æ ·çš„ã€‚è¿™é‡ŒæåŠçš„ context.Value å¯¹äº API è€Œè¨€ï¼Œå°±æ˜¯è¿™ç±»æ€§è´¨çš„ä¸œè¥¿ï¼Œå•¥éƒ½å¯ä»¥å¹²ï¼Œä½†æ˜¯æ²»æ ‡ä¸æ²»æœ¬ã€‚</p><ul><li>value èŠ‚ç‚¹æ˜¯ Context é“¾ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package context</span><br><span class="line">type valueCtx struct &#123;</span><br><span class="line">  Context</span><br><span class="line">  key, val interface&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">func WithValue(parent Context, key, val interface&#123;&#125;) Context &#123;</span><br><span class="line">  //  ...</span><br><span class="line">  return &amp;valueCtx&#123;parent, key, val&#125;</span><br><span class="line">&#125;</span><br><span class="line">func (c *valueCtx) Value(key interface&#123;&#125;) interface&#123;&#125; &#123;</span><br><span class="line">  if c.key == key &#123;</span><br><span class="line">    return c.val</span><br><span class="line">  &#125;</span><br><span class="line">  return c.Context.Value(key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>å¯ä»¥çœ‹åˆ°ï¼ŒWithValue() å®é™…ä¸Šå°±æ˜¯åœ¨ Context æ ‘å½¢ç»“æ„ä¸­ï¼Œå¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ç½¢äº†ã€‚</p><p>Context æ˜¯ immutable çš„ã€‚</p><h3 id="çº¦æŸ-key-çš„ç©ºé—´"><a href="#çº¦æŸ-key-çš„ç©ºé—´" class="headerlink" title="çº¦æŸ key çš„ç©ºé—´"></a>çº¦æŸ key çš„ç©ºé—´</h3><p>ä¸ºäº†é˜²æ­¢æ ‘å½¢ç»“æ„ä¸­å‡ºç°é‡å¤çš„é”®ï¼Œå»ºè®®çº¦æŸé”®çš„ç©ºé—´ã€‚æ¯”å¦‚ä½¿ç”¨ç§æœ‰ç±»å‹ï¼Œç„¶åç”¨ GetXxx() å’Œ WithXxxx() æ¥æ“ä½œç§æœ‰å®ä½“ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">type privateCtxType string</span><br><span class="line">var (</span><br><span class="line">  reqID = privateCtxType(&quot;req-id&quot;)</span><br><span class="line">)</span><br><span class="line">func GetRequestID(ctx context.Context) (int, bool) &#123;</span><br><span class="line">  id, exists := ctx.Value(reqID).(int)</span><br><span class="line">  return id, exists</span><br><span class="line">&#125;</span><br><span class="line">func WithRequestID(ctx context.Context, reqid int) context.Context &#123;</span><br><span class="line">  return context.WithValue(ctx, reqID, reqid)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨ WithXxx è€Œä¸æ˜¯ SetXxx ä¹Ÿæ˜¯å› ä¸º Context å®é™…ä¸Šæ˜¯ immutable çš„ï¼Œæ‰€ä»¥ä¸æ˜¯ä¿®æ”¹ Context é‡ŒæŸä¸ªå€¼ï¼Œè€Œæ˜¯äº§ç”Ÿæ–°çš„ Context <font color="DeepPink">å¸¦æŸä¸ªå€¼</font>ã€‚</p><h3 id="Context-Value-æ˜¯-immutable-çš„"><a href="#Context-Value-æ˜¯-immutable-çš„" class="headerlink" title="Context.Value æ˜¯ immutable çš„"></a>Context.Value æ˜¯ immutable çš„</h3><p>å†å¤šæ¬¡çš„å¼ºè°ƒ Context.Value æ˜¯ <font color="DeepPink">immutable</font> çš„ä¹Ÿä¸è¿‡åˆ†ã€‚</p><ul><li>context.Context ä»è®¾è®¡ä¸Šå°±æ˜¯æŒ‰ç…§ immutable ï¼ˆä¸å¯å˜çš„ï¼‰æ¨¡å¼è®¾è®¡çš„</li><li>åŒæ ·ï¼ŒContext.Value ä¹Ÿæ˜¯ immutable çš„</li><li>ä¸è¦è¯•å›¾åœ¨ Context.Value é‡Œå­˜æŸä¸ªå¯å˜æ›´çš„å€¼ï¼Œç„¶åæ”¹å˜ï¼ŒæœŸæœ›åˆ«çš„ Context å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ”¹å˜<ul><li>æ›´åˆ«æŒ‡æœ›ç€åœ¨ Context.Value é‡Œå­˜å¯å˜çš„å€¼ï¼Œæœ€åå¤šä¸ª goroutine å¹¶å‘è®¿é—®æ²¡ç«äº‰å†’é™©å•¥çš„ï¼Œå› ä¸ºè‡ªå§‹è‡³ç»ˆï¼Œå°±æ˜¯æŒ‰ç…§ä¸å¯å˜æ¥è®¾è®¡çš„</li><li>æ¯”å¦‚è®¾ç½®äº†è¶…æ—¶ï¼Œå°±åˆ«ä»¥ä¸ºå¯ä»¥æ”¹å˜è¿™ä¸ªè®¾ç½®çš„è¶…æ—¶å€¼</li></ul></li><li>åœ¨ä½¿ç”¨ Context.Value çš„æ—¶å€™ï¼Œä¸€å®šè¦è®°ä½è¿™ä¸€ç‚¹</li></ul><h3 id="åº”è¯¥æŠŠä»€ä¹ˆæ”¾åˆ°-Context-Value-é‡Œï¼Ÿ"><a href="#åº”è¯¥æŠŠä»€ä¹ˆæ”¾åˆ°-Context-Value-é‡Œï¼Ÿ" class="headerlink" title="åº”è¯¥æŠŠä»€ä¹ˆæ”¾åˆ° Context.Value é‡Œï¼Ÿ"></a>åº”è¯¥æŠŠä»€ä¹ˆæ”¾åˆ° Context.Value é‡Œï¼Ÿ</h3><ul><li>åº”è¯¥ä¿å­˜ Request èŒƒç•´çš„å€¼<ul><li>ä»»ä½•å…³äº Context è‡ªèº«çš„éƒ½æ˜¯ Request èŒƒç•´çš„ï¼ˆè¿™ä¿©åŒç”Ÿå…±æ­»ï¼‰</li><li>ä» Request æ•°æ®è¡ç”Ÿå‡ºæ¥ï¼Œå¹¶ä¸”éšç€ Request çš„ç»“æŸè€Œç»ˆç»“</li></ul></li></ul><h3 id="ä»€ä¹ˆä¸œè¥¿ä¸å±äº-Request-èŒƒç•´ï¼Ÿ"><a href="#ä»€ä¹ˆä¸œè¥¿ä¸å±äº-Request-èŒƒç•´ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆä¸œè¥¿ä¸å±äº Request èŒƒç•´ï¼Ÿ"></a>ä»€ä¹ˆä¸œè¥¿ä¸å±äº Request èŒƒç•´ï¼Ÿ</h3><ul><li>åœ¨ Request ä»¥å¤–å»ºç«‹çš„ï¼Œå¹¶ä¸”ä¸éšç€ Request æ”¹å˜è€Œå˜åŒ–<ul><li>æ¯”å¦‚ä½  func main() é‡Œå»ºç«‹çš„ä¸œè¥¿æ˜¾ç„¶ä¸å±äº Request èŒƒç•´</li></ul></li><li>æ•°æ®åº“è¿æ¥<ul><li>å¦‚æœ User ID åœ¨è¿æ¥é‡Œå‘¢ï¼Ÿ(ç¨åä¼šæåŠ)</li></ul></li><li>å…¨å±€ logger<ul><li>å¦‚æœ logger é‡Œéœ€è¦æœ‰ User ID å‘¢ï¼Ÿï¼ˆç¨åä¼šæåŠï¼‰</li></ul></li></ul><h3 id="é‚£ä¹ˆç”¨-Context-Value-æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#é‚£ä¹ˆç”¨-Context-Value-æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="é‚£ä¹ˆç”¨ Context.Value æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>é‚£ä¹ˆç”¨ Context.Value æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><ul><li>ä¸å¹¸çš„æ˜¯ï¼Œå¥½åƒæ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯ç”±è¯·æ±‚è¡ç”Ÿå‡ºæ¥çš„</li><li>é‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜éœ€è¦å‡½æ•°å‚æ•°ï¼Ÿç„¶åå¹²è„†åªæ¥ä¸€ä¸ª Context å°±å®Œäº†ï¼Ÿ<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func Add(ctx context.Context) int &#123;</span><br><span class="line">  return ctx.Value(&quot;first&quot;).(int) + ctx.Value(&quot;second&quot;).(int)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>æ›¾ç»çœ‹åˆ°è¿‡ä¸€ä¸ª APIï¼Œå°±æ˜¯è¿™ç§å½¢å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">func IsAdminUser(ctx context.Context) bool &#123;</span><br><span class="line">  userID := GetUser(ctx)</span><br><span class="line">  return authSingleton.IsAdmin(userID)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒAPIå®ç°å†…éƒ¨ä» context ä¸­å–å¾— UserIDï¼Œç„¶åå†è¿›è¡Œæƒé™åˆ¤æ–­ã€‚ä½†æ˜¯ä»å‡½æ•°ç­¾åçœ‹ï¼Œåˆ™å®Œå…¨æ— æ³•ç†è§£è¿™ä¸ªå‡½æ•°å…·ä½“éœ€è¦ä»€ä¹ˆã€ä»¥åŠåšä»€ä¹ˆã€‚</p><blockquote><p>ä»£ç è¦ä»¥å¯è¯»æ€§ä¸ºä¼˜å…ˆè®¾è®¡è€ƒè™‘ã€‚</p></blockquote><p>åˆ«äººæ‹¿åˆ°ä¸€ä¸ªä»£ç ï¼Œä¸€èˆ¬ä¸æ˜¯æ‰è¿›å‡½æ•°å®ç°ç»†èŠ‚é‡Œå»ä¸€è¡Œè¡Œçš„è¯»ä»£ç ï¼Œè€Œæ˜¯ä¼šå…ˆæµè§ˆä¸€ä¸‹å‡½æ•°æ¥å£ã€‚æ‰€ä»¥æ¸…æ™°çš„å‡½æ•°æ¥å£è®¾è®¡ï¼Œä¼šæ›´åŠ åˆ©äºåˆ«äººï¼ˆ<font color="DeepPink">æˆ–è€…æ˜¯å‡ ä¸ªæœˆåçš„ä½ è‡ªå·±</font>ï¼‰ç†è§£è¿™æ®µä»£ç ã€‚</p><p>ä¸€ä¸ªè‰¯å¥½çš„ API è®¾è®¡ï¼Œåº”è¯¥ä»å‡½æ•°ç­¾åå°±æ¸…æ™°çš„ç†è§£å‡½æ•°çš„é€»è¾‘ã€‚å¦‚æœæˆ‘ä»¬å°†ä¸Šé¢çš„æ¥å£æ”¹ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func IsAdminUser(ctx context.Context, userID string, authenticator auth.Service) bool</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»è¿™ä¸ªå‡½æ•°ç­¾åå°±å¯ä»¥æ¸…æ¥šçš„çŸ¥é“ï¼š</p><ul><li>è¿™ä¸ªå‡½æ•°å¾ˆå¯èƒ½å¯ä»¥æå‰è¢« cancel</li><li>è¿™ä¸ªå‡½æ•°éœ€è¦ User ID</li><li>è¿™ä¸ªå‡½æ•°éœ€è¦ä¸€ä¸ªauthenticatoræ¥</li><li>è€Œä¸”ç”±äº authenticator æ˜¯ä¼ å…¥å‚æ•°ï¼Œè€Œä¸æ˜¯ä¾èµ–äºéšå¼çš„æŸä¸ªä¸œè¥¿ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæµ‹è¯•çš„æ—¶å€™å°±å¾ˆå®¹æ˜“ä¼ å…¥ä¸€ä¸ªæ¨¡æ‹Ÿè®¤è¯å‡½æ•°æ¥åšæµ‹è¯•</li><li>userID æ˜¯ä¼ å…¥å€¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¿®æ”¹å®ƒï¼Œä¸ç”¨æ‹…å¿ƒå½±å“åˆ«çš„ä¸œè¥¿</li></ul><p>æ‰€æœ‰è¿™äº›ä¿¡æ¯ï¼Œéƒ½æ˜¯ä»å‡½æ•°ç­¾åå¾—åˆ°çš„ï¼Œè€Œæ— éœ€æ‰“å¼€å‡½æ•°å®ç°ä¸€è¡Œè¡Œå»çœ‹ã€‚</p><h3 id="é‚£ä»€ä¹ˆå¯ä»¥æ”¾åˆ°-Context-Value-é‡Œå»ï¼Ÿ"><a href="#é‚£ä»€ä¹ˆå¯ä»¥æ”¾åˆ°-Context-Value-é‡Œå»ï¼Ÿ" class="headerlink" title="é‚£ä»€ä¹ˆå¯ä»¥æ”¾åˆ° Context.Value é‡Œå»ï¼Ÿ"></a>é‚£ä»€ä¹ˆå¯ä»¥æ”¾åˆ° Context.Value é‡Œå»ï¼Ÿ</h3><p>ç°åœ¨çŸ¥é“ Context.Value ä¼šè®©æ¥å£å®šä¹‰æ›´åŠ æ¨¡ç³Šï¼Œä¼¼ä¹ä¸åº”è¯¥ä½¿ç”¨ã€‚é‚£ä¹ˆåˆå›åˆ°äº†åŸæ¥çš„é—®é¢˜ï¼Œåˆ°åº•ä»€ä¹ˆå¯ä»¥æ”¾åˆ° Context.Value é‡Œå»ï¼Ÿæ¢ä¸ªè§’åº¦å»æƒ³ï¼Œä»€ä¹ˆä¸æ˜¯è¡ç”Ÿäº Requestï¼Ÿ</p><ul><li>Context.Value åº”è¯¥æ˜¯å‘ŠçŸ¥æ€§è´¨çš„ä¸œè¥¿ï¼Œè€Œä¸æ˜¯æ§åˆ¶æ€§è´¨çš„ä¸œè¥¿</li><li>åº”è¯¥æ°¸è¿œéƒ½ä¸éœ€è¦å†™è¿›æ–‡æ¡£ä½œä¸ºå¿…é¡»å­˜åœ¨çš„è¾“å…¥æ•°æ®</li><li>å¦‚æœä½ å‘ç°ä½ çš„å‡½æ•°åœ¨æŸäº› Context.Value ä¸‹æ— æ³•æ­£ç¡®å·¥ä½œï¼Œé‚£å°±è¯´æ˜è¿™ä¸ª Context.Value é‡Œçš„ä¿¡æ¯ä¸åº”è¯¥æ”¾åœ¨é‡Œé¢ï¼Œè€Œåº”è¯¥æ”¾åœ¨æ¥å£ä¸Šã€‚å› ä¸ºå·²ç»è®©æ¥å£å¤ªæ¨¡ç³Šäº†ã€‚</li></ul><h4 id="ä»€ä¹ˆä¸œè¥¿ä¸æ˜¯æ§åˆ¶æ€§è´¨çš„ä¸œè¥¿ï¼Ÿ"><a href="#ä»€ä¹ˆä¸œè¥¿ä¸æ˜¯æ§åˆ¶æ€§è´¨çš„ä¸œè¥¿ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆä¸œè¥¿ä¸æ˜¯æ§åˆ¶æ€§è´¨çš„ä¸œè¥¿ï¼Ÿ"></a>ä»€ä¹ˆä¸œè¥¿ä¸æ˜¯æ§åˆ¶æ€§è´¨çš„ä¸œè¥¿ï¼Ÿ</h4><ul><li>Request ID<ul><li>åªæ˜¯ç»™æ¯ä¸ª RPC è°ƒç”¨ä¸€ä¸ª IDï¼Œè€Œæ²¡æœ‰å®é™…æ„ä¹‰</li><li>è¿™å°±æ˜¯ä¸ªæ•°å­—/å­—ç¬¦ä¸²ï¼Œåæ­£ä½ ä¹Ÿä¸ä¼šç”¨å…¶ä½œä¸ºé€»è¾‘åˆ¤æ–­</li><li>ä¸€èˆ¬ä¹Ÿå°±æ˜¯æ—¥å¿—çš„æ—¶å€™éœ€è¦è®°å½•ä¸€ä¸‹<ul><li>è€Œ logger æœ¬èº«ä¸æ˜¯ Request èŒƒç•´ï¼Œæ‰€ä»¥ logger ä¸åº”è¯¥åœ¨ Context é‡Œ</li><li>é Request èŒƒç•´çš„ logger åº”è¯¥åªæ˜¯åˆ©ç”¨ Context ä¿¡æ¯æ¥ä¿®é¥°æ—¥å¿—</li></ul></li></ul></li><li>User ID ï¼ˆå¦‚æœä»…ä»…æ˜¯ä½œä¸ºæ—¥å¿—ç”¨ï¼‰</li><li>Incoming Request ID</li></ul><h4 id="ä»€ä¹ˆæ˜¾ç„¶æ˜¯æ§åˆ¶æ€§è´¨çš„ä¸œè¥¿ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¾ç„¶æ˜¯æ§åˆ¶æ€§è´¨çš„ä¸œè¥¿ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¾ç„¶æ˜¯æ§åˆ¶æ€§è´¨çš„ä¸œè¥¿ï¼Ÿ"></a>ä»€ä¹ˆæ˜¾ç„¶æ˜¯æ§åˆ¶æ€§è´¨çš„ä¸œè¥¿ï¼Ÿ</h4><ul><li>æ•°æ®åº“è¿æ¥<ul><li>æ˜¾ç„¶ä¼šéå¸¸ä¸¥é‡çš„å½±å“é€»è¾‘</li><li>å› æ­¤è¿™åº”è¯¥åœ¨å‡½æ•°å‚æ•°é‡Œï¼Œæ˜ç¡®è¡¨ç¤ºå‡ºæ¥</li></ul></li><li>è®¤è¯æœåŠ¡(Authentication)<ul><li>æ˜¾ç„¶ä¸åŒçš„è®¤è¯æœåŠ¡å¯¼è‡´çš„é€»è¾‘ä¸åŒ</li><li>ä¹Ÿåº”è¯¥æ”¾åˆ°å‡½æ•°å‚æ•°é‡Œï¼Œæ˜ç¡®è¡¨ç¤ºå‡ºæ¥</li></ul></li></ul><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><h4 id="è°ƒè¯•æ€§è´¨çš„-Context-Value-net-http-httptrace"><a href="#è°ƒè¯•æ€§è´¨çš„-Context-Value-net-http-httptrace" class="headerlink" title="è°ƒè¯•æ€§è´¨çš„ Context.Value - net/http/httptrace"></a>è°ƒè¯•æ€§è´¨çš„ Context.Value - net/http/httptrace</h4><p><a href="https://medium.com/@cep21/go-1-7-httptrace-and-context-debug-patterns-608ae887224a" target="_blank" rel="noopener">https://medium.com/@cep21/go-1-7-httptrace-and-context-debug-patterns-608ae887224a</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line">func trace(req *http.Request, c *http.Client) &#123;</span><br><span class="line">  trace := &amp;httptrace.ClientTrace&#123;</span><br><span class="line">    GotConn: func(connInfo httptrace.GotConnInfo) &#123;</span><br><span class="line">      fmt.Println(&quot;Got Conn&quot;)</span><br><span class="line">    &#125;,</span><br><span class="line">    ConnectStart: func(network, addr string) &#123;</span><br><span class="line">      fmt.Println(&quot;Dial Start&quot;)</span><br><span class="line">    &#125;,</span><br><span class="line">    ConnectDone: func(network, addr string, err error) &#123;</span><br><span class="line">      fmt.Println(&quot;Dial done&quot;)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">  req = req.WithContext(httptrace.WithClientTrace(req.Context(), trace))</span><br><span class="line">  c.Do(req)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="net-http-æ˜¯æ€ä¹ˆä½¿ç”¨-httptrace-çš„ï¼Ÿ"><a href="#net-http-æ˜¯æ€ä¹ˆä½¿ç”¨-httptrace-çš„ï¼Ÿ" class="headerlink" title="net/http æ˜¯æ€ä¹ˆä½¿ç”¨ httptrace çš„ï¼Ÿ"></a>net/http æ˜¯æ€ä¹ˆä½¿ç”¨ httptrace çš„ï¼Ÿ</h4><ul><li>å¦‚æœæœ‰ trace å­˜åœ¨çš„è¯ï¼Œå°±æ‰§è¡Œ trace å›è°ƒå‡½æ•°</li><li>è¿™åªæ˜¯å‘ŠçŸ¥æ€§è´¨ï¼Œè€Œä¸æ˜¯æ§åˆ¶æ€§è´¨<ul><li>http ä¸ä¼šå› ä¸ºå­˜åœ¨ trace ä¸å¦å°±æœ‰ä¸åŒçš„æ‰§è¡Œé€»è¾‘</li><li>è¿™é‡Œåªæ˜¯å‘ŠçŸ¥ API çš„ç”¨æˆ·ï¼Œå¸®åŠ©ç”¨æˆ·è®°å½•æ—¥å¿—æˆ–è€…è°ƒè¯•</li><li>å› æ­¤è¿™é‡Œçš„ trace æ˜¯å­˜åœ¨äº Context é‡Œçš„<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package http</span><br><span class="line">func (req *Request) write(w io.Writer, usingProxy bool, extraHeaders Header, waitForContinue func() bool) (err error) &#123;</span><br><span class="line">  //  ...</span><br><span class="line">  trace := httptrace.ContextClientTrace(req.Context())</span><br><span class="line">  //  ...</span><br><span class="line">  if trace != nil &amp;&amp; trace.WroteHeaders != nil &#123;</span><br><span class="line">    trace.WroteHeaders()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="å›é¿ä¾èµ–æ³¨å…¥-github-com-golang-oauth2"><a href="#å›é¿ä¾èµ–æ³¨å…¥-github-com-golang-oauth2" class="headerlink" title="å›é¿ä¾èµ–æ³¨å…¥ - github.com/golang/oauth2"></a>å›é¿ä¾èµ–æ³¨å…¥ - github.com/golang/oauth2</h4><ul><li>è¿™é‡Œæ¯”è¾ƒè¯¡å¼‚ï¼Œä½¿ç”¨ ctx.Value æ¥å®šä½ä¾èµ–</li><li><font color="DeepPink">ä¸æ¨èè¿™æ ·åš</font><ul><li>è¿™é‡Œè¿™æ ·åšåŸºæœ¬ä¸Šåªæ˜¯ä¸ºäº†æ»¡è¶³æµ‹è¯•éœ€æ±‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line">import &quot;github.com/golang/oauth2&quot;</span><br><span class="line">func oauth() &#123;</span><br><span class="line">  c := &amp;http.Client&#123;Transport: &amp;mockTransport&#123;&#125;&#125;</span><br><span class="line">  ctx := context.WithValue(context.Background(), oauth2.HTTPClient, c)</span><br><span class="line">  conf := &amp;oauth2.Config&#123; /* ... */ &#125;</span><br><span class="line">  conf.Exchange(ctx, &quot;code&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="äººä»¬æ»¥ç”¨-Context-Value-çš„åŸå› "><a href="#äººä»¬æ»¥ç”¨-Context-Value-çš„åŸå› " class="headerlink" title="äººä»¬æ»¥ç”¨ Context.Value çš„åŸå› "></a>äººä»¬æ»¥ç”¨ Context.Value çš„åŸå› </h3><ul><li>ä¸­é—´ä»¶çš„æŠ½è±¡</li><li>å¾ˆæ·±çš„å‡½æ•°è°ƒç”¨æ ˆ</li><li>æ··ä¹±çš„è®¾è®¡</li></ul><blockquote><p>context.Value å¹¶æ²¡æœ‰è®©ä½ çš„ API æ›´ç®€æ´ï¼Œé‚£æ˜¯å‡è±¡ï¼Œç›¸åï¼Œå®ƒè®©ä½ çš„ API å®šä¹‰æ›´åŠ æ¨¡ç³Šã€‚</p></blockquote><h2 id="æ€»ç»“-Context-Value"><a href="#æ€»ç»“-Context-Value" class="headerlink" title="æ€»ç»“ Context.Value"></a>æ€»ç»“ Context.Value</h2><ul><li>å¯¹äºè°ƒè¯•éå¸¸æ–¹ä¾¿</li><li>å°†å¿…é¡»çš„ä¿¡æ¯æ”¾å…¥ Context.Value ä¸­ï¼Œä¼šè®©æ¥å£å®šä¹‰æ›´åŠ ä¸é€æ˜</li><li>å¦‚æœå¯ä»¥å°½é‡æ˜ç¡®å®šä¹‰åœ¨æ¥å£</li><li>å°½é‡ä¸è¦ç”¨ Context.Value</li></ul><h1 id="æ€»ç»“-Context"><a href="#æ€»ç»“-Context" class="headerlink" title="æ€»ç»“ Context"></a>æ€»ç»“ Context</h1><ul><li>æ‰€æœ‰çš„é•¿çš„ã€é˜»å¡çš„æ“ä½œéƒ½éœ€è¦ Context</li><li>errgroup æ˜¯æ„æ¶äº Context ä¹‹ä¸Šå¾ˆå¥½çš„æŠ½è±¡</li><li>å½“ Request çš„ç»“æŸçš„æ—¶å€™ï¼ŒCancel Context</li><li>Context.Value åº”è¯¥è¢«ç”¨äº<font color="DeepPink">å‘ŠçŸ¥æ€§è´¨</font>çš„äº‹ç‰©ï¼Œè€Œä¸æ˜¯<font color="DeepPink">æ§åˆ¶æ€§è´¨</font>çš„äº‹ç‰©</li><li>çº¦æŸ Context.Value çš„é”®ç©ºé—´</li><li>Context ä»¥åŠ Context.Value åº”è¯¥æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ï¼Œå¹¶ä¸”åº”è¯¥æ˜¯çº¿ç¨‹å®‰å…¨</li><li>Context åº”è¯¥éš Request æ¶ˆäº¡è€Œæ¶ˆäº¡</li></ul><h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><h2 id="æ•°æ®åº“çš„è®¿é—®ä¹Ÿç”¨-Context-ä¹ˆï¼Ÿ"><a href="#æ•°æ®åº“çš„è®¿é—®ä¹Ÿç”¨-Context-ä¹ˆï¼Ÿ" class="headerlink" title="æ•°æ®åº“çš„è®¿é—®ä¹Ÿç”¨ Context ä¹ˆï¼Ÿ"></a>æ•°æ®åº“çš„è®¿é—®ä¹Ÿç”¨ Context ä¹ˆï¼Ÿ</h2><p>ä¹‹å‰è¯´è¿‡é•¿æ—¶é—´ã€å¯é˜»å¡çš„æ“ä½œéƒ½ç”¨ Contextï¼Œæ•°æ®åº“æ“ä½œä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸è¿‡å¯¹äºè¶…æ—¶ Cancel æ“ä½œæ¥è¯´ï¼Œä¸€èˆ¬ä¸ä¼šå¯¹å†™æ“ä½œè¿›è¡Œ cancelï¼›ä½†æ˜¯å¯¹äºè¯»æ“ä½œï¼Œä¸€èˆ¬ä¼šæœ‰ Cancel æ“ä½œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Context </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>encrypted communication elasticsearch java rest client</title>
      <link href="/encrypted-communication-elasticsearch-java-rest-client.html"/>
      <url>/encrypted-communication-elasticsearch-java-rest-client.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>ElasticSearch 7.3.1<br>Java Rest Client HTTPSè¿æ¥æ“ä½œ</p></blockquote><a id="more"></a><p>ElasticSearchç‰ˆæœ¬7.3.1ï¼Œelasticsearch.ymlé…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xpack.security.enabled: true</span><br><span class="line">xpack.security.transport.ssl.enabled: true</span><br><span class="line">xpack.security.transport.ssl.verification_mode: certificate</span><br><span class="line">xpack.security.transport.ssl.key: /home/jiankunking/elasticsearch-7.3.1/config/certs/_.jiankunking.com.key</span><br><span class="line">xpack.security.transport.ssl.certificate: /home/jiankunking/elasticsearch-7.3.1/config/certs/_.jiankunking.com.cer</span><br><span class="line">xpack.security.transport.ssl.certificate_authorities: [ &quot;/home/jiankunking/elasticsearch-7.3.1/config/certs/_.jiankunking.com_ca.crt&quot; ]</span><br><span class="line">xpack.security.http.ssl.enabled: true</span><br><span class="line">xpack.security.http.ssl.key:  /home/jiankunking/elasticsearch-7.3.1/config/certs/_.jiankunking.com.key</span><br><span class="line">xpack.security.http.ssl.certificate: /home/jiankunking/elasticsearch-7.3.1/config/certs/_.jiankunking.com.cer</span><br><span class="line">xpack.security.http.ssl.certificate_authorities: [ &quot;/home/jiankunking/elasticsearch-7.3.1/config/certs/_.jiankunking.com_ca.crt&quot; ]</span><br></pre></td></tr></table></figure><p>ç”±äºElasticSearch Java clientä¸­çš„<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#KeyStore" target="_blank" rel="noopener">KeyStore Types</a>åªæ”¯æŒä»¥ä¸‹å‡ ç§ï¼š</p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>jceks</td><td>The proprietary keystore implementation provided by the SunJCE provider.</td></tr><tr><td>jks</td><td>The proprietary keystore implementation provided by the SUN provider.</td></tr><tr><td>dks</td><td>A domain keystore is a collection of keystores presented as a single logical keystore. It is specified by configuration data whose syntax is described in DomainLoadStoreParameter.</td></tr><tr><td>pkcs11</td><td>A keystore backed by a PKCS #11 token.</td></tr><tr><td>pkcs12</td><td>The transfer syntax for personal identity information as defined in PKCS #12.</td></tr></tbody></table><p>è€Œæˆ‘è¿™è¾¹è¯ä¹¦æ ¼å¼ä¸ºcerï¼Œæ‰€ä»¥é€šè¿‡keytoolè¿›è¡Œè½¬æ¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -import -v -trustcacerts -file _.jiankunking.com.cer  -keystore my_keystore.jks -keypass password -storepass password</span><br></pre></td></tr></table></figure><p>è¯ä¹¦è½¬æ¢å®Œæˆåï¼Œæ“ä½œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">package ssl;</span><br><span class="line"></span><br><span class="line">import org.apache.http.HttpHost;</span><br><span class="line">import org.apache.http.auth.AuthScope;</span><br><span class="line">import org.apache.http.auth.UsernamePasswordCredentials;</span><br><span class="line">import org.apache.http.client.CredentialsProvider;</span><br><span class="line">import org.apache.http.impl.client.BasicCredentialsProvider;</span><br><span class="line">import org.apache.http.ssl.SSLContexts;</span><br><span class="line">import org.elasticsearch.client.RequestOptions;</span><br><span class="line">import org.elasticsearch.client.RestClient;</span><br><span class="line">import org.elasticsearch.client.RestClientBuilder;</span><br><span class="line">import org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line">import org.elasticsearch.client.indices.CreateIndexRequest;</span><br><span class="line">import org.elasticsearch.client.indices.CreateIndexResponse;</span><br><span class="line">import org.elasticsearch.common.settings.Settings;</span><br><span class="line">import org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line"></span><br><span class="line">import javax.net.ssl.SSLContext;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.security.KeyManagementException;</span><br><span class="line">import java.security.KeyStoreException;</span><br><span class="line">import java.security.NoSuchAlgorithmException;</span><br><span class="line">import java.security.cert.CertificateException;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @Author: jiankunking</span><br><span class="line"> * @Date: 2019/8/27 15:32</span><br><span class="line"> * @Description:</span><br><span class="line"> */</span><br><span class="line">public class es &#123;</span><br><span class="line">    public static void main(String[] args) throws KeyStoreException, IOException, NoSuchAlgorithmException, KeyManagementException, CertificateException &#123;</span><br><span class="line">        </span><br><span class="line">        CredentialsProvider credentialsProvider = new BasicCredentialsProvider();</span><br><span class="line">        credentialsProvider.setCredentials(AuthScope.ANY, new UsernamePasswordCredentials(&quot;elastic&quot;, &quot;jiankunking&quot;));</span><br><span class="line"></span><br><span class="line">        SSLContext sslContext = SSLContexts.custom()</span><br><span class="line">                .loadTrustMaterial(new File(&quot;I:\\certs\\my_keystore.jks&quot;))</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        String host = &quot;es.jiankunking.com&quot;;</span><br><span class="line">        int port = 9200;</span><br><span class="line">        String scheme = &quot;https&quot;;</span><br><span class="line">        String indexName = &quot;twitter2&quot;;</span><br><span class="line"></span><br><span class="line">        RestClientBuilder restClientBuilder = RestClient.builder(new HttpHost(host, port, scheme)).setHttpClientConfigCallback(httpClientBuilder -&gt; httpClientBuilder</span><br><span class="line">                .setDefaultCredentialsProvider(credentialsProvider)</span><br><span class="line">                .setSSLContext(sslContext)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">// åˆ°è¿™é‡ŒRestHighLevelClientå·²ç»åˆå§‹åŒ–å®Œæˆï¼Œä¸‹é¢çš„åˆ›å»ºç´¢å¼•æ˜¯æµ‹è¯•</span><br><span class="line">        RestHighLevelClient restHighLevelClient = new RestHighLevelClient(restClientBuilder);</span><br><span class="line"></span><br><span class="line">        // åˆ›å»ºç´¢å¼•è¯·æ±‚</span><br><span class="line">        CreateIndexRequest request = new CreateIndexRequest(indexName);</span><br><span class="line">        request.settings(Settings.builder()</span><br><span class="line">                .put(&quot;index.number_of_shards&quot;, 3)</span><br><span class="line">                .put(&quot;index.number_of_replicas&quot;, 2)</span><br><span class="line">        );</span><br><span class="line">        request.mapping(</span><br><span class="line">                &quot;&#123;\n&quot; +</span><br><span class="line">                        &quot;  \&quot;properties\&quot;: &#123;\n&quot; +</span><br><span class="line">                        &quot;    \&quot;message\&quot;: &#123;\n&quot; +</span><br><span class="line">                        &quot;      \&quot;type\&quot;: \&quot;text\&quot;\n&quot; +</span><br><span class="line">                        &quot;    &#125;\n&quot; +</span><br><span class="line">                        &quot;  &#125;\n&quot; +</span><br><span class="line">                        &quot;&#125;&quot;,</span><br><span class="line">                XContentType.JSON);</span><br><span class="line">        Map&lt;String, Object&gt; message = new HashMap&lt;&gt;();</span><br><span class="line">        message.put(&quot;type&quot;, &quot;text&quot;);</span><br><span class="line">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span><br><span class="line">        properties.put(&quot;message&quot;, message);</span><br><span class="line">        Map&lt;String, Object&gt; mapping = new HashMap&lt;&gt;();</span><br><span class="line">        mapping.put(&quot;properties&quot;, properties);</span><br><span class="line">        request.mapping(mapping);</span><br><span class="line">        CreateIndexResponse createIndexResponse;</span><br><span class="line">        try &#123;</span><br><span class="line">            createIndexResponse = restHighLevelClient.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line">            System.out.println(createIndexResponse);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
            <tag> Java </tag>
            
            <tag> Rest </tag>
            
            <tag> Client </tag>
            
            <tag> Encrypted </tag>
            
            <tag> Communication </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webæ€§èƒ½æƒå¨æŒ‡å— ç¬”è®°</title>
      <link href="/high-performance-browser-networking-note.html"/>
      <url>/high-performance-browser-networking-note.html</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ•´ç†è‡ªï¼šã€ŠWebæ€§èƒ½æƒå¨æŒ‡å—ã€‹ ä½œè€…ï¼šIlya Grigorik</p><p>å‡ºç‰ˆæ—¶é—´ï¼š2014-04</p><a id="more"></a><h1 id="ç½‘ç»œæŠ€æœ¯æ¦‚è§ˆ"><a href="#ç½‘ç»œæŠ€æœ¯æ¦‚è§ˆ" class="headerlink" title="ç½‘ç»œæŠ€æœ¯æ¦‚è§ˆ"></a>ç½‘ç»œæŠ€æœ¯æ¦‚è§ˆ</h1><h2 id="å¸¦å®½ä¸å»¶è¿Ÿ"><a href="#å¸¦å®½ä¸å»¶è¿Ÿ" class="headerlink" title="å¸¦å®½ä¸å»¶è¿Ÿ"></a>å¸¦å®½ä¸å»¶è¿Ÿ</h2><h3 id="å»¶è¿Ÿçš„æœ€åä¸€å…¬é‡Œ"><a href="#å»¶è¿Ÿçš„æœ€åä¸€å…¬é‡Œ" class="headerlink" title="å»¶è¿Ÿçš„æœ€åä¸€å…¬é‡Œ"></a>å»¶è¿Ÿçš„æœ€åä¸€å…¬é‡Œ</h3><p>traceroute (Windows ç³»ç»Ÿä¸‹æ˜¯tracert) å‘½ä»¤åˆ©ç”¨ICMPåè®®å®šä½æ‚¨çš„è®¡ç®—æœºå’Œç›®æ ‡è®¡ç®—æœºä¹‹é—´çš„æ‰€æœ‰è·¯ç”±å™¨ã€‚</p><h2 id="TCPçš„æ„æˆ"><a href="#TCPçš„æ„æˆ" class="headerlink" title="TCPçš„æ„æˆ"></a>TCPçš„æ„æˆ</h2><p>å› ç‰¹ç½‘æœ‰ä¸¤ä¸ªæ ¸å¿ƒåè®®ï¼šIPå’ŒTCPã€‚IPï¼Œå³ Internet Protocolï¼ˆå› ç‰¹ç½‘åè®®ï¼‰ï¼Œè´Ÿè´£è”ç½‘ä¸»æœºä¹‹é—´çš„è·¯ç”±é€‰æ‹©å’Œå¯»å€ï¼›TCPï¼Œå³ Transmission Control Protocolï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰ï¼Œè´Ÿè´£åœ¨ä¸å¯é çš„ä¼ è¾“ä¿¡é“ä¹‹ä¸Šæä¾›å¯é çš„æŠ½è±¡å±‚ã€‚</p><h3 id="ä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹"></a>ä¸‰æ¬¡æ¡æ‰‹</h3><p>æ‰€æœ‰TCPè¿æ¥ä¸€å¼€å§‹éƒ½è¦ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼ˆè§å›¾ 2-1ï¼‰ã€‚å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨åœ¨äº¤æ¢åº”ç”¨æ•°æ®ä¹‹å‰ï¼Œå¿…é¡»å°±èµ·å§‹åˆ†ç»„åºåˆ—å·ï¼Œä»¥åŠå…¶ä»–ä¸€äº›è¿æ¥ç›¸å…³çš„ç»†èŠ‚è¾¾æˆä¸€è‡´ã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œåºåˆ—å·ç”±ä¸¤ç«¯éšæœºç”Ÿæˆã€‚<br><img alt data-src="/images/high-performance-browser-networking-note/%E5%9B%BE21%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png"></p><ul><li>SYN<br>å®¢æˆ·ç«¯é€‰æ‹©ä¸€ä¸ªéšæœºåºåˆ—å·xï¼Œå¹¶å‘é€ä¸€ä¸ªSYNåˆ†ç»„ï¼Œå…¶ä¸­å¯èƒ½è¿˜åŒ…æ‹¬å…¶ä»–TCPæ ‡å¿—å’Œé€‰é¡¹ã€‚</li><li>SYN ACK<br>æœåŠ¡å™¨ç»™xåŠ 1ï¼Œå¹¶é€‰æ‹©è‡ªå·±çš„ä¸€ä¸ªéšæœºåºåˆ—å·yï¼Œè¿½åŠ è‡ªå·±çš„æ ‡å¿—å’Œé€‰é¡¹ï¼Œç„¶åè¿”å›å“åº”ã€‚</li><li>ACK<br>å®¢æˆ·ç«¯ç»™xå’ŒyåŠ 1å¹¶å‘é€æ¡æ‰‹æœŸé—´çš„æœ€åä¸€ä¸ªACKåˆ†ç»„ã€‚</li></ul><blockquote><p>SYNï¼šåŒæ­¥åºåˆ—ç¼–å·ï¼ˆSynchronize Sequence Numbersï¼‰<br>ACK (Acknowledge characterï¼‰å³æ˜¯ç¡®è®¤å­—ç¬¦</p></blockquote><p>ä¸‰æ¬¡æ¡æ‰‹å®Œæˆåï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´å°±å¯ä»¥é€šä¿¡äº†ã€‚<font color="DeepPink">å®¢æˆ·ç«¯å¯ä»¥åœ¨å‘é€ACKåˆ†ç»„ä¹‹åç«‹å³å‘é€æ•°æ®ï¼Œè€ŒæœåŠ¡å™¨å¿…é¡»ç­‰æ¥æ”¶åˆ°ACKåˆ†ç»„ä¹‹åæ‰èƒ½å‘é€æ•°æ®ã€‚</font>è¿™ä¸ªå¯åŠ¨é€šä¿¡çš„è¿‡ç¨‹é€‚ç”¨äºæ‰€æœ‰TCPè¿æ¥ï¼Œå› æ­¤å¯¹æ‰€æœ‰ä½¿ç”¨TCPçš„åº”ç”¨å…·æœ‰éå¸¸å¤§çš„æ€§èƒ½å½±å“ï¼Œå› ä¸ºæ¯æ¬¡ä¼ è¾“åº”ç”¨æ•°æ®ä¹‹å‰ï¼Œéƒ½å¿…é¡»ç»å†ä¸€æ¬¡å®Œæ•´çš„å¾€è¿”ã€‚</p><h3 id="é˜Ÿé¦–é˜»å¡"><a href="#é˜Ÿé¦–é˜»å¡" class="headerlink" title="é˜Ÿé¦–é˜»å¡"></a>é˜Ÿé¦–é˜»å¡</h3><blockquote><p>ä¸¢åŒ…å°±ä¸¢åŒ…<br>äº‹å®ä¸Šï¼Œä¸¢åŒ…æ˜¯è®©TCPè¾¾åˆ°æœ€ä½³æ€§èƒ½çš„å…³é”®ã€‚è¢«åˆ é™¤çš„åŒ…æ°æ°æ˜¯ä¸€ç§åé¦ˆæœºåˆ¶ï¼Œèƒ½å¤Ÿè®©æ¥æ”¶ç«¯å’Œå‘é€ç«¯å„è‡ªè°ƒæ•´é€Ÿåº¦ï¼Œä»¥é¿å…ç½‘ç»œæ‹¥å µï¼ŒåŒæ—¶ä¿æŒå»¶è¿Ÿæœ€çŸ­ã€‚å¦å¤–ï¼Œæœ‰äº›åº”ç”¨ç¨‹åºå¯ä»¥å®¹å¿ä¸¢å¤±ä¸€å®šæ•°é‡çš„åŒ…ï¼Œæ¯”å¦‚è¯­éŸ³å’Œæ¸¸æˆçŠ¶æ€é€šä¿¡ï¼Œå°±ä¸éœ€è¦å¯é ä¼ è¾“æˆ–æŒ‰åºäº¤ä»˜ã€‚<br>å°±ç®—æœ‰ä¸ªåŒ…ä¸¢äº†ï¼ŒéŸ³é¢‘ç¼–è§£ç å™¨åªè¦åœ¨éŸ³é¢‘ä¸­æ’å…¥ä¸€ä¸ªå°å°çš„é—´æ­‡ï¼Œå°±å¯ä»¥ç»§ç»­å¤„ç†åæ¥çš„åŒ…ã€‚åªè¦é—´æ­‡å¤Ÿå°ï¼Œç”¨æˆ·å°±æ³¨æ„ä¸åˆ°ï¼Œè€Œç­‰å¾…ä¸¢å¤±çš„åŒ…åˆ™å¯èƒ½å¯¼è‡´éŸ³é¢‘è¾“å‡ºäº§ç”Ÿæ— æ³•é¢„æ–™çš„æš‚åœã€‚ç›¸å¯¹æ¥è¯´ï¼Œåè€…çš„ç”¨æˆ·ä½“éªŒæ›´ç³Ÿç³•ã€‚<br>ç±»ä¼¼åœ°ï¼Œæ›´æ–°3Dæ¸¸æˆä¸­è§’è‰²çš„çŠ¶æ€ä¹Ÿä¸€æ ·ï¼šæ”¶åˆ°Tæ—¶åˆ»çš„åŒ…è€Œç­‰å¾…T-1æ—¶åˆ»çš„åŒ…é€šå¸¸æ¯«æ— å¿…è¦ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œåº”è¯¥å¯ä»¥æ¥æ”¶æ‰€æœ‰çŠ¶æ€æ›´æ–°ï¼Œä½†ä¸ºé¿å…æ¸¸æˆå»¶è¿Ÿï¼Œé—´æ­‡æ€§çš„ä¸¢åŒ…ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚</p></blockquote><h2 id="é’ˆå¯¹TCPçš„ä¼˜åŒ–å»ºè®®"><a href="#é’ˆå¯¹TCPçš„ä¼˜åŒ–å»ºè®®" class="headerlink" title="é’ˆå¯¹TCPçš„ä¼˜åŒ–å»ºè®®"></a>é’ˆå¯¹TCPçš„ä¼˜åŒ–å»ºè®®</h2><p>TCPæ˜¯ä¸€ä¸ªè‡ªé€‚åº”çš„ã€å¯¹æ‰€æœ‰ç½‘ç»œèŠ‚ç‚¹ä¸€è§†åŒä»çš„ã€æœ€å¤§é™åˆ¶åˆ©ç”¨åº•å±‚ç½‘ç»œçš„åè®®ã€‚å› æ­¤ï¼Œä¼˜åŒ–TCPçš„æœ€ä½³é€”å¾„å°±æ˜¯è°ƒæ•´å®ƒæ„ŸçŸ¥å½“å‰ç½‘ç»œçŠ¶å†µçš„æ–¹å¼ï¼Œæ ¹æ®å®ƒä¹‹ä¸Šæˆ–ä¹‹ä¸‹çš„æŠ½è±¡å±‚çš„ç±»å‹å’Œéœ€æ±‚æ¥æ”¹å˜å®ƒçš„è¡Œä¸ºã€‚</p><h3 id="æœåŠ¡å™¨é…ç½®è°ƒä¼˜"><a href="#æœåŠ¡å™¨é…ç½®è°ƒä¼˜" class="headerlink" title="æœåŠ¡å™¨é…ç½®è°ƒä¼˜"></a>æœåŠ¡å™¨é…ç½®è°ƒä¼˜</h3><p>åœ¨ç€æ‰‹è°ƒæ•´TCPçš„ç¼“å†²åŒºã€è¶…æ—¶ç­‰æ•°åä¸ªå˜é‡ä¹‹å‰ï¼Œæœ€å¥½å…ˆæŠŠä¸»æœºæ“ä½œç³»ç»Ÿå‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚TCP çš„æœ€ä½³å®è·µä»¥åŠå½±å“å…¶æ€§èƒ½çš„åº•å±‚ç®—æ³•ä¸€ç›´åœ¨ä¸æ—¶ä¿±è¿›ï¼Œè€Œä¸”å¤§å¤šæ•°å˜åŒ–éƒ½åªåœ¨æœ€æ–°å†…æ ¸ä¸­æ‰æœ‰å®ç°ã€‚ä¸€å¥è¯ï¼Œè®©ä½ çš„æœåŠ¡å™¨è·Ÿä¸Šæ—¶ä»£æ˜¯ä¼˜åŒ–å‘é€ç«¯å’Œæ¥æ”¶ç«¯TCPæ ˆçš„é¦–è¦æªæ–½ã€‚</p><p>æœ‰äº†æœ€æ–°çš„å†…æ ¸ï¼Œæˆ‘ä»¬æ¨èä½ éµå¾ªå¦‚ä¸‹æœ€ä½³å®è·µæ¥é…ç½®è‡ªå·±çš„æœåŠ¡å™¨ã€‚</p><ul><li>å¢å¤§TCPçš„åˆå§‹æ‹¥å¡çª—å£<br>åŠ å¤§èµ·å§‹æ‹¥å¡çª—å£å¯ä»¥è®©TCPåœ¨ç¬¬ä¸€æ¬¡å¾€è¿”å°±ä¼ è¾“è¾ƒå¤šæ•°æ®ï¼Œè€Œéšåçš„é€Ÿåº¦æå‡ä¹Ÿä¼šå¾ˆæ˜æ˜¾ã€‚å¯¹äºçªå‘æ€§çš„çŸ­æš‚è¿æ¥ï¼Œè¿™ä¹Ÿæ˜¯ç‰¹åˆ«å…³é”®çš„ä¸€ä¸ªä¼˜åŒ–ã€‚</li><li>æ…¢å¯åŠ¨é‡å¯<br>åœ¨è¿æ¥ç©ºé—²æ—¶ç¦ç”¨æ…¢å¯åŠ¨å¯ä»¥æ”¹å–„ç¬æ—¶å‘é€æ•°æ®çš„é•¿TCPè¿æ¥çš„æ€§èƒ½ã€‚</li><li>çª—å£ç¼©æ”¾<br>å¯ç”¨çª—å£ç¼©æ”¾å¯ä»¥å¢å¤§æœ€å¤§æ¥æ”¶çª—å£å¤§å°ï¼Œå¯ä»¥è®©é«˜å»¶è¿Ÿçš„è¿æ¥è¾¾åˆ°æ›´å¥½ååé‡ã€‚</li><li>TCPå¿«é€Ÿæ‰“å¼€<br>åœ¨æŸäº›æ¡ä»¶ä¸‹ï¼Œå…è®¸åœ¨ç¬¬ä¸€ä¸ªSYNåˆ†ç»„ä¸­å‘é€åº”ç”¨ç¨‹åºæ•°æ®ã€‚TFOï¼ˆTCP Fast Openï¼ŒTCP å¿«é€Ÿæ‰“å¼€ï¼‰æ˜¯ä¸€ç§æ–°çš„ä¼˜åŒ–é€‰é¡¹ï¼Œéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…±åŒæ”¯æŒã€‚ä¸ºæ­¤ï¼Œé¦–å…ˆè¦ææ¸…æ¥šä½ çš„åº”ç”¨ç¨‹åºæ˜¯å¦å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ã€‚</li></ul><blockquote><p>Linuxç”¨æˆ·å¯ä»¥ä½¿ç”¨ssæ¥æŸ¥çœ‹å½“å‰æ‰“å¼€çš„å¥—æ¥å­—çš„å„ç§ç»Ÿè®¡ä¿¡æ¯ã€‚åœ¨å‘½ä»¤è¡Œé‡Œè¿è¡Œss â€“options â€“extended â€“memory â€“processes â€“info ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰é€šä¿¡èŠ‚ç‚¹ä»¥åŠå®ƒä»¬ç›¸åº”çš„è¿æ¥è®¾ç½®ã€‚</p></blockquote><h2 id="UDPçš„æ„æˆ"><a href="#UDPçš„æ„æˆ" class="headerlink" title="UDPçš„æ„æˆ"></a>UDPçš„æ„æˆ</h2><p>å…³äºUDPçš„åº”ç”¨ï¼Œæœ€å¹¿ä¸ºäººçŸ¥åŒæ—¶ä¹Ÿæ˜¯æ‰€æœ‰æµè§ˆå™¨å’Œå› ç‰¹ç½‘åº”ç”¨éƒ½èµ–ä»¥è¿ä½œçš„ï¼Œå°±æ˜¯DNSï¼ˆDomain Name Systemï¼ŒåŸŸåç³»ç»Ÿï¼‰ã€‚</p><p>IETFå’ŒW3Cå·¥ä½œç»„å…±åŒåˆ¶å®šäº†ä¸€å¥—æ–°API WebRTCï¼ˆWeb Real-Time Communicationï¼ŒWeb å®æ—¶é€šä¿¡ï¼‰ã€‚WebRTCç€çœ¼äºåœ¨æµè§ˆå™¨ä¸­é€šè¿‡UDPå®ç°åŸç”Ÿçš„è¯­éŸ³å’Œè§†é¢‘å®æ—¶é€šä¿¡ï¼Œä»¥åŠå…¶ä»–å½¢å¼çš„ P2Pï¼ˆPeer-to-Peerï¼Œç«¯åˆ°ç«¯ï¼‰é€šä¿¡ã€‚</p><h3 id="æ— åè®®æœåŠ¡"><a href="#æ— åè®®æœåŠ¡" class="headerlink" title="æ— åè®®æœåŠ¡"></a>æ— åè®®æœåŠ¡</h3><p>è¦ç†è§£ä¸ºä»€ä¹ˆUDPè¢«äººç§°ä½œâ€œæ— åè®®â€ï¼Œå¿…é¡»ä»ä½œä¸ºTCPå’ŒUDPä¸‹ä¸€å±‚çš„IPåè®®è¯´èµ·ã€‚<font color="DeepPink">IPå±‚çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯æŒ‰ç…§åœ°å€ä»æºä¸»æœºå‘ç›®æ ‡ä¸»æœºå‘é€æ•°æ®æŠ¥</font>ã€‚ä¸ºæ­¤ï¼Œæ¶ˆæ¯ä¼šè¢«å°è£…åœ¨ä¸€ä¸ªIPåˆ†ç»„å†…ï¼ˆå›¾3-1ï¼‰ï¼Œå…¶ä¸­è½½æ˜äº†æºåœ°å€å’Œç›®æ ‡åœ°å€ï¼Œä»¥åŠå…¶ä»–ä¸€äº›è·¯ç”±å‚æ•°ã€‚æ³¨æ„ï¼Œæ•°æ®æŠ¥è¿™ä¸ªè¯æš—ç¤ºäº†ä¸€ä¸ªé‡è¦çš„ä¿¡æ¯ï¼š<font color="DeepPink">IPå±‚ä¸ä¿è¯æ¶ˆæ¯å¯é çš„äº¤ä»˜ï¼Œä¹Ÿä¸å‘é€å¤±è´¥é€šçŸ¥ï¼Œå®é™…ä¸Šæ˜¯æŠŠåº•å±‚ç½‘ç»œçš„ä¸å¯é æ€§ç›´æ¥æš´éœ²ç»™äº†ä¸Šä¸€å±‚</font>ã€‚å¦‚æœæŸä¸ªè·¯ç”±èŠ‚ç‚¹å› ä¸ºç½‘ç»œæ‹¥å¡ã€è´Ÿè½½è¿‡é«˜æˆ–å…¶ä»–åŸå› è€Œåˆ é™¤äº†IPåˆ†ç»„ï¼Œé‚£ä¹ˆåœ¨å¿…è¦çš„æƒ…å†µä¸‹ï¼ŒIP çš„ä¸Šä¸€å±‚åè®®è¦è´Ÿè´£æ£€æµ‹ã€æ¢å¤å’Œé‡å‘æ•°æ®ã€‚<br><img alt data-src="/images/high-performance-browser-networking-note/%E5%9B%BE31IPv4%E9%A6%96%E9%83%A8.png"><br>UDPåè®®ä¼šç”¨è‡ªå·±çš„åˆ†ç»„ç»“æ„ï¼ˆå›¾3-2ï¼‰å°è£…ç”¨æˆ·æ¶ˆæ¯ï¼Œå®ƒåªå¢åŠ  4ä¸ªå­—æ®µï¼š<font color="DeepPink">æºç«¯å£ã€ç›®æ ‡ç«¯å£ã€åˆ†ç»„é•¿åº¦å’Œæ ¡éªŒå’Œ</font>ã€‚è¿™æ ·ï¼Œå½“IPæŠŠåˆ†ç»„é€è¾¾ç›®æ ‡ä¸»æœºæ—¶ï¼Œè¯¥ä¸»æœºèƒ½å¤Ÿæ‹†å¼€UDPåˆ†ç»„ï¼Œæ ¹æ®ç›®æ ‡ç«¯å£æ‰¾åˆ°ç›®æ ‡åº”ç”¨ç¨‹åºï¼Œç„¶åå†æŠŠæ¶ˆæ¯å‘é€è¿‡å»ã€‚ä»…æ­¤è€Œå·²ã€‚<br><img alt data-src="/images/high-performance-browser-networking-note/%E5%9B%BE32UDP%E9%A6%96%E9%83%A8.png"><br>äº‹å®ä¸Šï¼ŒUDPæ•°æ®æŠ¥ä¸­çš„æºç«¯å£å’Œæ ¡éªŒå’Œå­—æ®µéƒ½æ˜¯å¯é€‰çš„ã€‚IPåˆ†ç»„çš„é¦–éƒ¨ä¹Ÿæœ‰æ ¡éªŒå’Œï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å¿½ç•¥UDPæ ¡éªŒå’Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰é”™è¯¯æ£€æµ‹å’Œé”™è¯¯çº æ­£å·¥ä½œéƒ½å¯ä»¥å§”æ‰˜ç»™ä¸Šå±‚çš„åº”ç”¨ç¨‹åºã€‚è¯´åˆ°åº•ï¼Œ<font color="DeepPink">UDPä»…ä»…æ˜¯åœ¨IPå±‚ä¹‹ä¸Šé€šè¿‡åµŒå…¥åº”ç”¨ç¨‹åºçš„æºç«¯å£å’Œç›®æ ‡ç«¯å£</font>ï¼Œæä¾›äº†ä¸€ä¸ªâ€œåº”ç”¨ç¨‹åºå¤šè·¯å¤ç”¨â€æœºåˆ¶ã€‚æ˜ç™½äº†è¿™ä¸€ç‚¹ï¼Œå°±å¯ä»¥æ€»ç»“ä¸€ä¸‹UDPçš„æ— æœåŠ¡æ˜¯æ€ä¹ˆå›äº‹äº†ã€‚</p><ul><li>ä¸ä¿è¯æ¶ˆæ¯äº¤ä»˜<br>ä¸ç¡®è®¤ï¼Œä¸é‡ä¼ ï¼Œæ— è¶…æ—¶ã€‚</li><li>ä¸ä¿è¯äº¤ä»˜é¡ºåº<br>ä¸è®¾ç½®åŒ…åºå·ï¼Œä¸é‡æ’ï¼Œä¸ä¼šå‘ç”Ÿé˜Ÿé¦–é˜»å¡ã€‚</li><li>ä¸è·Ÿè¸ªè¿æ¥çŠ¶æ€<br>ä¸å¿…å»ºç«‹è¿æ¥æˆ–é‡å¯çŠ¶æ€æœºã€‚</li><li>ä¸éœ€è¦æ‹¥å¡æ§åˆ¶<br>ä¸å†…ç½®å®¢æˆ·ç«¯æˆ–ç½‘ç»œåé¦ˆæœºåˆ¶ã€‚</li></ul><p>TCPæ˜¯ä¸€ä¸ªé¢å‘å­—èŠ‚æµçš„åè®®ï¼Œèƒ½å¤Ÿä»¥å¤šä¸ªåˆ†ç»„å½¢å¼å‘é€åº”ç”¨ç¨‹åºæ¶ˆæ¯ï¼Œä¸”å¯¹åˆ†ç»„ä¸­çš„æ¶ˆæ¯èŒƒå›´æ²¡æœ‰ä»»ä½•æ˜ç¡®é™åˆ¶ã€‚å› æ­¤ï¼Œè¿æ¥çš„ä¸¤ç«¯å­˜åœ¨ä¸€ä¸ªè¿æ¥çŠ¶æ€ï¼Œæ¯ä¸ªåˆ†ç»„éƒ½æœ‰åºå·ï¼Œä¸¢å¤±è¿˜è¦é‡å‘ï¼Œå¹¶ä¸”è¦æŒ‰é¡ºåºäº¤ä»˜ã€‚ç›¸å¯¹æ¥è¯´ï¼Œ<font color="DeepPink">UDPæ•°æ®æŠ¥æœ‰æ˜ç¡®çš„é™åˆ¶ï¼šæ•°æ®æŠ¥å¿…é¡»å°è£…åœ¨IPåˆ†ç»„ä¸­ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»è¯»å–å®Œæ•´çš„æ¶ˆæ¯ã€‚æ¢å¥è¯è¯´ï¼Œæ•°æ®æŠ¥ä¸èƒ½åˆ†ç‰‡ã€‚</font></p><h3 id="UDPä¸ç½‘ç»œåœ°å€è½¬æ¢å™¨"><a href="#UDPä¸ç½‘ç»œåœ°å€è½¬æ¢å™¨" class="headerlink" title="UDPä¸ç½‘ç»œåœ°å€è½¬æ¢å™¨"></a>UDPä¸ç½‘ç»œåœ°å€è½¬æ¢å™¨</h3><p>ä½œä¸ºç›‘ç®¡å…¨çƒIPåœ°å€åˆ†é…çš„æœºæ„ï¼ŒIANAï¼ˆInternet Assigned Numbers Authorityï¼Œå› ç‰¹ç½‘å·ç åˆ†é…æœºæ„ï¼‰ä¸ºç§æœ‰ç½‘ç»œä¿ç•™äº†ä¸‰æ®µIPåœ°å€ï¼Œè¿™äº›IPåœ°å€ç»å¸¸å¯ä»¥åœ¨NATè®¾å¤‡åé¢çš„å†…ç½‘ä¸­çœ‹åˆ°ã€‚</p><p>ä¿ç•™çš„IPåœ°å€èŒƒå›´ï¼š</p><table><thead><tr><th>IPåœ°å€èŒƒå›´</th><th>åœ°å€æ•°é‡</th></tr></thead><tbody><tr><td>10.0.0.0~10.255.255.255</td><td>16 777 216</td></tr><tr><td>172.16.0.0~172.31.255.255</td><td>1 048 576</td></tr><tr><td>192.168.0.0~192.168.255.255</td><td>65 536</td></tr></tbody></table><blockquote><p>ä¸ºé˜²æ­¢è·¯ç”±é”™è¯¯å’Œå¼•èµ·ä¸å¿…è¦çš„éº»çƒ¦ï¼Œä¸å…è®¸ç»™å¤–ç½‘è®¡ç®—æœºåˆ†é…è¿™äº›ä¿ç•™çš„ç§æœ‰IPåœ°å€ã€‚</p></blockquote><h2 id="ä¼ è¾“å±‚å®‰å…¨ï¼ˆTLSï¼‰"><a href="#ä¼ è¾“å±‚å®‰å…¨ï¼ˆTLSï¼‰" class="headerlink" title="ä¼ è¾“å±‚å®‰å…¨ï¼ˆTLSï¼‰"></a>ä¼ è¾“å±‚å®‰å…¨ï¼ˆTLSï¼‰</h2><p>SSLï¼ˆSecure Sockets Layerï¼Œå®‰å…¨å¥—æ¥å­—å±‚ï¼‰åè®®æœ€åˆæ˜¯ç½‘æ™¯å…¬å¸ä¸ºäº†ä¿éšœç½‘ä¸Šäº¤æ˜“å®‰å…¨è€Œå¼€å‘çš„ï¼Œè¯¥åè®®é€šè¿‡åŠ å¯†æ¥ä¿æŠ¤å®¢æˆ·ä¸ªäººèµ„æ–™ï¼Œé€šè¿‡è®¤è¯å’Œå®Œæ•´æ€§æ£€æŸ¥æ¥ç¡®ä¿äº¤æ˜“å®‰å…¨ã€‚ä¸ºè¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼ŒSSLåè®®åœ¨ç›´æ¥ä½äºTCPä¸Šä¸€å±‚çš„åº”ç”¨å±‚è¢«å®ç°ï¼ˆå›¾ 4-1ï¼‰ã€‚SSLä¸ä¼šå½±å“ä¸Šå±‚åè®®ï¼ˆå¦‚HTTPã€ç”µå­é‚®ä»¶ã€å³æ—¶é€šè®¯ï¼‰ï¼Œä½†èƒ½å¤Ÿä¿è¯ä¸Šå±‚åè®®çš„ç½‘ç»œé€šä¿¡å®‰å…¨ã€‚<br><img alt data-src="/images/high-performance-browser-networking-note/%E5%9B%BE41%E4%BC%A0%E8%BE%93%E5%B1%82%E5%AE%89%E5%85%A8.png"><br>åœ¨æ­£ç¡®ä½¿ç”¨SSLçš„æƒ…å†µä¸‹ï¼Œç¬¬ä¸‰æ–¹ç›‘å¬è€…åªèƒ½æ¨æ–­å‡ºè¿æ¥çš„ç«¯ç‚¹ã€åŠ å¯†ç±»å‹ï¼Œä»¥åŠå‘é€æ•°æ®çš„é¢‘ç‡å’Œå¤§è‡´æ•°é‡ï¼Œä¸èƒ½å®é™…è¯»å–æˆ–ä¿®æ”¹ä»»ä½•æ•°æ®ã€‚</p><h3 id="ä¿¡ä»»é“¾ä¸è¯ä¹¦é¢å‘æœºæ„"><a href="#ä¿¡ä»»é“¾ä¸è¯ä¹¦é¢å‘æœºæ„" class="headerlink" title="ä¿¡ä»»é“¾ä¸è¯ä¹¦é¢å‘æœºæ„"></a>ä¿¡ä»»é“¾ä¸è¯ä¹¦é¢å‘æœºæ„</h3><p>Webä»¥åŠæµè§ˆå™¨ä¸­çš„èº«ä»½éªŒè¯éœ€è¦å›ç­”ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼šæˆ‘çš„æµè§ˆå™¨ä¿¡ä»»è°ï¼Ÿæˆ‘åœ¨ä½¿ç”¨æµè§ˆå™¨çš„æ—¶å€™ä¿¡ä»»è°ï¼Ÿè¿™ä¸ªé—®é¢˜è‡³å°‘æœ‰ä¸‰ä¸ªç­”æ¡ˆã€‚</p><ul><li>æ‰‹å·¥æŒ‡å®šè¯ä¹¦<br>æ‰€æœ‰æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿéƒ½æä¾›äº†ä¸€ç§æ‰‹å·¥å¯¼å…¥ä¿¡ä»»è¯ä¹¦çš„æœºåˆ¶ã€‚è‡³äºå¦‚ä½•è·å¾—è¯ä¹¦å’ŒéªŒè¯å®Œæ•´æ€§åˆ™å®Œå…¨ç”±ä½ è‡ªå·±æ¥å®šã€‚</li><li>è¯ä¹¦é¢å‘æœºæ„<br>CAï¼ˆCertificate Authorityï¼Œè¯ä¹¦é¢å‘æœºæ„ï¼‰æ˜¯è¢«è¯ä¹¦æ¥å—è€…ï¼ˆæ‹¥æœ‰è€…ï¼‰å’Œä¾èµ–è¯ä¹¦çš„ä¸€æ–¹å…±åŒä¿¡ä»»çš„ç¬¬ä¸‰æ–¹ã€‚</li><li>æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿ<br>æ¯ä¸ªæ“ä½œç³»ç»Ÿå’Œå¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šå†…ç½®ä¸€ä¸ªçŸ¥åè¯ä¹¦é¢å‘æœºæ„çš„åå•ã€‚å› æ­¤ï¼Œä½ ä¹Ÿä¼šä¿¡ä»»æ“ä½œç³»ç»ŸåŠæµè§ˆå™¨æä¾›å•†æä¾›å’Œç»´æŠ¤çš„å¯ä¿¡ä»»æœºæ„ã€‚</li></ul><p>å®è·µä¸­ï¼Œä¿å­˜å¹¶æ‰‹å·¥éªŒè¯æ¯ä¸ªç½‘ç«™çš„å¯†é’¥æ˜¯ä¸å¯è¡Œçš„ï¼ˆå½“ç„¶ï¼Œå¦‚æœä½ æ„¿æ„ï¼Œä¹Ÿå¯ä»¥ï¼‰ã€‚ç°å®ä¸­æœ€å¸¸è§çš„æ–¹æ¡ˆå°±æ˜¯è®©è¯ä¹¦é¢å‘æœºæ„æ›¿æˆ‘ä»¬åšè¿™ä»¶äº‹ï¼ˆå›¾ 4-5ï¼‰ï¼šæµè§ˆå™¨æŒ‡å®šå¯ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆæ ¹CAï¼‰ï¼Œç„¶åéªŒè¯ä»–ä»¬ç­¾ç½²çš„æ¯ä¸ªç«™ç‚¹çš„è´£ä»»å°±è½¬ç§»åˆ°äº†ä»–ä»¬å¤´ä¸Šï¼Œä»–ä»¬ä¼šå®¡è®¡å’ŒéªŒè¯è¿™äº›ç«™ç‚¹çš„è¯ä¹¦æ²¡æœ‰è¢«æ»¥ç”¨æˆ–å†’å……ã€‚æŒæœ‰CAè¯ä¹¦çš„ç«™ç‚¹çš„å®‰å…¨æ€§å¦‚æœé­åˆ°ç ´åï¼Œé‚£æ’¤é”€è¯¥è¯ä¹¦ä¹Ÿæ˜¯è¯ä¹¦é¢å‘æœºæ„çš„è´£ä»»ã€‚<br><img alt data-src="/images/high-performance-browser-networking-note/%E5%9B%BE45%E8%AF%81%E4%B9%A6%E9%A2%81%E5%8F%91%E6%9C%BA%E6%9E%84%E7%AD%BE%E7%BD%B2%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6.png"><br>æ‰€æœ‰æµè§ˆå™¨éƒ½å…è®¸ç”¨æˆ·æ£€è§†è‡ªå·±å®‰å…¨è¿æ¥çš„ä¿¡ä»»é“¾ï¼Œå¸¸è§çš„è®¿é—®å…¥å£å°±æ˜¯åœ°å€æ å¤´å„¿ä¸Šçš„é”å›¾æ ‡ï¼Œç‚¹å‡»å³å¯æŸ¥çœ‹ã€‚</p><h3 id="è¯ä¹¦æ’¤é”€"><a href="#è¯ä¹¦æ’¤é”€" class="headerlink" title="è¯ä¹¦æ’¤é”€"></a>è¯ä¹¦æ’¤é”€</h3><h4 id="è¯ä¹¦æ’¤é”€åå•ï¼ˆCRLï¼‰"><a href="#è¯ä¹¦æ’¤é”€åå•ï¼ˆCRLï¼‰" class="headerlink" title="è¯ä¹¦æ’¤é”€åå•ï¼ˆCRLï¼‰"></a>è¯ä¹¦æ’¤é”€åå•ï¼ˆCRLï¼‰</h4><p>CRLï¼ˆCertificate Revocation Listï¼Œè¯ä¹¦æ’¤é”€åå•ï¼‰æ˜¯RFC 5280è§„å®šçš„ä¸€ç§æ£€æŸ¥æ‰€æœ‰è¯ä¹¦çŠ¶æ€çš„ç®€å•æœºåˆ¶ï¼šæ¯ä¸ªè¯ä¹¦é¢å‘æœºæ„ç»´æŠ¤å¹¶å®šæœŸå‘å¸ƒå·²æ’¤é”€è¯ä¹¦çš„åºåˆ—å·å<br>å•ã€‚è¿™æ ·ï¼Œä»»ä½•æƒ³éªŒè¯è¯ä¹¦çš„äººéƒ½å¯ä»¥ä¸‹è½½æ’¤é”€åå•ï¼Œæ£€æŸ¥ç›¸åº”è¯ä¹¦æ˜¯å¦æ¦œä¸Šæœ‰åã€‚å¦‚æœæœ‰ï¼Œè¯´æ˜è¯ä¹¦å·²ç»è¢«æ’¤é”€äº†ã€‚</p><p>CRLæ–‡ä»¶æœ¬èº«å¯ä»¥å®šæœŸå‘å¸ƒã€æ¯æ¬¡æ›´æ–°æ—¶å‘å¸ƒï¼Œæˆ–é€šè¿‡HTTPæˆ–å…¶ä»–æ–‡ä»¶ä¼ è¾“åè®®æ¥æä¾›è®¿é—®ã€‚è¿™ä¸ªåå•åŒæ ·ç”±è¯ä¹¦é¢å‘æœºæ„ç­¾åï¼Œé€šå¸¸å…è®¸è¢«ç¼“å­˜ä¸€å®šæ—¶é—´ã€‚å®è·µä¸­ï¼Œè¿™ç§æœºåˆ¶æ•ˆæœå¾ˆå¥½ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>CRLåå•ä¼šéšç€è¦æ’¤é”€çš„è¯ä¹¦å¢å¤šè€Œå˜é•¿ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯éƒ½å¿…é¡»å–å¾—åŒ…å«æ‰€æœ‰åºåˆ—å·çš„å®Œæ•´åå•ï¼›</li><li>æ²¡æœ‰åŠæ³•ç«‹å³æ›´æ–°åˆšåˆšè¢«æ’¤é”€çš„è¯ä¹¦åºåˆ—å·ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯å…ˆç¼“å­˜äº†CRLï¼Œä¹‹åæŸè¯ä¹¦è¢«æ’¤é”€ï¼Œé‚£åˆ°ç¼“å­˜è¿‡æœŸä¹‹å‰ï¼Œè¯¥è¯ä¹¦å°†ä¸€ç›´è¢«è§†ä¸ºæœ‰æ•ˆã€‚</li></ul><h4 id="åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼ˆOCSPï¼‰"><a href="#åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼ˆOCSPï¼‰" class="headerlink" title="åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼ˆOCSPï¼‰"></a>åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼ˆOCSPï¼‰</h4><p>ä¸ºè§£å†³CRLæœºåˆ¶çš„ä¸Šè¿°é—®é¢˜ï¼ŒRFC 2560å®šä¹‰äº†OCSPï¼ˆOnline Certificate Status Protocolï¼Œåœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼‰ï¼Œæä¾›äº†ä¸€ç§å®æ—¶æ£€æŸ¥è¯ä¹¦çŠ¶æ€çš„æœºåˆ¶ã€‚ä¸CRLåŒ…å«è¢«æ’¤é”€è¯ä¹¦çš„åºåˆ—å·ä¸åŒï¼ŒOCSP æ”¯æŒéªŒè¯ç«¯ç›´æ¥æŸ¥è¯¢è¯ä¹¦æ•°æ®åº“ä¸­çš„åºåˆ—å·ï¼Œä»è€ŒéªŒè¯è¯ä¹¦é“¾æ˜¯å¦æœ‰æ•ˆã€‚æ€»ä¹‹ï¼ŒOCSP å ç”¨å¸¦å®½æ›´å°‘ï¼Œæ”¯æŒå®æ—¶éªŒè¯ã€‚</p><p>ç„¶è€Œï¼Œæ²¡æœ‰ä»€ä¹ˆæœºåˆ¶æ˜¯å®Œç¾æ— ç¼ºçš„ï¼å®æ—¶OCSPæŸ¥è¯¢ä¹Ÿå¸¦äº†ä¸€äº›é—®é¢˜ï¼š</p><ul><li>è¯ä¹¦é¢å‘æœºæ„å¿…é¡»å¤„ç†å®æ—¶æŸ¥è¯¢ï¼›</li><li>è¯ä¹¦é¢å‘æœºæ„å¿…é¡»ç¡®ä¿éšæ—¶éšåœ°å¯ä»¥è®¿é—®ï¼›</li><li>å®¢æˆ·ç«¯åœ¨è¿›ä¸€æ­¥åå•†ä¹‹å‰é˜»å¡OCSPè¯·æ±‚ï¼›</li><li>ç”±äºè¯ä¹¦é¢å‘æœºæ„çŸ¥é“å®¢æˆ·ç«¯è¦è®¿é—®å“ªä¸ªç«™ç‚¹ï¼Œå› æ­¤å®æ—¶OCSPè¯·æ±‚å¯èƒ½ä¼šæ³„éœ²å®¢æˆ·ç«¯çš„éšç§ã€‚</li></ul><blockquote><p>å®è·µä¸­ï¼ŒCRLå’ŒOCSPæœºåˆ¶æ˜¯äº’è¡¥å­˜åœ¨çš„ï¼Œå¤§å¤šæ•°è¯ä¹¦æ—¢æä¾›æŒ‡ä»¤ä¹Ÿæ”¯æŒæŸ¥è¯¢ã€‚<br>æ›´é‡è¦çš„å€’æ˜¯å®¢æˆ·ç«¯çš„æ”¯æŒå’Œè¡Œä¸ºã€‚æœ‰çš„æµè§ˆå™¨ä¼šåˆ†å‘è‡ªå·±çš„CRLåå•ï¼Œæœ‰çš„æµè§ˆå™¨ä»è¯ä¹¦é¢å‘æœºæ„å–å¾—å¹¶ç¼“å­˜CRLæ–‡ä»¶ã€‚ç±»ä¼¼åœ°ï¼Œæœ‰çš„æµè§ˆå™¨ä¼šè¿›è¡Œå®æ—¶OCSPæ£€æŸ¥ï¼Œä½†åœ¨OCSPè¯·æ±‚å¤±è´¥çš„æƒ…å†µä¸‹è¡Œä¸ºåˆä¼šæœ‰æ‰€ä¸åŒã€‚è¦äº†è§£å…·ä½“çš„æƒ…å†µï¼Œå¯ä»¥æ£€æŸ¥æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿçš„è¯ä¹¦æ’¤é”€ç½‘ç»œè®¾ç½®ã€‚</p></blockquote><h3 id="é’ˆå¯¹TLSçš„ä¼˜åŒ–å»ºè®®"><a href="#é’ˆå¯¹TLSçš„ä¼˜åŒ–å»ºè®®" class="headerlink" title="é’ˆå¯¹TLSçš„ä¼˜åŒ–å»ºè®®"></a>é’ˆå¯¹TLSçš„ä¼˜åŒ–å»ºè®®</h3><h4 id="TLSè®°å½•å¤§å°"><a href="#TLSè®°å½•å¤§å°" class="headerlink" title="TLSè®°å½•å¤§å°"></a>TLSè®°å½•å¤§å°</h4><p>ä¸è¿‡å¯¹äºåœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„Webåº”ç”¨æ¥è¯´ï¼Œå€’æ˜¯æœ‰ä¸€ä¸ªå€¼å¾—æ¨èçš„åšæ³•ï¼šæ¯ä¸ªTCPåˆ†ç»„æ°å¥½å°è£…ä¸€ä¸ªTLSè®°å½•ï¼Œè€ŒTLSè®°å½•å¤§å°æ°å¥½å æ»¡TCPåˆ†é…çš„MSSï¼ˆMaximum Segment Sizeï¼Œæœ€å¤§æ®µå¤§å°ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œä¸€æ–¹é¢ä¸è¦è®©TLSè®°å½•åˆ†æˆå¤šä¸ªTCPåˆ†ç»„ï¼Œå¦ä¸€æ–¹é¢åˆè¦å°½é‡åœ¨ä¸€æ¡è®°å½•ä¸­å¤šå‘é€æ•°æ®ã€‚ä»¥ä¸‹æ•°æ®å¯ä½œä¸ºç¡®å®šæœ€ä¼˜TLSè®°å½•å¤§å°çš„å‚è€ƒï¼š</p><ul><li>IPv4 å¸§éœ€è¦ 20 å­—èŠ‚ï¼ŒIPv6 éœ€è¦ 40 å­—èŠ‚ï¼›</li><li>TCP å¸§éœ€è¦ 20 å­—èŠ‚ï¼›</li><li>TCP é€‰é¡¹éœ€è¦ 40 å­—èŠ‚ï¼ˆæ—¶é—´æˆ³ã€SACK ç­‰ï¼‰ã€‚</li></ul><p>å‡è®¾å¸¸è§çš„MTUä¸º1500å­—èŠ‚ï¼Œåˆ™TLSè®°å½•å¤§å°åœ¨IPv4ä¸‹æ˜¯1420å­—èŠ‚ï¼Œåœ¨IPv6ä¸‹æ˜¯1400å­—èŠ‚ã€‚ä¸ºç¡®ä¿å‘å‰å…¼å®¹ï¼Œå»ºè®®ä½¿ç”¨IPv6ä¸‹çš„å¤§å°ï¼š1400å­—èŠ‚ã€‚å½“ç„¶ï¼Œå¦‚æœMTUæ›´å°ï¼Œè¿™ä¸ªå€¼ä¹Ÿè¦ç›¸åº”è°ƒå°ã€‚</p><p>å¯æƒœçš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨åº”ç”¨å±‚æ§åˆ¶TLSè®°å½•å¤§å°ã€‚TLSè®°å½•å¤§å°é€šå¸¸æ˜¯ä¸€ä¸ªè®¾ç½®ï¼Œç”šè‡³æ˜¯TLSæœåŠ¡å™¨ä¸Šçš„ç¼–è¯‘æ—¶å¸¸é‡æˆ–æ ‡å¿—ã€‚è¦äº†è§£å…·ä½“å¦‚ä½•è®¾ç½®è¿™ä¸ªå€¼ï¼Œè¯·å‚è€ƒæœåŠ¡å™¨æ–‡æ¡£ã€‚</p><blockquote><p>å¦‚æœæœåŠ¡å™¨è¦å¤„ç†å¤§é‡TLSè¿æ¥ï¼Œé‚£ä¹ˆå…³é”®çš„ä¼˜åŒ–æ˜¯æŠŠæ¯ä¸ªè¿æ¥å ç”¨çš„å†…å­˜é‡æ§åˆ¶åœ¨æœ€å°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenSSLç­‰å¸¸ç”¨çš„åº“ä¼šç»™æ¯ä¸ªè¿æ¥åˆ†é…50KBç©ºé—´ï¼Œä½†æ­£åƒè®¾ç½®è®°å½•å¤§å°ä¸€æ ·ï¼Œæœ‰å¿…è¦æŸ¥ä¸€æŸ¥æ–‡æ¡£æˆ–è€…æºä»£ç ï¼Œç„¶åå†å†³å®šå¦‚ä½•è°ƒæ•´è¿™ä¸ªå€¼ã€‚è°·æ­Œçš„æœåŠ¡å™¨æŠŠOpenSSLç¼“å†²åŒºçš„å¤§å°å‡å°‘åˆ°äº†å¤§çº¦5KBã€‚</p></blockquote><h4 id="TLSå‹ç¼©"><a href="#TLSå‹ç¼©" class="headerlink" title="TLSå‹ç¼©"></a>TLSå‹ç¼©</h4><p>TLSè¿˜æœ‰ä¸€ä¸ªå†…ç½®çš„å°åŠŸèƒ½ï¼Œå°±æ˜¯æ”¯æŒå¯¹è®°å½•åè®®ä¼ è¾“çš„æ•°æ®è¿›è¡Œæ— æŸå‹ç¼©ã€‚å‹ç¼©ç®—æ³•åœ¨TLSæ¡æ‰‹æœŸé—´å•†å®šï¼Œå‹ç¼©æ“ä½œåœ¨å¯¹è®°å½•åŠ å¯†ä¹‹å‰æ‰§è¡Œã€‚ç„¶è€Œï¼Œå‡ºäºå¦‚ä¸‹åŸå› ï¼Œå®è·µä¸­å¾€å¾€éœ€è¦ç¦ç”¨æœåŠ¡å™¨ä¸Šçš„TLSå‹ç¼©åŠŸèƒ½ï¼š</p><ul><li>2012 å¹´å…¬å¸ƒçš„â€œCRIMEâ€æ”»å‡»ä¼šåˆ©ç”¨TLSå‹ç¼©æ¢å¤åŠ å¯†è®¤è¯cookieï¼Œè®©æ”»å‡»è€…å®æ–½ä¼šè¯åŠ«æŒï¼›</li><li>ä¼ è¾“çº§çš„TLSå‹ç¼©ä¸å…³å¿ƒå†…å®¹ï¼Œå¯èƒ½ä¼šå†æ¬¡å‹ç¼©å·²ç»å‹ç¼©è¿‡çš„æ•°æ®ï¼ˆå›¾åƒã€è§†é¢‘ç­‰ç­‰ï¼‰ã€‚</li></ul><p>åŒé‡å‹ç¼©ä¼šæµªè´¹æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„CPUæ—¶é—´ï¼Œè€Œä¸”æš´éœ²çš„å®‰å…¨æ¼æ´ä¹Ÿå¾ˆä¸¥é‡ï¼Œå› æ­¤è¯·ç¦ç”¨TLSå‹ç¼©ã€‚å®è·µä¸­ï¼Œå¤§å¤šæ•°æµè§ˆå™¨ä¼šç¦ç”¨TLSå‹ç¼©ï¼Œä½†å³ä¾¿å¦‚æ­¤ä½ ä¹Ÿåº”è¯¥åœ¨æœåŠ¡å™¨çš„é…ç½®ä¸­æ˜ç¡®ç¦ç”¨å®ƒï¼Œä»¥ä¿æŠ¤ç”¨æˆ·çš„åˆ©ç›Šã€‚</p><blockquote><p>è™½ç„¶ä¸èƒ½ä½¿ç”¨TLSå‹ç¼©ï¼Œä½†åº”è¯¥ä½¿ç”¨æœåŠ¡å™¨çš„Gzipè®¾ç½®å‹ç¼©æ‰€æœ‰æ–‡æœ¬èµ„æºï¼ŒåŒæ—¶å¯¹å›¾åƒã€è§†é¢‘ã€éŸ³é¢‘ç­‰åª’ä½“é‡‡ç”¨æœ€åˆé€‚çš„å‹ç¼©æ ¼å¼ã€‚</p></blockquote><h1 id="æ— çº¿ç½‘ç»œæ€§èƒ½"><a href="#æ— çº¿ç½‘ç»œæ€§èƒ½" class="headerlink" title="æ— çº¿ç½‘ç»œæ€§èƒ½"></a>æ— çº¿ç½‘ç»œæ€§èƒ½</h1><h2 id="ç§»åŠ¨ç½‘ç»œçš„ä¼˜åŒ–å»ºè®®"><a href="#ç§»åŠ¨ç½‘ç»œçš„ä¼˜åŒ–å»ºè®®" class="headerlink" title="ç§»åŠ¨ç½‘ç»œçš„ä¼˜åŒ–å»ºè®®"></a>ç§»åŠ¨ç½‘ç»œçš„ä¼˜åŒ–å»ºè®®</h2><h3 id="æ¶ˆé™¤å‘¨æœŸæ€§åŠæ— æ•ˆçš„æ•°æ®ä¼ è¾“"><a href="#æ¶ˆé™¤å‘¨æœŸæ€§åŠæ— æ•ˆçš„æ•°æ®ä¼ è¾“" class="headerlink" title="æ¶ˆé™¤å‘¨æœŸæ€§åŠæ— æ•ˆçš„æ•°æ®ä¼ è¾“"></a>æ¶ˆé™¤å‘¨æœŸæ€§åŠæ— æ•ˆçš„æ•°æ®ä¼ è¾“</h3><p>å¯¹æ¨é€è€Œè¨€ï¼ŒåŸç”Ÿåº”ç”¨å¯ä»¥è®¿é—®å¹³å°ä¸“æœ‰çš„æ¨é€æœåŠ¡ï¼Œå› æ­¤åº”è¯¥å°½å¯èƒ½ä½¿ç”¨ã€‚å¯¹ Web åº”ç”¨æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨SSEï¼ˆServer Sent Eventsï¼ŒæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼‰å’ŒWebSocketä»¥é™ä½å»¶è¿Ÿæ—¶é—´å’Œåè®®æ¶ˆè€—ï¼Œå°½å¯èƒ½ä¸ä½¿ç”¨è½®è¯¢å’Œæ›´è€—èµ„æºçš„XHRæŠ€æœ¯ã€‚</p><h3 id="æ¶ˆé™¤ä¸å¿…è¦çš„é•¿è¿æ¥"><a href="#æ¶ˆé™¤ä¸å¿…è¦çš„é•¿è¿æ¥" class="headerlink" title="æ¶ˆé™¤ä¸å¿…è¦çš„é•¿è¿æ¥"></a>æ¶ˆé™¤ä¸å¿…è¦çš„é•¿è¿æ¥</h3><p>TCPæˆ–UDPè¿æ¥çš„è¿æ¥çŠ¶æ€åŠç”Ÿå‘½æœŸä¸è®¾å¤‡çš„æ— çº¿çŠ¶æ€æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚æ¢å¥è¯è¯´ï¼Œå³ä¾¿ä¸è¿è¥å•†ç½‘ç»œä»ç»´æŒç€ï¼ˆä¸¤ç«¯é—´ï¼‰è¿æ¥ä¸ä¸­æ–­ï¼Œæ— çº¿æ¨¡å—ä¹Ÿå¯ä»¥å¤„äºä½è€—ç”µçŠ¶æ€ã€‚å¤–éƒ¨ç½‘ç»œçš„åˆ†ç»„åˆ°æ¥æ—¶ï¼Œè¿è¥å•†æ— çº¿ç½‘ç»œä¼šé€šçŸ¥è®¾å¤‡ï¼Œä½¿å…¶æ— çº¿æ¨¡å—åˆ‡æ¢åˆ°è¿æ¥çŠ¶æ€ï¼Œä»è€Œæ¢å¤æ•°æ®ä¼ è¾“ã€‚</p><p>æ˜ç™½äº†å—ï¼Œåº”ç”¨ä¸å¿…è®©æ— çº¿æ¨¡å—â€œæ´»åŠ¨â€ä¹Ÿå¯ä»¥ä¿æŒè¿æ¥ä¸è¢«æ–­å¼€ã€‚ä½†ä¸å¿…è¦çš„é•¿è¿æ¥ä¹Ÿæœ‰å¯èƒ½æå¤§åœ°æ¶ˆè€—ç”µé‡ï¼Œè€Œä¸”ç”±äºäººä»¬å¯¹ç§»åŠ¨ç½‘ç»œæ— çº¿é€šä¿¡çš„è¯¯è§£ï¼Œè¿™ç§æƒ…å†µç»å¸¸å‘ç”Ÿã€‚</p><h3 id="é¢„æµ‹ç½‘ç»œå»¶è¿Ÿä¸Šé™"><a href="#é¢„æµ‹ç½‘ç»œå»¶è¿Ÿä¸Šé™" class="headerlink" title="é¢„æµ‹ç½‘ç»œå»¶è¿Ÿä¸Šé™"></a>é¢„æµ‹ç½‘ç»œå»¶è¿Ÿä¸Šé™</h3><p>åœ¨ç§»åŠ¨ç½‘ç»œä¸­ï¼Œä¸€ä¸ªHTTPè¯·æ±‚å¾ˆå¯èƒ½ä¼šå¯¼è‡´ä¸€è¿ä¸²é•¿è¾¾å‡ ç™¾ç”šè‡³ä¸Šå‡ åƒmsçš„ç½‘ç»œå»¶è¿Ÿã€‚è¿™ä¸€æ–¹é¢æ˜¯å› ä¸ºæœ‰å¾€è¿”å»¶è¿Ÿï¼Œå¦ä¸€æ–¹é¢ä¹Ÿä¸èƒ½å¿˜è®°DNSã€TCPã€TLSåŠæ§åˆ¶é¢çš„å»¶è¿Ÿï¼ˆå›¾8-2ï¼‰ã€‚<br><img alt data-src="/images/high-performance-browser-networking-note/%E5%9B%BE82%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84HTTP%E8%AF%B7%E6%B1%82%E7%9A%84%E6%9E%84%E6%88%90.png"></p><h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><h2 id="HTTP-ç®€å²"><a href="#HTTP-ç®€å²" class="headerlink" title="HTTP ç®€å²"></a>HTTP ç®€å²</h2><h3 id="HTTP-1-0ï¼šè¿…é€Ÿå‘å±•åŠå‚è€ƒæ€§RFC"><a href="#HTTP-1-0ï¼šè¿…é€Ÿå‘å±•åŠå‚è€ƒæ€§RFC" class="headerlink" title="HTTP 1.0ï¼šè¿…é€Ÿå‘å±•åŠå‚è€ƒæ€§RFC"></a>HTTP 1.0ï¼šè¿…é€Ÿå‘å±•åŠå‚è€ƒæ€§RFC</h3><p>ä»Šå¤©ï¼Œå‡ ä¹æ‰€æœ‰WebæœåŠ¡å™¨éƒ½æ”¯æŒï¼Œè€Œä¸”ä»¥åè¿˜ä¼šç»§ç»­æ”¯æŒHTTP 1.0ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå‰©ä¸‹çš„ä½ éƒ½çŸ¥é“äº†ã€‚ä½†HTTP 1.0å¯¹æ¯ä¸ªè¯·æ±‚éƒ½æ‰“å¼€ä¸€ä¸ªæ–°TCPè¿æ¥ä¸¥é‡å½±å“æ€§èƒ½ã€‚</p><h3 id="HTTP-1-1ï¼šäº’è”ç½‘æ ‡å‡†"><a href="#HTTP-1-1ï¼šäº’è”ç½‘æ ‡å‡†" class="headerlink" title="HTTP 1.1ï¼šäº’è”ç½‘æ ‡å‡†"></a>HTTP 1.1ï¼šäº’è”ç½‘æ ‡å‡†</h3><p>HTTP 1.1 æ ‡å‡†å˜æ¸…äº†ä¹‹å‰ç‰ˆæœ¬ä¸­å¾ˆå¤šæœ‰æ­§ä¹‰çš„åœ°æ–¹ï¼Œè€Œä¸”è¿˜åŠ å…¥äº†å¾ˆå¤šé‡è¦çš„æ€§èƒ½ä¼˜åŒ–ï¼š<font color="DeepPink">æŒä¹…è¿æ¥ã€åˆ†å—ç¼–ç ä¼ è¾“ã€å­—èŠ‚èŒƒå›´è¯·æ±‚ã€å¢å¼ºçš„ç¼“å­˜æœºåˆ¶ã€ä¼ è¾“ç¼–ç åŠè¯·æ±‚ç®¡é“</font>ã€‚</p><p>HTTP 1.1 æ”¹å˜äº†HTTPåè®®çš„è¯­ä¹‰ï¼Œé»˜è®¤ä½¿ç”¨æŒä¹…è¿æ¥ã€‚æ¢å¥è¯è¯´ï¼Œé™¤éæ˜ç¡®å‘ŠçŸ¥ï¼ˆé€šè¿‡Connection: close é¦–éƒ¨ï¼‰ï¼Œå¦åˆ™æœåŠ¡å™¨é»˜è®¤ä¼šä¿æŒè¿æ¥æ‰“å¼€ã€‚</p><p>ä¸è¿‡ï¼Œè¿™ä¸ªåŠŸèƒ½ä¹Ÿåå‘ç§»æ¤åˆ°äº†HTTP 1.0ï¼Œå¯ä»¥é€šè¿‡Connection: Keep-Alive é¦–éƒ¨æ¥å¯ç”¨ã€‚å®é™…ä¸Šï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯HTTP 1.1ï¼Œä»æŠ€æœ¯ä¸Šè¯´ä¸éœ€è¦Connection: Keep-Aliveé¦–éƒ¨ï¼Œä½†å¾ˆå¤šå®¢æˆ·ç«¯è¿˜æ˜¯é€‰æ‹©åŠ ä¸Šå®ƒã€‚</p><p>æ­¤å¤–ï¼ŒHTTP 1.1 åè®®æ·»åŠ äº†å†…å®¹ã€ç¼–ç ã€å­—ç¬¦é›†ï¼Œç”šè‡³è¯­è¨€çš„åå•†æœºåˆ¶ï¼Œè¿˜æ·»åŠ äº†ä¼ è¾“ç¼–ç ã€ç¼“å­˜æŒ‡ä»¤ã€å®¢æˆ·ç«¯cookie ç­‰åå‡ ä¸ªå¯ä»¥æ¯æ¬¡è¯·æ±‚éƒ½åå•†çš„å­—æ®µã€‚</p><h3 id="HTTP-2-0ï¼šæ”¹è¿›ä¼ è¾“æ€§èƒ½"><a href="#HTTP-2-0ï¼šæ”¹è¿›ä¼ è¾“æ€§èƒ½" class="headerlink" title="HTTP 2.0ï¼šæ”¹è¿›ä¼ è¾“æ€§èƒ½"></a>HTTP 2.0ï¼šæ”¹è¿›ä¼ è¾“æ€§èƒ½</h3><blockquote><p>HTTPï¼ˆHypertext Transfer Protocolï¼‰æ˜¯ä¸€ä¸ªåº”ç”¨å±‚åè®®ï¼Œå¯ç”¨äºåˆ†å¸ƒåä½œå¼çš„è¶…åª’ä½“ç³»ç»Ÿã€‚å®ƒæ˜¯ä¸€ä¸ªé€šç”¨ã€æ— çŠ¶æ€çš„åè®®ã€‚é™¤äº†è¶…æ–‡æœ¬ï¼Œé€šè¿‡æ‰©å±•å®ƒçš„è¯·æ±‚æ–¹å¼ã€é”™è¯¯ç¼–ç åŠé¦–éƒ¨ï¼Œè¿˜å¯ä»¥å°†å®ƒç”¨äºå¾ˆå¤šå…¶ä»–é¢†åŸŸï¼Œæ¯”å¦‚åŸŸåæœåŠ¡å™¨å’Œåˆ†å¸ƒå¼å¯¹è±¡ç®¡ç†ç³»ç»Ÿã€‚HTTPçš„ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯å…è®¸æ•°æ®çš„ç±»å‹å˜åŒ–å’Œåå•†ï¼Œä»è€Œå…è®¸ç³»ç»Ÿç‹¬ç«‹äºè¢«ä¼ è¾“çš„æ•°æ®æ„å»ºã€‚â€”â€”RFC 2616ï¼šHTTP/1.1ï¼ˆ1999 å¹´ 6 æœˆï¼‰</p></blockquote><blockquote><p>å½“å‰ï¼Œå‡ºç°äº†ä¸€ç§ä¿æŒHTTPè¯­ä¹‰ï¼Œä½†è„±ç¦»HTTP/1.xæ¶ˆæ¯åˆ†å¸§åŠè¯­æ³•çš„åè®®ç”¨æ³•ã€‚è¿™ç§ç”¨æ³•è¢«è¯æ˜æœ‰ç¢äºæ€§èƒ½ï¼Œå¹¶ä¸”æ˜¯åœ¨é¼“åŠ±æ»¥ç”¨åº•å±‚ä¼ è¾“åè®®ã€‚æœ¬å·¥ä½œç»„å°†åˆ¶å®šä¸€ä¸ªæ–°è§„èŒƒï¼Œä»æœ‰åºã€åŠåŒå·¥æµçš„è§’åº¦é‡æ–°è¡¨è¾¾å½“å‰HTTPçš„è¯­ä¹‰ã€‚ä¸HTTP/1.xä¸€æ ·ï¼Œä¸»è¦å°†ä½¿ç”¨TCPä½œä¸ºä¼ è¾“å±‚ï¼Œä¸è¿‡ä¹Ÿåº”è¯¥æ”¯æŒå…¶ä»–ä¼ è¾“åè®®ã€‚â€”â€”HTTP 2.0 çº²é¢† ï¼ˆ2012 å¹´ 1 æœˆï¼‰</p></blockquote><p>HTTP 2.0 çš„ä¸»è¦ç›®æ ‡æ˜¯æ”¹è¿›ä¼ è¾“æ€§èƒ½ï¼Œå®ç°ä½å»¶è¿Ÿå’Œé«˜ååé‡ã€‚ä¸»ç‰ˆæœ¬å·çš„å¢åŠ å¬èµ·æ¥åƒæ˜¯è¦åšå¤§çš„æ”¹è¿›ï¼Œä»æ€§èƒ½è§’åº¦è¯´çš„ç¡®å¦‚æ­¤ã€‚ä½†ä»å¦ä¸€æ–¹é¢çœ‹ï¼ŒHTTPçš„é«˜å±‚åè®®è¯­ä¹‰å¹¶ä¸ä¼šå› ä¸ºè¿™æ¬¡ç‰ˆæœ¬å‡çº§è€Œå—å½±å“ã€‚æ‰€æœ‰ HTTP é¦–éƒ¨ã€å€¼ï¼Œä»¥åŠå®ƒä»¬çš„ä½¿ç”¨åœºæ™¯éƒ½ä¸ä¼šå˜ã€‚</p><h2 id="Webæ€§èƒ½è¦ç‚¹"><a href="#Webæ€§èƒ½è¦ç‚¹" class="headerlink" title="Webæ€§èƒ½è¦ç‚¹"></a>Webæ€§èƒ½è¦ç‚¹</h2><h3 id="å‰–æç°ä»£Webåº”ç”¨"><a href="#å‰–æç°ä»£Webåº”ç”¨" class="headerlink" title="å‰–æç°ä»£Webåº”ç”¨"></a>å‰–æç°ä»£Webåº”ç”¨</h3><h4 id="é€Ÿåº¦ã€æ€§èƒ½ä¸ç”¨æˆ·æœŸæœ›"><a href="#é€Ÿåº¦ã€æ€§èƒ½ä¸ç”¨æˆ·æœŸæœ›" class="headerlink" title="é€Ÿåº¦ã€æ€§èƒ½ä¸ç”¨æˆ·æœŸæœ›"></a>é€Ÿåº¦ã€æ€§èƒ½ä¸ç”¨æˆ·æœŸæœ›</h4><p>æ—¶é—´å’Œç”¨æˆ·æ„Ÿè§‰</p><table><thead><tr><th>æ—¶é—´</th><th>æ„Ÿè§‰</th></tr></thead><tbody><tr><td>0 ~100 ms</td><td>å¾ˆå¿«</td></tr><tr><td>100~300 ms</td><td>æœ‰ä¸€ç‚¹ç‚¹æ…¢</td></tr><tr><td>300~1000 ms</td><td>æœºå™¨åœ¨å·¥ä½œå‘¢</td></tr><tr><td>&gt; 1000 ms</td><td>å…ˆå¹²ç‚¹åˆ«çš„å§</td></tr><tr><td>&gt; 10000 ms</td><td>ä¸èƒ½ç”¨äº†</td></tr></tbody></table><blockquote><p>è¿™ä¸ªè¡¨æ ¼è§£é‡Šäº†Webæ€§èƒ½ç¤¾åŒºæ€»ç»“çš„ç»éªŒæ³•åˆ™ï¼šå¿…é¡»250 mså†…æ¸²æŸ“é¡µé¢ï¼Œæˆ–è€…è‡³å°‘æä¾›è§†è§‰åé¦ˆï¼Œæ‰èƒ½ä¿è¯ç”¨æˆ·ä¸èµ°å¼€ï¼</p></blockquote><h2 id="HTTP-1-x"><a href="#HTTP-1-x" class="headerlink" title="HTTP 1.x"></a>HTTP 1.x</h2><p>HTTP 1.0çš„ä¼˜åŒ–ç­–ç•¥éå¸¸ç®€å•ï¼Œå°±ä¸€å¥è¯ï¼šå‡çº§åˆ°HTTP 1.1ã€‚å®Œäº†ï¼</p><p>æ”¹è¿› HTTP çš„æ€§èƒ½æ˜¯ HTTP 1.1 å·¥ä½œç»„çš„ä¸€ä¸ªé‡è¦ç›®æ ‡ï¼Œåæ¥è¿™ä¸ªç‰ˆæœ¬ä¹Ÿå¼•å…¥äº†å¤§é‡å¢å¼ºæ€§èƒ½çš„é‡è¦ç‰¹æ€§ï¼Œå…¶ä¸­ä¸€äº›å¤§å®¶æ¯”è¾ƒç†ŸçŸ¥çš„æœ‰ï¼š</p><ul><li>æŒä¹…åŒ–è¿æ¥ä»¥æ”¯æŒè¿æ¥é‡ç”¨ï¼› </li><li>åˆ†å—ä¼ è¾“ç¼–ç ä»¥æ”¯æŒæµå¼å“åº”ï¼› </li><li>è¯·æ±‚ç®¡é“ä»¥æ”¯æŒå¹¶è¡Œè¯·æ±‚å¤„ç†ï¼› </li><li>å­—èŠ‚æœåŠ¡ä»¥æ”¯æŒåŸºäºèŒƒå›´çš„èµ„æºè¯·æ±‚ï¼›ã€€ </li><li>æ”¹è¿›çš„æ›´å¥½çš„ç¼“å­˜æœºåˆ¶ã€‚ </li></ul><h3 id="æŒä¹…è¿æ¥çš„ä¼˜ç‚¹"><a href="#æŒä¹…è¿æ¥çš„ä¼˜ç‚¹" class="headerlink" title="æŒä¹…è¿æ¥çš„ä¼˜ç‚¹"></a>æŒä¹…è¿æ¥çš„ä¼˜ç‚¹</h3>]]></content>
      
      
      <categories>
          
          <category> Network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Network </tag>
            
            <tag> HTTP </tag>
            
            <tag> TCP </tag>
            
            <tag> UDP </tag>
            
            <tag> è¯»ä¹¦ç¬”è®° </tag>
            
            <tag> SSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java ForkJoin è§£æ</title>
      <link href="/java-forkjoin.html"/>
      <url>/java-forkjoin.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸»è¦æƒ³äº†è§£ä¸¤ä¸ªåœ°æ–¹ï¼šå¦‚ä½•çªƒå–ä»»åŠ¡ã€taskå¦‚ä½•ç­‰å¾…ï¼ˆjoinï¼‰<br>ä»£ç åŸºäº OpenJDK 12</p></blockquote><a id="more"></a><h1 id="çªƒå–ç®—æ³•ï¼ˆwork-stealingï¼‰"><a href="#çªƒå–ç®—æ³•ï¼ˆwork-stealingï¼‰" class="headerlink" title="çªƒå–ç®—æ³•ï¼ˆwork-stealingï¼‰"></a>çªƒå–ç®—æ³•ï¼ˆwork-stealingï¼‰</h1><p>ä»<a href="/attachments/ForkJoin-Paper-DougLea.pdf" target="_blank">ForkJoin-Paper-DougLea</a>ä¸­å¯ä»¥çœ‹å‡º:</p><ul><li>æ¯ä¸ªé˜Ÿåˆ—åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥æ‰§è¡Œé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ï¼Œçº¿ç¨‹å’Œé˜Ÿåˆ—ä¸€ä¸€å¯¹åº”ã€‚</li><li>é˜Ÿåˆ—ä½¿ç”¨çš„æ˜¯åŒç«¯é˜Ÿåˆ—ï¼Œæ”¯æŒLIFOã€FIFOã€‚</li><li>å­ä»»åŠ¡ä¼šè¢«æ”¾åˆ°çº¿ç¨‹ï¼ˆä¸ä¸€å®šæ˜¯å½“å‰çº¿ç¨‹ï¼‰çš„é˜Ÿåˆ—ä¸­ã€‚</li><li>å·¥ä½œçº¿ç¨‹æŒ‰ç…§LIFOçš„é¡ºåºå¤„ç†è‡ªå·±é˜Ÿåˆ—ä¸­æ•°æ®ã€‚</li><li>å½“ä¸€ä¸ªå·¥ä½œçº¿ç¨‹å¤„ç†å®Œè‡ªå·±é˜Ÿåˆ—ä¸­æ•°æ®çš„æ—¶å€™ï¼Œä¼šéšæœºæŒ‘é€‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå¹¶â€œçªƒå–â€çš„è¯¥å·¥ä½œçº¿ç¨‹é˜Ÿåˆ—é˜Ÿå°¾çš„taskã€‚</li></ul><p><img alt data-src="/images/java-forkjoin/steal.png"></p><p>åˆ°äº†è¿™é‡Œå°±å¯ä»¥çŸ¥é“ï¼Œçªƒå–ä»»åŠ¡ä»å…¶ä»–çº¿ç¨‹é˜Ÿåˆ—çš„å°¾éƒ¨çªƒå–çš„äº†ã€‚</p><h2 id="çªƒå–ç®—æ³•ä¼˜ç¼ºç‚¹"><a href="#çªƒå–ç®—æ³•ä¼˜ç¼ºç‚¹" class="headerlink" title="çªƒå–ç®—æ³•ä¼˜ç¼ºç‚¹"></a>çªƒå–ç®—æ³•ä¼˜ç¼ºç‚¹</h2><p>å·¥ä½œçªƒå–ç®—æ³•çš„ä¼˜ç‚¹ï¼šå……åˆ†åˆ©ç”¨çº¿ç¨‹è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œå‡å°‘äº†çº¿ç¨‹é—´çš„ç«äº‰ã€‚<br>å·¥ä½œçªƒå–ç®—æ³•çš„ç¼ºç‚¹ï¼šåœ¨æŸäº›æƒ…å†µä¸‹è¿˜æ˜¯å­˜åœ¨ç«äº‰ï¼Œæ¯”å¦‚åŒç«¯é˜Ÿåˆ—é‡Œåªæœ‰ä¸€ä¸ªä»»åŠ¡æ—¶ã€‚å¹¶ä¸”è¯¥ç®—æ³•ä¼šæ¶ˆè€—äº†æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚åˆ›å»ºå¤šä¸ªçº¿ç¨‹å’Œå¤šä¸ªåŒç«¯é˜Ÿåˆ—ã€‚</p><h1 id="Task-ç­‰å¾…ï¼ˆjoinï¼‰"><a href="#Task-ç­‰å¾…ï¼ˆjoinï¼‰" class="headerlink" title="Task ç­‰å¾…ï¼ˆjoinï¼‰"></a>Task ç­‰å¾…ï¼ˆjoinï¼‰</h1><p>Joinæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯é˜»å¡å½“å‰çº¿ç¨‹å¹¶ç­‰å¾…è·å–ç»“æœã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public final V join() &#123;</span><br><span class="line">    int s;</span><br><span class="line">    if (((s = doJoin()) &amp; ABNORMAL) != 0)</span><br><span class="line">        reportException(s);</span><br><span class="line">    return getRawResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œå®ƒè°ƒç”¨äº†doJoin()æ–¹æ³•ï¼Œé€šè¿‡doJoin()æ–¹æ³•å¾—åˆ°å½“å‰ä»»åŠ¡çš„çŠ¶æ€æ¥åˆ¤æ–­è¿”å›ä»€ä¹ˆç»“æœï¼Œä»»åŠ¡çŠ¶æ€æœ‰4ç§ï¼šå·²å®Œæˆï¼ˆNORMALï¼‰ã€è¢«å–æ¶ˆï¼ˆCANCELLEDï¼‰ã€ä¿¡å·ï¼ˆSIGNALï¼‰å’Œå‡ºç°å¼‚å¸¸ï¼ˆEXCEPTIONALï¼‰ã€‚</p><ul><li>å¦‚æœä»»åŠ¡çŠ¶æ€æ˜¯å·²å®Œæˆï¼Œåˆ™ç›´æ¥è¿”å›ä»»åŠ¡ç»“æœã€‚</li><li>å¦‚æœä»»åŠ¡çŠ¶æ€æ˜¯è¢«å–æ¶ˆï¼Œåˆ™ç›´æ¥æŠ›å‡ºCancellationExceptionã€‚</li><li>å¦‚æœä»»åŠ¡çŠ¶æ€æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¯¹åº”çš„å¼‚å¸¸ã€‚</li></ul><p>è®©æˆ‘ä»¬å†æ¥åˆ†æä¸€ä¸‹doJoin()æ–¹æ³•çš„å®ç°ä»£ç :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Implementation for join, get, quietlyJoin. Directly handles</span><br><span class="line"> * only cases of already-completed, external wait, and</span><br><span class="line"> * unfork+exec.  Others are relayed to ForkJoinPool.awaitJoin.</span><br><span class="line"> *</span><br><span class="line"> * @return status upon completion</span><br><span class="line"> */</span><br><span class="line">private int doJoin() &#123;</span><br><span class="line">    int s; Thread t; ForkJoinWorkerThread wt; ForkJoinPool.WorkQueue w;</span><br><span class="line">    return </span><br><span class="line">        //å·²å®Œæˆ,è¿”å›status</span><br><span class="line">    (s = status) &lt; 0 ? s :</span><br><span class="line">    //æœªå®Œæˆ,å¦‚æœå½“å‰çº¿ç¨‹æ˜¯ForkJoinWorkerThread,ä»è¯¥çº¿ç¨‹ä¸­å–å‡ºworkQueue,å¹¶å°è¯•å°†</span><br><span class="line">        //å½“å‰taskå‡ºé˜Ÿç„¶åæ‰§è¡Œ,æ‰§è¡Œçš„ç»“æœæ˜¯å®Œæˆåˆ™è¿”å›çŠ¶æ€,å¦åˆ™ä½¿ç”¨å½“çº¿ç¨‹æ± æ‰€åœ¨çš„ForkJoinPoolçš„awaitJoinæ–¹æ³•ç­‰å¾…</span><br><span class="line">        ((t = Thread.currentThread()) instanceof ForkJoinWorkerThread) ?</span><br><span class="line">        (w = (wt = (ForkJoinWorkerThread)t).workQueue).tryUnpush(this) &amp;&amp; (s = doExec()) &lt; 0 ? s : wt.pool.awaitJoin(w, this, 0L) :</span><br><span class="line">        //å½“å‰çº¿ç¨‹ä¸æ˜¯ForkJoinWorkerThread,è°ƒç”¨externalAwaitDoneæ–¹æ³•</span><br><span class="line">        //externalAwaitDone: Blocks a non-worker-thread until completion.</span><br><span class="line">        externalAwaitDone();</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * Pops the given task only if it is at the current top.</span><br><span class="line"> */</span><br><span class="line">final boolean tryUnpush(ForkJoinTask&lt;?&gt; task) &#123;</span><br><span class="line">    boolean popped = false;</span><br><span class="line">    int s, cap; ForkJoinTask&lt;?&gt;[] a;</span><br><span class="line">    if ((a = array) != null &amp;&amp; (cap = a.length) &gt; 0 &amp;&amp;</span><br><span class="line">        (s = top) != base &amp;&amp;</span><br><span class="line">        (popped = QA.compareAndSet(a, (cap - 1) &amp; --s, task, null)))</span><br><span class="line">        TOP.setOpaque(this, s);</span><br><span class="line">    return popped;</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * Primary execution method for stolen tasks. Unless done, calls</span><br><span class="line"> * exec and records status if completed, but doesn&apos;t wait for</span><br><span class="line"> * completion otherwise.</span><br><span class="line"> *</span><br><span class="line"> * @return status on exit from this method</span><br><span class="line">*/</span><br><span class="line">final int doExec() &#123;</span><br><span class="line">    int s; boolean completed;</span><br><span class="line">    // ä»…æœªå®Œæˆçš„ä»»åŠ¡ä¼šè¿è¡Œ,å…¶ä»–æƒ…å†µä¼šå¿½ç•¥.</span><br><span class="line">    if ((s = status) &gt;= 0) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            //execæ˜¯abstractæ–¹æ³•</span><br><span class="line">            //è°ƒç”¨ForkJoinTaskå­ç±»ä¸­exec</span><br><span class="line">            completed = exec();</span><br><span class="line">        &#125; catch (Throwable rex) &#123;</span><br><span class="line">            completed = false;</span><br><span class="line">            s = setExceptionalCompletion(rex);</span><br><span class="line">        &#125;</span><br><span class="line">        if (completed)</span><br><span class="line">            s = setDone();</span><br><span class="line">        &#125;</span><br><span class="line">        return s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨doJoin()æ–¹æ³•é‡Œï¼Œé¦–å…ˆé€šè¿‡æŸ¥çœ‹ä»»åŠ¡çš„çŠ¶æ€ï¼Œçœ‹ä»»åŠ¡æ˜¯å¦å·²ç»æ‰§è¡Œå®Œæˆï¼Œå¦‚æœæ‰§è¡Œå®Œæˆï¼Œåˆ™ç›´æ¥è¿”å›ä»»åŠ¡çŠ¶æ€ï¼›å¦‚æœæ²¡æœ‰æ‰§è¡Œå®Œï¼Œåˆ™ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œã€‚å¦‚æœä»»åŠ¡é¡ºåˆ©æ‰§è¡Œå®Œæˆï¼Œåˆ™è®¾ç½®ä»»åŠ¡çŠ¶æ€ä¸ºNORMALï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è®°å½•å¼‚å¸¸ï¼Œå¹¶å°†ä»»åŠ¡çŠ¶æ€è®¾ç½®ä¸ºEXCEPTIONALã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JUC </tag>
            
            <tag> ForkJoin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java ThreadLocal</title>
      <link href="/java-threadlocal.html"/>
      <url>/java-threadlocal.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>åŸºäºOpenJDK 12</p></blockquote><a id="more"></a><h1 id="å¼•"><a href="#å¼•" class="headerlink" title="å¼•"></a>å¼•</h1><p>æœ¬æ–‡ä¸»è¦æƒ³äº†è§£ä¸¤ä¸ªåœ°æ–¹ï¼š</p><ol><li>ThreadLocalå®ä¾‹çœ‹èµ·æ¥æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œä½†å®é™…ä¸Šæ˜¯å½¼æ­¤ç‹¬ç«‹çš„ï¼Œè¿™ä¸ªæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</li><li>ThreadLocalä½¿ç”¨ä¸å½“çœŸçš„ä¼šOOMå—ï¼Ÿå¦‚æœä¼šï¼Œé‚£ä¹ˆåŸå› æ˜¯å•¥ï¼Ÿ</li></ol><p>å…ˆçœ‹ä¸€ä¸‹<a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/ThreadLocal.html" target="_blank" rel="noopener">ThreadLocalçš„å®˜æ–¹API</a>è§£é‡Šä¸ºï¼š</p><blockquote><p>è¯¥ç±»æä¾›äº†çº¿ç¨‹å±€éƒ¨ (thread-local) å˜é‡ã€‚è¿™äº›å˜é‡ä¸åŒäºå®ƒä»¬çš„æ™®é€šå¯¹åº”ç‰©ï¼Œå› ä¸ºè®¿é—®æŸä¸ªå˜é‡ï¼ˆé€šè¿‡å…¶ get æˆ– set æ–¹æ³•ï¼‰çš„æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å±€éƒ¨å˜é‡ï¼Œå®ƒç‹¬ç«‹äºå˜é‡çš„åˆå§‹åŒ–å‰¯æœ¬[åŸæ–‡ï¼šThese variables differ from their normal counterparts in that each thread that accesses one (via its get or set method) has its own, independently initialized copy of the variable.]ã€‚ThreadLocal å®ä¾‹é€šå¸¸æ˜¯ç±»ä¸­çš„ private static å­—æ®µï¼Œå®ƒä»¬å¸Œæœ›å°†çŠ¶æ€ä¸æŸä¸€ä¸ªçº¿ç¨‹ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ· ID æˆ–äº‹åŠ¡ IDï¼‰ç›¸å…³è”ã€‚</p></blockquote><p>å¤§æ¦‚çš„æ„æ€æœ‰ä¸¤ç‚¹ï¼š</p><ul><li><font color="DeepPink">ThreadLocalæä¾›äº†ä¸€ç§è®¿é—®æŸä¸ªå˜é‡çš„ç‰¹æ®Šæ–¹å¼ï¼šè®¿é—®åˆ°çš„å˜é‡å±äºå½“å‰çº¿ç¨‹ï¼Œå³ä¿è¯æ¯ä¸ªçº¿ç¨‹çš„å˜é‡ä¸ä¸€æ ·ï¼Œè€ŒåŒä¸€ä¸ªçº¿ç¨‹åœ¨ä»»ä½•åœ°æ–¹æ‹¿åˆ°çš„å˜é‡éƒ½æ˜¯ä¸€è‡´çš„ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„çº¿ç¨‹éš”ç¦»ã€‚</font></li><li><font color="DeepPink">å¦‚æœè¦ä½¿ç”¨ThreadLocalï¼Œé€šå¸¸å®šä¹‰ä¸ºprivate staticç±»å‹ï¼Œåœ¨æˆ‘çœ‹æ¥æœ€å¥½æ˜¯å®šä¹‰ä¸ºprivate static finalç±»å‹ã€‚</font></li></ul><p>çœ‹ä¸€æ®µä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// ä»£ç æ¥è‡ªï¼š</span><br><span class="line">// http://tutorials.jenkov.com/java-concurrency/threadlocal.html</span><br><span class="line">public class ThreadLocalExample &#123;</span><br><span class="line">    public static class MyRunnable implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">        private ThreadLocal&lt;Integer&gt; threadLocal = new ThreadLocal&lt;Integer&gt;();</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            //æ³¨æ„è¿™é‡Œ setçš„å€¼æ˜¯runå‡½æ•°çš„å†…éƒ¨å˜é‡ï¼Œå¦‚æœæ˜¯MyRunnableçš„å…¨å±€å˜é‡</span><br><span class="line">            //åˆ™æ— æ³•èµ·åˆ°çº¿ç¨‹éš”ç¦»çš„ä½œç”¨</span><br><span class="line">            threadLocal.set((int) (Math.random() * 100D));</span><br><span class="line">            try &#123;</span><br><span class="line">                //sleepä¸¤ç§’çš„ä½œç”¨æ˜¯è®©thread2 setæ“ä½œåœ¨thread1çš„è¾“å‡ºä¹‹å‰æ‰§è¡Œ</span><br><span class="line">                //å¦‚æœçº¿ç¨‹ä¹‹é—´æ˜¯å…±ç”¨threadLocalï¼Œåˆ™thread2 setæ“ä½œä¼šè¦†ç›–æ‰thread1çš„setæ“ä½œ</span><br><span class="line">                //ä»è€Œä¸¤è€…çš„è¾“å‡ºéƒ½æ˜¯thread2 setçš„å€¼</span><br><span class="line">                Thread.sleep(2000);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                System.out.println(e);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(threadLocal.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">        MyRunnable sharedRunnableInstance = new MyRunnable();</span><br><span class="line"></span><br><span class="line">        Thread thread1 = new Thread(sharedRunnableInstance);</span><br><span class="line">        Thread thread2 = new Thread(sharedRunnableInstance);</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line"></span><br><span class="line">        thread1.join(); //wait for thread 1 to terminate</span><br><span class="line">        thread2.join(); //wait for thread 2 to terminate</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">thread1 start</span><br><span class="line">thread2 start</span><br><span class="line">38</span><br><span class="line">thread1 join</span><br><span class="line">78</span><br><span class="line">thread2 join</span><br></pre></td></tr></table></figure><p>MyRunnable runä¸­sleepä¸¤ç§’çš„ä½œç”¨æ˜¯è®©thread2 setæ“ä½œåœ¨thread1çš„è¾“å‡ºä¹‹å‰æ‰§è¡Œï¼Œå¦‚æœçº¿ç¨‹ä¹‹é—´æ˜¯å…±ç”¨threadLocalï¼Œåˆ™thread2 setæ“ä½œä¼šè¦†ç›–æ‰thread1çš„setæ“ä½œï¼Œä¸¤è€…çš„è¾“å‡ºéƒ½æ˜¯thread2 setçš„å€¼ï¼Œä»è€Œè¾“å‡ºçš„åº”è¯¥æ˜¯åŒä¸€ä¸ªå€¼ã€‚</p><p>ä½†ä»ä»£ç æ‰§è¡Œç»“æœæ¥çœ‹ï¼Œthread1ã€thread2çš„threadLocalæ˜¯ä¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯å®ç°äº†çº¿ç¨‹éš”ç¦»ã€‚</p><h1 id="ThreadLocalå®ä¾‹åœ¨çº¿ç¨‹é—´æ˜¯å¦‚ä½•ç‹¬ç«‹çš„ï¼Ÿ"><a href="#ThreadLocalå®ä¾‹åœ¨çº¿ç¨‹é—´æ˜¯å¦‚ä½•ç‹¬ç«‹çš„ï¼Ÿ" class="headerlink" title="ThreadLocalå®ä¾‹åœ¨çº¿ç¨‹é—´æ˜¯å¦‚ä½•ç‹¬ç«‹çš„ï¼Ÿ"></a>ThreadLocalå®ä¾‹åœ¨çº¿ç¨‹é—´æ˜¯å¦‚ä½•ç‹¬ç«‹çš„ï¼Ÿ</h1><p>çœ‹ä¸€çœ¼ThreadLocal setæ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public void set(T value) &#123;</span><br><span class="line">    //currentThreadæ˜¯ä¸ªnativeæ–¹æ³•ï¼Œä¼šè¿”å›å¯¹å½“å‰æ‰§è¡Œçº¿ç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚</span><br><span class="line">    Thread t = Thread.currentThread();</span><br><span class="line">    //getMap è¿”å›çº¿ç¨‹è‡ªèº«çš„threadLocals</span><br><span class="line">    ThreadLocalMap map = getMap(t);</span><br><span class="line">    if (map != null) &#123;</span><br><span class="line">        //æŠŠvalue setåˆ°çº¿ç¨‹è‡ªèº«çš„ThreadLocalMapä¸­äº†</span><br><span class="line">        map.set(this, value);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        //çº¿ç¨‹è‡ªèº«çš„ThreadLocalMapæœªåˆå§‹åŒ–ï¼Œåˆ™å…ˆåˆå§‹åŒ–ï¼Œå†set</span><br><span class="line">        createMap(t, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ThreadLocalMap getMap(Thread t) &#123;</span><br><span class="line">    return t.threadLocals;</span><br><span class="line">&#125;</span><br><span class="line">//Threadç±»ä¸­</span><br><span class="line">//ThreadLocalMapsetçš„setæ–¹æ³•æœªæ‰§è¡Œæ·±æ‹·è´ï¼Œéœ€è¦æ³¨æ„ä¼ é€’å€¼çš„ç±»å‹</span><br><span class="line">ThreadLocal.ThreadLocalMap threadLocals = null;</span><br></pre></td></tr></table></figure><p>ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨setçš„æ—¶å€™ï¼Œä¼šæ ¹æ®Threadå¯¹è±¡çš„å¼•ç”¨æ¥å°†å€¼æ·»åŠ åˆ°å„è‡ªçº¿ç¨‹ä¸­ã€‚ä½†setçš„å€¼valueè¿˜æ˜¯åŒä¸€ä¸ªå¯¹è±¡,æ—¢ç„¶ä¼ é€’çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£å°±æ¶‰åŠåˆ°å¦ä¸€ä¸ªé—®é¢˜ï¼šå‚æ•°å€¼ä¼ é€’ã€å¼•ç”¨ä¼ é€’çš„é—®é¢˜äº†ã€‚</p><h2 id="åŸºæœ¬ç±»å‹"><a href="#åŸºæœ¬ç±»å‹" class="headerlink" title="åŸºæœ¬ç±»å‹"></a>åŸºæœ¬ç±»å‹</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">public class ThreadLocalExample &#123;</span><br><span class="line">    public static class MyRunnable implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">        private ThreadLocal&lt;Object&gt; threadLocal = new ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        // MyRunnable å…¨å±€å˜é‡</span><br><span class="line">        int random;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            random = (int) (Math.random() * 100D);</span><br><span class="line">            threadLocal.set(random);</span><br><span class="line">            try &#123;</span><br><span class="line">                Thread.sleep(2000);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                System.out.println(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(threadLocal.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">        MyRunnable sharedRunnableInstance = new MyRunnable();</span><br><span class="line"></span><br><span class="line">        Thread thread1 = new Thread(sharedRunnableInstance);</span><br><span class="line">        Thread thread2 = new Thread(sharedRunnableInstance);</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        System.out.println(&quot;thread1 start&quot;);</span><br><span class="line">        thread2.start();</span><br><span class="line">        System.out.println(&quot;thread2 start&quot;);</span><br><span class="line"></span><br><span class="line">        thread1.join(); //wait for thread 1 to terminate</span><br><span class="line">        System.out.println(&quot;thread1 join&quot;);</span><br><span class="line">        thread2.join(); //wait for thread 2 to terminate</span><br><span class="line">        System.out.println(&quot;thread2 join&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">thread1 start</span><br><span class="line">thread2 start</span><br><span class="line">//ä¸¤ä¸ªå€¼ä¸åŒ</span><br><span class="line">16</span><br><span class="line">thread1 join</span><br><span class="line">75</span><br><span class="line">thread2 join</span><br></pre></td></tr></table></figure><p>ä»è¾“å‡ºå¯ä»¥çœ‹å‡ºä¸¤è€…éš”ç¦»äº†ã€‚</p><h2 id="å¼•ç”¨ç±»å‹"><a href="#å¼•ç”¨ç±»å‹" class="headerlink" title="å¼•ç”¨ç±»å‹"></a>å¼•ç”¨ç±»å‹</h2><h3 id="å…¨å±€å¼•ç”¨"><a href="#å…¨å±€å¼•ç”¨" class="headerlink" title="å…¨å±€å¼•ç”¨"></a>å…¨å±€å¼•ç”¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">public class ThreadLocalExample &#123;</span><br><span class="line">    public static class MyRunnable implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">        private ThreadLocal&lt;Object&gt; threadLocal = new ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        // MyRunnable å…¨å±€å˜é‡</span><br><span class="line">        Obj obj = new Obj();</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            obj.value = (int) (Math.random() * 100D);</span><br><span class="line">            threadLocal.set(obj);</span><br><span class="line">            try &#123;</span><br><span class="line">                Thread.sleep(2000);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                System.out.println(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(((Obj) threadLocal.get()).value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        class Obj &#123;</span><br><span class="line">            int value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">        MyRunnable sharedRunnableInstance = new MyRunnable();</span><br><span class="line"></span><br><span class="line">        Thread thread1 = new Thread(sharedRunnableInstance);</span><br><span class="line">        Thread thread2 = new Thread(sharedRunnableInstance);</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        System.out.println(&quot;thread1 start&quot;);</span><br><span class="line">        thread2.start();</span><br><span class="line">        System.out.println(&quot;thread2 start&quot;);</span><br><span class="line"></span><br><span class="line">        thread1.join(); //wait for thread 1 to terminate</span><br><span class="line">        System.out.println(&quot;thread1 join&quot;);</span><br><span class="line">        thread2.join(); //wait for thread 2 to terminate</span><br><span class="line">        System.out.println(&quot;thread2 join&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">thread1 start</span><br><span class="line">thread2 start</span><br><span class="line">//ä¸¤ä¸ªå€¼ç›¸åŒ</span><br><span class="line">36</span><br><span class="line">36</span><br><span class="line">thread1 join</span><br><span class="line">thread2 join</span><br></pre></td></tr></table></figure><p>ä»è¾“å‡ºç»“æœæ¥çœ‹ï¼Œå½“setæ“ä½œçš„å€¼æ˜¯MyRunnableçš„å…¨å±€å˜é‡ï¼Œå¹¶ä¸”æ˜¯å¼•ç”¨ç±»å‹çš„æ—¶å€™ï¼Œæ— æ³•èµ·åˆ°éš”ç¦»çš„ä½œç”¨ã€‚</p><h3 id="å±€éƒ¨å¼•ç”¨"><a href="#å±€éƒ¨å¼•ç”¨" class="headerlink" title="å±€éƒ¨å¼•ç”¨"></a>å±€éƒ¨å¼•ç”¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">public class ThreadLocalExample &#123;</span><br><span class="line">    public static class MyRunnable implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">        private ThreadLocal&lt;Object&gt; threadLocal = new ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        //Obj obj = new Obj();</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            Obj obj = new Obj();</span><br><span class="line">            obj.value = (int) (Math.random() * 100D);</span><br><span class="line">            threadLocal.set(obj);</span><br><span class="line">            try &#123;</span><br><span class="line">                Thread.sleep(2000);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                System.out.println(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(((Obj) threadLocal.get()).value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        class Obj &#123;</span><br><span class="line">            int value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">        MyRunnable sharedRunnableInstance = new MyRunnable();</span><br><span class="line"></span><br><span class="line">        Thread thread1 = new Thread(sharedRunnableInstance);</span><br><span class="line">        Thread thread2 = new Thread(sharedRunnableInstance);</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        System.out.println(&quot;thread1 start&quot;);</span><br><span class="line">        thread2.start();</span><br><span class="line">        System.out.println(&quot;thread2 start&quot;);</span><br><span class="line"></span><br><span class="line">        thread1.join(); //wait for thread 1 to terminate</span><br><span class="line">        System.out.println(&quot;thread1 join&quot;);</span><br><span class="line">        thread2.join(); //wait for thread 2 to terminate</span><br><span class="line">        System.out.println(&quot;thread2 join&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">thread1 start</span><br><span class="line">thread2 start</span><br><span class="line">//ä¸¤ä¸ªå€¼ä¸åŒ</span><br><span class="line">12</span><br><span class="line">19</span><br><span class="line">thread1 join</span><br><span class="line">thread2 join</span><br></pre></td></tr></table></figure><p>ä»è¾“å‡ºç»“æœçœ‹ï¼Œå±€éƒ¨å¼•ç”¨ï¼Œå¯ä»¥ç›¸äº’éš”ç¦»ã€‚</p><p><font color="DeepPink">åˆ°è¿™é‡Œå¯ä»¥çœ‹å‡ºThreadLocalï¼Œåªæ˜¯æŠŠsetå€¼æˆ–å¼•ç”¨ç»‘å®šåˆ°äº†å½“å‰çº¿ç¨‹ï¼Œä½†å´æ²¡æœ‰è¿›è¡Œç›¸åº”çš„æ·±æ‹·è´ï¼Œæ‰€ä»¥ThreadLocalè¦æƒ³åšçš„çº¿ç¨‹éš”ç¦»ï¼Œå¿…é¡»æ˜¯åŸºæœ¬ç±»å‹æˆ–è€…runçš„å±€éƒ¨å˜é‡ã€‚</font></p><h1 id="ThreadLocal-OOM-ï¼Ÿ"><a href="#ThreadLocal-OOM-ï¼Ÿ" class="headerlink" title="ThreadLocal OOM ï¼Ÿ"></a>ThreadLocal OOM ï¼Ÿ</h1><p>çœ‹ä¸€ä¸‹ThreadLocalMapå†…éƒ¨Entryï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class="line">    /** The value associated with this ThreadLocal. */</span><br><span class="line">    Object value;</span><br><span class="line"></span><br><span class="line">    Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">        super(k);</span><br><span class="line">        value = v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä»£ç ä¸­çœ‹åˆ°ï¼ŒEntryç»§æ‰¿äº†WeakReferenceï¼Œå¹¶å°†ThreadLocalè®¾ç½®ä¸ºäº†WeakReferenceï¼Œvalueè®¾ç½®ä¸ºå¼ºå¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯ï¼šå½“æ²¡æœ‰å¼ºå¼•ç”¨æŒ‡å‘ThreadLocalå˜é‡æ—¶ï¼Œå®ƒå¯è¢«å›æ”¶ã€‚</p><p>ä½†æ˜¯ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼š<font color="DeepPink">ThreadLocalMapç»´æŠ¤ThreadLocalå˜é‡ä¸å…·ä½“å®ä¾‹çš„æ˜ å°„ï¼Œå½“ThreadLocalå˜é‡è¢«å›æ”¶åï¼Œè¯¥æ˜ å°„çš„keyå˜ä¸º nullï¼Œè€Œè¯¥Entryè¿˜æ˜¯åœ¨ThreadLocalMapä¸­ï¼Œä»è€Œè¿™äº›æ— æ³•æ¸…ç†çš„Entryï¼Œä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</font></p><blockquote><p>ThreadLocalè‡ªå¸¦çš„removeã€setæ–¹æ³•ï¼Œéƒ½æ— æ³•å¤„ç†ThreadLocalè‡ªèº«ä¸ºnullçš„æƒ…å†µï¼Œå› ä¸ºä»£ç ä¸­éƒ½ç›´æ¥å–ThreadLocalçš„threadLocalHashCodeå±æ€§äº†ï¼Œæ‰€ä»¥å¦‚æœThreadLocalè‡ªèº«å·²ç»æ˜¯nullï¼Œè¿™æ—¶è°ƒç”¨removeã€setä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ˆjava.lang.NullPointerExceptionï¼‰çš„ã€‚</p></blockquote><p>æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨ThreadLocalçš„æ—¶å€™ï¼Œåœ¨ä½¿ç”¨å®Œæ¯•è®°å¾—removeï¼ˆremoveæ–¹æ³•ä¼šå°†Entryçš„valueåŠEntryè‡ªèº«è®¾ç½®ä¸ºnullå¹¶è¿›è¡Œæ¸…ç†ï¼‰ã€‚</p><p>JDK 12 ThreadLocalä»£ç åœ°å€ï¼š<br><a href="https://github.com/jiankunking/openjdk12/blob/master/src/java.base/share/classes/java/lang/ThreadLocal.java" target="_blank" rel="noopener">https://github.com/jiankunking/openjdk12/blob/master/src/java.base/share/classes/java/lang/ThreadLocal.java</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> ThreadLocal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯‘ Java Concurrent Atomic Packageè¯¦è§£</title>
      <link href="/java-concurrent-atomic-package.html"/>
      <url>/java-concurrent-atomic-package.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç¿»è¯‘è‡ªï¼šPackage java.util.concurrent.atomic</p></blockquote><a id="more"></a><blockquote><p>åœ°å€ï¼š<br><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/package-summary.html#package.description" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/package-summary.html#package.description</a><br>ç¿»è¯‘JDK8è€Œä¸æ˜¯12çš„åŸå› æ˜¯JDK8å¯¹ä¸å†…å­˜è¯­ä¹‰éƒ¨åˆ†è®²è§£æ›´åŠ è¯¦ç»†ã€‚</p></blockquote><p><strong>Package java.util.concurrent.atomic å¯¹äºå•ä¸ªå˜é‡æ”¯æŒæ— é”ã€çº¿ç¨‹å®‰å…¨æ“ä½œçš„å·¥å…·ç±»ã€‚</strong></p><p>ç±»æ‘˜è¦ï¼š</p><table><thead><tr><th>ç±»å</th><th>æè¿°</th></tr></thead><tbody><tr><td>AtomicBoolean</td><td>å¯ä»¥åŸå­æ€§æ›´æ–°çš„booleanå€¼ã€‚</td></tr><tr><td>AtomicInteger</td><td>å¯ä»¥åŸå­æ€§æ›´æ–°çš„intå€¼ã€‚</td></tr><tr><td>AtomicIntegerArray</td><td>ä¸€ä¸ªintæ•°ç»„ï¼Œå…¶ä¸­çš„å…ƒç´ å¯ä»¥åŸå­æ€§æ›´æ–°ã€‚</td></tr><tr><td>AtomicIntegerFieldUpdater<t></t></td><td>åŸºäºåå°„ï¼Œå¯ä»¥å¯¹æŒ‡å®šç±»çš„æŒ‡å®š volatile int å­—æ®µè¿›è¡ŒåŸå­æ›´æ–°ã€‚</td></tr><tr><td>AtomicLong</td><td>å¯ä»¥åŸå­æ€§æ›´æ–°çš„longå€¼ã€‚</td></tr><tr><td>AtomicLongArray</td><td>ä¸€ä¸ªlongæ•°ç»„ï¼Œå…¶ä¸­çš„å…ƒç´ å¯ä»¥åŸå­æ€§æ›´æ–°ã€‚</td></tr><tr><td>AtomicLongFieldUpdater<t></t></td><td>åŸºäºåå°„ï¼Œå¯ä»¥å¯¹æŒ‡å®šç±»çš„æŒ‡å®š volatile long å­—æ®µè¿›è¡ŒåŸå­æ›´æ–°ã€‚</td></tr><tr><td>AtomicMarkableReference<v></v></td><td>ç»´æŠ¤å¸¦æœ‰æ ‡è®°ä½çš„å¯¹è±¡å¼•ç”¨ï¼Œå¯ä»¥åŸå­æ–¹å¼å¯¹å…¶è¿›è¡Œæ›´æ–°ã€‚</td></tr><tr><td>AtomicReference<v></v></td><td>å¯ä»¥åŸå­æ€§æ›´æ–°çš„å¯¹è±¡å¼•ç”¨</td></tr><tr><td>AtomicReferenceArray<e></e></td><td>ä¸€ä¸ªå¯¹è±¡å¼•ç”¨æ•°ç»„ï¼Œå…¶ä¸­çš„å…ƒç´ å¯ä»¥åŸå­æ€§æ›´æ–°ã€‚</td></tr><tr><td>AtomicReferenceFieldUpdater&lt;T,V&gt;</td><td>åŸºäºåå°„ï¼Œå¯ä»¥å¯¹æŒ‡å®šç±»çš„æŒ‡å®š volatile reference å­—æ®µè¿›è¡ŒåŸå­æ›´æ–°ã€‚</td></tr><tr><td>AtomicStampedReference<v></v></td><td>ç»´æŠ¤å¸¦æœ‰æ•´æ•°ç‰ˆæœ¬æ ‡å¿—çš„å¯¹è±¡å¼•ç”¨ï¼Œå¯ä»¥åŸå­æ–¹å¼å¯¹å…¶è¿›è¡Œæ›´æ–°ã€‚</td></tr><tr><td>DoubleAccumulator</td><td>One or more variables that together maintain a running double value updated using a supplied function.</td></tr><tr><td>DoubleAdder</td><td>One or more variables that together maintain an initially zero double sum.</td></tr><tr><td>LongAccumulator</td><td>One or more variables that together maintain a running long value updated using a supplied function.</td></tr><tr><td>LongAdder</td><td>One or more variables that together maintain an initially zero long sum.</td></tr></tbody></table><blockquote><p>DoubleAccumulatorã€DoubleAdderã€LongAccumulatorã€LongAdder å‡æ˜¯Striped64çš„å­ç±»ï¼Œå†…éƒ¨ç»´æŠ¤çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå½“å¹¶å‘æ›´æ–°æ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹æ“ä½œçš„æ˜¯æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œä»è€Œé™ä½é”çš„ç²’åº¦ã€‚</p></blockquote><p>æœ¬è´¨ä¸Šï¼Œè¯¥packageä¸‹çš„ç±»æ‰©å±•äº†volatileå€¼ã€å­—æ®µã€æ•°ç»„å…ƒç´ çš„æ¦‚å¿µï¼Œæä¾›ä»¥ä¸‹å½¢å¼çš„åŸå­æ›´æ–°æ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">boolean compareAndSet(expectedValue, updateValue);</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•ï¼ˆåœ¨ä¸åŒç±»ä¸­çš„å‚æ•°ç±»å‹ä¸åŒï¼‰åŸå­åœ°å°†å˜é‡è®¾ç½®ä¸ºupdateValueï¼Œå¦‚æœå®ƒå½“å‰æŒæœ‰expectedValueï¼Œæ›´æ–°æˆåŠŸè¿”å›trueã€‚è¯¥åŒ…ä¸­çš„ç±»è¿˜åŒ…å«è·å–å’Œæ— æ¡ä»¶è®¾ç½®ï¼ˆsetï¼‰å€¼çš„æ–¹æ³•ã€‚</p><p>è¿™äº›æ–¹æ³•çš„è§„èŒƒä½¿å®ç°èƒ½å¤Ÿé‡‡ç”¨å½“ä»£å¤„ç†å™¨ä¸Šå¯ç”¨çš„é«˜æ•ˆæœºå™¨çº§åŸå­æŒ‡ä»¤ã€‚ ç„¶è€Œï¼Œ<font color="DeepPink">åœ¨æŸäº›å¹³å°ä¸Šï¼Œæ”¯æŒå¯èƒ½éœ€è¦æŸç§å½¢å¼çš„å†…éƒ¨é”å®šã€‚å› æ­¤ï¼Œè¿™äº›æ–¹æ³•ä¸æ˜¯ä¸¥æ ¼ä¿è¯æ˜¯éé˜»å¡çš„ï¼ˆçº¿ç¨‹å¯èƒ½åœ¨æ‰§è¡Œæ“ä½œä¹‹å‰æš‚æ—¶é˜»å¡ï¼‰ã€‚</font></p><p>AtomicBooleanã€AtomicIntegerã€AtomicLongå’ŒAtomicReferenceç±»çš„å®ä¾‹éƒ½æä¾›å¯¹å¯¹åº”ç±»å‹çš„å•ä¸ªå˜é‡çš„è®¿é—®å’Œæ›´æ–°ã€‚æ¯ä¸ªç±»è¿˜æä¾›äº†é€‚ç”¨äºè¯¥ç±»å‹çš„å®ç”¨æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œç±»AtomicLongå’ŒAtomicIntegeræä¾›åŸå­å¢é‡æ–¹æ³•ã€‚ ä¸€ä¸ªåº”ç”¨æ˜¯ç”Ÿæˆåºåˆ—å·ï¼Œå¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class Sequencer &#123;</span><br><span class="line">  private final AtomicLong sequenceNumber = new AtomicLong(0);</span><br><span class="line">  public long next() &#123;</span><br><span class="line">    return sequenceNumber.getAndIncrement();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸå­æ€§è®¿é—®å’Œæ›´æ–°å†…å­˜æ•ˆæœï¼Œä¸volatileséµå¾ªåŒæ ·çš„è§„åˆ™ï¼Œå¦‚<a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html#jls-17.4" target="_blank" rel="noopener">The Java Language Specification (17.4 Memory Model)</a>æ‰€è¿°ï¼š</p><ul><li>getä¸volatileè¯»æ•ˆæœä¸€æ ·</li><li>setä¸volatileå†™æ•ˆæœä¸€æ ·</li><li>lazySetä¸å†™å…¥(åˆ†é…)volatileå˜é‡çš„æ•ˆæœä¸€æ ·ã€å†™æ“ä½œä¸ä¼šä¸ä¹‹å‰çš„ä»»ä½•å†™æ“ä½œé‡æ–°æ’åºã€‘ï¼Œä½†å®ƒå¯èƒ½è¢«åç»­æ“ä½œé‡æ’ã€ä¹Ÿå°±æ˜¯ï¼Œ<font color="DeepPink">åœ¨volatileå†™æˆ–è€…åŒæ­¥æ“ä½œä¹‹å‰ï¼Œå¯èƒ½å¯¹äºå…¶å®ƒçº¿ç¨‹ä¸å¯è§</font>ã€‘ã€‚</li><li>compareAndSetå’Œæ‰€æœ‰å…¶ä»–è¯»å–å’Œæ›´æ–°æ“ä½œ(å¦‚getAndIncrement)ä¸€æ ·ï¼Œä¸volatileå˜é‡è¯»å–å’Œå†™å…¥å…·æœ‰ç›¸åŒçš„å†…å­˜æ•ˆæœã€‚</li></ul><blockquote><p>lazySetæ˜¯ä½¿ç”¨Unsafe.putOrderedObjectæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨å¯¹ä½å»¶è¿Ÿä»£ç æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œå®ƒèƒ½å¤Ÿå®ç°éé˜»å¡çš„å†™å…¥ï¼Œè¿™äº›å†™å…¥ä¸ä¼šè¢«Javaçš„JITé‡æ–°æ’åºæŒ‡ä»¤(instruction reordering)ï¼Œè¿™æ ·å®ƒä½¿ç”¨å¿«é€Ÿçš„å­˜å‚¨-å­˜å‚¨(store-store) barrier, è€Œä¸æ˜¯è¾ƒæ…¢çš„å­˜å‚¨-åŠ è½½(store-load) barrier, åè€…æ€»æ˜¯ç”¨åœ¨volatileçš„å†™æ“ä½œä¸Šï¼Œè¿™ç§æ€§èƒ½æå‡æ˜¯æœ‰ä»£ä»·çš„ï¼Œè™½ç„¶ä¾¿å®œï¼Œä¹Ÿå°±æ˜¯å†™åç»“æœå¹¶ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°ï¼Œç”šè‡³æ˜¯è‡ªå·±çš„çº¿ç¨‹ï¼Œé€šå¸¸æ˜¯å‡ çº³ç§’åè¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°ï¼Œè¿™ä¸ªæ—¶é—´æ¯”è¾ƒçŸ­ï¼Œæ‰€ä»¥ä»£ä»·å¯ä»¥å¿å—ã€‚<br>è®¾æƒ³å¦‚ä¸‹åœºæ™¯: è®¾ç½®ä¸€ä¸ª volatile å˜é‡ä¸º nullï¼Œè®©è¿™ä¸ªå¯¹è±¡è¢« GC æ‰ï¼Œvolatile write æ˜¯æ¶ˆè€—æ¯”è¾ƒå¤§ï¼ˆstore-load å±éšœï¼‰çš„ï¼Œä½†æ˜¯ putOrderedInt åªä¼šåŠ  store-store å±éšœï¼ŒæŸè€—ä¼šå°ä¸€äº›ã€‚</p></blockquote><p>æ·»åŠ lazySetæ–¹æ³•çš„åŸå› :<a href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6275329" target="_blank" rel="noopener">https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6275329</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">As probably the last little JSR166 follow-up for Mustang,</span><br><span class="line">we added a &quot;lazySet&quot; method to the Atomic classes</span><br><span class="line">(AtomicInteger, AtomicReference, etc). This is a niche</span><br><span class="line">method that is sometimes useful when fine-tuning code using</span><br><span class="line">non-blocking data structures. The semantics are</span><br><span class="line">that the write is guaranteed not to be re-ordered with any</span><br><span class="line">previous write, but may be reordered with subsequent operations</span><br><span class="line">(or equivalently, might not be visible to other threads) until</span><br><span class="line">some other volatile write or synchronizing action occurs).</span><br><span class="line"></span><br><span class="line">The main use case is for nulling out fields of nodes in</span><br><span class="line">non-blocking data structures solely for the sake of avoiding</span><br><span class="line">long-term garbage retention; it applies when it is harmless</span><br><span class="line">if other threads see non-null values for a while, but you&apos;d</span><br><span class="line">like to ensure that structures are eventually GCable. In such</span><br><span class="line">cases, you can get better performance by avoiding</span><br><span class="line">the costs of the null volatile-write. There are a few</span><br><span class="line">other use cases along these lines for non-reference-based</span><br><span class="line">atomics as well, so the method is supported across all of the</span><br><span class="line">AtomicX classes.</span><br><span class="line"></span><br><span class="line">For people who like to think of these operations in terms of</span><br><span class="line">machine-level barriers on common multiprocessors, lazySet</span><br><span class="line">provides a preceeding store-store barrier (which is either</span><br><span class="line">a no-op or very cheap on current platforms), but no</span><br><span class="line">store-load barrier (which is usually the expensive part</span><br><span class="line">of a volatile-write).</span><br></pre></td></tr></table></figure><blockquote><p>weakCompareAndSet JDK 9ä¹‹åDeprecatedï¼Œæœ¬æ–‡å·²è·³è¿‡ã€‚</p></blockquote><p>é™¤äº†è¡¨ç¤ºå•ä¸ªå€¼çš„ç±»ä¹‹å¤–ï¼Œpackageä¸­è¿˜åŒ…å«Updaterç±»ï¼Œå¯ç”¨äºåœ¨ç±»çš„volatileå­—æ®µä¸Šæ‰§è¡ŒcompareAndSetæ“ä½œã€‚ AtomicReferenceFieldUpdaterã€AtomicIntegerFieldUpdaterå’ŒAtomicLongFieldUpdateræ˜¯åŸºäºåå°„çš„ï¼Œå¯æä¾›å¯¹ç›¸å…³å­—æ®µç±»å‹çš„è®¿é—®ã€‚è¿™äº›ä¸»è¦ç”¨äºåŸå­æ•°æ®ç»“æ„ï¼ŒåŒä¸€èŠ‚ç‚¹çš„å‡ ä¸ªvolatileå­—æ®µï¼ˆä¾‹å¦‚ï¼Œæ ‘èŠ‚ç‚¹çš„é“¾æ¥ï¼‰ç‹¬ç«‹åœ°åŸå­æ›´æ–°ã€‚<strong>è¿™äº›ç±»åœ¨å¦‚ä½•ä»¥åŠä½•æ—¶ä½¿ç”¨åŸå­æ›´æ–°æ–¹é¢æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ï¼Œä½†ä»£ä»·æ˜¯æ›´åŠ ç¬¨æ‹™çš„åŸºäºåå°„çš„è®¾ç½®ã€æ›´ä¸æ–¹ä¾¿çš„ä½¿ç”¨å’Œæ›´å¼±çš„ä¿è¯ã€‚</strong></p><p>AtomicIntegerArrayã€AtomicLongArrayå’ŒAtomicReferenceArrayç±»è¿›ä¸€æ­¥å°†åŸå­æ“ä½œæ”¯æŒæ‰©å±•åˆ°è¿™äº›ç±»å‹çš„æ•°ç»„ã€‚è¿™äº›ç±»è¿˜<strong>æä¾›äº†æ•°ç»„å…ƒç´ çš„volatileè®¿é—®è¯­ä¹‰ï¼Œè¿™æ˜¯æ™®é€šæ•°ç»„ä¸æ”¯æŒçš„ã€‚</strong></p><p>AtomicMarkableReferenceç±»å°†å•ä¸ªå¸ƒå°”å€¼ä¸å¼•ç”¨ç›¸å…³è”ã€‚ ä¾‹å¦‚ï¼Œè¯¥ä½å¯èƒ½åœ¨æ•°æ®ç»“æ„ä¸­ä½¿ç”¨ï¼Œè¡¨ç¤ºè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨é€»è¾‘ä¸Šå·²è¢«åˆ é™¤ã€‚ AtomicStampedReferenceç±»å°†æ•´æ•°å€¼ä¸å¼•ç”¨ç›¸å…³è”ã€‚ ä¾‹å¦‚ï¼Œè¿™å¯ä»¥ç”¨äºè¡¨ç¤ºä¸ä¸€ç³»åˆ—æ›´æ–°ç›¸å¯¹åº”çš„ç‰ˆæœ¬å·ã€‚</p><p>åŸå­ç±»ä¸»è¦è®¾è®¡ä¸ºç”¨äºå®ç°éé˜»å¡æ•°æ®ç»“æ„å’Œç›¸å…³åŸºç¡€ç»“æ„ç±»çš„æ„å»ºã€‚ compareAndSetæ–¹æ³•ä¸æ˜¯é”å®šçš„ä¸€èˆ¬æ›¿ä»£æ–¹æ³•ã€‚ ä»…å½“å¯¹è±¡çš„å…³é”®æ›´æ–°ä»…é™äºå•ä¸ªå˜é‡æ—¶ï¼Œå®ƒæ‰é€‚ç”¨ã€‚</p><p>åŸå­ç±»ä¸æ˜¯java.lang.Integerå’Œç›¸å…³ç±»çš„é€šç”¨æ›¿æ¢ã€‚å®ƒä»¬æ²¡æœ‰å®šä¹‰equalsï¼ŒhashCodeå’ŒcompareToç­‰æ–¹æ³•ï¼ˆç”±äºåŸå­å˜é‡é¢„æœŸä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥å®ƒä»¬ä¸é€‚åˆä½œä¸ºå“ˆå¸Œè¡¨é”®ï¼‰ã€‚</p><blockquote><p>åç»­ä¼šå‡ºæ–‡ç« è§£æï¼šAtomicLongã€Striped64ã€LongAdder<br>æœ¬æ–‡çš„ç›®çš„ä¸»è¦æ˜¯ä»å¤§ä½“ä¸Šäº†è§£atomicåŠå…¶å†…å­˜è¯­ä¹‰</p></blockquote><blockquote><p>JDK 12<br><a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/util/concurrent/atomic/package-summary.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/util/concurrent/atomic/package-summary.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JDK </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JDK </tag>
            
            <tag> Concurrent </tag>
            
            <tag> Atomic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java JUC Atomic AtomicLong</title>
      <link href="/java-juc-atomic-atomiclong.html"/>
      <url>/java-juc-atomic-atomiclong.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>åŸºäºOpenJDK 12<br>æœ¬æ–‡çš„ç›®çš„æ˜¯ä¸ºåç»­æ–‡ç« è§£æLongAdderåšä¸€ä¸ªå¼•å­ï¼Œä»¥ä¾¿ä¸¤è€…å¯¹æ¯”ã€‚</p></blockquote><a id="more"></a><p><a href="http://www.jiankunking.com/è¯‘-Java-Concurrent-Atomic-Package-è¯¦è§£.html" target="_blank" rel="noopener">Atomic Packageè§£æå‚è€ƒï¼ˆæ¯”å¦‚lazySetåŸç†è§£æï¼‰</a></p><p>AtomicLongçš„å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><ul><li>long addAndGet(long delta)ï¼šä»¥åŸå­æ–¹å¼å°†è¾“å…¥çš„æ•°å€¼ä¸å®ä¾‹ä¸­çš„å€¼ï¼ˆAtomicLongé‡Œçš„<br>valueï¼‰ç›¸åŠ ï¼Œå¹¶è¿”å›ç»“æœã€‚</li><li>compareAndSet(long expectedValue, long newValue)ï¼šå¦‚æœè¾“å…¥çš„æ•°å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹<br>å¼å°†è¯¥å€¼è®¾ç½®ä¸ºè¾“å…¥çš„å€¼ã€‚</li><li>long getAndIncrement()ï¼šä»¥åŸå­æ–¹å¼å°†å½“å‰å€¼åŠ 1ï¼Œæ³¨æ„ï¼Œè¿™é‡Œè¿”å›çš„æ˜¯è‡ªå¢å‰çš„å€¼ã€‚</li><li>void lazySet(long newValue)ï¼šæœ€ç»ˆä¼šè®¾ç½®æˆnewValueï¼Œ<font color="DeepPink">ä½¿ç”¨lazySetè®¾ç½®å€¼åï¼Œå¯èƒ½å¯¼è‡´å…¶ä»–<br>çº¿ç¨‹åœ¨ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼</font>ã€‚</li><li>long getAndSet(long newValue)ï¼šä»¥åŸå­æ–¹å¼è®¾ç½®ä¸ºnewValueçš„å€¼ï¼Œå¹¶è¿”å›æ—§å€¼ã€‚</li></ul><p>AtomicLongç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class AtomicLongTest &#123;</span><br><span class="line">    static AtomicLong ai = new AtomicLong(1);</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(ai.getAndIncrement());</span><br><span class="line">        System.out.println(ai.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆgetAndIncrementæ˜¯å¦‚ä½•å®ç°åŸå­æ“ä½œçš„å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·åˆ†æå…¶å®ç°åŸç†ï¼ŒgetAndIncrementçš„æºç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public final long getAndIncrement() &#123;</span><br><span class="line">   return U.getAndAddLong(this, VALUE, 1L);</span><br><span class="line">&#125;</span><br><span class="line">@HotSpotIntrinsicCandidate</span><br><span class="line">public final long getAndAddLong(Object o, long offset, long delta) &#123;</span><br><span class="line">    long v;</span><br><span class="line">    do &#123;</span><br><span class="line">        v = getLongVolatile(o, offset);</span><br><span class="line">    &#125; while (!weakCompareAndSetLong(o, offset, v, v + delta));</span><br><span class="line">    return v;</span><br><span class="line">&#125;</span><br><span class="line">/** Volatile version of &#123;@link #getLong(Object, long)&#125;  */</span><br><span class="line">@HotSpotIntrinsicCandidate</span><br><span class="line">public native long getLongVolatile(Object o, long offset);</span><br><span class="line"></span><br><span class="line">@HotSpotIntrinsicCandidate</span><br><span class="line">public final boolean weakCompareAndSetLong(Object o, long offset,</span><br><span class="line">                                           long expected,</span><br><span class="line">                                           ong x) &#123;</span><br><span class="line">    return compareAndSetLong(o, offset, expected, x);</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * Atomically updates Java variable to &#123;@code x&#125; if it is currently</span><br><span class="line"> * holding &#123;@code expected&#125;.</span><br><span class="line"> *</span><br><span class="line"> * &lt;p&gt;This operation has memory semantics of a &#123;@code volatile&#125; read</span><br><span class="line"> * and write.  Corresponds to C11 atomic_compare_exchange_strong.</span><br><span class="line"> *</span><br><span class="line"> * @return &#123;@code true&#125; if successful</span><br><span class="line"> */</span><br><span class="line">@HotSpotIntrinsicCandidate</span><br><span class="line">public final native boolean compareAndSetLong(Object o, long offset,</span><br><span class="line">                                              long expected,</span><br><span class="line">                                              long x);</span><br></pre></td></tr></table></figure><blockquote><p>@HotSpotIntrinsicCandidate JDKçš„æºç ä¸­ï¼Œè¢«@HotSpotIntrinsicCandidateæ ‡æ³¨çš„æ–¹æ³•ï¼Œåœ¨HotSpotä¸­éƒ½æœ‰ä¸€å¥—é«˜æ•ˆçš„å®ç°ï¼Œè¯¥é«˜æ•ˆå®ç°åŸºäºCPUæŒ‡ä»¤ï¼Œè¿è¡Œæ—¶ï¼ŒHotSpotç»´æŠ¤çš„é«˜æ•ˆå®ç°ä¼šæ›¿ä»£JDKçš„æºç å®ç°ï¼Œä»è€Œè·å¾—æ›´é«˜çš„æ•ˆç‡ã€‚</p></blockquote><p>æºç getAndAddLong(Object o, long offset, long delta)ä¸­do whileå¾ªç¯ä½“æ˜¯å®ç°çš„å…³é”®æ‰€åœ¨ï¼Œå…¶é€»è¾‘æ˜¯ï¼š<br>ç¬¬ä¸€æ­¥å…ˆå–å¾—AtomicLongé‡Œå­˜å‚¨çš„æ•°å€¼ï¼Œ<br>ç¬¬äºŒæ­¥å¯¹AtomicLongçš„å½“å‰æ•°å€¼è¿›è¡ŒåŠ 1æ“ä½œï¼Œ<br>ç¬¬ä¸‰æ­¥è°ƒç”¨weakCompareAndSetLongæ–¹æ³•æ¥è¿›è¡ŒåŸå­æ›´æ–°æ“ä½œï¼Œè¯¥æ–¹æ³•å…ˆæ£€æŸ¥å½“å‰æ•°å€¼æ˜¯å¦ç­‰äºvï¼Œç­‰äºæ„å‘³ç€AtomicLongçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡ï¼Œåˆ™å°†weakCompareAndSetLongçš„å½“å‰æ•°å€¼æ›´æ–°æˆv+deltaçš„å€¼ï¼Œå¦‚æœä¸ç­‰äºvï¼ŒweakCompareAndSetLongæ–¹æ³•ä¼šè¿”å›falseï¼Œ<font color="DeepPink">ç¨‹åºä¼šè¿›å…¥do whileå¾ªç¯é‡æ–°è¿›è¡Œ</font>weakCompareAndSetLongæ“ä½œã€‚</p><p><font color="DeepPink">è¿™é‡Œéšå«äº†ä¸€ä¸ªé—®é¢˜ï¼Œå½“å¯¹äºå…±äº«å˜é‡ï¼ˆå‡è®¾å˜é‡åå­—æ˜¯aï¼‰çš„ç«äº‰éå¸¸æ¿€çƒˆçš„æ—¶å€™ï¼Œåœ¨å½“å‰çº¿ç¨‹è¯»å–aã€æ”¹å˜aä¹‹é—´ï¼Œaçš„å€¼ä¼šè¢«åˆ«çš„çº¿ç¨‹æ”¹å˜ï¼Œä»è€Œå¯¼è‡´å½“å‰çº¿ç¨‹ä¸€ç›´é‡è¯•ï¼ˆè‡ªæ—‹ï¼‰ï¼Œä¸€ç›´å ç”¨CPUã€‚</font></p><p><font color="DeepPink">è¿™å°±å¼•å‡ºå¦ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äºé”æŠ¢å å¾ˆæ¿€çƒˆçš„æ—¶å€™ï¼Œä¸²è¡Œæ˜¯æœ€å¥½çš„è§£å†³åŠæ³•ã€‚æ¯”å¦‚ä½¿ç”¨synchronizedã€‚</font></p><blockquote><p>java.util.concurrent.atomicä¸­çš„åŸå­æ“ä½œåŸºæœ¬æ˜¯åŸºäºUnsafeæˆ–è€…VarHandleå®ç°çš„ã€‚</p></blockquote><p><a href="https://github.com/jiankunking/openjdk12/blob/master/src/java.base/share/classes/java/util/concurrent/atomic/AtomicLong.java" target="_blank" rel="noopener">AtomicLongæºç </a></p><blockquote><p>æœ¬æ–‡å‚è€ƒ ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ ä½œè€…ï¼šæ–¹è…¾é£ã€€é­é¹ã€€ç¨‹æ™“æ˜</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JDK </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JDK </tag>
            
            <tag> Concurrent </tag>
            
            <tag> Atomic </tag>
            
            <tag> AtomicLong </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java JUC Atomic LongAdder</title>
      <link href="/java-juc-atomic-longadder.html"/>
      <url>/java-juc-atomic-longadder.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>åŸºäºOpenJDK 12</p></blockquote><a id="more"></a><p>é˜…è¯»æœ¬æ–‡å‰ï¼Œæ¨èå…ˆé˜…è¯»ä»¥ä¸‹ä¸¤ç¯‡æ–‡ç« ï¼Œä»¥ä¾¿èƒ½æ›´å¥½çš„å¯¹æ¯”ç†è§£ï¼š</p><ul><li><a href="https://jiankunking.com/%E8%AF%91-Java-Concurrent-Atomic-Package-%E8%AF%A6%E8%A7%A3.html">è¯‘-Java-Concurrent-Atomic-Package-è¯¦è§£</a></li><li><a href="https://jiankunking.com/Java-JUC-Atomic-AtomicLong.html">Java-JUC-Atomic-AtomicLong</a></li></ul><p>LongAdderæ˜¯JDK 1.8 æ–°å¢çš„åŸå­ç±»ï¼ŒåŸºäºStriped64å®ç°ã€‚ ä»å®˜æ–¹æ–‡æ¡£çœ‹ï¼ŒLongAdderåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ä¼šæ¯”AtomicLong å…·æœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œä»£ä»·æ˜¯æ¶ˆè€—æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼š</p><blockquote><p>This class is usually preferable to AtomicLong when multiple threads update a common sum that is used for purposes such as collecting statistics, not for fine-grained synchronization control. <font color="DeepPink">Under low update contention, the two classes have similar characteristics. But under high contention, expected throughput of this class is significantly higher, at the expense of higher space consumption.</font></p></blockquote><p>é‚£ä¹ˆLongAdderæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</p><p>å…ˆçœ‹ä¸€ä¸‹LongAdderçš„ç±»å›¾ï¼š<br><img alt data-src="/images/java-juc-atomic-longadder/LongAdder%E7%B1%BB%E5%9B%BE.png"></p><p>åŸºç±»Numberï¼ŒNumberæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å…¶ä¸­æ²¡æœ‰ä»»ä½•é€»è¾‘ï¼Œè¯¥ç±»æ˜¯byteã€doubleã€floatã€intã€longã€shortçš„åŸºç±»ã€‚</p><h1 id="Striped64"><a href="#Striped64" class="headerlink" title="Striped64"></a>Striped64</h1><h2 id="è®¾è®¡æ€æƒ³"><a href="#è®¾è®¡æ€æƒ³" class="headerlink" title="è®¾è®¡æ€æƒ³"></a>è®¾è®¡æ€æƒ³</h2><p>è¯¥éƒ¨åˆ†ç¿»è¯‘è‡ªStriped64æºç æ³¨é‡Šï¼Œå¯ä»¥ç•¥è¿‡ï¼Œæ¦‚æ‹¬èµ·æ¥å°±æ˜¯ï¼š</p><blockquote><p>åˆ†æ•£çƒ­ç‚¹ï¼Œå°†valueå€¼åˆ†æ•£åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œä¸åŒçº¿ç¨‹ä¼šå‘½ä¸­åˆ°æ•°ç»„çš„ä¸åŒæ§½ä¸­ï¼Œå„ä¸ªçº¿ç¨‹åªå¯¹è‡ªå·±æ§½ä¸­çš„é‚£ä¸ªå€¼è¿›è¡ŒCASæ“ä½œï¼Œè¿™æ ·çƒ­ç‚¹å°±è¢«åˆ†æ•£äº†ï¼Œå†²çªçš„æ¦‚ç‡å°±å°å¾ˆå¤šã€‚å¦‚æœè¦è·å–çœŸæ­£çš„longå€¼ï¼Œåªè¦å°†å„ä¸ªæ§½ä¸­çš„å˜é‡å€¼ç´¯åŠ è¿”å›ã€‚</p></blockquote><hr><p>ä»Striped64ç±»æ³¨é‡Šå¯ä»¥çœ‹åˆ°ï¼š</p><blockquote><p>Striped64æ˜¯packageå†…ä½¿ç”¨çš„ï¼Œå¯¹äºåœ¨64ä½å…ƒç´ ä¸ŠåŠ¨æ€åˆ†ç‰‡æä¾›ç»Ÿä¸€å®ç°ï¼ˆæ„Ÿè§‰æœ‰ç‚¹åƒï¼šAbstractQueuedSynchronizerï¼‰<br>Striped64ç»§æ‰¿äº†Numberç±»ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´å…·ä½“å®ç°çš„å­ç±»ä¹Ÿå¿…é¡»å®ç°ç›¸å…³çš„å†…å®¹</p></blockquote><p>è¯¥ç±»ç»´æŠ¤ä¸€ä¸ªåŸå­æ›´æ–°å˜é‡çš„å»¶è¿Ÿåˆå§‹åŒ–è¡¨ï¼Œä»¥åŠä¸€ä¸ªé¢å¤–çš„â€œbaseâ€å­—æ®µã€‚è¡¨çš„å¤§å°æ˜¯2çš„å¹‚ã€‚ç´¢å¼•ä½¿ç”¨æ©ç ä¸‹çš„æ¯ä¸ªçº¿ç¨‹çš„hash codeã€‚è¿™ä¸ªç±»ä¸­çš„å‡ ä¹æ‰€æœ‰å£°æ˜éƒ½æ˜¯packageç§æœ‰çš„ï¼Œç”±å­ç±»ç›´æ¥è®¿é—®ã€‚</p><p>è¡¨æ ¼å†…çš„å…ƒç´ æ˜¯Cellç±»ï¼ŒCellç±»æ˜¯ä¸€ä¸ªä¸ºäº†å‡å°‘ç¼“å­˜äº‰ç”¨è€Œå¡«å……çš„AtomicLongçš„å˜ç§ã€‚å¡«å……å¯¹äºå¤§å¤šæ•°åŸå­æ¥è¯´æ˜¯å¤šä½™çš„ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸ä¸è§„åˆ™åœ°åˆ†æ•£åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤å½¼æ­¤ä¹‹é—´ä¸ä¼šæœ‰å¤ªå¤šçš„å¹²æ‰°ã€‚ä½†æ˜¯ï¼Œé©»ç•™åœ¨æ•°ç»„ä¸­çš„åŸå­å¯¹è±¡å¾€å¾€æ˜¯å½¼æ­¤ç›¸é‚»çš„ï¼Œå› æ­¤åœ¨æ²¡æœ‰è¿™ç§é¢„é˜²æªæ–½çš„æƒ…å†µä¸‹ï¼Œæœ€å¸¸è§çš„æƒ…å†µæ˜¯å…±äº«é«˜é€Ÿç¼“å­˜çº¿(è¿™å¯¹æ€§èƒ½æœ‰å¾ˆå¤§çš„è´Ÿé¢å½±å“)ã€‚</p><p>åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œå› ä¸ºCellç±»ç›¸å¯¹è¾ƒå¤§ï¼Œåªæœ‰ä»–ä»¬çœŸæ­£è¢«éœ€è¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰åˆ›å»ºã€‚<font color="DeepPink">å¦‚æœæ²¡æœ‰ç«äº‰ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ›´æ–°æ“ä½œå°†å¯¹baseå­—æ®µå®ç°ã€‚å½“å‘ç”Ÿç¬¬ä¸€æ¬¡äº‰ç”¨ï¼ˆä¹Ÿå°±æ˜¯è¯´å¦‚æœç¬¬ä¸€æ¬¡å¯¹baseå­—æ®µçš„CASæ“ä½œå¤±è´¥ï¼‰ï¼Œåˆå§‹åŒ–ä¸ºå¤§å°æ˜¯2çš„è¡¨æ ¼ã€‚å½“è¿›ä¸€æ­¥çš„äº‰ç”¨å‘ç”Ÿçš„æ—¶å€™,è¡¨çš„å¤§å°ä¼šåŠ å€ï¼Œç›´åˆ°è¾¾åˆ°ç­‰äºå¤§äºcpuçš„æ•°é‡ã€‚è¡¨åœ¨æœªä½¿ç”¨ä¹‹å‰ä¸€ç›´ä¸ºnullã€‚</font></p><p>åˆ©ç”¨ä¸€ä¸ªè‡ªæ—‹é”ï¼ˆcellsBusyï¼‰æ¥åˆå§‹åŒ–å’Œè°ƒæ•´è¡¨çš„å¤§å°ï¼Œä»¥åŠç”¨æ–°Cellså¡«å……slotsã€‚è¿™ä¸ªåœ°æ–¹æ²¡æœ‰å¿…è¦ä½¿ç”¨é˜»å¡é”ï¼Œå¦‚æœé”ä¸å¯è¾¾ï¼Œçº¿ç¨‹å¯ä»¥å°è¯•å…¶ä»–çš„slotsï¼Œæˆ–è€…å°è¯•baseå­—æ®µã€‚åœ¨è¿™äº›é‡è¯•æœŸé—´ï¼Œç«äº‰åŠ å‰§ï¼Œä½†æ˜¯é™ä½äº†å±€éƒ¨æ€§ï¼Œè¿™ä»ç„¶æ¯”é˜»å¡é”æ¥å¾—å¥½ã€‚</p><p>é€šè¿‡ThreadLocalRandomç»´æŠ¤çš„Thread.probeå­—æ®µç”¨ä½œæ¯ä¸ªçº¿ç¨‹çš„å“ˆå¸Œç ã€‚æˆ‘ä»¬è®©å®ƒä»¬ä¿æŒæœªåˆå§‹åŒ–ï¼ˆä¸ºé›¶ï¼‰(å¦‚æœå®ƒä»¬ä»¥è¿™ç§æ–¹å¼å‡ºç°)ï¼Œç›´åˆ°å®ƒä»¬åœ¨æ’æ§½0ç«äº‰ã€‚å‡ºç°ç«äº‰ååˆå§‹åŒ–ä¸ºé€šå¸¸ä¸ä¼šå’Œå…¶ä»–çš„çš„å€¼å†²çªçš„å€¼ï¼Œæ¯”å¦‚çº¿ç¨‹çš„å“ˆå¸Œç ã€‚åœ¨æ‰§è¡Œæ›´æ–°æ—¶å‘ç”ŸCASæ“ä½œå¤±è´¥æ„å‘³ç€å‡ºç°äº†äº‰ç”¨æˆ–è€…è¡¨ç¢°æ’ï¼Œæˆ–ä¸¤è€…éƒ½æœ‰ã€‚åœ¨å‘ç”Ÿå†²çªæ—¶ï¼Œå¦‚æœè¡¨çš„å¤§å°å°äºå®¹é‡ï¼Œé‚£ä¹ˆå®ƒçš„å¤§å°å°†åŠ å€ï¼Œé™¤éå…¶ä»–çº¿ç¨‹æŒæœ‰é”ã€‚å¦‚æœå“ˆå¸Œåçš„slotä¸ºç©ºï¼Œå¹¶ä¸”é”å¯ç”¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°å•å…ƒæ ¼ã€‚å¦‚æœå­˜åœ¨äº†é‚£ä¹ˆä¼šè¿›è¡ŒCASå°è¯•ã€‚é€šè¿‡åŒé‡å“ˆå¸Œè¿›è¡Œé‡è¯•ï¼Œåˆ©ç”¨ä¸€ä¸ªè¾…åŠ©å“ˆå¸Œï¼ˆMarsaglia XorShiftéšæœºæ•°ç®—æ³•ï¼‰æ¥å°è¯•å¯»æ‰¾ä¸€ä¸ªç©ºé—²çš„slotã€‚</p><p><font color="DeepPink">è¡¨çš„å¤§å°æ˜¯æœ‰ä¸Šé™çš„ï¼Œå› ä¸ºå½“çº¿ç¨‹å¤šäºCPUæ—¶ï¼Œå‡è®¾æ¯ä¸ªçº¿ç¨‹éƒ½ç»‘å®šåˆ°ä¸€ä¸ªCPUï¼Œå°±ä¼šæœ‰ä¸€ä¸ªå®Œç¾çš„æ•£åˆ—å‡½æ•°å°†çº¿ç¨‹æ˜ å°„åˆ°æ’æ§½ï¼Œä»è€Œæ¶ˆé™¤å†²çªã€‚å½“æˆ‘ä»¬è¾¾åˆ°å®¹é‡æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡éšæœºæ”¹å˜å†²çªçº¿ç¨‹çš„å“ˆå¸Œä»£ç æ¥æœç´¢è¿™ä¸ªæ˜ å°„ã€‚å› ä¸ºæœç´¢æ˜¯éšæœºçš„ï¼Œå†²çªåªæœ‰é€šè¿‡CASå¤±è´¥æ‰çŸ¥é“ï¼Œæ”¶æ•›å¯èƒ½ä¼šå¾ˆæ…¢ï¼Œè€Œä¸”å› ä¸ºçº¿ç¨‹é€šå¸¸ä¸ä¼šæ°¸è¿œç»‘å®šåˆ°CPUï¼Œæ‰€ä»¥æ ¹æœ¬ä¸ä¼šå‘ç”Ÿã€‚ç„¶è€Œï¼Œå°½ç®¡æœ‰è¿™äº›é™åˆ¶ï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹è§‚å¯Ÿåˆ°çš„ç«äº‰ç‡é€šå¸¸å¾ˆä½ã€‚</font></p><p><font color="DeepPink">Cellå¯èƒ½ä¼šå‡ºç°ä¸å¯ç”¨çš„æƒ…å†µï¼ŒåŒ…æ‹¬è¿›è¡Œå“ˆå¸Œçš„çº¿ç¨‹ç»ˆæ­¢ï¼Œæˆ–è€…ç”±äºtableæ‰©å®¹å¯¼è‡´çº¿ç¨‹å“ˆå¸Œä¸æ­£ç¡®ã€‚æˆ‘ä»¬ä¸å°è¯•æ£€æµ‹æˆ–åˆ é™¤è¿™æ ·çš„å•å…ƒæ ¼ï¼Œå‡è®¾å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„å®ä¾‹ï¼Œäº‰ç”¨ä¼šå†æ¬¡å‘ç”Ÿï¼Œå› æ­¤æœ€ç»ˆå°†å†æ¬¡éœ€è¦è¿™äº›å•å…ƒæ ¼;è€Œå¯¹äºçŸ­æ—¶é—´è¿è¡Œçš„å®ä¾‹ï¼ŒèŠ±è´¹æ—¶é—´å»é”€æ¯åˆæ²¡æœ‰ä»€ä¹ˆå¿…è¦ã€‚</font></p><hr><h2 id="Cellç±»"><a href="#Cellç±»" class="headerlink" title="Cellç±»"></a>Cellç±»</h2><p>Atomiclongçš„å˜ä½“ï¼Œä»…æ”¯æŒåŸå§‹è®¿é—®å’ŒCASã€‚</p><blockquote><p>Cellç±»è¢«æ³¨è§£@jdk.internal.vm.annotation.Contendedä¿®é¥°ã€‚<br>Contendedçš„ä½œç”¨ï¼ˆè¯¦ç»†ä¿¡æ¯å‚è§ï¼š<a href="http://openjdk.java.net/jeps/142" target="_blank" rel="noopener">JEP 142</a>ï¼‰ï¼š<br>Define a way to specify that one or more fields in an object are likely to be highly contended across processor cores so that the VM can arrange for them not to share cache lines with other fields, or other objects, that are likely to be independently accessed.</p></blockquote><h2 id="ç¤ºæ„å›¾"><a href="#ç¤ºæ„å›¾" class="headerlink" title="ç¤ºæ„å›¾"></a>ç¤ºæ„å›¾</h2><p><img alt data-src="/images/java-juc-atomic-longadder/%E7%83%AD%E7%82%B9%E5%88%86%E7%A6%BB%E7%A4%BA%E6%84%8F%E5%9B%BE.png"></p><h2 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h2><p>Striped64çš„æ ¸å¿ƒæ–¹æ³•æ˜¯longAccumulateã€doubleAccumulateï¼Œä¸¤è€…ç±»ä¼¼ï¼Œä¸‹é¢ä¸»è¦çœ‹ä¸€ä¸‹longAccumulateï¼Œ<strong>å¯¹äºè¿™ç§ä»£ç ï¼Œä¸ªäººå»ºè®®æ˜¯ç†è§£æ€è·¯å³å¯ï¼Œæ¯•ç«Ÿå’±ä»¬åˆä¸æ˜¯è¿‡æ¥ä¿®æ”¹JDKçš„ï¼Œå¦‚æœçœŸçš„è¦ä¿®æ”¹äº†æˆ–è€…æœ‰ç±»ä¼¼çš„éœ€æ±‚äº†ï¼Œå†å›æ¥ç»†çœ‹å³å¯ã€‚</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">//x  å…ƒç´ </span><br><span class="line">//fn  æ›´æ–°å‡½æ•°ï¼Œå¦‚æœæ˜¯addå¯ä»¥ä¸ºnullï¼ˆè¿™ä¸ªçº¦å®šé¿å…äº†longadderä¸­å®šä¹‰é¢å¤–çš„å˜é‡æˆ–è€…å‡½æ•°ï¼‰</span><br><span class="line">//wasUncontended å¦‚æœCASåœ¨è°ƒç”¨ä¹‹å‰å¤±è´¥äº†ï¼Œè¿™ä¸ªå€¼ä¸ºfalse</span><br><span class="line">final void longAccumulate(long x, LongBinaryOperator fn,</span><br><span class="line">                          boolean wasUncontended) &#123;</span><br><span class="line">    int h;</span><br><span class="line">    //è·å–å½“å‰çº¿ç¨‹çš„probeå€¼ï¼Œå¦‚æœä¸º0ï¼Œåˆ™éœ€è¦åˆå§‹åŒ–è¯¥çº¿ç¨‹çš„probeå€¼</span><br><span class="line">    if ((h = getProbe()) == 0) &#123;</span><br><span class="line">    ThreadLocalRandom.current(); // force initialization</span><br><span class="line">        h = getProbe();</span><br><span class="line">        wasUncontended = true;</span><br><span class="line">    &#125;</span><br><span class="line">    boolean collide = false;  // True if last slot nonempty</span><br><span class="line">    done: for (;;) &#123;</span><br><span class="line">        Cell[] cs; Cell c; int n; long v;</span><br><span class="line">        //Cellsä¸ä¸ºç©ºï¼Œè¿›è¡Œæ“ä½œ</span><br><span class="line">        if ((cs = cells) != null &amp;&amp; (n = cs.length) &gt; 0) &#123;</span><br><span class="line">            //é€šè¿‡ï¼ˆhashCode &amp; (length - 1)ï¼‰è¿™ç§ç®—æ³•æ¥å®ç°å–æ¨¡ æœ‰ç§çœ‹åˆ°HashMapä»£ç çš„æ„Ÿè§‰</span><br><span class="line">            //å¦‚æœå½“å‰ä½ç½®ä¸ºnullè¯´æ˜éœ€è¦åˆå§‹åŒ–</span><br><span class="line">            if ((c = cs[(n - 1) &amp; h]) == null) &#123;</span><br><span class="line">                //åˆ¤æ–­é”çŠ¶æ€</span><br><span class="line">                if (cellsBusy == 0) &#123;       // Try to attach new Cell</span><br><span class="line">                    Cell r = new Cell(x);   // Optimistically create</span><br><span class="line">                    //å†æ¬¡åˆ¤æ–­é”çŠ¶æ€ï¼ŒåŒæ—¶è·å–é”</span><br><span class="line">                    if (cellsBusy == 0 &amp;&amp; casCellsBusy()) &#123;</span><br><span class="line">                        try &#123;               // Recheck under lock</span><br><span class="line">                            Cell[] rs; int m, j;</span><br><span class="line">                            if ((rs = cells) != null &amp;&amp;</span><br><span class="line">                                (m = rs.length) &gt; 0 &amp;&amp;</span><br><span class="line">                                rs[j = (m - 1) &amp; h] == null) &#123;</span><br><span class="line">                                rs[j] = r;</span><br><span class="line">                                //åˆ›å»ºæˆåŠŸè·³å‡º</span><br><span class="line">                                break done;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; finally &#123;</span><br><span class="line">                            //é‡Šæ”¾é”</span><br><span class="line">                            cellsBusy = 0;</span><br><span class="line">                        &#125;</span><br><span class="line">                        continue;           // Slot is now non-empty</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                collide = false;</span><br><span class="line">            &#125;</span><br><span class="line">            //è¿è¡Œåˆ°æ­¤è¯´æ˜cellçš„å¯¹åº”ä½ç½®ä¸Šå·²ç»æœ‰ç›¸åº”çš„Celläº†ï¼Œ</span><br><span class="line">            //ä¸éœ€è¦åˆå§‹åŒ–äº†</span><br><span class="line">            //CASæ“ä½œå·²ç»å¤±è´¥äº†ï¼Œå‡ºç°äº†ç«äº‰</span><br><span class="line">            else if (!wasUncontended)       // CAS already known to fail</span><br><span class="line">                wasUncontended = true;      // Continue after rehash</span><br><span class="line">            //è¿™é‡Œå°è¯•å°†xå€¼åŠ åˆ°açš„valueä¸Š </span><br><span class="line">            else if (c.cas(v = c.value,</span><br><span class="line">                           (fn == null) ? v + x : fn.applyAsLong(v, x)))</span><br><span class="line">                //å¦‚æœå°è¯•æˆåŠŸï¼Œè·³å‡ºå¾ªç¯ï¼Œæ–¹æ³•é€€å‡º</span><br><span class="line">                break;</span><br><span class="line">            //cellæ•°ç»„æœ€å¤§ä¸ºcpuçš„æ•°é‡ï¼Œ</span><br><span class="line">            //cells != asè¡¨æ˜cellsæ•°ç»„å·²ç»è¢«æ›´æ–°äº† </span><br><span class="line">            //æ ‡è®°ä¸ºæœ€å¤§çŠ¶æ€æˆ–è€…è¯´æ˜¯è¿‡æœŸçŠ¶æ€</span><br><span class="line">            else if (n &gt;= NCPU || cells != cs)</span><br><span class="line">                collide = false;            // At max size or stale</span><br><span class="line">            else if (!collide)</span><br><span class="line">                collide = true;</span><br><span class="line">            //æ‰©å®¹ å½“å‰å®¹é‡ * 2</span><br><span class="line">            else if (cellsBusy == 0 &amp;&amp; casCellsBusy()) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    if (cells == cs)        // Expand table unless stale</span><br><span class="line">                        cells = Arrays.copyOf(cs, n &lt;&lt; 1);</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    cellsBusy = 0;</span><br><span class="line">                &#125;</span><br><span class="line">                collide = false;</span><br><span class="line">                continue;                   // Retry with expanded table</span><br><span class="line">            &#125;</span><br><span class="line">            h = advanceProbe(h);</span><br><span class="line">        &#125;</span><br><span class="line">        //å°è¯•è·å–é”ä¹‹åæ‰©å¤§Cells</span><br><span class="line">        else if (cellsBusy == 0 &amp;&amp; cells == cs &amp;&amp; casCellsBusy()) &#123;</span><br><span class="line">            try &#123;                           // Initialize table</span><br><span class="line">                if (cells == cs) &#123;</span><br><span class="line">                    //åˆå§‹åŒ–cellè¡¨ï¼Œåˆå§‹å®¹é‡ä¸º2ã€‚ </span><br><span class="line">                    Cell[] rs = new Cell[2];</span><br><span class="line">                    rs[h &amp; 1] = new Cell(x);</span><br><span class="line">                    cells = rs;</span><br><span class="line">                    break done;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                //é‡Šæ”¾cellsBusyé”</span><br><span class="line">                cellsBusy = 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        //å¦‚æœåˆ›å»ºcellè¡¨ç”±äºç«äº‰å¯¼è‡´å¤±è´¥ï¼Œå°è¯•å°†xç´¯åŠ åˆ°baseä¸Š</span><br><span class="line">        // Fall back on using base</span><br><span class="line">        else if (casBase(v = base,</span><br><span class="line">                         (fn == null) ? v + x : fn.applyAsLong(v, x)))</span><br><span class="line">            break done;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * CASes the cellsBusy field from 0 to 1 to acquire lock.</span><br><span class="line"> */</span><br><span class="line">final boolean casCellsBusy() &#123;</span><br><span class="line">    return CELLSBUSY.compareAndSet(this, 0, 1);</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * CASes the base field.</span><br><span class="line"> */</span><br><span class="line">final boolean casBase(long cmp, long val) &#123;</span><br><span class="line">    return BASE.compareAndSet(this, cmp, val);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ®µçš„æ ¸å¿ƒæ˜¯è¿™æ ·çš„ï¼š</p><ul><li>longAccumulateä¼šæ ¹æ®å½“å‰çº¿ç¨‹æ¥è®¡ç®—ä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œç„¶åæ ¹æ®(hashCode &amp; (length - 1))å–æ¨¡ï¼Œä»¥å®šä½åˆ°è¯¥çº¿ç¨‹è¢«åˆ†æ•£åˆ°çš„Cellæ•°ç»„ä¸­çš„ä½ç½®</li><li>å¦‚æœCellæ•°ç»„è¿˜æ²¡æœ‰è¢«åˆ›å»ºï¼Œé‚£ä¹ˆå°±å»è·å–cellBusyè¿™ä¸ªé”ï¼ˆç›¸å½“äºé”ï¼Œä½†æ˜¯æ›´ä¸ºè½»é‡çº§ï¼‰ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™åˆå§‹åŒ–Cellæ•°ç»„ï¼Œåˆå§‹å®¹é‡ä¸º2ï¼Œåˆå§‹åŒ–å®Œæˆä¹‹åå°†xåŒ…è£…æˆä¸€ä¸ªCellï¼Œå“ˆå¸Œè®¡ç®—ä¹‹ååˆ†æ•£åˆ°ç›¸åº”çš„indexä¸Šã€‚å¦‚æœè·å–cellBusyå¤±è´¥ï¼Œé‚£ä¹ˆä¼šè¯•å›¾å°†xç´¯è®¡åˆ°baseä¸Šï¼Œæ›´æ–°å¤±è´¥ä¼šé‡æ–°å°è¯•ç›´åˆ°æˆåŠŸã€‚</li><li>å¦‚æœCellæ•°ç»„å·²ç»è¢«åˆå§‹åŒ–è¿‡äº†ï¼Œé‚£ä¹ˆå°±æ ¹æ®çº¿ç¨‹çš„å“ˆå¸Œå€¼åˆ†æ•£åˆ°ä¸€ä¸ªCellæ•°ç»„å…ƒç´ ä¸Šï¼Œè·å–è¿™ä¸ªä½ç½®ä¸Šçš„Cellå¹¶ä¸”èµ‹å€¼ç»™å˜é‡aï¼Œå¦‚æœaä¸ºnullï¼Œè¯´æ˜è¯¥ä½ç½®è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œé‚£ä¹ˆå°±åˆå§‹åŒ–ï¼Œå½“ç„¶åœ¨åˆå§‹åŒ–ä¹‹å‰éœ€è¦ç«äº‰cellBusyå˜é‡ã€‚</li><li>å¦‚æœCellæ•°ç»„çš„å¤§å°å·²ç»æœ€å¤§äº†ï¼ˆå¤§äºç­‰äºCPUçš„æ•°é‡ï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°è®¡ç®—å“ˆå¸Œï¼Œæ¥é‡æ–°åˆ†æ•£å½“å‰çº¿ç¨‹åˆ°å¦å¤–ä¸€ä¸ªCellä½ç½®ä¸Šå†èµ°ä¸€éè¯¥æ–¹æ³•çš„é€»è¾‘ï¼Œå¦åˆ™å°±éœ€è¦å¯¹Cellæ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œç„¶åå°†åŸæ¥çš„è®¡æ•°å†…å®¹è¿ç§»è¿‡å»ã€‚ç”±äºCellé‡Œé¢ä¿å­˜çš„æ˜¯è®¡æ•°å€¼ï¼Œæ‰€ä»¥æ‰©å®¹åæ²¡æœ‰å¿…è¦åšå…¶ä»–å¤„ç†ï¼Œç›´æ¥æ ¹æ®indexå°†æ—§çš„Cellæ•°ç»„å†…å®¹å¤åˆ¶åˆ°æ–°çš„Cellæ•°ç»„ä¸­ã€‚</li></ul><h1 id="LongAdder"><a href="#LongAdder" class="headerlink" title="LongAdder"></a>LongAdder</h1><blockquote><p>LongAdderçš„åŸºæœ¬æ€è·¯å°±æ˜¯åˆ†æ•£çƒ­ç‚¹ï¼Œå°†valueå€¼åˆ†æ•£åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œä¸åŒçº¿ç¨‹ä¼šå‘½ä¸­åˆ°æ•°ç»„çš„ä¸åŒæ§½ä¸­ï¼Œå„ä¸ªçº¿ç¨‹åªå¯¹è‡ªå·±æ§½ä¸­çš„é‚£ä¸ªå€¼è¿›è¡ŒCASæ“ä½œï¼Œè¿™æ ·çƒ­ç‚¹å°±è¢«åˆ†æ•£äº†ï¼Œå†²çªçš„æ¦‚ç‡å°±å°å¾ˆå¤šã€‚å¦‚æœè¦è·å–çœŸæ­£çš„longå€¼ï¼Œåªè¦å°†å„ä¸ªæ§½ä¸­çš„å˜é‡å€¼ç´¯åŠ è¿”å›ã€‚</p></blockquote><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>ä¿æŒä¸€ä¸ªæˆ–è€…å¤šä¸ªå˜é‡ï¼Œåˆå§‹å€¼è®¾ç½®ä¸ºé›¶ç”¨äºæ±‚å’Œã€‚å½“æ›´æ–°å‡ºç°å¤šä¸ªçº¿ç¨‹ç«äº‰æ—¶ï¼Œå˜é‡é›†åˆåŠ¨æ€å¢é•¿ä»¥å‡å°‘äº‰ç”¨ã€‚æœ€åå½“éœ€è¦æ±‚å’Œçš„æ—¶å€™æˆ–è€…è¯´éœ€è¦è¿™ä¸ªLongå‹çš„å€¼æ—¶ï¼Œå¯ä»¥é€šè¿‡æŠŠå½“å‰è¿™äº›å˜é‡æ±‚å’Œï¼Œåˆå¹¶åå¾—å‡ºæœ€ç»ˆçš„å’Œã€‚</p><p><font color="DeepPink">LongAdderåœ¨ä¸€äº›é«˜å¹¶å‘åœºæ™¯ä¸‹è¡¨ç°è¦æ¯”AtomicLongå¥½ï¼Œæ¯”å¦‚å¤šä¸ªçº¿ç¨‹åŒæ—¶æ›´æ–°ä¸€ä¸ªæ±‚å’Œçš„å˜é‡ï¼Œæ¯”å¦‚ç»Ÿè®¡é›†åˆçš„æ•°é‡ï¼Œä½†æ˜¯ä¸èƒ½ç”¨äºç»†ç²’åº¦åŒæ­¥æ§åˆ¶ï¼Œæ¢å¥è¯è¯´è¿™ä¸ªæ˜¯å¯èƒ½æœ‰è¯¯å·®çš„ï¼ˆå› ä¸ºæ›´æ–°ä¸è¯»å–æ˜¯å¹¶è¡Œçš„ï¼‰ã€‚åœ¨ä½å¹¶å‘åœºæ™¯åœºæ™¯ä¸‹LongAdderå’ŒAtomicLongçš„æ€§èƒ½è¡¨ç°æ²¡ä»€ä¹ˆå·®åˆ«ï¼Œä½†æ˜¯å½“é«˜å¹¶å‘ç«äº‰çš„æ—¶å€™ï¼Œè¿™ä¸ªç±»å°†å…·å¤‡æ›´å¥½çš„ååæ€§èƒ½ï¼Œä½†æ˜¯ç›¸åº”çš„ä¹Ÿä¼šè€—è´¹ç›¸å½“çš„ç©ºé—´ã€‚</font></p><p>LongAdderç»§æ‰¿äº†NumberæŠ½è±¡ç±»ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å®ç°ä¸€äº›æ–¹æ³•ä¾‹å¦‚: equalsã€hashCodeã€compareToï¼Œå› ä¸ºLongAdderå®ä¾‹çš„é¢„æœŸç”¨é€”æ˜¯è¿›è¡Œä¸€äº›æ¯”è¾ƒé¢‘ç¹çš„å˜åŒ–ï¼Œæ‰€ä»¥ä¹Ÿä¸é€‚åˆä½œä¸ºé›†åˆçš„keyã€‚</p><h2 id="å…·ä½“å®ç°-1"><a href="#å…·ä½“å®ç°-1" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h2><p>çœ‹ä¸€ä¸‹LongAdderæœ‰å“ªäº›æ–¹æ³•ï¼š<br><img alt data-src="/images/java-juc-atomic-longadder/LongAdder%E5%87%BD%E6%95%B0%E5%88%97%E8%A1%A8.png"></p><p>ä¸‹é¢ä¸»è¦è§£æLongAdder incrementã€sumæ–¹æ³•ï¼Œå…ˆçœ‹ä¸€ä¸‹æºç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Equivalent to &#123;@code add(1)&#125;.</span><br><span class="line"> */</span><br><span class="line">public void increment() &#123;</span><br><span class="line">add(1L);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* Adds the given value.</span><br><span class="line">*</span><br><span class="line">* @param x the value to add</span><br><span class="line">*/</span><br><span class="line">public void add(long x) &#123;</span><br><span class="line">    Cell[] cs; long b, v; int m; Cell c;</span><br><span class="line">    if ((cs = cells) != null || !casBase(b = base, b + x)) &#123;</span><br><span class="line">    //åˆ°äº†è¿™é‡Œ è¡¨æ˜csä¸ä¸ºnull or çº¿ç¨‹æœ‰å¹¶å‘å†²çªï¼Œå¯¼è‡´caseBaseå¤±è´¥</span><br><span class="line">        boolean uncontended = true;</span><br><span class="line">        if (cs == null || // cells ä¸ºnull</span><br><span class="line">            (m = cs.length - 1) &lt; 0 || // cells ä¸ä¸ºnull ä½†åªæœ‰ä¸€ä¸ªå…ƒç´ </span><br><span class="line">            (c = cs[getProbe() &amp; m]) == null || //å“ˆå¸Œå–æ¨¡ å¯¹åº”ä½ç½®å…ƒç´ ä¸ºnull</span><br><span class="line">            !(uncontended = c.cas(v = c.value, v + x))) //cas æ›¿æ¢å¤±è´¥ï¼ˆå¹¶å‘ç«äº‰ï¼‰</span><br><span class="line">            longAccumulate(x, null, uncontended);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line">* CASes the base field (Striped64ç±»ä¸­çš„æ–¹æ³•)</span><br><span class="line">*/</span><br><span class="line">final boolean casBase(long cmp, long val) &#123;</span><br><span class="line">    return BASE.compareAndSet(this, cmp, val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å½“åœ¨sumçš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½åˆ«çš„çº¿ç¨‹æ­£åœ¨æ“ä½œcellsï¼ˆå› ä¸ºæ²¡æœ‰åŠ é”ï¼‰</span><br><span class="line">//sumå–çš„å€¼ï¼Œä¸ä¸€å®šå‡†ç¡®</span><br><span class="line">public long sum() &#123;</span><br><span class="line">     Cell[] cs = cells;</span><br><span class="line">     long sum = base;</span><br><span class="line">     if (cs != null) &#123;</span><br><span class="line">        for (Cell c : cs)</span><br><span class="line">            if (c != null)</span><br><span class="line">                sum += c.value;</span><br><span class="line">    &#125;</span><br><span class="line">    return sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LongAdder-vs-AtomicLong-Performance"><a href="#LongAdder-vs-AtomicLong-Performance" class="headerlink" title="LongAdder vs AtomicLong Performance"></a>LongAdder vs AtomicLong Performance</h2><p><a href="http://blog.palominolabs.com/2014/02/10/java-8-performance-improvements-longadder-vs-atomiclong/" target="_blank" rel="noopener">Java 8 Performance Improvements: LongAdder vs AtomicLong</a></p><h1 id="å¯¹æ¯”LongAccumulator"><a href="#å¯¹æ¯”LongAccumulator" class="headerlink" title="å¯¹æ¯”LongAccumulator"></a>å¯¹æ¯”LongAccumulator</h1><p>LongAdderç±»å¯ä»¥çœ‹åšæ˜¯LongAccumulatorçš„ä¸€ä¸ªç‰¹ä¾‹ï¼ŒLongAccumulatoræä¾›äº†æ¯”LongAdderæ›´å¼ºå¤§ã€çµæ´»çš„åŠŸèƒ½ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Creates a new instance using the given accumulator function</span><br><span class="line"> * and identity element.</span><br><span class="line"> * @param accumulatorFunction a side-effect-free function of two arguments</span><br><span class="line"> * @param identity identity (initial value) for the accumulator function</span><br><span class="line">*/</span><br><span class="line">public LongAccumulator(LongBinaryOperator accumulatorFunction,</span><br><span class="line">                           long identity) &#123;</span><br><span class="line">    this.function = accumulatorFunction;</span><br><span class="line">    base = this.identity = identity;</span><br><span class="line">&#125;</span><br><span class="line">@FunctionalInterface</span><br><span class="line">public interface LongBinaryOperator &#123;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Applies this operator to the given operands.</span><br><span class="line"> *</span><br><span class="line"> * @param left the first operand</span><br><span class="line"> * @param right the second operand</span><br><span class="line"> * @return the operator result</span><br><span class="line">*/</span><br><span class="line">long applyAsLong(long left, long right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°å…¶ä¸­accumulatorFunctionä¸€ä¸ªåŒç›®è¿ç®—æ¥å£ï¼Œæ ¹æ®è¾“å…¥çš„ä¸¤ä¸ªå‚æ•°è¿”å›ä¸€ä¸ªè®¡ç®—å€¼ï¼Œidentityåˆ™æ˜¯LongAccumulatorç´¯åŠ å™¨çš„åˆå§‹å€¼ã€‚</p><p>accumulatorFunctionä¸»è¦ç”¨äºStriped64 longAccumulateä¸­ä½¿ç”¨ï¼Œå¦‚æœfn==nullï¼Œåˆ™é»˜è®¤æ˜¯ç›¸åŠ ï¼Œå¦åˆ™ä¼šè°ƒç”¨fn.applyAsLong(v, x)</p><blockquote><p>LongAccumulatorç›¸æ¯”äºLongAdderï¼Œå¯ä»¥ä¸ºç´¯åŠ å™¨æä¾›é0çš„åˆå§‹å€¼ï¼Œè€ŒLongAdderåªèƒ½æä¾›é»˜è®¤çš„0å€¼ã€‚<br>å¦å¤–ï¼ŒLongAccumulatorè¿˜å¯ä»¥æŒ‡å®šç´¯åŠ è§„åˆ™ï¼Œæ¯”å¦‚ç´¯åŠ æˆ–è€…ç›¸ä¹˜ï¼Œåªéœ€è¦åœ¨æ„é€ LongAccumulatoræ—¶ï¼Œä¼ å…¥è‡ªå®šä¹‰çš„åŒç›®è¿ç®—å™¨å³å¯ï¼Œåè€…åˆ™å†…ç½®ç´¯åŠ è§„åˆ™ã€‚</p></blockquote><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://github.com/jiankunking/openjdk12/blob/master/src/java.base/share/classes/java/util/concurrent/atomic/LongAdder.java" target="_blank" rel="noopener">https://github.com/jiankunking/openjdk12/blob/master/src/java.base/share/classes/java/util/concurrent/atomic/LongAdder.java</a></p><p><a href="https://github.com/jiankunking/openjdk12/blob/master/src/java.base/share/classes/jdk/internal/vm/annotation/Contended.java" target="_blank" rel="noopener">https://github.com/jiankunking/openjdk12/blob/master/src/java.base/share/classes/jdk/internal/vm/annotation/Contended.java</a></p><p><a href="https://www.jianshu.com/p/9a7de5644dd4" target="_blank" rel="noopener">https://www.jianshu.com/p/9a7de5644dd4</a></p><p><a href="http://openjdk.java.net/jeps/142" target="_blank" rel="noopener">http://openjdk.java.net/jeps/142</a></p><p><a href="http://mail.openjdk.java.net/pipermail/hotspot-dev/2012-November/007309.html" target="_blank" rel="noopener">http://mail.openjdk.java.net/pipermail/hotspot-dev/2012-November/007309.html</a></p>]]></content>
      
      
      <categories>
          
          <category> JDK </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JDK </tag>
            
            <tag> Concurrent </tag>
            
            <tag> Atomic </tag>
            
            <tag> LongAdder </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JRockitæƒå¨æŒ‡å—æ·±å…¥ç†è§£JVM ç¬”è®°</title>
      <link href="/java-jrockit-note.html"/>
      <url>/java-jrockit-note.html</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ•´ç†è‡ªï¼šã€ŠJRockitæƒå¨æŒ‡å—æ·±å…¥ç†è§£JVMã€‹ ä½œè€…ï¼šMarcus Hirt , Marcus Lagergren</p><p>å‡ºç‰ˆæ—¶é—´ï¼š2018-12-10</p><a id="more"></a><h1 id="èµ·æ­¥"><a href="#èµ·æ­¥" class="headerlink" title="èµ·æ­¥"></a>èµ·æ­¥</h1><h2 id="å°†åº”ç”¨ç¨‹åºè¿ç§»åˆ°JRockit"><a href="#å°†åº”ç”¨ç¨‹åºè¿ç§»åˆ°JRockit" class="headerlink" title="å°†åº”ç”¨ç¨‹åºè¿ç§»åˆ°JRockit"></a>å°†åº”ç”¨ç¨‹åºè¿ç§»åˆ°JRockit</h2><h3 id="å‘½ä»¤è¡Œé€‰é¡¹"><a href="#å‘½ä»¤è¡Œé€‰é¡¹" class="headerlink" title="å‘½ä»¤è¡Œé€‰é¡¹"></a>å‘½ä»¤è¡Œé€‰é¡¹</h3><p>åœ¨ JRockit JVMä¸­,ä¸»è¦æœ‰3ç±»å‘½ä»¤è¡Œé€‰é¡¹,åˆ†åˆ«æ˜¯ç³»ç»Ÿå±æ€§ã€æ ‡å‡†é€‰é¡¹(ä»¥-Xå¼€å¤´)å’Œéæ ‡å‡†é€‰é¡¹(ä»¥-XXå¼€å¤´)</p><p>1ã€ç³»ç»Ÿå±æ€§</p><p>è®¾ç½®JVMå¯åŠ¨å‚æ•°çš„æ–¹å¼æœ‰å¤šç§ã€‚ä»¥-Då¼€å¤´çš„å‚æ•°ä¼šä½œä¸ºç³»ç»Ÿå±æ€§ä½¿ç”¨,è¿™äº›å±æ€§å¯ä»¥ä¸ºJavaç±»åº“(å¦‚RMIç­‰)æä¾›ç›¸å…³çš„é…ç½®ä¿¡æ¯ã€‚ä¾‹å¦‚,åœ¨å¯åŠ¨çš„æ—¶å€™,å¦‚æœè®¾ç½®äº†-Dcom.Rockin.mc.debug=trueå‚æ•°,åˆ™JRockit Mission Controlä¼šæ‰“å°å‡ºè°ƒè¯•ä¿¡æ¯ã€‚ä¸è¿‡,R28ä¹‹åçš„JRockit JVMç‰ˆæœ¬åºŸå¼ƒäº†å¾ˆå¤šä¹‹å‰ä½¿ç”¨è¿‡çš„ç³»ç»Ÿå±æ€§,è½¬è€Œé‡‡ç”¨éæ ‡å‡†é€‰é¡¹å’Œç±»ä¼¼ HotSpotä¸­è™šæ‹Ÿæœºæ ‡å¿—(VM flag)çš„æ–¹å¼è®¾ç½®ç›¸å…³é€‰é¡¹</p><p>2ã€æ ‡å‡†é€‰é¡¹</p><p>ä»¥-Xå¼€å¤´çš„é€‰é¡¹æ˜¯å¤§éƒ¨åˆ†JVMå‚å•†éƒ½æ”¯æŒçš„é€šç”¨è®¾ç½®ã€‚ä¾‹å¦‚,ç”¨äºè®¾ç½®å †å¤§å°æœ€å¤§å€¼çš„é€‰é¡¹-Xmxåœ¨åŒ…æ‹¬ JRockitåœ¨å†…çš„å¤§éƒ¨åˆ†JVMä¸­éƒ½æ˜¯ç›¸åŒçš„ã€‚å½“ç„¶,ä¹Ÿå­˜åœ¨ä¾‹å¤–,å¦‚JRockitä¸­çš„é€‰é¡¹-Xverboseä¼šæ‰“å°å‡ºå¯é€‰çš„å­æ¨¡å—æ—¥å¿—ä¿¡æ¯,è€Œåœ¨ HotSpotä¸­,ç±»ä¼¼çš„(ä½†å®é™…ä¸Šæœ‰æ›´å¤šçš„é™åˆ¶)é€‰é¡¹æ˜¯-verbose</p><p>3ã€éæ ‡å‡†é€‰é¡¹</p><p>ä»¥-XXå¼€å¤´çš„å‘½ä»¤è¡Œé€‰é¡¹æ˜¯å„ä¸ªJVMå‚å•†è‡ªå·±å®šåˆ¶çš„ã€‚è¿™äº›é€‰é¡¹å¯èƒ½ä¼šåœ¨å°†æ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­è¢«åºŸå¼ƒæˆ–ä¿®æ”¹ã€‚å¦‚æœJVMçš„å‚æ•°é…ç½®ä¸­åŒ…å«äº†ä»¥-XXå¼€å¤´çš„å‘½ä»¤è¡Œé€‰é¡¹,åˆ™åœ¨å°†Javaåº”ç”¨ç¨‹åºä»ä¸€ç§JVMè¿ç§»åˆ°å¦ä¸€ç§æ—¶,åº”è¯¥åœ¨å¯åŠ¨Mä¹‹å‰å»é™¤è¿™äº›éæ ‡å‡†é€‰é¡¹ç¡®å®šäº†æ–°çš„VMé€‰é¡¹åæ‰å¯ä»¥å¯åŠ¨Javaåº”ç”¨ç¨‹åºã€‚</p><h1 id="è‡ªé€‚åº”ä»£ç ç”Ÿæˆ"><a href="#è‡ªé€‚åº”ä»£ç ç”Ÿæˆ" class="headerlink" title="è‡ªé€‚åº”ä»£ç ç”Ÿæˆ"></a>è‡ªé€‚åº”ä»£ç ç”Ÿæˆ</h1><h2 id="Javaè™šæ‹Ÿæœº"><a href="#Javaè™šæ‹Ÿæœº" class="headerlink" title="Javaè™šæ‹Ÿæœº"></a>Javaè™šæ‹Ÿæœº</h2><h3 id="å­—èŠ‚ç æ ¼å¼"><a href="#å­—èŠ‚ç æ ¼å¼" class="headerlink" title="å­—èŠ‚ç æ ¼å¼"></a>å­—èŠ‚ç æ ¼å¼</h3><p><a href="https://github.com/jiankunking/jvm-opcode" target="_blank" rel="noopener">Opcodes for the Java Virtual Machine</a></p><h4 id="å¸¸é‡æ± "><a href="#å¸¸é‡æ± " class="headerlink" title="å¸¸é‡æ± "></a>å¸¸é‡æ± </h4><p>ç¨‹åº,åŒ…å«æ•°æ®å’Œä»£ç ä¸¤éƒ¨åˆ†,å…¶ä¸­æ•°æ®ä½œä¸ºæ“ä½œæ•°ä½¿ç”¨ã€‚å¯¹äºå­—èŠ‚ç ç¨‹åºæ¥è¯´,å¦‚æœæ“ä½œæ•°éå¸¸å°æˆ–è€…å¾ˆå¸¸ç”¨(å¦‚å¸¸é‡0),åˆ™è¿™äº›æ“ä½œæ•°æ˜¯ç›´æ¥å†…åµŒåœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­çš„ã€‚</p><p>è¾ƒå¤§å—çš„æ•°æ®,ä¾‹å¦‚å¸¸é‡å­—ç¬¦ä¸²æˆ–æ¯”è¾ƒå¤§çš„æ•°å­—,æ˜¯å­˜å‚¨åœ¨classæ–‡ä»¶å¼€å§‹éƒ¨åˆ†çš„å¸¸é‡æ± (constant pool)ä¸­çš„ã€‚å½“ä½¿ç”¨è¿™ç±»æ•°æ®ä½œä¸ºæ“ä½œæ•°æ—¶,ä½¿ç”¨çš„æ˜¯å¸¸é‡æ± ä¸­æ•°æ®çš„ç´¢å¼•ä½ç½®,è€Œä¸æ˜¯å®é™…æ•°æ®æœ¬èº«ã€‚ä»¥å­—ç¬¦ä¸²æ•°æ®aVeryLong FunctionNameä¸ºä¾‹,å¦‚æœåœ¨ç¼–è¯‘æ–¹æ³•æ—¶æ¯æ¬¡éƒ½è¦é‡æ–°ç¼–ç è¿™ä¸ªå­—ç¬¦ä¸²çš„è¯,é‚£å­—èŠ‚ç å°±è°ˆä¸ä¸Šå‹ç¼©å­˜å‚¨äº†ã€‚</p><p>æ­¤å¤–,Javaç¨‹åºä¸­çš„æ–¹æ³•ã€å±æ€§å’Œç±»çš„å…ƒæ•°æ®ç­‰ä¹Ÿä½œä¸ºclasæ–‡ä»¶çš„ç»„æˆéƒ¨åˆ†,å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚</p><h2 id="è‡ªé€‚åº”ä»£ç ç”Ÿæˆ-1"><a href="#è‡ªé€‚åº”ä»£ç ç”Ÿæˆ-1" class="headerlink" title="è‡ªé€‚åº”ä»£ç ç”Ÿæˆ"></a>è‡ªé€‚åº”ä»£ç ç”Ÿæˆ</h2><h3 id="ä¼˜åŒ–åŠ¨æ€ç¨‹åº"><a href="#ä¼˜åŒ–åŠ¨æ€ç¨‹åº" class="headerlink" title="ä¼˜åŒ–åŠ¨æ€ç¨‹åº"></a>ä¼˜åŒ–åŠ¨æ€ç¨‹åº</h3><p>åœ¨æ±‡ç¼–ä»£ç ä¸­,æ–¹æ³•è°ƒç”¨æ˜¯é€šè¿‡callæŒ‡ä»¤å®Œæˆçš„ã€‚ä¸åŒå¹³å°ä¸ŠcallæŒ‡ä»¤çš„å…·ä½“å½¢å¼ä¸å°½ç›¸åŒ,ä¸åŒç±»å‹çš„callæŒ‡ä»¤,å…¶å…·ä½“æ ¼å¼ä¹Ÿä¸å°½ç›¸åŒã€‚</p><p>åœ¨é¢å‘å¯¹è±¡çš„è¯­è¨€ä¸­,è™šæ‹Ÿæ–¹æ³•åˆ†æ´¾é€šå¸¸è¢«ç¼–è¯‘ä¸ºå¯¹åˆ†æ´¾è¡¨(dispatch table)ä¸­åœ°å€çš„é—´æ¥è°ƒç”¨(indirect call,å³éœ€è¦ä»å†…å­˜ä¸­è¯»å–çœŸæ­£çš„è°ƒç”¨åœ°å€)ã€‚è¿™æ˜¯å› ä¸º,æ ¹æ®ä¸åŒçš„ç±»ç»§æ‰¿ç»“æ„åˆ†æ´¾è™šæ‹Ÿè°ƒç”¨æ—¶å¯èƒ½ä¼šæœ‰å¤šä¸ªæ¥æ”¶è€…ã€‚æ¯ä¸ªç±»ä¸­éƒ½æœ‰ä¸€ä¸ªåˆ†æ´¾è¡¨,å…¶ä¸­åŒ…å«äº†å…¶è™šæ‹Ÿè°ƒç”¨çš„æ¥æ”¶è€…ä¿¡æ¯ã€‚é™æ€æ–¹æ³•å’Œç¡®çŸ¥åªæœ‰ä¸€ä¸ªæ¥æ”¶è€…çš„è™šæ‹Ÿæ–¹æ³•å¯ä»¥è¢«ç¼–è¯‘ä¸ºå¯¹å›ºå®šè°ƒç”¨åœ°å€çš„ç›´æ¥è°ƒç”¨(direct call)ã€‚ä¸€èˆ¬æ¥è¯´,è¿™å¯ä»¥å¤§å¤§åŠ å¿«æ‰§è¡Œé€Ÿåº¦ã€‚<br><img alt data-src="/images/java-jrockit-note/%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8%E8%99%9A%E6%8B%9F%E8%B0%83%E7%94%A8.png"></p><p>å‡è®¾åº”ç”¨ç¨‹åºæ˜¯ä½¿ç”¨C++å¼€å‘çš„,å¯¹ä»£ç ç”Ÿæˆå™¨æ¥è¯´,åœ¨ç¼–è¯‘æ—¶å·²ç»å¯ä»¥è·å–åˆ°ç¨‹åºçš„æ‰€æœ‰ç»“æ„æ€§ä¿¡æ¯ã€‚ä¾‹å¦‚,ç”±äºåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­,ä»£ç ä¸ä¼šå‘ç”Ÿå˜åŒ–,æ‰€ä»¥åœ¨ç¼–è¯‘æ—¶å°±å¯ä»¥ä»ä»£ç ä¸­åˆ¤æ–­å‡º,æŸä¸ªè™šæ‹Ÿæ–¹æ³•æ˜¯å¦åªæœ‰ä¸€ç§å®ç°ã€‚æ­£å› å¦‚æ­¤,ç¼–è¯‘å™¨ä¸ä»…ä¸éœ€è¦å› ä¸ºåºŸå¼ƒä»£ç è€Œè®°å½•é¢å¤–çš„ä¿¡æ¯,è¿˜å¯ä»¥å°†é‚£äº›åªæœ‰ä¸€ç§å®ç°çš„è™šæ‹Ÿæ–¹æ³•è½¬åŒ–ä¸ºé™æ€è°ƒç”¨ã€‚</p><p>å‡å¦‚åº”ç”¨ç¨‹åºæ˜¯ä½¿ç”¨Javaå¼€å‘çš„,èµ·åˆæŸä¸ªè™šæ‹Ÿæ–¹æ³•å¯èƒ½åªæœ‰ä¸€ç§å®ç°,ä½†Javaå…è®¸åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¿®æ”¹æ–¹æ³•å®ç°ã€‚å½“JITç¼–è¯‘å™¨éœ€è¦ç¼–è¯‘æŸä¸ªè™šæ‹Ÿæ–¹æ³•æ—¶,æ›´å–œæ¬¢çš„æ˜¯é‚£äº›æ°¸è¿œåªå­˜åœ¨ä¸€ç§å®ç°çš„,è¿™æ ·ç¼–è¯‘å™¨å°±å¯ä»¥åƒå‰é¢æåˆ°çš„C+ç¼–è¯‘å™¨ä¸€æ ·åšå¾ˆå¤šä¼˜åŒ–,ä¾‹å¦‚å°†è™šæ‹Ÿè°ƒç”¨è½¬åŒ–ä¸ºç›´æ¥è°ƒç”¨ã€‚ä½†æ˜¯,ç”±äºJavaå…è®¸åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ä¿®æ”¹ä»£ç ,å¦‚æœæŸä¸ªæ–¹æ³•æ²¡æœ‰å£°æ˜finalä¿®é¥°ç¬¦,é‚£å®ƒå°±æœ‰å¯èƒ½åœ¨è¿è¡ŒæœŸé—´è¢«ä¿®æ”¹,å³ä½¿å®ƒçœ‹èµ·æ¥å‡ ä¹ä¸å¯èƒ½æœ‰å…¶ä»–å®ç°,ç¼–è¯‘å™¨ä¹Ÿä¸èƒ½å°†ä¹‹ä¼˜åŒ–ä¸ºç›´æ¥è°ƒç”¨ã€‚</p><p>åœ¨Javaä¸–ç•Œä¸­,æœ‰ä¸€äº›åœºæ™¯ç°åœ¨çœ‹èµ·æ¥ä¸€åˆ‡æ­£å¸¸,ç¼–è¯‘å™¨å¯ä»¥å¤§åŠ›ä¼˜åŒ–ä»£ç ,ä½†æ˜¯å¦‚æœæŸå¤©ç¨‹åºå‘ç”Ÿäº†æ”¹å˜çš„è¯,å°±éœ€è¦å°†ç›¸å…³çš„ä¼˜åŒ–å…¨éƒ¨æ’¤é”€ã€‚å¯¹äºJavaæ¥è¯´,ä¸ºäº†èƒ½å¤Ÿåª²ç¾C++ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦,å°±éœ€è¦ä¸€äº›ç‰¹æ®Šçš„ä¼˜åŒ–æªæ–½ã€‚</p><p>JVMä½¿ç”¨çš„ç­–ç•¥å°±æ˜¯â€œèµŒâ€ã€‚JVMä»£ç ç”Ÿæˆç­–ç•¥çš„å‡è®¾æ¡ä»¶æ˜¯,æ­£åœ¨è¿è¡Œçš„ä»£ç æ°¸è¿œä¸å˜ã€‚äº‹å®ä¸Š,å¤§éƒ¨åˆ†æ—¶é—´é‡Œç¡®å®å¦‚æ­¤ã€‚ä½†å¦‚æœæ­£åœ¨è¿è¡Œçš„ä»£ç å‘ç”Ÿäº†å˜åŒ–,è¿åäº†ä»£ç ä¼˜åŒ–çš„å‡è®¾æ¡ä»¶,å°±ä¼šè§¦å‘å…¶ç°¿è®°ç³»ç»Ÿ(bookkeeping system)çš„å›è°ƒåŠŸèƒ½ã€‚æ­¤æ—¶,åŸºäºåŸå…ˆå‡è®¾æ¡ä»¶ç”Ÿæˆçš„ä»£ç å°±éœ€è¦è¢«åºŸå¼ƒæ‰,é‡æ–°ç”Ÿæˆ,ä¾‹å¦‚ä¸ºå·²ç»è½¬åŒ–ä¸ºç›´æ¥è°ƒç”¨çš„è™šæ‹Ÿè°ƒç”¨é‡æ–°ç”Ÿæˆç›¸å…³ä»£ç ã€‚å› æ­¤,â€œèµŒè¾“â€çš„ä»£ä»·æ˜¯å¾ˆå¤§çš„,ä½†å¦‚æœâ€œèµŒèµ¢â€çš„æ¦‚ç‡éå¸¸é«˜,åˆ™ä»ä¸­è·å¾—çš„æ€§èƒ½æå‡å°±ä¼šéå¸¸å¤§,å€¼å¾—ä¸€è¯•ã€‚</p><p>ä¸€èˆ¬æ¥è¯´,JVMå’ŒJITç¼–è¯‘å™¨æ‰€åšçš„å…¸å‹å‡è®¾åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>è™šæ‹Ÿæ–¹æ³•ä¸ä¼šè¢«è¦†ç›–ã€‚ç”±äºæŸä¸ªè™šæ‹Ÿæ–¹æ³•åªå­˜åœ¨ä¸€ç§å®ç°,å°±å¯ä»¥å°†ä¹‹ä¼˜åŒ–ä¸ºä¸€ä¸ªç›´æ¥è°ƒç”¨ã€‚</li><li>æµ®ç‚¹æ•°çš„å€¼æ°¸è¿œä¸ä¼šæ˜¯NaNã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹,å¯ä»¥ä½¿ç”¨ç¡¬ä»¶æŒ‡ä»¤æ¥æ›¿æ¢å¯¹æœ¬åœ°æµ®ç‚¹æ•°å‡½æ•°åº“çš„è°ƒç”¨ã€‚</li><li>æŸäº›tryè¯­å¥å—ä¸­å‡ ä¹ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å› æ­¤,å¯ä»¥å°†catchè¯­å¥å—ä¸­çš„ä»£ç ä½œä¸ºå†·æ–¹æ³•å¯¹å¾…ã€‚</li><li>å¯¹äºå¤§å¤šæ•°ä¸‰è§’å‡½æ•°æ¥è¯´,ç¡¬ä»¶æŒ‡ä»¤fsinéƒ½èƒ½å¤Ÿè¾¾åˆ°ç²¾åº¦è¦æ±‚ã€‚å¦‚æœçœŸçš„è¾¾ä¸åˆ°,å°±æŠ›å‡ºå¼‚å¸¸,è°ƒç”¨æœ¬åœ°æµ®ç‚¹æ•°å‡½æ•°åº“å®Œæˆè®¡ç®—ã€‚</li><li>é”ç«äº‰å¹¶ä¸ä¼šå¤ªæ¿€çƒˆ,åˆæœŸå¯ä»¥ä½¿ç”¨è‡ªæ—‹é”(spinlock)æ›¿ä»£ã€‚</li><li>é”å¯èƒ½ä¼šå‘¨æœŸæ€§åœ°è¢«åŒä¸€ä¸ªçº¿ç¨‹è·å–å’Œé‡Šæ”¾,æ‰€ä»¥,å¯ä»¥å°†å¯¹é”çš„é‡å¤è·å–æ“ä½œå’Œé‡å¤é‡Šæ”¾æ“ä½œç›´æ¥çœç•¥æ‰ã€‚</li></ul><h2 id="æ·±å…¥JITç¼–è¯‘å™¨"><a href="#æ·±å…¥JITç¼–è¯‘å™¨" class="headerlink" title="æ·±å…¥JITç¼–è¯‘å™¨"></a>æ·±å…¥JITç¼–è¯‘å™¨</h2><h3 id="ä¼˜åŒ–å­—èŠ‚ç "><a href="#ä¼˜åŒ–å­—èŠ‚ç " class="headerlink" title="ä¼˜åŒ–å­—èŠ‚ç "></a>ä¼˜åŒ–å­—èŠ‚ç </h3><blockquote><p>æœ‰äº›æ—¶å€™,å¯¹Javaæºä»£ç åšä¼˜åŒ–ä¼šé€‚å¾—å…¶åã€‚ç»å¤§éƒ¨åˆ†å†™å‡ºå¯è¯»æ€§å¾ˆå·®çš„ä»£ç çš„äººéƒ½å£°ç§°æ˜¯ä¸ºäº†ä¼˜åŒ–æ€§èƒ½,å…¶å®å°±æ˜¯ç…§ç€ä¸€äº›åŸºå‡†æµ‹è¯•æŠ¥å‘Šçš„ç»“è®ºå†™ä»£ç ,è€Œè¿™äº›æ€§èƒ½æµ‹è¯•å¾€å¾€åªæ¶‰åŠäº†å­—èŠ‚ç è§£é‡Šæ‰§è¡Œ,æ²¡æœ‰ç»è¿‡JITç¼–è¯‘å™¨ä¼˜åŒ–,æ‰€ä»¥å¹¶ä¸èƒ½ä»£è¡¨åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶çš„çœŸå®è¡¨ç°ã€‚ä¾‹å¦‚,æŸä¸ªæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºä¸­åŒ…å«äº†å¤§é‡å¯¹æ•°ç»„å…ƒç´ çš„è¿­ä»£è®¿é—®æ“ä½œ,ç¨‹åºå‘˜å‚è€ƒäº†é‚£äº›æŠ¥å‘Šä¸­çš„ç»“è®º,æ²¡æœ‰è®¾ç½®å¾ªç¯æ¡ä»¶,è€Œæ˜¯å†™ä¸€ä¸ªæ— é™forå¾ªç¯,ç½®äºtryè¯­å¥å—ä¸­,å¹¶åœ¨catchè¯­å¥å—ä¸­æ•è·ArrayIndexOutOfBoundsExceptionå¼‚å¸¸ã€‚è¿™ç§ç³Ÿç³•çš„å†™æ³•ä¸ä»…ä½¿ä»£ç å¯è¯»æ€§æå·®,è€Œä¸”ä¸€æ—¦è¿è¡Œæ—¶å¯¹ä¹‹ä¼˜åŒ–ç¼–è¯‘çš„è¯,å…¶æ‰§è¡Œæ•ˆç‡åè€Œæ¯”æ™®é€šå¾ªç¯æ–¹å¼ä½å¾—å¤šã€‚åŸå› åœ¨äº,JVMçš„åŸºæœ¬å‡è®¾ä¹‹ä¸€å°±æ˜¯â€œå¼‚å¸¸æ˜¯å¾ˆå°‘å‘ç”Ÿçš„â€ã€‚åŸºäºè¿™ç§å‡è®¾,JVMä¼šåšä¸€äº›ç›¸å…³ä¼˜åŒ–,æ‰€ä»¥å½“çœŸçš„å‘ç”Ÿå¼‚å¸¸æ—¶,å¤„ç†æˆæœ¬å°±å¾ˆé«˜ã€‚</p></blockquote><h2 id="ä»£ç æµæ°´çº¿"><a href="#ä»£ç æµæ°´çº¿" class="headerlink" title="ä»£ç æµæ°´çº¿"></a>ä»£ç æµæ°´çº¿</h2><h3 id="ä»£ç ç”Ÿæˆæ¦‚è¿°"><a href="#ä»£ç ç”Ÿæˆæ¦‚è¿°" class="headerlink" title="ä»£ç ç”Ÿæˆæ¦‚è¿°"></a>ä»£ç ç”Ÿæˆæ¦‚è¿°</h3><blockquote><p>åœ¨ç”Ÿæˆä¼˜åŒ–ä»£ç æ—¶,å¦‚ä½•åˆ†é…å¯„å­˜å™¨éå¸¸é‡è¦ã€‚ç¼–è¯‘å™¨æ•™æä¸Šéƒ½å°†å¯„å­˜å™¨åˆ†é…é—®é¢˜ä½œä¸ºå›¾çš„ç€è‰²é—®é¢˜å¤„ç†,è¿™æ˜¯å› ä¸ºåŒæ—¶ç”¨åˆ°çš„ä¸¤ä¸ªå˜é‡ä¸èƒ½å…±äº«åŒä¸€ä¸ªå¯„å­˜å™¨,ä»è¿™ç‚¹ä¸Šè®²,ä¸ç€è‰²é—®é¢˜ç›¸åŒã€‚åŒæ—¶ä½¿ç”¨çš„å¤šä¸ªå˜é‡å¯ä»¥ç”¨å›¾ä¸­ç›¸è¿æ¥çš„èŠ‚ç‚¹æ¥è¡¨ç¤º,è¿™æ ·,å¯„å­˜å™¨åˆ†é…é—®é¢˜å°±å¯ä»¥è¢«æŠ½è±¡ä¸ºâ€œå¦‚ä½•ä¸ºå›¾ä¸­çš„èŠ‚ç‚¹ç€è‰²,5èƒ½ä½¿ç›¸è¿èŠ‚ç‚¹æœ‰ä¸åŒçš„é¢œè‰²â€ã€‚è¿™é‡Œå¯ç”¨é¢œè‰²çš„æ•°é‡ç­‰äºæŒ‡å®šå¹³å°ä¸Šå¯ç”¨å¯„å­˜å™¨çš„æ•°é‡ã€‚ä¸è¿‡,é—æ†¾çš„æ˜¯,ä»è®¡ç®—å¤æ‚æ€§ä¸Šè®²,ç€è‰²é—®é¢˜æ˜¯NP-hardçš„,ä¹Ÿå°±æ˜¯è¯´ç°åœ¨è¿˜æ²¡æœ‰ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•(æŒ‡å¯ä»¥åœ¨å¤šé¡¹å¼æ—¶é—´å†…å®Œæˆè®¡ç®—)èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯,ç€è‰²é—®é¢˜å¯ä»¥åœ¨çº¿æ€§å¯¹æ•°æ—¶é—´å†…ç»™å‡ºè¿‘ä¼¼è§£,å› æ­¤å¤§å¤šæ•°ç¼–è¯‘å™¨éƒ½ä½¿ç”¨ç€è‰²ç®—æ³•çš„æŸä¸ªå˜ç§æ¥å¤„ç†å¯„å­˜å™¨åˆ†é…é—®é¢˜ã€‚</p></blockquote><h1 id="è‡ªé€‚åº”å†…å­˜ç®¡ç†"><a href="#è‡ªé€‚åº”å†…å­˜ç®¡ç†" class="headerlink" title="è‡ªé€‚åº”å†…å­˜ç®¡ç†"></a>è‡ªé€‚åº”å†…å­˜ç®¡ç†</h1><h2 id="å †ç®¡ç†åŸºç¡€"><a href="#å †ç®¡ç†åŸºç¡€" class="headerlink" title="å †ç®¡ç†åŸºç¡€"></a>å †ç®¡ç†åŸºç¡€</h2><h3 id="å¯¹è±¡çš„åˆ†é…ä¸é‡Šæ”¾"><a href="#å¯¹è±¡çš„åˆ†é…ä¸é‡Šæ”¾" class="headerlink" title="å¯¹è±¡çš„åˆ†é…ä¸é‡Šæ”¾"></a>å¯¹è±¡çš„åˆ†é…ä¸é‡Šæ”¾</h3><p><font color="DeepPink">ä¸€èˆ¬æ¥è¯´,ä¸ºå¯¹è±¡åˆ†é…å†…å­˜æ—¶,å¹¶ä¸ä¼šç›´æ¥åœ¨å †ä¸Šåˆ’åˆ†å†…å­˜,è€Œæ˜¯å…ˆåœ¨çº¿ç¨‹å±€éƒ¨ç¼“å†²(thread local buffer)æˆ–å…¶ä»–ç±»ä¼¼çš„ç»“æ„ä¸­æ‰¾åœ°æ–¹æ”¾ç½®å¯¹è±¡,ç„¶åéšç€åº”ç”¨ç¨‹åºçš„è¿è¡Œã€æ–°å¯¹è±¡çš„ä¸æ–­åˆ†é…,åƒåœ¾å›æ”¶é€æ¬¡æ‰§è¡Œ,è¿™äº›å¯¹è±¡å¯èƒ½æœ€ç»ˆä¼šè¢«æå‡åˆ°å †ä¸­ä¿å­˜,ä¹Ÿæœ‰å¯èƒ½ä¼šå½“ä½œåƒåœ¾è¢«é‡Šæ”¾æ‰ã€‚</font></p><p>ä¸ºäº†èƒ½å¤Ÿåœ¨å †ä¸­ç»™æ–°åˆ›å»ºçš„å¯¹è±¡æ‰¾ä¸€ä¸ªåˆé€‚çš„ä½ç½®,å†…å­˜ç®¡ç†ç³»ç»Ÿå¿…é¡»çŸ¥é“å †ä¸­æœ‰å“ªäº›åœ°æ–¹æ˜¯ç©ºé—²çš„,å³è¿˜æ²¡æœ‰å­˜æ´»å¯¹è±¡å ç”¨ã€‚å†…å­˜ç®¡ç†ç³»ç»Ÿä½¿ç”¨ç©ºé—²åˆ—è¡¨(free list)â€”ä¸²è”èµ·å†…å­˜ä¸­å¯ç”¨å†…å­˜å—çš„é“¾è¡¨,æ¥ç®¡ç†å†…å­˜ä¸­å¯ç”¨çš„ç©ºé—²åŒºåŸŸ,å¹¶æŒ‰ç…§æŸä¸ªç»´åº¦çš„ä¼˜å…ˆçº§æ’åºã€‚</p><p>åœ¨ç©ºé—²åˆ—è¡¨ä¸­æœç´¢è¶³å¤Ÿå­˜å‚¨æ–°å¯¹è±¡çš„ç©ºé—²å—æ—¶,å¯ä»¥é€‰æ‹©å¤§å°æœ€é€‚åˆçš„ç©ºé—²å—,ä¹Ÿå¯ä»¥é€‰æ‹©ç¬¬ä¸€ä¸ªæ”¾å¾—ä¸‹çš„ç©ºé—²å—ã€‚è¿™å…¶ä¸­ä¼šç”¨åˆ°å‡ ç§ä¸åŒçš„ç®—æ³•å»å®ç°,å„æœ‰ä¼˜åŠ£,åæ–‡ä¼šè¯¦ç»†è®¨è®ºã€‚</p><h2 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h2><p><font color="DeepPink">åœ¨åæ–‡ä¸­,æ ¹é›†åˆ(root set)ä¸“æŒ‡ä¸Šè¿°æœç´¢ç®—æ³•çš„åˆå§‹è¾“å…¥é›†åˆ,å³å¼€å§‹æ‰§è¡Œå¼•ç”¨è·Ÿè¸ªæ—¶çš„å­˜æ´»å¯¹è±¡é›†åˆã€‚ä¸€èˆ¬æƒ…å†µä¸‹,æ ¹é›†åˆä¸­åŒ…æ‹¬äº†å› ä¸ºæ‰§è¡Œåƒåœ¾å›æ”¶è€Œæš‚åœçš„åº”ç”¨ç¨‹åºçš„å½“å‰æ ˆå¸§ä¸­æ‰€æœ‰çš„å¯¹è±¡,åŒ…å«äº†å¯ä»¥ä»å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡çš„ç”¨æˆ·æ ˆå’Œå¯„å­˜å™¨ä¸­èƒ½å¾—åˆ°çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ­¤å¤–,æ ¹é›†åˆä¸­è¿˜åŒ…å«å…¨å±€æ•°æ®,ä¾‹å¦‚ç±»çš„é™æ€å±æ€§ã€‚ç®€å•æ¥è¯´å°±æ˜¯,æ ¹é›†åˆä¸­åŒ…å«äº†æ‰€æœ‰æ— é¡»è·Ÿè¸ªå¼•ç”¨å°±å¯ä»¥å¾—åˆ°çš„å¯¹è±¡ã€‚</font></p><p>Javaä½¿ç”¨çš„æ˜¯å‡†ç¡®å¼åƒåœ¾å›æ”¶å™¨(exact garbage collector),å¯ä»¥å°†å¯¹è±¡æŒ‡é’ˆç±»å‹æ•°æ®å’Œå…¶ä»–ç±»å‹çš„æ•°æ®åŒºåˆ†å¼€,åªéœ€è¦å°†å…ƒæ•°æ®ä¿¡æ¯å‘ŠçŸ¥åƒåœ¾å›æ”¶å™¨å³å¯,è¿™äº›å…ƒæ•°æ®ä¿¡æ¯,ä¸€èˆ¬å¯ä»¥ä»Javaæ–¹æ³•çš„ä»£ç ä¸­å¾—åˆ°ã€‚</p><p>è¿‘äº›å¹´,ä½¿ç”¨ä¿¡å·æ¥æš‚åœçº¿ç¨‹çš„æ–¹å¼å—åˆ°é¢‡å¤šäº‰è®®ã€‚å®è·µå‘ç°,åœ¨æŸäº›æ“ä½œç³»ç»Ÿä¸Š,å°¤ä»¥Linuxä¸ºä¾‹,åº”ç”¨ç¨‹åºå¯¹ä¿¡å·çš„ä½¿ç”¨å’Œæµ‹è¯•å¾ˆä¸åˆ°ä½,è¿˜æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹çš„æœ¬åœ°åº“ä¸éµå®ˆä¿¡å·çº¦å®š,å¯¼è‡´ä¿¡å·å†²çªç­‰äº‹ä»¶çš„å‘ç”Ÿã€‚å› æ­¤,ä¸ä¿¡å·ç›¸å…³çš„å¤–éƒ¨ä¾èµ–å·²ç»ä¸å†å¯é ã€‚</p><h3 id="åˆ†ä»£åƒåœ¾å›æ”¶"><a href="#åˆ†ä»£åƒåœ¾å›æ”¶" class="headerlink" title="åˆ†ä»£åƒåœ¾å›æ”¶"></a>åˆ†ä»£åƒåœ¾å›æ”¶</h3><p>äº‹å®ä¸Š,å°†å †åˆ’åˆ†ä¸ºä¸¤ä¸ªæˆ–å¤šä¸ªç§°ä¸ºä»£(generation)çš„ç©ºé—´,å¹¶åˆ†åˆ«å­˜æ”¾å…·æœ‰ä¸åŒé•¿åº¦ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡,å¯ä»¥æå‡åƒåœ¾å›æ”¶çš„æ‰§è¡Œæ•ˆç‡ã€‚<font color="DeepPink">åœ¨JRockitä¸­,æ–°åˆ›å»º(young)çš„å¯¹è±¡å­˜æ”¾åœ¨ç§°ä¸ºæ–°ç”Ÿä»£(nursery)çš„ç©ºé—´ä¸­,ä¸€èˆ¬æ¥è¯´,å®ƒçš„å¤§å°ä¼šæ¯”è€å¹´ä»£(old collections)å°å¾ˆå¤š,éšç€åƒåœ¾å›æ”¶çš„é‡å¤æ‰§è¡Œ,ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ä¼šè¢«æå‡(promote)åˆ°è€å¹´ä»£ä¸­ã€‚</font>å› æ­¤,æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å’Œè€å¹´ä»£åƒåœ¾å›æ”¶ä¸¤ç§ä¸åŒçš„åƒåœ¾å›æ”¶æ–¹å¼åº”è¿è€Œç”Ÿ,åˆ†åˆ«ç”¨äºå¯¹å„è‡ªç©ºé—´ä¸­çš„å¯¹è±¡æ‰§è¡Œåƒåœ¾å›æ”¶ã€‚</p><p>æ–°ç”Ÿä»£åƒåœ¾å›æ”¶çš„é€Ÿåº¦æ¯”è€å¹´ä»£å¿«å‡ ä¸ªæ•°é‡çº§,å³ä½¿æ–°ç”Ÿä»£åƒåœ¾å›æ”¶çš„é¢‘ç‡æ›´é«˜,æ‰§è¡Œæ•ˆç‡ä¹Ÿä»ç„¶æ¯”è€å¹´ä»£åƒåœ¾å›æ”¶å¼º,è¿™æ˜¯å› ä¸ºå¤§å¤šæ•°å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸéƒ½å¾ˆçŸ­,æ ¹æœ¬æ— é¡»æå‡åˆ°è€å¹´ä»£ã€‚ç†æƒ³æƒ…å†µä¸‹,æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å¯ä»¥å¤§å¤§æå‡ç³»ç»Ÿçš„ååé‡,å¹¶æ¶ˆé™¤æ½œåœ¨çš„å†…å­˜ç¢ç‰‡ã€‚</p><h4 id="å†™å±éšœ"><a href="#å†™å±éšœ" class="headerlink" title="å†™å±éšœ"></a>å†™å±éšœ</h4><p>åœ¨å®ç°åˆ†ä»£å¼åƒåœ¾å›æ”¶æ—¶,å¤§éƒ¨åˆ†JVMéƒ½æ˜¯ç”¨åä¸ºå†™å±éšœ(write barrier)çš„æŠ€æœ¯æ¥è®°å½•æ‰§è¡Œåƒåœ¾å›æ”¶æ—¶éœ€è¦éå†å †çš„å“ªäº›éƒ¨åˆ†ã€‚å½“å¯¹è±¡AæŒ‡å‘å¯¹è±¡Bæ—¶,å³å¯¹è±¡Bæˆä¸ºå¯¹è±¡Açš„å±æ€§çš„å€¼æ—¶,å°±ä¼šè§¦å‘å†™å±éšœ,åœ¨å®Œæˆå±æ€§åŸŸèµ‹å€¼åæ‰§è¡Œä¸€äº›è¾…åŠ©æ“ä½œã€‚</p><p>å†™å±éšœçš„ä¼ ç»Ÿå®ç°æ–¹å¼æ˜¯å°†å †åˆ’åˆ†æˆå¤šä¸ªå°çš„è¿ç»­ç©ºé—´(ä¾‹å¦‚æ¯å—512å­—èŠ‚),æ¯å—ç©ºé—´ç§°ä¸ºå¡ç‰‡(card),äºæ˜¯,å †è¢«æ˜ å°„ä¸ºä¸€ä¸ªç²—ç²’åº¦çš„å¡è¡¨(card table)ã€‚å½“Javaåº”ç”¨ç¨‹åºå°†æŸä¸ªå¯¹è±¡èµ‹å€¼ç»™å¯¹è±¡å¼•ç”¨æ—¶,ä¼šé€šè¿‡å†™å±éšœè®¾ç½®è„æ ‡å¿—ä½(dirty bit),å°†è¯¥å¯¹è±¡æ‰€åœ¨çš„å¡ç‰‡æ ‡è®°ä¸ºè„ã€‚</p><p>è¿™æ ·,éå†ä»è€å¹´ä»£æŒ‡å‘æ–°ç”Ÿä»£çš„å¼•ç”¨æ—¶é—´å¾—ä»¥ç¼©çŸ­,åƒåœ¾å›æ”¶å™¨åœ¨åšæ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ—¶åªéœ€è¦æ£€æŸ¥è€å¹´ä»£ä¸­è¢«æ ‡è®°ä¸ºè„çš„å¡ç‰‡æ‰€å¯¹åº”çš„å†…å­˜åŒºåŸŸå³å¯ã€‚</p><h3 id="JRockitä¸­çš„åƒåœ¾å›æ”¶"><a href="#JRockitä¸­çš„åƒåœ¾å›æ”¶" class="headerlink" title="JRockitä¸­çš„åƒåœ¾å›æ”¶"></a>JRockitä¸­çš„åƒåœ¾å›æ”¶</h3><h4 id="è€å¹´ä»£åƒåœ¾å›æ”¶"><a href="#è€å¹´ä»£åƒåœ¾å›æ”¶" class="headerlink" title="è€å¹´ä»£åƒåœ¾å›æ”¶"></a>è€å¹´ä»£åƒåœ¾å›æ”¶</h4><p>JRockitä¸ä»…å°†å¡è¡¨åº”ç”¨äºåˆ†ä»£å¼åƒåœ¾å›æ”¶,è¿˜ç”¨åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸæ—¶çš„æ¸…ç†å·¥ä½œ,é¿å…æœç´¢æ•´ä¸ªå­˜æ´»å¯¹è±¡å›¾ã€‚è¿™æ˜¯å› ä¸ºJRockitéœ€è¦æ‰¾å‡ºåœ¨æ‰§è¡Œå¹¶å‘æ ‡è®°æ“ä½œæ—¶,åº”ç”¨ç¨‹åºåˆåˆ›å»ºäº†å“ªäº›å¯¹è±¡ã€‚ä¿®æ”¹å¼•ç”¨å…³ç³»æ—¶é€šè¿‡å†™å±éšœå¯ä»¥æ›´æ–°å¡è¡¨,å­˜æ´»å¯¹è±¡å›¾ä¸­çš„æ¯ä¸ªåŒºåŸŸä½¿ç”¨å¡è¡¨ä¸­çš„ä¸€ä¸ªå¡ç‰‡è¡¨ç¤º,å¡ç‰‡çš„çŠ¶æ€å¯ä»¥æ˜¯å¹²å‡€æˆ–è€…è„,æœ‰æ–°å¯¹è±¡åˆ›å»ºæˆ–è€…å¯¹è±¡å¼•ç”¨å…³ç³»ä¿®æ”¹äº†çš„å¡ç‰‡ä¼šè¢«æ ‡è®°ä¸ºè„ã€‚åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸæ—¶,åƒåœ¾å›æ”¶å™¨åªéœ€è¦æ£€æŸ¥é‚£äº›æ ‡è®°ä¸ºè„çš„å¡ç‰‡æ‰€å¯¹åº”çš„å †ä¸­åŒºåŸŸå³å¯,è¿™æ ·å°±å¯ä»¥æ‰¾åˆ°åœ¨å¹¶å‘æ ‡è®°æœŸé—´æ–°åˆ›å»ºçš„å’Œè¢«æ›´æ–°è¿‡å¼•ç”¨å…³ç³»çš„å¯¹è±¡</p><h2 id="æ€§èƒ½ä¸ä¼¸ç¼©æ€§"><a href="#æ€§èƒ½ä¸ä¼¸ç¼©æ€§" class="headerlink" title="æ€§èƒ½ä¸ä¼¸ç¼©æ€§"></a>æ€§èƒ½ä¸ä¼¸ç¼©æ€§</h2><h3 id="çº¿ç¨‹å±€éƒ¨åˆ†é…"><a href="#çº¿ç¨‹å±€éƒ¨åˆ†é…" class="headerlink" title="çº¿ç¨‹å±€éƒ¨åˆ†é…"></a>çº¿ç¨‹å±€éƒ¨åˆ†é…</h3><p><font color="DeepPink">åœ¨JRockitä¸­,ä½¿ç”¨äº†åä¸ºçº¿ç¨‹å±€éƒ¨åˆ†é…(thread local allocation)çš„æŠ€æœ¯æ¥å¤§å¹…åŠ é€Ÿå¯¹è±¡çš„åˆ†é…è¿‡ç¨‹ã€‚æ­£å¸¸æƒ…å†µä¸‹,åœ¨çº¿ç¨‹å†…çš„ç¼“å†²åŒºä¸­ä¸ºå¯¹è±¡åˆ†é…å†…å­˜è¦æ¯”ç›´æ¥åœ¨éœ€è¦åŒæ­¥æ“ä½œçš„å †ä¸Šåˆ†é…å†…å­˜å¿«å¾—å¤šã€‚åƒåœ¾å›æ”¶å™¨åœ¨å †ä¸Šç›´æ¥åˆ†é…å†…å­˜æ—¶æ˜¯éœ€è¦å¯¹æ•´ä¸ªå †åŠ é”çš„,å¯¹äºå¤šçº¿ç¨‹ç«äº‰æ¿€çƒˆçš„åº”ç”¨ç¨‹åºæ¥è¯´,è¿™å°†ä¼šæ˜¯ä¸€åœºç¾éš¾ã€‚</font>å› æ­¤,å¦‚æœæ¯ä¸ªJavaçº¿ç¨‹èƒ½å¤Ÿæœ‰ä¸€å—å±€éƒ¨å¯¹è±¡ç¼“å†²åŒºé‚£ä¹ˆç»å¤§éƒ¨åˆ†çš„å¯¹è±¡åˆ†é…æ“ä½œåªéœ€è¦ç§»åŠ¨ä¸€ä¸‹æŒ‡é’ˆå³å¯å®Œæˆ,åœ¨å¤§å¤šæ•°ç¡¬ä»¶å¹³å°ä¸Š,åªéœ€è¦ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤å°±è¡Œäº†ã€‚è¿™å—è½¬ä¸ºåˆ†é…å¯¹è±¡è€Œä¿ç•™çš„åŒºåŸŸ,å°±ç§°ä¸ºçº¿ç¨‹å±€éƒ¨ç¼“å†²åŒº(thread local area,TLA)ã€‚</p><p>ä¸ºäº†æ›´å¥½åœ°åˆ©ç”¨ç¼“å­˜,è¾¾åˆ°æ›´é«˜çš„æ€§èƒ½,ä¸€èˆ¬æƒ…å†µä¸‹,TLAçš„å¤§å°ä»‹äº16KBåˆ°128KBä¹‹é—´,å½“ç„¶,ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ˜¾å¼æŒ‡å®šã€‚<font color="DeepPink">å½“TLAè¢«å¡«æ»¡æ—¶,åƒåœ¾å›æ”¶å™¨ä¼šå°†TLAä¸­çš„å†…å®¹æå‡åˆ°å †ä¸­ã€‚å› æ­¤,å¯ä»¥å°†TLAçœ‹ä½œæ˜¯çº¿ç¨‹ä¸­çš„æ–°ç”Ÿä»£å†…å­˜ç©ºé—´</font>ã€‚</p><p>å½“Javaæºä»£ç ä¸­æœ‰newæ“ä½œç¬¦,å¹¶ä¸”JITç¼–è¯‘å™¨å¯¹å†…å­˜åˆ†é…æ‰§è¡Œé«˜çº§ä¼˜åŒ–ä¹‹å,å†…å­˜åˆ†é…çš„ä¼ªä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">object allocateNewobject(Class objectclass)&#123;</span><br><span class="line">Thread current getcurrentThread():</span><br><span class="line">int objectSize=alignedSize(objectclass)</span><br><span class="line">if(current.nextTLAOffset+objectSize&gt; TLA_SIZE)&#123;</span><br><span class="line">current.promoteTLAToHeap();//æ…¢,è€Œä¸”æ˜¯åŒæ­¥æ“ä½œ</span><br><span class="line">current.nextTLAOffset=0;</span><br><span class="line">&#125;</span><br><span class="line">Object ptr= current.TLAStart+current.nextTLAOffset:</span><br><span class="line">current.nextTLAOffset + objectSize;</span><br><span class="line">return ptr:</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸ºäº†è¯´æ˜å†…å­˜åˆ†é…é—®é¡Œ,åœ¨ä¸Šé¢çš„ä¼ªä»£ç ä¸­çœç•¥äº†å¾ˆå¤šå…¶ä»–å…³è”æ“ä½œã€‚ä¾‹å¦‚å¦‚æœå¾…åˆ†é…çš„å¯¹è±¡éå¸¸å¤§,è¶…è¿‡äº†æŸä¸ªé˜ˆå€¼,æˆ–å¯¹è±¡å¤ªå¤§å¯¼è‡´æ— æ³•å­˜æ”¾åœ¨TLAä¸­,åˆ™ä¼šç›´æ¥åœ¨å †ä¸­ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚</p></blockquote><h3 id="NUMAæ¶æ„"><a href="#NUMAæ¶æ„" class="headerlink" title="NUMAæ¶æ„"></a>NUMAæ¶æ„</h3><p>NUMA(non-uniform memory access,éç»Ÿä¸€å†…å­˜è®¿é—®æ¨¡å‹)æ¶æ„çš„å‡ºç°ä¸ºåƒåœ¾å›æ”¶å¸¦æ¥äº†æ›´å¤šæŒ‘æˆ˜ã€‚<font color="DeepPink">åœ¨NUMAæ¶æ„ä¸‹,ä¸åŒçš„å¤„ç†å™¨æ ¸å¿ƒé€šå¸¸è®¿é—®å„è‡ªçš„å†…å­˜åœ°å€ç©ºé—´,è¿™æ˜¯ä¸ºäº†é¿å…å› å¤šä¸ªCPUæ ¸å¿ƒè®¿é—®åŒä¸€å†…å­˜åœ°å€é€ æˆçš„æ€»çº¿å»¶è¿Ÿã€‚</font>æ¯ä¸ªCPUæ ¸å¿ƒéƒ½é…æœ‰ä¸“ç”¨çš„å†…å­˜å’Œæ€»çº¿å› æ­¤CPUæ ¸å¿ƒåœ¨è®¿é—®å…¶ä¸“æœ‰å†…å­˜æ—¶é€Ÿåº¦å¾ˆå¿«,è€Œè¦è®¿é—®ç›¸é‚»CPUæ ¸å¿ƒçš„å†…å­˜æ—¶å°±ä¼šç›¸å¯¹æ…¢äº›,CPUæ ¸å¿ƒç›¸è·è¶Šè¿œ,è®¿é—®é€Ÿåº¦è¶Šæ…¢(ä¹Ÿä¾èµ–äºå…·ä½“é…ç½®)ä¼ ç»Ÿä¸Š,å¤šæ ¸CPUæ˜¯æŒ‰ç…§UMA(uniform memory access,ç»Ÿä¸€å†…å­˜è®¿é—®æ¨¡å‹)æ¶æ„è¿è¡Œçš„,æ‰€æœ‰çš„CPUæ ¸å¿ƒæŒ‰ç…§ç»Ÿä¸€çš„æ¨¡å¼æ— å·®åˆ«åœ°è®¿é—®æ‰€æœ‰å†…å­˜ã€‚</p><p>ä¸ºäº†æ›´å¥½åœ°åˆ©ç”¨NUMAæ¶æ„,åƒåœ¾å›æ”¶å™¨çº¿ç¨‹çš„ç»„ç»‡ç»“æ„åº”è¯¥åšç›¸åº”çš„è°ƒæ•´ã€‚å¦‚æœæŸä¸ªCPUæ ¸å¿ƒæ­£åœ¨è¿è¡Œæ ‡è®°çº¿ç¨‹,é‚£ä¹ˆè¯¥çº¿ç¨‹æ‰€è¦è®¿é—®çš„é‚£éƒ¨åˆ†å †å†…å­˜æœ€å¥½èƒ½å¤Ÿæ”¾ç½®åœ¨è¯¥CPUçš„ä¸“æœ‰å†…å­˜ä¸­,è¿™æ ·æ‰èƒ½å‘æŒ¥NUMAæ¶æ„çš„æœ€å¤§å¨åŠ›ã€‚åœ¨æœ€åæƒ…å†µä¸‹,å¦‚æœæ ‡è®°çº¿ç¨‹æ‰€è¦è®¿é—®çš„å¯¹è±¡ä½äºå…¶ä»–NUMAèŠ‚ç‚¹çš„ä¸“æœ‰å†…å­˜ä¸­,è¿™æ—¶åƒåœ¾å›æ”¶å™¨é€šå¸¸éœ€è¦ä¸€ä¸ªå¯å‘å¼å¯¹è±¡ç§»åŠ¨ç®—æ³•ã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯ä½¿ç”¨æ—¶é—´ä¸Šç›¸è¿‘çš„å¯¹è±¡åœ¨å­˜å‚¨ä½ç½®ä¸Šä¹Ÿèƒ½ç›¸è¿‘,å¦‚æœè¿™ä¸ªç®—æ³•èƒ½å¤Ÿæ­£ç¡®å·¥ä½œ,è¿˜æ˜¯å¯ä»¥å¸¦æ¥ä¸å°çš„æ€§èƒ½æå‡çš„ã€‚è¿™é‡Œæ‰€é¢ä¸´çš„ä¸»è¦é—®é¢˜æ˜¯å¦‚ä½•é¿å…å¯¹è±¡åœ¨ä¸åŒNUMAèŠ‚ç‚¹çš„ä¸“æœ‰å†…å­˜ä¸­é‡å¤ç§»åŠ¨ã€‚ç†è®ºä¸Š,è‡ªé€‚åº”è¿è¡Œæ—¶ç³»ç»Ÿåº”è¯¥å¯ä»¥å¾ˆå¥½åœ°å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="å¤§å†…å­˜é¡µ"><a href="#å¤§å†…å­˜é¡µ" class="headerlink" title="å¤§å†…å­˜é¡µ"></a>å¤§å†…å­˜é¡µ</h3><p>å†…å­˜åˆ†é…æ˜¯é€šè¿‡æ“ä½œç³»ç»ŸåŠå…¶æ‰€ä½¿ç”¨çš„é¡µè¡¨å®Œæˆçš„ã€‚æ“ä½œç³»ç»Ÿå°†ç‰©ç†å†…å­˜åˆ’åˆ†æˆå¤šä¸ªé¡µæ¥ç®¡ç†,ä»æ“ä½œç³»ç»Ÿå±‚é¢è®²,é¡µæ˜¯å®é™…åˆ†é…å†…å­˜çš„æœ€å°å•ä½ã€‚ä¼ ç»Ÿä¸Š,é¡µçš„å¤§å°æ˜¯ä»¥4KBä¸ºåŸºæœ¬å•ä½åˆ’åˆ†çš„,é¡µæ“ä½œå¯¹è¿›ç¨‹æ¥è¯´æ˜¯é€æ˜çš„,è¿›ç¨‹æ‰€ä½¿ç”¨çš„æ˜¯è™šæ‹Ÿåœ°å€ç©ºé—´,å¹¶éçœŸæ­£çš„ç‰©ç†åœ°å€ã€‚ä¸ºäº†ä¾¿äºå°†è™šæ‹Ÿé¡µé¢è½¬æ¢ä¸ºå®é™…çš„ç‰©ç†å†…å­˜åœ°å€,å¯ä½¿ç”¨åä¸ºæ—è·¯è½¬æ¢ç¼“å†²(translation lookaside buffer,TLB)çš„ç¼“å­˜æ¥åŠ é€Ÿåœ°å€çš„è½¬æ¢æ“ä½œã€‚ä»å®ç°ä¸Šçœ‹,å¦‚æœé¡µé¢çš„å®¹é‡éå¸¸å°çš„è¯,ä¼šå¯¼è‡´é¢‘ç¹å‡ºç°æ—è·¯è½¬æ¢ç¼“å†²ä¸¢å¤±çš„æƒ…å†µã€‚</p><p>ä¿®å¤è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•å°±æ˜¯å°†é¡µé¢çš„å®¹é‡è°ƒå¤§å‡ ä¸ªæ•°é‡çº§,ä¾‹å¦‚ä»¥MBä¸ºåŸºæœ¬å•ä½ã€‚ç°ä»£æ“ä½œç³»ç»Ÿæ™®éå€¾å‘äºæ”¯æŒè¿™ç§å¤§å†…å­˜é¡µæœºåˆ¶ã€‚</p><p>å¾ˆæ˜æ˜¾,å½“å¤šä¸ªè¿›ç¨‹åˆ†åˆ«åœ¨å„è‡ªçš„å¯»å€ç©ºé—´ä¸­åˆ†é…å†…å­˜,è€Œé¡µé¢çš„å®¹é‡åˆæ¯”è¾ƒå¤§æ—¶,éšç€ä½¿ç”¨çš„é¡µé¢æ•°é‡è¶Šæ¥è¶Šå¤š,ç¢ç‰‡åŒ–çš„é—®é¢˜å°±æ„ˆå‘ä¸¥é‡,åƒè¿›ç¨‹è¦åˆ†é…çš„å†…å­˜æ¯”é¡µé¢å®¹é‡ç¨å¾®å¤§ä¸€ç‚¹çš„æƒ…å†µ,å°±ä¼šæµªè´¹å¾ˆå¤šå­˜å‚¨ç©ºé—´ã€‚å¯¹äºåœ¨è¿›ç¨‹å†…è‡ªå·±ç®¡ç†å†…å­˜åˆ†é…å›æ”¶ã€å¹¶æœ‰å¤§é‡å†…å­˜ç©ºé—´å¯ç”¨çš„è¿è¡Œæ—¶æ¥è¯´,è¿™ä¸ç®—ä»€ä¹ˆé—®é¢˜,å› ä¸ºè¿è¡Œæ—¶å¯ä»¥é€šè¿‡æŠ½è±¡å‡ºä¸åŒå¤§å°çš„è™šæ‹Ÿé¡µé¢æ¥è§£å†³ã€‚</p><blockquote><p>é€šå¸¸æƒ…å†µä¸‹,å¯¹äºé‚£äº›å†…å­˜åˆ†é…å’Œå›æ”¶é¢‘ç¹çš„åº”ç”¨ç¨‹åºæ¥è¯´,ä½¿ç”¨å¤§å†…å­˜é¡µå¯ä»¥ä½¿ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½è‡³å°‘æå‡10%ã€‚ JRockitå¯¹å¤§å†…å­˜é¡µæœ‰å¾ˆå¥½çš„æ”¯æŒã€‚</p></blockquote><h2 id="è¿‘å®æ—¶åƒåœ¾å›æ”¶"><a href="#è¿‘å®æ—¶åƒåœ¾å›æ”¶" class="headerlink" title="è¿‘å®æ—¶åƒåœ¾å›æ”¶"></a>è¿‘å®æ—¶åƒåœ¾å›æ”¶</h2><h3 id="JRockit-Real-Time"><a href="#JRockit-Real-Time" class="headerlink" title="JRockit Real Time"></a>JRockit Real Time</h3><p><font color="DeepPink">ä½å»¶è¿Ÿçš„ä»£ä»·æ˜¯åƒåœ¾å›æ”¶æ•´ä½“æ—¶é—´çš„å»¶é•¿</font>ã€‚ç›¸æ¯”äºå¹¶è¡Œåƒåœ¾å›æ”¶,åœ¨ç¨‹åºè¿è¡Œçš„åŒæ—¶å¹¶å‘åƒåœ¾å›æ”¶çš„éš¾åº¦æ›´å¤§,è€Œé¢‘ç¹ä¸­æ–­åƒåœ¾å›æ”¶åˆ™å¯èƒ½å¸¦æ¥æ›´å¤šçš„éº»çƒ¦ã€‚äº‹å®ä¸Š,è¿™å¹¶éä»€ä¹ˆå¤§é—®é¢˜,å› ä¸ºå¤§å¤šæ•°ä½¿ç”¨JRockit Real Timeçš„<font color="DeepPink">ç”¨æˆ·æ›´å…³å¿ƒç³»ç»Ÿçš„å¯é¢„æµ‹æ€§,è€Œä¸æ˜¯å‡å°‘åƒåœ¾å›æ”¶çš„æ€»ä½“æ—¶é—´ã€‚å¤§å¤šæ•°ç”¨æˆ·è®¤ä¸ºæš‚åœæ—¶é—´çš„çªç„¶å¢é•¿æ¯”åƒåœ¾å›æ”¶æ€»ä½“æ—¶é—´çš„å»¶é•¿æ›´å…·å±å®³æ€§</font>ã€‚</p><h4 id="è½¯å®æ—¶çš„æœ‰æ•ˆæ€§"><a href="#è½¯å®æ—¶çš„æœ‰æ•ˆæ€§" class="headerlink" title="è½¯å®æ—¶çš„æœ‰æ•ˆæ€§"></a>è½¯å®æ—¶çš„æœ‰æ•ˆæ€§</h4><p>è½¯å®æ—¶æ˜¯JRockit Real Timeçš„æ ¸å¿ƒæœºåˆ¶ã€‚ä½†<font color="DeepPink">éç¡®å®šæ€§ç³»ç»Ÿå¦‚ä½•æä¾›æŒ‡å®šç¨‹åº¦çš„ç¡®å®šæ€§,ä¾‹å¦‚åƒåƒåœ¾å›æ”¶å™¨è¿™æ ·çš„ç³»ç»Ÿå¦‚ä½•ä¿è¯åº”ç”¨ç¨‹åºçš„æš‚åœæ—¶é—´ä¸ä¼šè¶…è¿‡æŸä¸ªé˜ˆå€¼?ä¸¥æ ¼æ¥è¯´,æ— æ³•æä¾›è¿™æ ·çš„ä¿è¯</font>,ä½†ç”±äºè¿™æ ·çš„æç«¯æ¡ˆä¾‹å¾ˆå°‘,æ‰€ä»¥ä¹Ÿå°±æ— å…³ç´§è¦äº†ã€‚</p><p>å½“ç„¶,æ²¡æœ‰ä»€ä¹ˆä¸‡å…¨ä¹‹ç­–,ç¡®å®å­˜åœ¨æ— æ³•ä¿è¯æš‚åœæ—¶é—´çš„åœºæ™¯ã€‚ä½†å®è·µè¯æ˜,å¯¹äºé‚£äº›å †ä¸­å­˜æ´»å¯¹è±¡çº¦å 30%-50%çš„åº”ç”¨ç¨‹åºæ¥è¯´, JRockit Real Timeçš„è¡¨ç°å¯ä»¥æ»¡è¶³æœåŠ¡éœ€è¦,è€Œä¸”éšç€JRockit Real Timeå„ä¸ªç‰ˆæœ¬çš„å‘è¡Œ,30%-50%è¿™ä¸ªé˜ˆå€¼åœ¨ä¸æ–­æå‡,å¯æ”¯æŒçš„æš‚åœæ—¶é—´é˜ˆå€¼åˆ™ä¸æ–­é™ä½ã€‚</p><h4 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h4><ul><li>é«˜æ•ˆçš„å¹¶è¡Œæ‰§è¡Œ</li><li>ç»†åˆ†åƒåœ¾å›æ”¶è¿‡ç¨‹,å°†ä¹‹å˜æˆå‡ ä¸ªå¯å›æ»šã€å¯ä¸­æ–­çš„å­ä»»åŠ¡(work packet)</li><li>é«˜æ•ˆçš„å¯å‘å¼ç®—æ³•</li></ul><p><font color="DeepPink">äº‹å®ä¸Š,å®ç°ä½å»¶è¿Ÿçš„å…³é”®ä»æ˜¯å°½å¯èƒ½å¤šè®©Javaåº”ç”¨ç¨‹åºè¿è¡Œ,ä¿æŒå †çš„ä½¿ç”¨ç‡å’Œç¢ç‰‡åŒ–ç¨‹åº¦åœ¨ä¸€ä¸ªè¾ƒä½çš„æ°´å¹³</font>ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Š, JRockit Real Timeä½¿ç”¨çš„æ˜¯è´ªå¿ƒç­–ç•¥,å³å°½å¯èƒ½æ¨è¿ŸSTWå¼çš„åƒåœ¾å›æ”¶æ“ä½œ,å¸Œæœ›é—®é¢˜èƒ½å¤Ÿç”±åº”ç”¨ç¨‹åºè‡ªèº«è§£å†³,æˆ–è€…èƒ½å¤Ÿå‡å°‘ä¸å¾—ä¸æ‰§è¡ŒSTWå¼æ“ä½œçš„æƒ…å†µ,æœ€å¥½åœ¨å…·ä½“æ‰§è¡Œçš„æ—¶å€™éœ€è¦å¤„ç†çš„å¯¹è±¡ä¹Ÿå°½å¯èƒ½å°‘ä¸€äº›ã€‚</p><p>JRockit Real Timeä¸­,åƒåœ¾å›æ”¶å™¨çš„å·¥ä½œè¢«åˆ’åˆ†ä¸ºå‡ ä¸ªå­ä»»åŠ¡ã€‚å¦‚æœåœ¨æ‰§è¡Œå…¶ä¸­æŸä¸ªå­ä»»åŠ¡æ—¶(ä¾‹å¦‚æ•´ç†å †ä¸­çš„æŸä¸€éƒ¨åˆ†å†…å­˜),åº”ç”¨ç¨‹åºçš„æš‚åœæ—¶é—´è¶…è¿‡äº†é˜ˆå€¼,é‚£ä¹ˆå°±æ”¾å¼ƒè¯¥å­ä»»åŠ¡æ¢å¤åº”ç”¨ç¨‹åºçš„æ‰§è¡Œã€‚ç”¨æˆ·æ ¹æ®ä¸šåŠ¡éœ€è¦æŒ‡å®šå¯ç”¨äºå®Œæˆåƒåœ¾å›æ”¶çš„æ€»ä½“æ—¶é—´,æœ‰äº›æ—¶å€™,æŸäº›å­ä»»åŠ¡å·²ç»å®Œæˆ,ä½†æ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´å®Œæˆæ•´ä¸ªåƒåœ¾å›æ”¶å·¥ä½œ,è¿™æ—¶ä¸ºäº†ä¿è¯åº”ç”¨ç¨‹åºçš„è¿è¡Œ,ä¸å¾—ä¸åºŸå¼ƒè¿˜æœªå®Œæˆçš„å­ä»»åŠ¡,å¾…åˆ°ä¸‹æ¬¡åƒåœ¾å›æ”¶çš„æ—¶å€™å†é‡æ–°æ‰§è¡Œ,æŒ‡å®šçš„å“åº”æ—¶é—´è¶ŠçŸ­,åˆ™åºŸå¼ƒçš„å­ä»»åŠ¡å¯èƒ½è¶Šå¤šã€‚</p><p>å‰é¢ä»‹ç»è¿‡çš„æ ‡è®°é˜¶æ®µçš„å·¥ä½œæ¯”è¾ƒå®¹æ˜“è°ƒæ•´,å¯ä»¥ä¸åº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚ä½†æ¸…ç†å’Œæ•´ç†é˜¶æ®µåˆ™éœ€è¦æš‚åœåº”ç”¨ç¨‹åºçº¿ç¨‹(STW)ã€‚å¹¸è¿çš„æ˜¯,æ ‡è®°é˜¶æ®µä¼šå åˆ°åƒåœ¾å›æ”¶æ€»ä½“æ—¶é—´çš„90%ã€‚å¦‚æœæš‚åœåº”ç”¨ç¨‹åºçš„æ—¶é—´è¿‡é•¿,åˆ™ä¸å¾—ä¸ç»ˆæ­¢å½“å‰åƒåœ¾å›æ”¶ä»»åŠ¡,é‡æ–°å¹¶å‘æ‰§è¡Œ,æœŸæœ›é—®é¢˜å¯ä»¥è‡ªåŠ¨è§£å†³ã€‚ä¹‹æ‰€ä»¥å°†åƒåœ¾å›æ”¶åˆ’åˆ†ä¸ºå‡ ä¸ªå­ä»»åŠ¡å°±æ˜¯ä¸ºäº†ä¾¿äºè¿™ä¸€ç›®æ ‡çš„å®ç°ã€‚</p><h2 id="å†…å­˜æ“ä½œç›¸å…³API"><a href="#å†…å­˜æ“ä½œç›¸å…³API" class="headerlink" title="å†…å­˜æ“ä½œç›¸å…³API"></a>å†…å­˜æ“ä½œç›¸å…³API</h2><h3 id="ææ„æ–¹æ³•"><a href="#ææ„æ–¹æ³•" class="headerlink" title="ææ„æ–¹æ³•"></a>ææ„æ–¹æ³•</h3><blockquote><p>Javaä¸­çš„ææ„å‡½æ•°çš„è®¾è®¡å°±æ˜¯ä¸€ä¸ªå¤±è¯¯,åº”é¿å…ä½¿ç”¨ã€‚</p></blockquote><p>è¿™ä¸ä»…ä»…æ˜¯æˆ‘ä»¬çš„æ„è§,ä¹Ÿæ˜¯Javaç¤¾åŒºçš„ä¸€è‡´æ„è§ã€‚</p><h3 id="JVMçš„è¡Œä¸ºå·®å¼‚"><a href="#JVMçš„è¡Œä¸ºå·®å¼‚" class="headerlink" title="JVMçš„è¡Œä¸ºå·®å¼‚"></a>JVMçš„è¡Œä¸ºå·®å¼‚</h3><p>å¯¹äºJVMæ¥è¯´,ä¸€å®šè°¨è®°,ç¼–ç¨‹è¯­è¨€åªèƒ½æé†’åƒåœ¾å›æ”¶å™¨å·¥ä½œã€‚å°±Javaè€Œè¨€,åœ¨è®¾è®¡ä¸Šå®ƒæœ¬èº«å¹¶ä¸èƒ½ç²¾ç¡®æ§åˆ¶å†…å­˜ç³»ç»Ÿã€‚ä¾‹å¦‚,å‡è®¾ä¸¤ä¸ªâ…£Må‚å•†æ‰€å®ç°è½¯å¼•ç”¨åœ¨ç¼“å­˜ä¸­å…·æœ‰ç›¸åŒçš„å­˜æ´»æ—¶é—´,è¿™æœ¬å°±æ˜¯ä¸åˆ‡å®é™…çš„ã€‚</p><p>å¦å¤–ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¤§é‡ç”¨æˆ·å¯¹System.gc()æ–¹æ³•çš„é”™è¯¯ä½¿ç”¨ã€‚<font color="DeepPink">System.gc()æ–¹æ³•ä»…ä»…æ˜¯æé†’è¿è¡Œæ—¶â€œç°åœ¨å¯ä»¥åšåƒåœ¾å›æ”¶äº†â€ã€‚åœ¨æŸäº›JVMå®ç°ä¸­,é¢‘ç¹è°ƒç”¨è¯¥æ–¹æ³•å¯¼è‡´äº†é¢‘ç¹çš„åƒåœ¾å›æ”¶æ“ä½œ,è€Œåœ¨æŸäº›JVMå®ç°ä¸­,å¤§éƒ¨åˆ†æ—¶é—´å¿½ç•¥äº†è¯¥è°ƒç”¨ã€‚</font></p><p>æˆ‘è¿‡å»ä»»èŒä¸ºæ€§èƒ½é¡¾é—®æœŸé—´,å¤šæ¬¡çœ‹åˆ°è¯¥æ–¹æ³•è¢«æ»¥ç”¨ã€‚å¾ˆå¤šæ—¶å€™,åªæ˜¯å»æ‰å¯¹ System.gcæ–¹æ³•çš„å‡ æ¬¡è°ƒç”¨å°±å¯ä»¥å¤§å¹…æå‡æ€§èƒ½,è¿™ä¹Ÿæ˜¯ JRockä¸­ä¼šæœ‰å‘½ä»¤è¡Œå‚æ•°-xx:AllowSystemGC=Falseæ¥ç¦ç”¨System,gcæ–¹æ³•çš„åŸå› ã€‚</p><h2 id="é™·é˜±ä¸ä¼ªä¼˜åŒ–"><a href="#é™·é˜±ä¸ä¼ªä¼˜åŒ–" class="headerlink" title="é™·é˜±ä¸ä¼ªä¼˜åŒ–"></a>é™·é˜±ä¸ä¼ªä¼˜åŒ–</h2><p>éƒ¨åˆ†å¼€å‘äººå‘˜åœ¨å†™ä»£ç æ—¶,æœ‰æ—¶ä¼šå†™ä¸€äº›â€œç»è¿‡ä¼˜åŒ–çš„â€çš„ä»£ç ,æœŸæœ›å¯ä»¥å¸®åŠ©å®Œæˆåƒåœ¾å›æ”¶çš„å·¥ä½œ,ä½†å®é™…ä¸Š,è¿™åªæ˜¯ä»–ä»¬çš„é”™è§‰ã€‚è®°ä½,è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æºã€‚å°±Javaæ¥è¯´,å¾ˆéš¾åœ¨è¯­è¨€å±‚é¢æ§åˆ¶åƒåœ¾å›æ”¶çš„è¡Œä¸ºã€‚è¿™é‡Œçš„ä¸»è¦é—®é¢˜æ—¶,å¼€å‘äººå‘˜è¯¯ä»¥ä¸ºåƒåœ¾å›æ”¶å™¨æœ‰å›ºå®šçš„è¿è¡Œæ¨¡å¼,å¹¶å¦„å›¾å»æ§åˆ¶å®ƒã€‚</p><p>é™¤äº†åƒåœ¾å›æ”¶å¤–,å¯¹è±¡æ± (object poll)ä¹Ÿæ˜¯Javaä¸­å¸¸è§çš„ä¼ªä¼˜åŒ–(false optimization)ã€‚æœ‰äººè®¤ä¸º,ä¿ç•™ä¸€ä¸ªå­˜æ´»å¯¹è±¡æ± æ¥é‡æ–°ä½¿ç”¨å·²åˆ›å»ºçš„å¯¹è±¡å¯ä»¥æå‡åƒåœ¾å›æ”¶çš„æ€§èƒ½,ä½†å®é™…ä¸Š,å¯¹è±¡æ± ä¸ä»…å¢åŠ äº†åº”ç”¨ç¨‹åºçš„å¤æ‚åº¦,è¿˜å¾ˆå®¹æ˜“å‡ºé”™ã€‚å¯¹äºç°ä»£åƒåœ¾æ”¶é›†å™¨æ¥è¯´,ä½¿ç”¨java.lang.ref.Referenceç³»åˆ—ç±»å®ç°ç¼“å­˜,æˆ–è€…ç›´æ¥å°†æ— ç”¨å¯¹è±¡çš„å¼•ç”¨ç½®ä¸ºnullå°±å¥½äº†,ä¸ç”¨å¤šæ“å¿ƒã€‚</p><p>äº‹å®ä¸Š,åŸºäºç°ä»£VM,å¦‚æœèƒ½å¤Ÿåˆç†åˆ©ç”¨ä¹¦æœ¬ä¸Šçš„æŠ€å·§,ä¾‹å¦‚æ­£ç¡®ä½¿ç”¨java.lang.ref.Referenceç³»åˆ—ç±»,æ³¨æ„Javaçš„åŠ¨æ€ç‰¹æ€§,å®Œå…¨å¯ä»¥å†™å‡ºè¿è¡Œè‰¯å¥½çš„åº”ç”¨ç¨‹åºã€‚<font color="DeepPink">å¦‚æœåº”ç”¨ç¨‹åºçœŸçš„æœ‰å®æ—¶æ€§è¦æ±‚,é‚£ä¹ˆä¸€å¼€å§‹å°±ä¸è¯¥ç”¨Javaç¼–å†™,è€Œåº”è¯¥ä½¿ç”¨é‚£äº›ç”±ç¨‹åºå‘˜æ‰‹åŠ¨æ§åˆ¶å†…å­˜çš„é™æ€ç¼–ç¨‹è¯­è¨€æ¥å®ç°åº”ç”¨ç¨‹åºã€‚</font></p><h2 id="JRockitä¸­çš„å†…å­˜ç®¡ç†"><a href="#JRockitä¸­çš„å†…å­˜ç®¡ç†" class="headerlink" title="JRockitä¸­çš„å†…å­˜ç®¡ç†"></a>JRockitä¸­çš„å†…å­˜ç®¡ç†</h2><p><font color="DeepPink">éœ€è¦æ³¨æ„çš„æ˜¯,èŠ±å¤§åŠ›æ°”é¼“æ£JVMå‚æ•°å¹¶ä¸ä¸€å®šä¼šä½¿åº”ç”¨ç¨‹åºæ€§èƒ½æœ‰å¤šä¹ˆå¤§çš„æå‡,è€Œä¸”åè€Œå¯èƒ½ä¼šå¹²æ‰°JVMçš„æ­£å¸¸è¿è¡Œã€‚</font></p><h1 id="çº¿ç¨‹ä¸åŒæ­¥"><a href="#çº¿ç¨‹ä¸åŒæ­¥" class="headerlink" title="çº¿ç¨‹ä¸åŒæ­¥"></a>çº¿ç¨‹ä¸åŒæ­¥</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>æ¯ä¸ªå¯¹è±¡éƒ½æŒæœ‰ä¸åŒæ­¥æ“ä½œç›¸å…³çš„ä¿¡æ¯,ä¾‹å¦‚å½“å‰å¯¹è±¡æ˜¯å¦ä½œä¸ºé”ä½¿ç”¨,ä»¥åŠé”çš„å…·ä½“å®ç°ç­‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹,ä¸ºäº†ä¾¿äºå¿«é€Ÿè®¿é—®,è¿™äº›ä¿¡æ¯è¢«ä¿å­˜åœ¨æ¯ä¸ªå¯¹è±¡çš„å¯¹è±¡å¤´çš„é”å­—(lock word)ä¸­ã€‚JRockitä½¿ç”¨é”å­—ä¸­çš„ä¸€äº›ä½æ¥å­˜å‚¨åƒåœ¾å›æ”¶çŠ¶æ€ä¿¡æ¯,è™½ç„¶å…¶ä¸­åŒ…å«äº†åƒåœ¾å›æ”¶ä¿¡æ¯,ä½†æ˜¯æœ¬ä¹¦è¿˜æ˜¯ç§°ä¹‹ä¸ºé”å­—ã€‚</p><p>å¯¹è±¡å¤´è¿˜åŒ…å«äº†æŒ‡å‘ç±»å‹ä¿¡æ¯çš„æŒ‡é’ˆ,åœ¨ JRockitä¸­,è¿™ç§°ä¸ºç±»å—(class block)ä¸‹å›¾æ˜¯ JRockitä¸­Javaå¯¹è±¡åœ¨ä¸åŒçš„CPUå¹³å°ä¸Šçš„å†…å­˜å¸ƒå±€ã€‚ä¸ºäº†èŠ‚çœå†…å­˜,å¹¶åŠ é€Ÿè§£å¼•ç”¨æ“ä½œ,å¯¹è±¡å¤´ä¸­æ‰€æœ‰å­—çš„é•¿åº¦æ˜¯32ä½ã€‚ç±»å—æ˜¯ä¸€ä¸ª32ä½çš„æŒ‡é’ˆ,æŒ‡å‘å¦ä¸€ä¸ªå¤–éƒ¨ç»“æ„,è¯¥ç»“æ„åŒ…å«äº†å½“å‰å¯¹è±¡çš„ç±»å‹ä¿¡æ¯å’Œè™šåˆ†æ´¾è¡¨(virtual dispatch table)ç­‰ä¿¡æ¯ã€‚</p><p><img alt data-src="/images/java-jrockit-note/%E5%AF%B9%E8%B1%A1%E5%A4%B4%E5%B8%83%E5%B1%80.png"><br>å°±ç›®å‰æ¥çœ‹,åœ¨ç»å¤§éƒ¨åˆ†JVM(åŒ…æ‹¬JRockit)ä¸­,å¯¹è±¡å¤´æ˜¯ä½¿ç”¨ä¸¤ä¸ª32ä½é•¿çš„å­—æ¥è¡¨ç¤ºçš„ã€‚åœ¨JRockitä¸­,åç§»ä¸º0çš„å¯¹è±¡æŒ‡é’ˆæŒ‡å‘å½“å‰å¯¹è±¡çš„ç±»å‹ä¿¡æ¯,æ¥ä¸‹æ¥æ˜¯4å­—èŠ‚çš„é”å­—ã€‚åœ¨SPARCå¹³å°ä¸Š,å¯¹è±¡å¤´çš„å¸ƒå±€åˆšå¥½åè¿‡æ¥,å› ä¸ºåœ¨ä½¿ç”¨åŸå­æŒ‡ä»¤æ“ä½œæŒ‡é’ˆæ—¶,å¦‚æœæ²¡æœ‰åç§»çš„è¯,æ•ˆç‡ä¼šæ›´é«˜ã€‚ä¸é”å­—ä¸åŒ,ç±»å—å¹¶ä¸ä¸ºåŸå­æ“ä½œæ‰€ä½¿ç”¨,å› æ­¤åœ¨SPARCå¹³å°ä¸Š,ç±»å—è¢«æ”¾åœ¨é”å­—åé¢ã€‚</p><blockquote><p>åŸå­æ“ä½œ(atomic operation)æ˜¯æŒ‡å…¨éƒ¨æ‰§è¡Œæˆ–å…¨éƒ¨ä¸æ‰§è¡Œçš„æœ¬åœ°æŒ‡ä»¤ã€‚å½“åŸå­æŒ‡ä»¤å…¨éƒ¨æ‰§è¡Œæ—¶,å…¶æ“ä½œç»“æœéœ€è¦å¯¹æ‰€æœ‰æ½œåœ¨è®¿é—®è€…å¯è§ã€‚</p></blockquote><p><font color="DeepPink">åŸå­æ“ä½œç”¨äºè¯»å†™é”å­—,å…·æœ‰æ’ä»–æ€§,è¿™æ˜¯å®ç°JVMä¸­åŒæ­¥å—çš„åŸºç¡€ã€‚</font></p><h3 id="éš¾ä»¥è°ƒè¯•"><a href="#éš¾ä»¥è°ƒè¯•" class="headerlink" title="éš¾ä»¥è°ƒè¯•"></a>éš¾ä»¥è°ƒè¯•</h3><blockquote><p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾è‡ªå·±æ‰€éœ€çš„èµ„æº,ç»“æœå¯¼è‡´ä¸¤ä¸ªçº¿ç¨‹éƒ½è¿›å…¥ä¼‘çœ çŠ¶æ€ã€‚å¾ˆæ˜æ˜¾,å®ƒä»¬å†ä¹Ÿé†’ä¸è¿‡æ¥äº†ã€‚æ´»é”çš„æ¦‚å¿µä¸æ­»é”ç±»ä¼¼,åŒºåˆ«åœ¨äºçº¿ç¨‹åœ¨ç«Ÿäº‰æ—¶ä¼šé‡‡å–ä¸»åŠ¨æ“ä½œ,ä½†æ— æ³•è·å–é”ã€‚è¿™å°±åƒä¸¤ä¸ªäººé¢å¯¹é¢å‰è¿›,åœ¨ä¸€ä¸ªå¾ˆçª„çš„èµ°å»Šç›¸é‡,ä¸ºäº†èƒ½ç»§ç»­å‰è¿›,ä»–ä»¬éƒ½å‘ä¾§é¢ç§»åŠ¨,ä½†ç”±äºç§»åŠ¨çš„æ–¹å‘ç›¸åå¯¼è‡´è¿˜æ˜¯æ— æ³•å‰è¿›ã€‚</p></blockquote><h2 id="Java-API"><a href="#Java-API" class="headerlink" title="Java API"></a>Java API</h2><h3 id="synchronizedå…³é”®å­—"><a href="#synchronizedå…³é”®å­—" class="headerlink" title="synchronizedå…³é”®å­—"></a>synchronizedå…³é”®å­—</h3><p>åœ¨Javaä¸­,å…³é”®å­—synchronizedç”¨äºå®šä¹‰ä¸€ä¸ªä¸´ç•ŒåŒº,æ—¢å¯ä»¥æ˜¯ä¸€æ®µä»£ç å—,ä¹Ÿå¯ä»¥æ˜¯ä¸ªå®Œæ•´çš„æ–¹æ³•,å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public synchronized void setGadget(Gadget g)&#123;</span><br><span class="line">this.gadget = g;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•å®šä¹‰ä¸­åŒ…å«synchronizedå…³é”®å­—,å› æ­¤æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ç»™å®šå¯¹è±¡çš„gadgetåŸŸã€‚</p><p><font color="DeepPink">åœ¨åŒæ­¥æ–¹æ³•ä¸­,ç›‘è§†å™¨å¯¹è±¡æ˜¯éšå¼çš„,å³å½“å‰å¯¹è±¡this,è€Œå¯¹é™æ€åŒæ­¥æ–¹æ³•æ¥è¯´,ç›‘è§†å™¨å¯¹è±¡æ˜¯å½“å‰å¯¹è±¡çš„ç±»å¯¹è±¡ã€‚</font>ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸ä¸‹é¢çš„ä»£ç æ˜¯ç­‰æ•ˆçš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public void setGadget(Gadget g)&#123;</span><br><span class="line">synchronized(this)&#123;</span><br><span class="line">this.gadget = g;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="java-lang-Threadç±»"><a href="#java-lang-Threadç±»" class="headerlink" title="java.lang.Threadç±»"></a>java.lang.Threadç±»</h3><p>Javaä¸­çš„çº¿ç¨‹ä¹Ÿæœ‰ä¼˜å…ˆçº§æ¦‚å¿µ,ä½†æ˜¯å¦çœŸçš„èµ·ä½œç”¨å–å†³äºJVMçš„å…·ä½“å®ç°ã€‚setPriorityæ–¹æ³•ç”¨äºè®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§,æç¤ºJVMè¯¥çº¿ç¨‹æ›´åŠ é‡è¦æˆ–ä¸æ€ä¹ˆé‡è¦ã€‚å½“ç„¶,å¯¹äºå¤§å¤šæ•°JVMæ¥è¯´,æ˜¾å¼åœ°ä¿®æ”¹çº¿ç¨‹ä¼˜å…ˆçº§æ²¡ä»€ä¹ˆå¤§å¸®åŠ©ã€‚å½“è¿è¡Œæ—¶â€œæœ‰æ›´å¥½çš„æ–¹æ¡ˆâ€æ—¶, JRockit JVMç”šè‡³ä¼šå¿½ç•¥Javaçº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚</p><p>æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å¯ä»¥é€šè¿‡è°ƒç”¨yieldæ–¹æ³•ä¸»åŠ¨æ”¾å¼ƒå‰©ä½™çš„æ—¶é—´ç‰‡,ä»¥ä¾¿å…¶ä»–çº¿ç¨‹è¿è¡Œ,è‡ªèº«ä¼‘çœ (è°ƒç”¨waitæ–¹æ³•)æˆ–ç­‰å¾…å…¶ä»–çº¿ç¨‹ç»“æŸå†è¿è¡Œ(è°ƒç”¨joinæ–¹æ³•)ã€‚</p><h3 id="volatile-å…³é”®å­—"><a href="#volatile-å…³é”®å­—" class="headerlink" title="volatile å…³é”®å­—"></a>volatile å…³é”®å­—</h3><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹,å¯¹æŸä¸ªå±æ€§åŸŸæˆ–å†…å­˜åœ°å€è¿›è¡Œå†™æ“ä½œå,å…¶ä»–æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æœªå¿…èƒ½ç«‹å³çœ‹åˆ°è¿™ä¸ªç»“æœã€‚åœ¨æŸäº›åœºæ™¯ä¸­,è¦æ±‚æ‰€æœ‰çº¿ç¨‹åœ¨æ‰§è¡Œæ—¶éœ€è¦å¾—çŸ¥æŸä¸ªå±æ€§æœ€æ–°çš„å€¼,ä¸ºæ­¤,Javaæä¾›äº†å…³é”®å­—volatileæ¥è§£å†³æ­¤é—®é¢˜ã€‚</p><p><font color="DeepPink">ä½¿ç”¨volatileä¿®é¥°å±æ€§å,å¯ä»¥ä¿è¯å¯¹è¯¥å±æ€§åŸŸçš„å†™æ“ä½œä¼šç›´æ¥ä½œç”¨åˆ°å†…å­˜ä¸­ã€‚åŸæœ¬,æ•°æ®æ“ä½œä»…ä»…å°†æ•°æ®å†™åˆ°CPUç¼“å­˜ä¸­,è¿‡ä¸€ä¼šå†å†™åˆ°å†…å­˜ä¸­,æ­£å› å¦‚æ­¤,åœ¨åŒä¸€ä¸ªå±æ€§åŸŸä¸Š,ä¸åŒçš„çº¿ç¨‹å¯èƒ½çœ‹åˆ°ä¸åŒçš„å€¼ã€‚ç›®å‰,JVMåœ¨å®ç°volatileå…³é”®å­—æ—¶,æ˜¯é€šè¿‡åœ¨å†™å±æ€§æ“ä½œåæ’å…¥å†…å­˜å±éšœä»£ç æ¥å®ç°çš„,åªä¸è¿‡è¿™ç§æ–¹æ³•æœ‰ä¸€ç‚¹æ€§èƒ½æŸè€—ã€‚</font></p><p>äººä»¬å¸¸å¸¸éš¾ä»¥ç†è§£â€œä¸ºä»€ä¹ˆä¸åŒçš„çº¿ç¨‹ä¼šåœ¨åŒä¸€ä¸ªå±æ€§åŸŸä¸Šçœ‹åˆ°ä¸åŒçš„å€¼â€ã€‚<font color="DeepPink">ä¸€èˆ¬æ¥è¯´,ç›®å‰çš„æœºå™¨çš„å†…å­˜æ¨¡å‹å·²ç»è¶³å¤Ÿå¼º,æˆ–è€…åº”ç”¨ç¨‹åºçš„æœ¬èº«ç»“æ„å°±ä¸å®¹æ˜“ä½¿évolatileå±æ€§å‡ºç°è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯,è€ƒè™‘åˆ°JITä¼˜åŒ–ç¼–è¯‘å™¨å¯èƒ½ä¼šå¯¹ç¨‹åºåšè¾ƒå¤§æ”¹åŠ¨,å¦‚æœå¼€å‘äººå‘˜ä¸ç•™å¿ƒçš„è¯,è¿˜æ˜¯ä¼šå‡ºç°é—®é¢˜çš„ã€‚</font>ä¸‹é¢çš„ç¤ºä¾‹ä»£ç è§£é‡Šäº†åœ¨Javaç¨‹åºä¸­,ä¸ºä»€ä¹ˆå†…å­˜è¯­ä¹‰å¦‚æ­¤é‡è¦,å°¤å…¶æ˜¯å½“é—®é¢˜è¿˜æ²¡è¡¨ç°å‡ºæ¥çš„æ—¶å€™ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class My Thread extends Thread&#123;</span><br><span class="line">private volatile boolean finished;</span><br><span class="line">public void run()&#123;</span><br><span class="line">while(!finished)&#123;</span><br><span class="line">   //</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">public void signalDone()&#123;</span><br><span class="line">this.finished = true</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå®šä¹‰å˜é‡finishedæ—¶æ²¡æœ‰åŠ ä¸Švolatileå…³é”®å­—,é‚£ä¹ˆåœ¨ç†è®ºä¸Š,JITç¼–è¯‘å™¨åœ¨ä¼˜åŒ–æ—¶,å¯èƒ½ä¼šå°†ä¹‹ä¿®æ”¹ä¸ºåªåœ¨å¾ªç¯å¼€å§‹å‰åŠ è½½ä¸€æ¬¡finishedçš„å€¼,ä½†è¿™å°±æ”¹å˜äº†ä»£ç åŸæœ¬çš„å«ä¹‰å¦‚æœfinishedçš„å€¼æ˜¯false,é‚£ä¹ˆç¨‹åºå°±ä¼šé™·å…¥æ— é™å¾ªç¯,å³ä½¿å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†signalDoneæ–¹æ³•ä¹Ÿæ²¡ç”¨ã€‚<font color="DeepPink">Javaè¯­è¨€è§„èŒƒæŒ‡æ˜,å¦‚æœç¼–è¯‘å™¨è®¤ä¸ºåˆé€‚çš„è¯,å¯ä»¥ä¸ºé volatileå˜é‡åœ¨çº¿ç¨‹å†…åˆ›å»ºå‰¯æœ¬ä»¥ä¾¿åç»­ä½¿ç”¨ã€‚</font></p><blockquote><p>ç”±äºä¸€èˆ¬ä¼šä½¿ç”¨å†…å­˜å±éšœæ¥å®ç°volatileå…³é”®å­—çš„è¯­ä¹‰,ä¼šå¯¼è‡´CPUç¼“å­˜å¤±æ•ˆ,é™ä½åº”ç”¨ç¨‹åºæ•´ä½“æ€§èƒ½,ä½¿ç”¨çš„æ—¶å€™è¦è°¨æ…ã€‚</p></blockquote><h2 id="Javaä¸­çº¿ç¨‹ä¸åŒæ­¥æœºåˆ¶çš„å®ç°"><a href="#Javaä¸­çº¿ç¨‹ä¸åŒæ­¥æœºåˆ¶çš„å®ç°" class="headerlink" title="Javaä¸­çº¿ç¨‹ä¸åŒæ­¥æœºåˆ¶çš„å®ç°"></a>Javaä¸­çº¿ç¨‹ä¸åŒæ­¥æœºåˆ¶çš„å®ç°</h2><h3 id="Javaå†…å­˜æ¨¡å‹"><a href="#Javaå†…å­˜æ¨¡å‹" class="headerlink" title="Javaå†…å­˜æ¨¡å‹"></a>Javaå†…å­˜æ¨¡å‹</h3><p>ç°åœ¨CPUæ¶æ„ä¸­,æ™®éä½¿ç”¨äº†æ•°æ®ç¼“å­˜æœºåˆ¶ä»¥å¤§å¹…æå‡CPUå¯¹æ•°æ®çš„è¯»å†™é€Ÿåº¦,å‡è½»å¤„ç†å™¨æ€»çº¿çš„ç«äº‰ç¨‹åº¦ã€‚æ­£å¦‚æ‰€æœ‰çš„ç¼“å­˜ç³»ç»Ÿä¸€æ ·,è¿™é‡Œä¹Ÿå­˜åœ¨ä¸€è‡´æ€§é—®é¢˜,å¯¹äºå¤šå¤„ç†å™¨ç³»ç»Ÿæ¥è¯´å°¤å…¶é‡è¦,å› ä¸ºå¤šä¸ªå¤„ç†å™¨æœ‰å¯èƒ½åŒæ—¶è®¿é—®å†…å­˜ä¸­åŒä¸€ä½ç½®çš„æ•°æ®å†…å­˜æ¨¡å‹å®šä¹‰äº†ä¸åŒçš„CPU,åœ¨åŒæ—¶è®¿é—®å†…å­˜ä¸­åŒä¸€ä½ç½®æ—¶,æ˜¯å¦ä¼šçœ‹åˆ°ç›¸åŒçš„å€¼çš„æƒ…å†µã€‚</p><p>å¼ºå†…å­˜æ¨¡å‹(ä¾‹å¦‚x86å¹³å°)æ˜¯æŒ‡,å½“æŸä¸ªCPUä¿®æ”¹äº†æŸä¸ªå†…å­˜ä½ç½®çš„å€¼å,å…¶ä»–çš„CPUå‡ ä¹è‡ªåŠ¨å°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªåˆšåˆšä¿å­˜çš„å€¼ã€‚åœ¨è¿™ç§å†…å­˜æ¨¡å‹ä¹‹ä¸‹,å†…å­˜å†™æ“ä½œçš„æ‰§è¡Œé¡ºåºä¸ä»£ç ä¸­çš„æ’åˆ—é¡ºåºç›¸åŒã€‚å¼±å†…å­˜æ¨¡å‹(ä¾‹å¦‚IA-64å¹³å°)æ˜¯æŒ‡,å½“æŸä¸ªCPUä¿®æ”¹äº†æŸä¸ªå†…å­˜ä½ç½®çš„å€¼åå…¶ä»–çš„CPUä¸ä¸€å®šå¯ä»¥çœ‹åˆ°è¿™ä¸ªåˆšåˆšä¿å­˜çš„å€¼(é™¤éCPUåœ¨æ‰§è¡Œå†™æ“ä½œæ—¶é™„æœ‰ç‰¹æ®Šçš„å†…å­˜å±éšœç±»æŒ‡ä»¤),æ›´æ™®éä½è¯´,æ‰€æœ‰ç”±Javaç¨‹åºå¼•èµ·çš„å†…å­˜è®¿é—®éƒ½åº”è¯¥å¯¹å…¶ä»–æ‰€æœ‰CPUå¯è§,ä½†äº‹å®ä¸Šå´ä¸èƒ½ä¿è¯ç«‹å³å¯è§ã€‚</p><h3 id="åŒæ­¥çš„å®ç°"><a href="#åŒæ­¥çš„å®ç°" class="headerlink" title="åŒæ­¥çš„å®ç°"></a>åŒæ­¥çš„å®ç°</h3><h4 id="åŸç”Ÿæœºåˆ¶"><a href="#åŸç”Ÿæœºåˆ¶" class="headerlink" title="åŸç”Ÿæœºåˆ¶"></a>åŸç”Ÿæœºåˆ¶</h4><p>ä»è®¡ç®—æœºæœ€åº•å±‚CPUç»“æ„æ¥è¯´,åŒæ­¥æ˜¯ä½¿ç”¨åŸå­æŒ‡ä»¤å®ç°çš„,å„ä¸ªå¹³å°çš„å…·ä½“å®ç°å¯èƒ½æœ‰æ‰€ä¸åŒã€‚ä»¥x86å¹³å°ä¸ºä¾‹,å®ƒä½¿ç”¨äº†ä¸“é—¨çš„é”å‰ç¼€(lock prefix)æ¥å®ç°å¤šå¤„ç†å™¨ç¯å¢ƒä¸­æŒ‡ä»¤çš„åŸå­æ€§ã€‚</p><p>åœ¨å¤§å¤šæ•°CPUæ¶æ„ä¸­,æ ‡å‡†æŒ‡ä»¤(ä¾‹å¦‚åŠ æ³•å’Œå‡æ³•æŒ‡ä»¤)éƒ½å¯ä»¥å®ç°ä¸ºåŸå­æŒ‡ä»¤ã€‚</p><p>åœ¨å¾®æ¶æ„( micro- architecture)å±‚é¢,åŸå­æŒ‡ä»¤çš„æ‰§è¡Œæ–¹å¼åœ¨å„ä¸ªå¹³å°ä¸Šä¸å°½ç›¸åŒã€‚ä¸€èˆ¬æƒ…å†µä¸‹,å®ƒä¼šæš‚åœCPUæµæ°´çº¿çš„æŒ‡ä»¤åˆ†æ´¾,ç›´åˆ°æ‰€æœ‰å·²æœ‰çš„æŒ‡ä»¤éƒ½å®Œæˆæ‰§è¡Œ,å¹¶å°†æ“ä½œç»“æœåˆ·å…¥åˆ°å†…å­˜ä¸­ã€‚æ­¤å¤–,è¯¥CPUè¿˜ä¼šé˜»æ­¢å…¶ä»–CPUå¯¹ç›¸å…³ç¼“å­˜è¡Œçš„è®¿é—®,ç›´åˆ°è¯¥åŸå­æŒ‡ä»¤ç»“æŸæ‰§è¡Œã€‚åœ¨ç°ä»£x86ç¡¬ä»¶å¹³å°ä¸Š,å¦‚æœå±éšœæŒ‡ä»¤(fence instruction)ä¸­æ–­äº†æ¯”è¾ƒå¤æ‚çš„æŒ‡ä»¤æ‰§è¡Œ,åˆ™è¯¥åŸå­æŒ‡ä»¤å¯èƒ½éœ€è¦ç­‰ä¸Šå¾ˆå¤šä¸ªæ—¶é’Ÿå‘¨æœŸæ‰èƒ½å®Œæˆæ‰§è¡Œã€‚å› æ­¤,ä¸ä»…æ˜¯è¿‡å¤šçš„ä¸´ç•ŒåŒºä¼šå½±å“ç³»ç»Ÿæ€§èƒ½é”çš„å…·ä½“å®ç°ä¹Ÿä¼šå½±å“æ€§èƒ½,å½“é¢‘ç¹å¯¹è¾ƒå°çš„ä¸´ç•ŒåŒºæ‰§è¡ŒåŠ é”ã€è§£é”æ“ä½œæ—¶,æ€§èƒ½æŸè€—æ›´æ˜¯å·¨å¤§ã€‚</p><h3 id="åŒæ­¥åœ¨å­—èŠ‚ç ä¸­çš„å®ç°"><a href="#åŒæ­¥åœ¨å­—èŠ‚ç ä¸­çš„å®ç°" class="headerlink" title="åŒæ­¥åœ¨å­—èŠ‚ç ä¸­çš„å®ç°"></a>åŒæ­¥åœ¨å­—èŠ‚ç ä¸­çš„å®ç°</h3><p>Javaå­—èŠ‚ç ä¸­æœ‰ä¸¤æ¡ç”¨äºå®ç°åŒæ­¥çš„æŒ‡ä»¤,åˆ†åˆ«æ˜¯monitorenterå’Œmonitorexit,å®ƒä»¬éƒ½ä¼šä»æ‰§è¡Œæ ˆä¸­å¼¹å‡ºä¸€ä¸ªå¯¹è±¡ä½œä¸ºå…¶æ“ä½œæ•°ã€‚ä½¿ç”¨javacç¼–è¯‘æºä»£ç æ—¶,è‹¥é‡åˆ°æ˜¾å¼ä½¿ç”¨ç›‘è§†å™¨å¯¹è±¡çš„åŒæ­¥ä»£ç ,åˆ™ä¸ºä¹‹ç”Ÿæˆç›¸åº”çš„monitorenteræŒ‡ä»¤å’ŒmonitorexitæŒ‡ä»¤ã€‚</p><h2 id="å¯¹äºçº¿ç¨‹ä¸åŒæ­¥çš„ä¼˜åŒ–"><a href="#å¯¹äºçº¿ç¨‹ä¸åŒæ­¥çš„ä¼˜åŒ–" class="headerlink" title="å¯¹äºçº¿ç¨‹ä¸åŒæ­¥çš„ä¼˜åŒ–"></a>å¯¹äºçº¿ç¨‹ä¸åŒæ­¥çš„ä¼˜åŒ–</h2><h3 id="é”è†¨èƒ€ä¸é”æ”¶ç¼©"><a href="#é”è†¨èƒ€ä¸é”æ”¶ç¼©" class="headerlink" title="é”è†¨èƒ€ä¸é”æ”¶ç¼©"></a>é”è†¨èƒ€ä¸é”æ”¶ç¼©</h3><blockquote><p>é»˜è®¤æƒ…å†µä¸‹, JRockitä½¿ç”¨ä¸€ä¸ªå°çš„è‡ªæ—‹é”æ¥å®ç°åˆšè†¨èƒ€çš„èƒ–é”,åªæŒç»­å¾ˆçŸ­çš„æ—¶é—´ã€‚ä¹çœ‹ä¹‹ä¸‹,è¿™ä¸å¤ªç¬¦åˆå¸¸ç†,ä½†è¿™ä¹ˆåšç¡®å®æ˜¯å¾ˆæœ‰ç›Šå¤„çš„ã€‚å¦‚æœé”çš„ç«Ÿäº‰ç¡®å®éå¸¸æ¿€çƒˆ,è€Œå¯¼è‡´çº¿ç¨‹é•¿æ—¶é—´è‡ªæ—‹çš„è¯,å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°-XX:UseFatSpin=falseç¦ç”¨æ­¤æ–¹å¼ã€‚ä½œä¸ºèƒ–é”çš„ä¸€éƒ¨åˆ†,è‡ªæ—‹é”ä¹Ÿå¯ä»¥åˆ©ç”¨è‡ªé€‚åº”è¿è¡Œæ—¶è·å–åˆ°çš„åé¦ˆä¿¡æ¯,è¿™éƒ¨åˆ†åŠŸèƒ½é»˜è®¤æ˜¯ç¦ç”¨çš„,å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°-XX:UseAdaptiveFatSpin=trueæ¥å¼€å¯ã€‚</p></blockquote><h3 id="å»¶è¿Ÿè§£é”"><a href="#å»¶è¿Ÿè§£é”" class="headerlink" title="å»¶è¿Ÿè§£é”"></a>å»¶è¿Ÿè§£é”</h3><p>å¦‚ä½•åˆ†æå¾ˆå¤šçº¿ç¨‹å±€éƒ¨çš„è§£é”,ä»¥åŠé‡æ–°åŠ é”çš„æ“ä½œåªä¼šé™ä½ç¨‹åºæ‰§è¡Œæ•ˆç‡?è¿™æ˜¯å¦æ˜¯ç¨‹åºè¿è¡Œçš„å¸¸æ€?è¿è¡Œæ—¶æ˜¯å¦å¯ä»¥å‡è®¾æ¯ä¸ªå•ç‹¬çš„è§£é”æ“ä½œå®é™…ä¸Šéƒ½æ˜¯ä¸å¿…è¦çš„?</p><p>å¦‚æœæŸä¸ªé”æ¯æ¬¡è¢«é‡Šæ”¾ååˆç«‹åˆ»éƒ½è¢«åŒä¸€ä¸ªçº¿ç¨‹è·å–,åˆ™è¿è¡Œæ—¶å¯ä»¥åšä¸Šè¿°å‡è®¾ã€‚ä½†åªè¦æœ‰å¦å¤–æŸä¸ªçº¿ç¨‹è¯•å›¾è·å–è¿™ä¸ªçœ‹èµ·æ¥åƒæ˜¯æœªè¢«åŠ é”çš„ç›‘è§†å™¨å¯¹è±¡(è¿™ç§æƒ…å†µæ˜¯ç¬¦åˆè¯­ä¹‰çš„),è¿™ç§å‡è®¾å°±ä¸å†æˆç«‹äº†ã€‚è¿™æ—¶ä¸ºäº†ä½¿è¿™ä¸ªç›‘è§†å™¨å¯¹è±¡çœ‹èµ·æ¥åƒæ˜¯ä¸€åˆ‡æ­£å¸¸,åŸæœ¬æŒæœ‰è¯¥ç›‘è§†å™¨å¯¹è±¡çš„çº¿ç¨‹éœ€è¦å¼ºè¡Œé‡Šæ”¾è¯¥é”ã€‚è¿™ç§å®ç°æ–¹å¼ç§°ä¸ºå»¶è¿Ÿè§£é”,åœ¨æŸäº›æè¿°ä¸­ä¹Ÿç§°ä¸ºåå‘é”(biased locking)ã€‚</p><p>å³ä½¿æŸä¸ªé”å®Œå…¨æ²¡æœ‰ç«äº‰,æ‰§è¡ŒåŠ é”å’Œè§£é”æ“ä½œçš„å¼€é”€ä»æ—§æ¯”ä»€ä¹ˆéƒ½ä¸åšè¦å¤§ã€‚è€Œä½¿ç”¨åŸå­æŒ‡ä»¤ä¼šä½¿è¯¥æŒ‡ä»¤å‘¨å›´çš„Javaä»£ç éƒ½äº§ç”Ÿé¢å¤–çš„æ‰§è¡Œå¼€é”€ã€‚</p><p>ä»ä»¥ä¸Šå¯ä»¥çœ‹å‡º,å‡è®¾å¤§éƒ¨åˆ†é”éƒ½åªåœ¨çº¿ç¨‹å±€éƒ¨èµ·ä½œç”¨è€Œä¸ä¼šå‡ºç°ç«äº‰æƒ…å†µ,æ˜¯æœ‰é“ç†çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹,ä½¿ç”¨å»¶è¿Ÿè§£é”çš„ä¼˜åŒ–æ–¹å¼å¯ä»¥æå‡ç³»ç»Ÿæ€§èƒ½ã€‚å½“ç„¶,å¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤,å¦‚æœæŸä¸ªçº¿ç¨‹è¯•å›¾è·å–æŸä¸ªå·²ç»å»¶è¿Ÿè§£é”ä¼˜åŒ–çš„ç›‘è§†å™¨å¯¹è±¡,è¿™æ—¶çš„æ‰§è¡Œå¼€é”€ä¼šè¢«ç›´æ¥è·å–æ™®é€šç›‘è§†å™¨å¯¹è±¡å¤§å¾—å¤š,å› ä¸ºè¿™ä¸ªçœ‹ä¼¼æœªåŠ é”çš„ç›‘è§†å™¨å¯¹è±¡å¿…é¡»è¦å…ˆè¢«å¼ºè¡Œé‡Šæ”¾æ‰å› æ­¤,ä¸èƒ½ä¸€ç›´å‡è®¾è§£é”æ“ä½œæ˜¯ä¸å¿…è¦çš„,éœ€è¦å¯¹ä¸åŒçš„è¿è¡Œæ—¶è¡Œä¸ºåšé’ˆå¯¹æ€§çš„ä¼˜åŒ–ã€‚</p><p>1.å®ç°</p><p>å®ç°å»¶è¿Ÿè§£é”çš„è¯­ä¹‰å…¶å®å¾ˆç®€å•ã€‚</p><p>å®ç° monitorenteræŒ‡ä»¤ã€‚</p><ul><li><font color="DeepPink">å¦‚æœå¯¹è±¡æ˜¯æœªé”å®šçš„,åˆ™åŠ é”æˆåŠŸçš„çº¿ç¨‹å°†ç»§ç»­æŒæœ‰è¯¥é”,å¹¶æ ‡è®°è¯¥å¯¹è±¡ä¸ºå»¶è¿ŸåŠ é”çš„ã€‚</font></li><li><font color="DeepPink">å¦‚æœå¯¹è±¡å·²ç»è¢«æ ‡è®°ä¸ºå»¶è¿ŸåŠ é”çš„</font>ï¼š<ul><li><font color="DeepPink">å¦‚æœå¯¹è±¡æ˜¯è¢«åŒä¸€ä¸ªçº¿ç¨‹åŠ é”çš„,åˆ™ä»€ä¹ˆä¹Ÿä¸åš(å¤§ä½“ä¸Šæ˜¯ä¸€ä¸ªé€’å½’é”)</font></li><li><font color="DeepPink">å¦‚æœå¯¹è±¡æ˜¯è¢«å¦ä¸€ä¸ªçº¿ç¨‹åŠ é”çš„,åˆ™æš‚åœè¯¥çº¿ç¨‹å¯¹é”çš„æŒæœ‰çŠ¶æ€,æ£€æŸ¥è¯¥å¯¹è±¡çœŸå®çš„åŠ é”çŠ¶æ€,å³æ˜¯å·²åŠ é”çš„è¿˜æ˜¯æœªåŠ é”çš„,è¿™ä¸€æ­¥æ“ä½œä»£ä»·é«˜æ˜‚,éœ€è¦éå†è°ƒç”¨æ ˆã€‚å¦‚æœå¯¹è±¡æ˜¯å·²åŠ é”çš„,åˆ™å°†è¯¥é”è½¬æ¢ä¸ºç˜¦é”,å¦åˆ™å¼ºåˆ¶é‡Šæ”¾è¯¥é”,ä»¥ä¾¿å¯ä»¥è¢«æ–°çº¿ç¨‹è·å–åˆ°ã€‚</font></li></ul></li></ul><p>å®ç°monitorexitæŒ‡ä»¤:å¦‚æœæ˜¯å»¶è¿ŸåŠ é”çš„å¯¹è±¡,åˆ™ä»€ä¹ˆä¹Ÿä¸åš,ä¿ç•™å…¶å·²åŠ é”çŠ¶æ€,å³æ‰§è¡Œå»¶è¿Ÿè§£é”ã€‚</p><p>ä¸ºäº†èƒ½è§£é™¤çº¿ç¨‹å¯¹é”çš„æŒæœ‰çŠ¶æ€,å¿…é¡»è¦å…ˆæš‚åœè¯¥çº¿ç¨‹çš„æ‰§è¡Œ,è¿™ä¸ªæ“ä½œæœ‰ä¸å°çš„å¼€é”€ã€‚åœ¨é‡Šæ”¾é”ä¹‹å,é”çš„å®é™…çŠ¶æ€ä¼šé€šè¿‡æ£€æŸ¥çº¿ç¨‹æ ˆä¸­çš„é”ç¬¦å·æ¥ç¡®å®šã€‚å»¶è¿Ÿè§£é”ä½¿ç”¨è‡ªå·±çš„é”ç¬¦å·,ä»¥è¡¨ç¤ºâ€œè¯¥å¯¹è±¡æ˜¯è¢«å»¶è¿Ÿé”å®šçš„â€ã€‚</p><p>å¦‚æœå»¶è¿Ÿé”å®šçš„å¯¹è±¡ä»æ¥ä¹Ÿæ²¡æœ‰è¢«æ’¤é”€è¿‡,å³æ‰€æœ‰çš„é”éƒ½åªåœ¨çº¿ç¨‹å±€éƒ¨å†…å‘æŒ¥ä½œç”¨,é‚£ä¹ˆä½¿ç”¨å»¶è¿Ÿé”å®šå°±å¯ä»¥å¤§å¹…æå‡ç³»ç»Ÿæ€§èƒ½ã€‚ä½†åœ¨å®é™…åº”ç”¨ä¸­,å¦‚æœæˆ‘ä»¬çš„å‡è®¾ä¸æˆç«‹,è¿è¡Œæ—¶å°±ä¸å¾—ä¸ä¸€éåˆä¸€éåœ°é‡Šæ”¾å·²ç»è¢«å»¶è¿ŸåŠ é”çš„å¯¹è±¡,è¿™ç§æ€§èƒ½æ¶ˆè€—å®åœ¨æ‰¿å—ä¸èµ·ã€‚å› æ­¤,è¿è¡Œæ—¶éœ€è¦è®°å½•ä¸‹ç›‘è§†å™¨å¯¹è±¡è¢«ä¸åŒçº¿ç¨‹è·å–åˆ°çš„æ¬¡æ•°,è¿™éƒ¨åˆ†ä¿¡æ¯å­˜å‚¨åœ¨ç›‘è§†å™¨å¯¹è±¡çš„é”å­—ä¸­,ç§°ä¸ºè½¬ç§»ä½(transfer bit)ã€‚</p><p>å¦‚æœç›‘è§†å™¨å¯¹è±¡åœ¨ä¸åŒçš„çº¿ç¨‹ä¹‹é—´è½¬ç§»çš„æ¬¡æ•°è¿‡å¤š,é‚£ä¹ˆè¯¥å¯¹è±¡ã€å…¶ç±»å¯¹è±¡æˆ–è€…å…¶ç±»çš„æ‰€æœ‰å®ä¾‹éƒ½å¯èƒ½ä¼šè¢«ç¦ç”¨å»¶è¿ŸåŠ é”,åªä¼šä½¿ç”¨æ ‡å‡†çš„èƒ–é”å’Œç˜¦é”æ¥å¤„ç†åŠ é”æˆ–è§£é”æ“ä½œã€‚</p><p>æ­£å¦‚ä¹‹å‰ä»‹ç»è¿‡çš„,å¯¹è±¡é¦–å…ˆæ˜¯æœªåŠ é”çŠ¶æ€çš„,ç„¶åçº¿ç¨‹T1æ‰§è¡ŒmonitorenteræŒ‡ä»¤,ä½¿ä¹‹è¿›å…¥å»¶è¿ŸåŠ é”çŠ¶æ€ã€‚ä½†<font color="DeepPink">å¦‚æœçº¿ç¨‹T1åœ¨è¯¥å¯¹è±¡ä¸Šæ‰§è¡Œäº†monitorexitæŒ‡ä»¤,è¿™æ—¶ç³»ç»Ÿä¼šå‡è£…å·²ç»è§£é”äº†,ä½†å®é™…ä¸Šä»æ˜¯é”å®šçŠ¶æ€,é”å¯¹è±¡çš„é”å­—ä¸­ä»è®°å½•ç€çº¿ç¨‹T1çš„çº¿ç¨‹ID</font>ã€‚åœ¨æ­¤ä¹‹åçº¿ç¨‹T1å¦‚æœå†æ‰§è¡ŒåŠ é”æ“ä½œ,å°±ä¸ç”¨å†æ‰§è¡Œç›¸å…³æ“ä½œäº†ã€‚</p><p><font color="DeepPink">å¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹T2è¯•å›¾è·å–åŒä¸€ä¸ªé”,åˆ™ä¹‹å‰æ‰€åšâ€œè¯¥é”ç»å¤§éƒ¨åˆ†è¢«çº¿T1ç¨‹ä½¿ç”¨â€çš„å‡è®¾ä¸å†æˆç«‹,ä¼šå—åˆ°æ€§èƒ½æƒ©ç½š,å°†é”å­—ä¸­çš„çº¿ç¨‹IDç”±çº¿ç¨‹T1çš„IDæ›¿æ¢ä¸ºçº¿ç¨‹T2çš„</font>ã€‚å¦‚æœè¿™æƒ…å†µç»å¸¸å‡ºç°,é‚£ä¹ˆå¯èƒ½ä¼šç¦ç”¨è¯¥å¯¹è±¡ä½œä¸ºå»¶è¿Ÿé”,å¹¶å°†è¯¥å¯¹è±¡ä½œä¸ºæ™®é€šçš„ç˜¦é”ä½¿ç”¨ã€‚</p><h2 id="é™·é˜±ä¸ä¼ªä¼˜åŒ–-1"><a href="#é™·é˜±ä¸ä¼ªä¼˜åŒ–-1" class="headerlink" title="é™·é˜±ä¸ä¼ªä¼˜åŒ–"></a>é™·é˜±ä¸ä¼ªä¼˜åŒ–</h2><h3 id="Thread-stopã€Thread-resumeå’ŒThread-suspend"><a href="#Thread-stopã€Thread-resumeå’ŒThread-suspend" class="headerlink" title="Thread.stopã€Thread.resumeå’ŒThread.suspend"></a>Thread.stopã€Thread.resumeå’ŒThread.suspend</h3><p>æ°¸è¿œä¸è¦ä½¿ç”¨Thread.stopæ–¹æ³•ã€Thread.resumeæ–¹æ³•æˆ–Thread.suspendæ–¹æ³•å¹¶å°å¿ƒå¤„ç†ä½¿ç”¨è¿™äº›æ–¹æ³•çš„å†å²é—ç•™ä»£ç ã€‚</p><p>æ™®éå»ºè®®ä½¿ç”¨waitæ–¹æ³•ã€notifyæ–¹æ³•æˆ–volatileå˜é‡æ¥åšçº¿ç¨‹é—´çš„åŒæ­¥å¤„ç†ã€‚</p><h3 id="åŒæ£€æŸ¥é”"><a href="#åŒæ£€æŸ¥é”" class="headerlink" title="åŒæ£€æŸ¥é”"></a>åŒæ£€æŸ¥é”</h3><p>å¦‚æœå¯¹å†…å­˜æ¨¡å‹å’ŒCPUæ¶æ„ç¼ºä¹ç†è§£çš„è¯,å³ä½¿ä½¿ç”¨å¹³é‡åˆ°é—®é¢˜ã€‚ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹,å…¶ç›®çš„æ˜¯å®ç°å•ä¾‹æ¨¡å¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class Gadget Holder&#123;</span><br><span class="line">private Gadget theGadget;</span><br><span class="line">public synchronized Gadget cetGadget()&#123;</span><br><span class="line">if (this.theGadget == null)&#123;</span><br><span class="line">this.theGadget = new Gadget();</span><br><span class="line">&#125;</span><br><span class="line">return this.theGadget;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç æ˜¯çº¿ç¨‹å®‰å…¨çš„,å› ä¸ºgetGadgetæ–¹æ³•æ˜¯åŒæ­¥ä½†å½“Gadgetç±»çš„æ„é€ å‡½æ•°å·²ç»æ‰§è¡Œè¿‡ä¸€æ¬¡ä¹‹å,å†æ‰§è¡ŒåŒä¼˜åŒ–æ€§èƒ½,å°†ä¹‹æ”¹é€ ä¸ºä¸‹é¢çš„ä»£ç ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public Gadget getGadget()&#123;</span><br><span class="line">if (this.theGadget == null)&#123;</span><br><span class="line">synchronized(this)&#123;</span><br><span class="line">if(this.theGadget == null))&#123;</span><br><span class="line">this.theGadget = new Gadget();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return this.theGadget;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨äº†ä¸€ä¸ªçœ‹èµ·æ¥å¾ˆâ€œèªæ˜â€çš„æŠ€å·§,å¦‚æœè¡ŒåŒæ­¥æ“ä½œ,è€Œæ˜¯ç›´æ¥è¿”å›å·²æœ‰çš„å¯¹è±¡;å¦‚æœå¯¹è±¡è¿˜æœªåˆ›å»ºå€¼ã€‚è¿™æ ·å¯ä»¥ä¿è¯â€œçº¿ç¨‹å®‰å…¨â€ã€‚</p><p>ä¸Šè¿°ä»£ç å°±æ˜¯æ‰€è°“çš„åŒæ£€æŸ¥é”(double checked locking),ä¸‹é¢åˆ†æä¸€ä¸‹è¿™æ®µä»£ç çš„é—®é¢˜ã€‚<font color="DeepPink">å‡è®¾æŸä¸ªçº¿ç¨‹ç»è¿‡å†…å±‚çš„ç©ºå€¼æ£€æŸ¥,å¼€å§‹åˆå§‹åŒ–theGadgetå­—æ®µçš„å€¼,è¯¥çº¿ç¨‹éœ€è¦ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜,å¹¶å¯¹theGadgetå­—æ®µèµ‹å€¼ã€‚å¯æ˜¯,è¿™ä¸€ç³»åˆ—æ“ä½œå¹¶ä¸æ˜¯åŸå­çš„,ä¸”æ‰§è¡Œé¡ºåºæ— æ³•ä¿è¯ã€‚å¦‚æœåœ¨æ­¤æ—¶æ­£å¥½å‘ç”Ÿçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢,åˆ™å¦ä¸€ä¸ªçº¿ç¨‹çœ‹åˆ°çš„theGadgetå­—æ®µçš„å€¼å¯èƒ½æ˜¯æœªç»å®Œæ•´åˆå§‹åŒ–çš„,æœ‰å¯èƒ½ä¼šå¯¼è‡´å¤–å±‚çš„æ§åˆ¶æ£€æŸ¥å¤±æ•ˆ,å¹¶è¿”å›è¿™ä¸ªæœªç»å®Œæ•´åˆå§‹åŒ–çš„å¯¹è±¡ã€‚ä¸ä»…ä»…æ˜¯åˆ›å»ºå¯¹è±¡å¯èƒ½ä¼šå‡ºé—®é¢˜,å¤„ç†å…¶ä»–ç±»å‹æ•°æ®æ—¶ä¹Ÿè¦å°å¿ƒã€‚ä¾‹å¦‚,åœ¨32ä½å¹³å°ä¸Š,å†™å…¥ä¸€ä¸ªlongå‹æ•°æ®é€šå¸¸éœ€è¦æ‰§è¡Œä¸¤æ¬¡32ä½æ•°æ®çš„å†™æ“ä½œ,è€Œå†™å…¥intæ•°æ®åˆ™æ— æ­¤é¡¾è™‘ã€‚</font></p><p>ä¸Šè¿°é—®é¢˜å¯ä»¥é€šè¿‡å°† theGadgetå­—æ®µå£°æ˜ä¸º volatileæ¥è§£å†³(æ³¨æ„,åªåœ¨æ–°ç‰ˆæœ¬çš„å†…å­˜æ¨¡å‹ä¸‹æ‰æœ‰æ•ˆ),å¢åŠ çš„æ‰§è¡Œå¼€é”€å°½ç®¡æ¯”ä½¿ç”¨synchronizedæ–¹æ³•çš„å°,ä½†è¿˜æ˜¯æœ‰çš„ã€‚å¦‚æœä¸ç¡®å®šå½“å‰ç‰ˆæœ¬çš„å†…å­˜æ¨¡å‹æ˜¯å¦å®ç°æ­£ç¡®,ä¸è¦ä½¿ç”¨åŒæ£€æŸ¥é”ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« ä»‹ç»äº†ä¸ºä»€ä¹ˆä¸åº”è¯¥ä½¿ç”¨åŒæ£€æŸ¥é”,ä¸ä»…é™äºJava,å…¶ä»–è¯­è¨€ä¹Ÿæ˜¯ã€‚</p><p><font color="DeepPink">åŒæ£€æŸ¥é”çš„å±é™©ä¹‹å¤„åœ¨äº,åœ¨å¼ºå†…å­˜æ¨¡å‹ä¸‹,å®ƒå¾ˆå°‘ä¼šä½¿ç¨‹åºå´©æºƒã€‚Intel IA-64å¹³å°å°±æ˜¯ä¸ªå…¸å‹ç¤ºä¾‹,å…¶å¼±å†…å­˜æ¨¡å‹è‡­åè¿œæ‰¬,åŸæœ¬å¥½å¥½è¿è¡Œçš„Javaåº”ç”¨ç¨‹åºå´å‡ºç°æ•…éšœã€‚å¦‚æœæŸä¸ªåº”ç”¨ç¨‹åºåœ¨x86å¹³å°è¿è¡Œè‰¯å¥½,åœ¨x64å¹³å°å´å‡ºé—®é¢˜,äººä»¬å¾ˆå®¹æ˜“æ€€ç–‘æ˜¯JVMçš„bug,å´å¿½è§†äº†æœ‰å¯èƒ½æ˜¯Javaåº”ç”¨ç¨‹åºè‡ªèº«çš„é—®é¢˜ã€‚</font></p><p>ä½¿ç”¨é™æ€å±æ€§æ¥å®ç°å•ä¾‹æ¨¡å¼å¯ä»¥å®ç°åŒæ ·çš„è¯­ä¹‰,è€Œæ— é¡»ä½¿ç”¨åŒæ£€æŸ¥é”,å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public class GadgetMaker&#123;</span><br><span class="line">public static Gadget theGadget= new Gadget();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="DeepPink">Javaè¯­è¨€ä¿è¯ç±»çš„åˆå§‹åŒ–æ˜¯åŸå­æ“ä½œ, GadgetMakerç±»ä¸­æ²¡æœ‰å…¶ä»–çš„åŸŸ,å› æ­¤,åœ¨é¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨è¯¥ç±»æ—¶ä¼šè‡ªåŠ¨åˆ›å»º Gadgetç±»çš„å®ä¾‹ã€‚å¹¶èµ‹å€¼ç»™theGadgetå­—æ®µã€‚è¿™ç§æ–¹æ³•åœ¨æ–°æ—§ä¸¤ç§å†…å­˜æ¨¡å‹ä¸‹å‡å¯æ­£å¸¸å·¥ä½œã€‚</font></p><p>æ€»ä¹‹,ä½¿ç”¨Javaåšå¹¶è¡Œç¨‹åºå¼€å‘æœ‰å¾ˆå¤šéœ€è¦å°å¿ƒçš„åœ°æ–¹,å¦‚æœèƒ½å¤Ÿæ­£ç¡®ç†è§£Javaå†…å­˜æ¨¡å‹é‚£ä¹ˆæ˜¯å¯ä»¥é¿å¼€è¿™äº›é™·é˜±çš„ã€‚å¼€å‘äººå‘˜å¾€å¾€ä¸å¤ªå…³å¿ƒå½“å‰çš„ç¡¬ä»¶æ¶æ„,ä½†å¦‚æœä¸èƒ½ç†è§£Javaå†…å­˜æ¨¡å‹,è¿Ÿæ—©ä¼šæ¬èµ·çŸ³å¤´ç ¸è‡ªå·±çš„è„šã€‚</p><h1 id="åŸºå‡†æµ‹è¯•ä¸æ€§èƒ½è°ƒä¼˜"><a href="#åŸºå‡†æµ‹è¯•ä¸æ€§èƒ½è°ƒä¼˜" class="headerlink" title="åŸºå‡†æµ‹è¯•ä¸æ€§èƒ½è°ƒä¼˜"></a>åŸºå‡†æµ‹è¯•ä¸æ€§èƒ½è°ƒä¼˜</h1><h2 id="waitæ–¹æ³•ã€notifyæ–¹æ³•ä¸èƒ–é”"><a href="#waitæ–¹æ³•ã€notifyæ–¹æ³•ä¸èƒ–é”" class="headerlink" title="waitæ–¹æ³•ã€notifyæ–¹æ³•ä¸èƒ–é”"></a>waitæ–¹æ³•ã€notifyæ–¹æ³•ä¸èƒ–é”</h2><h3 id="Javaå¹¶éä¸‡èƒ½çš„"><a href="#Javaå¹¶éä¸‡èƒ½çš„" class="headerlink" title="Javaå¹¶éä¸‡èƒ½çš„"></a>Javaå¹¶éä¸‡èƒ½çš„</h3><p>Javaæ˜¯ä¸€é—¨å¼ºå¤§çš„é€šç”¨ç¼–ç¨‹è¯­è¨€,å› å…¶å‹å¥½çš„è¯­ä¹‰å’Œå†…å»ºçš„å†…çš„å¼€å‘è¿›åº¦,ä½†Javaä¸æ˜¯ä¸‡èƒ½çš„,è¿™é‡Œæ¥è°ˆè°ˆä¸å®œä½¿ç”¨Javaè§£å†³çš„åœºæ™¯ï¼š</p><ul><li>è¦å¼€å‘ä¸€ä¸ªæœ‰è¿‘å®æ—¶æ€§è¦æ±‚çš„ç”µä¿¡åº”ç”¨ç¨‹åº,å¹¶ä¸”å…¶ä¸­ä¼šæœ‰å…¶ä¸­ä¼šæœ‰æˆåƒä¸Šä¸‡çš„çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚</li><li>åº”ç”¨ç¨‹åºçš„æ•°æ®åº“å±‚æ‰€è¿”å›çš„æ•°æ®ç»å¸¸æ˜¯20MBçš„å­—èŠ‚æ•°ç»„ã€‚</li><li>åº”ç”¨ç¨‹åºæ€§èƒ½å’Œè¡Œä¸ºçš„ç¡®å®šæ€§,å®Œå…¨ä¾èµ–äºåº•å±‚æ“ä½œç³»ç»Ÿçš„è°ƒåº¦å™¨ï¼Œå³ä½¿è°ƒåº¦å™¨æœ‰å¾®å°å˜åŒ–ä¹Ÿä¼šå¯¹åº”ç”¨ç¨‹åºæ€§èƒ½äº§ç”Ÿè¾ƒå¤§å½±å“ã€‚</li><li>å¼€å‘è®¾å¤‡é©±åŠ¨ç¨‹åºã€‚</li><li>ä½¿ç”¨ C/Fortran/COBOLç­‰è¯­è¨€å¼€å‘çš„å†å²é—ç•™ä»£ç å¤ªå¤š,ç›®å‰å›¢é˜Ÿæ‰‹ä¸­è¿˜æ²¡æœ‰å¥½ç”¨çš„å·¥å…·å¯ä»¥å°†è¿™äº›ä»£ç è½¬æ¢ä¸ºJavaä»£ç ã€‚</li></ul><p>é™¤äº†ä¸Šé¢çš„ç¤ºä¾‹å¤–,è¿˜æœ‰å…¶ä»–å¾ˆå¤šåœºæ™¯ä¸é€‚å®œä½¿ç”¨Javaã€‚é€šè¿‡JvMå¯¹åº•å±‚æ“ä½œç³»ç»Ÿçš„æŠ½è±¡Javaå®ç°äº†â€œä¸€æ¬¡ç¼–å†™,åˆ°å¤„è¿è¡Œâ€,ä¹Ÿå› æ­¤å—åˆ°äº†å¹¿æ³›å…³æ³¨ã€‚ä½†å¤¸å¤§ä¸€ç‚¹è¯´,ANSI Cä¹Ÿèƒ½åšåˆ°è¿™ä¸€ç‚¹,åªä¸è¿‡åœ¨ç¼–å†™æºä»£ç æ—¶,è¦èŠ±å¾ˆå¤šç²¾åŠ›æ¥åº”å¯¹å¯ç§»æ¤æ€§é—®é¢˜ã€‚å› æ­¤è¦ç»“åˆå®é™…åœºæ™¯é€‰æ‹©åˆé€‚çš„å·¥å…·ã€‚Javaæ˜¯å¥½ç”¨,ä½†ä¹Ÿä¸è¦æ»¥ç”¨ã€‚</p><p>PDFä¹¦ç±ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/jiankunking/books-recommendation/tree/master/Java" target="_blank" rel="noopener">https://github.com/jiankunking/books-recommendation/tree/master/Java</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> GC </tag>
            
            <tag> è¯»ä¹¦ç¬”è®° </tag>
            
            <tag> JVM </tag>
            
            <tag> JRockit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥ç†è§£JVMï¼†G1GC ç¬”è®°</title>
      <link href="/java-jvm-gc-g1-note.html"/>
      <url>/java-jvm-gc-g1-note.html</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ•´ç†è‡ªï¼šã€Šæ·±å…¥ç†è§£JVMï¼†G1GCã€‹ ä½œè€…ï¼šå‘¨æ˜è€€<br>æœ¬ä¹¦å¾ˆä¸€èˆ¬<br>å‡ºç‰ˆæ—¶é—´ï¼š2017-06-01</p><a id="more"></a><h1 id="JVM-GCåŸºæœ¬çŸ¥è¯†"><a href="#JVM-GCåŸºæœ¬çŸ¥è¯†" class="headerlink" title="JVM GCåŸºæœ¬çŸ¥è¯†"></a>JVM GCåŸºæœ¬çŸ¥è¯†</h1><h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>G1å†…éƒ¨ä¸»è¦æœ‰å››ä¸ªæ“ä½œé˜¶æ®µï¼š</p><ul><li>å¹´è½»ä»£å›æ”¶(A Young Collection)</li><li>è¿è¡Œåœ¨åå°çš„å¹¶è¡Œå¾ªç¯(A Background,Concurrent Cycle)</li><li>æ··åˆå›æ”¶(A Mixed Collection)</li><li>å…¨é‡å›æ”¶(A Full GC)</li></ul><h2 id="åŸºæœ¬æœ¯è¯­"><a href="#åŸºæœ¬æœ¯è¯­" class="headerlink" title="åŸºæœ¬æœ¯è¯­"></a>åŸºæœ¬æœ¯è¯­</h2><h3 id="Javaç›¸å…³æœ¯è¯­"><a href="#Javaç›¸å…³æœ¯è¯­" class="headerlink" title="Javaç›¸å…³æœ¯è¯­"></a>Javaç›¸å…³æœ¯è¯­</h3><h4 id="Interned-Strings"><a href="#Interned-Strings" class="headerlink" title="Interned Strings"></a>Interned Strings</h4><p>åœ¨Javaè¯­è¨€ä¸­æœ‰8ç§åŸºæœ¬ç±»å‹å’Œä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹ Stringè¿™äº›ç±»å‹ä¸ºäº†ä½¿å®ƒä»¬åœ¨è¿è¡Œè¿‡ç¨‹ä¸­é€Ÿåº¦æ›´å¿«ã€æ›´èŠ‚çœå†…å­˜,éƒ½æä¾›äº†ä¸€ç§å¸¸é‡æ± çš„æ¦‚å¿µã€‚å¸¸é‡æ± å°±ç±»ä¼¼ä¸€ä¸ªJavaç³»ç»Ÿçº§åˆ«æä¾›çš„ç¼“å­˜ã€‚8ç§åŸºæœ¬ç±»å‹çš„å¸¸é‡æ± éƒ½æ˜¯ç³»ç»Ÿåè°ƒçš„,Stringç±»å‹çš„å¸¸é‡æ± æ¯”è¾ƒç‰¹æ®Šã€‚å®ƒçš„ä¸»è¦ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§ã€‚</p><ul><li>ç›´æ¥ä½¿ç”¨åŒå¼•å·å£°æ˜å‡ºæ¥çš„Stringå¯¹è±¡ä¼šç›´æ¥å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­</li><li>å¦‚æœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜çš„Stringå¯¹è±¡,å¯ä»¥ä½¿ç”¨Stringæä¾›çš„Internæ–¹æ³•ã€‚ internæ–¹æ³•ä¼šä»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æŸ¥è¯¢å½“å‰å­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨,è‹¥ä¸å­˜åœ¨å°±ä¼šå°†å½“å‰å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± ä¸­ã€‚</li></ul><p>é€šä¿—ç‚¹è®²,Interned Stringå°±æ˜¯ç¡®ä¿å­—ç¬¦ä¸²åœ¨å†…å­˜é‡Œåªæœ‰ä¸€ä»½æ‹·è´,è¿™æ ·å¯ä»¥èŠ‚çº¦å†…å­˜ç©ºé—´,åŠ å¿«å­—ç¬¦ä¸²æ“ä½œä»»åŠ¡çš„æ‰§è¡Œé€Ÿåº¦ã€‚æ³¨æ„,è¿™ä¸ªå€¼ä¼šè¢«å­˜æ”¾åœ¨å­—ç¬¦ä¸²å†…éƒ¨æ± (String Intern Pool)ã€‚</p><p>Java 7ä¸­Oracleçš„å·¥ç¨‹å¸ˆå¯¹å­—ç¬¦ä¸²æ± çš„é€»è¾‘åšäº†å¾ˆå¤§çš„æ”¹å˜,å³å°†å­—ç¬¦ä¸²æ± çš„ä½ç½®è°ƒæ•´åˆ°Javaå †å†…,è¿™ä¸ªæ”¹åŠ¨æ„å‘³ç€ä½ å†ä¹Ÿä¸ä¼šè¢«å›ºå®šçš„å†…å­˜ç©ºé—´é™åˆ¶äº†ã€‚æ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½ä¿å­˜åœ¨å †(Heap)ä¸­,å’Œå…¶ä»–æ™®é€šå¯¹è±¡ä¸€æ ·,è¿™æ ·å¯ä»¥è®©ä½ åœ¨è¿›è¡Œè°ƒä¼˜åº”ç”¨æ—¶ä»…éœ€è¦è°ƒæ•´å †å¤§å°å°±å¯ä»¥äº†ã€‚å­—ç¬¦ä¸²æ± æ¦‚å¿µåŸæœ¬ä½¿ç”¨å¾—æ¯”è¾ƒå¤š,ä½†æ˜¯è¿™ä¸ªæ”¹åŠ¨ä½¿å¾—æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ç†ç”±è®©æˆ‘ä»¬é‡æ–°è€ƒè™‘åœ¨Java7ä¸­ä½¿ç”¨ String intern()ã€‚</p><h3 id="Java-å¯¹è±¡å¤´"><a href="#Java-å¯¹è±¡å¤´" class="headerlink" title="Java å¯¹è±¡å¤´"></a>Java å¯¹è±¡å¤´</h3><p>åœ¨HotSpotè™šæ‹Ÿæœºä¸­,å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€å¯ä»¥åˆ†æˆå¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®ã€å¯¹é½å¡«å……ä¸‰éƒ¨åˆ†ã€‚</p><ul><li>å¯¹è±¡å¤´:å®ƒä¸»è¦åŒ…æ‹¬å¯¹è±¡è‡ªèº«çš„è¿è¡Œè¡Œå…ƒæ•°æ®,æ¯”å¦‚å“ˆå¸Œç ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ç­‰,åŒæ—¶è¿˜åŒ…å«ä¸€ä¸ªç±»å‹æŒ‡é’ˆ,æŒ‡å‘ç±»å…ƒæ•°æ®,è¡¨æ˜è¯¥å¯¹è±¡æ‰€å±çš„ç±»å‹ã€‚</li><li>å®ä¾‹æ•°æ®:å®ƒæ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯,åŒ…æ‹¬ç¨‹åºä»£ç ä¸­å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µ(åŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å’Œæœ¬èº«æ‹¥æœ‰çš„å­—æ®µ)ã€‚</li><li>å¯¹é½å¡«å……:å®ƒä¸æ˜¯å¿…è¦å­˜åœ¨çš„,ä»…ä»…èµ·ç€å ä½ç¬¦çš„ä½œç”¨</li></ul><p>å¯¹è±¡å¤´å¤§å°åœ¨32ä½HotSpot VMå’Œ64ä½ HotSpot VMä¹‹é—´æ˜¯ä¸ä¸€æ ·çš„,å¯¹è±¡å¤´åœ¨32ä½ç³»ç»Ÿä¸Šå ç”¨8yte,åœ¨64ä½ç³»ç»Ÿä¸Šå ç”¨16yteã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡Javaå¯¹è±¡å¸ƒå±€å·¥å…·è·å–å¤´å¤§å°,è¿™ä¸ªå·¥å…·ç®€ç§°ä¸ºJOLã€‚</p><h2 id="G1-æ¶‰åŠæœ¯è¯­"><a href="#G1-æ¶‰åŠæœ¯è¯­" class="headerlink" title="G1 æ¶‰åŠæœ¯è¯­"></a>G1 æ¶‰åŠæœ¯è¯­</h2><h3 id="Metaspace"><a href="#Metaspace" class="headerlink" title="Metaspace"></a>Metaspace</h3><p>JDK8 HotSpot JVMä½¿ç”¨<font color="DeepPink">æœ¬åœ°å†…å­˜</font>æ¥å­˜å‚¨ç±»å…ƒæ•°æ®ä¿¡æ¯å¹¶ç§°ä¸ºå…ƒç©ºé—´(Metaspace)ã€‚</p><p><font color="DeepPink">é»˜è®¤æƒ…å†µä¸‹,å¤§éƒ¨åˆ†ç±»å…ƒæ•°æ®éƒ½åœ¨æœ¬åœ°å†…å­˜ä¸­åˆ†é…,ç±»å…ƒæ•°æ®åªå—å¯ç”¨çš„æœ¬åœ°å†…å­˜é™åˆ¶(å®¹é‡å–å†³äºæ˜¯32ä½æˆ–æ˜¯64ä½æ“ä½œç³»ç»Ÿçš„å¯ç”¨è™šæ‹Ÿå†…å­˜å¤§å°)ã€‚æ–°å‚æ•°(MaxMetaspace Size)ç”¨äºé™åˆ¶æœ¬åœ°å†…å­˜åˆ†é…ç»™ç±»å…ƒæ•°æ®çš„å¤§å°ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šè¿™ä¸ªå‚æ•°,å…ƒç©ºé—´ä¼šåœ¨è¿è¡Œæ—¶æ ¹æ®éœ€è¦åŠ¨æ€è°ƒæ•´ã€‚</font></p><p>ä¸€èˆ¬æƒ…å†µä¸‹,é€‚æ—¶åœ°ç›‘æ§å’Œè°ƒæ•´å…ƒç©ºé—´å¯¹äºå‡å°åƒåœ¾å›æ”¶é¢‘ç‡å’Œå‡å°‘å»¶æ—¶æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚æŒç»­çš„å…ƒç©ºé—´åƒåœ¾å›æ”¶æƒ…å†µå¦‚æœé¢‘ç¹å‘ç”Ÿ,è¯´æ˜å¯èƒ½å­˜åœ¨ç±»ã€ç±»åŠ è½½å™¨å¯¼è‡´çš„å†…å­˜æ³„æ¼æˆ–æ˜¯å¤§å°è®¾ç½®ä¸åˆé€‚ã€‚</p><p>G1 GCä¸Metaspaceç›¸å…³çš„é€‰é¡¹å¦‚ä¸‹ï¼š</p><ul><li>-XX:MetaspaceSize:åˆå§‹åŒ–å…ƒç©ºé—´çš„å¤§å°(é»˜è®¤12 Mbytesåœ¨32bit client VM and 16 Mbytesåœ¨32bit server VM,åœ¨64 bit VMä¸Šä¼šæ›´å¤§äº›)ã€‚ </li><li>-XX:MaxMetaspaceSize:æœ€å¤§å…ƒç©ºé—´çš„å¤§å°(é»˜è®¤æœ¬åœ°å†…å­˜)ã€‚</li><li>-XX:MinMetaspaceFreeRatio:æ‰©å¤§ç©ºé—´çš„æœ€å°æ¯”ç‡,å½“GCå,å†…å­˜å ç”¨è¶…è¿‡è¿™ä¸€æ¯”ç‡,å°±ä¼šæ‰©å¤§ç©ºé—´ã€‚</li><li>-XX:MaxMetaspaceFreeRatio:ç¼©å°ç©ºé—´çš„æœ€å°æ¯”ç‡,å½“GCå,å†…å­˜å ç”¨ä½äºè¿™ä¸€æ¯”ç‡,å°±ä¼šç¼©å°ç©ºé—´ã€‚</li></ul><h3 id="Mixed-GC-Event"><a href="#Mixed-GC-Event" class="headerlink" title="Mixed GC Event"></a>Mixed GC Event</h3><p>å³æ··åˆGCäº‹ä»¶,åœ¨è¿™ä¸ªäº‹ä»¶å†…éƒ¨,æ‰€æœ‰çš„å¹´è½»ä»£Regionå’Œä¸€éƒ¨åˆ†è€å¹´ä»£Regionä¸€èµ·è¢«å›æ”¶ã€‚æ··åˆGCäº‹ä»¶ä¸€å®šæ˜¯è·Ÿåœ¨Minor GCä¹‹åçš„,å¹¶ä¸”æ··åˆGCåªæœ‰åœ¨å­˜æ´»å¯¹è±¡å…ƒæ•°æ®å­˜åœ¨çš„æƒ…å†µä¸‹æ‰ä¼šè§¦å‘ã€‚</p><h3 id="Reclaimable"><a href="#Reclaimable" class="headerlink" title="Reclaimable"></a>Reclaimable</h3><p><font color="DeepPink">Gl GCä¸ºäº†èƒ½å¤Ÿå›æ”¶,åˆ›å»ºäº†ä¸€ç³»åˆ—ä¸“é—¨ç”¨äºå­˜æ”¾å¯å›æ”¶å¯¹è±¡çš„Region</font>ã€‚è¿™äº›Regionéƒ½åœ¨ä¸ªé“¾è¡¨é˜Ÿåˆ—é‡Œé¢,è¿™ä¸ªé˜Ÿåˆ—åªåŒ…å«å­˜æ´»ç‡å°äº-XX: GIMixedGCLiveThresholdPercent(é»˜è®¤85%)çš„Regionã€‚Regionçš„å€¼é™¤ä»¥æ•´ä¸ªJavaå †åŒº,å¦‚æœå¤§äº-XX:G1HeapWastePercen(é»˜è®¤5%),åˆ™å¯åŠ¨å›æ”¶æœºåˆ¶ã€‚</p><h3 id="Rset"><a href="#Rset" class="headerlink" title="Rset"></a>Rset</h3><p><font color="DeepPink">å…¨ç§°Remembered Set,ç®€ç§°Rset,å³è·Ÿè¸ªæŒ‡å‘æŸä¸ªå †åŒº(Region)å†…çš„å¯¹è±¡å¼•ç”¨ã€‚</font></p><p><font color="DeepPink">åœ¨æ ‡è®°å­˜æ´»å¯¹è±¡æ—¶,G1ä½¿ç”¨RememberSetçš„æ¦‚å¿µ,å°†æ¯ä¸ªåˆ†åŒºå¤–æŒ‡å‘åˆ†åŒºå†…çš„å¼•ç”¨è®°å½•åœ¨è¯¥åˆ†åŒºçš„RememberSetä¸­,é¿å…äº†å¯¹æ•´ä¸ªHeapçš„æ‰«æ,ä½¿å¾—å„ä¸ªåˆ†åŒºçš„GCæ›´åŠ ç‹¬ç«‹ã€‚å †å†…å­˜ä¸­çš„æ¯ä¸ªåŒºéƒ½æœ‰ä¸€ä¸ªRSet,Rsetçš„ä½œç”¨æ˜¯è®©å †åŒºèƒ½å¹¶è¡Œç‹¬ç«‹åœ°è¿›è¡Œåƒåœ¾é›†åˆã€‚</font>RSetæ‰€å ç”¨çš„JVMå†…å­˜å°äºæ€»å¤§å°çš„5%ã€‚åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹,å¯ä»¥çœ‹å‡ºG1GCå¤§å¤§æé«˜äº†è§¦å‘ Full Gcæ—¶çš„Heapå ç”¨ç‡,åŒæ—¶ä¹Ÿä½¿å¾— Minor GCçš„æš‚åœæ—¶é—´æ›´åŠ å¯æ§,å¯¹äºå†…å­˜è¾ƒå¤§çš„ç¯å¢ƒéå¸¸å‹å¥½ã€‚</p><p>G1 GCå¼•å…¥äº†ä¸€äº›æ–°çš„é€‰é¡¹ã€‚G1RSetUpdatingPauseTimePercentè®¾ç½®STWé˜¶æ®µ(ç‹¬å é˜¶æ®µ)ä¸ºG1æ”¶é›†å™¨æŒ‡å®šæ›´æ–°RememberSetçš„æ—¶é—´å æ€»STWæ—¶é—´çš„æœŸæœ›æ¯”ä¾‹,é»˜è®¤ä¸º10ã€‚è€ŒG1ConcRefinementThreadsåˆ™æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ç»´æŠ¤RememberSetçš„çº¿ç¨‹æ•°ç›®ã€‚é€šè¿‡å¯¹è¿™ä¸¤ä¸ªå€¼çš„å¯¹åº”è°ƒæ•´,æˆ‘ä»¬å¯ä»¥æŠŠSTWé˜¶æ®µçš„RememberSetæ›´æ–°å·¥ä½œå‹åŠ›æ›´å¤šåœ°ç§»åˆ°å¹¶è¡Œé˜¶æ®µã€‚</p><h3 id="CSet"><a href="#CSet" class="headerlink" title="CSet"></a>CSet</h3><p><font color="DeepPink">å…¨ç§°Collection Set,ç®€ç§°CSet,å³æ”¶é›†é›†åˆ,ä¿å­˜ä¸€æ¬¡GCä¸­å°†æ‰§è¡Œåƒåœ¾å›æ”¶çš„åŒºé—´(Region)ã€‚GCæ—¶åœ¨CSetä¸­çš„æ‰€æœ‰å­˜æ´»æ•°æ®(Live Data)éƒ½ä¼šè¢«è½¬ç§»(å¤åˆ¶/ç§»åŠ¨)ã€‚</font>é›†åˆä¸­çš„å †åŒºå¯ä»¥æ˜¯Eden, Survivorå’Œ/æˆ–Old Generationã€‚CSetsæ‰€å ç”¨çš„JVMå†…å­˜å°äºæ€»å¤§å°çš„1%ã€‚</p><p>ä»è¿™é‡Œå¯ä»¥çŸ¥é“,å®é™…ä¸ŠCSetç›¸å½“äºä¸€ä¸ªå¤§åœˆ,é‡Œé¢åŒ…å«äº†å¾ˆå¤šçš„å°åœˆ(Rset),è¿™äº›åœˆåœˆéƒ½æ˜¯éœ€è¦è¢«å›æ”¶çš„ä¿¡æ¯ã€‚è¿™æ ·å¯ä»¥æŠŠCSetæ¯”ä½œåƒåœ¾åœº,RSetæ˜¯åƒåœ¾åœºé‡Œé¢ä¸€ä¸ªä¸ªç»¿è‰²çš„å¯å›æ”¶åƒåœ¾æ¡¶ã€‚</p><h3 id="PLAB"><a href="#PLAB" class="headerlink" title="PLAB"></a>PLAB</h3><p>å…¨ç§°ä¸ºPromotion Local Allocation Buffers,å®ƒè¢«ç”¨äºå¹´è½»ä»£å›æ”¶ã€‚PLABçš„ä½œç”¨æ˜¯é¿å…å¤šçº¿ç¨‹ç«äº‰ç›¸åŒçš„æ•°æ®,å¤„ç†æ–¹å¼æ˜¯æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„PLAB,ç”¨äºé’ˆå¯¹å¹¸å­˜è€…å’Œè€å¹´ç©ºé—´ã€‚å½“åº”ç”¨å¼€å¯çš„çº¿ç¨‹è¾ƒå¤šæ—¶,æœ€å¥½ä½¿ç”¨-XX:-ResizePlaBæ¥å…³é—­PLAB()çš„å¤§å°è°ƒæ•´,ä»¥é¿å…å¤§é‡çš„çº¿ç¨‹é€šä¿¡æ‰€å¯¼è‡´çš„æ€§èƒ½ä¸‹é™ã€‚</p><h3 id="TLAB"><a href="#TLAB" class="headerlink" title="TLAB"></a>TLAB</h3><p>å…¨ç§°ä¸ºThread Local Allocation Buffers,å³çº¿ç¨‹æœ¬åœ°åˆ†é…ç¼“å­˜,æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸“ç”¨çš„å†…å­˜åˆ†é…åŒºåŸŸã€‚</p><p>æ€»çš„æ¥è¯´,<font color="DeepPink">TLABæ˜¯ä¸ºäº†åŠ é€Ÿå¯¹è±¡åˆ†é…è€Œç”Ÿçš„</font>ã€‚ç”±äºå¯¹è±¡ä¸€èˆ¬ä¼šåˆ†é…åœ¨å †ä¸Š,è€Œå †æ˜¯å…¨å±€å…±äº«çš„ã€‚å› æ­¤åœ¨åŒä¸€æ—¶é—´,å¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åœ¨å †ä¸Šç”³è¯·ç©ºé—´ã€‚å› æ­¤,æ¯ä¸€æ¬¡å¯¹è±¡åˆ†é…éƒ½å¿…é¡»è¦è¿›è¡ŒåŒæ­¥,è€Œåœ¨ç«äº‰æ¿€çƒˆçš„åœºåˆåˆ†é…çš„æ•ˆç‡åˆä¼šè¿›ä¸€æ­¥ä¸‹é™ã€‚è€ƒè™‘åˆ°å¯¹è±¡åˆ†é…å‡ ä¹æ˜¯Javaæœ€æœ€å¸¸ç”¨çš„æ“ä½œ,æ‰€ä»¥JVMå°±ä½¿ç”¨äº†TLABè¿™ç§çº¿ç¨‹ä¸“å±çš„åŒºé—´æ¥é¿å…å¤šçº¿ç¨‹å†²çª,æé«˜å¯¹è±¡åˆ†é…çš„æ•ˆç‡ã€‚<font color="DeepPink">TLABæœ¬èº«å ç”¨äº†EdenåŒºçš„ç©ºé—´</font>,å³JVMä¼šä¸ºæ¯ä¸€ä¸ªJavaçº¿ç¨‹åˆ†é…ä¸€å—TLABç©ºé—´ã€‚</p><p><font color="DeepPink">å¯¹äºG1 GCæ¥è¯´,TLABæ˜¯Edençš„ä¸€ä¸ªRegion,è¢«ä¸€ä¸ªå•ä¸€çº¿ç¨‹ç”¨äºåˆ†é…èµ„æºã€‚ä¸»è¦ç”¨é€”æ˜¯è®©ä¸€ä¸ªçº¿ç¨‹é€šè¿‡æ ˆæ“ä½œæ–¹å¼ç‹¬äº«å†…å­˜ç©ºé—´,ç”¨äºå¯¹è±¡åˆ†é…,è¿™æ ·æ¯”å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«èµ„æºè¦å¿«å¾ˆå¤šã€‚å¦‚æœæ¯ä¸ªçº¿ç¨‹çš„åˆ†é…å†…å­˜ä¸å¤Ÿ,é‚£ä¹ˆå®ƒä¼šå»å…¨å±€å†…å­˜æ± ç”³è¯·æ–°çš„å†…å­˜ã€‚è¿™æ ·ä¹Ÿå°±æ˜¯è¯´,å¦‚æœTLABå€¼è®¾ç½®è¿‡å°,å®¹æ˜“é€ æˆé¢‘ç¹ç”³è¯·,ä¹Ÿå°±ä¼šé€ æˆGCæ€§èƒ½ä¸‹é™ã€‚åä¹‹,å¦‚æœè®¾ç½®è¿‡å¤§,ä¼šé€ æˆTLABä½¿ç”¨ä¸å®Œ,ä¹Ÿå°±æ˜¯è¯´å†…å­˜æµªè´¹ã€‚</font></p><h3 id="Region"><a href="#Region" class="headerlink" title="Region"></a>Region</h3><p>ä»å­—é¢ä¸Šæ¥è¯´, Regionè¡¨ç¤ºä¸€ä¸ªåŒºåŸŸ,æ¯ä¸ªåŒºåŸŸé‡Œé¢çš„å­—æ¯ä»£è¡¨ä¸åŒçš„åˆ†ä»£å†…å­˜ç©ºé—´ç±»å‹(å¦‚[E]Eden,[O]Old,[S]Survivor),<font color="DeepPink">ç©ºç™½çš„åŒºå—ä¸å±äºä»»ä½•ä¸€ä¸ªåˆ†åŒº</font>ã€‚G1å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™ä»»æ„æŒ‡å®šè¿™ä¸ªåŒºåŸŸå±äºEdenæˆ–æ˜¯OåŒºä¹‹ç±»çš„ã€‚</p><h3 id="Ergonomics-Heuristic-Decision"><a href="#Ergonomics-Heuristic-Decision" class="headerlink" title="Ergonomics Heuristic Decision"></a>Ergonomics Heuristic Decision</h3><p>åœ¨å¾ˆå¤šè‹±æ–‡ä¹¦é‡Œéƒ½èƒ½çœ‹åˆ°è¿™ä¸²å•è¯,ç‰¹åˆ«æ˜¯Ergonomics Heuristi,å®ƒä»¬çš„å­—é¢æ„æ€æ˜¯äººä½“å·¥ç¨‹å­¦,å¯ä»¥ç†è§£ä¸ºé€‚åˆäººç±»ç†è§£çš„è¡Œä¸ºã€ä¹ æƒ¯ã€‚GCæ—¥å¿—é‡Œé¢çœ‹åˆ°Ergonomicsè¿™ä¸ªå•è¯,å®ƒåé¢ä¸€èˆ¬è·Ÿç€çš„æ˜¯G1 GCç›¸å…³çš„è¯¦ç»†æè¿°,æ¯”å¦‚å †å†…å­˜æ—¥å¿—ã€CSetåˆ’åˆ†ç­‰,é€šå¸¸é‡‡ç”¨é€‰é¡¹-XX:+PrintAdaptiveSizePolicyæ—¶ä¼šçœ‹åˆ°è¿™ä¸ªå•è¯ã€‚</p><h3 id="Top-at-mark-start"><a href="#Top-at-mark-start" class="headerlink" title="Top-at-mark-start"></a>Top-at-mark-start</h3><p>æ¯ä¸ªåŒºé—´è®°å½•ç€ä¸¤ä¸ªTAMSæŒ‡é’ˆ(Top-at-mark-start),åˆ†åˆ«ä¸ºprevTAMSå’ŒnextTAMSåœ¨TAMSä»¥ä¸Šçš„å¯¹è±¡æ˜¯æ–°åˆ†é…çš„,å› è€Œè¢«è§†ä¸ºéšå¼æ ‡è®°ã€‚</p><h1 id="JVM-amp-GC-æ·±å…¥çŸ¥è¯†"><a href="#JVM-amp-GC-æ·±å…¥çŸ¥è¯†" class="headerlink" title="JVM&amp;GC æ·±å…¥çŸ¥è¯†"></a>JVM&amp;GC æ·±å…¥çŸ¥è¯†</h1><h2 id="Javaè™šæ‹Ÿæœºå†…å­˜æ¨¡å‹"><a href="#Javaè™šæ‹Ÿæœºå†…å­˜æ¨¡å‹" class="headerlink" title="Javaè™šæ‹Ÿæœºå†…å­˜æ¨¡å‹"></a>Javaè™šæ‹Ÿæœºå†…å­˜æ¨¡å‹</h2><p><img alt data-src="/images/java-jvm-gc-g1-note/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.png"></p><h3 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h3><p>ç¨‹åºè®¡æ•°å™¨,è‹±æ–‡å…¨ç§°Program Counter Register,å®ƒæ˜¯ä¸€å—å¾ˆå°çš„å†…å­˜ç©ºé—´,å®ƒæ˜¯è¿è¡Œé€Ÿåº¦æœ€å¿«çš„å­˜å‚¨åŒºåŸŸ,è¿™æ˜¯å› ä¸ºå®ƒä½äºä¸åŒäºå…¶ä»–å­˜å‚¨åŒºçš„åœ°æ–¹â€”å¤„ç†å™¨å†…éƒ¨ã€‚å¯„å­˜å™¨çš„æ•°é‡æå…¶æœ‰é™,æ‰€ä»¥å¯„å­˜å™¨ç”±ç¼–è¯‘å™¨æ ¹æ®éœ€æ±‚è¿›è¡Œåˆ†é…ã€‚å®é™…ä¸Šåœ¨Jaaåº”ç”¨ç¨‹åºå†…éƒ¨ä¸èƒ½ç›´æ¥æ§åˆ¶å¯„å­˜å™¨,ä¹Ÿä¸èƒ½åœ¨ç¨‹åºä¸­æ„Ÿè§‰åˆ°å¯„å­˜å™¨å­˜åœ¨çš„ä»»ä½•è¿¹è±¡ã€‚<font color="DeepPink">å¯ä»¥æŠŠç¨‹åºè®¡æ•°å™¨çœ‹ä½œå½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚åœ¨è™šæ‹Ÿæœºçš„æ¦‚å¿µæ¨¡å‹é‡Œ,å­—èŠ‚ç è§£é‡Šå™¨çš„å·¥ä½œå°±æ˜¯é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨çš„å€¼æ¥é€‰æ‹©ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤,åˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚</font></p><p>ç®€å•æ¦‚æ‹¬ä¸Šé¢çš„æè¿°,å³åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹,ä¸ºäº†è®©çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®,æ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨,å„ä¸ªçº¿ç¨‹ä¹‹é—´äº’ä¸å½±å“ã€ç‹¬ç«‹å­˜å‚¨,å› æ­¤è¿™å—å†…å­˜æ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚<font color="DeepPink">JVMä¸­çš„å¯„å­˜å™¨ç±»ä¼¼äºç‰©ç†å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ,æ­£å¦‚å‰é¢è¯´çš„,å®ƒæ˜¯çº¿ç¨‹ç§æœ‰çš„,æ‰€ä»¥ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ã€‚</font></p><p><font color="DeepPink">æ ¹æ®Javaè™šæ‹Ÿæœºå®šä¹‰æ¥çœ‹,ç¨‹åºå¯„å­˜å™¨åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•OutOfMemory Erroræƒ…å†µçš„åŒºåŸŸã€‚</font></p><h3 id="è™šæ‹Ÿæœºæ ˆ"><a href="#è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="è™šæ‹Ÿæœºæ ˆ"></a>è™šæ‹Ÿæœºæ ˆ</h3><p>JVMçš„æ¶æ„æ˜¯åŸºäºæ ˆçš„,å³ç¨‹åºæŒ‡ä»¤çš„æ¯ä¸€ä¸ªæ“ä½œéƒ½è¦ç»è¿‡å…¥æ ˆå’Œå‡ºæ ˆè¿™æ ·çš„ç»„åˆå‹æ“ä½œæ‰èƒ½å®Œæˆã€‚</p><p>æ€»çš„æ¥è¯´,æ ˆçš„ä¼˜åŠ¿æ˜¯è®¿é—®é€Ÿåº¦æ¯”å †è¦å¿«,å®ƒä»…æ¬¡äºå¯„å­˜å™¨,å¹¶ä¸”æ ˆæ•°æ®æ˜¯å¯ä»¥è¢«å…±äº«çš„æ ˆçš„ç¼ºç‚¹æ˜¯å­˜å‚¨åœ¨æ ˆé‡Œé¢çš„æ•°æ®å¤§å°ä¸ç”Ÿå­˜æœŸå¿…é¡»æ˜¯ç¡®å®šçš„,ä»è¿™ä¸€ç‚¹æ¥çœ‹,æ ˆæ˜æ˜¾ç¼ºä¹çµæ´»æ€§ã€‚è™šæ‹Ÿæœºæ ˆå†…ä¸»è¦è¢«ç”¨æ¥å­˜æ”¾ä¸€äº›åŸºæœ¬ç±»å‹çš„å˜é‡,ä¾‹å¦‚intã€ shortã€longã€byteã€foatã€ doubleã€booleaã€char,ä»¥åŠå¯¹è±¡å¼•ç”¨ã€‚</p><p>å‰é¢è¯´è¿‡,è™šæ‹Ÿæœºæ ˆæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ®Šæ€§,å°±æ˜¯å­˜æ”¾åœ¨æ ˆå†…çš„æ•°æ®å¯ä»¥å…±äº«ã€‚å‡è®¾åŒæ—¶å®šä¹‰:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int a=1;</span><br><span class="line">int b=1;</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸Šé¢çš„ä»£ç ,è™šæ‹Ÿæœºå¤„ç†ç¬¬ä¸€æ¡è¯­å¥,é¦–å…ˆå®ƒä¼šåœ¨æ ˆå†…åˆ›å»ºä¸€ä¸ªå˜é‡ä¸ºaçš„å¼•ç”¨,ç„¶åæŸ¥æ‰¾æ ˆå†…æ˜¯å¦æœ‰1è¿™ä¸ªå€¼,å¦‚æœæ²¡æ‰¾åˆ°,å°±å°†1å­˜æ”¾è¿›æ¥,ç„¶åå°†aæŒ‡å‘1ã€‚æ¥ä¸‹æ¥å¤„ç†ç¬¬äºŒæ¡è¯­å¥,åœ¨åˆ›å»ºå®Œbçš„å¼•ç”¨å˜é‡å,å› ä¸ºåœ¨æ ˆå†…å·²ç»æœ‰1è¿™ä¸ªå€¼,ä¾¿å°†bç›´æ¥æŒ‡å‘1ã€‚è¿™æ ·,å°±å‡ºç°äº†aä¸båŒæ—¶å‡æŒ‡å‘1çš„æƒ…å†µã€‚è¿™æ—¶,å¦‚æœå­˜åœ¨ç¬¬ä¸‰æ¡è¯­å¥,å®ƒé’ˆå¯¹aå†æ¬¡å®šä¹‰ä¸ºa=4,é‚£ä¹ˆç¼–è¯‘å™¨ä¼šé‡æ–°æœç´¢æ ˆå†…æ˜¯å¦æœ‰4å€¼,å¦‚æœæ²¡æœ‰,åˆ™å°†4å­˜æ”¾è¿›æ¥,å¹¶ä»¤aæŒ‡å‘4,å¦‚æœå·²ç»æœ‰äº†,åˆ™ç›´æ¥å°†aæŒ‡å‘è¿™ä¸ªåœ°å€,å› æ­¤aå€¼çš„æ”¹å˜ä¸ä¼šå½±å“åˆ°bçš„å€¼ã€‚è¦æ³¨æ„è¿™ç§æ•°æ®çš„å…±äº«ä¸ä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨åŒæ—¶æŒ‡å‘ä¸€ä¸ªå¯¹è±¡çš„è¿™ç§å…±äº«çš„æ–¹å¼å­˜åœ¨æ˜æ˜¾çš„ä¸åŒ,å› ä¸ºè¿™ç§æƒ…å†µaçš„ä¿®æ”¹å¹¶ä¸ä¼šå½±å“åˆ°b,å®ƒæ˜¯ç”±è™šæ‹Ÿæœºå®Œæˆçš„,è¿™æ ·çš„åšæ³•æœ‰åˆ©äºèŠ‚çœç©ºé—´ã€‚è€Œä¸€ä¸ªå¯¹è±¡å¼•ç”¨å˜é‡ä¿®æ”¹äº†è¿™ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€,ä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡å¼•ç”¨å˜é‡ã€‚</p><p>ä¸ç¨‹åºè®¡æ•°å™¨ä¸€æ ·,<font color="DeepPink">Javaè™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„å†…å­˜ç©ºé—´,å®ƒå’ŒJavaçº¿ç¨‹åœ¨åŒä¸€æ—¶é—´åˆ›å»º,å®ƒä¿å­˜æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœ,å¹¶å‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›</font>ã€‚</p><p>è™šæ‹Ÿæœºæ ˆåœ¨è¿è¡Œæ—¶ä½¿ç”¨ä¸€ç§å«ä½œæ ˆå¸§çš„æ•°æ®ç»“æ„ä¿å­˜ä¸Šä¸‹æ–‡æ•°æ®,æ ˆå¸§é‡Œé¢å­˜æ”¾äº†æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥æ–¹æ³•å’Œè¿”å›åœ°å€ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼´éšç€æ ˆå¸§çš„å…¥æ ˆæ“ä½œ,ç›¸åº”åœ°,æ–¹æ³•çš„è¿”å›åˆ™è¡¨ç¤ºæ ˆå¸§çš„å‡ºæ ˆæ“ä½œã€‚<br><img alt data-src="/images/java-jvm-gc-g1-note/%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%E5%BC%95%E7%94%A8%E5%9B%BE.png"></p><blockquote><p>ä½¿ç”¨JClassLibå·¥å…·å¯ä»¥æŸ¥çœ‹Classæ–‡ä»¶ä¸­æ¯ä¸ªæ–¹æ³•æ‰€åˆ†é…çš„æœ€å¤§å±€éƒ¨å˜é‡åŒºçš„å®¹é‡ã€‚JClassLibå·¥å…·æ˜¯å¼€æºè½¯ä»¶,å®ƒå¯ä»¥ç”¨äºæŸ¥çœ‹ Classæ–‡ä»¶çš„ç»“æ„,åŒ…æ‹¬å¸¸é‡æ± ã€æ¥å£ã€å±æ€§ã€æ–¹æ³•,è¿˜å¯ä»¥ç”¨äºæŸ¥çœ‹æ–‡ä»¶çš„å­—èŠ‚ç ã€‚</p></blockquote><h3 id="Javaå †"><a href="#Javaå †" class="headerlink" title="Javaå †"></a>Javaå †</h3><p>Javaå †åŒºåœ¨JVMå¯åŠ¨çš„æ—¶å€™å³è¢«åˆ›å»º,å®ƒåªè¦æ±‚é€»è¾‘ä¸Šæ˜¯è¿ç»­çš„,åœ¨ç‰©ç†ç©ºé—´ä¸Šå¯ä»¥æ˜¯ä¸è¿ç»­ã€‚æ‰€æœ‰çš„çº¿ç¨‹å…±äº«Javaå †,åœ¨è¿™é‡Œå¯ä»¥åˆ’åˆ†çº¿ç¨‹ç§æœ‰çš„ç¼“å†²åŒº(Thread Local Allocation Buffer,TLAB)ã€‚</p><p>æ­£æ˜¯å› ä¸ºJavaå †åŒºæ˜¯GCçš„é‡ç‚¹å›æ”¶åŒºåŸŸ,æ‰€ä»¥GCææœ‰å¯èƒ½ä¼šåœ¨å¤§å†…å­˜çš„ä½¿ç”¨å’Œé¢‘ç¹è¿›è¡Œåƒåœ¾å›æ”¶è¿‡ç¨‹ä¸Šæˆä¸ºç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜,JVMçš„è®¾è®¡è€…ä»¬å¼€å§‹è€ƒè™‘æ˜¯å¦ä¸€å®šéœ€è¦å°†å¯¹è±¡å®ä¾‹å­˜å‚¨åˆ°Javaå †åŒºå†…ã€‚åŸºäºOpenJDKæ·±åº¦å®šåˆ¶çš„TaobaoJVM,å…¶ä¸­åˆ›æ–°çš„GCIH(GC invisible heap)æŠ€æœ¯å®ç°äº†off-heap,å³å°†ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„Javaå¯¹è±¡ä»heapä¸­ç§»åˆ°heapä¹‹å¤–,å¹¶ä¸”GCä¸èƒ½ç®¡ç†GCHå†…éƒ¨çš„Javaå¯¹è±¡,ä»¥æ­¤è¾¾åˆ°é™ä½GCçš„å›æ”¶é¢‘ç‡å’Œæå‡GCçš„å›æ”¶æ•ˆç‡çš„ç›®çš„ã€‚</p><h3 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h3><p><font color="DeepPink">æ–¹æ³•åŒºä¸»è¦ä¿å­˜çš„ä¿¡æ¯æ˜¯ç±»çš„å…ƒæ•°æ®</font>ã€‚æ–¹æ³•åŒºä¸å †ç©ºé—´ç±»ä¼¼,å®ƒä¹Ÿæ˜¯è¢«JVMä¸­æ‰€æœ‰çš„çº¿ç¨‹å…±äº«çš„åŒºåŸŸã€‚å¦‚ä¸‹å›¾æ‰€ç¤º,æ–¹æ³•åŒºä¸­æœ€ä¸ºé‡è¦çš„æ˜¯ç±»çš„ç±»å‹ä¿¡æ¯ã€å¸¸é‡æ± ã€åŸŸä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€‚ç±»å‹ä¿¡æ¯åŒ…æ‹¬ç±»çš„å®Œæ•´åç§°ã€çˆ¶ç±»çš„å®Œæ•´åç§°ã€ç±»å‹ä¿®é¥°ç¬¦(public/protected/private)å’Œç±»å‹çš„ç›´æ¥æ¥å£ç±»è¡¨ã€‚<br><img alt data-src="/images/java-jvm-gc-g1-note/%E6%96%B9%E6%B3%95%E5%8C%BA%E7%BB%84%E6%88%90%E5%9B%BE.png"></p><p><font color="DeepPink">å¸¸é‡æ± åŒ…æ‹¬ç±»æ–¹æ³•ã€åŸŸç­‰ä¿¡æ¯æ‰€å¼•ç”¨çš„å¸¸é‡ä¿¡æ¯ã€‚åŸŸä¿¡æ¯åŒ…æ‹¬åŸŸåç§°ã€åŸŸç±»å‹å’ŒåŸŸä¿®é¥°ç¬¦æ–¹æ³•ä¿¡æ¯åŒ…æ‹¬æ–¹æ³•åç§°ã€è¿”å›ç±»å‹ã€æ–¹æ³•å‚æ•°ã€æ–¹æ³•ä¿®é¥°ç¬¦ã€æ–¹æ³•å­—èŠ‚ç ã€æ“ä½œæ•°æ ˆå’Œæ–¹æ³•æ ˆå¸§çš„å±€éƒ¨å˜é‡åŒºå¤§å°ä»¥åŠå¼‚å¸¸è¡¨ã€‚æ–¹æ³•åŒºæ˜¯çº¿ç¨‹é—´å…±äº«çš„,å½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶éœ€è¦åŠ è½½ä¸€ä¸ªç±»å‹æ—¶,åªæœ‰ä¸€ä¸ªç±»ä¼šè¯·æ±‚ClassLoaderåŠ è½½,å¦ä¸€ä¸ªçº¿ç¨‹åˆ™ä¼šç­‰å¾…ã€‚æ€»è€Œè¨€ä¹‹,æ–¹æ³•åŒºå†…ä¿å­˜çš„ä¿¡æ¯å¤§éƒ¨åˆ†æ¥è‡ªäºClassä»¶,æ˜¯Javaåº”ç”¨ç¨‹åºè¿è¡Œå¿…ä¸å¯å°‘çš„é‡è¦æ•°æ®ã€‚</font></p><p>åœ¨Hotspotè™šæ‹Ÿæœºä¸­,æ–¹æ³•åŒºä¹Ÿè¢«ç§°ä¸ºæ°¸ä¹…åŒº,æ˜¯ä¸€å—ç‹¬ç«‹äºJavaå †çš„å†…å­˜ç©ºé—´ã€‚è™½ç„¶è¢«å«ä½œæ°¸ä¹…åŒº,ä½†æ˜¯åœ¨æ°¸ä¹…åŒºä¸­çš„å¯¹è±¡åŒæ ·ä¹Ÿæ˜¯å¯ä»¥è¢«GCå›æ”¶çš„,åªæ˜¯å¯¹äºGCçš„å¯¹åº”ç­–ç•¥ä¸Javaå †ç©ºé—´ç•¥æœ‰ä¸åŒã€‚</p><p>GCé’ˆå¯¹æ°¸ä¹…åŒºçš„å›æ”¶,é€šå¸¸ä¸»è¦ä»ä¸¤ä¸ªæ–¹é¢åˆ†æ:ä¸€æ˜¯GCå¯¹æ°¸ä¹…åŒºå¸¸é‡æ± çš„å›æ”¶,äºŒæ˜¯æ°¸ä¹…åŒºå¯¹ç±»å…ƒæ•°æ®çš„å›æ”¶ã€‚HotSpotè™šæ‹Ÿæœºå¯¹å¸¸é‡æ± çš„å›æ”¶ç­–ç•¥æ˜¯å¾ˆæ˜ç¡®çš„,åªè¦å¸¸é‡æ± ä¸­çš„å¸¸é‡æ²¡æœ‰è¢«ä»»ä½•åœ°æ–¹å¼•ç”¨ï¼Œå°±å¯ä»¥è¢«å›æ”¶ã€‚</p><h2 id="åƒåœ¾æ”¶é›†ç®—æ³•"><a href="#åƒåœ¾æ”¶é›†ç®—æ³•" class="headerlink" title="åƒåœ¾æ”¶é›†ç®—æ³•"></a>åƒåœ¾æ”¶é›†ç®—æ³•</h2><h3 id="æ ¹æœç´¢ç®—æ³•"><a href="#æ ¹æœç´¢ç®—æ³•" class="headerlink" title="æ ¹æœç´¢ç®—æ³•"></a>æ ¹æœç´¢ç®—æ³•</h3><p><font color="DeepPink">åœ¨HotSpotä¸­,æ ¹å¯¹è±¡é›†åˆä¸­åŒ…å«äº†5ä¸ªå…ƒç´ ,Javaæ ˆå†…çš„å¯¹è±¡å¼•ç”¨ã€æœ¬åœ°æ–¹æ³•æ ˆå†…çš„å¯¹è±¡å¼•ç”¨ã€è¿è¡Œæ—¶å¸¸é‡æ± ä¸­çš„å¯¹è±¡å¼•ç”¨ã€æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§çš„å¯¹è±¡å¼•ç”¨ä»¥åŠä¸ä¸€ä¸ªç±»å¯¹åº”çš„å”¯ä¸€æ•°æ®ç±»å‹çš„Classå¯¹è±¡ã€‚</font></p><blockquote><p>è¿™éƒ¨åˆ†äº†è§£ä¸€ä¸‹å°±å¥½<br>æ³¨æ„,åœ¨æ ¹æœç´¢ç®—æ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡,ä¹Ÿå¹¶éæ˜¯â€œéæ­»ä¸å¯â€çš„,è¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºâ€œç¼“åˆ‘â€é˜¶æ®µ,è¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡,è‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ã€‚å¦‚æœå¯¹è±¡åœ¨è¿›è¡Œæ ¹æœç´¢åå‘ç°æ²¡æœ‰ä¸GC Rootsç›¸è¿æ¥çš„å¼•ç”¨é“¾,é‚£å®ƒå°†ä¼šè¢«ç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰,ç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalizeæ–¹æ³•ã€‚å½“å¯¹è±¡æ²¡æœ‰è¦†ç›–finalizeæ–¹æ³•,æˆ–è€…finalizedæ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡,è™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µéƒ½è§†ä¸ºâ€œæ²¡æœ‰å¿…è¦æ‰§è¡Œâ€ã€‚å¦‚æœè¿™ä¸ªå¯¹è±¡è¢«åˆ¤å®šä¸ºæœ‰å¿…è¦æ‰§è¡Œfinalizeæ–¹æ³•,é‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†ä¼šè¢«æ”¾ç½®åœ¨ä¸€ä¸ªåä¸ºF-Queueçš„é˜Ÿåˆ—ä¹‹ä¸­,å¹¶åœ¨ç¨åç”±æ¡ç”±è™šæ‹Ÿæœºè‡ªåŠ¨å»ºç«‹çš„ã€ä½ä¼˜å…ˆçº§çš„Finalizerçº¿ç¨‹å»æ‰§è¡Œã€‚è¿™é‡Œæ‰€è°“çš„â€œæ‰§è¡Œâ€æ˜¯æŒ‡è™šæ‹Ÿæœºä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•,ä½†å¹¶ä¸æ‰¿è¯ºä¼šç­‰å¾…å®ƒè¿è¡Œç»“æŸã€‚è¿™æ ·åšçš„åŸå› æ˜¯,å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨finalizeæ–¹æ³•ä¸­æ‰§è¡Œç¼“æ…¢,æˆ–è€…å‘ç”Ÿäº†æ­»å¾ªç¯(æ›´æç«¯çš„æƒ…å†µ),å¾ˆå¯èƒ½ä¼šå¯¼è‡´F-Queueé˜Ÿåˆ—ä¸­çš„å…¶ä»–å¯¹è±¡æ°¸ä¹…å¤„äºç­‰å¾…çŠ¶æ€,ç”šè‡³å¯¼è‡´æ•´ä¸ªå†…å­˜å›æ”¶ç³»ç»Ÿå´©æºƒã€‚finalize()æ–¹æ³•æ˜¯å¯¹è±¡é€ƒè„±æ­»äº¡å‘½è¿çš„æœ€åä¸€æ¬¡æœºä¼š,ç¨åGCå°†å¯¹F-Queueä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡å°è§„æ¨¡çš„æ ‡è®°,å¦‚æœå¯¹è±¡è¦åœ¨finalizedä¸­æˆåŠŸæ‹¯æ•‘è‡ªå·±â€”åªè¦é‡æ–°ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹å…³è”å³å¯,è­¬å¦‚æŠŠè‡ªå·±(thiså…³é”®å­—)èµ‹å€¼ç»™æŸä¸ªç±»å˜é‡æˆ–å¯¹è±¡çš„æˆå‘˜å˜é‡,é‚£åœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶å®ƒå°†è¢«ç§»é™¤å‡ºâ€œå³å°†å›æ”¶â€çš„é›†åˆã€‚å¦‚æœå¯¹è±¡è¿™æ—¶å€™è¿˜æ²¡æœ‰é€ƒè„±,é‚£å®ƒå°±çœŸçš„ç¦»æ­»ä¸è¿œäº†ã€‚</p></blockquote><h3 id="æ ‡è®°æ¸…é™¤ç®—æ³•-Mark-Sweep"><a href="#æ ‡è®°æ¸…é™¤ç®—æ³•-Mark-Sweep" class="headerlink" title="æ ‡è®°æ¸…é™¤ç®—æ³•(Mark-Sweep)"></a>æ ‡è®°æ¸…é™¤ç®—æ³•(Mark-Sweep)</h3><p>ç®—æ³•æ¶‰åŠå‡ ä¸ªæ¦‚å¿µ,å…ˆæ¥äº†è§£ä¸€ä¸‹mutatorå’Œcollector,è¿™ä¸¤ä¸ªåè¯ç»å¸¸åœ¨åƒåœ¾æ”¶é›†ç®—æ³•ä¸­å‡ºç°,<font color="DeepPink">collectoræŒ‡çš„å°±æ˜¯åƒåœ¾æ”¶é›†å™¨,è€Œ mutatoræ˜¯æŒ‡é™¤äº†åƒåœ¾æ”¶é›†å™¨ä¹‹å¤–çš„éƒ¨åˆ†,æ¯”å¦‚è¯´æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæœ¬èº«ã€‚</font>mutatorçš„èŒè´£ä¸€èˆ¬æ˜¯NEW(åˆ†é…å†…å­˜)ã€READ(ä»å†…å­˜ä¸­è¯»å–å†…å®¹)ã€WRITE(å°†å†…å®¹å†™å…¥å†…å­˜),è€Œcollectoråˆ™å°±æ˜¯å›æ”¶ä¸å†ä½¿ç”¨çš„å†…å­˜æ¥ä¾›mutatorè¿›è¡ŒNEWæ“ä½œçš„ä½¿ç”¨ã€‚mutatoræ ¹å¯¹è±¡ä¸€èˆ¬æŒ‡çš„æ˜¯åˆ†é…åœ¨å †å†…å­˜ä¹‹å¤–,å¯ä»¥ç›´æ¥è¢«mutatorç›´æ¥è®¿é—®åˆ°çš„å¯¹è±¡,ä¸€èˆ¬æ˜¯æŒ‡é™æ€/å…¨å±€å˜é‡ä»¥åŠThreadLocalå˜é‡ã€‚</p><h3 id="å¤åˆ¶ç®—æ³•-Copying"><a href="#å¤åˆ¶ç®—æ³•-Copying" class="headerlink" title="å¤åˆ¶ç®—æ³•(Copying)"></a>å¤åˆ¶ç®—æ³•(Copying)</h3><p>åŸºäºåˆ†ä»£çš„æ¦‚å¿µ,Javaå †åŒºå¦‚æœè¿˜è¦æ›´è¿›ä¸€æ­¥ç»†åˆ†çš„è¯,è¿˜å¯ä»¥åˆ’åˆ†ä¸ºå¹´è½»ä»£(Young Gen)å’Œè€å¹´ä»£(OldEn),å…¶ä¸­å¹´è½»ä»£åˆå¯ä»¥è¢«åˆ’åˆ†ä¸ºEdenç©ºé—´ã€From Survivorç©ºé—´å’ŒTo Survivorç©ºé—´ã€‚<font color="DeepPink">åœ¨HotSpotä¸­,Edenç©ºé—´å’Œå¦å¤–ä¸¤ä¸ªSurvivorç©ºé—´é»˜è®¤æ‰€å çš„æ¯”ä¾‹æ˜¯8:1,å½“ç„¶å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹â€œ-XX:SurvivorRatioâ€è°ƒæ•´è¿™ä¸ªç©ºé—´æ¯”ä¾‹</font>ã€‚å½“æ‰§è¡Œä¸€æ¬¡Minor GC(å¹´è½»ä»£çš„åƒåœ¾å›æ”¶),Edenç©ºé—´ä¸­çš„å­˜æ´»å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ°Toç©ºé—´å†…,å¹¶ä¸”ä¹‹å‰å·²ç»ç»å†è¿‡ä¸€æ¬¡ Minor GCå¹¶åœ¨Fromç©ºé—´ä¸­å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å¦‚æœè¿˜å¹´è½»çš„è¯åŒæ ·ä¹Ÿä¼šè¢«å¤åˆ¶åˆ°Toç©ºé—´å†…ã€‚éœ€è¦æ³¨æ„çš„æ˜¯,åœ¨æ»¡è¶³ä¸¤ç§ç‰¹æ®Šæƒ…å†µä¸‹,Edenå’ŒFromç©ºé—´ä¸­çš„å­˜æ´»å¯¹è±¡å°†ä¸ä¼šè¢«å¤åˆ¶åˆ°Toç©ºé—´å†…ã€‚é¦–å…ˆæ˜¯å¦‚æœå­˜æ´»å¯¹è±¡çš„åˆ†ä»£å¹´é¾„è¶…è¿‡é€‰é¡¹â€œ-XX:MaxTenuringThresholdâ€æ‰€æŒ‡å®šçš„é˜ˆå€¼æ—¶,å°†ä¼šç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å…¶æ¬¡å½“Toç©ºé—´çš„å®¹é‡è¾¾åˆ°é˜ˆå€¼æ—¶,å­˜æ´»å¯¹è±¡åŒæ ·ä¹Ÿæ˜¯ç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å½“æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡éƒ½è¢«å¤åˆ¶åˆ°Toç©ºé—´æˆ–è€…æ™‹å‡åˆ°è€å¹´ä»£å,å‰©ä¸‹çš„å‡ä¸ºåƒåœ¾å¯¹è±¡,è¿™å°±æ„å‘³ç€GCå¯ä»¥å¯¹è¿™äº›å·²ç»æ­»äº¡äº†çš„å¯¹è±¡æ‰§è¡Œä¸€æ¬¡Minor GC,é‡Šæ”¾æ‰å…¶æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p><h3 id="æ ‡è®°å‹ç¼©ç®—æ³•-Mark-Compact"><a href="#æ ‡è®°å‹ç¼©ç®—æ³•-Mark-Compact" class="headerlink" title="æ ‡è®°å‹ç¼©ç®—æ³•(Mark-Compact)"></a>æ ‡è®°å‹ç¼©ç®—æ³•(Mark-Compact)</h3><p>åœ¨HotSpotä¸­,åŸºäºåˆ†ä»£çš„æ¦‚å¿µ,GCæ‰€ä½¿ç”¨çš„å†…å­˜å›æ”¶ç®—æ³•å¿…é¡»ç»“åˆå¹´è½»ä»£å’Œè€å¹´ä»£å„è‡ªçš„ç‰¹ç‚¹ã€‚ç®€å•æ¥è¯´,å°±æ˜¯é’ˆå¯¹ä¸åŒçš„ä»£ç©ºé—´,ä»è€Œç»“åˆä½¿ç”¨ä¸åŒçš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚<font color="DeepPink">ä¸ºå¹´è½»ä»£é€‰æ‹©çš„åƒåœ¾æ”¶é›†ç®—æ³•é€šå¸¸æ˜¯ä»¥é€Ÿåº¦ä¼˜å…ˆ,å› ä¸ºå¹´è½»ä»£ä¸­æ‰€å­˜å‚¨çš„ç¬æ—¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸéå¸¸çŸ­æš‚,å¯ä»¥æœ‰é’ˆå¯¹æ€§åœ°ä½¿ç”¨å¤åˆ¶ç®—æ³•,å› æ­¤æ‰§è¡ŒMinor GCæ—¶,ä¸€å®šè¦ä¿æŒé«˜æ•ˆå’Œå¿«é€Ÿã€‚è€Œå¹´è½»ä»£ä¸­çš„ç”Ÿå­˜ç©ºé—´é€šå¸¸éƒ½æ¯”è¾ƒå°,æ‰€ä»¥å›æ”¶å¹´è½»ä»£æ—¶ä¸€å®šä¼šéå¸¸é¢‘ç¹ã€‚ä½†è€å¹´ä»£é€šå¸¸ä½¿ç”¨æ›´èŠ‚çœå†…å­˜çš„å›æ”¶ç®—æ³•,å› ä¸ºè€å¹´ä»£ä¸­æ‰€å­˜å‚¨çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸéƒ½éå¸¸é•¿,å¹¶ä¸”è€å¹´ä»£å æ®äº†å¤§éƒ¨åˆ†çš„å †ç©ºé—´æ‰€ä»¥è€å¹´ä»£çš„Full GCå¹¶ä¸ä¼šè·Ÿå¹´è½»ä»£çš„Minor GCä¸€æ ·é¢‘ç¹,ä¸è¿‡ä¸€æ—¦ç¨‹åºä¸­å‘ç”Ÿä¸€æ¬¡Full GC,å°†ä¼šè€—è´¹æ›´é•¿çš„æ—¶é—´æ¥å®Œæˆ,é‚£ä¹ˆåœ¨è€å¹´ä»£ä¸­ä½¿ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•æˆ–è€…æ ‡è®°-å‹ç¼©ç®—æ³•æ‰§è¡Œåƒåœ¾å›æ”¶å°†ä¼šæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</font></p><h2 id="Garbage-Collection"><a href="#Garbage-Collection" class="headerlink" title="Garbage Collection"></a>Garbage Collection</h2><h3 id="GC-æ¦‚å¿µ"><a href="#GC-æ¦‚å¿µ" class="headerlink" title="GC æ¦‚å¿µ"></a>GC æ¦‚å¿µ</h3><p>åœ¨è®¸å¤šæƒ…å†µä¸‹,GCä¸åº”è¯¥æˆä¸ºå½±å“ç³»ç»Ÿæ€§èƒ½çš„ç“¶é¢ˆ,å¯ä»¥æ ¹æ®ä»¥ä¸‹å…­ç‚¹æ¥è¯„ä¼°ä¸€æ¬¾GCçš„æ€§èƒ½ã€‚</p><ul><li>ååé‡ï¼šç¨‹åºçš„è¿è¡Œæ—¶é—´(ç¨‹åºçš„è¿è¡Œæ—¶é—´+å†…å­˜å›æ”¶çš„æ—¶é—´)ã€‚</li><li>åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°,åƒåœ¾æ”¶é›†å™¨æ‰€å æ—¶é—´ä¸æ€»æ—¶é—´çš„æ¯”ä¾‹ã€‚</li><li>æš‚åœæ—¶é—´ï¼šæ‰§è¡Œåƒåœ¾æ”¶é›†æ—¶,ç¨‹åºçš„å·¥ä½œçº¿ç¨‹è¢«æš‚åœçš„æ—¶é—´ã€‚</li><li>æ”¶é›†é¢‘ç‡ï¼šç›¸å¯¹äºåº”ç”¨ç¨‹åºçš„æ‰§è¡Œ,æ”¶é›†æ“ä½œå‘ç”Ÿçš„é¢‘ç‡ã€‚</li><li>å †ç©ºé—´ï¼šJavaå †åŒºæ‰€å çš„å†…å­˜å¤§å°ã€‚</li><li>å¿«é€Ÿï¼šä¸€ä¸ªå¯¹è±¡ä»è¯ç”Ÿåˆ°è¢«å›æ”¶æ‰€ç»å†çš„æ—¶é—´ã€‚</li></ul><h3 id="Parallelæ”¶é›†å™¨"><a href="#Parallelæ”¶é›†å™¨" class="headerlink" title="Parallelæ”¶é›†å™¨"></a>Parallelæ”¶é›†å™¨</h3><p><font color="DeepPink">éœ€è¦æ³¨æ„çš„æ˜¯,åƒåœ¾æ”¶é›†å™¨ä¸­ååé‡å’Œä½å»¶è¿Ÿè¿™ä¸¤ä¸ªç›®æ ‡æœ¬èº«æ˜¯ç›¸äº’çŸ›ç›¾çš„,å› ä¸ºå¦‚æœé€‰æ‹©ä»¥ååé‡ä¼˜å…ˆ,é‚£ä¹ˆå¿…ç„¶éœ€è¦é™ä½å†…å­˜å›æ”¶çš„æ‰§è¡Œé¢‘ç‡,ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´GCéœ€è¦æ›´é•¿çš„æš‚åœæ—¶é—´æ¥æ‰§è¡Œå†…å­˜å›æ”¶ã€‚ç›¸åçš„,å¦‚æœé€‰æ‹©ä»¥ä½å»¶è¿Ÿä¼˜å…ˆä¸ºåŸåˆ™,é‚£ä¹ˆä¸ºäº†é™ä½æ¯æ¬¡æ‰§è¡Œå†…å­˜å›æ”¶æ—¶çš„æš‚åœæ—¶é—´,ä¹Ÿåªèƒ½é¢‘ç¹åœ°æ‰§è¡Œå†…å­˜å›æ”¶,ä½†è¿™åˆå¼•èµ·äº†å¹´è½»ä»£å†…å­˜çš„ç¼©å‡å’Œå¯¼è‡´ç¨‹åºååé‡çš„ä¸‹é™ã€‚</font></p><p>ä¸¾ä¸ªä¾‹å­,åœ¨60sçš„JVMæ€»è¿è¡Œæ—¶é—´é‡Œ,GCçš„æ‰§è¡Œé¢‘ç‡æ˜¯20ç§’/æ¬¡,é‚£ä¹ˆ60så†…ä¸€å…±ä¼šæ‰§è¡Œ3æ¬¡å†…å­˜å›æ”¶,æŒ‰ç…§æ¯æ¬¡GCè€—æ—¶100msæ¥è®¡ç®—,æœ€ç»ˆä¸€å…±ä¼šæœ‰300ms(3Ã—100)è¢«ç”¨äºæ‰§è¡Œåƒåœ¾å›æ”¶ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†é€‰é¡¹â€œ-XX:MaxGCPauseMillsâ€çš„å€¼è°ƒå°å,å¹´è½»ä»£çš„å†…å­˜ç©ºé—´ä¹Ÿä¼šè‡ªåŠ¨è°ƒæ•´,å†…å­˜ç©ºé—´è¶Šå°å°±è¶Šå®¹æ˜“è¢«è€—å°½,ä¹Ÿå°±è¶Šå®¹æ˜“é€ æˆGCçš„æ‰§è¡Œé¢‘ç¹å‘ç”Ÿã€‚ä¹‹å‰åœ¨60sçš„JVMæ€»è¿è¡Œæ—¶é—´é‡Œ,æœ€ç»ˆä¼šæœ‰300msè¢«ç”¨äºæ‰§è¡Œå†…å­˜å›æ”¶,è€Œå¦‚ä»ŠGCçš„æ‰§è¡Œé¢‘ç‡å´æ˜¯10s/æ¬¡,60så†…å°†ä¼šæ‰§è¡Œ6æ¬¡å†…å­˜å›æ”¶,æŒ‰ç…§æ¯æ¬¡GCè€—æ—¶60msæ¥è®¡ç®—,è™½ç„¶çœ‹ä¸Šå»æš‚åœæ—¶é—´æ›´çŸ­äº†,ä½†æœ€ç»ˆä¼šè€—æ—¶360ms(6Ã—60)ç”¨äºæ‰§è¡Œå†…å­˜å›æ”¶,å¾ˆæ˜æ˜¾ç¨‹åºçš„ååé‡ä¸‹é™äº†ã€‚æ‰€ä»¥å¤§å®¶åœ¨è®¾ç½®è¿™ä¸¤ä¸ªé€‰é¡¹æ—¶,ä¸€å®šéœ€è¦æ³¨æ„æ§åˆ¶åœ¨ä¸€ä¸ªæŠ˜ä¸­çš„èŒƒå›´ä¹‹å†…ã€‚Parallelæ”¶é›†å™¨è¿˜æä¾›ä¸ªâ€œ-XX:UseAdaptiveSizePolicyâ€é€‰é¡¹ç”¨äºè®¾ç½®GCçš„è‡ªåŠ¨åˆ†ä»£å¤§å°è°ƒèŠ‚ç­–ç•¥,ä¸€æ—¦è®¾ç½®è¿™ä¸ªé€‰é¡¹å,å°±æ„å‘³ç€å¼€å‘äººå‘˜å°†ä¸å†éœ€è¦æ˜¾å¼åœ°è®¾ç½®å¹´è½»ä»£ä¸­çš„ä¸€äº›ç»†èŠ‚å‚æ•°,JVMä¼šæ ¹æ®è‡ªèº«å½“å‰çš„è¿è¡Œæƒ…å†µåŠ¨æ€è°ƒæ•´è¿™äº›ç›¸å…³å‚æ•°ã€‚</p><h3 id="Garbage-First-G1-GC"><a href="#Garbage-First-G1-GC" class="headerlink" title="Garbage First (G1) GC"></a>Garbage First (G1) GC</h3><p><font color="DeepPink">G1å¾ˆé‡è§†è€å¹´ä»£çš„åƒåœ¾å›æ”¶,ä¸€æ—¦æ•´ä¸ªå †ç©ºé—´å æœ‰ç‡è¾¾åˆ°æŒ‡å®šçš„é˜ˆå€¼(å¯åŠ¨æ—¶å¯é…ç½®),G1ä¼šç«‹å³å¯åŠ¨ä¸€ä¸ªç‹¬å çš„å¹¶è¡Œåˆå§‹æ ‡è®°é˜¶æ®µ(inil-mark phase)è¿›è¡Œåƒåœ¾å›æ”¶ã€‚åœ¨G1 GC,åˆ¤æ–­çš„æ˜¯æ•´ä¸ªJavaå †å†…éƒ¨è€å¹´ä»£çš„å æœ‰ç‡,è¶³ä»¥è§G1å¯¹è€å¹´ä»£çš„é‡è§†ã€‚</font></p><p>åˆå§‹æ ‡è®°é˜¶æ®µä¸€èˆ¬å’Œå¹´è½»ä»£GCä¸€èµ·è¿è¡Œ,ä¸€æ—¦åˆå§‹æ ‡è®°é˜¶æ®µç»“æŸ,å¹¶è¡Œå¤šçº¿ç¨‹çš„æ ‡è®°é˜¶æ®µå°±å¼€å§‹å¯åŠ¨å»æ ‡è®°æ‰€æœ‰è€å¹´ä»£è¿˜å­˜æ´»çš„å¯¹è±¡,æ³¨æ„è¿™ä¸ªæ ‡è®°é˜¶æ®µä¸æ˜¯ç‹¬å å¼çš„,å®ƒå…è®¸åº”ç”¨ç¨‹åºçº¿ç¨‹å’Œå®ƒå¹¶è¡Œæ‰§è¡Œã€‚å½“è¿™ä¸ªæ ‡è®°é˜¶æ®µè¿è¡Œå®Œæ¯•ä¹‹å,ä¸ºäº†å†æ¬¡ç¡®è®¤æ˜¯å¦æœ‰é€ƒè¿‡æ‰«æçš„å¯¹è±¡,â€œå¯åŠ¨ä¸€ä¸ªç‹¬å å¼çš„å†æ¬¡æ ‡è®°é˜¶æ®µ(remark phase),å°è¯•æ ‡è®°æ‰€æœ‰é—æ¼çš„å¯¹è±¡ã€‚åœ¨è¿™ä¸ªå†æ¬¡æ ‡è®°é˜¶æ®µç»“æŸä¹‹å,G1å°±æŒæ¡äº†æ‰€æœ‰çš„è€å¹´ä»£ Regionçš„æ ‡è®°ä¿¡æ¯,è¿™å’Œå›½å®¶çš„æˆ·å£ç»Ÿè®¡æ–¹å¼å·®ä¸å¤šã€‚ä¸€æ—¦è€å¹´ä»£çš„æŸäº›Regionå†…éƒ¨å­˜åœ¨ä»»ä½•çš„å­˜æ´»å¯¹è±¡,å®ƒå°±å¯ä»¥åœ¨ä¸‹ä¸€ä¸ªé˜¶æ®µ,å³æ¸…é™¤é˜¶æ®µ(cleanup phase)è¢«æ¸…é™¤äº†,å°±æ˜¯å¯ä»¥é”€æˆ·äº†,åˆè¢«æ”¾å›äº†å¯ç”¨Regioné˜Ÿåˆ—ã€‚åŒæ ·åœ°,å†æ¬¡æ ‡è®°é˜¶æ®µç»“æŸåå°±å¯ä»¥å¯¹ä¸€äº›è€å¹´ä»£æ‰§è¡Œæ”¶é›†åŠ¨ä½œã€‚</p><p>å‰é¢æåˆ°äº†CSetæ¦‚å¿µ,ä¸€ä¸ªCSeté‡Œé¢å¯ä»¥åŒ…å«å¤šå°‘Regionå–å†³äºå¤šå°‘ç©ºé—´å¯ä»¥è¢«é‡Šæ”¾ã€G1åœé¡¿ç›®æ ‡æ—¶é—´è¿™ä¸¤ä¸ªå› ç´ ã€‚å‰é¢è¯´èµ·è¿‡æ··åˆGC(Mixed GC),è¿™é‡Œå°±è¦å…·ä½“è¯´æ˜ä¸€ä¸‹äº†ã€‚å½“CSetè¢«ç¡®å®šä¹‹å,ä¼šåœ¨æ¥ä¸‹æ¥çš„ä¸€ä¸ªå¹´è½»ä»£å›æ”¶è¿‡ç¨‹å½“ä¸­å¯¹CSetè¿›è¡Œå›æ”¶,é€šè¿‡å¹´è½»ä»£GCçš„å‡ ä¸ªé˜¶æ®µ,ä¸€éƒ¨åˆ†çš„è€å¹´ä»£Regionä¼šè¢«å›æ”¶å¹¶æ”¾å…¥å¹´è½»ä»£ä½¿ç”¨ã€‚è¿™ä¸ªæ¦‚å¿µå¾ˆçµæ´»,<font color="DeepPink">å³G1åªå…³æ³¨ä½ æœ‰æ²¡æœ‰å­˜æ´»å¯¹è±¡äº†,å¦‚æœæ²¡æœ‰,æ— è®ºä½ å±äºè€å¹´ä»£,è¿˜æ˜¯å±äºå¹´è½»ä»£,ä½ éƒ½ä¼šè¢«å›æ”¶å¹¶æ”¾å…¥å¯ç”¨Regioné˜Ÿåˆ—,ä¸‹ä¸€æ¬¡ä½ è¢«åˆ†é…åˆ°å“ªé‡Œå°±ä¸ç¡®å®šäº†ã€‚</font>ä¹Ÿæ­£æ˜¯å› ä¸ºRegionã€æ··åˆæ”¶é›†è¿™äº›ç‰¹æ€§,è®©G1å¯¹è€å¹´ä»£çš„åƒåœ¾æ”¶é›†æ–¹å¼æœ‰åˆ«äºSerial GCã€Parallel GCå’ŒCMS GC,G1é‡‡ç”¨Regionæ–¹å¼è®©å¯¹è±¡ä¹‹é—´çš„è”ç³»å­˜åœ¨äºè™šæ‹Ÿåœ°å€ä¹‹ä¸Š,è¿™æ ·å°±ä¸éœ€è¦é’ˆå¯¹è€å¹´ä»£çš„å‹ç¼©å’Œå›æ”¶åŠ¨ä½œå¯¹æ•´ä¸ªJavaå †æ‰§è¡Œæ‰«æ,ä¸ºè€å¹´ä»£å›æ”¶èŠ‚çº¦äº†æ—¶é—´ã€‚</p><h4 id="G1-è®¾è®¡æ€è·¯"><a href="#G1-è®¾è®¡æ€è·¯" class="headerlink" title="G1 è®¾è®¡æ€è·¯"></a>G1 è®¾è®¡æ€è·¯</h4><p>GlæŠŠæ•´ä¸ªJavaå †åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªåŒºé—´(Region)ã€‚æ¯ä¸ªRegionå¤§å°ä¸º2çš„å€æ•°,èŒƒå›´åœ¨MB32MBä¹‹é—´,å¯èƒ½ä¸º1MBã€2MBã€4MBã€8MBã€16MBã€32MBã€‚<font color="DeepPink">æ‰€æœ‰çš„Regionæœ‰ä¸€æ ·çš„å¤§å°,åœ¨JVMç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šè¢«æ”¹å˜ã€‚</font></p><p>æ³¨æ„,åœ¨å¹´è½»ä»£ã€æ··åˆä»£ã€Full GCè¿™ä¸‰ä¸ªé˜¶æ®µ,å¹´è½»ä»£çš„Eden Regionå’ŒSurvivor Regionçš„æ•°é‡ä¼šéšæ—¶å˜åŒ–ã€‚<font color="DeepPink">Humongous Region(å¤§å¯¹è±¡ Region)æ˜¯è€å¹´ä»£Regionçš„ä¸€éƒ¨åˆ†</font>,é‡Œé¢çš„å¯¹è±¡è¶…è¿‡æ¯ä¸ªRegionçš„50%ç©ºé—´,è¿™ä¸€ç‚¹æœ‰åˆ«äºä¸€èˆ¬å¯¹è±¡Regionã€‚</p><p>ä»ä¹‹å‰çš„ä»‹ç»æˆ‘ä»¬çŸ¥é“æ²¡æœ‰å¿…è¦å»åˆ»æ„åŒºåˆ†Regionçš„ç”¨é€”,å› ä¸ºG1è®¾è®¡Regionçš„åˆ†é…åŸåˆ™æ˜¯å¾ˆçµæ´»çš„ã€‚ä¸€å¼€å§‹G1ä¼šä»å¯ç”¨ Regioné˜Ÿåˆ—é‡Œé¢æŒ‘é€‰å‡ºRegionå¹¶è®¾ç½®ä¸ºEden Region,ä¸€ä¸ªEden Regioné‡Œé¢å¡«æ»¡å¯¹è±¡ä»¥å,åˆä¼šä»å¯ç”¨Regioné˜Ÿåˆ—é‡Œå†æŒ‘å‡ºä¸€ä¸ªã€‚å½“æ‰€æœ‰çš„Eden Regionéƒ½è¢«å¡«æ»¡æ—¶,ä¸€ä¸ªå¹´è½»ä»£GCæ”¶é›†å°±ä¼šå¼€å§‹æ‰§è¡Œäº†,åœ¨è¿™ä¸ªæ”¶é›†é˜¶æ®µ,æˆ‘ä»¬ä¼šæ”¶é›†Edenå’ŒSurvivor Region,æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡è¦ä¹ˆè¿›å…¥åˆ°ä¸‹ä¸€ä¸ªSurvivor region,è¦ä¹ˆè¿›å…¥è€å¹´ä»£Regionã€‚</p><p><font color="DeepPink">G1æä¾›äº†ä¸€ä¸ªé€‰é¡¹-XX:InitiatingHeapOccupancyPercent,é»˜è®¤å€¼æ˜¯Javaå †ç©ºé—´çš„45%,è¿™ä¸ªé€‰é¡¹å†³å®šäº†æ˜¯å¦å¼€å§‹ä¸€æ¬¡è€å¹´ä»£å›æ”¶åŠ¨ä½œ,å³å¹´è½»ä»£GCç»“æŸä¹‹å,G1ä¼šè¯„ä¼°å‰©ä½™çš„å¯¹è±¡æ˜¯å¦è¾¾åˆ°äº†45%è¿™ä¸ªé˜ˆå€¼ã€‚</font></p><p>å¦‚æœæ ‡è®°é˜¶æ®µ(Marking Phase)ç»“æŸåä¸€ä¸ªè€å¹´ä»£çš„Regionå·²ç»ä¸å­˜åœ¨å¯¹è±¡,é‚£ä¹ˆå®ƒä¼šè¢«æ”¾å›å¯ç”¨Regioné˜Ÿåˆ—,åä¹‹,å®ƒä¼šè¢«æ”¾å…¥æ··åˆæ”¶é›†å™¨ã€‚</p><p>ç”±äºæ ‡è®°é˜¶æ®µä¸æ˜¯ä¸€ä¸ªç‹¬å å¼çš„å¤šçº¿ç¨‹å¹¶è¡Œç¨‹åº,è¿™æ ·åº”ç”¨ç¨‹åºçº¿ç¨‹å°±ä¼šå’Œå®ƒä¸€èµ·å¹¶è¡Œæ‰§è¡Œã€‚<font color="DeepPink">ä¸ºäº†é¿å…æ ‡è®°é˜¶æ®µå ç”¨è¿‡å¤šçš„CPUèµ„æº,G1é‡‡ç”¨æ—¶é—´ç‰‡æ–¹å¼åˆ†æ®µæ‰§è¡Œæ“ä½œ,å³åœ¨æ—¶é—´ç‰‡å†…å…¨åŠ›è¿è¡Œ,ç„¶åä¼‘æ¯ä¸€æ®µæ—¶é—´,è¿™ä¸ªä¼‘æ¯æ—¶é—´å°±æ˜¯è®©åº”ç”¨ç¨‹åºå°½å¯èƒ½å¤šåœ°ä½¿ç”¨CPUèµ„æºè¿è¡Œã€‚</font></p><h4 id="å¤§å¯¹è±¡-Humongous-Object"><a href="#å¤§å¯¹è±¡-Humongous-Object" class="headerlink" title="å¤§å¯¹è±¡(Humongous Object)"></a>å¤§å¯¹è±¡(Humongous Object)</h4><p>å¤§å¯¹è±¡Regionå±äºè€å¹´ä»£çš„ä¸€éƒ¨åˆ†,å®ƒåªåŒ…å«ä¸€ä¸ªå¯¹è±¡ã€‚å½“å¹¶è¡Œæ ‡è®°é˜¶æ®µå‘ç°æ²¡æœ‰å­˜æ´»å¯¹è±¡æ—¶,G1ä¼šå›æ”¶è¿™ä¸ªå¤§å¯¹è±¡ Region,æ³¨æ„è¿™ä¸ªåŠ¨ä½œå¯ä»¥æ˜¯ä¸€ä¸ªæ‰¹é‡å›æ”¶ã€‚</p><h4 id="å…¨åƒåœ¾æ”¶é›†-Full-Garbage-Collection"><a href="#å…¨åƒåœ¾æ”¶é›†-Full-Garbage-Collection" class="headerlink" title="å…¨åƒåœ¾æ”¶é›†(Full Garbage Collection)"></a>å…¨åƒåœ¾æ”¶é›†(Full Garbage Collection)</h4><p>G1çš„Full GCå’ŒSerial goçš„FuGCé‡‡ç”¨çš„æ˜¯åŒä¸€ç§ç®—æ³•ã€‚<font color="DeepPink">Full GCä¼šå¯¹æ•´ä¸ªJavaå †è¿›è¡Œå‹ç¼©ã€‚G1çš„Full GCæ˜¯å•çº¿ç¨‹çš„,ä¼šå¼•èµ·è¾ƒé•¿çš„åœé¡¿æ—¶é—´,å› æ­¤G1çš„è®¾è®¡ç›®æ ‡æ˜¯å‡å°‘Full GCçš„å‘ç”Ÿæ¬¡æ•°ã€‚</font></p><h4 id="å¹¶è¡Œå¾ªç¯-Concurrent-Cycle"><a href="#å¹¶è¡Œå¾ªç¯-Concurrent-Cycle" class="headerlink" title="å¹¶è¡Œå¾ªç¯(Concurrent Cycle)"></a>å¹¶è¡Œå¾ªç¯(Concurrent Cycle)</h4><p>ä¸€ä¸ªG1å¹¶è¡Œå¾ªç¯åŒ…æ‹¬å‡ ä¸ªé˜¶æ®µçš„æ´»åŠ¨:åˆå§‹æ ‡è®°(Initial Marking)ã€å¹¶è¡ŒRootåŒºé—´æ‰«æ(Concurrent Root Region Scanning)ã€å¹¶è¡Œæ ‡è®°(Concurrent Marking)ã€é‡æ ‡è®°(Remarking)å’Œæ¸…é™¤(Cleanup)ã€‚é™¤äº†æœ€åçš„Cleanupé˜¶æ®µä»¥å¤–,å…¶ä½™é˜¶æ®µéƒ½å±äºæ ‡è®°å­˜æ´»å¯¹è±¡é˜¶æ®µã€‚</p><p>åˆå§‹æ ‡è®°é˜¶æ®µçš„ç›®çš„æ˜¯æ”¶é›†æ‰€æœ‰GCæ ¹(Roots)ã€‚ Rootsæ˜¯ä¸€ä¸ªå¯¹è±¡çš„èµ·æºæŒ‡é’ˆã€‚ä¸ºäº†æ”¶é›†æ ¹å¼•ç”¨,ä»åº”ç”¨çº¿ç¨‹å¼€å§‹,åº”ç”¨çº¿ç¨‹å¿…é¡»åœä¸‹æ¥,æ‰€ä»¥åˆå§‹æ ‡è®°é˜¶æ®µæ˜¯ä¸€ä¸ªç‹¬å å¼çš„ã€‚ç”±äºä¸ªå¹´è½»ä»£GCå¿…é¡»æ”¶é›†æ‰€æœ‰çš„Roots,æ‰€ä»¥G1çš„åˆå§‹æ ‡è®°åœ¨ä¸€ä¸ªå¹´è½»ä»£GCé‡Œå®Œæˆã€‚</p><p><font color="DeepPink">å¹¶è¡Œæ ¹åŒºé—´æ‰«æé˜¶æ®µå¿…é¡»æ‰«æå’Œæ ‡è®°æ‰€æœ‰å¹¸å­˜è€…åŒºé—´çš„å¯¹è±¡å¼•ç”¨,è¿™ä¸€é˜¶æ®µæ‰€æœ‰çš„åº”ç”¨ç¨‹åºçº¿ç¨‹éƒ½å¯ä»¥å¹¶è¡Œæ‰§è¡Œ,å”¯ä¸€çš„çº¦æŸæ˜¯æ‰«æå¿…é¡»åœ¨ä¸‹ä¸€ä¸ªGCå¼€å§‹å‰å®Œæˆã€‚è¿™ä¸€çº¦æŸçš„åŸå› æ˜¯ä¸ªæ–°çš„GCäº‹ä»¶ä¼šäº§ç”Ÿä¸€å †æ–°çš„å¹¸å­˜è€…å¯¹è±¡é›†åˆ,è¿™äº›å¯¹è±¡å’Œåˆå§‹åŒ–æ ‡è®°é˜¶æ®µçš„å¹¸å­˜è€…å¯¹è±¡ä¸ä¸€æ ·,å®¹æ˜“å‘ç”Ÿæ··æ·†ã€‚</font></p><p>å¹¶è¡Œæ ‡è®°é˜¶æ®µå®Œæˆäº†å‡ ä¹æ‰€æœ‰çš„æ ‡è®°å·¥ä½œã€‚åœ¨è¿™ä¸€é˜¶æ®µ,åˆ©ç”¨å¤šçº¿ç¨‹å¹¶è¡Œæ ‡è®°å­˜æ´»å¯¹è±¡åŠå¯¹åº”çš„é€»è¾‘åœ°å›¾ã€‚è¿™ä¸€é˜¶æ®µå…è®¸æ‰€æœ‰çš„Javaçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œ,ä½†æ˜¯å¯¹åº”ç”¨ç¨‹åºæ¥è¯´æ€»ä½“çš„ååé‡å¯èƒ½ä¼šä¸‹é™ã€‚å…¶å®ä»»ä½•ä¸€ä¸ªç³»ç»Ÿéƒ½å’Œäººä½“å¾ªç¯ä¸€æ ·,å½“æ²¡æœ‰å¤–éƒ¨å¹²æ‰°æ—¶,ç³»ç»Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå¦‚æœå—åˆ°å¤–éƒ¨å¹²æ‰°,äººä½“ç³»ç»Ÿä¹Ÿä¼šå‡ºç°æ··ä¹±,ç”šè‡³å‡ºç°çŸ­æ—¶é—´çš„ä¼‘å…‹ã€‚</p><p>é‡æ ‡è®°é˜¶æ®µæ˜¯ä¸€ä¸ªç‹¬å å¼é˜¶æ®µ,é€šå¸¸æ˜¯ä¸€ä¸ªå¾ˆçŸ­çš„åœé¡¿,è¿™ä¸ªé˜¶æ®µä¼šå®Œæˆæ‰€æœ‰çš„æ ‡è®°å·¥ä½œã€‚</p><p>æœ€åä¸€ä¸ªå¹¶è¡Œæ ‡è®°æ­¥éª¤æ˜¯æ¸…é™¤é˜¶æ®µã€‚åœ¨è¿™ä¸ªé˜¶æ®µ,æ²¡æœ‰åŒ…å«å­˜æ´»å¯¹è±¡çš„Regionä¼šè¢«å›æ”¶,å¹¶éšå³è¢«åŠ å…¥å¯ç”¨Regioné˜Ÿåˆ—ã€‚è¿™ä¸ªé˜¶æ®µçš„é‡è¦æ„ä¹‰æ˜¯æœ€ç»ˆå†³å®šäº†å“ªäº› Regionå¯ä»¥è¿›å…¥æ··åˆGCã€‚åœ¨G1å†…éƒ¨,æ··åˆGCæ˜¯éå¸¸é‡è¦çš„é‡Šæ”¾å†…å­˜æœºåˆ¶,é¿å…äº†G1å‡ºç°æ²¡æœ‰å¯ç”¨Regionçš„æƒ…å†µå‘ç”Ÿ,å¦åˆ™å°±ä¼šè§¦å‘Full GCäº‹ä»¶ã€‚</p><h4 id="å †å¤§å°ï¼ˆHeap-Sizingï¼‰"><a href="#å †å¤§å°ï¼ˆHeap-Sizingï¼‰" class="headerlink" title="å †å¤§å°ï¼ˆHeap Sizingï¼‰"></a>å †å¤§å°ï¼ˆHeap Sizingï¼‰</h4><p>G1åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹å¯èƒ½ä¼šå¢å¤§å †å†…å­˜å¤§å°ï¼š</p><ul><li>Full GCé˜¶æ®µã€‚</li><li>Youngæˆ–Mixed GCå‘ç”Ÿæ—¶,G1è®¡ç®—GCèŠ±è´¹çš„æ—¶é—´ä¸Javaçº¿ç¨‹çš„èŠ±è´¹æ—¶é—´æ¯”ä¾‹,å¦‚æœ-XX:GCTimeRatioè®¾ç½®GCèŠ±è´¹æ—¶é—´å¾ˆé•¿,åˆ™å †å¤§å°ä¼šå¢å¤§,è¿™æ ·çš„è®¾è®¡æ€è·¯æ˜¯å¸Œæœ›G1å‘ç”ŸGCçš„é¢‘ç‡é™ä½,è¿™æ ·GCèŠ±è´¹æ—¶é—´å’ŒJavaçº¿ç¨‹èŠ±è´¹æ—¶é—´æ¯”ä¾‹ä¹Ÿä¼šç›¸åº”ä¸‹é™ã€‚<br>  -XX:GCTimeRatioé€‰é¡¹çš„é»˜è®¤å€¼æ˜¯9,æ‰€æœ‰å…¶ä»–HotSpot GCçš„é»˜è®¤å€¼æ˜¯99ã€‚è¿™ä¸ªå€¼è¶Šå¤§,ä»£è¡¨Javaå †ç©ºé—´å¤§å°å¢é•¿è¶Šåæ¿€,å³è¶Šå®¹æ˜“æ‰©å¤§å †ç©ºé—´å¤§å°,è¿™æ ·ä¹Ÿæ˜¯ä¸ºäº†è¾¾åˆ°é™ä½GCèŠ±è´¹æ—¶é—´çš„è®¾è®¡ç›®æ ‡ã€‚</li><li>å¦‚æœä¸€ä¸ªå¯¹è±¡åˆ†é…å¤±è´¥,å³ä¾¿ä¸€ä¸ªGCåˆšåˆšç»“æŸ,G1é‡‡ç”¨çš„ç­–ç•¥ä¸æ˜¯ç«‹å³é‡å¤Full GCï¼Œè€Œæ˜¯é€šè¿‡å¢å¤§å †å†…å­˜å¤§å°,ç¡®ä¿å¯¹è±¡åˆ†é…æˆåŠŸã€‚è¿™æ ·çš„è®¾è®¡ç†å¿µç¬¦åˆG1çš„é¿å…Full GCå‘ç”Ÿçš„æœ€åˆæ€æƒ³ã€‚</li><li>å’Œç¬¬3æ¡ä¸€æ ·,å¦‚æœå‡ºç°ä¸€ä¸ªå¤§å¯¹è±¡åˆ†é…å¤±è´¥,å‰é¢è¯´è¿‡,å¤§å¯¹è±¡éœ€è¦å‡ ä¸ªè¿ç»­çš„RegionåŒºé—´æ‰èƒ½ç¡®ä¿å¯¹è±¡åˆ†é…æˆåŠŸã€‚å¦‚æœå‘ç”Ÿè¿™ç§åˆ†é…å¤±è´¥çš„æƒ…å†µ,é‡‡ç”¨çš„è®¾è®¡ç†å¿µä¹Ÿä¸æ˜¯è°ƒç”¨Full GC,è€Œæ˜¯æ‰©å¤§å †å†…å­˜ã€‚</li><li>å½“GCç”³è¯·åŠ å…¥ä¸€ä¸ªæ–°çš„Regionæ—¶ã€‚</li></ul><p>å¼•ç”¨ä¸€æ®µåœ¨StackOverfall.comä¸Šçœ‹åˆ°çš„ç»éªŒåˆ†äº«,â€æˆ‘åœ¨ä¸€ä¸ªçœŸå®çš„ã€è¾ƒå¤§è§„æ¨¡çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿‡G1:å¤§çº¦åˆ†é…æœ‰60B-70GBå†…å­˜,å­˜æ´»å¯¹è±¡å¤§çº¦åœ¨20GB50GBä¹‹é—´ã€‚æœåŠ¡å™¨è¿è¡ŒLinuxæ“ä½œç³»ç»Ÿ,JDKç‰ˆæœ¬ä¸º6u22ã€‚G1ä¸PS/PS Oldç›¸æ¯”,æœ€å¤§çš„å¥½å¤„æ˜¯åœé¡¿æ—¶é—´æ›´åŠ å¯æ§å¯é¢„æµ‹ã€‚å¦‚æœæˆ‘åœ¨PSä¸­è®¾ç½®ä¸€ä¸ªå¾ˆä½çš„æœ€å¤§å…è®¸GCæ—¶é—´,è­¬å¦‚æœŸæœ›50mså†…å®ŒæˆGC(-XX:MaxGCPauseMillis=50),ä½†åœ¨65GBçš„Javaå †ä¸‹æœ‰å¯èƒ½å¾—åˆ°çš„ç›´æ¥ç»“æœæ˜¯ä¸€æ¬¡é•¿è¾¾30sè‡³2minçš„æ¼«é•¿çš„Stop-the-Worldè¿‡ç¨‹ã€‚è€ŒGlä¸CMSç›¸æ¯”,å®ƒä»¬éƒ½ç«‹è¶³äºä½åœé¡¿æ—¶é—´,CMSä»ç„¶æ˜¯æˆ‘ç°åœ¨çš„é€‰æ‹©,ä½†æ˜¯éšç€Oracleå¯¹G1çš„æŒç»­æ”¹è¿›,æˆ‘ç›¸ä¿¡Glä¼šæ˜¯æœ€ç»ˆçš„èƒœåˆ©è€…ã€‚å¦‚æœä½ ç°åœ¨é‡‡ç”¨çš„æ”¶é›†å™¨æ²¡æœ‰å‡ºç°é—®é¢˜,é‚£ä¹ˆå°±æ²¡æœ‰ä»»ä½•ç†ç”±ç°åœ¨å»é€‰æ‹©G1;å¦‚æœä½ çš„åº”ç”¨è¿½æ±‚ä½åœé¡¿,é‚£ä¹ˆG1ç°åœ¨å·±ç»å¯ä»¥ä½œä¸ºä¸€ä¸ªå¯å°è¯•çš„é€‰æ‹©:å¦‚æœä½ çš„åº”ç”¨è¿½æ±‚ååé‡,é‚£ä¹ˆG1å¹¶ä¸ä¼šä¸ºä½ å¸¦æ¥ä»€ä¹ˆç‰¹åˆ«çš„å¥½å¤„ã€‚â€</p><h1 id="G1-GCåº”ç”¨ç¤ºä¾‹"><a href="#G1-GCåº”ç”¨ç¤ºä¾‹" class="headerlink" title="G1 GCåº”ç”¨ç¤ºä¾‹"></a>G1 GCåº”ç”¨ç¤ºä¾‹</h1><p>G1 GCç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šçš„å‘½ä»¤è¡Œé€‰é¡¹,ä¹Ÿå°±æ˜¯å‚æ•°,è¿™äº›å‚æ•°ä¸€ç±»ä»¥å¸ƒå°”ç±»å‹æ‰“å¤´,â€œ+â€è¡¨ç¤ºå¯ç”¨è¯¥é€‰é¡¹,â€œ-â€è¡¨ç¤ºå…³é—­è¯¥é€‰é¡¹ã€‚å¦ä¸€ç±»é‡‡ç”¨æ•°å­—èµ‹å€¼,ä¸éœ€è¦å¸ƒå°”ç±»å‹æ‰“å¤´ã€‚</p><h2 id="é€‰é¡¹è§£é‡ŠåŠåº”ç”¨"><a href="#é€‰é¡¹è§£é‡ŠåŠåº”ç”¨" class="headerlink" title="é€‰é¡¹è§£é‡ŠåŠåº”ç”¨"></a>é€‰é¡¹è§£é‡ŠåŠåº”ç”¨</h2><p>é¦–å…ˆåœ¨cmdå‘½ä»¤è¡Œæ¨¡å¼ä¸‹è¾“å…¥java -X,,å¦‚C:Users\Administrator&gt; java -X,è¾“å‡ºå¦‚ä»£ç å¦‚ä¸‹ï¼š<br><img alt data-src="/images/java-jvm-gc-g1-note/javax%E6%8E%A7%E5%88%B6%E5%8F%B0%E8%BE%93%E5%87%BA.png"></p><h3 id="XX-PrintGCDetails"><a href="#XX-PrintGCDetails" class="headerlink" title="-XX:+PrintGCDetails"></a>-XX:+PrintGCDetails</h3><p>è¯¥é€‰é¡¹ç”¨äºè®°å½•GCè¿è¡Œæ—¶çš„è¯¦ç»†æ•°æ®ä¿¡æ¯å¹¶è¾“å‡º,æ˜¯æœ€åŸºæœ¬ã€ä½¿ç”¨æœ€æ™®éçš„ä¸€ä¸ªé€‰é¡¹è¿™ä¸ªé€‰é¡¹é€‚ç”¨äºæ‰€æœ‰GC,è¾“å‡ºå†…å®¹ä¸»è¦åŒ…æ‹¬æ–°ç”Ÿæˆå¯¹è±¡å ç”¨å†…å­˜å¤§å°ä»¥åŠè€—è´¹æ—¶é—´ã€å„ä¸ªå¹´é¾„ä»£çš„æƒ…å†µã€æ¯æ¬¡å›æ”¶çš„å¯¹åº”æ•°æ®ç­‰ã€‚</p><h3 id="Xloggc"><a href="#Xloggc" class="headerlink" title="-Xloggc"></a>-Xloggc</h3><p>å¦‚æœæƒ³è¦ä»¥æ–‡ä»¶å½¢å¼ä¿å­˜è¿™äº›GCæ—¥å¿—,å¯ä»¥åœ¨å¯åŠ¨å‚æ•°ä¸­è¾“å…¥-XX:+PrintGCDetails -verbose:gc -XLoggc:gc.log,è¿è¡Œåæˆ‘ä»¬ä¼šå‘ç°ç”Ÿæˆäº†ä¸€ä¸ª gc.logæ–‡ä»¶ã€‚</p><blockquote><p>-Xloggc:example_gc.log ï¼ˆè®¾ç½®åƒåœ¾å›æ”¶æ—¥å¿—æ‰“å°çš„æ–‡ä»¶ï¼Œæ–‡ä»¶åç§°å¯ä»¥è‡ªå®šä¹‰ï¼‰ </p></blockquote><p>-XX:initialHeapSizeå’Œ-XX:MaxHeapSizeå°±æ˜¯æˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„-Xmså’Œ-Xmx,å®ƒä»¬å…è®¸æˆ‘ä»¬æŒ‡å®šJVMçš„åˆå§‹å’Œæœ€å¤§å †å†…å­˜å¤§å°-XX:+UseCompressedClassPointersã€XX:+UseCompressedOops<br>ä»¥åŠ-XX:-UseLargePagesIndividualAllocationè¿™ä¸‰ä¸ªé€‰é¡¹å’ŒOOPæœ‰å…³ã€‚OOPçš„å…¨ç§°æ˜¯Ordinary Object Pointer,å³æ™®é€šå¯¹è±¡æŒ‡é’ˆã€‚é€šå¸¸64ä½JVMæ¶ˆè€—çš„å†…å­˜ä¼šæ¯”32ä½çš„å¤§1.5å€,è¿™æ˜¯å› ä¸ºå¯¹è±¡æŒ‡é’ˆåœ¨64ä½æ¶æ„ä¸‹,é•¿åº¦ä¼šç¿»å€(æ›´å®½çš„å¯»å€)ã€‚å¯¹äºé‚£äº›å°†è¦ä»32ä½å¹³å°ç§»æ¤åˆ°64ä½çš„åº”ç”¨æ¥è¯´,å¹³ç™½æ— æ•…å¤šäº†1/2çš„å†…å­˜å ç”¨,ä½œä¸ºå¼€å‘è€…ä¸€å®šä¸æ„¿æ„çœ‹åˆ°è¿™ç§åœºæ™¯ã€‚æ‰€ä»¥,ä»JDK1.6 update4å¼€å§‹,64 bit JVMæ­£å¼æ”¯æŒäº†-XX:+UseCompressedOopsè¿™ä¸ªå¯ä»¥å‹ç¼©æŒ‡é’ˆ,èµ·åˆ°èŠ‚çº¦å†…å­˜å ç”¨çš„é€‰é¡¹ã€‚CompressedOopsçš„å®ç°æ–¹å¼æ˜¯åœ¨æœºå™¨ç ä¸­æ¤å…¥å‹ç¼©ä¸è§£å‹æŒ‡ä»¤,å¯èƒ½ä¼šç»™JVMå¢åŠ é¢å¤–çš„å¼€é”€ã€‚-XX:+UseCompressedClassPointersé€‰é¡¹æ˜¯åœ¨JDK8å‡ºç°çš„,ä¹Ÿæ˜¯åœ¨æ°¸ä¹…åŒºæ¶ˆå¤±ä¹‹åå‡ºç°çš„æ–°çš„é€‰é¡¹,ä¸»è¦ç”¨äºå¯¹ç±»çš„å…ƒæ•°æ®è¿›è¡Œå‹ç¼©ã€‚-XX:UseLargePagesIndividualAllocationå’Œoopsæ˜¯ä¸€èµ·ä½¿ç”¨çš„,åœ¨å¤§é¡µå†…å­˜ä½¿ç”¨å‘ç”Ÿæ—¶è¿™ä¸ªé€‰é¡¹ä¹Ÿä¼šè‡ªåŠ¨å¯ç”¨ã€‚</p><h3 id="XX-PrintGCApplicationStoppedTime"><a href="#XX-PrintGCApplicationStoppedTime" class="headerlink" title="-XX:+PrintGCApplicationStoppedTime"></a>-XX:+PrintGCApplicationStoppedTime</h3><p>æ‰“å°åƒåœ¾å›æ”¶æœŸé—´ç¨‹åºæš‚åœçš„æ—¶é—´,å¦‚æœä½¿ç”¨è¯¥é€‰é¡¹,ä¼šè¾“å‡ºGCé€ æˆåº”ç”¨ç¨‹åºæš‚åœçš„æ—¶é—´ã€‚ä¸€èˆ¬å’Œ-XX:+PrintGCApplicationConcurrentTimeç»„åˆèµ·æ¥ä¸€èµ·ä½¿ç”¨,è¿™æ ·æ¯”è¾ƒæœ‰åˆ©äºæŸ¥çœ‹è¾“å‡ºã€‚</p><h3 id="XX-ConcGCThreads"><a href="#XX-ConcGCThreads" class="headerlink" title="-XX:ConcGCThreads"></a>-XX:ConcGCThreads</h3><p>è¿™ä¸ªé€‰é¡¹ç”¨æ¥è®¾ç½®ä¸Javaåº”ç”¨ç¨‹åºçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œçš„GCçº¿ç¨‹æ•°é‡,é»˜è®¤ä¸ºGCç‹¬å æ—¶è¿è¡Œçº¿ç¨‹çš„1/4ã€‚è¿™ä¸ªé€‰é¡¹è®¾ç½®è¿‡å¤§ä¼šå¯¼è‡´Javaåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨çš„CPUèµ„æºå‡å°‘,å¦‚æœå°ä¸€ç‚¹åˆ™ä¼šå¯¹åº”ç”¨ç¨‹åºæœ‰åˆ©,ä½†æ˜¯è¿‡å°å°±ä¼šå¢åŠ GCå¹¶è¡Œå¾ªç¯çš„æ‰§è¡Œæ—¶é—´,åè¿‡æ¥å‡å°‘Javaåº”ç”¨ç¨‹åºçš„è¿è¡Œæ—¶é—´(å› ä¸ºç‹¬å æœŸæ—¶é—´æ‹‰é•¿)ã€‚</p><h3 id="XX-G1HeapRegionSize"><a href="#XX-G1HeapRegionSize" class="headerlink" title="-XX:G1HeapRegionSize"></a>-XX:G1HeapRegionSize</h3><p>è¿™æ˜¯G1GCç‹¬æœ‰çš„é€‰é¡¹,å®ƒæ˜¯ä¸“é—¨é’ˆå¯¹Regionè¿™ä¸ªæ¦‚å¿µçš„å¯¹åº”è®¾ç½®é€‰é¡¹,åç»­GCåº”è¯¥ä¼šç»§ç»­é‡‡ç”¨ Regionè¿™ä¸ªæ¦‚å¿µã€‚ Regionçš„å¤§å°é»˜è®¤ä¸ºå †å¤§å°çš„1/200,.ä¹Ÿå¯ä»¥è®¾ç½®ä¸º1MBã€2MBã€4MBã€8MBã€16MB,ä»¥åŠ32MB,è¿™å…­ä¸ªåˆ’åˆ†æ¡£æ¬¡ã€‚</p><p>å¢å¤§Regionå—çš„å¤§å°æœ‰åˆ©äºå¤„ç†å¤§å¯¹è±¡ã€‚å‰é¢ä»‹ç»è¿‡,å¤§å¯¹è±¡æ²¡æœ‰æŒ‰ç…§æ™®é€šå¯¹è±¡æ–¹å¼è¿›è¡Œç®¡ç†å’Œåˆ†é…ç©ºé—´,å¦‚æœå¢å¤§Regionå—çš„å¤§å°,åˆ™ä¸€äº›åŸæœ¬èµ°ç‰¹æ®Šå¤„ç†é€šé“çš„å¤§å¯¹è±¡å°±å¯ä»¥è¢«çº³å…¥æ™®é€šå¤„ç†é€šé“äº†ã€‚è¿™å°±å¥½æ¯”æˆ‘ä»¬åœ¨æœºåœºå®‰æ£€,é£è¡Œå‘˜ã€ç©ºå§å¯ä»¥èµ°ç‰¹æ®Šé€šé“,ä¹˜å®¢å¦‚æœä¹Ÿæç‰¹æ®ŠåŒ–,ä¸€éƒ¨åˆ†äººå»ç‰¹æ®Šé€šé“å¤„ç†,é‚£ä¹ˆç‰¹æ®Šé€šé“å°±å¾—å¢—åŠ å‡ ä¸ª,ç›¸åº”çš„æ™®é€šé€šé“å°±å¾—å‡å°‘äº†,å¯¹æ•ˆç‡å°±èµ·äº†é™ä½ä½œç”¨ã€‚åä¹‹,å¦‚æœRegionå¤§å°è®¾ç½®è¿‡å°,åˆ™ä¼šé™ä½G1çš„çµæ´»æ€§,å¯¹äºå„ä¸ªå¹´é¾„ä»£çš„å¤§å°éƒ½ä¼šé€ æˆåˆ†é…é—®é¢˜ã€‚</p><h3 id="XX-G1HeapWastePercent"><a href="#XX-G1HeapWastePercent" class="headerlink" title="-XX:G1HeapWastePercent"></a>-XX:G1HeapWastePercent</h3><p>è¿™ä¸ªé€‰é¡¹æ§åˆ¶G1 GCä¸ä¼šå›æ”¶çš„ç©ºé—²å†…å­˜æ¯”ä¾‹,é»˜è®¤æ˜¯å †å†…å­˜çš„5%ã€‚G1 GCåœ¨å›æ”¶è¿‡ç¨‹ä¸­ä¼šå›æ”¶æ‰€æœ‰Regionçš„å†…å­˜,å¹¶æŒç»­åœ°åšè¿™ä¸ªå·¥ä½œç›´åˆ°ç©ºé—²å†…å­˜æ¯”ä¾‹è¾¾åˆ°è®¾ç½®çš„è¿™ä¸ªå€¼ä¸ºæ­¢,æ‰€ä»¥å¯¹äºè®¾ç½®äº†è¾ƒå¤§å€¼çš„å †å†…å­˜æ¥è¯´,éœ€è¦é‡‡ç”¨æ¯”è¾ƒä½çš„æ¯”ä¾‹,è¿™æ ·å¯ä»¥ç¡®ä¿è¾ƒå°éƒ¨åˆ†çš„å†…å­˜ä¸è¢«å›æ”¶ã€‚è¿™ä¸ªå¾ˆå®¹æ˜“ç†è§£,åŸå¸‚è¶Šå¤§å°±è¶Šå®¹æ˜“å‡ºç°ä¸€äº›æ­»è§’,å‡ºäºæ€§èƒ½çš„åŸå› å¯ä»¥ä¸å»å…³æ³¨é‚£é‡Œ,ä½†æ˜¯è¿™ä¸ªæ¯”ä¾‹ä¸èƒ½å¤§ã€‚</p><h3 id="XX-G1MixedGCCountTarget"><a href="#XX-G1MixedGCCountTarget" class="headerlink" title="-XX:G1MixedGCCountTarget"></a>-XX:G1MixedGCCountTarget</h3><p>è€å¹´ä»£Regionçš„å›æ”¶æ—¶é—´é€šå¸¸æ¥è¯´æ¯”å¹´è½»ä»£Regionç¨é•¿ä¸€äº›,è¿™ä¸ªé€‰é¡¹å¯ä»¥è®¾ç½®ä¸€ä¸ªå¹¶è¡Œå¾ªç¯ä¹‹åå¯åŠ¨å¤šå°‘ä¸ªæ··åˆGC,é»˜è®¤å€¼æ˜¯8ä¸ªã€‚è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼å¯ä»¥è®©G1 GCåœ¨è€å¹´ä»£Regionå›æ”¶æ—¶å¤šèŠ±ä¸€äº›æ—¶é—´,å¦‚æœä¸€ä¸ªæ··åˆGCçš„åœé¡¿æ—¶é—´å¾ˆé•¿,è¯´æ˜å®ƒè¦åšçš„äº‹æƒ…å¾ˆå¤š,æ‰€ä»¥å¯ä»¥å¢å¤§è¿™ä¸ªå€¼çš„è®¾ç½®,ä½†æ˜¯å¦‚æœè¿™ä¸ªå€¼è¿‡å¤§,ä¹Ÿä¼šé€ æˆå¹¶è¡Œå¾ªç¯ç­‰å¾…æ··åˆGCå®Œæˆçš„æ—¶é—´ç›¸åº”çš„å¢åŠ ã€‚</p><blockquote><p>å½“å ç”¨å†…å­˜è¶…è¿‡InitiatingHeapOccupancyPercenté˜€å€¼æ—¶, æœ€å¤šé€šè¿‡å¤šå°‘æ¬¡Mixed GCæ¥å°†å†…å­˜æ§åˆ¶åœ¨é˜€å€¼ä¹‹ä¸‹ã€‚</p></blockquote><h3 id="XX-G1PrintRegionLivenessInfo"><a href="#XX-G1PrintRegionLivenessInfo" class="headerlink" title="-XX:+G1PrintRegionLivenessInfo"></a>-XX:+G1PrintRegionLivenessInfo</h3><p>ç”±äºå¼€å¯è¿™ä¸ªé€‰é¡¹ä¼šåœ¨æ ‡è®°å¾ªç¯é˜¶æ®µå®Œæˆä¹‹åè¾“å‡ºè¯¦ç»†ä¿¡æ¯,ä¸“ä¸šä¸€ç‚¹çš„å«æ³•æ˜¯è¯Šæ–­é€‰é¡¹,æ‰€ä»¥åœ¨ä½¿ç”¨å‰éœ€è¦å¼€å¯é€‰é¡¹UnlockDiagnosticVMOptionsã€‚è¿™ä¸ªé€‰é¡¹å¯ç”¨åä¼šæ‰“å°å †å†…å­˜å†…éƒ¨æ¯ä¸ªRegioné‡Œé¢çš„å­˜æ´»å¯¹è±¡ä¿¡æ¯,è¿™äº›ä¿¡æ¯åŒ…æ‹¬ä½¿ç”¨ç‡ã€RSetå¤§å°ã€å›æ”¶ä¸€ä¸ªRegionçš„ä»·å€¼(Regionå†…éƒ¨å›æ”¶ä»·å€¼è¯„ä¼°,å³æ€§ä»·æ¯”)ã€‚</p><p>è¿™ä¸ªé€‰é¡¹è¾“å‡ºçš„ä¿¡æ¯å¯¹äºè°ƒè¯•å †å†…Regionæ˜¯å¾ˆæœ‰æ•ˆçš„,ä¸è¿‡å¯¹äºä¸€ä¸ªå¾ˆå¤§çš„å †å†…å­˜æ¥è¯´,ç”±äºæ¯ä¸ª Regionä¿¡æ¯éƒ½è¾“å‡ºäº†,æ‰€ä»¥ä¿¡æ¯é‡ä¹Ÿæ˜¯æŒºå¤§çš„ã€‚</p><h3 id="XX-G1ReservePercent"><a href="#XX-G1ReservePercent" class="headerlink" title="-XX:G1ReservePercent"></a>-XX:G1ReservePercent</h3><p>æ¯ä¸ªå¹´é¾„ä»£éƒ½ä¼šæœ‰ä¸€äº›å¯¹è±¡å¯ä»¥è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µ,ä¸ºäº†ç¡®ä¿è¿™ä¸ªæå‡è¿‡ç¨‹æ­£å¸¸å®Œæˆ,æˆ‘ä»¬å…è®¸G1GCä¿ç•™ä¸€äº›å†…å­˜,è¿™æ ·å°±å¯ä»¥é¿å…å‡ºç°â€œ to space exhaustedâ€é”™è¯¯,è¿™ä¸ªé€‰é¡¹å°±æ˜¯ä¸ºäº†è¿™ä¸ªç”¨é€”ã€‚</p><p>è¿™ä¸ªé€‰é¡¹é»˜è®¤ä¿ç•™å †å†…å­˜çš„10%ã€‚æ³¨æ„,è¿™ä¸ªé¢„ç•™å†…å­˜ç©ºé—´ä¸èƒ½ç”¨äºå¹´è½»ä»£ã€‚</p><p>å¯¹äºä¸€ä¸ªæ‹¥æœ‰å¤§å†…å­˜çš„å †å†…å­˜æ¥è¯´,è¿™ä¸ªå€¼ä¸èƒ½è¿‡å¤§,å› ä¸ºå®ƒä¸èƒ½ç”¨äºå¹´è½»ä»£,è¿™å°±æ„å‘³ç€å¹´è½»ä»£å¯ç”¨å†…å­˜é™ä½äº†ã€‚å‡å°è¿™ä¸ªå€¼æœ‰åŠ©äºç»™å¹´è½»ä»£ç•™å‡ºæ›´å¤§çš„å†…å­˜ç©ºé—´ã€æ›´é•¿çš„GCæ—¶é—´,è¿™å¯¹æå‡æ€§èƒ½ååé‡æœ‰å¥½å¤„ã€‚</p><h3 id="XX-G1SummarizeRSetStats"><a href="#XX-G1SummarizeRSetStats" class="headerlink" title="-XX:+G1SummarizeRSetStats"></a>-XX:+G1SummarizeRSetStats</h3><p>å’ŒGIPrintRegionLivenessInfoé€‰é¡¹ä¸€æ ·,è¿™ä¸ªé€‰é¡¹ä¹Ÿæ˜¯ä¸€ä¸ªè¯Šæ–­é€‰é¡¹,æ‰€ä»¥ä¹Ÿéœ€è¦å¼€å¯UnlockDiagnosticVMOptionsé€‰é¡¹åæ‰èƒ½ä½¿ç”¨,è¿™ä¹Ÿå°±æ„å‘³ç€-XX:+UnlockDiagnosticVMOptionsé€‰é¡¹éœ€è¦æ”¾åœ¨-XX:+G1SummarizeRSetStatsé€‰é¡¹çš„å‰é¢ã€‚</p><p>è¿™ä¸ªé€‰é¡¹å’Œ-XX:G1SummarizePeriodä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ä¼šé˜¶æ®µæ€§åœ°æ‰“å°RSetsçš„è¯¦ç»†ä¿¡æ¯,è¿™æœ‰åŠ©äºæ‰¾åˆ°RSeté‡Œé¢å­˜åœ¨çš„é—®é¢˜ã€‚</p><h3 id="XX-G1TraceConcRefinement"><a href="#XX-G1TraceConcRefinement" class="headerlink" title="-XX:+G1TraceConcRefinement"></a>-XX:+G1TraceConcRefinement</h3><p>è¿™æ˜¯ä¸€ä¸ªè¯Šæ–­é€‰é¡¹ã€‚å¦‚æœå¯åŠ¨è¿™ä¸ªè¯Šæ–­é€‰é¡¹,é‚£ä¹ˆå¹¶è¡ŒRefinementçº¿ç¨‹ç›¸å…³çš„ä¿¡æ¯ä¼šè¢«æ‰“å°ã€‚æ³¨æ„,çº¿ç¨‹å¯åŠ¨å’Œç»“æŸæ—¶çš„ä¿¡æ¯éƒ½ä¼šè¢«æ‰“å°ã€‚</p><p>è¿™é‡Œæåˆ°äº†Refinementçº¿ç¨‹,æˆ‘ä»¬æ¥æå‰æ¢³ç†è¿™ä¸ªæ¦‚å¿µã€‚è¯·çœ‹æ¯ä¸€ä»£GCå¯¹åº”çš„GCçº¿ç¨‹:</p><table><thead><tr><th>Garbage Collector</th><th>Worker Threads Used</th></tr></thead><tbody><tr><td>Parallel GC</td><td>ParallelGCThreads</td></tr><tr><td>CMS GC</td><td>ParallelGCThreads<br>ConcGCThreads</td></tr><tr><td>G1 GC</td><td>ParallelGCThreads<br>ConcGCThreads<br>G1ConcRefinementThreads</td></tr></tbody></table><p>ä¸Šé¢åˆ—å‡ºäº†ä¸‰ç±»GCçº¿ç¨‹,åˆ†åˆ«æ˜¯ParallelGCThreadsã€ConcGCThreadså’ŒG1ConcRefinementThreadsã€‚å…³äºè¿™ä¸‰ä¸ªçº¿ç¨‹çš„åŒºåˆ«ï¼š</p><table><thead><tr><th>åç§°</th><th>é€‰é¡¹æ§åˆ¶</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>ParallelGC Thread</td><td>-XX:ParallelGCThreads</td><td>GCçš„å¹¶è¡Œå·¥ä½œçº¿ç¨‹,ä¸“é—¨ç”¨äºç‹¬å é˜¶æ®µçš„å·¥ä½œ,æ¯”å¦‚æ‹·è´å­˜æ´»å¯¹è±¡</td></tr><tr><td>ParallelMarkingThreads</td><td>-XX:ConcGCThreads</td><td>å¹¶è¡Œæ ‡è®°é˜¶æ®µçš„å¹¶è¡Œçº¿ç¨‹,å®ƒç”±ä¸€ä¸ªä¸»æ§(Master)çº¿ç¨‹å’Œä¸€äº›å·¥ä½œ(Worker)çº¿ç¨‹ç»„æˆ,å¯ä»¥å’Œåº”ç”¨ç¨‹åºå¹¶è¡Œæ‰§è¡Œ</td></tr><tr><td>G1ConcurrentRefinementThreads</td><td>-XX:G1ConcRefinementThreads</td><td>å’Œåº”ç”¨ç¨‹åºä¸€èµ·è¿è¡Œ,ç”¨äºæ›´æ–°RSet,å¦‚æœConcurrentRefinementThreadsæ²¡æœ‰è®¾ç½®,é‚£ä¹ˆé»˜è®¤ä¸ºParallelGCThreads+1</td></tr></tbody></table><h3 id="XX-G1UseAdaptiveConcRefinement"><a href="#XX-G1UseAdaptiveConcRefinement" class="headerlink" title="-XX:+G1UseAdaptiveConcRefinement"></a>-XX:+G1UseAdaptiveConcRefinement</h3><p>è¿™ä¸ªé€‰é¡¹é»˜è®¤æ˜¯å¼€å¯çš„ã€‚å®ƒä¼šåŠ¨æ€åœ°å¯¹æ¯ä¸€æ¬¡GCä¸­XX:G1ConcRefinementGreenZoneã€-XX:G1ConcRefinementYellowZoneã€-XX:G1ConcRefinementRedZoneçš„å€¼è¿›è¡Œé‡æ–°è®¡ç®—ã€‚</p><p>å¹¶è¡ŒRefinementçº¿ç¨‹æ˜¯æŒç»­è¿è¡Œçš„,å¹¶ä¸”ä¼šéšç€update log bufferç§¯ç´¯çš„æ•°é‡è€ŒåŠ¨æ€è°ƒèŠ‚ã€‚å‰é¢è¯´åˆ°çš„ä¸‰ä¸ªé…ç½®é€‰é¡¹-XX:G1ConcRefinementGreenZoneã€-XX:G1ConcRefinementYellowZoneã€-XX:G1ConcRefinementRedZone,æ˜¯è¢«ç”¨æ¥æ ¹æ®ä¸åŒçš„ bufferä½¿ç”¨ä¸åŒçš„Refinementçº¿ç¨‹,ç›®çš„å°±æ˜¯ä¸ºäº†ä¿è¯ Refinementçº¿ç¨‹ä¸€å®šè¦å°½å¯èƒ½åœ°è·Ÿä¸Šupdate log bufferäº§ç”Ÿçš„æ­¥ä¼ã€‚ä½†æ˜¯è¿™ä¸ªRefinementçº¿ç¨‹ä¸æ˜¯æ— é™å¢åŠ çš„,ä¸€æ—¦å‡ºç° Refinementçº¿ç¨‹è·Ÿä¸ä¸Šupdate log bufferäº§ç”Ÿçš„é€Ÿåº¦ã€update log bufferå¼€å§‹å‡ºç°ç§¯å‹çš„æƒ…å†µ,Mutatorçº¿ç¨‹(å³åº”ç”¨ä¸šåŠ¡çº¿ç¨‹)å°±ä¼šååŠ©Refinementçº¿ç¨‹æ‰§è¡ŒRSetçš„æ›´æ–°å·¥ä½œã€‚è¿™ä¸ª Mutatorçº¿ç¨‹å®é™…ä¸Šå°±æ˜¯åº”ç”¨ä¸šåŠ¡çº¿ç¨‹,å½“ä¸šåŠ¡çº¿ç¨‹å»å‚ä¸Rsetä¿®æ”¹æ—¶,ç³»ç»Ÿæ€§èƒ½ä¸€å®šä¼šå—åˆ°å½±å“,æ‰€ä»¥éœ€è¦å°½åŠ›å»é¿å…è¿™ç§çŠ¶å†µã€‚</p><h3 id="XX-GCTimeRatio"><a href="#XX-GCTimeRatio" class="headerlink" title="-XX:GCTimeRatio"></a>-XX:GCTimeRatio</h3><p>è¿™ä¸ªé€‰é¡¹ä»£è¡¨Javaåº”ç”¨çº¿ç¨‹èŠ±è´¹çš„æ—¶é—´ä¸GCçº¿ç¨‹èŠ±è´¹æ—¶é—´çš„æ¯”ç‡ã€‚é€šè¿‡è¿™ä¸ªæ¯”ç‡å€¼å¯ä»¥è°ƒèŠ‚Javaåº”ç”¨çº¿ç¨‹æˆ–è€…GCçº¿ç¨‹çš„å·¥ä½œæ—¶é—´,ä¿éšœä¸¤è€…çš„æ‰§è¡Œæ—¶é—´.</p><p>HotSpot VMè½¬æ¢è¿™ä¸ªå€¼ä¸ºä¸€ä¸ªç™¾åˆ†æ¯”,å…¬å¼æ˜¯100/(1+GCTimeRatio),é»˜è®¤å€¼æ˜¯9,è¡¨ç¤ºèŠ±è´¹åœ¨GCå·¥ä½œé‡ä¸Šçš„æ—¶é—´å æ€»æ—¶é—´çš„10%ã€‚</p><h3 id="XX-HeapDumpBeforeFullGC-XX-HeapDumpAfterFullGC"><a href="#XX-HeapDumpBeforeFullGC-XX-HeapDumpAfterFullGC" class="headerlink" title="-XX:+HeapDumpBeforeFullGC/-XX:+HeapDumpAfterFullGC"></a>-XX:+HeapDumpBeforeFullGC/-XX:+HeapDumpAfterFullGC</h3><p>è¿™ä¸ªé€‰é¡¹å¯ç”¨ä¹‹å,åœ¨Full GCå¼€å§‹ä¹‹å‰æœ‰ä¸€ä¸ªhprofæ–‡ä»¶ä¼šè¢«åˆ›å»ºã€‚å»ºè®®è¿™ä¸ªé€‰é¡¹å’Œ-XX:+HeapDumpAfterFullGCä¸€èµ·ä½¿ç”¨,å¯ä»¥é€šè¿‡å¯¹Full GCå‘ç”Ÿå‰åçš„Javaå †å†…å­˜è¿›è¡Œå¯¹æ¯”,æ‰¾å‡ºå†…å­˜æ³„æ¼å’Œå…¶ä»–é—®é¢˜ã€‚</p><blockquote><p>è·å–full GCå‰åçš„heap dump</p></blockquote><h3 id="XX-InitiatingHeapOccypancyPercent"><a href="#XX-InitiatingHeapOccypancyPercent" class="headerlink" title="-XX:InitiatingHeapOccypancyPercent"></a>-XX:InitiatingHeapOccypancyPercent</h3><p>è¯¥é€‰é¡¹çš„é»˜è®¤å€¼æ˜¯45,è¡¨ç¤ºG1 GCå¹¶è¡Œå¾ªç¯åˆå§‹è®¾ç½®çš„å †å¤§å°å€¼,è¿™ä¸ªå€¼å†³å®šäº†ä¸€ä¸ªå¹¶è¡Œå¾ªç¯æ˜¯ä¸æ˜¯è¦å¼€å§‹æ‰§è¡Œã€‚å®ƒçš„é€»è¾‘æ˜¯åœ¨ä¸€æ¬¡GCå®Œæˆå,æ¯”è¾ƒè€å¹´ä»£å ç”¨çš„ç©ºé—´å’Œæ•´ä¸ªJavaå †ä¹‹é—´çš„æ¯”ä¾‹ã€‚å¦‚æœå¤§äºè¿™ä¸ªå€¼,åˆ™é¢„çº¦ä¸‹ä¸€æ¬¡GCå¼€å§‹ä¸€ä¸ªå¹¶è¡Œå¾ªç¯å›æ”¶åƒåœ¾,ä»åˆå§‹æ ‡è®°é˜¶æ®µå¼€å§‹ã€‚è¿™ä¸ªå€¼è¶Šå°,GCè¶Šé¢‘ç¹,åä¹‹,å€¼è¶Šå¤§,å¯ä»¥è®©åº”ç”¨ç¨‹åºæ‰§è¡Œæ—¶é—´æ›´é•¿ã€‚ä¸è¿‡åœ¨å†…å­˜æ¶ˆè€—å¾ˆå¿«çš„æƒ…å†µä¸‹,æˆ‘è®¤ä¸ºæ—©è¿è¡Œå¹¶è¡Œå¾ªç¯æ¯”æ™šè¿è¡Œè¦å¥½,çœ‹ç—…è¦è¶æ—©ã€‚</p><h3 id="XX-UseStringDeduplication"><a href="#XX-UseStringDeduplication" class="headerlink" title="-XX:+UseStringDeduplication"></a>-XX:+UseStringDeduplication</h3><p>è¯¥é€‰é¡¹å¯åŠ¨Java Stringå¯¹è±¡çš„å»é‡å·¥ä½œã€‚JDK8u20å¼€å§‹å¼•å…¥è¯¥é€‰é¡¹,é»˜è®¤ä¸ºä¸å¯ç”¨ã€‚æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªåˆ¤æ–­Java Stringå¯¹è±¡å€¼æ˜¯å¦ä¸€æ ·çš„è¯­å¥â€œStringl equals(String2)tueâ€,å¦‚æœå¼€å¯äº†è¯¥é€‰é¡¹,å¹¶ä¸”å¦‚æœä¸¤ä¸ªå¯¹è±¡åŒ…å«ç›¸åŒçš„å†…å®¹,å³è¿”å›â€œtueâ€,åˆ™ä¸¤ä¸ªStringå¯¹è±¡åªä¼šå…±äº«ä¸€ä¸ªå­—ç¬¦æ•°ç»„ã€‚è¿™ä¸ªé€‰é¡¹æ˜¯G1GCç‹¬æœ‰çš„,ä¹Ÿå¯ä»¥å’Œå…¶ä»–GCä¸€èµ·ä½¿ç”¨ã€‚</p><p>å»¶ä¼¸ä¸€ç‚¹æˆ‘ä»¬çš„çŸ¥è¯†é¢,ä¸€ä¸ªå»é‡å¯¹è±¡çš„å¿…å¤‡æ¡ä»¶æœ‰å¦‚ä¸‹ä¸‰ç‚¹:</p><ul><li>Java.lang Stringå¯¹è±¡çš„ä¸€ä¸ªå®ä¾‹ã€‚</li><li>è¿™ä¸ªå¯¹è±¡åœ¨å¹´è½»ä»£å †åŒºé—´ã€‚</li><li>è¿™ä¸ªå¯¹è±¡çš„å¹´é¾„è¾¾åˆ°å»é‡å¹´é¾„ä»£,æˆ–è€…è¿™ä¸ªå¯¹è±¡å·²ç»åœ¨è€å¹´ä»£å †åŒºé—´å¹¶ä¸”å¯¹è±¡å¹´é¾„æ¯”å»é‡å¹´é¾„å°ã€‚é€‰é¡¹-XX:StringDeduplicationAgeThresholdè®¾ç½®äº†è¿™ä¸ªå¹´é¾„ç•Œé™ã€‚</li></ul><p>å‰é¢ä»‹ç»è¿‡çš„å¯ä¿®æ”¹å’Œä¸å¯ä¿®æ”¹å­—ç¬¦ä¸²çš„å¤„ç†æ–¹å¼æœ‰æ‰€ä¸åŒ,ä¸å¯ä¿®æ”¹å­—ç¬¦ä¸²é»˜è®¤å°±æ˜¯å»é‡çš„,åœ¨æ’å…¥åˆ°HotSpot VMçš„String Tableæ—¶å·²ç»æ³¨æ˜äº†æ˜¯å»é‡çš„,è¿™æ ·å°±é¿å…äº†HotSpotæœåŠ¡å™¨JITç¼–è¯‘ä¼˜åŒ–æªæ–½ã€‚</p><h3 id="XX-StringDeduplicationAgeThreshold"><a href="#XX-StringDeduplicationAgeThreshold" class="headerlink" title="-XX:StringDeduplicationAgeThreshold"></a>-XX:StringDeduplicationAgeThreshold</h3><p>è¿™ä¸ªé€‰é¡¹æ˜¯é’ˆå¯¹-XX:+UseStringDeduplicationé€‰é¡¹çš„,é»˜è®¤å€¼æ˜¯3ã€‚å®ƒçš„æ„æ€æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å¹´é¾„è¶…è¿‡è®¾å®šçš„é˜ˆå€¼,æˆ–è€…æå‡åˆ°G1 GCè€å¹´ä»£Regionä¹‹å,å°±ä¼šæˆä¸ºå­—ç¬¦ä¸²å»é‡çš„å€™é€‰å¯¹è±¡,å»é‡æ“ä½œåªä¼šæœ‰ä¸€æ¬¡ã€‚</p><h3 id="XX-PrintStringDeduplicationStatistics"><a href="#XX-PrintStringDeduplicationStatistics" class="headerlink" title="-XX:+PrintStringDeduplicationStatistics"></a>-XX:+PrintStringDeduplicationStatistics</h3><p>è¿™ä¸ªé€‰é¡¹æŒºæœ‰ç”¨çš„,èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬é€šè¿‡è¯»å–è¾“å‡ºçš„ç»Ÿè®¡èµ„æ–™æ¥äº†è§£æ˜¯å¦å­—ç¬¦ä¸²å»é‡åèŠ‚çº¦äº†å¤§é‡çš„å †å†…å­˜ç©ºé—´,é»˜è®¤æ˜¯å…³é—­çš„,å°±æ˜¯è¯´ä¸ä¼šè¾“å‡ºå­—ç¬¦ä¸²å»é‡çš„ç»Ÿè®¡èµ„æ–™ã€‚</p><h3 id="XX-G1UseAdaptiveIHOP"><a href="#XX-G1UseAdaptiveIHOP" class="headerlink" title="-XX:+G1UseAdaptiveIHOP"></a>-XX:+G1UseAdaptiveIHOP</h3><p>JDK9æä¾›çš„æ–°çš„é€‰é¡¹ã€‚<font color="DeepPink">è¿™ä¸ªé€‰é¡¹çš„ä½œç”¨æ˜¯é€šè¿‡åŠ¨æ€è°ƒèŠ‚æ ‡è®°é˜¶æ®µå¼€å§‹çš„æ—¶é—´,ä»¥è¾¾åˆ°æå‡åº”ç”¨ç¨‹åºååé‡çš„ç›®æ ‡,ä¸»è¦é€šè¿‡å°½å¯èƒ½è¿Ÿåœ°è§¦å‘æ ‡è®°å¾ªç¯æ–¹å¼æ¥é¿å…æ¶ˆè€—è€å¹´ä»£ç©ºé—´ã€‚</font></p><p>è¿™ä¸ªé€‰é¡¹çš„å€¼åœ¨VMåˆšå¼€å§‹å¯åŠ¨æ—¶å’Œ-XX:InitiatingHeapOccupancyPercentçš„å€¼ä¸€æ ·,å¦‚æœå‡ºç°æ ‡è®°å¾ªç¯é˜¶æ®µå†…å­˜ä¸å¤Ÿç”¨,åˆ™å®ƒä¼šè‡ªåŠ¨è°ƒèŠ‚å¤§å°,ç¡®ä¿æ ‡è®°å¾ªç¯å¯ç”¨æ›´å¤šçš„å †å†…å­˜ã€‚</p><p>æ³¨æ„,-XX:+G1UseAdaptiveIHOPè¿™ä¸ªé€‰é¡¹ä¼šåœ¨JDK9é‡Œé»˜è®¤å¯ç”¨,å³-XX:InitiatingHeapOccupancyPercentå’ŒXX:+GIUseAdaptivelHOPåœ¨JDK9ä¹‹ååªéœ€è¦å¯ç”¨ä¸€ä¸ªå°±å¯ä»¥äº†ã€‚</p><p>JDK8ç¯å¢ƒä¸‹è¿è¡Œè¯¥é€‰é¡¹ä¼šè¾“å‡º:â€œUnrecognized VM option â€˜G1UseAdaptivelHOPâ€™â€</p><h3 id="XX-MaxGCPauseMills"><a href="#XX-MaxGCPauseMills" class="headerlink" title="-XX:+MaxGCPauseMills"></a>-XX:+MaxGCPauseMills</h3><p>è¿™ä¸ªé€‰é¡¹æ¯”è¾ƒé‡è¦ã€‚å®ƒè®¾ç½®äº†G1çš„ç›®æ ‡åœé¡¿æ—¶é—´,å•ä½æ˜¯ms,é»˜è®¤å€¼ä¸º200msã€‚è¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªç›®æ ‡æ—¶é—´,è€Œä¸æ˜¯æœ€å¤§åœé¡¿æ—¶é—´ã€‚G1 GCå°½æœ€å¤§åŠªåŠ›ç¡®ä¿å¹´è½»ä»£çš„å›æ”¶æ—¶é—´å¯ä»¥æ§åˆ¶åœ¨è¿™ä¸ªç›®æ ‡åœé¡¿æ—¶é—´èŒƒå›´é‡Œé¢,åœ¨G1GCä½¿ç”¨è¿‡ç¨‹ä¸­,è¿™ä¸ªé€‰é¡¹å’Œ-Xmsã€Xmxä¸¤ä¸ªé€‰é¡¹ä¸€èµ·ä½¿ç”¨,å®ƒä»¬ä¸‰ä¸ªä¹Ÿæœ€å¥½åœ¨JVMå¯åŠ¨æ—¶å°±ä¸€èµ·é…ç½®å¥½ã€‚</p><h3 id="XX-MinHeapFreeRatio"><a href="#XX-MinHeapFreeRatio" class="headerlink" title="-XX:+MinHeapFreeRatio"></a>-XX:+MinHeapFreeRatio</h3><p>è¿™ä¸ªé€‰é¡¹è®¾ç½®å †å†…å­˜é‡Œå¯ä»¥ç©ºé—²çš„æœ€å°çš„å†…å­˜ç©ºé—´å¤§å°,é»˜è®¤å€¼ä¸ºå †å†…å­˜çš„40%ã€‚å½“ç©ºé—²å †å†…å­˜å¤§å°å°äºè¿™ä¸ªè®¾ç½®çš„å€¼æ—¶,æˆ‘ä»¬éœ€è¦åˆ¤æ–­-Xmså’Œ-Xmxè¿™ä¸¤ä¸ªå€¼çš„åˆå§‹åŒ–è®¾ç½®å€¼,å¦‚æœ-Xmså’Œ-Xmxä¸ä¸€æ ·,é‚£ä¹ˆæˆ‘ä»¬å°±æœ‰æœºä¼šæ‰©å±•å †å†…å­˜,å¦åˆ™å°±æ— æ³•æ‰©å±•ã€‚</p><h3 id="XX-MaxHeapFreeRatio"><a href="#XX-MaxHeapFreeRatio" class="headerlink" title="-XX:+MaxHeapFreeRatio"></a>-XX:+MaxHeapFreeRatio</h3><p>è¿™ä¸ªé€‰é¡¹è®¾ç½®æœ€å¤§ç©ºé—²ç©ºé—´å¤§å°,é»˜è®¤å€¼ä¸ºå †å†…å­˜çš„70%ã€‚è¿™ä¸ªé€‰é¡¹å’Œä¸Šé¢é‚£ä¸ªæœ€å°å †å†…å­˜ç©ºé—²å¤§å°åˆšå¥½ç›¸å,å½“å¤§äºè¿™ä¸ªç©ºé—²æ¯”ç‡æ—¶,G1 GCä¼šè‡ªåŠ¨å‡å°‘å †å†…å­˜å¤§å°ã€‚éœ€è¦åˆ¤æ–­-Xmså’Œ-Xmxè¿™ä¸¤ä¸ªå€¼çš„åˆå§‹åŒ–è®¾ç½®å€¼,å¦‚æœ-Xmså’Œ-Xmxä¸ä¸€æ ·,é‚£ä¹ˆå°±æœ‰æœºä¼šå‡å°å †å†…å­˜,å¦åˆ™å°±æ— æ³•å‡å°ã€‚</p><h3 id="XX-PrintAdaptiveSizePolicy"><a href="#XX-PrintAdaptiveSizePolicy" class="headerlink" title="-XX:+PrintAdaptiveSizePolicy"></a>-XX:+PrintAdaptiveSizePolicy</h3><p>è¿™ä¸ªé€‰é¡¹å†³å®šæ˜¯å¦å¼€å¯å †å†…å­˜å¤§å°å˜åŒ–çš„ç›¸åº”è®°å½•ä¿¡æ¯æ‰“å°,å³æ˜¯å¦æ‰“å°è¿™äº›ä¿¡æ¯åˆ°GCæ—¥å¿—é‡Œé¢ã€‚è¿™ä¸ªä¿¡æ¯å¯¹äºParallel GCå’ŒG1 GCéƒ½å¾ˆæœ‰ç”¨ã€‚</p><h3 id="XX-ResizePLAB"><a href="#XX-ResizePLAB" class="headerlink" title="-XX:+ResizePLAB"></a>-XX:+ResizePLAB</h3><p>GCä½¿ç”¨çš„æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å­˜å—é‡‡ç”¨åŠ¨æ€å€¼è¿˜æ˜¯é™æ€å€¼è¿›è¡Œè®¾ç½®æ˜¯ç”±è¿™ä¸ªé€‰é¡¹å†³å®šçš„,å®ƒé»˜è®¤æ˜¯å¼€å¯çš„,è¿™ä¸ªè®¾ç½®å¯¹åº”çš„æ˜¯GCåœ¨æå‡å¯¹è±¡æ—¶æ˜¯å¦ä¼šè°ƒæ•´PLABçš„å¤§å°ã€‚</p><p>è¿™ä¸ªé€‰é¡¹å¤§å®¶è¿˜æ˜¯æ…ç”¨,æ®è¯´ä¼šå‡ºç°æ€§èƒ½é—®é¢˜,å¯ç”¨åå¯èƒ½ä¼šå¢åŠ GCçš„åœé¡¿æ—¶é—´ã€‚å½“åº”ç”¨å¼€å¯çš„çº¿ç¨‹è¾ƒå¤šæ—¶,æœ€å¥½ä½¿ç”¨-XX:ResizePlaBæ¥å…³é—­PLAB()çš„å¤§å°è°ƒæ•´,ä»¥é¿å…å¤§é‡çš„çº¿ç¨‹é€šä¿¡æ‰€å¯¼è‡´çš„æ€§èƒ½ä¸‹é™ã€‚</p><h3 id="XX-ResizeTLAB"><a href="#XX-ResizeTLAB" class="headerlink" title="-XX:+ResizeTLAB"></a>-XX:+ResizeTLAB</h3><p>Javaåº”ç”¨çº¿ç¨‹ä½¿ç”¨çš„æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å­˜å—é‡‡ç”¨åŠ¨æ€å€¼è¿˜æ˜¯é™æ€å€¼è¿›è¡Œè®¾ç½®æ˜¯ç”±è¿™ä¸ªé€‰é¡¹å†³å®šçš„,å®ƒé»˜è®¤æ˜¯å¼€å¯çš„,å³TLABå€¼ä¼šè¢«åŠ¨æ€è°ƒæ•´ã€‚</p><h3 id="XX-ClassUnloadingWithConcurrentMark"><a href="#XX-ClassUnloadingWithConcurrentMark" class="headerlink" title="-XX:+ClassUnloadingWithConcurrentMark"></a>-XX:+ClassUnloadingWithConcurrentMark</h3><p>è¿™ä¸ªé€‰é¡¹å¼€å¯åœ¨G1 GCå¹¶è¡Œå¾ªç¯é˜¶æ®µå¸è½½ç±»,å°¤å…¶æ˜¯åœ¨è€å¹´ä»£çš„å¹¶è¡Œå›æ”¶é˜¶æ®µ,é»˜è®¤æ˜¯å¼€å¯çš„ã€‚è¿™ä¸ªé€‰é¡¹å¼€å¯åä¼šåœ¨å¹¶è¡Œå¾ªç¯çš„é‡æ ‡è®°é˜¶æ®µå¸è½½JVMæ²¡æœ‰ç”¨åˆ°çš„ç±»,è¿™äº›å·¥ä½œä¹Ÿå¯ä»¥æ”¾åœ¨Full GCé‡Œé¢å»åš,ä½†æ˜¯æå‰åšäº†æœ‰å¾ˆå¤§çš„å¥½å¤„ã€‚ä½†å› ä¸ºå¼€å¯å®ƒæ„å‘³ç€é‡æ ‡è®°é˜¶æ®µçš„GCåœé¡¿æ—¶é—´ä¼šæ‹‰é•¿,è¿™æ—¶å€™æˆ‘ä»¬å°±è¦åˆ¤æ–­æ€§ä»·æ¯”äº†,å¦‚æœGCåœé¡¿æ—¶é—´æ¯”æˆ‘ä»¬è®¾ç½®çš„æœ€å¤§GCåœé¡¿ç›®æ ‡æ—¶é—´è¿˜é•¿,å¹¶ä¸”éœ€è¦å¸è½½çš„ç±»ä¹Ÿä¸å¤š,é‚£è¿˜æ˜¯å…³é—­è¿™ä¸ªé€‰é¡¹å§ã€‚</p><h3 id="XX-ClassUnloading"><a href="#XX-ClassUnloading" class="headerlink" title="-XX:+ClassUnloading"></a>-XX:+ClassUnloading</h3><p>é»˜è®¤å€¼æ˜¯Ture,å†³å®šäº†JVMæ˜¯å¦ä¼šå¸è½½æ‰€æœ‰æ— ç”¨çš„ç±»,å¦‚æœå…³é—­äº†è¿™ä¸ªé€‰é¡¹,æ— è®ºæ˜¯å¹¶è¡Œå›æ”¶å¾ªç¯,è¿˜æ˜¯Full GC,éƒ½ä¸ä¼šå†å¸è½½è¿™äº›ç±»äº†,æ‰€ä»¥éœ€è°¨æ…å…³é—­ã€‚</p><h3 id="XX-UnlockDiagnosticVMOptions"><a href="#XX-UnlockDiagnosticVMOptions" class="headerlink" title="-XX:+UnlockDiagnosticVMOptions"></a>-XX:+UnlockDiagnosticVMOptions</h3><p>è¿™ä¸ªé€‰é¡¹å†³å®šæ˜¯å¦å¼€å¯è¯Šæ–­é€‰é¡¹,é»˜è®¤å€¼æ˜¯False,å³ä¸å¼€å¯åœ¨GCé‡Œé¢æœ‰ä¸€äº›é€‰é¡¹ç§°ä¹‹ä¸ºè¯Šæ–­é€‰é¡¹(Diagnostic Options),é€šè¿‡-XX:+PrintFlagsFinal å’ŒXX:+Unlockã€‚DiagnosticVMOptionsè¿™ä¸¤ä¸ªé€‰é¡¹ç»„åˆèµ·æ¥è¿è¡Œ,å°±å¯ä»¥è¾“å‡ºå¹¶æŸ¥çœ‹è¿™äº›é€‰é¡¹ã€‚</p><h3 id="XX-UnlockExperimentalVMOptions"><a href="#XX-UnlockExperimentalVMOptions" class="headerlink" title="-XX:+UnlockExperimentalVMOptions"></a>-XX:+UnlockExperimentalVMOptions</h3><p>é™¤äº†ä¹‹å‰è¯´çš„è¯Šæ–­é€‰é¡¹ä»¥å¤–,JVMè¿˜æœ‰ä¸€äº›å«ä½œè¯•éªŒé€‰é¡¹(Experimental Options),è¿™äº›é€‰é¡¹ä¹Ÿéœ€è¦é€šè¿‡XX:+UnlockExperimentalVMOptionsè¿™ä¸ªé€‰é¡¹å¼€å¯,é»˜è®¤æ˜¯å…³é—­çš„ã€‚</p><p>å’Œè¯Šæ–­é€‰é¡¹ä¸€æ ·,ä¹Ÿå¯ä»¥å’Œ-XX:+PrintFlagsFinalé€‰é¡¹è”åˆä½¿ç”¨,å³-XX:+PrintFlagsFinalå’Œ-XX:+UnlockExperimental VMOptionsè¿™ä¸¤ä¸ªé€‰é¡¹è”åˆä½¿ç”¨æ—¶å¯ä»¥è¾“å‡ºæ—¥å¿—,è¾“å‡ºçš„æ—¥å¿—å·²ç»åŒ…å«åœ¨äº†å‰ä¸€ä¸ªé€‰é¡¹-XX:+UnlockDiagnosticVMOptionsçš„è¿è¡Œè¾“å‡ºé‡Œ,è¿™é‡Œå°±ä¸å†é‡å¤ã€‚</p><p>æ€»çš„æ¥è¯´,è¿™äº›è¯•éªŒé€‰é¡¹å¯¹æ•´ä½“åº”ç”¨æ€§èƒ½å¯èƒ½ä¼šæœ‰äº›å¥½å¤„,ä½†æ˜¯å®ƒä»¬å¹¶æ²¡æœ‰ç»å†å®Œæ•´çš„æµ‹è¯•ç¯èŠ‚,æ‰€ä»¥ç§°ä¸ºè¯•éªŒé€‰é¡¹ã€‚</p><h3 id="XX-UnlockCommercialFeatures"><a href="#XX-UnlockCommercialFeatures" class="headerlink" title="-XX:+UnlockCommercialFeatures"></a>-XX:+UnlockCommercialFeatures</h3><p>è¿™ä¸ªé€‰é¡¹åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ Oracleç‰¹æœ‰çš„ç‰¹æ€§,é»˜è®¤æ˜¯å…³é—­çš„ã€‚</p><p>æœ‰ä¸€äº›å±æ€§æ˜¯Oracleå…¬å¸é’ˆå¯¹Oracleçš„Javaè¿è¡Œæ—¶ç‹¬æœ‰çš„,æ²¡æœ‰è¢«åŒ…å«åœ¨OpenJDKé‡Œé¢ã€‚ä¸¾ä¸ªä¾‹å­,æ¯”å¦‚è¯´ Oracleçš„ç›‘æ§å’Œç®¡ç†å·¥å…·Java Mission Control,å®ƒæœ‰ä¸€ä¸ªç‰¹æ€§å«ä½œJava Flight Recorder,è¿™ä¸ªç‰¹æ€§ä½œä¸ºJava Mission Controlçš„ä¸€éƒ¨åˆ†,å±äºäº‹ä»¶å›æ”¶æ¡†æ¶,å¯ä»¥è¢«ç”¨æ¥æ˜¾ç¤ºåº”ç”¨ç¨‹åºå’ŒJVMçš„åº•å±‚ä¿¡æ¯ã€‚</p><h1 id="æ·±å…¥G1-GC"><a href="#æ·±å…¥G1-GC" class="headerlink" title="æ·±å…¥G1 GC"></a>æ·±å…¥G1 GC</h1><h2 id="G1-GCæ¦‚å¿µç®€ä»‹"><a href="#G1-GCæ¦‚å¿µç®€ä»‹" class="headerlink" title="G1 GCæ¦‚å¿µç®€ä»‹"></a>G1 GCæ¦‚å¿µç®€ä»‹</h2><h3 id="èƒŒæ™¯çŸ¥è¯†"><a href="#èƒŒæ™¯çŸ¥è¯†" class="headerlink" title="èƒŒæ™¯çŸ¥è¯†"></a>èƒŒæ™¯çŸ¥è¯†</h3><p>G1ä½¿ç”¨äº†å…¨æ–°çš„åˆ†åŒºç®—æ³•,å…¶ç‰¹ç‚¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>å¹¶è¡Œæ€§ï¼šG1åœ¨å›æ”¶æœŸé—´,å¯ä»¥æœ‰å¤šä¸ªGCçº¿ç¨‹åŒæ—¶å·¥ä½œ,å¯ä»¥æœ‰æ•ˆåˆ©ç”¨å¤šæ ¸çš„è®¡ç®—èƒ½åŠ›</li><li>å¹¶å‘æ€§ï¼šG1æ‹¥æœ‰ä¸åº”ç”¨ç¨‹åºäº¤æ›¿æ‰§è¡Œçš„èƒ½åŠ›,éƒ¨åˆ†å·¥ä½œå¯ä»¥å’Œåº”ç”¨ç¨‹åºåŒæ—¶æ‰§è¡Œ,å› æ­¤,ä¸€èˆ¬æ¥è¯´,ä¸ä¼šåœ¨æ•´ä¸ªå›æ”¶é˜¶æ®µå‘ç”Ÿå®Œå…¨é˜»å¡åº”ç”¨ç¨‹åºçš„æƒ…å†µã€‚</li><li>åˆ†ä»£GCï¼šG1ä¾ç„¶æ˜¯ä¸€ä¸ªåˆ†ä»£æ”¶é›†å™¨,ä½†æ˜¯å’Œä¹‹å‰çš„å„ç±»å›æ”¶å™¨ä¸åŒ,å®ƒåŒæ—¶å…¼é¡¾äº†å¹´è½»ä»£å’Œè€å¹´ä»£ã€‚å¯¹æ¯”å…¶ä»–å›æ”¶å™¨,å®ƒä»¬æˆ–è€…å·¥ä½œåœ¨å¹´è½»ä»£,æˆ–è€…å·¥ä½œåœ¨è€å¹´ä»£ã€‚</li><li>ç©ºé—´æ•´ç†ï¼šG1åœ¨å›æ”¶è¿‡ç¨‹ä¸­,ä¼šè¿›è¡Œé€‚å½“çš„å¯¹è±¡ç§»åŠ¨,ä¸åƒCMSé‚£æ ·åªæ˜¯ç®€å•åœ°æ ‡è®°æ¸…ç†å¯¹è±¡ã€‚åœ¨è‹¥å¹²æ¬¡GCå,CMSå¿…é¡»è¿›è¡Œä¸€æ¬¡ç¢ç‰‡æ•´ç†ã€‚è€ŒG1ä¸åŒ,å®ƒæ¯æ¬¡å›æ”¶éƒ½ä¼šæœ‰æ•ˆåœ°å¤åˆ¶å¯¹è±¡,å‡å°‘ç©ºé—´ç¢ç‰‡,è¿›è€Œæå‡å†…éƒ¨å¾ªç¯é€Ÿåº¦ã€‚</li><li>å¯é¢„è§æ€§ï¼šç”±äºåˆ†åŒºçš„åŸå› ,G1å¯ä»¥åªé€‰å–éƒ¨åˆ†åŒºåŸŸè¿›è¡Œå†…å­˜å›æ”¶,è¿™æ ·ç¼©å°äº†å›æ”¶çš„èŒƒå›´,å› æ­¤å¯¹äºå…¨å±€åœé¡¿æƒ…å†µçš„å‘ç”Ÿä¹Ÿèƒ½å¾—åˆ°è¾ƒå¥½çš„æ§åˆ¶ã€‚</li></ul><p><font color="DeepPink">éšç€G1 GCçš„å‡ºç°,GCä»ä¼ ç»Ÿçš„è¿ç»­å †å†…å­˜å¸ƒå±€é€æ¸èµ°å‘äº†ä¸è¿ç»­å†…å­˜å—å¸ƒå±€,è¿™æ˜¯é€šè¿‡å¼•å…¥Regionæ¦‚å¿µå®ç°çš„,ä¹Ÿå°±æ˜¯è¯´,ç”±ä¸€å †ä¸è¿ç»­çš„Regionç»„æˆäº†å †å†…å­˜ã€‚å…¶å®ä¹Ÿä¸èƒ½è¯´æ˜¯ä¸è¿ç»­çš„,åªæ˜¯å®ƒä»ä¼ ç»Ÿçš„ç‰©ç†è¿ç»­é€æ¸æ”¹å˜ä¸ºé€»è¾‘ä¸Šçš„è¿ç»­</font>,è¿™æ˜¯é€šè¿‡Regionçš„åŠ¨æ€åˆ†é…æ–¹å¼å®ç°çš„,å¯ä»¥æŠŠä¸€ä¸ªRegionåˆ†é…ç»™Edenã€Surviâ…³vorã€è€å¹´ä»£ã€å¤§å¯¹è±¡åŒºé—´ã€ç©ºé—²åŒºé—´ç­‰åŒºé—´çš„ä»»æ„ä¸€ä¸ª,è€Œä¸æ˜¯å›ºå®šå®ƒçš„ä½œç”¨,å› ä¸ºè¶Šæ˜¯å›ºå®š,è¶Šæ˜¯å‘†æ¿ã€‚</p><h3 id="G1çš„åŒºé—´è®¾è®¡çµæ„Ÿ"><a href="#G1çš„åŒºé—´è®¾è®¡çµæ„Ÿ" class="headerlink" title="G1çš„åŒºé—´è®¾è®¡çµæ„Ÿ"></a>G1çš„åŒºé—´è®¾è®¡çµæ„Ÿ</h3><p><font color="DeepPink">åœ¨G1ä¸­,å †è¢«å¹³å‡åˆ†æˆè‹¥å¹²ä¸ªå¤§å°ç›¸ç­‰çš„åŒºåŸŸ(Region)ã€‚æ¯ä¸ªRegionéƒ½æœ‰ä¸ªå…³è”çš„Remembered Set(ç®€ç§°RS),RSçš„æ•°æ®ç»“æ„æ˜¯Hashè¡¨,é‡Œé¢çš„æ•°æ®æ˜¯Card Table(å †ä¸­æ¯512byteæ˜ å°„åœ¨card table 1byte)ã€‚ç®€å•åœ°è¯´,RSé‡Œé¢å­˜åœ¨çš„æ˜¯Regionä¸­å­˜æ´»å¯¹è±¡çš„æŒ‡é’ˆã€‚å½“Regionä¸­æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶,é¦–å…ˆåæ˜ åˆ°Card Tableä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªCardä¸Š,RSé€šè¿‡æ‰«æå†…éƒ¨çš„Card Tableå¾—çŸ¥Regionä¸­å†…å­˜ä½¿ç”¨æƒ…å†µå’Œå­˜æ´»å¯¹è±¡ã€‚åœ¨ä½¿ç”¨Regionè¿‡ç¨‹ä¸­,å¦‚æœRegion è¢«å¡«æ»¡äº†,åˆ†é…å†…å­˜çš„çº¿ç¨‹ä¼šé‡æ–°é€‰æ‹©ä¸€ä¸ªæ–°çš„Region,ç©ºé—²Regionè¢«ç»„ç»‡åˆ°ä¸€ä¸ªåŸºäºé“¾è¡¨çš„æ•°æ®ç»“æ„(LinkedListé‡Œé¢,è¿™æ ·å¯ä»¥å¿«é€Ÿæ‰¾åˆ°æ–°çš„Regionã€‚</font></p><h2 id="G1-GCåˆ†ä»£ç®¡ç†"><a href="#G1-GCåˆ†ä»£ç®¡ç†" class="headerlink" title="G1 GCåˆ†ä»£ç®¡ç†"></a>G1 GCåˆ†ä»£ç®¡ç†</h2><h3 id="å¹´è½»ä»£"><a href="#å¹´è½»ä»£" class="headerlink" title="å¹´è½»ä»£"></a>å¹´è½»ä»£</h3><p>é™¤éæˆ‘ä»¬æ˜¾ç¤ºåœ°é€šè¿‡å‘½ä»¤è¡Œæ–¹å¼å£°æ˜äº†å¹´è½»ä»£çš„åˆå§‹åŒ–å€¼å’Œæœ€å¤§å€¼çš„å¤§å°,å¦åˆ™ï¼Œä¸€èˆ¬æ¥è¯´,åˆå§‹åŒ–å€¼é»˜è®¤æ˜¯æ•´ä¸ªJavaå †å¤§å°çš„5%(é€šè¿‡é€‰é¡¹-XX:G1NewSizePercentè®¾ç½®),æœ€å¤§å€¼é»˜è®¤æ˜¯æ•´ä¸ªJavaå †å¤§å°çš„60%(é€šè¿‡é€‰é¡¹-XX:G1MaxNewSizePercentè®¾ç½®)ã€‚</p><h3 id="å›æ”¶é›†åˆåŠå…¶é‡è¦æ€§"><a href="#å›æ”¶é›†åˆåŠå…¶é‡è¦æ€§" class="headerlink" title="å›æ”¶é›†åˆåŠå…¶é‡è¦æ€§"></a>å›æ”¶é›†åˆåŠå…¶é‡è¦æ€§</h3><p>ä»»ä½•ä¸€æ¬¡åƒåœ¾å›æ”¶éƒ½ä¼šé‡Šæ”¾CSeté‡Œé¢çš„æ‰€æœ‰åŒºé—´ã€‚ä¸€ä¸ªCSetç”±ä¸€ç³»åˆ—çš„ç­‰å¾…å›æ”¶çš„åŒºé—´æ‰€ç»„æˆã€‚åœ¨ä¸€æ¬¡åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­,è¿™äº›å›æ”¶å€™é€‰åŒºé—´çš„å­˜æ´»å¯¹è±¡ä¼šè¢«æ•´ä½“è¯„ä¼°,å¹¶ä¸”åœ¨å›æ”¶ç»“æŸåè¿™äº›åŒºé—´ä¼šè¢«åŠ å…¥åˆ°ç©ºé—²åŒºé—´é˜Ÿåˆ—(LinkedListé˜Ÿåˆ—)ã€‚åœ¨ä¸€æ¬¡å¹´è½»ä»£å›æ”¶è¿‡ç¨‹ä¸­,csetåªä¼šåŒ…å«å¹´è½»ä»£åŒºé—´,è€Œåœ¨ä¸€ä¸ªæ··åˆå›æ”¶è¿‡ç¨‹ä¸­,CSetä¼šåœ¨å¹´è½»ä»£åŒºé—´åŸºç¡€ä¸Šå†åŒ…å«ä¸€äº›è€å¹´ä»£åŒºé—´,è¿™å°±æ˜¯æ–°å¢çš„æ··åˆå›æ”¶æ¦‚å¿µ,ä¸å†å¯¹å¹´è½»ä»£å’Œè€å¹´ä»£å®Œå…¨åˆ‡åˆ†ã€‚</p><p>G1 GCæä¾›äº†ä¸¤ä¸ªé€‰é¡¹ç”¨äºå¸®åŠ©é€‰æ‹©è¿›å…¥CSetçš„å€™é€‰è€å¹´ä»£åŒºé—´: </p><ul><li>-XX:G1MixedGCLiveThresholdPercent:JDK8u45é»˜è®¤å€¼ä¸ºä¸€ä¸ªG1 GCåŒºé—´çš„85%ã€‚è¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªå­˜æ´»å¯¹è±¡çš„é˜ˆå€¼,å¹¶ä¸”èµ·åˆ°äº†ä»æ··åˆå›æ”¶çš„CSeté‡Œæ’é™¤ä¸€äº›è€å¹´ä»£åŒºé—´çš„ä½œç”¨,å³å¯ä»¥ç†è§£ä¸ºG1 GCé™åˆ¶CSetä»…åŒ…å«ä½äºè¿™ä¸ªé˜ˆå€¼(é»˜è®¤85%)çš„è€å¹´ä»£åŒºé—´,è¿™æ ·å¯ä»¥å‡å°‘åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­æ‹·è´å¯¹è±¡æ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚</li><li>-XX:G1OldCSetRegionThresholdPercent:JDK8u45é»˜è®¤å€¼ä¸ºæ•´ä¸ªJavaå †åŒºçš„10%ã€‚è¿™ä¸ªå€¼è®¾ç½®äº†å¯ä»¥è¢«ç”¨äºä¸€æ¬¡æ··åˆå›æ”¶æš‚åœæ‰€å›æ”¶çš„æœ€å¤§è€å¹´ä»£åŒºé—´æ•°é‡ã€‚è¿™ä¸ªé˜ˆå€¼å–å†³äºJVMè¿›ç¨‹æ‰€èƒ½ä½¿ç”¨çš„Javaå †çš„ç©ºé—²ç©ºé—´ã€‚</li></ul><h3 id="RSetåŠå…¶é‡è¦æ€§"><a href="#RSetåŠå…¶é‡è¦æ€§" class="headerlink" title="RSetåŠå…¶é‡è¦æ€§"></a>RSetåŠå…¶é‡è¦æ€§</h3><p>ä¸€ä¸ªRSetæ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„,è¿™ä¸ªæ•°æ®ç»“æ„å¸®åŠ©ç»´æŠ¤å’Œè·Ÿè¸ªåœ¨å®ƒä»¬å•å…ƒå†…éƒ¨çš„å¯¹è±¡å¼•ç”¨ä¿¡æ¯,åœ¨G1 GCé‡Œ,è¿™ä¸ªå•å…ƒå°±æ˜¯åŒºé—´(Region),ä¹Ÿå°±æ˜¯è¯´,G1 GCé‡Œæ¯ä¸€ä¸ªRSetå¯¹åº”çš„æ˜¯ä¸€ä¸ªåŒºé—´å†…éƒ¨çš„å¯¹è±¡å¼•ç”¨æƒ…å†µã€‚æœ‰äº†RSet,å°±ä¸éœ€è¦æ‰«ææ•´ä¸ªå †å†…å­˜äº†,å½“G1 GCæ‰§è¡ŒSTWç‹¬å å›æ”¶(å¹´è½»ä»£ã€æ··åˆä»£å›æ”¶)æ—¶,åªéœ€è¦æ‰«ææ¯ä¸€ä¸ªåŒºé—´å†…éƒ¨çš„RSetå°±å¯ä»¥äº†ã€‚å› ä¸ºæ‰€æœ‰RSetéƒ½ä¿å­˜åœ¨CSeté‡Œé¢,å³Region-RSet-CSetè¿™æ ·çš„æ¦‚å¿µ,æ‰€ä»¥ä¸€æ—¦åŒºé—´å†…éƒ¨çš„å­˜æ´»å¯¹è±¡è¢«ç§»é™¤,RSeté‡Œé¢ä¿å­˜çš„å¼•ç”¨ä¿¡æ¯ä¹Ÿä¼šç«‹å³è¢«æ›´æ–°ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½å¤Ÿç†è§£RSetå°±æ˜¯ä¸€å¼ è™šæ‹Ÿçš„å¯¹è±¡å¼•ç”¨è¡¨äº†,æ¯ä¸ªåŒºé—´å†…éƒ¨éƒ½æœ‰è¿™ä¹ˆä¸€å¼ è¡¨å­˜åœ¨,å¸®åŠ©å¯¹åŒºé—´å†…éƒ¨çš„å¯¹è±¡å­˜æ´»æƒ…å†µã€åŸºæœ¬ä¿¡æ¯åšæœ‰åºé«˜æ•ˆçš„ç®¡ç†ã€‚</p><p>G1 GCçš„å¹´è½»ä»£å›æ”¶æˆ–è€…æ··åˆå›æ”¶é˜¶æ®µ,ç”±äºå¹´è½»ä»£è¢«å°½å¯èƒ½åœ°è®¾è®¡ä¸ºæœ€å¤§é‡çš„å›æ”¶,è¿™æ ·çš„è®¾è®¡æ–¹å¼å‡å°‘äº†å¯¹äºRSetçš„ä¾èµ–,å³å‡å¼±äº†å¯¹äºå¹´è½»ä»£é‡Œé¢å­˜å‚¨çš„è·Ÿè¸ªå¼•ç”¨ä¿¡æ¯çš„ä¾èµ–ç¨‹åº¦,è¿›è€Œå‡å¼±äº†å¤šä½™RSetçš„æ¶ˆè€—ã€‚G1 GCåªåœ¨ä»¥ä¸‹ä¸¤ä¸ªåœºæ™¯ä¾èµ–RSetã€‚</p><ul><li>è€å¹´ä»£åˆ°å¹´è½»ä»£çš„å¼•ç”¨ï¼šG1 GCç»´æŠ¤äº†ä»è€å¹´ä»£åŒºé—´åˆ°å¹´è½»ä»£åŒºé—´çš„æŒ‡é’ˆ,è¿™ä¸ªæŒ‡é’ˆä¿å­˜åœ¨å¹´è½»ä»£çš„RSeté‡Œé¢ã€‚</li><li>è€å¹´ä»£åˆ°è€å¹´ä»£çš„å¼•ç”¨ï¼šG1 GCç»´æŠ¤äº†ä»è€å¹´ä»£åŒºé—´åˆ°è€å¹´ä»£åŒºé—´çš„æŒ‡é’ˆ,è¿™ä¸ªæŒ‡é’ˆä¿å­˜åœ¨è€å¹´ä»£çš„RSeté‡Œé¢ã€‚</li></ul><p>æ¯ä¸€ä¸ªåŒºé—´åªä¼šæœ‰ä¸€ä¸ªRSetç”±äºå¯¹äºå¯¹è±¡çš„å¼•ç”¨æ˜¯åŸºäºJavaåº”ç”¨ç¨‹åºçš„éœ€æ±‚çš„,æ‰€ä»¥æœ‰å¯èƒ½ä¼šå‡ºç°RSetå†…éƒ¨çš„â€œçƒ­ç‚¹â€,å³ä¸€ä¸ªåŒºé—´å‡ºç°å¾ˆå¤šæ¬¡çš„å¼•ç”¨æ›´æ–°,éƒ½å‡ºç°åœ¨åŒä¸€ä¸ªä½ç½®çš„æƒ…å†µã€‚</p><p>å¯¹äºä¸€ä¸ªè®¿é—®å¾ˆé¢‘ç¹çš„åŒºé—´æ¥è¯´,è¿™æ ·çš„æ–¹å¼ä¼šå½±å“RSetçš„æ‰«ææ—¶é—´ã€‚</p><p>æ³¨æ„,åŒºé—´(Region)å¹¶ä¸æ˜¯æœ€å°å•å…ƒ,æ¯ä¸ªåŒºé—´ä¼šè¢«è¿›ä¸€æ­¥åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå—(Chunks)ã€‚åœ¨G1 GCåŒºé—´é‡Œ,æœ€å°çš„å•å…ƒæ˜¯ä¸€ä¸ª512ä¸ªå­—èŠ‚çš„å †å†…å­˜å—(Card)ã€‚G1 GCä¸ºæ¯ä¸ªåŒºé—´è®¾ç½®äº†ä¸€ä¸ªå…¨å±€å†…å­˜å—è¡¨æ¥å¸®åŠ©ç»´æŠ¤æ‰€æœ‰çš„å †å†…å­˜å—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img alt data-src="/images/java-jvm-gc-g1-note/%E5%85%A8%E5%B1%80%E5%8D%A1%E8%A1%A8%E7%A4%BA%E6%84%8F%E5%9B%BE.png"></p><p>å½“ä¸€ä¸ªæŒ‡é’ˆå¼•ç”¨åˆ°äº†RSeté‡Œé¢çš„ä¸€ä¸ªåŒºé—´æ—¶,åŒ…å«è¯¥æŒ‡é’ˆçš„å †å†…å­˜å—å°±ä¼šåœ¨PRTé‡Œé¢è¢«æ ‡è®°ã€‚å¦‚æœéœ€è¦å¿«é€Ÿåœ°æ‰«æä¸€å¼ æ•°æ®è¡¨,æœ€å¥½çš„æ–¹å¼æ˜¯å»ºç«‹ç´¢å¼•,ä¸€ä¸ªç²—ç²’åº¦çš„PRTå°±æ˜¯åŸºäºå“ˆå¸Œè¡¨å»ºç«‹çš„ã€‚å¯¹äºä¸€ä¸ªç»†ç²’åº¦çš„PRTæ¥è¯´,å“ˆå¸Œè¡¨å†…éƒ¨çš„æ¯ä¸€ä¸ªå…¥å£å¯¹åº”ä¸€ä¸ªåŒºé—´,è€ŒåŒºé—´å†…éƒ¨çš„å†…å­˜å—ç´¢å¼•ä¹Ÿæ˜¯å­˜å‚¨åœ¨ä½å›¾é‡Œé¢çš„ã€‚å½“ç»†ç²’åº¦PRTçš„æœ€å¤§å€¼è¢«çªç ´çš„æ—¶å€™,æˆ‘ä»¬å°±ä¼šå¼€å§‹é‡‡ç”¨ç²—ç²’åº¦æ–¹å¼å¤„ç†PRTã€‚</p><p>åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­,å½“æ‰«æRSetå¹¶ä¸”å†…å­˜å—ç¡®å®å­˜åœ¨äºPRTé‡Œæ—¶,G1 GCä¼šåœ¨å…¨å±€å †å†…å­˜å—æ•°æ®è¡¨é‡Œæ ‡è®°å¯¹åº”çš„å…¥å£,è¿™ç§åšæ³•é¿å…äº†é‡æ–°æ‰«æè¿™ä¸ªå†…å­˜å—ã€‚G1 GCä¼šåœ¨å›æ”¶å¾ªç¯é˜¶æ®µé»˜è®¤æ¸…é™¤å†…å­˜å †è¡¨,åœ¨GCçº¿ç¨‹çš„å¹¶è¡Œå·¥ä½œ(ä¸»è¦åŒ…æ‹¬æ ¹å¤–éƒ¨æ‰«æã€æ›´æ–°å’Œæ‰«æRSetã€å¯¹è±¡æ‹·è´ã€ç»ˆæ­¢åè®®ç­‰)å®Œæˆä¹‹åç´§è·Ÿç€çš„å°±æ˜¯æ¸…é™¤å †å†…å­˜è¡¨æ ‡è®°(Clear CT)é˜¶æ®µã€‚Update RSå’ŒScan RSå¯¹åº”çš„æ˜¯RSetçš„æ›´æ–°å’Œæ‰«æåŠ¨ä½œã€‚</p><p>RSetçš„ä½œç”¨æ˜¯å¾ˆæ˜æ˜¾çš„,ä½†æ˜¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¹Ÿé‡åˆ°äº†å†™ä¿æŠ¤å’Œå¹¶è¡Œæ›´æ–°çº¿ç¨‹çš„ç»´æŠ¤æˆæœ¬ã€‚</p><p>OpenJDK HotSpotçš„å¹¶è¡Œè€å¹´ä»£å’ŒCMS GCéƒ½åœ¨æ‰§è¡ŒJVMçš„ä¸€ä¸ªå¯¹è±¡å¼•ç”¨å†™æ“ä½œæ—¶ä½¿ç”¨äº†å†™ä¿æŠ¤æœºåˆ¶,å¦‚ä»£ç object field = some_other_objectã€‚è¿˜è®°å¾—æˆ‘ä»¬å¯¹äºæ¯ä¸ªåŒºé—´æ˜¯é‡‡ç”¨é’ˆå¯¹æœ€å°å•å…ƒå †å†…å­˜å—è¿›è¡Œç®¡ç†çš„å—?è¿™ä¸ªå†™ä¿æŠ¤æœºåˆ¶ä¹Ÿä¼šé€šè¿‡æ›´æ–°ä¸€ä¸ªç±»ä¼¼äºå †å†…å­˜å—è¡¨çš„æ•°æ®ç»“æ„æ¥è·Ÿè¸ªè·¨å¹´ä»£å¼•ç”¨ã€‚å †å†…å­˜è¡¨åœ¨æœ€å°åƒåœ¾å›æ”¶æ—¶ä¼šè¢«æ‰«æã€‚å†™ä¿æŠ¤ç®—æ³•åŸºäºUrs Holzleçš„å¿«é€Ÿå†™ä¿æŠ¤ç®—æ³•,è¿™ä¸ªç®—æ³•å‡å°‘äº†ç¼–è¯‘ä»£ç æ—¶çš„å¤–éƒ¨æŒ‡ä»¤æ¶ˆè€—ã€‚</p><p>å½“è·¨è¶ŠåŒºé—´çš„æ›´æ–°å‘ç”Ÿçš„æ—¶å€™,G1 GCä¼šå°†è¿™äº›å¯¹åº”çš„å †å†…å­˜å—æ”¾å…¥ä¸€ä¸ªç¼“å­˜,æˆ‘ä»¬å¯ä»¥ç§°è¿™ä¸ªç¼“å­˜ä¸ºâ€œæ›´æ–°æ—¥å¿—ç¼“å­˜â€,å†™å…¥è¯¥ç¼“å­˜çš„æ–¹å¼å’Œå†™å…¥é˜Ÿåˆ—çš„æ–¹å¼ä¸€æ ·ã€‚G1 GCä¼šä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹ç»„å»ç»´æŒRSetä¿¡æ¯,å®ƒä»¬çš„èŒè´£æ˜¯æ‰«æâ€œæ›´æ–°æ—¥å¿—ç¼“å­˜â€,ç„¶åæ›´æ–°RSetã€‚JDK8u45é‡‡ç”¨é€‰é¡¹-XX:G1ConcRefinementThreadsè®¾ç½®è¿™ä¸ªçº¿ç¨‹ç»„çš„æ•°é‡,å¦‚æœä½ æ²¡æœ‰è®¾ç½®,é‚£ä¹ˆé»˜è®¤é‡‡ç”¨-XX:ParallelGCThreadsé€‰é¡¹ã€‚</p><p>ä¸€æ—¦â€œæ›´æ–°æ—¥å¿—ç¼“å­˜â€è¾¾åˆ°äº†æœ€å¤§å¯ç”¨,å®ƒä¼šè¢«æ”¾å…¥å…¨å±€åŒ–çš„æ»¡è½½é˜Ÿåˆ—å¹¶å¯ç”¨ä¸€ä¸ªæ–°çš„ç¼“å­˜å—ã€‚ä¸€æ—¦æ›´æ–°çº¿ç¨‹åœ¨å…¨å±€æ»¡è½½é˜Ÿåˆ—é‡Œé¢å‘ç°äº†å…¥å£,å®ƒä»¬å°±å¼€å§‹å¹¶è¡Œå¤„ç†æ•´ä¸ªæ»¡è½½ç¼“å­˜é˜Ÿåˆ—ã€‚</p><p>G1 GCé’ˆå¯¹å¹¶è¡Œæ›´æ–°çº¿ç¨‹é‡‡ç”¨çš„æ˜¯åˆ†å±‚æ–¹æ³•,ä¸ºäº†ä¿è¯æ›´æ–°é€Ÿåº¦ä¼šåŠ å…¥æ›´å¤šçš„çº¿ç¨‹,å¦‚æœå®åœ¨è·Ÿä¸ä¸Šé€Ÿåº¦,Javaåº”ç”¨ç¨‹åºçº¿ç¨‹ä¹Ÿä¼šåŠ å…¥æˆ˜æ–—,ä½†å°½é‡ä¸è¦å‡ºç°è¿™æ ·çš„æƒ…å†µ,è¿™ç§æƒ…å†µæ˜¯å‘ç”Ÿäº†çº¿ç¨‹çªƒå–,ä¼šé€ æˆåº”ç”¨ç¨‹åºèŠ±è´¹äº†æœ¬å¯ä»¥ç”¨äºè‡ªèº«ç¨‹åºç®—æ³•è¿è¡Œçš„èƒ½åŠ›ã€‚</p><h3 id="å¹¶è¡Œæ ‡è®°å¾ªç¯"><a href="#å¹¶è¡Œæ ‡è®°å¾ªç¯" class="headerlink" title="å¹¶è¡Œæ ‡è®°å¾ªç¯"></a>å¹¶è¡Œæ ‡è®°å¾ªç¯</h3><p>å¹¶è¡Œæ ‡è®°å¾ªç¯çš„è¿‡ç¨‹æ˜¯åˆå§‹æ ‡è®°é˜¶æ®µâ†’æ ¹åŒºé—´æ‰«æé˜¶æ®µâ†’å¹¶è¡Œæ ‡è®°é˜¶æ®µâ†’é‡æ ‡è®°é˜¶æ®µâ†’æ¸…é™¤é˜¶æ®µ,å…¶ä¸­ä¸€éƒ¨åˆ†æ˜¯å¯ä»¥ä¸åº”ç”¨ç¨‹åºå¹¶è¡Œæ‰§è¡Œçš„,ä¸€éƒ¨åˆ†æ˜¯ç‹¬å å¼çš„ã€‚</p><h4 id="1-åˆå§‹æ ‡è®°é˜¶æ®µ"><a href="#1-åˆå§‹æ ‡è®°é˜¶æ®µ" class="headerlink" title="1.åˆå§‹æ ‡è®°é˜¶æ®µ"></a>1.åˆå§‹æ ‡è®°é˜¶æ®µ</h4><p>è¿™ä¸ªé˜¶æ®µæ˜¯ç‹¬å å¼çš„,å®ƒä¼šåœæ­¢æ‰€æœ‰çš„Javaçº¿ç¨‹,ç„¶åå¼€å§‹æ ‡è®°æ ¹èŠ‚ç‚¹å¯åŠçš„æ‰€æœ‰å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µå¯ä»¥å’Œå¹´è½»ä»£å›æ”¶åŒæ—¶æ‰§è¡Œ,è¿™æ ·çš„è®¾è®¡æ–¹å¼ä¸»è¦æ˜¯ä¸ºäº†åŠ å¿«ç‹¬å é˜¶æ®µçš„æ‰§è¡Œé€Ÿåº¦ã€‚</p><p>åœ¨è¿™ä¸ªé˜¶æ®µ,æ¯ä¸€ä¸ªåŒºé—´çš„NATMSå€¼ä¼šè¢«è®¾ç½®åœ¨åŒºé—´çš„é¡¶éƒ¨ã€‚</p><h4 id="2-æ ¹åŒºé—´æ‰«æé˜¶æ®µ"><a href="#2-æ ¹åŒºé—´æ‰«æé˜¶æ®µ" class="headerlink" title="2.æ ¹åŒºé—´æ‰«æé˜¶æ®µ"></a>2.æ ¹åŒºé—´æ‰«æé˜¶æ®µ</h4><p>è®¾ç½®äº†æ¯ä¸ªåŒºé—´çš„TAMSå€¼ä¹‹å,Javaåº”ç”¨ç¨‹åºçº¿ç¨‹é‡æ–°å¼€å§‹æ‰§è¡Œ,æ ¹åŒºé—´æ‰«æé˜¶æ®µä¹Ÿä¼šå’ŒJavaåº”ç”¨ç¨‹åºçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚åŸºäºæ ‡è®°ç®—æ³•åŸç†,åœ¨å¹´è½»ä»£å›æ”¶çš„åˆå§‹æ ‡è®°é˜¶æ®µæ‹·è´åˆ°å¹¸å­˜è€…åŒºé—´çš„å¯¹è±¡éœ€è¦è¢«æ‰«æå¹¶è¢«å½“ä½œæ ‡è®°æ ¹å…ƒç´ ,ç›¸åº”åœ°,G1 GCå› æ­¤å¼€å§‹æ‰«æå¹¸å­˜è€…åŒºé—´ã€‚ä»»ä½•ä»å¹¸å­˜è€…åŒºé—´è¿‡æ¥çš„å¼•ç”¨éƒ½ä¼šè¢«æ ‡è®°,åŸºäºè¿™ä¸ªåŸç†,å¹¸å­˜è€…åŒºé—´ä¹Ÿè¢«ç§°ä¸ºæ ¹åŒºé—´ã€‚</p><p>æ ¹åŒºé—´æ‰«æé˜¶æ®µå¿…é¡»åœ¨ä¸‹ä¸€ä¸ªåƒåœ¾å›æ”¶æš‚åœä¹‹å‰å®Œæˆ,è¿™æ˜¯å› ä¸ºæ‰€æœ‰ä»å¹¸å­˜è€…åŒºé—´æ¥çš„å¼•ç”¨éœ€è¦åœ¨æ•´ä¸ªå †åŒºé—´æ‰«æä¹‹å‰å®Œæˆæ ‡è®°å·¥ä½œã€‚</p><h4 id="3-å¹¶è¡Œæ ‡è®°é˜¶æ®µ"><a href="#3-å¹¶è¡Œæ ‡è®°é˜¶æ®µ" class="headerlink" title="3.å¹¶è¡Œæ ‡è®°é˜¶æ®µ"></a>3.å¹¶è¡Œæ ‡è®°é˜¶æ®µ</h4><p>é¦–å…ˆå¯ä»¥æ˜ç¡®çš„æ˜¯,å¹¶è¡Œæ ‡è®°é˜¶æ®µæ˜¯ä¸€ä¸ªå¹¶è¡Œçš„ä¸”å¤šçº¿ç¨‹çš„é˜¶æ®µ,å¯ä»¥é€šè¿‡é€‰é¡¹-XX:ConcGCThreadsæ¥è®¾ç½®å¹¶è¡Œçº¿ç¨‹çš„æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹,G1 GCè®¾ç½®å¹¶è¡Œæ ‡è®°é˜¶æ®µçº¿ç¨‹æ•°é‡ä¸ºé€‰é¡¹-XX:ParallelGCThreads(å¹¶è¡ŒGCçº¿ç¨‹)çš„1/4ã€‚å¹¶è¡Œæ ‡è®°çº¿ç¨‹ä¸€æ¬¡åªæ‰«æä¸€ä¸ªåŒºé—´,æ‰«æå®Œæ¯•åä¼šé€šè¿‡æ ‡è®°ä½æ–¹å¼æ ‡è®°è¯¥åŒºé—´å·²ç»æ‰«æå®Œæ¯•ä¸ºäº†æ»¡è¶³SATBå¹¶è¡Œæ ‡è®°ç®—æ³•çš„è¦æ±‚,G1 GCé‡‡ç”¨ä¸€ä¸ªå†™å‰barrieræ‰§è¡Œç›¸åº”çš„åŠ¨ä½œã€‚</p><h4 id="4-é‡æ ‡è®°é˜¶æ®µ"><a href="#4-é‡æ ‡è®°é˜¶æ®µ" class="headerlink" title="4.é‡æ ‡è®°é˜¶æ®µ"></a>4.é‡æ ‡è®°é˜¶æ®µ</h4><p>é‡æ ‡è®°é˜¶æ®µæ˜¯æ•´ä¸ªæ ‡è®°é˜¶æ®µçš„æœ€åä¸€ç¯ã€‚è¿™ä¸ªé˜¶æ®µæ˜¯ä¸€ä¸ªç‹¬å å¼é˜¶æ®µ,åœ¨æ•´ä¸ªç‹¬å å¼è¿‡ç¨‹ä¸­,G1 GCå®Œå…¨å¤„ç†äº†é—ç•™çš„SATBæ—¥å¿—ç¼“å­˜ã€æ›´æ–°ã€‚è¿™ä¸ªé˜¶æ®µä¸»è¦çš„ç›®æ ‡æ˜¯ç»Ÿè®¡å­˜æ´»å¯¹è±¡çš„æ•°é‡,åŒæ—¶ä¹Ÿå¯¹å¼•ç”¨å¯¹è±¡è¿›è¡Œå¤„ç†ã€‚</p><p>G1 GCé‡‡ç”¨å¤šçº¿ç¨‹æ–¹å¼åŠ å¿«å¹¶è¡Œå¤„ç†æ—¥å¿—ç¼“å­˜æ–‡ä»¶,è¿™æ ·å¯ä»¥èŠ‚çœä¸‹æ¥å¾ˆå¤šæ—¶é—´,é€šè¿‡é€‰é¡¹-XX:ParallelGCThreadså¯ä»¥è®¾ç½®GCæ•°é‡ã€‚</p><p>æ³¨æ„,å¦‚æœä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨äº†å¤§é‡çš„å¼•ç”¨å¯¹è±¡,ä¾‹å¦‚å¼±å¼•ç”¨ã€è½¯å¼•ç”¨ã€è™šå¼•ç”¨ã€å¼ºå¼•ç”¨,é‚£ä¹ˆè¿™ä¸ªé‡æ ‡è®°é˜¶æ®µçš„è€—æ—¶ä¼šæœ‰æ‰€å¢åŠ ã€‚</p><h4 id="5-æ¸…é™¤é˜¶æ®µ"><a href="#5-æ¸…é™¤é˜¶æ®µ" class="headerlink" title="5.æ¸…é™¤é˜¶æ®µ"></a>5.æ¸…é™¤é˜¶æ®µ</h4><p>å‰é¢å„ä¸ªé˜¶æ®µåœ¨åšçš„ä¸»è¦äº‹æƒ…å°±æ˜¯ä¸ºäº†æ ‡è®°å¯¹è±¡,é‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦é’ˆå¯¹æ¯ä¸€ä¸ªåŒºé—´è¿›è¡Œæ ‡è®°å‘¢?è¿™æ˜¯å› ä¸ºå¦‚æœæˆ‘ä»¬çŸ¥é“äº†æ¯ä¸ªåŒºé—´çš„å­˜æ´»å¯¹è±¡æ•°é‡,å¦‚æœè¿™ä¸ªåŒºé—´æ²¡æœ‰ä¸€ä¸ªå­˜æ´»å¯¹è±¡,é‚£ä¹ˆå°±å¯ä»¥å¾ˆå¿«åœ°æ¸…é™¤RSet,å¹¶ä¸”ç«‹å³æ”¾å…¥ç©ºé—²åŒºé—´é˜Ÿåˆ—,è€Œä¸æ˜¯å°†è¿™ä¸ªåŒºé—´æ”¾å…¥æ’é˜Ÿåºåˆ—,ç­‰å¾…ä¸€ä¸ªæ··åˆåƒåœ¾å›æ”¶æš‚åœé˜¶æ®µçš„å›æ”¶ã€‚RSetä¹Ÿå¯ä»¥è¢«ç”¨æ¥å¸®åŠ©æ£€æµ‹è¿‡æœŸå¼•ç”¨,ä¾‹å¦‚,å¦‚æœæ ‡è®°é˜¶æ®µå‘ç°æ‰€æœ‰åœ¨ç‰¹å®šå †å—ä¸Šçš„å¯¹è±¡éƒ½å·²ç»æ­»äº¡,é‚£ä¹ˆRSetå¯ä»¥å¿«é€Ÿæ¸…é™¤è¿™å—å †å—ã€‚</p><p>ä¸€å¥è¯æ€»ç»“,æ¸…é™¤é˜¶æ®µä¼šè¯†åˆ«å¹¶æ¸…ç†å®Œå…¨ç©ºé—²çš„åŒºåŸŸã€‚å®ƒæ˜¯å¹¶å‘çš„æ¸…ç†,ä¸ä¼šå¼•èµ·åœé¡¿ã€‚</p><h3 id="è¯„ä¼°å¤±è´¥å’Œå®Œå…¨å›æ”¶"><a href="#è¯„ä¼°å¤±è´¥å’Œå®Œå…¨å›æ”¶" class="headerlink" title="è¯„ä¼°å¤±è´¥å’Œå®Œå…¨å›æ”¶"></a>è¯„ä¼°å¤±è´¥å’Œå®Œå…¨å›æ”¶</h3><p>å¦‚æœåœ¨å¹´è½»ä»£åŒºé—´æˆ–è€…è€å¹´ä»£åŒºé—´æ‰§è¡Œæ‹·è´å­˜æ´»å¯¹è±¡æ“ä½œçš„æ—¶å€™,æ‰¾ä¸åˆ°ä¸€ä¸ªç©ºé—²çš„åŒºé—´,é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åœ¨GCæ—¥å¿—é‡Œçœ‹åˆ°è¯¸å¦‚â€œto-space exhaustedâ€è¿™æ ·çš„é”™è¯¯æ—¥å¿—æ‰“å°ã€‚</p><p>å‘ç”Ÿè¿™ä¸ªé”™è¯¯çš„åŒæ—¶,G1 GCä¼šå°è¯•å»æ‰©å±•å¯ç”¨çš„Javaå †å†…å­˜å¤§å°ã€‚å¦‚æœæ‰©å±•å¤±è´¥,G1 GCä¼šè§¦å‘å®ƒçš„å¤±è´¥ä¿æŠ¤æœºåˆ¶å¹¶ä¸”å¯åŠ¨å•çº¿ç¨‹çš„å®Œå…¨å›æ”¶åŠ¨ä½œã€‚</p><p>åœ¨è¿™ä¸ªå®Œå…¨å›æ”¶é˜¶æ®µ,å•çº¿ç¨‹ä¼šé’ˆå¯¹æ•´ä¸ªå †å†…å­˜é‡Œçš„æ‰€æœ‰åŒºé—´è¿›è¡Œæ ‡è®°ã€æ¸…é™¤ã€å‹ç¼©ç­‰åŠ¨ä½œã€‚åœ¨å®Œæˆå›æ”¶å,å †å†…å­˜å°±å®Œå…¨ç”±å­˜æ´»å¯¹è±¡å¡«å……,å¹¶ä¸”æ‰€æœ‰çš„å¹´é¾„ä»£å¯¹åº”çš„åŒºé—´éƒ½å·²ç»å®Œæˆäº†å‹ç¼©ä»»åŠ¡ã€‚</p><p>ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™ä¸ªå®Œå…¨å›æ”¶æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„,æ‰€ä»¥å½“å †å†…å­˜å¾ˆå¤§æ—¶åŠ¿å¿…è€—æ—¶å¾ˆé•¿,æ‰€ä»¥éœ€è¦è°¨æ…ä½¿ç”¨,æœ€å¥½ä¸è¦è®©å®ƒç»å¸¸å‘ç”Ÿ,ä»¥é¿å…ä¸å¿…è¦çš„é•¿æ—¶é—´çš„åº”ç”¨ç¨‹åºæš‚åœã€‚</p><h2 id="G1-GCä½¿ç”¨åœºæ™¯"><a href="#G1-GCä½¿ç”¨åœºæ™¯" class="headerlink" title="G1 GCä½¿ç”¨åœºæ™¯"></a>G1 GCä½¿ç”¨åœºæ™¯</h2><p>å¦‚æœåº”ç”¨ç¨‹åºå…·æœ‰å¦‚ä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å¾,é‚£ä¹ˆå°†åƒåœ¾æ”¶é›†å™¨ä»CMSæˆ–ParallelOldGCåˆ‡æ¢åˆ°G1å°†ä¼šå¤§å¤§æå‡æ€§èƒ½:</p><ul><li>Full GCæ¬¡æ•°å¤ªé¢‘ç¹æˆ–è€…æ¶ˆè€—æ—¶é—´å¤ªé•¿</li><li>å¯¹è±¡åˆ†é…çš„é¢‘ç‡æˆ–ä»£æ•°æå‡(promotion)æ˜¾è‘—å˜åŒ–ã€‚</li><li>å—å¤Ÿäº†å¤ªé•¿çš„åƒåœ¾å›æ”¶æˆ–å†…å­˜æ•´ç†æ—¶é—´(è¶…è¿‡0.5~1s)</li></ul><p>æ³¨æ„,å¦‚æœæ­£åœ¨ä½¿ç”¨CMSæˆ–ParallelOldGC,è€Œåº”ç”¨ç¨‹åºçš„åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´å¹¶ä¸é•¿,é‚£ä¹ˆç»§ç»­ä½¿ç”¨ç°åœ¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯ä¸ªå¥½ä¸»æ„ã€‚</p><h1 id="G1-GCæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#G1-GCæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="G1 GCæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ"></a>G1 GCæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ</h1><h2 id="G1çš„å¹´è½»ä»£å›æ”¶"><a href="#G1çš„å¹´è½»ä»£å›æ”¶" class="headerlink" title="G1çš„å¹´è½»ä»£å›æ”¶"></a>G1çš„å¹´è½»ä»£å›æ”¶</h2><h3 id="External-Root-Regions"><a href="#External-Root-Regions" class="headerlink" title="External Root Regions"></a>External Root Regions</h3><p><font color="DeepPink">å¤–éƒ¨æ ¹åŒºé—´æ‰«ææŒ‡çš„æ˜¯ä»æ ¹éƒ¨å¼€å§‹æ‰«æé€šè¿‡JNIä¸­æœ¬åœ°çš„ç±»ä¸­è°ƒç”¨Mallocå‡½æ•°åˆ†é…å‡ºçš„å†…å­˜ã€‚è¿™ä¸ªæ­¥éª¤æ˜¯å¹¶è¡Œä»»åŠ¡çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ã€‚è¿™ä¸ªé˜¶æ®µå †å¤–(off-heap)æ ¹èŠ‚ç‚¹è¢«å¼€å§‹æ‰«æ,è¿™äº›æ‰«æèŒƒå›´åŒ…æ‹¬JVMç³»ç»Ÿå­—å…¸ã€VMæ•°æ®ç»“æ„ã€JNIçº¿ç¨‹å¥æŸ„ã€ç¡¬ä»¶æ³¨å†Œå™¨ã€å…¨å±€å˜é‡,ä»¥åŠçº¿ç¨‹æ ˆæ ¹éƒ¨ç­‰,è¿™ä¸ªè¿‡ç¨‹ä¸»è¦æ˜¯ä¸ºäº†æ‰¾åˆ°å¹¶è¡Œæš‚åœé˜¶æ®µæ˜¯å¦å­˜åœ¨æŒ‡å‘å½“å‰æ”¶é›†é›†åˆ(CSet)çš„æŒ‡é’ˆã€‚</font></p><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæƒ…å†µéœ€è¦å¼•èµ·å¤§å®¶çš„é‡è§†,å°±æ˜¯æŸ¥çœ‹å·¥ä½œçº¿ç¨‹æ˜¯å¦åœ¨å¤„ç†ä¸€ä¸ªå•ä¸€çš„æ ¹èŠ‚ç‚¹æ—¶è€—æ—¶è¿‡é•¿,å¯¼è‡´æ„Ÿè§‰ç±»ä¼¼æŒ‚èµ·çš„ç°è±¡ã€‚è¿™ä¸ªç°è±¡å¯ä»¥é€šè¿‡æŸ¥çœ‹å·¥ä½œçº¿ç¨‹å¯¹åº”çš„â€œterminationâ€æ—¥å¿—çœ‹å‡ºæ¥ã€‚å¦‚æœå­˜åœ¨è¿™ä¸ªç°è±¡,ä½ éœ€è¦å»æŸ¥çœ‹æ˜¯å¦å­˜åœ¨æ¯”è¾ƒå¤§çš„ç³»ç»Ÿå­—å…¸(JVM System Dictionary),å¦‚æœè¿™ä¸ªç³»ç»Ÿå­—å…¸è¢«å½“æˆäº†ä¸€ä¸ªå•ä¸€æ ¹èŠ‚ç‚¹è¿›è¡Œå¤„ç†,é‚£ä¹ˆå½“å­˜åœ¨å¤§é‡çš„åŠ è½½ç±»æ—¶å°±ä¼šå‡ºç°è¾ƒé•¿æ—¶é—´çš„è€—æ—¶ã€‚</p><h3 id="Rememebered-Sets-and-Processed-Buffers"><a href="#Rememebered-Sets-and-Processed-Buffers" class="headerlink" title="Rememebered Sets and Processed Buffers"></a>Rememebered Sets and Processed Buffers</h3><p>Rsetå¸®åŠ©ç»´æŠ¤å’Œè·Ÿè¸ªæŒ‡å‘G1åŒºé—´çš„å¼•ç”¨,è€Œè¿™äº›åŒºé—´æœ¬èº«æ‹¥æœ‰è¿™äº›RSetã€‚è¿˜è®°å¾—æˆ‘ä»¬åœ¨ç¬¬4ç« ä»‹ç»è¿‡çš„å¹¶è¡ŒRefinementçº¿ç¨‹å—?è¿™äº›çº¿ç¨‹çš„ä»»åŠ¡æ˜¯æ‰«ææ›´æ–°æ—¥å¿—ç¼“å­˜,å¹¶ä¸”æ›´æ–°åŒºé—´çš„RSetã€‚ä¸ºäº†æ›´åŠ æœ‰æ•ˆåœ°æ”¯æ´è¿™äº›Refinementçº¿ç¨‹çš„å·¥ä½œ,åœ¨å¹¶è¡Œå›æ”¶é˜¶æ®µ,æ‰€æœ‰æœªè¢«å¤„ç†çš„ç¼“å­˜(å·²ç»æœ‰æ—¥å¿—å†™åœ¨é‡Œé¢äº†)éƒ½ä¼šè¢«å·¥ä½œçº¿ç¨‹æ‹¿æ¥å¤„ç†,è¿™äº›ç¼“å­˜ä¹Ÿè¢«ç§°ä¸ºæ—¥å¿—é‡Œé¢çš„å¤„ç†ç¼“å­˜ã€‚</p><p>ä¸ºäº†é™åˆ¶èŠ±è´¹åœ¨æ›´æ–°RSetä¸Šçš„æ—¶é—´,G1é€šè¿‡é€‰é¡¹-XX:MaxGCPauseMillsè®¾ç½®äº†ç›®æ ‡æš‚åœæ—¶é—´,é‡‡ç”¨ç›¸å¯¹äºæ•´ä¸ªåœé¡¿ç›®æ ‡æ—¶é—´ç™¾åˆ†æ¯”çš„æ–¹å¼,é™åˆ¶äº†æ›´æ–°RSetèŠ±è´¹çš„æ€»æ—¶é•¿,è®©è¯„ä¼°æš‚åœé˜¶æ®µæŠŠæœ€å¤§é‡çš„æ—¶å€™èŠ±è´¹åœ¨æ‹·è´å­˜æ´»å¯¹è±¡ä¸Šã€‚è¿™ä¸ªç›®æ ‡æ—¶é—´é»˜è®¤ä¸ºæ•´ä¸ªåœé¡¿æ—¶é—´çš„10%,ä¾‹å¦‚æ•´ä¸ªåœé¡¿æ—¶é—´æ˜¯10s,é‚£ä¹ˆèŠ±è´¹åœ¨æ›´æ–°RSetä¸Šçš„æ—¶é—´æœ€å¤§ä¸ºlsã€‚G1 GCçš„è®¾è®¡ç›®æ ‡æ˜¯è®©æ›´å¤šçš„åœé¡¿æ—¶é—´èŠ±è´¹åœ¨æ‹·è´å­˜æ´»å¯¹è±¡ä¸Šé¢,å› æ­¤æš‚åœæ—¶é—´çš„10%è¢«ç”¨äºæ›´æ–°RSetä¹Ÿæ˜¯æ¯”è¾ƒåˆç†çš„,ç™¾åˆ†æ¯”å¤§äº†,èŠ±åœ¨å¹²å…·ä½“ä¸šåŠ¡(å„é˜¶æ®µæ‹·è´å­˜æ´»å¯¹è±¡)ä¸Šçš„æ—¶é—´ä¹Ÿå°±å°‘äº†ã€‚</p><p>å¦‚æœä½ å‘ç°è¿™ä¸ªå€¼ä¸å¤ªå‡†ç¡®æˆ–è€…ä¸ç¬¦åˆä½ çš„å®é™…éœ€æ±‚,è¿™é‡Œå¯ä»¥é€šè¿‡æ›´æ–°é€‰é¡¹-XX:G1RSetUpdatingPauseTimePercentæ¥æ”¹å˜è¿™ä¸ªæ›´æ–°RSetçš„ç›®æ ‡æ—¶é—´å€¼ã€‚åˆ‡è®°,å¦‚æœä½ æ”¹å˜äº†èŠ±è´¹åœ¨æ›´æ–°RSetä¸Šçš„æ—¶é—´,é‚£ä½ å¿…é¡»æœ‰æŠŠæ¡å·¥ä½œçº¿ç¨‹å¯ä»¥åœ¨å›æ”¶æš‚åœé˜¶æ®µå®Œæˆå®ƒä»¬çš„å·¥ä½œ,å¦‚æœä¸èƒ½,é‚£è¿™éƒ¨åˆ†å·¥ä½œä¼šè¢«æ”¾åˆ°å¹¶è¡ŒRefinementçº¿ç¨‹é‡Œé¢å»æ‰§è¡Œ,è¿™ä¼šå¯¼è‡´å¹¶è¡Œå·¥ä½œé‡å¢åŠ ã€å¹¶è¡Œå›æ”¶æ¬¡æ•°å¢å¤šã€‚æœ€åçš„æƒ…å†µæ˜¯å¦‚æœå¹¶è¡ŒRefinementçº¿ç¨‹ä¹Ÿä¸èƒ½å®Œæˆä»»åŠ¡,é‚£ä¹ˆJavaåº”ç”¨ç¨‹åºå°±ä¼šè¢«æš‚åœ,åŸæœ¬è´Ÿè´£æ‰§è¡ŒJavaåº”ç”¨ç¨‹åºçš„èµ„æºå°±ä¼šç›´æ¥æ¥æ‰‹ä»»åŠ¡,è¿™ä¸ªç”»é¢â€œå¤ªç¾â€ä¸æ•¢çœ‹!å¤§å®¶è¦å°½é‡é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿã€‚</p><p>æ³¨æ„,-XX:G1ConcRefinementThreadsé€‰é¡¹çš„å€¼é»˜è®¤å’Œ-XX:ParallelGCThreadsçš„å€¼ä¸€æ ·,è¿™æ„å‘³ç€å¯¹äº-XX:ParallelGCThreadsé€‰é¡¹çš„ä¿®æ”¹ä¼šåŒæ ·æ”¹å˜-XX:G1ConcRefinementThreadsé€‰é¡¹çš„å€¼ã€‚</p><p>åœ¨å½“å‰CSeté‡Œé¢å›æ”¶ä¹‹å‰,CSetå†…éƒ¨çš„æ¯ä¸ªåŒºé—´çš„Rsetéƒ½éœ€è¦è¢«æ‰«æ,ä¸»è¦ç›®çš„æ˜¯æ‰¾åˆ°CSetåŒºé—´å†…éƒ¨çš„å¼•ç”¨å…³ç³»ã€‚ä¸€ä¸ªæœ‰è¾ƒå¤šå­˜æ´»å¯¹è±¡çš„åŒºé—´å®¹æ˜“å¯¼è‡´Rsetçš„ç²’åº¦å˜ç»†,å³æ¯ä¸ªåŒºé—´å¯¹åº”çš„è¡¨æ ¼ä¼šä»ç²—ç²’åº¦å˜ä¸ºç»†ç²’åº¦,ä¹Ÿå¯ä»¥ç†è§£ä¸ºé‡Œé¢å¯¹è±¡å¢å¤šåæ‰«æä¸€ä¸ªRsetéœ€è¦æ›´é•¿çš„æ‰«ææ—¶é—´,è¿™æ ·ä½ å°±ä¼šçœ‹åˆ°æ›´å¤šçš„æ—¶é—´è¢«èŠ±è´¹åœ¨äº†æ‰«æRSetä¸Šé¢ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºæ‰«ææ—¶é—´å–å†³äºRSetæ•°æ®ç»“æ„çš„ç²—ç»†ç²’åº¦ã€‚</p><h3 id="Summarizing-Remembered-Sets"><a href="#Summarizing-Remembered-Sets" class="headerlink" title="Summarizing Remembered Sets"></a>Summarizing Remembered Sets</h3><p>XX:+G1SummarizeRSetStatsé€‰é¡¹ç”¨äºç»Ÿè®¡RSetçš„å¯†åº¦æ•°é‡(ç»†ç²’åº¦æˆ–è€…ç²—ç²’åº¦),è¿™ä¸ªå¯†åº¦å¸®åŠ©å†³å®šæ˜¯å¦å¹¶è¡ŒRefinementçº¿ç¨‹æœ‰èƒ½åŠ›å»åº”å¯¹æ›´æ–°ç¼“å­˜çš„å·¥ä½œ,å¹¶ä¸”æ”¶é›†æ›´å¤šå…³äºNmethodsçš„ä¿¡æ¯ã€‚è¿™ä¸ªé€‰é¡¹æ¯éš”næ¬¡GCæš‚åœæ”¶é›†ä¸€æ¬¡RSetçš„ç»Ÿè®¡ä¿¡æ¯,è¿™ä¸ªnæ¬¡ç”±é€‰é¡¹-XX:G1SummarizeRSetStatsPeriod=nå†³å®š,ä¹Ÿæ˜¯éœ€è¦é€šè¿‡é€‰é¡¹è¿›è¡Œè®¾ç½®çš„ã€‚</p><p>æ³¨æ„,-XX:+G1SummarizeRSetStatsé€‰é¡¹æ˜¯ä¸€ä¸ªè¯Šæ–­é€‰é¡¹,å› æ­¤å¿…é¡»å¯ç”¨-XX:+UnlockDiagnosticVMOptionsé€‰é¡¹æ‰å¯ä»¥å¯ç”¨-XX:+G1SummarizeRSetStatsé€‰é¡¹ã€‚</p><p>PDFä¹¦ç±ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/jiankunking/books-recommendation/tree/master/Java" target="_blank" rel="noopener">https://github.com/jiankunking/books-recommendation/tree/master/Java</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> GC </tag>
            
            <tag> è¯»ä¹¦ç¬”è®° </tag>
            
            <tag> G1 </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“ç´¢å¼•è®¾è®¡ä¸ä¼˜åŒ– ç¬”è®°</title>
      <link href="/relational-database-index-design-and-the-optimizers-note.html"/>
      <url>/relational-database-index-design-and-the-optimizers-note.html</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ•´ç†è‡ªï¼šã€Šæ•°æ®åº“ç´¢å¼•è®¾è®¡ä¸ä¼˜åŒ–ã€‹ ä½œè€…ï¼šTapio Lahdenmakiï¼ŒMichael Leach</p><p>å‡ºç‰ˆæ—¶é—´ï¼š2015-06-01</p><a id="more"></a><h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><h2 id="ç´¢å¼•è¯¯åŒº"><a href="#ç´¢å¼•è¯¯åŒº" class="headerlink" title="ç´¢å¼•è¯¯åŒº"></a>ç´¢å¼•è¯¯åŒº</h2><h3 id="è¯¯åŒº1ï¼šç´¢å¼•å±‚çº§ä¸è¦è¶…è¿‡5å±‚"><a href="#è¯¯åŒº1ï¼šç´¢å¼•å±‚çº§ä¸è¦è¶…è¿‡5å±‚" class="headerlink" title="è¯¯åŒº1ï¼šç´¢å¼•å±‚çº§ä¸è¦è¶…è¿‡5å±‚"></a>è¯¯åŒº1ï¼šç´¢å¼•å±‚çº§ä¸è¦è¶…è¿‡5å±‚</h3><p>ç”±äºéå¶å­é¡µé€šå¸¸éƒ½ä¼šç•™åœ¨å†…å­˜æˆ–è€…è¯»ç¼“å­˜ä¸­ï¼Œæ‰€ä»¥é€šå¸¸ç´¢å¼•ä»»æ„ä¸€ä¸ªå¶å­é¡µçš„æ—¶é—´ä¸º10ms~20msï¼Œè¿™æ˜¯å›ºå®šçš„ã€‚æ‰€ä»¥ï¼Œå¯¹ç´¢å¼•å±‚æ•°çš„é™åˆ¶æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„ã€‚</p><h3 id="è¯¯åŒº2ï¼šå•è¡¨çš„ç´¢å¼•æ•°ä¸è¦è¶…è¿‡6ä¸ª"><a href="#è¯¯åŒº2ï¼šå•è¡¨çš„ç´¢å¼•æ•°ä¸è¦è¶…è¿‡6ä¸ª" class="headerlink" title="è¯¯åŒº2ï¼šå•è¡¨çš„ç´¢å¼•æ•°ä¸è¦è¶…è¿‡6ä¸ª"></a>è¯¯åŒº2ï¼šå•è¡¨çš„ç´¢å¼•æ•°ä¸è¦è¶…è¿‡6ä¸ª</h3><p>æˆ‘å»ºè®®ä¸è¦ç»™è¡¨çš„ç´¢å¼•æ•°ç›®è®¾ç½®ä¸Šé™ã€‚</p><p>ä¿è¯æ‰€æœ‰çš„SQLè¯­å¥éƒ½èƒ½å¤Ÿæµç•…è¿è¡Œæ˜¯è®¾è®¡çš„åº•çº¿ã€‚æˆ‘ä»¬æ€»èƒ½æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥è¾¾åˆ°è¿™ä¸€ç‚¹ã€‚å¦‚æœä¸ºäº†è¾¾åˆ°è¿™ä¸€ç‚¹éœ€è¦åœ¨è¡¨ä¸Šåˆ›å»º10ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆä½ å°±åº”è¯¥åœ¨è¡¨ä¸Šå»ºç«‹10ä¸ªç´¢å¼•ã€‚</p><h3 id="è¯¯åŒº3ï¼šä¸åº”è¯¥ç´¢å¼•ä¸ç¨³å®šçš„åˆ—"><a href="#è¯¯åŒº3ï¼šä¸åº”è¯¥ç´¢å¼•ä¸ç¨³å®šçš„åˆ—" class="headerlink" title="è¯¯åŒº3ï¼šä¸åº”è¯¥ç´¢å¼•ä¸ç¨³å®šçš„åˆ—"></a>è¯¯åŒº3ï¼šä¸åº”è¯¥ç´¢å¼•ä¸ç¨³å®šçš„åˆ—</h3><p><font color="DeepPink">ç´¢å¼•è¡Œæ˜¯æŒ‰ç´¢å¼•é”®çš„é¡ºåºå­˜å‚¨çš„ï¼Œæ‰€ä»¥å½“ç´¢å¼•é”®ä¸­å­˜ä¸€åˆ—è¢«æ›´æ–°æ—¶ï¼ŒDBMSå¯èƒ½ä¸å¾—ä¸æŠŠç›¸åº”çš„è¡Œä»æ—§çš„ç´¢å¼•ä½ç½®ç§»åˆ°æ–°çš„ä½ç½®æ¥ä¿æŒè¿™ä¸€é¡ºåºã€‚è¿™ä¸ªæ–°çš„ä½è¿“å¯èƒ½ä¸æ—§çš„ä½æ™‹ä½äºç›¸åŒçš„å¶å­è´ä¸Šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªé¡µä¼šå—åˆ°å½±å“ã€‚ç„¶è€Œï¼Œå¦‚æœè¢«ä¿®æ”¹çš„é”®æ˜¯ç¬¬ä¸€åˆ—æˆ–å”¯ä¸€çš„åˆ—ï¼Œé‚£ä¹ˆæ–°çš„ç´¢å¼•è¡Œå¯èƒ½å¿…é¡»è¢«è¿ç§»åˆ°ä¸€ä¸ªä¸åŒçš„å¶å­é¡µä¸Šï¼Œå³DBMSå¿…é¡»æ›´æ–°ä¸¤ä¸ªå¶å­é¡µã€‚ä¸‰åå¹´å‰ï¼Œå¦‚æœè¿™ä¸ªç´¢å¼•ä¸ºä¸€ä¸ª4å±‚ç´¢å¼•ï¼Œè¿™ä¹Ÿè®¸éœ€è¦6æ¬¡ç£ç›˜éšæœºè¯»å–ï¼š3æ¬¡å¸¸è§„è¯»å–ï¼Œå³2æ¬¡éå¶å­é¡µè¯»å–å’Œ1æ¬¡å¶å­é¡µè¯»å–ï¼ŒåŠ ä¸Šæ–°çš„ä½ç½®æ‰€æ¶‰åŠçš„3æ¬¡éšæœºè¯»å–ã€‚å½“ä¸€æ¬¡éšæœºè¯»å–è€—æ—¶30ms æ—¶ï¼Œè¿ç§»ä¸€ä¸ªç´¢å¼•è¡Œå¯èƒ½ä¼šç»™è¯¥æ›´æ–°æ“ä½œé¢å¤–å¢åŠ 6 x 30ms =180ms çš„å“åº”æ—¶é—´ã€‚å› æ­¤ï¼Œä¸ç¨³å®šçš„åˆ—å¾ˆå°‘è¢«ç´¢å¼•å°±ä¸è¶³ä¸ºå¥‡äº†ã€‚</font></p><p><font color="DeepPink">ç°åœ¨ï¼Œå½“å››å±‚ç´¢å¼•ä¸­ä¸‰ä¸ªå±‚çº§çš„éå¶å­é¡µä¿ç•™åœ¨å†…å­˜ä¸­æ—¶ï¼Œä¸€æ¬¡ç£ç›˜éšæœºè¯»å–éœ€è¦ l0 ms ï¼Œå“åº”çš„æ—¶é—´å˜æˆäº† 2 x 10ms = 20ms ã€‚æ­¤å¤–ï¼Œè®¸å¤šç´¢å¼•ä¸ºå¤šåˆ—ç´¢å¼•ï¼Œä¹Ÿç§°ä½œå¤åˆæˆ–ç»„åˆç´¢å¼•ï¼Œå®ƒé€šå¸¸åŒ…å«å¤šåˆ—ï¼Œä»¥ä½¿å¾—ç´¢å¼•é”®å€¼å”¯ä¸€ã€‚å½“ä¸ç¨³å®šçš„åˆ—ä¸ºå¤åˆç´¢å¼•çš„å°¾åˆ—æ›´æ–°è¿™ä¸ªä¸ç¨³å®šçš„åˆ—ç»ä¸ä¼šå¯¼è‡´å…¶è¿ç§»åˆ°æ–°çš„å¶å­é¡µã€‚å› æ­¤ï¼Œåœ¨å½“å‰çš„ç£ç›˜æ¡ä»¶ä¸‹ï¼Œæ›´æ–°ä¸€ä¸ªä¸ç¨³å®šçš„åˆ—åªä¼šå¯¹è¯¥æ›´æ–°æ“ä½œå¢åŠ 10msçš„å“åº”æ—¶é—´ã€‚</font></p><p>åœ¨å½“å‰ç£ç›˜æ¡ä»¶ä¸‹ï¼Œåªæœ‰åœ¨æ›´æ–°é¢‘ç‡å¤šäº10æ¬¡/ç§’çš„æƒ…å†µä¸‹ï¼Œä¸ç¨³å®šåˆ—æ‰å¯èƒ½æˆä¸ºé—®é¢˜ã€‚</p><blockquote><p>åˆ›å»ºç´¢å¼•çš„ç›®çš„åº”è¯¥æ˜¯åœ¨ç¡¬ä»¶å®¹é‡é™åˆ¶çš„å‰æä¸‹ä¿è¯æ‰€æœ‰çš„æ•°æ®åº“è°ƒç”¨è¿è¡Œçš„è¶³å¤Ÿå¿«ã€‚</p></blockquote><h2 id="ç³»ç»ŸåŒ–çš„ç´¢å¼•è®¾è®¡"><a href="#ç³»ç»ŸåŒ–çš„ç´¢å¼•è®¾è®¡" class="headerlink" title="ç³»ç»ŸåŒ–çš„ç´¢å¼•è®¾è®¡"></a>ç³»ç»ŸåŒ–çš„ç´¢å¼•è®¾è®¡</h2><ul><li>æ‰¾åˆ°ç”±äºç´¢å¼•ä¸åˆé€‚è€Œå¯¼è‡´è¿è¡Œ<strong>å¤ªæ…¢</strong>çš„æŸ¥è¯¢è¯­å¥<br>  æœ€å·®è¾“å…¥ï¼šå¯¼è‡´æ‰§è¡Œæ—¶é—´æœ€é•¿çš„å˜é‡å€¼</li><li>è®¾è®¡ç´¢å¼•ï¼Œä½¿æ‰€æœ‰æŸ¥è¯¢è¯­å¥éƒ½è¿è¡Œçš„è¶³å¤Ÿå¿«<br>  è¡¨çš„ç»´æŠ¤ï¼ˆæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰ä¹Ÿå¿…é¡»è¶³å¤Ÿå¿«</li></ul><h1 id="è¡¨å’Œç´¢å¼•ç»“æ„"><a href="#è¡¨å’Œç´¢å¼•ç»“æ„" class="headerlink" title="è¡¨å’Œç´¢å¼•ç»“æ„"></a>è¡¨å’Œç´¢å¼•ç»“æ„</h1><p>DBMS ä¼šæ„è¯†åˆ°å¤šä¸ªç´¢å¼•æˆ–è¡¨é¡µéœ€è¦è¢«é¡ºåºåœ°è¯»å–ï¼Œä¸”èƒ½è¯†åˆ¥å‡ºé‚£äº›ä¸åœ¨ç¼“å†²æ± ä¸­çš„é¡µã€‚éšåï¼Œå®ƒå°†å‘å‡ºå¤šé¡µI/Oè¯·æ±‚ï¼Œæ¯æ¬¡è¯·æ±‚çš„é¡µçš„æ•°é‡ç”±DBMSå†³å®šã€‚<font color="DeepPink">åªæœ‰é‚£äº›ä¸åœ¨ç¼“å†²æ± ä¸­çš„é¡µä¼šè¢«ä»ç£ç›˜æœåŠ¡å™¨ä¸Šè¯»å–ï¼Œå› ä¸ºé‚£äº›å·²ç»åœ¨ç¼“å†²æ± ä¸­çš„é¡µä¸­å¯èƒ½åŒ…å«äº†å°šæœªè¢«å†™äººç£ç›˜çš„æ›´æ–°æ•°æ®ã€‚</font></p><h1 id="SQLå¤„ç†è¿‡ç¨‹"><a href="#SQLå¤„ç†è¿‡ç¨‹" class="headerlink" title="SQLå¤„ç†è¿‡ç¨‹"></a>SQLå¤„ç†è¿‡ç¨‹</h1><h2 id="è°“è¯"><a href="#è°“è¯" class="headerlink" title="è°“è¯"></a>è°“è¯</h2><p>WHEREå­å¥ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ª<font color="DeepPink">è°“è¯ï¼ˆæœç´¢å‚æ•°ï¼‰</font>ç»„æˆã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># SQL 3.1</span><br><span class="line">WHERE SEX = &apos;M&apos;</span><br><span class="line">      AND</span><br><span class="line">      (WEIGHT &gt; 90</span><br><span class="line">      OR</span><br><span class="line">      HEIGHT &gt; 190)</span><br></pre></td></tr></table></figure><p>SQL 3.1ä¸­æœ‰ä¸‰ä¸ªç®€å•è°“è¯ï¼Œå®ƒä»¬æ˜¯ï¼š</p><ul><li>SEX = â€˜Mâ€™</li><li>WEIGHT &gt; 90</li><li>HEIGHT &gt; 190</li></ul><p>åŒæ ·ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸¤ä¸ªç»„åˆè°“è¯ï¼š</p><ul><li>WEIGHT &gt; 90 OR HEIGHT &gt; 190</li><li>SEX = â€˜Mâ€™ AND  ( WEIGHT &gt; 90 OR HEIGHT &gt; 190 )</li></ul><p>è°“è¯è¡¨è¾¾å¼æ˜¯ç´¢å¼•è®¾è®¡çš„ä¸»è¦å…¥æ‰‹ç‚¹ã€‚å¦‚æœä¸€ä¸ªç´¢å¼•èƒ½å¤Ÿæ»¡è¶³SELECTæŸ¥è¯¢è¯­å¥çš„æ‰€æœ‰è°“è¯è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆä¼˜åŒ–å™¨å°±å¾ˆæœ‰å¯èƒ½å»ºç«‹èµ·ä¸€ä¸ªé«˜æ•ˆçš„è®¿é—®è·¯å¾„ã€‚</p><p>æ ¸å®ç¡®è®¤è®¿é—®è·¯å¾„ï¼ˆæ‰§è¡Œè®¡åˆ’ï¼‰<br><img alt data-src="/images/database-index-design-optimizers/%E4%BC%98%E5%8C%96%E5%99%A8%E4%BD%95%E6%97%B6%E9%80%89%E6%8B%A9%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84.png"></p><h1 id="ä¸ºSELETEè¯­å¥åˆ›å»ºç†æƒ³çš„ç´¢å¼•ã€é‡ç‚¹ã€‘"><a href="#ä¸ºSELETEè¯­å¥åˆ›å»ºç†æƒ³çš„ç´¢å¼•ã€é‡ç‚¹ã€‘" class="headerlink" title="ä¸ºSELETEè¯­å¥åˆ›å»ºç†æƒ³çš„ç´¢å¼•ã€é‡ç‚¹ã€‘"></a>ä¸ºSELETEè¯­å¥åˆ›å»ºç†æƒ³çš„ç´¢å¼•ã€é‡ç‚¹ã€‘</h1><blockquote><p>å¾ˆå¤šè°ƒä¼˜äººå‘˜ï¼ˆå°½ç®¡æ²¡ç»éªŒï¼‰è®¤ä¸ºï¼Œå¦‚æœä¸€ä¸ªSQLè¯­å¥ä½¿ç”¨äº†ç´¢å¼•ï¼Œé‚£è¿™ä¸ª SQLå°±æ˜¯è¢«å¾ˆå¥½åœ°ä¼˜åŒ–è¿‡çš„ï¼Œæˆ‘å¯¹æ­¤æ„Ÿåˆ°å¾ˆæƒŠè®¶ã€‚ä½ åº”è¯¥æ€»æ˜¯é—®è‡ªå·±ï¼Œâ€è¿™æ˜¯ä¸æ˜¯å¯ç”¨çš„æœ€å¥½çš„ç´¢å¼•ï¼Ÿâ€ æˆ– â€œå†æ·»åŠ å¦å¤–ä¸€ä¸ªç´¢å¼•èƒ½å¦æå‡<br>å“åº”æ€§èƒ½ï¼Ÿâ€ï¼Œåˆæˆ–è€… â€œå…¨è¡¨æ‰«æä¼šä¸ä¼šæ›´å¿«åœ°è¿”å›ç»“æœï¼Ÿâ€</p></blockquote><h2 id="ä¸‰æ˜Ÿç´¢å¼•"><a href="#ä¸‰æ˜Ÿç´¢å¼•" class="headerlink" title="ä¸‰æ˜Ÿç´¢å¼•"></a>ä¸‰æ˜Ÿç´¢å¼•</h2><blockquote><p>ä¸‰æ˜Ÿç´¢å¼•ï¼šæŸ¥è¯¢è¯­å¥çš„ç†æƒ³ç´¢å¼•ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DECLARE CURSOR41 CURSOR FOR</span><br><span class="line">SELECT    CNO, FNAME</span><br><span class="line">FROM      CUST</span><br><span class="line">WHERE     LNAME = :LNAME</span><br><span class="line">          AND</span><br><span class="line">          CITY  = :CITY</span><br><span class="line">ORDER BY  FNAME</span><br></pre></td></tr></table></figure><p><img alt data-src="/images/database-index-design-optimizers/%E5%9B%BE4.2.png"></p><h2 id="æ˜Ÿçº§æ˜¯å¦‚ä½•ç»™å®šçš„"><a href="#æ˜Ÿçº§æ˜¯å¦‚ä½•ç»™å®šçš„" class="headerlink" title="æ˜Ÿçº§æ˜¯å¦‚ä½•ç»™å®šçš„"></a>æ˜Ÿçº§æ˜¯å¦‚ä½•ç»™å®šçš„</h2><p>å¦‚æœä¸ä¸€ä¸ªæŸ¥è¯¢ç›¸å…³çš„ç´¢å¼•è¡Œæ˜¯ç›¸é‚»çš„ï¼Œæˆ–è€…è‡³å°‘ç›¸è·è¶³å¤Ÿé è¿‘çš„è¯ï¼Œé‚£è¿™ä¸ªç´¢å¼•å°±å¯ä»¥è¢«æ ‡è®°ä¸Šç¬¬ä¸€é¢—æ˜Ÿã€‚è¿™<font color="DeepPink">æœ€å°åŒ–</font>äº†å¿…é¡»æ‰«æçš„ç´¢å¼•ç‰‡çš„å®½åº¦ã€‚ </p><p>å¦‚æœç´¢å¼•è¡Œçš„é¡ºåºä¸æŸ¥è¯¢è¯­å¥çš„éœ€æ±‚ä¸€è‡´ï¼Œåˆ™ç´¢å¼•å¯ä»¥è¢«æ ‡è®°ä¸Šç¬¬äºŒé¢—æ˜Ÿã€‚è¿™<font color="DeepPink">æ’é™¤äº†æ’åºæ“ä½œ</font>ã€‚ </p><p>å¦‚æœç´¢å¼•è¡ŒåŒ…å«çš„æŸ¥è¯¢è¯­å¥ä¸­çš„æ‰€æœ‰åˆ—ï¼Œé‚£ä¹ˆç´¢å¼•å°±å¯ä»¥è¢«æ ‡è®°ä¸Šç¬¬ä¸‰é¢—æ˜Ÿã€‚è¿™é¿å…äº†è®¿é—®è¡¨çš„æ“ä½œï¼š<font color="DeepPink">ä»…è®¿é—®ç´¢å¼•å°±å¯ä»¥äº†</font>ã€‚ </p><p><font color="DeepPink">å¯¹äºè¿™ä¸‰é¢—æ˜Ÿï¼Œç¬¬ä¸‰é¢—é€šå¸¸æ˜¯æœ€é‡è¦çš„ã€‚å°†ä¸€ä¸ªåˆ—æ’é™¤åœ¨ç´¢å¼•ä¹‹å¤–å¯èƒ½ä¼šå¯¼è‡´è®¸å¤šé€Ÿåº¦è¾ƒæ…¢çš„ç£ç›˜éšæœºè¯»ã€‚</font>æˆ‘ä»¬æŠŠä¸€ä¸ªè‡³å°‘åŒ…å«ç¬¬ä¸‰é¢—æ˜Ÿçš„ç´¢å¼•ç§°ä¸ºå¯¹åº”æŸ¥è¯¢è¯­å¥çš„å®½ç´¢å¼•ã€‚</p><blockquote><p>å®½ç´¢å¼•ï¼šå®½ç´¢å¼•æ˜¯æŒ‡ä¸€ä¸ªè‡³å°‘æ»¡è¶³ç¬¬ä¸‰é¢—æ˜Ÿçš„ç´¢å¼•ã€‚è¯¥ç´¢å¼•åŒ…å«äº†SELECTè¯­å¥æ‰€æ¶‰åŠçš„æ‰€æœ‰åˆ—ï¼Œå› è€Œèƒ½å¤Ÿä½¿å¾—æŸ¥è¯¢åªéœ€è®¿é—®ç´¢å¼•è€Œæ— éœ€è®¿é—®è¡¨ã€‚</p></blockquote><p><strong>ä¸ºäº†æ»¡è¶³ç¬¬ä¸€é¢—æ˜Ÿ</strong><br>é¦–å…ˆå–å‡ºæ‰€æœ‰ç­‰å€¼è°“è¯çš„åˆ—ï¼ˆWHERE COL=â€¦ï¼‰ã€‚æŠŠè¿™äº›åˆ—ä½œä¸ºç´¢å¼•æœ€å¼€å¤´çš„åˆ—â€”â€”ä»¥ä»»æ„é¡ºåºéƒ½å¯ä»¥ã€‚å¯¹äºCURSOR41æ¥è¯´ï¼Œä¸‰æ˜Ÿç´¢å¼•å¯ä»¥ä»¥LNAMEã€CITYæˆ–è€…ä»¥CITYã€LNAMEå¼€å¤´ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»æ‰«æçš„ç´¢å¼•ç‰‡å®½åº¦å°†è¢«ç¼©å‡è‡³æœ€çª„ã€‚</p><p><strong>ä¸ºäº†æ»¡è¶³ç¬¬äºŒé¢—æ˜Ÿ</strong><br>å°†ORDER BYåˆ—åŠ å…¥åˆ°ç´¢å¼•ä¸­ã€‚ä¸è¦æ”¹å˜è¿™äº›åˆ—çš„é¡ºåºï¼Œä½†æ˜¯å¿½ç•¥é‚£äº›åœ¨ç¬¬ä¸€æ­¥ä¸­å·²ç»åŠ å…¥ç´¢å¼•çš„åˆ—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœCURSOR41åœ¨ORDER BY ä¸­æœ‰é‡å¤çš„åˆ—ï¼Œå¦‚ORDER BY LNAMEã€FNAMEæˆ–è€…æ˜¯ORDER BY FNAMEã€CITYï¼Œåªæœ‰FNAMEéœ€è¦åœ¨è¿™æ­¥ä¸­è¢«åŠ å…¥åˆ°ç´¢å¼•ä¸­å»ã€‚å½“FNAMEæ˜¯ç´¢å¼•çš„ç¬¬ä¸‰åˆ—æ—¶ï¼Œç»“æœé›†ä¸­çš„è®°å½•æ— é¡»æ’åºå°±å·²ç»æ˜¯ä»¥æ­£ç¡®çš„é¡ºåºæ’åˆ—çš„äº†ã€‚ç¬¬ä¸€æ¬¡è¯»å–æ“ä½œå°†è¿”å›FNAMEå€¼æœ€å°çš„é‚£ä¸€è¡Œã€‚</p><p><strong>ä¸ºäº†æ»¡è¶³ç¬¬ä¸‰é¢—æ˜Ÿ</strong><br>å°†æŸ¥è¯¢è¯­å¥ä¸­å‰©ä½™çš„åˆ—åŠ åˆ°ç´¢å¼•ä¸­å»ï¼Œåˆ—åœ¨ç´¢å¼•ä¸­æ·»åŠ çš„é¡ºåºå¯¹æŸ¥è¯¢è¯­å¥çš„æ€§èƒ½æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯å°†æ˜“å˜çš„åˆ—æ”¾åœ¨æœ€åèƒ½é™ä½æ›´æ–°çš„æˆæœ¬ã€‚ç°åœ¨ï¼Œç´¢å¼•å·²åŒ…å«äº†æ»¡è¶³æ— é¡»å›è¡¨çš„è®¿é—®è·¯å¾„æ‰€éœ€çš„æ‰€æœ‰åˆ—ã€‚</p><p>æœ€ç»ˆä¸‰æ˜Ÿç´¢å¼•å°†ä¼šæ˜¯ï¼š(LNAME, CITY, FNAME, CNO) æˆ– (CITY, LNAME, FNAME, CNO)</p><p>CURSOR41åœ¨ä»¥ä¸‹æ–¹é¢æ˜¯æœ€ä¸ºæŒ‘å‰”çš„ï¼š</p><ul><li>WHERE æ¡ä»¶ä¸åŒ…å«èŒƒå›´è°“è¯ï¼ˆBETWEENã€&gt;ã€&gt;=ç­‰ï¼‰</li><li>FROM è¯­å¥åªæ¶‰åŠå•è¡¨</li><li>æ‰€æœ‰è°“è¯å¯¹äºä¼˜åŒ–å™¨æ¥è¯´éƒ½è¶³å¤Ÿç®€å•</li></ul><h2 id="èŒƒå›´è°“è¯ä¸ä¸‰æ˜Ÿç´¢å¼•"><a href="#èŒƒå›´è°“è¯ä¸ä¸‰æ˜Ÿç´¢å¼•" class="headerlink" title="èŒƒå›´è°“è¯ä¸ä¸‰æ˜Ÿç´¢å¼•"></a>èŒƒå›´è°“è¯ä¸ä¸‰æ˜Ÿç´¢å¼•</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DECLARE CURSOR43 CURSOR FOR</span><br><span class="line">SELECT    CNO, FNAME</span><br><span class="line">FROM      CUST</span><br><span class="line">WHERE     LNAME BETWEEN :LNAME1 AND :LNAME2</span><br><span class="line">          AND</span><br><span class="line">          CITY  = :CITY</span><br><span class="line">          ORDER BY  FNAME</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬å°è¯•ä¸ºè¿™ä¸ª CURSOR è®¾è®¡ä¸€ä¸ªä¸‰æ˜Ÿç´¢å¼•ã€‚å¤§éƒ¨åˆ†çš„æ¨è®ºä¸ CURSOR41 ç›¸åŒï¼Œä½†æ˜¯â€œBETWEEN è°“è¯â€å°†â€œ=è°“è¯â€æ›¿ä»£åå°†ä¼šæœ‰å¾ˆå¤§çš„å½±å“ã€‚æˆ‘ä»¬å°†ä¼šä»¥ç›¸åçš„é¡ºåºä¾æ¬¡è€ƒè™‘ä¸‰é¢—æ˜Ÿï¼ŒæŒ‰ç†è¯´ï¼Œè¿™ä»£è¡¨äº†ç†è§£çš„éš¾åº¦ã€‚</p><p>é¦–å…ˆæ˜¯æœ€ç®€å•çš„æ˜Ÿï¼ˆè™½ç„¶éå¸¸é‡è¦ï¼‰ï¼Œç¬¬ä¸‰é¢—æ˜Ÿã€‚æŒ‰ç…§å…ˆå‰æ‰€è¿°ï¼Œ<strong>ç¡®ä¿æŸ¥è¯¢è¯­å¥ä¸­çš„æ‰€æœ‰åˆ—éƒ½åœ¨ç´¢å¼•ä¸­å°±èƒ½æ»¡è¶³ç¬¬ä¸‰é¢—æ˜Ÿã€‚è¿™æ ·ä¸éœ€è¦è®¿é—®è¡¨ï¼Œé‚£ä¹ˆåŒæ­¥è¯»ä¹Ÿå°±ä¸ä¼šé€ æˆé—®é¢˜ã€‚</strong></p><p>æ·»åŠ  ORDER BY åˆ—èƒ½ä½¿ç´¢å¼•æ»¡è¶³ç¬¬äºŒé¢—æ˜Ÿï¼Œä½†æ˜¯è¿™ä¸ªä»…åœ¨å°†å…¶æ”¾åœ¨ BETWEEN è°“è¯åˆ— LNAME ä¹‹å‰çš„æƒ…å†µä¸‹æ‰æˆç«‹ï¼Œå¦‚ç´¢å¼• (CITY, FNAME, LNAME)ã€‚ç”±äº CITY çš„å€¼åªæœ‰ä¸€ä¸ªï¼ˆ=è°“è¯ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨è¿™ä¸ªç´¢å¼•å¯ä»¥ä½¿ç»“æœé›†ä»¥ FNAME çš„é¡ºåºæ’åˆ—ï¼Œè€Œä¸éœ€è¦é¢å¤–çš„æ’åºã€‚ä½†æ˜¯å¦‚æœ ORDER BY å­—æ®µåŠ åœ¨ BETWEEN è°“è¯åˆ— LNAME åé¢ï¼Œå¦‚ç´¢å¼• (CITY, LNAME, FNAME)ï¼Œé‚£ä¹ˆç´¢å¼•è¡Œä¸æ˜¯æŒ‰ FNAME é¡ºåºæ’åˆ—çš„ï¼Œå› è€Œå°±éœ€è¦è¿›è¡Œæ’åºæ“ä½œã€‚å› æ­¤ï¼Œä¸ºäº†æ»¡è¶³ç¬¬äºŒé¢—æ˜Ÿï¼ŒFNAME å¿…é¡»åœ¨ BETWEEN è°“è¯åˆ— LNAME å‰é¢ï¼Œå¦‚ç´¢å¼• (FNAME, â€¦) æˆ–ç´¢å¼• (CITY, FNAME, â€¦)ã€‚</p><p>å†è€ƒè™‘ç¬¬ä¸€é¢—æ˜Ÿï¼Œå¦‚æœ CITY æ˜¯ç´¢å¼•çš„ç¬¬ä¸€ä¸ªåˆ—ï¼Œé‚£æˆ‘ä»¬å°†ä¼šæœ‰ä¸€ä¸ªç›¸å¯¹è¾ƒçª„çš„ç´¢å¼•ç‰‡éœ€è¦æ‰«æï¼ˆMC=1ï¼‰ï¼Œè¿™å–å†³äº CITY çš„è¿‡æ»¤å› å­ã€‚ä½†æ˜¯å¦‚æœç”¨ç´¢å¼• (CITY, LNAME, â€¦) çš„è¯ï¼Œç´¢å¼•ç‰‡ä¼šæ›´çª„ï¼Œè¿™æ ·åœ¨æœ‰ä¸¤ä¸ªåŒ¹é…åˆ—çš„æƒ…å†µä¸‹æˆ‘ä»¬åªéœ€è¦è®¿é—®çœŸæ­£éœ€è¦çš„ç´¢å¼•è¡Œã€‚ä½†æ˜¯ï¼Œä¸ºäº†åšåˆ°è¿™æ ·ï¼Œå¹¶ä»ä¸€ä¸ªå¾ˆçª„çš„ç´¢å¼•ç‰‡ä¸­è·ç›Šï¼Œå…¶ä»–åˆ—ï¼ˆå¦‚ FNAMEï¼‰å°±ä¸èƒ½æ”¾åœ¨è¿™ä¸¤åˆ—ä¹‹é—´ã€‚</p><blockquote><p>MC:match columnï¼ˆåŒ¹é…åˆ—ï¼‰</p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬çš„ç†æƒ³ç´¢å¼•ä¼šæœ‰å‡ é¢—æ˜Ÿå‘¢ï¼Ÿé¦–å…ˆå®ƒä¸€å®šèƒ½æœ‰ç¬¬ä¸‰é¢—æ˜Ÿï¼Œä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘ä»¬åˆšæ‰æ‰€è¯´ï¼Œæˆ‘ä»¬åªèƒ½æœ‰ç¬¬ä¸€é¢—æ˜Ÿæˆ–è€…ç¬¬äºŒé¢—æ˜Ÿï¼Œè€Œä¸èƒ½åŒæ—¶æ‹¥æœ‰ä¸¤è€…ï¼æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬åªèƒ½äºŒé€‰ä¸€ï¼š</p><ul><li>é¿å…æ’åº â€” æ‹¥æœ‰ç¬¬äºŒé¢—æ˜Ÿ</li><li>æ‹¥æœ‰å¯èƒ½çš„æœ€çª„ç´¢å¼•ç‰‡ï¼Œä¸ä»…å°†éœ€è¦å¤„ç†çš„ç´¢å¼•è¡Œæ•°é™è‡³æœ€ä½ï¼Œè€Œä¸”å°†åç»­å¤„ç†é‡ï¼Œç‰¹åˆ«æ˜¯è¡¨ä¸­æ•°æ®è¡Œçš„åŒæ­¥è¯»ï¼Œå‡å°‘åˆ°æœ€å°‘ â€” æ‹¥æœ‰ç¬¬ä¸€é¢—æ˜Ÿ</li></ul><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒBETWEEN è°“è¯æˆ–è€…ä»»ä½•å…¶ä»–èŒƒå›´è°“è¯çš„å‡ºç°ï¼Œæ„å‘³ç€æˆ‘ä»¬ä¸èƒ½åŒæ—¶æ‹¥æœ‰ç¬¬ä¸€é¢—æ˜Ÿå’Œç¬¬äºŒé¢—æ˜Ÿã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸èƒ½æ‹¥æœ‰ä¸€ä¸ªä¸‰æ˜Ÿç´¢å¼•ã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬éœ€è¦åœ¨ç¬¬ä¸€é¢—æ˜Ÿå’Œç¬¬äºŒé¢—æ˜Ÿä¸­åšå‡ºé€‰æ‹©ã€‚é€šå¸¸è¿™ä¸æ˜¯ä¸€ä¸ªå›°éš¾çš„é€‰æ‹©ï¼Œ<strong>å› ä¸ºç¬¬ä¸€é¢—æ˜Ÿä¸€èˆ¬æ¯”ç¬¬äºŒé¢—æ˜Ÿæ›´é‡è¦ï¼Œè™½ç„¶å¹¶ä¸æ€»æ˜¯è¿™æ ·</strong>ã€‚</p><h2 id="ä¸ºæŸ¥è¯¢è¯­å¥è®¾è®¡æœ€ä½³ç´¢å¼•çš„ç®—æ³•"><a href="#ä¸ºæŸ¥è¯¢è¯­å¥è®¾è®¡æœ€ä½³ç´¢å¼•çš„ç®—æ³•" class="headerlink" title="ä¸ºæŸ¥è¯¢è¯­å¥è®¾è®¡æœ€ä½³ç´¢å¼•çš„ç®—æ³•"></a>ä¸ºæŸ¥è¯¢è¯­å¥è®¾è®¡æœ€ä½³ç´¢å¼•çš„ç®—æ³•</h2><p><font color="DeepPink">æ ¹æ®ä»¥ä¸Šçš„è®¨è®ºï¼Œç†æƒ³çš„ç´¢å¼•æ˜¯ä¸€ä¸ªä¸‰æ˜Ÿç´¢å¼•ã€‚ç„¶è€Œï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œå½“å­˜åœ¨èŒƒå›´è°“è¯æ—¶ï¼Œè¿™æ˜¯ä¸å¯èƒ½å®ç°çš„ã€‚æˆ‘ä»¬ï¼ˆä¹Ÿè®¸ï¼‰ä¸å¾—ä¸ç‰ºç‰²ç¬¬äºŒé¢—æ˜Ÿæ¥æ»¡è¶³ä¸€ä¸ªæ›´çª„çš„ç´¢å¼•ç‰‡ï¼ˆç¬¬ä¸€é¢—æ˜Ÿï¼‰ï¼Œè¿™æ ·ï¼Œæœ€ä½³ç´¢å¼•å°±åªæ‹¥æœ‰ä¸¤é¢—æ˜Ÿã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä»”ç»†åŒºåˆ†ç†æƒ³å’Œæœ€ä½³ã€‚</font>åœ¨è¿™ä¸ªä¾‹å­ä¸­ç†æƒ³ç´¢å¼•æ˜¯ä¸å¯èƒ½å®ç°çš„ã€‚å°†è¿™å±‚å› ç´ è€ƒè™‘åœ¨å†…ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ‰€æœ‰æƒ…å†µä¸‹åˆ›å»ºæœ€ä½³ç´¢å¼•ï¼ˆä¹Ÿè®¸ä¸æ˜¯ç†æƒ³ç´¢å¼•ï¼‰çš„è¿‡ç¨‹å…¬å¼åŒ–ã€‚åˆ›å»ºå‡ºçš„ç´¢å¼•å°†æ‹¥æœ‰ä¸‰é¢—æ˜Ÿæˆ–è€…ä¸¤é¢—æ˜Ÿã€‚</p><p><strong>é¦–å…ˆè®¾è®¡ä¸€ä¸ªç´¢å¼•ç‰‡å°½å¯èƒ½çª„ï¼ˆç¬¬ä¸€é¢—æ˜Ÿï¼‰çš„å®½ç´¢å¼•ï¼ˆç¬¬ä¸‰é¢—æ˜Ÿï¼‰ã€‚å¦‚æœæŸ¥è¯¢ä½¿ç”¨è¿™ä¸ªç´¢å¼•æ—¶ä¸éœ€è¦æ’åºï¼ˆç¬¬äºŒé¢—æ˜Ÿï¼‰ï¼Œé‚£è¿™ä¸ªç´¢å¼•å°±æ˜¯ä¸‰æ˜Ÿç´¢å¼•ã€‚å¦åˆ™è¿™ä¸ªç´¢å¼•åªèƒ½æ˜¯äºŒæ˜Ÿç´¢å¼•ï¼Œç‰ºç‰²ç¬¬äºŒé¢—æ˜Ÿã€‚æˆ–è€…é‡‡ç”¨å¦ä¸€ç§é€‰æ‹©ï¼Œé¿å…æ’åºï¼Œç‰ºç‰²ç¬¬ä¸€é¢—æ˜Ÿä¿ç•™ç¬¬äºŒé¢—æ˜Ÿã€‚è¿™ç§äºŒæ˜Ÿç´¢å¼•ä¸­çš„ä¸€ä¸ªå°†ä¼šæ˜¯ç›¸åº”æŸ¥è¯¢è¯­å¥çš„æœ€ä½³ç´¢å¼•ã€‚</strong></p><h3 id="ä¸ºæŸ¥è¯¢è¯­å¥åˆ›å»ºæœ€ä½³ç´¢å¼•çš„ç®—æ³•"><a href="#ä¸ºæŸ¥è¯¢è¯­å¥åˆ›å»ºæœ€ä½³ç´¢å¼•çš„ç®—æ³•" class="headerlink" title="ä¸ºæŸ¥è¯¢è¯­å¥åˆ›å»ºæœ€ä½³ç´¢å¼•çš„ç®—æ³•"></a>ä¸ºæŸ¥è¯¢è¯­å¥åˆ›å»ºæœ€ä½³ç´¢å¼•çš„ç®—æ³•</h3><h4 id="å€™é€‰-A"><a href="#å€™é€‰-A" class="headerlink" title="å€™é€‰ A"></a>å€™é€‰ A</h4><ol><li>å–å‡ºå¯¹äºä¼˜åŒ–å™¨æ¥è¯´ä¸è¿‡åˆ†å¤æ‚çš„ç­‰å€¼è°“è¯åˆ—ã€‚å°†è¿™äº›åˆ—ä½œä¸ºç´¢å¼•çš„å‰å¯¼åˆ—(ä»¥ä»»æ„é¡ºåºçš†å¯)ã€‚</li><li>å°†é€‰æ‹©æ€§æœ€å¥½çš„èŒƒå›´è°“è¯ä½œä¸ºç´¢å¼•çš„ä¸‹ä¸€ä¸ªåˆ—ï¼Œå¦‚æœå­˜åœ¨çš„è¯ã€‚æœ€å¥½çš„é€‰æ‹©æ€§æ˜¯æŒ‡å¯¹äºæœ€å·®çš„è¾“å…¥å€¼æœ‰æœ€ä½çš„è¿‡æ»¤å› å­ã€‚åªè€ƒè™‘å¯¹äºä¼˜åŒ–å™¨æ¥è¯´ä¸è¿‡åˆ†å¤æ‚çš„èŒƒå›´è°“è¯ã€‚</li><li>ä»¥æ­£ç¡®çš„é¡ºåºæ·»åŠ ORDER BYè¯­åˆ—ï¼Œå¿½ç•¥åœ¨ç¬¬ä¸€æ­¥æˆ–è€…ç¬¬äºŒæ­¥å·²æ·»åŠ çš„åˆ—ã€‚</li><li>ä»¥ä»»æ„é¡ºåºå°† SELECT è¯­å¥ä¸­å…¶ä½™çš„åˆ—æ·»åŠ è‡³ç´¢å¼•ä¸­ï¼ˆä½†æ˜¯éœ€è¦ä»¥ä¸æ˜“å˜çš„åˆ—å¼€å§‹ï¼‰ã€‚</li></ol><p>ä¸¾ä¾‹ï¼šCURSOR43</p><p>å€™é€‰ A ä¸º (CITY, LNAME, FNAME, NCNO)ã€‚</p><p>ç”±äº FNAME åœ¨èŒƒå›´è°“è¯åˆ— LNAME çš„åé¢ï¼Œå€™é€‰ A å¼•èµ·äº† CURSOR43 çš„ä¸€æ¬¡æ’åºæ“ä½œã€‚</p><h4 id="å€™é€‰-B"><a href="#å€™é€‰-B" class="headerlink" title="å€™é€‰ B"></a>å€™é€‰ B</h4><p>å¦‚æœå€™é€‰ A å¼•èµ·äº†æ‰€ç»™æŸ¥è¯¢è¯­å¥çš„ä¸€æ¬¡æ’åºæ“ä½œï¼Œé‚£ä¹ˆè¿˜å¯ä»¥è®¾è®¡å€™é€‰ Bã€‚æ ¹æ®å®šä¹‰ï¼Œå¯¹äºå€™é€‰ B æ¥è¯´ç¬¬äºŒé¢—æ˜Ÿæ¯”ç¬¬ä¸€é¢—æ˜Ÿæ›´é‡è¦ã€‚</p><ol><li>å–å‡ºå¯¹äºä¼˜åŒ–å™¨æ¥è¯´ä¸è¿‡åˆ†å¤æ‚çš„ç­‰å€¼è°“è¯åˆ—ã€‚å°†è¿™äº›åˆ—ä½œä¸ºç´¢å¼•çš„å‰å¯¼åˆ—(ä»¥ä»»æ„é¡ºåºçš†å¯)ã€‚</li><li>ä»¥æ­£ç¡®é¡ºåºæ·»åŠ  ORDER BY åˆ—ï¼ˆå¦‚æœ ORDER BY åˆ—æœ‰ DESC çš„è¯ï¼ŒåŠ ä¸Š DESCï¼‰ã€‚å¿½ç•¥åœ¨ç¬¬1æ­¥ä¸­å·²ç»æ·»åŠ çš„åˆ—ã€‚</li><li>ä»¥ä»»æ„é¡ºåºå°† SELECT è¯­å¥ä¸­å…¶ä½™çš„åˆ—æ·»åŠ è‡³ç´¢å¼•ä¸­ï¼ˆä½†æ˜¯éœ€è¦ä»¥ä¸æ˜“å˜çš„åˆ—å¼€å§‹ï¼‰ã€‚</li></ol><p>ä¸¾ä¾‹ï¼šCURSOR43</p><p>å€™é€‰ B ä¸º (CITY, FNAME, LNAME, CNO)ã€‚</p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€åšçš„åªæ˜¯è®¾è®¡ç†æƒ³ç´¢å¼•æˆ–æ˜¯æœ€ä½³ç´¢å¼•ã€‚ä½†æ˜¯è¿™æ˜¯å¦æ˜¯å®é™…å¯è¡Œçš„ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªé˜¶æ®µè¿˜ä¸å¥½è¯´ã€‚</p></blockquote><h1 id="å‰ç»æ€§çš„ç´¢å¼•è®¾è®¡"><a href="#å‰ç»æ€§çš„ç´¢å¼•è®¾è®¡" class="headerlink" title="å‰ç»æ€§çš„ç´¢å¼•è®¾è®¡"></a>å‰ç»æ€§çš„ç´¢å¼•è®¾è®¡</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="è®¿é—®"><a href="#è®¿é—®" class="headerlink" title="è®¿é—®"></a>è®¿é—®</h3><p>æ ¹æ®å®šä¹‰ï¼ŒDBMSè¯»å–ä¸€ä¸ªç´¢å¼•è¡Œæˆ–ä¸€ä¸ªè¡¨è¡Œçš„æˆæœ¬ç§°ä¸ºä¸€æ¬¡è®¿é—® : ç´¢å¼•è®¿é—®æˆ–è¡¨è®¿é—®ã€‚å¦‚æœDBMSæ‰«æç´¢å¼•æˆ–è¡¨çš„ä¸€ä¸ªç‰‡æ®µ(è¢«è¯»å–çš„è¡Œåœ¨ç‰©ç†ä¸Šæ˜¯å½¼æ­¤ç›¸é‚»çš„)ï¼Œé‚£ä¹ˆç¬¬ä¸€è¡Œçš„è¯»å–å³ä¸ºä¸€æ¬¡éšæœºè®¿é—®ã€‚å¯¹äºåç»­è¡Œçš„è¯»å–ï¼Œæ¯è¡Œéƒ½æ˜¯ä¸€æ¬¡é¡ºåºè®¿é—®ã€‚åœ¨å½“å‰çš„ç¡¬ä»¶æ¡ä»¶ä¸‹ï¼Œé¡ºåºè®¿é—®çš„æˆæœ¬æ¯”éšæœºè®¿é—®çš„æˆæœ¬ä½å¾—å¤šã€‚ä¸€æ¬¡ç´¢å¼•è®¿é—®çš„æˆæœ¬ä¸ä¸€æ¬¡è¡¨è®¿é—®çš„æˆæœ¬åŸºæœ¬ä¸Šæ˜¯ç›¸åŒçš„ã€‚</p><h3 id="è¯»å–ä¸€ç»„è¿ç»­çš„ç´¢å¼•è¡Œ"><a href="#è¯»å–ä¸€ç»„è¿ç»­çš„ç´¢å¼•è¡Œ" class="headerlink" title="è¯»å–ä¸€ç»„è¿ç»­çš„ç´¢å¼•è¡Œ"></a>è¯»å–ä¸€ç»„è¿ç»­çš„ç´¢å¼•è¡Œ</h3><p>ç‰©ç†ä¸Šå½¼æ­¤ç›¸é‚»æ˜¯ä»€ä¹ˆæ„æ€?</p><p>ç´¢å¼•ä¸Šçš„æ‰€æœ‰è¡Œéƒ½é€šè¿‡æŒ‡é’ˆé“¾æ¥åœ¨ä¸€èµ·ï¼Œé“¾æ¥çš„å…ˆåé¡ºåºç”±ç´¢å¼•çš„é”®å€¼ä¸¥æ ¼å®šä¹‰ã€‚å½“å‡ ä¸ªç´¢å¼•è¡Œçš„é”®å€¼ç›¸åŒæ—¶ï¼Œå°±æ ¹æ®ç´¢å¼•è¡Œå­˜å‚¨çš„æŒ‡é’ˆå€¼è¿›è¡Œé“¾æ¥ã€‚åœ¨ä¼ ç»Ÿçš„ç´¢å¼•è®¾è®¡(ä»æŸä¸ªè§’åº¦çœ‹ï¼Œæ˜¯ç†æƒ³åŒ–çš„)ä¸­ï¼Œé“¾è¡¨ä»LP1(å¶å­é¡µ1)å¼€å§‹ï¼Œéšåé“¾æ¥LP2ï¼Œä»¥æ­¤ç±»æ¨ã€‚è¿™æ ·(å‡è®¾æ¯ä¸ªç£é“å¯ä»¥æ”¾12ä¸ªå¶å­é¡µï¼Œå½“å‰çš„ç¡¬ä»¶é€šå¸¸å¯ä»¥å®¹çº³æ›´å¤š)ï¼Œå¶å­é¡µå°±ç»„æˆäº†ä¸€ä¸ªè¿ç»­çš„æ–‡ä»¶ï¼ŒLP1è‡³LP12å­˜å‚¨åœ¨ç£ç›˜æŸ±é¢çš„ç¬¬ä¸€ä¸ªç£é“ï¼ŒLP13è‡³LP24å­˜å‚¨åœ¨ä¸‹ä¸€ä¸ªç£é“ï¼Œå¦‚æ­¤ç»§ç»­ï¼Œå½“ç¬¬ä¸€ä¸ªæŸ±é¢å­˜æ»¡åï¼Œä¸‹ä¸€ç»„LPå°±ä¼šè¢«å­˜å‚¨åœ¨ä¸‹ä¸€ä¸ªæŸ±é¢çš„é¦–ä¸ªç£é“ä¸Šã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¶å­é¡µä¹‹é—´æ²¡æœ‰å…¶ä»–é¡µã€‚</p><p>ç°åœ¨ï¼Œè¯»å–ä¸€ä¸ªè¿ç»­çš„ç´¢å¼•è¡Œ(å³ä¸€ä¸ªç´¢å¼•ç‰‡ï¼Œæˆ–è€…åŒ…å«äº†å•ä¸ªé”®å€¼æˆ–è€…ä¸€ä¸ªèŒƒå›´çš„é”®å€¼æ‰€å¯¹åº”çš„ç´¢å¼•è¡Œ)å°±éå¸¸å¿«äº†ã€‚ä¸€æ¬¡ç£ç›˜æ—‹è½¬ä¼šå°†å¤šä¸ªå¶å­é¡µè¯»å–è¿›å†…å­˜ä¸­ï¼Œè€Œä¸”åªæœ‰åœ¨ç£ç›˜æŒ‡é’ˆç§»åˆ°ä¸‹ä¸€ä¸ªæŸ±é¢æ—¶æ‰éœ€è¦è¿›è¡Œä¸€æ¬¡çŸ­æš‚çš„å¯»å€ã€</p><p>ä¸è¿‡ï¼Œè¿™ä¸ªå®Œç¾çš„é¡ºåºè¿˜æ˜¯ä¼šè¢«æ‰“ç ´çš„ï¼Œè‡³å°‘æœ‰ä»¥ä¸‹ä¸‰ä¸ªå½±å“å› ç´  :</p><ol><li>å¦‚æœä¸€ä¸ªå¶å­é¡µæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜å‚¨æ–°æ’å…¥çš„ç´¢å¼•è¡Œï¼Œé‚£ä¹ˆå¶å­é¡µå°±å¿…é¡»è¢«åˆ†è£‚ã€‚ä¹‹åé“¾è¡¨ä»ä¼šæŒ‰ç…§æ­£ç¡®çš„é¡ºåºé“¾æ¥ç´¢å¼•è¡Œï¼Œä½†æ˜¯è¿™ä¸åº•å±‚çš„ç‰©ç†å­˜å‚¨é¡ºåºå°±ä¸å†ä¸€è‡´äº†ï¼Œä¸€äº›æŒ‰é“ç†åº”è¯¥æ˜¯é¡ºåºçš„è®¿é—®å°±å˜æˆéšæœºè®¿é—®äº†ã€‚ä¸è¿‡ç´¢å¼•çš„å……è¶³å¯ä»¥å†æ¬¡æ¢å¤æœ€ç†æƒ³çš„é¡ºåºã€‚</li><li>æ„å‘ä¸åˆ°çš„æ•°æ®å¢é•¿å¯èƒ½ä¼šå¡«æ»¡åŸæœ¬è¿ç»­çš„ç©ºé—´(åŒºæˆ–ç±»ä¼¼çš„æ¦‚å¿µ)ã€‚æ“ä½œç³»ç»Ÿäºæ˜¯å°±ä¼šå¯»æ‰¾å¦å¤–æœ‰ä¸€ä¸ªè¿ç»­çš„ç©ºé—´ï¼Œå¹¶å°†å®ƒè¿æ¥åˆ°åŸæ¥ç©ºé—´çš„åé¢ã€‚è¿™æ—¶å€™ä»ç¬¬ä¸€ä¸ªåŒºè·¨åˆ°ç¬¬äºŒä¸ªåŒºè®¿é—®å°±ä¼šäº§ç”Ÿä¸€æ¬¡éšæœºè®¿é—®ï¼Œä¸è¿‡è¿™ç§æƒ…å†µå½±å“ä¸å¤§ã€‚</li><li>RAID 5æ¡å¸¦ä¼šå°†å‰å‡ ä¸ªå¶å­é¡µå­˜å‚¨åœ¨ä¸€ä¸ªé©±åŠ¨å™¨ä¸Šï¼Œå°†åé¢çš„å¶å­é¡µå­˜æ”¾åœ¨å¦å¤–çš„é©±åŠ¨å™¨ä¸Šã€‚è¿™å°±ä¼šäº§ç”Ÿé¢å¤–çš„éšæœºè¯»ï¼Œä½†å®é™…ä¸Šæ¡å¸¦çš„ç§¯æä½œç”¨è¦å¤§è¿‡éšæœºè¯»å¸¦æ¥çš„æ€§èƒ½æ¶åŒ–ï¼Œä¸€ä¸ªæ™ºèƒ½çš„ç£ç›˜æœåŠ¡å™¨å¯ä»¥å°†åç»­çš„å¶å­é¡µå¹¶è¡Œçš„ä»å¤šä¸ªé©±åŠ¨å™¨ä¸Šè¯»å–è‡³ç£ç›˜ç¼“å­˜ä¸­ï¼Œä»è€Œå¤§å¤§é™ä½äº†å•ä¸ªå¶å­é¡µçš„I/Oæ—¶é—´ã€‚æ­¤å¤–ï¼Œåœ¨RAID 5æ¡å¸¦ç­–ç•¥ä¸‹ï¼Œä¸€ä¸ªè¢«é¢‘ç¹è®¿é—®çš„ç´¢å¼•çš„ä¸å¤ªå¯èƒ½å¯¼è‡´æŸä¸€ä¸ªç£ç›˜è´Ÿè½½è¿‡é«˜ï¼Œå› ä¸ºI/Oè¯·æ±‚ä¼šè¢«å‡åŒ€ä½åˆ†å¸ƒåˆ°RAID 5é˜µåˆ—å†…çš„å¤šä¸ªç£ç›˜é©±åŠ¨å™¨ã€‚</li></ol><p>å¿½ç•¥ä¸Šè¿°æƒ…å†µï¼Œæˆ‘ä»¬ä»ç„¶å‡è®¾ï¼Œå¦‚æœä¸¤ä¸ªç´¢å¼•è¡Œåœ¨é“¾è¡¨ä¸Šå½¼æ­¤ç›¸é‚»(æˆ–è€…åœ¨å”¯ä¸€ç´¢å¼•ä¸­ï¼Œç›¸åŒé”®å€¼çš„è¡ŒæŒ‡é’ˆæ„å‘³ç€å½¼æ­¤ç›¸é‚»)ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºè¿™ä¸¤è¡Œåœ¨ç‰©ç†ä¸Šä¹Ÿç›¸é‚»ã€‚è¿™å°±æ„å‘³ç€QUBEè®¤ä¸ºæ‰€æœ‰çš„ç´¢å¼•éƒ½æœ‰æœ€ç†æƒ³çš„é¡ºåºã€‚</p><h3 id="è¯»å–ä¸€ç»„è¿ç»­çš„è¡¨è¡Œ"><a href="#è¯»å–ä¸€ç»„è¿ç»­çš„è¡¨è¡Œ" class="headerlink" title="è¯»å–ä¸€ç»„è¿ç»­çš„è¡¨è¡Œ"></a>è¯»å–ä¸€ç»„è¿ç»­çš„è¡¨è¡Œ</h3><p>è¯»å–ä¸€ç»„è¿ç»­çš„è¡¨è¡Œæœ‰å¦‚ä¸‹ä¸¤ç§æƒ…å†µï¼š</p><ol><li>å…¨è¡¨æ‰«æ<br>ä»TP1(è¡¨é¡µ1)å¼€å§‹ï¼Œè¯»å–è¯¥é¡µä¸Šæ‰€æœ‰çš„è®°å½•ï¼Œç„¶åå†è®¿é—®TP2ï¼Œä¸€æ¬¡ç±»æ¨ã€‚æŒ‰ç…§è®°å½•åœ¨è¡¨é¡µä¸­å­˜å‚¨çš„é¡ºåºè¿›è¡Œè¯»å–ï¼Œæ²¡æœ‰å…¶ä»–ç‰¹æ®Šçš„é¡ºåºã€‚</li><li>èšç°‡ç´¢å¼•æ‰«æ<br>è¯»å–ç´¢å¼•ç‰‡ä¸Šç¬¬ä¸€ä¸ªç´¢å¼•è¡Œï¼Œç„¶åè·å–ç›¸åº”çš„è¡¨è¡Œï¼Œå†è®¿é—®ç¬¬äºŒä¸ªç´¢å¼•è¡Œï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦‚æœç´¢å¼•è¡Œä¸å¯¹åº”çš„è¡¨è¡Œè®°å½•é¡ºåºå®Œå…¨ä¸€è‡´(èšç°‡ç‡ä¸º100%)ï¼Œé‚£ä¹ˆé™¤äº†ç¬¬ä¸€æ¬¡ä¹‹å¤–çš„æ‰€æœ‰è¡¨è®¿é—®å°±éƒ½æ˜¯é¡ºåºè®¿é—®ã€‚è¡¨è®°å½•çš„é“¾æ¥æ–¹å¼è·Ÿç´¢å¼•ä¸ä¸€æ ·ã€‚å•ä¸ªè¡¨é¡µä¸­è®°å½•çš„é¡ºåºæ— å…³ç´§è¦ï¼Œåªè¦è®¿é—®çš„ä¸‹ä¸€ä¸ªè¡¨è®°å½•åœ¨åŒä¸€ä¸ªè¡¨é¡µæˆ–è€…ç›¸é‚»çš„ä¸‹ä¸€ä¸ªè¡¨é¡µå†…å°±å¯ä»¥äº†ã€‚</li></ol><p>åŒç´¢å¼•ä¸€æ ·ï¼Œå­˜å‚¨è¡¨çš„ä¼ ç»Ÿæ–¹å¼ä¹Ÿæ˜¯å°†æ‰€æœ‰è¡¨é¡µä¿ç•™åœ¨ä¸€ä¸ªè¿ç»­çš„ç©ºé—´å†…ã€‚å¼•èµ·é¡ºåºæ‚ä¹±æˆ–ç¢ç‰‡åŒ–çš„å› ç´ ä¹Ÿå’Œç´¢å¼•ä¸­çš„ç›¸ä¼¼ï¼Œä½†åˆä¸¤ä¸ªåœ°æ–¹ä¸åŒï¼š</p><ol><li>å¦‚æœå¾€è¡¨ä¸­æ’å…¥çš„è®°å½•åœ¨èšç°‡ç´¢å¼•æ‰€å®šä¹‰çš„ä¸»é¡µä¸­è£…ä¸ä¸‹ï¼Œåˆ™é€šå¸¸ä¸ä¼šç§»åŠ¨ç°æœ‰çš„è¡Œï¼Œè€Œæ˜¯ä¼šå°†æ–°æ’å…¥çš„è®°å½•å­˜å‚¨åˆ°ç¦»ä¸»é¡µå°½å¯èƒ½è¿‘çš„è¡¨é¡µä¸­ã€‚å¯¹ç¬¬äºŒä¸ªé¡µçš„éšæœºI/Oä¼šä½¿èšç°‡ç´¢å¼•æ‰«æå˜å¾—æ›´æ…¢ï¼Œä½†æ˜¯å¦‚æœè¿™æ¡è®°å½•ç¦»ä¸»é¡µå¾ˆè¿‘ï¼Œè¿™äº›é¢å¤–çš„å¼€é”€å°±å¯ä»¥è¢«é¿å…ï¼Œå› ä¸ºé¡ºé¢„è¯»åŠŸèƒ½ä¼šä¸€æ¬¡æ€§å°†å¤šä¸ªè¡¨é¡µè£…è½½åˆ°æ•°æ®åº“ç¼“å­˜ä¸­ã€‚å³ä½¿é¡ºåºé¢„è¯»åŠŸèƒ½æ²¡æœ‰ä½¿ç”¨ï¼Œä¹Ÿåªæœ‰å½“è¯¥é¡µåœ¨æ•°æ®åº“ç¼“å­˜è¢«è¦†ç›–çš„æƒ…å†µä¸‹æ‰ä¼šå‘ç”Ÿé¢å¤–çš„éšæœºI/Oã€‚</li><li>ä¸€æ¡è®°å½•è¢«æ›´æ–°åï¼Œå¯èƒ½å› ä¸ºè¡¨è¡Œè¿‡é•¿å¯¼è‡´å…¶æ— æ³•å†å­˜å‚¨äºå½“å‰çš„è¡¨é¡µä¸­ã€‚è¿™æ˜¯DBMAå°±å¿…é¡»å°†è¯¥è¡Œè®°å½•è¿ç§»è‡³å¦å¤–ä¸€ä¸ªè¡¨é¡µä¸­ï¼ŒåŒæ—¶åœ¨åŸæœ‰çš„è¡¨é¡µä¸­å­˜å‚¨æŒ‡å‘æ–°è¡¨é¡µçš„æŒ‡é’ˆã€‚å½“è¯¥è¡Œè¢«è®¿é—®æ—¶ï¼Œä¼šå¼•å…¥é¢å¤–çš„éšæœºè®¿é—®ã€‚<br>è¡¨å¯ä»¥é€šè¿‡é‡ç»„æ¥è¿˜åŸè¡Œè®°å½•çš„é¡ºåºï¼Œä»è€Œå‡å°‘ä¸å¿…è¦çš„éšæœºè®¿é—®ã€‚</li></ol><h2 id="è®¡ç®—è®¿é—®æ¬¡æ•°"><a href="#è®¡ç®—è®¿é—®æ¬¡æ•°" class="headerlink" title="è®¡ç®—è®¿é—®æ¬¡æ•°"></a>è®¡ç®—è®¿é—®æ¬¡æ•°</h2><h3 id="éšæœºè®¿é—®"><a href="#éšæœºè®¿é—®" class="headerlink" title="éšæœºè®¿é—®"></a>éšæœºè®¿é—®</h3><p>æˆ‘ä»¬é¦–å…ˆæ€è€ƒä¸€ä¸‹ç£ç›˜è¯»ä¸è®¿é—®çš„åŒºåˆ«ã€‚<strong>ä¸€æ¬¡ç£ç›˜è¯»æ‰€è®¿é—®çš„å¯¹è±¡æ˜¯ä¸€ä¸ªé¡µï¼Œè€Œä¸€æ¬¡è®¿é—®çš„è®¿é—®å¯¹è±¡åˆ™æ˜¯ä¸€è¡Œã€‚</strong>ä¸€æ¬¡éšæœºç£ç›˜è¯»ä¼šå°†ä¸€æ•´é¡µ(é€šå¸¸ä¼šåŒ…å«å¾ˆå¤šè¡Œ)è¯»å–è‡³æ•°æ®åº“çš„ç¼“å†²æ± ä¸­ï¼Œä½†æ˜¯æ ¹æ®å®šä¹‰ï¼Œå‰åä¸¤æ¬¡éšæœºè¯»ä¸å¤ªå¯èƒ½ä¼šè®¿é—®åˆ°åŒä¸€ä¸ªé¡µã€‚</p><h2 id="ä½¿ç”¨æ»¡è¶³éœ€æ±‚çš„æˆæœ¬æœ€ä½çš„ç´¢å¼•è¿˜æ˜¯æ‰€èƒ½è¾¾åˆ°çš„æœ€æœ‰ç´¢å¼•"><a href="#ä½¿ç”¨æ»¡è¶³éœ€æ±‚çš„æˆæœ¬æœ€ä½çš„ç´¢å¼•è¿˜æ˜¯æ‰€èƒ½è¾¾åˆ°çš„æœ€æœ‰ç´¢å¼•" class="headerlink" title="ä½¿ç”¨æ»¡è¶³éœ€æ±‚çš„æˆæœ¬æœ€ä½çš„ç´¢å¼•è¿˜æ˜¯æ‰€èƒ½è¾¾åˆ°çš„æœ€æœ‰ç´¢å¼•"></a>ä½¿ç”¨æ»¡è¶³éœ€æ±‚çš„æˆæœ¬æœ€ä½çš„ç´¢å¼•è¿˜æ˜¯æ‰€èƒ½è¾¾åˆ°çš„æœ€æœ‰ç´¢å¼•</h2><p><font color="DeepPink">å½“æœ‰å¤šä¸ªç­‰å€¼è°“è¯ä½œä¸ºåŒ¹é…åˆ—æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘è¿™äº›åˆ—åœ¨ç´¢å¼•ä¸Šçš„å…ˆåé¡ºåºã€‚ç»å¸¸å˜åŒ–çš„åˆ—åº”å½“å°½å¯èƒ½çš„æ’åœ¨åé¢ã€‚</font></p><blockquote><p>æ›´æ”¹ç°æœ‰ç´¢å¼•åˆ—çš„é¡ºåºå’Œåœ¨ç°æœ‰ç´¢å¼•åˆ—ä¹‹é—´æ·»åŠ æ–°åˆ—åŒæ ·å±é™©ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œç°æœ‰çš„selectçš„æ‰§è¡Œé€Ÿåº¦éƒ½å¯èƒ½ä¼šæ€¥å‰§ä¸‹é™ï¼Œå› ä¸ºåŒ¹é…åˆ—å‡å°‘äº†ï¼Œæˆ–è€…å¼•å…¥äº†æ’åº(å¯¼è‡´è¿‡æ—©äº§ç”Ÿç»“æœé›†)</p></blockquote><h2 id="åŠå®½ç´¢å¼•-æœ€å¤§åŒ–ç´¢å¼•è¿‡æ»¤"><a href="#åŠå®½ç´¢å¼•-æœ€å¤§åŒ–ç´¢å¼•è¿‡æ»¤" class="headerlink" title="åŠå®½ç´¢å¼•(æœ€å¤§åŒ–ç´¢å¼•è¿‡æ»¤)"></a>åŠå®½ç´¢å¼•(æœ€å¤§åŒ–ç´¢å¼•è¿‡æ»¤)</h2><p>åœ¨ç°æœ‰ç´¢å¼•çš„æœ«ç«¯æ·»åŠ ç¼ºå°‘çš„è°“è¯åˆ—å¯ä»¥æ¶ˆé™¤å¤§é‡çš„éšæœºè®¿é—®ï¼Œå› ä¸ºè¿™æ ·èƒ½å¼•å…¥ç´¢å¼•è¿‡æ»¤è¿‡ç¨‹ã€‚</p><h1 id="å½±å“ç´¢å¼•è®¾è®¡è¿‡ç¨‹çš„å› ç´ "><a href="#å½±å“ç´¢å¼•è®¾è®¡è¿‡ç¨‹çš„å› ç´ " class="headerlink" title="å½±å“ç´¢å¼•è®¾è®¡è¿‡ç¨‹çš„å› ç´ "></a>å½±å“ç´¢å¼•è®¾è®¡è¿‡ç¨‹çš„å› ç´ </h1><p>I/Oæ—¶é—´ä¼°ç®—:</p><ul><li>éšæœºè¯»å– 10ms(é¡µçš„å¤§å°ä¸º4KBæˆ–8KB)</li><li>é¡ºåºè¯»å– 40MB/s</li></ul><p>è¿™äº›æ•°æ®æ˜¯å‡å®šç³»ç»Ÿä½¿ç”¨å½“å‰ç¡¬ä»¶å¹¶åœ¨ä¸€ä¸ªåˆç†çš„è´Ÿè½½ä¸‹è¿è¡Œæ—¶çš„å€¼ã€‚ä¸€äº›ç³»ç»Ÿå¯èƒ½è¿è¡Œçš„æ›´æ…¢æˆ–å¤„ç†è¶…è´Ÿè·çŠ¶æ€ã€‚</p><h2 id="å›°éš¾è°“è¯"><a href="#å›°éš¾è°“è¯" class="headerlink" title="å›°éš¾è°“è¯"></a>å›°éš¾è°“è¯</h2><p>å¤§ä½“ä¸Šï¼Œå‡è®¾ä¸€ä¸ªè°“è¯çš„åˆ¤å®šç»“æœä¸ºfalseï¼Œè€Œè¿™æ—¶å¦‚æœä¸æ£€æŸ¥å…¶ä»–è°“è¯å°±ä¸èƒ½ç¡®å®šåœ°å°†ä¸€è¡Œè®°å½•æ’é™¤åœ¨å¤–ï¼Œé‚£ä¹ˆè¿™ç±»è°“è¯å¯¹ä¼˜åŒ–å™¨è€Œè¨€å°±æ˜¯å¤ªè¿‡å›°éš¾çš„ã€‚</p><h2 id="è¿‡æ»¤å› å­éšæ‚£"><a href="#è¿‡æ»¤å› å­éšæ‚£" class="headerlink" title="è¿‡æ»¤å› å­éšæ‚£"></a>è¿‡æ»¤å› å­éšæ‚£</h2><p>å½“ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶ï¼Œè¿™ç§è¿‡æ»¤å› å­éšæ‚£å¯èƒ½ä¼šäº§ç”Ÿ :</p><ul><li>è®¿é—®è·¯å¾„ä¸­æ²¡æœ‰æ’åº</li><li>ç¬¬ä¸€å±ç»“æœä¸€å»ºç«‹å°±å›åº”</li><li>ä¸æ˜¯æ‰€æœ‰çš„è°“è¯å­—æ®µéƒ½å‚ä¸å®šä¹‰å¸¦æ‰«æçš„ç´¢å¼•ç‰‡â€“æ¢å¥è¯è¯´å°±æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯åŒ¹é…å­—æ®µã€‚</li></ul><h1 id="è¢«åŠ¨å¼ç´¢å¼•è®¾è®¡"><a href="#è¢«åŠ¨å¼ç´¢å¼•è®¾è®¡" class="headerlink" title="è¢«åŠ¨å¼ç´¢å¼•è®¾è®¡"></a>è¢«åŠ¨å¼ç´¢å¼•è®¾è®¡</h1><blockquote><p>è¢«åŠ¨å¼çš„æ–¹æ³•ä¸è±ç‰¹å…„å¼Ÿåˆ›é€ å®ˆæ¶é£æœºçš„ç»å†éå¸¸ç›¸ä¼¼ã€‚æœ¬è´¨ä¸Šå°±æ˜¯æŠŠæŸ¥è¯¢æ”¾åœ¨ä¸€èµ·ï¼Œæ¨ä¸‹æ‚¬å´–ï¼Œç„¶åçœ‹ä»–èƒ½å¦èµ·é£ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ä¸ºåº”ç”¨è®¾è®¡ä¸€ä¸ªæ²¡æœ‰ç´¢å¼•çš„åŸå‹ï¼Œç„¶åå¼€å§‹è¿è¡Œä¸€äº›æŸ¥è¯¢ã€‚åˆæˆ–è€…ï¼Œåˆ›å»ºåŸå§‹ç´¢å¼•é›†ï¼Œç„¶åé€šè¿‡è¿è¡Œåº”ç”¨æ¥çœ‹é‚£äº›ç´¢å¼•è¢«ç”¨åˆ°ï¼Œé‚£äº›æ²¡æœ‰è¢«ç”¨åˆ°ã€‚å³ä½¿æ˜¯ä¸€ä¸ªå°å‹çš„æ•°æ®åº“ç³»ç»Ÿï¼Œè¿è¡Œé€Ÿåº¦æ…¢çš„æŸ¥è¯¢ä¹Ÿä¼šè¢«å¾ˆå¿«å‡¸æ˜¾å‡ºæ¥ã€‚</p><p>è¢«åŠ¨å¼è°ƒä¼˜çš„æ–¹æ³•ä¹Ÿè¢«ç”¨æ¥ç†è§£å’Œè°ƒä¼˜ä¸€ä¸ªæ€§èƒ½æ²¡æœ‰æ»¡è¶³é¢„æœŸçš„å·²æœ‰åº”ç”¨ã€‚</p></blockquote><h2 id="å¯¹ç»“æœé›†æ’åº"><a href="#å¯¹ç»“æœé›†æ’åº" class="headerlink" title="å¯¹ç»“æœé›†æ’åº"></a>å¯¹ç»“æœé›†æ’åº</h2><p>é™¤äº†å…¨è¡¨æ‰«æå’Œå…¨ç´¢å¼•æ‰«æï¼Œç»“æœé›†çš„æ’åºå°±æ˜¯æœ€æœ‰ç”¨çš„è­¦ç¤ºä¿¡å·äº†ã€‚å¼•èµ·æ’åºçš„åŸå› å¯èƒ½æœ‰ä»¥ä¸‹ä¸¤ç§:</p><ul><li>æ²¡æœ‰å¯ä½¿æŸ¥è¯¢è¯­å¥é¿å…æ’åºçš„ç´¢å¼•ã€‚</li><li>ä¼˜åŒ–å™¨æ‰€é€‰æ‹©çš„è®¿é—®è·¯å¾„åŒ…å«äº†ä¸€æ¬¡å¤šä½™çš„æ’åºã€‚</li></ul><blockquote><p>æœ‰å¾ˆå¤šæ•°æ®åº“é¡¾é—®å°†æ’åºè§†ä¸ºæ•Œäººã€‚æˆ‘ä»¬è®¤ä¸ºï¼Œå“ªäº›å¼ºè°ƒéšæœºI/Oå¸¦æ¥è‡´å‘½å½±å“çš„é¡¾é—®æ›´å€¼å¾—ä¿¡ä»»ã€‚</p></blockquote><h2 id="æˆæœ¬ä¼°ç®—"><a href="#æˆæœ¬ä¼°ç®—" class="headerlink" title="æˆæœ¬ä¼°ç®—"></a>æˆæœ¬ä¼°ç®—</h2><p>ä¸€äº›æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„EXPLAINåŠŸèƒ½æ˜¾ç¤ºäº†ä¼˜åŒ–å™¨å¯¹æ‰€é€‰è®¿é—®è·¯å¾„çš„æœ¬åœ°å“åº”æ—¶é—´çš„ä¼°ç®—ï¼Œæˆ–è‡³å°‘æ˜¾ç¤ºäº†å¯¹CPUæ—¶é—´çš„ä¼°ç®—ã€‚</p><p>ä¸å¹¸çš„æ˜¯ï¼Œä»¥ä¸‹ä¸¤ä¸ªä¸¥é‡é—®é¢˜é™åˆ¶äº†ä½¿ç”¨æˆæœ¬ä¼°ç®—æ–¹æ³•çš„ä»·å€¼:</p><ul><li>ä¼˜åŒ–å™¨æ‰€åšå‡ºçš„çš„æœ¬åœ°å“åº”æ—¶é—´ä¼°ç®—å¯èƒ½ä¸å®é™…ç›¸å·®å¾ˆå¤§</li><li>å½“è°“è¯ä½¿ç”¨ç»‘å®šå˜é‡æ—¶(æ˜¾ç„¶è¿™æ˜¯å¾ˆæ™®éçš„)ï¼Œä¼˜åŒ–å™¨å¯¹è¿‡æ»¤å› å­çš„ä¼°ç®—æ˜¯åŸºäºå¹³å‡è¾“å…¥å€¼çš„ï¼Œæˆ–æ›´å·®æƒ…å†µä¸‹ï¼ŒåŸºäºé»˜è®¤å€¼ã€‚ä¸ºäº†è·å–æ›´æœ‰ä»·å€¼çš„æœ€å·®æƒ…å†µä¼°å€¼ï¼ŒEXPLAINä¸­çš„ç»‘å®šå˜é‡å¿…é¡»ç”¨æœ€å·®æƒ…å†µä¸‹çš„è¾“å…¥å€¼æ¥ä»£æ›¿ã€‚è¿™æ˜¯ä¸€ä¸ªéœ€è¦åº”ç”¨çŸ¥è¯†çš„ç´¯äººæ“ä½œã€‚</li></ul><h1 id="ä¸ºè¡¨è¿æ¥è®¾è®¡ç´¢å¼•"><a href="#ä¸ºè¡¨è¿æ¥è®¾è®¡ç´¢å¼•" class="headerlink" title="ä¸ºè¡¨è¿æ¥è®¾è®¡ç´¢å¼•"></a>ä¸ºè¡¨è¿æ¥è®¾è®¡ç´¢å¼•</h1><h2 id="é¢„æµ‹è¡¨çš„è®¿é—®é¡ºåº"><a href="#é¢„æµ‹è¡¨çš„è®¿é—®é¡ºåº" class="headerlink" title="é¢„æµ‹è¡¨çš„è®¿é—®é¡ºåº"></a>é¢„æµ‹è¡¨çš„è®¿é—®é¡ºåº</h2><p>åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç»éªŒæ³•åˆ™æ¥é¢„æµ‹æœ€ä½³çš„è¡¨è®¿é—®é¡ºåº : å°†åŒ…å«<strong>æœ€ä½æ•°é‡æœ¬åœ°è¡Œ</strong>çš„è¡¨ä½œä¸ºå¤–å±‚è¡¨ã€‚</p><blockquote><p>æœ¬åœ°è¡Œçš„æ•°é‡æ˜¯æŒ‡æœ€å¤§è¿‡æ»¤å› å­è¿‡æ»¤æœ¬åœ°è°“è¯ä¹‹åæ‰€å‰©ä½™çš„è¡Œæ•°ã€‚</p></blockquote><p>ç»éªŒæ³•åˆ™å¿½ç•¥äº†ä»¥ä¸‹å› ç´ :</p><ol><li>æ’åºã€‚</li><li>å¾ˆå°çš„è¡¨ã€‚<font color="DeepPink">éå¸¸å°çš„è¡¨åŠå…¶ç´¢å¼•å¯èƒ½é•¿æœŸå­˜åœ¨äºæ•°æ®åº“çš„ç¼“å†²æ± ä¸­</font>ï¼Œè‡³å°‘åœ¨ä¸€ä¸ªè¿æ¥æŸ¥è¯¢ä¸­ï¼Œæ²¡æœ‰é¡µä¼šè¢«è¯»å–å¤šæ¬¡ã€‚åœ¨è¿™æ ·çš„è¡¨å’Œç´¢å¼•ä¸Šè¿›è¡Œéšæœºè¯»å–æ‰€è€—è´¹çš„æ—¶é—´å°äº0.1msï¼Œè‡³å°‘åœ¨é¡µè¢«ç¬¬ä¸€æ¬¡è¯»å–ä¹‹åæ˜¯è¿™æ ·çš„ã€‚æ‰€ä»¥ï¼Œå½“è¿™æ ·çš„è¡¨ä¸æ˜¯å¤–å±‚è¡¨æ—¶ï¼Œå¯¹å…¶å¤§é‡çš„éšæœºè¯»å–ä¹Ÿä¸ä¼šç§°ä¸ºé—®é¢˜ã€‚</li><li>èšç°‡æ¯”ä¾‹ã€‚ç´¢å¼•ä¸­è¡Œçš„é¡ºåºå’Œè¡¨ä¸­è¡Œçš„é¡ºåºçš„å…³è”æ€§(å¯¹äºèšç°‡ç´¢å¼•è€Œè¨€ï¼Œè¯¥å…³è”æ€§åœ¨è¡¨é‡ç»„åä¸º100%)ï¼Œå¯èƒ½ä¼šå½±å“å¯¹æœ€ä½³è®¿é—®é¡ºåºçš„é€‰æ‹©ï¼Œå½“ç„¶ï¼Œé™¤éç´¢å¼•æ˜¯å®½ç´¢å¼•ã€‚</li></ol><p>æœ€å¥½çš„åŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨åœ¨è¿›è¡Œè·¯å¾„é€‰æ‹©æ—¶ä¼šæŠŠè¿™äº›å› ç´ è€ƒè™‘è¿›æ¥ã€‚å› æ­¤ï¼Œä»–æ‰¾å‡ºçš„è®¿é—®é¡ºåºå¯èƒ½æ¯”æˆ‘ä»¬åŸºäºæœ¬åœ°è¡Œçš„æ•°é‡çš„ç»éªŒæ‰€å¾—å‡ºçš„ç»“æœæ›´ä¼˜ã€‚</p><h2 id="åˆå¹¶æ‰«æè¿æ¥å’Œå“ˆå¸Œè¿æ¥"><a href="#åˆå¹¶æ‰«æè¿æ¥å’Œå“ˆå¸Œè¿æ¥" class="headerlink" title="åˆå¹¶æ‰«æè¿æ¥å’Œå“ˆå¸Œè¿æ¥"></a>åˆå¹¶æ‰«æè¿æ¥å’Œå“ˆå¸Œè¿æ¥</h2><h3 id="åˆå¹¶æ‰«æè¿æ¥"><a href="#åˆå¹¶æ‰«æè¿æ¥" class="headerlink" title="åˆå¹¶æ‰«æè¿æ¥"></a>åˆå¹¶æ‰«æè¿æ¥</h3><p>æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹</p><ul><li>æ‰§è¡Œè¡¨æˆ–ç´¢å¼•æ‰«æä»¥æ‰¾å‡ºæ»¡è¶³æœ¬åœ°è°“è¯çš„æ‰€æœ‰è¡Œã€‚</li><li>éšåå¯èƒ½ä¼šè¿›è¡Œæ’åºï¼Œå¦‚æœè¿™äº›æ‰«ææœªæŒ‰æ‰€è¦æ±‚çš„é¡ºåºæä¾›ç»“æœé›†ã€‚</li><li>å¯¹å‰ä¸¤è€…ç”Ÿæˆçš„ä¸´æ—¶è¡¨è¿›è¡Œåˆå¹¶ã€‚</li></ul><p>åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œåˆå¹¶æ‰«æä¼šæ¯”åµŒå¥—å¾ªç¯å¿«ã€‚</p><ol><li>ç”¨äºè¿æ¥çš„å­—æ®µä¸Šæ²¡æœ‰å¯ç”¨çš„ç´¢å¼•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‹¥ä½¿ç”¨åµŒå¥—å¾ªç¯ï¼Œé‚£ä¹ˆå†…å±‚è¡¨å¯èƒ½éœ€è¦è¢«æ‰«æå¾ˆå¤šæ¬¡ã€‚åœ¨å®é™…æƒ…å†µä¸­ï¼Œç”¨äºè¿æ¥çš„åˆ—ä¸Šé¢æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µå¾ˆå°‘è§ï¼Œå› ä¸ºå¤§éƒ¨åˆ†è¿æ¥è°“è¯éƒ½æ˜¯åŸºäºâ€œä¸»é”®ç­‰äºå¤–é”®â€è¿™ä¸€æ¡ä»¶çš„ã€‚</li><li>ç»“æœè¡¨å¾ˆå¤§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‹¥ä½¿ç”¨åµŒå¥—å¾ªç¯è¿æ¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç›¸åŒçš„é¡µè¢«ä¸æ–­çš„é‡å¤è®¿é—®ã€‚</li><li>è¿æ¥æŸ¥è¯¢ä¸­ä¸æ­¢ä¸€å¼ è¡¨çš„è¿‡æ»¤å› å­å¾ˆä½ã€‚å¦‚æˆ‘ä»¬æ‰€è§ï¼ŒåµŒå¥—å¾ªç¯å¯èƒ½å¯¼è‡´å¯¹å†…å±‚è¡¨(æˆ–è€…å†…å±‚è¡¨ç´¢å¼•)çš„å¤§é‡éšæœºè®¿é—®ã€‚</li></ol><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DECLARE CURSOR81 CURSOR FOR</span><br><span class="line">SELECT CNAME, CTYPE, INO, IEUR</span><br><span class="line">FROM CUST, INVOICE</span><br><span class="line">WHERE CUST.CTYPE = :CTYPE</span><br><span class="line">      AND</span><br><span class="line">      IDATE &gt; :IDATE</span><br><span class="line">      AND</span><br><span class="line">      CUST.CNO = INVOICE.CNO</span><br></pre></td></tr></table></figure><h3 id="å“ˆå¸Œè¿æ¥"><a href="#å“ˆå¸Œè¿æ¥" class="headerlink" title="å“ˆå¸Œè¿æ¥"></a>å“ˆå¸Œè¿æ¥</h3><p>å“ˆå¸Œè¿æ¥æœ¬è´¨ä¸Šæ˜¯ç”¨å“ˆå¸Œç®—æ³•ä»£æ›¿æ’åºç®—æ³•çš„åˆå¹¶æ‰«æè¿æ¥ã€‚é¦–å…ˆï¼Œå¯¹è¾ƒå°çš„ç»“æœé›†ç”¨å“ˆå¸Œç®—æ³•è®¡ç®—å…¶è¿æ¥å­—æ®µï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨ä¸€ä¸ªä¸´æ—¶è¡¨ä¸­ï¼›ç„¶åï¼Œå†æ‰«æå…¶ä»–çš„è¡¨(æˆ–ç´¢å¼•ç‰‡)ï¼Œå¹¶é€šè¿‡(è®¡ç®—å¾—åˆ°çš„)å“ˆå¸Œå€¼å°†æ»¡è¶³æœ¬åœ°è°“è¯æ¡ä»¶çš„æ¯ä¸€è¡Œè®°å½•ä¸ä¸´æ—¶è¡¨ä¸­ç›¸åº”çš„è¡Œè¿›è¡ŒåŒ¹é…ã€‚</p><p>è‹¥ç»“æœè¡Œé›†å·²åœ¨ç´¢å¼•ä¸­æ»¡è¶³äº†æ‰€è¦æ±‚çš„é¡ºåºï¼Œé‚£ä¹ˆåˆå¹¶æ‰«æçš„é€Ÿåº¦å°†æ›´å¿«ã€‚è‹¥åˆå¹¶æ‰«æéœ€è¦è¿›è¡Œæ’åºï¼Œé‚£ä¹ˆå“ˆå¸Œè¿æ¥çš„é€Ÿåº¦å¯èƒ½æ›´å¿«ï¼Œå°¤å…¶æ˜¯å½“å…¶ä¸­ä¸€ä¸ªè¡Œé›†èƒ½å¤Ÿå…¨éƒ¨ç•™åœ¨å†…å­˜ä¸­æ—¶(å¯¹ä¸€ä¸ªå“ˆå¸Œè¡¨è¿›è¡Œä¸€æ¬¡éšæœºè®¿é—®æ‰€èŠ±è´¹çš„CPUæ—¶é—´ï¼Œé€šå¸¸ä¼šæ¯”æ’åºå’Œåˆå¹¶ä¸€è¡Œæ‰€èŠ±è´¹çš„æ—¶é—´å°‘)ã€‚å¦‚æœä¸¤ä¸ªè¡Œé›†å¾ˆå¤§ï¼Œé‚£ä¹ˆå“ˆå¸Œè¡¨ä¼šæ ¹æ®å¯ç”¨å†…å­˜çš„å¤§å°å¯¹å“ˆå¸Œè¡¨è¿›è¡Œåˆ†åŒº(åŒä¸€æ—¶é—´å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªåˆ†åŒº)ï¼Œè€Œå¦å¤–ä¸€ä¸ªè¡Œé›†ä¼šè¢«æ‰«æå¤šæ¬¡ã€‚</p><h2 id="ä¸ºä»€ä¹ˆè¿æ¥çš„æ€§èƒ½è¡¨ç°è¾ƒå·®"><a href="#ä¸ºä»€ä¹ˆè¿æ¥çš„æ€§èƒ½è¡¨ç°è¾ƒå·®" class="headerlink" title="ä¸ºä»€ä¹ˆè¿æ¥çš„æ€§èƒ½è¡¨ç°è¾ƒå·®"></a>ä¸ºä»€ä¹ˆè¿æ¥çš„æ€§èƒ½è¡¨ç°è¾ƒå·®</h2><h3 id="æ¨¡ç³Šçš„ç´¢å¼•è®¾è®¡"><a href="#æ¨¡ç³Šçš„ç´¢å¼•è®¾è®¡" class="headerlink" title="æ¨¡ç³Šçš„ç´¢å¼•è®¾è®¡"></a>æ¨¡ç³Šçš„ç´¢å¼•è®¾è®¡</h3><p>â€œåœ¨è¿æ¥å­—æ®µä¸Šå»ºç´¢å¼•â€æ˜¯æœ€å¤è€çš„ç´¢å¼•å»ºè®®ä¹‹ä¸€ã€‚äº‹å®ä¸Šï¼Œè¿™æ˜¯åŸºäºå»ºè®®çš„ä¸€ä¸ªæ‰©å±• : â€œ<strong>ä¸ºä¸»é”®åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œå¹¶ä¸”ä¸ºæ¯ä¸€ä¸ªå¤–é”®åˆ›å»ºä¸€ä¸ªç”±æ­¤å¤–é”®ä½œä¸ºå‰å¯¼åˆ—çš„ç´¢å¼•</strong>â€ã€‚åœ¨è¿æ¥è°“è¯ä¸Šå»ºç´¢å¼•ä½¿å¾—åµŒå¥—å¾ªç¯ç§°ä¸ºä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆï¼Œä½†åŒ…å«è¿æ¥è°“è¯åˆ—å¹¶ä¸ä¸€å®šèƒ½å¤Ÿæä¾›å®Œå…¨å¯æ¥å—çš„å“åº”æ—¶é—´ã€‚è¿æ¥è°“è¯åˆ—ä¸Šçš„ç´¢å¼•å’Œæœ¬åœ°è°“è¯ä¸Šçš„ç´¢å¼•é€šå¸¸éƒ½éœ€è¦æ˜¯å®½ç´¢å¼•ã€‚è€Œä¸”ï¼Œä¸åŒçš„è¡¨è®¿é—®é¡ºåºå¯èƒ½å¯¼è‡´å®Œå…¨ä¸åŒçš„ç´¢å¼•éœ€æ±‚ã€‚</p><h2 id="ä¸ºå­æŸ¥è¯¢è®¾è®¡ç´¢å¼•"><a href="#ä¸ºå­æŸ¥è¯¢è®¾è®¡ç´¢å¼•" class="headerlink" title="ä¸ºå­æŸ¥è¯¢è®¾è®¡ç´¢å¼•"></a>ä¸ºå­æŸ¥è¯¢è®¾è®¡ç´¢å¼•</h2><p>ä»æ€§èƒ½çš„è§’åº¦çœ‹ï¼Œå­æŸ¥è¯¢ä¸è¿æ¥ååˆ†ç›¸ä¼¼ã€‚<strong>å®é™…ä¸Šï¼Œç°ä»Šçš„ä¼˜åŒ–å™¨é€šå¸¸ä¼šåœ¨è¿›è¡Œè®¿é—®è·¯å¾„çš„é€‰æ‹©ä¹‹å‰ï¼Œå…ˆå°†å­æŸ¥è¯¢é‡å†™ä¸ºä¸€ä¸ªè¿æ¥ã€‚</strong>è‹¥ä¼˜åŒ–å™¨æ²¡æœ‰è¿›è¡Œé‡å†™ï¼Œé‚£ä¹ˆå­æŸ¥è¯¢çš„ç±»å‹æœ¬èº«å¯èƒ½å°±å†³å®šäº†è¡¨è®¿é—®é¡ºåºã€‚å†…å¤–å±‚æ— å…³è”çš„å­æŸ¥è¯¢é€šå¸¸ä¼šä»æœ€å†…å±‚çš„SELECTå¼€å§‹æ‰§è¡Œã€‚ç»“æœé›†è¢«ä¿å­˜åœ¨ä¸€å¼ ä¸´æ—¶è¡¨ä¸­ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªSELECTçš„è®¿é—®ã€‚å†…å¤–å±‚æœ‰å…³è”çš„å­æŸ¥è¯¢é€šå¸¸ä¼šä»æœ€å†…å±‚çš„SELECTå¼€å§‹æ‰§è¡Œã€‚æ— è®ºæ˜¯ä½•ç§æƒ…å†µï¼ŒåŒè¿æ¥ä¸€æ ·ï¼Œåº”å½“åŸºäºèƒ½å¤Ÿå½¢æˆæœ€å¿«è®¿é—®è·¯å¾„çš„è¡¨è®¿é—®é¡ºåºè¿›è¡Œç´¢å¼•è®¾è®¡ã€‚è‹¥æœ€ä½³çš„è¡¨è®¿é—®é¡ºåºæœªè¢«é€‰ä¸­ï¼Œé‚£ä¹ˆç¨‹åºå¼€å‘äººå‘˜å¯èƒ½éœ€è¦å¯¹è¯­å¥è¿›è¡Œé‡å†™ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹è¿˜å¯èƒ½è¦ä½¿ç”¨è¿æ¥ã€‚</p><h2 id="ä¸ºUNIONè¯­å¥è®¾è®¡ç´¢å¼•"><a href="#ä¸ºUNIONè¯­å¥è®¾è®¡ç´¢å¼•" class="headerlink" title="ä¸ºUNIONè¯­å¥è®¾è®¡ç´¢å¼•"></a>ä¸ºUNIONè¯­å¥è®¾è®¡ç´¢å¼•</h2><p>é€šè¿‡UNIONæˆ–UNION ALLè¿æ¥çš„SELECTè¯­å¥æ˜¯é€ä¸ªåˆ†åˆ«è¿›è¡Œä¼˜åŒ–å’ŒæŒ‡å‘çš„ã€‚å› æ­¤ï¼Œåº”è¯¥ä¸ºæ¯ä¸ªç‹¬ç«‹çš„SELECTè®¾è®¡åˆé€‚çš„ç´¢å¼•ã€‚éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¸¦ORDER BYçš„UNIONå¯èƒ½ä¼šå¯¼è‡´æå‰ç‰©åŒ–ã€‚</p><h2 id="å¯¹äºè¡¨è®¾è®¡çš„æ€è€ƒ"><a href="#å¯¹äºè¡¨è®¾è®¡çš„æ€è€ƒ" class="headerlink" title="å¯¹äºè¡¨è®¾è®¡çš„æ€è€ƒ"></a>å¯¹äºè¡¨è®¾è®¡çš„æ€è€ƒ</h2><h3 id="å†—ä½™æ•°æ®"><a href="#å†—ä½™æ•°æ®" class="headerlink" title="å†—ä½™æ•°æ®"></a>å†—ä½™æ•°æ®</h3><p>æœ‰ä¸¤ç§é€šè¿‡å†—ä½™æ•°æ®ä¼˜åŒ–è¿æ¥é€Ÿåº¦çš„æ–¹æ³•ï¼š</p><ol><li>å°†æŸåˆ—æ‹·è´è‡³ä¾èµ–è¡¨(å‘ä¸‹åèŒƒå¼æ³•)ã€‚</li><li>å°†æ±‡æ€»æ•°æ®æ·»åŠ è‡³çˆ¶è¡¨(å‘ä¸ŠåèŒƒå¼æ³•)ã€‚</li></ol><h3 id="å‘ä¸‹åèŒƒå¼åŒ–"><a href="#å‘ä¸‹åèŒƒå¼åŒ–" class="headerlink" title="å‘ä¸‹åèŒƒå¼åŒ–"></a>å‘ä¸‹åèŒƒå¼åŒ–</h3><p>ä¸è¿‡ï¼Œæ€»ä½“è€Œè¨€ï¼Œå½“æˆ‘ä»¬è€ƒè™‘å¼•å…¥å‘ä¸‹åèŒƒå¼åŒ–æ—¶ï¼Œéœ€è¦é¢„æµ‹ä¸€ä¸‹å†—ä½™å­—æ®µæ›´æ–°æ—¶å¯èƒ½ä¼šå¯¼è‡´æœ€å·®æƒ…å†µä¸‹çš„ç´¢å¼•éšæœºè®¿é—®æ¬¡æ•°ã€‚</p><h3 id="åèŒƒå¼åŒ–çš„æˆæœ¬"><a href="#åèŒƒå¼åŒ–çš„æˆæœ¬" class="headerlink" title="åèŒƒå¼åŒ–çš„æˆæœ¬"></a>åèŒƒå¼åŒ–çš„æˆæœ¬</h3><p>è€ƒè™‘æ€§èƒ½æ—¶æœ€ä»¤äººå…³æ³¨çš„é€šå¸¸æ˜¯ï¼Œä¸ºäº†æ›´æ–°è¡¨åŠç´¢å¼•ä¸Šçš„å†—ä½™å­—æ®µé”å¸¦æ¥çš„I/Oæ—¶é—´ã€‚åœ¨å‘ä¸‹åèŒƒå¼åŒ–ä¸­ï¼Œè¿™å¯èƒ½éœ€è¦ç§»åŠ¨å¤§é‡çš„ç´¢å¼•è¡Œï¼Œä»è€Œå¯¼è‡´ä¸€ä¸ªç®€å•çš„UPDATEè¿è¡Œçš„å¾ˆæ…¢ã€‚å‘ä¸ŠåèŒƒå¼åŒ–ä¸å¤ªå¯èƒ½å› ä¸ºä¸€æ¬¡ç®€å•çš„æ›´æ–°æ“ä½œè€Œå¼•å‘I/Oå‰§å¢ã€‚ä¸è¿‡INSERTï¼ŒUPDATEå’ŒDELETEå¯èƒ½å¯¼è‡´çˆ¶è¡¨åŠå…¶ç´¢å¼•ä¸Šçš„ä¸€äº›é¢å¤–I/Oã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¦‚æ¯ç§’10æ¬¡ä»¥ä¸Šçš„INSERTæˆ–UPDATEï¼Œç”±è¿™äº›I/Oå¸¦æ¥çš„ç£ç›˜è´Ÿè½½å¯èƒ½ä¼šæˆä¸ºé—®é¢˜ã€‚</p><h2 id="åµŒå¥—å¾ªç¯è¿æ¥å’Œåˆå¹¶æ‰«æè¿æ¥-å“ˆå¸Œè¿æ¥-VS-åèŒƒå¼åŒ–"><a href="#åµŒå¥—å¾ªç¯è¿æ¥å’Œåˆå¹¶æ‰«æè¿æ¥-å“ˆå¸Œè¿æ¥-VS-åèŒƒå¼åŒ–" class="headerlink" title="åµŒå¥—å¾ªç¯è¿æ¥å’Œåˆå¹¶æ‰«æè¿æ¥/å“ˆå¸Œè¿æ¥ VS åèŒƒå¼åŒ–"></a>åµŒå¥—å¾ªç¯è¿æ¥å’Œåˆå¹¶æ‰«æè¿æ¥/å“ˆå¸Œè¿æ¥ VS åèŒƒå¼åŒ–</h2><p>è®¸å¤šæ•°æ®åº“ä¸“å®¶ä¸æ„¿æ„å°†å†—ä½™åˆ—æ·»åŠ è‡³äº‹åŠ¡å‹è¡¨ä¸Šï¼Œè¿™æ˜¯å¯ä»¥ç†è§£çš„ã€‚åèŒƒå¼åŒ–ä¸ä»…ä»…æ˜¯æŸ¥è¯¢é€Ÿåº¦å’Œæ›´æ–°é€Ÿåº¦ä¹‹é—´çš„ä¸€ä¸ªæƒè¡¡ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œä»–è¿˜æ˜¯æ€§èƒ½å’Œæ•°æ®å®Œæ•´æ€§ä¹‹é—´çš„ä¸€ä¸ªæƒè¡¡ï¼Œå³ä½¿åœ¨ä½¿ç”¨è§¦å‘å™¨æ¥ç»´æŠ¤å†—ä½™æ•°æ®çš„æƒ…å†µä¸‹ã€‚ç„¶è€Œï¼Œå½“åµŒå¥—å¾ªç¯å¼•å…¥äº†è¿‡å¤šçš„éšæœºè®¿é—®ï¼Œä¸”MS/HJè€—è´¹äº†è¿‡å¤šçš„CPUæ—¶é—´æ—¶ï¼ŒåèŒƒå¼åŒ–å¯èƒ½æˆä¸ºå”¯ä¸€çš„é€‰æ‹©ã€‚å°½ç®¡å¦‚æ­¤ï¼Œåœ¨å†³å®šé‡‡ç”¨è¿™ä¸€æç«¯çš„æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿æ‰€æœ‰èƒ½å¤Ÿé¿å…è¿™ä¸€æ–¹æ¡ˆçš„æ–¹æ³•éƒ½å·²ç»è€ƒè™‘è¿‡äº†ã€‚</p><h2 id="æ— æ„è¯†çš„è¡¨è®¾è®¡"><a href="#æ— æ„è¯†çš„è¡¨è®¾è®¡" class="headerlink" title="æ— æ„è¯†çš„è¡¨è®¾è®¡"></a>æ— æ„è¯†çš„è¡¨è®¾è®¡</h2><p>ä»æ€§èƒ½çš„è§’åº¦çœ‹ï¼Œæˆ‘ä»¬éå¸¸éš¾ä»¥ç†è§£ä¸ºä½•æœ‰é‚£ä¹ˆå¤šçš„æ•°æ®åº“ä¸­å­˜åœ¨å…·æœ‰1 : 1æˆ–1: C(C = æœ‰æ¡ä»¶çš„;å³0æˆ–1)å…³ç³»çš„è¡¨ã€‚</p><p>ä¸ºä½•è¦å»ºå››å¼ è¡¨è€Œéåªå»ºä¸€å¼ CUSTè¡¨ï¼Ÿåªè¦å…³ç³»æ°¸è¿œä¸ä¼šå˜æˆ1 : Mï¼Œé‚£ä¹ˆçµæ´»æ€§å°±ä¸ä¼šæˆä¸ºé—®é¢˜ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®¢æˆ·è¦ä¹ˆæ˜¯å…¬å¸ï¼Œè¦ä¹ˆæ˜¯ä¸ªäººï¼Œä¸”ä¸ä¼šæœ‰å®¢æˆ·æ­»äº¡ä¸¤æ¬¡!</p><p>å°†è¿™å››å¼ è¡¨åˆæˆä¸€å¼ éƒ¨åˆ†å­—æ®µä¸ºç©ºçš„è¡¨(å¯¹äºæ¯ä¸€è¡Œï¼Œè¦ä¹ˆå…¬å¸ç›¸å…³çš„å­—æ®µä¸ºç©ºï¼Œè¦ä¹ˆä¸ªäººç›¸å…³çš„å­—æ®µä¸ºç©ºï¼›åŒæ ·ï¼Œæ‰€æœ‰æ´»ç€çš„å®¢æˆ·çš„æ­»äº¡ç›¸å…³çš„å­—æ®µä¸ºç©º)ï¼Œè¿™æ˜¯å­˜å‚¨ç©ºé—´å’Œæ€§èƒ½(éšæœºè®¿é—®çš„æ¬¡æ•°)ä¹‹é—´çš„æƒè¡¡ã€‚ä¸ºç©ºçš„æ•°æ®å¹¶ä¸è¿åèŒƒå¼ã€‚</p><p>åœ¨ä¸è€ƒè™‘ç¡¬ä»¶æ€§èƒ½çš„æƒ…å†µä¸‹è®¾è®¡è¡¨å¯èƒ½ä¼šæœ‰å¦‚ä¸‹é—®é¢˜ :</p><ul><li>å³ä¾¿æ˜¯åœ¨æœ€ä½³ç´¢å¼•æ¡ä»¶ä¸‹ï¼Œéšæœºè®¿é—®çš„æ¬¡æ•°ä»å¯èƒ½ä¼šå¾ˆé«˜ã€‚</li><li>å¤æ‚è¿æ¥å¯èƒ½ä½¿å¾—ç´¢å¼•è®¾è®¡å˜å¾—éå¸¸å›°éš¾ã€‚</li><li>ä¼˜åŒ–å™¨å¯èƒ½å¯¹å¤æ‚è¿æ¥åšå‡ºé”™è¯¯çš„è®¿é—®è·¯å¾„é€‰æ‹©ã€‚</li></ul><h1 id="æ˜Ÿå‹è¿æ¥"><a href="#æ˜Ÿå‹è¿æ¥" class="headerlink" title="æ˜Ÿå‹è¿æ¥"></a>æ˜Ÿå‹è¿æ¥</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>æ˜Ÿå‹è¿æ¥ä¸æ™®é€šè¿æ¥çš„å·®åˆ«ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹é¢ï¼š</p><ol><li>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä½äºæ˜Ÿå‹ç»“æ„ä¸­å¿ƒä½ç½®çš„è¡¨ç§°ä¸º<strong>äº‹å®è¡¨</strong>ï¼Œå®ƒçš„æ•°æ®é‡è¿œå¤§äºå®ƒå‘¨å›´çš„è¡¨â€”<strong>ç»´åº¦è¡¨</strong>ã€‚</li><li>æœ€ä½³çš„è®¿é—®è·¯å¾„é€šå¸¸æ˜¯åŒ…å«ç»´åº¦è¡¨çš„<strong>ç¬›å¡å°”ç§¯</strong>ï¼Œè¿™æ„å‘³ç€ä»–ä»¬<strong>æ²¡æœ‰ç›¸åŒçš„å†—ä½™åˆ—</strong>ï¼Œæ»¡è¶³æœ¬åœ°è°“è¯çš„ç»´åº¦è¡¨æ•°æ®è¡Œéƒ½ä¼šå‚ä¸è¿æ¥ã€‚</li></ol><p><img alt data-src="/images/database-index-design-optimizers/%E6%98%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F.png"></p><p>SALES é”€å”®è®°å½•<br>STORE å‡ºå”®çš„åº—é“º<br>ITEM  å‡ºå”®çš„å•†å“<br>DATE  å‡ºå”®çš„æ—¶é—´<br>CUST  å‡ºå”®çš„å®¢æˆ·</p><p>åœ¨æ˜Ÿå‹è¿æ¥ä¸­ï¼Œäº‹å®è¡¨çš„æ•°æ®é‡é€šè¿‡éƒ½æ¯”è¾ƒå¤§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‡³å°‘ä¾æ®ç»éªŒæ³•åˆ™ï¼Œäº‹å®è¡¨åº”è¯¥ä½œä¸ºåµŒå¥—å¾ªç¯è¿æ¥æ–¹å¼ä¸­æœ€å†…å±‚çš„è¡¨ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æœªè¯»è¡¨éƒ½æ²¡æœ‰å…±åŒçš„åˆ—ï¼Œæ‰€ä»¥è¿™ç§é“¾æ¥é¡ºåºæ„å‘³ç€æ˜¯ç¬›å¡å°”è¿æ¥ã€‚</p><h2 id="äº‹å®è¡¨çš„ç´¢å¼•"><a href="#äº‹å®è¡¨çš„ç´¢å¼•" class="headerlink" title="äº‹å®è¡¨çš„ç´¢å¼•"></a>äº‹å®è¡¨çš„ç´¢å¼•</h2><p>äº‹å®ä¸Šï¼Œå®½ç´¢å¼•é€šå¸¸æ¯”äº‹å®è¡¨è¿˜å¤§ï¼ŒåŸå› æœ‰ä¸¤ä¸ª :</p><ol><li>è¡¨é€šå¸¸éƒ½è¿›è¡Œäº†å‹ç¼©å¤„ç†ï¼Œè€Œç´¢å¼•æ²¡æœ‰ã€‚</li><li>æ–°å¢ä¸€æ¡è®°å½•é€šå¸¸éƒ½è¿½åŠ åˆ°è¡¨çš„å°¾éƒ¨ï¼Œå› æ­¤äº‹å®è¡¨å¹¶ä¸éœ€è¦åˆ†æ•£çš„ç©ºé—²ç©ºé—´ã€‚ä½†æ’å…¥åˆ°ç´¢å¼•(é™¤äº†èšç°‡ç´¢å¼•)ä¸Šçš„ä½ç½®æ˜¯éšæœºçš„ã€‚ä¸ºäº†é¿å…é¢‘ç¹çš„ç´¢å¼•é‡ç»„ï¼Œåœ¨å½“å‰ç¡¬ä»¶æ¡ä»¶ä¸‹ï¼Œé€šå¸¸10äº¿è¡Œçš„è¡¨å°†èŠ±è´¹å‡ ä¸ªå°æ—¶ï¼Œå¤§å¤šæ•°çš„ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹ä¸Šéƒ½éœ€è¦ç•™å‡ºè¶³å¤Ÿçš„ç©ºé—²ç©ºé—´ï¼Œå¯èƒ½ä¸º30% ~ 40%ã€‚</li></ol><h2 id="æ±‡æ€»è¡¨"><a href="#æ±‡æ€»è¡¨" class="headerlink" title="æ±‡æ€»è¡¨"></a>æ±‡æ€»è¡¨</h2><p>å³ä½¿æ˜¯åœ¨ç†æƒ³ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œä¸€äº›é’ˆå¯¹10äº¿æ¡è®°å½•çš„äº‹å®è¡¨è¿›è¡Œçš„æŸ¥è¯¢ä¹Ÿä¼šå¯¼è‡´å¤§é‡çš„I/Oè®¿é—®ã€‚æé«˜è¿™ç±»æŸ¥è¯¢çš„æ€§èƒ½çš„å”¯ä¸€æ–¹å¼å°±æ˜¯ä½¿ç”¨æ±‡æ€»è¡¨(æŸ¥è¯¢è¡¨)ã€‚è¿™ç±»è¡¨æ˜¯åèŒƒå¼åŒ–çš„äº‹å®è¡¨ã€‚å¦‚æœè¡¨ä¸æ˜¯ç‰¹åˆ«å¤§(æ¯”å¦‚åªåŒ…å«å‡ ç™¾ä¸‡è¡Œæ•°æ®)ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¯è¡Œçš„æ–¹æ¡ˆï¼Œå› ä¸ºåæ¨¡å¼åŒ–æŸ¥è¯¢åªéœ€é’ˆå¯¹æ±‡æ€»è¡¨ï¼Œè€Œä¸éœ€è¦å¤šè¡¨å…³è”ã€‚</p><p>å¦‚æœé¢‘ç¹æŸ¥è¯¢æ¯å‘¨çš„é”€å”®æƒ…å†µï¼Œé‚£ä¹ˆå¯ä»¥é’ˆå¯¹æ¯å‘¨çš„æ¶ˆè´¹è®°å½•å»ºç«‹ä¸€å¼ æ±‡æ€»è¡¨ã€‚æ¯”è¾ƒå¥½çš„æ±‡æ€»è¡¨è®¾è®¡æ˜¯æ ¹æ®å‘¨ï¼Œå•†å“ï¼Œå•†åº—æ±‡æ€»ä¸€æ¡è®°å½•ã€‚æ±‡æ€»è¡¨æ ¹æ®å‘¨å’Œå•†å“è¿›è¡Œæ±‡æ€»åï¼Œæ•°æ®é‡å¯ä»¥å¤§å¹…åº¦å‡å°‘ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢çš„å“åº”æ—¶é—´å¯èƒ½é™ä½åˆ°ä¸åˆ°1ç§’é’Ÿã€‚</p><p>æ±‡æ€»è¡¨ä¸Šçš„ç´¢å¼•é€šå¸¸ä¼šæ¯”è¾ƒå°ï¼Œä»–å”¯ä¸€çš„æ˜¾ç¤ºå› ç´ å°±æ˜¯åˆ·æ–°æ­¤è¡¨æ‰€éœ€çš„æ—¶é—´ã€‚å¦‚åŒæ‰€æœ‰æ–°é²œäº‹ç‰©ä¸€æ ·ï¼Œæ±‡æ€»è¡¨çš„æ–¹æ¡ˆä¹Ÿä¼šå¸¦æ¥æ–°çš„é—®é¢˜ã€‚</p><ol><li>å¦‚æœç”¨æˆ·çš„æŸ¥è¯¢éœ€æ±‚å¤šæ ·ï¼Œæ±‡æ€»è¡¨çš„è®¾è®¡ä¼šæ¯”ç´¢å¼•çš„è®¾è®¡æ›´å›°éš¾ï¼Œä¸è¿‡ï¼Œå·²ç»æœ‰ä¸€äº›å·¥å…·åŸºäºæŸ¥è¯¢æ—¥å¿—æ¥ååŠ©æ±‡æ€»è¡¨çš„è®¾è®¡ã€‚</li><li>å¦‚æœä¼˜åŒ–å™¨ä¸èƒ½é€‰æ‹©æ­£ç¡®çš„æ±‡æ€»è¡¨ï¼Œé‚£ä¹ˆæ±‡æ€»è¡¨çš„æ„ä¹‰å°±ä¸å¤§ï¼›æˆ‘ä»¬ä¸èƒ½æŒ‡æœ›ç”¨æˆ·æ¥æŒ‡å®šæŸ¥è¯¢ä½¿ç”¨æŸä¸ªåˆé€‚çš„æ±‡æ€»è¡¨ã€‚æœ€å¥½çš„ä¼˜åŒ–å™¨å·²ç»åœ¨è¯•ç€è®¿é—®åˆé€‚çš„è¡¨äº†ï¼Œè™½ç„¶SELECTè¯­å¥å®é™…ä¸ŠæŸ¥è¯¢çš„æ˜¯äº‹å®è¡¨ã€‚å¦‚æœä¼˜åŒ–å™¨ä¸å…·å¤‡è¿™ä¸ªèƒ½åŠ›ï¼Œæˆ–è€…å®ƒçš„æ­£ç¡®ç‡ä¸å¤Ÿé«˜ï¼Œé‚£ä¹ˆå¯èƒ½å°±ä¸å¾—ä¸å¼ºåˆ¶æŒ‡å®šæ¯ä¸ªç”¨æˆ·åªèƒ½è®¿é—®ä¸€ä¸ªæ±‡æ€»è¡¨ã€‚ç”¨æˆ·ä¸å¾—ä¸è‡ªå·±é€‰æ‹©è¦ä½¿ç”¨çš„æ±‡æ€»è¡¨ã€‚ä¼˜åŒ–å™¨èƒ½è‡ªåŠ¨è¯†åˆ«çš„æ±‡æ€»è¡¨é€šå¸¸è¢«ç§°ä¸ºè‡ªåŠ¨æ±‡æ€»è¡¨æˆ–ç‰©åŒ–è§†å›¾ã€‚</li></ol><h1 id="å¤šç´¢å¼•è®¿é—®"><a href="#å¤šç´¢å¼•è®¿é—®" class="headerlink" title="å¤šç´¢å¼•è®¿é—®"></a>å¤šç´¢å¼•è®¿é—®</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>è®¸å¤šæ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ”¯æŒä»ä¸€å¼ è¡¨çš„å¤šä¸ªç´¢å¼•å¤„æ”¶é›†åˆ¶ä½œï¼Œæˆ–æ˜¯ä»å•ä¸ªç´¢å¼•çš„å‡ ä¸ªç´¢å¼•ç‰‡æ”¶é›†ï¼Œç„¶åæ¯”è¾ƒè¿™äº›æŒ‡é’ˆé›†å¹¶è®¿é—®æ»¡è¶³WHEREè¯­å¥ä¸­æ‰€æœ‰è°“è¯æ¡ä»¶çš„æ•°æ®è¡Œã€‚è¿™ä¸€èƒ½åŠ›è¢«ç§°ä¸ºå¤šç´¢å¼•è®¿é—®ï¼Œæˆ–è¢«ç§°ä¸ºç´¢å¼•ä¸(ç´¢å¼•äº¤é›†)å’Œç´¢å¼•æˆ–(ç´¢å¼•å¹¶é›†)ã€‚</p><blockquote><p>å¤šç´¢å¼•è®¿é—®çš„æ€æƒ³æ˜¯ï¼šå¯¹è¡¨ä¸­æ•°æ®åˆ†åˆ«ä½¿ç”¨å„ä¸ªç´¢å¼•ï¼Œæœ€åå°†æ»¡è¶³æ¡ä»¶çš„è¿›è¡Œäº¤é›†æˆ–å¹¶é›†æ“ä½œã€‚</p></blockquote><h1 id="ç´¢å¼•å’Œç´¢å¼•é‡ç»„"><a href="#ç´¢å¼•å’Œç´¢å¼•é‡ç»„" class="headerlink" title="ç´¢å¼•å’Œç´¢å¼•é‡ç»„"></a>ç´¢å¼•å’Œç´¢å¼•é‡ç»„</h1><h2 id="DBMSå¦‚ä½•æŸ¥æ‰¾ç´¢å¼•è¡Œ"><a href="#DBMSå¦‚ä½•æŸ¥æ‰¾ç´¢å¼•è¡Œ" class="headerlink" title="DBMSå¦‚ä½•æŸ¥æ‰¾ç´¢å¼•è¡Œ"></a>DBMSå¦‚ä½•æŸ¥æ‰¾ç´¢å¼•è¡Œ</h2><p><font color="DeepPink">åœ¨å½“å‰çš„ç¡¬ä»¶æ¡ä»¶ä¸‹ï¼Œéå¶å­é¡µå¾ˆå¯èƒ½å·²ç»è¢«ç¼“å­˜åœ¨æ•°æ®åº“ç¼“å†²æ± ä¸­ï¼Œæˆ–è€…è‡³å°‘åœ¨ç£ç›˜çš„è¯»ç¼“å­˜ä¸­ï¼Œå› ä¸ºå®ƒä»¬ç»å¸¸è¢«é¢‘ç¹çš„è®¿é—®ã€‚</font></p><h2 id="æ’å…¥ä¸€è¡Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ"><a href="#æ’å…¥ä¸€è¡Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ’å…¥ä¸€è¡Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ"></a>æ’å…¥ä¸€è¡Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h2><p>å¦‚æœä¸€å¼ è¡¨æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œé‚£ä¹ˆDBMSä¼šæ ¹æ®èšç°‡ç´¢å¼•çš„é”®å€¼å°è¯•å°†æ’å…¥çš„è®°å½•æ”¾åœ¨å®ƒæ‰€å±çš„è¡¨é¡µ(ä¸»é¡µ)ä¸­ã€‚å¦‚æœè¿™è¡Œè®°å½•åœ¨ä¸»é¡µé‡Œæ”¾ä¸ä¸‹ï¼Œæˆ–è€…å½“å‰é¡µè¢«é”ä½ï¼Œé‚£ä¹ˆDBMSå°†ä¼šæ£€æŸ¥é‚»è¿‘çš„é¡µã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œæ–°çš„è¡Œä¼šè¢«æ’å…¥åˆ°æ ‡çš„æœ€åä¸€é¡µã€‚<font color="DeepPink">ä¾èµ–äºDBMSå’Œè¡¨çš„ç±»å‹ï¼Œå·²ç»æ’å…¥çš„è¡Œé€šå¸¸éƒ½ä¸ä¼šè¢«ç§»åŠ¨ï¼Œå¦åˆ™è¿™å°†æ„å‘³ç€æ›´æ–°è¡¨ä¸Šå·²ç»å»ºç«‹çš„æ‰€æœ‰ç´¢å¼•ä¸Šçš„ç›¸å…³æŒ‡é’ˆã€‚</font>å½“æœ‰è®¸å¤šè¡¨è¡Œæœªèƒ½å­˜åœ¨åœ¨ä¸»é¡µä¸­æ—¶ï¼Œå¦‚æœè¡¨è¡Œçš„é¡ºåºå¾ˆé‡è¦ï¼Œåˆ™éœ€è¦å¯¹è¿™ä¸ªè¡¨è¿›è¡Œé‡ç»„â€”å¯¹äºé‚£äº›æ¶‰åŠå¤šå¼ å¤§è¡¨çš„å¤§è§„æ¨¡æ‰¹å¤„ç†ä»»åŠ¡è€Œè¨€ï¼Œé€šå¸¸éœ€è¦è¿™ä¹ˆåšã€‚</p><p>å½“å¾€è¡¨ä¸­æ’å…¥ä¸€æ¡è®°å½•æ—¶ï¼ŒDBMSä¼šå°è¯•å°†ç´¢å¼•è¡Œæ·»åŠ è‡³å…¶ç´¢å¼•å»ºæ‰€å±çš„å¶å­é¡µä¸Šï¼Œä½†æ˜¯è¯¥ç´¢å¼•é¡µå¯èƒ½æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—²ç©ºé—´æ¥å­˜æ”¾è¿™ä¸ªç´¢å¼•è¡Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒDBMSå°†ä¼šåˆ†è£‚è¯¥å¶å­é¡µã€‚å…¶ä¸­ä¸€åŠçš„è¡Œå°†è¢«ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°çš„å¶å­é¡µä¸Šï¼Œå¹¶å°½å¯èƒ½åœ°é è¿‘è¢«åˆ†è£‚çš„é¡µï¼Œä½†æ˜¯åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªç´¢å¼•é¡µå¯èƒ½ä¼šè¢«æ”¾ç½®åœ¨ç´¢å¼•çš„æœ«å°¾ã€‚é™¤äº†åœ¨æ¯ä¸ªå¶å­é¡µä¸Šé¢„ç•™éƒ¨åˆ†æ¯”ä¾‹çš„ç©ºé—²ç©ºé—´å¤–ï¼Œä¹Ÿè®¸å¯ä»¥åœ¨ç´¢å¼•è¢«åˆ›å»ºæˆ–é‡ç»„æ—¶ï¼Œæ¯nä¸ªé¡µé¢é¢„ç•™ä¸€ä¸ªç©ºé¡µâ€”å½“ç´¢å¼•åˆ†è£‚æ— æ³•é¿å…æ—¶ï¼Œè¿™ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„åŠæ³•ã€‚</p><p><font color="DeepPink">å½“ä¸€ä¸ªç´¢å¼•æœ‰ä¸€ä¸ªä¸æ–­å¢é•¿çš„é”®å€¼æ—¶ï¼Œæ–°è¡Œå°†è¢«æ·»åŠ åˆ°ç´¢å¼•é¡µçš„æœ€åï¼Œç´¢å¼•é¡µå¯èƒ½æ°¸è¿œä¹Ÿä¸ä¼šè¿›è¡Œåˆ†è£‚,è¿™æ ·çš„ç´¢å¼•å¯èƒ½ä¸éœ€è¦ä»»ä½•ç©ºé—²ç©ºé—´ã€‚</font></p><h2 id="å¶å­é¡µçš„åˆ†è£‚ä¸¥é‡å—ï¼Ÿ"><a href="#å¶å­é¡µçš„åˆ†è£‚ä¸¥é‡å—ï¼Ÿ" class="headerlink" title="å¶å­é¡µçš„åˆ†è£‚ä¸¥é‡å—ï¼Ÿ"></a>å¶å­é¡µçš„åˆ†è£‚ä¸¥é‡å—ï¼Ÿ</h2><p>åˆ†è£‚ä¸€ä¸ªç´¢å¼•é¡µåªéœ€ä¸€æ¬¡é¢å¤–çš„åŒæ­¥è¯»ï¼Œçº¦10msã€‚é™¤äº†ä¸¤ä¸ªå¶å­é¡µä»¥å¤–ï¼ŒDBMSé€šå¸¸è¿˜å¿…é¡»æ›´æ–°ä¸€ä¸ªéå¶å­é¡µï¼Œè€Œå®ƒå¾ˆå¯èƒ½å·²ç»åœ¨å†…å­˜æˆ–è€…è¯»ç¼“å­˜ä¸­äº†ã€‚</p><p>åœ¨å¶å­é¡µåˆ†è£‚åï¼ŒæŸ¥è¯¢ä»»ä½•ä¸€æ¡ç´¢å¼•è¡Œçš„é€Ÿåº¦å¾ˆå¯èƒ½åŒä¹‹å‰ä¸€æ ·å¿«ã€‚åœ¨æœ€åæƒ…å†µä¸‹ï¼Œä¸€æ¬¡åˆ†è£‚ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•å±‚çº§ï¼Œä½†æ˜¯å¦‚æœä¸æ˜¯ä»ç£ç›˜è¯»å–éå¶å­é¡µçš„è¯ï¼Œè¿™åªä¼šå¢åŠ å¾ˆå°‘çš„CPUæ—¶é—´ã€‚</p><p>ç„¶è€Œï¼Œå¶å­é¡µçš„åˆ†è£‚ä¼šå¯¼è‡´ä¸€ä¸ªç´¢å¼•ç‰‡å˜å¾—æ›´æ…¢ã€‚ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åœ¨æ‰€æœ‰çš„åœºæ™¯ä¸­éƒ½å‡è®¾ä¸²è”ç´¢å¼•è¡Œçš„é“¾æŒ‡é’ˆæ€»æ˜¯æŒ‡å‘åŒä¸€é¡µæˆ–è€…ä¸‹ä¸€é¡µï¼Œè¿™äº›é¡µå¯èƒ½å·²è¢«DBMSé¢„è¯»å–ã€‚åœ¨ç´¢å¼•è¢«åˆ›å»ºæˆ–è€…é‡ç»„åï¼Œè¿™ç§å‡è®¾æ˜¯æ¥è¿‘çœŸå®æƒ…å†µçš„ï¼Œä½†æ˜¯ç´¢å¼•ç‰‡ä¸Šçš„æ¯å¤„å¶å­é¡µåˆ†è£‚éƒ½å¯èƒ½ä¼šå¢åŠ é¢å¤–çš„ä¸¤æ¬¡éšæœºè®¿é—®â€”ä¸€æ¬¡æ˜¯ä¸ºäº†æŸ¥æ‰¾ç´¢å¼•è¡Œè¢«ç§»åŠ¨è‡³çš„ç´¢å¼•é¡µï¼Œä¸€æ¬¡æ˜¯ä¸ºäº†è¿”å›åˆ°æ‰«æçš„åŸå§‹ä½ç½®ã€‚å…¶ä¸­ç¬¬ä¸€æ¬¡éšæœºè®¿é—®å¾ˆå¯èƒ½ä¼šå¯¼è‡´ä¸€æ¬¡ç£ç›˜çš„éšæœºè¯»å–(10ms)ã€‚</p><h2 id="ä»€ä¹ˆæ—¶å€™åº”è¯¥å¯¹ç´¢å¼•è¿›è¡Œé‡ç»„ï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™åº”è¯¥å¯¹ç´¢å¼•è¿›è¡Œé‡ç»„ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™åº”è¯¥å¯¹ç´¢å¼•è¿›è¡Œé‡ç»„ï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™åº”è¯¥å¯¹ç´¢å¼•è¿›è¡Œé‡ç»„ï¼Ÿ</h2><h3 id="æ’å…¥æ¨¡å¼"><a href="#æ’å…¥æ¨¡å¼" class="headerlink" title="æ’å…¥æ¨¡å¼"></a>æ’å…¥æ¨¡å¼</h3><p>ç´¢å¼•é‡ç»„æ˜¯ä¸ºäº†æ¢å¤ç´¢å¼•è¡Œæ­£ç¡®çš„ç‰©ç†ä½ç½®ï¼Œä»–å¯¹äºç´¢å¼•ç‰‡æ‰«æå’Œå…¨ç´¢å¼•æ‰«æçš„æ€§èƒ½è€Œè¨€å¾ˆé‡è¦ã€‚å› ä¸ºæ’å…¥æ¨¡å¼çš„ä¸åŒï¼Œå¢åŠ çš„ç´¢å¼•è¡Œå¯èƒ½ä¼šä»¥æ— åºçš„æ–¹å¼æ¥åˆ›å»ºã€‚æˆ‘ä»¬éœ€è¦è®°ä½ï¼Œæ›´æ–°ä¸€ä¸ªåˆ—æ„å‘³ç€éœ€è¦åˆ é™¤æ—§çš„ç´¢å¼•è¡Œï¼Œå¹¶å¢åŠ ä¸€ä¸ªæ–°çš„ç´¢å¼•è¡Œï¼Œæ–°ç´¢å¼•è¡Œçš„ä½ç½®ç”±æ–°çš„ç´¢å¼•é”®å€¼æ¥ç¡®å®šã€‚</p><p>ä¸‹æ–‡å¯¹ä¸‰ç§åŸºæœ¬æ’å…¥æ¨¡å¼çš„è®¨è®ºåŸºäºå¦‚ä¸‹å‡è®¾</p><ol><li>ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•ã€‚</li><li>è¢«åˆ é™¤çš„ç´¢å¼•è¡Œé”è…¾å‡ºçš„ç©ºé—´åœ¨é‡ç»„ä¹‹å‰å¯ä»¥è¢«æ–°çš„ç´¢å¼•è¡Œé‡ç”¨ã€‚</li></ol><h3 id="æ–°ç´¢å¼•è¡Œè¢«æ·»åŠ è‡³ç´¢å¼•çš„å°¾éƒ¨-æ°¸è¿œé€’å¢çš„é”®"><a href="#æ–°ç´¢å¼•è¡Œè¢«æ·»åŠ è‡³ç´¢å¼•çš„å°¾éƒ¨-æ°¸è¿œé€’å¢çš„é”®" class="headerlink" title="æ–°ç´¢å¼•è¡Œè¢«æ·»åŠ è‡³ç´¢å¼•çš„å°¾éƒ¨(æ°¸è¿œé€’å¢çš„é”®)"></a>æ–°ç´¢å¼•è¡Œè¢«æ·»åŠ è‡³ç´¢å¼•çš„å°¾éƒ¨(æ°¸è¿œé€’å¢çš„é”®)</h3><p>å‡è®¾æ’å…¥äº†ä¸€ä¸ªç´¢å¼•è¡Œï¼Œå…¶ç´¢å¼•é”®å€¼æ¯”ä»»ä½•å·²ç»å­˜åœ¨çš„ç´¢å¼•é”®å€¼éƒ½è¦å¤§ï¼Œåˆ™DBMSå°±ä¸ä¼šåˆ†ç±»æœ€åçš„å¶å­é¡µï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ç©ºé—²çš„ç©ºé—´æˆ–è€…è¿›è¡Œç´¢å¼•é‡ç»„äº†ã€‚ç„¶è€Œï¼Œå¦‚æœåœ¨ç´¢å¼•å‰é¢çš„ç´¢å¼•è¡Œè¢«å®šæœŸåœ°åˆ é™¤ï¼Œé‚£ä¹ˆä¸ºäº†å›æ”¶ç©ºé—²çš„ç©ºé—´ï¼Œç´¢å¼•å¯èƒ½ä¸å¾—ä¸è¿›è¡Œé‡ç»„(ä¸€ä¸ªâ€œçˆ¬è¡Œâ€çš„ç´¢å¼•)ã€‚</p><h3 id="éšæœºæ’å…¥æ¨¡å¼"><a href="#éšæœºæ’å…¥æ¨¡å¼" class="headerlink" title="éšæœºæ’å…¥æ¨¡å¼"></a>éšæœºæ’å…¥æ¨¡å¼</h3><p>æˆ‘ä»¬ç¨åå°†ä¼šçœ‹åˆ°ï¼Œå°½ç®¡è€ƒè™‘äº†ç©ºé—²ç©ºé—´å’Œé‡ç»„ï¼Œå¯¹äºä¸åŒçš„ç´¢å¼•è¡Œé•¿åº¦(çŸ­ï¼Œä¸­ï¼Œé•¿)çš„å¤„ç†ä¹Ÿæ˜¯ä¸åŒçš„ã€‚è¶Šé•¿çš„ç´¢å¼•è¡Œè¶Šéš¾å¤„ç†ï¼Œè¶ŠçŸ­çš„è¶Šå¥½å¤„ç†ã€‚</p><p>æœ‰ä¸€ä¸ªé‡è¦çš„ä¾‹å¤–åœºæ™¯ : å¦‚æœç´¢å¼•è¡Œæ˜¯å˜é•¿çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦æœ‰ç©ºé—²çš„ç©ºé—´å»é€‚åº”ä»»ä½•ç´¢å¼•è¡Œçš„å¢é•¿ã€‚</p><h2 id="ç´¢å¼•é‡ç»„çš„ä»£ä»·"><a href="#ç´¢å¼•é‡ç»„çš„ä»£ä»·" class="headerlink" title="ç´¢å¼•é‡ç»„çš„ä»£ä»·"></a>ç´¢å¼•é‡ç»„çš„ä»£ä»·</h2><p>ä¸€ä¸ªç´¢å¼•å¯ä»¥ä»¥å¤šç§æ–¹å¼è¿›è¡Œé‡ç»„ï¼š</p><ol><li>å…¨ç´¢å¼•æ‰«æï¼ˆéšæœºè®¿é—®ä¸”æ— é¡»æ’åºï¼Œæˆ–è€…é¡ºåºè®¿é—®å¹¶æ’åºï¼‰ã€‚</li><li>å…¨è¡¨æ‰«æï¼ˆç±»ä¼¼ CREATE INDEX; é¡ºåºè®¿é—®åŠä¸€æ¬¡æ’åºï¼‰ã€‚</li></ol><p>ç”±ç´¢å¼•é‡ç»„äº§ç”Ÿçš„é”ç­‰å¾…ä¾èµ–äºå…·ä½“çš„æ•°æ®åº“å’Œé€‰é¡¹ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯ç®€æ˜“çš„å·¥å…·,é‚£ä¹ˆå½“è¡¨æˆ–è€…ç´¢å¼•æ­£åœ¨è¢«æ‰«æå‹ï¼Œæ•´ä¸ªè¡¨å¯èƒ½è¢«åŠ ä¸Šä¸€ä¸ªSé”(æ›´æ–°æ“ä½œä¼šè¢«é˜»å¡ï¼‰ã€‚å¦‚æœå·¥å…·èƒ½åœ¨æ‰«ææœŸé—´å°†æ›´æ–°æ“ä½œä¿å­˜ä¸‹æ¥ï¼Œå¹¶åœ¨æ’åºå‰å°†å®ƒä»¬åº”ç”¨åˆ°æ•°æ®è¡Œä¸Šï¼Œé‚£ä¹ˆé”ç­‰å¾…çš„æ—¶é—´å°†ä¼šç¼©çŸ­å¾ˆå¤šã€‚</p><p>æœ‰äº›æ—¶å€™ï¼Œå¤§çš„ç´¢å¼•å¯èƒ½ä¸å¾—ä¸åœ¨ä¸åˆé€‚çš„æ—¶é—´è¢«é‡ç»„ã€‚åœ¨æœ€åæƒ…å†µä¸‹ï¼Œé”çš„é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„é‡ç»„æ— æ³•å®ç°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ ï¼Œ ä¸€äº›æ˜“å˜çš„ç´¢å¼•å¯èƒ½å¿…éœ€è¢«å¼ºåˆ¶ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼ˆå°†å…¶å›ºå®šåœ¨å†…å­˜ä¸­ï¼‰ã€‚</p><h1 id="æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç›¸å…³çš„ç´¢å¼•é™åˆ¶"><a href="#æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç›¸å…³çš„ç´¢å¼•é™åˆ¶" class="headerlink" title="æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç›¸å…³çš„ç´¢å¼•é™åˆ¶"></a>æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç›¸å…³çš„ç´¢å¼•é™åˆ¶</h1><h2 id="ç´¢å¼•åˆ—çš„æ•°é‡"><a href="#ç´¢å¼•åˆ—çš„æ•°é‡" class="headerlink" title="ç´¢å¼•åˆ—çš„æ•°é‡"></a>ç´¢å¼•åˆ—çš„æ•°é‡</h2><p>èƒ½å¤Ÿå¤åˆ¶åˆ°ç´¢å¼•ä¸Šçš„åˆ—çš„ä¸ªæ•°ä¸Šé™åœ¨16è‡³64ä¹‹é—´ã€‚å¹¶éæ¯ä¸ªäººéƒ½å°†è¿™è§†ä¸ºä¸€ä¸ªé—®é¢˜ã€‚ Gulutzan å’Œ Pelzeræå‡ºäº†ä¸€ä¸ªå‡ºäººæ„æ–™çš„<br>å»ºè®®ï¼Œå¦‚ä¸‹:</p><blockquote><p>é’ˆå¯¹æ‰€æœ‰æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„æ€»ä½“å»ºè®®ä¸ºï¼šåœ¨ä¸€ä¸ªå¤åˆç´¢å¼•ä¸­æœ€å¤šä½¿ç”¨5åˆ—ã€‚è™½ç„¶ä½ èƒ½å¤Ÿç¡®å®šæ•°æ®åº“ç®¡ç†ç³»ç»Ÿè‡³å°‘èƒ½å¤Ÿæ”¯æŒ16åˆ—ï¼Œä½†æ˜¯5åˆ—æ˜¯ä¸€äº›ä¸“å®¶æ‰€è®¤ä¸ºçš„åˆç†ä¸Šé™ã€‚</p></blockquote><h2 id="ç´¢å¼•åˆ—çš„æ€»é•¿åº¦"><a href="#ç´¢å¼•åˆ—çš„æ€»é•¿åº¦" class="headerlink" title="ç´¢å¼•åˆ—çš„æ€»é•¿åº¦"></a>ç´¢å¼•åˆ—çš„æ€»é•¿åº¦</h2><p>å¤åˆ¶åˆ°ç´¢å¼•çš„åˆ—çš„æ€»é•¿åº¦å­˜åœ¨ä¸€ä¸ªä¸Šé™ï¼Œè¯¥ä¸Šé™çš„å€¼å–å†³äºæ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚éšç€å®½ç´¢å¼•å˜å¾—è¶Šæ¥è¶Šæµè¡Œï¼Œè¿™ä¸€ä¸Šé™åœ¨æ•°æ®åº“ç­²ç†ç³»ç»Ÿçš„æ–°ç‰ˆæœ¬ä¸­åœ¨å˜å¤§ã€‚</p><h2 id="å•è¡¨ç´¢å¼•æ•°é‡ä¸Šé™"><a href="#å•è¡¨ç´¢å¼•æ•°é‡ä¸Šé™" class="headerlink" title="å•è¡¨ç´¢å¼•æ•°é‡ä¸Šé™"></a>å•è¡¨ç´¢å¼•æ•°é‡ä¸Šé™</h2><p>åœ¨å•è¡¨ç´¢å¼•æ•°é‡é™åˆ¶æ–¹é¢ï¼Œè®¸å¤šæ•°æ®åº“äº§å“è¦ä¹ˆæ²¡æœ‰ä¸Šé™ï¼Œè¦ä¹ˆä¸Šé™å¤ªé«˜ä»¥è‡³äºæ— å…³ç´§è¦ã€‚</p><h2 id="ç´¢å¼•å¤§å°ä¸Šé™"><a href="#ç´¢å¼•å¤§å°ä¸Šé™" class="headerlink" title="ç´¢å¼•å¤§å°ä¸Šé™"></a>ç´¢å¼•å¤§å°ä¸Šé™</h2><p>å…¸å‹çš„ç´¢å¼•å¤§å°ä¸Šé™ä¸ºå‡ GB,è€Œä¸”è¿™ä¸€ä¸Šé™æ­£åœ¨æŒç»­å¢å¤§ã€‚å°±åƒå¤§è¡¨ä¸€æ ·ï¼Œå¤§ç´¢å¼•é€šå¸¸æ˜¯åˆ†åŒºçš„ï¼Œè¿™æ ·èƒ½å¤Ÿä½¿æ‰§è¡Œç»´æŠ¤ç¨‹åºçš„æˆæœ¬æœ€å°åŒ–ï¼Œå¹¶ä¸”èƒ½å°†ç´¢å¼•åˆ†æ•£åˆ°å¤šä¸ªç£ç›˜é©±åŠ¨å™¨æˆ–RAIDç»„ä¸Šã€‚</p><h2 id="ç´¢å¼•é”å®š"><a href="#ç´¢å¼•é”å®š" class="headerlink" title="ç´¢å¼•é”å®š"></a>ç´¢å¼•é”å®š</h2><p>ä»æ›´æ–°çš„æ—¶é—´ç‚¹åˆ°æäº¤çš„æ—¶é—´ç‚¹å†…ï¼Œå¦‚æœæ•°æ®åº“ç®¡ç†ç³»ç»Ÿç»™ä¸€ä¸ªç´¢å¼•é¡µæˆ–è€…ä¸€ä¸ªç´¢å¼•é¡µçš„ä¸€éƒ¨åˆ†ï¼ˆå¦‚ä¸€ä¸ªå­é¡µï¼‰åŠ äº†é”ï¼Œé‚£ä¹ˆè¯¥ç´¢å¼•é¡µæˆ–å­é¡µå¾ˆèƒ½ä¼šæˆä¸ºç“¶é¢ˆï¼Œå› ä¸ºæ’å…¥æ“ä½œå°†ä¼šå˜ä¸ºé¡ºåºçš„ã€‚ä¾‹å¦‚ï¼ŒSQL Server 2000å°±æ˜¯è¿™æ ·åšçš„ï¼Œä½†å¦‚æœä¸Šé”çš„ç²’åº¦ä»…ä¸ºä¸€è¡Œï¼Œé‚£ä¹ˆè¿™ä¸å¯èƒ½ä¼šæˆä¸€ä¸ªé—®é¢˜ã€‚</p><p>åœ¨DB2æ•°æ®åº“çš„z/OSç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨é—©é”æ¥ä¿è¯ç´¢å¼•é¡µçš„ç‰©ç†å®Œå¹£æ€§ã€‚å½“ç”¨é—©é”å¯¹ä¸€ä¸ªç¼“å†²æ± ä¸­çš„é¡µåŠ é”æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨æ•°æ®åº“ç¼“å†²æ± ä¸­è¿›è¡Œäº†ä¸€æ¬¡ç½®ä½æ“ä½œï¼Œå½“é‡Šæ”¾é—©é”æ—¶å†è¿›è¡Œé‡ç½®ã€‚ä¸€ä¸ªé¡µåªæœ‰åœ¨è¯»å–æˆ–ä¿®æ”¹æ—¶æ‰ä¼šè¢«åŠ ä¸Šé—©é”ï¼Œåœ¨å½“å‰çš„å¤„ç†å™¨æ¡ä»¶ä¸‹è€—è´¹æ—¶é—´ä¸åˆ°ä¸€å¾®ç§’ã€‚è€Œæ•°æ®å®Œå¹£æ€§æ˜¯é€šè¿‡å¯¹ç´¢å¼•è¡Œæ‰€æŒ‡å‘çš„è¡¨é¡µæˆ–è¡¨è¡ŒåŠ ä¸Šæ™®é€šé”æ¥ä¿è¯çš„ï¼ˆä»…å¯¹æ•°æ®ä¸Šé”ï¼‰ã€‚å½“ç¨‹åºä¿®æ”¹ä¸€ä¸ªè¡¨è¡Œæˆ–è¡¨é¡µã€‚è¿™äº›é”ä¸€ç›´ä¸ä¼šé‡Šæ”¾ï¼Œç›´è‡³ä¿®æ”¹è¢«æäº¤ã€‚</p><h1 id="æ•°æ®åº“ç´¢å¼•é€‰é¡¹"><a href="#æ•°æ®åº“ç´¢å¼•é€‰é¡¹" class="headerlink" title="æ•°æ®åº“ç´¢å¼•é€‰é¡¹"></a>æ•°æ®åº“ç´¢å¼•é€‰é¡¹</h1><p>ç´¢å¼•é”®å†³å®šäº†è¿™ä¸€ç´¢å¼•è¡Œåœ¨ç´¢å¼•ç»“æ„ä¸­çš„ä½ç½®ã€‚å½“ç´¢å¼•é”®è¢«ä¿®æ”¹å,DBMSä¼šåˆ é™¤åŸæ¥çš„ç´¢å¼•è¡Œï¼Œå¹¶å°†å…¶æ’å…¥åˆ°æ–°çš„ä½ç½®ä¸Šã€‚åœ¨æœ€å·®æƒ…å†µä¸‹ï¼Œç´¢å¼•è¡Œä¼šè¢«ç§»åŠ¨åˆ°å…¶ä»–çš„å¶å­é¡µä¸Šã€‚</p><h1 id="å…¶ä»–è¯„ä¼°äº‹é¡¹"><a href="#å…¶ä»–è¯„ä¼°äº‹é¡¹" class="headerlink" title="å…¶ä»–è¯„ä¼°äº‹é¡¹"></a>å…¶ä»–è¯„ä¼°äº‹é¡¹</h1><h2 id="å®½ç´¢å¼•è¿˜æ˜¯ç†æƒ³ç´¢å¼•"><a href="#å®½ç´¢å¼•è¿˜æ˜¯ç†æƒ³ç´¢å¼•" class="headerlink" title="å®½ç´¢å¼•è¿˜æ˜¯ç†æƒ³ç´¢å¼•"></a>å®½ç´¢å¼•è¿˜æ˜¯ç†æƒ³ç´¢å¼•</h2><p>å•çº¯ä»å“åº”æ—¶é—´æ¥çœ‹ï¼Œç†æƒ³çš„ç´¢å¼•å¹¶éå…·æœ‰å®Œå…¨çš„ä¼˜åŠ¿ï¼Œæˆ‘ä»¬ç»™å‡ºäº†å¦‚ä¸‹ç»“è®º :</p><blockquote><p>è™½ç„¶ä¸‰æ˜Ÿç´¢å¼•æœ‰ä¸€å®šçš„ä¼˜åŠ¿ï¼Œå°¤å…¶æ˜¯åœ¨ç»“æœé›†ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œä½†æ˜¯è¿™ä¸ªä¼˜åŠ¿å¹¶ä¸ä¹Ÿåˆ«æ˜æ˜¾ï¼Œè€Œä¸”ä¼šå¸¦æ¥ä¸æ–°å¢ç´¢å¼•ç›¸å…³çš„é¢å¤–å¼€é”€ã€‚</p></blockquote><h1 id="ç»„ç»‡ç´¢å¼•è®¾è®¡è¿‡ç¨‹"><a href="#ç»„ç»‡ç´¢å¼•è®¾è®¡è¿‡ç¨‹" class="headerlink" title="ç»„ç»‡ç´¢å¼•è®¾è®¡è¿‡ç¨‹"></a>ç»„ç»‡ç´¢å¼•è®¾è®¡è¿‡ç¨‹</h1><h2 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>åœ¨å¤§å…¬å¸é‡Œï¼Œä¸€ä¸ªåˆç†çš„æŠ˜ä¸­æ–¹æ¡ˆæ˜¯è˜ç”¨50/50çš„ä¸“å®¶ï¼Œä»–ä»¬ä¼šå°†50%çš„æ—¶é—´ç”¨æ¥åº”ç”¨ç¨‹åºå¼€å‘ï¼Œå¦å¤–50%çš„æ—¶é—´ç”¨äºååŠ©åŒäº‹è¿›è¡Œç´¢å¼•è¯„ä¼°åŠå…¶ä»–æ€§èƒ½é—®é¢˜çš„å¤„ç†ï¼ˆæ¯”å¦‚æ ¹æ®EXPLAINçš„è¾“å‡ºå†…å®¹è§£å†³æŸä¸ªä¼˜åŒ–å™¨é—®é¢˜ï¼‰ã€‚ç»éªŒæ˜¾ç¤ºï¼Œä¸ºæ¯5è‡³10ä½åº”ç”¨å¼€å‘è€…é…ä¸€å50/50ä¸“å®¶çš„æ–¹å¼æ•ˆæœå¾ˆå¥½ã€‚</p><p>ç´¢å¼•è®¾è®¡éœ€è¦åŒäº‹æŒæ¡æŠ€æœ¯æŠ€èƒ½ä»¥åŠåº”ç”¨ç³»ç»ŸçŸ¥è¯†ã€‚ç›¸æ¯”è®©æ•°æ®åº“ä¸“å®¶ç†Ÿæ‚‰åº”ç”¨ç³»ç»Ÿçš„ç»†èŠ‚è€Œè¨€ï¼Œæ•™ä¼šå¼€å‘äººå‘˜ç´¢å¼•æŠ€èƒ½æ˜¯æ›´å®¹æ˜“çš„ã€‚</p><hr><p>PDFä¹¦ç±ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/jiankunking/books-recommendation/tree/master/Database" target="_blank" rel="noopener">https://github.com/jiankunking/books-recommendation/tree/master/Database</a></p>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Design </tag>
            
            <tag> MySQL </tag>
            
            <tag> è¯»ä¹¦ç¬”è®° </tag>
            
            <tag> Database </tag>
            
            <tag> Oracle </tag>
            
            <tag> SQL Server </tag>
            
            <tag> DB2 </tag>
            
            <tag> Index </tag>
            
            <tag> Optimizers </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaæ€§èƒ½ä¼˜åŒ–æƒå¨æŒ‡å— ç¬”è®°</title>
      <link href="/java-performance-note.html"/>
      <url>/java-performance-note.html</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ•´ç†è‡ªï¼šã€ŠJavaæ€§èƒ½ä¼˜åŒ–æƒå¨æŒ‡å—ã€‹ ä½œè€…ï¼šCharlie Hunt / Binu John </p><p>å‡ºç‰ˆæ—¶é—´ï¼š2014-03</p><a id="more"></a><h1 id="æ“ä½œç³»ç»Ÿæ€§èƒ½ç›‘æ§"><a href="#æ“ä½œç³»ç»Ÿæ€§èƒ½ç›‘æ§" class="headerlink" title="æ“ä½œç³»ç»Ÿæ€§èƒ½ç›‘æ§"></a>æ“ä½œç³»ç»Ÿæ€§èƒ½ç›‘æ§</h1><h2 id="CPUä½¿ç”¨ç‡"><a href="#CPUä½¿ç”¨ç‡" class="headerlink" title="CPUä½¿ç”¨ç‡"></a>CPUä½¿ç”¨ç‡</h2><p>å¤§å¤šæ•°çš„æ“ä½œç³»ç»Ÿçš„CPUä½¿ç”¨ç‡åˆ†ä¸ºç”¨æˆ·æ€CPUä½¿ç”¨ç‡å’Œç³»ç»Ÿæ€CPUä½¿ç”¨ç‡ã€‚</p><p>ç”¨æˆ·æ€CPUä½¿ç”¨ç‡æ˜¯æŒ‡æ‰§è¡Œåº”ç”¨ç¨‹åºä»£ç çš„æ—¶é—´å æ€»CPUæ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚</p><p>ç³»ç»Ÿæ€CPUä½¿ç”¨ç‡æ˜¯æŒ‡åº”ç”¨æ‰§è¡Œæ“ä½œç³»ç»Ÿè°ƒç”¨çš„æ—¶é—´å æ€»CPUæ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚<font color="DeepPink">ç³»ç»Ÿæ€CPUä½¿ç”¨ç‡é«˜æ„å‘³ç€å…±äº«èµ„æºæœ‰ç«äº‰æˆ–è€…I/Oè®¾å¤‡ä¹‹é—´æœ‰å¤§é‡çš„äº¤äº’ã€‚</font></p><p>æ—¢ç„¶åŸæœ¬ç”¨äºæ‰§è¡Œæ“ä½œç³»ç»Ÿå†…æ ¸è°ƒç”¨çš„CPUå‘¨æœŸä¹Ÿå¯ä»¥ç”¨æ¥æ‰§è¡Œåº”ç”¨ä»£ç ï¼Œæ‰€ä»¥ç†æƒ³æƒ…å†µä¸‹ï¼Œåº”ç”¨è¾¾åˆ°æœ€é«˜æ€§èƒ½å’Œæ‰©å±•æ€§æ—¶ï¼Œå®ƒçš„ç³»ç»Ÿæ€CPUä½¿ç”¨ç‡ä¸º0%ï¼Œæ‰€ä»¥æé«˜åº”ç”¨æ€§èƒ½å’Œæ‰©å±•æ€§çš„ä¸€ä¸ªç›®æ ‡æ˜¯å°½å¯èƒ½é™ä½ç³»ç»Ÿæ€CPUä½¿ç”¨ç‡ã€‚</p><p>å¯¹äºè®¡ç®—å¯†é›†å‹åº”ç”¨æ¥è¯´ï¼Œä¸ä»…è¦ç›‘æ§ç”¨æˆ·æ€å’Œç³»ç»Ÿæ€CPUä½¿ç”¨ç‡ï¼Œè¿˜è¦è¿›ä¸€æ­¥ç›‘æ§æ¯æ—¶é’ŸæŒ‡ä»¤æ•°ï¼ˆInstructions Per Clockï¼ŒIPCï¼‰æˆ–æ¯æŒ‡ä»¤æ—¶é’Ÿå‘¨æœŸï¼ˆCycles Per Instructionï¼ŒCPIï¼‰ç­‰æŒ‡æ ‡ã€‚è¿™ä¸¤ä¸ªæŒ‡æ ‡å¯¹äºè®¡ç®—å¯†é›†å‹åº”ç”¨æ¥è¯´å¾ˆé‡è¦ï¼Œå› ä¸º<font color="DeepPink">ç°ä»£æ“ä½œç³»ç»Ÿè‡ªå¸¦çš„CPUä½¿ç”¨ç‡ç›‘æ§å·¥å…·åªèƒ½æŠ¥å‘ŠCPUä½¿ç”¨ç‡ï¼Œè€Œæ²¡æœ‰CPUæ‰§è¡ŒæŒ‡ä»¤å ç”¨CPUæ—¶é’Ÿå‘¨æœŸçš„ç™¾åˆ†æ¯”ï¼Œè¿™æ„å‘³ç€ï¼Œå³ä¾¿CPUåœ¨ç­‰å¾…ç€å†…å­˜ä¸­çš„æ•°æ®ï¼Œæ“ä½œç³»ç»Ÿå·¥å…·ä»ç„¶ä¼šæŠ¥å‘ŠCPUç¹å¿™ã€‚è¿™ç§æƒ…å†µé€šå¸¸è¢«ç§°ä¸ºåœæ»ã€‚å½“CPUæ‰§è¡ŒæŒ‡ä»¤æ‰€ç”¨çš„æ“ä½œæ•°æ®ä¸åœ¨å¯„å­˜å™¨æˆ–è€…ç¼“å­˜ä¸­æ—¶ï¼Œå°±ä¼šå‘ç”Ÿåœæ»ï¼Œç”±äºæŒ‡ä»¤æ‰§è¡Œå‰å¿…é¡»ç­‰å¾…æ•°æ®ä»å†…å­˜ä¸­è£…å…¥CPUå¯„å­˜å™¨ï¼Œæ‰€ä»¥ä¸€æ—¦å‘ç”Ÿåœæ»ï¼Œå°±ä¼šæµªè´¹æ—¶é’Ÿå‘¨æœŸã€‚</font>CPUåœæ»é€šå¸¸ä¼šç­‰å¾…å¥½å‡ ç™¾ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œå› æ­¤æé«˜è®¡ç®—å¯†é›†å‹åº”ç”¨æ€§èƒ½çš„ç­–ç•¥å°±æ˜¯å‡å°‘åœæ»æˆ–è€…æ”¹å–„CPUé«˜é€Ÿç¼“å­˜ä½¿ç”¨ç‡ï¼Œä»è€Œå‡å°‘CPUåœ¨ç­‰å¾…å†…å­˜æ•°æ®æ—¶æµªè´¹çš„æ—¶é’Ÿå‘¨æœŸã€‚</p><h2 id="CPUè°ƒåº¦ç¨‹åºè¿è¡Œé˜Ÿåˆ—"><a href="#CPUè°ƒåº¦ç¨‹åºè¿è¡Œé˜Ÿåˆ—" class="headerlink" title="CPUè°ƒåº¦ç¨‹åºè¿è¡Œé˜Ÿåˆ—"></a>CPUè°ƒåº¦ç¨‹åºè¿è¡Œé˜Ÿåˆ—</h2><p>ç›‘æ§CPUè°ƒåº¦ç¨‹åºè¿è¡Œé˜Ÿåˆ—å¯¹äºåˆ†è¾¨ç³»ç»Ÿæ˜¯å¦æ»¡è´Ÿè·ä¹Ÿæœ‰é‡è¦æ„ä¹‰ã€‚<font color="DeepPink">è¿è¡Œé˜Ÿåˆ—ä¸­å°±æ˜¯é‚£äº›å·²å‡†å¤‡å¥½è¿è¡Œã€æ­£ç­‰å¾…å¯ç”¨CPUçš„è½»é‡çº§è¿›ç¨‹ã€‚å¦‚æœå‡†å¤‡è¿è¡Œçš„è½»é‡çº§è¿›ç¨‹æ•°è¶…è¿‡ç³»ç»Ÿæ‰€èƒ½å¤„ç†çš„ä¸Šé™ï¼Œè¿è¡Œé˜Ÿåˆ—å°±ä¼šå¾ˆé•¿ã€‚</font>è¿è¡Œé˜Ÿåˆ—é•¿è¡¨æ˜ç³»ç»Ÿè´Ÿè½½å¯èƒ½é¥±å’Œã€‚ç³»ç»Ÿè¿è¡Œé˜Ÿåˆ—é•¿åº¦ç­‰äºè™šæ‹Ÿæœºå¤„ç†å™¨çš„ä¸ªæ•°æ—¶ï¼Œç”¨æˆ·ä¸ä¼šæ˜æ˜¾æ„Ÿè§‰åˆ°æ€§èƒ½ä¸‹é™ã€‚æ­¤å¤„è™šæ‹Ÿå¤„ç†å™¨çš„ä¸ªæ•°å°±æ˜¯ç³»ç»Ÿç¡¬ä»¶çº¿ç¨‹çš„ä¸ªæ•°ï¼Œä¹Ÿæ˜¯Java API Runtime.availableProcessors()çš„è¿”å›å€¼ã€‚å½“è¿è¡Œé˜Ÿåˆ—é•¿åº¦è¾¾åˆ°è™šæ‹Ÿå¤„ç†çš„4å€æˆ–è€…æ›´å¤šæ—¶ï¼Œç³»ç»Ÿçš„å“åº”å°±éå¸¸è¿Ÿç¼“äº†ã€‚</p><p>ä¸€èˆ¬æ€§çš„æŒ‡å¯¼åŸåˆ™æ˜¯ï¼šå¦‚æœåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œè¿è¡Œé˜Ÿåˆ—çš„é•¿åº¦ä¸€ç›´éƒ½è¶…è¿‡è™šæ‹Ÿå¤„ç†å™¨ä¸ªæ•°çš„1å€ï¼Œå°±éœ€è¦å…³æ³¨äº†ï¼Œåªæ˜¯æš‚æ—¶è¿˜ä¸éœ€è¦ç«‹åˆ»é‡‡å–è¡ŒåŠ¨ã€‚<font color="DeepPink">å¦‚æœåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œè¿è¡Œé˜Ÿåˆ—é•¿åº¦è¾¾åˆ°è™šæ‹Ÿå¤„ç†å™¨ä¸ªæ•°çš„3~4å€æˆ–æ›´é«˜ï¼Œåˆ™éœ€è¦ç«‹åˆ»å¼•èµ·æ³¨æ„å’Œé‡‡å–è¡ŒåŠ¨ã€‚</font></p><h2 id="å†…å­˜ä½¿ç”¨ç‡"><a href="#å†…å­˜ä½¿ç”¨ç‡" class="headerlink" title="å†…å­˜ä½¿ç”¨ç‡"></a>å†…å­˜ä½¿ç”¨ç‡</h2><p>ç³»ç»Ÿåœ¨è¿›è¡Œé¡µé¢äº¤æ¢æˆ–è€…ä½¿ç”¨è™šæ‹Ÿå†…å­˜æ—¶ï¼ŒJavaåº”ç”¨æˆ–JVMä¼šè¡¨ç°å‡ºæ˜æ˜¾çš„æ€§èƒ½é—®é¢˜ã€‚å½“åº”ç”¨è¿è¡Œæ‰€éœ€çš„å†…å­˜è¶…è¿‡å¯ç”¨ç‰©ç†å†…å­˜æ—¶ï¼Œå°±ä¼šå‘ç”Ÿé¡µé¢äº¤æ¢ã€‚ä¸ºäº†åº”å¯¹è¿™ç§å¯èƒ½å‡ºç°çš„æƒ…å†µï¼Œé€šå¸¸è¦ä¸ºç³»ç»Ÿé…ç½®swapç©ºé—´ã€‚swapç©ºé—´ä¸€èˆ¬ä¼šåœ¨ä¸€ä¸ªç‹¬ç«‹çš„ç£ç›˜åˆ†åŒºä¸Šã€‚å½“åº”ç”¨è€—å°½å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†åº”ç”¨çš„ä¸€éƒ¨åˆ†ç½®æ¢åˆ°ç£ç›˜ä¸Šçš„swapç©ºé—´ã€‚é€šå¸¸æ˜¯åº”ç”¨ä¸­æœ€å°‘è¿è¡Œçš„éƒ¨åˆ†ï¼Œä»¥å…å½±å“æ•´ä¸ªåº”ç”¨æˆ–è€…åº”ç”¨æœ€å¿™çš„é‚£éƒ¨åˆ†ã€‚å½“è®¿é—®åº”ç”¨ä¸­è¢«ç½®æ¢å‡ºå»çš„éƒ¨åˆ†æ—¶ï¼Œå°±å¿…é¡»å°†å®ƒä»ç£ç›˜ç½®æ¢è¿›å†…å­˜ï¼Œè€Œè¿™ç§ç½®æ¢æ´»åŠ¨ä¼šå¯¹åº”ç”¨çš„å“åº”æ€§å’Œååé‡é€ æˆå¾ˆå¤§å½±å“ã€‚</p><p><font color="DeepPink">JVMåƒåœ¾æ”¶é›†å™¨åœ¨ç³»ç»Ÿé¡µé¢äº¤æ¢æ—¶çš„æ€§èƒ½ä¹Ÿå¾ˆå·®ï¼Œè¿™æ˜¯ç”±äºåƒåœ¾æ”¶é›†å™¨ä¸ºäº†å›æ”¶ä¸å¯è¾¾å¯¹è±¡æ‰€å ç”¨çš„ç©ºé—´ï¼Œéœ€è¦è®¿é—®å¤§é‡çš„å†…å­˜ã€‚å¦‚æœJavaå †å¾—ä¸€éƒ¨åˆ†è¢«ç½®æ¢å‡ºå»ï¼Œå°±å¿…é¡»å…ˆç½®æ¢è¿›å†…å­˜ä»¥ä¾¿åƒåœ¾æ”¶é›†å™¨æ‰«æå­˜æ´»å¯¹è±¡ï¼Œè¿™ä¼šå¢åŠ åƒåœ¾æ”¶é›†çš„æŒç»­æ—¶é—´ã€‚</font>åƒåœ¾æ”¶é›†æ˜¯ä¸€ç§Stop-The-Worldæ“ä½œï¼Œå³åœæ­¢æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„åº”ç”¨çº¿ç¨‹ï¼Œå¦‚æœæ­¤æ—¶ç³»ç»Ÿæ­£åœ¨è¿›è¡Œé¡µé¢äº¤æ¢ï¼Œåˆ™ä¼šå¼•èµ·JVMé•¿æ—¶é—´çš„åœé¡¿ã€‚</p><h3 id="ç›‘æ§æŠ¢å å¼ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#ç›‘æ§æŠ¢å å¼ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="ç›‘æ§æŠ¢å å¼ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>ç›‘æ§æŠ¢å å¼ä¸Šä¸‹æ–‡åˆ‡æ¢</h3><p>è®©æ­¥å¼ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶æŒ‡æ‰§è¡Œçº¿ç¨‹ä¸»åŠ¨é‡Šæ”¾CPUï¼ŒæŠ¢å å¼ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶æŒ‡çº¿ç¨‹å› ä¸ºåˆ†é…çš„æ—¶é—´ç‰‡ç”¨å°½è€Œè¢«è¿«æ”¾å¼ƒCPUæˆ–è€…è¢«å…¶ä»–ä¼˜å…ˆçº§æ›´é«˜çš„çº¿ç¨‹é”æŠ¢å ã€‚pidstatçš„è¾“å‡ºç»“æœä¸­cswch/sæ˜¯æ¯ç§’çš„è®©æ­¥å¼ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œnvccswch/sæ˜¯æŠ¢å å¼ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p><h3 id="ç›‘æ§çº¿ç¨‹è¿ç§»"><a href="#ç›‘æ§çº¿ç¨‹è¿ç§»" class="headerlink" title="ç›‘æ§çº¿ç¨‹è¿ç§»"></a>ç›‘æ§çº¿ç¨‹è¿ç§»</h3><p>æˆ‘ä»¬å‘ç°ï¼Œå¾…è¿è¡Œçº¿ç¨‹åœ¨å¤„ç†å™¨ä¹‹å‰çš„è¿ç§»ä¹Ÿä¼šå¯¼è‡´æ€§èƒ½çš„ä¸‹é™ã€‚å¤§å¤šæ•°æ“ä½œç³»ç»Ÿçš„CPUè°ƒåº¦ç¨‹åºä¼šå°†å¾…è¿è¡Œçº¿ç¨‹åˆ†é…ç»™ä¸Šæ¬¡è¿è¡Œå®ƒçš„è™šæ‹Ÿå¤„ç†å™¨ã€‚å¦‚æœè¿™ä¸ªè™šæ‹Ÿå¤„ç†å™¨å¿™ï¼Œè°ƒåº¦ç¨‹åºå°±ä¼šå°†å¾…å¤„ç†çº¿ç¨‹è¿ç§»åˆ°å…¶ä»–å¯ç”¨çš„è™šæ‹Ÿå¤„ç†å™¨ã€‚<font color="DeepPink">çº¿ç¨‹è¿ç§»ä¼šå¯¹åº”ç”¨æ€§èƒ½é€ æˆå½±å“ï¼Œè¿™æ˜¯å› ä¸ºæ–°çš„è™šæ‹Ÿå¤„ç†å™¨ç¼“å­˜ä¸­å¯èƒ½æ²¡æœ‰å¾…è¿è¡Œçº¿ç¨‹æ‰€éœ€çš„æ•°æ®æˆ–çŠ¶æ€ä¿¡æ¯ã€‚</font>å¤šæ ¸ç³»ç»Ÿä¸Šè¿è¡ŒJavaåº”ç”¨å¯èƒ½ä¼šå‘ç”Ÿå¤§é‡çš„çº¿ç¨‹è¿ç§»ï¼Œå‡å°‘è¿ç§»çš„ç­–ç•¥æ˜¯åˆ›å»ºå¤„ç†å™¨ç»„å¹¶å°†åº”ç”¨åˆ†é…ç»™è¿™äº›å¤„ç†å™¨ç»„ã€‚ä¸€èˆ¬æ€§å‡†åˆ™æ˜¯ï¼Œ<font color="DeepPink">å¦‚æœæ¨ªè·¨å¤šæ ¸æˆ–è™šæ‹Ÿå¤„ç†å™¨çš„Javaåº”ç”¨æ¯ç§’è¿ç§»è¶…è¿‡500æ¬¡ï¼Œå°†Javaåº”ç”¨ç»‘å®šåœ¨å¤„ç†å™¨ç»„ä¸Šå°±æœ‰å¥½å¤„ã€‚</font></p><h2 id="ç½‘ç»œI-Oä½¿ç”¨ç‡"><a href="#ç½‘ç»œI-Oä½¿ç”¨ç‡" class="headerlink" title="ç½‘ç»œI/Oä½¿ç”¨ç‡"></a>ç½‘ç»œI/Oä½¿ç”¨ç‡</h2><h3 id="åº”ç”¨æ€§èƒ½æ”¹è¿›çš„è€ƒè™‘"><a href="#åº”ç”¨æ€§èƒ½æ”¹è¿›çš„è€ƒè™‘" class="headerlink" title="åº”ç”¨æ€§èƒ½æ”¹è¿›çš„è€ƒè™‘"></a>åº”ç”¨æ€§èƒ½æ”¹è¿›çš„è€ƒè™‘</h3><p>å•æ¬¡è¯»å†™æ•°æ®é‡å°è€Œç½‘ç»œè¯»å†™é‡å¤§çš„åº”ç”¨ä¼šæ¶ˆè€—å¤§é‡çš„ç³»ç»Ÿæ€CPUï¼Œäº§ç”Ÿå¤§é‡çš„ç³»ç»Ÿè°ƒç”¨ã€‚å¯¹äºè¿™ç±»åº”ç”¨ï¼Œå‡å°‘ç³»ç»Ÿæ€CPUçš„ç­–ç•¥æ˜¯å‡å°‘ç½‘ç»œè¯»å†™çš„ç³»ç»Ÿè°ƒç”¨ã€‚æ­¤å¤–ï¼Œä½¿ç”¨éé˜»å¡çš„Java NIOè€Œä¸æ˜¯é˜»å¡çš„java.net.Socketï¼Œå‡å°‘å¤„ç†è¯·æ±‚å’Œå‘é€ç›¸åº”çš„çº¿ç¨‹æ•°ï¼Œä¹Ÿå¯ä»¥æ”¹å–„åº”ç”¨æ€§èƒ½ã€‚</p><p>ä»éé˜»å¡Socketä¸­è¯»å–æ•°æ®çš„ç­–ç•¥æ˜¯ï¼Œåº”ç”¨åœ¨æ¯æ¬¡è¯»è¯·æ±‚æ—¶å°½å¯èƒ½å¤šåœ°è¯»å–æ•°æ®ã€‚åŒæ ·ï¼Œå½“å¾€Socketä¸­å†™æ•°æ®æ—¶ï¼Œæ¯ä¸ªå†™è°ƒç”¨åº”è¯¥å°½å¯èƒ½å¤šåœ°å†™ã€‚</p><h1 id="JVMæ¦‚è§ˆ"><a href="#JVMæ¦‚è§ˆ" class="headerlink" title="JVMæ¦‚è§ˆ"></a>JVMæ¦‚è§ˆ</h1><h2 id="HotSpot-è¿è¡Œæ—¶"><a href="#HotSpot-è¿è¡Œæ—¶" class="headerlink" title="HotSpot è¿è¡Œæ—¶"></a>HotSpot è¿è¡Œæ—¶</h2><h3 id="å‘½ä»¤è¡Œé€‰é¡¹"><a href="#å‘½ä»¤è¡Œé€‰é¡¹" class="headerlink" title="å‘½ä»¤è¡Œé€‰é¡¹"></a>å‘½ä»¤è¡Œé€‰é¡¹</h3><p>HotSpot VM å‘½ä»¤è¡Œé€‰é¡¹æœ‰3ç±»ï¼š</p><ul><li>æ ‡å‡†é€‰é¡¹ï¼ˆStandard optionï¼‰ï¼šæ ‡å‡†é€‰é¡¹æ˜¯Java virtual Machine Specificationè¦æ±‚æ‰€æœ‰java JVM éƒ½å¿…é¡»å®ç°çš„é€‰é¡¹ã€‚</li><li>éæ ‡å‡†é€‰é¡¹ï¼ˆNonStandard optionï¼‰ï¼šéæ ‡å‡†é€‰é¡¹(ä»¥â€“Xä¸ºå‰ç¼€)ï¼Œä¸ä¿è¯ä¹Ÿä¸å¼ºåˆ¶æ‰€æœ‰JVMå®ç°éƒ½å¿…é¡»æ”¯æŒã€‚</li><li>éç¨³å®šé€‰é¡¹ï¼ˆDeveloper optionï¼‰ï¼šéç¨³å®šé€‰é¡¹(ä»¥-XXä¸ºå‰ç¼€),é€šå¸¸ä¸ºäº†ç‰¹å®šéœ€è¦è€Œå¯¹JVMçš„è¿è¡Œè¿›è¡ŒçŸ«æ­£ã€‚é€‰é¡¹åç§°å‰+ä»£è¡¨ trueå¯ç”¨ï¼Œ-ä»£è¡¨falseå…³é—­ã€‚</li></ul><h3 id="VMç”Ÿå‘½å‘¨æœŸ"><a href="#VMç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="VMç”Ÿå‘½å‘¨æœŸ"></a>VMç”Ÿå‘½å‘¨æœŸ</h3><p>å¯åŠ¨å™¨å¯åŠ¨HotSpot VMæ—¶ä¼šæ‰§è¡Œä¸€ç³»åˆ—æ“ä½œã€‚æ­¥éª¤æ¦‚è¿°å¦‚ä¸‹ï¼š</p><ol><li>è§£æå‘½ä»¤è¡Œé€‰é¡¹</li><li>è®¾ç½®å †çš„å¤§å°å’ŒJITç¼–è¯‘å™¨<br>å¦‚æœå‘½ä»¤è¡Œæ²¡æœ‰æ˜ç¡®è®¾ç½®å †çš„å¤§å°å’ŒJITç¼–è¯‘å™¨ï¼Œå¯åŠ¨å™¨åˆ™é€šè¿‡è‡ªåŠ¨ä¼˜åŒ–è¿›è¡Œè®¾ç½®ã€‚</li><li>è®¾å®šç¯å¢ƒå˜é‡å¦‚ï¼šLD_LIBRARY_PATHå’ŒCLASSPATH</li><li>å¦‚æœå‘½ä»¤è¡Œæœ‰-jaré€‰é¡¹ï¼Œå¯åŠ¨å™¨åˆ™ä»æŒ‡å®šJARçš„manifestä¸­æŸ¥æ‰¾Main-Classï¼Œå¦åˆ™ä»å‘½ä»¤è¡Œè¯»å–Main-Class</li><li>ä½¿ç”¨æ ‡å‡†Javaæœ¬åœ°æ¥å£ï¼ˆJava Native Interfaceï¼ŒJNIï¼‰æ–¹æ³•JNI_CreateJavaVMåœ¨æ–°åˆ›å»ºçš„çº¿ç¨‹ä¸­åˆ›å»ºHotSpot VM</li><li>ä¸€æ—¦åˆ›å»ºå¹¶åˆå§‹åŒ–å·HotSpot VMï¼Œå°±ä¼šåŠ è½½Java Main-Classï¼Œå¯åŠ¨å™¨ä¹Ÿä¼šä»Java Main-Classä¸­å–å¾—Java mainæ–¹æ³•çš„å‚æ•°</li><li>HotSpot VMé€šè¿‡JNIæ–¹æ³•CallStartVoidMethodè°ƒç”¨Java mainæ–¹æ³•ï¼Œå¹¶å°†å‘½ä»¤è¡Œé€‰é¡¹ä¼ ç»™å®ƒ</li></ol><h3 id="VMç±»åŠ è½½é˜¶æ®µ"><a href="#VMç±»åŠ è½½é˜¶æ®µ" class="headerlink" title="VMç±»åŠ è½½é˜¶æ®µ"></a>VMç±»åŠ è½½é˜¶æ®µ</h3><h4 id="ç±»åŠ è½½é˜¶æ®µ"><a href="#ç±»åŠ è½½é˜¶æ®µ" class="headerlink" title="ç±»åŠ è½½é˜¶æ®µ"></a>ç±»åŠ è½½é˜¶æ®µ</h4><p>å¯¹äºç»™å®šçš„Javaç±»æˆ–æ¥å£ï¼Œç±»åŠ è½½æ—¶ä¼šä¾æ®å®ƒçš„åå­—æ‰¾åˆ°Javaç±»çš„äºŒè¿›åˆ¶ç±»æ–‡ä»¶ï¼Œå®šä¹‰Javaç±»ï¼Œç„¶ååˆ›å»ºä»£è¡¨è¿™ä¸ªç±»æˆ–è€…æ¥å£çš„java.lang.Classå¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°Javaç±»æˆ–æ¥å£çš„äºŒè¿›åˆ¶è¡¨ç¤ºå°±ä¼šæŠ›å‡ºNoClassDefFoundã€‚æ­¤å¤–ï¼Œç±»åŠ è½½é˜¶æ®µä¼šå¯¹ç±»çš„æ ¼å¼è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼Œå¦‚æœæœ‰é”™ï¼Œåˆ™ä¼šæŠ›å‡ºClassFormatErroræˆ–UnsupportedClassVersionErrorã€‚Javaç±»åŠ è½½å‰ï¼ŒHotSpot VMå¿…é¡»å…ˆåŠ è½½å®ƒçš„æ‰€æœ‰è¶…ç±»å’Œè¶…æ¥å£ï¼Œå¦‚æœç±»çš„ç»§æ‰¿å±‚æ¬¡æœ‰é”™ï¼Œä¾‹å¦‚Javaç±»æ˜¯å®ƒè‡ªå·±çš„è¶…ç±»æˆ–è¶…æ¥å£ï¼ˆç±»å±‚æ¬¡é€’å½’ï¼‰,HotSpot VMåˆ™ä¼šæŠ›å‡ºClassCircularityErrorã€‚å¦‚æœæ‰€å¼•ç”¨çš„ç›´æ¥è¶…æ¥å£æœ¬èº«å¹¶ä¸æ˜¯æ¥å£ï¼Œæˆ–è€…ç›´æ¥è¶…ç±»å®é™…ä¸Šæ˜¯æ¥å£ï¼ŒHotSpot VMåˆ™ä¼šæŠ›å‡ºIncompatibleClassChangeErrorã€‚</p><p>é“¾æ¥çš„ç¬¬ä¸€æ­¥æ˜¯éªŒè¯ï¼Œæ£€æŸ¥ç±»æ–‡ä»¶çš„è¯­ä¹‰ã€å¸¸é‡æ± ç¬¦å·ä»¥åŠç±»å‹ã€‚å¦‚æœæ£€æŸ¥æœ‰é”™ï¼Œå°±ä¼šæŠ›å‡ºVerifyErrorã€‚é“¾æ¥çš„ä¸‹ä¸€æ­¥æ˜¯å‡†å¤‡ï¼Œå®ƒä¼šåˆ›å»ºé™æ€å­—æ®µï¼Œåˆå§‹åŒ–ä¸ºæ ‡å‡†é»˜è®¤å€¼ï¼Œä»¥åŠåˆ†é…æ–¹æ³•è¡¨ã€‚è¯·æ³¨æ„ï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰æ‰§è¡Œä»»ä½•Javaä»£ç ã€‚æ¥ä¸‹æ¥è§£æç¬¦å·å¼•ç”¨ï¼Œè¿™ä¸€æ­¥æ˜¯å¯é€‰çš„ã€‚ç„¶ååˆå§‹åŒ–ç±»ï¼Œè¿è¡Œç±»æ„é€ å™¨ã€‚è¿™æ˜¯è¿„ä»Šä¸ºæ­¢ï¼Œç±»ä¸­è¿è¡Œçš„ç¬¬ä¸€æ®µJavaä»£ç ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<font color="DeepPink">åˆå§‹åŒ–ç±»éœ€è¦é¦–å…ˆåˆå§‹åŒ–è¶…ç±»ï¼ˆä¸ä¼šåˆå§‹åŒ–è¶…æ¥å£ï¼‰</font>ã€‚</p><blockquote><p>å¦‚ï¼šintçš„æ ‡å‡†é»˜è®¤å€¼ä¸º0ï¼›public static int alue=123ï¼Œå‡†å¤‡é˜¶æ®µå°†å…¶åˆå§‹åŒ–ä¸º0è€Œä¸æ˜¯123ï¼Œvalue=123çš„èµ‹å€¼æ“ä½œåœ¨ç±»æ„é€ å™¨&lt;clinit&gt;()ä¸­ã€‚<br>public static final int value=123ï¼Œç¼–è¯‘æ—¶ä¼šä¸ºvalueåœ¨å­—æ®µå±æ€§è¡¨ä¸­ç”ŸæˆConstantValueï¼Œä»è€Œåœ¨å‡†å¤‡é˜¶æ®µå°±è¢«åˆå§‹åŒ–æˆ123ã€‚</p></blockquote><p>Java Virtual Machine Specificationè§„å®šé¦–æ¬¡ä½¿ç”¨ç±»æ—¶è¿›è¡Œç±»åˆå§‹åŒ–ï¼Œè€ŒJava Language Specificationåˆ™å…è®¸åœ¨é“¾æ¥é˜¶æ®µç¬¦å·è§£ææ—¶çµæ´»å¤„ç†ï¼Œåªè¦ä¿æŒè¯­è¨€çš„è¯­ä¹‰ä¸å˜ï¼ŒJVMä¾æ¬¡æ‰§è¡ŒåŠ è½½ã€é“¾æ¥å’Œåˆå§‹åŒ–ï¼Œä¿è¯åŠæ—¶æŠ›å‡ºé”™è¯¯å³å¯ã€‚å‡ºäºæ€§èƒ½ä¼˜åŒ–çš„è€ƒè™‘ï¼Œé€šå¸¸ç›´åˆ°ç±»åˆå§‹åŒ–æ—¶HotspotVMæ‰ä¼šåŠ è½½å’Œé“¾æ¥ç±»ã€‚<font color="DeepPink">è¿™æ„å‘³ç€ï¼Œç±»Aå¼•ç”¨ç±»Bã€‚åŠ è½½Aä¸ä¸€å®šå¯¼è‡´åŠ è½½Bï¼ˆé™¤éBéœ€è¦éªŒè¯ï¼‰ã€‚æ‰§è¡ŒBçš„ç¬¬ä¸€æ¡æŒ‡ä»¤ä¼šå¯¼è‡´åˆå§‹åŒ–Bï¼Œä»è€ŒåŠ è½½å’Œé“¾æ¥Bã€‚</font></p><h4 id="ç±»åŠ è½½å™¨å§”æ´¾"><a href="#ç±»åŠ è½½å™¨å§”æ´¾" class="headerlink" title="ç±»åŠ è½½å™¨å§”æ´¾"></a>ç±»åŠ è½½å™¨å§”æ´¾</h4><p>å½“è¯·æ±‚ç±»åŠ è½½å™¨æŸ¥æ‰¾å’ŒåŠ è½½æŸä¸ªç±»æ—¶ï¼Œè¯¥ç±»åŠ è½½å™¨å¯ä»¥è½¬è€Œè¯·æ±‚åˆ«çš„ç±»åŠ è½½å™¨æ¥åŠ è½½ã€‚è¿™è¢«ç§°ä¸ºç±»åŠ è½½å™¨å§”æ´¾ã€‚ç±»çš„é¦–ä¸ªç±»åŠ æ‰¾å™¨ç§°ä¸ºåˆå§‹ç±»åŠ è½½å™¨ï¼ˆInitiating ClassLoader)ï¼Œæœ€ç»ˆå®šä¹‰ç±»çš„ç±»åŠ è½½å™¨ç§°ä¸ºå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆDefining ClassLoaderï¼‰ã€‚<font color="DeepPink">å°±å­—èŠ‚ç è§£æè€Œè¨€ï¼ŒæŸä¸ªç±»çš„åˆå§‹ç±»åŠ è½½å™¨æ˜¯æŒ‡å¯¹è¯¥ç±»è¿›è¡Œå¸¸é‡æ± ç¬¦å·è§£æçš„ç±»åŠ è½½å™¨ã€‚</font></p><p>ç±»åŠ è½½å™¨ä¹‹é—´æ˜¯å±‚çº§åŒ–å…³ç³»ï¼Œæ¯ä¸ªç±»åŠ è½½å™¨éƒ½å¯ä»¥å§”æ´¾ç»™ä¸Šä¸€çº§ç±»åŠ è½½å™¨ã€‚è¿™ç§å§”æ´¾å…³ç³»å®šä¹‰äº†äºŒè¿›åˆ¶ç±»çš„æŸ¥æ‰¾é¡ºåºã€‚<font color="DeepPink">Java SEç±»åŠ è½½å™¨çš„å±‚çº§æŸ¥æ‰¾é¡ºåºä¸ºå¯åŠ¨ç±»åŠ è½½å™¨ã€æ‰©å±•ç±»åŠ è½½å™¨åŠç³»ç»Ÿç±»åŠ è½½å™¨ã€‚</font>ç³»ç»Ÿç±»åŠ è½½å™¨æ˜¯é»˜è®¤çš„åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå®ƒåŠ è½½Javaç±»çš„mainæ–¹æ³•å¹¶ä»classpathä¸ŠåŠ è½½ç±»ã€‚<font color="DeepPink">åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨å¯ä»¥æ˜¯Java SEç³»ç»Ÿè‡ªå¸¦çš„ç±»åŠ è½½å™¨ï¼Œæˆ–è€…ç”±åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›ã€‚æ‰©å±•ç±»åŠ è½½å™¨åˆ™JavaSEç³»ç»Ÿå®ç°ï¼Œå®ƒè´Ÿè´£ä»JRE(Java Runtime Environment,Javaè¿è¡Œç¯å¢ƒï¼‰çš„lib/extç›®å½•ä¸‹åŠ è½½ç±»ã€‚</font></p><h4 id="å¯åŠ¨ç±»åŠ è½½å™¨"><a href="#å¯åŠ¨ç±»åŠ è½½å™¨" class="headerlink" title="å¯åŠ¨ç±»åŠ è½½å™¨"></a>å¯åŠ¨ç±»åŠ è½½å™¨</h4><p><font color="DeepPink">å¯åŠ¨ç±»åŠ è½½å™¨æ˜¯ç”±HotSpot VMå®ç°çš„ï¼Œè´Ÿè´£åŠ è½½BOOTCLASSPATHè·¯å¾„ä¸­çš„ç±»ï¼Œå¦‚åŒ…å«Java SEç±»åº“çš„rt.jarã€‚</font>ä¸ºäº†åŠ å¿«å¯åŠ¨é€Ÿåº¦ï¼ŒClientæ¨¡å¼çš„HotSpot VMå¯ä»¥é€šè¿‡ç§°ä¸ºç±»æ•™æ®å…±äº«ï¼ˆClass Data Sharingï¼‰çš„ç‰¹æ€§ä½¿ç”¨å·²ç»é¢„åŠ è½½çš„ç±»ã€‚è¿™ä¸ªç‰¹æ€§é»˜è®¤ä¸ºå¼€å¯ï¼Œå¯ç”±HotSpot VMå‘½ä»¤è¡Œå¼€å…³-Xshare:onå¼€å¯ï¼Œ-Xshare:offå…³é—­ã€‚åˆ°æœ¬ä¹¦ç¼–å†™æ—¶ä¸ºæ­¢ï¼ŒServeræ¨¡å¼çš„HotSpot VMè¿˜ä¸æ”¯æŒç±»æ•°æ®å…±äº«ï¼Œè€Œä¸”å³ä¾¿æ˜¯Clientæ¨¡å¼ï¼Œä¹Ÿåªæœ‰ä½¿ç”¨Serialæ”¶é›†å™¨æ—¶æ‰æ”¯æŒè¯¥æœºåˆ¶ã€‚</p><h4 id="ç±»å‹å®‰å…¨"><a href="#ç±»å‹å®‰å…¨" class="headerlink" title="ç±»å‹å®‰å…¨"></a>ç±»å‹å®‰å…¨</h4><p>Javaç±»æˆ–æ¥å£çš„åå­—ä¸ºå…¨é™å®šåï¼ˆåŒ…æ‹¬åŒ…åï¼‰ã€‚Javaçš„ç±»å‹ç”±å…¨é™å®šåå’Œç±»åŠ è½½å™¨å”¯ä¸€ç¡®å®šã€‚</p><h4 id="HotSpotç±»å…ƒæ•°æ®"><a href="#HotSpotç±»å…ƒæ•°æ®" class="headerlink" title="HotSpotç±»å…ƒæ•°æ®"></a>HotSpotç±»å…ƒæ•°æ®</h4><p>ç±»åŠ è½½æ—¶ï¼ŒHotSpot VMä¼šåœ¨æ°¸ä¹…ä»£åˆ›å»ºç±»çš„å†…éƒ¨è¡¨ç¤ºinstanceKlassæˆ–arrayKlassã€‚instanceKlassåº”ç”¨äº†ä¸ä¹‹å¯¹åº”çš„java.lang.Classå®ä¾‹ï¼Œåè€…æ˜¯å‰è€…çš„Javaé•œåƒã€‚HotSpot VMå†…éƒ¨ä½¿ç”¨ç§°ä¸ºklassOopçš„æ•°æ®ç»“æ„è®¿é—®instanceKlassã€‚åç¼€â€œOopâ€è¡¨ç¤ºæ™®é€šå¯¹è±¡æŒ‡é’ˆï¼Œæ‰€ä»¥klassOopæ˜¯åº”ç”¨java.lang.Classçš„HotSpotå†…éƒ¨æŠ½è±¡ï¼Œå®ƒæ˜¯æŒ‡å‘Klassï¼ˆä¸Javaç±»å¯¹åº”çš„å†…éƒ¨è¡¨ç¤ºï¼‰çš„æ™®é€šå¯¹è±¡æŒ‡é’ˆã€‚</p><h4 id="å†…éƒ¨çš„ç±»åŠ è½½æ•°æ®"><a href="#å†…éƒ¨çš„ç±»åŠ è½½æ•°æ®" class="headerlink" title="å†…éƒ¨çš„ç±»åŠ è½½æ•°æ®"></a>å†…éƒ¨çš„ç±»åŠ è½½æ•°æ®</h4><p>ç±»åŠ è½½è¿‡ç¨‹ä¸­ï¼ŒHotSpot VMç»´æŠ¤äº†3å¼ æ•£åˆ—è¡¨ã€‚SystemDictionaryåŒ…å«å·²åŠ è½½çš„ç±»ï¼Œå®ƒå°†å»ºç«‹ç±»å/ç±»åŠ è½½å™¨ï¼ˆåŒ…æ‹¬åˆå§‹ç±»åŠ è½½å™¨å’Œå®šä¹‰ç±»åŠ è½½å™¨ï¼‰ä¸klassOopå¯¹è±¡ä¹‹é—´çš„æ˜ å°„ã€‚ç›®å‰åªæœ‰åœ¨å®‰å…¨ç‚¹äº‹æ‰èƒ½ç§»é™¤SystemDictionaryä¸­çš„å…ƒç´ ã€‚Placeholder-TableåŒ…å«å½“å‰æ­£åœ¨åŠ è½½çš„ç±»ï¼Œå®ƒç”¨äºæ£€æŸ¥ClassCircularityErrorï¼Œå¤šçº¿ç¨‹ç±»åŠ è½½å™¨å¹¶è¡ŒåŠ è½½ç±»æ—¶ä¹Ÿä¼šç”¨åˆ°å®ƒã€‚LoaderConstraintTableç”¨äºè¿½è¸ªç±»å‹å®‰å…¨æ£€æŸ¥çš„çº¦æŸæ¡ä»¶ã€‚<font color="DeepPink">è¿™äº›æ•£åˆ—è¡¨éƒ½éœ€è¦åŠ é”ä¿è¯è®¿é—®å®‰å…¨ï¼Œåœ¨HotSpot VMä¸­ï¼Œè¿™ä¸ªé”ç§°ä¸ºSystemDictionary_lockã€‚é€šå¸¸ï¼ŒHotSpot VMå€ŸåŠ©ç±»åŠ è½½å™¨å¯¹è±¡é”å¯¹åŠ è½½ç±»çš„è¿‡ç¨‹è¿›è¡Œåºåˆ—åŒ–ã€‚</font></p><h3 id="å­—èŠ‚ç éªŒè¯"><a href="#å­—èŠ‚ç éªŒè¯" class="headerlink" title="å­—èŠ‚ç éªŒè¯"></a>å­—èŠ‚ç éªŒè¯</h3><p>Javaæ˜¯ä¸€é—¨ç±»å‹å®‰å…¨è¯­è¨€ï¼Œå®˜æ–¹æ ‡å‡†çš„Javaç¼–è¯‘å™¨ï¼ˆjavacï¼‰å¯ä»¥ç”Ÿæˆåˆæ³•çš„ç±»æ–‡ä»¶å’Œç±»å‹å®‰å…¨çš„å­—èŠ‚ç ï¼Œä½†Javaè™šæ‹Ÿæœºæ— æ³•ç¡®ä¿å­—èŠ‚ç ä¸€å®šæ˜¯ç”±å¯ä¿¡çš„javacç¼–è¯‘å™¨äº§ç”Ÿçš„ï¼Œæ‰€ä»¥åœ¨é“¾æ¥æ—¶å¿…é¡»è¿›è¡Œå­—èŠ‚ç éªŒè¯ä»¥ä¿éšœç±»å‹å®‰å…¨ã€‚</p><h3 id="ç±»æ•°æ®å…±äº«"><a href="#ç±»æ•°æ®å…±äº«" class="headerlink" title="ç±»æ•°æ®å…±äº«"></a>ç±»æ•°æ®å…±äº«</h3><p>ç±»æ•°æ®å…±äº«æ˜¯Java 5å¼•äººçš„ç‰¹æ€§ï¼Œä»¥ç¼©çŸ­Javaç¨‹åºï¼ˆç‰¹åˆ¥æ˜¯å°ç¨‹åºï¼‰çš„å¯åŠ¨æ—¶é—´ï¼ŒåŒæ—¶ä¹Ÿèƒ½å‡å°‘å®ƒä»¬çš„å†…å­˜å ç”¨ã€‚ä½¿ç”¨Java HotSpot JREå®‰è£…ç¨‹åºåœ¨32ä½å¹³å°ä¸Šå®‰è£…Javaè¿è¡Œç¯å¢ƒï¼ˆJRE)æ—¶ï¼Œå®‰è£…ç¨‹åºä¼šåŠ è½½ç³»ç»Ÿjarä¸­çš„éƒ¨åˆ†ç±»ï¼Œå˜æˆç§æœ‰çš„å†…éƒ¨è¡¨ç¤ºå¹¶è½¬å‚¨æˆæ–‡ä»¶ï¼Œç§°ä¸ºå…±äº«æ–‡æ¡£(Shared Archive)ã€‚å¦‚æœè¿‡æ²¡æœ‰ä½¿ç”¨Java HotSpot JREå®‰è£…ç¨‹åºï¼Œä¹Ÿå¯ä»¥æ‰‹å·¥ç”Ÿæˆè¯¥æ–‡ä»¶ã€‚ä¹‹åè°ƒç”¨Javaè™šæ‹Ÿæœºæ—¶ï¼Œå…±äº«æ–‡æ¡£ä¼šæ˜ å°„åˆ°JVMå†…å­˜ä¸­ï¼Œä»è€Œå‡å°‘å‡å°‘åŠ è½½è¿™äº›ç±»çš„å¼€é”€ï¼Œä¹Ÿä½¿å¾—è¿™äº›ç±»çš„å¤§éƒ¨åˆ†JVMå…æ•°æ¤èƒ½åœ¨å¤šä¸ªJVMè¿›ç¨‹é—´å…±äº«ã€‚</p><h3 id="è§£é‡Šå™¨"><a href="#è§£é‡Šå™¨" class="headerlink" title="è§£é‡Šå™¨"></a>è§£é‡Šå™¨</h3><p>HotSpot VMè§£é‡Šå™¨æ˜¯ä¸€ç§åŸºäºæ¨¡æ¿çš„è§£é‡Šå™¨ã€‚JVMå¯åŠ¨æ—¶ï¼ŒHotSpot VMè¿è¡Œæ—¶ç³»ç»Ÿåˆ©ç”¨å†…éƒ¨TemplateTableä¸­çš„ä¿¡æ¯åœ¨å†…å­˜ä¸­ç”Ÿæˆè§£æå™¨ã€‚TemplateTableåŒ…å«äºæ¯ä¸ªå­—èŠ‚ç å¯¹åº”çš„æœºå™¨ä»£ç ï¼Œæ¯ä¸ªæ¨¡æ¿æè¿°ä¸€ä¸ªå­—èŠ‚ç ã€‚</p><p>HotSpot VMè§£é‡Šå™¨å ªäºæ¨¡æ¿çš„è®¾è®¡è¦å¥½äºä¼ ç»Ÿçš„switchè¯­å¥å¾ªç¯æ–¹å¼ã€‚switchè¯­å¥éœ€è¦é‡å¤æ‰§è¡Œæ¯”è¾ƒæ“ä½œï¼Œæœ€å·®æƒ…å†µéœ€è¦å’Œæ‰€å†‡å­—èŠ‚ç æ¯”è¾ƒã€‚æ­¤å¤–ï¼Œswitchè¯­å¥å¿…é¡»ä½¿ç”¨å•ç‹¬çš„è½¯ä»¶æ ˆä¼ é€’ Java å‚æ•°ã€‚HotSpot VMä½¿ç”¨æœ¬åœ°Cæ ˆä¼ é€’ Java å‚æ•°ã€‚ä¸€äº›å­˜å‚¨åœ¨Cå˜é‡ä¸­çš„HotSpot VMå†…éƒ¨å˜é‡ï¼Œä¾‹å¦‚Javaçº¿ç¨‹çš„ç¨‹åºè®¡æ•°å™¨æˆ–æ ˆæŒ‡é’ˆï¼Œå¹¶ä¸èƒ½ä¿è¯æ€»æ˜¯å­˜å‚¨åœ¨åº•å±‚ç¡¬ä»¶å¯„å­˜å™¨ä¸­ã€‚ç»“æœï¼Œç®¡ç†è¿™äº›è½¯ä»¶è§£é‡Šå™¨æ•°æ®ç»“æ„å°±ä¼šå å»æ€»æ‰§è¡Œæ—¶é—´çš„ç›¸å½“å¤§ä¸€éƒ¨åˆ†ã€‚ä¸è¿‡æ€»ä½“æ¥è¯´ï¼ŒHotSpotè§£é‡Šå™¨æ˜¾è‘—ç¼©çŸ­HotSpot VMå’Œå®ä½“æœºä¹‹é—´çš„æ€§èƒ½å·®è·ï¼Œè§£é‡Šé€Ÿåº¦ä¹Ÿæ˜æ˜¾å˜å¿«äº†ï¼Œç„¶è€Œä»£ä»·æ˜¯å¤§é‡ä¸æœºå™¨ç›¸å…³çš„ä»£ç ã€‚ä¾‹å¦‚ï¼ŒIntel X86å¹³å°ç‰¹å®šçš„ä»£ç å¤§çº¦æœ‰10000è¡Œï¼ŒSPARCå¹³å°ä¸“ç”¨çš„ä»£ç å¤§çº¦æ‰“14000è¡Œã€‚ç”±äºéœ€è¦æ”¯æŒåŠ¨æ€ä»£ç ç”Ÿæˆï¼ˆJITç¼–è¯‘ï¼‰ï¼Œæ•´ä½“çš„ä»£ç é‡å’Œå¤æ‚åº¦ä¹Ÿæ˜¾è‘—å˜å¤§ã€‚å¹¶ä¸”è°ƒ è¯•åŠ¨æ€ç”Ÿæˆçš„æœºå™¨ç ï¼ˆ JITç¼–è¯‘ä»£ç ï¼‰æ¯”è°ƒè¯•é™æ€ä»£ç å›°éš¾å¤šäº†ã€‚è™½ç„¶è¿™äº›ä¸åˆ©äºè¿è¡Œæ—¶ç³»ç»Ÿçš„æ”¹å–„ï¼Œä½†ä¹Ÿå¹¶éä¸å¯èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚</p><h3 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h3><p>å½“ä¸Javaçš„è¯­ä¹‰çº¦æŸå†²çªæ—¶ï¼ŒJavaè™šæ‹Ÿæœºä¼šç”¨å¼‚å¸¸é€šçŸ¥ç¨‹åºã€‚å¼‚å¸¸å¤„ç†ç”±HotSpot VMè§£é‡Šå™¨ã€JITç¼–è¯‘å™¨å’Œå…¶ä»–HotSpot VMç»„ä»¶ä¸€èµ·åä½œå®ç°ã€‚å¼‚å¸¸å¤„ç†ä¸»è¦æœ‰ä¸¤ç§æƒ…å½¢ï¼ŒåŒä¸€æ–¹æ³•ä¸­æŠ›å‡ºå’Œæ•è·å¼‚å¸¸ï¼Œæˆ–ç”±è°ƒç”¨æ–¹æ³•æ•è·å¼‚å¸¸ã€‚å¼‚å¸¸å¯ä»¥ç”±æŠ›å‡ºå­—èŠ‚ç ã€VMå†…éƒ¨è°ƒç”¨è¿”å›ã€JNIè°ƒç”¨è¿”å›æˆ–Javaè°ƒç”¨è¿”å›æ‰€å¼•å‘ã€‚</p><h3 id="çº¿ç¨‹ç®¡ç†"><a href="#çº¿ç¨‹ç®¡ç†" class="headerlink" title="çº¿ç¨‹ç®¡ç†"></a>çº¿ç¨‹ç®¡ç†</h3><p><font color="DeepPink">HotSpot VMé€šè¿‡åä½œã€è½®è¯¢çš„æœºåˆ¶åˆ›å»ºå®‰å…¨ç‚¹</font>ã€‚ç®€ä¸­æ¥è¯´ï¼Œçº¿ç¨‹ä¼šç»å¸¸è¯¢é—®ï¼šâ€œæˆ‘è¯¥åœ¨å®‰å…¨ç‚¹åœä½ä¹ˆï¼Ÿ â€é«˜æ•ˆåœ°è¯¢é—®è¿™ä¸ªé—®é¢˜å¹¶ä¸æ˜¯ä»¶å®¹æ˜“çš„äº‹ã€‚çº¿ç¨‹åœ¨çŠ¶æ€å˜è¿çš„è¿‡ç¨‹ä¸­ï¼Œä¼šç»å¸¸è¯¢é—®è¿™ä¸ªé—®é¢˜ï¼Œä½†å¹¶éæ‰€æœ‰çš„çŠ¶æ€å˜è¿éƒ½ä¼šå¦‚æ­¤è¯¢é—®ï¼Œæ¯”å¦‚çº¿ç¨‹ç¦»å¼€HotSpot VMè¿›å…¥æœ¬åœ°ä»£ç çš„æƒ…å†µã€‚æ­¤å¤–ï¼ŒJITç¼–è¯‘ä»£ç ä»javaæ–¹æ³•ä¸­è¿”å›æˆ–æ­£ä½œå¾ªç¯è¿­ä»£çš„æŸä¸ªé˜¶æ®µæ—¶ï¼Œçº¿ç¨‹ä¹Ÿä¼šè¯¢é—®â€œæˆ‘è¯¥åœ¨å®‰å…¨ç‚¹åœä½å—ï¼Ÿ â€ã€‚æ­£åœ¨æ‰§è¡Œè§£é‡Šä»£ç çš„çº¿ç¨‹é€šå¸¸ä¸ä¼šè¯¢é—®å®ƒä»¬æ˜¯å¦è¯¥åœ¨å®‰å…¨ç‚¹åœä½ã€‚ç›¸åï¼Œå½“è§£é‡Šå™¨åˆ‡æ¢åˆ°ä¸åŒçš„åˆ†é…è¡¨æ—¶ï¼Œä¼šè¯·æ±‚å®‰å…¨ç‚¹ã€‚åˆ‡æ¢æ“ä½œä¸­åŒ…å«ä¸€éƒ¨åˆ†ä»£ç ï¼Œç”¨ä»¥è¯¢é—®ä½•æ—¶ç¦»å¼€å®‰å…¨ç‚¹ã€‚å½“ç¦»å¼€å®‰å…¨ç‚¹æ—¶ï¼Œåˆ†é…è¡¨ä¼šå†æ¬¡åˆ‡æ¢å›æ¥ã€‚ä¸€æ—¦è¯·æ±‚äº†å®‰å…¨ç‚¹ï¼ŒVMThreadå°±å¿…é¡»åœ¨ç»§ç»­æ‰§è¡ŒVMæ“ä½œå‰ç­‰å¾…ï¼Œç›´åˆ°ç¡®å®šæ‰€è¡Œçº¿ç¨‹éƒ½å·²è¿›å…¥å®‰å…¨ç‚¹ä¿å…¨çŠ¶æ€ä¸ºæ­¢ã€‚åœ¨å®‰å…¨ç‚¹æ—¶ï¼ŒVMThreadç”¨Threads_locké˜»å¡æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼ŒVMæ“ä½œå®Œæˆå , VMThreadé‡Šæ”¾Threads_lockã€‚</p><h3 id="Javaæœ¬åœ°æ¥å£ï¼ˆJNIï¼‰"><a href="#Javaæœ¬åœ°æ¥å£ï¼ˆJNIï¼‰" class="headerlink" title="Javaæœ¬åœ°æ¥å£ï¼ˆJNIï¼‰"></a>Javaæœ¬åœ°æ¥å£ï¼ˆJNIï¼‰</h3><p>åˆ‡è®°ï¼Œä¸€æ—¦åœ¨åº”ç”¨ä¸­ä½¿ç”¨JNIï¼Œå°±æ„å‘³ç€ä¸§å¤±äº†Javaå¹³å°çš„ä¸¤ä¸ªå¥½å¤„ã€‚é¦–å…ˆï¼Œä¾èµ–JNIçš„Javaåº”ç”¨éš¾ä»¥åœ¨å¤šç§å¼‚æ„çš„ç¡¬ä»¶å¹³å°ä¸Šè¿è¡Œã€‚å³ä¾¿åº”ç”¨ä¸­Javaè¯­è¨€ç¼–å†™çš„éƒ¨åˆ†å¯ä»¥ç§»æ¤åˆ°å¤šç§ç¡¬ä»¶å¹³å°ï¼Œé‡‡ç”¨æœ¬åœ°ç¼–ç¨‹è¯­è¨€çš„éƒ¨åˆ†ä¹Ÿéœ€è¦é‡æ–°ç¼–è¯‘ã€‚æ¢å¥è¯è¯´ï¼Œä¸€æ—¦ä½¿ç”¨JNIå°±å¤±å»äº†Javaæ‰¿è¯ºçš„ç‰¹æ€§ï¼Œå³â€œä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œâ€ã€‚å…¶æ¬¡ï¼ŒJavaæ˜¯å¼ºç±»å‹å’Œå®‰å…¨çš„è¯­è¨€,æœ¬åœ°è¯­è¨€å¦‚Cæˆ–C++åˆ™ä¸æ˜¯ã€‚å› æ­¤ï¼ŒJavaå¼€å‘è€…ç”¨JNIç¼–å†™åº”ç”¨æ—¶å¿…é¡»æ ¼å¤–å°å¿ƒã€‚è¯¯ç”¨æœ¬åœ°æ–¹æ³•å¯èƒ½ç ´åæ•´ä¸ªåº”ç”¨ã€‚é‰´äºæ­¤ï¼Œåœ¨è°ƒJNIæ–¹æ³•å‰ï¼ŒJavaåº”ç”¨å¸¸å¸¸éœ€è¦å®‰ä»æ£€æŸ¥ã€‚é¢å¤–çš„å®‰å…¨æ£€æŸ¥ä»¥åŠHotSpot VMåœ¨Javaä¸JNIä¹‹é—´çš„æ•°æ®å¤åˆ¶ä¼šé™ä½åº”ç”¨çš„æ€§èƒ½ã€‚</p><p>HotSpot VMè¿½è¸ªæ­£åœ¨æ‰§è¡Œæœ¬åœ°æ–¹æ³•çš„çº¿ç¨‹æ—¶å¿…é¡»ç‰¹åˆ¥å°å¿ƒã€‚åœ¨HotSpot VMçš„æŸäº›æ´»åŠ¨è¿‡ç¨‹ä¸­ï¼Œå°¤å…¶æ˜¯åƒåœ¾æ”¶é›†çš„æŸäº›é˜¶æ®µï¼Œçº¿ç¨‹å¿…é¡»åœ¨å®‰å…¨ç‚¹æ—¶æš‚åœï¼Œä»¥ä¿è¯Javaå†…å­˜å †ä¸è¢«æ›´æ”¹ï¼Œç¡®ä¿åƒåœ¾æ”¶é›†çš„å‡†ç¡®æ€§ã€‚å½“HotSpot VMçº¿ç¨‹æ‰§è¡Œæœ¬åœ°ä»£ç åˆ°è¾¾å®‰å…¨ç‚¹æ—¶ï¼Œçº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œæœ¬åœ°ä»£ç ï¼Œç›´åˆ°å®ƒJavaä»£ç æˆ–è€…å‘èµ·JNIè°ƒç”¨ä¸ºæ­¢ã€‚</p><h3 id="VMè‡´å‘½é”™è¯¯å¤„ç†"><a href="#VMè‡´å‘½é”™è¯¯å¤„ç†" class="headerlink" title="VMè‡´å‘½é”™è¯¯å¤„ç†"></a>VMè‡´å‘½é”™è¯¯å¤„ç†</h3><p>HotSpotå†…éƒ¨ä½¿ç”¨ä¿¡å·è¿›è¡Œé€šä¿¡ã€‚å½“æ— æ³•è¯†åˆ«ä¿¡å·æ—¶ï¼Œå°†è°ƒç”¨è‡´å‘½é”™è¯¯å¤„ç†ç¨‹åºã€‚åœ¨æ— æ³•è¯†åˆ«çš„æƒ…å†µä¸‹ï¼Œå®ƒå¯èƒ½æ¥è‡ªåº”ç”¨ç¨‹åºJNIä»£ç ï¼ŒOSæœ¬åœ°åº“ï¼ŒJREæœ¬åœ°åº“æˆ–JVMæœ¬èº«çš„é”™è¯¯ã€‚</p><h2 id="HotSpot-VMåƒåœ¾æ”¶é›†å™¨"><a href="#HotSpot-VMåƒåœ¾æ”¶é›†å™¨" class="headerlink" title="HotSpot VMåƒåœ¾æ”¶é›†å™¨"></a>HotSpot VMåƒåœ¾æ”¶é›†å™¨</h2><h3 id="åˆ†ä»£åƒåœ¾æ”¶é›†"><a href="#åˆ†ä»£åƒåœ¾æ”¶é›†" class="headerlink" title="åˆ†ä»£åƒåœ¾æ”¶é›†"></a>åˆ†ä»£åƒåœ¾æ”¶é›†</h3><p>åƒåœ¾æ”¶é›†å™¨ä¸éœ€è¦æ‰«ææ•´ä¸ªï¼ˆå¯èƒ½æ¯”æ–°ç”Ÿä»£æ›´å¤§ï¼‰è€å¹´ä»£å°±èƒ½è¯†åˆ«æ–°ç”Ÿä»£ä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œä»è€Œç¼©çŸ­Minor GCçš„æ—¶é—´ã€‚<font color="DeepPink">HotSpot VMçš„åƒåœ¾æ”¶é›†å™¨ä½¿ç”¨ç§°ä¸ºå¡è¡¨ï¼ˆCardTable)çš„æ•°æ®ç»“æ„æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚è€å¹´ä»£ä»¥512å­—èŠ‚ä¸ºå—åˆ’åˆ†æˆè‹¥åå¼ å¡ï¼ˆCard)ã€‚å¡è¡¨æ˜¯ä¸ªå•å­—èŠ‚æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ å¯¹åº”å †ä¸­çš„ä¸€å¼ å¡ã€‚æ¯æ¬¡è€å¹´ä»£å¯¹è±¡ä¸­æŸä¸ªå¼•ç”¨æ–°ç”Ÿä»£çš„å­—æ®µå‘ç”Ÿå˜åŒ–æ—¶ï¼ŒHotSpot VMå°±å¿…é¡»å°†è¯¥å¡æ‰€å¯¹ä½çš„å¡è¡¨å…ƒç´ è®¾ç½®ä¸ºé€‚å½“çš„å€¼ï¼Œä»è€Œå°†è¯¥å¼•ç”¨å­—æ®µæ‰€åœ¨çš„å¡æ ‡è®°ä¸ºè„ã€‚åœ¨Minor GCè¿‡ç¨‹ä¸­ï¼Œåƒåœ¾æ”¶é›†å™¨åªä¼šåœ¨è„å¡ä¸­æ‰«ææŸ¥æ‰¾è€å¹´ä»£-æ–°ç”Ÿä»£å¼•ç”¨ã€‚</font></p><p><img alt data-src="/images/java-performance-note/%E5%9B%BE3-3.png"></p><p><font color="DeepPink">HotSpot VMçš„å­—èŠ‚ç è§£é‡Šå™¨å’ŒJITç¼–è¯‘å™¨ä½¿ç”¨å†™å±éšœ(Write Barrier)ç»´æŠ¤å¡è¡¨ã€‚</font>å†™å±éšœæ˜¯ä¸€å°æ®µå°†å¡çŠ¶æ€è®¾ç½ä¸ºè„çš„ä»£ç ã€‚è§£é‡Šå™¨æ¯æ¬¡æ‰§è¡Œæ›´æ–°å¼•ç”¨çš„å­—èŠ‚ç æ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€æ®µå†™å±éšœï¼›JIT ç¼–è¯‘å™¨åœ¨ç”Ÿæˆæ›´æ–°å¼•ç”¨çš„ä»£ç åï¼Œä¹Ÿä¼šç”Ÿæˆä¸€æ®µå†™å±éšœã€‚è™½ç„¶å†™å±éšœä½¿å¾—åº”ç”¨çº¿ç¨‹å¢åŠ äº†ä¸€äº›æ€§èƒ½å¼€é”€ï¼Œä½†Minor GCå˜å¿«äº†è®¸å¤šï¼Œæ•´å¤©çš„åƒåœ¾æ”¶é›†æ•ˆç‡ä¹Ÿæé«˜äº†è®¸å¤šã€‚é€šå¸¸åº”ç”¨çš„ååé‡ä¹Ÿä¼šæœ‰æ‰€æ”¹å–„ã€‚</p><h3 id="æ–°ç”Ÿä»£"><a href="#æ–°ç”Ÿä»£" class="headerlink" title="æ–°ç”Ÿä»£"></a>æ–°ç”Ÿä»£</h3><p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œ<font color="DeepPink">åœ¨Minor GCè¿‡ç¨‹ä¸­ï¼ŒSurvivorå¯èƒ½ä¸è¶³ä»¥å®¹çº³Edenå’Œå¦ä¸€ä¸ªSurvivorä¸­çš„å­˜æ´»å¯¹è±¡ã€‚å¦‚æœSurvivor ä¸­çš„å­˜æ´»å¯¹è±¡æº¢å‡ºï¼Œå¤šä½™çš„å¯¹è±¡å°†è¢«ç§»åˆ°è€å¹´ä»£ã€‚è¿™ç§°ä¸ºè¿‡æ—©æå‡(Premature Promotion)</font>ã€‚è¿™ä¼šå¯¼è‡´è€å¹´ä»£ä¸­çŸ­æœŸå­˜æ´»å¯¹è±¡çš„å¢é•¿ï¼Œå¯èƒ½ä¼šå¼•å‘ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚å†è¿›ä¸€æ­¥è¯´ï¼Œåœ¨Minor GCè¿‡ç¨‹ä¸­ï¼Œå¦‚æœè€å¹´ä»£æ»¡äº†è€Œæ— æ³•å®¹çº³æ›´å¤šçš„å¯¹è±¡ï¼ŒMinor GCä¹‹åé€šå¸¸å°±ä¼šè¿›è¡ŒFull GC,è¿™å°†å¯¼è‡´éå†æ•´ä¸ªJavaå †ã€‚è¿™ç§°ä¸ºæå‡å¤±è´¥ï¼ˆPromotion Failureï¼‰ã€‚</p><h3 id="å¿«é€Ÿå†…å­˜åˆ†é…"><a href="#å¿«é€Ÿå†…å­˜åˆ†é…" class="headerlink" title="å¿«é€Ÿå†…å­˜åˆ†é…"></a>å¿«é€Ÿå†…å­˜åˆ†é…</h3><p>å¯¹è±¡å†…å­˜åˆ†é…å™¨çš„æ“ä½œéœ€è¦å’Œåƒåœ¾æ”¶é›†å™¨ç´§å¯†é…åˆã€‚åƒåœ¾æ”¶é›†å™¨å¿…é¡»è®°å½•å®ƒå†‹æ”¶çš„ç©ºé—´ï¼Œè€Œåˆ†é…å™¨åœ¨é‡ç”¨å †ç©ºé—´ä¹‹å‰éœ€è¦æ‰¾åˆ°å¯ä»¥æ»¡è¶³å…¶åˆ†é…éœ€æ±‚çš„ç©ºé—²ç©ºé—´ã€‚åƒåœ¾æ”¶é›†å™¨ä»¥å¤åˆ¶æ–¹å¼å›æ”¶HotSpot VMæ–°ç”Ÿä»£ï¼Œå…¶å¥½å¤„åœ¨äºå›æ”¶ä»¥åEdenæ€»ä¸ºç©ºï¼Œåœ¨Edenä¸­è¿ç”¨è¢«ç§°ä¸ºæŒ‡è®¡ç¢°æ’(Bump-the-Pointer)çš„æŠ€æœ¯å°±å¯ä»¥æœ‰æ•ˆåœ°åˆ†é…ç©ºé—´ã€‚è¿™ç§æŠ€æœ¯è¿½è¸ªæœ€åä¸€ä¸ªåˆ†é…çš„å¯¹è±¡ï¼ˆå¸¸ç§°ä¸ºtop),å½“æœ‰æ–°çš„åˆ†é…è¯·æ±‚æ—¶ï¼Œåˆ†é…å™¨åªéœ€è¦æ£€æŸ¥topå’Œedenæœªç«¯ä¹‹é—´çš„ç©ºé—´æ˜¯å¦èƒ½å®¹çº³ã€‚å¦‚æœèƒ½å®¹çº³ï¼Œtopåˆ™è·³åˆ°æ–°è¿‘åˆ†é…å¯¹è±¡çš„æœªç«¯ã€‚</p><p><font color="DeepPink">é‡è¦çš„Javaåº”ç”¨å¤§å¤šæ˜¯å¤šçº¿ç¨‹çš„ï¼Œå› æ­¤å†…å­˜åˆ†é…çš„æ“ä½œéœ€è¦è€ƒè™‘å¤šçº¿ç¨‹å®‰å…¨ã€‚å¦‚æœåªç”¨å…¨å±€é”ï¼Œåœ¨Edenä¸­çš„åˆ†é…æ“ä½œå°±ä¼šæˆä¸ºç“¶é¢ˆè€Œé™ä½æ€§èƒ½ã€‚HotSpot VMæ²¡æœ‰é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œè€Œæ˜¯ä»¥ä¸€ç§ç§°ä¸ºçº¿ç¨‹æœ¬åœ°åˆ†é…ç¼“å†²åŒºï¼ˆthread-Local Allocation Buffer,TLAB)çš„æŠ€æœ¯ï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹è®¾è®¾ç½®å„è‡ªçš„ç¼“å†²åŒº(å³Edençš„ä¸€å°å—ï¼‰ï¼Œä»¥æ­¤æ”¹å–„å¤šçº¿ç¨‹åˆ†é…çš„ååé‡ã€‚å› ä¸ºæ¯ä¸ªTLABéƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä»ä¸­åˆ†é…å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æŒ‡é’ˆç¢°æ’æŠ€æœ¯å¿«é€Ÿåˆ†é…è€Œä¸éœ€è¦ä»»ä½•é”ã€‚ç„¶è€Œå½“çº¿ç¨‹çš„TLABå¡«æ»¡éœ€è¦è·å–æ–°çš„ç©ºé—´æ—¶ï¼ˆä¸å¸¸è§ï¼‰ï¼Œå®ƒå°±éœ€è¦é‡‡ç”¨å¤šçº¿ç¨‹å®‰å…¨çš„æ–¹å¼äº†ã€‚å¤§éƒ¨åˆ†æ—¶å€™ï¼ŒHotSpot VMçš„new Object()æ“ä½œåªéœ€è¦å¤§çº¦åæ¡æŒ‡ä»¤ã€‚åƒåœ¾æ”¶é›†å™¨æ¸…ç©ºEdenåŒºåŸŸï¼Œç„¶åå°±å¯ä»¥æ”¯æŒå¿«é€Ÿå†…å­˜åˆ†é…äº†ã€‚</font></p><h2 id="HotSpot-VM-JITç¼–è¯‘å™¨"><a href="#HotSpot-VM-JITç¼–è¯‘å™¨" class="headerlink" title="HotSpot VM JITç¼–è¯‘å™¨"></a>HotSpot VM JITç¼–è¯‘å™¨</h2><p>ç»å…¸çš„å¯„å­˜å™¨åˆ†é…ç­–ç•¥æ˜¯å›¾ç€è‰²ç®—æ³•ï¼Œé€šå¸¸å¯ä»¥ä½¿æœºå™¨å¯„å­˜å™¨çš„ä½¿ç”¨ç‡è¾¾åˆ°æœ€é«˜ï¼Œè€Œä¸”å¤šä½™çš„å€¼å¾ˆå°‘ä¼šå¸è½½åˆ°æ ˆä¸­ã€‚å›¾è¡¨ç¤ºçš„æ˜¯åŒæ—¶æœ‰å“ªäº›å˜é‡åœ¨ä½¿ç”¨ï¼ä»¥åŠå“ªäº›å¯„å­˜å™¨å¯ä»¥å­˜æ”¾è¿™äº›å˜è™½ã€‚å¦‚æœåŒæ—¶å­˜æ´»çš„å˜é‡æ•°è¶…è¿‡äº†å¯ç”¨çš„å¯„å­˜å™¨æ•°ï¼Œé‡è¦æ€§æœ€ä½çš„å˜é‡å°†è¢«ç§»åˆ°æ ˆä¸­ï¼Œä½¿å¾—å…¶ä»–å˜é‡å¯ä»¥ä½¿ç”¨å¯„å­˜å™¨ã€‚æŒ‡æ´¾æŸä¸ªå˜é‡ç»™å¯„å­˜å™¨é€šå¸¸éœ€è¦æ¥å›å‡ æ¬¡æ„å»ºå›¾å’Œç€è‰²ã€‚è¿™ä¹Ÿå¯¼è‡´äº†å®ƒçš„ä¸è¶³ï¼Œå›¾ç€è‰²ç®—æ³•èŠ±è´¹çš„æ—¶é—´ã€æ•°æ®ç»“æ„æ‰€éœ€çš„ç©ºé—´éƒ½æ¯”è¾ƒæ˜‚è´µã€‚</p><h1 id="JVMæ€§èƒ½ç›‘æ§"><a href="#JVMæ€§èƒ½ç›‘æ§" class="headerlink" title="JVMæ€§èƒ½ç›‘æ§"></a>JVMæ€§èƒ½ç›‘æ§</h1><h2 id="åƒåœ¾æ”¶é›†"><a href="#åƒåœ¾æ”¶é›†" class="headerlink" title="åƒåœ¾æ”¶é›†"></a>åƒåœ¾æ”¶é›†</h2><h3 id="é‡è¦çš„åƒåœ¾æ”¶é›†æ•°æ®"><a href="#é‡è¦çš„åƒåœ¾æ”¶é›†æ•°æ®" class="headerlink" title="é‡è¦çš„åƒåœ¾æ”¶é›†æ•°æ®"></a>é‡è¦çš„åƒåœ¾æ”¶é›†æ•°æ®</h3><p>é‡è¦çš„åƒåœ¾æ”¶é›†æ•°æ®åŒ…æ‹¬ï¼š</p><ul><li>å½“å‰ä½¿ç”¨çš„åƒåœ¾æ”¶é›†å™¨</li><li>Javaå †çš„å¤§å°</li><li>æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„å¤§å°</li><li>æ°¸ä¹…ä»£çš„å¤§å°</li><li>Minor GCçš„æŒç»­æ—¶é—´</li><li>Minor GCçš„é¢‘ç‡</li><li>Minor GCçš„ç©ºé—´å›æ”¶é‡</li><li>Full GCçš„æŒç»­æ—¶é—´</li><li>Full GCçš„é¢‘ç‡</li><li>æ¯ä¸ªå¹¶å‘åƒåœ¾æ”¶é›†å‘¨æœŸå†…çš„ç©ºé—´å›æ”¶é‡</li><li>åƒåœ¾æ”¶é›†å‰åJavaå †çš„å ç”¨é‡</li><li>åƒåœ¾æ”¶é›†å‰åæ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„å ç”¨é‡</li><li>åƒåœ¾æ”¶é›†å‰åæ°¸ä¹…ä»£çš„å ç”¨é‡</li><li>æ˜¯å¦è€å¹´ä»£æˆ–æ°¸ä¹…ä»£çš„å ç”¨è§¦å‘äº† Full GC</li><li>åº”ç”¨æ˜¯å¦æ˜¾å¼è°ƒç”¨äº† System.gc()</li></ul><h3 id="åƒåœ¾å›æ”¶æŠ¥å‘Š"><a href="#åƒåœ¾å›æ”¶æŠ¥å‘Š" class="headerlink" title="åƒåœ¾å›æ”¶æŠ¥å‘Š"></a>åƒåœ¾å›æ”¶æŠ¥å‘Š</h3><h3 id="JITç¼–è¯‘å™¨"><a href="#JITç¼–è¯‘å™¨" class="headerlink" title="JITç¼–è¯‘å™¨"></a>JITç¼–è¯‘å™¨</h3><p>å¯ä»¥ä½¿ç”¨-XX:+PrintCompilationç›‘æ§HotSpot JITç¼–è¯‘å™¨ã€‚-XX:+PrintCompilationä¸ºæ¯æ¬¡ç¼–è¯‘ç”Ÿæˆä¸€è¡Œæ—¥å¿—ã€‚</p><p>æ—¥å¿—æ ·ä¾‹å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">7java. lang String: indexOf (151 bytes)</span><br><span class="line">8% !sun. awt. image. PNGImageDecoder: produceImage a 960 (1920 bytes)</span><br><span class="line">9  !sun awt. image. PNGImageDecoder: produceImage (1920 bytes)</span><br><span class="line">10java. lang. AbstractStringBuilder: append(40 bytes)</span><br><span class="line">11njava. lang System: arraycopy (static)</span><br><span class="line">12sjava util. Hashtable: get (69 bytes)</span><br><span class="line">13bjava util. HashMap: indexFor (6 bytes)</span><br><span class="line">14made zombie java. awt. geom. Path2DSIterator: isDone (20 bytes)</span><br></pre></td></tr></table></figure><h1 id="JVMæ€§èƒ½è°ƒä¼˜å…¥é—¨"><a href="#JVMæ€§èƒ½è°ƒä¼˜å…¥é—¨" class="headerlink" title="JVMæ€§èƒ½è°ƒä¼˜å…¥é—¨"></a>JVMæ€§èƒ½è°ƒä¼˜å…¥é—¨</h1><h2 id="åº”ç”¨ç¨‹åºçš„ç³»ç»Ÿéœ€æ±‚"><a href="#åº”ç”¨ç¨‹åºçš„ç³»ç»Ÿéœ€æ±‚" class="headerlink" title="åº”ç”¨ç¨‹åºçš„ç³»ç»Ÿéœ€æ±‚"></a>åº”ç”¨ç¨‹åºçš„ç³»ç»Ÿéœ€æ±‚</h2><h3 id="ååé‡"><a href="#ååé‡" class="headerlink" title="ååé‡"></a>ååé‡</h3><p><font color="DeepPink">ååé‡æ˜¯å¯¹å•ä½æ—¶é—´å†…å¤„ç†å·¥ä½œé‡çš„åº¦é‡</font>ã€‚è®¾è®¡ååé‡éœ€æ±‚æ—¶,æˆ‘ä»¬ä¸€èˆ¬ä¸è€ƒè™‘å®ƒå¯¹å»¶è¿Ÿæˆ–è€…å“åº”æ—¶é—´çš„å½±å“ã€‚é€šå¸¸æƒ…å†µä¸‹,å¢åŠ ååé‡çš„ä»£ä»·æ˜¯å»¶è¿Ÿçš„å¢åŠ æˆ–å†…å­˜ä½¿ç”¨çš„å¢åŠ ã€‚</p><p>ååé‡æ€§èƒ½éœ€æ±‚çš„ä¸€ä¸ªå…¸å‹ä¾‹å­æ˜¯,åº”ç”¨ç¨‹åºæ¯ç§’éœ€è¦å®Œæˆ2500æ¬¡äº‹åŠ¡ã€‚</p><h3 id="å»¶è¿Ÿæˆ–å“åº”æ€§"><a href="#å»¶è¿Ÿæˆ–å“åº”æ€§" class="headerlink" title="å»¶è¿Ÿæˆ–å“åº”æ€§"></a>å»¶è¿Ÿæˆ–å“åº”æ€§</h3><p><font color="DeepPink">å»¶è¿Ÿ,æˆ–è€…å“åº”æ€§,æ˜¯å¯¹åº”ç”¨ç¨‹åºæ”¶åˆ°æŒ‡ä»¤å¼€å§‹å·¥ä½œç›´åˆ°å®Œæˆè¯¥å·¥ä½œæ‰€æ¶ˆè€—æ—¶é—´çš„åº¦é‡ã€‚</font></p><p>å®šä¹‰å»¶è¿Ÿæˆ–å“åº”æ€§éœ€æ±‚æ—¶å¹¶ä¸è€ƒè™‘ç¨‹åºçš„ååé‡ã€‚é€šå¸¸æƒ…å†µä¸‹,æé«˜å“åº”æ€§æˆ–ç¼©å°å»¶è¿Ÿçš„ä»£ä»·æ˜¯æ›´ä½çš„ååé‡ã€æˆ–è€…æ›´å¤šçš„å†…å­˜æ¶ˆè€—(æˆ–è€…äºŒè€…åŒæ—¶å‘ç”Ÿ)</p><p>å»¶è¿Ÿæˆ–å“åº”éœ€æ±‚çš„ä¸€ä¸ªå…¸å‹ä¾‹å­æ˜¯,åº”ç”¨ç¨‹åºåº”è¯¥åœ¨60æ¯«ç§’å†…å®Œæˆäº¤æ˜“è¯·æ±‚çš„å¤„ç†å·¥ä½œã€‚</p><h3 id="å†…å­˜å ç”¨"><a href="#å†…å­˜å ç”¨" class="headerlink" title="å†…å­˜å ç”¨"></a>å†…å­˜å ç”¨</h3><p><font color="DeepPink">å†…å­˜å ç”¨æŒ‡åœ¨åŒç­‰ç¨‹åº¦çš„ååé‡ã€å»¶è¿Ÿã€å¯ç”¨æ€§å’Œå¯ç®¡ç†æ€§å‰æä¸‹,è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„å†…å­˜å¤§å°ã€‚</font>å†…å­˜å ç”¨é€šå¸¸ä»¥è¿è¡Œåº”ç”¨ç¨‹åºéœ€è¦çš„Javaå †å¤§å°æˆ–è€…è¿è¡Œåº”ç”¨ç¨‹åºéœ€è¦çš„æ€»å†…å­˜å¤§å°æ¥è¡¨è¿°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹,é€šè¿‡å¢å¤§Javaå †çš„æ–¹å¼å¢åŠ å¯ç”¨å†…å­˜èƒ½å¤Ÿæé«˜ååé‡ã€é™ä½å»¶è¿Ÿæˆ–è€…å…¼é¡¾äºŒè€…ã€‚åº”ç”¨ç¨‹åºçš„å¯ç”¨å†…å­˜å‡å°‘æ—¶,ååé‡å’Œå»¶è¿Ÿé€šå¸¸éƒ½ä¼šå—åˆ°å½±å“ã€‚åº”ç”¨ç¨‹åºçš„å†…å­˜å ç”¨é™åˆ¶äº†å›ºå®šå†…å­˜çš„æœºå™¨ä¸Šèƒ½åŒæ—¶è¿è¡Œçš„åº”ç”¨ç¨‹åºå®ä¾‹æ•°ã€‚</p><p>å†…å­˜å ç”¨éœ€æ±‚çš„ä¸€ä¸ªå…¸å‹ä¾‹å­æ˜¯,åº”ç”¨ç¨‹åºéœ€è¦åœ¨æ‹¥æœ‰8GBå†…å­˜çš„ç³»ç»Ÿä¸Šä»¥å•ä¸ªå®ä¾‹æ–¹å¼è¿è¡Œæˆ–è€…åœ¨24GBå†…å­˜çš„ç³»ç»Ÿä¸Šä»¥3ä¸ªåº”ç”¨ç¨‹åºå®ä¾‹æ–¹å¼è¿è¡Œã€‚</p><h2 id="æ€§èƒ½æ”¶é›†è°ƒä¼˜åŸºç¡€"><a href="#æ€§èƒ½æ”¶é›†è°ƒä¼˜åŸºç¡€" class="headerlink" title="æ€§èƒ½æ”¶é›†è°ƒä¼˜åŸºç¡€"></a>æ€§èƒ½æ”¶é›†è°ƒä¼˜åŸºç¡€</h2><h3 id="æ€§èƒ½å±æ€§"><a href="#æ€§èƒ½å±æ€§" class="headerlink" title="æ€§èƒ½å±æ€§"></a>æ€§èƒ½å±æ€§</h3><ul><li>ååé‡:æ˜¯è¯„ä»·åƒåœ¾æ”¶é›†å™¨èƒ½åŠ›çš„é‡è¦æŒ‡æ ‡ä¹‹ä¸€,æŒ‡ä¸è€ƒè™‘åƒåœ¾æ”¶é›†å¼•èµ·çš„åœé¡¿æ—¶é—´æˆ–å†…å­˜æ¶ˆè€—,åƒåœ¾æ”¶é›†å™¨èƒ½æ”¯æ’‘åº”ç”¨ç¨‹åºè¾¾åˆ°çš„æœ€é«˜æ€§èƒ½æŒ‡æ ‡ã€‚</li><li>å»¶è¿Ÿ:ä¹Ÿæ˜¯è¯„ä»·åƒåœ¾æ”¶é›†å™¨èƒ½åŠ›çš„é‡è¦æŒ‡æ ‡,åº¦é‡æ ‡å‡†æ˜¯ç¼©çŸ­ç”±äºåƒåœ¾æ”¶é›†å¼•èµ·çš„åœé¡¿æ—¶é—´æˆ–å®Œå…¨æ¶ˆé™¤å› åƒåœ¾æ”¶é›†æ‰€å¼•èµ·çš„åœé¡¿,é¿å…åº”ç”¨ç¨‹åºè¿è¡Œæ—¶å‘ç”ŸæŠ–åŠ¨ã€‚</li><li>å†…å­˜å ç”¨:åƒåœ¾æ”¶é›†å™¨æµç•…è¿è¡Œæ‰€éœ€è¦çš„å†…å­˜æ•°é‡ã€‚</li></ul><p><font color="DeepPink">è¿™å…¶ä¸­ä»»ä½•ä¸€ä¸ªå±æ€§æ€§èƒ½çš„æé«˜å‡ ä¹éƒ½æ˜¯ä»¥å¦ä¸€ä¸ªæˆ–ä¸¤ä¸ªå±æ€§æ€§èƒ½çš„æŸå¤±ä½œä»£ä»·çš„ã€‚æ¢å¥è¯è¯´,æŸä¸€ä¸ªå±æ€§ä¸Šçš„æ€§èƒ½æé«˜æ€»ä¼šç‰ºç‰²å¦ä¸€ä¸ªæˆ–ä¸¤ä¸ªå±æ€§ã€‚ç„¶è€Œ,å¯¹å¤§å¤šæ•°çš„åº”ç”¨è€Œè¨€,æå°‘å‡ºç°è¿™ä¸‰ä¸ªå±æ€§çš„é‡è¦ç¨‹åº¦éƒ½åŒç­‰çš„æƒ…å†µã€‚å¾ˆå¤šæ—¶å€™,æŸä¸€ä¸ªæˆ–ä¸¤ä¸ªå±æ€§çš„æ€§èƒ½è¦æ¯”å¦ä¸€ä¸ªé‡è¦ã€‚</font></p><p>æˆ‘ä»¬éœ€è¦äº†è§£å¯¹åº”ç”¨ç¨‹åºè€Œè¨€å“ªäº›ç³»ç»Ÿéœ€æ±‚æ˜¯æœ€é‡è¦çš„,ä¹Ÿéœ€è¦çŸ¥é“å¯¹åº”ç”¨ç¨‹åºè€Œè¨€è¿™ä¸‰ä¸ªæ€§èƒ½å±æ€§å“ªäº›æ˜¯æœ€é‡è¦çš„ã€‚ç¡®å®šå“ªäº›å±æ€§æœ€é‡è¦,å¹¶å°†å…¶æ˜ å°„åˆ°åº”ç”¨ç¨‹åºçš„ç³»ç»Ÿéœ€æ±‚,å¯¹åº”ç”¨ç¨‹åºè€Œè¨€éå¸¸é‡è¦ã€‚</p><h3 id="åŸåˆ™"><a href="#åŸåˆ™" class="headerlink" title="åŸåˆ™"></a>åŸåˆ™</h3><p>è°ˆåˆ°JVMåƒåœ¾æ”¶é›†å™¨è°ƒä¼˜ä¹Ÿæœ‰ä¸‰ä¸ªéœ€è¦ç†è§£çš„åŸºæœ¬åŸåˆ™ã€‚</p><ul><li>æ¯æ¬¡Minor GCéƒ½å°½å¯èƒ½å¤šåœ°æ”¶é›†åƒåœ¾å¯¹è±¡ã€‚æˆ‘ä»¬æŠŠè¿™ç§°ä½œâ€œ<font color="DeepPink">Minor GCå›æ”¶åŸåˆ™</font>â€ã€‚éµå®ˆè¿™åŸåˆ™å¯ä»¥å‡å°‘åº”ç”¨ç¨‹åºå‘ç”Ÿ Full GCçš„é¢‘ç‡ã€‚Full GCçš„æŒç»­æ—¶é—´æ€»æ˜¯æœ€é•¿çš„,æ˜¯åº”ç”¨ç¨‹åºæ— æ³•è¾¾åˆ°å…¶å»¶è¿Ÿæˆ–ååé‡è¦æ±‚çš„ç½ªé­ç¥¸é¦–ã€‚</li><li>å¤„ç†ååé‡å’Œå»¶è¿Ÿé—®é¢˜æ—¶,åƒåœ¾å¤„ç†å™¨èƒ½ä½¿ç”¨çš„å†…å­˜è¶Šå¤§,å³Javaå †ç©ºé—´è¶Šå¤§,åƒåœ¾æ”¶é›†çš„æ•ˆæœè¶Šå¥½,åº”ç”¨ç¨‹åºè¿è¡Œä¹Ÿè¶Šæµç•…ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œ<font color="DeepPink">GCå†…å­˜æœ€å¤§åŒ–åŸåˆ™</font>â€ã€‚</li><li>åœ¨è¿™ä¸‰ä¸ªæ€§èƒ½å±æ€§(ååé‡ã€å»¶è¿Ÿã€å†…å­˜å ç”¨)ä¸­ä»»æ„é€‰æ‹©ä¸¤ä¸ªè¿›è¡ŒJVMåƒåœ¾æ”¶é›†å™¨è°ƒä¼˜ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œ<font color="DeepPink">GCè°ƒä¼˜çš„3é€‰2åŸåˆ™</font>â€ã€‚</li></ul><p>è°ƒä¼˜JVMåƒåœ¾æ”¶é›†çš„è¿‡ç¨‹ä¸­è°¨è®°è¿™ä¸‰æ¡åŸåˆ™èƒ½å¸®åŠ©ä½ æ›´è½»æ¾åœ°è°ƒä¼˜åƒåœ¾æ”¶é›†,è¾¾åˆ°åº”ç”¨ç¨‹åºçš„æ€§èƒ½è¦æ±‚ã€‚</p><h2 id="ç¡®å®šå†…å­˜å ç”¨"><a href="#ç¡®å®šå†…å­˜å ç”¨" class="headerlink" title="ç¡®å®šå†…å­˜å ç”¨"></a>ç¡®å®šå†…å­˜å ç”¨</h2><h3 id="HotSpot-VMå †å¸ƒå±€"><a href="#HotSpot-VMå †å¸ƒå±€" class="headerlink" title="HotSpot VMå †å¸ƒå±€"></a>HotSpot VMå †å¸ƒå±€</h3><p>é€šè¿‡-Xmnå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è®¾å®šæ–°ç”Ÿä»£ç©ºé—´çš„åˆå§‹å€¼å’Œæœ€å¤§å€¼ã€‚æœ‰ä¸€ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„,å¦‚æœ-Xmså’Œ-â…ªmxå¹¶æ²¡æœ‰è®¾å®šä¸ºåŒä¸€ä¸ªå€¼,ä½¿ç”¨-Xmné€‰é¡¹æ—¶,Javaå †çš„å¤§å°å˜åŒ–ä¸ä¼šå½±å“æ–°ç”Ÿä»£ç©ºé—´,å³æ–°ç”Ÿä»£ç©ºé—´çš„å¤§å°æ€»ä¿æŒæ’å®š,è€Œä¸æ˜¯éšç€Javaå †å¤§å°çš„æ‰©å±•æˆ–ç¼©å‡åšç›¸åº”çš„è°ƒæ•´ã€‚å› æ­¤,è¯·æ³¨æ„,<font color="DeepPink">åªæœ‰åœ¨-Xmsä¸-Xmxè®¾å®šä¸ºåŒä¸€å€¼æ—¶æ‰ä½¿ç”¨-Xmné€‰é¡¹ã€‚</font></p><p>è€å¹´ä»£ç©ºé—´çš„å¤§å°ä¼šæ ¹æ®æ–°ç”Ÿä»£çš„å¤§å°éšå¼è®¾å®šã€‚è€å¹´ä»£ç©ºé—´çš„åˆå§‹å€¼ä¸º-Xmxçš„å€¼å‡å»XX:    NewSizeçš„å€¼ã€‚è€å¹´ä»£ç©ºé—´çš„æœ€å°å€¼ä¸º-Xmxçš„å€¼å‡å»-XX:MaxNewSizeçš„å€¼ã€‚å¦‚æœ-Xmsä¸Xmxè®¾ç½®ä¸ºåŒä¸€å€¼,åŒæ—¶ä½¿ç”¨äº†-Xmn,æˆ–è€…-XX:NewSizeä¸-XX:MaxNewsizeä¸€æ ·,åˆ™è€å¹´ä»£çš„å¤§å°ä¸º-Xmx(æˆ–-Xms)çš„å€¼å‡å»-Xmnã€‚</p><p>å®é™…ä¸Š,å½“HotSpot VMå‘ç°å½“å‰å¯ç”¨ç©ºé—´ä¸è¶³ä»¥å®¹çº³ä¸‹ä¸€æ¬¡Minor GCæå‡çš„å¯¹è±¡æ—¶å°±ä¼šè¿›è¡ŒFull GCã€‚ä¸å› ç©ºé—´é—®é¢˜å¯¼è‡´çš„Minor GCè¿‡ç¨‹ä¸­çš„å¯¹è±¡æå‡å¤±è´¥æ¯”è¾ƒèµ·æ¥,è¿™ç§æ–¹å¼çš„ä»£ä»·è¦å°å¾—å¤šã€‚ä»å¤±è´¥çš„å¯¹è±¡æå‡ä¸­æ¢å¤æ˜¯ä¸€ä¸ªå¾ˆæ˜‚è´µçš„æ“ä½œã€‚æ°¸ä¹…ä»£æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜å‚¨æ–°çš„VMæˆ–ç±»å…ƒæ•°æ®æ—¶ä¹Ÿä¼šå‘ç”ŸFull GCã€‚</p><p>å¦‚æœFull GCç¼˜äºè€å¹´ä»£ç©ºé—´å·²æ»¡,å³ä½¿æ°¸ä¹…ä»£ç©ºé—´å¹¶æ²¡æœ‰ç”¨å°½,è€å¹´ä»£å’Œæ°¸ä¹…ä»£éƒ½ä¼šè¿›è¡Œåƒåœ¾æ”¶é›†ã€‚åŒæ ·,å¦‚æœFull GCç”±æ°¸ä¹…ä»£ç©ºé—´ç”¨å°½å¼•èµ·,è€å¹´ä»£å’Œæ°¸ä¹…ä»£ä¹Ÿéƒ½ä¼šè¿›è¡Œåƒåœ¾æ”¶é›†,æ— è®ºè€å¹´ä»£æ˜¯å¦è¿˜æœ‰ç©ºé—²ç©ºé—´ã€‚å¼€å¯-XX:+UseParallelGCæˆ–-XX:+UseParallelOldGCæ—¶,å¦‚æœå…³é—­-XX:-ScavengeBeforeFullGC, HotSpot VMåœ¨Full GCä¹‹å‰ä¸ä¼šè¿›è¡ŒMinor GC,ä½†Full GCè¿‡ç¨‹ä¸­ä¾ç„¶ä¼šæ”¶é›†æ–°ç”Ÿä»£;å¦‚æœå¼€å¯-XX:+ScavengeBeforeFullGC, HotSpot VMåœ¨Full GCå‰ä¼šå…ˆåšä¸€æ¬¡Minor GC,åˆ†æ‹…ä¸€éƒ¨åˆ†Full GCåŸæœ¬è¦åšçš„å·¥ä½œã€‚</p><h3 id="å †å¤§å°è°ƒä¼˜ç€çœ¼ç‚¹"><a href="#å †å¤§å°è°ƒä¼˜ç€çœ¼ç‚¹" class="headerlink" title="å †å¤§å°è°ƒä¼˜ç€çœ¼ç‚¹"></a>å †å¤§å°è°ƒä¼˜ç€çœ¼ç‚¹</h3><p>å¦‚æœä½ ä½¿ç”¨çš„HotSpot VMä¸æ¥å—-XX:+UseParallelOldGCé€‰é¡¹,å¯ä»¥ä½¿ç”¨-XX:+UseParallelGCä»£æ›¿ã€‚å¦‚æœä½ å¾ˆæ¸…æ¥šJavaåº”ç”¨ç¨‹åºè¦ä½¿ç”¨å¤šå¤§çš„Javaå †ç©ºé—´,å¯ä»¥å°†Javaå †å¤§å°ä½œä¸ºè°ƒä¼˜çš„å…¥æ‰‹ç‚¹,ä½¿ç”¨-Xmxå’Œ-Xmsè®¾ç½®Javaå †çš„å¤§å°ã€‚å¦‚æœä½ ä¸æ¸…æ¥šJavaåº”ç”¨ç¨‹åºåˆ°åº•éœ€è¦ä½¿ç”¨å¤šå¤§çš„Javaå †,å¯ä»¥åˆ©ç”¨HotSpot VMè‡ªåŠ¨é€‰å–Javaå †çš„å¤§å°ã€‚å¯åŠ¨Javaåº”ç”¨ç¨‹åºæ—¶ä¸æŒ‡å®š-Xmxæˆ–-Xmsçš„å€¼, HotSpot VMä¼šè‡ªåŠ¨è®¾å®šJavaå †å¤§å°çš„åˆå§‹å€¼ã€‚æ¢å¥è¯è¯´,è¿™æ˜¯ä¸€ä¸ªèµ·å§‹ç‚¹ã€‚éšç€è°ƒä¼˜è¿‡ç¨‹,åé¢ä¼šé€æ¸è°ƒæ•´Javaå †çš„å¤§å°ã€‚</p><p>é€šè¿‡HotSpotå‘½ä»¤è¡Œé€‰é¡¹-XX:+PrintCommandLineFlagsè¿˜å¯ä»¥æŸ¥çœ‹å †çš„åˆå§‹å€¼åŠæœ€å¤§å€¼ã€‚-XX:+PrintCommandlineFlagsé€‰é¡¹å¯ä»¥è¾“å‡ºHotSpot VMåˆå§‹åŒ–æ—¶ä½¿ç”¨-XX:InitialHeapSize=&lt;n&gt; -XX:MaxHeapSize=&lt;m&gt;æŒ‡å®šçš„å †çš„åˆå§‹å€¼åŠæœ€å¤§å€¼,å…¶ä¸­&lt;n&gt;æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„åˆå§‹Javaå †å¤§å°,&lt;m&gt;æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„å †çš„æœ€å¤§å€¼ã€‚</p><h3 id="è®¡ç®—æ´»è·ƒæ•°æ®å¤§å°"><a href="#è®¡ç®—æ´»è·ƒæ•°æ®å¤§å°" class="headerlink" title="è®¡ç®—æ´»è·ƒæ•°æ®å¤§å°"></a>è®¡ç®—æ´»è·ƒæ•°æ®å¤§å°</h3><p><font color="DeepPink">æ´»è·ƒæ•°æ®å¤§å°æ˜¯åº”ç”¨ç¨‹åºè¿è¡Œäºç¨³å®šæ€æ—¶,é•¿æœŸå­˜æ´»çš„å¯¹è±¡åœ¨Javaå †ä¸­å ç”¨çš„ç©ºé—´å¤§å°ã€‚æ¢å¥è¯è¯´,æ´»è·ƒæ•°æ®å¤§å°æ˜¯åº”ç”¨ç¨‹åºè¿è¡Œäºç¨³å®šæ€,Full GCä¹‹åJavaå †ä¸­è€å¹´ä»£å’Œæ°¸ä¹…ä»£å ç”¨çš„ç©ºé—´å¤§å°ã€‚</font></p><p>Javaåº”ç”¨çš„æ´»è·ƒæ•°æ®å¤§å°å¯ä»¥é€šè¿‡GCæ—¥å¿—æ”¶é›†ã€‚æ´»è·ƒæ•°æ®å¤§å°åŒ…æ‹¬ä¸‹é¢çš„å†…å®¹:</p><ul><li>åº”ç”¨ç¨‹åºè¿è¡Œäºç¨³å®šæ€æ—¶,è€å¹´ä»£å ç”¨çš„Javaå †å¤§å°;</li><li>åº”ç”¨ç¨‹åºè¿è¡Œäºç¨³å®šæ€æ—¶,æ°¸ä¹…ä»£å ç”¨çš„Javaå †å¤§å°ã€‚</li></ul><p>é™¤äº†æ´»è·ƒæ•°æ®å¤§å°,ç¨³å®šæ€çš„Full GCä¹Ÿä¼šå¯¹å»¶è¿Ÿå¸¦æ¥ä¸¥é‡å½±å“ã€‚</p><p>ä¸ºäº†æ›´å¥½åœ°åº¦é‡åº”ç”¨ç¨‹åºçš„æ´»è·ƒæ•°æ®å¤§å°,æœ€å¥½åœ¨å¤šæ¬¡Full GCä¹‹åå†æŸ¥çœ‹Javaå †çš„å ç”¨æƒ…å†µã€‚å¦å¤–,éœ€è¦ç¡®ä¿Full GCå‘ç”Ÿæ—¶,åº”ç”¨ç¨‹åºæ­£å¤„äºç¨³å®šæ€ã€‚</p><p>å¦‚æœåº”ç”¨ç¨‹åºæ²¡æœ‰å‘ç”ŸFull GCæˆ–è€…ä¸ç»å¸¸å‘ç”ŸFull GC,ä½ å¯ä»¥ä½¿ç”¨JVMç›‘æ§å·¥å…·Visual VMæˆ–JConsoleäººå·¥è§¦å‘Full GCã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨HotSpot JDKå‘è¡Œç‰ˆä¸­æä¾›çš„jmapå‘½ä»¤,é€šè¿‡å‘½ä»¤è¡Œå¼ºåˆ¶è¿›è¡ŒFull GCã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„,jmapéœ€è¦ä½¿ç”¨- histo:liveå‘½ä»¤è¡Œé€‰é¡¹åŠJVMè¿›ç¨‹å·ã€‚JVMè¿›ç¨‹å·å¯ä»¥é€šè¿‡JDKçš„jså‘½ä»¤è·å¾—ã€‚ä¾‹å¦‚,Javaåº”ç”¨ç¨‹åºçš„JMè¿›ç¨‹å·æ˜¯348,ä½¿ç”¨jmapè§¦å‘Full GCçš„å‘½ä»¤è¡Œå¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap -histo: live 348</span><br></pre></td></tr></table></figure><p>jmapå‘½ä»¤è§¦å‘ Full GCçš„åŒæ—¶ä¹Ÿç”Ÿæˆä¸€ä»½åŒ…å«å¯¹è±¡åˆ†é…ä¿¡æ¯çš„å †åˆ†ææ–‡ä»¶ã€‚ä¸ºäº†ä¸“æ³¨æœ¬æ­¥æ“ä½œ,ä½ å¯ä»¥å¿½ç•¥ç”Ÿæˆçš„å †åˆ†ææ–‡ä»¶ã€‚</p><h3 id="åˆå§‹åŒ–å †å¤§å°é…ç½®"><a href="#åˆå§‹åŒ–å †å¤§å°é…ç½®" class="headerlink" title="åˆå§‹åŒ–å †å¤§å°é…ç½®"></a>åˆå§‹åŒ–å †å¤§å°é…ç½®</h3><p>æ¨èçš„åšæ³•æ˜¯åŸºäºæœ€å·®å»¶è¿Ÿè¿›è¡Œä¼°ç®—ã€‚</p><table><thead><tr><th>ç©ºé—´</th><th>å‘½ä»¤è¡Œé€‰é¡¹</th><th>å ç”¨å€æ•°</th></tr></thead><tbody><tr><td>Javaå †</td><td>-Xmså’Œ-Xmx</td><td>3-4å€Full GCåçš„è€å¹´ä»£ç©ºé—´å ç”¨é‡</td></tr><tr><td>æ°¸ä¹…ä»£</td><td>-XX:Permsize<br>-XX:MaxPermSize</td><td>1.2-1.5å€Full GCåçš„æ°¸ä¹…ä»£ç©ºé—´å ç”¨é‡</td></tr><tr><td>æ–°ç”Ÿä»£</td><td>-Xmn</td><td>1~1.5å€ Full GCåçš„è€å¹´ä»£ç©ºé—´å ç”¨é‡</td></tr><tr><td>è€å¹´ä»£</td><td>Javaå †å¤§å°å‡æ–°ç”Ÿä»£å¤§å°</td><td>2-3å€Full GCåçš„è€å¹´ä»£ç©ºé—´å ç”¨é‡</td></tr></tbody></table><h2 id="è°ƒä¼˜å»¶è¿Ÿ-å“åº”æ€§"><a href="#è°ƒä¼˜å»¶è¿Ÿ-å“åº”æ€§" class="headerlink" title="è°ƒä¼˜å»¶è¿Ÿ/å“åº”æ€§"></a>è°ƒä¼˜å»¶è¿Ÿ/å“åº”æ€§</h2><h3 id="è¾“å…¥"><a href="#è¾“å…¥" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h3><p>è¿™ä¸€æ­¥è°ƒä¼˜æœ‰å¤šä¸ªè¾“å…¥,éƒ½æºäºåº”ç”¨ç¨‹åºçš„ç³»ç»Ÿæ€§éœ€æ±‚ã€‚</p><ul><li>åº”ç”¨ç¨‹åºå¯æ¥å—çš„å¹³å‡åœæ»æ—¶é—´ã€‚å¹³å‡åœæ»æ—¶é—´å°†ä¸æµ‹é‡å‡ºçš„Minor GCæŒç»­æ—¶é—´è¿›è¡Œæ¯”è¾ƒã€‚</li><li>å¯æ¥å—çš„Minor GC(ä¼šå¯¼è‡´å»¶è¿Ÿ)é¢‘ç‡ã€‚ Minor GCçš„é¢‘ç‡å°†ä¸å¯å®¹å¿çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚å¯¹åº”ç”¨ç¨‹åºå¹²ç³»äººè€Œè¨€,GCæŒç»­çš„æ—¶é—´å¾€å¾€æ¯”GCå‘ç”Ÿçš„é¢‘ç‡æ›´é‡è¦ã€‚</li><li>åº”ç”¨ç¨‹åºå¹²ç³»äººå¯æ¥å—çš„åº”ç”¨ç¨‹åºçš„æœ€å¤§åœé¡¿æ—¶é—´ã€‚æœ€å¤§åœé¡¿æ—¶é—´å°†ä¸æœ€å·®æƒ…å†µä¸‹Full GCçš„æŒç»­æ—¶é—´è¿›è¡Œæ¯”è¾ƒã€‚</li><li>åº”ç”¨ç¨‹åºå¹²ç³»äººå¯æ¥å—çš„æœ€å¤§åœé¡¿å‘ç”Ÿçš„é¢‘ç‡ã€‚æœ€å¤§åœé¡¿å‘ç”Ÿçš„é¢‘ç‡åŸºæœ¬ä¸Šå°±æ˜¯Full GCçš„é¢‘ç‡ã€‚åŒæ ·,å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºå¹²ç³»äººè€Œè¨€,ç›¸å¯¹äºGCçš„é¢‘ç‡,ä»–ä»¬æ›´å…³å¿ƒGCæŒç»­çš„å¹³å‡åœé¡¿æ—¶é—´å’Œæœ€å¤§åœé¡¿æ—¶é—´ã€‚</li></ul><h3 id="ä¼˜åŒ–æ–°ç”Ÿä»£çš„å¤§å°"><a href="#ä¼˜åŒ–æ–°ç”Ÿä»£çš„å¤§å°" class="headerlink" title="ä¼˜åŒ–æ–°ç”Ÿä»£çš„å¤§å°"></a>ä¼˜åŒ–æ–°ç”Ÿä»£çš„å¤§å°</h3><p>è°ƒæ•´æ–°ç”Ÿä»£ç©ºé—´æ—¶,éœ€è¦è°¨è®°ä¸‹é¢å‡ ä¸ªå‡†åˆ™ï¼š</p><ul><li><font color="DeepPink">è€å¹´ä»£ç©ºé—´å¤§å°ä¸åº”è¯¥å°äºæ´»è·ƒæ•°æ®å¤§å°çš„1.5å€ã€‚</font></li><li><font color="DeepPink">æ–°ç”Ÿä»£ç©ºé—´è‡³å°‘åº”ä¸ºJavaå †å¤§å°çš„10%</font>,é€šè¿‡Xmxå’Œ-Xmså¯ä»¥è®¾å®šè¯¥å€¼ã€‚æ–°ç”Ÿä»£è¿‡å°å¯èƒ½é€‚å¾—å…¶å,ä¼šå¯¼è‡´é¢‘ç¹çš„Minor GCã€‚</li><li>å¢å¤§Javaå †å¤§å°æ—¶,éœ€è¦æ³¨æ„ä¸è¦è¶…è¿‡JVMå¯ç”¨çš„ç‰©ç†å†…å­˜æ•°ã€‚å †å ç”¨è¿‡å¤šå†…å­˜å°†å¯¼è‡´åº•å±‚ç³»ç»Ÿäº¤æ¢åˆ°è™šæ‹Ÿå†…å­˜,åè€Œä¼šé€ æˆåƒåœ¾æ”¶é›†å™¨å’Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½ä½ä¸‹ã€‚</li></ul><h3 id="ç›‘æ§æ™‹å‡é˜ˆå€¼"><a href="#ç›‘æ§æ™‹å‡é˜ˆå€¼" class="headerlink" title="ç›‘æ§æ™‹å‡é˜ˆå€¼"></a>ç›‘æ§æ™‹å‡é˜ˆå€¼</h3><p>æœ€å¤§æ™‹å‡é˜ˆå€¼å¯ä»¥é€šè¿‡HotSpot VMçš„å‘½ä»¤è¡Œé€‰é¡¹-XX: MaxTenuringThreshold=&lt;n&gt;è®¾ç½®ã€‚ä½¿ç”¨HotSpot VMçš„å‘½ä»¤è¡Œé€‰é¡¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX: +PrintTenuringDistribution</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç›‘æ§æ™‹å‡çš„åˆ†å¸ƒæˆ–è€…å¯¹è±¡å¹´é¾„åˆ†å¸ƒ,å¹¶ä»¥æ­¤ä¸ºä¾æ®ç¡®å®šæœ€ä¼˜çš„æœ€å¤§æ™‹å‡é˜ˆå€¼å€¼ã€‚</p><p>é€šè¿‡-XX:+PrintTenuringDistributionå‘½ä»¤è¡Œé€‰é¡¹å¯ä»¥è§‚å¯ŸSurvivorç©ºé—´ä¸­çš„å¯¹è±¡æ˜¯å¦‚ä½•è€åŒ–çš„ã€‚åœ¨-XX:+PrintTenuringDistributionç”Ÿæˆçš„è¾“å‡ºä¸­,æˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯éšç€å¯¹è±¡å¹´é¾„çš„å¢åŠ ,å„å¯¹è±¡å¹´é¾„ä¸Šå­—èŠ‚æ•°å‡å°‘çš„æƒ…å†µ,ä»¥åŠ HotSpot VMè®¡ç®—å‡ºçš„æ™‹å‡é˜ˆå€¼æ˜¯å¦ç­‰äºæˆ–æ¥è¿‘è®¾ç½®çš„æœ€å¤§æ™‹å‡é˜ˆå€¼ã€‚</p><p>XX:+PrintTenuringDistributionä¼šè¾“å‡ºæ¯æ¬¡Minor GCæ—¶æ™‹å‡åˆ†å¸ƒçš„æƒ…å†µã€‚å®ƒä¹Ÿå¯ä»¥å’Œå…¶ä»–çš„åƒåœ¾æ”¶é›†å‘½ä»¤è¡Œé€‰é¡¹,ä¾‹å¦‚-XX:+PrintGCDateStampsã€-XX:+PrintGcTime Stampsæˆ–-XX:+PrintgCDetailsé…åˆä½¿ç”¨ã€‚å¯¹Survivorç©ºé—´çš„æœ‰æ•ˆå¯¹è±¡è€åŒ–è¿›è¡Œå¾®è°ƒæ—¶,åº”è¯¥ä½¿ç”¨é€‰é¡¹XX:+PrintTenuringDistributionåœ¨åƒåœ¾æ”¶é›†æ—¥å¿—ä¸­åŒ…å«æ™‹å‡åˆ†å¸ƒçš„ç»Ÿè®¡ä¿¡æ¯ã€‚åŒæ ·,å¦‚æœéœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åˆ¤æ–­ä¸€ä¸ªåº”ç”¨ç¨‹åºäº‹ä»¶æ˜¯å¦æºäºä¸€æ¬¡Stop-The-Worldå‹ç¼©å¼åƒåœ¾æ”¶é›†,å¾€å¾€ä¹Ÿéœ€è¦è·å–æ™‹å‡åˆ†å¸ƒçš„æ—¥å¿—ä¿¡æ¯,ä½¿ç”¨è¯¥é€‰é¡¹æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚</p><blockquote><p><font color="DeepPink">é€šå¸¸æƒ…å†µä¸‹,è§‚å¯Ÿåˆ°æ–°çš„æ™‹å‡é˜ˆå€¼æŒç»­å°äºæœ€å¤§æ™‹å‡é˜ˆå€¼,æˆ–è€…è§‚å¯Ÿåˆ° Survivorç©ºé—´å¤§å°å°äºæ€»çš„å­˜æ´»å¯¹è±¡å¤§å°éƒ½è¡¨æ˜ Survivorç©ºé—´è¿‡å°ã€‚</font></p></blockquote><h3 id="è°ƒæ•´-Survivorç©ºé—´çš„å®¹é‡"><a href="#è°ƒæ•´-Survivorç©ºé—´çš„å®¹é‡" class="headerlink" title="è°ƒæ•´ Survivorç©ºé—´çš„å®¹é‡"></a>è°ƒæ•´ Survivorç©ºé—´çš„å®¹é‡</h3><p>è°ƒæ•´Survivorç©ºé—´å®¹é‡ä¸€ä¸ªåº”è¯¥è°¨è®°äºå¿ƒçš„é‡è¦åŸåˆ™:<font color="DeepPink">è°ƒæ•´Survivorç©ºé—´å®¹é‡æ—¶,å¦‚æœæ–°ç”Ÿä»£ç©ºé—´å¤§å°ä¸å˜,å¢å¤§Survivorç©ºé—´ä¼šå‡å°‘Edenç©ºé—´;è€Œå‡å°‘Edenç©ºé—´ä¼šå¢åŠ Minor GCçš„é¢‘ç‡ã€‚</font>å› æ­¤,ä¸ºäº†åŒæ—¶æ»¡è¶³åº”ç”¨ç¨‹åºMinor GCé¢‘ç‡çš„è¦æ±‚,å°±éœ€è¦å¢å¤§å½“å‰æ–°ç”Ÿä»£ç©ºé—´çš„å¤§å°;å³å¢å¤§Survivorç©ºé—´å¤§å°æ—¶,Edenç©ºé—´çš„å¤§å°åº”è¯¥ä¿æŒä¸å˜ã€‚æ¢å¥è¯è¯´,æ¯å½“ Survivorç©ºé—´å¢åŠ æ—¶,æ–°ç”Ÿä»£ç©ºé—´éƒ½åº”è¯¥å¢å¤§ã€‚å¦‚æœå¯ä»¥å¢å¤§Minor GCçš„é¢‘ç‡,ä½ å¯ä»¥é€‰æ‹©ç”¨ä¸€éƒ¨åˆ†Edenç©ºé—´æ¥å¢å¤§Survivorç©ºé—´,æˆ–è€…ç›´æ¥å¢å¤§æ–°ç”Ÿä»£ç©ºé—´å¤§å°ã€‚å¦‚æœå†…å­˜è¶³å¤Ÿ,ç›¸å¯¹äºå‡å°‘Edenç©ºé—´.å¢åŠ æ–°ç”Ÿä»£å¤§å°é€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ä¿æŒEdenç©ºé—´å¤§å°æ’å®š, Minor GCçš„é¢‘ç‡å°±ä¸ä¼šç”±äºSurvivorç©ºé—´å¢å¤§è€Œå‘ç”Ÿå˜åŒ–ã€‚</p><blockquote><p>å¦‚æœä½ è§‚å¯Ÿåˆ°åƒåœ¾æ”¶é›†ä¸­æ™‹å‡åˆ†å¸ƒæå°‘å‡ºç°å¯¹è±¡å¹´é¾„ä¸º15çš„æƒ…å†µ,å¹¶ä¸”ä¹Ÿæ²¡æœ‰å‘ç”ŸSurviâ…³vorç©ºé—´æº¢å‡º,é‚£ä¹ˆåº”è¯¥è®¾ç½®æœ€å¤§æ™‹å‡é˜ˆå€¼ä¸ºå…¶é»˜è®¤å€¼15ã€‚è¿™ç§åœºæ™¯ä¸‹,å¯¹è±¡éƒ½ä¸æ˜¯é•¿æœŸå­˜æ´»å¯¹è±¡,åœ¨å¹´é¾„å¾ˆå°çš„æ—¶å€™å°±è¢«å›æ”¶äº†,æ ¹æœ¬ä¸ä¼šç”Ÿå­˜åˆ°æœ€å¤§æ™‹å‡å¹´é™çš„å¹´é¾„15ã€‚</p></blockquote><h4 id="è°ƒæ•´ç›®æ ‡Survivorç©ºé—´å ç”¨"><a href="#è°ƒæ•´ç›®æ ‡Survivorç©ºé—´å ç”¨" class="headerlink" title="è°ƒæ•´ç›®æ ‡Survivorç©ºé—´å ç”¨"></a>è°ƒæ•´ç›®æ ‡Survivorç©ºé—´å ç”¨</h4><p>ç›®æ ‡Survivorç©ºé—´å ç”¨æ˜¯HotSpot VMå°è¯•åœ¨Minor GCä¹‹åä»ç„¶ç»´æŒçš„Survivorç©ºé—´å ç”¨ã€‚é€šè¿‡ HotSpot VMçš„å‘½ä»¤è¡Œé€‰é¡¹-XX:TargetSurvivorRatio=&lt;percent&gt;å¯ä»¥å¯¹è¯¥å€¼è¿›è¡Œè°ƒæ•´ã€‚é€šè¿‡å‘½ä»¤è¡Œé€‰é¡¹æŒ‡å®šçš„å‚æ•°å®é™…ä¸Šæ˜¯Survivorç©ºé—´å ç”¨çš„ç™¾åˆ†æ¯”è€Œä¸æ˜¯ä¸€ä¸ªæ¯”ç‡ã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯50ã€‚</p><p>HotSpot VMç ”å‘å›¢é˜Ÿå¯¹ä¸åŒç±»å‹çš„åº”ç”¨ç¨‹åºè¿›è¡Œäº†å¤§é‡çš„è´Ÿè·æµ‹è¯•,ç»“æœè¡¨æ˜50%çš„ç›®æ ‡Survivorç©ºé—´å ç”¨èƒ½é€‚åº”å¤§å¤šæ•°çš„åº”ç”¨ç¨‹åº,è¿™æ˜¯å› ä¸ºå®ƒèƒ½åº”å¯¹Minor GCæ—¶å­˜æ´»å¯¹è±¡çš„æ€¥é€Ÿå¢åŠ ã€‚</p><p>æå°‘å‘ç”Ÿéœ€è¦å¯¹ç›®æ ‡Survivorç©ºé—´å ç”¨è¿›è¡Œè°ƒä¼˜çš„æƒ…å†µã€‚ä½†æ˜¯,å¦‚æœåº”ç”¨ç¨‹åºæœ‰ä¸€ä¸ªç›¸å¯¹ç¨³å®šçš„å¯¹è±¡åˆ†é…é€Ÿç‡,å¯ä»¥è€ƒè™‘æé«˜ç›®æ ‡Survivorç©ºé—´å ç”¨åˆ°80~90ã€‚è¿™æ ·å¯ä»¥å‡å°‘ç”¨äºè€åŒ–å¯¹è±¡çš„Survivorç©ºé—´çš„æ•°é‡ã€‚å°†-XX:TargetSurvivorRatio=&lt;percent&gt;è®¾ç½®å¾—å¤§äºé»˜è®¤å€¼ä¼šå¸¦æ¥çš„å†‹é¢˜æ˜¯ä¸èƒ½å¾ˆå¦¤çš„é€‚åº”è¿…é€Ÿä¸Šæ¶¨çš„å¯¹è±¡åˆ†é…é€Ÿç‡,å¯¼è‡´æå‡å¯¹è±¡çš„æ—¶æœºæ¯”é¢„æœŸæ›´æ—©ã€‚ä½¿ç”¨CMSæ—¶,å¦‚æœå¯¹è±¡æå‡è¿‡å¿«ä¼šå¯¼è‡´è€å¹´ä»£å ç”¨å¢å¤§,ç”±äºæå‡äº†ä¸€äº›éé•¿æœŸå­˜æ´»çš„å¯¹è±¡,è¿™äº›å¯¹è±¡åœ¨å°†æ¥çš„å¹¶å‘åƒåœ¾æ”¶é›†å‘¨æœŸä¸­ä¸€å®šä¼šè¢«å›æ”¶,å¯¼è‡´å‡ºç°å†…å­˜ç¢ç‰‡çš„æ¦‚ç‡è¾ƒé«˜ã€‚ç¢ç‰‡æ˜¯æˆ‘ä»¬è¦å°½é‡é¿å…çš„,å› ä¸ºå®ƒæœ€ç»ˆä¼šå¯¼è‡´Stop-The-Worldå‹ç¼©å¼åƒåœ¾æ”¶é›†ã€‚</p><p><font color="DeepPink">æˆåŠŸçš„CMSæ”¶é›†å™¨è°ƒä¼˜è¦èƒ½ä»¥å¯¹è±¡ä»æ–°ç”Ÿä»£æå‡åˆ°è€å¹´ä»£çš„åŒç­‰é€Ÿåº¦å¯¹è€å¹´ä»£ä¸­çš„å¯¹è±¡è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚è¾¾ä¸åˆ°è¿™ä¸ªæ ‡å‡†åˆ™ç§°ä¹‹ä¸ºâ€œå¤±é€Ÿâ€(Lost the Race)å¤±é€Ÿçš„ç»“æœå°±ä¼šå‘ç”ŸStop-The-Worldå‹ç¼©å¼åƒåœ¾æ”¶é›†ã€‚é¿å…å¤±é€Ÿçš„å…³é”®æ˜¯è¦ç»“åˆè¶³å¤Ÿå¤§çš„è€å¹´ä»£ç©ºé—´å’Œè¶³å¤Ÿå¿«åœ°åˆå§‹åŒ–CMSåƒåœ¾æ”¶é›†å‘¨æœŸ,è®©å®ƒä»¥æ¯”æå‡é€Ÿç‡æ›´å¿«çš„é€Ÿåº¦å›æ”¶ç©ºé—´ã€‚</font></p><p><font color="DeepPink">CMSå‘¨æœŸçš„åˆå§‹åŒ–åŸºäºè€å¹´ä»£ç©ºé—´çš„å ç”¨æƒ…å†µã€‚å¦‚æœCMSå‘¨æœŸå¼€å§‹å¾—å¤ªæ™š,å°±ä¼šå‘ç”Ÿå¤±é€Ÿã€‚å¦‚æœå®ƒæ— æ³•ä»¥è¶³å¤Ÿå¿«çš„é€Ÿåº¦å›æ”¶å¯¹è±¡,å°±æ— æ³•é¿å…è€å¹´ä»£ç©ºé—´ç”¨å°½ã€‚ä½†æ˜¯CMSå‘¨æœŸå¼€å§‹å¾—è¿‡æ—©åˆä¼šå¼•èµ·æ— ç”¨çš„æ¶ˆè€—,å½±å“åº”ç”¨ç¨‹åºçš„ååé‡ã€‚é€šå¸¸,æ—©å¯åŠ¨CMSå‘¨æœŸè¦æ¯”æ™šå¯åŠ¨CMSå¥½,å› ä¸ºå¯åŠ¨å¤ªæ™šçš„ç»“æœæ¯”å¯åŠ¨è¿‡æ—©çš„ç»“æœè¦æ¶åŠ£å¾—å¤šã€‚</font></p><p>å¦‚æœGCæ—¥å¿—ä¸­å‘ç°concurrent mode failureså­—æ ·,å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¡Œé€‰é¡¹é€šçŸ¥HotSpotåœ¨æ›´æ—©çš„æ—¶é—´å¯åŠ¨CMSåƒåœ¾æ”¶é›†å‘¨æœŸã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX: CMSInitiatingOccupancyFraction=&lt;percent&gt;</span><br></pre></td></tr></table></figure><p>è®¾å®šçš„å€¼æ˜¯CMSåƒåœ¾æ”¶é›†å‘¨æœŸåœ¨è€å¹´ä»£ç©ºé—´å ç”¨è¾¾åˆ°å¤šå°‘ç™¾åˆ†æ¯”æ—¶å¯åŠ¨ã€‚ä¾‹å¦‚,å¦‚æœä½ å¸Œæœ›CMSå‘¨æœŸåœ¨è€å¹´ä»£ç©ºé—´å ç”¨è¾¾åˆ°65%æ—¶å¼€å§‹,å¯ä»¥è®¾ç½®-XX:CMSInitiatingOccupancyFraction=65ã€‚</p><p>å¦ä¸€ä¸ªå¯ä»¥ä¸-XX:CMSInitiatingOccupancyFraction=&lt;percent&gt;ä¸€èµ·ä½¿ç”¨å¦ä¸€ä¸ªHotspotå‘½ä»¤è¡Œé€‰é¡¹æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseCMSInitiatingOccupancyOnly</span><br></pre></td></tr></table></figure><p>-XX:+UseCMSInitiatingOccupancyOnlyå‘ŠçŸ¥HotSpot VMæ€»æ˜¯ä½¿ç”¨-XX:CMSInitiatingOccupancyFractionè®¾å®šçš„å€¼ä½œä¸ºå¯åŠ¨CMSå‘¨æœŸçš„è€å¹´ä»£ç©ºé—´å ç”¨é˜ˆå€¼ã€‚ä¸ä½¿ç”¨-XX:+UseRs InitiatingOccupancyOnly, HotSpot VMä»…åœ¨å¯åŠ¨çš„ç¬¬ä¸€ä¸ªCMSå‘¨æœŸé‡Œä½¿ç”¨-XX:CMSInitiatingOccupancyFractionè®¾å®šçš„å€¼ä½œä¸ºå ç”¨æ¯”ç‡,ä¹‹åçš„å‘¨æœŸä¸­åˆè½¬å‘è‡ªé€‚åº”åœ°å¯åŠ¨CMSå‘¨æœŸ,å³ç¬¬ä¸€æ¬¡CMSå‘¨æœŸä¹‹åå°±ä¸å†ä½¿ç”¨-XX:CMSInitiatingoccupancy Fractionè®¾å®šçš„å€¼ã€‚</p><blockquote><p>è¿‡é€‰é¡¹è®¾ç½®ä½•æ—¶å¯åŠ¨CMSå‘¨æœŸæ—¶,æœ€å¥½åŒæ—¶ä½¿ç”¨-XX:CMSInitiatingOccupancyFraction=&lt;percent&gt;å’Œ-XX:+UseCMSInitiatingOccupancyOnly</p></blockquote><p><font color="DeepPink">é€‰é¡¹-XX:CMSInitiatingOccupancyFractionè®¾å®šçš„ç©ºé—´å ç”¨å€¼åº”è¯¥å¤§äºè€å¹´ä»£å ç”¨ç©ºé—´å’Œæ´»è·ƒæ•°æ®å¤§å°ä¹‹æ¯”ã€‚åº”ç”¨ç¨‹åºçš„æ´»è·ƒæ•°æ®å¤§å°å°±æ˜¯ä¸€æ¬¡Full GCä¹‹åå †æ‰€å ç”¨çš„ç©ºé—´å¤§å°ã€‚å¦‚æœä½¿ç”¨-XX:CMSInitiatingOccupancyFractionè®¾ç½®çš„å€¼å°äºæ´»è·ƒæ•°æ®çš„å ç”¨ç™¾åˆ†æ¯”,CMSæ”¶é›†å™¨ä¸€ç›´è¿è¡Œé™·å…¥æ­»å¾ªç¯ã€‚å› æ­¤-XX:CMSInitiatingoccupancyFractionè®¾ç½®çš„ä¸€ä¸ªé€šç”¨åŸåˆ™æ˜¯è€å¹´ä»£å ç”¨ç™¾åˆ†æ¯”åº”è¯¥è‡³å°‘åº”è¯¥æ˜¯æ´»è·ƒæ•°æ®å¤§å°çš„1.5å€ã€‚</font></p><p><font color="DeepPink">ä½•æ—¶(æå‰æˆ–æ¨è¿Ÿ)å¯åŠ¨CMSå‘¨æœŸå–å†³äºå¯¹è±¡ä»æ–°ç”Ÿä»£æå‡è‡³è€å¹´ä»£çš„é€Ÿç‡,å³è€å¹´ä»£ç©ºé—´çš„å¢é•¿ç‡ã€‚å¦‚æœè€å¹´ä»£ç©ºé—´æ¶ˆè€—å¾—æ¯”è¾ƒæ…¢,å¯ä»¥åœ¨ç¨æ™©çš„æ—¶å€™å¯åŠ¨CMSå‘¨æœŸã€‚å¦‚æœè€å¹´ä»£ç©ºé—´æ¶ˆè€—è¿…é€Ÿ,ä½ åº”è¯¥åœ¨è¾ƒæ—©çš„æ—¶å€™å¯åŠ¨CMSå‘¨æœŸ,ä½†æ˜¯ä¹Ÿä¸åº”ä½äºæ´»è·ƒæ•°æ®çš„å ç”¨çš„æ¯”ç‡ã€‚</font>ä¸åº”è¯¥å°†å¯åŠ¨CMSå‘¨æœŸçš„å€¼è®¾ç½®å¾—æ¯”æ´»è·ƒæ•°æ®çš„å¤§å°ä½,è§£å†³è¿™ä¸ªé—®é¢˜æ›´å¥½çš„æ–¹æ³•æ˜¯å¢å¤§è€å¹´ä»£ç©ºé—´çš„å¤§å°ã€‚</p><h3 id="æ˜¾å¼çš„åƒåœ¾æ”¶é›†"><a href="#æ˜¾å¼çš„åƒåœ¾æ”¶é›†" class="headerlink" title="æ˜¾å¼çš„åƒåœ¾æ”¶é›†"></a>æ˜¾å¼çš„åƒåœ¾æ”¶é›†</h3><p>ä½¿ç”¨CMSæ—¶,å¦‚æœä½ è§‚å¯Ÿåˆ°ç”±æ˜¾å¼è°ƒç”¨System.gc()è§¦å‘çš„Full GC,æœ‰2ç§å¤„ç†çš„æ–¹æ³•ã€‚</p><p>1ã€å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„ HotSpot VMå‘½ä»¤è¡Œé€‰é¡¹,æŒ‡å®š HotSpot VMä»¥CMSåƒåœ¾æ”¶é›†å‘¨æœŸçš„æ–¹å¼æ‰§è¡Œ</p><p>-XX:+ExplicitGCInvokesConcurrent</p><p>æˆ–è€…</p><p>-XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses</p><p>å‰è€…éœ€è¦Java6åŠä»¥ä¸Šç‰ˆæœ¬ã€‚åè€…éœ€è¦Java6 Update4åŠä»¥ä¸Šç‰ˆæœ¬ã€‚å¦‚æœä½ çš„JKç‰ˆæœ¬æ”¯æŒ,æœ€å¥½ä½¿ç”¨-XX:+ExplicitGCInvokesConcurrentAndUnloadsClassesé€‰é¡¹ã€‚</p><p>2ã€ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¡Œé€šçŸ¥HotSpot VMå¿½ç•¥æ˜¾å¼çš„ System.gc()è°ƒç”¨</p><p>-XX:+DisableExplicitGC</p><p>è¦ç•™æ„çš„æ˜¯,ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ä¹Ÿä¼šå¯¼è‡´å…¶ä»– HotSpot VMçš„åƒåœ¾æ”¶é›†å™¨å¿½ç•¥æ˜¾å¼çš„System.gc()è°ƒç”¨ã€‚</p><p>ç¦ç”¨æ˜¾å¼çš„åƒåœ¾æ”¶é›†æ—¶åº”è¯¥æ…é‡,å®ƒå¯èƒ½ä¼šå¯¹åº”ç”¨ç¨‹åºçš„æ€§èƒ½é€ æˆè¾ƒå¤§å½±å“ã€‚è¿˜æœ‰å¯èƒ½å‡ºç°è¿™æ ·çš„åœºæ™¯,ä½ éœ€è¦åŠæ—¶å¯¹å¯¹è±¡å¼•ç”¨åšå¤„ç†,ä½†ä¸ä¹‹å¯¹åº”çš„åƒåœ¾æ”¶é›†å´è·Ÿä¸ä¸Šå…¶èŠ‚å¥ã€‚ä½¿ç”¨Java RMIçš„åº”ç”¨ç¨‹åºå°¤å…¶å®¹æ˜“ç¢°åˆ°è¿™ç§é—®é¢˜ã€‚æˆ‘ä»¬å»ºè®®é™¤éæœ‰éå¸¸æ˜ç¡®çš„ç†ç”±,å¦åˆ™ä¸è¦è½»æ˜“åœ°ç¦ç”¨æ˜¾å¼çš„åƒåœ¾æ”¶é›†ã€‚ä¸æ­¤åŒæ—¶,ä¹Ÿå»ºè®®åªåœ¨æœ‰æ˜ç¡®ç†ç”±çš„æƒ…å†µä¸‹æ‰åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨System.gc()ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2010-12-16T23:04:39.452-0600:[Full GC(System)</span><br><span class="line">CMS:418061K-&gt;428608K(16384K),0.2539726 secs</span><br><span class="line">418749K-&gt;4288608K(31168K),</span><br><span class="line">[CMS Perm:32428K-&gt;32428K(65536K)],</span><br><span class="line">0.2540393 secs]</span><br><span class="line">[Times: user=0. 12 sys=0. 01, real=0. 25 secs]</span><br></pre></td></tr></table></figure><p>è¯·ç•™æ„Full GCä¹‹åçš„(System)æ ‡ç­¾,å®ƒè¡¨æ˜System.gc()è§¦å‘äº†æœ¬æ¬¡ Full GCã€‚å¦‚æœåœ¨åƒåœ¾æ”¶é›†æ—¥å¿—ä¸­å‘ç°äº†æ˜¾å¼çš„Full GC,ä½ éœ€è¦å…ˆåˆ¤æ–­ä¸ºä»€ä¹ˆå®ƒä¼šå‘ç”Ÿ,ä¹‹åå†å†³å®šæ˜¯å¦è¦ç¦ç”¨,æ˜¯å¦è¦æŠŠè¯¥è°ƒç”¨ä»ä»£ç ä¸­ç§»é™¤,æˆ–è€…æ˜¯å¦æœ‰å¿…è¦æŒ‡å®šä¸€ä¸ªæ¡ä»¶æ¥è§¦å‘CMSå¹¶å‘åƒåœ¾æ”¶é›†å‘¨æœŸã€‚</p><h2 id="åº”ç”¨ç¨‹åºååé‡è°ƒä¼˜"><a href="#åº”ç”¨ç¨‹åºååé‡è°ƒä¼˜" class="headerlink" title="åº”ç”¨ç¨‹åºååé‡è°ƒä¼˜"></a>åº”ç”¨ç¨‹åºååé‡è°ƒä¼˜</h2><blockquote><p>ä¸€ä¸ªé€šç”¨åŸåˆ™æ˜¯ä½¿ç”¨ Throughputæ”¶é›†å™¨æ—¶,åƒåœ¾æ”¶é›†çš„å¼€é”€åº”è¯¥å°äº5%ã€‚å¦‚æœå¯ä»¥å°†åƒåœ¾æ”¶é›†çš„å¼€é”€å‡å°‘åˆ°1%ç”šè‡³æ›´å°‘,é‚£åŸºæœ¬ä¸Šå°±å·²ç»åˆ°äº†æé™,è¿›ä¸€æ­¥ä¼˜åŒ–èŠ±è´¹çš„ä»£ä»·å¾ˆå¤§ã€‚</p></blockquote><h3 id="è°ƒä¼˜å¹¶è¡Œåƒåœ¾æ”¶é›†çº¿ç¨‹"><a href="#è°ƒä¼˜å¹¶è¡Œåƒåœ¾æ”¶é›†çº¿ç¨‹" class="headerlink" title="è°ƒä¼˜å¹¶è¡Œåƒåœ¾æ”¶é›†çº¿ç¨‹"></a>è°ƒä¼˜å¹¶è¡Œåƒåœ¾æ”¶é›†çº¿ç¨‹</h3><p>å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨ä½¿ç”¨çš„çº¿ç¨‹æ•°ä¹Ÿåº”è¯¥ä¾æ®ç³»ç»Ÿä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºæ•°ä»¥åŠåº•å±‚çš„ç¡¬ä»¶å¹³å°è¿›è¡Œç›¸åº”çš„è°ƒä¼˜ã€‚å¤šä¸ªåº”ç”¨ç¨‹åºè¿è¡ŒäºåŒä¸€ä¸ªç³»ç»Ÿä¸Šæ—¶,å»ºè®®é€šè¿‡å‘½ä»¤è¡Œé€‰é¡¹-XX:ParallelGCThreads=&lt;n&gt;å°†å¹¶è¡Œåƒåœ¾æ”¶é›†çš„çº¿ç¨‹æ•°è®¾ç½®ä¸ºå°äºå…¶é»˜è®¤å€¼ã€‚</p><p>å¦åˆ™,ç”±äºå¤§é‡çš„åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶è¿è¡Œ,å…¶ä»–åº”ç”¨ç¨‹åºçš„æ€§èƒ½å°†å—åˆ°ä¸¥é‡å½±å“ã€‚æˆªè‡³Java6 Update23,é»˜è®¤æƒ…å†µä¸‹å¹¶è¡Œåƒåœ¾æ”¶é›†çš„çº¿ç¨‹æ•°ç­‰äºJava API Runtime.availableProcessors()çš„è¿”å›å€¼(å¦‚æœè¯¥è¿”å›å€¼å°äºç­‰äº8),å¦åˆ™å…¶ç­‰äº8+(Runtime.availableProcessors()-8)*5/8ã€‚<font color="DeepPink">å¤šä¸ªåº”ç”¨ç¨‹åºè¿è¡ŒäºåŒä¸€ç³»ç»Ÿä¸Šæ—¶è®¾ç½®å¹¶è¡Œåƒåœ¾æ”¶é›†çº¿ç¨‹çš„ä¸€ä¸ªé€šç”¨åŸåˆ™æ˜¯ç”¨è™šæ‹Ÿå¤„ç†å™¨çš„æ•°ç›® (Runtime.availableProcessors()çš„è¿”å›å€¼)é™¤ä»¥è¯¥ç³»ç»Ÿä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºæ•°ã€‚</font>è¿™é‡Œæˆ‘ä»¬å‡è®¾è¿™äº›åº”ç”¨ç¨‹åºçš„è´Ÿè·åŠå †å¤§å°çš„æƒ…å†µç›¸å·®ä¸å¤§ã€‚å¦‚æœåº”ç”¨ç¨‹åºçš„è´Ÿè·åŠJavaå †å¤§å°å·®å¼‚å¾ˆå¤§,é‚£ä¹ˆä¸ºæ¯ä¸ªJavaåº”ç”¨è®¾ç½®ä¸åŒæƒé‡,å¹¶æ®æ­¤è®¾ç½®å¹¶è¡Œåƒåœ¾çº¿ç¨‹æ•°æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹æ³•ã€‚</p><h3 id="åœ¨NUMAç³»ç»Ÿä¸Šéƒ¨ç½²"><a href="#åœ¨NUMAç³»ç»Ÿä¸Šéƒ¨ç½²" class="headerlink" title="åœ¨NUMAç³»ç»Ÿä¸Šéƒ¨ç½²"></a>åœ¨NUMAç³»ç»Ÿä¸Šéƒ¨ç½²</h3><p>å¦‚æœåº”ç”¨ç¨‹åºéœ€è¦åœ¨NUMA(éä¸€è‡´æ€§å†…å­˜æ¶æ„)ç³»ç»Ÿä¸Šéƒ¨ç½²,è¿˜æœ‰ä¸€ä¸ªå¯ä»¥ä¸Throughputæ”¶é›†å™¨ä¸€èµ·ä½¿ç”¨çš„HotSpotå‘½ä»¤è¡Œé€‰é¡¹æ˜¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseNUMA</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤è¡Œé€‰é¡¹æ ¹æ®CPUä¸å†…å­˜ä½ç½®çš„å…³ç³»åœ¨åˆ†é…çº¿ç¨‹è¿è¡Œçš„æœ¬åœ°å†…å­˜ä¸­åˆ†é…å¯¹è±¡ã€‚è¿™é‡Œä¾æ®çš„å‡è®¾æ˜¯åˆ†é…å¯¹è±¡çš„çº¿ç¨‹æ˜¯è¿‘æœŸæœ€æœ‰å¯èƒ½è®¿é—®è¯¥å¯¹è±¡çš„çº¿ç¨‹ã€‚ç›¸å¯¹äºè¿œç¨‹çš„å†…å­˜è€Œè¨€,åœ¨åŒä¸€çº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¸­åˆ†é…å¯¹è±¡ç”¨æ›´çŸ­çš„æ—¶é—´å³èƒ½è®¿é—®è¯¥å¯¹è±¡çš„å†…å®¹ã€‚</p><p>åªæœ‰å½“JVMçš„éƒ¨ç½²è·¨CPUã€ä¸åŒCPUè®¿é—®å†…å­˜çš„æ‹“æ‰‘æœ‰æ‰€ä¸åŒ,å¯¼è‡´è®¿é—®æ—¶é—´ä¹Ÿæœ‰æ‰€å·®åˆ«çš„ç¯å¢ƒä¸‹æ‰é€‰æ‹©ä½¿ç”¨-XX:+UseNUMAé€‰é¡¹ã€‚ä¾‹å¦‚,è™½ç„¶JVMéƒ¨ç½²åˆ°NUMAç³»ç»Ÿçš„ä¸€ä¸ªå¤„ç†å™¨é›†ä¸Š,ä½†æ˜¯è¿™ä¸ªå¤„ç†å™¨é›†å¹¶ä¸å­˜åœ¨è·¨CPUè®¿é—®å†…å­˜çš„æ‹“æ‰‘,æ²¡æœ‰è®¿é—®æ—¶é—´çš„å·®åˆ«,é‚£ä¹ˆå°±ä¸åº”è¯¥ä½¿ç”¨-XX:+UseNUMAé€‰é¡¹ã€‚</p><blockquote><p>ç®€è€Œè¨€ä¹‹,æ”´æŒNUMAçš„VMä¼šæ ¹æ®NUMAèŠ‚ç‚¹åˆ’åˆ†å †,çº¿ç¨‹åˆ›å»ºæ–°çš„å¯¹è±¡æ—¶,åªä¼šåœ¨è¯¥çº¿ç¨‹è¿è¡Œæ‰€åœ¨æ ¸çš„NUMAèŠ‚ç‚¹ä¸Šåˆ†é…å¯¹è±¡,åç»­è¯¥çº¿ç¨‹å¦‚æœéœ€è¦ä½¿ç”¨è¿™ä¸ªå¯¹è±¡,å°±ç›´æ¥ä»æœ¬åœ°å†…å­˜ä¸­è®¿é—®ã€‚é€šå¸¸æƒ…å†µä¸‹,å¦‚æœæ²¡æœ‰ä½¿ç”¨å‘½ä»¤,è‡‚å¦‚RHELä¸‹ä½¿ç”¨numactl,è®¾ç½®CPUçš„äº²å’Œæ€§(Affinity),é»˜è®¤å°±è·¨å¤šä¸ªå†…å­˜èŠ‚ç‚¹,æ»¡è¶³-XX:+UseNUMAçš„ä½¿ç”¨æ¡ä»¶ã€‚</p></blockquote><blockquote><p>æ³¨ï¼šThroughput garbage collector,å®é™…æŒ‡çš„æ˜¯Parallelæ”¶é›†å™¨</p></blockquote><h2 id="å…¶å®ƒæ€§èƒ½å‘½ä»¤è¡Œé€‰é¡¹"><a href="#å…¶å®ƒæ€§èƒ½å‘½ä»¤è¡Œé€‰é¡¹" class="headerlink" title="å…¶å®ƒæ€§èƒ½å‘½ä»¤è¡Œé€‰é¡¹"></a>å…¶å®ƒæ€§èƒ½å‘½ä»¤è¡Œé€‰é¡¹</h2><h3 id="å¤§é¡µé¢æ”¯æŒ"><a href="#å¤§é¡µé¢æ”¯æŒ" class="headerlink" title="å¤§é¡µé¢æ”¯æŒ"></a>å¤§é¡µé¢æ”¯æŒ</h3><p>è®¡ç®—æœºç³»ç»Ÿçš„å†…å­˜è¢«åˆ’åˆ†æˆç§°ä¸ºâ€œé¡µâ€çš„å›ºå®šå¤§å°çš„å—ã€‚ç¨‹å…è®¿é—®å†…å­˜çš„è¿‡ç¨‹ä¸­ä¼šå°†è™šæ‹Ÿå†…å­˜åœ°å€è½¬æ¢æˆç‰©ç†å†…å­˜åœ°å€ã€‚è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢æ˜¯é€šè¿‡è¡¨å®Œæˆçš„ã€‚ä¸ºäº†å‡å°‘æ¯æ¬¡å†…å­˜è®¿é—®æ—¶è®¿é—®é¡µè¡¨çš„ä»£ä»·,é€šå¸¸çš„åšæ³•æ˜¯ä½¿ç”¨ä¸€å—å¿«é€Ÿç¼“å­˜,å¯¹è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢è¿›è¡Œç¼“å­˜ã€‚è¿™å—ç¼“å­˜è¢«ç§°ä¸ºè½¬è¯‘å¿«æŸ¥ç¼“å­˜(TLB)ã€‚</p><p>ä½¿ç”¨TLBå®Œæˆä»è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„æ¯”éå†æ•´ä¸ªé¡µè¡¨çš„æ–¹å¼è¦å¿«å¾—å¤šã€‚TLBé€šå¸¸åªèƒ½å®¹çº³å›ºå®šæ•°é‡çš„æ¡ç›®ã€‚TLBä¸­çš„ä¸€æ¡è®°å½•å°±æ˜¯æŒ‰é¡µé¢å¤§å°ç»Ÿè®¡çš„ä¸€å—å†…å­˜åœ°å€åŒºé—´çš„æ˜ å°„ã€‚å› æ­¤ç³»ç»Ÿçš„é¡µé¢è¶Šå¤§,æ¯ä¸ªæ¡ç›®èƒ½æ˜ å°„çš„å†…å­˜åœ°å€åŒºé—´è¶Šå¤§,æ¯ä¸ªTLBèƒ½ç®¡ç†çš„ç©ºé—´ä¹Ÿè¶Šå¤§ã€‚TLBä»£è¡¨çš„åœ°å€åŒºé—´è¶Šå¤§,åœ°å€è½¬è¯‘è¯·æ±‚åœ¨TLBä¸­å¤±æ•ˆçš„å¯èƒ½æ€§å°±è¶Šå°ã€‚å½“ä¸€ä¸ªåœ°å€è½¬è¯‘è¯·æ±‚æ— æ³•åœ¨TLBä¸­æ‰¾åˆ°åŒ¹é…é¡¹æ—¶,æˆ‘ä»¬ç§°ä¹‹å‘ç”Ÿäº†â€œTLBå¤±æ•ˆâ€ã€‚TLBå¤±æ•ˆäº‹ä»¶å‘ç”Ÿæ—¶å¸¸å¸¸éœ€è¦éå†å†…å­˜ä¸­çš„é¡µè¡¨,æŸ»æ‰¾è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ã€‚ä¸åœ¨TLBä¸­æŸ¥æ‰¾åœ°å€æ˜ å°„æ¯”è¾ƒèµ·æ¥,éå†é¡µè¡¨æ˜¯ä¸€é¡¹éå¸¸æ˜‚è´µçš„æ“ä½œã€‚ç”±æ­¤å¯è§,<font color="DeepPink">ä½¿ç”¨å¤§é¡µé¢çš„å¥½å¤„æ˜¯å…¶å‡å°äº†TLBå¤±æ•ˆçš„å‡ ç‡ã€‚</font></p><p>HotSpotè™šæ‹Ÿæœºåœ¨Oracle solaris(è¿™ä¹‹åç§°ä¸ºSolaris)ã€ Linuxå’Œ Windowsä¸Šéƒ½æ”¯æŒå¤§é¡µé¢ã€‚é¡µé¢å¤§å°è¿˜å¯èƒ½éšç€å¤„ç†å™¨çš„ä¸åŒæœ‰æ‰€ä¸åŒã€‚å¦å¤–,ä¸ºäº†ä½¿ç”¨å¤§é¡µé¢è¿˜å¯èƒ½éœ€è¦å¯¹æ“ä½œç³»ç»Ÿè¿›è¡Œé…ç½®ã€‚</p><h1 id="Java-åº”ç”¨çš„åŸºå‡†æµ‹è¯•"><a href="#Java-åº”ç”¨çš„åŸºå‡†æµ‹è¯•" class="headerlink" title="Java åº”ç”¨çš„åŸºå‡†æµ‹è¯•"></a>Java åº”ç”¨çš„åŸºå‡†æµ‹è¯•</h1><h2 id="åŸºå‡†æµ‹è¯•æ‰€é¢ä¸´çš„æŒ‘æˆ˜"><a href="#åŸºå‡†æµ‹è¯•æ‰€é¢ä¸´çš„æŒ‘æˆ˜" class="headerlink" title="åŸºå‡†æµ‹è¯•æ‰€é¢ä¸´çš„æŒ‘æˆ˜"></a>åŸºå‡†æµ‹è¯•æ‰€é¢ä¸´çš„æŒ‘æˆ˜</h2><h3 id="åŸºå‡†æµ‹è¯•çš„é¢„çƒ­é˜¶æ®µ"><a href="#åŸºå‡†æµ‹è¯•çš„é¢„çƒ­é˜¶æ®µ" class="headerlink" title="åŸºå‡†æµ‹è¯•çš„é¢„çƒ­é˜¶æ®µ"></a>åŸºå‡†æµ‹è¯•çš„é¢„çƒ­é˜¶æ®µ</h3><p>æ‰§è¡ŒåŸºå‡†æµ‹è¯•æ—¶ä½¿ç”¨HotSpot VMå‘½ä»¤è¡Œé€‰é¡¹-XX:+PrintCompilationæ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯,ä½¿ç”¨è¯¥å‘½ä»¤è¡Œé€‰é¡¹çš„è¾“å²€å¯ä»¥åˆ¤æ–­JITç¼–è¯‘å™¨ä½•æ—¶å®Œæˆäº†é¢„çƒ­é˜¶æ®µ,ç¡®ä¿åœ¨ HotSpotç¼–è¯‘å™¨åˆ°è¾¾ç¨³å®šæ€å,å³å·²ç»å®Œæˆå®ƒçš„ä¼˜åŒ–å·¥ä½œ(ç”Ÿæˆäº†é€‚åˆåŸºå‡†æµ‹è¯•çš„ä¼˜åŒ–æœºå™¨ç )åå†å¼€å§‹åŸºå‡†æ•°æ®é‡‡æ ·ã€‚-XX:+PrintCompilationé€‰é¡¹é€šçŸ¥VMä¸ºæ¯ä¸ªå®ƒä¼˜åŒ–æˆ–é€†ä¼˜åŒ–çš„å‡½æ•°è¾“å‡ºä¸€æ¡æ—¥å¿—ã€‚ä¸‹é¢æ˜¯åœ¨ä¸€æ®µå¾®åŸºå‡†æµ‹è¯•ä¸­ä½¿ç”¨-XX:+PrintCompilationé€‰é¡¹è¾“å‡ºçš„æ—¥å¿—ç‰‡æ®µ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">11java.util.Random:: nextInt (60 bytes)</span><br><span class="line">12java.util.Random: next (47 bytes</span><br><span class="line">13java.util.concurrent atomic Atomi CLong: get (5 bytes)</span><br><span class="line">14java.util.HashSet: contains (9 bytes)</span><br><span class="line">15java.util.HashMap: transfer (83 bytes)</span><br><span class="line">16java.util.Arrays SArrayList: set (16 bytes)</span><br><span class="line">17java.util.Arrays SArrayList: set (16 bytes)</span><br><span class="line">18java.util.Collections: swap (25 bytes)</span><br><span class="line">19java.util.Arrays SArrayList: get (7 bytes)</span><br><span class="line">20java.lang.Long: &lt;init&gt; (10 bytes)</span><br><span class="line">21java.lang.Integer: longvalue (6 bytes)</span><br><span class="line">22java.lang.Long: valueOf (36 bytes)</span><br><span class="line">23java.lang.Integer: stringSize (21 bytes)</span><br><span class="line">24java.lang.Integer: getChars (131 bytes)</span><br></pre></td></tr></table></figure><p><font color="DeepPink">è§‚å¯Ÿæ—¥å¿—ä¸­å·²ç»ä¸å†æœ‰-XX:+PrintCompilationè¾“å‡ºçš„ä¿¡æ¯(è¡¨æ˜JITç¼–è¯‘å™¨çš„ä¼˜åŒ–å·¥ä½œå·²ç»å®Œæˆ)ä¹‹åæ‰æ­£å¼å¼€å§‹é‡‡æ ·æ•°æ®ã€‚æ­¤å¤–,åŸºå‡†æµ‹è¯•è¿˜åº”è¯¥åœ¨ä¸ä½¿ç”¨-XX:+PrintCompilationé€‰é¡¹çš„æƒ…å†µä¸‹è¿è¡Œå‡ æ¬¡,æ¯”è¾ƒå…¶æ€§èƒ½ä¸ä½¿ç”¨-XX:+ PrintCompilationé€‰é¡¹çš„ç»“æœæ˜¯å¦ä¸€è‡´ã€‚å¦‚æœäºŒè€…ä¸ä¸€è‡´,å¯èƒ½åœ¨åˆ›å»ºåŸºå‡†æµ‹è¯•æˆ–å¾®åŸºå‡†æµ‹è¯•æ—¶å—åˆ°äº†å…¶ä»–å› ç´ çš„å½±å“ã€‚</font></p><blockquote><p>å¾®åŸºå‡†æµ‹è¯•ä¸­æœ‰ä¸€ä¸ªæƒ¯ä¾‹,å³åœ¨å¼€å§‹é‡‡æ ·é—´éš”å¼€å§‹è®¡æ—¶ä¹‹å‰,å…ˆè°ƒç”¨å‡ æ¬¡ System.gc()ã€‚å¤šæ¬¡è°ƒç”¨ System.gc()çš„ç›®çš„æ˜¯å¸Œæœ›é€šè¿‡Javaå¯¹è±¡çš„ç»ˆç»“æ–¹æ³•é‡Šæ”¾å†…å­˜,è€Œè¿™å¾€å¾€éœ€è¦è¿›è¡Œå¤šæ¬¡åƒåœ¾æ”¶é›†æ‰èƒ½å®Œæˆã€‚æ­¤å¤–,å½“å¯¹è±¡ä¸å¯è¾¾,å¯¼è‡´ç»ˆç»“æ–¹æ³•ä¸€ç›´å¤„äºç­‰å¾…é˜Ÿåˆ—,æˆ–è€…éƒ¨åˆ†æ‰§è¡Œé˜Ÿåˆ—ä¸­,è°ƒç”¨System.runFinalization()æ¥å£å¯ä»¥è¯·æ±‚JVMæ‰§è¡Œå…¶fina1ize()æ–¹æ³•,å®Œæˆåƒåœ¾æ”¶é›†ã€‚</p></blockquote><h3 id="ä½¿ç”¨Java-Timeæ¥å£"><a href="#ä½¿ç”¨Java-Timeæ¥å£" class="headerlink" title="ä½¿ç”¨Java Timeæ¥å£"></a>ä½¿ç”¨Java Timeæ¥å£</h3><p>å¼•å…¥æ–°çš„System.nanoTime()æ¥å£ä¹‹å‰,å¤§å¤šæ•°çš„JavaåŸºå‡†æµ‹è¯•æˆ–å¾®åŸºå‡†æµ‹è¯•éƒ½ä½¿ç”¨System.currentTimeMillis()æ¥å£è·å–é‡‡æ ·é—´éš”çš„å¼€å§‹å’Œç»ˆæ­¢æ—¶é—´,æ ¹æ®ç»ˆæ­¢æ—¶é—´ä¸å¼€å§‹æ—¶é—´çš„é—´éš”å¾—åˆ°è¿è¡Œå…³æ³¨çš„ä»£ç æ‰€æ¶ˆè€—çš„æ—¶é—´ä½¿ç”¨Javaçš„System.currentTimeMillis()å’ŒSystem.nanoTime()æ¥å£éƒ½æœ‰ä¸€å®šç¨‹åº¦çš„ç²¾åº¦é—®é¢˜ã€‚è™½ç„¶ System.currentTimeMillis()çš„è¿”å›å€¼æ˜¯ä»¥äº³ç§’è®¡çš„å½“å‰æ—¶é—´,ä½†æ¯«ç§’çº§çš„ç²¾åº¦å´å–å†³äºæ“ä½œç³»ç»Ÿã€‚Java API Specificationä¸­å¯¹äºSystem.currentTimeMillis()æœ‰æ˜ç¡®çš„é™ˆè¿°:è™½ç„¶è¯¥æ¥å£çš„è¿”å›å€¼æ˜¯æ¯«ç§’,ä½†è¿”å›å€¼çš„ç²’åº¦å–å†³äºåº•å±‚çš„æ“ä½œç³»ç»Ÿã€‚è¿™ä¸€è§„èŒƒä¸ºæ“ä½œç³»ç»Ÿä½¿ç”¨è‡ªèº«çš„äº³ç§’çº§ç³»ç»Ÿæ¥å£æä¾›äº†æ–¹ä¾¿,ä½†æ˜¯å¯èƒ½å­˜åœ¨è¿™æ ·çš„æƒ…å†µ,å°½ç®¡ä½¿ç”¨çš„æ˜¯æ¯«ç§’è®¡æ•°å™¨,ä½†æ˜¯æ›´æ–°é—´éš”å´è¿‡å¤§,è­¬å¦‚æ¯30æ¯«ç§’æ›´æ–°ä¸€æ¬¡ã€‚è¿™ä¸ªè§„èŒƒæœ‰æ„åœ°è§„å®šå¾—æ¯”è¾ƒå®½æ¾,è¯•å›¾è®©Java APIå°½å¯èƒ½åœ°æ”¯æŒæ›´å¤šçš„æ“ä½œç³»ç»Ÿ,å…¶ä¸­å°±åŒ…å«ä¸€äº›æ— æ³•æä¾›æ¯«ç§’çº§æ—¶é’Ÿç²¾åº¦çš„æ“ä½œç³»ç»Ÿã€‚ä½¿ç”¨Java API System. nanoTime()ä¹Ÿæœ‰ç±»ä¼¼çš„é—®é¢˜ã€‚<font color="DeepPink">è™½ç„¶è¯¥æ–¹æ³•æä¾›äº†çº³ç§’çº§çš„ç²¾åº¦,ä½†æ¥å£å¹¶ä¸ä¿è¯æä¾›çº³ç§’çº§çš„ç²¾åº¦: System.nanoTime()çš„ Java API Specificationä¸­æ˜ç¡®æåˆ°ä¸ä¿è¯System.nanoTime()è¿”å›å€¼çš„æ›´æ–°é¢‘åº¦ã€‚</font></p><p>å› æ­¤,ä½¿ç”¨System.currentTimeMillis()è®¡ç®—æ—¶é—´æ¶ˆè€—æ—¶,é‡‡æ ·çš„æ—¶é—´é—´éš”åº”è¯¥è¶³å¤Ÿå¤§,å°½é‡å‡å°‘System, currentTimeMillis()ç²¾åº¦å¸¦æ¥çš„å½±å“ã€‚ä¹Ÿå³æ˜¯è¯´,é‡‡æ ·çš„æ—¶é—´é—´éš”éœ€è¦æ¯”æ¯«ç§’å¤§(è­¬å¦‚å‡ ç§’ã€æˆ–è€…å°½å¯èƒ½å‡ åˆ†é’Ÿ)åŒæ ·çš„åŸåˆ™ä¹Ÿé€‚ç”¨äº System.nanoTime()ã€‚æ ¹æ® jJava API Specification,System.nanoTime()ä¾èµ–åº•å±‚çš„æ“ä½œç³»ç»Ÿ,è¿”å›ç³»ç»Ÿä¸­å¯ç”¨çš„æœ€ç²¾ç¡®æ—¶é’Ÿçš„å½“å‰å€¼ã€‚ç„¶è€Œ,æœ€ç²¾ç¡®çš„å¯ç”¨ç³»ç»Ÿæ—¶é’Ÿå¯èƒ½ä¹Ÿæ²¡æœ‰çº³ç§’çº§çš„ç²¾åº¦ã€‚è¿›è¡ŒåŸºå‡†æµ‹è¯•æ—¶,å»ºè®®é¦–å…ˆæ‘¸æ¸…æ¥šè¿™ä¸¤ä¸ªJava APIåœ¨å¯¹åº”å¹³å°æˆ–æ“ä½œç³»ç»Ÿä¸Šçš„ç²’åº¦æˆ–ç²¾åº¦ã€‚å¦‚æœä½ ä¸æ˜¯å¾ˆæ¸…æ¥š,ä½†æ‰‹é‡Œæœ‰æºä»£ç ,å¯ä»¥é€šè¿‡æŸ¥çœ‹è¿™ä¸¤ä¸ªAPIçš„åº•å±‚å®ç°,äº†è§£å…¶ç²’åº¦å’Œç²¾åº¦ã€‚å¦‚æœä½ ä½¿ç”¨ System.currentTimeMillis(æˆ–System.nanoTime())ã€‚è€Œä¸”é‡‡æ ·æ—¶é—´é—´éš”å¾ˆçŸ­(ç›¸å¯¹äºæ¯«ç§’æˆ–çº³ç§’æ¥è®²),è¦ç‰¹åˆ«æ³¨æ„è¿™ä¸ªé—®é¢˜ã€‚</p><blockquote><p>å¾®åŸºå‡†æµ‹è¯•æ—¶,ä½¿ç”¨System.nanoTime()è·å–å¯åŠ¨å’Œç»ˆæ­¢æ—¶é—´è®¡ç®—é‡‡æ ·é—´éš”æ˜¯ä¸€ç§å¥½æ–¹æ³•ã€‚æ¥ç€è®¡ç®—ç»ˆæ­¢ä¸å¯åŠ¨çš„æ—¶é—´å·®å°±å¯ä»¥å¾—åˆ°å¾®åŸºå‡†æµ‹è¯•çš„è€—æ—¶,ä»¥åŠæ¯æ¬¡æ“ä½œé€‰ä»£æ‰€æ¶ˆè€—çš„çº³ç§’æ•°æˆ–è€…æ¯ç§’æ‰€å‘ç”Ÿçš„è¿­ä»£æ¬¡æ•°ã€‚<font color="DeepPink">æœ€é‡è¦çš„æ˜¯è¦ç¡®ä¿å¾®åŸºå‡†æµ‹è¯•è¿è¡Œçš„æ—¶é—´è¦è¶³å¤Ÿé•¿,ç¡®ä¿åº”ç”¨ç¨‹åºè¿è¡Œå·²è¾¾ç¨³å®šæ€ä¸”é‡‡æ ·çš„æ—¶é—´ä¹Ÿè¶³å¤Ÿé•¿ã€‚</font></p></blockquote><h3 id="å‰”é™¤æ— æ•ˆä»£ç "><a href="#å‰”é™¤æ— æ•ˆä»£ç " class="headerlink" title="å‰”é™¤æ— æ•ˆä»£ç "></a>å‰”é™¤æ— æ•ˆä»£ç </h3><p>ä¸ºäº†é¿å…å¾®åŸºå‡†æµ‹è¯•ä¸­çš„ä»£ç è¢«å®šæ€§ä¸ºæ— æ•ˆä»£ç ,å¼•å‘è¿‡åº¦ç®€åŒ–çš„é—®é¢˜,å¯ä»¥é‡‡ç”¨ä¸‹é¢çš„ç¼–ç¨‹å®è·µï¼š</p><ul><li><font color="DeepPink">è®©è¯¥æ–¹æ³•å˜å¾—å¿…ä¸å¯å°‘</font></li><li><font color="DeepPink">åœ¨é‡†æ ·é˜¶æ®µç»“æŸæ—¶ç›´æ¥è¾“å‡ºè®¡ç®—çš„ç»“æœ,æˆ–è€…ä¿å­˜è¯¥è®¡ç®—ç»“æœ,åœ¨é‡‡æ ·é˜¶æ®µç»“æŸåè¾“å‡ºè¯¥å€¼</font></li></ul><p>è¦ä½¿è®¡ç®—æœ‰æ„ä¹‰,å°±è¦å‘è¢«æµ‹æ–¹æ³•ä¼ å…¥å‚æ•°,å¹¶ä»è¢«æµ‹æ–¹æ³•è¿”å›è®¡ç®—ç»“æœã€‚æ­¤å¤–,åœ¨åŸºå‡†æµ‹è¯•é‡‡æ ·é˜¶æ®µå†…æˆ–åœ¨å¤šä¸ªä¸åŒçš„åŸºå‡†æµ‹è¯•é‡‡æ ·é˜¶æ®µé—´å˜æ¢è¿­ä»£æ¬¡æ•°ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ³•,ç„¶åæ¯”è¾ƒæ¯æ¯«ç§’å†…å‘ç”Ÿçš„è¿­ä»£æ¬¡æ•°,åˆ¤æ–­è¿­ä»£æ¬¡æ•°æ˜¯å¦ä¿æŒæ’å®š,åŒæ—¶ä½¿ç”¨-XX:+PrintCompilationé€‰é¡¹è¿½è¸ªè®°å½•JITç¼–è¯‘å™¨çš„çŠ¶æ€ã€‚</p><h3 id="å†…è”"><a href="#å†…è”" class="headerlink" title="å†…è”"></a>å†…è”</h3><p>HotSpot VMçš„Clientå’ŒServer JITç¼–è¯‘å™¨éƒ½èƒ½å¯¹æ–¹æ³•è¿›è¡Œå†…è”ã€‚è¿™æ„å‘³ç€è°ƒç”¨è¿‡ç¨‹ä¸­,ç›®æ ‡æ–¹æ³•ä¼šè¢«å±•å¼€åˆ°è°ƒç”¨æ–¹æ³•ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±Jç¼–è¯‘å™¨å®Œæˆçš„,Jç¼–è¯‘å™¨é€šè¿‡é™ä½æ–¹æ³•è°ƒç”¨çš„å¼€é”€æå‡æ‰§è¡Œæ€§èƒ½ã€‚æ­¤å¤–,å†…è”çš„ä»£ç å¯èƒ½æä¾›æ›´å¤šçš„ä¼˜åŒ–æœºä¼š,æ•´åˆåçš„ä»£ç å¯èƒ½æ›´ç®€å•,æˆ–è€…æ¶ˆé™¤äº†æ— æ•ˆè°ƒç”¨,è€Œè¿™äº›åœ¨ä¸å†…è”çš„æƒ…å†µä¸‹æ˜¯æ— æ³•å®ç°çš„ã€‚å†…è”åœ¨å¾®åŸºå‡†æµ‹è¯•ä¸­è¿˜å¯èƒ½å®ç°è®©äººçœ¼å‰ä¸€äº®çš„æ€§èƒ½æå‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:+PrintInlining</span><br><span class="line">-XX:MaxInlineSize=N</span><br></pre></td></tr></table></figure><h3 id="é€†ä¼˜åŒ–"><a href="#é€†ä¼˜åŒ–" class="headerlink" title="é€†ä¼˜åŒ–"></a>é€†ä¼˜åŒ–</h3><p>JITç¼–è¯‘å™¨ä»¥å…¶æ‰§è¡Œä¼˜åŒ–çš„èƒ½åŠ›è€Œè‘—ç§°äºä¸–ã€‚ä½†æ˜¯,æŸäº›åœºæ™¯ä¸‹JITç¼–è¯‘å™¨ä¹Ÿä¼šè¿›è¡Œâ€œé€†ä¼˜åŒ–â€ã€‚è­¬å¦‚,Javaåº”ç”¨ä¸€æ—¦å¼€å§‹è¿è¡Œ,æ–¹æ³•è°ƒç”¨å˜å¾—é¢‘ç¹;JITç¼–è¯‘å™¨å°±å¯ä»¥æ ¹æ®ä»ç¨‹åºè¿‡ç¨‹ä¸­äº†è§£åˆ°çš„ä¿¡æ¯åšå‡ºä¼˜åŒ–å†³ç­–ã€‚æœ‰äº›æ—¶å€™,ä¼˜åŒ–çš„å†³ç­–åœ¨åç»­å¯èƒ½è¢«è¯æ˜æ˜¯é”™è¯¯çš„ã€‚å½“JITç¼–è¯‘å™¨å‘ç°ä¹‹å‰çš„ä¼˜åŒ–ä½œäº†é”™è¯¯çš„ä¼˜åŒ–å†³ç­–æ—¶å°±ä¼šè¿›è¡Œé€†ä¼˜åŒ–ã€‚å¾ˆå¤šæ—¶å€™,åœ¨JITç¼–è¯‘å™¨é€†ä¼˜åŒ–ä¸ä¹…ä¹‹å(ä¸€æ—¦è¾¾åˆ°ä¸€å®šçš„æ‰§è¡Œæ¬¡æ•°é˜ˆå€¼)å°±ä¼šæ¥ç€å†æ¬¡è¿›è¡Œä¼˜åŒ–ã€‚å¿½è§†å‘ç”Ÿçš„é€†ä¼˜åŒ–å¯èƒ½å¾—å‡ºé”™è¯¯çš„æ€§èƒ½ç»“è®ºã€‚</p><blockquote><p>ä½¿ç”¨-XX:+PrintCompilationé€‰é¡¹å¯ä»¥å¸®åŠ©ç¡®å®šæ˜¯å¦å‘ç”Ÿäº†é€†ä¼˜åŒ–ã€‚-XX:+Printcompilationé€‰é¡¹çš„è¾“å‡ºä¸­å¦‚æœåŒ…å«â€œmad not entrantâ€,å³è¡¨æ˜ä¹‹å‰çš„ç¼–è¯‘ä¼˜åŒ–è¢«ä¸¢å¼ƒäº†,æ–¹æ³•å°†é€šè¿‡è§£é‡Šå™¨è¿è¡Œ,ç›´åˆ°è¯¥æ–¹æ³•æ‰§è¡Œè¶³å¤Ÿçš„æ¬¡æ•°å†è§¦å‘ä¼˜åŒ–ã€‚</p></blockquote><p><font color="DeepPink">è½¯ä»¶å¼€å‘è€…åº”è¯¥ä¸“æ³¨äºä¼˜ç§€çš„è½¯ä»¶æ¶æ„ã€è®¾è®¡ä»¥åŠå®ç°,æ²¡æœ‰å¿…è¦è¿‡åº¦æ‹…å¿§ç°ä»£JITç¼–è¯‘å™¨çš„å½±å“ã€‚å¦‚æœå¯¹è½¯ä»¶æ¶æ„ã€è®¾è®¡æˆ–å®ç°çš„ä¿®æ”¹æ˜¯ä¸ºäº†å…‹æœJITç¼–è¯‘å™¨çš„ä¸€äº›æ€§è´¨,å°±åº”è¯¥è€ƒè™‘è¿™æ˜¯JITç¼–è¯‘å™¨çš„ç¼ºé™·æˆ–ä¸è¶³ã€‚</font></p><h3 id="åˆ›å»ºå¾®åŸºå‡†æµ‹è¯•çš„æ³¨æ„äº‹é¡¹"><a href="#åˆ›å»ºå¾®åŸºå‡†æµ‹è¯•çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="åˆ›å»ºå¾®åŸºå‡†æµ‹è¯•çš„æ³¨æ„äº‹é¡¹"></a>åˆ›å»ºå¾®åŸºå‡†æµ‹è¯•çš„æ³¨æ„äº‹é¡¹</h3><ol><li>æ˜ç¡®ä½ éœ€è¦äº†è§£çš„æ€§èƒ½æŒ‡æ ‡æ˜¯ä»€ä¹ˆ,è®¾è®¡ç›¸åº”çš„å®éªŒå†‹ç­”ä½ éœ€è¦è§£å†³çš„å†‹é¢˜ã€‚ä¸è¦å—äº›æ— å…³ç—›ç—’çš„å› ç´ å½±å“è€Œå¿½ç•¥äº†ä½ çœŸæ­£éœ€è¦è§£å†³çš„é—®é¢˜ã€‚</li><li>ç¡®ä¿é‡‡æ ·é˜¶æ®µä¸­æ¯æ¬¡ä½¿ç”¨åŒæ ·çš„å·¥ä½œé‡ã€‚</li><li>è®¡ç®—å¹¶æ”¶é›†å¤šç§æ€§èƒ½æŒ‡æ ‡,è­¬å¦‚æ¶ˆè€—æ—¶é—´ã€å•ä½æ—¶å†‹è¿­ä»£æ¬¡æ•°æˆ–æ¯æ¬¡è¿­ä»£çš„æ¶ˆè€—æ—¶é—´ç”¨åœ¨é¢„çƒ­é˜¶æ®µä¹‹å,é‡‡æ ·é˜¶æ®µæœŸé—´è®°å½•çš„æ€§èƒ½æŒ‡æ ‡ã€‚ç•™æ„åº¦é‡æ—¶é—´çš„ç²¾åº¦å’Œç²’åº¦,ç‰¹åˆ«æ˜¯ä½¿ç”¨äº†System.currentTimeMi1lis()å’Œ System.nanoTime()å†µã€‚å¤šæ¬¡è¿è¡Œè¯•éªŒ,å¹¶å˜æ¢é‡‡æ ·çš„å‘¨æœŸæ•°æˆ–é‡†æ ·çš„æŒç»­æ—¶é—´ã€‚ä¹‹åå†æ¯”è¾ƒå…¶æ‰€æ¶ˆè€—çš„æ—¶é—´,å¯†åˆ‡æ³¨æ„å•ä½æ—¶é—´è¿­ä»£æ¬¡æ•°æˆ–æ¯è¿­ä»£æ¶ˆè€—æ—¶é—´æŒ‡æ ‡çš„å˜åŒ–ã€‚å¾®åŸºå‡†æµ‹è¯•ç»å†äº†è¶³å¤Ÿçš„é¢„çƒ­ã€è¾¾åˆ°ç¨³å®šæ€æ—¶,åä¸€ä¸ªæŒ‡æ ‡å‡ ä¹åº”è¯¥ä¸é‡†æ ·é˜¶æ®µæŒç»­æ—¶é—´çš„å˜åŒ–ä¿æŒä¸€è‡´ã€‚</li><li>å¼€å§‹é‡†æ ·ä¹‹å‰ç¡®è®¤å¾®åŸºå‡†æµ‹è¯•å·²ç»åˆ°è¾¾ç¨³å®šæ€ã€‚å¯éµå¾ªçš„ä¸€æ¡é€šç”¨åŸåˆ™æ˜¯,ç¡®ä¿å¾®åŸºå‡†æµ‹è¯•è‡³å°‘è¿è¡Œ10ç§’ä»¥ä¸Šã€‚ä½¿ç”¨ HotSpotçš„-XX:+PrintCompilationé€‰é¡¹é€šè¿‡æ’å…¥è¡¨ç¤ºå¾®åŸºå‡†æµ‹è¯•æ‰§è¡Œé˜¶æ®µçš„å·¥å…·å¯ä»¥å¸®åŠ©ç¡®è®¤åŸºå‡†æµ‹è¯•å·²ç»åˆ°è¾¾ç¨³å®šæ€ã€‚è¿™ä¸€æ­¥çš„æ—¥çš„æ˜¯ç¡®ä¿åœ¨å¼€å§‹é‡‡æ ·ä¹‹å‰,å¾®åŸºå‡†æµ‹è¯•ç»è¿‡å……åˆ†é¢„çƒ­,åœ¨é‡‡æ ·é˜¶æ®µä¸ä¼šå‘ç”Ÿè¿›ä¸€æ­¥çš„ä¼˜åŒ–æˆ–é€†ä¼˜åŒ–äº‹ä»¶ã€‚</li><li>å¤šæ¬¡è¿è¡ŒåŸºå‡†æµ‹è¯•ä»¥ç¡®ä¿è§‚æµ‹çš„ç»“æœæ˜¯å¯é‡å¤çš„ã€‚å¤šæ¬¡è¿è¡Œå¯ä»¥ä¸ºä½ æœ€ç»ˆçš„ç»“è®ºæä¾›æœ‰åŠ›æ”¯æŒã€‚</li><li>è¿è¡Œå®éªŒåŠè§‚æµ‹ç»“æœæ—¶ç‰¹åˆ«è¦ç•™æ„å¾—åˆ°çš„ç»“æœæ˜¯å¦åˆç†ã€‚å¦‚æœç¢°åˆ°æ— æ³•è§£é‡Šæˆ–å¯ç–‘çš„ç»“æœ,è¦èŠ±æ—¶é—´å»ç ”ç©¶ã€å›é¡¾å®éªŒçš„è®¾è®¡,ç¡®ä¿è§‚å¯Ÿçš„ç»“æœåˆç†ã€‚</li><li>é€šè¿‡ä¼ é€’éšæ—¶å˜åŒ–çš„å‚æ•°åˆ°å…³æ³¨çš„æ–¹æ³•ä¸­ã€è¿”å›å…³æ³¨æ–¹æ³•çš„æ‰§è¡Œç»“æœã€åœ¨é‡‡æ ·å‘¨æœŸä¹‹å¤–æ‰“å°è¾“å‡ºè®¡ç®—ç»“æœä½¿è®¡ç®—æ›´æœ‰æ„ä¹‰,é¿å…åœ¨å¾®åŸºå‡†æµ‹è¯•ä¸­åˆ›å»ºæ— æ•ˆä»£ç ã€‚</li><li>ç•™æ„å†…è”å¯èƒ½å¯¹å¾®åŸºå‡†æµ‹è¯•äº§ç”Ÿçš„å½±å“ã€‚å¦‚æœå¯¹ç»“æœå­˜ç–‘,å¯ä»¥é€šè¿‡XX:+PrintInliningå’Œ-XX:+PrintCompilationå‘½ä»¤è¡Œé€‰é¡¹,åˆ©ç”¨HotSpot Debug VMè§‚å¯ŸHotSpot JITç¼–è¯‘å™¨è¿›è¡Œå†…è”å†³ç­–çš„è¿‡ç¨‹ã€‚</li><li>ç¡®ä¿æ‰§è¡Œå¾®åŸºå‡†æµ‹è¯•æ—¶å…¶ä»–çš„åº”ç”¨ç¨‹åºä¸ä¼šå¯¹ç³»ç»Ÿé€ æˆå½±å“ã€‚æ‰§è¡Œå¾®åŸºå‡†æµ‹è¯•æ—¶å³ä½¿å‘æ¡Œé¢çª—å£ç®¡ç†å™¨ä¸­æ·»åŠ å¾ˆå°æˆ–è€…å¾ˆç®€å•çš„åº”ç”¨ç¨‹åº(è­¬å¦‚å¤©æ°”åº”ç”¨æˆ–è€…è‚¡ç¥¨è¡Œæƒ…è®°å½•è½¯ä»¶),éƒ½ä¼šå¯¹ç³»ç»Ÿæ€§èƒ½é€ æˆå½±å“ã€‚</li><li>å½“ä½ éœ€è¦å¾ˆæ˜ç¡®åœ°äº†è§£JITç¼–è¯‘å™¨ç”Ÿæˆäº†ä»€ä¹ˆæ ·çš„ä¼˜åŒ–ä»£ç æ—¶,å¯ä»¥ä½¿ç”¨Oracle Solaris Studio Performance Analyzeræˆ–è€…HotSpot Debug VM(ä½¿ç”¨-XX:+PrintOptoAssemblyé€‰é¡¹)æŸ¥çœ‹ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ã€‚</li><li>é‡‡ç”¨å°æ•°æ®é›†æˆ–æ•°æ®ç»“æ„çš„å¾®åŸºå‡†æµ‹è¯•å—ç¼“å­˜çš„å½±å“å¾ˆå¤§ã€‚å¾®åŸºå‡†æµ‹è¯•çš„ç»“æœå¯èƒ½æ¯æ¬¡æ‰§è¡Œéƒ½ä¸ä¸€æ ·,åœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œç»“æœä¹Ÿå·®åˆ«å¾ˆå¤§ã€‚</li><li>å¯¹äºé‡‡ç”¨å¤šçº¿ç¨‹çš„å¾®åŸºå‡†æµ‹è¯•éœ€è¦æ„è¯†åˆ°çº¿ç¨‹è°ƒåº¦å¯èƒ½ä¸æ˜¯ç¡®å®šæ€§çš„,ç‰¹åˆ«æ˜¯åœ¨è´Ÿè·è¾ƒé‡çš„æƒ…å†µä¸‹ã€‚</li></ol><p>PDFä¹¦ç±ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/jiankunking/books-recommendation/tree/master/Java" target="_blank" rel="noopener">https://github.com/jiankunking/books-recommendation/tree/master/Java</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Performance </tag>
            
            <tag> GC </tag>
            
            <tag> è¯»ä¹¦ç¬”è®° </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Arthas å­¦ä¹ ç¬”è®°</title>
      <link href="/arthas-learning-notes.html"/>
      <url>/arthas-learning-notes.html</url>
      
        <content type="html"><![CDATA[<p>é˜¿é‡Œ Arthas å­¦ä¹ ç¬”è®°</p><a id="more"></a><h1 id="thread"><a href="#thread" class="headerlink" title="thread"></a>thread</h1><p>æŸ¥çœ‹å½“å‰çº¿ç¨‹ä¿¡æ¯ï¼ŒæŸ¥çœ‹çº¿ç¨‹çš„å †æ ˆã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>id</td><td>çº¿ç¨‹id</td><td></td></tr><tr><td>[n:]</td><td>æŒ‡å®šæœ€å¿™çš„å‰Nä¸ªçº¿ç¨‹å¹¶æ‰“å°å †æ ˆ</td><td>thread -n 3</td></tr><tr><td>[b]</td><td>æ‰¾å‡ºå½“å‰é˜»å¡å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹</td><td>thread -b</td></tr><tr><td>[i <value>]</value></td><td>æŒ‡å®šcpuå æ¯”ç»Ÿè®¡çš„é‡‡æ ·é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’</td><td></td></tr></tbody></table><blockquote><p>æ³¨æ„ï¼Œ ç›®å‰åªæ”¯æŒæ‰¾å‡ºsynchronizedå…³é”®å­—é˜»å¡ä½çš„çº¿ç¨‹ï¼Œ å¦‚æœæ˜¯java.util.concurrent.Lockï¼Œ ç›®å‰è¿˜ä¸æ”¯æŒã€‚</p></blockquote><h1 id="jvm"><a href="#jvm" class="headerlink" title="jvm"></a>jvm</h1><p>æŸ¥çœ‹å½“å‰JVMä¿¡æ¯ã€‚</p><p>ä½¿ç”¨å‚è€ƒï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">$ jvm</span><br><span class="line"> RUNTIME                                                                                                                                                                                       </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MACHINE-NAME                                           1@9db2689bb4d6                                                                                                                         </span><br><span class="line"> JVM-START-TIME                                         2019-07-16 18:18:06                                                                                                                    </span><br><span class="line"> MANAGEMENT-SPEC-VERSION                                2.0                                                                                                                                    </span><br><span class="line"> SPEC-NAME                                              Java Virtual Machine Specification                                                                                                     </span><br><span class="line"> SPEC-VENDOR                                            Oracle Corporation                                                                                                                     </span><br><span class="line"> SPEC-VERSION                                           12                                                                                                                                     </span><br><span class="line"> VM-NAME                                                OpenJDK 64-Bit Server VM                                                                                                               </span><br><span class="line"> VM-VENDOR                                              Oracle Corporation                                                                                                                     </span><br><span class="line"> VM-VERSION                                             12.0.1+12                                                                                                                              </span><br><span class="line"> INPUT-ARGUMENTS                                        -XX:G1PeriodicGCInterval=120000                                                                                                        </span><br><span class="line">                                                        -XX:G1PeriodicGCSystemLoadThreshold=0                                                                                                  </span><br><span class="line">                                                                                                                                                                                               </span><br><span class="line"> CLASS-PATH                                             application.jar                                                                                                                        </span><br><span class="line"> BOOT-CLASS-PATH                                                                                                                                                                               </span><br><span class="line"> LIBRARY-PATH                                           /usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib                                                                                 </span><br><span class="line">                                                                                                                                                                                               </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> CLASS-LOADING                                                                                                                                                                                 </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> LOADED-CLASS-COUNT                                     11046                                                                                                                                  </span><br><span class="line"> TOTAL-LOADED-CLASS-COUNT                               11377                                                                                                                                  </span><br><span class="line"> UNLOADED-CLASS-COUNT                                   331                                                                                                                                    </span><br><span class="line"> IS-VERBOSE                                             false                                                                                                                                  </span><br><span class="line">                                                                                                                                                                                               </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> COMPILATION                                                                                                                                                                                   </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> NAME                                                   HotSpot 64-Bit Tiered Compilers                                                                                                        </span><br><span class="line"> TOTAL-COMPILE-TIME                                     74558(ms)                                                                                                                              </span><br><span class="line">                                                                                                                                                                                               </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> GARBAGE-COLLECTORS                                                                                                                                                                            </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> G1 Young Generation                                    12027/52593(ms)                                                                                                                        </span><br><span class="line"> [count/time]                                                                                                                                                                                  </span><br><span class="line"> G1 Old Generation                                      0/0(ms)                                                                                                                                </span><br><span class="line"> [count/time]                                                                                                                                                                                  </span><br><span class="line">                                                                                                                                                                                               </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MEMORY-MANAGERS                                                                                                                                                                               </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> CodeCacheManager                                       CodeHeap &apos;non-nmethods&apos;                                                                                                                </span><br><span class="line">                                                        CodeHeap &apos;profiled nmethods&apos;                                                                                                           </span><br><span class="line">                                                        CodeHeap &apos;non-profiled nmethods&apos;                                                                                                       </span><br><span class="line">                                                                                                                                                                                               </span><br><span class="line"> Metaspace Manager                                      Metaspace                                                                                                                              </span><br><span class="line">                                                        Compressed Class Space                                                                                                                 </span><br><span class="line">                                                                                                                                                                                               </span><br><span class="line"> G1 Young Generation                                    G1 Eden Space                                                                                                                          </span><br><span class="line">                                                        G1 Survivor Space                                                                                                                      </span><br><span class="line">                                                        G1 Old Gen                                                                                                                             </span><br><span class="line">                                                                                                                                                                                               </span><br><span class="line"> G1 Old Generation                                      G1 Eden Space                                                                                                                          </span><br><span class="line">                                                        G1 Survivor Space                                                                                                                      </span><br><span class="line">                                                        G1 Old Gen                                                                                                                             </span><br><span class="line">                                                                                                                                                                                               </span><br><span class="line">                                                                                                                                                                                               </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MEMORY                                                                                                                                                                                        </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> HEAP-MEMORY-USAGE                                      184549376(176.00 MiB)/2113929216(1.97 GiB)/32178700288(29.97 GiB)/60812520(58.00 MiB)                                                  </span><br><span class="line"> [committed/init/max/used]                                                                                                                                                                     </span><br><span class="line"> NO-HEAP-MEMORY-USAGE                                   115539968(110.19 MiB)/7667712(7.31 MiB)/-1(-1 B)/108227072(103.21 MiB)                                                                 </span><br><span class="line"> [committed/init/max/used]                                                                                                                                                                     </span><br><span class="line"> PENDING-FINALIZE-COUNT                                 0                                                                                                                                      </span><br><span class="line">                                                                                                                                                                                               </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> OPERATING-SYSTEM                                                                                                                                                                              </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> OS                                                     Linux                                                                                                                                  </span><br><span class="line"> ARCH                                                   amd64                                                                                                                                  </span><br><span class="line"> PROCESSORS-COUNT                                       32                                                                                                                                     </span><br><span class="line"> LOAD-AVERAGE                                           2.25                                                                                                                                   </span><br><span class="line"> VERSION                                                3.10.0-514.26.2.el7.x86_64                                                                                                             </span><br><span class="line">                                                                                                                                                                                               </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> THREAD                                                                                                                                                                                        </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> COUNT                                                  1060                                                                                                                                   </span><br><span class="line"> DAEMON-COUNT                                           25                                                                                                                                     </span><br><span class="line"> PEAK-COUNT                                             1062                                                                                                                                   </span><br><span class="line"> STARTED-COUNT                                          2463                                                                                                                                   </span><br><span class="line"> DEADLOCK-COUNT                                         0                                                                                                                                      </span><br><span class="line">                                                                                                                                                                                               </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> FILE-DESCRIPTOR                                                                                                                                                                               </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MAX-FILE-DESCRIPTOR-COUNT                              -1                                                                                                                                     </span><br><span class="line"> OPEN-FILE-DESCRIPTOR-COUNT                             -1                                                                                                                                     </span><br><span class="line">Affect(row-cnt:0) cost in 14 ms.</span><br></pre></td></tr></table></figure><h1 id="sysprop"><a href="#sysprop" class="headerlink" title="sysprop"></a>sysprop</h1><p>æŸ¥çœ‹å½“å‰JVMçš„ç³»ç»Ÿå±æ€§(System Property)ã€‚</p><p>ä¸jinfo ä¿¡æ¯ç±»ä¼¼ï¼Œä¸è¿‡syspropæä¾›ä¿®æ”¹å•ä¸ªå±æ€§å€¼çš„åŠŸèƒ½ã€‚</p><p>æŸ¥çœ‹å•ä¸ªå±æ€§ï¼Œæ”¯æŒé€šè¿‡TABé”®è‡ªåŠ¨è¡¥å…¨ã€‚</p><h1 id="sysenv"><a href="#sysenv" class="headerlink" title="sysenv"></a>sysenv</h1><p>æŸ¥çœ‹å½“å‰JVMçš„ç¯å¢ƒå±æ€§(System Environment Variables)ã€‚</p><p>æŸ¥çœ‹å•ä¸ªå±æ€§ï¼Œæ”¯æŒé€šè¿‡TABé”®è‡ªåŠ¨è¡¥å…¨ã€‚</p><h1 id="scã€smã€jad"><a href="#scã€smã€jad" class="headerlink" title="scã€smã€jad"></a>scã€smã€jad</h1><h2 id="sc"><a href="#sc" class="headerlink" title="sc"></a>sc</h2><p>æŸ¥çœ‹JVMå·²åŠ è½½çš„ç±»ä¿¡æ¯,å¯ä»¥packageå‰ç¼€æ¨¡ç³ŠåŒ¹é…ã€‚</p><h2 id="sm"><a href="#sm" class="headerlink" title="sm"></a>sm</h2><p>æŸ¥çœ‹å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ monitor com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWord</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost in 90 ms.</span><br><span class="line"> timestamp            class                                                method                total  success  fail  avg-rt(ms)  fail-rate                                                   </span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------                                                  </span><br><span class="line"> 2019-08-02 10:37:50  com.jiankunking.logsearch.services.LogSearchService  queryStringByKeyWord  61     61       0     96.68       0.00%                                                       </span><br><span class="line"></span><br><span class="line"> timestamp            class                                                method                total  success  fail  avg-rt(ms)  fail-rate                                                   </span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------                                                  </span><br><span class="line"> 2019-08-02 10:38:50  com.jiankunking.logsearch.services.LogSearchService  queryStringByKeyWord  27     27       0     51.06       0.00%                                                       </span><br><span class="line"></span><br><span class="line"> timestamp            class                                                method                total  success  fail  avg-rt(ms)  fail-rate                                                   </span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------                                                  </span><br><span class="line"> 2019-08-02 10:39:50  com.jiankunking.logsearch.services.LogSearchService  queryStringByKeyWord  0      0        0     0.00        0.00%</span><br></pre></td></tr></table></figure><h2 id="jad"><a href="#jad" class="headerlink" title="jad"></a>jad</h2><p>åç¼–è¯‘æŒ‡å®šå·²åŠ è½½ç±»çš„æºç ã€‚</p><p>jad å‘½ä»¤å°† JVM ä¸­å®é™…è¿è¡Œçš„ class çš„ byte code åç¼–è¯‘æˆ java ä»£ç ï¼Œä¾¿äºä½ ç†è§£ä¸šåŠ¡é€»è¾‘ï¼›</p><ul><li>åœ¨ Arthas Console ä¸Šï¼Œåç¼–è¯‘å‡ºæ¥çš„æºç æ˜¯å¸¦è¯­æ³•é«˜äº®çš„ï¼Œé˜…è¯»æ›´æ–¹ä¾¿</li><li>å½“ç„¶ï¼Œåç¼–è¯‘å‡ºæ¥çš„ java ä»£ç å¯èƒ½ä¼šå­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œä½†ä¸å½±å“ä½ è¿›è¡Œé˜…è¯»ç†è§£</li></ul><blockquote><p>scã€smã€jad ä¸‰ä¸ªå‘½ä»¤å¯ä»¥ç»“åˆä½¿ç”¨ã€‚</p></blockquote><h1 id="classloader"><a href="#classloader" class="headerlink" title="classloader"></a>classloader</h1><p>æŸ¥çœ‹classloaderçš„ç»§æ‰¿æ ‘ï¼Œurlsï¼Œç±»åŠ è½½ä¿¡æ¯ã€‚</p><p>classloader å‘½ä»¤å°† JVM ä¸­æ‰€æœ‰çš„classloaderçš„ä¿¡æ¯ç»Ÿè®¡å‡ºæ¥ï¼Œå¹¶å¯ä»¥å±•ç¤ºç»§æ‰¿æ ‘ï¼Œurlsç­‰ã€‚</p><p>å¯ä»¥è®©æŒ‡å®šçš„classloaderå»getResourcesï¼Œæ‰“å°å‡ºæ‰€æœ‰æŸ¥æ‰¾åˆ°çš„resourcesçš„urlã€‚å¯¹äºResourceNotFoundExceptionæ¯”è¾ƒæœ‰ç”¨ã€‚</p><h1 id="mcã€redefine"><a href="#mcã€redefine" class="headerlink" title="mcã€redefine"></a>mcã€redefine</h1><h2 id="mc"><a href="#mc" class="headerlink" title="mc"></a>mc</h2><p>Memory Compiler/å†…å­˜ç¼–è¯‘å™¨ï¼Œç¼–è¯‘.javaæ–‡ä»¶ç”Ÿæˆ.classã€‚</p><h2 id="redefine"><a href="#redefine" class="headerlink" title="redefine"></a>redefine</h2><p>åŠ è½½å¤–éƒ¨çš„.classæ–‡ä»¶ï¼Œredefine jvmå·²åŠ è½½çš„ç±»ã€‚</p><blockquote><p>mcã€redefine å¯ä»¥ç»“åˆä½¿ç”¨</p></blockquote><h1 id="monitor"><a href="#monitor" class="headerlink" title="monitor"></a>monitor</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ monitor com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWord</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost in 90 ms.</span><br><span class="line"> timestamp            class                                                method                total  success  fail  avg-rt(ms)  fail-rate                                                   </span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------                                                  </span><br><span class="line"> 2019-08-02 10:37:50  com.jiankunking.logsearch.services.LogSearchService  queryStringByKeyWord  61     61       0     96.68       0.00%                                                       </span><br><span class="line"></span><br><span class="line"> timestamp            class                                                method                total  success  fail  avg-rt(ms)  fail-rate                                                   </span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------                                                  </span><br><span class="line"> 2019-08-02 10:38:50  com.jiankunking.logsearch.services.LogSearchService  queryStringByKeyWord  27     27       0     51.06       0.00%                                                       </span><br><span class="line"></span><br><span class="line"> timestamp            class                                                method                total  success  fail  avg-rt(ms)  fail-rate                                                   </span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------                                                  </span><br><span class="line"> 2019-08-02 10:39:50  com.jiankunking.logsearch.services.LogSearchService  queryStringByKeyWord  0      0        0     0.00        0.00%</span><br></pre></td></tr></table></figure><h1 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h1><p>æ–¹æ³•æ‰§è¡Œæ•°æ®è§‚æµ‹ã€‚</p><p>è®©ä½ èƒ½æ–¹ä¾¿çš„è§‚å¯Ÿåˆ°æŒ‡å®šæ–¹æ³•çš„è°ƒç”¨æƒ…å†µã€‚èƒ½è§‚å¯Ÿåˆ°çš„èŒƒå›´ä¸ºï¼šè¿”å›å€¼ã€æŠ›å‡ºå¼‚å¸¸ã€å…¥å‚ï¼Œé€šè¿‡ç¼–å†™OGNL è¡¨è¾¾å¼è¿›è¡Œå¯¹åº”å˜é‡çš„æŸ¥çœ‹ã€‚</p><blockquote><p>è¿™ä¸ªæœ‰ç‚¹å¼ºå¤§å•Š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">$ watch  com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWord  &quot;&#123;params,target,returnObj&#125;&quot; -x 2 -b -s -n 2</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost in 111 ms.</span><br><span class="line">ts=2019-08-02 10:48:48; [cost=0.006503ms] result=@ArrayList[</span><br><span class="line">    @Object[][</span><br><span class="line">        @String[monitor],</span><br><span class="line">        @String[console],</span><br><span class="line">        null,</span><br><span class="line">        @String[all],</span><br><span class="line">        @String[all],</span><br><span class="line">        null,</span><br><span class="line">        null,</span><br><span class="line">        @Integer[100],</span><br><span class="line">        @Long[1564713816522],</span><br><span class="line">        @Long[1564714116522],</span><br><span class="line">        null,</span><br><span class="line">        @[desc],</span><br><span class="line">    ],</span><br><span class="line">    @LogSearchService[</span><br><span class="line">        log=@Logger[Logger[com.jiankunking.logsearch.services.LogSearchService]],</span><br><span class="line">        esFilterService=@ESFilterService[com.jiankunking.logsearch.services.ESFilterService@58ebfd03],</span><br><span class="line">        indexPrefixService=@IndexPrefixService[com.jiankunking.logsearch.services.IndexPrefixService@19fb8826],</span><br><span class="line">        searchAfterSort=@String[][isEmpty=false;size=3],</span><br><span class="line">    ],</span><br><span class="line">    null,</span><br><span class="line">]</span><br><span class="line">ts=2019-08-02 10:48:48; [cost=91.878471ms] result=@ArrayList[</span><br><span class="line">    @Object[][</span><br><span class="line">        @String[monitor],</span><br><span class="line">        @String[console],</span><br><span class="line">        null,</span><br><span class="line">        @String[all],</span><br><span class="line">        @String[all],</span><br><span class="line">        null,</span><br><span class="line">        null,</span><br><span class="line">        @Integer[100],</span><br><span class="line">        @Long[1564713816522],</span><br><span class="line">        @Long[1564714116522],</span><br><span class="line">        null,</span><br><span class="line">        @[desc],</span><br><span class="line">    ],</span><br><span class="line">    @LogSearchService[</span><br><span class="line">        log=@Logger[Logger[com.jiankunking.logsearch.services.LogSearchService]],</span><br><span class="line">        esFilterService=@ESFilterService[com.jiankunking.logsearch.services.ESFilterService@58ebfd03],</span><br><span class="line">        indexPrefixService=@IndexPrefixService[com.jiankunking.logsearch.services.IndexPrefixService@19fb8826],</span><br><span class="line">        searchAfterSort=@String[][isEmpty=false;size=3],</span><br><span class="line">    ],</span><br><span class="line">    @SearchResult[</span><br><span class="line">        metadata=@MetaData[MetaData(total=21431)],</span><br><span class="line">        items=@ArrayList[isEmpty=false;size=100],</span><br><span class="line">    ],</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h1 id="trace"><a href="#trace" class="headerlink" title="trace"></a>trace</h1><p>æ–¹æ³•å†…éƒ¨è°ƒç”¨è·¯å¾„ï¼Œå¹¶è¾“å‡ºæ–¹æ³•è·¯å¾„ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè€—æ—¶</p><p>trace å‘½ä»¤èƒ½ä¸»åŠ¨æœç´¢ class-patternï¼method-pattern å¯¹åº”çš„æ–¹æ³•è°ƒç”¨è·¯å¾„ï¼Œæ¸²æŸ“å’Œç»Ÿè®¡æ•´ä¸ªè°ƒç”¨é“¾è·¯ä¸Šçš„æ‰€æœ‰æ€§èƒ½å¼€é”€å’Œè¿½è¸ªè°ƒç”¨é“¾è·¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">$ trace  com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWord </span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost in 182 ms.</span><br><span class="line">`---ts=2019-08-02 10:53:36;thread_name=http-nio-8080-exec-8;id=42d;is_daemon=true;priority=5;TCCL=org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@1095194</span><br><span class="line">    `---[416.520613ms] com.jiankunking.logsearch.services.LogSearchService:queryStringByKeyWord()</span><br><span class="line">        +---[0.019415ms] org.elasticsearch.search.builder.SearchSourceBuilder:&lt;init&gt;() #78</span><br><span class="line">        +---[0.011853ms] org.elasticsearch.index.query.QueryBuilders:boolQuery() #79</span><br><span class="line">        +---[0.02617ms] com.jiankunking.logsearch.services.ESFilterService:addProjectFilter() #80</span><br><span class="line">        +---[0.005593ms] com.jiankunking.logsearch.util.StringUtils:isEmpty() #81</span><br><span class="line">        +---[0.006519ms] java.lang.String:equals() #81</span><br><span class="line">        +---[0.002157ms] com.jiankunking.logsearch.util.StringUtils:isEmpty() #84</span><br><span class="line">        +---[0.002046ms] java.lang.String:equals() #84</span><br><span class="line">        +---[0.004284ms] com.jiankunking.logsearch.util.StringUtils:isNotEmpty() #87</span><br><span class="line">        +---[0.002342ms] com.jiankunking.logsearch.util.StringUtils:isNotEmpty() #90</span><br><span class="line">        +---[0.002066ms] com.jiankunking.logsearch.util.StringUtils:isNotEmpty() #98</span><br><span class="line">        +---[0.005008ms] org.elasticsearch.index.query.QueryBuilders:rangeQuery() #114</span><br><span class="line">        +---[0.005904ms] com.jiankunking.logsearch.util.TimeUtils:toDate() #115</span><br><span class="line">        +---[0.006666ms] org.elasticsearch.index.query.RangeQueryBuilder:gte() #115</span><br><span class="line">        +---[0.002128ms] com.jiankunking.logsearch.util.TimeUtils:toDate() #116</span><br><span class="line">        +---[0.004161ms] org.elasticsearch.index.query.RangeQueryBuilder:lte() #116</span><br><span class="line">        +---[0.347063ms] org.elasticsearch.index.query.BoolQueryBuilder:must() #117</span><br><span class="line">        +---[min=0.002196ms,max=0.030129ms,total=0.036436ms,count=3] org.elasticsearch.search.builder.SearchSourceBuilder:sort() #126</span><br><span class="line">        +---[0.005683ms] org.elasticsearch.search.builder.SearchSourceBuilder:fetchSource() #131</span><br><span class="line">        +---[0.003406ms] org.elasticsearch.search.builder.SearchSourceBuilder:size() #133</span><br><span class="line">        +---[0.003613ms] org.elasticsearch.search.builder.SearchSourceBuilder:query() #133</span><br><span class="line">        +---[0.321264ms] org.elasticsearch.search.builder.SearchSourceBuilder:toString() #134</span><br><span class="line">        +---[0.00689ms] org.springframework.http.HttpMethod:name() #136</span><br><span class="line">        +---[0.172438ms] com.jiankunking.logsearch.services.IndexPrefixService:getIndexPrefix() #136</span><br><span class="line">        +---[0.012968ms] com.jiankunking.logsearch.util.ESQueryUtils:getEndpoint() #136</span><br><span class="line">        +---[398.953869ms] com.jiankunking.logsearch.util.ESQueryUtils:performRequest() #136</span><br><span class="line">        +---[0.336319ms] com.alibaba.fastjson.JSON:parse() #138</span><br><span class="line">        +---[min=0.002461ms,max=0.013798ms,total=0.016259ms,count=2] java.util.Map:get() #140</span><br><span class="line">        +---[0.006434ms] java.lang.Integer:intValue() #140</span><br><span class="line">        +---[min=0.001908ms,max=0.002073ms,total=0.003981ms,count=2] java.util.Map:get() #141</span><br><span class="line">        +---[0.007532ms] com.jiankunking.logsearch.dto.SearchResult:&lt;init&gt;() #145</span><br><span class="line">        +---[0.004286ms] java.util.ArrayList:&lt;init&gt;() #146</span><br><span class="line">        +---[0.005725ms] com.alibaba.fastjson.JSONArray:iterator() #148</span><br><span class="line">        +---[min=8.07E-4ms,max=0.010324ms,total=0.124433ms,count=101] java.util.Iterator:hasNext() #148</span><br><span class="line">        +---[min=8.16E-4ms,max=0.009674ms,total=0.114893ms,count=100] java.util.Iterator:next() #148</span><br><span class="line">        +---[min=8.38E-4ms,max=0.013835ms,total=0.130734ms,count=100] com.alibaba.fastjson.JSONObject:get() #150</span><br><span class="line">        +---[min=8.69E-4ms,max=0.005654ms,total=0.112518ms,count=100] com.jiankunking.logsearch.util.MapUtils:getSize() #151</span><br><span class="line">        +---[min=7.84E-4ms,max=0.005522ms,total=0.106345ms,count=100] java.util.HashMap:&lt;init&gt;() #151</span><br><span class="line">        +---[min=8.4E-4ms,max=0.016457ms,total=0.12907ms,count=100] com.alibaba.fastjson.JSONArray:iterator() #152</span><br><span class="line">        +---[min=8.21E-4ms,max=0.002612ms,total=0.106495ms,count=100] java.util.Iterator:hasNext() #152</span><br><span class="line">        +---[min=8.07E-4ms,max=0.018355ms,total=0.143992ms,count=100] java.util.Iterator:next() #152</span><br><span class="line">        +---[min=8.72E-4ms,max=0.008687ms,total=0.132524ms,count=100] java.lang.String:valueOf() #153</span><br><span class="line">        +---[min=8.07E-4ms,max=0.008049ms,total=0.110329ms,count=100] java.lang.String:contains() #153</span><br><span class="line">        +---[min=8.46E-4ms,max=0.002612ms,total=0.109295ms,count=100] java.lang.String:valueOf() #156</span><br><span class="line">        +---[min=8.86E-4ms,max=0.041239ms,total=0.178986ms,count=100] java.util.HashMap:put() #156</span><br><span class="line">        +---[min=7.96E-4ms,max=0.008521ms,total=0.113489ms,count=100] com.alibaba.fastjson.JSONObject:get() #159</span><br><span class="line">        +---[min=8.2E-4ms,max=0.016801ms,total=0.125154ms,count=100] java.util.Map:get() #159</span><br><span class="line">        +---[min=8.39E-4ms,max=0.002089ms,total=0.106842ms,count=100] java.util.HashMap:put() #159</span><br><span class="line">        +---[min=7.86E-4ms,max=0.002836ms,total=0.104852ms,count=100] com.alibaba.fastjson.JSONObject:get() #160</span><br><span class="line">        +---[min=8.4E-4ms,max=0.003068ms,total=0.10763ms,count=100] java.util.HashMap:put() #160</span><br><span class="line">        +---[min=8.02E-4ms,max=0.020112ms,total=0.122423ms,count=100] com.alibaba.fastjson.JSONObject:get() #161</span><br><span class="line">        +---[min=8.22E-4ms,max=0.001939ms,total=0.104809ms,count=100] java.util.HashMap:put() #161</span><br><span class="line">        +---[min=7.99E-4ms,max=0.00186ms,total=0.10316ms,count=100] com.alibaba.fastjson.JSONObject:get() #162</span><br><span class="line">        +---[min=8.17E-4ms,max=0.012238ms,total=0.115955ms,count=100] java.util.Map:get() #162</span><br><span class="line">        +---[min=8.14E-4ms,max=0.018342ms,total=0.124331ms,count=100] java.util.HashMap:put() #162</span><br><span class="line">        +---[min=8.47E-4ms,max=0.003852ms,total=0.113692ms,count=100] com.alibaba.fastjson.JSONObject:containsKey() #164</span><br><span class="line">        +---[min=8.11E-4ms,max=0.017145ms,total=0.122375ms,count=100] com.alibaba.fastjson.JSONObject:containsKey() #167</span><br><span class="line">        +---[min=7.85E-4ms,max=0.002459ms,total=0.10233ms,count=100] com.alibaba.fastjson.JSONObject:get() #167</span><br><span class="line">        +---[min=8.57E-4ms,max=0.005959ms,total=0.11281ms,count=100] java.util.Map:containsKey() #167</span><br><span class="line">        +---[min=7.86E-4ms,max=0.016889ms,total=0.116022ms,count=100] com.alibaba.fastjson.JSONObject:get() #171</span><br><span class="line">        +---[min=8.27E-4ms,max=0.007969ms,total=0.121529ms,count=100] java.util.Map:get() #171</span><br><span class="line">        +---[min=8.24E-4ms,max=0.017969ms,total=0.126264ms,count=100] java.util.Map:containsKey() #171</span><br><span class="line">        +---[min=7.83E-4ms,max=0.001924ms,total=0.101244ms,count=100] com.alibaba.fastjson.JSONObject:get() #172</span><br><span class="line">        +---[min=7.92E-4ms,max=0.247702ms,total=0.502606ms,count=200] java.util.Map:get() #172</span><br><span class="line">        +---[min=8.61E-4ms,max=0.010095ms,total=0.124106ms,count=100] java.util.HashMap:put() #172</span><br><span class="line">        +---[min=7.84E-4ms,max=0.002789ms,total=0.100561ms,count=100] com.alibaba.fastjson.JSONObject:get() #174</span><br><span class="line">        +---[min=8.18E-4ms,max=0.003825ms,total=0.105746ms,count=100] java.util.Map:get() #174</span><br><span class="line">        +---[min=8.17E-4ms,max=0.003044ms,total=0.108946ms,count=100] java.util.Map:containsKey() #174</span><br><span class="line">        +---[min=7.83E-4ms,max=0.010689ms,total=0.10957ms,count=100] com.alibaba.fastjson.JSONObject:get() #175</span><br><span class="line">        +---[min=7.92E-4ms,max=0.018299ms,total=0.225606ms,count=200] java.util.Map:get() #175</span><br><span class="line">        +---[min=8.53E-4ms,max=0.002182ms,total=0.108485ms,count=100] java.util.HashMap:put() #175</span><br><span class="line">        +---[min=7.84E-4ms,max=0.005874ms,total=0.103371ms,count=100] com.alibaba.fastjson.JSONObject:get() #177</span><br><span class="line">        +---[min=8.02E-4ms,max=0.002017ms,total=0.101695ms,count=100] java.util.Map:get() #177</span><br><span class="line">        +---[min=8.26E-4ms,max=0.002735ms,total=0.106121ms,count=100] java.util.Map:containsKey() #177</span><br><span class="line">        +---[min=8.0E-4ms,max=0.017176ms,total=0.130393ms,count=100] com.alibaba.fastjson.JSONObject:get() #178</span><br><span class="line">        +---[min=8.03E-4ms,max=0.003318ms,total=0.204767ms,count=200] java.util.Map:get() #178</span><br><span class="line">        +---[min=8.55E-4ms,max=0.008081ms,total=0.115006ms,count=100] java.util.HashMap:put() #178</span><br><span class="line">        +---[min=9.11E-4ms,max=0.014017ms,total=0.136197ms,count=100] java.util.List:add() #180</span><br><span class="line">        +---[0.005288ms] com.jiankunking.logsearch.dto.SearchResult:setItems() #182</span><br><span class="line">        `---[0.002643ms] com.jiankunking.logsearch.dto.SearchResult:setTotal() #183</span><br></pre></td></tr></table></figure><h1 id="stack"><a href="#stack" class="headerlink" title="stack"></a>stack</h1><p>è¾“å‡ºå½“å‰æ–¹æ³•è¢«è°ƒç”¨çš„è°ƒç”¨è·¯å¾„ã€‚</p><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½çŸ¥é“ä¸€ä¸ªæ–¹æ³•è¢«æ‰§è¡Œï¼Œä½†è¿™ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„è·¯å¾„éå¸¸å¤šï¼Œæˆ–è€…ä½ æ ¹æœ¬å°±ä¸çŸ¥é“è¿™ä¸ªæ–¹æ³•æ˜¯ä»é‚£é‡Œè¢«æ‰§è¡Œäº†ï¼Œæ­¤æ—¶ä½ éœ€è¦çš„æ˜¯ stack å‘½ä»¤ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">$ stack  com.jiankunking.logsearch.services.LogSearchService queryStringByKeyWord </span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost in 173 ms.</span><br><span class="line">ts=2019-08-02 10:55:44;thread_name=http-nio-8080-exec-1;id=426;is_daemon=true;priority=5;TCCL=org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@1095194</span><br><span class="line">    @com.jiankunking.logsearch.controller.LogSearchController.searchByKeyWord()</span><br><span class="line">        at com.jiankunking.logsearch.controller.LogSearchController$$FastClassBySpringCGLIB$$61775844.invoke(&lt;generated&gt;:-1)</span><br><span class="line">        at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204)</span><br><span class="line">        at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:746)</span><br><span class="line">        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)</span><br><span class="line">        at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88)</span><br><span class="line">        at com.jiankunking.logsearch.aspect.ControllerTimeConsumeAspect.doAround(ControllerTimeConsumeAspect.java:34)</span><br><span class="line">        at jdk.internal.reflect.GeneratedMethodAccessor91.invoke(null:-1)</span><br><span class="line">        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:567)</span><br><span class="line">        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)</span><br><span class="line">        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)</span><br><span class="line">        at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)</span><br><span class="line">        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:174)</span><br><span class="line">        at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)</span><br><span class="line">        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:185)</span><br><span class="line">        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)</span><br><span class="line">        at com.jiankunking.logsearch.controller.LogSearchController$$EnhancerBySpringCGLIB$$2f145034.searchByKeyWord(&lt;generated&gt;:-1)</span><br><span class="line">        at jdk.internal.reflect.GeneratedMethodAccessor97.invoke(null:-1)</span><br><span class="line">        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:567)</span><br><span class="line">        at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:209)</span><br><span class="line">        at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:136)</span><br><span class="line">        at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)</span><br><span class="line">        at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:891)</span><br><span class="line">        at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:797)</span><br><span class="line">        at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)</span><br><span class="line">        at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:991)</span><br><span class="line">        at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:925)</span><br><span class="line">        at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:974)</span><br><span class="line">        at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:866)</span><br><span class="line">        at javax.servlet.http.HttpServlet.service(HttpServlet.java:635)</span><br><span class="line">        at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:851)</span><br><span class="line">        at javax.servlet.http.HttpServlet.service(HttpServlet.java:742)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">        at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">        at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)</span><br><span class="line">        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">        at org.springframework.web.filter.HttpPutFormContentFilter.doFilterInternal(HttpPutFormContentFilter.java:109)</span><br><span class="line">        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">        at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)</span><br><span class="line">        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">        at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)</span><br><span class="line">        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:198)</span><br><span class="line">        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)</span><br><span class="line">        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:493)</span><br><span class="line">        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)</span><br><span class="line">        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:81)</span><br><span class="line">        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)</span><br><span class="line">        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)</span><br><span class="line">        at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:800)</span><br><span class="line">        at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)</span><br><span class="line">        at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:806)</span><br><span class="line">        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1498)</span><br><span class="line">        at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)</span><br><span class="line">        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:835)</span><br></pre></td></tr></table></figure><h1 id="tt"><a href="#tt" class="headerlink" title="tt"></a>tt</h1><p>æ–¹æ³•æ‰§è¡Œæ•°æ®çš„æ—¶ç©ºéš§é“ï¼Œè®°å½•ä¸‹æŒ‡å®šæ–¹æ³•æ¯æ¬¡è°ƒç”¨çš„å…¥å‚å’Œè¿”å›ä¿¡æ¯ï¼Œå¹¶èƒ½å¯¹è¿™äº›ä¸åŒçš„æ—¶é—´ä¸‹è°ƒç”¨è¿›è¡Œè§‚æµ‹ã€‚</p><h1 id="options"><a href="#options" class="headerlink" title="options"></a>options</h1><p>å…¨å±€å¼€å…³</p><table><thead><tr><th>åç§°</th><th>é»˜è®¤å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>unsafe</td><td>false</td><td>æ˜¯å¦æ”¯æŒå¯¹ç³»ç»Ÿçº§åˆ«çš„ç±»è¿›è¡Œå¢å¼ºï¼Œæ‰“å¼€è¯¥å¼€å…³å¯èƒ½å¯¼è‡´æŠŠJVMææŒ‚ï¼Œè¯·æ…é‡é€‰æ‹©ï¼</td></tr><tr><td>dump</td><td>false</td><td>æ˜¯å¦æ”¯æŒè¢«å¢å¼ºäº†çš„ç±»dumpåˆ°å¤–éƒ¨æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ‰“å¼€å¼€å…³ï¼Œclassæ–‡ä»¶ä¼šè¢«dumpåˆ°/${application dir}/arthas-class-dump/ç›®å½•ä¸‹ï¼Œå…·ä½“ä½ç½®è¯¦è§æ§åˆ¶å°è¾“å‡º</td></tr><tr><td>batch-re-transform</td><td>true</td><td>æ˜¯å¦æ”¯æŒæ‰¹é‡å¯¹åŒ¹é…åˆ°çš„ç±»æ‰§è¡Œretransformæ“ä½œ</td></tr><tr><td>json-format</td><td>false</td><td>æ˜¯å¦æ”¯æŒjsonåŒ–çš„è¾“å‡º</td></tr><tr><td>disable-sub-class</td><td>false</td><td>æ˜¯å¦ç¦ç”¨å­ç±»åŒ¹é…ï¼Œé»˜è®¤åœ¨åŒ¹é…ç›®æ ‡ç±»çš„æ—¶å€™ä¼šé»˜è®¤åŒ¹é…åˆ°å…¶å­ç±»ï¼Œå¦‚æœæƒ³ç²¾ç¡®åŒ¹é…ï¼Œå¯ä»¥å…³é—­æ­¤å¼€å…³</td></tr><tr><td>debug-for-asm</td><td>false</td><td>æ‰“å°ASMç›¸å…³çš„è°ƒè¯•ä¿¡æ¯</td></tr><tr><td>save-result</td><td>false</td><td>æ˜¯å¦æ‰“å¼€æ‰§è¡Œç»“æœå­˜æ—¥å¿—åŠŸèƒ½ï¼Œæ‰“å¼€ä¹‹åæ‰€æœ‰å‘½ä»¤çš„è¿è¡Œç»“æœéƒ½å°†ä¿å­˜åˆ°/home/admin/logs/arthas/arthas.logä¸­</td></tr><tr><td>job-timeout</td><td>id</td><td>å¼‚æ­¥åå°ä»»åŠ¡çš„é»˜è®¤è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œä»»åŠ¡è‡ªåŠ¨åœæ­¢ï¼›æ¯”å¦‚è®¾ç½® 1d, 2h, 3m, 25sï¼Œåˆ†åˆ«ä»£è¡¨å¤©ã€å°æ—¶ã€åˆ†ã€ç§’</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> Arthas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¨‹åºå‘˜å¸¸ç”¨è¯æ±‡</title>
      <link href="/coder-vocabulary.html"/>
      <url>/coder-vocabulary.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä¸‹é¢æ˜¯å·¥ä½œä¸­ï¼Œç»å¸¸ç”¨åˆ°çš„ä¸€äº›è¯æ±‡ï¼ŒæŒç»­æ›´æ–°</p></blockquote><a id="more"></a><p>1, abbreviation  [É™briËvÉªâ€™eÉªÊƒ(É™)n]<br>n. ç¼©å†™ï¼›ç¼©å†™è¯<br>2, abruptly<br>adv. çªç„¶åœ°ï¼›å”çªåœ°<br>3, absence  [â€˜Ã¦bsns]<br>n. æ²¡æœ‰ï¼›ç¼ºä¹ï¼›ç¼ºå¸­ï¼›ä¸æ³¨æ„<br>4, absent  [ËˆÃ¦bsnt;(for v.)É™bËˆsÉ›nt]<br>adj. ç¼ºå¸­çš„ï¼›ç¼ºå°‘çš„ï¼›å¿ƒä¸åœ¨ç„‰çš„ï¼›èŒ«ç„¶çš„<br>vt. ä½¿ç¼ºå¸­<br>5, absorber  [É™bâ€™sÉ”ËbÉ™]<br>n. å‡éœ‡å™¨ï¼›å¸æ”¶å™¨ï¼›å¸æ”¶ä½“<br>6, accessible  [É™kâ€™sesÉªb(É™)l]<br>adj. æ˜“æ¥è¿‘çš„ï¼›å¯è¿›å…¥çš„ï¼›å¯ç†è§£çš„<br>7, accidental  [Ã¦ksÉªâ€™dent(É™)l]<br>adj. æ„å¤–çš„ï¼›å¶ç„¶çš„ï¼›é™„å±çš„ï¼›ä¸´æ—¶è®°å·çš„;<br>n. æ¬¡è¦æ–¹é¢ï¼›éä¸»è¦çš„ç‰¹æ€§ï¼›ä¸´æ—¶è®°å·<br>8, accomplished  [É™â€™kÊŒmplÉªÊƒt; É™â€™kÉ’m-]<br>adj. å®Œæˆçš„ï¼›ç†Ÿç»ƒçš„ï¼Œæœ‰æŠ€å·§çš„ï¼›æœ‰ä¿®å…»çš„ï¼›æœ‰å­¦é—®çš„<br>9, accumulate  [É™â€™kjumjÉ™let]<br>vi. ç´¯ç§¯ï¼›ç§¯èš<br>vt. ç§¯æ”’<br>10, accumulation  [É™,kjÊŠmjÉ™â€™leÊƒÉ™n]<br>n. ç§¯èšï¼Œç´¯ç§¯ï¼›å †ç§¯ç‰©<br>11, accuracy  [â€˜Ã¦kjÊŠrÉ™sÉª]<br>n. [æ•°] ç²¾ç¡®åº¦ï¼Œå‡†ç¡®æ€§<br>12, actually  [â€˜Ã¦ktjÊŠÉ™lÉª; -tÊƒÊŠ-]<br>adv. å®é™…ä¸Šï¼›äº‹å®ä¸Š<br>13, Actually  [â€˜Ã¦ktjÊŠÉ™lÉª; -tÊƒÊŠ-]<br>adv. å®é™…ä¸Šï¼›äº‹å®ä¸Š<br>14, actuator  [â€˜Ã¦ktÊƒÊŠ,etÉš]<br>n. [è‡ª] æ‰§è¡Œæœºæ„ï¼›æ¿€åŠ±è€…ï¼›ä¿ƒåŠ¨å™¨<br>15, Adaptee<br>è¢«é€‚é…è€…<br>16, additionally  [É™â€™dÉªÊƒÉ™nÉ™lÉª]<br>adv. æ­¤å¤–ï¼›åˆï¼ŒåŠ ä¹‹<br>17, Additivity  [,Ã¦dÉªâ€™tÉªvÉ™tÉª]<br>n. æ·»åŠ ï¼›ç›¸åŠ æ€§<br>18, addon  [addon]<br>n. æ’ä»¶<br>19, adequate  [ËˆÃ¦dÉªkwÉ™t]<br>adj. å……è¶³çš„ï¼›é€‚å½“çš„ï¼›èƒœä»»çš„<br>20, adjacent  [É™â€™dÊ’esnt]<br>adj. é‚»è¿‘çš„ï¼Œæ¯—è¿çš„<br>21, adopt  [É™â€™dÉ’pt]<br>vt. é‡‡å–ï¼›æ¥å—ï¼›æ”¶å…»ï¼›æ­£å¼é€šè¿‡;<br>vi. é‡‡å–ï¼›è¿‡ç»§<br>22, Advice  [É™dâ€™vaÉªs]<br>n. å»ºè®®ï¼›å¿ å‘Šï¼›åŠå‘Šï¼›é€šçŸ¥<br>23, advisable  [É™dâ€™vaÉªzÉ™b(É™)l]<br>adj. æ˜æ™ºçš„ï¼Œå¯å–çš„ï¼Œé€‚å½“çš„<br>24, advisor  [É™dâ€™vaÉªzÉ™]<br>n. é¡¾é—®ï¼›æŒ‡å¯¼æ•™å¸ˆï¼›åŠå‘Šè€…<br>25, affinity  [É™â€™fÉªnÉ™ti]<br>n. å¯†åˆ‡å…³ç³»ï¼›å¸å¼•åŠ›ï¼›å§»äº²å…³ç³»ï¼›ç±»åŒ<br>26, affliction  [É™â€™flÉªkÊƒ(É™)n]<br>n. è‹¦éš¾ï¼›è‹¦æ¼ï¼›æŠ˜ç£¨<br>27, afford  [É™â€™fÉ”rd]<br>vt. ç»™äºˆï¼Œæä¾›ï¼›ä¹°å¾—èµ·<br>n. (Afford)äººåï¼›(è‹±)é˜¿ç¦å¾·<br>28, agenda  [É™â€™dÊ’É›ndÉ™]<br>n. è®®ç¨‹ï¼›æ—¥å¸¸å·¥ä½œäº‹é¡¹<br>29, aggregation  [,Ã¦grÉªâ€™geÊƒÉ™n]<br>n. [åœ°è´¨][æ•°] èšåˆï¼Œèšé›†ï¼›èšé›†ä½“ï¼Œé›†åˆä½“<br>30, agnostic  [Ã¦gâ€™nÉ’stÉªk]<br>n. ä¸å¯çŸ¥è®ºè€…;<br>adj. ä¸å¯çŸ¥è®ºçš„<br>31, aligned  [É™â€™laÉªn]<br>adj. å¯¹é½çš„ï¼›å‡è¡¡çš„<br>v. ç»“ç›Ÿï¼ˆalignçš„è¿‡å»å¼ï¼‰ï¼›ä½¿æˆä¸€ç›´çº¿<br>32, Alliance  [É™â€™laÉªÉ™ns]<br>n. è”ç›Ÿï¼Œè”åˆï¼›è”å§»<br>33, allocation  [,Ã¦lÉ™â€™keÊƒÉ™n]<br>n. åˆ†é…ï¼Œé…ç½®ï¼›å®‰ç½®<br>34, allowable  [É™â€™laÊŠÉ™bl]<br>adj. è®¸å¯çš„ï¼›æ­£å½“çš„ï¼›å¯æ‰¿è®¤çš„ï¼›å¯è·å®½å…<br>35, along with<br>æ²¿ï¼ˆé¡ºï¼‰ç€ï¼›è¿åŒâ€¦ä¸€èµ·ï¼›ä¸â€¦ä¸€é“ï¼›éšåŒâ€¦ä¸€èµ·<br>36, alternative  [É”Ëlâ€™tÉœËnÉ™tÉªv; É’l-]<br>adj. ä¾›é€‰æ‹©çš„ï¼›é€‰æ‹©æ€§çš„ï¼›äº¤æ›¿çš„;<br>n. äºŒä¸­æ‹©ä¸€ï¼›ä¾›æ›¿ä»£çš„é€‰æ‹©<br>37, ambassador  [Ã¦mâ€™bÃ¦sÉ™dÉš]<br>n. å¤§ä½¿ï¼›ä»£è¡¨ï¼›ä½¿èŠ‚<br>38, ameliorate  [É™â€™milÉªÉ™â€™ret]<br>vt. æ”¹å–„ï¼›å‡è½»ï¼ˆç—›è‹¦ç­‰ï¼‰ï¼›æ”¹è‰¯<br>vi. å˜å¾—æ›´å¥½<br>39, amend  [É™â€™mend]<br>vt. ä¿®æ”¹ï¼›æ”¹å–„ï¼Œæ”¹è¿›<br>vi. æ”¹æ­£ï¼Œæ”¹å–„ï¼›æ”¹è¿‡è‡ªæ–°<br>n. (Amend)äººåï¼›(å¾·ã€è‹±)é˜¿é—¨å¾·<br>40, amended<br>adj. ä¿®æ­£çš„<br>v. ä¿®è®¢ï¼›æ”¹è¿›ï¼ˆamendçš„è¿‡å»åˆ†è¯ï¼‰<br>41, amid  [ç¾/É™â€™mÉªd/]<br>prep. åœ¨å…¶ä¸­ï¼Œåœ¨å…¶é—´;<br>n. (Amid)äººåï¼›(æ³•ã€é˜¿æ‹‰ä¼¯)é˜¿ç±³å¾·;<br>42, among  [É™â€™mÊŒÅ‹]<br>prep. åœ¨â€¦ä¸­é—´ï¼›åœ¨â€¦ä¹‹ä¸­<br>43, analogous  [É™â€™nÃ¦lÉ™gÉ™s]<br>adj. ç±»ä¼¼çš„ï¼›[æ˜†] åŒåŠŸçš„ï¼›å¯æ¯”æ‹Ÿçš„<br>44, analysts  [â€˜Ã¦n(É™)lÉªsts]<br>n. åˆ†æå¸ˆï¼›åˆ†æå®¶ï¼›[åˆ†åŒ–] åˆ†æå‘˜ï¼ˆanalystçš„å¤æ•°ï¼‰<br>45, Analyzer  [â€˜Ã¦nÉ™laÉªzÉ™]<br>n. [è®¡] åˆ†æå™¨ï¼›åˆ†æè€…ï¼›æ£€åé•œ<br>46, anatomy  [É™â€™nÃ¦tÉ™mi]<br>n. è§£å‰–ï¼›è§£å‰–å­¦ï¼›å‰–æï¼›éª¨éª¼<br>47, ancestor  [â€˜Ã¦nsÉ›stÉš]<br>n. å§‹ç¥–ï¼Œç¥–å…ˆï¼›è¢«ç»§æ‰¿äºº<br>48, animate  [â€˜Ã¦nÉªmeÉªt]<br>vt. ä½¿æœ‰ç”Ÿæ°”ï¼›ä½¿æ´»æ³¼ï¼›é¼“èˆï¼›æ¨åŠ¨;<br>adj. æœ‰ç”Ÿå‘½çš„<br>49, animation  [,Ã¦nÉªâ€™meÊƒÉ™n]<br>n. æ´»æ³¼ï¼Œç”Ÿæ°”ï¼›æ¿€åŠ±ï¼›å¡é€šç‰‡ç»˜åˆ¶<br>50, Annotation  [Ã¦nÉ™â€™teÉªÊƒ(É™)n]<br>n. æ³¨é‡Šï¼›æ³¨è§£ï¼›é‡Šæ–‡<br>51, annotations  []<br>é‡Šæ–‡<br>52, announce  [É™â€™naÊŠns]<br>vt. å®£å¸ƒï¼›è¿°è¯´ï¼›é¢„ç¤ºï¼›æ’­æŠ¥<br>vi. å®£å¸ƒå‚åŠ ç«é€‰ï¼›å½“æ’­éŸ³å‘˜<br>53, anomalies<br>n. å¼‚å¸¸ç°è±¡ï¼Œåå¸¸ç°è±¡ï¼ˆanomaly å¤æ•°å½¢å¼ï¼‰<br>54, approach  [É™â€™protÊƒ]<br>n. æ–¹æ³•ï¼›é€”å¾„ï¼›æ¥è¿‘<br>vt. æ¥è¿‘ï¼›ç€æ‰‹å¤„ç†<br>vi. é è¿‘<br>55, appropriate  [É™â€™prÉ™ÊŠprÉªÉ™t]<br>adj. é€‚å½“çš„ï¼›æ°å½“çš„ï¼›åˆé€‚çš„;<br>vt. å ç”¨ï¼Œæ‹¨å‡º<br>56, approve  [É™â€™pruËv]<br>vt. æ‰¹å‡†ï¼›èµæˆï¼›ä¸ºâ€¦æä¾›è¯æ®;<br>vi. æ‰¹å‡†ï¼›èµæˆï¼›æ»¡æ„<br>57, approximately  [É™â€™prÉ’ksÉªmÉ™tlÉª]<br>adv. å¤§çº¦ï¼Œè¿‘ä¼¼åœ°ï¼›è¿‘äº<br>58, approximation  [É™,prÉ’ksÉªâ€™meÉªÊƒn]<br>n. [æ•°] è¿‘ä¼¼æ³•ï¼›æ¥è¿‘ï¼›[æ•°] è¿‘ä¼¼å€¼<br>59, approximations  [approximations]<br>[æ•°] è¿‘ä¼¼å€¼<br>60, apsara<br>n. (Apsara)äººåï¼›(æ³•)é˜¿æ™®è¨æ‹‰<br>61, arbitrarily  [,É‘rbÉ™â€™trÉ›rÉ™li]<br>adv. æ­¦æ–­åœ°ï¼›åå¤æ— å¸¸åœ°ï¼›ä¸“æ¨ªåœ°<br>62, arbitrary  [â€˜É‘ËbÉªt(rÉ™)rÉª]<br>adj. [æ•°] ä»»æ„çš„ï¼›æ­¦æ–­çš„ï¼›ä¸“åˆ¶çš„<br>63, arbitrate  [â€˜É‘ËbÉªtreÉªt]<br>vt. ä»²è£ï¼›å…¬æ–­<br>64, archetype  [â€˜É‘ËkÉªtaÉªp]<br>n. åŸå‹<br>65, architectural  [,É‘ËkÉªâ€™tektÊƒÉ™rÉ™l]<br>adj. å»ºç­‘å­¦çš„ï¼›å»ºç­‘ä¸Šçš„ï¼›ç¬¦åˆå»ºç­‘æ³•çš„<br>66, archive  [â€˜É‘rkaÉªv]<br>n. æ¡£æ¡ˆé¦†ï¼›æ¡£æ¡ˆæ–‡ä»¶;<br>vt. æŠŠâ€¦å­˜æ¡£<br>67, Archive  [â€˜É‘rkaÉªv]<br>n. æ¡£æ¡ˆé¦†ï¼›æ¡£æ¡ˆæ–‡ä»¶;<br>vt. æŠŠâ€¦å­˜æ¡£<br>68, arguably  [â€˜É‘rÉ¡juÉ™bli]<br>adv. å¯è®ºè¯åœ°ï¼›å¯äº‰è¾©åœ°ï¼›æ­£å¦‚å¯æå‡ºè¯æ®åŠ ä»¥è¯æ˜çš„é‚£æ ·åœ°<br>[å¹¿ä¹‰ç”¨æ³•]å¯èƒ½ï¼Œå¤§æ¦‚<br>69, ark  [É‘rk]<br>n. çº¦æŸœï¼›æ–¹èˆŸï¼›ï¼ˆç¾ï¼‰å¹³åº•èˆ¹ï¼›é¿éš¾æ‰€<br>n. (Ark)äººåï¼›(ä¿„ã€åœŸ)é˜¿å°”å…‹<br>70, artifact  [â€˜É‘:tÉ™ËŒfÃ¦kt]<br>n. äººå·¥åˆ¶å“ï¼›æ‰‹å·¥è‰ºå“<br>71, artifacts  [â€˜a:rtifÃ¦kts]<br>n. å²å‰å¤å™¨ç‰©ï¼›äººå·¥äº§å“<br>72, Artifacts  [â€˜a:rtifÃ¦kts]<br>n. å²å‰å¤å™¨ç‰©ï¼›äººå·¥äº§å“<br>73, Artificial  [É‘ËtÉªâ€™fÉªÊƒ(É™)l]<br>adj. äººé€ çš„ï¼›ä»¿é€ çš„ï¼›è™šä¼ªçš„ï¼›éåŸäº§åœ°çš„ï¼›æ­¦æ–­çš„<br>74, Aspect  [â€˜Ã¦spekt]<br>n. æ–¹é¢ï¼›æ–¹å‘ï¼›å½¢åŠ¿ï¼›å¤–è²Œ<br>75, assailed  [É™â€™seÉªl]<br>vt. æ”»å‡»ï¼›è´¨é—®ï¼›ç€æ‰‹è§£å†³<br>76, asset  [â€˜Ã¦set]<br>n. èµ„äº§ï¼›ä¼˜ç‚¹ï¼›æœ‰ç”¨çš„ä¸œè¥¿ï¼›æœ‰åˆ©æ¡ä»¶ï¼›è´¢äº§ï¼›æœ‰ä»·å€¼çš„äººæˆ–ç‰©</p><p>n. ï¼ˆæ³•ï¼‰é˜¿å¡ï¼ˆäººåï¼‰<br>77, Assets  []<br>n. èµ„äº§ï¼›[ç»] è´¢äº§ï¼›æœ‰åˆ©æ¡ä»¶ï¼ˆassetçš„å¤æ•°ï¼‰<br>78, asshole  [â€˜Ã¦shÉ™ÊŠl]<br>n. å±çœ¼å„¿ï¼Œè‚›é—¨ï¼›ä»¤äººè®¨åŒçš„äºº<br>adj. æ„šè ¢çš„ï¼›çªå›Šçš„ï¼›å¯æ¶çš„<br>79, assign  [É™â€™saÉªn]<br>vt. åˆ†é…ï¼›æŒ‡æ´¾ï¼›[è®¡][æ•°] èµ‹å€¼;<br>vi. å°†è´¢äº§è¿‡æˆ·ï¼ˆå°¤æŒ‡è¿‡æˆ·ç»™å€ºæƒäººï¼‰<br>80, assignee  [Ã¦sÉªâ€™niË; -saÉª-]<br>n. ä»£ç†äººï¼›å—æ‰˜äººï¼›åˆ†é…åˆ°ä»»åŠ¡çš„äºº<br>81, association  [É™sÉ™ÊŠsÉªâ€™eÉªÊƒ(É™)n; -ÊƒÉª-]<br>n. åä¼šï¼Œè”ç›Ÿï¼Œç¤¾å›¢ï¼›è”åˆï¼›è”æƒ³<br>82, assume  [É™â€™sjuËm]<br>vt. æ‰¿æ‹…ï¼›å‡å®šï¼›é‡‡å–ï¼›å‘ˆç°;<br>vi. è£…è…”ä½œåŠ¿ï¼›å¤šç®¡é—²äº‹<br>83, asterisk  [â€˜Ã¦stÉ™rÉªsk]<br>n. æ˜Ÿå·<br>vt. æ³¨ä¸Šæ˜Ÿå·ï¼›ç”¨æ˜Ÿå·æ ‡å‡º<br>84, async  [É™ËˆsÉªÅ‹k]<br>abbr. å¼‚æ­¥ï¼ŒéåŒæ­¥ï¼ˆasynchronousï¼‰<br>85, asynchronous  [É™â€™sÉªÅ‹krÉ™nÉ™s; eÉª-]<br>adj. [ç”µ] å¼‚æ­¥çš„ï¼›ä¸åŒæ—¶çš„ï¼›ä¸åŒæœŸçš„<br>86, Asynchronous  [É™â€™sÉªÅ‹krÉ™nÉ™s; eÉª-]<br>adj. [ç”µ] å¼‚æ­¥çš„ï¼›ä¸åŒæ—¶çš„ï¼›ä¸åŒæœŸçš„<br>87, atlassian  </p><p>88, atop  [É™â€™tÉ’p]<br>prep. åœ¨â€¦çš„é¡¶ä¸Š;<br>adv. åœ¨é¡¶ä¸Š<br>89, attach  [É™â€™tÃ¦tÊƒ]<br>vt. ä½¿ä¾é™„ï¼›è´´ä¸Šï¼›ç³»ä¸Šï¼›ä½¿ä¾æ‹;<br>vi. é™„åŠ ï¼›é™„å±ï¼›ä¼´éš<br>90, attendance  [É™â€™tend(É™)ns]<br>n. å‡ºå¸­ï¼›åˆ°åœºï¼›å‡ºå¸­äººæ•°ï¼›è€ƒå‹¤<br>91, attendees<br>n. å‚åŠ è€…ï¼›å‡ºå¸­è€…ï¼ˆattendeeçš„å¤æ•°ï¼‰<br>92, atypical  [eÉªâ€™tÉªpÉªk(É™)l; Ã¦-]<br>adj. éå…¸å‹çš„ï¼›ä¸åˆè§„åˆ™çš„<br>93, audit  [â€˜É”ËdÉªt]<br>vi. å®¡è®¡ï¼›[å®¡è®¡] æŸ¥è´¦;<br>n. å®¡è®¡ï¼›[å®¡è®¡] æŸ¥è´¦;<br>vt. ï¼ˆç¾ï¼‰æ—å¬<br>94, authentication  [É”Ë,Î¸entÉªâ€™keÉªÊƒÉ™n]<br>n. è¯æ˜ï¼›é‰´å®šï¼›è¯å®<br>95, Authentication  [É”Ë,Î¸entÉªâ€™keÉªÊƒÉ™n]<br>n. è¯æ˜ï¼›é‰´å®šï¼›è¯å®<br>96, authorization  [É”ËÎ¸É™raÉªâ€™zeÉªÊƒ(É™)n]<br>n. æˆæƒï¼Œè®¤å¯ï¼›æ‰¹å‡†ï¼Œå§”ä»»<br>97, Authorization  [É”ËÎ¸É™raÉªâ€™zeÉªÊƒ(É™)n]<br>n. æˆæƒï¼Œè®¤å¯ï¼›æ‰¹å‡†ï¼Œå§”ä»»<br>98, authorize  [â€˜É”Î¸É™raÉªz]<br>vt. æ‰¹å‡†ï¼Œè®¤å¯ï¼›æˆæƒç»™ï¼›å§”æ‰˜ä»£æ›¿<br>99, automata  [É”â€™tÉ‘mÉ™tÉ™]<br>n. è‡ªåŠ¨è£…ç½®ï¼›æœºå™¨äºº ï¼ˆautomatonçš„å¤æ•°ï¼‰<br>100, Automation  [É”ËtÉ™â€™meÉªÊƒ(É™)n]<br>n. è‡ªåŠ¨åŒ–ï¼›è‡ªåŠ¨æ“ä½œ<br>101, autowire<br>n. è‡ªåŠ¨è£…é…<br>102, auxiliary  [É”Ëgâ€™zÉªlÉªÉ™rÉª; É’g-]<br>n. åŠ©åŠ¨è¯ï¼›è¾…åŠ©è€…ï¼Œè¾…åŠ©ç‰©ï¼›é™„å±æœºæ„;<br>adj. è¾…åŠ©çš„ï¼›å‰¯çš„ï¼›é™„åŠ çš„<br>103, avail  [É™â€™veÉªl]<br>n. æ•ˆç”¨ï¼Œåˆ©ç›Š;<br>vt. æœ‰ç›Šäºï¼Œæœ‰ç›Šäºï¼›ä½¿å¯¹æŸäººæœ‰åˆ©ã€‚;<br>vi. æœ‰ç›Šäºï¼Œæœ‰ç›Šäºï¼›ä½¿å¯¹æŸäººæœ‰åˆ©ã€‚<br>104, await  [É™â€™weÉªt]<br>vt. ç­‰å€™ï¼Œç­‰å¾…ï¼›æœŸå¾…<br>105, Aware  [É™â€™weÉ™]<br>adj. æ„è¯†åˆ°çš„ï¼›çŸ¥é“çš„ï¼›æœ‰â€¦æ–¹é¢çŸ¥è¯†çš„ï¼›æ‡‚ä¸–æ•…çš„;<br>n. (Aware)äººåï¼›(é˜¿æ‹‰ä¼¯ã€ç´¢)é˜¿ç“¦é›·<br>106, awesome  [â€˜É”Ës(É™)m]<br>ã€ç½‘ç»œã€‘å¦äººç«Ÿä¸ºçš„ï¼›ç”Ÿç•ï¼›çœŸäº†ä¸èµ·ï¼›å‚²æ£®<br>107, Awesome  [â€˜É”Ës(É™)m]<br>adj. ä»¤äººæ•¬ç•çš„ï¼›ä½¿äººç•æƒ§çš„ï¼›å¯æ€•çš„ï¼›æå¥½çš„<br>108, axis  [â€˜Ã¦ksÉªs]<br>n. è½´ï¼›è½´çº¿ï¼›è½´å¿ƒå›½<br>109, backslash  [backslash]<br>n. åæ–œæ ï¼Œåæ–œçº¿ç¬¦å·<br>110, backwards  [â€˜bÃ¦kwÉšdz]<br>adv. å€’ï¼›å‘åï¼›é€†<br>111, Badge  [bÃ¦dÊ’]<br>n. å¾½ç« ï¼›è¯ç« ï¼›æ ‡è®°;<br>vt. æˆç»™â€¦å¾½ç« <br>112, banner  [â€˜bÃ¦nÉš]<br>n. æ¨ªå¹…å›¾ç‰‡çš„å¹¿å‘Šæ¨¡å¼<br>n. æ——å¸œï¼Œæ¨ªå¹…,æ ‡è¯­<br>n. äººå(è‹±ã€å¾·ã€ç½—)ç­çº³<br>113, barge  [bÉ‘rdÊ’]<br>vi. è¹’è·šï¼›é—¯å…¥<br>n. é©³èˆ¹ï¼›æ¸¸è‰‡<br>vt. ç”¨èˆ¹è¿è¾“ï¼›è›®ä¸è®²ç†åœ°é—¯å…¥æˆ–æ‰“æ‰°æŸäº‹ç‰©<br>n. (Barge)äººåï¼›(è‹±)å·´å¥‡ï¼›(å¾·)å·´æ ¼ï¼›(è¥¿)å·´å°”èµ«ï¼›(æ³•ã€è‘¡)å·´å°”çƒ­<br>114, Barter  [â€˜bÉ‘ËtÉ™]<br>vi. è¿›è¡Œæ˜“è´§è´¸æ˜“ï¼›[è´¸æ˜“] ä½œç‰©ç‰©äº¤æ¢ï¼›è®¨ä»·è¿˜ä»·;<br>vt. ä»¥â€¦ä½œä¸ºäº¤æ¢ï¼›æ‹¿â€¦è¿›è¡Œæ˜“è´§è´¸æ˜“;<br>n. æ˜“è´§è´¸æ˜“ï¼›ç‰©ç‰©äº¤æ¢ï¼›å®ç‰©äº¤æ˜“;<br>n. (Barter)äººåï¼›(è‹±)å·´ç‰¹<br>115, Bash  [bÃ¦Êƒ]<br>vt. çŒ›å‡»ï¼Œç—›å‡»ï¼›æ€’æ®´;<br>n. çŒ›çƒˆçš„ä¸€å‡»ï¼Œç—›å‡»;<br>n. (Bash)äººåï¼›(è‹±ã€ä¿„ã€å·´åŸº)å·´ä»€<br>116, be populated with<br>ç”¨â€¦å¡«å……<br>117, be responsible for  []<br>å¯¹â€¦â€¦è´Ÿè´£ï¼›æ˜¯â€¦â€¦çš„åŸå› <br>Be responsible for: è´Ÿè´£  å¯¹  æ‰¿æ‹…è´£ä»»<br>118, bear  [bÉ›r]<br>vt. ç»“æœå®ï¼Œå¼€èŠ±ï¼ˆæ­£å¼ï¼‰<br>vt. å¿å—ï¼›æ‰¿å—ï¼›å…·æœ‰ï¼›æ”¯æ’‘<br>n. ç†Š<br>n. (Bear)äººåï¼›(è‹±)è´å°”<br>119, bearer  [â€˜bÉ›rÉš]<br>n. æŒç¥¨äººï¼›[å»º] æ‰¿æœ¨ï¼›[æœº] æ‰˜æ¶ï¼›é€ä¿¡äººï¼›æ¬è¿å·¥äºº<br>120, beast  [biËst]<br>n. é‡å…½ï¼›ç•œç”Ÿï¼Œäººé¢å…½å¿ƒçš„äºº<br>121, behalf  [bÉªâ€™hÉ‘Ëf]<br>n. ä»£è¡¨ï¼›åˆ©ç›Š<br>122, benchmarks  [benchmarks]<br>n. [è®¡] åŸºå‡†ï¼›æ ‡ç«¿ï¼›æ°´å‡†ç‚¹ï¼›åŸºå‡†æµ‹è¯•ç¨‹åºæ•°å€¼ï¼ˆbenchmarkçš„å¤æ•°å½¢å¼ï¼‰<br>v. æµ‹å®šåŸºå‡†ç‚¹ï¼ˆbenchmarkçš„ä¸‰å•å½¢å¼ï¼‰<br>123, bend  [bend]<br>vt. ä½¿å¼¯æ›²ï¼›ä½¿å±ˆæœï¼›ä½¿è‡´åŠ›ï¼›ä½¿æœå‘;<br>vi. å¼¯æ›²ï¼Œè½¬å¼¯ï¼›å±ˆæœï¼›å€¾å‘ï¼›ä¸“å¿ƒäº;<br>n. å¼¯æ›²;<br>n. (Bend)äººåï¼›(ç‘å…¸)æœ¬å¾·<br>124, beware  [bÉªâ€™wÉ›r]<br>vi. å½“å¿ƒï¼Œå°å¿ƒ<br>vt. æ³¨æ„ï¼Œå½“å¿ƒï¼›æé˜²<br>125, bin  [bÉªn]<br>n. ç®±å­ï¼Œå®¹å™¨ï¼›äºŒè¿›åˆ¶;<br>vt. æŠŠâ€¦æ”¾å…¥ç®±ä¸­;<br>n. (Bin)äººåï¼›(æ„ã€æŸ¬)å®¾ï¼›(æ—¥)æ•(å)ï¼›(ä¸œå—äºšå›½å®¶åè¯­)æ°‘<br>126, Binary  [â€˜baÉªnÉ™rÉª]<br>adj. [æ•°] äºŒè¿›åˆ¶çš„ï¼›äºŒå…ƒçš„ï¼ŒäºŒæ€çš„<br>127, Binary Distributions<br>äºŒè¿›åˆ¶å‘è¡Œç‰ˆ<br>128, bio  [â€˜baÉªÉ™ÊŠ]<br>n. ä¸ªäººç®€å†ï¼Œå°ä¼ </p><p>n. (Bio)äººåï¼›(æ³•ã€æ„ã€è‘¡ã€åœŸã€åˆš(é‡‘)ã€å¡æ‹‰)æ¯”å¥¥<br>129, bitwise<br>n. æŒ‰ä½<br>130, biz  [bÉªz]<br>n. å•†ä¸šï¼ˆç­‰äºbusinessï¼‰<br>131, blazing  [â€˜bleÉªzÉªÅ‹]<br>adj. ç‡ƒçƒ§çš„ï¼›å¼ºçƒˆçš„ï¼›é—ªè€€çš„;<br>adv. éå¸¸;<br>v. ç‡ƒçƒ§ï¼›é—ªè€€ï¼›è¿¸å‘ï¼›å…¬å¼€ï¼ˆblazeçš„ingå½¢å¼ï¼‰<br>132, block  [blÉ’k]<br>n. å—ï¼›è¡—åŒºï¼›å¤§å¦ï¼›éšœç¢ç‰©;<br>vt. é˜»æ­¢ï¼›é˜»å¡ï¼›é™åˆ¶ï¼›å°ç›–;<br>adj. æˆæ‰¹çš„ï¼Œå¤§å—çš„ï¼›äº¤é€šå µå¡çš„;<br>n. (Block)äººåï¼›(è‹±ã€æ³•ã€å¾·ã€è¥¿ã€è‘¡ã€èŠ¬ã€ç½—)å¸ƒæ´›å…‹<br>133, Block  [blÉ’k]<br>n. å—ï¼›è¡—åŒºï¼›å¤§å¦ï¼›éšœç¢ç‰©;<br>vt. é˜»æ­¢ï¼›é˜»å¡ï¼›é™åˆ¶;<br>adj. æˆæ‰¹çš„ï¼Œå¤§å—çš„ï¼›äº¤é€šå µå¡çš„;<br>n. (Block)äººåï¼›(è‹±ã€æ³•ã€å¾·ã€è¥¿ã€è‘¡ã€èŠ¬ã€ç½—)å¸ƒæ´›å…‹<br>134, blueprint  [â€˜blÊŠâ€™prÉªnt]<br>vt. è®¡åˆ’ï¼›åˆ¶æˆè“å›¾<br>n. è“å›¾ï¼Œè®¾è®¡å›¾ï¼›è®¡åˆ’<br>135, blur  [blÉœË]<br>vt. æ¶‚æ±¡ï¼›ä½¿â€¦æ¨¡ç³Šä¸æ¸…ï¼›ä½¿æš—æ·¡ï¼›ç·æ±¡;<br>vi. æ²¾ä¸Šæ±¡è¿¹ï¼›å˜æ¨¡ç³Š;<br>n. æ±¡è¿¹ï¼›æ¨¡ç³Šä¸æ¸…çš„äº‹ç‰©<br>136, board  [bÉ”rd]<br>n. è‘£äº‹ä¼šï¼›æœ¨æ¿ï¼›ç”²æ¿ï¼›è†³é£Ÿ<br>vt. ä¸Šï¼ˆé£æœºã€è½¦ã€èˆ¹ç­‰ï¼‰ï¼›ç”¨æ¿ç›–ä¸Šï¼›ç»™æä¾›è†³å®¿<br>vi. å¯„å®¿<br>n. (Board)äººåï¼›(è‹±ã€è¥¿)åšå¾·<br>137, boilerplate  [â€˜bÉ”ÉªlÉšplet]<br>n. æ ·æ¿æ–‡ä»¶ï¼›å¼•ç”¨<br>138, boils<br>n. ç”Ÿç––ï¼Œç–®ï¼ˆboilå¤æ•°ï¼‰<br>139, bold  [bold]<br>adj. å¤§èƒ†çš„ï¼Œè‹±å‹‡çš„ï¼›é»‘ä½“çš„ï¼›åšé¢œæ— è€»çš„ï¼›é™©å³»çš„<br>n. (Bold)äººåï¼›(è‹±ã€å¾·ã€ç½—ã€æ·ã€ç‘å…¸)åšå°”å¾·<br>140, bolt  [bÉ™ÊŠlt]<br>n. èºæ “ï¼Œèºé’‰ï¼›é—ªç”µï¼Œé›·ç”µï¼›é—¨é—©ï¼›å¼©ç®­;ï¼ˆå¸ƒçš„ï¼‰ä¸€åŒ¹ï¼Œä¸€å·<br>vt. ç­›é€‰ï¼›å›«å›µåä¸‹ï¼›ï¼ˆæŠŠé—¨ã€çª—ç­‰ï¼‰é—©ä¸Šï¼›çªç„¶è¯´å‡ºï¼Œè„±å£è¯´å‡º<br>vi. ï¼ˆé—¨çª—ç­‰ï¼‰é—©ä¸Šï¼Œæ‹´ä½ï¼›å†²å‡ºï¼Œè·³å‡ºï¼›ï¼ˆé©¬ç­‰çš„ï¼‰è„±ç¼°ï¼›å›«å›µåä¸‹<br>adv. çªç„¶åœ°ï¼›åƒç®­ä¼¼åœ°ï¼›ç›´ç«‹åœ°<br>141, boost  [buËst]<br>vt. ä¿ƒè¿›ï¼›å¢åŠ ï¼›æ”¯æ´;<br>vi. å®£æ‰¬ï¼›å·çªƒ;<br>n. æ¨åŠ¨ï¼›å¸®åŠ©ï¼›å®£æ‰¬;<br>n. (Boost)äººåï¼›(è‹±)å¸ƒæ–¯ç‰¹ï¼›(å¾·)åšæ–¯ç‰¹<br>142, boot  [buËt]<br>vt. å¼•å¯¼ï¼›è¸¢ï¼›è§£é›‡ï¼›ä½¿ç©¿é´;<br>n. é´å­ï¼›è¸¢ï¼›æ±½è½¦è¡Œæç®±;<br>n. (Boot)äººåï¼›(è‹±)å¸ƒç‰¹ï¼›(å¾·)åšç‰¹<br>143, bootstrap  [â€˜buËtstrÃ¦p]<br>n. [è®¡] å¼•å¯¼ç¨‹åºï¼Œè¾…åŠ©ç¨‹åºï¼›è§£é´å¸¦<br>144, Bootstrap  [â€˜buËtstrÃ¦p]<br>n. [è®¡] å¼•å¯¼ç¨‹åºï¼Œè¾…åŠ©ç¨‹åºï¼›è§£é´å¸¦<br>145, BootStrap  [â€˜buËtstrÃ¦p]<br>n. [è®¡] å¼•å¯¼ç¨‹åºï¼Œè¾…åŠ©ç¨‹åºï¼›è§£é´å¸¦<br>146, bootup<br>n. å¯åŠ¨<br>147, borrow  [â€˜bÉ’rÉ™ÊŠ]<br>vi. å€Ÿï¼›å€Ÿç”¨ï¼›ä»å…¶ä»–è¯­è¨€ä¸­å¼•å…¥</p><p>vt. å€Ÿï¼›å€Ÿç”¨</p><p>n. (Borrow)äººåï¼›(è‹±)åšç½—<br>148, bottleneck  [â€˜bÉ‘tlnÉ›k]<br>n. ç“¶é¢ˆï¼›éšœç¢ç‰©<br>149, bound  [baÊŠnd]<br>adj. æœ‰ä¹‰åŠ¡çš„ï¼›å—çº¦æŸçš„ï¼›è£…æœ‰å°é¢çš„;<br>vt. æŸç¼šï¼›ä½¿è·³è·ƒ;<br>n. èŒƒå›´ï¼›è·³è·ƒ;<br>vi. é™åˆ¶ï¼›å¼¹èµ·<br>150, bourne  [buÉ™n]<br>n. å°æºªï¼›ç›®çš„åœ°ï¼›è¾¹ç•Œ<br>n. (Bourne)äººåï¼›(è‹±)ä¼¯æ©ï¼›(è¥¿)åšå°”å†…<br>151, Bourne  [buÉ™n]<br>n. å°æºªï¼›ç›®çš„åœ°ï¼›è¾¹ç•Œ;<br>n. (Bourne)äººåï¼›(è‹±)ä¼¯æ©ï¼›(è¥¿)åšå°”å†…<br>152, breakthrough  [â€˜breÉªkÎ¸ruË]<br>n. çªç ´ï¼›çªç ´æ€§è¿›å±•<br>153, brevity  [â€˜brÉ›vÉ™ti]<br>n. ç®€æ´ï¼Œç®€çŸ­ï¼›çŸ­æš‚ï¼ŒçŸ­ä¿ƒ<br>154, brew  [brÊŠ]<br>vt. é…¿é€ ï¼›é…é…¿<br>vi. é…¿é…’ï¼›è¢«å†²æ³¡ï¼›å³å°†å‘ç”Ÿ<br>n. å•¤é…’ï¼›è´¨åœ°<br>n. (Brew)äººåï¼›(è‹±)å¸ƒé²<br>155, brief  [brif]<br>adj. ç®€çŸ­çš„ï¼Œç®€æ´çš„ï¼›çŸ­æš‚çš„ï¼Œè‰ç‡çš„<br>n. æ‘˜è¦ï¼Œç®€æŠ¥ï¼›æ¦‚è¦ï¼Œè¯‰ä¹¦<br>vt. ç®€æŠ¥ï¼Œæ‘˜è¦ï¼›ä½œâ€¦çš„æè¦<br>n. (Brief)äººåï¼›(è‹±)å¸ƒé‡Œå¤«<br>156, brilliant  [â€˜brÉªlj(É™)nt]<br>adj. ç¿çƒ‚çš„ï¼Œé—ªè€€çš„ï¼›æ°å‡ºçš„ï¼›æœ‰æ‰æ°”çš„ï¼›ç²¾å½©çš„ï¼Œç»å¦™çš„<br>157, brittle  [â€˜brÉªt(É™)l]<br>adj. æ˜“ç¢çš„ï¼Œè„†å¼±çš„ï¼›æ˜“ç”Ÿæ°”çš„<br>158, broker  [â€˜brokÉš]<br>n. ç»çºªäººï¼Œæ®å®¢<br>vi. ä½œä¸ºæƒåŠ›ç»çºªäººè¿›è¡Œè°ˆåˆ¤<br>vt. ä»¥ä¸­é—´äººç­‰èº«åˆ†å®‰æ’â€¦<br>n. (Broker)äººåï¼›(è‹±)å¸ƒç½—å…‹ï¼›(ä¿„)å¸ƒç½—å…‹å°”<br>159, bucket  [â€˜bÊŒkÉªt]<br>n. æ¡¶ï¼Œæ°´æ¡¶ï¼›é“²æ–—ï¼›ä¸€æ¡¶çš„é‡<br>v. å€¾ç›†è€Œä¸‹ï¼›é¢ ç°¸ç€è¡Œè¿›<br>n. (Bucket)äººåï¼›(å¾·)å¸ƒå…‹ç‰¹<br>160, buddy  [â€˜bÊŒdÉª]<br>n. ä¼™ä¼´ï¼Œå¥½æœ‹å‹ï¼›å¯†å‹ï¼›å°ç”·å­©;<br>vi. åšå¥½æœ‹å‹ï¼Œäº¤æœ‹å‹;<br>n. (Buddy)äººåï¼›(è‹±)å·´è¿ª<br>161, budget  [â€˜bÊŒdÊ’Éªt]<br>n. é¢„ç®—ï¼Œé¢„ç®—è´¹<br>vt. å®‰æ’ï¼Œé¢„å®šï¼›æŠŠâ€¦ç¼–å…¥é¢„ç®—<br>vi. ç¼–é¢„ç®—ï¼Œåšé¢„ç®—<br>adj. å»‰ä»·çš„<br>162, bulk  [bÊŒlk]<br>n. ä½“ç§¯ï¼Œå®¹é‡ï¼›å¤§å¤šæ•°ï¼Œå¤§éƒ¨åˆ†ï¼›å¤§å—<br>vt. ä½¿æ‰©å¤§ï¼Œä½¿å½¢æˆå¤§é‡ï¼›ä½¿æ˜¾å¾—é‡è¦<br>n. (Bulk)äººåï¼›(åœŸ)å¸ƒå°”å…‹<br>163, bunch  [bÊŒn(t)Êƒ]<br>n. ç¾¤ï¼›ä¸²ï¼›çªå‡ºç‰©</p><p>vi. éš†èµ·ï¼›æ‰“è¤¶ï¼›å½¢æˆä¸€ä¸²</p><p>vt. ä½¿æˆä¸€ä¸²ï¼›ä½¿æ‰“è¤¶</p><p>n. (Bunch)äººåï¼›(è‹±)é‚¦å¥‡<br>164, bundle  [â€˜bÊŒnd(É™)l]<br>n. æŸï¼›æ†;<br>vt. æ†;<br>vi. åŒ†å¿™ç¦»å¼€<br>165, Bundle  [â€˜bÊŒnd(É™)l]<br>n. æŸï¼›æ†;<br>vt. æ†;<br>vi. åŒ†å¿™ç¦»å¼€<br>166, burst  [bÉœËst]<br>vi. çˆ†å‘ï¼Œçªå‘ï¼›çˆ†ç‚¸</p><p>vt. çˆ†å‘ï¼Œçªå‘ï¼›çˆ†ç‚¸</p><p>n. çˆ†å‘ï¼Œçªå‘ï¼›çˆ†ç‚¸</p><p>n. (Burst)äººåï¼›(å¾·ã€ç½—)å¸ƒå°”æ–¯ç‰¹<br>167, byzantine  [baÉªËˆzntaÉªn;ËˆbÉªzÉ™ntaÉªn]<br>adj. æ‹œå åº­å¼çš„ï¼›ä¸œç½—é©¬å¸å›½çš„<br>n. æ‹œå åº­äººï¼Œæ‹œå åº­æ´¾çš„å»ºç­‘å¸ˆ<br>168, Callable  [â€˜kÉ”ËlÉ™b(É™)l]<br>adj. éšæ—¶å¯å¿è¿˜çš„ï¼›è¯·æ±‚å³ä»˜çš„<br>169, Campaign  [kÃ¦mâ€™peÉªn]<br>vi. ä½œæˆ˜ï¼›å‚åŠ ç«é€‰ï¼›å‚åŠ æ´»åŠ¨<br>n. è¿åŠ¨ï¼›æ´»åŠ¨ï¼›æˆ˜å½¹<br>170, canary  [kÉ™â€™nÉ›ri]<br>n. [é¸Ÿ] é‡‘ä¸é›€ï¼›æ·¡é»„è‰²<br>n. (Canary)äººåï¼›(è‹±)å¡çº³é‡Œ<br>171, candidate  [â€˜kÃ¦ndÉªdeÉªt; -dÉ™t]<br>n. å€™é€‰äººï¼Œå€™è¡¥è€…ï¼›åº”è¯•è€…<br>172, canonical  [kÉ™â€™nÉ’nÉªk(É™)l]<br>adj. ä¾æ•™è§„çš„ï¼›æƒå¨çš„ï¼›ç‰§å¸ˆçš„<br>n. ç‰§å¸ˆç¤¼æœ<br>173, Canonical  [kÉ™â€™nÉ’nÉªk(É™)l]<br>adj. ä¾æ•™è§„çš„ï¼›æƒå¨çš„ï¼›ç‰§å¸ˆçš„;<br>n. ç‰§å¸ˆç¤¼æœ<br>174, Canvas  [â€˜kÃ¦nvÉ™s]<br>n. å¸†å¸ƒ;<br>vt. ç”¨å¸†å¸ƒè¦†ç›–ï¼Œç”¨å¸†å¸ƒè£…å¤‡;<br>adj. å¸†å¸ƒåˆ¶çš„<br>175, Capable  [â€˜keÉªpÉ™b(É™)l]<br>adj. èƒ½å¹²çš„ï¼Œèƒ½èƒœä»»çš„ï¼›æœ‰æ‰åçš„<br>176, capitalized  [capitalized]<br>å¤§å†™çš„<br>177, capped  [capped]<br>v. ç»™â€¦æˆ´å¸½ï¼›å»è’‚ï¼›è¦†ä»¥â€¦ï¼›é™¤å»ç›–å­ï¼›èƒœè¿‡ï¼ˆcapçš„è¿‡å»åˆ†è¯å½¢å¼ï¼‰<br>adj. åŒ…è¿‡çš„ï¼›åŠ ç›–çš„ï¼›å»è’‚çš„<br>178, cardinality  [kÉ‘ËdÉªâ€™nÃ¦lÉªtÉª]<br>n. åŸºæ•°ï¼›é›†çš„åŠ¿<br>179, caret  [â€˜kÃ¦rÉ™t]<br>n. è„±å­—ç¬¦å·ï¼›æ’å…¥ç¬¦å·;<br>n. (Caret)äººåï¼›(æ³•)å¡é›·ï¼›(è‹±)å¡é›·ç‰¹<br>180, Caret  [â€˜kÃ¦rÉ™t]<br>n. è„±å­—ç¬¦å·ï¼›æ’å…¥ç¬¦å·;<br>n. (Caret)äººåï¼›(æ³•)å¡é›·ï¼›(è‹±)å¡é›·ç‰¹<br>181, carrot  [â€˜kÃ¦rÉ™t]<br>n. èƒ¡èåœ;<br>è¯±é¥µ<br>182, cascading  [kÃ¦â€™skeÉªdÉªÅ‹]<br>n. [ç”µ] çº§è”ï¼›ä¸²æ¥ï¼›é˜¶å¼æ¸—é€</p><p>v. ç€‘å¸ƒèˆ¬è½ä¸‹ï¼›ä¸²è”ï¼›ä¼ é€’ä¿¡æ¯ï¼ˆcascadeçš„ingå½¢å¼ï¼‰<br>183, catalina  [,kÃ¦tÉ™â€™li:nÉ™]<br>n. è¿œç¨‹è½°ç‚¸æœº;<br>n. (Catalina)äººåï¼›(æ³•ã€è¥¿)å¡å¡”åˆ©å¨œï¼›(è‹±)å¡å¡”è‰å¨œ<br>184, cave  [keÉªv]<br>vt. ä½¿å‡¹é™·ï¼Œä½¿å¡Œè½ï¼›åœ¨â€¦æŒ–æ´ç©´<br>vi. å‡¹é™·ï¼Œå¡Œè½ï¼›æŠ•é™<br>n. æ´ç©´ï¼Œçª‘æ´<br>n. (Cave)äººåï¼›(è¥¿)å¡éŸ¦ï¼›(è‹±)å‡¯å¤«ï¼›(æ³•)å¡å¤«<br>185, caveat  [â€˜kÃ¦vÉªÃ¦t; â€˜ke-]<br>n. è­¦å‘Šï¼›ä¸­æ­¢è¯‰è®¼æ‰‹ç»­çš„ç”³è¯·ï¼›è´§ç‰©å‡ºé—¨æ¦‚ä¸é€€æ¢ï¼›åœæ­¢æ”¯ä»˜çš„å¹¿å‘Š<br>186, caveats<br>n. è­¦å‘Šï¼›è¯´æ˜ï¼ˆcaveatçš„å¤æ•°ï¼‰<br>187, cellular  [â€˜sÉ›ljÉ™lÉš]<br>adj. ç»†èƒçš„ï¼›å¤šå­”çš„ï¼›ç”±ç»†èƒç»„æˆçš„<br>n. ç§»åŠ¨ç”µè¯ï¼›å•å…ƒ<br>188, Celsius  [â€˜sÉ›lsÉªÉ™s]<br>adj. æ‘„æ°çš„<br>n. æ‘„æ°åº¦<br>189, characteristic  [kÃ¦rÉ™ktÉ™â€™rÉªstÉªk]<br>adj. å…¸å‹çš„ï¼›ç‰¹æœ‰çš„ï¼›è¡¨ç¤ºç‰¹æ€§çš„<br>n. ç‰¹å¾ï¼›ç‰¹æ€§ï¼›ç‰¹è‰²<br>190, Characteristics  [,kÃ¦rÉ™ktÉ™â€™rÉªstÉªks]<br>n. ç‰¹æ€§ï¼Œç‰¹å¾ï¼›ç‰¹è‰²ï¼ˆcharacteristicçš„å¤æ•°ï¼‰ï¼›ç‰¹è´¨<br>191, charcuterie  [ÊƒÉ‘Ëâ€™kuËt(É™)rÉª]<br>n. ç†Ÿé£Ÿåº—ï¼›çŒªè‚‰åº—;<br>n. (Charcuterie)äººåï¼›(æ³•)æ²™å°”å±ˆç‰¹é‡Œ<br>192, chase  [tÊƒeÉªs]<br>vt. è¿½é€ï¼›è¿½æ•ï¼›è¯•å›¾èµ¢å¾—ï¼›é›•é•‚;<br>vi. è¿½é€ï¼›è¿½èµ¶ï¼›å¥”è·‘;<br>n. è¿½é€ï¼›è¿½èµ¶ï¼›è¿½å‡»;<br>n. (Chase)äººåï¼›(è‹±)è”¡æ–¯ï¼›(æ³•)æ²™æ–¯<br>193, chaser  [â€˜tÊƒeÉªsÉ™]<br>n. é©±é€èˆ°ï¼›çŒäººï¼›é¥®çƒˆé…’åå–çš„é¥®æ–™ï¼›[æœº] èºçº¹æ¢³åˆ€<br>194, chefs  [Êƒefs]<br>n.å¤§å¨ï¼›ä¸»å¨ï¼ˆchefçš„å¤æ•°ï¼‰<br>195, Choreographies Processes<br>ç»„åˆæµç¨‹<br>196, choreography  [,kÉ’rÉªâ€™É’grÉ™fÉª]<br>n. ç¼–èˆï¼›èˆè¹ˆè‰ºæœ¯ï¼›èˆè‰º<br>197, chronicle  [â€˜krÉ’nÉªk(É™)l]<br>n.ç¼–å¹´å²ï¼Œå¹´ä»£è®°ï¼›è®°å½•<br>vt.è®°å½•ï¼›æŠŠâ€¦è½½å…¥ç¼–å¹´å²<br>198, chronology  [krÉ™â€™nÉ’lÉ™dÊ’Éª]<br>n. å¹´è¡¨ï¼›å¹´ä»£å­¦<br>Chronology: å¹´ä»£å­¦  å¹´ä»£å­¦  å¹´è¡¨<br>199, chubby  [â€˜tÊƒÊŒbi]<br>adj. åœ†èƒ–çš„ï¼Œä¸°æ»¡çš„<br>200, chunk  [tÊƒÊŒÅ‹k]<br>n.å¤§å—ï¼›çŸ®èƒ–çš„äººæˆ–ç‰©<br>201, churn  [tÊƒÉœËn]<br>vi.æ…æ‹Œï¼›æ…åŠ¨<br>vt.æ…æ‹Œï¼›æ…åŠ¨<br>n.æ…ä¹³å™¨<br>202, cipher  [â€˜saÉªfÉ™]<br>n. å¯†ç ï¼›æš—å·ï¼›é›¶</p><p>vi. ä½¿ç”¨å¯†ç ï¼›è®¡ç®—ï¼›åšç®—æœ¯</p><p>vt. è®¡ç®—ï¼›åšç®—æœ¯ï¼›å°†â€¦è¯‘æˆå¯†ç <br>203, circuit  [â€˜sÉkÉªt]<br>n. [ç”µå­] ç”µè·¯ï¼Œå›è·¯ï¼›å·¡å›ï¼›ä¸€åœˆï¼›ç¯é“ vi. ç¯è¡Œ vt. ç»•å›â€¦ç¯è¡Œ<br>204, circumstance  [ËˆsÉâ€‹kÉ™mËŒstÉ™ns]<br>n. ç¯å¢ƒï¼Œæƒ…å†µï¼›äº‹ä»¶ï¼›å¢ƒé‡<br>205, citrus  [â€˜sÉªtrÉ™s]<br>n. [å›­è‰º] æŸ‘æ©˜å±æœæ ‘ï¼›æŸ‘æ©˜ç±»çš„æ¤ç‰©;<br>adj. æŸ‘æ©˜å±æ¤ç‰©çš„<br>206, claim  [kleÉªm]<br>vi. æå‡ºè¦æ±‚;<br>vt. è¦æ±‚ï¼›å£°ç§°ï¼›éœ€è¦ï¼›è®¤é¢†;<br>n. è¦æ±‚ï¼›å£°ç§°ï¼›ç´¢èµ”ï¼›æ–­è¨€ï¼›å€¼å¾—<br>207, clamp  [klÃ¦mp]<br>vt. å¤¹ç´§ï¼Œå›ºå®šä½<br>n. å¤¹é’³ï¼Œèºä¸é’³<br>208, clarity  [â€˜klÃ¦rÉªtÉª]<br>n. æ¸…æ¥šï¼Œæ˜æ™°ï¼›é€æ˜;<br>n. (Clarity)äººåï¼›(è‹±)å…‹æ‹‰é‡Œè’‚<br>209, Clip  [klÉªp]<br>vt. ä¿®å‰ªï¼›å¤¹ç‰¢ï¼›ç—›æ‰“;<br>vi. ä¿®å‰ª;<br>n. ä¿®å‰ªï¼›å¤¹å­ï¼›å›å½¢é’ˆ<br>210, clove  [klÉ™ÊŠv]<br>n. [æ¤][ä¸­åŒ»] ä¸é¦™<br>v. åŠˆå¼€ï¼ˆcleaveçš„è¿‡å»å¼ï¼‰<br>211, clue  [klÊŠ]<br>n. çº¿ç´¢ï¼›ï¼ˆæ•…äº‹ç­‰çš„ï¼‰æƒ…èŠ‚<br>vt. ä¸ºâ€¦æä¾›çº¿ç´¢ï¼›ä¸ºâ€¦æä¾›æƒ…å†µ<br>212, cluster  [â€˜klÊŒstÉ™]<br>n. ç¾¤ï¼›ç°‡ï¼›ä¸›ï¼›ä¸²<br>vi. ç¾¤èšï¼›ä¸›ç”Ÿ<br>vt. ä½¿èšé›†ï¼›èšé›†åœ¨æŸäººçš„å‘¨å›´<br>n. (Cluster)äººåï¼›(è‹±)å…‹æ‹‰æ–¯ç‰¹<br>213, co-branding  [kÉ™uâ€™brÃ¦ndiÅ‹]<br>n. è”åˆå“ç‰Œï¼›åˆä½œå“ç‰Œ<br>214, coalesced<br>åˆå¹¶ï¼ˆcoalesceçš„è¿‡å»å¼å’Œè¿‡å»åˆ†è¯ï¼‰<br>215, coarse  [kÉ”rs]<br>adj. ç²—ç³™çš„ï¼›ç²—ä¿—çš„ï¼›ä¸‹ç­‰çš„<br>216, coerce  [kÉ™ÊŠâ€™ÉœËs]<br>vt. å¼ºåˆ¶ï¼Œè¿«ä½¿<br>217, coexist  [,kÉ™ÊŠÉªgâ€™zÉªst]<br>vi. å…±å­˜ï¼›å’Œå¹³å…±å¤„<br>218, cognitive  [â€˜kÉ’É¡nÉªtÉªv]<br>adj. è®¤çŸ¥çš„ï¼Œè®¤è¯†çš„<br>219, coherency  [coherency]<br>n. é™„ç€ï¼›å‡èšï¼›è”æ¥ï¼›ç›¸å‚æ€§<br>220, coherent  [kÉ™(ÊŠ)â€™hÉªÉ™r(É™)nt]<br>adj. è¿è´¯çš„ï¼Œä¸€è‡´çš„ï¼›æ˜äº†çš„ï¼›æ¸…æ™°çš„ï¼›å‡èšæ€§çš„ï¼›äº’ç›¸è€¦åˆçš„ï¼›ç²˜åœ¨ä¸€èµ·çš„<br>221, cohesive  [kÉ™ÊŠâ€™hiËsÉªv]<br>adj. æœ‰ç»“åˆåŠ›çš„ï¼›ç´§å¯†ç»“åˆçš„ï¼›æœ‰ç²˜ç€åŠ›çš„<br>222, collaboration  [kÉ™lÃ¦bÉ™â€™reÉªÊƒn]<br>n. åˆä½œï¼›å‹¾ç»“ï¼›é€šæ•Œ<br>223, collapsar  [kÉ™â€™lÃ¦psÉ‘Ë]<br>n. é»‘æ´ï¼ˆç­‰äºblack holeï¼‰<br>224, collapse  [kÉ™â€™lÃ¦ps]<br>vi.å€’å¡Œï¼›ç“¦è§£ï¼›æš´è·Œ<br>vt.ä½¿å€’å¡Œï¼Œä½¿å´©æºƒï¼›ä½¿èé™·ï¼›æŠ˜å <br>n.å€’å¡Œï¼›å¤±è´¥ï¼›è¡°ç«­<br>225, collide  [kÉ™â€™laÉªd]<br>vi. ç¢°æ’ï¼›æŠµè§¦ï¼Œå†²çª;<br>vt. ä½¿ç¢°æ’ï¼›ä½¿ç›¸æ’<br>226, collision  [kÉ™â€™lÉªÊ’(É™)n]<br>n. ç¢°æ’ï¼›å†²çªï¼›ï¼ˆæ„è§ï¼Œçœ‹æ³•ï¼‰çš„æŠµè§¦ï¼›ï¼ˆæ”¿å…šç­‰çš„ï¼‰å€¾è½§<br>227, collisions  [collisions]<br>n. [ç‰©] ç¢°æ’ï¼›å†²çªï¼›æ’å‡»ï¼ˆcollisionçš„å¤æ•°å½¢å¼ï¼‰<br>228, colloquially  [kÉ™â€™lÉ™ukwiÉ™li]<br>adv. å£è¯­åœ°ï¼›ç”¨é€šä¿—è¯­<br>229, colly<br>vt. ï¼ˆè‹±ï¼‰æŠŠâ€¦å¼„é»‘<br>n. é”…ç°ï¼›ç…¤ç°<br>n. (Colly)äººåï¼›(è‹±ã€æ³•)ç§‘åˆ©<br>230, colon  [â€˜kolÉ™n]<br>n. [è§£å‰–] ç»“è‚ ï¼›å†’å·ï¼ˆç”¨äºå¼•è¯­ã€è¯´æ˜ã€ä¾‹è¯ç­‰ä¹‹å‰ï¼‰ï¼›ç§‘éƒï¼ˆå“¥æ–¯è¾¾é»åŠ è´§å¸å•ä½ï¼‰<br>231, comma  [â€˜kÉ‘mÉ™]<br>n. é€—å·ï¼›åœé¡¿<br>232, Commerce  [â€˜kÉ’mÉœËs]<br>n. è´¸æ˜“ï¼Œå•†ä¸š<br>233, commercial  [kÉ™â€™mÉœËÊƒ(É™)l]<br>adj. å•†ä¸šçš„ï¼›è¥åˆ©çš„ï¼›é å¹¿å‘Šæ”¶å…¥çš„;<br>n. å•†ä¸šå¹¿å‘Š<br>234, communicating  [kÉ™â€™mjÊŠnÉ™,ketÉªÅ‹]<br>adj. äº¤æµçš„ï¼›é€šä¿¡çš„<br>v. äº¤æµï¼›ä¼ æ’­ï¼ˆcommunicateçš„ç°åœ¨åˆ†è¯ï¼‰ï¼›ä¼ é€’<br>235, comparison  [kÉ™mâ€™pÃ¦rÉªs(É™)n]<br>n. æ¯”è¾ƒï¼›å¯¹ç…§ï¼›æ¯”å–»ï¼›æ¯”è¾ƒå…³ç³»<br>236, compatible  [kÉ™mâ€™pÃ¦tÉªb(É™)l]<br>adj. å…¼å®¹çš„ï¼›èƒ½å…±å¤„çš„ï¼›å¯å¹¶ç«‹çš„<br>237, compensate  [â€˜kÉ’mpenseÉªt]<br>vi. è¡¥å¿ï¼Œèµ”å¿ï¼›æŠµæ¶ˆ;<br>vt. è¡¥å¿ï¼Œèµ”å¿ï¼›ä»˜æŠ¥é…¬<br>238, Compensation  [kÉ’mpenâ€™seÉªÊƒ(É™)n]<br>n. è¡¥å¿ï¼›æŠ¥é…¬ï¼›èµ”å¿é‡‘<br>239, comply  [kÉ™mâ€™plaÉª]<br>vi. éµå®ˆï¼›é¡ºä»ï¼Œéµä»ï¼›ç­”åº”<br>240, compound  [â€˜kÉ’mpaÊŠnd]<br>n. [åŒ–å­¦] åŒ–åˆç‰©ï¼›æ··åˆç‰©ï¼›å¤åˆè¯</p><p>adj. å¤åˆçš„ï¼›æ··åˆçš„</p><p>v. åˆæˆï¼›æ··åˆï¼›æ¶åŒ–ï¼ŒåŠ é‡ï¼›å’Œè§£ï¼Œå¦¥å<br>241, comprehensive  [kÉ’mprÉªâ€™hensÉªv]<br>adj. ç»¼åˆçš„ï¼›å¹¿æ³›çš„ï¼›æœ‰ç†è§£åŠ›çš„;<br>n. ç»¼åˆå­¦æ ¡ï¼›ä¸“ä¸šç»¼åˆæµ‹éªŒ<br>242, Comprehensive  [kÉ’mprÉªâ€™hensÉªv]<br>adj. ç»¼åˆçš„ï¼›å¹¿æ³›çš„ï¼›æœ‰ç†è§£åŠ›çš„;<br>n. ç»¼åˆå­¦æ ¡ï¼›ä¸“ä¸šç»¼åˆæµ‹éªŒ<br>243, compulsive  [kÉ™mâ€™pÊŒlsÉªv]<br>adj. å¼ºåˆ¶çš„ï¼›å¼ºè¿«çš„<br>244, computation  [kÉ’mpjÊŠâ€™teÉªÊƒ(É™)n]<br>n. ä¼°è®¡ï¼Œè®¡ç®—<br>245, concatenate  [kÉ‘nâ€™kÃ¦tÉ™,net]<br>vt. è¿ç»“ï¼›ä½¿è¿é”<br>adj. è¿ç»“çš„ï¼›è¿é”çš„<br>246, conclusions  [kÉ™nâ€™klÊŠÊ’É™nz]<br>n. ç»“è®ºï¼Œæ€»ç»“ï¼›å†³å®šï¼ˆconclusionçš„å¤æ•°ï¼‰<br>247, concrete  [â€˜kÉ’Å‹kriËt]<br>adj. æ··å‡åœŸçš„ï¼›å®åœ¨çš„ï¼Œå…·ä½“çš„ï¼›æœ‰å½¢çš„;<br>vi. å‡ç»“;<br>vt. ä½¿å‡å›ºï¼›ç”¨æ··å‡åœŸä¿®ç­‘;<br>n. å…·ä½“ç‰©ï¼›å‡ç»“ç‰©<br>248, Concrete  [â€˜kÉ’Å‹kriËt]<br>adj. æ··å‡åœŸçš„ï¼›å®åœ¨çš„ï¼Œå…·ä½“çš„ï¼›æœ‰å½¢çš„;<br>vi. å‡ç»“;<br>vt. ä½¿å‡å›ºï¼›ç”¨æ··å‡åœŸä¿®ç­‘;<br>n. å…·ä½“ç‰©ï¼›å‡ç»“ç‰©<br>249, condense  [kÉ™nâ€™dens]<br>vi. æµ“ç¼©ï¼›å‡ç»“;<br>vt. ä½¿æµ“ç¼©ï¼›ä½¿å‹ç¼©<br>250, confidentiality  [,kÉ‘nfÉª,dÉ›nÊƒÉªâ€™Ã¦lÉ™ti]<br>n. æœºå¯†ï¼Œ[è®¡] æœºå¯†æ€§<br>251, confinement  [kÉ™nâ€™faÉªnmÉ™nt]<br>n. é™åˆ¶ï¼›ç›‘ç¦ï¼›åˆ†å¨©<br>252, confluence  [â€˜kÉ‘nfluÉ™ns]<br>n. ï¼ˆæ²³æµçš„ï¼‰æ±‡åˆã€æ±‡æµç‚¹ï¼›ï¼ˆäººæˆ–ç‰©çš„ï¼‰èšé›†<br>253, conjunction  [kÉ™nâ€™dÊ’ÊŒÅ‹kÊƒÉ™n]<br>n. ç»“åˆï¼›[è¯­] è¿æ¥è¯ï¼›åŒæ—¶å‘ç”Ÿ<br>254, consecutive  [kÉ™nâ€™sekjÊŠtÉªv]<br>adj. è¿è´¯çš„ï¼›è¿ç»­ä¸æ–­çš„<br>255, conservative  [kÉ™nâ€™sÉvÉ™tÉªv]<br>adj. ä¿å®ˆçš„<br>n. ä¿å®ˆæ´¾ï¼Œå®ˆæ—§è€…<br>256, consistent  [kÉ™nâ€™sÉªstÉ™nt]<br>adj. å§‹ç»ˆå¦‚ä¸€çš„ï¼Œä¸€è‡´çš„ï¼›åšæŒçš„<br>257, constant  [â€˜kÉ’nst(É™)nt]<br>adj. ä¸å˜çš„ï¼›æ’å®šçš„ï¼›ç»å¸¸çš„;<br>n. [æ•°] å¸¸æ•°ï¼›æ’é‡;<br>n. (Constant)äººåï¼›(å¾·)åº·æ–¯å¦ç‰¹<br>258, Constant  [â€˜kÉ’nst(É™)nt]<br>adj. ä¸å˜çš„ï¼›æ’å®šçš„ï¼›ç»å¸¸çš„;<br>n. [æ•°] å¸¸æ•°ï¼›æ’é‡;<br>n. (Constant)äººåï¼›(å¾·)åº·æ–¯å¦ç‰¹<br>259, consult  [kÉ™nâ€™sÊŒlt]<br>vt. æŸ¥é˜…ï¼›å•†é‡ï¼›å‘â€¦è¯·æ•™;<br>vi. è¯·æ•™ï¼›å•†è®®ï¼›å½“é¡¾é—®<br>260, consumption  [kÉ™nâ€™sÊŒm(p)Êƒ(É™)n]<br>n. æ¶ˆè´¹ï¼›æ¶ˆè€—ï¼›è‚ºç—¨<br>261, contend  [kÉ™nâ€™tÉ›nd]<br>vi. ç«äº‰ï¼›å¥‹æ–—ï¼›æ–—äº‰ï¼›äº‰è®º<br>vt. ä¸»å¼ ï¼›ä¸ºâ€¦æ–—äº‰<br>262, contention  [kÉ™nâ€™tÉ›nÊƒÉ™n]<br>n. äº‰è®ºï¼Œäº‰è¾©ï¼›äº‰å¤ºï¼›è®ºç‚¹<br>263, contiguous  [kÉ™nâ€™tÉªgjÊŠÉ™s]<br>adj. è¿ç»­çš„ï¼›é‚»è¿‘çš„ï¼›æ¥è§¦çš„<br>264, continual  [kÉ™nâ€™tÉªnjÊŠÉ™l]<br>adj. æŒç»­ä¸æ–­çš„ï¼›é¢‘ç¹çš„<br>265, continuations  [continuations]<br>n. å»¶ç»­éƒ¨åˆ†ï¼›ï¼ˆä¹¦ç±çš„ï¼‰é™„å½•ï¼›ï¼ˆæ–‡å­¦ä½œå“çš„ï¼‰ç»­é›†ï¼ˆcontinuationçš„å¤æ•°ï¼‰<br>266, convenient  [kÉ™nâ€™viËnÉªÉ™nt]<br>adj. æ–¹ä¾¿çš„ï¼›[åºŸè¯­]é€‚å½“çš„ï¼›[å£è¯­]è¿‘ä¾¿çš„ï¼›å®ç”¨çš„<br>267, Convenient  [kÉ™nâ€™viËnÉªÉ™nt]<br>adj. æ–¹ä¾¿çš„;<br>æ–¹ä¾¿;<br>è¿‘ä¾¿çš„;<br>è¿‘ä¾¿åœ°<br>268, convention  [kÉ™nâ€™venÊƒ(É™)n]<br>n. å¤§ä¼šï¼›[æ³•] æƒ¯ä¾‹ï¼›[è®¡] çº¦å®šï¼›[æ³•] åå®šï¼›ä¹ ä¿—<br>269, conversely  [â€˜kÉ‘nvÉsli]<br>adv. ç›¸ååœ°<br>270, conveys  [conveys]<br>è¿è¾“<br>è¡¨è¾¾<br>271, coordinate  [kÉ™ÊŠâ€™É”:dÉªneÉªt]<br>n. åæ ‡ï¼›åŒç­‰çš„äººæˆ–ç‰©;<br>adj. å¹¶åˆ—çš„ï¼›åŒç­‰çš„;<br>vt. è°ƒæ•´ï¼›æ•´åˆ;<br>vi. åè°ƒ<br>272, coordinator  [koâ€™É”rdn,etÉš]<br>n. åè°ƒè€…ï¼›[è‡ª] åè°ƒå™¨ï¼›åŒç­‰çš„äººæˆ–ç‰©<br>273, cordon  [â€˜kÉ”rdn]<br>n. è­¦æˆ’çº¿ï¼›ç»¶å¸¦ï¼›æŸå¸¦å±‚<br>vt. ç”¨è­¦æˆ’çº¿å›´ä½ï¼›åŒ…å›´éš”ç¦»<br>n. (Cordon)äººåï¼›(è‹±ã€è¥¿)ç§‘ç™»ï¼›(æ³•ã€è‘¡)ç§‘å°”ä¸œ<br>274, cornerstone  [â€˜kÉ”ËnÉ™stÉ™ÊŠn]<br>n. åŸºç¡€ï¼›æŸ±çŸ³ï¼›åœ°åŸº<br>275, coroutine  [,kÉ™uru:â€™ti:n]<br>n. ååŒç¨‹åº<br>276, correspond  [kÉ’rÉªâ€™spÉ’nd]<br>vi. ç¬¦åˆï¼Œä¸€è‡´ï¼›ç›¸åº”ï¼›é€šä¿¡<br>277, correspondingly  [,kÉ”rÉ™â€™spÉ‘ndÉªÅ‹li]<br>adv. ç›¸åº”åœ°ï¼Œç›¸å¯¹åœ°<br>278, Cotton  [â€˜kÉ’t(É™)n]<br>n. æ£‰èŠ±ï¼›æ£‰å¸ƒï¼›æ£‰çº¿<br>vi. ä¸€è‡´ï¼›ç†è§£ï¼›å’Œè°ï¼›äº²è¿‘<br>adj. æ£‰çš„ï¼›æ£‰åˆ¶çš„<br>n. (Cotton)äººåï¼›(è‹±ã€è¥¿ã€è‘¡)ç§‘é¡¿ï¼›(æ³•)æˆˆç™»<br>279, counterintuitive  [,kaÊŠntÉ™rÉªnâ€™tjuËÉªtÉªv]<br>adj. è¿åç›´è§‰çš„<br>280, counterpart  [â€˜kaÊŠntÉ™pÉ‘Ët]<br>n. å‰¯æœ¬ï¼›é…å¯¹ç‰©ï¼›æç›¸ä¼¼çš„äººæˆ–ç‰©<br>281, Courage  [â€˜kÊŒrÉªdÊ’]<br>n. å‹‡æ°”ï¼›èƒ†é‡;<br>n. (Courage)äººåï¼›(è‹±)å¡é‡Œå¥‡ï¼›(æ³•)åº“æ‹‰çƒ­<br>282, crap  [krÃ¦p]<br>n. åºŸè¯ï¼›åºŸç‰©ï¼›å±ï¼›æ‹‰å±<br>vi. æ·éª°å­ï¼›æ‹‰å±<br>n. (Crap)äººåï¼›(è‹±)å…‹æ‹‰æ™®<br>283, crater  [â€˜kreÉªtÉ™]<br>n. ç«å±±å£ï¼›å¼¹å‘;<br>vt. åœ¨â€¦ä¸Šå½¢æˆå‘ï¼›å–æ¶ˆï¼›æ¯å;<br>vi. å½¢æˆå‘ï¼›æ¶ˆäº¡<br>284, crawler  [â€˜krÉ”lÉš]<br>n. çˆ¬è¡Œè€…ï¼›å±¥å¸¦ç‰µå¼•è£…ç½®<br>285, creamy  [â€˜kriËmÉª]<br>adj.å¥¶æ²¹è‰²çš„ï¼›ä¹³è„‚çŠ¶çš„ï¼›å«ä¹³è„‚çš„<br>286, crisp  [krÉªsp]<br>adj. è„†çš„ï¼›æ–°é²œçš„ï¼›æ˜“ç¢çš„;<br>vt. ä½¿å·æ›²ï¼›ä½¿å‘è„†;<br>vi. å·æ›²ï¼›å‘è„†;<br>n. æ¾è„†ç‰©ï¼›æ²¹ç‚¸é©¬é“ƒè–¯ç‰‡;<br>n. (Crisp)äººåï¼›(è‹±)å…‹é‡Œæ–¯æ™®<br>287, criteria  [kraÉªâ€™tÉªÉ™rÉªÉ™]<br>n. æ ‡å‡†ï¼Œæ¡ä»¶ï¼ˆcriterionçš„å¤æ•°ï¼‰<br>288, Criteria  [kraÉªâ€™tÉªÉ™rÉªÉ™]<br>n. æ ‡å‡†ï¼Œæ¡ä»¶ï¼ˆcriterionçš„å¤æ•°ï¼‰<br>289, critical  [â€˜krÉªtÉªk(É™)l]<br>adj. é‰´å®šçš„ï¼›[æ ¸] ä¸´ç•Œçš„ï¼›æ‰¹è¯„çš„ï¼Œçˆ±æŒ‘å‰”çš„ï¼›å±é™©çš„ï¼›å†³å®šæ€§çš„ï¼›è¯„è®ºçš„<br>290, criticize  [â€˜krÉªtÉªsaÉªz]<br>vt. æ‰¹è¯„ï¼›è¯„è®ºï¼›ééš¾<br>vi. æ‰¹è¯„ï¼›è¯„è®ºï¼›è‹›æ±‚<br>291, cropper  [â€˜krÉ’pÉ™]<br>n. ç§æ¤è€…ï¼›å†œä½œç‰©ï¼›æ”¶å‰²æœºï¼›ä¿®å‰ªæœº<br>n. (Cropper)äººåï¼›(æ„)å…‹ç½—ç€å°”ï¼›(è‹±)å…‹ç½—ç€<br>292, crucial  [â€˜kruËÊƒ(É™)l]<br>adj. é‡è¦çš„ï¼›å†³å®šæ€§çš„ï¼›å®šå±€çš„ï¼›å†³æ–­çš„<br>293, crunch  [krÊŒn(t)Êƒ]<br>n. å’¬ç¢ï¼Œå’¬ç¢å£°ï¼›æ‰æ‰åœ°è¸<br>vt. å‹ç¢ï¼›å˜æ‰å˜æ‰çš„å’¬åš¼ï¼›æ‰æ‰åœ°è¸è¿‡<br>vi. å˜å±ä½œå“åœ°å’€åš¼ï¼›å˜å±å˜å±åœ°è¸è¿‡<br>294, cryptography  [krÉªpâ€™tÉ’grÉ™fÉª]<br>n. å¯†ç å­¦ï¼›å¯†ç ä½¿ç”¨æ³•<br>295, Cryptography  [krÉªpâ€™tÉ’grÉ™fÉª]<br>n. å¯†ç å­¦ï¼›å¯†ç ä½¿ç”¨æ³•<br>296, cue  [kjuË]<br>n.æç¤ºï¼Œæš—ç¤ºï¼›çº¿ç´¢<br>vt.ç»™â€¦æš—ç¤º<br>n.(Cue)äººåï¼›(è¥¿)åº“åŸƒ<br>297, culprit  [â€˜kÊŒlprÉªt]<br>n. çŠ¯äººï¼Œç½ªçŠ¯ï¼›è¢«æ§çŠ¯ç½ªçš„äºº<br>298, cumbersome  [â€˜kÊŒmbÉ™s(É™)m]<br>adj. ç¬¨é‡çš„ï¼›ç´¯èµ˜çš„ï¼›éš¾å¤„ç†çš„<br>299, cumulative  [â€˜kjumjÉ™letÉªv]<br>adj. ç´¯ç§¯çš„<br>300, cumulatively<br>adv. ç´¯ç§¯åœ°ï¼›æ¸å¢åœ°<br>301, curator  [kjÊŠ(É™)â€™reÉªtÉ™]<br>n. é¦†é•¿ï¼›ç›‘æŠ¤äººï¼›ç®¡ç†è€…<br>302, curly  [â€˜kÉœËlÉª]<br>adj. å·æ›²çš„ï¼›å·æ¯›çš„ï¼›ï¼ˆæœ¨æï¼‰æœ‰çš±çŠ¶çº¹ç†çš„ï¼›èœ·ç¼©çš„<br>303, curry  [â€˜kÊŒrÉª]<br>vt. ç”¨å’–å–±çƒ§ï¼Œç»™â€¦åŠ å’–å–±ç²‰ï¼›æ¢³åˆ·ï¼›é­æ‰“;<br>n. å’–å“©ç²‰ï¼Œå’–å–±ï¼›å’–å“©é¥­èœ<br>304, cutoff  [â€˜kÊŒt,É”Ëf]<br>n. åˆ‡æ‰ï¼›ä¸­æ–­ï¼›æ·å¾„</p><p>adj. æˆªæ­¢çš„ï¼›ä¸­æ–­çš„<br>305, cutting-edge  [â€˜kÊŒtÉªÅ‹â€™edÊ’]<br>n. (åˆ€ç‰‡çš„)åˆƒå£ï¼›å°–ç«¯ï¼›å‰æ²¿;<br>adj. å…ˆè¿›çš„ï¼Œå°–ç«¯çš„<br>306, Cycle  [â€˜saÉªk(É™)l]<br>n. å¾ªç¯ï¼›å‘¨æœŸï¼›è‡ªè¡Œè½¦ï¼›æ•´å¥—ï¼›ä¸€æ®µæ—¶é—´;<br>vt. ä½¿å¾ªç¯ï¼›ä½¿è½®è½¬;<br>vi. å¾ªç¯ï¼›éª‘è‡ªè¡Œè½¦ï¼›è½®è½¬<br>307, cyclone  [â€˜saÉªklon]<br>n. æ—‹é£ï¼›[æ°”è±¡] æ°”æ—‹ï¼›é£“é£<br>308, dabble  [â€˜dÃ¦bl]<br>vt. æº…æ¹¿ï¼›æµ¸å…¥æ°´ä¸­<br>vi. æ¶‰çŒï¼›æ¶‰è¶³ï¼›ç©æ°´<br>309, daemon  [â€˜diËmÉ™n]<br>n. å®ˆæŠ¤è¿›ç¨‹ï¼›åå°ç¨‹åº<br>310, dapper  [â€˜dÃ¦pÉš]<br>adj. çŸ­å°ç²¾æ‚çš„ï¼›è¡£å† æ¥šæ¥šçš„ï¼›æ•´æ´çš„ï¼›æ•´é½çš„<br>n. (Dapper)äººåï¼›(è‹±)è¾¾ç€ï¼›(æ„)è¾¾ç€å°”ï¼›(å¾·)è¾¾ä½©å°”<br>311, Dashboard  [â€˜dÃ¦ÊƒbÉ”Ëd]<br>n. æ±½è½¦ç­‰çš„ä»ªè¡¨æ¿ï¼›é©¬è½¦ç­‰å‰éƒ¨çš„æŒ¡æ³¥æ¿<br>312, daunting  [â€˜dÉ”ntÉªÅ‹]<br>adj. ä½¿äººç•ç¼©çš„ï¼›ä½¿äººæ°”é¦çš„ï¼›ä»¤äººæ€¯æ­¥çš„<br>313, deactivation  [di:,Ã¦ktiâ€™veiÊƒÉ™n]<br>n. [ç‰©åŒ–] å‡æ´»åŒ–ä½œç”¨ï¼›é’åŒ–ä½œç”¨<br>314, dealt  [delt]<br>v. å¤„ç†ï¼ˆdealçš„è¿‡å»å¼å’Œè¿‡å»åˆ†è¯ï¼‰<br>315, decade  [â€˜dekeid]<br>n. åå¹´ï¼Œåå¹´æœŸï¼›å<br>316, decay  [dÉªâ€™ke]<br>vi. è¡°é€€ï¼Œ[æ ¸] è¡°å‡ï¼›è…çƒ‚ï¼Œè…æœ½<br>n. è¡°é€€ï¼Œ[æ ¸] è¡°å‡ï¼›è…çƒ‚ï¼Œè…æœ½<br>vt. ä½¿è…çƒ‚ï¼Œä½¿è…è´¥ï¼›ä½¿è¡°é€€ï¼Œä½¿è¡°è½<br>n. (Decay)äººåï¼›(æ³•)å¾·å‡¯<br>317, decaying  [dÉªâ€™ke]<br>n. [æ ¸] è¡°å‡ï¼›é¢“åï¼›è…èš€ä½œç”¨<br>v. è…çƒ‚ï¼›è¡°é€€ï¼›æ¶ˆç˜¦ï¼ˆdecayçš„ingå½¢å¼ï¼‰<br>adj. è¡°å‡çš„ï¼›è…çƒ‚çš„ï¼›æ¶ˆæ•£çš„<br>318, declarations  [,deklÉ™â€™reiÊƒÉ™nz]<br>n. [æ³•] å£°æ˜ï¼ˆdeclarationçš„å¤æ•°ï¼‰<br>319, Declarative  [dÉªâ€™klÃ¦rÉ™tÉªv]<br>adj. å®£è¨€çš„ï¼›é™ˆè¿°çš„ï¼Œè¯´æ˜çš„<br>320, decommission  [diËkÉ™â€™mÉªÊƒ(É™)n]<br>vt. ä½¿â€¦é€€å½¹ï¼›è§£é™¤â€¦çš„å†›èŒ<br>321, decorate  [â€˜dekÉ™reÉªt]<br>vt. è£…é¥°ï¼›å¸ƒç½®ï¼›æˆå‹‹ç»™;<br>vi. è£…é¥°ï¼›å¸ƒç½®<br>322, decoration  [dekÉ™â€™reÉªÊƒ(É™)n]<br>n. è£…é¥°ï¼Œè£…æ½¢ï¼›è£…é¥°å“ï¼›å¥–ç« <br>323, decorator  [â€˜dÉ›kÉ™retÉš]<br>n. è£…é¥°è€…ï¼›å®¤å†…è£…æ½¢å¸ˆ<br>324, decouple  [diËâ€™kÊŒp(É™)l]<br>vt. å‡å¼±éœ‡æ³¢;<br>n. [ç”µ] å»è€¦<br>325, decoupling  [di:â€™kÊŒpliÅ‹]<br>n. å»è€¦<br>v. å»è€¦ï¼ˆdecoupleçš„ç°åœ¨åˆ†è¯ï¼‰<br>326, dedicate  [â€˜dÉ›dÉªket]<br>vt. è‡´åŠ›ï¼›çŒ®èº«ï¼›é¢˜çŒ®<br>327, dedicated  [â€˜dÉ›dÉ™â€™ketÉªd]<br>adj. ä¸“ç”¨çš„ï¼›ä¸“æ³¨çš„ï¼›çŒ®èº«çš„<br>v. ä»¥â€¦å¥‰çŒ®ï¼›æŠŠâ€¦ç”¨äºï¼ˆdedicateçš„è¿‡å»å¼å’Œè¿‡å»åˆ†è¯ï¼‰<br>328, deem  [diËm]<br>vt. è®¤ä¸ºï¼Œè§†ä½œï¼›ç›¸ä¿¡</p><p>vi. è®¤ä¸ºï¼ŒæŒæŸç§çœ‹æ³•ï¼›ä½œæŸç§è¯„ä»·</p><p>n. (Deem)äººåï¼›(è‹±)è¿ªå§†<br>329, deemed  [diËmd]<br>v. è®¤ä¸ºï¼ˆdeemçš„è¿‡å»å¼ï¼‰<br>330, Defer  [dÉªâ€™fÉœË]<br>vi. æ¨è¿Ÿï¼›å»¶æœŸï¼›æœä»;<br>vt. ä½¿æ¨è¿Ÿï¼›ä½¿å»¶æœŸ;<br>n. (Defer)äººåï¼›(æ³•)å¾·è´¹<br>331, Deferred  [dÉªâ€™fÉœËd]<br>adj. å»¶æœŸçš„;<br>v. æ¨è¿Ÿï¼ˆdeferçš„è¿‡å»å¼åŠè¿‡å»åˆ†è¯å½¢å¼ï¼‰<br>332, deficiency  [dÉªâ€™fÉªÊƒ(É™)nsÉª]<br>n. ç¼ºé™·ï¼Œç¼ºç‚¹ï¼›ç¼ºä¹ï¼›ä¸è¶³çš„æ•°é¢<br>333, deficient  [dÉªâ€™fÉªÊƒ(É™)nt]<br>adj. ä¸è¶³çš„ï¼›æœ‰ç¼ºé™·çš„ï¼›ä¸å……åˆ†çš„<br>334, deflate  [dÉªâ€™flet]<br>vt. æ”¾æ°”ï¼›ä½¿ç¼©å°ï¼›ç´§ç¼©é€šè´§ï¼›æ‰“å‡»ï¼›ä½¿æ³„æ°”<br>vi. ç¼©å°ï¼›ç‰©ä»·ä¸‹é™<br>335, degree  [dÉªâ€™griË]<br>n. ç¨‹åº¦ï¼Œç­‰çº§ï¼›åº¦ï¼›å­¦ä½ï¼›é˜¶å±‚<br>336, dejection  [dÉªâ€™dÊ’ekÊƒ(É™)n]<br>n. æ²®ä¸§ï¼›ç²ªä¾¿<br>337, delimiter  [dÉªâ€™lÉªmÉªtÉš]<br>n. [è®¡] å®šç•Œç¬¦<br>338, delta  [â€˜dÉ›ltÉ™]<br>n. ï¼ˆæ²³æµçš„ï¼‰ä¸‰è§’æ´²ï¼›å¾·è€³å¡”ï¼ˆå¸Œè…Šå­—æ¯çš„ç¬¬å››ä¸ªå­—ï¼‰<br>n. (Delta)äººåï¼›(è‹±ã€ç½—ã€è‘¡)å¾·å°”å¡”<br>339, demand  [dÉªâ€™mÉ‘Ënd]<br>vt. è¦æ±‚ï¼›éœ€è¦ï¼›æŸ¥è¯¢;<br>vi. éœ€è¦ï¼›è¯·æ±‚ï¼›æŸ¥é—®;<br>n. [ç»] éœ€æ±‚ï¼›è¦æ±‚ï¼›éœ€è¦;<br>n. (Demand)äººåï¼›(å¾·)å¾·æ›¼å¾·<br>340, demarcation  [â€˜dimÉ‘râ€™keÊƒÉ™n]<br>n. åˆ’åˆ†ï¼›åˆ’ç•Œï¼›é™ç•Œ<br>341, democracy  [dÉªËˆmÉ‘krÉ™si]<br>n. æ°‘ä¸»ï¼Œæ°‘ä¸»ä¸»ä¹‰ï¼›æ°‘ä¸»æ”¿æ²»<br>342, demonstrate  [â€˜demÉ™nstreÉªt]<br>vt. è¯æ˜ï¼›å±•ç¤ºï¼›è®ºè¯<br>vi. ç¤ºå¨<br>343, demote  [diËâ€™mÉ™ÊŠt]<br>vt. ä½¿é™çº§ï¼›ä½¿é™èŒ<br>344, denial  [dÉªâ€™naÉªÉ™l]<br>n. å¦è®¤ï¼›æ‹’ç»ï¼›èŠ‚åˆ¶ï¼›èƒŒå¼ƒ<br>345, denoted<br>è¡¨ç¤ºï¼ŒæŒ‡ç¤ºï¼ˆdenoteçš„è¿‡å»å¼å’Œè¿‡å»åˆ†è¯ï¼‰<br>346, Denotes  []<br>ä¸ºâ€¦çš„ç¬¦å·ï¼Œè¡¨ç¤ºï¼ŒæŒ‡ç¤ºï¼ˆdenoteçš„ç¬¬ä¸‰äººç§°å•æ•°ï¼‰<br>347, density  [â€˜dÉ›nsÉ™ti]<br>n. å¯†åº¦<br>348, dentry<br>ç›®å½•é¡¹<br>349, depict  [dÉªâ€™pÉªkt]<br>vt. æè¿°ï¼›æç”»<br>350, Deploy  [dÉªâ€™plÉ’Éª]<br>vt. é…ç½®ï¼›å±•å¼€ï¼›ä½¿ç–å¼€;<br>vi. éƒ¨ç½²ï¼›å±•å¼€;<br>n. éƒ¨ç½²<br>351, depot  [â€˜depÉ™ÊŠ]<br>n. ä»“åº“ï¼›åœè½¦åœºï¼›èˆªç©ºç«™;<br>vt. æŠŠâ€¦å­˜æ”¾åœ¨å‚¨è—å¤„;<br>adj. è¯æ€§æŒä¹…çš„;<br>n. (Depot)äººåï¼›(åˆš(å¸ƒ))å¾·æ³¢ç‰¹<br>352, deprecation  [,depriâ€™keiÊƒÉ™n]<br>n. ç¥ˆå…ï¼›è´¬ä½ï¼›åå¯¹<br>353, derivative  [dÉªâ€™rÉªvÉ™tÉªv]<br>n. [åŒ–å­¦] è¡ç”Ÿç‰©ï¼Œæ´¾ç”Ÿç‰©ï¼›å¯¼æ•°<br>adj. æ´¾ç”Ÿçš„ï¼›å¼•å‡ºçš„<br>354, descendant  [dÉªâ€™sÉ›ndÉ™nt]<br>adj. ä¸‹é™çš„ï¼›ç¥–ä¼ çš„<br>n. åè£”ï¼›å­å­™<br>355, descended  [dÉªâ€™sendÉªd]<br>adj. å‡ºèº«äºâ€¦çš„ï¼›ä»ä¸€ä¸ªç¥–å…ˆä¼ ä¸‹æ¥çš„<br>356, designate  [â€˜dezÉªgneÉªt]<br>vt. æŒ‡å®šï¼›æŒ‡æ´¾ï¼›æ ‡å‡ºï¼›æŠŠâ€¦å®šåä¸º;<br>adj. æŒ‡å®šçš„ï¼›é€‰å®šçš„<br>357, designated  [â€˜dÉ›zÉªg,netÉªd]<br>adj. æŒ‡å®šçš„ï¼›ç‰¹æŒ‡çš„<br>358, desirable  [dÉªâ€™zaÉªÉ™rÉ™bl]<br>adj. ä»¤äººæ»¡æ„çš„ï¼›å€¼å¾—è¦çš„ n. åˆæ„çš„äººæˆ–äº‹ç‰©<br>359, desire  [dÉªâ€™zaÉªÉš]<br>n. æ¬²æœ›ï¼›è¦æ±‚ï¼Œå¿ƒæ„¿ï¼›æ€§æ¬²<br>vt. æƒ³è¦ï¼›è¦æ±‚ï¼›å¸Œæœ›å¾—åˆ°â€¦<br>vi. æ¸´æœ›<br>n. (Desire)äººåï¼›(åˆš(å¸ƒ)ã€è‹±)å¾·è¥¿é›·<br>360, desired  [dÉªâ€™zaÉªrd]<br>adj. æ¸´æœ›çš„ï¼›æƒ³å¾—åˆ°çš„<br>v. æ¸´æœ›ï¼Œè¦æ±‚ï¼ˆdesireçš„è¿‡å»åˆ†è¯å½¢å¼ï¼‰<br>361, destruction  [dÉªâ€™strÊŒkÊƒ(É™)n]<br>n. ç ´åï¼Œæ¯ç­ï¼›æ‘§æ¯<br>362, detach  [dÉªâ€™tÃ¦tÊƒ]<br>vt. åˆ†ç¦»ï¼›æ´¾é£ï¼›ä½¿è¶…ç„¶<br>363, detached  [dÉªâ€™tÃ¦tÊƒt]<br>adj. åˆ†ç¦»çš„ï¼Œåˆ†å¼€çš„ï¼›è¶…ç„¶çš„<br>v. åˆ†ç¦»<br>364, Detail  [â€˜diËteÉªl]<br>n. ç»†èŠ‚ï¼Œè¯¦æƒ…;<br>vt. è¯¦è¿°ï¼›é€‰æ´¾;<br>vi. ç”»è¯¦å›¾<br>365, deviation  [â€˜divÉªâ€™eÊƒÉ™n]<br>n. åå·®ï¼›è¯¯å·®ï¼›èƒŒç¦»<br>366, diagnose  [â€˜daÉªÉ™gnÉ™ÊŠz; -â€˜nÉ™ÊŠz]<br>vt. è¯Šæ–­ï¼›æ–­å®š</p><p>vi. è¯Šæ–­ï¼›åˆ¤æ–­<br>367, diagram  [â€˜daÉªÉ™grÃ¦m]<br>n. å›¾è¡¨ï¼›å›¾è§£<br>vt. ç”¨å›¾è§£æ³•è¡¨ç¤º<br>diagram: å›¾è¡¨  å›¾è§£  ç®€å›¾<br>368, dial  [â€˜daÉªÉ™l]<br>n. è½¬ç›˜ï¼›åˆ»åº¦ç›˜ï¼›é’Ÿé¢<br>vi. æ‹¨å·<br>vt. ç»™â€¦æ‹¨å·æ‰“ç”µè¯<br>n. (Dial)äººåï¼›(è‹±)æˆ´å°”<br>369, dialect  [â€˜daÉªÉ™lekt]<br>n. æ–¹è¨€ï¼ŒåœŸè¯ï¼›åŒæºè¯­ï¼›è¡Œè¯ï¼›ä¸ªäººç”¨è¯­ç‰¹å¾</p><p>adj. æ–¹è¨€çš„<br>370, Dialect  [â€˜daÉªÉ™lekt]<br>n. æ–¹è¨€ï¼ŒåœŸè¯ï¼›åŒæºè¯­ï¼›è¡Œè¯ï¼›ä¸ªäººç”¨è¯­ç‰¹å¾;<br>adj. æ–¹è¨€çš„<br>371, digest  [daÉªâ€™dÊ’É›st]<br>vt. æ¶ˆåŒ–ï¼›å¸æ”¶ï¼›èä¼šè´¯é€š<br>vi. æ¶ˆåŒ–<br>n. æ–‡æ‘˜ï¼›æ‘˜è¦<br>372, Digest  [daÉªâ€™dÊ’est; dÉª-]<br>vt. æ¶ˆåŒ–ï¼›å¸æ”¶ï¼›èä¼šè´¯é€š;<br>vi. æ¶ˆåŒ–;<br>n. æ–‡æ‘˜ï¼›æ‘˜è¦<br>373, dimension  [dÉªâ€™menÊƒ(É™)n; daÉª-]<br>n. æ–¹é¢;[æ•°] ç»´ï¼›å°ºå¯¸ï¼›æ¬¡å…ƒï¼›å®¹ç§¯ vt. æ ‡å‡ºå°ºå¯¸;<br>adj. è§„æ ¼çš„;<br>adj. è§„æ ¼çš„<br>374, dimensional  [dÉªâ€™menÊƒÉ™nÉ™l]<br>adj. ç©ºé—´çš„ï¼›å°ºå¯¸çš„<br>375, dimensionality  [daÉªmÉ›nÊƒÉ™â€™nÃ¦lÉ™ti]<br>n. ç»´åº¦ï¼›å¹…å‘˜ï¼›å¹¿å»¶<br>376, dimensions  [dÉªâ€™mÉ›nÊƒÉ™nz]<br>n. è§„æ¨¡ï¼Œå¤§å°<br>377, directive  [daÉªâ€™rÉ›ktÉªv]<br>n. æŒ‡ç¤ºï¼›æŒ‡ä»¤<br>adj. æŒ‡å¯¼çš„ï¼›ç®¡ç†çš„<br>378, disambiguate  [dÉªsÃ¦mâ€™bÉªgjÊŠeÉªt]<br>vt. æ¶ˆé™¤ï¼ˆå­—å¥ç­‰çš„ï¼‰å«ç³Šæ„ä¹‰ï¼Œæ¶ˆé™¤â€¦çš„è™šæ— ä¸»ä¹‰<br>379, disastrous  [dÉªâ€™zÉ‘ËstrÉ™s]<br>adj. ç¾éš¾æ€§çš„ï¼›æŸå¤±æƒ¨é‡çš„ï¼›æ‚²ä¼¤çš„<br>380, discrepancy  [dÉªsâ€™krep(É™)nsÉª]<br>n. ä¸ç¬¦ï¼›çŸ›ç›¾ï¼›ç›¸å·®<br>381, discretionary  [dÉªâ€™skreÊƒ(É™)n(É™)rÉª]<br>adj. ä»»æ„çš„ï¼›è‡ªç”±å†³å®šçš„<br>382, discriminator  [dÉªâ€™skrÉªmÉªneÉªtÉ™]<br>n. [ç”µå­] é‰´åˆ«å™¨ï¼›è¾¨åˆ«è€…<br>383, discuss  [dÉªâ€™skÊŒs]<br>vt. è®¨è®ºï¼›è®ºè¿°ï¼Œè¾©è®º<br>384, dismiss  [dÉªsâ€™mÉªs]<br>vt. è§£æ•£ï¼›è§£é›‡ï¼›å¼€é™¤ï¼›è®©â€¦ç¦»å¼€ï¼›ä¸äºˆç†ä¼šã€ä¸äºˆè€ƒè™‘;<br>vi. è§£æ•£<br>385, Dismissal  [dÉªsâ€™mÉªsl]<br>n. è§£é›‡ï¼›å…èŒ<br>386, Dispatcher  [dÉªsâ€™pÃ¦tÊƒÉ™]<br>n. è°ƒåº¦å‘˜ï¼›[è®¡] è°ƒåº¦ç¨‹åºï¼›[è®¡] åˆ†é…å™¨<br>387, disperse  [dÉªâ€™spÉœËs]<br>vt. åˆ†æ•£ï¼›ä½¿æ•£å¼€ï¼›ä¼ æ’­;<br>vi. åˆ†æ•£;<br>adj. åˆ†æ•£çš„<br>388, Displaced  [dÉªsâ€™ples]<br>adj. æ— å®¶å¯å½’çš„ï¼›ä½ç§»çš„ï¼›è¢«å–ä»£çš„<br>n. æ— å®¶å¯å½’è€…<br>v. å–ä»£ï¼ˆdisplaceçš„è¿‡å»åˆ†è¯ï¼‰ï¼›ç§»åŠ¨â€¦çš„ä½ç½®ï¼›æ’¤æ¢<br>389, disruption  [dÉªsâ€™rÊŒpÊƒÉ™n]<br>n. ç ´åï¼Œæ¯åï¼›åˆ†è£‚ï¼Œç“¦è§£<br>390, disruptor  [disruptor]<br>n. ç ´åè€…ï¼Œåˆ†è£‚è€…<br>391, Disruptor  [dÉªsËˆrÊŒpt]<br>n. ç ´åè€…ï¼Œåˆ†è£‚è€…<br>392, dissect  [dÉªËˆsÉ›kt, daÉª-, ËˆdaÉªËŒsÉ›kt]<br>vt. åˆ‡ç»†ï¼›ä»”ç»†åˆ†æ<br>vi. è¿›è¡Œè§£å‰–ï¼›è¿›è¡Œè¯¦ç»†åˆ†æ<br>393, Dissector  [dÉªâ€™sektÉ™]<br>n. è§£å‰–å™¨ï¼›æè±¡å™¨<br>394, Dissipator  [â€˜disipeitÉ™]<br>n. æµªå­ï¼Œæ”¾è¡è€…<br>395, distinguish  [dÉªâ€™stÉªÅ‹gwÉªÊƒ]<br>vi. åŒºåˆ«ï¼ŒåŒºåˆ†ï¼›è¾¨åˆ«<br>vt. åŒºåˆ†ï¼›è¾¨åˆ«ï¼›ä½¿æ°å‡ºï¼Œä½¿è¡¨ç°çªå‡º<br>396, Distributed  [dÉªâ€™strÉªbjÊŠtÉªd]<br>adj. åˆ†å¸ƒå¼çš„ï¼Œåˆ†æ•£å¼çš„<br>397, Distributions  [,dÉªstrÉ™â€™bjÊŠÊƒÉ™n]<br>n. åˆ†æ´¾ï¼›åˆ†æ´¾ï¼›åˆ†é”€ï¼ˆdistributionçš„å¤æ•°å½¢å¼ï¼‰<br>398, Distro  [Distro]<br>n. å‘è¡Œç‰ˆ<br>399, divergence  [daÉªâ€™vÉœËdÊ’(É™)ns]<br>n. åˆ†æ­§<br>400, Doctype<br>n. æ–‡æ¡£ç±»å‹<br>401, Domestic  [dÉ™â€™mestÉªk]<br>adj. å›½å†…çš„ï¼›å®¶åº­çš„ï¼›é©¯å…»çš„ï¼›ä¸€å¿ƒåªç®¡å®¶åŠ¡çš„<br>n. å›½è´§ï¼›ä½£äºº<br>402, dominant  [â€˜dÉ’mÉªnÉ™nt]<br>adj. æ˜¾æ€§çš„ï¼›å ä¼˜åŠ¿çš„ï¼›æ”¯é…çš„ï¼Œç»Ÿæ²»çš„<br>n. æ˜¾æ€§<br>403, Donations  [doÊŠâ€™neÉªÊƒnz]<br>n. [ç»] æèµ ï¼ˆdonationçš„å¤æ•°ï¼‰ï¼›ææ¬¾<br>404, dozens<br>n. è®¸å¤šï¼ˆdozençš„å¤æ•°ï¼‰<br>405, drain  [dren]<br>vi. æ’æ°´ï¼›æµå¹²<br>vt. å–å…‰ï¼Œè€—å°½ï¼›ä½¿æµå‡ºï¼›æ’æ‰æ°´<br>n. æ’æ°´ï¼›ä¸‹æ°´é“ï¼Œæ’æ°´ç®¡ï¼›æ¶ˆè€—<br>n. (Drain)äººåï¼›(è‹±)å¾·é›·æ©ï¼›(æ³•)å¾·å…°<br>406, dramatically  [drÉ™â€™mÃ¦tÉªkÉ™lÉª]<br>adv. æˆå‰§åœ°ï¼›å¼•äººæ³¨ç›®åœ°;<br>adv. æ˜¾è‘—åœ°ï¼Œå‰§çƒˆåœ°<br>407, drastically  [â€˜drÃ¦stikÉ™li]<br>adv. å½»åº•åœ°ï¼›æ¿€çƒˆåœ°<br>408, drawback  [â€˜drÉ”bÃ¦k]<br>n. ç¼ºç‚¹ï¼Œä¸åˆ©æ¡ä»¶ï¼›é€€ç¨<br>409, drench  [dren(t)Êƒ]<br>vt. ä½¿æ¹¿é€ï¼›ç»™ï¼ˆç‰²ç•œï¼‰çŒè¯;<br>n. æ»‚æ²±å¤§é›¨ï¼›æµ¸æ¶²<br>410, drill  [drÉªl]<br>n. è®­ç»ƒï¼›é’»å­”æœºï¼›é’»å­ï¼›æ’­ç§æœº<br>vi. é’»å­”ï¼›è®­ç»ƒ<br>vt. é’»å­”ï¼›è®­ç»ƒï¼›æ¡æ’­<br>n. (Drill)äººåï¼›(å¾·ã€è‹±)å¾·é‡Œå°”<br>411, drip  [drÉªp]<br>vi. æ»´ä¸‹ï¼›å……æ»¡ï¼›æ¼ä¸‹<br>n. æ°´æ»´ï¼Œæ»´æ°´å£°ï¼›é™è„‰æ»´æ³¨ï¼›ä½¿äººåŒçƒ¦çš„äºº<br>vt. ä½¿æ»´ä¸‹ï¼›æº¢å‡ºï¼Œå‘å‡º<br>412, dual  [â€˜djuËÉ™l]<br>adj. åŒçš„ï¼›åŒé‡çš„;<br>n. åŒæ•°ï¼›åŒæ•°è¯;<br>n. (Dual)äººåï¼›(æ³•)è¿ªé˜¿å°”<br>413, duckweed  [â€˜dÊŒkwiËd]<br>n. æµ®èï¼›æ°´è<br>414, Duckweed  [â€˜dÊŒkwiËd]<br>n. æµ®èï¼›æ°´è<br>415, ducky  [â€˜dÊŒkÉª]<br>adj. å¯å–œçš„ï¼›æå¥½çš„ï¼›æä¸ºæ„‰å¿«çš„<br>416, dumb  [dÊŒm]<br>adj. å“‘çš„ï¼Œæ— è¯´è¯èƒ½åŠ›çš„ï¼›ä¸è¯´è¯çš„ï¼Œæ— å£°éŸ³çš„<br>417, dummy  [â€˜dÊŒmi]<br>adj. è™šæ‹Ÿçš„ï¼›å‡çš„<br>n. å‚€å„¡ï¼›å“‘å·´ï¼›ä»¿åˆ¶å“<br>418, dust  [dÊŒst]<br>n. ç°å°˜ï¼›å°˜åŸƒï¼›å°˜åœŸ;<br>vt. æ’’ï¼›æ‹‚å»ç°å°˜;<br>vi. æ‹‚å»ç°å°˜ï¼›åŒ–ä¸ºç²‰æœ«;<br>n. (Dust)äººåï¼›(å¾·ã€ä¿„)æœæ–¯ç‰¹<br>419, Dutch  [dÊŒtÊƒ]<br>adj. è·å…°çš„ï¼›è·å…°äººçš„ï¼›è·å…°è¯­çš„<br>n. è·å…°äººï¼›è·å…°è¯­<br>adv. è´¹ç”¨å¹³æ‘Šåœ°ï¼›å„è‡ªä»˜è´¦åœ°<br>420, dutiful  [â€˜djuËtÉªfÊŠl; -f(É™)l]<br>adj. å¿ å®çš„ï¼›é¡ºä»çš„ï¼›å®ˆæœ¬åˆ†çš„<br>421, E-Commerce  [â€˜i:,kÉ’mÉœ:s]<br>n. ç”µå­å•†åŠ¡<br>422, ebook  [â€˜i:buk]<br>n. ç”µå­ä¹¦<br>423, echo  [â€˜É›ko]<br>vt. åå°„ï¼›é‡å¤<br>vi. éšå£°é™„å’Œï¼›å‘å‡ºå›å£°<br>n. å›éŸ³ï¼›æ•ˆä»¿<br>424, ecosystem  [â€˜É›ko,sÉªstÉ™m]<br>n. ç”Ÿæ€ç³»ç»Ÿ<br>425, eden  [â€˜i:dÉ™n]<br>n. ä¼Šç”¸å›­ï¼ˆã€Šåœ£ç»ã€‹ä¸­äºšå½“å’Œå¤å¨ƒæœ€åˆå±…ä½çš„åœ°æ–¹ï¼‰<br>426, edgesight  </p><p>427, ego  [â€˜iËgÉ™ÊŠ; â€˜e-]<br>n. è‡ªæˆ‘ï¼›è‡ªè´Ÿï¼›è‡ªæˆ‘æ„è¯†;<br>n. (Ego)äººåï¼›(æ—¥)ä¾æ€™ (å§“)ï¼›(æ³•)åŸƒæˆˆ<br>428, elaborate  [Éªâ€™lÃ¦bÉ™ret]<br>adj. ç²¾å¿ƒåˆ¶ä½œçš„ï¼›è¯¦å°½çš„ï¼›ç…è´¹è‹¦å¿ƒçš„<br>vt. ç²¾å¿ƒåˆ¶ä½œï¼›è¯¦ç»†é˜è¿°ï¼›ä»ç®€å•æˆåˆ†åˆæˆï¼ˆå¤æ‚æœ‰æœºç‰©ï¼‰<br>vi. è¯¦ç»†æè¿°ï¼›å˜å¤æ‚<br>429, elapse  [Éªâ€™lÃ¦ps]<br>vi. æ¶ˆé€ï¼›æ—¶é—´è¿‡å»<br>n. æµé€ï¼›æ—¶é—´çš„è¿‡å»<br>430, elapsed<br>v. æ—¶é—´è¿‡å»ï¼›æ¶ˆé€ï¼ˆelapseçš„è¿‡å»åˆ†è¯ï¼‰<br>431, elastic  [Éªâ€™lÃ¦stÉªk]<br>adj. æœ‰å¼¹æ€§çš„ï¼›çµæ´»çš„ï¼›æ˜“ä¼¸ç¼©çš„;<br>n. æ¾ç´§å¸¦ï¼›æ©¡çš®åœˆ<br>432, election  [Éªâ€™lekÊƒ(É™)n]<br>n. é€‰ä¸¾ï¼›å½“é€‰ï¼›é€‰æ‹©æƒï¼›ä¸Šå¸çš„é€‰æ‹”<br>433, elector  [Éªâ€™lÉ›ktÉš]<br>n. é€‰ä¸¾äººï¼›æœ‰é€‰ä¸¾æƒçš„äººï¼›æ€»ç»Ÿé€‰ä¸¾äºº<br>434, elide  [Éªâ€™laÉªd]<br>vt. çœç•¥ï¼›å–æ¶ˆï¼›åˆ å»ï¼›ä¸äºˆè€ƒè™‘åˆ èŠ‚<br>n. (Elide)äººåï¼›(æ„)åŸƒåˆ©å¾·<br>435, eligible  [â€˜elÉªdÊ’Éªb(É™)l]<br>adj. åˆæ ¼çš„ï¼Œåˆé€‚çš„ï¼›ç¬¦åˆæ¡ä»¶çš„ï¼›æœ‰èµ„æ ¼å½“é€‰çš„<br>n. åˆæ ¼è€…ï¼›é€‚ä»»è€…ï¼›æœ‰èµ„æ ¼è€…<br>436, eliminate  [Éªâ€™lÉªmÉªnet]<br>vt. æ¶ˆé™¤ï¼›æ’é™¤<br>437, elimination  [Éª,lÉªmÉªâ€™neÉªÊƒÉ™n]<br>n. æ¶ˆé™¤ï¼›æ·˜æ±°ï¼›é™¤å»<br>438, embed  [Éªmâ€™bÉ›d]<br>vt. æ ½ç§ï¼›ä½¿åµŒå…¥ï¼Œä½¿æ’å…¥ï¼›ä½¿æ·±ç•™è„‘ä¸­<br>439, embedded  [ÉªmËˆbÉ›dÉªd]<br>adj. åµŒå…¥å¼çš„ï¼›æ¤å…¥çš„ï¼›å†…å«çš„<br>v. åµŒå…¥ï¼ˆembedçš„è¿‡å»å¼å’Œè¿‡å»åˆ†è¯å½¢å¼ï¼‰<br>440, Embedded  [Éªmâ€™bedÉªd]<br>adj. åµŒå…¥å¼çš„ï¼›æ¤å…¥çš„ï¼›å†…å«çš„;<br>v. åµŒå…¥ï¼ˆembedçš„è¿‡å»å¼å’Œè¿‡å»åˆ†è¯å½¢å¼ï¼‰<br>441, embellishment  [Éªmâ€™belÉªÊƒmÉ™nt]<br>n. è£…é¥°ï¼Œä¿®é¥°ï¼›æ¶¦è‰²<br>442, emergency  [Éªâ€™mÉœËdÊ’(É™)nsÉª]<br>n. ç´§æ€¥æƒ…å†µï¼›çªå‘äº‹ä»¶ï¼›éå¸¸æ—¶åˆ»<br>adj. ç´§æ€¥çš„ï¼›å¤‡ç”¨çš„<br>443, emit  [Éªâ€™mÉªt]<br>vt. å‘å‡ºï¼Œæ”¾å°„ï¼›å‘è¡Œï¼›å‘è¡¨<br>444, empathy  [â€˜empÉ™Î¸Éª]<br>n. ç¥å…¥ï¼›ç§»æƒ…ä½œç”¨ï¼›æ‰§ç€<br>n. æ„ŸåŒèº«å—ï¼›åŒæ„Ÿï¼›å…±é¸£<br>445, emphasis  [â€˜É›mfÉ™sÉªs]<br>n. é‡ç‚¹ï¼›å¼ºè°ƒï¼›åŠ å¼ºè¯­æ°”<br>446, emphasis on  []<br>ç€é‡äºï¼›å¯¹â€¦çš„å¼ºè°ƒ<br>emphasis on: å¯¹  å¼ºè°ƒ  å¯¹â€¦â€¦çš„å¼ºè°ƒ<br>447, emphasize  [â€˜É›mfÉ™saÉªz]<br>vt. å¼ºè°ƒï¼Œç€é‡<br>448, employ  [Éªmâ€™plÉ’Éª; em-]<br>vt. ä½¿ç”¨ï¼Œé‡‡ç”¨ï¼›é›‡ç”¨ï¼›ä½¿å¿™äºï¼Œä½¿ä»äº‹äº</p><p>n. ä½¿ç”¨ï¼›é›‡ç”¨<br>449, empower  [Éªmâ€™paÊŠÉ™; em-]<br>vt. æˆæƒï¼Œå…è®¸ï¼›ä½¿èƒ½å¤Ÿ<br>450, emulation  [,emjÊŠâ€™leÉªÊƒÉ™n]<br>n. [è®¡] ä»¿çœŸï¼›ç«äº‰ï¼›æ•ˆæ³•<br>451, encapsulate  [Éªnâ€™kÃ¦psjÊŠleÉªt; en-]<br>vt. å‹ç¼©ï¼›å°†â€¦è£…å…¥èƒ¶å›Šï¼›å°†â€¦å°è¿›å†…éƒ¨ï¼›æ¦‚è¿°;<br>vi. å½¢æˆèƒ¶å›Š<br>452, encapsulated  [Éªnâ€™kÃ¦psÉ™leÉªtÉªd]<br>adj. å¯†å°çš„ï¼›åŒ…åœ¨èšè†œå†…çš„</p><p>v. å‹ç¼©ï¼ˆencapsulateçš„è¿‡å»åˆ†è¯ï¼‰ï¼›å°è¿›å†…éƒ¨ï¼›è£…å…¥èƒ¶å›Š<br>453, encapsulates  [Éªnâ€™kÃ¦psjÊŠleÉªt; en-]<br>vt. å‹ç¼©ï¼›å°†â€¦è£…å…¥èƒ¶å›Šï¼›å°†â€¦å°è¿›å†…éƒ¨;<br>vi. å½¢æˆèƒ¶å›Š<br>454, encapsulation  [Éªn,kÃ¦psÉ™â€™leÊƒÉ™n]<br>n. å°è£…ï¼›åŒ…è£…<br>455, Encapsulation  [Éªn,kÃ¦psÉ™â€™leÉªÊƒÉ™n]<br>n. å°è£…ï¼›åŒ…è£…<br>456, encompass  [Éªnâ€™kÊŒmpÉ™s; en-]<br>vt. åŒ…å«ï¼›åŒ…å›´ï¼Œç¯ç»•ï¼›å®Œæˆ<br>457, encore  [â€˜É’Å‹kÉ”Ë]<br>n. å†æ¼”å”±çš„è¦æ±‚ï¼›ç»è¦æ±‚è€Œå†å”±<br>vt. è¦æ±‚å†æ¼”æˆ–å”±<br>int. å†æ¥ä¸€ä¸ª<br>458, encounter  [Éªnâ€™kaÊŠntÉ™; en-]<br>vt. é­é‡ï¼Œé‚‚é€…ï¼›é‡åˆ°;<br>n. é­é‡ï¼Œå¶ç„¶ç¢°è§;<br>vi. é­é‡ï¼›å¶ç„¶ç›¸é‡<br>459, encrypted<br>v. æŠŠâ€¦ç¼–ç ï¼›æŠŠâ€¦åŠ å¯†ï¼ˆencryptçš„è¿‡å»åˆ†è¯ï¼‰<br>460, endeavour  [Éªnâ€™devÉ™; en-]<br>n. å°½åŠ›ï¼Œç«­åŠ›;<br>vt. ç«­åŠ›åšåˆ°ï¼Œè¯•å›¾æˆ–åŠ›å›¾ï¼ˆåšæŸäº‹ï¼‰;<br>vi. ç«­åŠ›ï¼›ä¼å›¾<br>461, enormous  [Éªâ€™nÉ”ËmÉ™s]<br>adj. åºå¤§çš„ï¼Œå·¨å¤§çš„ï¼›å‡¶æš´çš„ï¼Œææ¶çš„<br>462, entail  [Éªnâ€™tel]<br>vt. ä½¿éœ€è¦ï¼Œå¿…éœ€ï¼›æ‰¿æ‹…ï¼›é—ä¼ ç»™ï¼›è•´å«<br>n. å¼•èµ·ï¼›éœ€è¦ï¼›ç»§æ‰¿<br>463, enthusiasm  [Éªnâ€™Î¸juËzÉªÃ¦z(É™)m; en-]<br>n. çƒ­å¿ƒï¼Œçƒ­å¿±ï¼Œçƒ­æƒ…<br>464, enthusiastic  [Éªn,Î¸juËzÉªâ€™Ã¦stÉªk; en-]<br>adj. çƒ­æƒ…çš„ï¼›çƒ­å¿ƒçš„ï¼›ç‹‚çƒ­çš„<br>465, entrance  [â€˜entr(É™)ns]<br>n. å…¥å£ï¼›è¿›å…¥;<br>vt. ä½¿å‡ºç¥ï¼Œä½¿å…¥è¿·<br>466, entrypoint  [entrypoint]<br>n. è¿›å…¥ç‚¹ï¼›å…¥å¢ƒç‚¹ï¼›å…¥å£ç‚¹<br>467, envelope  [â€˜envÉ™lÉ™ÊŠp; â€˜É’n-]<br>n. ä¿¡å°ï¼Œå°çš®ï¼›åŒ…è†œï¼›[å¤©] åŒ…å±‚ï¼›åŒ…è¿¹<br>468, ephemeral  [É™â€™fÉ›mÉ™rÉ™l]<br>adj. çŸ­æš‚çš„ï¼›æœç”Ÿæš®æ­»çš„<br>n. åªç”Ÿå­˜ä¸€å¤©çš„äº‹ç‰©<br>469, epoch  [â€˜É›pÉ™k]<br>n. [åœ°è´¨] ä¸–ï¼›æ–°çºªå…ƒï¼›æ–°æ—¶ä»£ï¼›æ—¶é—´ä¸Šçš„ä¸€ç‚¹<br>470, equate  [Éªâ€™kweÉªt]<br>vt. ä½¿ç›¸ç­‰ï¼›è§†ä¸ºå¹³ç­‰;<br>vi. ç­‰åŒ<br>471, equates  [Éªâ€™kweÉªt]<br>vt. ä½¿ç›¸ç­‰ï¼›è§†ä¸ºå¹³ç­‰</p><p>vi. ç­‰åŒ<br>472, equipment  [Éªâ€™kwÉªpm(É™)nt]<br>n. è®¾å¤‡ï¼Œè£…å¤‡ï¼›å™¨æ<br>473, equivalent  [Éªâ€™kwÉªv(É™)l(É™)nt]<br>adj. ç­‰ä»·çš„ï¼Œç›¸ç­‰çš„ï¼›åŒæ„ä¹‰çš„;<br>n. ç­‰ä»·ç‰©ï¼Œç›¸ç­‰ç‰©<br>474, erase  [Éªâ€™reÉªz]<br>vt. æŠ¹å»ï¼›æ“¦é™¤<br>vi. è¢«æ“¦å»ï¼Œè¢«æŠ¹æ‰<br>475, erasure  [Éªâ€™reÉªÊ’É™(r)]<br>n. æ¶ˆé™¤ï¼›æ¶‚æ“¦çš„ç—•è¿¹ï¼›æ¶ˆç£<br>476, estimate  [â€˜É›stÉ™,met]<br>vi. ä¼°è®¡ï¼Œä¼°ä»·<br>n. ä¼°è®¡ï¼Œä¼°ä»·ï¼›åˆ¤æ–­ï¼Œçœ‹æ³•<br>vt. ä¼°è®¡ï¼Œä¼°é‡ï¼›åˆ¤æ–­ï¼Œè¯„ä»·<br>477, Estimate  [â€˜estÉªmeÉªt]<br>vi. ä¼°è®¡ï¼Œä¼°ä»·;<br>n. ä¼°è®¡ï¼Œä¼°ä»·ï¼›åˆ¤æ–­ï¼Œçœ‹æ³•;<br>vt. ä¼°è®¡ï¼Œä¼°é‡ï¼›åˆ¤æ–­ï¼Œè¯„ä»·<br>478, estimated  [É›stÉ™ËŒmetÉªd]<br>adj. ä¼°è®¡çš„ï¼›é¢„è®¡çš„ï¼›ä¼°ç®—çš„<br>479, estimation  [,É›stÉªâ€™meÊƒÉ™n]<br>n. ä¼°è®¡ï¼›å°Šé‡<br>480, ethereal  [Éªâ€™Î¸ÉªÉ™rÉªÉ™l]<br>adj. ä¼˜é›…çš„ï¼›è½»é£˜çš„ï¼›ç¼¥ç¼ˆçš„ï¼›è¶…å‡¡çš„<br>481, ethernet  [â€˜iÎ¸ÉšnÉ›t]<br>n. [è®¡] ä»¥å¤ªç½‘<br>482, Ethernet  [Ethernet]<br>n. [è®¡] ä»¥å¤ªç½‘<br>483, evacuate  [Éªâ€™vÃ¦kjuet]<br>vt. ç–æ•£ï¼Œæ’¤é€€ï¼›æ’æ³„<br>vi. ç–æ•£ï¼›æ’¤é€€ï¼›æ’æ³„<br>484, evacuated  [Éªâ€™vÃ¦kjÊŠ,et]<br>adj. ç–æ•£ï¼›æ’ç©ºçš„ï¼Œæ’¤é€€è€…çš„<br>v. ç–æ•£ï¼›æ’¤å‡ºï¼›æ’æ³„ï¼ˆevacuateçš„è¿‡å»å¼å’Œè¿‡å»åˆ†è¯å½¢å¼ï¼‰<br>485, evacuation  [Éª,vÃ¦kjÊŠâ€™eÉªÊƒ(É™)n]<br>n. ç–æ•£ï¼›æ’¤ç¦»ï¼›æ’æ³„<br>486, eval  [Éªâ€™vÃ¦l]<br>n. é‡æ–°è¿ç®—æ±‚å‡ºå‚æ•°çš„å†…å®¹<br>487, evaluate  [Éªâ€™vÃ¦ljÊŠeÉªt]<br>vt. è¯„ä»·ï¼›ä¼°ä»·ï¼›æ±‚â€¦çš„å€¼;<br>vi. è¯„ä»·ï¼›ä¼°ä»·<br>488, Evaluate  [Éªâ€™vÃ¦ljÊŠeÉªt]<br>vt. è¯„ä»·ï¼›ä¼°ä»·ï¼›æ±‚â€¦çš„å€¼;<br>vi. è¯„ä»·ï¼›ä¼°ä»·<br>489, evaluated<br>vi. è¯„ä¼°ï¼›ä¼°â€¦çš„ä»·ï¼ˆevaluateçš„è¿‡å»åˆ†è¯å½¢å¼ï¼‰<br>490, even  [â€˜iËv(É™)n]<br>adj. [æ•°] å¶æ•°çš„ï¼›å¹³å¦çš„ï¼›ç›¸ç­‰çš„;<br>adv. ç”šè‡³ï¼›å³ä½¿ï¼›è¿˜ï¼›å®é™…ä¸Š;<br>vt. ä½¿å¹³å¦ï¼›ä½¿ç›¸ç­‰;<br>vi. å˜å¹³ï¼›å˜å¾—å¯æ¯”è¾ƒï¼›æˆä¸ºç›¸ç­‰;<br>n. (Even)äººåï¼›(æ³•)åŸƒæ—ºï¼›(å¾·)åŸƒæ–‡ï¼›(è‹±)åŸƒæ–‡<br>491, eventually  [Éªâ€™ventÊƒÊŠÉ™lÉª]<br>adv. æœ€åï¼Œç»ˆäº<br>492, evict  [Éªâ€™vÉªkt]<br>vt. é©±é€ï¼›é€å‡º<br>493, eviction  [Éªâ€™vÉªkÊƒ(É™)n]<br>n. é€å‡ºï¼›èµ¶å‡ºï¼›æ”¶å›<br>494, Eviction  [Éªâ€™vÉªkÊƒ(É™)n]<br>n. é€å‡ºï¼›èµ¶å‡ºï¼›æ”¶å›<br>495, evolve  [Éªâ€™vÉ’lv]<br>vt. å‘å±•ï¼Œè¿›åŒ–ï¼›è¿›åŒ–ï¼›ä½¿é€æ­¥å½¢æˆï¼›æ¨æ–­å‡º;<br>vi. å‘å±•ï¼Œè¿›å±•ï¼›è¿›åŒ–ï¼›é€æ­¥å½¢æˆ<br>496, Evolve  [Éªâ€™vÉ’lv]<br>vt. å‘å±•ï¼Œè¿›åŒ–ï¼›è¿›åŒ–ï¼›ä½¿é€æ­¥å½¢æˆï¼›æ¨æ–­å‡º;<br>vi. å‘å±•ï¼Œè¿›å±•ï¼›è¿›åŒ–ï¼›é€æ­¥å½¢æˆ<br>497, evolved<br>adj. è¿›åŒ–äº†çš„;<br>vt. ä½¿é€æ­¥å½¢æˆï¼ˆevolveçš„è¿‡å»åˆ†è¯ï¼‰<br>498, exact  [Éªgâ€™zÃ¦kt; eg-]<br>adj. å‡†ç¡®çš„ï¼Œç²¾å¯†çš„ï¼›ç²¾ç¡®çš„;<br>vt. è¦æ±‚ï¼›å¼ºæ±‚ï¼›æ€¥éœ€;<br>vi. å‹’ç´¢é’±è´¢<br>499, examine  [Éªgâ€™zÃ¦mÉªn; eg-]<br>vt. æ£€æŸ¥ï¼›è°ƒæŸ¥ï¼› æ£€æµ‹ï¼›è€ƒè¯•;<br>vi. æ£€æŸ¥ï¼›è°ƒæŸ¥<br>500, excitable  [Éªkâ€™saÉªtÉ™b(É™)l; ek-]<br>adj. æ˜“æ¿€åŠ¨çš„ï¼›æ˜“å…´å¥‹çš„ï¼›æ˜“æ€’çš„<br>501, Exclusive  [Éªkâ€™skluËsÉªv; ek-]<br>adj. ç‹¬æœ‰çš„ï¼›æ’å¤–çš„ï¼›ä¸“ä¸€çš„;<br>n. ç‹¬å®¶æ–°é—»ï¼›ç‹¬å®¶ç»è¥çš„é¡¹ç›®ï¼›æ’å¤–è€…<br>502, exhaustive  [Éªgâ€™zÉ”ËstÉªv; eg-]<br>adj. è¯¦å°½çš„ï¼›å½»åº•çš„ï¼›æ¶ˆè€—çš„<br>503, exotic  [Éªgâ€™zÉ’tÉªk; eg-]<br>adj. å¼‚å›½çš„ï¼›å¤–æ¥çš„ï¼›å¼‚å›½æƒ…è°ƒçš„<br>504, experimental  [ek,speriâ€™mentÉ™l; ekâ€™s-]<br>adj. å®éªŒçš„ï¼›æ ¹æ®å®éªŒçš„ï¼›è¯•éªŒæ€§çš„<br>505, explanatory  [Éªkâ€™splÃ¦nÉ™tÉ”ri]<br>adj. è§£é‡Šçš„ï¼›è¯´æ˜çš„<br>506, explicitly  [Éªkâ€™splÉªsÉªtli]<br>adv. æ˜ç¡®åœ°ï¼›æ˜ç™½åœ°<br>507, explode  [Éªkâ€™splÉ™ÊŠd; ek-]<br>vi. çˆ†ç‚¸ï¼Œçˆ†å‘ï¼›æ¿€å¢;<br>vt. ä½¿çˆ†ç‚¸ï¼›çˆ†ç‚¸ï¼›æ¨ç¿»<br>508, exponential  [â€˜É›kspÉ™â€™nÉ›nÊƒÉ™l]<br>adj. æŒ‡æ•°çš„<br>n. æŒ‡æ•°<br>509, exponentially  [,É›kspoâ€™nÉ›nÊƒÉ™li]<br>adv. ä»¥æŒ‡æ•°æ–¹å¼<br>510, exponentiation  [,ekspÉ™nenÊƒÉªâ€™eÉªÊƒ(É™)n]<br>n. [æ•°] å–å¹‚ï¼Œæ±‚å¹‚ï¼›ä¹˜æ–¹<br>511, expose  [Éªkâ€™spÉ™ÊŠz; ek-]<br>vt. æ­éœ²ï¼Œæ­å‘ï¼›ä½¿æ›å…‰ï¼›æ˜¾ç¤º<br>512, expresso  [ekâ€™spresÉ™ÊŠ]<br>n. ï¼ˆè’¸æ±½åŠ å‹ç…®å‡ºçš„ï¼‰æµ“å’–å•¡<br>513, expunge  [Éªkâ€™spÊŒndÊ’]<br>vt. æ“¦å»ï¼›åˆ æ‰<br>514, Expunge  [Éªkâ€™spÊŒn(d)Ê’; ek-]<br>vt. æ“¦å»ï¼›åˆ æ‰<br>515, expunges  [Éªkâ€™spÊŒn(d)Ê’; ek-]<br>vt. æ“¦å»ï¼›åˆ æ‰<br>516, extensible  [ekâ€™stensÉªbl; Éªkâ€™stensÉªb(É™)l]<br>adj. å¯å»¶é•¿çš„ï¼›å¯æ‰©å¼ çš„<br>517, Extensible  [ekâ€™stensÉªbl; Éªkâ€™stensÉªb(É™)l]<br>adj. å¯å»¶é•¿çš„ï¼›å¯æ‰©å¼ çš„<br>518, extent  [Éªkâ€™stent; ek-]<br>n. ç¨‹åº¦ï¼›èŒƒå›´ï¼›é•¿åº¦<br>519, extract  [ËˆekstrÃ¦kt]<br>vt. æå–ï¼›å–å‡ºï¼›æ‘˜å½•ï¼›æ¦¨å–</p><p>n. æ±ï¼›æ‘˜å½•ï¼›æ¦¨å‡ºç‰©ï¼›é€‰ç²¹<br>520, extrapolate  [Éªkâ€™strÃ¦pÉ™â€™let]<br>vt. å¤–æ¨ï¼›æ¨æ–­<br>vi. å¤–æ¨ï¼›è¿›è¡Œæ¨æ–­<br>è¿‡å»å¼:extrapolated; è¿‡å»åˆ†è¯:extrapolated; ç°åœ¨åˆ†è¯:extrapolating<br>521, extrapolated<br>v. æ¨æµ‹ï¼ˆextrapolateçš„è¿‡å»åˆ†è¯ï¼‰<br>adj. æ¨æµ‹çš„<br>522, Extras  [â€˜É›kstrÉ™]<br>n. é™„åŠ è®¾å¤‡ï¼›é¢å¤–éƒ¨åˆ†ï¼›å¦å¤–æ”¶è´¹çš„éƒ¨åˆ†ï¼ˆextraçš„å¤æ•°ï¼‰<br>523, facade  [fÉ™â€™sÉ‘Ëd]<br>n. æ­£é¢ï¼›è¡¨é¢ï¼›å¤–è§‚<br>524, facilitate  [fÉ™â€™sÉªlÉªteÉªt]<br>vt. ä¿ƒè¿›ï¼›å¸®åŠ©ï¼›ä½¿å®¹æ˜“<br>525, faint  [feÉªnt]<br>adj. æ¨¡ç³Šçš„ï¼›å¤´æ™•çš„ï¼›è™šå¼±çš„ï¼›[åŒ»] è¡°å¼±çš„</p><p>vi. æ˜å€’ï¼›å˜å¾—å¾®å¼±ï¼›å˜å¾—æ²¡æ°”åŠ›</p><p>n. [ä¸­åŒ»] æ˜å¥ï¼Œæ˜å€’<br>526, Fake  [feÉªk]<br>n. å‡è´§ï¼›éª—å­ï¼›å‡åŠ¨ä½œ;<br>vt. æé€ ï¼›å‡è£…â€¦çš„æ ·å­;<br>vi. å‡è£…ï¼›åšå‡åŠ¨ä½œ;<br>adj. ä¼ªé€ çš„;<br>n. (Fake)äººåï¼›(è‹±)è´¹å…‹<br>527, Fakes  []<br>n. èµå“ï¼›äº‘æ¯æ¿çŠ¶å²©ï¼›å‡å†’å•†å“ï¼ˆfakeçš„å¤æ•°ï¼‰;<br>v. ä½¯è£…ï¼›å‡è£…ï¼ˆfakeçš„ä¸‰å•å½¢å¼ï¼‰;<br>n. (Fakes)äººåï¼›(æ³•)æ³•å…‹<br>528, fallback  [â€˜fÉ”lbÃ¦k]<br>n. å¯ä¾é çš„ä¸œè¥¿ï¼›åå¤‡ç‰©å“ï¼›æ’¤é€€ï¼Œé€€å´<br>529, fame  [feÉªm]<br>n. åå£°ï¼Œåæœ›ï¼›ä¼ é—»ï¼Œä¼ è¯´;<br>vt. ä½¿é—»åï¼Œä½¿æœ‰åæœ›<br>530, fanatical  [fÉ™â€™nÃ¦tÉªkÉ™l]<br>adj. ç‹‚çƒ­çš„<br>531, fancy  [â€˜fÃ¦nsÉª]<br>n. å¹»æƒ³ï¼›æƒ³è±¡åŠ›ï¼›çˆ±å¥½;<br>adj. æƒ³è±¡çš„ï¼›å¥‡ç‰¹çš„ï¼›æ˜‚è´µçš„ï¼›ç²¾é€‰çš„;<br>vt. æƒ³è±¡ï¼›å–œçˆ±ï¼›è®¾æƒ³ï¼›è‡ªè´Ÿ;<br>vi. å¹»æƒ³ï¼›æƒ³è±¡;<br>n. (Fancy)äººåï¼›(æ³•)æ–¹è¥¿<br>532, fanout  [fanout]<br>n. æ‰‡å‡ºï¼›å±•å¼€ï¼›åˆ†åˆ—ï¼ˆè´¦æˆ·ï¼‰<br>533, fatal  [â€˜fetl]<br>adj. è‡´å‘½çš„ï¼›é‡å¤§çš„ï¼›æ¯ç­æ€§çš„ï¼›å‘½ä¸­æ³¨å®šçš„ n. (Fatal)äººåï¼›(è‘¡ã€èŠ¬)æ³•å¡”å°”<br>534, fault  [fÉ”Ëlt; fÉ’lt]<br>n. æ•…éšœï¼›[åœ°è´¨] æ–­å±‚ï¼›é”™è¯¯ï¼›ç¼ºç‚¹ï¼›æ¯›ç—…ï¼›ï¼ˆç½‘çƒç­‰ï¼‰å‘çƒå¤±è¯¯</p><p>vi. å¼„é”™ï¼›äº§ç”Ÿæ–­å±‚</p><p>vt. ï¼ˆé€šå¸¸ç”¨äºç–‘é—®å¥æˆ–å¦å®šå¥ï¼‰æŒ‘å‰”<br>535, favor  [â€˜feÉªvÉ™]<br>vt. èµæˆï¼›å–œæ¬¢ï¼›åƒï¼›èµäºˆï¼›è¯å®;<br>n. å–œçˆ±ï¼›æ¬¢å¿ƒï¼›å¥½æ„Ÿ<br>536, federate  [â€˜fedÉ™reÉªt]<br>adj. åŒç›Ÿçš„ï¼›è”é‚¦åˆ¶åº¦ä¸‹çš„ï¼›è”åˆçš„<br>vt. ä½¿ç»“æˆåŒç›Ÿï¼›ä½¿ç»“æˆè”é‚¦<br>vi. ç»“æˆè”é‚¦<br>537, federated  [â€˜fÉ›dÉ™,retÉªd]<br>adj. è”é‚¦çš„ï¼›è”åˆçš„ï¼›ç»“æˆåŒç›Ÿçš„</p><p>v. ç»“æˆåŒç›Ÿï¼›æŒ‰è”é‚¦åˆ¶ç»„ç»‡èµ·æ¥ï¼ˆfederateçš„è¿‡å»åˆ†è¯ï¼‰<br>538, federation  [fedÉ™â€™reÉªÊƒ(É™)n]<br>n. è”åˆï¼›è”é‚¦ï¼›è”ç›Ÿï¼›è”é‚¦æ”¿åºœ<br>539, fence  [fens]<br>n. æ …æ ï¼›å›´å¢™ï¼›å‰‘æœ¯<br>vt. é˜²æŠ¤ï¼›ç”¨ç¯±ç¬†å›´ä½ï¼›ç»ƒä¹ å‰‘æœ¯<br>vi. å‡»å‰‘ï¼›æªå¡ï¼›å›´ä»¥æ …æ ï¼›è·³è¿‡æ …æ <br>540, fetch  [fetÊƒ]<br>vt. å–æ¥ï¼›æ¥æ¥ï¼›åˆ°è¾¾ï¼›å¸å¼•;<br>vi. æ‹¿ï¼›å–ç‰©ï¼›å–å¾—;<br>n. å–å¾—ï¼›è¯¡è®¡<br>541, fictional  [â€˜fÉªkÊƒÉ™nl]<br>adj. è™šæ„çš„ï¼›å°è¯´çš„<br>542, fictitious  [fÉªkâ€™tÉªÊƒÉ™s]<br>adj. è™šæ„çš„ï¼›å‡æƒ³çš„ï¼›ç¼–é€ çš„ï¼›å‡è£…çš„<br>543, final  [â€˜faÉªn(É™)l]<br>adj. æœ€ç»ˆçš„ï¼›å†³å®šæ€§çš„ï¼›ä¸å¯æ›´æ”¹çš„;<br>n. å†³èµ›ï¼›æœŸæœ«è€ƒè¯•ï¼›å½“æ—¥æŠ¥çº¸çš„æœ«ç‰ˆ<br>544, finer-grained  [finer-grained]<br>ç»†ç²’åº¦<br>545, firework  [â€˜faÉªÉšwÉk]<br>n. çƒŸç«ï¼›æ¿€çƒˆæƒ…ç»ª<br>546, flap  [flÃ¦p]<br>n. æ‹æ‰“ï¼Œæ‹æ‰“å£°ï¼›ç¥ç»ç´§å¼ ï¼›[èˆª] è¥Ÿç¿¼<br>vi. æ‹åŠ¨ï¼›ç¥ç»ç´§å¼ ï¼›é¼“ç¿¼è€Œé£ï¼›ï¼ˆå¸½è¾¹ç­‰ï¼‰å‚ä¸‹<br>vt. æ‹æ‰“ï¼›æ‰”ï¼›æ‹‰ä¸‹å¸½è¾¹ï¼›é£˜åŠ¨<br>547, flat  [flÃ¦t]<br>adj. å¹³çš„ï¼›å•è°ƒçš„ï¼›ä¸æ™¯æ°”çš„ï¼›å¹²è„†çš„ï¼›å¹³å¦çš„ï¼›æ‰å¹³çš„ï¼›æµ…çš„;<br>adv. ï¼ˆå°¤æŒ‡è´´ç€å¦ä¸€è¡¨é¢ï¼‰å¹³ç›´åœ°ï¼›æ–­ç„¶åœ°ï¼›æ°´å¹³åœ°ï¼›ç›´æ¥åœ°ï¼Œå®Œå…¨åœ°;<br>n. å¹³åœ°ï¼›å…¬å¯“ï¼›å¹³é¢;<br>vt. ä½¿å˜å¹³ï¼›[éŸ³ä¹]ä½¿ï¼ˆéŸ³è°ƒï¼‰ä¸‹é™ï¼Œå°¤æŒ‡é™åŠéŸ³;<br>vi. é€æ¸å˜å¹³ï¼›[éŸ³ä¹]ä»¥é™è°ƒå”±ï¼ˆæˆ–å¥ï¼‰;<br>n. ï¼ˆæ³•ï¼‰å¼—æ‹‰ç‰¹ï¼ˆäººåï¼‰ï¼›ï¼ˆè‹±ï¼‰å¼—è±ç‰¹ï¼ˆäººåï¼‰<br>548, flatten  [â€˜flÃ¦tn]<br>vt. å‡»è´¥ï¼Œæ‘§æ¯ï¼›ä½¿â€¦â€¦å¹³å¦ vi. å˜å¹³ï¼›å˜å•è°ƒ n. (Flatten)äººåï¼›(å¾·)å¼—æ‹‰æ»•<br>549, flatter  [â€˜flÃ¦tÉ™]<br>vt. å¥‰æ‰¿ï¼›è°„åªšï¼›ä½¿é«˜å…´<br>550, flavors<br>n. é£å‘³è°ƒæ–™ï¼ˆflavorå¤æ•°ï¼‰<br>v. æ·»åŠ å‘³é“ï¼ˆflavorçš„ä¸‰å•å½¢å¼ï¼‰<br>551, flavour<br>n. é¦™å‘³ï¼›æ»‹å‘³<br>vt. ç»™â€¦â€¦è°ƒå‘³ï¼›ç»™â€¦â€¦å¢æ·»é£è¶£<br>552, fledged  [fledÊ’d]<br>adj. æˆç†Ÿçš„ï¼›å¿«ä¼šé£çš„ï¼›ç¾½æ¯›ä¸°æ»¡çš„<br>553, flood  [flÊŒd]<br>vt. æ·¹æ²¡ï¼›å……æ»¡ï¼›æº¢å‡º<br>vi. æ¶Œå‡ºï¼›æ¶Œè¿›ï¼›ä¸ºæ°´æ·¹æ²¡<br>n. æ´ªæ°´ï¼›æ³›æ»¥ï¼›ä¸€å¤§æ‰¹<br>n. (Flood)äººåï¼›(è‹±)å¼—å‹’å¾·ï¼›(ç‘å…¸ã€èŠ¬)å¼—æ´›å¾·<br>554, fluent  [â€˜fluÉ™nt]<br>adj. æµç•…çš„ï¼Œæµåˆ©çš„ï¼›æ¶²æ€çš„ï¼›ç•…æµçš„<br>555, flute  [fluËt]<br>n. é•¿ç¬›ï¼›ã€å·¥ç¨‹è®¾è®¡ã€‘(åˆ€å…·çš„)å‡ºå±‘æ§½<br>vt. ç”¨é•¿ç¬›å¹å¥<br>vi. å¹é•¿ç¬›<br>556, forcibly  [â€˜fÉ”ËsÉªblÉª]<br>adv. ç”¨åŠ›åœ°ï¼›å¼ºåˆ¶åœ°ï¼›æœ‰è¯´æœåŠ›åœ°<br>557, foremost  [â€˜fÉ”ËmÉ™ÊŠst]<br>adj. æœ€é‡è¦çš„ï¼›æœ€å…ˆçš„<br>adv. é¦–å…ˆï¼›å±…äºé¦–ä½åœ°<br>558, forges<br>n. è½»ä¾¿é”»ç‚‰ï¼›ç†”ç‚‰ï¼ˆforgeçš„å¤æ•°ï¼‰</p><p>v. ä¼ªé€ ï¼ˆforgeçš„ç¬¬ä¸‰äººç§°å•æ•°ï¼‰ï¼›æ‰“åˆ¶</p><p>n. (Forges)äººåï¼›(æ³•)ç¦å°”çƒ­<br>559, fork  [fÉ”Ëk]<br>n. å‰ï¼›é¤å‰ï¼›è€™;<br>vt. å‰èµ·ï¼›ä½¿æˆå‰çŠ¶;<br>vi. åˆ†å‰ï¼›åˆ†æ­§;<br>n. (Fork)äººåï¼›(è‹±ã€å¾·)ç¦å…‹<br>560, formerly  [â€˜fÉ”ËmÉ™lÉª]<br>adv. ä»¥å‰ï¼›åŸæ¥<br>561, Fortress  [â€˜fÉ”ËtrÉªs]<br>n. å ¡å’ï¼›è¦å¡;<br>vt. ç­‘è¦å¡ï¼›ä»¥è¦å¡é˜²å®ˆ<br>562, Forwarding  [â€˜fÉ”ËwÉ™dÉªÅ‹]<br>v. ä¿ƒè¿›ï¼›å¯„å‘ï¼›è£…è®¢ï¼›è½¬é€’ï¼ˆforwardçš„ingå½¢å¼ï¼‰;<br>n. è½¬å‘ï¼›ä¿ƒè¿›ï¼›è¿è¾“ä¸šåŠ¡ï¼›å„é¡¹è£…è®¢å·¥åº;<br>adj. è¿è¾“çš„ï¼›è½¬å‘çš„<br>563, foundry  [â€˜faÊŠndri]<br>n. é“¸é€ ï¼Œé“¸é€ ç±»ï¼›[æœº] é“¸é€ å‚<br>564, fractional  [â€˜frÃ¦kÊƒÉ™nl]<br>adj. éƒ¨åˆ†çš„ï¼›[æ•°] åˆ†æ•°çš„ï¼Œå°æ•°çš„<br>565, fragile  [â€˜frÃ¦dÊ’É™l]<br>adj. è„†çš„ï¼›æ˜“ç¢çš„<br>566, fragments  [â€˜frÃ¦gmÉ™nt]<br>n. ç¢ç‰‡ï¼ˆfragmentçš„å¤æ•°ï¼‰ï¼›ç‰‡æ–­ï¼›[è®¡] åˆ†æ®µ;<br>v. ç ´ç¢ï¼ˆfragmentçš„ä¸‰å•å½¢å¼ï¼‰ï¼›æ‰“ç¢<br>567, frequency  [â€˜frikwÉ™nsi]<br>n. é¢‘ç‡ï¼›é¢‘ç¹<br>568, fresh  [freÊƒ]<br>adj. æ–°é²œçš„ï¼›æ¸…æ–°çš„ï¼›æ·¡æ°´çš„ï¼›æ— ç»éªŒçš„;<br>n. å¼€å§‹ï¼›æ–°ç”Ÿï¼›æ³›æ»¥;<br>adv. åˆšåˆšï¼Œæ‰ï¼›æœ€æ–°åœ°<br>569, frugal  [â€˜fruËg(É™)l]<br>adj. èŠ‚ä¿­çš„ï¼›æœ´ç´ çš„ï¼›èŠ±é’±å°‘çš„<br>570, frustrate  [frÊŒâ€™streÉªt; â€˜frÊŒs-]<br>vt. æŒ«è´¥ï¼›é˜»æŒ ï¼›ä½¿æ„Ÿåˆ°ç°å¿ƒ;<br>vi. å¤±è´¥ï¼›å—æŒ«;<br>adj. æŒ«è´¥çš„ï¼›æ— ç›Šçš„<br>571, fudge  [fÊŒdÊ’]<br>n. è½¯ç³–ï¼›èƒ¡è¯´ï¼›è°è¯<br>vt. æé€ ï¼›ç²—åˆ¶æ»¥é€ ï¼›å›é¿<br>vi. é€ƒé¿è´£ä»»ï¼›æ¬ºéª—ï¼›è’™æ··<br>int. èƒ¡è¯´å…«é“ï¼<br>n. (Fudge)äººåï¼›(è‹±)å¯Œå¥‡<br>572, functionality  [fÊŒÅ‹kÊƒÉ™â€™nÃ¦lÉ™tÉª]<br>n. åŠŸèƒ½ï¼›[æ•°] æ³›å‡½æ€§ï¼Œå‡½æ•°æ€§<br>573, fundamental  [fÊŒndÉ™â€™ment(É™)l]<br>adj. åŸºæœ¬çš„ï¼Œæ ¹æœ¬çš„<br>n. åŸºæœ¬åŸç†ï¼›åŸºæœ¬åŸåˆ™<br>574, fuzzy  [â€˜fÊŒzi]<br>adj. æ¨¡ç³Šçš„ï¼›å¤±çœŸçš„ï¼›æœ‰ç»’æ¯›çš„<br>n. (Fuzzy)äººåï¼›(è‹±)å¯Œé½<br>[ æ¯”è¾ƒçº§:fuzzier æœ€é«˜çº§:fuzziest ]<br>575, gain  [geÉªn]<br>n. å¢åŠ ï¼›åˆ©æ¶¦ï¼›æ”¶è·;<br>vt. è·å¾—ï¼›å¢åŠ ï¼›èµšåˆ°;<br>vi. å¢åŠ ï¼›è·åˆ©;<br>n. (Gain)äººåï¼›(è‹±ã€åŒˆã€æ³•)ç›–æ©<br>576, gauge  [gedÊ’]<br>n. è®¡é‡å™¨ï¼›æ ‡å‡†å°ºå¯¸ï¼›å®¹é‡è§„æ ¼<br>vt. æµ‹é‡ï¼›ä¼°è®¡ï¼›ç»™â€¦å®šè§„æ ¼<br>577, gear  [É¡Éªr]<br>n. é½¿è½®ï¼›è£…ç½®ï¼Œå·¥å…·ï¼›ä¼ åŠ¨è£…ç½® vi. é€‚åˆï¼›æ­ä¸Šé½¿è½®ï¼›å¼€å§‹å·¥ä½œ vt. å¼€åŠ¨ï¼›æ­ä¸Šé½¿è½®ï¼›ä½¿â€¦â€¦é€‚åˆï¼›ä½¿â€¦â€¦å‡†å¤‡å¥½ adj. å¥½æäº† n. (Gear)äººåï¼›(è‹±)å‰å°”<br>578, gem  [dÊ’É›m]<br>n. å®çŸ³ï¼Œçå®ï¼› ç²¾åï¼›å—äººé‡è§†è€…<br>vi. ç‚¹ç¼€ï¼› ç”¨å®çŸ³è£…é¥°ï¼› é¥°ä»¥å®çŸ³<br>adj. æœ€ä½³å“è´¨çš„<br>n. (Gem)äººåï¼›(è‹±)æ°å§†<br>579, geographically  [dÊ’ÉªÉ™â€™grÃ¦fÉªkli]<br>adv. åœ¨åœ°ç†ä¸Šï¼›åœ°ç†å­¦ä¸Š<br>580, gigabytes<br>n. åƒå…†å­—èŠ‚ï¼ˆgigabyteçš„å¤æ•°ï¼‰ï¼›åäº¿ä½å…ƒç»„<br>581, glimpse  [glÉªm(p)s]<br>n. ä¸€ç¥ï¼Œä¸€çœ‹</p><p>vi. ç¥è§</p><p>vt. ç¥è§<br>582, glossary  [â€˜glÉ’s(É™)rÉª]<br>n. æœ¯è¯­ï¼ˆç‰¹æ®Šç”¨è¯­ï¼‰è¡¨ï¼›è¯æ±‡è¡¨ï¼›ä¸“ä¸šè¯å…¸<br>583, glossed  [glÉ’s]<br>n. å…‰å½©ï¼›æ³¨é‡Šï¼›å‡è±¡;<br>vt. ä½¿å…‰å½©ï¼›æ©ç›–ï¼›æ³¨é‡Š;<br>n. (Gloss)äººåï¼›(å¾·ã€è¥¿ã€æ·)æ ¼æ´›æ–¯<br>584, goals  [gÉ™ÊŠlz]<br>n. ç›®æ ‡ï¼Œ[å¿ƒç†] ç›®çš„ï¼›è¿›çƒï¼Œå°„ä¸­æ¬¡æ•°<br>585, gradient  [â€˜greÉªdÉªÉ™nt]<br>n. [æ•°][ç‰©] æ¢¯åº¦ï¼›å¡åº¦ï¼›å€¾æ–œåº¦;<br>adj. å€¾æ–œçš„ï¼›æ­¥è¡Œçš„<br>586, gradients<br>n. æ¸å˜ï¼Œ[æ•°][ç‰©] æ¢¯åº¦ï¼ˆgradientå¤æ•°å½¢å¼ï¼‰<br>587, gradually  [â€˜grÃ¦dÊ’ÊŠÉ™li]<br>adv. é€æ­¥åœ°ï¼›æ¸æ¸åœ°<br>588, grant  [grÉ‘Ënt]<br>vt. æˆäºˆï¼›å…è®¸ï¼›æ‰¿è®¤</p><p>vi. åŒæ„</p><p>n. æ‹¨æ¬¾ï¼›[æ³•] æˆäºˆç‰©</p><p>n. (Grant)äººåï¼›(ç‘å…¸ã€è‘¡ã€è¥¿ã€ä¿„ã€ç½—ã€è‹±ã€å¡ã€å¾·ã€æ„)æ ¼å…°ç‰¹ï¼›(æ³•)æ ¼æœ—<br>589, granularity<br>n. é—´éš”å°ºå¯¸ï¼Œ[å²©] ç²’åº¦<br>590, graphical  [â€˜grÃ¦fÉªk(É™)l]<br>adj. å›¾è§£çš„ï¼›ç»˜ç”»çš„ï¼›ç”ŸåŠ¨çš„<br>591, greedy  [â€˜griËdÉª]<br>adj. è´ªå©ªçš„ï¼›è´ªåƒçš„ï¼›æ¸´æœ›çš„<br>592, grep  [grep]<br>n. UNIXå·¥å…·ç¨‹åºï¼›å¯åšæ–‡ä»¶å†…çš„å­—ç¬¦ä¸²æŸ¥æ‰¾;<br>n. (Grep)äººåï¼›(è‹é‡Œ)æ ¼é›·æ™®<br>593, grok  [É¡rÉ‘k]<br>vt. å‡­ç›´è§‰æ·±åˆ»äº†è§£ï¼›æ¬£èµï¼›ç¥äº¤<br>vi. å¿ƒæ„ç›¸é€šï¼›ä¸â€¦ç¥äº¤<br>594, gross  [É¡ros]<br>adj. æ€»å…±çš„ï¼›ç²—é‡çš„ï¼›æ¶åŠ£çš„ï¼›æ˜¾è€Œæ˜“è§çš„<br>vt. æ€»å…±æ”¶å…¥<br>n. æ€»é¢ï¼Œæ€»æ•°<br>n. (Gross)äººåï¼›(è‹±ã€æ³•ã€å¾·ã€æ„ã€è‘¡ã€è¥¿ã€ä¿„ã€èŠ¬ã€ç½—ã€æ·ã€åŒˆ)æ ¼ç½—æ–¯<br>595, grumpy  [â€˜É¡rÊŒmpi]<br>adj. è„¾æ°”æš´èºçš„ï¼›æ€§æƒ…ä¹–æˆ¾çš„<br>n. è„¾æ°”åçš„äººï¼›çˆ±æŠ±æ€¨çš„äºº<br>596, guarantee  [,É¡Ã¦rÉ™nâ€™ti]<br>n. ä¿è¯ï¼›æ‹…ä¿ï¼›ä¿è¯äººï¼›ä¿è¯ä¹¦ï¼›æŠµæŠ¼å“<br>vt. ä¿è¯ï¼›æ‹…ä¿<br>597, guaranteed  [â€˜gÃ¦rÉ™nâ€™tid]<br>adj. æœ‰ä¿è¯çš„ï¼Œï¼›æœ‰äººæ‹…ä¿çš„;<br>v. æ‹…ä¿ï¼ˆguaranteeçš„è¿‡å»å¼å’Œè¿‡å»åˆ†è¯ï¼‰<br>598, guide  [gaÉªd]<br>n. æŒ‡å—ï¼›å‘å¯¼ï¼›å…¥é—¨ä¹¦;<br>vt. å¼•å¯¼ï¼›å¸¦é¢†ï¼›æ“çºµ;<br>vi. æ‹…ä»»å‘å¯¼;<br>n. (Guide)äººåï¼›(æ³•ã€è‘¡)å‰å¾·<br>599, Guvnor  [â€˜É¡ÊŒvnÉ™]<br>n. é›‡ä¸»ï¼›è€æ¿<br>600, gym  [dÊ’Éªm]<br>n. å¥èº«æˆ¿ï¼›ä½“è‚²ï¼›ä½“è‚²é¦†<br>601, hall  [hÉ”Ël]<br>n. è¿‡é“ï¼Œé—¨å…ï¼Œèµ°å»Šï¼›ä¼šå ‚ï¼›é£Ÿå ‚ï¼›å­¦ç”Ÿå®¿èˆï¼›å¤§å…ï¼Œå‰å…ï¼›å¨±ä¹ä¸­å¿ƒï¼Œä¼šæ‰€;<br>n. ï¼ˆåœŸï¼‰å“ˆå‹’ï¼ˆäººåï¼‰ï¼›ï¼ˆå¾·ã€æ³¢ã€ä¸¹ã€èŠ¬ã€ç‘å…¸ï¼‰å“ˆå°”ï¼ˆäººåï¼‰ï¼›ï¼ˆè‹±ï¼‰éœå°”ï¼ˆäººåï¼‰ï¼›ï¼ˆæ³•ï¼‰é˜¿å°”ï¼ˆäººåï¼‰<br>602, hallway  [â€˜hÉ”ËlweÉª]<br>n. èµ°å»Šï¼›é—¨å…ï¼›ç„å…³<br>603, halted<br>v. åœæ­¢ï¼Œåœé¡¿ï¼ˆhaltçš„è¿‡å»å¼ï¼Œè¿‡å»åˆ†è¯ï¼‰<br>604, halve  [hÉ‘Ëv]<br>vt. äºŒç­‰åˆ†ï¼›æŠŠâ€¦â€¦å‡åŠ</p><p>n. (Halve)äººåï¼›(èŠ¬)å“ˆå°”éŸ¦<br>605, handlers  []<br>n. æ“ä½œè€…ï¼›ç»ç†äººï¼›é™¶å™¨å·¥äººï¼ˆhandlerçš„å¤æ•°ï¼‰<br>606, handshake  [â€˜hÃ¦n(d)ÊƒeÉªk]<br>n. æ¡æ‰‹<br>607, hashtag  [ËˆhÃ¦ÊƒËŒtÃ¦É¡]<br>n. æ ‡ç­¾<br>608, hazard  [â€˜hÃ¦zÉ™d]<br>vt. èµŒè¿æ°”ï¼›å†’â€¦çš„å±é™©ï¼Œä½¿é­å—å±é™©<br>n. å±é™©ï¼Œå†’é™©ï¼›å†’é™©çš„äº‹<br>n. (Hazard)äººåï¼›(æ³•)é˜¿æ‰å°”ï¼›(è‹±)å“ˆæ³½å¾·<br>609, headroom  [â€˜hedruËm; -rÊŠm]<br>n. å‡€ç©ºï¼›å‡€ç©ºé«˜åº¦ï¼›å¤´ä¸Šç©ºé—´<br>610, heap  [hiËp]<br>n. å †ï¼›è®¸å¤šï¼›ç´¯ç§¯;<br>vt. å †ï¼›å †ç§¯;<br>vi. å †èµ·æ¥;<br>n. (Heap)äººåï¼›(èŠ¬)æµ·äºšæ™®ï¼›(ä¸œå—äºšå›½å®¶åè¯­)åï¼›(è‹±)å¸Œæ™®<br>611, heck  [hek]<br>int.çœŸè§é¬¼ï¼ˆhellçš„å§”å©‰è¯´æ³•ï¼‰<br>n.é¥²è‰æ¶<br>n.(Heck)äººåï¼›(å¾·)é»‘å…‹ï¼›(è‘¡ã€è¥¿ã€æ³•)åŸƒå…‹ï¼›(è‹±)èµ«å…‹<br>612, Hence  [hens]<br>adv. å› æ­¤ï¼›ä»Šå<br>613, hereby  [hÉªÉ™â€™baÉª]<br>adv. ä»¥æ­¤æ–¹å¼ï¼Œæ®æ­¤ï¼›ç‰¹æ­¤<br>614, hesitant  [â€˜hÉ›zÉªtÉ™nt]<br>adj. è¿Ÿç–‘çš„ï¼›è¸Œèº‡çš„ï¼›çŠ¹è±«ä¸å®šçš„<br>615, hesitate  [ËˆhÉ›zÉ™tet]<br>vi. è¸Œèº‡ï¼ŒçŠ¹è±«ï¼›ä¸æ„¿<br>vt. è¸Œèº‡ï¼ŒçŠ¹è±«ï¼›æœ‰ç–‘è™‘ï¼Œä¸æ„¿æ„<br>616, heterogeneous  [,het(É™)rÉ™(ÊŠ)â€™dÊ’iËnÉªÉ™s; -â€˜dÊ’en-]<br>adj. [åŒ–å­¦] å¤šç›¸çš„ï¼›å¼‚ç§çš„ï¼›[åŒ–å­¦] ä¸å‡åŒ€çš„ï¼›ç”±ä¸åŒæˆåˆ†å½¢æˆçš„<br>617, heuristics  [hjuâ€™rÉªstÉªks]<br>n. å¯å‘æ³•ï¼›å¯å‘å¼æ•™å­¦æ³•<br>618, hexadecimal  [,hÉ›ksÉ™â€™dÉ›sÉªml]<br>adj. åå…­è¿›åˆ¶çš„<br>n. åå…­è¿›åˆ¶<br>619, hierarchical  [haÉªÉ™â€™rÉ‘ËkÉªk(É™)l]<br>adj. åˆ†å±‚çš„ï¼›ç­‰çº§ä½“ç³»çš„<br>620, hierarchy  [â€˜haÉªÉ™rÉ‘ËkÉª]<br>n. å±‚çº§ï¼›ç­‰çº§åˆ¶åº¦<br>621, hint  [hÉªnt]<br>n. æš—ç¤ºï¼›çº¿ç´¢<br>vt. æš—ç¤ºï¼›ç¤ºæ„<br>vi. ç¤ºæ„<br>n. (Hint)äººåï¼›(è‹±)æ¬£ç‰¹ï¼›(æ³•)å®‰ç‰¹<br>622, histogram  [â€˜hÉªstÉ™É¡rÃ¦m]<br>n. [ç»Ÿè®¡] ç›´æ–¹å›¾ï¼›æŸ±çŠ¶å›¾<br>623, hitchhiker  [â€˜hÉªtÊƒhaÉªkÉ™]<br>n. æ­ä¾¿è½¦çš„æ—…è¡Œè€…ï¼›é¡ºä¾¿æ’å…¥çš„å¹¿å‘Š<br>624, hive  [haÉªv]<br>vi. ç¾¤å±…ï¼›å…¥èœ‚æˆ¿ï¼›ç”Ÿæ´»åœ¨èœ‚æˆ¿ä¸­<br>n. èœ‚æˆ¿ï¼Œèœ‚å·¢ï¼›çƒ­é—¹çš„åœºæ‰€ï¼›ç†™æ”˜å–§é—¹çš„äººç¾¤<br>vt. å…¥èœ‚ç®±ï¼›è´®å¤‡<br>625, hoist  [hÉ’Éªst]<br>n. èµ·é‡æœºï¼›å‡èµ·ï¼ŒåŠèµ·;<br>vi. å‡èµ·ï¼›åŠèµ·;<br>vt. ï¼ˆç”¨ç»³ç´¢ï¼Œèµ·é‡æœºç­‰ï¼‰ä½¿å‡èµ·;<br>n. (Hoist)äººåï¼›(è‹±)éœä¼Šæ–¯ç‰¹<br>626, hole  [hÉ™ÊŠl]<br>n. æ´ï¼Œå­”ï¼›æ´ç©´ï¼Œç©´ï¼›çªç ´å£<br>vi. å‡¿æ´ï¼Œç©¿å­”ï¼›ï¼ˆé«˜å°”å¤«çƒç­‰ï¼‰è¿›æ´<br>vt. å‡¿æ´<br>n. (Hole)äººåï¼›(ç‘å…¸ã€æŒª)éœå‹’ï¼›(è‹±)éœå°”<br>627, holt  [holt]<br>n. å°æ—ï¼›æ—ä¸˜ï¼›æ‚æœ¨æ—<br>n. (Holt)äººåï¼›(è‹±ã€å¾·ã€ç½—ã€åŒˆã€ç‘å…¸)éœå°”ç‰¹ï¼›(æ³•ã€è¥¿)å¥¥å°”ç‰¹<br>628, homebrew  [homebrew]<br>n. è‡ªé…¿ï¼ˆå•¤ï¼‰é…’ï¼›å…¬å¸è‡ªäº§è‡ªç”¨<br>629, honestly  [â€˜É’nÉªstlÉª]<br>adv. çœŸè¯šåœ°ï¼›å…¬æ­£åœ°<br>630, hood  [hÊŠd]<br>n. å¤´å·¾ï¼›è¦†ç›–ï¼›å…œå¸½<br>n. (Hood)äººåï¼›(è‹±)èƒ¡å¾·ï¼›(å¾·ã€è·)éœå¾·<br>vt. ç½©ä¸Šï¼›ä»¥å¤´å·¾è¦†ç›–<br>631, hostile  [â€˜hÉ’staÉªl]<br>adj. æ•Œå¯¹çš„ï¼Œæ•Œæ–¹çš„ï¼›æ€€æ•Œæ„çš„;<br>n. æ•Œå¯¹<br>632, hourly  [â€˜aÊŠÉšli]<br>adv. æ¯å°æ—¶åœ°ï¼›é¢‘ç¹åœ°ï¼Œéšæ—¶<br>adj. æ¯å°æ—¶çš„ï¼Œä»¥é’Ÿç‚¹è®¡ç®—çš„ï¼›é¢‘ç¹çš„<br>633, hydrant  [â€˜haÉªdr(É™)nt]<br>n. æ¶ˆé˜²æ “ï¼›æ°´é¾™å¤´ï¼›ç»™æ°´æ “<br>634, ideally  [aÉªâ€™diÉ™li]<br>adv. ç†æƒ³åœ°ï¼›è§‚å¿µä¸Šåœ°<br>635, idempotent  [,aÉªdemâ€™pÉ™ÊŠt(É™)nt; aÉªâ€™dempÉ™t(É™)nt]<br>adj. å¹‚ç­‰çš„</p><p>n. [æ•°] å¹‚ç­‰<br>636, identify  [aÉªâ€™dentÉªfaÉª]<br>vt. ç¡®å®šï¼›é‰´å®šï¼›è¯†åˆ«ï¼Œè¾¨è®¤å‡ºï¼›ä½¿å‚ä¸ï¼›æŠŠâ€¦çœ‹æˆä¸€æ · vi. ç¡®å®šï¼›è®¤åŒï¼›ä¸€è‡´;<br>vi. ç¡®å®šï¼›è®¤åŒï¼›ä¸€è‡´<br>637, idiom  [â€˜ÉªdÉªÉ™m]<br>n. æˆè¯­ï¼Œä¹ è¯­ï¼›åœŸè¯<br>638, idiomatic  [,ÉªdÉªÉ™â€™mÃ¦tÉªk]<br>adj. æƒ¯ç”¨çš„ï¼›ç¬¦åˆè¯­è¨€ä¹ æƒ¯çš„ï¼›é€šé¡ºçš„<br>639, idle  [â€˜aÉªdl]<br>adj. é—²ç½®çš„ï¼›æ‡’æƒ°çš„ï¼›åœé¡¿çš„ vi. æ— æ‰€äº‹äº‹ï¼›è™šåº¦ï¼›ç©ºè½¬ vt. è™šåº¦ï¼›ä½¿ç©ºè½¬<br>640, Idle  [â€˜aÉªd(É™)l]<br>adj. é—²ç½®çš„ï¼›æ‡’æƒ°çš„ï¼›åœé¡¿çš„;<br>vi. æ— æ‰€äº‹äº‹ï¼›è™šåº¦ï¼›ç©ºè½¬;<br>vt. è™šåº¦ï¼›ä½¿ç©ºè½¬<br>641, ignite  [ÉªÉ¡â€™naÉªt]<br>vt. ç‚¹ç‡ƒï¼›ä½¿ç‡ƒçƒ§ï¼›ä½¿æ¿€åŠ¨<br>vi. ç‚¹ç«ï¼›ç‡ƒçƒ§<br>642, illegal  [Éªâ€™liËg(É™)l]<br>n. éæ³•ç§»æ°‘ï¼›é—´è°;adj. [æ³•] éæ³•çš„ï¼›è¿æ³•çš„ï¼›è¿åè§„åˆ™çš„<br>643, illustrate  [â€˜ÉªlÉ™streÉªt]<br>vi. ä¸¾ä¾‹<br>vt. é˜æ˜ï¼Œä¸¾ä¾‹è¯´æ˜ï¼›å›¾è§£<br>644, immutability  [immutability]<br>n. ä¸å˜ï¼›æ°¸æ’æ€§ï¼›ä¸å˜æ€§<br>645, immutable  [Éªâ€™mjuËtÉ™b(É™)l]<br>adj. ä¸å˜çš„ï¼›ä¸å¯å˜çš„ï¼›ä¸èƒ½å˜çš„<br>646, implement  [â€˜ÉªmplÉªm(É™)nt]<br>n. å·¥å…·ï¼Œå™¨å…·ï¼›æ‰‹æ®µ<br>vt. å®æ–½ï¼Œæ‰§è¡Œï¼›å®ç°ï¼Œä½¿ç”Ÿæ•ˆ<br>647, implementation  [ÉªmplÉªmenâ€™teÉªÊƒ(É™)n]<br>n. [è®¡] å®ç°ï¼›å±¥è¡Œï¼›å®‰è£…å¯ç”¨<br>648, implementing  []<br>n. å®æ–½ï¼Œæ‰§è¡Œï¼›å®ç°<br>v. è´¯å½»ï¼Œæ‰§è¡Œï¼ˆimplementçš„ç°åœ¨åˆ†è¯ï¼‰<br>649, implicit  [Éªmâ€™plÉªsÉªt]<br>adj. å«è“„çš„ï¼›æš—ç¤ºçš„ï¼›ç›²ä»çš„<br>650, inception  [Éªnâ€™sÉ›pÊƒÉ™n]<br>n. èµ·åˆï¼›è·å¾—å­¦ä½<br>n. ã€Šç›—æ¢¦ç©ºé—´ã€‹ï¼ˆç”µå½±åï¼‰<br>651, inconvenience  [ÉªnkÉ™nâ€™viËnÉªÉ™ns]<br>n. ä¸ä¾¿ï¼›éº»çƒ¦;<br>vt. éº»çƒ¦ï¼›æ‰“æ‰°<br>652, incorporate  [Éªnâ€™kÉ”ËpÉ™reÉªt]<br>vt. åŒ…å«ï¼Œå¸æ”¶ï¼›ä½“ç°ï¼›æŠŠâ€¦â€¦åˆå¹¶;<br>vi. åˆå¹¶ï¼›æ··åˆï¼›ç»„æˆå…¬å¸;<br>adj. åˆå¹¶çš„ï¼›ä¸€ä½“åŒ–çš„ï¼›ç»„æˆå…¬å¸çš„<br>653, incubator  [â€˜ÉªÅ‹kjÊŠbeÉªtÉ™]<br>n. [ç¦½] å­µåµå™¨ï¼›[å„¿ç§‘] ä¿æ¸©ç®±ï¼›æ—©äº§å„¿ä¿è‚²å™¨ï¼›ç»†èŒåŸ¹å…»å™¨<br>654, indicate  [â€˜ÉªndÉªkeÉªt]<br>vt. è¡¨æ˜ï¼›æŒ‡å‡ºï¼›é¢„ç¤ºï¼›è±¡å¾<br>655, indicating  [â€˜ÉªndÉªkeÉªtÉªÅ‹]<br>n. è¡¨æ˜ï¼›æŒ‡ç¤º<br>v. è¡¨æ˜ï¼›æŒ‡ç¤ºï¼›è¦æ±‚ï¼ˆindicateçš„ingå½¢å¼ï¼‰<br>adj. æŒ‡ç¤ºçš„<br>656, indicator  [â€˜ÉªndÉªketÉš]<br>n. æŒ‡ç¤ºå™¨ï¼›[è¯•å‰‚] æŒ‡ç¤ºå‰‚ï¼›[è®¡] æŒ‡ç¤ºç¬¦ï¼›å‹åŠ›è®¡<br>657, indice<br>n. æŒ‡æ•°ï¼›æ ‡è®°ä½“<br>658, individual  [ÉªndÉªâ€™vÉªdjÊŠ(É™)l]<br>adj. ä¸ªäººçš„ï¼›ä¸ªåˆ«çš„ï¼›ç‹¬ç‰¹çš„;<br>n. ä¸ªäººï¼Œä¸ªä½“<br>659, individually  [ËŒÉªndÉªËˆvÉªdÊ’uÉ™li]<br>adv. ä¸ªåˆ«åœ°ï¼Œå•ç‹¬åœ°<br>660, industry  [â€˜ÉªndÉ™strÉª]<br>n. äº§ä¸šï¼›å·¥ä¸šï¼›å‹¤å‹‰<br>661, inevitably  [Éªâ€™nevÉªtÉ™blÉª; Éªnâ€™evÉªtÉ™blÉª]<br>adv. ä¸å¯é¿å…åœ°ï¼›å¿…ç„¶åœ°<br>662, infection  [Éªnâ€™fÉ›kÊƒÉ™n]<br>n. æ„ŸæŸ“ï¼›ä¼ æŸ“ï¼›å½±å“ï¼›ä¼ æŸ“ç—…<br>663, infer  [Éªnâ€™fÉ]<br>vt. æ¨æ–­ï¼›æ¨è®º<br>vi. æ¨æ–­ï¼›ä½œå‡ºæ¨è®º<br>664, Infinite  [â€˜ÉªnfÉªnÉ™t]<br>adj. æ— é™çš„ï¼Œæ— ç©·çš„ï¼›æ— æ•°çš„ï¼›æå¤§çš„;<br>n. æ— é™ï¼›[æ•°] æ— ç©·å¤§ï¼›æ— é™çš„ä¸œè¥¿ï¼ˆå¦‚ç©ºé—´ï¼Œæ—¶é—´ï¼‰<br>665, infrastructure  [â€˜ÉªnfrÉ™strÊŒktÊƒÉ™]<br>n. åŸºç¡€è®¾æ–½ï¼›å…¬å…±å»ºè®¾ï¼›ä¸‹éƒ¨æ„é€ <br>666, ingest  [Éªnâ€™dÊ’est]<br>vt. æ‘„å–ï¼›å’½ä¸‹ï¼›å¸æ”¶ï¼›æ¥å¾…<br>667, ingress  [â€˜Éªngres]<br>n. è¿›å…¥ï¼›å…¥å£ï¼›å‡†è®¸è¿›å…¥ï¼›å…¥å¢ƒ<br>n. (Ingress)äººåï¼›(è‹±)è‹±æ ¼é›·æ–¯<br>668, inherently  [Éªnâ€™hÉªrÉ™ntli]<br>adv. å†…åœ¨åœ°ï¼›å›ºæœ‰åœ°ï¼›å¤©æ€§åœ°<br>669, inhibition  [Éªn(h)Éªâ€™bÉªÊƒ(É™)n]<br>n. æŠ‘åˆ¶ï¼›å‹æŠ‘ï¼›ç¦æ­¢<br>670, Initiative  [Éªâ€™nÉªÊƒÉªÉ™tÉªv; -ÊƒÉ™-]<br>n. ä¸»åŠ¨æƒï¼›é¦–åˆ›ç²¾ç¥;<br>adj. ä¸»åŠ¨çš„ï¼›è‡ªå‘çš„ï¼›èµ·å§‹çš„<br>671, initiator  [Éªâ€™nÉªÊƒÉªeÉªtÉ™]<br>n. å‘èµ·äººï¼Œåˆ›å§‹è€…ï¼›æ•™å¯¼è€…ï¼›[è®¡] å¯åŠ¨ç¨‹åºï¼›å¼•çˆ†å™¨<br>672, innocent  [â€˜ÉªnÉ™s(É™)nt]<br>adj. æ— è¾œçš„ï¼›æ— ç½ªçš„ï¼›æ— çŸ¥çš„<br>n. å¤©çœŸçš„äººï¼›ç¬¨è›‹<br>n. (Innocent)äººåï¼›(è‹±ã€è¥¿)å› è¯ºæ£®ç‰¹ï¼›(æ³•)ä¼Šè¯ºæ¡‘<br>673, inplace<br>n. åŸåœ°<br>674, insight  [â€˜ÉªnsaÉªt]<br>n. æ´å¯ŸåŠ›ï¼›æ´æ‚‰<br>n. (Insight)äººåï¼›(è‹±)å› èµ›ç‰¹<br>675, inspect  [Éªnâ€™spekt]<br>vt. æ£€æŸ¥ï¼›è§†å¯Ÿï¼›æ£€é˜…;<br>vi. è¿›è¡Œæ£€æŸ¥ï¼›è¿›è¡Œè§†å¯Ÿ<br>676, instant  [â€˜ÉªnstÉ™nt]<br>adj. ç«‹å³çš„ï¼›ç´§æ€¥çš„ï¼›ç´§è¿«çš„<br>n. ç¬é—´ï¼›ç«‹å³ï¼›ç‰‡åˆ»<br>677, instantaneous  [,ÉªnstÉ™nâ€™tenÉªÉ™s]<br>adj. ç¬é—´çš„ï¼›å³æ—¶çš„ï¼›çŒå‘çš„<br>678, instantiate  [Éªnâ€™stÃ¦nÊƒÉªeÉªt]<br>vt. ä¾‹ç¤ºï¼Œä¸¾ä¾‹è¯´æ˜<br>679, instrument  [â€˜ÉªnstrÊŠm(É™)nt]<br>n. ä»ªå™¨ï¼›å·¥å…·ï¼›ä¹å™¨ï¼›æ‰‹æ®µï¼›å™¨æ¢°<br>680, instrumental  [,ÉªnstrÉ™â€™mÉ›ntl]<br>adj. ä¹å™¨çš„ï¼›æœ‰å¸®åŠ©çš„ï¼›ä»ªå™¨çš„ï¼Œå™¨æ¢°çš„<br>n. å™¨ä¹æ›²ï¼›å·¥å…·å­—ï¼Œå·¥å…·æ ¼<br>681, insulation  [ÉªnsjÊŠâ€™leÉªÊƒ(É™)n]<br>n. ç»ç¼˜ï¼›éš”ç¦»ï¼Œå­¤ç«‹<br>682, intact  [Éªnâ€™tÃ¦kt]<br>adj. å®Œæ•´çš„ï¼›åŸå°ä¸åŠ¨çš„ï¼›æœªå—æŸä¼¤çš„<br>683, integrate  [â€˜ÉªntÉªgreÉªt]<br>vt. ä½¿â€¦å®Œæ•´ï¼›ä½¿â€¦æˆæ•´ä½“ï¼›æ±‚â€¦çš„ç§¯åˆ†ï¼›è¡¨ç¤ºâ€¦çš„æ€»å’Œ;<br>vi. æ±‚ç§¯åˆ†ï¼›å–æ¶ˆéš”ç¦»ï¼›æˆä¸ºä¸€ä½“;<br>adj. æ•´åˆçš„ï¼›å®Œå…¨çš„;<br>n. ä¸€ä½“åŒ–ï¼›é›†æˆä½“<br>684, integration  [ÉªntÉªâ€™greÉªÊƒ(É™)n]<br>n. é›†æˆï¼›ç»¼åˆ<br>685, Integration  [ÉªntÉªâ€™greÉªÊƒ(É™)n]<br>n. é›†æˆï¼›ç»¼åˆ<br>686, intense  [Éªnâ€™tÉ›ns]<br>adj. å¼ºçƒˆçš„ï¼›ç´§å¼ çš„ï¼›éå¸¸çš„ï¼›çƒ­æƒ…çš„<br>[ æ¯”è¾ƒçº§:more intenseæˆ– intenser æœ€é«˜çº§:most intenseæˆ– intensest ]<br>687, intent  [Éªnâ€™tent]<br>n. æ„å›¾ï¼›ç›®çš„ï¼›å«ä¹‰;<br>adj. ä¸“å¿ƒçš„ï¼›æ€¥åˆ‡çš„ï¼›åšå†³çš„<br>688, intention  [Éªnâ€™tenÊƒ(É™)n]<br>n. æ„å›¾ï¼›ç›®çš„ï¼›æ„å‘ï¼›æ„ˆåˆ<br>689, intentionally<br>adv. æ•…æ„åœ°ï¼Œæœ‰æ„åœ°<br>690, interacting  [,ÉªntÉ™â€™rÃ¦kt]<br>n. ç›¸äº’ä½œç”¨ï¼›ç›¸äº’åˆ¶çº¦;<br>v. äº’ç›¸å½±å“ï¼›äº’ç›¸ä½œç”¨ï¼ˆinteractçš„ingå½¢å¼ï¼‰<br>691, interaction  [ÉªntÉ™râ€™Ã¦kÊƒ(É™)n]<br>n. ç›¸äº’ä½œç”¨ï¼›[æ•°] äº¤äº’ä½œç”¨<br>n. äº’åŠ¨<br>interaction: ç›¸äº’ä½œç”¨  äº¤äº’  äº¤äº’ä½œç”¨<br>692, interactive  [ÉªntÉ™râ€™Ã¦ktÉªv]<br>adj. äº¤äº’å¼çš„ï¼›ç›¸äº’ä½œç”¨çš„<br>693, Interactive  [ÉªntÉ™râ€™Ã¦ktÉªv]<br>adj. äº¤äº’å¼çš„ï¼›ç›¸äº’ä½œç”¨çš„<br>694, intercept  [,ÉªntÉ™â€™sept]<br>vt. æ‹¦æˆªï¼›æˆªæ–­ï¼›çªƒå¬;<br>n. æ‹¦æˆªï¼›[æ•°] æˆªè·ï¼›æˆªè·çš„æƒ…æŠ¥<br>695, interference  [ÉªntÉ™â€™fÉªÉ™r(É™)ns]<br>n. å¹²æ‰°ï¼Œå†²çªï¼›å¹²æ¶‰<br>696, interleaving<br>n. [è®¡] äº¤é”™ï¼›äº¤å‰</p><p>v. æ’å…¥ï¼›[è®¡] äº¤å‰å­˜å–ï¼ˆinterleaveçš„ingå½¢å¼ï¼‰<br>697, Intermediate  [,ÉªntÉ™â€™miËdÉªÉ™t]<br>vi. èµ·åª’ä»‹ä½œç”¨;<br>adj. ä¸­é—´çš„ï¼Œä¸­çº§çš„;<br>n. [åŒ–å­¦] ä¸­é—´ç‰©ï¼›åª’ä»‹<br>698, internally<br>adv. å†…éƒ¨åœ°ï¼›å›½å†…åœ°ï¼›å†…åœ¨åœ°<br>699, Internationalization  [â€˜ÉªntÉ™,nÃ¦ÊƒÉ™nÉ™laÉªâ€™zeÉªÊƒÉ™n]<br>n. å›½é™…åŒ–<br>700, Interop<br>n. äº¤äº’æ“ä½œï¼›Interopè´¸æ˜“å±•ç¤ºä¼šï¼ˆæ¯å¹´åœ¨ç¾å›½ä¸¾åŠçš„å…¨çƒæœ€å¤§çš„ç½‘ç»œä¸“ä¸šå±•è§ˆä¼šï¼‰<br>701, Interoperability  [â€˜ÉªntÉ™r,É’pÉ™rÉ™â€™bÉªlÉ™tÉª]<br>n. [è®¡] äº’æ“ä½œæ€§ï¼›äº’ç”¨æ€§<br>702, interoperable<br>adj. å½¼æ­¤åä½œçš„ï¼›èƒ½å…±åŒæ“ä½œçš„ï¼›èƒ½å…±åŒä½¿ç”¨çš„<br>703, interpolate  [Éªnâ€™tÉpÉ™let]<br>vt. ç¯¡æ”¹ï¼›æ’å…¥æ–°è¯­å¥<br>vi. æ’å…¥ï¼›ç¯¡æ”¹<br>704, interpolation  [Éªn,tÉšpÉ™â€™leÊƒÉ™n]<br>n. æ’å…¥ï¼›ç¯¡æ”¹ï¼›æ·»å†™<br>705, Interpretable  [inâ€™tÉ™:prÉ™tÉ™bl]<br>adj. å¯è¯´æ˜çš„ï¼›å¯åˆ¤æ–­çš„ï¼›å¯ç¿»è¯‘çš„<br>706, interrupt  [ÉªntÉ™â€™rÊŒpt]<br>vt. ä¸­æ–­ï¼›æ‰“æ–­ï¼›æ’å˜´ï¼›å¦¨ç¢<br>vi. æ‰“æ–­ï¼›æ‰“æ‰°<br>n. ä¸­æ–­<br>707, interview  [â€˜ÉªntÉ™vjuË]<br>n. æ¥è§ï¼Œé‡‡è®¿ï¼›é¢è¯•ï¼Œé¢è°ˆ;<br>vt. é‡‡è®¿ï¼›æ¥è§ï¼›å¯¹â€¦è¿›è¡Œé¢è°ˆï¼›å¯¹æŸäººè¿›è¡Œé¢è¯•<br>708, intoxication  [Éªn,tÉ’ksÉªâ€™keÉªÊƒn]<br>n. [å†…ç§‘] ä¸­æ¯’ï¼›é™¶é†‰ï¼›å–é†‰<br>709, intrinsic  [Éªnâ€™trÉªnsÉªk]<br>adj. æœ¬è´¨çš„ï¼Œå›ºæœ‰çš„<br>710, introspection  [ÉªntrÉ™(ÊŠ)â€™spekÊƒ(É™)n]<br>n. å†…çœï¼›åçœ<br>711, introspective  [ÉªntrÉ™â€™spektÉªv]<br>adj. å†…çœçš„ï¼›åçœçš„<br>712, intuitive  [Éªnâ€™tuÉªtÉªv]<br>adj. ç›´è§‰çš„ï¼›å‡­ç›´è§‰è·çŸ¥çš„<br>713, intuitively  [Éªnâ€™tjÊŠÉªtÉªvli]<br>adv. ç›´è§‚åœ°ï¼›ç›´è§‰åœ°<br>714, invariant  [Éªnâ€™vÉ›rÉªÉ™nt]<br>adj. ä¸å˜çš„<br>n. [æ•°] ä¸å˜é‡ï¼›[è®¡] ä¸å˜å¼<br>715, invasive  [Éªnâ€™veÉªsÉªv]<br>adj. ä¾µç•¥æ€§çš„ï¼›æ”»å‡»æ€§çš„<br>716, inventory  [â€˜Éªnv(É™)nt(É™)rÉª]<br>n. å­˜è´§ï¼Œå­˜è´§æ¸…å•ï¼›è¯¦ç»†ç›®å½•ï¼›è´¢äº§æ¸…å†Œ<br>717, Inventory  [â€˜Éªnv(É™)nt(É™)rÉª]<br>n. å­˜è´§ï¼Œå­˜è´§æ¸…å•ï¼›è¯¦ç»†ç›®å½•ï¼›è´¢äº§æ¸…å†Œ<br>718, Inversion  [Éªnâ€™vÉœËÊƒ(É™)n]<br>n. å€’ç½®ï¼›åå‘ï¼›å€’è½¬<br>719, inverted  [Éªnâ€™vÉœËtÉªd]<br>adj. å€’è½¬çš„ï¼Œåå‘çš„<br>v. é¢ å€’ï¼ˆinvertçš„è¿‡å»åˆ†è¯ï¼‰ï¼›ä½¿â€¦åå‘<br>720, investigate  [Éªnâ€™vestÉªgeÉªt]<br>v. è°ƒæŸ¥ï¼›ç ”ç©¶<br>721, invitation  [ËŒÉªnvÉªËˆteÉªÊƒn]<br>n. é‚€è¯·ï¼›å¼•è¯±<br>722, invite  [Éªnâ€™vaÉªt]<br>vt. é‚€è¯·ï¼Œæ‹›å¾…ï¼›æ‹›è‡´;<br>n. é‚€è¯·<br>723, invocation  [,ÉªnvÉ™(ÊŠ)â€™keÉªÊƒ(É™)n]<br>n. ç¥ˆç¥·ï¼›ç¬¦å’’ï¼›ã€æ³•å¾‹ã€‘(æ³•é™¢å¯¹å¦æ¡ˆçš„)æ–‡ä»¶è°ƒå–ï¼›(æ³•æƒçš„)è¡Œä½¿<br>724, Invocation  [,ÉªnvÉ™(ÊŠ)â€™keÉªÊƒ(É™)n]<br>n. ç¥ˆç¥·ï¼›ç¬¦å’’<br>725, irrespective  [,ÉªrÉªâ€™spÉ›ktÉªv]<br>adj. æ— å…³çš„ï¼›ä¸è€ƒè™‘çš„ï¼›ä¸é¡¾çš„<br>726, iteration  [ÉªtÉ™â€™reÉªÊƒ(É™)n]<br>n.[æ•°] è¿­ä»£ï¼›åå¤ï¼›é‡å¤<br>727, iteratively  [â€˜itÉ™,reitivli]<br>adv. è¿­ä»£åœ°ï¼›åå¤åœ°<br>728, iterator  [ÉªtÉ™â€™retÉš]<br>n. è¿­ä»£å™¨ï¼›è¿­ä»£ç¨‹åº<br>729, Iterator  [ÉªtÉ™â€™reÉªtÉ™]<br>n. è¿­ä»£å™¨ï¼›è¿­ä»£ç¨‹åº<br>730, jet  [jÉ›t]<br>n. å–·å°„ï¼Œå–·å˜´ï¼›å–·æ°”å¼é£æœºï¼›é»‘ç‰<br>adj. å¢¨é»‘çš„<br>vt. å°„å‡º<br>vi. å°„å‡ºï¼›[èˆª] ä¹˜å–·æ°”å¼é£æœº<br>731, journal  [â€˜dÊ’ÉœËn(É™)l]<br>n. æ—¥æŠ¥ï¼Œæ‚å¿—ï¼›æ—¥è®°ï¼›åˆ†ç±»è´¦<br>732, Jumbotron  [â€˜dÊ’ÊŒmbÉ™utrÉ”n]<br>n. ç”µè§†æœºçš„è¶…å¤§å±å¹•<br>733, Kestrel  [â€˜kestr(É™)l]<br>n. ï¼ˆäº§äºæ¬§æ´²çš„ï¼‰èŒ¶éš¼<br>734, kick  [kÉªk]<br>n. è¸¢ï¼›åå†²ï¼Œååº§åŠ›<br>vt. è¸¢ï¼›åå†²ï¼Œæœååº§<br>vi. è¸¢ï¼›åå†²<br>n. (Kick)äººåï¼›(å¾·)åŸºå…‹<br>735, knobs<br>n. æŠŠæ‰‹ï¼ˆknobçš„å¤æ•°ï¼‰ï¼›å‡¸å²©<br>736, knuckle  [â€˜nÊŒk(É™)l]<br>n. å…³èŠ‚ï¼›æŒ‡å…³èŠ‚ï¼›æŒ‡èŠ‚ï¼›è†å…³èŠ‚ï¼›è‚˜<br>vi. å¼€å§‹è®¤çœŸå·¥ä½œ<br>vt. ç”¨æŒ‡å…³èŠ‚æ•²æ‰“<br>737, lack  [lÃ¦k]<br>vt. ç¼ºä¹ï¼›ä¸è¶³ï¼›æ²¡æœ‰ï¼›éœ€è¦;<br>vi. ç¼ºä¹ï¼›ä¸è¶³ï¼›æ²¡æœ‰;<br>n. ç¼ºä¹ï¼›ä¸è¶³;<br>n. (Lack)äººåï¼›(è€)æ‹‰ï¼›(è‹±ã€æ³•ã€æ„ã€è‘¡ã€åŒˆ)æ‹‰å…‹ï¼›(åŒˆ)æ´›å…‹<br>738, landscape  [â€˜lÃ¦n(d)skeÉªp]<br>n. é£æ™¯ï¼›é£æ™¯ç”»ï¼›æ™¯è‰²ï¼›å±±æ°´ç”»ï¼›ä¹¡æ‘é£æ™¯ç”»ï¼›åœ°å½¢ï¼›ï¼ˆæ–‡ä»¶çš„ï¼‰æ¨ªå‘æ‰“å°æ ¼å¼;<br>vt. å¯¹â€¦åšæ™¯è§‚ç¾åŒ–ï¼Œç»™â€¦åšå›­æ—ç¾åŒ–ï¼›ä»äº‹åº­å›­è®¾è®¡;<br>vi. ç¾åŒ–ï¼ˆç¯å¢ƒç­‰ï¼‰ï¼Œä½¿æ™¯è‰²å®œäººï¼›ä»äº‹æ™¯è§‚ç¾åŒ–å·¥ä½œï¼Œåšåº­å›­è®¾è®¡å¸ˆ<br>739, lane  [leÉªn]<br>n. å°å··ï¼›[èˆª][æ°´è¿] èˆªçº¿ï¼›è½¦é“ï¼›ç½šçƒåŒº<br>n. (Lane)äººåï¼›(è‹±ã€ä¿„)è±æ©ï¼›(è€)å…°ï¼›(å¾·ã€æ³•ã€æ„ã€è‘¡ã€å¡ã€ç‘å…¸)æ‹‰å†…<br>740, Lantern  [â€˜lÃ¦ntÉ™n]<br>n. ç¯ç¬¼ï¼›æç¯ï¼›ç¯ç¬¼å¼å¤©çª—<br>741, Laptops  []<br>ç¬”è®°æœ¬ç”µè„‘<br>742, lark  [lÉ‘Ëk]<br>n. äº‘é›€ï¼›ç™¾çµé¸Ÿï¼›æ¬¢ä¹<br>vi. éª‘é©¬ç©ä¹ï¼›å¬‰è€<br>vt. æ„šå¼„<br>n. (Lark)äººåï¼›(ä¸œå—äºšå›½å®¶åè¯­)å…­<br>743, latch  [lÃ¦tÊƒ]<br>vi. å æœ‰ï¼ŒæŠ“ä½ï¼›é—­é”<br>vt. é—©ä¸Šï¼›çº ç¼ ä½æŸäºº<br>n. é—¨é—©<br>n. (Latch)äººåï¼›(è‹±)æ‹‰å¥‡<br>744, Latch  [lÃ¦tÊƒ]<br>vi. å æœ‰ï¼ŒæŠ“ä½ï¼›é—­é”;<br>vt. é—©ä¸Šï¼›çº ç¼ ä½æŸäºº;<br>n. é—¨é—©;<br>n. (Latch)äººåï¼›(è‹±)æ‹‰å¥‡<br>745, latency  [â€˜letnsi]<br>n. æ½œä¼ï¼›æ½œåœ¨å› ç´ <br>746, latent  [â€˜letnt]<br>adj. æ½œåœ¨çš„ï¼›æ½œä¼çš„ï¼›éšè—çš„<br>747, launching  [â€˜lÉ”ËntÊƒÉªÅ‹]<br>n. å‘å°„ï¼›ä¸‹æ°´ï¼›åˆ›è®¾;<br>v. å‘å°„ï¼›å‘åŠ¨ï¼›å¼€å§‹ä»äº‹ï¼ˆlaunchçš„ingå½¢å¼ï¼‰<br>748, lean  [lin]<br>vi. å€¾æ–œï¼›å€šé ï¼›å€¾å‘ï¼›ä¾èµ–<br>adj. ç˜¦çš„ï¼›è´«ä¹çš„ï¼Œæ­‰æ”¶çš„<br>vt. ä½¿å€¾æ–œ<br>n. ç˜¦è‚‰ï¼›å€¾æ–œï¼›å€¾æ–œåº¦<br>n. (Lean)äººåï¼›(è¥¿)è±å®‰ï¼›(æŸ¬)è¿ï¼›(è‹±)åˆ©æ©<br>[ :è¿‡å»å¼leanedæˆ– leant è¿‡å»åˆ†è¯:leanedæˆ– leant ç°åœ¨åˆ†è¯:leaning ]<br>749, leap  [lip]<br>vi. è·³ï¼Œè·³è·ƒ<br>n. é£è·ƒï¼›è·³è·ƒ<br>vt. è·³è·ƒï¼Œè·³è¿‡ï¼›ä½¿è·ƒè¿‡<br>n. (Leap)äººåï¼›(æ³•)è±äºš<br>750, ledger  [â€˜ledÊ’É™]<br>n.æ€»è´¦ï¼Œåˆ†æˆ·æ€»è´¦ï¼›[ä¼šè®¡] åˆ†ç±»è´¦ï¼›è´¦ç°¿ï¼›åº•è´¦ï¼›ï¼ˆæ‰‹è„šæ¶ä¸Šçš„ï¼‰æ¨ªæœ¨<br>n.(Ledger)äººåï¼›(è‹±)è±æ°<br>751, legacy  [â€˜legÉ™sÉª]<br>n. é—èµ ï¼Œé—äº§<br>752, Legacy  [â€˜legÉ™sÉª]<br>n. é—èµ ï¼Œé—äº§<br>753, lenient  [â€˜liËnÉªÉ™nt]<br>adj. å®½å¤§çš„ï¼›ä»æ…ˆçš„</p><p>n. (Lenient)äººåï¼›(æ³•)å‹’å°¼å®‰<br>754, leverage  [â€˜lÉ›vÉ™rÉªdÊ’]<br>n. æ‰‹æ®µï¼Œå½±å“åŠ›ï¼›æ æ†ä½œç”¨ï¼›æ æ†æ•ˆç‡<br>v. åˆ©ç”¨ï¼›ä¸¾å€ºç»è¥<br>755, Lexical  [â€˜leksÉªk(É™)l]<br>adj. è¯æ±‡çš„ï¼›[è¯­] è¯å…¸çš„ï¼›è¯å…¸ç¼–çº‚çš„<br>756, lexicographically  </p><p>757, line up<br>æ’åˆ—èµ·ï¼›æ•´é˜Ÿ<br>758, linguistic  [lÉªÅ‹â€™gwÉªstÉªk]<br>adj. è¯­è¨€çš„ï¼›è¯­è¨€å­¦çš„<br>759, literal  [â€˜lÉªt(É™)r(É™)l]<br>adj. æ–‡å­—çš„ï¼›é€å­—çš„ï¼›æ— å¤¸å¼ çš„<br>760, loan  [lÉ™ÊŠn]<br>n. è´·æ¬¾ï¼›å€Ÿæ¬¾<br>vi. å€Ÿå‡º<br>vt. å€Ÿï¼›å€Ÿç»™<br>761, lobster  [â€˜lÉ’bstÉ™]<br>n. é¾™è™¾<br>é¾™è™¾è‚‰<br>762, lockup  [â€˜lÉ’kÊŒp]<br>n. æ‹˜ç•™æ‰€ï¼Œç›‘ç‹±ï¼›é”ä½ï¼›ç›‘ç¦<br>763, looks up  </p><p>764, lookup  [â€˜lÊŠkÊŒp]<br>n. æŸ¥æ‰¾ï¼›æ£€æŸ¥<br>765, loop  [luËp]<br>vi. æ‰“ç¯ï¼›ç¿»ç­‹æ–—;<br>n. ç¯ï¼›åœˆï¼›å¼¯æ›²éƒ¨åˆ†ï¼›ç¿»ç­‹æ–—;<br>vt. ä½¿æˆç¯ï¼›ä»¥ç¯è¿ç»“ï¼›ä½¿ç¿»ç­‹æ–—<br>766, Loop  [luËp]<br>vi. æ‰“ç¯ï¼›ç¿»ç­‹æ–—;<br>n. ç¯ï¼›åœˆï¼›å¼¯æ›²éƒ¨åˆ†ï¼›ç¿»ç­‹æ–—;<br>vt. ä½¿æˆç¯ï¼›ä»¥ç¯è¿ç»“ï¼›ä½¿ç¿»ç­‹æ–—<br>767, loopback  [loopback]<br>n. [è®¡] å›é€ï¼›å›è·¯<br>768, luggage  [â€˜lÊŒgÉªdÊ’]<br>n. è¡Œæï¼›çš®ç®±<br>769, lumberjack  [â€˜lÊŒmbÉ™dÊ’Ã¦k]<br>n. ä¼æœ¨å·¥äººï¼›æœ¨æå•†çš„ä½£å·¥ï¼›çŸ­èŒ„å…‹è¡«<br>770, macro  [â€˜mÃ¦kro]<br>adj. å·¨å¤§çš„ï¼Œå¤§é‡çš„<br>n. å®ï¼Œå·¨ï¼ˆè®¡ç®—æœºæœ¯è¯­ï¼‰<br>n. (Macro)äººåï¼›(æ„)é©¬å…‹ç½—<br>771, malformed  [,mÃ¦lâ€™fÉ”rmd]<br>adj. ç•¸å½¢çš„ï¼Œéš¾çœ‹çš„<br>772, malicious  [mÉ™â€™lÉªÊƒÉ™s]<br>adj. æ¶æ„çš„ï¼›æ¶æ¯’çš„ï¼›è“„æ„çš„ï¼›æ€€æ¨çš„<br>773, malware<br>n. æ¶æ„è½¯ä»¶<br>774, mandatory  [â€˜mÃ¦ndÉ™t(É™)rÉª]<br>adj. å¼ºåˆ¶çš„ï¼›æ‰˜ç®¡çš„ï¼›å‘½ä»¤çš„</p><p>n. å—æ‰˜è€…ï¼ˆç­‰äºmandataryï¼‰<br>775, manifest  [â€˜mÃ¦nÉªfest]<br>vt. è¯æ˜ï¼Œè¡¨æ˜ï¼›æ˜¾ç¤º<br>vi. æ˜¾ç¤ºï¼Œå‡ºç°<br>n. è½½è´§å•ï¼Œè´§å•ï¼›æ—…å®¢åå•<br>adj. æ˜¾ç„¶çš„ï¼Œæ˜æ˜¾çš„ï¼›æ˜ç™½çš„<br>776, manipulate  [mÉ™â€™nÉªpjÊŠleÉªt]<br>vt. æ“çºµï¼›æ“ä½œï¼›å·§å¦™åœ°å¤„ç†ï¼›ç¯¡æ”¹<br>777, Manipulation  [mÉ™,nÉªpjÊŠâ€™leÉªÊƒ(É™)n]<br>n. æ“çºµï¼›æ“ä½œï¼›å¤„ç†ï¼›ç¯¡æ”¹<br>778, manner  [â€˜mÃ¦nÉ™]<br>n. æ–¹å¼ï¼›ä¹ æƒ¯ï¼›ç§ç±»ï¼›è§„çŸ©ï¼›é£ä¿—;<br>n. (Manner)äººåï¼›(å¾·ã€èŠ¬ã€ç‘å…¸)æ›¼çº³<br>779, manufacture  [mÃ¦njÊŠâ€™fÃ¦ktÊƒÉ™]<br>n. åˆ¶é€ ï¼›äº§å“ï¼›åˆ¶é€ ä¸š<br>vt. åˆ¶é€ ï¼›åŠ å·¥ï¼›æé€ <br>vi. åˆ¶é€ <br>780, margin  [â€˜mÉ‘ËdÊ’Éªn]<br>n. è¾¹ç¼˜ï¼›åˆ©æ¶¦ï¼Œä½™è£•ï¼›é¡µè¾¹çš„ç©ºç™½;<br>vt. åŠ è¾¹äºï¼›åŠ æ—æ³¨äº;<br>n. (Margin)äººåï¼›(ä¿„ã€æ„)é©¬å°”é‡‘<br>781, marginally  [â€˜mÉ‘rdÊ’ÉªnÉ™li]<br>adv. å°‘é‡åœ°ï¼›æœ€ä½é™åº¦åœ°ï¼›åœ¨æ å¤–ï¼›åœ¨é¡µè¾¹<br>782, Markup  [â€˜mÉ‘ËkÊŒp]<br>n. æ¶¨ä»·ï¼›åˆ©æ¶¦ï¼›å®¡å®š;<br>n. (Markup)äººåï¼›(æ·ã€åŒˆ)é©¬å°”åº“æ™®<br>783, marshall<br>n. å…ƒå¸…ï¼›å…¸ç¤¼å®˜ï¼›æ‰§æ³•å®˜ï¼›æ³•å®˜çš„éšè¡Œå®˜å‘˜ï¼ˆç­‰äºjudgeâ€™s marshalï¼‰<br>vt. å®‰æ’ï¼›å¼•é¢†ï¼›ç»Ÿå¸…<br>vi. å„å°±å„ä½ï¼›æŒ‰æ¬¡åºæ’åˆ—æˆå½¢ï¼ˆç­‰äºmarshalï¼‰<br>784, marshalled  [marshalled]<br>æ•´ç†ï¼ˆmarshalçš„è¿‡å»å¼ä¸è¿‡å»åˆ†è¯å½¢å¼ï¼‰<br>ä½¿æ’åˆ—ï¼ˆmarshalçš„è¿‡å»å¼ä¸è¿‡å»åˆ†è¯å½¢å¼ï¼‰<br>785, maskable<br>adj. å¯å±è”½çš„<br>786, master  [â€˜mÉ‘ËstÉ™]<br>vt. æ§åˆ¶ï¼›ç²¾é€šï¼›å¾æœ;<br>n. ç¡•å£«ï¼›ä¸»äººï¼›å¤§å¸ˆï¼›æ•™å¸ˆ;<br>adj. ä¸»äººçš„ï¼›ä¸»è¦çš„ï¼›ç†Ÿç»ƒçš„;<br>n. (Master)äººåï¼›(è‹±)é©¬æ–¯ç‰¹<br>787, mate  [meÉªt]<br>n. åŠ©æ‰‹ï¼Œå¤§å‰¯ï¼›é…å¶ï¼›åŒäº‹ï¼›é…å¯¹ç‰©<br>vt. ä½¿é…å¯¹ï¼›ä½¿ä¸€è‡´ï¼›ç»“ä¼´<br>vi. äº¤é…ï¼›æˆé…å¶ï¼›ç´§å¯†é…åˆ<br>n. (Mate)äººåï¼›(æ—¥)è›(å§“)ï¼›(è¥¿ã€æ„ã€å¡)é©¬ç‰¹ï¼›(æ³¢é»‘)é©¬ç‰¹ï¼›(ç½—ã€ä¿„)é©¬æ³°<br>788, material  [mÉ™â€™tÉªrÉªÉ™l]<br>adj. é‡è¦çš„ï¼›ç‰©è´¨çš„ï¼Œå®è´¨æ€§çš„ï¼›è‚‰ä½“çš„<br>n. ææ–™ï¼ŒåŸæ–™ï¼›ç‰©èµ„ï¼›å¸ƒæ–™<br>789, matrix  [â€˜metrÉªks]<br>n. [æ•°] çŸ©é˜µï¼›æ¨¡å‹ï¼›[ç”Ÿç‰©][åœ°è´¨] åŸºè´¨ï¼›æ¯ä½“ï¼›å­å®«ï¼›[åœ°è´¨] è„‰çŸ³<br>790, Matrix  [â€˜meÉªtrÉªks]<br>n. [æ•°] çŸ©é˜µï¼›æ¨¡å‹ï¼›[ç”Ÿç‰©][åœ°è´¨] åŸºè´¨ï¼›æ¯ä½“ï¼›å­å®«ï¼›[åœ°è´¨] è„‰çŸ³<br>791, mean  [min]<br>adj. å¹³å‡çš„ï¼›å‘é„™çš„ï¼›ä½åŠ£çš„ï¼›åå•¬çš„<br>vt. æ„å‘³ï¼›æƒ³è¦ï¼›æ„æ¬²<br>n. å¹³å‡å€¼<br>vi. ç”¨æ„<br>n. (Mean)äººåï¼›(æŸ¬)æ£‰<br>792, Measurable  [â€˜meÊ’(É™)rÉ™b(É™)l]<br>adj. å¯æµ‹é‡çš„ï¼›é‡è¦çš„ï¼›é‡å¤§çš„<br>793, mechanism  [â€˜mek(É™)nÉªz(É™)m]<br>n. æœºåˆ¶ï¼›åŸç†ï¼Œé€”å¾„ï¼›è¿›ç¨‹ï¼›æœºæ¢°è£…ç½®ï¼›æŠ€å·§<br>794, mechanisms  [â€˜mÉ›kÉ™nÉªzÉ™mz]<br>n. æœºåˆ¶ï¼›[æœº] æœºæ„ï¼ˆmechanismçš„å¤æ•°ï¼‰ï¼›æœºæ¢°ï¼›[æœº] æœºæ„å­¦<br>795, median  [â€˜midÉªÉ™n]<br>n. n. ä¸­å€¼ï¼Œä¸­ä½æ•°ï¼›ä¸‰è§’å½¢ä¸­çº¿ï¼›æ¢¯å½¢ä¸­ä½çº¿<br>adj. ä¸­å€¼çš„ï¼›ä¸­å¤®çš„<br>n. (Median)äººåï¼›(é˜¿æ‹‰ä¼¯)è¿ˆè¿ªå®‰ï¼›(ç½—)æ¢…è¿ªå®‰<br>796, mediocre  [,miËdÉªâ€™É™ÊŠkÉ™]<br>adj. æ™®é€šçš„ï¼›å¹³å‡¡çš„ï¼›ä¸­ç­‰çš„<br>797, mediocrity  [miËdÉªâ€™É’krÉªtÉª]<br>n. å¹³åº¸ä¹‹æ‰ï¼›å¹³å¸¸<br>798, mega  [â€˜mÉ›É¡É™]<br>n. ç™¾ä¸‡<br>adj. è®¸å¤šï¼›å®å¤§çš„<br>adv. éå¸¸<br>n. (Mega)äººåï¼›(è‘¡ã€æ„ã€æ·ã€å¡)æ¢…åŠ <br>799, megabyte  [â€˜megÉ™baÉªt]<br>n. [è®¡] å…†å­—èŠ‚<br>800, melon  [â€˜melÉ™n]<br>n. ç“œï¼›ç”œç“œï¼›å¤§è‚šå­ï¼›åœ†é¼“é¼“åƒç“œä¼¼çš„ä¸œè¥¿</p><p>n. (Melon)äººåï¼›(æ„ã€è¥¿ã€è‘¡)æ¢…éš†<br>801, memorization  [,mÉ›mÉ™rÉªâ€™zeÊƒÉ™n]<br>n. è®°ä½ï¼›æš—è®°<br>802, mentor  [â€˜mÉ›nâ€™tÉ”r]<br>n. æŒ‡å¯¼è€…ï¼Œè‰¯å¸ˆç›Šå‹;<br>vt. æŒ‡å¯¼<br>803, merchant  [â€˜mÉtÊƒÉ™nt]<br>n. å•†äººï¼Œæ‰¹å‘å•†ï¼›åº—ä¸»<br>adj. å•†ä¸šçš„ï¼Œå•†äººçš„<br>n. (Merchant)äººåï¼›(è‹±)éº¦é’±ç‰¹<br>804, merry  [â€˜mÉ›ri]<br>adj. æ„‰å¿«çš„ï¼›å¾®é†‰çš„ï¼›å¬‰æˆä½œä¹çš„ n. ç”œæ¨±æ¡ƒ n. (Merry)äººåï¼›(è‹±ã€æ³•ã€è¥¿)æ¢…é‡Œ<br>805, mesh  [mÉ›Êƒ]<br>n. ç½‘çœ¼ï¼›ç½‘ä¸ï¼›åœˆå¥—<br>vi. ç›¸å•®åˆ<br>vt. [æœº] å•®åˆï¼›ä»¥ç½‘æ•æ‰<br>806, mess  [mes]<br>n.æ··ä¹±ï¼›é£Ÿå ‚ï¼Œä¼™é£Ÿå›¢ï¼›å›°å¢ƒï¼›è„ä¹±çš„ä¸œè¥¿<br>vt.å¼„ä¹±ï¼Œå¼„è„ï¼›æ¯åï¼›ä½¿å°±é¤<br>vi.æŠŠäº‹æƒ…å¼„ç³Ÿï¼›åˆ¶é€ è„ä¹±ï¼›ç©å¼„<br>n.(Mess)äººåï¼›(å¾·ã€ç½—)æ¢…æ–¯<br>807, messy  [â€˜mesÉª]<br>adj. å‡Œä¹±çš„ï¼Œæ•£ä¹±çš„ï¼›è‚®è„çš„ï¼Œæ±¡ç§½çš„ï¼›éº»çƒ¦çš„<br>808, metric  [â€˜mÉ›trÉªk]<br>adj. å…¬åˆ¶çš„ï¼›ç±³åˆ¶çš„ï¼›å…¬å°ºçš„<br>n. åº¦é‡æ ‡å‡†<br>809, metrics  [â€˜mÉ›trÉªks]<br>n. åº¦é‡ï¼›ä½œè¯—æ³•ï¼›éŸµå¾‹å­¦<br>810, Metrics  [â€˜metrÉªks]<br>n. åº¦é‡ï¼›ä½œè¯—æ³•ï¼›éŸµå¾‹å­¦<br>811, migrate  [maÉªâ€™greÉªt; â€˜maÉªgreÉªt]<br>vi. ç§»åŠ¨ï¼›éšå­£èŠ‚è€Œç§»å±…ï¼›ç§»å¾€<br>vt. ä½¿ç§»å±…ï¼›ä½¿ç§»æ¤<br>812, Migrate  [maÉªâ€™greÉªt; â€˜maÉªgreÉªt]<br>vi. ç§»åŠ¨ï¼›éšå­£èŠ‚è€Œç§»å±…ï¼›ç§»å¾€;<br>vt. ä½¿ç§»å±…ï¼›ä½¿ç§»æ¤<br>813, migration  [maÉªâ€™greÉªÊƒ(É™)n]<br>n. è¿ç§»ï¼›ç§»æ°‘ï¼›ç§»åŠ¨<br>814, milestones<br>n. é‡Œç¨‹ç¢‘ï¼›æ—¶é—´è¡¨<br>815, mimic  [â€˜mÉªmÉªk]<br>vt. æ¨¡ä»¿ï¼Œæ‘¹æ‹Ÿ<br>n. æ•ˆé¢¦è€…ï¼Œæ¨¡ä»¿è€…ï¼›ä»¿åˆ¶å“ï¼›å°ä¸‘<br>adj. æ¨¡ä»¿çš„ï¼Œæ¨¡æ‹Ÿçš„ï¼›å‡è£…çš„<br>816, mind  [maÉªnd]<br>n. ç†æ™ºï¼Œç²¾ç¥ï¼›æ„è§ï¼›æ™ºåŠ›ï¼›è®°å¿†åŠ›<br>vt. ä»‹æ„ï¼›ä¸“å¿ƒäºï¼›ç…§æ–™<br>vi. ä»‹æ„ï¼›æ³¨æ„<br>817, minify  [â€˜mÉªnÉªfaÉª]<br>vt. ä½¿å˜å°ï¼›è´¬ä½<br>818, minor  [â€˜maÉªnÉ™]<br>adj. æœªæˆå¹´çš„ï¼›æ¬¡è¦çš„ï¼›è¾ƒå°çš„ï¼›å°è°ƒçš„ï¼›äºŒæµçš„;<br>n. æœªæˆå¹´äººï¼›å°è°ƒï¼›å‰¯ä¿®ç§‘ç›®;<br>vi. å‰¯ä¿®;<br>n. (Minor)äººåï¼›(è‹±)è¿ˆçº³ï¼›(å¾·ã€æ³•ã€æ³¢ã€ä¿„)ç±³è¯ºå°”<br>819, Misc  [â€˜mÉªsk]<br>abbr. æ··æ‚çš„ï¼›å„è‰²å„æ ·æ··åœ¨ä¸€èµ·ï¼›å¤šæ‰å¤šè‰ºçš„ï¼ˆmiscellaneousï¼‰<br>820, miscellaneous  [â€˜mÉªsÉ™â€™lenÉªÉ™s]<br>adj. æ··æ‚çš„ï¼Œå„ç§å„æ ·çš„ï¼›å¤šæ–¹é¢çš„ï¼Œå¤šæ‰å¤šè‰ºçš„<br>821, misconception  [mÉªskÉ™nâ€™sepÊƒ(É™)n]<br>n. è¯¯è§£ï¼›é”™è§‰ï¼›é”™è¯¯æƒ³æ³•<br>822, misfire  [â€˜mÉªsâ€™faÉªr]<br>vi. å¤±è´¥ï¼›ä¸å‘ç«<br>n. å¤±è´¥ï¼›ä¸å‘ç«<br>823, mitigated  [â€˜mÉªtÉªgeÉªt]<br>vt. ä½¿ç¼“å’Œï¼Œä½¿å‡è½»</p><p>vi. å‡è½»ï¼Œç¼“å’Œä¸‹æ¥<br>824, mitigation  [mÉªtÉªâ€™geÉªÊƒ(É™)n]<br>n. å‡è½»ï¼›ç¼“å’Œï¼›å¹³é™<br>825, mix  [mÉªks]<br>vt. é…åˆ¶ï¼›æ··æ·†ï¼›ä½¿æ··å’Œï¼›ä½¿ç»“äº¤<br>vi. å‚ä¸ï¼›ç›¸æ··åˆï¼›äº¤å¾€<br>n. æ··åˆï¼›æ··åˆç‰©ï¼›æ··ä¹±<br>n. (Mix)äººåï¼›(å¾·ã€è‹±)ç±³å…‹æ–¯<br>826, mock  [mÉ’k]<br>n. è‹±å›½æ¨¡æ‹Ÿè€ƒè¯•ï¼ˆmocksï¼‰<br>vt. æ„šå¼„ï¼Œå˜²å¼„<br>adj. ä»¿åˆ¶çš„ï¼Œæ¨¡æ‹Ÿçš„ï¼Œè™šå‡çš„ï¼Œä¸è¯šå®çš„<br>vt. ä¸å°Šé‡ï¼Œè”‘è§†<br>827, Modal  [â€˜mÉ™ÊŠd(É™)l]<br>adj. æ¨¡å¼çš„ï¼›æƒ…æ€çš„ï¼›å½¢å¼çš„;<br>n. è«ä»£å°”ï¼ˆä¸€ç§æ–°å‹çº¤ç»´ç´ çº¤ç»´ï¼‰<br>828, Mon amour  []<br>æˆ‘çš„çˆ±<br>829, monial  [â€˜mÉ™uniÉ™l]<br>n.ç«–æ¡†ï¼ˆç­‰äºmullionï¼‰<br>830, monolith  [â€˜mÉ’n(É™)lÉªÎ¸]<br>n. æ•´å—çŸ³æ–™ï¼›åºç„¶å¤§ç‰©<br>831, monolithic  [mÉ’nÉ™â€™lÉªÎ¸Éªk]<br>adj. æ•´ä½“çš„ï¼›å·¨çŸ³çš„ï¼Œåºå¤§çš„ï¼›å®Œå…¨ç»Ÿä¸€çš„</p><p>n. å•å—é›†æˆç”µè·¯ï¼Œå•ç‰‡ç”µè·¯<br>832, monopolize  [mÉ™â€™nÉ‘pÉ™â€™laÉªz]<br>vt. å„æ–­ï¼›ç‹¬å ï¼›æ‹¥æœ‰â€¦çš„ä¸“å–æƒ<br>833, monotonically  [mÉ’nÉ™â€™tÉ’nÉªklÉª]<br>adv. å•è°ƒåœ°<br>834, monotonicity  [,mÉ”nÉ™tÉ™â€™nisÉ™ti]<br>n. [æ•°] å•è°ƒæ€§<br>835, mood  [muËd]<br>n. æƒ…ç»ªï¼Œè¯­æ°”ï¼›å¿ƒå¢ƒï¼›æ°”æ°›;n. (Mood)äººåï¼›(è‹±)ç©†å¾·ï¼›(ç‘å…¸)è«å¾·<br>836, Moreover  [mÉ”Ërâ€™É™ÊŠvÉ™]<br>adv. è€Œä¸”ï¼›æ­¤å¤–<br>837, mount  [maÊŠnt]<br>vt. å¢åŠ ï¼›çˆ¬ä¸Šï¼›ä½¿éª‘ä¸Šé©¬ï¼›å®‰è£…ï¼Œæ¶ç½®ï¼›é•¶åµŒï¼ŒåµŒå…¥ï¼›å‡†å¤‡ä¸Šæ¼”ï¼›æˆç«‹ï¼ˆå†›é˜Ÿç­‰ï¼‰;<br>vi. çˆ¬ï¼›å¢åŠ ï¼›ä¸Šå‡;<br>n. å±±å³°ï¼›åº•åº§ï¼›ä¹˜éª‘ç”¨é©¬ï¼›æ”€ï¼Œç™»ï¼›è¿è½½å·¥å…·ï¼›åº•åº§;<br>n. ï¼ˆè‹±ï¼‰èŠ’ç‰¹ï¼ˆäººåï¼‰;<br>v. ç™»ä¸Šï¼›éª‘ä¸Š<br>838, mprotect  </p><p>839, mule  [mjuËl]<br>n. éª¡ï¼›å€”å¼ºä¹‹äººï¼Œé¡½å›ºçš„äººï¼›æ‚äº¤ç§åŠ¨ç‰©;<br>n. (Mule)äººåï¼›(æ„)ç©†è±ï¼›(è‹±)ç±³å°”<br>840, multiplexer  [â€˜mÊŒltÉª,plÉ›ksÉš]<br>n. [è®¡][é€šä¿¡] å¤šå·¥å™¨ï¼›å¤šè·¯å™¨ï¼›[é€šä¿¡] å¤šè·¯è½¬æ¥å™¨<br>841, multiplicity  [,mÊŒltÉªâ€™plÉªsÉ™ti]<br>n. å¤šæ ·æ€§ï¼›[ç‰©] å¤šé‡æ€§<br>842, mutable  [â€˜mjutÉ™bl]<br>adj. æ˜“å˜çš„ï¼Œä¸å®šçš„ï¼›æ€§æƒ…ä¸å®šçš„<br>843, mutate  [â€˜mjutet]<br>vi. å˜åŒ–ï¼Œäº§ç”Ÿçªå˜<br>vt. æ”¹å˜ï¼Œä½¿çªå˜<br>844, mutative  [â€˜mjuËtÉ™tÉªv]<br>adj. å˜åŒ–çš„ï¼›ç”Ÿç‰©çªå˜çš„<br>845, mutator  [â€˜mju:teitÉ™]<br>n. å¢å˜åŸºå› <br>846, mute  [mjuËt]<br>adj. å“‘çš„ï¼›æ²‰é»˜çš„ï¼›æ— å£°çš„;<br>vt. å‡å¼±â€¦â€¦çš„å£°éŸ³ï¼›ä½¿â€¦â€¦æŸ”å’Œ;<br>n. å“‘å·´ï¼›å¼±éŸ³å™¨ï¼›é—­é”éŸ³;<br>n. (Mute)äººåï¼›(å¡)ç©†ç‰¹<br>847, mutex  []<br>n. äº’æ–¥ï¼›äº’æ–¥å…ƒï¼Œäº’æ–¥ä½“ï¼›äº’æ–¥é‡<br>848, mutual  [â€˜mjutÊƒuÉ™l]<br>adj. å…±åŒçš„ï¼›ç›¸äº’çš„ï¼Œå½¼æ­¤çš„<br>849, mutually  [ËˆmjuËtÊƒuÉ™li]<br>adv. äº’ç›¸åœ°ï¼›äº’åŠ©<br>850, negate  [nÉªâ€™geÉªt]<br>vt. å¦å®šï¼›å–æ¶ˆï¼›ä½¿æ— æ•ˆ;<br>vi. å¦å®šï¼›å¦è®¤ï¼›æ— æ•ˆ;<br>n. å¯¹ç«‹é¢ï¼›åé¢<br>851, negligible  [â€˜neglÉªdÊ’Éªb(É™)l]<br>adj. å¾®ä¸è¶³é“çš„ï¼Œå¯ä»¥å¿½ç•¥çš„<br>852, Negotiate  [nÉªâ€™gÉ™ÊŠÊƒÉªeÉªt]<br>vt. è°ˆåˆ¤ï¼Œå•†è®®ï¼›è½¬è®©ï¼›è¶Šè¿‡;<br>vi. è°ˆåˆ¤ï¼Œäº¤æ¶‰<br>853, nest  [nest]<br>n. å·¢ï¼Œçªï¼›å®‰ä¹çªï¼›æ¸©åºŠ;<br>vt. ç­‘å·¢ï¼›åµŒå¥—;<br>vi. ç­‘å·¢ï¼›æ‰¾é¸Ÿå·¢;<br>n. (Nest)äººåï¼›(å¾·)å†…ä¸ç‰¹ï¼›(è‹±)å†…ä¸ç‰¹(å¥³å­æ•™å Agnes å¨å°”å£«è¯­çš„æ˜µç§°)<br>854, newbie  [â€˜njuËbÉª]<br>n. ç½‘ç»œæ–°æ‰‹ï¼›æ–°å…µ<br>855, nick  [nÉªk]<br>vt. åˆ»ç—•äºï¼›æŒ‘æ¯›ç—…ï¼›ç”¨åˆ»ç—•è®° n. åˆ»ç—•ï¼›ç¼ºå£ vi. åˆ»ç—•ï¼›ç‹™å‡»<br>856, nimbus  [â€˜nÉªmbÉ™s]<br>n. ï¼ˆäººå’Œç‰©äº§ç”Ÿçš„ï¼‰çµæ°”ï¼›å…‰è½®ï¼›[æ°”è±¡] é›¨äº‘ï¼›å…‰è¾‰ç¿çƒ‚çš„æ°”æ°›<br>857, noisy  [ËˆnÉ”ÉªzÉª]<br>adj. å˜ˆæ‚çš„ï¼›å–§é—¹çš„ï¼›è’å™ªçš„<br>n. å“å£°ï¼›å˜ˆæ‚å£°<br>858, nonce  [nÉ’ns]<br>n. ç›®å‰ï¼›ç‰¹å®šåœºåˆï¼›å¼ºå¥¸çŠ¯</p><p>adj. ä¸´æ—¶çš„ï¼›ç‰¹å®šåœºåˆçš„<br>859, nope  [nÉ™ÊŠp]<br>adv. ä¸æ˜¯ï¼Œæ²¡æœ‰ï¼›ä¸<br>860, norm  [nÉ”rm]<br>n. æ ‡å‡†ï¼Œè§„èŒƒ<br>861, notably  [â€˜notÉ™bli]<br>adv. æ˜¾è‘—åœ°ï¼›å°¤å…¶<br>862, notation  [noâ€™teÊƒÉ™n]<br>n. ç¬¦å·ï¼›ä¹è°±ï¼›æ³¨é‡Šï¼›è®°å·æ³•<br>863, Notation  [nÉ™ÊŠâ€™teÉªÊƒ(É™)n]<br>n. ç¬¦å·ï¼›ä¹è°±ï¼›æ³¨é‡Šï¼›è®°å·æ³•<br>864, noticeable  [â€˜nÉ™ÊŠtÉªsÉ™b(É™)l]<br>adj. æ˜¾è€Œæ˜“è§çš„ï¼Œæ˜¾è‘—çš„ï¼›å€¼å¾—æ³¨æ„çš„<br>865, notoriously  [noËˆtÉ”ËriÉ™sli]<br>adv. ä¼—æ‰€å‘¨çŸ¥åœ°ï¼›å£°åç‹¼è—‰åœ°ï¼›æ¶åæ˜­å½°åœ°<br>866, noverflow  </p><p>867, obey  [É™â€™be]<br>vt. æœä»ï¼Œå¬ä»ï¼›æŒ‰ç…§â€¦â€¦è¡ŒåŠ¨<br>vi. æœä»ï¼Œé¡ºä»ï¼›å¬è¯<br>n. (Obey)äººåï¼›(è‹±ã€æ³•)å¥¥è´<br>868, obligation  [,É‘blÉªâ€™É¡eÊƒÉ™n]<br>n. ä¹‰åŠ¡ï¼›èŒè´£ï¼›å€ºåŠ¡<br>869, observer  [É™bâ€™zÉœËvÉ™]<br>n. è§‚å¯Ÿè€…ï¼›[å¤©] è§‚æµ‹è€…ï¼›éµå®ˆè€…<br>870, obsession  [É™bâ€™seÊƒ(É™)n]<br>n. ç—´è¿·ï¼›å›°æ‰°ï¼›[å†…ç§‘][å¿ƒç†] å¼ºè¿«è§‚å¿µ<br>871, obtain  [É™bâ€™teÉªn]<br>vi. è·å¾—ï¼›æµè¡Œ;<br>vt. è·å¾—<br>872, obtuse  [É™bâ€™tjuËs]<br>adj. è¿Ÿé’çš„ï¼›åœ†å¤´çš„ï¼›ä¸é”‹åˆ©çš„<br>873, occupied  [â€˜É’kjÊŠpaÉªd]<br>adj. å·²å ç”¨çš„ï¼›ä½¿ç”¨ä¸­çš„ï¼›æ— ç©ºé—²çš„<br>v. å æœ‰ï¼ˆoccupyçš„è¿‡å»åˆ†è¯ï¼‰<br>874, occurrence  [É™â€™kÊŒr(É™)ns]<br>n. å‘ç”Ÿï¼›å‡ºç°ï¼›äº‹ä»¶ï¼›å‘ç°<br>875, odevity  [odevity]<br>å¥‡å¶æ€§<br>876, offloading  []<br>n. å¸è½½ï¼›å¸è´§;<br>vt. å¸è½½ï¼ˆoffloadçš„ç°åœ¨åˆ†è¯å½¢å¼ï¼‰<br>877, omit  [É™(ÊŠ)â€™mÉªt]<br>vt. çœç•¥ï¼›é—æ¼ï¼›åˆ é™¤ï¼›ç–å¿½<br>878, Onboarding<br>adv. åœ¨èˆ¹ä¸Šï¼›åœ¨é£æœºä¸Šï¼›åœ¨æ¿ä¸Š<br>adj. éšè½¦æºå¸¦çš„<br>879, onset  [â€˜É‘nsÉ›t]<br>n. å¼€å§‹ï¼Œç€æ‰‹ï¼›å‘ä½œï¼›æ”»å‡»ï¼Œè¿›æ”»<br>880, onwards  [â€˜É’nwÉ™dz]<br>adv. å‘å‰ï¼›åœ¨å‰é¢<br>881, opaque  [oâ€™pek]<br>adj. ä¸é€æ˜çš„ï¼›ä¸ä¼ çƒ­çš„ï¼›è¿Ÿé’çš„<br>n. ä¸é€æ˜ç‰©<br>vt. ä½¿ä¸é€æ˜ï¼›ä½¿ä¸åå…‰<br>882, opinion  [É™â€™pÉªnjÉ™n]<br>n. æ„è§ï¼›ä¸»å¼ <br>883, opinionated  [É™â€™pÉªnjÉ™netÉªd]<br>adj. å›ºæ‰§å·±è§çš„ï¼›æ­¦æ–­çš„<br>884, optimized  [â€˜É’ptÉªmaÉªzd]<br>adj. æœ€ä½³åŒ–çš„ï¼›å°½é‡å……åˆ†åˆ©ç”¨<br>885, optimizer  [â€˜É’ptÉªmaÉªzÉ™]<br>n. [è®¡] ä¼˜åŒ–ç¨‹åºï¼›æœ€ä¼˜æ§åˆ¶å™¨<br>886, orchestrating<br>ç²¾å¿ƒç­–åˆ’</p><p>ç»™ â€¦ é…ç®¡å¼¦ä¹æ›²</p><p>ä½¿åè°ƒåœ°ç»“åˆåœ¨ä¸€èµ·<br>887, orchestration  [,É”kÉ›sâ€™treÊƒÉ™n]<br>n. ç®¡å¼¦ä¹ç¼–æ›²ï¼›å’Œè°çš„ç»“åˆ<br>888, orchestrator<br>n. ç®¡å¼¦ä¹æ¼”å¥å®¶ï¼›ç®¡å¼¦ä¹ç¼–æ›²å®¶<br>889, ordinarily  [â€˜É”Ëd(É™),n(É™)rÉªlÉª; ,É”ËdÉªâ€™nerÉªlÉª]<br>adv. é€šå¸¸åœ°ï¼›ä¸€èˆ¬åœ°<br>890, Oriented  [â€˜É”ËrÉªentÉªd]<br>adj. å¯¼å‘çš„ï¼›å®šå‘çš„ï¼›ä»¥â€¦ä¸ºæ–¹å‘çš„;<br>v. è°ƒæ•´ï¼›ä½¿æœå‘ï¼ˆorientçš„è¿‡å»åˆ†è¯ï¼‰ï¼›ç¡®å®šâ€¦çš„æ–¹ä½<br>891, orphans  [â€˜É”rfÉ™n]<br>n. å­¤å„¿ï¼ˆorphançš„å¤æ•°ï¼‰<br>v. æˆä¸ºå­¤å„¿ï¼ˆorphançš„ä¸‰å•å½¢å¼ï¼‰<br>892, outage  [â€˜aÊŠtÉªdÊ’]<br>n. å‚¨è¿æŸè€—ï¼›ä¸­æ–­ä¾›åº”ï¼›è¿è¡Œä¸­æ–­<br>893, outgoing  [â€˜aÊŠtgÉ™ÊŠÉªÅ‹]<br>adj. å¯¹äººå‹å¥½çš„ï¼Œå¼€æœ—çš„ï¼›å‡ºå‘çš„ï¼Œå¤–å‡ºçš„ï¼›å³å°†ç¦»èŒçš„ï¼›ä¹äºåŠ©äººçš„;<br>n. å¤–å‡ºï¼›æµå‡ºï¼›å¼€æ”¯;<br>v. è¶…è¿‡ï¼›ä¼˜äºï¼ˆoutgoçš„ingå½¢å¼ï¼‰<br>894, outnumber  [aÊŠtâ€™nÊŒmbÉ™]<br>vt. æ•°ç›®è¶…è¿‡ï¼›æ¯”â€¦å¤š<br>895, outright  [â€˜aÊŠtraÉªt]<br>adv. å…¨éƒ¨åœ°ï¼›ç«‹åˆ»åœ°ï¼›ç‡ç›´åœ°ï¼›ä¸€ç›´å‘å‰ï¼›ç—›å¿«åœ°<br>adj. å®Œå…¨çš„ï¼Œå½»åº•çš„ï¼›ç›´ç‡çš„ï¼›æ€»å…±çš„<br>896, outstanding  [aÊŠtâ€™stÃ¦ndÉªÅ‹]<br>adj. æ°å‡ºçš„ï¼›æ˜¾è‘—çš„ï¼›æœªè§£å†³çš„ï¼›æœªå¿ä»˜çš„;<br>n. æœªå¿è´·æ¬¾<br>897, overlap  [É™ÊŠvÉ™â€™lÃ¦p]<br>n. é‡å ï¼›é‡å¤</p><p>vi. éƒ¨åˆ†é‡å ï¼›éƒ¨åˆ†çš„åŒæ—¶å‘ç”Ÿ</p><p>vt. ä¸â€¦é‡å ï¼›ä¸â€¦åŒæ—¶å‘ç”Ÿ<br>898, overlay  [â€˜ovÉ™lÉ›i]<br>n. è¦†ç›–å›¾ï¼›è¦†ç›–ç‰©<br>vt. åœ¨è¡¨é¢ä¸Šé“ºä¸€è–„å±‚ï¼Œé•€<br>899, overpopulate  [É™ÊŠvÉ™â€™pÉ’pjÊŠleÉªt]<br>vt. ä½¿äººå£è¿‡å‰©ï¼›ä½¿äººå£è¿‡å¯†<br>900, overwhelm  [ovÉšËˆhwÉ›lm]<br>vt. æ·¹æ²¡ï¼›å‹å€’ï¼›å—æ‰“å‡»ï¼›è¦†ç›–ï¼›å‹å®<br>901, pacesetter  [â€˜pessÉ›tÉš]<br>n. æ ‡å…µï¼›å…ˆå¯¼è€…ï¼Œæ­¥è°ƒè°ƒæ•´è€…<br>902, pad  [pÃ¦d]<br>n. è¡¬å«ï¼›æŠ¤å…·ï¼›ä¾¿ç¬ºç°¿ï¼›å¡«è¡¥<br>vi. æ­¥è¡Œï¼›æ”¾è½»è„šæ­¥èµ°<br>vt. å¡«è¡¥ï¼›èµ°<br>n. (Pad)äººåï¼›(è‹±)å¸•å¾·(ç”·å­æ•™å Patrick çš„æ˜µç§°)<br>903, padding  [â€˜pÃ¦dÉªÅ‹]<br>n. å¡«æ–™ï¼›å«æ–™;<br>v. å¡«è¡¥ï¼ˆpadçš„ingå½¢å¼ï¼‰<br>904, paddle  [â€˜pÃ¦dl]<br>n. åˆ’æ¡¨ï¼›æ˜è½®ç¿¼<br>vt. æ‹Œï¼›æ…ï¼›ç”¨æ¡¨åˆ’<br>vi. åˆ’æ¡¨ï¼›æˆæ°´ï¼›æ¶‰æ°´<br>905, padlock  [â€˜pÃ¦dlÉ’k]<br>n. æŒ‚é”ï¼›å…³é—­ï¼›ç¦æ­¢è¿›å…¥;<br>vt. ç”¨æŒ‚é”é”ä¸Šï¼›å…³é—­<br>906, Page View<br>è®¿é—®é‡<br>907, Pagination  [,pÃ¦dÊ’Éªâ€™neÉªÊƒ(É™)n]<br>n. æ ‡è®°é¡µæ•°ï¼›é¡µç <br>908, painful  [â€˜penfl]<br>adj. ç—›è‹¦çš„ï¼›ç–¼ç—›çš„ï¼›ä»¤äººä¸å¿«çš„<br>909, palette  [â€˜pÃ¦lÉ™t]<br>n. è°ƒè‰²æ¿ï¼›é¢œæ–™<br>n. (Palette)äººåï¼›(æ³•)å¸•è±ç‰¹<br>910, pampas  [â€˜pÃ¦mpÉ™s]<br>n. è‰åŸï¼›è’²è‹‡ï¼ˆpampaçš„å¤æ•°å½¢å¼ï¼‰<br>n. (Pampas)äººåï¼›(ç‘å…¸)æ½˜å¸•æ–¯<br>911, pan  [ç¾/pÃ¦n/]<br>n. å¹³åº•é”…ï¼›ç›˜çŠ¶çš„å™¨çš¿ï¼›æ·˜ç›˜å­ï¼Œé‡‘ç›˜ï¼Œç§¤ç›˜;<br>vt. æ·˜é‡‘ï¼›åœ¨æµ…é”…ä¸­çƒ¹è°ƒï¼ˆé£Ÿç‰©ï¼‰ï¼›[éæ­£å¼ç”¨è¯­]ä¸¥å‰çš„æ‰¹è¯„;<br>vi. æ·˜é‡‘ï¼›åœ¨æ·˜æ´—ä¸­æ”¶è·é‡‘å­;<br>912, pane  [peÉªn]<br>n. çª—æ ¼ï¼›è¾¹ï¼›é¢ï¼›çª—æ ¼ç»ç’ƒï¼›åµŒæ¿;<br>vt. è£…çª—ç»ç’ƒäºï¼›é•¶åµŒæ¿äº;<br>n. (Pane)äººåï¼›(è€)ç­ï¼›(è‹±)æ½˜æ©ï¼›(å¾·ã€è¥¿ã€æ„ã€å¡ã€å°å°¼)å¸•å†…<br>913, panic  [â€˜pÃ¦nÉªk]<br>n. ææ…Œï¼ŒæƒŠæ…Œï¼›å¤§ææ…Œ;<br>adj. ææ…Œçš„ï¼›æ²¡æœ‰ç†ç”±çš„;<br>vt. ä½¿ææ…Œ;<br>vi. ååˆ†æƒŠæ…Œ;<br>n. (Panic)äººåï¼›(ç½—)å¸•å°¼å…‹<br>914, paradise  [â€˜pÃ¦rÉ™daÉªs]<br>n. å¤©å ‚<br>è‡³ç¦å¢ƒåœ°<br>915, Paradise  [â€˜pÃ¦rÉ™daÉªs]<br>n. å¤©å ‚;<br>è‡³ç¦å¢ƒåœ°<br>916, paramount  [â€˜pÃ¦rÉ™maÊŠnt]<br>adj. æœ€é‡è¦çš„ï¼Œä¸»è¦çš„ï¼›è‡³é«˜æ— ä¸Šçš„</p><p>n. æœ€é«˜ç»Ÿæ²»è€…<br>917, parasitic  [,pÃ¦rÉ™â€™sÉªtÉªk]<br>adj. å¯„ç”Ÿçš„ï¼ˆç­‰äºparasiticalï¼‰<br>918, parentheses  [pÉ™â€™rÉ›nÎ¸É™sÉªz]<br>n. parenthesisçš„å¤æ•°å½¢å¼<br>919, parenthesis  [pÉ™â€™rÉ›nÎ¸É™sÉªs]<br>n. æ’å…¥è¯­,æ’å…¥æˆåˆ†<br>n. åœ†æ‹¬å·<br>n. é—´æ­‡ï¼Œæ’æ›²<br>920, parlance  [â€˜pÉ‘Ël(É™)ns]<br>n. è¯´æ³•ï¼›ç”¨è¯­ï¼›è¯­è°ƒï¼›å‘è¨€<br>921, participant  [pÉ‘Ëâ€™tÉªsÉªp(É™)nt]<br>n. å‚ä¸è€…ï¼›å…³ç³»è€…<br>adj. å‚ä¸çš„ï¼›æœ‰å…³ç³»çš„<br>922, passenger  [â€˜pÃ¦sÉªndÊ’É™]<br>n. æ—…å®¢ï¼›ä¹˜å®¢ï¼›è¿‡è·¯äººï¼›ç¢æ‰‹ç¢è„šçš„äºº<br>923, passive  [â€˜pÃ¦sÉªv]<br>adj. è¢«åŠ¨çš„ï¼Œæ¶ˆæçš„ï¼›è¢«åŠ¨è¯­æ€çš„</p><p>n. è¢«åŠ¨è¯­æ€<br>924, passphrase  [passphrase]<br>n. å¯†ç ï¼›é€šè¡Œç ï¼›å£ä»¤çŸ­è¯­<br>925, peculiar  [pÉªâ€™kjulÉªÉš]<br>adj. ç‰¹æ®Šçš„ï¼›ç‹¬ç‰¹çš„ï¼›å¥‡æ€ªçš„ï¼›ç½•è§çš„<br>n. ç‰¹æƒï¼›ç‰¹æœ‰è´¢äº§<br>926, peek  [pik]<br>n. å·çœ‹ï¼›ä¸€ç¥ï¼Œçœ‹ä¸€çœ¼<br>vi. çª¥è§†ï¼Œå·çœ‹<br>n. (Peek)äººåï¼›(è‹±)çš®å…‹<br>927, peer  [pÉªÉ™]<br>n. è´µæ—ï¼›åŒç­‰çš„äººï¼›åŒé¾„äºº</p><p>vi. å‡è§†ï¼Œç›¯ç€çœ‹ï¼›çª¥è§†</p><p>vt. å°ä¸ºè´µæ—ï¼›ä¸â€¦åŒç­‰</p><p>n. (Peer)äººåï¼›(è‹±ã€å·´åŸº)çš®å°”<br>928, pending  [â€˜pendÉªÅ‹]<br>adj. æœªå†³å®šçš„ï¼›è¡Œå°†å‘ç”Ÿçš„;<br>prep. åœ¨â€¦æœŸé—´ï¼›ç›´åˆ°â€¦æ—¶ä¸ºæ­¢ï¼›åœ¨ç­‰å¾…â€¦ä¹‹é™…;<br>v. å¾…å®šï¼›æ‚¬è€Œä¸å†³ï¼ˆpendçš„ingå½¢å¼ï¼‰;<br>n. (Pending)äººåï¼›(ç‘å…¸)å½­ä¸<br>929, Pending  []</p><p>930, percentile  [pÉšâ€™sÉ›ntaÉªl]<br>adj. ç™¾åˆ†ç‡çš„ï¼›æŒ‰ç™¾ç­‰åˆ†æ’åˆ—çš„<br>n. ç™¾åˆ†ä½<br>931, percolate  [â€˜pÉœËkÉ™leÉªt]<br>vi. è¿‡æ»¤ï¼›æ¸—å‡ºï¼›æµ¸é€</p><p>vt. ä½¿æ¸—å‡ºï¼›ä½¿è¿‡æ»¤</p><p>n. æ»¤è¿‡æ¶²ï¼›æ¸—å‡ºæ¶²<br>932, percolator  [â€˜pÉœËkÉ™leÉªtÉ™]<br>n. è¿‡æ»¤å™¨ï¼›æ¸—æ»¤å™¨ï¼›å’–å•¡æ¸—æ»¤å£¶<br>933, perform  [pÉ™â€™fÉ”Ëm]<br>vt. æ‰§è¡Œï¼›å®Œæˆï¼›æ¼”å¥<br>vi. æ‰§è¡Œï¼Œæœºå™¨è¿è½¬ï¼›è¡¨æ¼”<br>perform: æ‰§è¡Œ  è¡¨æ¼”  å±¥è¡Œ<br>934, Perform  [pÉ™â€™fÉ”Ëm]<br>vt. æ‰§è¡Œï¼›å®Œæˆï¼›æ¼”å¥;<br>vi. æ‰§è¡Œï¼Œæœºå™¨è¿è½¬ï¼›è¡¨æ¼”<br>935, performance  [pÉ™â€™fÉ”Ëm(É™)ns]<br>n. æ€§èƒ½ï¼›ç»©æ•ˆï¼›è¡¨æ¼”ï¼›æ‰§è¡Œ<br>936, performing  [pÉ™â€™fÉ”ËmÉªÅ‹]<br>v. è¡¨æ¼”ï¼ˆperformçš„ingå½¢å¼ï¼‰ï¼›å±¥è¡Œ<br>adj. è¡¨æ¼”çš„ï¼›å±¥è¡Œçš„<br>performing: æ‰§è¡Œ  è¡¨æ¼”æ€§  è¡¨ç°<br>937, period  [â€˜pÉªÉ™rÉªÉ™d]<br>n. å‘¨æœŸï¼ŒæœŸé—´ï¼›æ—¶æœŸï¼›æœˆç»ï¼›è¯¾æ—¶ï¼›ï¼ˆè¯­æ³•å­¦ï¼‰å¥ç‚¹ï¼Œå¥å·</p><p>adj. æŸä¸€æ—¶ä»£çš„<br>938, periodic  [,pÉªÉ™rÉªâ€™É’dÉªk]<br>adj. å‘¨æœŸçš„ï¼›å®šæœŸçš„<br>939, periodically  [pÉªrÉªËˆÉ‘dÉªklÉª]<br>adv. å®šæœŸåœ°ï¼›å‘¨æœŸæ€§åœ°ï¼›å¶å°”ï¼›é—´æ­‡<br>940, peripheral  [pÉ™â€™rÉªfÉ™rÉ™l]<br>adj. å¤–å›´çš„ï¼›æ¬¡è¦çš„ï¼›ï¼ˆç¥ç»ï¼‰æœ«æ¢¢åŒºåŸŸçš„<br>n. å¤–éƒ¨è®¾å¤‡<br>941, permanent  [â€˜pÉœËm(É™)nÉ™nt]<br>adj.æ°¸ä¹…çš„ï¼Œæ°¸æ’çš„ï¼›ä¸å˜çš„<br>n.çƒ«å‘ï¼ˆç­‰äºpermanent waveï¼‰<br>942, permission  [pÉ™â€™mÉªÊƒ(É™)n]<br>n. å…è®¸ï¼Œè®¸å¯<br>943, Permission  [pÉ™â€™mÉªÊƒ(É™)n]<br>n. å…è®¸ï¼Œè®¸å¯<br>944, permutation  [â€˜pÉmjÊŠâ€™teÊƒÉ™n]<br>n. [æ•°] æ’åˆ—ï¼›[æ•°] ç½®æ¢<br>945, perpetual  [pÉšâ€™pÉ›tÊƒuÉ™l]<br>adj. æ°¸ä¹…çš„ï¼›ä¸æ–­çš„ï¼›å››å­£å¼€èŠ±çš„ï¼›æ— æœŸé™çš„<br>946, personality  [pÉœËsÉ™â€™nÃ¦lÉªtÉª]<br>n. ä¸ªæ€§ï¼›å“æ ¼ï¼›åäºº<br>947, perspective  [pÉ™â€™spektÉªv]<br>n. è§‚ç‚¹ï¼›è¿œæ™¯ï¼›é€è§†å›¾;<br>adj. é€è§†çš„<br>948, pertain  [pÉ™â€™teÉªn]<br>vi. å±äºï¼›å…³äºï¼›é€‚åˆ<br>949, phantom  [â€˜fÃ¦ntÉ™m]<br>n. å¹½çµï¼›å¹»å½±ï¼›è™šä½</p><p>adj. å¹½çµçš„ï¼›å¹»è§‰çš„ï¼›æœ‰åæ— å®çš„<br>950, Phantom  [â€˜fÃ¦ntÉ™m]<br>n. å¹½çµï¼›å¹»å½±ï¼›è™šä½;<br>adj. å¹½çµçš„ï¼›å¹»è§‰çš„ï¼›æœ‰åæ— å®çš„<br>951, phase  [feÉªz]<br>n. ç›¸ï¼›é˜¶æ®µï¼›[å¤©] ä½ç›¸;<br>vt. ä½¿å®šç›¸ï¼›é€æ­¥æ‰§è¡Œ;<br>vi. é€æ­¥å‰è¿›<br>952, phases  [â€˜feÉªsiËz]<br>n. é˜¶æ®µï¼Œæ—¶æœŸï¼ˆphaseçš„å¤æ•°å½¢å¼ï¼‰;<br>v. é€æ­¥å®è¡Œï¼ˆphaseçš„ä¸‰å•å½¢å¼ï¼‰<br>953, philosophies  [fÉªâ€™lÉ’sÉ™fÉª]<br>n. å“²å­¦ï¼›å“²ç†ï¼›äººç”Ÿè§‚<br>954, phrase  [frez]<br>n. çŸ­è¯­, ä¹ è¯­, æªè¾, ä¹å¥<br>vt. æªè¯, å°†(ä¹æ›²)åˆ†æˆä¹å¥<br>955, PHRASE  [freÉªz]<br>n. çŸ­è¯­, ä¹ è¯­, æªè¾, ä¹å¥;<br>vt. æªè¯, å°†(ä¹æ›²)åˆ†æˆä¹å¥<br>956, pier  [pÉªr]<br>n. ç å¤´ï¼Œç›´ç å¤´ï¼›æ¡¥å¢©ï¼›çª—é—´å£<br>n. (Pier)äººåï¼›(è‹±ã€å¾·)çš®å°”ï¼›(è¥¿)å½¼å°”ï¼›(æ„)çš®è€¶å°”<br>957, piggyback  [â€˜pÉªÉ¡ÉªbÃ¦k]<br>adj. èƒŒç€çš„ï¼›[èˆª] åœ¨èƒŒè‚©ä¸Šçš„<br>adv. åœ¨èƒŒè‚©ä¸Š<br>n. è‚©æ‰›ï¼›èƒŒè´Ÿå¼è¿è¾“<br>vt. èƒŒè´Ÿå¼è£…è¿<br>958, pilot  [kÉ™â€™lekt]<br>vt. æ”¶é›†ï¼›å‹Ÿæ<br>vi. æ”¶é›†ï¼›èšé›†ï¼›å‹Ÿæ<br>adv. ç”±æ”¶ä»¶äººä»˜æ¬¾åœ°<br>adj. ç”±æ”¶ä»¶äººä»˜æ¬¾çš„<br>n. (Collect)äººåï¼›(è‹±)ç§‘è±å…‹ç‰¹<br>959, pin  [pÉªn]<br>n. å¤§å¤´é’ˆï¼Œåˆ«é’ˆï¼Œé’ˆï¼›æ “ï¼›çç¢ç‰©<br>vt. é’‰ä½ï¼›å‹ä½ï¼›å°†â€¦â€¦ç”¨é’ˆåˆ«ä½<br>960, pinned  [â€˜pind]<br>adj. ç”¨é’ˆåˆ«ä½çš„ï¼›è¢«å‹åˆ¶çš„<br>v. ç‰µåˆ¶ï¼›ç”¨é’ˆåˆ«ä½ï¼›åˆºç©¿ï¼ˆpinçš„è¿‡å»åˆ†è¯ï¼‰<br>961, pipeline  [â€˜paÉªplaÉªn]<br>n. ç®¡é“ï¼›è¾“æ²¹ç®¡ï¼›ä¼ é€’é€”å¾„<br>è¿‡å»å¼:pipelined; è¿‡å»åˆ†è¯:pipelined; ç°åœ¨åˆ†è¯:pipelining<br>962, placement  [â€˜pleÉªsmÉ™nt]<br>n. å¸ƒç½®ï¼›å®šä½çƒï¼›äººå‘˜é…ç½®<br>963, plain  [plen]<br>adj. å¹³çš„ï¼›ç®€å•çš„ï¼›æœ´ç´ çš„ï¼›æ¸…æ™°çš„<br>n. å¹³åŸï¼›æ— æ ¼å¼ï¼›æœ´å®æ— åçš„ä¸œè¥¿<br>adv. æ¸…æ¥šåœ°ï¼›å¹³æ˜“åœ°<br>n. (Plain)äººåï¼›(è‹±)æ™®è±æ©ï¼›(æ³•)æ™®å…°<br>964, planet  [â€˜plÃ¦nÉªt]<br>n. è¡Œæ˜Ÿ<br>n. (Planet)äººåï¼›(æ³•)æ™®æ‹‰å†…ï¼›(è¥¿ã€è‘¡)æ™®æ‹‰å†…ç‰¹<br>965, Plastic  [â€˜plÃ¦stÉªk]<br>adj. å¡‘æ–™çš„ï¼›ï¼ˆå¤–ç§‘ï¼‰é€ å‹çš„ï¼›å¯å¡‘çš„<br>n. å¡‘æ–™åˆ¶å“ï¼›æ•´å½¢ï¼›å¯å¡‘ä½“<br>966, plenty  [â€˜plentÉª]<br>n. ä¸°å¯Œï¼Œå¤§é‡ï¼›å……è¶³;<br>adj. è¶³å¤Ÿçš„ï¼Œå¾ˆå¤šçš„;<br>adv. è¶³å¤Ÿ;<br>n. (Plenty)äººåï¼›(è‹±)æ™®ä¼¦è’‚<br>967, plot  [plÉ‘t]<br>n. æƒ…èŠ‚ï¼›å›¾ï¼›é˜´è°‹<br>vt. å¯†è°‹ï¼›ç»˜å›¾ï¼›åˆ’åˆ†ï¼›æ ‡ç»˜<br>vi. å¯†è°‹ï¼›ç­–åˆ’ï¼›ç»˜åˆ¶<br>n. (Plot)äººåï¼›(æ·)æ™®æ´›ç‰¹ï¼›(æ³•)æ™®æ´›<br>968, plotted  [plotted]<br>adj. æ ‡ç»˜çš„<br>v. ç­–åˆ’ï¼ˆplotçš„è¿‡å»åˆ†è¯ï¼‰ï¼›åˆ’åˆ†ï¼›ç»˜åˆ¶â€¦çš„åœ°å›¾<br>969, plug  [plÊŒg]<br>n. æ’å¤´ï¼›å¡å­ï¼›æ “;<br>vi. å¡ä½ï¼›ç”¨æ’å¤´å°†ä¸ç”µæºæ¥é€š;<br>vt. æ’å…¥ï¼›å¡ä½ï¼›æ¥æ’å¤´<br>970, plug in  []<br>æ’å…¥ï¼›æ’ä¸Šç”µæº<br>971, pluggable  [plÊŒgÉ™bl]<br>adj. æ’æ¥å¼è¿æ¥ï¼Œ[ç”µ] å¯æ’çš„<br>972, Pluggable  [plÊŒgÉ™bl]<br>adj. æ’æ¥å¼è¿æ¥ï¼Œ[ç”µ] å¯æ’çš„<br>973, Plugin  [plÊŒgÉªn]<br>n. æ’ä»¶ï¼›ç›¸å…³æ’ä»¶;<br>n. (Plugin)äººåï¼›(ä¿„)æ™®å¢é‡‘<br>974, plural  [â€˜plÊŠrÉ™l]<br>adj. å¤æ•°çš„<br>n. å¤æ•°<br>975, poet  [â€˜pÉ™ÊŠÉªt]<br>n. è¯—äºº<br>976, poetry  [â€˜pÉ™ÊŠÉªtrÉª]<br>n. è¯—ï¼›è¯—æ„ï¼Œè¯—æƒ…ï¼›è¯—æ­Œè‰ºæœ¯<br>977, poison  [â€˜pÉ”Éªzn]<br>vt. æ±¡æŸ“ï¼›ä½¿ä¸­æ¯’ï¼Œæ”¾æ¯’äºï¼›è´¥åï¼›é˜»ç¢<br>vi. æ”¾æ¯’ï¼Œä¸‹æ¯’<br>n. æ¯’è¯ï¼Œæ¯’ç‰©ï¼›é…’ï¼›æœ‰æ¯’å®³çš„äº‹ç‰©ï¼›[åŠ©å‰‚] æŠ‘åˆ¶å‰‚<br>adj. æœ‰æ¯’çš„<br>n. (Poison)äººåï¼›(è¥¿)æ³¢ä¼Šæ¾<br>978, polar  [â€˜pÉ™ÊŠlÉ™]<br>adj. æåœ°çš„ï¼›ä¸¤æçš„ï¼›æ­£å¥½ç›¸åçš„</p><p>n. æé¢ï¼›æçº¿</p><p>n. (Polar)äººåï¼›(å¾·ã€è¥¿)æ³¢æ‹‰å°”<br>979, pollution  [pÉ™â€™luÊƒÉ™n]<br>n. æ±¡æŸ“<br>æ±¡æŸ“ç‰©<br>980, polymorphism  [,pÉ‘lÉªâ€™mÉ”rfÉªzm]<br>n. å¤šæ€æ€§ï¼›å¤šå½¢æ€§ï¼›åŒè´¨å¤šæ™¶<br>981, popover  [â€˜pÉ’pÉ™ÊŠvÉ™]<br>n. ä¸€ç§æ·¡çƒ¤çš„é…¥é¥¼<br>982, populated  [ËˆpÉ‘ËpjuleÉªtid]<br>adj. ç²’å­æ•°å¢åŠ çš„;<br>v. å±…ä½äºâ€¦ä¸­ï¼›æ„æˆâ€¦çš„äººå£ï¼ˆpopulateçš„è¿‡å»åˆ†è¯ï¼‰<br>983, portable  [â€˜pÉ”rtÉ™bl]<br>adj. æ‰‹æçš„ï¼Œä¾¿æºå¼çš„ï¼›è½»ä¾¿çš„<br>n. æ‰‹æå¼æ‰“å­—æœº<br>984, portal  [â€˜pÉ”Ët(É™)l]<br>n. å¤§é—¨ï¼Œå…¥å£;<br>n. (Portal)äººåï¼›(æ³•ã€è¥¿ã€è‘¡)æ³¢å¡”å°”ï¼›(è‹±)æ³¢ç‰¹å°”<br>985, portion  [â€˜pÉ”ËÊƒ(É™)n]<br>n. éƒ¨åˆ†ï¼›ä¸€ä»½ï¼›å‘½è¿</p><p>vt. åˆ†é…ï¼›ç»™â€¦å«å¦†<br>986, portrait  [â€˜pÉ”rtrÉªt]<br>n. è‚–åƒï¼›æå†™ï¼›åŠèº«é›•å¡‘åƒ<br>n. (Portrait)äººåï¼›(æ³•)æ³¢ç‰¹é›·<br>987, postpone  [pÉ™ÊŠs(t)â€™pÉ™ÊŠn; pÉ™â€™spÉ™ÊŠn]<br>vt. ä½¿â€¦å»¶æœŸï¼›æŠŠâ€¦æ”¾åœ¨æ¬¡è¦åœ°ä½ï¼›æŠŠâ€¦æ”¾åœ¨åé¢;<br>vi. å»¶ç¼“ï¼Œå»¶è¿Ÿï¼›å»¶ç¼“å‘ä½œ<br>988, pot  [ç¾/pÉ‘t/]<br>n. å£¶ï¼›ç›†ï¼›ç½;<br>vt. æŠŠâ€¦è£…ç½ï¼›å°„å‡»ï¼›èŠ‚ç•¥;<br>vi. éšæ‰‹å°„å‡»;<br>n. (Pot)äººåï¼›(æŸ¬)å¸ƒç‰¹ï¼›(æ·)æ³¢ç‰¹ï¼›(æ³•)æ³¢;<br>989, potentially  [pÉ™â€™tÉ›nÊƒÉ™li]<br>adv.å¯èƒ½åœ°ï¼Œæ½œåœ¨åœ°<br>990, practical  [â€˜prÃ¦ktÉªk(É™)l]<br>adj. å®é™…çš„ï¼›å®ç”¨æ€§çš„<br>991, pragmatic  [prÃ¦gâ€™mÃ¦tÉªk]<br>adj. å®é™…çš„ï¼›å®ç”¨ä¸»ä¹‰çš„ï¼›å›½äº‹çš„<br>992, prank  [prÃ¦Å‹k]<br>n. æ¶ä½œå‰§ï¼Œå¼€ç©ç¬‘ï¼›æˆè°‘;<br>vt. è£…é¥°ï¼›æ‰“æ‰®;<br>vi. ç‚«è€€è‡ªå·±ï¼›èƒ¡é—¹<br>993, precaution  [prÉªâ€™kÉ”ËÊƒ(É™)n]<br>n. é¢„é˜²ï¼Œè­¦æƒ•ï¼›é¢„é˜²æªæ–½;<br>vt. è­¦æƒ•ï¼›é¢„å…ˆè­¦å‘Š<br>994, precede  [prÉªâ€™siËd]<br>vt. é¢†å…ˆï¼Œåœ¨â€¦ä¹‹å‰ï¼›ä¼˜äºï¼Œé«˜äº;<br>vi. é¢†å…ˆï¼Œåœ¨å‰é¢<br>995, precedence  [â€˜presÉªd(É™)ns; prÉªâ€™siËd(É™)ns]<br>n. ä¼˜å…ˆï¼›å±…å…ˆ<br>996, precision  [prÉªâ€™sÉªÊ’n]<br>n. ç²¾åº¦ï¼Œ[æ•°] ç²¾å¯†åº¦ï¼›ç²¾ç¡®<br>adj. ç²¾å¯†çš„ï¼Œç²¾ç¡®çš„<br>997, preclude  [prÉªâ€™kluËd]<br>vt. æ’é™¤ï¼›å¦¨ç¢ï¼›é˜»æ­¢<br>998, predecessor  [â€˜priËdÉªsesÉ™]<br>n. å‰ä»»ï¼Œå‰è¾ˆ<br>999, predictability  [pri,diktÉ™â€™biliti]<br>n. å¯é¢„æµ‹æ€§ï¼›å¯é¢„è¨€<br>1000, preempt  [,primpt]<br>vt. å…ˆå ï¼›å…ˆå–ï¼›ä»¥å…ˆä¹°æƒè·å¾—<br>1001, preference  [â€˜pref(É™)r(É™)ns]<br>n. åçˆ±ï¼Œå€¾å‘ï¼›ä¼˜å…ˆæƒ<br>1002, prefetch  [prefetch]<br>v. é¢„å–<br>1003, preliminary  [prÉªâ€™lÉªmÉªn(É™)rÉª]<br>n. å‡†å¤‡ï¼›é¢„èµ›ï¼›åˆæ­¥æªæ–½<br>adj. åˆæ­¥çš„ï¼›å¼€å§‹çš„ï¼›é¢„å¤‡çš„<br>1004, premiered  []<br>ï¼ˆæˆå‰§ã€ç”µå½±ç­‰ï¼‰é¦–æ¬¡å…¬æ¼”ï¼ˆpremiereçš„è¿‡å»å¼å’Œè¿‡å»åˆ†è¯ï¼‰<br>1005, premises  [â€˜premÉªsÉªz]<br>n.å‰æï¼›ç»è¥åœºå€ï¼›ä¸Šè¿°æˆ¿å±‹ï¼›å¥‘çº¦å‰è¨€ï¼ˆpremiseçš„å¤æ•°ï¼‰ v.æå‡ºâ€¦ä¸ºå‰æï¼›é¢„è¿°ï¼ˆpremiseçš„ç¬¬ä¸‰äººç§°å•æ•°ï¼‰<br>1006, premium  [â€˜priËmÉªÉ™m]<br>n. é¢å¤–è´¹ç”¨ï¼›å¥–é‡‘ï¼›ä¿é™©è´¹;(å•†)æº¢ä»·;<br>adj. é«˜ä»·çš„ï¼›ä¼˜è´¨çš„<br>1007, preppy  [â€˜prÉ›pi]<br>n. é¢„ç§‘ç”Ÿï¼ˆç­‰äºpreppieï¼‰<br>1008, prerequisite  [priËâ€™rekwÉªzÉªt]<br>n. å…ˆå†³æ¡ä»¶;<br>adj. é¦–è¦å¿…å¤‡çš„<br>1009, present  [â€˜prez(É™)nt]<br>vt. æå‡ºï¼›ä»‹ç»ï¼›å‘ˆç°ï¼›èµ é€;<br>vi. ä¸¾æªç„å‡†;<br>adj. ç°åœ¨çš„ï¼›å‡ºå¸­çš„;<br>n. ç°åœ¨ï¼›ç¤¼ç‰©ï¼›ç„å‡†<br>1010, presentation  [prez(É™)nâ€™teÉªÊƒ(É™)n]<br>n. å±•ç¤ºï¼›æè¿°ï¼Œé™ˆè¿°ï¼›ä»‹ç»ï¼›èµ é€<br>1011, Presentation  [prez(É™)nâ€™teÉªÊƒ(É™)n]<br>n. æè¿°ï¼Œé™ˆè¿°ï¼›ä»‹ç»ï¼›èµ é€<br>1012, presenter  [prÉªâ€™zÉ›ntÉš]<br>n. æå‡ºè€…ï¼›æ¨èè€…ï¼›èµ é€è€…ï¼›ä»»å‘½è€…ï¼›ä¸»æŒäºº<br>1013, prevent  [prÉªâ€™vent]<br>vt. é¢„é˜²ï¼Œé˜²æ­¢ï¼›é˜»æ­¢;<br>vi. å¦¨ç¢ï¼Œé˜»æ­¢<br>1014, primary  [â€˜praÉªmÉ›ri]<br>adj. ä¸»è¦çš„ï¼›åˆçº§çš„ï¼›åŸºæœ¬çš„<br>n. åŸè‰²ï¼›æœ€ä¸»è¦è€…<br>1015, Primordial  [praÉªâ€™mÉ”ËdÉªÉ™l]<br>adj. åŸå§‹çš„ï¼›æ ¹æœ¬çš„ï¼›åŸç”Ÿçš„<br>1016, principal  [â€˜prÉªnsÉ™p(É™)l]<br>adj. ä¸»è¦çš„ï¼›èµ„æœ¬çš„;<br>n. é¦–é•¿ï¼›æ ¡é•¿ï¼›èµ„æœ¬ï¼›å½“äº‹äºº<br>1017, Principal  [â€˜prÉªnsÉ™p(É™)l]<br>adj. ä¸»è¦çš„ï¼›èµ„æœ¬çš„;<br>n. é¦–é•¿ï¼›æ ¡é•¿ï¼›èµ„æœ¬ï¼›å½“äº‹äºº<br>1018, principle  [â€˜prÉªnsÉªp(É™)l]<br>n. åŸç†ï¼ŒåŸåˆ™ï¼›ä¸»ä¹‰ï¼Œé“ä¹‰ï¼›æœ¬è´¨ï¼Œæœ¬ä¹‰ï¼›æ ¹æºï¼Œæºæ³‰<br>1019, Principle  [â€˜prÉªnsÉªp(É™)l]<br>n. åŸç†ï¼ŒåŸåˆ™ï¼›ä¸»ä¹‰ï¼Œé“ä¹‰ï¼›æœ¬è´¨ï¼Œæœ¬ä¹‰ï¼›æ ¹æºï¼Œæºæ³‰<br>1020, principle engineer<br>ã€ç½‘ç»œã€‘é¦–å¸­å·¥ç¨‹å¸ˆ<br>1021, priority  [praÉªâ€™É”rÉ™ti]<br>n. ä¼˜å…ˆï¼›ä¼˜å…ˆæƒï¼›[æ•°] ä¼˜å…ˆæ¬¡åºï¼›ä¼˜å…ˆè€ƒè™‘çš„äº‹<br>1022, Priority  [praÉªâ€™É’rÉªtÉª]<br>n. ä¼˜å…ˆï¼›ä¼˜å…ˆæƒï¼›[æ•°] ä¼˜å…ˆæ¬¡åºï¼›ä¼˜å…ˆè€ƒè™‘çš„äº‹<br>1023, proactive  [prÉ™ÊŠâ€™Ã¦ktÉªv]<br>adj. å‰æ‘„çš„ï¼ˆå‰ä¸€æ´»åŠ¨ä¸­çš„å› ç´ å¯¹åä¸€æ´»åŠ¨é€ æˆå½±å“çš„ï¼‰ï¼›æœ‰å‰ç»æ€§çš„ï¼Œå…ˆè¡Œä¸€æ­¥çš„ï¼›ç§¯æä¸»åŠ¨çš„<br>1024, probe  [prÉ™ÊŠb]<br>n. æ¢é’ˆï¼›è°ƒæŸ¥<br>vi. è°ƒæŸ¥ï¼›æ¢æµ‹<br>vt. æ¢æŸ¥ï¼›ç”¨æ¢é’ˆæ¢æµ‹<br>n. (Probe)äººåï¼›(æ³•)æ™®ç½—å¸ƒ<br>1025, proceed  [proâ€™sid]<br>vi. å¼€å§‹ï¼›ç»§ç»­è¿›è¡Œï¼›å‘ç”Ÿï¼›è¡Œè¿›<br>n. æ”¶å…¥ï¼Œè·åˆ©<br>1026, Processing  [â€˜prÉ‘sÉ›s]<br>v. åŠ å·¥ï¼›[è‡ª] å¤„ç†ï¼›å¯¹â€¦èµ·è¯‰ï¼ˆprocessçš„ingå½¢å¼ï¼‰<br>1027, Processors  [prÉ”:â€™sesÉ™z]<br>n. [è®¡] å¤„ç†å™¨ï¼Œ[è®¡] å¤„ç†æœºï¼ˆprocessorå¤æ•°ï¼‰<br>1028, profile  [â€˜profaÉªl]<br>n. ä¾§é¢ï¼›è½®å»“ï¼›å¤–å½¢ï¼›å‰–é¢ï¼›ç®€å†µ<br>vt. æâ€¦çš„è½®å»“ï¼›æ‰¼è¦æè¿°<br>vi. ç»™å‡ºè½®å»“<br>1029, profiled  []<br>v.æç»˜â€¦è½®å»“ï¼Œè¯„è®ºäººç‰©ï¼ˆprofileçš„è¿‡å»å¼ï¼‰<br>1030, progressively  [prÉ™â€™É¡rÉ›sÉªvli]<br>adv. æ¸è¿›åœ°ï¼›æ—¥ç›Šå¢å¤šåœ°<br>1031, projection  [prÉ™â€™dÊ’É›kÊƒÉ™n]<br>n. æŠ•å°„ï¼›è§„åˆ’ï¼›çªå‡ºï¼›å‘å°„ï¼›æ¨æµ‹<br>1032, promote  [prÉ™â€™mÉ™ÊŠt]<br>vt. ä¿ƒè¿›ï¼›æå‡ï¼›æ¨é”€ï¼›å‘æ‰¬<br>vi. æˆä¸ºç‹åæˆ–å…¶ä»–å¤§äºå’çš„å­<br>1033, pronounce  [prÉ™â€™naÊŠns]<br>vt. å‘éŸ³ï¼›å®£åˆ¤ï¼›æ–­è¨€;<br>vi. å‘éŸ³ï¼›ä½œå‡ºåˆ¤æ–­<br>1034, propagation  [,prÉ’pÉ™â€™É¡eÉªÊƒÉ™n]<br>n. ä¼ æ’­ï¼›ç¹æ®–ï¼›å¢æ®–<br>1035, PROPAGATION  [,prÉ’pÉ™â€™É¡eÉªÊƒÉ™n]<br>n. ä¼ æ’­ï¼›ç¹æ®–ï¼›å¢æ®–<br>1036, proper  [â€˜prÉ‘pÉš]<br>adj. é€‚å½“çš„ï¼›æœ¬èº«çš„ï¼›ç‰¹æœ‰çš„ï¼›æ­£æ´¾çš„<br>adv. å®Œå…¨åœ°<br>n. (Proper)äººåï¼›(è‹±ã€å¾·)æ™®ç½—ç€<br>1037, proportional  [prÉ™â€™pÉ”ËÊƒ(É™)n(É™)l]<br>adj. æ¯”ä¾‹çš„ï¼Œæˆæ¯”ä¾‹çš„ï¼›ç›¸ç§°çš„ï¼Œå‡è¡¡çš„;<br>n. [æ•°] æ¯”ä¾‹é¡¹<br>1038, proposal  [prÉ™â€™pÉ™ÊŠz(É™)l]<br>n. æè®®ï¼Œå»ºè®®ï¼›æ±‚å©š<br>1039, prospector  [prÉ™ÊŠâ€™spektÉ™]<br>n. æ¢å‹˜è€…ï¼›é‡‡çŸ¿è€…<br>1040, protocol  [â€˜prÉ™ÊŠtÉ™kÉ’l]<br>n. åè®®ï¼›è‰æ¡ˆï¼›ç¤¼ä»ª;<br>vt. æ‹Ÿå®š;<br>vi. æ‹Ÿå®š<br>1041, Protocol  [â€˜prÉ™ÊŠtÉ™kÉ’l]<br>n. åè®®ï¼›è‰æ¡ˆï¼›ç¤¼ä»ª;<br>vt. æ‹Ÿå®š;<br>vi. æ‹Ÿå®š<br>1042, provision  [prÉ™â€™vÉªÊ’(É™)n]<br>n. è§„å®šï¼›æ¡æ¬¾ï¼›å‡†å¤‡ï¼›[ç»] ä¾›åº”å“<br>vt. ä¾›ç»™â€¦é£Ÿç‰©åŠå¿…éœ€å“<br>1043, proxy  [â€˜prÉ’ksÉª]<br>n. ä»£ç†äººï¼›å§”æ‰˜ä¹¦ï¼›ä»£ç”¨å“<br>1044, prune  [pruËn]<br>vi. åˆ é™¤ï¼›å‡å°‘<br>vt. ä¿®å‰ªï¼›åˆ é™¤ï¼›å‰ªå»<br>n. æ·±ç´«çº¢è‰²ï¼›å‚»ç“œï¼›æå­å¹²<br>n. (Prune)äººåï¼›(ç½—)æ™®é²å†…<br>1045, pseudo  [â€˜sjuËdÉ™ÊŠ]<br>n. ä¼ªå›å­ï¼›å‡å†’çš„äºº;<br>adj. å†’å……çš„ï¼Œå‡çš„<br>1046, pump  [pÊŒmp]<br>vt. æ‰“æ°”ï¼›ç”¨æŠ½æ°´æœºæŠ½â€¦</p><p>n. æ³µï¼ŒæŠ½æ°´æœºï¼›æ‰“æ°”ç­’</p><p>vi. æŠ½æ°´</p><p>n. (Pump)äººåï¼›(æ·)è“¬æ™®ï¼›(è‹±)åºæ™®<br>1047, punch above  [punch+above]<br>è¶…è¶Š<br>1048, punctuation  [â€˜pÊŒÅ‹ktÊƒÊŠâ€™eÊƒÉ™n]<br>n. æ ‡ç‚¹ï¼›æ ‡ç‚¹ç¬¦å·<br>1049, puppet  [â€˜pÊŒpÉªt]<br>n. æœ¨å¶ï¼›å‚€å„¡ï¼›å—ä»–äººæ“çºµçš„äºº<br>1050, Purchase  [â€˜pÉœ:tÊƒÉ™s]<br>n. è´­ä¹°ï¼›ç´§æ¡ï¼›èµ·é‡è£…ç½®;<br>vt. è´­ä¹°ï¼›èµ¢å¾—;<br>vi. è´­ä¹°ä¸œè¥¿<br>1051, purge  [pÉdÊ’]<br>vi. å‡€åŒ–ï¼›é€šä¾¿<br>vt. å‡€åŒ–ï¼›æ¸…æ´—ï¼›é€šä¾¿<br>n. å‡€åŒ–ï¼›æ³»è¯<br>1052, puzzle  [â€˜pÊŒzl]<br>vt. ä½¿â€¦å›°æƒ‘ï¼›ä½¿â€¦ä¸ºéš¾ï¼›è‹¦æ€è€Œå¾—å‡º<br>vi. è¿·æƒ‘ï¼›å†¥æ€è‹¦æƒ³<br>n. è°œï¼›éš¾é¢˜ï¼›è¿·æƒ‘<br>1053, quack  [kwÃ¦k]<br>n. åº¸åŒ»ï¼›é¸­å«å£°<br>vi. ï¼ˆé¸­å­ï¼‰å˜å˜å«ï¼›å¹å˜˜ï¼›å¤§å£°é—²èŠ<br>adj. éª—äººçš„ï¼›å†’ç‰ŒåŒ»ç”Ÿçš„<br>n. (Quack)äººåï¼›(å¾·)å¤¸å…‹<br>1054, qualifier  [â€˜kwÉ’lÉªfaÉªÉ™(r)]<br>n. [è¯­] ä¿®é¥°è¯­<br>n. èµ„æ ¼èµ›ï¼Œé¢„é€‰èµ›ï¼›å–å¾—èµ„æ ¼çš„äºº<br>1055, quantile<br>n. [è®¡] åˆ†ä½æ•°ï¼›åˆ†ä½ç‚¹<br>1056, Quantity  [â€˜kwÉ’ntÉªtÉª]<br>n. é‡ï¼Œæ•°é‡ï¼›å¤§é‡ï¼›æ€»é‡<br>1057, quiescent  [kwÉªâ€™É›snt]<br>adj. é™æ­¢çš„ï¼›ä¸æ´»åŠ¨çš„ï¼›æ²‰å¯‚çš„<br>1058, quorum  [â€˜kwÉ”rÉ™m]<br>n. æ³•å®šäººæ•°<br>1059, rack  [rÃ¦k]<br>n. [æœº] é½¿æ¡ï¼›æ¶å­ï¼›æ‹·é—®å°</p><p>vi. å˜å½¢ï¼›éšé£é£˜ï¼›å°æ­¥è·‘</p><p>vt. æŠ˜ç£¨ï¼›æ¦¨å–</p><p>n. (Rack)äººåï¼›(æ³•ã€å¾·ã€æ„ã€åŒˆ)æ‹‰å…‹<br>1060, radically  [â€˜rÃ¦dÉªkli]<br>adv. æ ¹æœ¬ä¸Šï¼›å½»åº•åœ°ï¼›ä»¥æ¿€è¿›çš„æ–¹å¼<br>1061, radius  [â€˜reÉªdÉªÉ™s]<br>n. åŠå¾„ï¼ŒåŠå¾„èŒƒå›´ï¼›[è§£å‰–] æ¡¡éª¨ï¼›è¾å°„å…‰çº¿ï¼›æœ‰æ•ˆèˆªç¨‹;<br>n. (Radius)äººåï¼›(æ„ã€å°å°¼)æ‹‰è¿ªä¹Œæ–¯ï¼›(è‹±)é›·è¿ªå„æ–¯ï¼›(æ³•)æ‹‰è¿ªäºæ–¯<br>1062, raft  [rÉ‘Ëft]<br>n. ç­ï¼›æ•‘ç”Ÿè‰‡ï¼›ï¼ˆç¾ï¼‰å¤§é‡<br>vt. ç­è¿ï¼›åˆ¶æˆç­<br>vi. ä¹˜ç­<br>n. (Raft)äººåï¼›(åŒˆã€ç‘å…¸)æ‹‰å¤«ç‰¹<br>1063, raid  [reÉªd]<br>n. è¢­å‡»ï¼›çªè¢­ï¼›æœæ•ï¼›æŠ¢åŠ«<br>vi. çªè¢­<br>vt. è¢­å‡»ï¼Œçªè¢­<br>n. (Raid)äººåï¼›(é˜¿æ‹‰ä¼¯)æ‹‰ä¼Šå¾·<br>1064, rake  [rek]<br>vi. æœç´¢ï¼›ç”¨è€™å­è€™ï¼›æ è¿‡ï¼Œæ“¦è¿‡<br>vt. å€¾æ–œï¼›æœç´¢ï¼›æ è¿‡ï¼›ç”¨è€™å­è€™<br>n. è€™å­ï¼›æ–œåº¦ï¼›é’±è€™ï¼›æ”¾è¡çš„äººï¼Œæµªå­<br>n. (Rake)äººåï¼›(è‹±)é›·å…‹ï¼›(å¡)æ‹‰å‡¯<br>1065, rally  [â€˜rÃ¦lÉª]<br>vi. å›¢ç»“ï¼›é‡æ•´ï¼›æ¢å¤ï¼›ï¼ˆç½‘çƒç­‰ï¼‰è¿ç»­å¯¹æ‰“</p><p>vt. å›¢ç»“ï¼›é›†åˆï¼›æ¢å¤å¥åº·ã€åŠ›é‡ç­‰</p><p>n. é›†ä¼šï¼›å›å¤ï¼›å…¬è·¯èµ›è½¦ä¼š</p><p>n. (Rally)äººåï¼›(ç½—)æ‹‰åˆ©<br>1066, rancher  [â€˜rÃ¦ntÊƒÉš]<br>n. å¤§å†œåœºç»è¥è€…ï¼›å¤§å†œåœºå·¥äºº<br>n. (Rancher)äººåï¼›(æ„)å…°å‡¯å°”<br>1067, Range  [reÉªn(d)Ê’]<br>n. èŒƒå›´ï¼›å¹…åº¦ï¼›æ’ï¼›å±±è„‰;<br>vi. å¹³è¡Œï¼Œåˆ—ä¸ºä¸€è¡Œï¼›å»¶ä¼¸ï¼›æ¼«æ¸¸ï¼›å°„ç¨‹è¾¾åˆ°;<br>vt. æ¼«æ¸¸ï¼›æ”¾ç‰§ï¼›ä½¿å¹¶åˆ—ï¼›å½’ç±»äºï¼›æ¥å›èµ°åŠ¨;<br>n. (Range)äººåï¼›(è‘¡)å…°çƒ­ï¼›(ç‘å…¸ã€å¾·)æœ—æ ¼<br>1068, rare  [reÉ™]<br>adj. ç¨€æœ‰çš„ï¼›ç¨€è–„çš„ï¼›åŠç†Ÿçš„<br>adj. æ°å‡ºçš„ï¼›æåº¦çš„ï¼›éå¸¸å¥½çš„<br>adv. éå¸¸ï¼›æå…¶<br>vi. ç”¨åè…¿ç«™èµ·ï¼›æ¸´æœ›<br>1069, rather  [â€˜rÉ‘ËÃ°É™]<br>adv. å®å¯ï¼Œå®æ„¿ï¼›ç›¸å½“;<br>int. å½“ç„¶å•¦ï¼ˆå›ç­”é—®é¢˜æ—¶ç”¨ï¼‰;<br>n. (Rather)äººåï¼›(è‹±)æ‹‰ç‘Ÿ<br>1070, raw  [rÉ”Ë]<br>adj. ç”Ÿçš„ï¼›æœªåŠ å·¥çš„ï¼›é˜´å†·çš„ï¼›åˆºç—›çš„ï¼›æ“¦æ‰çš®çš„ï¼›æ— ç»éªŒçš„ï¼›ï¼ˆåœ¨è‰ºæœ¯ç­‰æ–¹é¢ï¼‰ä¸æˆç†Ÿçš„;<br>n. æ“¦ä¼¤å¤„;<br>vt. æ“¦ä¼¤;<br>n. (Raw)äººåï¼›(è‹±)ç½—<br>1071, Raw  [rÉ”Ë]<br>adj. ç”Ÿçš„ï¼›æœªåŠ å·¥çš„ï¼›é˜´å†·çš„ï¼›åˆºç—›çš„ï¼›æ“¦æ‰çš®çš„ï¼›æ— ç»éªŒçš„ï¼›ï¼ˆåœ¨è‰ºæœ¯ç­‰æ–¹é¢ï¼‰ä¸æˆç†Ÿçš„;<br>n. æ“¦ä¼¤å¤„;<br>vt. æ“¦ä¼¤;<br>n. (Raw)äººåï¼›(è‹±)ç½—<br>1072, react  [rÉªâ€™Ã¦kt]<br>vi. ååº”ï¼›å½±å“ï¼›åæŠ—ï¼›èµ·åä½œç”¨;<br>vt. ä½¿å‘ç”Ÿç›¸äº’ä½œç”¨ï¼›ä½¿èµ·åŒ–å­¦ååº”<br>1073, Reactive  [rÉªâ€™Ã¦ktÉªv]<br>adj. ååº”çš„ï¼›ç”µæŠ—çš„ï¼›ååŠ¨çš„<br>1074, realistic  [rÉªÉ™â€™lÉªstÉªk]<br>adj. ç°å®çš„ï¼›ç°å®ä¸»ä¹‰çš„ï¼›é€¼çœŸçš„ï¼›å®åœ¨è®ºçš„<br>1075, realm  [relm]<br>n. é¢†åŸŸï¼ŒèŒƒå›´ï¼›ç‹å›½<br>1076, Realm  [relm]<br>n. é¢†åŸŸï¼ŒèŒƒå›´ï¼›ç‹å›½<br>1077, receiver  [rÉªâ€™siËvÉ™]<br>n. æ¥æ”¶å™¨ï¼›æ¥å—è€…ï¼›æ”¶ä¿¡æœºï¼›æ”¶æ¬¾å‘˜ï¼Œæ¥å¾…è€…<br>1078, reciprocate  [rÉªâ€™sÉªprÉ™keÉªt]<br>vt. æŠ¥ç­”ï¼›äº’æ¢ï¼›äº’ç»™<br>vi. å¾€å¤è¿åŠ¨ï¼›äº’æ¢ï¼›é…¬ç­”ï¼›äº’ç»™<br>1079, reclamation  [,reklÉ™â€™meÉªÊƒÉ™n]<br>n. å¼€å¦ï¼›æ”¶å›ï¼›å†åˆ©ç”¨ï¼›çŸ«æ­£<br>1080, recognition  [rekÉ™gâ€™nÉªÊƒ(É™)n]<br>n. è¯†åˆ«ï¼›æ‰¿è®¤ï¼Œè®¤å‡ºï¼›é‡è§†ï¼›èµèª‰ï¼›å…¬è®¤<br>1081, recommend  [rekÉ™â€™mend]<br>vt. æ¨èï¼Œä»‹ç»ï¼›åŠå‘Šï¼›ä½¿å—æ¬¢è¿ï¼›æ‰˜ä»˜;<br>vi. æ¨èï¼›å»ºè®®<br>1082, reconcile  [â€˜rÉ›kÉ™nsaÉªl]<br>vt. ä½¿ä¸€è‡´ï¼›ä½¿å’Œè§£ï¼›è°ƒåœï¼Œè°ƒè§£ï¼›ä½¿é¡ºä»<br>1083, recruiter  [rÉªâ€™kruËtÉ™]<br>n. æ‹›è˜äººå‘˜ï¼Œå¾å…µäººå‘˜<br>1084, rectangle  [â€˜rektÃ¦Å‹g(É™)l]<br>n. çŸ©å½¢ï¼›é•¿æ–¹å½¢<br>1085, rectify  [â€˜rektÉªfaÉª]<br>vt. æ”¹æ­£ï¼›ç²¾é¦ï¼›æ•´æµ<br>1086, recurse<br>n. é€’å½’ï¼ˆç®—æ³•ï¼‰<br>v. é€’å½’<br>1087, recursion  [rÉªâ€™kÉœËÊƒ(É™)n]<br>n. [æ•°] é€’å½’ï¼Œå¾ªç¯ï¼›é€’å½’å¼<br>1088, recursive  [rÉªâ€™kÉœËsÉªv]<br>adj. [æ•°] é€’å½’çš„ï¼›å¾ªç¯çš„<br>1089, Reduce  [rÉªâ€™djuËs]<br>vt. å‡å°‘ï¼›é™ä½ï¼›ä½¿å¤„äºï¼›æŠŠâ€¦åˆ†è§£;<br>vi. å‡å°‘ï¼›ç¼©å°ï¼›å½’çº³ä¸º<br>1090, redundant  [rÉªâ€™dÊŒnd(É™)nt]<br>adj. å¤šä½™çš„ï¼Œè¿‡å‰©çš„ï¼›è¢«è§£é›‡çš„ï¼Œå¤±ä¸šçš„ï¼›å†—é•¿çš„ï¼Œç´¯èµ˜çš„<br>1091, ReentrantLock<br>é‡å…¥é”<br>1092, reflexive  [rÉªâ€™fleksÉªv]<br>n. åèº«ä»£è¯ï¼›åèº«åŠ¨è¯;<br>adj. åèº«çš„ï¼›[ç‰©] åå°„çš„<br>1093, regardless  [rÉªâ€™gÉ‘ËdlÉªs]<br>adj. ä¸ç®¡çš„ï¼›ä¸é¡¾çš„ï¼›ä¸æ³¨æ„çš„;<br>adv. ä¸é¡¾åæœåœ°ï¼›ä¸ç®¡æ€æ ·ï¼Œæ— è®ºå¦‚ä½•ï¼›ä¸æƒœè´¹ç”¨åœ°<br>1094, regardless of<br>ä¸é¡¾ï¼Œä¸ç®¡<br>regardless of: ä¸é¡¾ | ä¸ç®¡ | ä¸æƒœ<br>1095, register  [â€˜rÉ›dÊ’ÉªstÉš]<br>vt. ç™»è®°ï¼›æ³¨å†Œï¼›è®°å½•ï¼›æŒ‚å·é‚®å¯„ï¼›æŠŠâ€¦æŒ‚å·ï¼›æ­£å¼æå‡º vi. ç™»è®°ï¼›æ³¨å†Œï¼›æŒ‚å· n. ç™»è®°ï¼›æ³¨å†Œï¼›è®°å½•ï¼›å¯„å­˜å™¨ï¼›ç™»è®°ç°¿ n. (Register)äººåï¼›(è‹±)é›·å‰æ–¯ç‰¹<br>1096, registry  [â€˜rÉ›dÊ’Éªstri]<br>n. æ³¨å†Œï¼›ç™»è®°å¤„ï¼›æŒ‚å·å¤„ï¼›èˆ¹èˆ¶çš„å›½ç±<br>1097, regular  [â€˜regjÊŠlÉ™]<br>adj. å®šæœŸçš„ï¼›æœ‰è§„å¾‹çš„ï¼›åˆæ ¼çš„ï¼›æ•´é½çš„ï¼›æ™®é€šçš„</p><p>n. å¸¸å®¢ï¼›æ­£å¼é˜Ÿå‘˜ï¼›ä¸­åšåˆ†å­</p><p>adv. å®šæœŸåœ°ï¼›ç»å¸¸åœ°</p><p>n. (Regular)äººåï¼›(ä»¥)é›·å¤æ‹‰å°”<br>1098, reinforce  [riËÉªnâ€™fÉ”Ës]<br>vt. åŠ å¼ºï¼ŒåŠ å›ºï¼›å¼ºåŒ–ï¼›è¡¥å……;<br>vi. æ±‚æ´ï¼›å¾—åˆ°å¢æ´ï¼›ç»™äºˆæ›´å¤šçš„æ”¯æŒ;<br>n. åŠ å¼ºï¼›åŠ å›ºç‰©ï¼›åŠ å›ºææ–™<br>1099, relevance  [â€˜rÉ›lÉ™vÉ™ns]<br>n. å…³è”ï¼›é€‚å½“ï¼›ä¸­è‚¯<br>1100, remedy  [â€˜remÉªdÉª]<br>vt. è¡¥æ•‘ï¼›æ²»ç–—ï¼›çº æ­£</p><p>n. è¡¥æ•‘ï¼›æ²»ç–—ï¼›èµ”å¿<br>1101, render  [â€˜rendÉ™]<br>vt. è‡´ä½¿ï¼›æå‡ºï¼›å®æ–½ï¼›ç€è‰²ï¼›ä»¥â€¦å›æŠ¥;<br>vi. ç»™äºˆè¡¥å¿;<br>n. æ‰“åº•ï¼›äº¤çº³ï¼›ç²‰åˆ·;<br>n. (Render)äººåï¼›(è‹±ã€å¾·)ä¼¦å¾·å°”<br>1102, rendering  [â€˜rend(É™)rÉªÅ‹]<br>n. ç¿»è¯‘ï¼›è¡¨ç°ï¼›è¡¨æ¼”ï¼›æå†™ï¼›æ‰“åº•ï¼›ï¼ˆå»ºç­‘ç‰©ç­‰ï¼‰é€è§†å›¾<br>vt. è‡´ä½¿ï¼›è¡¨æ¼”ï¼›æ‰“åº•ï¼ˆrenderçš„ingå½¢å¼ï¼‰<br>vi. ç»™äºˆè¡¥å¿ï¼ˆrenderçš„ingå½¢å¼ï¼‰<br>1103, renouncement  [renouncement]<br>n. å¦è®¤ï¼›æ‹’ç»ï¼›æ”¾å¼ƒ<br>1104, replica  [â€˜rÉ›plÉªkÉ™]<br>n. å¤åˆ¶å“ï¼Œå¤åˆ¶ç‰©<br>1105, replicas  [replicas]<br>[å¤] å¤åˆ¶å“<br>å¤å‹<br>1106, repository  [rÉªâ€™pÉ’zÉªt(É™)rÉª]<br>n. è´®è—å®¤ï¼Œä»“åº“ï¼›çŸ¥è¯†åº“ï¼›æ™ºå›Šå›¢<br>1107, represent  [reprÉªâ€™zent]<br>vt. ä»£è¡¨ï¼›è¡¨ç°ï¼›æç»˜ï¼›å›å¿†ï¼›å†èµ é€<br>vi. ä»£è¡¨ï¼›æå‡ºå¼‚è®®<br>1108, representation  [,reprÉªzenâ€™teÉªÊƒ(É™)n]<br>n. ä»£è¡¨ï¼›è¡¨ç°ï¼›è¡¨ç¤ºæ³•ï¼›é™ˆè¿°<br>1109, REQUIRED  [rÉªâ€™kwaÉªÉ™d]<br>adj. å¿…éœ€çš„ï¼›ï¼ˆç¾ï¼‰å¿…ä¿®çš„;<br>v. éœ€è¦ï¼ˆrequireçš„è¿‡å»å¼åŠè¿‡å»åˆ†è¯å½¢å¼ï¼‰ï¼›è¦æ±‚<br>1110, reroute  [riËâ€™ruËt]<br>vt. å˜æ›´æ—…ç¨‹ï¼›æŒ‰æ–°çš„ç‰¹å®šè·¯çº¿è¿é€<br>1111, rescue  [â€˜reskjuË]<br>vt. è¥æ•‘ï¼›æ´æ•‘;<br>n. è¥æ•‘ï¼›æ´æ•‘ï¼›è§£æ•‘<br>1112, reservation  [rezÉ™â€™veÉªÊƒ(É™)n]<br>n. é¢„çº¦ï¼Œé¢„è®¢ï¼›ä¿ç•™<br>1113, reservoir  [â€˜rÉ›zÉš,vÉ”r]<br>n. æ°´åº“ï¼›è“„æ°´æ± <br>1114, resilience  [rÉªâ€™zÉªlÉªÉ™ns]<br>n. æ¢å¤åŠ›ï¼›å¼¹åŠ›ï¼›é¡ºåº”åŠ›<br>1115, resiliency  [rÉªâ€™zÉªlÉªÉ™nsÉª]<br>n. å¼¹æ€§ï¼›è·³å›<br>1116, Resiliency  [rÉªâ€™zÉªlÉªÉ™nsÉª]<br>n. å¼¹æ€§ï¼›è·³å›<br>1117, resilient  [rÉªâ€™zÉªlÉªÉ™nt]<br>adj. å¼¹å›çš„ï¼Œæœ‰å¼¹åŠ›çš„<br>adj. èƒ½å¤åŸçš„ï¼›æœ‰å¤åŸåŠ›çš„<br>1118, resist  [rÉªâ€™zÉªst]<br>vi. æŠµæŠ—ï¼ŒæŠ—æ‹’ï¼›å¿è€;<br>vt. æŠµæŠ—ï¼›å¿è€ï¼Œå¿ä½;<br>n. [åŠ©å‰‚] æŠ—èš€å‰‚ï¼›é˜²æŸ“å‰‚<br>1119, resolute  [â€˜rezÉ™luËt]<br>adj. åšå†³çš„ï¼›æœæ–­çš„<br>1120, resolution  [,rÉ›zÉ™â€™luÊƒÉ™n]<br>n. [ç‰©] åˆ†è¾¨ç‡ï¼›å†³è®®ï¼›è§£å†³ï¼›å†³å¿ƒ<br>1121, resolve  [rÉªâ€™zÉ’lv]<br>vt. å†³å®šï¼›æº¶è§£ï¼›ä½¿â€¦åˆ†è§£ï¼›å†³å¿ƒè¦åšâ€¦;<br>vi. è§£å†³ï¼›å†³å¿ƒï¼›åˆ†è§£;<br>n. åšå†³ï¼›å†³å®šè¦åšçš„äº‹<br>1122, resolved  [rÉªâ€™zÉ’lvd]<br>adj. ä¸‹å®šå†³å¿ƒçš„ï¼›å·²è§£å†³çš„ï¼›æ–­ç„¶çš„;<br>v. è§£å†³ï¼›å†³å®šï¼›åˆ†è§£ï¼›è½¬å˜ï¼ˆresolveçš„è¿‡å»åˆ†è¯ï¼‰<br>1123, Resolved  [rÉªâ€™zÉ’lvd]<br>adj. ä¸‹å®šå†³å¿ƒçš„ï¼›å·²è§£å†³çš„ï¼›æ–­ç„¶çš„;<br>v. è§£å†³ï¼›å†³å®šï¼›åˆ†è§£ï¼›è½¬å˜ï¼ˆresolveçš„è¿‡å»åˆ†è¯ï¼‰<br>1124, Resolver  [riËâ€™zÉ’lvÉ™]<br>n. æº¶å‰‚ï¼›[ç”µå­] åˆ†è§£å™¨ï¼›ä¸‹å†³å¿ƒè€…<br>1125, respect  [rÉªâ€™spekt]<br>n. å°Šæ•¬ï¼Œå°Šé‡ï¼›æ–¹é¢ï¼›æ•¬æ„;<br>vt. å°Šæ•¬ï¼Œå°Šé‡ï¼›éµå®ˆ<br>1126, response  [rÉªâ€™spÉ’ns]<br>n. å“åº”ï¼›ååº”ï¼›å›ç­”<br>1127, responsible  [rÉªâ€™spÉ’nsÉªb(É™)l]<br>adj. è´Ÿè´£çš„ï¼Œå¯é çš„ï¼›æœ‰è´£ä»»çš„<br>1128, responsive  [rÉªâ€™spÉ’nsÉªv]<br>adj. å“åº”çš„ï¼›åº”ç­”çš„ï¼›å›ç­”çš„<br>1129, restored  [riâ€™stÉ”:d]<br>adj. ç²¾åŠ›å……æ²›çš„ï¼›ç²¾åŠ›æ¢å¤çš„;<br>v. ä¿®å¤ï¼ˆrestoreçš„è¿‡å»å¼ï¼‰ï¼›æ¢å¤å¥åº·<br>1130, restrict  [rÉªâ€™strÉªkt]<br>vt. é™åˆ¶ï¼›çº¦æŸï¼›é™å®š<br>1131, restriction  [rÉªâ€™strÉªkÊƒ(É™)n]<br>n. é™åˆ¶ï¼›çº¦æŸï¼›æŸç¼š<br>1132, retention  [rÉªâ€™tenÊƒ(É™)n]<br>n. ä¿ç•™ï¼›æ‰£ç•™ï¼Œæ»ç•™ï¼›è®°å¿†åŠ›ï¼›é—­å°¿<br>1133, Retention  [rÉªâ€™tenÊƒ(É™)n]<br>n. ä¿ç•™ï¼›æ‰£ç•™ï¼Œæ»ç•™ï¼›è®°å¿†åŠ›ï¼›é—­å°¿<br>1134, retrieval  [rÉªâ€™triËvl]<br>n. æ£€ç´¢ï¼›æ¢å¤ï¼›å–å›ï¼›æ‹¯æ•‘<br>1135, retrieve  [rÉªâ€™triËv]<br>vt. [è®¡] æ£€ç´¢ï¼›æ¢å¤ï¼›é‡æ–°å¾—åˆ°;<br>vi. æ‰¾å›çŒç‰©;<br>n. [è®¡] æ£€ç´¢ï¼›æ¢å¤ï¼Œå–å›<br>1136, Retype  [ri:â€™taip]<br>vt. é‡æ–°è¾“å…¥<br>1137, Reuse  [riËâ€™juËz]<br>n. é‡æ–°ä½¿ç”¨ï¼Œå†ç”¨;<br>vt. å†ä½¿ç”¨<br>1138, revision  [rÉªâ€™vÉªÊ’(É™)n]<br>n. [å°åˆ·] ä¿®æ­£ï¼›å¤ä¹ ï¼›ä¿®è®¢æœ¬<br>1139, revisions  []<br>n. æ ¡è®¢ï¼Œ[å°åˆ·] ä¿®æ­£ï¼›å¤ä¹ ï¼ˆrevisionçš„å¤æ•°å½¢å¼ï¼‰<br>1140, revoke  [rÉªâ€™vÉ™ÊŠk]<br>vt. æ’¤å›ï¼Œå–æ¶ˆï¼›åºŸé™¤</p><p>vi. æœ‰ç‰Œä¸è·Ÿ</p><p>n. æœ‰ç‰Œä¸è·Ÿ<br>1141, rewind  [,riâ€™waÉªnd]<br>n. é‡ç»•ï¼›å€’å¸¦å™¨<br>vt. å€’å›ï¼›é‡ç»•<br>vi. å€’å›ï¼›é‡ç»•<br>1142, rid  [rÉªd]<br>vt. ä½¿æ‘†è„±ï¼›ä½¿å»æ‰;<br>n. (Rid)äººåï¼›(è‹±)é‡Œå¾·<br>1143, riddle  [â€˜rÉªdl]<br>vt. è§£è°œï¼›ç»™â€¦å‡ºè°œï¼›å……æ»¡äº<br>n. è°œè¯­ï¼›ç²—ç­›ï¼›è°œä¸€èˆ¬çš„äººã€ä¸œè¥¿ã€äº‹æƒ…ç­‰<br>vi. å‡ºè°œ<br>n. (Riddle)äººåï¼›(è‹±)é‡Œå¾·å°”<br>1144, ridiculous  [rÉªâ€™dÉªkjÊŠlÉ™s]<br>adj. å¯ç¬‘çš„ï¼›è’è°¬çš„<br>1145, rigid  [â€˜rÉªdÊ’Éªd]<br>adj. ä¸¥æ ¼çš„ï¼›åƒµç¡¬çš„ï¼Œæ­»æ¿çš„ï¼›åšç¡¬çš„ï¼›ç²¾ç¡®çš„<br>1146, rigorously  [â€˜rigÉ™rÉ™sli]<br>adv.ä¸¥å‰åœ°ï¼›æ®‹é…·åœ°<br>1147, ripped  [rÉªpt]<br>adj. å–é†‰çš„ï¼›å—æ¯’å“éº»é†‰çš„;<br>v. æ’•ï¼›æ‰¯ï¼ˆripçš„è¿‡å»åˆ†è¯ï¼‰<br>1148, rival  [â€˜raÉªvl]<br>n. å¯¹æ‰‹ï¼›ç«äº‰è€…;<br>vt. ä¸â€¦ç«äº‰ï¼›æ¯”å¾—ä¸ŠæŸäºº;<br>vi. ç«äº‰;<br>adj. ç«äº‰çš„;<br>n. (Rival)äººåï¼›(è‹±ã€æ³•ã€è¥¿)é‡Œç“¦å°”<br>1149, robust  [rÉ™(ÊŠ)â€™bÊŒst]<br>adj. å¼ºå¥çš„ï¼›å¥åº·çš„ï¼›ç²—é‡çš„ï¼›ç²—é²çš„<br>1150, role  [rÉ™ÊŠl]<br>n. è§’è‰²ï¼›ä»»åŠ¡;<br>n. (Role)äººåï¼›(æ„ã€å¡ã€èµ¤å‡ )ç½—è±<br>1151, rollover  [â€˜rolovÉš]<br>n. ç¿»è½¬ï¼›ï¼ˆè½¦ï¼‰ç¿»è¦†ï¼›å»¶æœŸä»˜æ¬¾<br>1152, rotate  [ËŒÃ¦plÉªâ€™keÉªÊƒ(É™)n]<br>n. åº”ç”¨ï¼›ç”³è¯·ï¼›åº”ç”¨ç¨‹åºï¼›æ•·ç”¨ï¼›ï¼ˆå¯¹äº‹ç‰©ã€å­¦ä¹ ç­‰ï¼‰æŠ•å…¥<br>1153, rotation  [roâ€™teÊƒÉ™n]<br>n. æ—‹è½¬ï¼›å¾ªç¯ï¼Œè½®æµ<br>1154, routes<br>n. [è®¡] è·¯ç”±ï¼Œ[é€šä¿¡] è·¯å¾„ï¼›[äº¤] çº¿è·¯<br>1155, rush  [rÊŒÊƒ]<br>n. å†²è¿›ï¼›åŒ†ä¿ƒï¼›æ€¥æµï¼›ç¯å¿ƒè‰</p><p>adj. æ€¥éœ€çš„</p><p>vt. ä½¿å†²ï¼›çªè¢­ï¼›åŒ†å¿™åœ°åšï¼›é£è·ƒ</p><p>vi. å†²ï¼›å¥”ï¼›é—¯ï¼›èµ¶ç´§ï¼›æ¶Œç°</p><p>n. (Rush)äººåï¼›(è‹±)æ‹‰ä»€<br>1156, saber  [â€˜seÉªbÉ™]<br>n. å†›åˆ€ï¼›ä½©å‰‘ï¼›éª‘å…µ<br>vt. ç”¨é©¬åˆ€ç æˆ–æ€<br>n. (Saber)äººåï¼›(æ³•)è¨è´ï¼›(é˜¿æ‹‰ä¼¯)è¨æ¯”å°”<br>1157, sacrifice  [â€˜sÃ¦krÉªfaÉªs]<br>n. ç‰ºç‰²ï¼›ç¥­å“ï¼›ä¾›å¥‰<br>vt. ç‰ºç‰²ï¼›çŒ®ç¥­ï¼›äºæœ¬å‡ºå”®<br>vi. çŒ®ç¥­ï¼›å¥‰çŒ®<br>1158, sage  [seÉªdÊ’]<br>n.åœ£äººï¼›è´¤äººï¼›å“²äºº<br>adj.æ˜æ™ºçš„ï¼›è´¤æ˜çš„ï¼›å®¡æ…çš„<br>n.(Sage)äººåï¼›(æ—¥)ä¸‰ä¸‹(å§“)ï¼›(è‹±)å¡å¥‡ï¼›(æ„)è¨æ°ï¼›(å¾·)æ‰æ ¼ï¼›(æ³•)è¨çƒ­<br>1159, sake  [seÉªk]<br>n. ç›®çš„ï¼›åˆ©ç›Šï¼›ç†ç”±ï¼›æ—¥æœ¬ç±³é…’<br>n. (Sake)äººåï¼›(ç½—)è¨å…‹ï¼›(æ—¥)é…’(å§“)<br>1160, salt  [sÉ”lt]<br>n. ç›ï¼›é£è¶£ï¼Œåˆºæ¿€æ€§<br>adj. å’¸æ°´çš„ï¼›å«ç›çš„ï¼Œå’¸å‘³çš„ï¼›ç›è…Œçš„ï¼›çŒ¥äºµçš„<br>vt. ç”¨ç›è…Œï¼›ç»™â€¦åŠ ç›ï¼›å°†ç›æ’’åœ¨é“è·¯ä¸Šä½¿å†°æˆ–é›ªèåŒ–<br>n. (Salt)äººåï¼›(è¥¿)è¨å°”ç‰¹ï¼›(è‹±)ç´¢å°”ç‰¹<br>1161, salty  [â€˜sÉ”ËltÉª; â€˜sÉ’-]<br>adj. å’¸çš„ï¼›å«ç›çš„<br>1162, salute  [sÉ™â€™l(j)uËt]<br>n. è‡´æ•¬ï¼Œæ¬¢è¿ï¼›æ•¬ç¤¼;<br>vt. è¡Œç¤¼è‡´æ•¬ï¼Œæ¬¢è¿;<br>vi. è‡´æ„ï¼Œæ‰“æ‹›å‘¼ï¼›è¡Œç¤¼<br>1163, sanitize<br>vt. ä½¿â€¦æ— å®³ï¼›ç»™â€¦æ¶ˆæ¯’ï¼›å¯¹â€¦é‡‡å–å«ç”Ÿæªæ–½<br>1164, sanitized  [sanitized]<br>v. æ¶ˆæ¯’ï¼›ä½¿æ¸…æ´ï¼ˆsanitizeçš„è¿‡å»å¼ï¼‰<br>1165, sanity  [â€˜sÃ¦nÉªtÉª]<br>n. æ˜æ™ºï¼›å¤´è„‘æ¸…æ¥šï¼›ç²¾ç¥å¥å…¨ï¼›é€šæƒ…è¾¾ç†<br>1166, saturate  [â€˜sÃ¦tÊƒÉ™rÉªt]<br>vt. æµ¸é€ï¼Œä½¿æ¹¿é€ï¼›ä½¿é¥±å’Œï¼Œä½¿å……æ»¡<br>adj. æµ¸é€çš„ï¼Œé¥±å’Œçš„ï¼›æ·±é¢œè‰²çš„<br>1167, saturated  [â€˜sÃ¦tÊƒÉ™reÉªtÉªd]<br>adj. é¥±å’Œçš„ï¼›æ¸—é€çš„ï¼›æ·±é¢œè‰²çš„</p><p>v. ä½¿æ¸—é€ï¼Œä½¿é¥±å’Œï¼ˆsaturateçš„è¿‡å»å¼ï¼‰<br>1168, saturation  [â€˜sÃ¦tÊƒÉ™â€™reÊƒÉ™n]<br>n. é¥±å’Œï¼›è‰²é¥±å’Œåº¦ï¼›æµ¸é€ï¼›ç£åŒ–é¥±å’Œ<br>1169, scalability  [,skeilÉ™â€™biliti]<br>n. å¯æ‰©å±•æ€§ï¼›å¯ä¼¸ç¼©æ€§ï¼›å¯é‡æµ‹æ€§<br>1170, scalable  [â€˜skelÉ™bl]<br>adj. å¯æ”€ç™»çš„ï¼›å¯å»é³çš„ï¼›å¯ç§°é‡çš„<br>1171, scale  [skeÉªl]<br>n. è§„æ¨¡ï¼›æ¯”ä¾‹ï¼›é³ï¼›åˆ»åº¦ï¼›å¤©å¹³ï¼›æ•°å€¼èŒƒå›´;<br>vi. è¡¡é‡ï¼›æ”€ç™»ï¼›å‰¥è½ï¼›ç”Ÿæ°´å¢;<br>vt. æµ‹é‡ï¼›æ”€ç™»ï¼›åˆ®é³ï¼›ä¾æ¯”ä¾‹å†³å®š;<br>n. (Scale)äººåï¼›(æ„)æ–¯å¡è±<br>1172, scarf  [skÉ‘Ëf]<br>n. å›´å·¾ï¼›åµŒæ¥ï¼ŒåµŒæ¥å¤„ï¼›å¤´å·¾é¢†å·¾;<br>vt. æŠ«åµŒæ¥ï¼›ç”¨å›´å·¾å›´;<br>n. (Scarf)äººåï¼›(è‹±)æ–¯å¡å¤«<br>1173, scenario  [sÉªâ€™nÉ‘ËrÉªÉ™ÊŠ]<br>n. æ–¹æ¡ˆï¼›æƒ…èŠ‚ï¼›å‰§æœ¬ï¼›è®¾æƒ³<br>1174, scenarios  [sÉªâ€™nÉ›rÉª,o]<br>n. æƒ…èŠ‚ï¼›è„šæœ¬ï¼›æƒ…æ™¯ä»‹ç»ï¼ˆscenarioçš„å¤æ•°ï¼‰<br>1175, scope  [skÉ™ÊŠp]<br>n. èŒƒå›´ï¼›ä½™åœ°ï¼›è§†é‡ï¼›çœ¼ç•Œï¼›å¯¼å¼¹å°„ç¨‹;<br>vt. å®¡è§†<br>1176, Scope  [skÉ™ÊŠp]<br>n. èŒƒå›´ï¼›ä½™åœ°ï¼›è§†é‡ï¼›çœ¼ç•Œï¼›å¯¼å¼¹å°„ç¨‹;<br>vt. å®¡è§†<br>1177, SCOPE  [skÉ™ÊŠp]<br>n. èŒƒå›´ï¼›ä½™åœ°ï¼›è§†é‡ï¼›çœ¼ç•Œï¼›å¯¼å¼¹å°„ç¨‹;<br>vt. å®¡è§†<br>1178, scrape  [skrep]<br>n. åˆ®æ‰ï¼›æ“¦ç—•ï¼›å›°å¢ƒï¼›åˆ®æ“¦å£°<br>vt. åˆ®ï¼›æ“¦ä¼¤ï¼›æŒ–æˆ<br>vi. åˆ®æ‰ï¼›åˆ®å‡ºåˆºè€³å£°<br>1179, scratch  [skrÃ¦tÊƒ]<br>n. æ“¦ä¼¤ï¼›æŠ“ç—•ï¼›åˆ®æ“¦å£°ï¼›ä¹±å†™;<br>adj. æ‰“è‰ç¨¿ç”¨çš„ï¼›å‡‘åˆçš„ï¼›ç¢°å·§çš„;<br>vt. æŠ“ï¼›åˆ®ï¼›æŒ–å‡ºï¼›ä¹±æ¶‚;<br>vi. æŠ“ï¼›æ”ï¼›å‘åˆ®æ“¦å£°ï¼›å‹‰å¼ºç³Šå£ï¼›é€€å‡ºæ¯”èµ›<br>1180, screened  [screened]<br>adj. ç­›è¿‡çš„ï¼Œå±è”½çš„<br>1181, screw  [skruË]<br>vt. æ—‹ï¼Œæ‹§ï¼›å‹æ¦¨ï¼›å¼ºè¿«<br>n. èºæ—‹ï¼›èºä¸é’‰ï¼›åå•¬é¬¼<br>vi. è½¬åŠ¨ï¼Œæ‹§<br>1182, scroll  [skrÉ™ÊŠl]<br>n. å·è½´ï¼Œç”»å·ï¼›åå†Œï¼›å·å½¢ç‰©;<br>vi. æˆå·å½¢;<br>vt. ä½¿æˆå·å½¢<br>1183, scum  [skÊŒm]<br>n. æµ®æ¸£ï¼›æ³¡æ²«ï¼›ç³Ÿç²•<br>vi. äº§ç”Ÿæ³¡æ²«ï¼›è¢«æµ®æ¸£è¦†ç›–<br>vt. å°†æµ®æ¸£å»é™¤æ‰<br>1184, segment  [â€˜segm(É™)nt]<br>vi. åˆ†å‰²;<br>n. æ®µï¼›éƒ¨åˆ†;<br>vt. åˆ†å‰²<br>1185, selfie  []<br>n. è‡ªæ‹ç…§<br>1186, semantics  [sÉªâ€™mÃ¦ntÉªks]<br>n. [è¯­] è¯­ä¹‰å­¦ï¼›è¯­ä¹‰è®º<br>1187, semaphore  [â€˜semÉ™fÉ”Ë]<br>vi. æ‰“æ——è¯­ï¼›å‘ä¿¡å·;<br>n. ä¿¡å·ï¼›æ——è¯­ï¼›è‡‚æ¿ä¿¡å·æœº;<br>vt. ç”¨ä¿¡å·è”ç»œ<br>1188, semicolon  [â€˜sÉ›mÉªkolÉ™n]<br>n. åˆ†å·<br>1189, sensation  [senâ€™seÉªÊƒ(É™)n]<br>n. æ„Ÿè§‰ï¼›è½°åŠ¨ï¼›æ„ŸåŠ¨<br>1190, sensibly  [â€˜sÉ›nsÉ™bli]<br>adv. æ˜æ˜¾åœ°ï¼›å®¹æ˜“æ„ŸçŸ¥åœ°ï¼›èªæ˜åœ°<br>1191, sentinel  [â€˜sÉ›ntÉªnl]<br>n. å“¨å…µ<br>vt. å®ˆå«ï¼Œæ”¾å“¨<br>1192, serial  [â€˜sÉªÉ™rÉªÉ™l]<br>adj. è¿ç»­çš„ï¼›è¿è½½çš„ï¼›åˆ†æœŸå¿è¿˜çš„;<br>n. ç”µè§†è¿ç»­å‰§ï¼›[å›¾æƒ…] æœŸåˆŠï¼›è¿è½½å°è¯´<br>1193, severely  [sÉªâ€™vÉªÉ™lÉª]<br>adv. ä¸¥é‡åœ°ï¼›ä¸¥æ ¼åœ°ï¼Œä¸¥å‰åœ°ï¼›çº¯æœ´åœ°<br>1194, severity  [sÉªâ€™verÉªtÉª]<br>n. ä¸¥é‡ï¼›ä¸¥æ ¼ï¼›çŒ›çƒˆ<br>1195, shell  [Êƒel]<br>n. å£³ï¼Œè´å£³ï¼›ç‚®å¼¹ï¼›å¤–å½¢<br>vi. å‰¥è½ï¼›è®¾å®šå‘½ä»¤è¡Œè§£é‡Šå™¨çš„ä½ç½®<br>vt. å‰¥çš®ï¼›ç‚®è½°<br>1196, shelter  [â€˜ÊƒÉ›ltÉš]<br>n. åº‡æŠ¤ï¼›é¿éš¾æ‰€ï¼›é®ç›–ç‰©<br>vt. ä¿æŠ¤ï¼›ä½¿æ©è”½<br>vi. èº²é¿ï¼Œé¿éš¾<br>n. (Shelter)äººåï¼›(è‹±)è°¢å°”ç‰¹<br>1197, shelve  [ÊƒÉ›lv]<br>vt. å°†ï¼ˆä¹¦ç­‰ï¼‰æ”¾ç½®åœ¨æ¶å­ä¸Šï¼›æç½®ï¼Œå°†æŸäº‹æ”¾åˆ°ä¸€æ—ä¸äºˆè€ƒè™‘ï¼›å°†â€¦æåœ¨ä¸€è¾¹ï¼›è£…ææ¶äºï¼›ç½¢å…<br>vi. ï¼ˆé™†åœ°ï¼‰é€æ¸å€¾æ–œ<br>1198, shenandoah  [,ÊƒenÉ™nâ€™dÉ™uÉ™]<br>n. è°¢å—å¤šå„æ²³ï¼ˆç¾å›½å¼—å‰å°¼äºšå·æ²³æµï¼‰ï¼›è°¢å—å¤šå„æ²³è°·ï¼ˆåœ°åï¼‰ï¼›æƒ…äººæ¸¡ï¼Œæ°´æ‰‹ç‘¶ï¼ˆæ­Œæ›²åï¼‰<br>1199, shield  [Êƒild]<br>n. ç›¾ï¼›é˜²æŠ¤ç‰©ï¼›ä¿æŠ¤è€…<br>vt. é®è”½ï¼›åŒ…åº‡ï¼›é¿å¼€ï¼›ä¿å«<br>vi. é˜²å¾¡ï¼›èµ·ä¿æŠ¤ä½œç”¨<br>n. (Shield)äººåï¼›(è‹±)å¸Œå°”å¾·<br>1200, Shield  [ÊƒiËld]<br>n. ç›¾ï¼›é˜²æŠ¤ç‰©ï¼›ä¿æŠ¤è€…</p><p>vt. é®è”½ï¼›åŒ…åº‡ï¼›é¿å¼€ï¼›ä¿å«</p><p>vi. é˜²å¾¡ï¼›èµ·ä¿æŠ¤ä½œç”¨</p><p>n. (Shield)äººåï¼›(è‹±)å¸Œå°”å¾·<br>1201, shim  [ÊƒÉªm]<br>vt. ç”¨æœ¨ç‰‡æˆ–å¤¹é“å¡«ï¼›å¤¹é“ n. å¡«éš™ç”¨æœ¨ç‰‡ï¼›å¤¹é“ n. (Shim)äººåï¼›(æœ)æ²ˆ<br>1202, shipper  [â€˜ÊƒÉªpÉš]<br>n. æ‰˜è¿äººï¼›å‘è´§äººï¼›è´§ä¸»<br>1203, shoehorn<br>n. é‹æ‹”</p><p>vt. ç¡¬å¡è¿›<br>1204, shot  [ÊƒÉ’t]<br>n. å‘å°„ï¼›ç‚®å¼¹ï¼›å°„æ‰‹ï¼›é•œå¤´;<br>adj. ç”¨å°½çš„ï¼›ç ´æ—§çš„ï¼›æ‚è‰²çš„ï¼Œé—ªå…‰çš„;<br>v. å°„å‡»ï¼ˆshootçš„è¿‡å»å¼å’Œè¿‡å»åˆ†è¯ï¼‰<br>1205, shrimp  [ÊƒrÉªmp]<br>n. è™¾ï¼›å°è™¾ï¼›çŸ®å°çš„äºº<br>vi. æ•è™¾<br>adj. æœ‰è™¾çš„ï¼›è™¾åˆ¶çš„<br>1206, shrink  [ÊƒrÉªÅ‹k]<br>n. æ”¶ç¼©ï¼›ç•ç¼©ï¼›&lt;ä¿š&gt;ç²¾ç¥ç—…å­¦å®¶</p><p>vt. ä½¿ç¼©å°ï¼Œä½¿æ”¶ç¼©</p><p>vi. æ”¶ç¼©ï¼›ç•ç¼©<br>1207, shuffle  [â€˜ÊƒÊŒfl]<br>v. æ´—ç‰Œï¼›æ¨è¯¿ï¼Œæ¨å¸ï¼›æ‹–æ›³ï¼Œæ…¢åååœ°èµ°ï¼›æ…ä¹±<br>n. æ´—ç‰Œï¼Œæ´—çº¸ç‰Œï¼›æ··ä¹±ï¼Œè’™æ··ï¼›æ‹–ç€è„šèµ°<br>1208, sidecar  [â€˜saÉªdkÉ‘r]<br>n. è½»å¿«çš„åŒè½®é©¬è½¦ï¼›è·¨æ–—<br>1209, sidetrack  [â€˜saÉªdtrÃ¦k]<br>vt. å°†ï¼ˆç«è½¦ï¼‰[å»º] è½¬åˆ°ä¾§çº¿ï¼›è½¬å˜ï¼ˆè¯é¢˜ï¼‰<br>n. ï¼ˆé“è·¯ï¼‰ä¾§çº¿ï¼›æ¬¡è¦åœ°ä½<br>vi. [å»º] è½¬åˆ°ä¾§çº¿ï¼›è½¬å˜è¯é¢˜<br>1210, sierra  [sÉªâ€™erÉ™; sÉªâ€™eÉ™rÉ™]<br>n. [åœ°ç†] é”¯é½¿å±±è„Šï¼›å‘ˆé½¿çŠ¶èµ·ä¼çš„å±±è„‰<br>n. (Sierra)äººåï¼›(æ„ã€è¥¿)è°¢æ‹‰ï¼›(è‹±)è¥¿æ‹‰<br>1211, significant  [sÉªÉ¡â€™nÉªfÉªkÉ™nt]<br>adj. é‡å¤§çš„ï¼›æœ‰æ•ˆçš„ï¼›æœ‰æ„ä¹‰çš„ï¼›å€¼å¾—æ³¨æ„çš„ï¼›æ„å‘³æ·±é•¿çš„<br>n. è±¡å¾ï¼›æœ‰æ„ä¹‰çš„äº‹ç‰©<br>1212, silhouette  [,sÉªluâ€™É›t]<br>n. è½®å»“ï¼Œå‰ªå½±<br>vt. ä½¿â€¦ç…§å‡ºå½±å­æ¥ï¼›ä½¿â€¦ä»…ä»…æ˜¾å‡ºè½®å»“<br>n. (Silhouette)äººåï¼›(æ³•)è¥¿å¢åŸƒç‰¹<br>1213, Silly  [â€˜sÉªlÉª]<br>adj. æ„šè ¢çš„<br>n. å‚»ç“œ<br>n. (Silly)äººåï¼›(åŒˆ)å¸Œä¼Šï¼›(æ³•)è¥¿åˆ©<br>1214, simulate  [â€˜sÉªmjÊŠleÉªt]<br>vt. æ¨¡ä»¿ï¼›å‡è£…ï¼›å†’å……</p><p>adj. æ¨¡ä»¿çš„ï¼›å‡è£…çš„<br>1215, simultaneous  [,saÉªmlâ€™tenÉªÉ™s]<br>adj. åŒæ—¶çš„ï¼›è”ç«‹çš„ï¼›åŒæ—¶å‘ç”Ÿçš„<br>n. åŒæ—¶è¯‘å‘˜<br>1216, simultaneously  [saÉªmÉ™lâ€™tenÉªÉ™sli]<br>adv. åŒæ—¶åœ°<br>1217, single-minded  [â€˜siÅ‹É¡l,â€™maindid]<br>adj. ä¸“å¿ƒçš„ï¼›çº¯çœŸçš„ï¼›çœŸè¯šçš„ï¼›ç‡ç›´çš„<br>1218, singular  [â€˜sÉªÅ‹gjÊŠlÉ™]<br>adj. å•æ•°çš„ï¼›å•ä¸€çš„ï¼›éå‡¡çš„ï¼›å¼‚å¸¸çš„</p><p>n. å•æ•°<br>1219, singularity  [sÉªÅ‹gjÊŠâ€™lÃ¦rÉªtÉª]<br>n. å¥‡å¼‚ï¼›å¥‡ç‚¹ï¼›çªå‡ºï¼›ç¨€æœ‰<br>1220, sink  [sÉªÅ‹k]<br>vi. ä¸‹æ²‰ï¼›æ¶ˆæ²‰ï¼›æ¸—é€<br>vt. ä½¿ä¸‹æ²‰ï¼›æŒ–æ˜ï¼›ä½¿ä½è½<br>n. æ°´æ§½ï¼›æ´—æ¶¤æ§½ï¼›æ±¡æ°´å‘<br>n. (Sink)äººåï¼›(è‹±ã€ç‘å…¸)è¾›å…‹<br>1221, slack  [slÃ¦k]<br>adj. æ¾å¼›çš„ï¼›ç–å¿½çš„ï¼›ä¸æµç•…çš„<br>vi. æ¾æ‡ˆï¼›å‡å¼±<br>n. ç…¤æœ«ï¼›å³¡è°·<br>vt. æ”¾æ¾ï¼›ä½¿ç¼“æ…¢<br>adv. é©¬è™åœ°ï¼›ç¼“æ…¢åœ°<br>n. (Slack)äººåï¼›(è‹±)æ–¯è±å…‹<br>1222, slash  [slÃ¦Êƒ]<br>vt. çŒ›ç ï¼›é­æ‰“ï¼›ä¸¥å‰æ‰¹è¯„ï¼›å¤§å¹…åº¦è£å‡æˆ–å‰Šå‡;<br>vi. çŒ›ç ï¼›ä¸¥å‰æ‰¹è¯„;<br>n. å‰Šå‡ï¼›æ–œçº¿ï¼›çŒ›ç ï¼›ç ç—•ï¼›æ²¼æ³½ä½åœ°<br>1223, slave  [sleÉªv]<br>n. å¥´éš¶ï¼›ä»åŠ¨è£…ç½®;<br>vi. è‹¦å¹²ï¼›æ‹¼å‘½å·¥ä½œ;<br>n. (Slave)äººåï¼›(å¡ã€ç½—)æ–¯æ‹‰éŸ¦<br>1224, slavishly  [â€˜slevÉªÊƒli]<br>adv. å¥´éš¶èˆ¬åœ°<br>1225, sleuth  [sluËÎ¸]<br>n. ä¾¦æ¢ï¼›è­¦çŠ¬</p><p>vi. åšä¾¦æ¢ï¼›ä¾¦æŸ¥<br>1226, slice  [slaÉªs]<br>n. è–„ç‰‡ï¼›éƒ¨åˆ†ï¼›èœåˆ€ï¼Œç«é“²;<br>vt. åˆ‡ä¸‹ï¼›æŠŠâ€¦åˆ†æˆéƒ¨åˆ†ï¼›å°†â€¦åˆ‡æˆè–„ç‰‡;<br>vi. åˆ‡å¼€ï¼›å‰²ç ´<br>1227, slide  [slaÉªd]<br>n. æ»‘åŠ¨ï¼›å¹»ç¯ç‰‡ï¼›æ»‘æ¢¯ï¼›é›ªå´©;<br>vi. æ»‘åŠ¨ï¼›æ»‘è½ï¼›ä¸çŸ¥ä¸è§‰é™·å…¥;<br>vt. æ»‘åŠ¨ï¼›ä½¿æ»‘åŠ¨ï¼›æ‚„æ‚„åœ°è¿…é€Ÿæ”¾ç½®<br>1228, sloped  []<br>adj. å€¾æ–œçš„;<br>v. å€¾æ–œï¼›ä½¿å€¾æ–œï¼ˆslopeçš„è¿‡å»å¼ï¼‰;<br>1229, slot  [slÉ’t]<br>n. ä½ç½®ï¼›ç‹­æ§½ï¼›æ°´æ²Ÿï¼›ç¡¬å¸æŠ•å¸å£;<br>vt. è·Ÿè¸ªï¼›å¼€æ§½äº;<br>n. (Slot)äººåï¼›(è‹±ã€è·)æ–¯æ´›ç‰¹<br>1230, slurp  [slÉœËp]<br>vt. å‡ºå£°åœ°åƒæˆ–å–</p><p>vi. å‡ºå£°åœ°åƒæˆ–å–</p><p>n. åƒçš„å£°éŸ³ï¼›å•œé£Ÿå£°<br>1231, snack  [snÃ¦k]<br>n. å°åƒï¼Œå¿«é¤ï¼›ä¸€ä»½ï¼Œéƒ¨åˆ†;<br>vi. åƒå¿«é¤ï¼Œåƒç‚¹å¿ƒ<br>1232, snap  [snÃ¦p]<br>vt. çªç„¶æŠ˜æ–­ï¼Œæ‹‰æ–­ï¼›çŒ›å’¬ï¼›å•ªåœ°å…³ä¸Š;<br>vi. å’¬ï¼›å‰å£°è¯´ï¼›å’¯å—’ä¸€å£°å…³ä¸Š;<br>n. çŒ›å’¬ï¼›åŠˆå•ªå£°ï¼›çªç„¶æŠ˜æ–­;<br>adj. çªç„¶çš„<br>1233, SNAPSHOT  [â€˜snÃ¦pÊƒÉ’t]<br>n. å¿«ç…§ï¼Œå¿«ç›¸ï¼›æ€¥å°„ï¼Œé€Ÿå°„ï¼›ç®€å•å°è±¡;<br>vt. ç»™â€¦æ‹å¿«ç…§;<br>vi. æ‹å¿«ç…§<br>1234, sneaker  [â€˜sniËkÉ™]<br>n. è¿åŠ¨é‹ï¼›å‘é„™è€…ï¼›é¬¼é¬¼ç¥Ÿç¥Ÿåšäº‹çš„äºº<br>1235, sneaky  [â€˜sniki]<br>adj. é¬¼é¬¼ç¥Ÿç¥Ÿçš„ï¼›æš—ä¸­çš„ï¼Œå‘é„™çš„<br>1236, sniffer  [snÉªfÉ™]<br>n. å—…æ¢å™¨ï¼›å—…æ¢çŠ¬ï¼›ä»¥é¼»å¸æ¯’è€…<br>1237, snippet  [â€˜snÉªpÉªt]<br>n. å°ç‰‡ï¼›ç‰‡æ–­ï¼›ä¸çŸ¥å¤©é«˜åœ°åšçš„å¹´è½»äºº<br>1238, soap  [sÉ™ÊŠp]<br>n. è‚¥çš‚;<br>vt. å°†è‚¥çš‚æ¶‚åœ¨â€¦â€¦ä¸Šï¼›å¯¹â€¦â€¦æ‹é©¬å±ï¼ˆä¿šè¯­ï¼‰;<br>vi. ç”¨è‚¥çš‚æ“¦æ´—<br>1239, sock  [sÉ‘k]<br>n. çŸ­è¢œï¼›ä¸€å‡»<br>vt. é‡å‡»ï¼›ç»™â€¦â€¦ç©¿è¢œ<br>adv. æ­£ç€åœ°ï¼›ä¸åä¸å€šåœ°<br>adj. éå¸¸æˆåŠŸçš„<br>n. (Sock)äººåï¼›(å¾·)ä½å…‹<br>1240, sole  [sol]<br>n. é‹åº•ï¼›è„šåº•ï¼›åŸºç¡€ï¼›é³ç›®é±¼<br>adj. å”¯ä¸€çš„ï¼›å•ç‹¬çš„ï¼›ä»…æœ‰çš„<br>vt. è§¦åº•ï¼›ä¸Šé‹åº•<br>n. (Sole)äººåï¼›(æ„ã€è¥¿ã€èŠ¬ã€å¡ã€ç½—ã€å—é)ç´¢è±<br>1241, solid  [â€˜sÉ’lÉªd]<br>adj. å›ºä½“çš„ï¼›å¯é çš„ï¼›ç«‹ä½“çš„ï¼›ç»“å®çš„ï¼›ä¸€è‡´çš„;<br>n. å›ºä½“ï¼›ç«‹æ–¹ä½“;<br>n. (Solid)äººåï¼›(ç‘å…¸)ç´¢åˆ©å¾·<br>1242, sophisticated  [sÉ™â€™fÉªstÉªkeÉªtÉªd]<br>adj. å¤æ‚çš„ï¼›ç²¾è‡´çš„ï¼›ä¹…ç»ä¸–æ•…çš„ï¼›å¯Œæœ‰ç»éªŒçš„;<br>v. ä½¿å˜å¾—ä¸–æ•…ï¼›ä½¿è¿·æƒ‘ï¼›ç¯¡æ”¹ï¼ˆsophisticateçš„è¿‡å»åˆ†è¯å½¢å¼ï¼‰<br>1243, sore  [sÉ”Ë]<br>adj. ç–¼ç—›çš„ï¼Œç—›å¿ƒçš„ï¼›å‰§çƒˆçš„ï¼Œæåº¦çš„ï¼›æ¼ç«çš„ï¼Œå‘æ€’çš„ï¼›å‰å®³çš„ï¼Œè¿«åˆ‡çš„<br>n. æºƒç–¡ï¼Œç—›å¤„ï¼›æ¨äº‹ï¼Œä¼¤å¿ƒäº‹<br>n. (Sore)äººåï¼›(æ³•)ç´¢å°”ï¼›(æ„)ç´¢é›·<br>1244, spawn  [spÉ”n]<br>n. åµï¼›èŒä¸ï¼›äº§ç‰©<br>vt. äº§åµï¼›é…¿æˆï¼Œé€ æˆï¼›å¤§é‡ç”Ÿäº§<br>vi. äº§åµï¼›å¤§é‡ç”Ÿäº§<br>1245, spec  [spÉ›k]<br>n. æŠ•æœºï¼›è¯´æ˜ä¹¦ï¼›ç»†åˆ™<br>1246, specific  [spÉ™â€™sÉªfÉªk]<br>adj. ç‰¹æ®Šçš„ï¼Œç‰¹å®šçš„ï¼›æ˜ç¡®çš„ï¼›è¯¦ç»†çš„ï¼›[è¯] å…·æœ‰ç‰¹æ•ˆçš„;<br>n. ç‰¹æ€§ï¼›ç»†èŠ‚ï¼›ç‰¹æ•ˆè¯<br>1247, specification  [,spesÉªfÉªâ€™keÉªÊƒ(É™)n]<br>n. è§„æ ¼ï¼›è¯´æ˜ä¹¦ï¼›è¯¦è¿°<br>1248, Specification  [,spesÉªfÉªâ€™keÉªÊƒ(É™)n]<br>n. è§„æ ¼ï¼›è¯´æ˜ä¹¦ï¼›è¯¦è¿°<br>1249, spike  [spaÉªk]<br>n. é•¿é’‰ï¼Œé“é’‰ï¼›é’‰é‹ï¼›ç»†é«˜è·Ÿ<br>vt. é˜»æ­¢ï¼›ä»¥å¤§é’‰é’‰ç‰¢ï¼›ç”¨å°–ç‰©åˆºç©¿<br>n. (Spike)äººåï¼›(ç‘å…¸)æ–¯çš®å…‹<br>1250, Spinlock  [Spinlock]<br>è‡ªæ—‹é”<br>1251, split  [splÉªt]<br>vt. åˆ†ç¦»ï¼›ä½¿åˆ†ç¦»ï¼›åŠˆå¼€ï¼›ç¦»å¼€ï¼›åˆ†è§£;<br>vi. ç¦»å¼€ï¼›è¢«åŠˆå¼€ï¼›æ–­ç»å…³ç³»;<br>n. åŠˆå¼€ï¼›è£‚ç¼;<br>adj. åŠˆå¼€çš„<br>1252, sponsor  [â€˜spÉ’nsÉ™]<br>n. èµåŠ©è€…ï¼›ä¸»åŠè€…ï¼›ä¿è¯äºº</p><p>vt. èµåŠ©ï¼›å‘èµ·<br>1253, spouse  [spaÊŠz; -s]<br>n. é…å¶<br>vt. å’Œâ€¦ç»“å©š<br>n. (Spouse)äººåï¼›(è‹±)æ–¯æ³¢æ–¯<br>1254, spout  [spaÊŠt]<br>n. å–·å£ï¼›æ°´é¾™å·ï¼›æ°´è½ç®¡ï¼›æ°´æŸ±<br>vt. å–·å‡ºï¼›å–·å°„ï¼›æ»”æ»”ä¸ç»åœ°è®²ï¼›æŠŠâ€¦å…¸å½“æ‰<br>vi. å–·å‡ºï¼›å–·å°„ï¼›æ»”æ»”ä¸ç»åœ°è®²<br>1255, spurious  [â€˜spjÊŠÉ™rÉªÉ™s]<br>adj. å‡çš„ï¼›ä¼ªé€ çš„ï¼›æ¬ºéª—çš„<br>1256, squash  [skwÉ”Êƒ]<br>vt. é•‡å‹ï¼›æŠŠâ€¦å‹æ‰ï¼›ä½¿æ²‰é»˜<br>vi. å—æŒ¤å‹ï¼›å‘å‡ºæŒ¤å‹å£°ï¼›æŒ¤å…¥<br>n. å£çƒï¼›æŒ¤å‹ï¼›å’¯å±å£°ï¼›å—ç“œå±æ¤ç‰©ï¼›ï¼ˆè‹±ï¼‰æœæ±é¥®æ–™<br>1257, stacked  [stÃ¦kt]<br>adj. å¦–è‰³çš„ï¼›ï¼ˆå¥³äººï¼‰èº«æä¸°æ»¡åŒ€ç§°çš„<br>v. å †æ”¾ï¼ˆstackçš„è¿‡å»åˆ†è¯ï¼‰<br>1258, stage  [steÉªdÊ’]<br>n. é˜¶æ®µï¼›èˆå°ï¼›æˆå‰§ï¼›é©¿ç«™</p><p>vt. ä¸¾è¡Œï¼›ä¸Šæ¼”ï¼›ç­¹åˆ’</p><p>vi. ä¸¾è¡Œï¼›é€‚äºä¸Šæ¼”ï¼›ä¹˜é©¿è½¦æ—…è¡Œ</p><p>n. (Stage)äººåï¼›(è‹±)æ–¯ç‰¹å¥‡<br>1259, stale  [stel]<br>adj. é™ˆè…çš„ï¼›ä¸æ–°é²œçš„<br>vi. å˜é™ˆæ—§ï¼›æ’’å°¿ï¼›å˜å¾—ä¸æ–°é²œ<br>vt. ä½¿å˜æ—§ï¼›å˜å¾—ä¸æ–°é²œ<br>n. å°¿<br>n. (Stale)äººåï¼›(å¡)æ–¯å¡”è±<br>1260, Stale  [steÉªl]<br>adj. é™ˆè…çš„ï¼›ä¸æ–°é²œçš„;<br>vi. å˜é™ˆæ—§ï¼›æ’’å°¿ï¼›å˜å¾—ä¸æ–°é²œ;<br>vt. ä½¿å˜æ—§ï¼›å˜å¾—ä¸æ–°é²œ;<br>n. å°¿;<br>n. (Stale)äººåï¼›(å¡)æ–¯å¡”è±<br>1261, staleness  [staleness]<br>n. è…è´¥ï¼›é™ˆè…ï¼›ä¸æ–°é²œï¼›æ³„æ°”<br>1262, stamp  [stÃ¦mp]<br>n. é‚®ç¥¨ï¼›å°è®°ï¼›æ ‡å¿—ï¼›è·ºè„š<br>vt. é“­è®°ï¼›æ ‡å‡ºï¼›ç›–ç« äºâ€¦ï¼›è´´é‚®ç¥¨äºâ€¦ï¼›ç”¨è„šè¸©è¸<br>vi. è·ºè„šï¼›æ£ç¢ï¼›æ¯æ‰<br>n. (Stamp)äººåï¼›(å¾·)æ–½å¦æ™®ï¼›(è‹±)æ–¯å¦æ™®<br>1263, stamped  [stÃ¦mpt]<br>adj. é“­åˆ»çš„ï¼›ç›–ä¸Šé‚®æˆ³çš„ï¼›é¡¿è¶³çš„</p><p>v. è´´ä¸Šé‚®ç¥¨ï¼ˆstampçš„è¿‡å»å¼ï¼‰ï¼›é¡¿è¶³<br>1264, stand-alone  [â€˜stÃ¦ndÉ™,lon]<br>n. ç‹¬ç«‹ï¼›å•æœº<br>adj. ç‹¬ç«‹çš„ï¼›ç‹¬ç«‹æ“ä½œçš„<br>1265, standardization  [,stÃ¦ndÉ™daÉªâ€™zeÉªÊƒÉ™n]<br>n. æ ‡å‡†åŒ–ï¼›[æ•°] è§„æ ¼åŒ–ï¼›æ ¡å‡†<br>1266, stash<br>n. è—åŒ¿å¤„ï¼›è—åŒ¿ç‰©<br>vt. å­˜æ”¾ï¼›è´®è—<br>vi. å­˜æ”¾ï¼›è—èµ·æ¥<br>1267, statement  [â€˜steÉªtm(É™)nt]<br>n. å£°æ˜ï¼›é™ˆè¿°ï¼Œå™è¿°ï¼›æŠ¥è¡¨ï¼Œæ¸…å•<br>1268, statistic  [stÉ™â€™tÉªstÉªk]<br>adj. ç»Ÿè®¡çš„ï¼Œç»Ÿè®¡å­¦çš„;<br>n. ç»Ÿè®¡æ•°å€¼<br>1269, statistician<br>n. ç»Ÿè®¡å­¦å®¶ï¼Œç»Ÿè®¡å‘˜<br>1270, stdout<br>abbr. æ ‡å‡†è¾“å‡ºï¼ˆstandard outputï¼‰<br>1271, STEADY  [â€˜stedÉª]<br>adj. ç¨³å®šçš„ï¼›ä¸å˜çš„ï¼›æ²‰ç€çš„;<br>vi. ç¨³å›º;<br>vt. ä½¿ç¨³å®šï¼›ç¨³å›ºï¼›ä½¿åšå®š;<br>adv. ç¨³å®šåœ°ï¼›ç¨³å›ºåœ°;<br>n. å…³ç³»å›ºå®šçš„æƒ…ä¾£ï¼›å›ºå®šæ”¯æ¶<br>1272, stem  [stem]<br>n. å¹²ï¼›èŒï¼›èˆ¹é¦–ï¼›è¡€ç»Ÿ;<br>vt. é˜»æ­¢ï¼›é™¤å»â€¦çš„èŒï¼›ç»™â€¦è£…æŸ„;<br>vi. é˜»æ­¢ï¼›èµ·æºäºæŸäº‹ç‰©ï¼›é€†è¡Œ<br>1273, stereotype  [â€˜stÉ›rÉªÉ™taÉªp]<br>vt. ä½¿ç”¨é“…ç‰ˆï¼›å¥—ç”¨è€å¥—ï¼Œä½¿ä¸€æˆä¸å˜<br>n. é™ˆè…”æ»¥è°ƒï¼Œè€å¥—ï¼›é“…ç‰ˆ<br>1274, sticker  [â€˜stÉªkÉ™]<br>n. å°–åˆ€ï¼›éš¾é¢˜ï¼›å¼ è´´ç‰©ï¼›åšæŒä¸æ‡ˆçš„äºº;<br>vt. ç»™â€¦è´´ä¸Šæ ‡ç­¾ä»·;<br>adj. æ±½è½¦ä»·ç›®æ ‡ç­¾çš„ï¼›æ±½è½¦æ ‡ç­¾ä»·çš„;<br>n. (Sticker)äººåï¼›(å¾·)æ–½è’‚å…‹<br>1275, stitch  [stÉªtÊƒ]<br>n. é’ˆè„šï¼Œçº¿è¿¹ï¼›ä¸€é’ˆ</p><p>vt. ç¼ï¼Œç¼åˆ</p><p>vi. ç¼ï¼Œç¼åˆ<br>1276, straightforward  [streÉªtâ€™fÉ”ËwÉ™d]<br>adj. ç®€å•çš„ï¼›å¦ç‡çš„ï¼›æ˜ç¡®çš„ï¼›å¾„ç›´çš„</p><p>adv. ç›´æˆªäº†å½“åœ°ï¼›å¦ç‡åœ°<br>1277, strange  [strendÊ’]<br>adj. å¥‡æ€ªçš„ï¼›é™Œç”Ÿçš„ï¼›å¤–è¡Œçš„<br>adv. å¥‡æ€ªåœ°ï¼›é™Œç”Ÿåœ°ï¼Œå†·æ·¡åœ°<br>n. (Strange)äººåï¼›(è‹±)æ–¯ç‰¹å…°å¥‡ï¼›(ç‘å…¸ã€å¡)æ–¯ç‰¹æœ—æ ¼<br>1278, strategist  [â€˜strÃ¦tÉ™dÊ’Éªst]<br>n. æˆ˜ç•¥å®¶ï¼›å†›äº‹å®¶<br>1279, strategy  [â€˜strÃ¦tÉªdÊ’Éª]<br>n. æˆ˜ç•¥ï¼Œç­–ç•¥<br>1280, stratum  [â€˜strÉ‘ËtÉ™m; â€˜streÉªtÉ™m]<br>n. ï¼ˆç»„ç»‡çš„ï¼‰å±‚ï¼›[åœ°è´¨] åœ°å±‚ï¼›ç¤¾ä¼šé˜¶å±‚<br>1281, strict  [strÉªkt]<br>adj. ä¸¥æ ¼çš„ï¼›ç»å¯¹çš„ï¼›ç²¾ç¡®çš„ï¼›è¯¦ç»†çš„<br>1282, stride  [straÉªd]<br>n. å¤§æ­¥ï¼›æ­¥å¹…ï¼›è¿›å±•<br>vt. è·¨è¿‡ï¼›å¤§è¸æ­¥èµ°è¿‡ï¼›è·¨ååœ¨â€¦<br>vi. è·¨ï¼›è·¨è¿‡ï¼›å¤§æ­¥è¡Œèµ°<br>è¿‡å»å¼:strode; è¿‡å»åˆ†è¯:stridden; ç°åœ¨åˆ†è¯:striding<br>1283, strip  [strÉªp]<br>vt. å‰¥å¤ºï¼›å‰¥å»ï¼›è„±å»è¡£æœ<br>n. å¸¦ï¼›æ¡çŠ¶ï¼›è„±è¡£èˆ<br>vi. è„±å»è¡£æœ<br>1284, striped  [straÉªpt]<br>adj. æœ‰æ¡çº¹çš„ï¼›æœ‰æ–‘çº¹çš„;<br>v. è¢«å‰¥å»ï¼ˆstripçš„è¿‡å»åˆ†è¯ï¼‰<br>1285, structural  [â€˜strÊŒktÊƒ(É™)r(É™)l]<br>adj. ç»“æ„çš„ï¼›å»ºç­‘çš„<br>1286, Stub  [stÊŒb]<br>n. å­˜æ ¹ï¼›çƒŸè’‚ï¼›æ ‘æ¡©ï¼›æ–­æ ª;<br>vt. è¸©ç†„ï¼›è¿æ ¹æ‹”é™¤;<br>n. (Stub)äººåï¼›(æŒªã€ç‘å…¸)æ–¯å›¾å¸ƒ<br>1287, stuff  [stÊŒf]<br>n. ä¸œè¥¿ï¼›ææ–™ï¼›å¡«å……ç‰©ï¼›ç´ æèµ„æ–™<br>vt. å¡æ»¡ï¼›å¡«å¡ï¼›è®©åƒé¥±<br>vi. åƒå¾—è¿‡å¤š<br>1288, subdivide  [â€˜sÊŒbdÉªvaÉªd]<br>vi. ç»†åˆ†ï¼Œå†åˆ†<br>vt. æŠŠâ€¦â€¦å†åˆ†ï¼ŒæŠŠâ€¦â€¦ç»†åˆ†<br>1289, subject  [â€˜sÊŒbdÊ’ekt; â€˜sÊŒbdÊ’Éªkt]<br>n. ä¸»é¢˜ï¼›ç§‘ç›®ï¼›[è¯­] ä¸»è¯­ï¼›å›½æ°‘;<br>adj. æœä»çš„ï¼›æ˜“æ‚£â€¦çš„ï¼›å—åˆ¶äºâ€¦çš„;<br>vt. ä½¿â€¦éš¶å±ï¼›ä½¿å±ˆä»äºâ€¦<br>1290, subscribe  [sÉ™bâ€™skraÉªb]<br>vi. è®¢é˜…ï¼›ææ¬¾ï¼›è®¤è´­ï¼›èµæˆï¼›ç­¾ç½² vt. ç­¾ç½²ï¼›èµæˆï¼›æåŠ©<br>1291, Subscription  [sÉ™bâ€™skrÉªpÊƒ(É™)n]<br>n. æçŒ®ï¼›è®¢é˜…ï¼›è®¢é‡‘ï¼›ç­¾ç½²<br>1292, subsequent  [â€˜sÊŒbsÉªkw(É™)nt]<br>adj. åæ¥çš„ï¼Œéšåçš„<br>1293, substitute  [â€˜sÊŒbstÉªtut]<br>n. ä»£ç”¨å“ï¼›ä»£æ›¿è€…<br>vi. æ›¿ä»£<br>vt. ä»£æ›¿<br>1294, suddenly  [ËˆsÊŒdnlÉª]<br>adv. çªç„¶åœ°ï¼›å¿½ç„¶<br>1295, suit  [suËt]<br>vt. é€‚åˆï¼›ä½¿é€‚åº”<br>n. è¯‰è®¼ï¼›æ³æ±‚ï¼›å¥—è£…ï¼›ä¸€å¥—å¤–è¡£<br>vi. åˆé€‚ï¼›ç›¸ç§°<br>1296, suite  [sut; swit]<br>n. ï¼ˆä¸€å¥—ï¼‰å®¶å…·ï¼›å¥—æˆ¿ï¼›ç»„æ›²ï¼›ï¼ˆä¸€æ‰¹ï¼‰éšå‘˜ï¼Œéšä»<br>1297, summed<br>v. æ€»è®¡ï¼Œæ¦‚æ‹¬ï¼Œæ€»ç»“ï¼ˆsumçš„è¿‡å»æ—¶å’Œè¿‡å»åˆ†è¯ï¼‰<br>1298, supercede  [supercede]<br>vt. å–ä»£ï¼›å»¶æœŸï¼›ç´§æ¥ç€â€¦è€Œåˆ°æ¥<br>vi. æ¨è¿Ÿè¡ŒåŠ¨<br>1299, superseded<br>adj. ä½œåºŸçš„ï¼›è¢«å–ä»£çš„<br>v. å–ä»£ï¼›å…‹åˆ¶ï¼›åºŸå¼ƒï¼ˆsupersedeçš„è¿‡å»åˆ†è¯ï¼‰<br>1300, superset  [superset]<br>n. [æ•°] è¶…é›†<br>1301, supervise  [â€˜suËpÉ™vaÉªz; â€˜sjuË-]<br>vt. ç›‘ç£ï¼Œç®¡ç†ï¼›æŒ‡å¯¼<br>vi. ç›‘ç£ï¼Œç®¡ç†ï¼›æŒ‡å¯¼<br>1302, supervisor  [â€˜supÉšvaÉªzÉš]<br>n. ç›‘ç£äººï¼Œ[ç®¡ç†] ç®¡ç†äººï¼›æ£€æŸ¥å‘˜<br>1303, supplemental  [,sÊŒplÉ™â€™mÉ›ntl]<br>adj. è¡¥å……çš„ï¼ˆç­‰äºsupplementaryï¼‰ï¼›è¿½åŠ çš„<br>1304, supplier  [sÉ™â€™plaÉªÉ™]<br>n. ä¾›åº”å‚å•†ï¼Œä¾›åº”å›½ï¼›ä¾›åº”è€…<br>1305, supreme  [suËâ€™priËm]<br>adj.æœ€é«˜çš„ï¼›è‡³é«˜çš„ï¼›æœ€é‡è¦çš„<br>n.è‡³é«˜ï¼›éœ¸æƒ<br>1306, survey  [ËˆsÉœËveÉª]<br>n. è°ƒæŸ¥ï¼›æµ‹é‡ï¼›å®¡è§†ï¼›çºµè§ˆ;<br>vt. è°ƒæŸ¥ï¼›å‹˜æµ‹ï¼›ä¿¯ç°;<br>vi. æµ‹é‡åœŸåœ°<br>1307, survivor  [sÉ™â€™vaÉªvÉ™]<br>n. å¹¸å­˜è€…ï¼›ç”Ÿè¿˜è€…ï¼›æ®‹å­˜ç‰©<br>1308, susceptible  [sÉ™â€™septÉªb(É™)l]<br>adj. æ˜“å—å½±å“çš„ï¼›æ˜“æ„ŸåŠ¨çš„ï¼›å®¹è®¸â€¦çš„</p><p>n. æ˜“å¾—ç—…çš„äºº<br>1309, symmetric  [sÉªâ€™metrÉªk]<br>adj. å¯¹ç§°çš„ï¼›åŒ€ç§°çš„<br>1310, synonyms  [ËˆsÉªnÉ™nÉªm]<br>n. [è¯­] åŒä¹‰è¯ï¼ŒåŒä¹‰å­—ï¼›åŒä¸€æ€§ï¼ˆsynonymçš„å¤æ•°ï¼‰<br>1311, synopsis  [sÉªâ€™nÉ‘psÉªs]<br>n. æ¦‚è¦ï¼Œå¤§çº²<br>1312, syntactically  [sÉªnâ€™tÃ¦ktÉªkli]<br>adv. ä¾ç…§å¥æ³•åœ°ï¼›åœ¨è¯­å¥æ„æˆä¸Š<br>1313, synthetic  [sÉªnâ€™Î¸etÉªk]<br>adj.ç»¼åˆçš„ï¼›åˆæˆçš„ï¼Œäººé€ çš„<br>n.åˆæˆç‰©<br>1314, systematic  [sÉªstÉ™â€™mÃ¦tÉªk]<br>adj. ç³»ç»Ÿçš„ï¼›ä½“ç³»çš„ï¼›æœ‰ç³»ç»Ÿçš„ï¼›[å›¾æƒ…] åˆ†ç±»çš„ï¼›ä¸€è´¯çš„ï¼Œæƒ¯å¸¸çš„<br>1315, tactic  [â€˜tÃ¦ktÉªk]<br>n. ç­–ç•¥ï¼Œæˆ˜ç•¥<br>adj. æŒ‰é¡ºåºçš„ï¼Œä¾æ¬¡æ’åˆ—çš„<br>1316, tail  [teÉªl]<br>n. å°¾å·´ï¼›è¸ªè¿¹ï¼›è¾«å­ï¼›ç‡•å°¾æœ<br>vt. å°¾éšï¼›è£…ä¸Šå°¾å·´<br>vi. è·Ÿè¸ªï¼›å˜å°‘æˆ–ç¼©å°<br>adj. ä»åé¢è€Œæ¥çš„ï¼›å°¾éƒ¨çš„<br>1317, taint  [tent]<br>vt. æ±¡æŸ“ï¼›è…èš€ï¼›ä½¿æ„ŸæŸ“<br>n. æ±¡ç‚¹ï¼›æ„ŸæŸ“<br>vi. è´¥åï¼›è¢«æ±¡æŸ“<br>1318, tamper  [â€˜tÃ¦mpÉ™]<br>vi. ç¯¡æ”¹ï¼›å¹²é¢„ï¼›æŸå®³ï¼›å‰Šå¼±ï¼›ç©å¼„ï¼›è´¿èµ‚;<br>vt. ç¯¡æ”¹;<br>n. å¡«å¡è€…ï¼›æ£æ£’<br>1319, Tarball  [Tarball]<br>n. åŸå§‹ç ï¼›ï¼ˆLinuxä¸‹æœ€æ–¹ä¾¿çš„ï¼‰æ‰“åŒ…å·¥å…·<br>1320, tasty  [â€˜teÉªstÉª]<br>adj. ç¾å‘³çš„ï¼›é«˜é›…çš„ï¼›æœ‰è¶£çš„;<br>n. å¯å£çš„ä¸œè¥¿ï¼›å¼•äººå…¥èƒœçš„ä¸œè¥¿<br>1321, technique  [tekâ€™niËk]<br>n. æŠ€å·§ï¼ŒæŠ€æœ¯ï¼›æ‰‹æ³•<br>1322, telemetry  [tÉ™â€™lÉ›mÉ™tri]<br>n. [è‡ª] é¥æµ‹æŠ€æœ¯ï¼›é¥æ„Ÿå‹˜æµ‹ï¼›è‡ªåŠ¨æµ‹é‡è®°å½•ä¼ å¯¼<br>1323, tempo  [â€˜tempÉ™ÊŠ]<br>n. é€Ÿåº¦ï¼Œå‘å±•é€Ÿåº¦ï¼›æ‹å­<br>n. (Tempo)äººåï¼›(æ„)æ»•æ³¢<br>1324, temptation  [tem(p)â€™teÉªÊƒ(É™)n]<br>n. å¼•è¯±ï¼›è¯±æƒ‘ç‰©<br>1325, tenant  [â€˜tÉ›nÉ™nt]<br>n. æ‰¿ç§Ÿäººï¼›æˆ¿å®¢ï¼›ä½ƒæˆ·ï¼›å±…ä½è€…<br>vt. ç§Ÿå€Ÿï¼ˆå¸¸ç”¨äºè¢«åŠ¨è¯­æ€ï¼‰<br>n. (Tenant)äººåï¼›(æ³•)ç‰¹å—<br>1326, tenure  [â€˜tenjÉ™]<br>n. ä»»æœŸï¼›å æœ‰<br>vt. æˆäºˆâ€¦ç»ˆèº«èŒä½<br>1327, term  [tÉm]<br>n. æœ¯è¯­ï¼›å­¦æœŸï¼›æœŸé™ï¼›æ¡æ¬¾ï¼›(ä»£æ•°å¼ç­‰çš„)é¡¹<br>vt. æŠŠâ€¦å«åš<br>n. (Term)äººåï¼›(æ³°)ä¸<br>1328, terminology  [,tÉœËmÉªâ€™nÉ’lÉ™dÊ’Éª]<br>n. æœ¯è¯­ï¼Œæœ¯è¯­å­¦ï¼›ç”¨è¾<br>1329, terminus  [â€˜tÉmÉªnÉ™s]<br>n. ç»ˆç‚¹ï¼›ç»ˆç‚¹ç«™ï¼›ç•Œæ ‡ï¼›ç•ŒçŸ³<br>1330, territory  [â€˜terÉªt(É™)rÉª]<br>n. é¢†åœŸï¼Œé¢†åŸŸï¼›èŒƒå›´ï¼›åœ°åŸŸï¼›ç‰ˆå›¾<br>1331, testimonial  [,testÉªâ€™mÉ™ÊŠnÉªÉ™l]<br>n.è¯æ˜ä¹¦ï¼›æ¨èä¹¦<br>adj.è¯æ˜çš„ï¼›è¤’å¥–çš„ï¼›è¡¨æ‰¬çš„<br>1332, theta  [â€˜Î¸itÉ™]<br>n. å¸Œè…Šå­—æ¯çš„ç¬¬å…«å­—ï¼›æ—¶é—´é€’è€—å€¼<br>1333, thin  [Î¸Éªn]<br>adj. è–„çš„ï¼›ç˜¦çš„ï¼›ç¨€è–„çš„ï¼›å¾®å¼±çš„;<br>vt. ä½¿ç˜¦ï¼›ä½¿æ·¡ï¼›ä½¿ç¨€ç–;<br>vi. å˜è–„ï¼›å˜ç˜¦ï¼›å˜æ·¡;<br>adv. ç¨€ç–åœ°ï¼›å¾®å¼±åœ°;<br>n. ç»†å°éƒ¨åˆ†;<br>n. (Thin)äººåï¼›(è¶Š)è¾°ï¼›(æŸ¬)å»·<br>1334, threshold  [â€˜Î¸reÊƒÉ™ÊŠld; â€˜Î¸reÊƒ,hÉ™ÊŠld]<br>n. å…¥å£ï¼›é—¨æ§›ï¼›å¼€å§‹ï¼›æé™ï¼›ä¸´ç•Œå€¼<br>1335, thresholds  [â€˜Î¸rÉ›Êƒhold]<br>n. é˜ˆå€¼ï¼›[å»º] é—¨æ§›ï¼›ä¸´ç•Œå€¼å€¼ï¼ˆthresholdçš„å¤æ•°ï¼‰<br>1336, thrift  [Î¸rÉªft]<br>n. èŠ‚ä¿­ï¼›èŠ‚çº¦ï¼›[æ¤] æµ·çŸ³ç«¹<br>n. (Thrift)äººåï¼›(è‹±)æ€é‡Œå¤«ç‰¹<br>1337, thrilled  [Î¸rÉªld]<br>adj. éå¸¸å…´å¥‹çš„ï¼›æä¸ºæ¿€åŠ¨çš„;<br>v. æ¿€åŠ¨ï¼ˆthrillçš„è¿‡å»å¼ï¼‰ï¼›[åŒ»] éœ‡é¢¤<br>1338, throttle  [â€˜Î¸rÉ‘tl]<br>n. èŠ‚æµé˜€ï¼›[è½¦è¾†] é£é—¨ï¼›å–‰å’™<br>vt. å‹åˆ¶ï¼Œæ‰¼æ€ï¼›ä½¿â€¦â€¦çª’æ¯ï¼›ä½¿â€¦â€¦èŠ‚æµ<br>vi. èŠ‚æµï¼Œå‡é€Ÿï¼›çª’æ¯<br>1339, throughput  [â€˜Î¸rÊŠâ€™pÊŠt]<br>n. ç”Ÿäº§é‡ï¼Œç”Ÿäº§èƒ½åŠ›<br>1340, thumbnail  [â€˜Î¸ÊŒmneÉªl]<br>n. æ‹‡æŒ‡æŒ‡ç”²ï¼›æå°çš„ä¸œè¥¿ï¼›çŸ­æ–‡;<br>adj. æå°çš„ï¼ŒæçŸ­çš„<br>1341, tick  [tÉªk]<br>vt. æ ‡è®°å·äºï¼›æ»´ç­”åœ°è®°å½•<br>n. æ»´ç­”å£°ï¼›æ‰è™±ï¼›è®°å·ï¼›èµŠæ¬ <br>vi. å‘å‡ºæ»´ç­”å£°ï¼›æ ‡ä»¥è®°å·<br>n. (Tick)äººåï¼›(åŒˆã€èŠ¬)è’‚å…‹<br>1342, tie  [taÉª]<br>vt. ç³»ï¼›çº¦æŸï¼›æ‰“ç»“ï¼›ä¸â€¦æˆå¹³å±€<br>vi. æ‰“ç»“ï¼›ä¸åˆ†èƒœè´Ÿï¼›è¢«ç”¨å¸¦ï¼ˆæˆ–ç»³å­ç­‰ï¼‰ç³»ä½<br>n. é¢†å¸¦ï¼›å¹³å±€ï¼›é‹å¸¦ï¼›é¢†ç»“ï¼›ä¸åˆ†èƒœè´Ÿ<br>n. (Tie)äººåï¼›(ä¸œå—äºšå›½å®¶åè¯­)æ²»ï¼›(è‹±)æ³°ä¼Šï¼›(æŸ¬)ç‹„<br>1343, tie-breaking  [tie-breaking]<br>adj. å¹³å±€å†³èƒœçš„ï¼›æ‰“ç ´åƒµå±€çš„<br>1344, tier  [tÉªr]<br>n. å±‚ï¼Œæ’ï¼›è¡Œï¼Œåˆ—ï¼›ç­‰çº§<br>vt. ä½¿å±‚å <br>vi. æˆé€’å‡å¾˜åˆ—<br>n. (Tier)äººåï¼›(è‹±)è’‚å°”<br>1345, ties<br>n. ç»“<br>v. ç»‘ï¼›è¿ç»“<br>1346, toggle  [â€˜tÉ’g(É™)l]<br>vt. æ‹´ç‰¢ï¼Œç³»ç´§;<br>n. å¼€å…³ï¼Œè§¦å‘å™¨ï¼›æ‹´æ‰£ï¼›[èˆ¹] å¥—ç´¢é’‰<br>1347, Tokenizer<br>n. åˆ†è¯å™¨ï¼›ç¼–è¯‘å™¨<br>1348, tolerable  [â€˜tÉ’l(É™)rÉ™b(É™)l]<br>adj. å¯ä»¥çš„ï¼›å¯å®¹å¿çš„<br>1349, tolerate  [â€˜tÉ’lÉ™reÉªt]<br>vt. å¿å—ï¼›é»˜è®¸ï¼›å®½æ•<br>1350, topology  [tÉ™ËˆpÉ‘lÉ™dÊ’i]<br>n. æ‹“æ‰‘å­¦<br>1351, tracker  [â€˜trÃ¦kÉ™]<br>n. æ‹‰çº¤è€…ï¼Œçº¤å¤«ï¼›è¿½è¸ªç³»ç»Ÿï¼Œ[è‡ª] è·Ÿè¸ªè£…ç½®ï¼›è¿½è¸ªè€…<br>1352, trade off<br>æƒè¡¡ï¼›å–æ‰ï¼›äº¤æ›¿ä½¿ç”¨ï¼›äº¤æ›¿æ¢ä½<br>1353, tradeoff  [â€˜tred,É”f]<br>n. æƒè¡¡ï¼›æŠ˜è¡·ï¼›ï¼ˆå…¬å¹³ï¼‰äº¤æ˜“ï¼ˆç­‰äºtrade-offï¼‰<br>1354, tradeoffs  [â€˜tred,É”f]<br>n. æƒè¡¡ï¼›æŠ˜è¡·ï¼›ï¼ˆå…¬å¹³ï¼‰äº¤æ˜“ï¼ˆç­‰äºtrade-offï¼‰<br>1355, transform  [trÃ¦nsâ€™fÉ”Ëm; trÉ‘Ëns-; -nz-]<br>vt. æ”¹å˜ï¼Œä½¿â€¦å˜å½¢ï¼›è½¬æ¢;<br>vi. å˜æ¢ï¼Œæ”¹å˜ï¼›è½¬åŒ–<br>1356, transformation  [trÃ¦nsfÉ™â€™meÉªÊƒ(É™)n; trÉ‘Ëns-; -nz-]<br>n. [é—] è½¬åŒ–ï¼›è½¬æ¢ï¼›æ”¹é©ï¼›å˜å½¢<br>1357, transient  [â€˜trÃ¦nzÉªÉ™nt]<br>adj. çŸ­æš‚çš„ï¼›è·¯è¿‡çš„;<br>n. ç¬å˜ç°è±¡ï¼›è¿‡å¾€æ—…å®¢ï¼›å€™é¸Ÿ<br>1358, transition  [trÃ¦nâ€™zÉªÊƒ(É™)n; trÉ‘Ën-; -â€˜sÉªÊƒ-]<br>n. è¿‡æ¸¡ï¼›è½¬å˜ï¼›[åˆ†å­ç”Ÿç‰©] è½¬æ¢ï¼›å˜è°ƒ<br>1359, transitive  [â€˜trÃ¦nsÉªtÉªv; â€˜trÉ‘Ëns-; -nz-]<br>adj. åŠç‰©çš„ï¼›è¿‡æ¸¡çš„ï¼›å¯è¿çš„;<br>n. ä¼ é€’ï¼›åŠç‰©åŠ¨è¯<br>1360, transparently  [â€˜trÃ¦nsâ€™pÉ›rÉ™ntli]<br>adv. æ˜¾ç„¶åœ°ï¼Œæ˜“è§‰å¯Ÿåœ°ï¼›æ˜äº®åœ°<br>1361, traversal  [trÉ™ËˆvÉ™rs(É™)l]<br>n. [è®¡] éå†ï¼›æ¨ªè¶Šï¼›æ¨ªæ–­ç‰©<br>1362, traverse  [â€˜trÃ¦vÉ™s; trÉ™â€™vÉœËs]<br>n. ç©¿è¿‡ï¼›æ¨ªè´¯ï¼›æ¨ªæœ¨</p><p>vt. ç©¿è¿‡ï¼›åå¯¹ï¼›è¯¦ç»†ç ”ç©¶ï¼›åœ¨â€¦æ¥å›ç§»åŠ¨</p><p>vi. æ¨ªè¶Šï¼›æ—‹è½¬ï¼›æ¥å›ç§»åŠ¨</p><p>adj. æ¨ªè´¯çš„</p><p>n. (Traverse)äººåï¼›(è‹±)ç‰¹æ‹‰å¼—æ–¯ï¼›(æ³•)ç‰¹æ‹‰éŸ¦å°”æ–¯<br>1363, traversing  [â€˜trÃ¦vÉs]<br>n. ç©¿è¶Šï¼Œé€šè¿‡;<br>v. ç©¿è¿‡ï¼ˆtraverseçš„ingå½¢å¼ï¼‰ï¼›æ¨ªè¶Š<br>1364, Tray  [treÉª]<br>n. æ‰˜ç›˜ï¼›æ–‡ä»¶ç›’ï¼›éš”åº•åŒ£ï¼›ï¼ˆæ— çº¿ç”µçš„ï¼‰å‘å°„ç®±<br>1365, tremendously  [trÉªâ€™mÉ›ndÉ™sli]<br>adv. éå¸¸åœ°ï¼›å¯æ€•åœ°ï¼›æƒŠäººåœ°<br>1366, trends  [trendz]<br>n. åŠ¨æ€ï¼Œ[ç»Ÿè®¡] è¶‹åŠ¿<br>1367, trial  [â€˜traÉªÉ™l]<br>n. è¯•éªŒï¼›å®¡è®¯ï¼›åŠªåŠ›ï¼›ç£¨ç‚¼;<br>adj. è¯•éªŒçš„ï¼›å®¡è®¯çš„;<br>n. (Trial)äººåï¼›(æ³•)ç‰¹é‡Œäºšå°”<br>1368, tribe  [traÉªb]<br>n. éƒ¨è½ï¼›æ—ï¼›å®—æ—ï¼›ä¸€ä¼™<br>n. (Tribe)äººåï¼›(è‹±)ç‰¹èµ–å¸ƒ<br>1369, tricky  [â€˜trÉªkÉª]<br>adj. ç‹¡çŒ¾çš„ï¼›æœºè­¦çš„<br>1370, trident  [â€˜traÉªdnt]<br>n. ä¸‰å‰æˆŸï¼›[æ•°] ä¸‰å‰çº¿ï¼›ä¸‰é½¿é±¼å‰<br>1371, trillion  [â€˜trÉªljÉ™n]<br>n. [æ•°] ä¸‡äº¿</p><p>adj. ä¸‡äº¿çš„</p><p>num. [æ•°] ä¸‡äº¿<br>1372, trivia  [â€˜trÉªvÉªÉ™]<br>n. çäº‹<br>1373, trivial  [â€˜trÉªvÉªÉ™l]<br>adj. ä¸é‡è¦çš„ï¼Œçç¢çš„ï¼›çç»†çš„<br>1374, tropic  [â€˜trÉ’pÉªk]<br>n. çƒ­å¸¦ï¼›å›å½’çº¿<br>adj. çƒ­å¸¦çš„<br>1375, troubleshooting<br>n. è§£å†³çº·äº‰ï¼›å‘ç°å¹¶ä¿®ç†æ•…éšœ<br>v. æ£€ä¿®ï¼ˆtroubleshootçš„ingå½¢å¼ï¼‰ï¼›å½“è°ƒè§£äºº<br>1376, trunk  [trÊŒÅ‹k]<br>n. æ ‘å¹²ï¼›èº¯å¹²ï¼›è±¡é¼»ï¼›æ±½è½¦è½¦å°¾çš„è¡Œæç®±;<br>vt. æŠŠâ€¦æ”¾å…¥æ—…è¡Œç®±å†…;<br>adj. å¹²çº¿çš„ï¼›èº¯å¹²çš„ï¼›ç®±å­çš„;<br>n. (Trunk)äººåï¼›(å¾·ã€åŒˆã€è¥¿)ç‰¹ä¼¦å…‹<br>1377, tunable  [â€˜tjÊŠnÉ™bl]<br>adj. å¯è°ƒè°çš„ï¼›å¯è°ƒéŸ³çš„ï¼›å’Œè°çš„ï¼›éŸ³è°ƒç¾çš„<br>1378, tune  [tun]<br>n. æ›²è°ƒï¼›å’Œè°ï¼›å¿ƒæƒ…<br>vt. è°ƒæ•´ï¼›ä½¿ä¸€è‡´ï¼›ä¸ºâ€¦è°ƒéŸ³<br>vi. [ç”µå­][é€šä¿¡] è°ƒè°ï¼›åè°ƒ<br>n. (Tune)äººåï¼›(è‹±)å›¾æ©<br>1379, tunnel  [â€˜tÊŒnl]<br>n. éš§é“ï¼›å‘é“ï¼›æ´ç©´é€šé“<br>vt. æŒ–ï¼›åœ¨â€¦æ‰“å¼€é€šé“ï¼›åœ¨â€¦æŒ–æ˜éš§é“<br>vi. æŒ–æ˜éš§é“ï¼›æ‰“å¼€é€šé“<br>1380, tutorial  [tjuËâ€™tÉ”ËrÉªÉ™l]<br>adj. è¾…å¯¼çš„ï¼›å®¶åº­æ•™å¸ˆçš„ï¼Œä¸ªåˆ«æŒ‡å¯¼çš„;<br>n. ä¸ªåˆ«æŒ‡å¯¼<br>1381, tweak  [twik]<br>n. æ‰­ï¼›æ‹§ï¼›ç„¦æ€¥<br>vt. æ‰­ï¼›ç”¨åŠ›æ‹‰ï¼›å¼€è¶³é©¬åŠ›<br>1382, tweet  [twiËt]<br>n. å°é¸Ÿå«å£°ï¼›è‡ªå½•éŸ³å†ç°è£…ç½®å‘å‡ºçš„é«˜éŸ³ï¼›æ¨ç‰¹;<br>vi. å±å±åœ°å«ï¼›å•¾é¸£<br>1383, ubiquitous  [juËâ€™bÉªkwÉªtÉ™s]<br>adj. æ™®éå­˜åœ¨çš„ï¼›æ— æ‰€ä¸åœ¨çš„<br>1384, unary  [â€˜juËnÉ™rÉª]<br>adj. [æ•°] ä¸€å…ƒçš„<br>1385, unassigned<br>adj. æœªæ´¾èŒåŠ¡çš„ï¼›æœªèµ‹å€¼çš„<br>1386, uncle  [â€˜ÊŒÅ‹k(É™)l]<br>n. å”å”ï¼›ä¼¯çˆ¶ï¼›ä¼¯ä¼¯ï¼›èˆ…çˆ¶ï¼›å§¨ä¸ˆï¼›å§‘çˆ¶<br>1387, undelivered  [,ÊŒndÉªâ€™lÉªvÉšd]<br>adj. æœªè¢«é‡Šæ”¾çš„ï¼›æœªé€è¾¾çš„<br>1388, undergo  [,ÊŒndÉšâ€™É¡o]<br>vt. ç»å†ï¼Œç»å—ï¼›å¿å—<br>1389, underlying  [ÊŒndÉ™â€™laÉªÉªÅ‹]<br>adj. æ½œåœ¨çš„ï¼›æ ¹æœ¬çš„ï¼›åœ¨ä¸‹é¢çš„ï¼›ä¼˜å…ˆçš„;<br>v. æ”¾åœ¨â€¦çš„ä¸‹é¢ï¼›ä¸ºâ€¦çš„åŸºç¡€ï¼›ä¼˜å…ˆäºï¼ˆunderlieçš„ingå½¢å¼ï¼‰<br>1390, underpin  [ÊŒndÉ™â€™pÉªn]<br>vt. å·©å›ºï¼›æ”¯æŒï¼›ä»ä¸‹é¢æ”¯æ’‘ï¼›åŠ å¼ºâ€¦çš„åŸºç¡€<br>1391, underwear  [â€˜ÊŒndÉ™weÉ™]<br>n. å†…è¡£ç‰©<br>1392, unfeasible  [ÊŒnâ€™fiËzÉªb(É™)l]<br>adj. éš¾å®æ–½çš„ï¼Œä¸èƒ½å®è¡Œçš„<br>1393, unified<br>adj. ç»Ÿä¸€çš„ï¼›ä¸€è‡´æ ‡å‡†çš„<br>v. ç»Ÿä¸€ï¼›ä½¿ä¸€è‡´ï¼ˆunifyçš„è¿‡å»åˆ†è¯ï¼‰<br>1394, Unity  [ËˆjuËnÉ™ti]<br>n. å›¢ç»“ï¼›ä¸€è‡´ï¼›è”åˆï¼›ä¸ªä½“;<br>n. (Unity)äººåï¼›(è‹±)å°¤å¦®è’‚<br>1395, Until  [É™nâ€™tÉªl]<br>conj. åœ¨â€¦ä»¥å‰ï¼›ç›´åˆ°â€¦æ—¶;<br>prep. åœ¨â€¦ä»¥å‰ï¼›åˆ°â€¦ä¸ºæ­¢<br>1396, unusual  [ÊŒnâ€™juËÊ’ÊŠÉ™l]<br>adj. ä¸å¯»å¸¸çš„ï¼›ä¸ä¼—ä¸åŒçš„ï¼›ä¸å¹³å¸¸çš„<br>1397, upon  [É™â€™pÉ‘n]<br>prep. æ ¹æ®ï¼›æ¥è¿‘ï¼›åœ¨â€¦ä¹‹ä¸Š<br>1398, usual  [â€˜juËÊ’ÊŠÉ™l]<br>adj. é€šå¸¸çš„ï¼Œæƒ¯ä¾‹çš„ï¼›å¹³å¸¸çš„<br>1399, Utility  [juËËˆtÉªlÉ™ti]<br>n. å®ç”¨ï¼›æ•ˆç”¨ï¼›å…¬å…±è®¾æ–½ï¼›åŠŸç”¨;<br>adj. å®ç”¨çš„ï¼›é€šç”¨çš„ï¼›æœ‰å¤šç§ç”¨é€”çš„<br>1400, vacant  [â€˜veÉªk(É™)nt]<br>adj.ç©ºè™šçš„ï¼›ç©ºçš„ï¼›ç©ºç¼ºçš„ï¼›ç©ºé—²çš„ï¼›èŒ«ç„¶çš„<br>n.(Vacant)äººåï¼›(æ³•)ç“¦åº·<br>1401, Validation  [,vÃ¦lÉªâ€™deÉªÊƒÉ™n]<br>n. ç¡®è®¤ï¼›æ‰¹å‡†ï¼›ç”Ÿæ•ˆ<br>1402, vanilla  [vÉ™â€™nÉªlÉ™]<br>n. é¦™å­å…°ï¼Œé¦™è‰<br>adj. é¦™è‰å‘³çš„<br>1403, variant  [â€˜vÉ›rÉªÉ™nt]<br>adj. ä¸åŒçš„ï¼›å¤šæ ·çš„<br>n. å˜ä½“ï¼›è½¬åŒ–<br>1404, variants<br>n. [è®¡] å˜ä½“ï¼›å˜å¼‚å‹ï¼ˆvariantçš„å¤æ•°ï¼‰<br>1405, Variation  [veÉ™rÉªâ€™eÉªÊƒ(É™)n]<br>n. å˜åŒ–ï¼›[ç”Ÿç‰©] å˜å¼‚ï¼Œå˜ç§<br>1406, various  [â€˜veÉ™rÉªÉ™s]<br>adj. å„ç§å„æ ·çš„ï¼›å¤šæ–¹é¢çš„<br>1407, vary  [â€˜veÉ™rÉª]<br>vi. å˜åŒ–ï¼›å˜å¼‚ï¼›è¿å;<br>vt. æ”¹å˜ï¼›ä½¿å¤šæ ·åŒ–ï¼›å˜å¥;<br>n. (Vary)äººåï¼›(è‹±ã€æ³•ã€ç½—ã€æŸ¬)ç“¦é‡Œ<br>1408, vast  [vÉ‘Ëst]<br>adj. å¹¿é˜”çš„ï¼›å·¨å¤§çš„ï¼›å¤§é‡çš„ï¼›å·¨é¢çš„;<br>n. æµ©ç€šï¼›å¹¿é˜”æ— å çš„ç©ºé—´;<br>n. (Vast)äººåï¼›(æ³•)ç“¦æ–¯ç‰¹<br>1409, vastly  [ËˆvÉ‘:stli]<br>adv. æå¤§åœ°ï¼›å¹¿å¤§åœ°ï¼›æ·±è¿œåœ°<br>1410, vector  [â€˜vÉ›ktÉš]<br>n. çŸ¢é‡ï¼›å¸¦èŒè€…ï¼›èˆªçº¿<br>vt. ç”¨æ— çº¿ç”µå¯¼èˆª<br>1411, vehicle  [â€˜viËÉªkl]<br>n. [è½¦è¾†] è½¦è¾†ï¼›å·¥å…·ï¼›äº¤é€šå·¥å…·ï¼›è¿è½½å·¥å…·ï¼›ä¼ æ’­åª’ä»‹ï¼›åª’ä»‹ç‰©<br>1412, velocity  [vÉ™ËˆlÉ’sÉ™ti]<br>n. ã€ç‰©ã€‘é€Ÿåº¦<br>1413, Velocity  [vÉ™ËˆlÉ’sÉ™ti]<br>n. [åŠ›] é€Ÿç‡ï¼›è¿…é€Ÿï¼›å‘¨è½¬ç‡<br>1414, vendor  [â€˜vÉ›ndÉš]<br>n. å–ä¸»ï¼›å°è´©ï¼›ä¾›åº”å•†ï¼›[è´¸æ˜“] è‡ªåŠ¨å”®è´§æœº<br>1415, Venus  [â€˜viËnÉ™s]<br>n. [å¤©] é‡‘æ˜Ÿï¼›ç»´çº³æ–¯ï¼ˆçˆ±ä¸ç¾çš„å¥³ç¥ï¼‰<br>1416, verbose  [vÉœËâ€™bÉ™ÊŠs]<br>adj. å†—é•¿çš„ï¼›å•°å—¦çš„<br>1417, verify  [â€˜verÉªfaÉª]<br>vt. æ ¸å®ï¼›æŸ¥è¯<br>1418, versatile  [â€˜vÉœËsÉ™taÉªl]<br>adj. å¤šæ‰å¤šè‰ºçš„ï¼›é€šç”¨çš„ï¼Œä¸‡èƒ½çš„ï¼›å¤šé¢æ‰‹çš„<br>1419, versus  [â€˜vÉsÉ™s]<br>prep. å¯¹ï¼›ä¸â€¦ç›¸å¯¹ï¼›å¯¹æŠ—<br>1420, vetting  [vetting]<br>n. å®¡æŸ¥ï¼Œå®¡æ ¸<br>1421, via  [ËˆvaÉªÉ™ï¼ŒËˆviËÉ™]<br>prep. æ¸ é“ï¼Œé€šè¿‡ï¼›ç»ç”±<br>1422, vigorously  [â€˜vÉªgÉ™rÉ™sli]<br>adv. ç²¾ç¥æ—ºç››åœ°ï¼Œæ´»æ³¼åœ°<br>1423, violation  [vaÉªÉ™â€™leÉªÊƒn]<br>n. è¿åï¼›å¦¨ç¢ï¼Œä¾µå®³ï¼›è¿èƒŒï¼›å¼ºå¥¸<br>1424, virtue  [â€˜vÉœËtjuË; -tÊƒuË]<br>n. ç¾å¾·ï¼›ä¼˜ç‚¹ï¼›è´æ“ï¼›åŠŸæ•ˆ;<br>n. (Virtue)äººåï¼›(è‹±)å¼—ä¸˜<br>1425, visual  [â€˜vÉªÊ’jÊŠÉ™l; -zj-]<br>adj. è§†è§‰çš„ï¼Œè§†åŠ›çš„ï¼›æ ©æ ©å¦‚ç”Ÿçš„<br>1426, Visual  [â€˜vÉªÊ’jÊŠÉ™l; -zj-]<br>adj. è§†è§‰çš„ï¼Œè§†åŠ›çš„ï¼›æ ©æ ©å¦‚ç”Ÿçš„<br>1427, volatile  [â€˜vÉ’lÉ™taÉªl]<br>adj. [åŒ–å­¦] æŒ¥å‘æ€§çš„ï¼›ä¸ç¨³å®šçš„ï¼›çˆ†ç‚¸æ€§çš„ï¼›åå¤æ— å¸¸çš„;<br>n. æŒ¥å‘ç‰©ï¼›æœ‰ç¿…çš„åŠ¨ç‰©;<br>n. (Volatile)äººåï¼›(æ„)æ²ƒæ‹‰è’‚è±<br>1428, volatility  [,vÉ‘lÉ™â€™tÉªlÉ™ti]<br>n. [åŒ–å­¦] æŒ¥å‘æ€§ï¼›æ˜“å˜ï¼›æ´»æ³¼<br>1429, voltage  [â€˜voltÉªdÊ’]<br>n. [ç”µ] ç”µå‹<br>1430, vulnerabilities<br>n. ç¼ºé™·ï¼ˆvulnerabilityçš„å¤æ•°å½¢å¼ï¼‰ï¼›è„†å¼±ç‚¹<br>1431, walkthrough<br>n. é¢„æ’ï¼Œé¢„æ’å·¥ä½œ<br>1432, wall-mounted  [,wÉ”:lâ€™mauntid]<br>adj. å›ºå®šåœ¨å¢™ä¸Šçš„ï¼›å®‰è£…åœ¨å¢™ä¸Šçš„<br>1433, warranty  [â€˜wÉ”rÉ™nti]<br>n. ä¿è¯ï¼›æ‹…ä¿ï¼›æˆæƒï¼›ï¼ˆæ­£å½“ï¼‰ç†ç”±<br>1434, webcasts  []<br>n. ç½‘ç»œå¹¿æ’­ï¼ˆwebcastçš„å¤æ•°ï¼‰<br>1435, webinar  [â€˜webÉªnÉ‘Ë]<br>n. ç½‘ç»œç ”è®¨ä¼šï¼›åœ¨çº¿ä¼šè®®<br>1436, weighted  [â€˜wetÉªd]<br>adj. [æ•°] åŠ æƒçš„ï¼›åŠ é‡çš„ï¼›è¡¡é‡è¿‡çš„<br>v. åŠ é‡é‡äºâ€¦ï¼›é‡å‹ï¼ˆweightçš„è¿‡å»åˆ†è¯ï¼‰<br>1437, well-distributed<br>å‡åŒ€<br>1438, whence  [wens]<br>n. æ ¹æº<br>adv. ä»ä½•å¤„<br>pron. ä½•å¤„<br>conj. ç”±æ­¤<br>1439, whoop  [wuËp]<br>n. å¤§å«ï¼›å“®å–˜å£°ï¼›å‘å–Šï¼›ä¸€ç‚¹ç‚¹<br>vt. é«˜å£°è¯´ï¼›å”¤èµ·<br>vi. å«å–Šï¼›å–˜æ¯<br>1440, whore  [hÉ”Ë]<br>vi.å–æ·«ï¼Œå¨¼å¦“<br>n.å¨¼å¦“ï¼Œæ·«å¦‡<br>1441, wicked  [â€˜wÉªkÉªd]<br>adj. é‚ªæ¶çš„ï¼›æ¶åŠ£çš„ï¼›ä¸é“å¾·çš„ï¼›é¡½çš®çš„<br>1442, widgets  []<br>n. å°å·¥å…·ï¼ˆwidgetçš„å¤æ•°ï¼‰ï¼›çª—ä½“å°éƒ¨ä»¶<br>1443, wiggle  [â€˜wÉªÉ¡l]<br>vt. ä½¿â€¦â€¦æ‘†åŠ¨ï¼Œä½¿â€¦â€¦æ‰­åŠ¨<br>vi. æ‘†åŠ¨<br>n. æ‰­åŠ¨<br>1444, wildcard  [â€˜waÉªldkÉ‘rd]<br>n. é€šé…ç¬¦<br>1445, wipe  [waÉªp]<br>vt. æ“¦ï¼›æ¶ˆé™¤ï¼›æ¶‚ä¸Š;<br>vi. æ“¦ï¼›æ‰“;<br>n. æ“¦æ‹­ï¼›ç”¨åŠ›æ‰“<br>1446, wizard  [â€˜wÉªzÉ™d]<br>n. ç”·å·«ï¼›æœ¯å£«ï¼›å¥‡æ‰ï¼›å‘å¯¼ç¨‹åº</p><p>adj. ç”·å·«çš„ï¼›å·«æœ¯çš„<br>1447, Wizard  [â€˜wÉªzÉ™d]<br>n. ç”·å·«ï¼›æœ¯å£«ï¼›å¥‡æ‰;<br>adj. ç”·å·«çš„ï¼›å·«æœ¯çš„<br>1448, workbench  [â€˜wÉkbÉ›ntÊƒ]<br>n. å·¥ä½œå°ï¼›æ‰‹å·¥å°<br>1449, worthwhile  [wÉœËÎ¸â€™waÉªl]<br>adj. å€¼å¾—åšçš„ï¼Œå€¼å¾—èŠ±æ—¶é—´çš„<br>1450, wrap  [rÃ¦p]<br>vt. åŒ…ï¼›ç¼ ç»•ï¼›éšè—ï¼›æ©æŠ¤;<br>vi. åŒ…èµ·æ¥ï¼›ç¼ ç»•ï¼›ç©¿å¤–è¡£;<br>n. å¤–å¥—ï¼›å›´å·¾<br>1451, WRT  [WRT]<br>abbr. å…³äºï¼ˆWith Regard Toï¼‰<br>1452, xenial  [xenial]<br>adj. å¼‚èŠ±å—ç²‰çš„ï¼›ä¸»å®¢å…³ç³»çš„ï¼›æ¬¾å¾…çš„<br>1453, zap  [zÃ¦p]<br>n. æ´»åŠ›ï¼›æ„å¿—ï¼›æ€æ­»ï¼›éœ‡å‡»</p><p>vt. æ”»å‡»ï¼›æ‰“è´¥ï¼›å¿«é€Ÿæ¨åŠ¨</p><p>vi. å¿«é€Ÿç§»åŠ¨</p><p>int. å’ï¼ï¼›ç³Ÿäº†ï¼<br>1454, æ¼”ç¤º  [yÇn shÃ¬]<br>demonstration;<br>show-how;<br>reproduction</p>]]></content>
      
      
      <categories>
          
          <category> Words </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Words </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[è¯‘]ZGC: ä¸€ä¸ªå¯ä¼¸ç¼©çš„ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨</title>
      <link href="/zgc-a-scalable-low-latency-garbage-collector.html"/>
      <url>/zgc-a-scalable-low-latency-garbage-collector.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç¿»è¯‘è‡ªï¼šJEP 333</p></blockquote><a id="more"></a><blockquote><p>åœ°å€ï¼š<a href="https://openjdk.java.net/jeps/333" target="_blank" rel="noopener">https://openjdk.java.net/jeps/333</a></p></blockquote><h1 id="ä¸€ã€æ‘˜è¦"><a href="#ä¸€ã€æ‘˜è¦" class="headerlink" title="ä¸€ã€æ‘˜è¦"></a>ä¸€ã€æ‘˜è¦</h1><p>Zåƒåœ¾æ”¶é›†å™¨ï¼Œä¹Ÿç§°ä¸ºZGCï¼Œæ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©çš„ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ã€‚</p><h1 id="äºŒã€ç›®æ ‡"><a href="#äºŒã€ç›®æ ‡" class="headerlink" title="äºŒã€ç›®æ ‡"></a>äºŒã€ç›®æ ‡</h1><ul><li>GCæš‚åœæ—¶é—´ä¸è¶…è¿‡10ms</li><li>èƒ½å¤„ç†å¤§å°ä»ç›¸å¯¹è¾ƒå°(å‡ ç™¾MB)åˆ°éå¸¸å¤§(TBçº§)çš„å †</li><li>ä¸ä½¿ç”¨G1ç›¸æ¯”ï¼Œåº”ç”¨ç¨‹åºååé‡å‡å°‘ä¸è¶…è¿‡15%</li><li>æ–¹ä¾¿æ—¥ååœ¨æ­¤åŸºç¡€ä¸Šåˆ©ç”¨å½©è‰²æŒ‡é’ˆå’Œå†…å­˜å±éšœè¿›ä¸€æ­¥ä¼˜åŒ–æ”¶é›†å™¨åŠå®ç°æ–°ç‰¹æ€§ã€‚ã€åŸæ–‡ï¼šLay a foundation for future GC features and optimizations leveraging colored pointers and load barriersã€‘</li><li>æ”¯æŒå¹³å°:Linux/x64</li></ul><blockquote><p>æ³¨ï¼šæ­¤å¤„åŠä¸‹æ–‡ä¸­çš„å†…å­˜å±éšœå³load barrierï¼Œåœ¨ZGCä¸­ç”¨çš„æ˜¯è¯»å±éšœã€‚</p></blockquote><h1 id="ä¸‰ã€åŠ¨æœº"><a href="#ä¸‰ã€åŠ¨æœº" class="headerlink" title="ä¸‰ã€åŠ¨æœº"></a>ä¸‰ã€åŠ¨æœº</h1><p>åƒåœ¾æ”¶é›†æ˜¯Javaçš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€ã€‚ä½†æ˜¯ï¼Œå½“åƒåœ¾æ”¶é›†æš‚åœå¤ªé•¿æ—¶ï¼Œå°±ä¼šå¯¹åº”ç”¨ç¨‹åºçš„å“åº”æ—¶é—´äº§ç”Ÿè´Ÿé¢å½±å“ã€‚é€šè¿‡å¤§å¹…åº¦ç¼©çŸ­åœé¡¿æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥è®©Javaé€‚ç”¨äºæ›´å¤šç±»å‹çš„åº”ç”¨ç¨‹åºã€‚</p><p>æ­¤å¤–ï¼Œç°ä»£ç³»ç»Ÿä¸­å¯ç”¨çš„å†…å­˜æ•°é‡è¿˜åœ¨ç»§ç»­å¢é•¿ã€‚<strong>ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¸Œæœ›JVMèƒ½å¤Ÿä»¥ä¸€ç§æœ‰æ•ˆçš„æ–¹å¼å……åˆ†åˆ©ç”¨è¿™ç§å†…å­˜ï¼Œå¹¶ä¸”ä¸ä¼šå‡ºç°å¾ˆé•¿çš„GCæš‚åœæ—¶é—´ã€‚</strong></p><h1 id="å››ã€-æè¿°"><a href="#å››ã€-æè¿°" class="headerlink" title="å››ã€ æè¿°"></a>å››ã€ æè¿°</h1><p>ZGCæ˜¯ä¸€ä¸ªå¹¶å‘çš„ã€å•ä»£ï¼ˆä¸å†åŒºåˆ†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼‰çš„ã€åŸºäºregionçš„ã€æ”¯æŒnumaçš„å‹ç¼©æ”¶é›†å™¨ã€‚Stop-the-worldé˜¶æ®µä»…é™äºæ ¹æ‰«æï¼Œæ‰€ä»¥GCæš‚åœæ—¶é—´ä¸ä¼šéšç€å †æˆ–å­˜æ´»å¯¹è±¡çš„å¤šå°‘è€Œå¢åŠ ã€‚</p><p><font color="DeepPink">ZGCçš„ä¸€ä¸ªæ ¸å¿ƒè®¾è®¡åŸåˆ™æ˜¯ç»“åˆä½¿ç”¨å†…å­˜å±éšœå’Œå½©è‰²å¯¹è±¡æŒ‡é’ˆã€‚è¿™ä½¿å¾—ZGCèƒ½å¤Ÿåœ¨è¿è¡ŒJavaåº”ç”¨ç¨‹åºçº¿ç¨‹æ—¶æ‰§è¡Œå¹¶å‘æ“ä½œï¼Œæ¯”å¦‚å¯¹è±¡é‡å®šä½ã€‚ä»Javaçº¿ç¨‹çš„è§’åº¦æ¥çœ‹ï¼Œåœ¨Javaå¯¹è±¡ä¸­åŠ è½½å¼•ç”¨å­—æ®µçš„è¡Œä¸ºå—åˆ°å†…å­˜å±éšœçš„é™åˆ¶ã€‚é™¤äº†å¯¹è±¡åœ°å€ä¹‹å¤–ï¼Œæœ‰è‰²å¯¹è±¡æŒ‡é’ˆè¿˜åŒ…å«å†…å­˜å±éšœéœ€è¦çš„ä¿¡æ¯ï¼Œç”¨äºç¡®å®šåœ¨å…è®¸Javaçº¿ç¨‹ä½¿ç”¨è¯¥æŒ‡é’ˆä¹‹å‰æ˜¯å¦éœ€è¦é‡‡å–æŸäº›æ“ä½œã€‚</font>ä¾‹å¦‚ï¼Œå¯¹è±¡å¯èƒ½å·²ç»è¢«é‡æ–°å®šä½ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå†…å­˜å±éšœå°†æ£€æµ‹æƒ…å†µå¹¶é‡‡å–é€‚å½“çš„æ“ä½œã€‚</p><p>ä¸å…¶ä»–æŠ€æœ¯ç›¸æ¯”ï¼Œæˆ‘ä»¬è®¤ä¸ºé¢œè‰²æŒ‡é’ˆæ–¹æ¡ˆæä¾›äº†ä¸€äº›éå¸¸å¸å¼•äººçš„ç‰¹æ€§ã€‚ç‰¹åˆ«æ˜¯:</p><ul><li><p>è¿™å…è®¸æˆ‘ä»¬åœ¨ç§»åŠ¨å¯¹è±¡/æ•´ç†å†…å­˜é˜¶æ®µï¼Œåœ¨æŒ‡å‘å¯å›æ”¶/é‡ç”¨åŒºåŸŸçš„æŒ‡é’ˆç¡®å®šä¹‹å‰å›æ”¶/é‡ç”¨è¿™éƒ¨åˆ†å†…å­˜ã€åŸæ–‡ï¼šIt allows us to reclaim and reuse memory during the relocation/compaction phase, before pointers pointing into the reclaimed/reused regions have been fixed. ã€‘ã€‚è¿™æœ‰åŠ©äºé™ä½å †å¼€é”€ã€‚è¿™è¿˜æ„å‘³ç€ä¸éœ€è¦å®ç°å•ç‹¬çš„æ ‡è®°å‹ç¼©ç®—æ³•æ¥å¤„ç†å®Œæ•´çš„GCã€‚</p></li><li><p>è¿™å…è®¸æˆ‘ä»¬ä½¿ç”¨ç›¸å¯¹è¾ƒå°‘ä¸”ç®€å•çš„GCå±éšœã€‚è¿™æœ‰åŠ©äºé™ä½è¿è¡Œæ—¶å¼€é”€ã€‚è¿™è¿˜æ„å‘³ç€åœ¨è§£é‡Šå™¨å’ŒJITç¼–è¯‘å™¨ä¸­æ›´å®¹æ˜“å®ç°ã€ä¼˜åŒ–å’Œç»´æŠ¤GC barrierä»£ç ã€‚</p></li><li><p>æˆ‘ä»¬ç›®å‰å°†æ ‡è®°å’Œé‡æ–°å®šä½ç›¸å…³ä¿¡æ¯å­˜å‚¨åœ¨å½©è‰²æŒ‡é’ˆä¸­ã€‚ç„¶è€Œï¼Œæ­¤æ–¹æ¡ˆçš„é€šç”¨æ€§å…è®¸æˆ‘ä»¬å­˜å‚¨ä»»ä½•ç±»å‹çš„ä¿¡æ¯(åªè¦æˆ‘ä»¬èƒ½å°†å…¶æ”¾å…¥æŒ‡é’ˆä¸­)ï¼Œå¹¶å…è®¸å†…å­˜å±éšœæ ¹æ®è¯¥ä¿¡æ¯é‡‡å–å®ƒæƒ³è¦é‡‡å–çš„ä»»ä½•æ“ä½œã€‚æˆ‘ä»¬ç›¸ä¿¡è¿™å°†ä¸ºå°†æ¥çš„è®¸å¤šç‰¹æ€§æ‰“ä¸‹åŸºç¡€ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œåœ¨å¼‚æ„å†…å­˜ç¯å¢ƒä¸­ï¼Œè¿™å¯ä»¥ç”¨æ¥è·Ÿè¸ªå †è®¿é—®æ¨¡å¼ï¼Œä»¥æŒ‡å¯¼GCé‡æ–°å®šä½å†³ç­–ï¼Œå°†å¾ˆå°‘ä½¿ç”¨çš„å¯¹è±¡ç§»åŠ¨åˆ°å†·å­˜å‚¨(ä¸å¸¸è®¿é—®çš„å†…å­˜åŒºåŸŸ)ä¸­ã€åŸæ–‡ï¼šTo pick one example, in a heterogeneous memory environment, this could be used to track heap access patterns to guide GC relocation decisions to move rarely used objects to cold storage.ã€‘ã€‚</p></li></ul><h1 id="äº”ã€æ€§èƒ½"><a href="#äº”ã€æ€§èƒ½" class="headerlink" title="äº”ã€æ€§èƒ½"></a>äº”ã€æ€§èƒ½</h1><p>æˆ‘ä»¬å·²ç»ä½¿ç”¨SPECjbb 2015[1]åšäº†å¸¸è§„æ€§èƒ½æµ‹è¯•ã€‚ä»ååé‡å’Œå»¶è¿Ÿè§’åº¦æ¥çœ‹ï¼Œæ€§èƒ½éƒ½å¾ˆå¥½ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨128Gå †åœ¨å¤åˆæ¨¡å¼ä¸‹æ¯”è¾ƒZGCå’ŒG1çš„å…¸å‹åŸºå‡†åˆ†æ•°(ä»¥ç™¾åˆ†æ¯”ä¸ºå•ä½ï¼Œæ ¹æ®ZGCçš„max-jOPSè¿›è¡Œæ ‡å‡†åŒ–)ã€åŸæ–‡ï¼šBelow are typical benchmark scores (in percent, normalized against ZGCâ€™s max-jOPS), comparing ZGC and G1, in composite mode using a 128G heap.ã€‘ï¼š</p><blockquote><p>è¶Šé«˜è¶Šå¥½</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ZGC</span><br><span class="line">       max-jOPS: 100%</span><br><span class="line">  critical-jOPS: 76.1%</span><br><span class="line"></span><br><span class="line">G1</span><br><span class="line">       max-jOPS: 91.2%</span><br><span class="line">  critical-jOPS: 54.7%</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯æ¥è‡ªç›¸åŒåŸºå‡†æµ‹è¯•çš„GCæš‚åœæ—¶é—´ã€‚ZGCè®¾æ³•ä¿æŒè¿œä½äº10msçš„ç›®æ ‡ã€‚æ³¨æ„ï¼Œç¡®åˆ‡çš„æ•°å­—å¯èƒ½ä¼šæ ¹æ®ä½¿ç”¨çš„æœºå™¨å’Œè®¾ç½®è€Œå˜åŒ–(ä¸Šä¸‹éƒ½æœ‰ï¼Œä½†ä¸æ˜¯å¾ˆæ˜æ˜¾)ã€‚</p><blockquote><p>è¶Šä½è¶Šå¥½</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ZGC</span><br><span class="line">                avg: 1.091ms (+/-0.215ms)</span><br><span class="line">    95th percentile: 1.380ms</span><br><span class="line">    99th percentile: 1.512ms</span><br><span class="line">  99.9th percentile: 1.663ms</span><br><span class="line"> 99.99th percentile: 1.681ms</span><br><span class="line">                max: 1.681ms</span><br><span class="line"></span><br><span class="line">G1</span><br><span class="line">                avg: 156.806ms (+/-71.126ms)</span><br><span class="line">    95th percentile: 316.672ms</span><br><span class="line">    99th percentile: 428.095ms</span><br><span class="line">  99.9th percentile: 543.846ms</span><br><span class="line"> 99.99th percentile: 543.846ms</span><br><span class="line">                max: 543.846ms</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯¹å…¶ä»–å„ç§SPECÂ®åŸºå‡†æµ‹è¯•å’Œå†…éƒ¨å·¥ä½œè´Ÿè½½è¿›è¡Œäº†ç‰¹åˆ«çš„æ€§èƒ½æµ‹é‡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒZGCèƒ½å¤Ÿç»´æŠ¤ä¸ªä½æ•°çš„æ¯«ç§’æš‚åœæ—¶é—´ã€‚</p><h1 id="å…­ã€-å±€é™æ€§"><a href="#å…­ã€-å±€é™æ€§" class="headerlink" title="å…­ã€ å±€é™æ€§"></a>å…­ã€ å±€é™æ€§</h1><p>ZGCçš„åˆå§‹å®éªŒç‰ˆæœ¬å°†ä¸æ”¯æŒç±»å¸è½½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œclassunloadå’ŒClassUnloadingWithConcurrentMarké€‰é¡¹å°†è¢«ç¦ç”¨ã€‚å³ä¾¿ä½ å¯ç”¨ä¹Ÿæ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚</p><p>æ­¤å¤–ï¼ŒZGCæœ€åˆä¸æ”¯æŒJVMCI(å³Graal)ã€‚å¦‚æœå¯ç”¨EnableJVMCIé€‰é¡¹ï¼Œå°†æ‰“å°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ã€‚</p><p>è¿™äº›é™åˆ¶å°†åœ¨æœ¬é¡¹ç›®çš„åæœŸè§£å†³ã€‚</p><h1 id="ä¸ƒã€-æ„å»ºå’Œä½¿ç”¨"><a href="#ä¸ƒã€-æ„å»ºå’Œä½¿ç”¨" class="headerlink" title="ä¸ƒã€ æ„å»ºå’Œä½¿ç”¨"></a>ä¸ƒã€ æ„å»ºå’Œä½¿ç”¨</h1><p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæ„å»ºç³»ç»Ÿé»˜è®¤ç¦ç”¨JVMä¸­çš„å®éªŒæ€§ç‰¹æ€§ã€‚ZGCæ˜¯ä¸€ä¸ªå®éªŒæ€§ç‰¹æ€§ï¼Œå› æ­¤ä¸ä¼šå‡ºç°åœ¨JDKæ„å»ºä¸­ï¼Œé™¤éåœ¨ç¼–è¯‘æ—¶ä½¿ç”¨configureé€‰é¡¹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--with-jvm-features=zgc</span><br></pre></td></tr></table></figure><p>æ˜¾å¼åœ°å¯ç”¨å®ƒã€‚</p><p>(ZGCå°†å‡ºç°åœ¨Oracleå‘å¸ƒçš„æ‰€æœ‰Linux/x64 JDKç‰ˆæœ¬ä¸­)</p><p>JVMä¸­çš„å®éªŒç‰¹æ€§è¿˜éœ€è¦åœ¨è¿è¡Œæ—¶æ˜¾å¼åœ°è§£é”ã€‚å› æ­¤ï¼Œè¦å¯ç”¨/ä½¿ç”¨ZGCï¼Œéœ€è¦ä»¥ä¸‹JVMé€‰é¡¹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:+ unlockexperimental alvmoptions -XX:+UseZGC</span><br></pre></td></tr></table></figure><p>æœ‰å…³å¦‚ä½•è®¾ç½®å’Œè°ƒä¼˜ZGCçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ZGCé¡¹ç›®Wikiï¼ˆwikiåœ°å€ï¼š<a href="https://wiki.openjdk.java.net/display/zgc/Mainï¼‰ã€‚" target="_blank" rel="noopener">https://wiki.openjdk.java.net/display/zgc/Mainï¼‰ã€‚</a></p><p>ZGC paperå¯ä»¥å‚è€ƒAzul Pauseless GC Algorithmï¼š</p><p><a href="https://github.com/jiankunking/books-recommendation/blob/master/GC/ZGC/Azul_Pauseless_GC_Algorithm.pdf" target="_blank" rel="noopener">https://github.com/jiankunking/books-recommendation/blob/master/GC/ZGC/Azul_Pauseless_GC_Algorithm.pdf</a></p><p>ZGC ç®€ä»‹PPT:</p><p><a href="https://github.com/jiankunking/books-recommendation/blob/master/GC/ZGC/ZGC-FOSDEM-2018.pdf" target="_blank" rel="noopener">https://github.com/jiankunking/books-recommendation/blob/master/GC/ZGC/ZGC-FOSDEM-2018.pdf</a></p>]]></content>
      
      
      <categories>
          
          <category> GC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> GC </tag>
            
            <tag> ZGC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ElasticSearch æŸ¥è¯¢çš„ç§˜å¯†</title>
      <link href="/elasticsearch-query-secret.html"/>
      <url>/elasticsearch-query-secret.html</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å‚ä¸ä¸€ä¸ªåŸºäºElasticsearchä½œä¸ºåº•å±‚æ•°æ®æ¡†æ¶æä¾›å¤§æ•°æ®é‡(äº¿çº§)çš„å®æ—¶ç»Ÿè®¡æŸ¥è¯¢çš„æ–¹æ¡ˆè®¾è®¡å·¥ä½œï¼ŒèŠ±äº†äº›æ—¶é—´å­¦ä¹ Elasticsearchçš„åŸºç¡€ç†è®ºçŸ¥è¯†ï¼Œæ•´ç†äº†ä¸€ä¸‹ï¼Œå¸Œæœ›èƒ½å¯¹Elasticsearchæ„Ÿå…´è¶£/æƒ³äº†è§£çš„åŒå­¦æœ‰æ‰€å¸®åŠ©ã€‚<br>åŒæ—¶ä¹Ÿå¸Œæœ›æœ‰å‘ç°å†…å®¹ä¸æ­£ç¡®æˆ–è€…æœ‰ç–‘é—®çš„åœ°æ–¹ï¼Œæœ›æŒ‡æ˜ï¼Œä¸€èµ·æ¢è®¨ï¼Œå­¦ä¹ ï¼Œè¿›æ­¥ã€‚</p><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><blockquote><p>Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å¯æ‰©å±•çš„å®æ—¶æœç´¢å’Œåˆ†æå¼•æ“.</p></blockquote><p>Elasticsearch æ˜¯ä¸€ä¸ªå»ºç«‹åœ¨å…¨æ–‡æœç´¢å¼•æ“ Apache Lucene(TM) åŸºç¡€ä¸Šçš„æœç´¢å¼•æ“.<br>å½“ç„¶ Elasticsearch å¹¶ä¸ä»…ä»…æ˜¯ Lucene é‚£ä¹ˆç®€å•ï¼Œå®ƒä¸ä»…åŒ…æ‹¬äº†å…¨æ–‡æœç´¢åŠŸèƒ½ï¼Œè¿˜å¯ä»¥è¿›è¡Œä»¥ä¸‹å·¥ä½œ:</p><ul><li>åˆ†å¸ƒå¼å®æ—¶æ–‡ä»¶å­˜å‚¨ï¼Œå¹¶å°†æ¯ä¸€ä¸ªå­—æ®µéƒ½ç¼–å…¥ç´¢å¼•ï¼Œä½¿å…¶å¯ä»¥è¢«æœç´¢ã€‚</li><li>å®æ—¶åˆ†æçš„åˆ†å¸ƒå¼æœç´¢å¼•æ“ã€‚</li><li>å¯ä»¥æ‰©å±•åˆ°ä¸Šç™¾å°æœåŠ¡å™¨ï¼Œå¤„ç†PBçº§åˆ«çš„ç»“æ„åŒ–æˆ–éç»“æ„åŒ–æ•°æ®ã€‚</li></ul><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p>å…ˆè¯´Elasticsearchçš„æ–‡ä»¶å­˜å‚¨ï¼ŒElasticsearchæ˜¯é¢å‘æ–‡æ¡£å‹æ•°æ®åº“ï¼Œä¸€æ¡æ•°æ®åœ¨è¿™é‡Œå°±æ˜¯ä¸€ä¸ªæ–‡æ¡£ï¼Œç”¨JSONä½œä¸ºæ–‡æ¡£åºåˆ—åŒ–çš„æ ¼å¼ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ¡ç”¨æˆ·æ•°æ®ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span> :     <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">"sex"</span> :      <span class="string">"Male"</span>,</span><br><span class="line">    <span class="attr">"age"</span> :      <span class="number">25</span>,</span><br><span class="line">    <span class="attr">"birthDate"</span>: <span class="string">"1990/05/01"</span>,</span><br><span class="line">    <span class="attr">"about"</span> :    <span class="string">"I love to go rock climbing"</span>,</span><br><span class="line">    <span class="attr">"interests"</span>: [ <span class="string">"sports"</span>, <span class="string">"music"</span> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨Mysqlè¿™æ ·çš„æ•°æ®åº“å­˜å‚¨å°±ä¼šå®¹æ˜“æƒ³åˆ°å»ºç«‹ä¸€å¼ Userè¡¨ï¼Œæœ‰balabalaçš„å­—æ®µç­‰ï¼Œåœ¨Elasticsearché‡Œè¿™å°±æ˜¯ä¸€ä¸ª<em>æ–‡æ¡£</em>ï¼Œå½“ç„¶è¿™ä¸ªæ–‡æ¡£ä¼šå±äºä¸€ä¸ªUserçš„<em>ç±»å‹</em>ï¼Œå„ç§å„æ ·çš„ç±»å‹å­˜åœ¨äºä¸€ä¸ª<em>ç´¢å¼•</em>å½“ä¸­ã€‚è¿™é‡Œæœ‰ä¸€ä»½ç®€æ˜“çš„å°†Elasticsearchå’Œå…³ç³»å‹æ•°æ®æœ¯è¯­å¯¹ç…§è¡¨:</p><p>å…³ç³»æ•°æ®åº“     â‡’ æ•°æ®åº“ â‡’ è¡¨    â‡’ è¡Œ    â‡’ åˆ—(Columns)</p><p>Elasticsearch  â‡’ ç´¢å¼•   â‡’ ç±»å‹  â‡’ æ–‡æ¡£  â‡’ å­—æ®µ(Fields)</p><p>ä¸€ä¸ª Elasticsearch é›†ç¾¤å¯ä»¥åŒ…å«å¤šä¸ªç´¢å¼•(æ•°æ®åº“)ï¼Œä¹Ÿå°±æ˜¯è¯´å…¶ä¸­åŒ…å«äº†å¾ˆå¤šç±»å‹(è¡¨)ã€‚è¿™äº›ç±»å‹ä¸­åŒ…å«äº†å¾ˆå¤šçš„æ–‡æ¡£(è¡Œ)ï¼Œç„¶åæ¯ä¸ªæ–‡æ¡£ä¸­åˆåŒ…å«äº†å¾ˆå¤šçš„å­—æ®µ(åˆ—)ã€‚</p><p>Elasticsearchçš„äº¤äº’ï¼Œå¯ä»¥ä½¿ç”¨Java APIï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨HTTPçš„Restful APIæ–¹å¼ï¼Œæ¯”å¦‚æˆ‘ä»¬æ‰“ç®—æ’å…¥ä¸€æ¡è®°å½•ï¼Œå¯ä»¥ç®€å•å‘é€ä¸€ä¸ªHTTPçš„è¯·æ±‚ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT /megacorp/employee/1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span> :     <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">"sex"</span> :      <span class="string">"Male"</span>,</span><br><span class="line">    <span class="attr">"age"</span> :      <span class="number">25</span>,</span><br><span class="line">    <span class="attr">"about"</span> :    <span class="string">"I love to go rock climbing"</span>,</span><br><span class="line">    <span class="attr">"interests"</span>: [ <span class="string">"sports"</span>, <span class="string">"music"</span> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´æ–°ï¼ŒæŸ¥è¯¢ä¹Ÿæ˜¯ç±»ä¼¼è¿™æ ·çš„æ“ä½œï¼Œå…·ä½“æ“ä½œæ‰‹å†Œå¯ä»¥å‚è§<a href="http://www.learnes.net/data/README.html" target="_blank" rel="noopener">Elasticsearchæƒå¨æŒ‡å—</a></p><hr><h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><p>Elasticsearchæœ€å…³é”®çš„å°±æ˜¯æä¾›å¼ºå¤§çš„ç´¢å¼•èƒ½åŠ›äº†ï¼Œå…¶å®InfoQçš„è¿™ç¯‡<a href="http://www.infoq.com/cn/articles/database-timestamp-02?utm_source=infoq&utm_medium=related_content_link&utm_campaign=relatedContent_articles_clk" target="_blank" rel="noopener">æ—¶é—´åºåˆ—æ•°æ®åº“çš„ç§˜å¯†(2)â€”â€”ç´¢å¼•</a>å†™çš„éå¸¸å¥½ï¼Œæˆ‘è¿™é‡Œä¹Ÿæ˜¯å›´ç»•è¿™ç¯‡ç»“åˆè‡ªå·±çš„ç†è§£è¿›ä¸€æ­¥æ¢³ç†ä¸‹ï¼Œä¹Ÿå¸Œæœ›å¯ä»¥å¸®åŠ©å¤§å®¶æ›´å¥½çš„ç†è§£è¿™ç¯‡æ–‡ç« ã€‚</p><p>Elasticsearchç´¢å¼•çš„ç²¾é«“ï¼š</p><blockquote><p>ä¸€åˆ‡è®¾è®¡éƒ½æ˜¯ä¸ºäº†æé«˜æœç´¢çš„æ€§èƒ½</p></blockquote><p>å¦ä¸€å±‚æ„æ€ï¼šä¸ºäº†æé«˜æœç´¢çš„æ€§èƒ½ï¼Œéš¾å…ä¼šç‰ºç‰²æŸäº›å…¶ä»–æ–¹é¢ï¼Œæ¯”å¦‚æ’å…¥/æ›´æ–°ï¼Œå¦åˆ™å…¶ä»–æ•°æ®åº“ä¸ç”¨æ··äº†:)</p><p>å‰é¢çœ‹åˆ°å¾€Elasticsearché‡Œæ’å…¥ä¸€æ¡è®°å½•ï¼Œå…¶å®å°±æ˜¯ç›´æ¥PUTä¸€ä¸ªjsonçš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æœ‰å¤šä¸ªfieldsï¼Œæ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­çš„<em>name, sex, age, about, interests</em>ï¼Œé‚£ä¹ˆåœ¨æ’å…¥è¿™äº›æ•°æ®åˆ°Elasticsearchçš„åŒæ—¶ï¼ŒElasticsearchè¿˜é»˜é»˜<a href="Elasticsearché»˜è®¤ä¼šä¸ºæ¯ä¸ªå­—æ®µæ ¹æ®valueçš„ç±»å‹åˆ†åˆ«å»ºç«‹ç´¢å¼•ï¼Œå¦‚æœä¸æƒ³ä¸ºæŸäº›å­—æ®µå»ºç«‹ç´¢å¼•æˆ–è€…ä¸åšåˆ†è¯åˆ†æçš„è¯ï¼Œéœ€è¦é€šè¿‡FieldMappingæ³¨æ˜">^1</a>çš„ä¸ºè¿™äº›å­—æ®µå»ºç«‹ç´¢å¼•â€“å€’æ’ç´¢å¼•ï¼Œå› ä¸ºElasticsearchæœ€æ ¸å¿ƒåŠŸèƒ½æ˜¯æœç´¢ã€‚</p><h3 id="Elasticsearchæ˜¯å¦‚ä½•åšåˆ°å¿«é€Ÿç´¢å¼•çš„"><a href="#Elasticsearchæ˜¯å¦‚ä½•åšåˆ°å¿«é€Ÿç´¢å¼•çš„" class="headerlink" title="Elasticsearchæ˜¯å¦‚ä½•åšåˆ°å¿«é€Ÿç´¢å¼•çš„"></a>Elasticsearchæ˜¯å¦‚ä½•åšåˆ°å¿«é€Ÿç´¢å¼•çš„</h3><p>InfoQé‚£ç¯‡æ–‡ç« é‡Œè¯´Elasticsearchä½¿ç”¨çš„å€’æ’ç´¢å¼•æ¯”å…³ç³»å‹æ•°æ®åº“çš„B-Treeç´¢å¼•å¿«ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><h4 id="ä»€ä¹ˆæ˜¯B-Treeç´¢å¼•"><a href="#ä»€ä¹ˆæ˜¯B-Treeç´¢å¼•" class="headerlink" title="ä»€ä¹ˆæ˜¯B-Treeç´¢å¼•?"></a>ä»€ä¹ˆæ˜¯B-Treeç´¢å¼•?</h4><p>ä¸Šå¤§å­¦è¯»ä¹¦æ—¶è€å¸ˆæ•™è¿‡æˆ‘ä»¬ï¼ŒäºŒå‰æ ‘æŸ¥æ‰¾æ•ˆç‡æ˜¯logNï¼ŒåŒæ—¶æ’å…¥æ–°çš„èŠ‚ç‚¹ä¸å¿…ç§»åŠ¨å…¨éƒ¨èŠ‚ç‚¹ï¼Œæ‰€ä»¥ç”¨æ ‘å‹ç»“æ„å­˜å‚¨ç´¢å¼•ï¼Œèƒ½åŒæ—¶å…¼é¡¾æ’å…¥å’ŒæŸ¥è¯¢çš„æ€§èƒ½ã€‚</p><p>å› æ­¤åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå†ç»“åˆç£ç›˜çš„è¯»å–ç‰¹æ€§(é¡ºåºè¯»/éšæœºè¯»)ï¼Œä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“é‡‡ç”¨äº†B-Tree/B+Treeè¿™æ ·çš„æ•°æ®ç»“æ„ï¼š</p><p><img alt data-src="/images/elasticsearch-query-secret/b-tree.png"></p><p>ä¸ºäº†æé«˜æŸ¥è¯¢çš„æ•ˆç‡ï¼Œå‡å°‘ç£ç›˜å¯»é“æ¬¡æ•°ï¼Œå°†å¤šä¸ªå€¼ä½œä¸ºä¸€ä¸ªæ•°ç»„é€šè¿‡è¿ç»­åŒºé—´å­˜æ”¾ï¼Œä¸€æ¬¡å¯»é“è¯»å–å¤šä¸ªæ•°æ®ï¼ŒåŒæ—¶ä¹Ÿé™ä½æ ‘çš„é«˜åº¦ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•"><a href="#ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•" class="headerlink" title="ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•?"></a>ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•?</h4><p><img alt data-src="/images/elasticsearch-query-secret/inverted-index.png"></p><p>ç»§ç»­ä¸Šé¢çš„ä¾‹å­ï¼Œå‡è®¾æœ‰è¿™ä¹ˆå‡ æ¡æ•°æ®(ä¸ºäº†ç®€å•ï¼Œå»æ‰about, interestsè¿™ä¸¤ä¸ªfield):</p><table><thead><tr><th>ID</th><th align="center">Name</th><th align="right">Age</th><th align="right">Sex</th></tr></thead><tbody><tr><td>1</td><td align="center">Kate</td><td align="right">24</td><td align="right">Female</td></tr><tr><td>2</td><td align="center">John</td><td align="right">24</td><td align="right">Male</td></tr><tr><td>3</td><td align="center">Bill</td><td align="right">29</td><td align="right">Male</td></tr></tbody></table><p>IDæ˜¯Elasticsearchè‡ªå»ºçš„æ–‡æ¡£idï¼Œé‚£ä¹ˆElasticsearchå»ºç«‹çš„ç´¢å¼•å¦‚ä¸‹:</p><p><strong>Name:</strong> </p><table><thead><tr><th>Term</th><th align="center">Posting List</th></tr></thead><tbody><tr><td>Kate</td><td align="center">1</td></tr><tr><td>John</td><td align="center">2</td></tr><tr><td>Bill</td><td align="center">3</td></tr></tbody></table><p><strong>Age:</strong></p><table><thead><tr><th>Term</th><th align="center">Posting List</th></tr></thead><tbody><tr><td>24</td><td align="center">[1,2]</td></tr><tr><td>29</td><td align="center">3</td></tr></tbody></table><p><strong>Sex:</strong></p><table><thead><tr><th>Term</th><th align="center">Posting List</th></tr></thead><tbody><tr><td>Female</td><td align="center">1</td></tr><tr><td>Male</td><td align="center">[2,3]</td></tr></tbody></table><h5 id="Posting-List"><a href="#Posting-List" class="headerlink" title="Posting List"></a>Posting List</h5><p>Elasticsearchåˆ†åˆ«ä¸ºæ¯ä¸ªfieldéƒ½å»ºç«‹äº†ä¸€ä¸ªå€’æ’ç´¢å¼•ï¼ŒKate, John, 24, Femaleè¿™äº›å«termï¼Œè€Œ[1,2]å°±æ˜¯<strong>Posting List</strong>ã€‚Posting listå°±æ˜¯ä¸€ä¸ªintçš„æ•°ç»„ï¼Œå­˜å‚¨äº†æ‰€æœ‰ç¬¦åˆæŸä¸ªtermçš„æ–‡æ¡£idã€‚</p><p>çœ‹åˆ°è¿™é‡Œï¼Œä¸è¦è®¤ä¸ºå°±ç»“æŸäº†ï¼Œç²¾å½©çš„éƒ¨åˆ†æ‰åˆšå¼€å§‹â€¦</p><p>é€šè¿‡posting listè¿™ç§ç´¢å¼•æ–¹å¼ä¼¼ä¹å¯ä»¥å¾ˆå¿«è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ¯”å¦‚è¦æ‰¾age=24çš„åŒå­¦ï¼Œçˆ±å›ç­”é—®é¢˜çš„å°æ˜é©¬ä¸Šå°±ä¸¾æ‰‹å›ç­”ï¼šæˆ‘çŸ¥é“ï¼Œidæ˜¯1ï¼Œ2çš„åŒå­¦ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™é‡Œæœ‰ä¸Šåƒä¸‡çš„è®°å½•å‘¢ï¼Ÿå¦‚æœæ˜¯æƒ³é€šè¿‡nameæ¥æŸ¥æ‰¾å‘¢ï¼Ÿ</p><h5 id="Term-Dictionary"><a href="#Term-Dictionary" class="headerlink" title="Term Dictionary"></a>Term Dictionary</h5><p>Elasticsearchä¸ºäº†èƒ½å¿«é€Ÿæ‰¾åˆ°æŸä¸ªtermï¼Œå°†æ‰€æœ‰çš„termæ’ä¸ªåºï¼ŒäºŒåˆ†æ³•æŸ¥æ‰¾termï¼ŒlogNçš„æŸ¥æ‰¾æ•ˆç‡ï¼Œå°±åƒé€šè¿‡å­—å…¸æŸ¥æ‰¾ä¸€æ ·ï¼Œè¿™å°±æ˜¯<strong>Term Dictionary</strong>ã€‚ç°åœ¨å†çœ‹èµ·æ¥ï¼Œä¼¼ä¹å’Œä¼ ç»Ÿæ•°æ®åº“é€šè¿‡B-Treeçš„æ–¹å¼ç±»ä¼¼å•Šï¼Œä¸ºä»€ä¹ˆè¯´æ¯”B-Treeçš„æŸ¥è¯¢å¿«å‘¢ï¼Ÿ</p><h5 id="Term-Index"><a href="#Term-Index" class="headerlink" title="Term Index"></a>Term Index</h5><p>B-Treeé€šè¿‡å‡å°‘ç£ç›˜å¯»é“æ¬¡æ•°æ¥æé«˜æŸ¥è¯¢æ€§èƒ½ï¼ŒElasticsearchä¹Ÿæ˜¯é‡‡ç”¨åŒæ ·çš„æ€è·¯ï¼Œç›´æ¥é€šè¿‡å†…å­˜æŸ¥æ‰¾termï¼Œä¸è¯»ç£ç›˜ï¼Œä½†æ˜¯å¦‚æœtermå¤ªå¤šï¼Œterm dictionaryä¹Ÿä¼šå¾ˆå¤§ï¼Œæ”¾å†…å­˜ä¸ç°å®ï¼Œäºæ˜¯æœ‰äº†<strong>Term Index</strong>ï¼Œå°±åƒå­—å…¸é‡Œçš„ç´¢å¼•é¡µä¸€æ ·ï¼ŒAå¼€å¤´çš„æœ‰å“ªäº›termï¼Œåˆ†åˆ«åœ¨å“ªé¡µï¼Œå¯ä»¥ç†è§£term indexæ˜¯ä¸€é¢—æ ‘ï¼š<br><img alt data-src="/images/elasticsearch-query-secret/term-index.png"></p><p>è¿™æ£µæ ‘ä¸ä¼šåŒ…å«æ‰€æœ‰çš„termï¼Œå®ƒåŒ…å«çš„æ˜¯termçš„ä¸€äº›å‰ç¼€ã€‚é€šè¿‡term indexå¯ä»¥å¿«é€Ÿåœ°å®šä½åˆ°term dictionaryçš„æŸä¸ªoffsetï¼Œç„¶åä»è¿™ä¸ªä½ç½®å†å¾€åé¡ºåºæŸ¥æ‰¾ã€‚<br><img alt data-src="/images/elasticsearch-query-secret/index.png"></p><p>æ‰€ä»¥term indexä¸éœ€è¦å­˜ä¸‹æ‰€æœ‰çš„termï¼Œè€Œä»…ä»…æ˜¯ä»–ä»¬çš„ä¸€äº›å‰ç¼€ä¸Term Dictionaryçš„blockä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œå†ç»“åˆFST(Finite State Transducers)çš„å‹ç¼©æŠ€æœ¯ï¼Œå¯ä»¥ä½¿term indexç¼“å­˜åˆ°å†…å­˜ä¸­ã€‚ä»term indexæŸ¥åˆ°å¯¹åº”çš„term dictionaryçš„blockä½ç½®ä¹‹åï¼Œå†å»ç£ç›˜ä¸Šæ‰¾termï¼Œå¤§å¤§å‡å°‘äº†ç£ç›˜éšæœºè¯»çš„æ¬¡æ•°ã€‚</p><p>è¿™æ—¶å€™çˆ±æé—®çš„å°æ˜åˆä¸¾æ‰‹äº†:â€é‚£ä¸ªFSTæ˜¯ç¥é©¬ä¸œä¸œå•Š?â€</p><p>ä¸€çœ‹å°±çŸ¥é“å°æ˜æ˜¯ä¸€ä¸ªä¸Šå¤§å­¦è¯»ä¹¦çš„æ—¶å€™è·Ÿæˆ‘ä¸€æ ·ä¸è®¤çœŸå¬è¯¾çš„å­©å­ï¼Œæ•°æ®ç»“æ„è€å¸ˆä¸€å®šè®²è¿‡ä»€ä¹ˆæ˜¯FSTã€‚ä½†æ²¡åŠæ³•ï¼Œæˆ‘ä¹Ÿå¿˜äº†ï¼Œè¿™é‡Œå†è¡¥ä¸‹è¯¾ï¼š</p><blockquote><p>FSTs are finite-state machines that <strong>map</strong> a <strong>term (byte sequence)</strong> to an arbitrary <strong>output</strong>.</p></blockquote><p>å‡è®¾æˆ‘ä»¬ç°åœ¨è¦å°†mop, moth, pop, star, stop and top(term indexé‡Œçš„termå‰ç¼€)æ˜ å°„åˆ°åºå·ï¼š0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5(term dictionaryçš„blockä½ç½®)ã€‚æœ€ç®€å•çš„åšæ³•å°±æ˜¯å®šä¹‰ä¸ªMap&lt;String, Integer&gt;ï¼Œå¤§å®¶æ‰¾åˆ°è‡ªå·±çš„ä½ç½®å¯¹åº”å…¥åº§å°±å¥½äº†ï¼Œä½†ä»å†…å­˜å ç”¨å°‘çš„è§’åº¦æƒ³æƒ³ï¼Œæœ‰æ²¡æœ‰æ›´ä¼˜çš„åŠæ³•å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ï¼š<strong>FST</strong>(<a href="http://www.cs.nyu.edu/~mohri/pub/fla.pdf" target="_blank" rel="noopener">ç†è®ºä¾æ®åœ¨æ­¤ï¼Œä½†æˆ‘ç›¸ä¿¡99%çš„äººä¸ä¼šè®¤çœŸçœ‹å®Œçš„</a>)</p><p><img alt data-src="/images/elasticsearch-query-secret/fst.png"></p><p>â­•ï¸è¡¨ç¤ºä¸€ç§çŠ¶æ€</p><p>â€“&gt;è¡¨ç¤ºçŠ¶æ€çš„å˜åŒ–è¿‡ç¨‹ï¼Œä¸Šé¢çš„å­—æ¯/æ•°å­—è¡¨ç¤ºçŠ¶æ€å˜åŒ–å’Œæƒé‡</p><p>å°†å•è¯åˆ†æˆå•ä¸ªå­—æ¯é€šè¿‡â­•ï¸å’Œâ€“&gt;è¡¨ç¤ºå‡ºæ¥ï¼Œ0æƒé‡ä¸æ˜¾ç¤ºã€‚å¦‚æœâ­•ï¸åé¢å‡ºç°åˆ†æ”¯ï¼Œå°±æ ‡è®°æƒé‡ï¼Œæœ€åæ•´æ¡è·¯å¾„ä¸Šçš„æƒé‡åŠ èµ·æ¥å°±æ˜¯è¿™ä¸ªå•è¯å¯¹åº”çš„åºå·ã€‚</p><blockquote><p>FSTs are finite-state machines that map a term (<strong>byte sequence</strong>) to an arbitrary output.</p></blockquote><p>FSTä»¥å­—èŠ‚çš„æ–¹å¼å­˜å‚¨æ‰€æœ‰çš„termï¼Œè¿™ç§å‹ç¼©æ–¹å¼å¯ä»¥æœ‰æ•ˆçš„ç¼©å‡å­˜å‚¨ç©ºé—´ï¼Œä½¿å¾—term indexè¶³ä»¥æ”¾è¿›å†…å­˜ï¼Œä½†è¿™ç§æ–¹å¼ä¹Ÿä¼šå¯¼è‡´æŸ¥æ‰¾æ—¶éœ€è¦æ›´å¤šçš„CPUèµ„æºã€‚</p><p>åé¢çš„æ›´ç²¾å½©ï¼Œçœ‹ç´¯äº†çš„åŒå­¦å¯ä»¥å–æ¯å’–å•¡â€¦â€¦</p><hr><h4 id="å‹ç¼©æŠ€å·§"><a href="#å‹ç¼©æŠ€å·§" class="headerlink" title="å‹ç¼©æŠ€å·§"></a>å‹ç¼©æŠ€å·§</h4><p>Elasticsearché‡Œé™¤äº†ä¸Šé¢è¯´åˆ°ç”¨FSTå‹ç¼©term indexå¤–ï¼Œå¯¹posting listä¹Ÿæœ‰å‹ç¼©æŠ€å·§ã€‚<br>å°æ˜å–å®Œå’–å•¡åˆä¸¾æ‰‹äº†:â€posting listä¸æ˜¯å·²ç»åªå­˜å‚¨æ–‡æ¡£idäº†å—ï¼Ÿè¿˜éœ€è¦å‹ç¼©ï¼Ÿâ€ </p><p>å—¯ï¼Œæˆ‘ä»¬å†çœ‹å›æœ€å¼€å§‹çš„ä¾‹å­ï¼Œå¦‚æœElasticsearchéœ€è¦å¯¹åŒå­¦çš„æ€§åˆ«è¿›è¡Œç´¢å¼•(è¿™æ—¶ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“å·²ç»å“­æ™•åœ¨å•æ‰€â€¦â€¦)ï¼Œä¼šæ€æ ·ï¼Ÿå¦‚æœæœ‰ä¸Šåƒä¸‡ä¸ªåŒå­¦ï¼Œè€Œä¸–ç•Œä¸Šåªæœ‰ç”·/å¥³è¿™æ ·ä¸¤ä¸ªæ€§åˆ«ï¼Œæ¯ä¸ªposting listéƒ½ä¼šæœ‰è‡³å°‘ç™¾ä¸‡ä¸ªæ–‡æ¡£idã€‚<br>Elasticsearchæ˜¯å¦‚ä½•æœ‰æ•ˆçš„å¯¹è¿™äº›æ–‡æ¡£idå‹ç¼©çš„å‘¢ï¼Ÿ</p><h5 id="Frame-Of-Reference"><a href="#Frame-Of-Reference" class="headerlink" title="Frame Of Reference"></a>Frame Of Reference</h5><blockquote><p>å¢é‡ç¼–ç å‹ç¼©ï¼Œå°†å¤§æ•°å˜å°æ•°ï¼ŒæŒ‰å­—èŠ‚å­˜å‚¨</p></blockquote><p>é¦–å…ˆï¼ŒElasticsearchè¦æ±‚posting listæ˜¯æœ‰åºçš„(ä¸ºäº†æé«˜æœç´¢çš„æ€§èƒ½ï¼Œå†ä»»æ€§çš„è¦æ±‚ä¹Ÿå¾—æ»¡è¶³)ï¼Œè¿™æ ·åšçš„ä¸€ä¸ªå¥½å¤„æ˜¯æ–¹ä¾¿å‹ç¼©ï¼Œçœ‹ä¸‹é¢è¿™ä¸ªå›¾ä¾‹ï¼š<br><img alt data-src="/images/elasticsearch-query-secret/frameOfReference.png"></p><p>å¦‚æœæ•°å­¦ä¸æ˜¯ä½“è‚²è€å¸ˆæ•™çš„è¯ï¼Œè¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çœ‹å‡ºæ¥è¿™ç§å‹ç¼©æŠ€å·§çš„ã€‚</p><p>åŸç†å°±æ˜¯é€šè¿‡å¢é‡ï¼Œå°†åŸæ¥çš„å¤§æ•°å˜æˆå°æ•°ä»…å­˜å‚¨å¢é‡å€¼ï¼Œå†ç²¾æ‰“ç»†ç®—æŒ‰bitæ’å¥½é˜Ÿï¼Œæœ€åé€šè¿‡å­—èŠ‚å­˜å‚¨ï¼Œè€Œä¸æ˜¯å¤§å¤§å’§å’§çš„å°½ç®¡æ˜¯2ä¹Ÿæ˜¯ç”¨int(4ä¸ªå­—èŠ‚)æ¥å­˜å‚¨ã€‚</p><h5 id="Roaring-bitmaps"><a href="#Roaring-bitmaps" class="headerlink" title="Roaring bitmaps"></a>Roaring bitmaps</h5><p>è¯´åˆ°Roaring bitmapsï¼Œå°±å¿…é¡»å…ˆä»bitmapè¯´èµ·ã€‚Bitmapæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå‡è®¾æœ‰æŸä¸ªposting listï¼š</p><p>[1,3,4,7,10]</p><p>å¯¹åº”çš„bitmapå°±æ˜¯ï¼š</p><p>[1,0,1,1,0,0,1,0,0,1]</p><p>éå¸¸ç›´è§‚ï¼Œç”¨0/1è¡¨ç¤ºæŸä¸ªå€¼æ˜¯å¦å­˜åœ¨ï¼Œæ¯”å¦‚10è¿™ä¸ªå€¼å°±å¯¹åº”ç¬¬10ä½ï¼Œå¯¹åº”çš„bitå€¼æ˜¯1ï¼Œè¿™æ ·ç”¨ä¸€ä¸ªå­—èŠ‚å°±å¯ä»¥ä»£è¡¨8ä¸ªæ–‡æ¡£idï¼Œæ—§ç‰ˆæœ¬(5.0ä¹‹å‰)çš„Luceneå°±æ˜¯ç”¨è¿™æ ·çš„æ–¹å¼æ¥å‹ç¼©çš„ï¼Œä½†è¿™æ ·çš„å‹ç¼©æ–¹å¼ä»ç„¶ä¸å¤Ÿé«˜æ•ˆï¼Œå¦‚æœæœ‰1äº¿ä¸ªæ–‡æ¡£ï¼Œé‚£ä¹ˆéœ€è¦12.5MBçš„å­˜å‚¨ç©ºé—´ï¼Œè¿™ä»…ä»…æ˜¯å¯¹åº”ä¸€ä¸ªç´¢å¼•å­—æ®µ(æˆ‘ä»¬å¾€å¾€ä¼šæœ‰å¾ˆå¤šä¸ªç´¢å¼•å­—æ®µ)ã€‚äºæ˜¯æœ‰äººæƒ³å‡ºäº†Roaring bitmapsè¿™æ ·æ›´é«˜æ•ˆçš„æ•°æ®ç»“æ„ã€‚</p><p>Bitmapçš„ç¼ºç‚¹æ˜¯å­˜å‚¨ç©ºé—´éšç€æ–‡æ¡£ä¸ªæ•°çº¿æ€§å¢é•¿ï¼ŒRoaring bitmapséœ€è¦æ‰“ç ´è¿™ä¸ªé­”å’’å°±ä¸€å®šè¦ç”¨åˆ°æŸäº›æŒ‡æ•°ç‰¹æ€§ï¼š</p><p>å°†posting listæŒ‰ç…§65535ä¸ºç•Œé™åˆ†å—ï¼Œæ¯”å¦‚ç¬¬ä¸€å—æ‰€åŒ…å«çš„æ–‡æ¡£idèŒƒå›´åœ¨0<del>65535ä¹‹é—´ï¼Œç¬¬äºŒå—çš„idèŒƒå›´æ˜¯65536</del>131071ï¼Œä»¥æ­¤ç±»æ¨ã€‚å†ç”¨&lt;å•†ï¼Œä½™æ•°&gt;çš„ç»„åˆè¡¨ç¤ºæ¯ä¸€ç»„idï¼Œè¿™æ ·æ¯ç»„é‡Œçš„idèŒƒå›´éƒ½åœ¨0~65535å†…äº†ï¼Œå‰©ä¸‹çš„å°±å¥½åŠäº†ï¼Œæ—¢ç„¶æ¯ç»„idä¸ä¼šå˜å¾—æ— é™å¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æœ€æœ‰æ•ˆçš„æ–¹å¼å¯¹è¿™é‡Œçš„idå­˜å‚¨ã€‚</p><p><img alt data-src="/images/elasticsearch-query-secret/Roaringbitmaps.png"></p><p>ç»†å¿ƒçš„å°æ˜è¿™æ—¶å€™åˆä¸¾æ‰‹äº†:â€ä¸ºä»€ä¹ˆæ˜¯ä»¥65535ä¸ºç•Œé™?â€</p><p>ç¨‹åºå‘˜çš„ä¸–ç•Œé‡Œé™¤äº†1024å¤–ï¼Œ65535ä¹Ÿæ˜¯ä¸€ä¸ªç»å…¸å€¼ï¼Œå› ä¸ºå®ƒ=2^16-1ï¼Œæ­£å¥½æ˜¯ç”¨2ä¸ªå­—èŠ‚èƒ½è¡¨ç¤ºçš„æœ€å¤§æ•°ï¼Œä¸€ä¸ªshortçš„å­˜å‚¨å•ä½ï¼Œæ³¨æ„åˆ°ä¸Šå›¾é‡Œçš„æœ€åä¸€è¡Œâ€œIf a block has more than 4096 values, encode as a bit set, and otherwise as a simple array using 2 bytes per valueâ€ï¼Œå¦‚æœæ˜¯å¤§å—ï¼Œç”¨èŠ‚çœç‚¹ç”¨bitsetå­˜ï¼Œå°å—å°±è±ªçˆ½ç‚¹ï¼Œ2ä¸ªå­—èŠ‚æˆ‘ä¹Ÿä¸è®¡è¾ƒäº†ï¼Œç”¨ä¸€ä¸ªshort[]å­˜ç€æ–¹ä¾¿ã€‚</p><p>é‚£ä¸ºä»€ä¹ˆç”¨4096æ¥åŒºåˆ†é‡‡ç”¨æ•°ç»„è¿˜æ˜¯bitmapçš„é˜€å€¼å‘¢ï¼Ÿ</p><p>è¿™ä¸ªæ˜¯ä»å†…å­˜å¤§å°è€ƒè™‘çš„ï¼Œå½“blockå—é‡Œå…ƒç´ è¶…è¿‡4096åï¼Œç”¨bitmapæ›´å‰©ç©ºé—´ï¼š<br>é‡‡ç”¨bitmapéœ€è¦çš„ç©ºé—´æ˜¯æ’å®šçš„: 65536/8 = 8192bytes<br>è€Œå¦‚æœé‡‡ç”¨short[]ï¼Œæ‰€éœ€çš„ç©ºé—´æ˜¯: 2*N(Nä¸ºæ•°ç»„å…ƒç´ ä¸ªæ•°)<br>å°æ˜æ‰‹æŒ‡ä¸€æN=4096åˆšå¥½æ˜¯è¾¹ç•Œ:</p><p><img alt data-src="/images/elasticsearch-query-secret/block-memory.png"></p><hr><h4 id="è”åˆç´¢å¼•"><a href="#è”åˆç´¢å¼•" class="headerlink" title="è”åˆç´¢å¼•"></a>è”åˆç´¢å¼•</h4><p>ä¸Šé¢è¯´äº†åŠå¤©éƒ½æ˜¯å•fieldç´¢å¼•ï¼Œå¦‚æœå¤šä¸ªfieldç´¢å¼•çš„è”åˆæŸ¥è¯¢ï¼Œå€’æ’ç´¢å¼•å¦‚ä½•æ»¡è¶³å¿«é€ŸæŸ¥è¯¢çš„è¦æ±‚å‘¢ï¼Ÿ</p><ul><li>åˆ©ç”¨è·³è¡¨(Skip list)çš„æ•°æ®ç»“æ„å¿«é€Ÿåšâ€œä¸â€è¿ç®—ï¼Œæˆ–è€…</li><li>åˆ©ç”¨ä¸Šé¢æåˆ°çš„bitsetæŒ‰ä½â€œä¸â€</li></ul><p>å…ˆçœ‹çœ‹è·³è¡¨çš„æ•°æ®ç»“æ„ï¼š</p><p><img alt data-src="/images/elasticsearch-query-secret/skiplist.png"></p><p>å°†ä¸€ä¸ªæœ‰åºé“¾è¡¨level0ï¼ŒæŒ‘å‡ºå…¶ä¸­å‡ ä¸ªå…ƒç´ åˆ°level1åŠlevel2ï¼Œæ¯ä¸ªlevelè¶Šå¾€ä¸Šï¼Œé€‰å‡ºæ¥çš„æŒ‡é’ˆå…ƒç´ è¶Šå°‘ï¼ŒæŸ¥æ‰¾æ—¶ä¾æ¬¡ä»é«˜levelå¾€ä½æŸ¥æ‰¾ï¼Œæ¯”å¦‚55ï¼Œå…ˆæ‰¾åˆ°level2çš„31ï¼Œå†æ‰¾åˆ°level1çš„47ï¼Œæœ€åæ‰¾åˆ°55ï¼Œä¸€å…±3æ¬¡æŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾æ•ˆç‡å’Œ2å‰æ ‘çš„æ•ˆç‡ç›¸å½“ï¼Œä½†ä¹Ÿæ˜¯ç”¨äº†ä¸€å®šçš„ç©ºé—´å†—ä½™æ¥æ¢å–çš„ã€‚</p><p>å‡è®¾æœ‰ä¸‹é¢ä¸‰ä¸ªposting listéœ€è¦è”åˆç´¢å¼•ï¼š</p><p><img alt data-src="/images/elasticsearch-query-secret/combineIndex.png"></p><p>å¦‚æœä½¿ç”¨è·³è¡¨ï¼Œå¯¹æœ€çŸ­çš„posting listä¸­çš„æ¯ä¸ªidï¼Œé€ä¸ªåœ¨å¦å¤–ä¸¤ä¸ªposting listä¸­æŸ¥æ‰¾çœ‹æ˜¯å¦å­˜åœ¨ï¼Œæœ€åå¾—åˆ°äº¤é›†çš„ç»“æœã€‚</p><p>å¦‚æœä½¿ç”¨bitsetï¼Œå°±å¾ˆç›´è§‚äº†ï¼Œç›´æ¥æŒ‰ä½ä¸ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯æœ€åçš„äº¤é›†ã€‚</p><hr><h3 id="æ€»ç»“å’Œæ€è€ƒ"><a href="#æ€»ç»“å’Œæ€è€ƒ" class="headerlink" title="æ€»ç»“å’Œæ€è€ƒ"></a>æ€»ç»“å’Œæ€è€ƒ</h3><p>Elasticsearchçš„ç´¢å¼•æ€è·¯:</p><blockquote><p>å°†ç£ç›˜é‡Œçš„ä¸œè¥¿å°½é‡æ¬è¿›å†…å­˜ï¼Œå‡å°‘ç£ç›˜éšæœºè¯»å–æ¬¡æ•°(åŒæ—¶ä¹Ÿåˆ©ç”¨ç£ç›˜é¡ºåºè¯»ç‰¹æ€§)ï¼Œç»“åˆå„ç§å¥‡æŠ€æ·«å·§çš„å‹ç¼©ç®—æ³•ï¼Œç”¨åŠå…¶è‹›åˆ»çš„æ€åº¦ä½¿ç”¨å†…å­˜ã€‚</p></blockquote><p>æ‰€ä»¥ï¼Œå¯¹äºä½¿ç”¨Elasticsearchè¿›è¡Œç´¢å¼•æ—¶éœ€è¦æ³¨æ„:</p><ul><li>ä¸éœ€è¦ç´¢å¼•çš„å­—æ®µï¼Œä¸€å®šè¦æ˜ç¡®å®šä¹‰å‡ºæ¥ï¼Œå› ä¸ºé»˜è®¤æ˜¯è‡ªåŠ¨å»ºç´¢å¼•çš„</li><li>åŒæ ·çš„é“ç†ï¼Œå¯¹äºStringç±»å‹çš„å­—æ®µï¼Œä¸éœ€è¦analysisçš„ä¹Ÿéœ€è¦æ˜ç¡®å®šä¹‰å‡ºæ¥ï¼Œå› ä¸ºé»˜è®¤ä¹Ÿæ˜¯ä¼šanalysisçš„</li><li>é€‰æ‹©æœ‰è§„å¾‹çš„IDå¾ˆé‡è¦ï¼Œéšæœºæ€§å¤ªå¤§çš„ID(æ¯”å¦‚javaçš„UUID)ä¸åˆ©äºæŸ¥è¯¢</li></ul><p>å…³äºæœ€åä¸€ç‚¹ï¼Œä¸ªäººè®¤ä¸ºæœ‰å¤šä¸ªå› ç´ :</p><p>å…¶ä¸­ä¸€ä¸ª(ä¹Ÿè®¸ä¸æ˜¯æœ€é‡è¦çš„)å› ç´ : ä¸Šé¢çœ‹åˆ°çš„å‹ç¼©ç®—æ³•ï¼Œéƒ½æ˜¯å¯¹Posting listé‡Œçš„å¤§é‡IDè¿›è¡Œå‹ç¼©çš„ï¼Œé‚£å¦‚æœIDæ˜¯é¡ºåºçš„ï¼Œæˆ–è€…æ˜¯æœ‰å…¬å…±å‰ç¼€ç­‰å…·æœ‰ä¸€å®šè§„å¾‹æ€§çš„IDï¼Œå‹ç¼©æ¯”ä¼šæ¯”è¾ƒé«˜ï¼›</p><p>å¦å¤–ä¸€ä¸ªå› ç´ : å¯èƒ½æ˜¯æœ€å½±å“æŸ¥è¯¢æ€§èƒ½çš„ï¼Œåº”è¯¥æ˜¯æœ€åé€šè¿‡Posting listé‡Œçš„IDåˆ°ç£ç›˜ä¸­æŸ¥æ‰¾Documentä¿¡æ¯çš„é‚£æ­¥ï¼Œå› ä¸ºElasticsearchæ˜¯åˆ†Segmentå­˜å‚¨çš„ï¼Œæ ¹æ®IDè¿™ä¸ªå¤§èŒƒå›´çš„Termå®šä½åˆ°Segmentçš„æ•ˆç‡ç›´æ¥å½±å“äº†æœ€åæŸ¥è¯¢çš„æ€§èƒ½ï¼Œå¦‚æœIDæ˜¯æœ‰è§„å¾‹çš„ï¼Œå¯ä»¥å¿«é€Ÿè·³è¿‡ä¸åŒ…å«è¯¥IDçš„Segmentï¼Œä»è€Œå‡å°‘ä¸å¿…è¦çš„ç£ç›˜è¯»æ¬¡æ•°ï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡<a href="http://blog.mikemccandless.com/2014/05/choosing-fast-unique-identifier-uuid.html" target="_blank" rel="noopener">å¦‚ä½•é€‰æ‹©ä¸€ä¸ªé«˜æ•ˆçš„å…¨å±€IDæ–¹æ¡ˆ</a>(è¯„è®ºä¹Ÿå¾ˆç²¾å½©)</p><p>åç»­å†ç»“åˆå®é™…å¼€å‘åŠè°ƒä¼˜å·¥ä½œåˆ†äº«æ›´å¤šå†…å®¹ï¼Œæ•¬è¯·æœŸå¾…ï¼</p><hr><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://neway6655.github.io/elasticsearch/2015/09/11/elasticsearch-study-notes.html" target="_blank" rel="noopener">Elasticsearch å­¦ä¹ ç¬”è®°</a></p>]]></content>
      
      
      <categories>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Epoll çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</title>
      <link href="/epoll-principle.html"/>
      <url>/epoll-principle.html</url>
      
        <content type="html"><![CDATA[<p>ä»äº‹æœåŠ¡ç«¯å¼€å‘ï¼Œå°‘ä¸äº†è¦æ¥è§¦ç½‘ç»œç¼–ç¨‹ã€‚epoll ä½œä¸º Linux ä¸‹é«˜æ€§èƒ½ç½‘ç»œæœåŠ¡å™¨çš„å¿…å¤‡æŠ€æœ¯è‡³å…³é‡è¦ï¼Œnginxã€Redisã€Skynet å’Œå¤§éƒ¨åˆ†æ¸¸æˆæœåŠ¡å™¨éƒ½ä½¿ç”¨åˆ°è¿™ä¸€å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚</p><p>epoll å¾ˆé‡è¦ï¼Œä½†æ˜¯ epoll ä¸ select çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿepoll é«˜æ•ˆçš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><img alt data-src="/images/linux-epoll/%E9%A6%96%E9%A1%B5%E5%9B%BE.jpg"></p><p>ç½‘ä¸Šè™½ç„¶ä¹Ÿæœ‰ä¸å°‘è®²è§£ epollçš„æ–‡ç« ï¼Œä½†è¦ä¹ˆæ˜¯è¿‡äºæµ…æ˜¾ï¼Œæˆ–è€…é™·å…¥æºç è§£æï¼Œå¾ˆå°‘èƒ½æœ‰é€šä¿—æ˜“æ‡‚çš„ã€‚ç¬”è€…äºæ˜¯å†³å®šç¼–å†™æ­¤æ–‡ï¼Œè®©ç¼ºä¹ä¸“ä¸šèƒŒæ™¯çŸ¥è¯†çš„è¯»è€…ä¹Ÿèƒ½å¤Ÿæ˜ç™½ epoll çš„åŸç†ã€‚</p><p><font color="DeepPink">æ–‡ç« æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šè¦è®©è¯»è€…æ¸…æ™°æ˜ç™½ epoll ä¸ºä»€ä¹ˆæ€§èƒ½å¥½ã€‚</font></p><p><font color="DeepPink">æœ¬æ–‡ä¼šä»ç½‘å¡æ¥æ”¶æ•°æ®çš„æµç¨‹è®²èµ·ï¼Œä¸²è”èµ· CPU ä¸­æ–­ã€æ“ä½œç³»ç»Ÿè¿›ç¨‹è°ƒåº¦ç­‰çŸ¥è¯†ï¼›å†ä¸€æ­¥æ­¥åˆ†æé˜»å¡æ¥æ”¶æ•°æ®ã€select åˆ° epoll çš„è¿›åŒ–è¿‡ç¨‹ï¼›æœ€åæ¢ç©¶ epoll çš„å®ç°ç»†èŠ‚ã€‚</font></p><h1 id="ä¸€ã€ä»ç½‘å¡æ¥æ”¶æ•°æ®è¯´èµ·"><a href="#ä¸€ã€ä»ç½‘å¡æ¥æ”¶æ•°æ®è¯´èµ·" class="headerlink" title="ä¸€ã€ä»ç½‘å¡æ¥æ”¶æ•°æ®è¯´èµ·"></a>ä¸€ã€ä»ç½‘å¡æ¥æ”¶æ•°æ®è¯´èµ·</h1><p>ä¸‹è¾¹æ˜¯ä¸€ä¸ªå…¸å‹çš„è®¡ç®—æœºç»“æ„å›¾ï¼Œè®¡ç®—æœºç”± CPUã€å­˜å‚¨å™¨ï¼ˆå†…å­˜ï¼‰ä¸ç½‘ç»œæ¥å£ç­‰éƒ¨ä»¶ç»„æˆï¼Œäº†è§£ epoll æœ¬è´¨çš„ç¬¬ä¸€æ­¥ï¼Œè¦ä»ç¡¬ä»¶çš„è§’åº¦çœ‹è®¡ç®—æœºæ€æ ·æ¥æ”¶ç½‘ç»œæ•°æ®ã€‚<br><img alt data-src="/images/linux-epoll/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%93%E6%9E%84%E5%9B%BE.jpg"><br><em>è®¡ç®—æœºç»“æ„å›¾ï¼ˆå›¾ç‰‡æ¥æºï¼šLinuxå†…æ ¸å®Œå…¨æ³¨é‡Šä¹‹å¾®å‹è®¡ç®—æœºç»„æˆç»“æ„ï¼‰</em></p><p>ä¸‹å›¾å±•ç¤ºäº†ç½‘å¡æ¥æ”¶æ•°æ®çš„è¿‡ç¨‹ã€‚</p><ul><li>åœ¨ â‘  é˜¶æ®µï¼Œç½‘å¡æ”¶åˆ°ç½‘çº¿ä¼ æ¥çš„æ•°æ®ï¼›</li><li>ç»è¿‡ â‘¡ é˜¶æ®µçš„ç¡¬ä»¶ç”µè·¯çš„ä¼ è¾“ï¼›</li><li>æœ€ç»ˆ â‘¢ é˜¶æ®µå°†æ•°æ®å†™å…¥åˆ°å†…å­˜ä¸­çš„æŸä¸ªåœ°å€ä¸Šã€‚</li></ul><p>è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ° DMA ä¼ è¾“ã€IO é€šè·¯é€‰æ‹©ç­‰ç¡¬ä»¶æœ‰å…³çš„çŸ¥è¯†ï¼Œä½†æˆ‘ä»¬åªéœ€çŸ¥é“ï¼š<font color="DeepPink">ç½‘å¡ä¼šæŠŠæ¥æ”¶åˆ°çš„æ•°æ®å†™å…¥å†…å­˜</font>ã€‚</p><p><img alt data-src="/images/linux-epoll/%E7%BD%91%E5%8D%A1%E6%8E%A5%E6%94%B6%E6%95%B0%E6%8D%AE%E7%9A%84%E8%BF%87%E7%A8%8B.jpg"><br><em>ç½‘å¡æ¥æ”¶æ•°æ®çš„è¿‡ç¨‹</em></p><p>é€šè¿‡ç¡¬ä»¶ä¼ è¾“ï¼Œç½‘å¡æ¥æ”¶çš„æ•°æ®å­˜æ”¾åˆ°å†…å­˜ä¸­ï¼Œæ“ä½œç³»ç»Ÿå°±å¯ä»¥å»è¯»å–å®ƒä»¬ã€‚</p><h1 id="äºŒã€å¦‚ä½•çŸ¥é“æ¥æ”¶äº†æ•°æ®ï¼Ÿ"><a href="#äºŒã€å¦‚ä½•çŸ¥é“æ¥æ”¶äº†æ•°æ®ï¼Ÿ" class="headerlink" title="äºŒã€å¦‚ä½•çŸ¥é“æ¥æ”¶äº†æ•°æ®ï¼Ÿ"></a>äºŒã€å¦‚ä½•çŸ¥é“æ¥æ”¶äº†æ•°æ®ï¼Ÿ</h1><p>äº†è§£ epoll æœ¬è´¨çš„ç¬¬äºŒæ­¥ï¼Œè¦ä» CPU çš„è§’åº¦æ¥çœ‹æ•°æ®æ¥æ”¶ã€‚ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œè¦å…ˆäº†è§£ä¸€ä¸ªæ¦‚å¿µâ€”â€”<font color="DeepPink">ä¸­æ–­</font>ã€‚</p><p>è®¡ç®—æœºæ‰§è¡Œç¨‹åºæ—¶ï¼Œä¼šæœ‰ä¼˜å…ˆçº§çš„éœ€æ±‚ã€‚æ¯”å¦‚ï¼Œå½“è®¡ç®—æœºæ”¶åˆ°æ–­ç”µä¿¡å·æ—¶ï¼Œå®ƒåº”ç«‹å³å»ä¿å­˜æ•°æ®ï¼Œä¿å­˜æ•°æ®çš„ç¨‹åºå…·æœ‰è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼ˆç”µå®¹å¯ä»¥ä¿å­˜å°‘è®¸ç”µé‡ï¼Œä¾› CPU è¿è¡Œå¾ˆçŸ­çš„ä¸€å°æ®µæ—¶é—´ï¼‰ã€‚</p><p><font color="DeepPink">ä¸€èˆ¬è€Œè¨€ï¼Œç”±ç¡¬ä»¶äº§ç”Ÿçš„ä¿¡å·éœ€è¦ CPU ç«‹é©¬åšå‡ºå›åº”ï¼Œä¸ç„¶æ•°æ®å¯èƒ½å°±ä¸¢å¤±äº†ï¼Œæ‰€ä»¥å®ƒçš„ä¼˜å…ˆçº§å¾ˆé«˜ã€‚CPU ç†åº”ä¸­æ–­æ‰æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºï¼Œå»åšå‡ºå“åº”ï¼›å½“ CPU å®Œæˆå¯¹ç¡¬ä»¶çš„å“åº”åï¼Œå†é‡æ–°æ‰§è¡Œç”¨æˆ·ç¨‹åºã€‚</font>ä¸­æ–­çš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼Œå®ƒå’Œå‡½æ•°è°ƒç”¨å·®ä¸å¤šï¼Œåªä¸è¿‡å‡½æ•°è°ƒç”¨æ˜¯äº‹å…ˆå®šå¥½ä½ç½®ï¼Œè€Œä¸­æ–­çš„ä½ç½®ç”±â€œä¿¡å·â€å†³å®šã€‚<br><img alt data-src="/images/linux-epoll/%E4%B8%AD%E6%96%AD%E7%A8%8B%E5%BA%8F%E8%B0%83%E7%94%A8.jpg"><br><em>ä¸­æ–­ç¨‹åºè°ƒç”¨</em></p><p>ä»¥é”®ç›˜ä¸ºä¾‹ï¼Œå½“ç”¨æˆ·æŒ‰ä¸‹é”®ç›˜æŸä¸ªæŒ‰é”®æ—¶ï¼Œé”®ç›˜ä¼šç»™ CPU çš„ä¸­æ–­å¼•è„šå‘å‡ºä¸€ä¸ªé«˜ç”µå¹³ï¼ŒCPUèƒ½å¤Ÿæ•è·è¿™ä¸ªä¿¡å·ï¼Œç„¶åæ‰§è¡Œé”®ç›˜ä¸­æ–­ç¨‹åºã€‚ä¸‹å›¾å±•ç¤ºäº†å„ç§ç¡¬ä»¶é€šè¿‡ä¸­æ–­ä¸ CPU äº¤äº’çš„è¿‡ç¨‹ã€‚<br><img alt data-src="/images/linux-epoll/CPU%E4%B8%AD%E6%96%AD.jpg"><br><em>CPU ä¸­æ–­ï¼ˆå›¾ç‰‡æ¥æºï¼šnet.pku.edu.cnï¼‰</em></p><p>ç°åœ¨å¯ä»¥å›ç­”â€œ<strong>å¦‚ä½•çŸ¥é“æ¥æ”¶äº†æ•°æ®ï¼Ÿ</strong>â€è¿™ä¸ªé—®é¢˜äº†ï¼š<font color="DeepPink">å½“ç½‘å¡æŠŠæ•°æ®å†™å…¥åˆ°å†…å­˜åï¼Œç½‘å¡å‘ CPU å‘å‡ºä¸€ä¸ªä¸­æ–­ä¿¡å·ï¼Œæ“ä½œç³»ç»Ÿä¾¿èƒ½å¾—çŸ¥æœ‰æ–°æ•°æ®åˆ°æ¥ï¼Œå†é€šè¿‡ç½‘å¡ä¸­æ–­ç¨‹åºå»å¤„ç†æ•°æ®ã€‚</font></p><h1 id="ä¸‰ã€è¿›ç¨‹é˜»å¡ä¸ºä»€ä¹ˆä¸å ç”¨-CPU-èµ„æºï¼Ÿ"><a href="#ä¸‰ã€è¿›ç¨‹é˜»å¡ä¸ºä»€ä¹ˆä¸å ç”¨-CPU-èµ„æºï¼Ÿ" class="headerlink" title="ä¸‰ã€è¿›ç¨‹é˜»å¡ä¸ºä»€ä¹ˆä¸å ç”¨ CPU èµ„æºï¼Ÿ"></a>ä¸‰ã€è¿›ç¨‹é˜»å¡ä¸ºä»€ä¹ˆä¸å ç”¨ CPU èµ„æºï¼Ÿ</h1><p>äº†è§£ epoll æœ¬è´¨çš„ç¬¬ä¸‰æ­¥ï¼Œè¦ä»æ“ä½œç³»ç»Ÿè¿›ç¨‹è°ƒåº¦çš„è§’åº¦æ¥çœ‹æ•°æ®æ¥æ”¶ã€‚<font color="DeepPink">é˜»å¡æ˜¯è¿›ç¨‹è°ƒåº¦çš„å…³é”®ä¸€ç¯ï¼ŒæŒ‡çš„æ˜¯è¿›ç¨‹åœ¨ç­‰å¾…æŸäº‹ä»¶ï¼ˆå¦‚æ¥æ”¶åˆ°ç½‘ç»œæ•°æ®ï¼‰å‘ç”Ÿä¹‹å‰çš„ç­‰å¾…çŠ¶æ€ï¼Œrecvã€select å’Œ epoll éƒ½æ˜¯é˜»å¡æ–¹æ³•</font>ã€‚ä¸‹è¾¹åˆ†æä¸€ä¸‹è¿›ç¨‹é˜»å¡ä¸ºä»€ä¹ˆä¸å ç”¨ CPU èµ„æºï¼Ÿ</p><p>ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä»æ™®é€šçš„ recv æ¥æ”¶å¼€å§‹åˆ†æï¼Œå…ˆçœ‹çœ‹ä¸‹é¢ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//åˆ›å»ºsocket</span><br><span class="line">int s = socket(AF_INET, SOCK_STREAM, 0);   </span><br><span class="line">//ç»‘å®š</span><br><span class="line">bind(s, ...)</span><br><span class="line">//ç›‘å¬</span><br><span class="line">listen(s, ...)</span><br><span class="line">//æ¥å—å®¢æˆ·ç«¯è¿æ¥</span><br><span class="line">int c = accept(s, ...)</span><br><span class="line">//æ¥æ”¶å®¢æˆ·ç«¯æ•°æ®</span><br><span class="line">recv(c, ...);</span><br><span class="line">//å°†æ•°æ®æ‰“å°å‡ºæ¥</span><br><span class="line">printf(...)</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€æ®µæœ€åŸºç¡€çš„ç½‘ç»œç¼–ç¨‹ä»£ç ï¼Œå…ˆæ–°å»º socket å¯¹è±¡ï¼Œä¾æ¬¡è°ƒç”¨ bindã€listen ä¸ acceptï¼Œæœ€åè°ƒç”¨ recv æ¥æ”¶æ•°æ®ã€‚recv æ˜¯ä¸ªé˜»å¡æ–¹æ³•ï¼Œå½“ç¨‹åºè¿è¡Œåˆ° recv æ—¶ï¼Œå®ƒä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æ¥æ”¶åˆ°æ•°æ®æ‰å¾€ä¸‹æ‰§è¡Œã€‚</p><p>é‚£ä¹ˆé˜»å¡çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p><h2 id="å·¥ä½œé˜Ÿåˆ—"><a href="#å·¥ä½œé˜Ÿåˆ—" class="headerlink" title="å·¥ä½œé˜Ÿåˆ—"></a>å·¥ä½œé˜Ÿåˆ—</h2><p><font color="DeepPink">æ“ä½œç³»ç»Ÿä¸ºäº†æ”¯æŒå¤šä»»åŠ¡ï¼Œå®ç°äº†è¿›ç¨‹è°ƒåº¦çš„åŠŸèƒ½ï¼Œä¼šæŠŠè¿›ç¨‹åˆ†ä¸ºâ€œè¿è¡Œâ€å’Œâ€œç­‰å¾…â€ç­‰å‡ ç§çŠ¶æ€ã€‚è¿è¡ŒçŠ¶æ€æ˜¯è¿›ç¨‹è·å¾— CPU ä½¿ç”¨æƒï¼Œæ­£åœ¨æ‰§è¡Œä»£ç çš„çŠ¶æ€ï¼›ç­‰å¾…çŠ¶æ€æ˜¯é˜»å¡çŠ¶æ€ï¼Œæ¯”å¦‚ä¸Šè¿°ç¨‹åºè¿è¡Œåˆ° recv æ—¶ï¼Œç¨‹åºä¼šä»è¿è¡ŒçŠ¶æ€å˜ä¸ºç­‰å¾…çŠ¶æ€ï¼Œæ¥æ”¶åˆ°æ•°æ®ååˆå˜å›è¿è¡ŒçŠ¶æ€ã€‚</font>æ“ä½œç³»ç»Ÿä¼šåˆ†æ—¶æ‰§è¡Œå„ä¸ªè¿è¡ŒçŠ¶æ€çš„è¿›ç¨‹ï¼Œç”±äºé€Ÿåº¦å¾ˆå¿«ï¼Œçœ‹ä¸Šå»å°±åƒæ˜¯åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚</p><p>ä¸‹å›¾çš„è®¡ç®—æœºä¸­è¿è¡Œç€ Aã€B ä¸ C ä¸‰ä¸ªè¿›ç¨‹ï¼Œå…¶ä¸­è¿›ç¨‹ A æ‰§è¡Œç€ä¸Šè¿°åŸºç¡€ç½‘ç»œç¨‹åºï¼Œä¸€å¼€å§‹ï¼Œè¿™ 3 ä¸ªè¿›ç¨‹éƒ½è¢«æ“ä½œç³»ç»Ÿçš„å·¥ä½œé˜Ÿåˆ—æ‰€å¼•ç”¨ï¼Œå¤„äºè¿è¡ŒçŠ¶æ€ï¼Œä¼šåˆ†æ—¶æ‰§è¡Œã€‚<br><img alt data-src="/images/linux-epoll/%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97%E4%B8%AD%E6%9C%89ABC%E4%B8%89%E4%B8%AA%E8%BF%9B%E7%A8%8B.jpg"><br><em>å·¥ä½œé˜Ÿåˆ—ä¸­æœ‰ Aã€B å’Œ C ä¸‰ä¸ªè¿›ç¨‹</em></p><h2 id="ç­‰å¾…é˜Ÿåˆ—"><a href="#ç­‰å¾…é˜Ÿåˆ—" class="headerlink" title="ç­‰å¾…é˜Ÿåˆ—"></a>ç­‰å¾…é˜Ÿåˆ—</h2><p>å½“è¿›ç¨‹ A æ‰§è¡Œåˆ°åˆ›å»º socket çš„è¯­å¥æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªç”±æ–‡ä»¶ç³»ç»Ÿç®¡ç†çš„ socket å¯¹è±¡ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚è¿™ä¸ª socket å¯¹è±¡åŒ…å«äº†å‘é€ç¼“å†²åŒºã€æ¥æ”¶ç¼“å†²åŒºä¸ç­‰å¾…é˜Ÿåˆ—ç­‰æˆå‘˜ã€‚ç­‰å¾…é˜Ÿåˆ—æ˜¯ä¸ªéå¸¸é‡è¦çš„ç»“æ„ï¼Œå®ƒæŒ‡å‘æ‰€æœ‰éœ€è¦ç­‰å¾…è¯¥ socket äº‹ä»¶çš„è¿›ç¨‹ã€‚<br><img alt data-src="/images/linux-epoll/%E5%88%9B%E5%BB%BAsocket.jpg"><br><em>åˆ›å»º socket</em></p><p><strong>å½“ç¨‹åºæ‰§è¡Œåˆ° recv æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†è¿›ç¨‹ A ä»å·¥ä½œé˜Ÿåˆ—ç§»åŠ¨åˆ°è¯¥ socket çš„ç­‰å¾…é˜Ÿåˆ—ä¸­</strong>ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚ç”±äºå·¥ä½œé˜Ÿåˆ—åªå‰©ä¸‹äº†è¿›ç¨‹ B å’Œ Cï¼Œä¾æ®è¿›ç¨‹è°ƒåº¦ï¼ŒCPU ä¼šè½®æµæ‰§è¡Œè¿™ä¸¤ä¸ªè¿›ç¨‹çš„ç¨‹åºï¼Œä¸ä¼šæ‰§è¡Œè¿›ç¨‹ A çš„ç¨‹åºã€‚æ‰€ä»¥è¿›ç¨‹ A è¢«é˜»å¡ï¼Œä¸ä¼šå¾€ä¸‹æ‰§è¡Œä»£ç ï¼Œä¹Ÿä¸ä¼šå ç”¨ CPU èµ„æºã€‚<br><img alt data-src="/images/linux-epoll/socket%E7%9A%84%E7%AD%89%E5%BE%85%E9%98%9F%E5%88%97.jpg"><br><em>socket çš„ç­‰å¾…é˜Ÿåˆ—</em></p><blockquote><p>æ³¨ï¼šæ“ä½œç³»ç»Ÿæ·»åŠ ç­‰å¾…é˜Ÿåˆ—åªæ˜¯æ·»åŠ äº†å¯¹è¿™ä¸ªâ€œç­‰å¾…ä¸­â€è¿›ç¨‹çš„å¼•ç”¨ï¼Œä»¥ä¾¿åœ¨æ¥æ”¶åˆ°æ•°æ®æ—¶è·å–è¿›ç¨‹å¯¹è±¡ã€å°†å…¶å”¤é†’ï¼Œè€Œéç›´æ¥å°†è¿›ç¨‹ç®¡ç†çº³å…¥è‡ªå·±ä¹‹ä¸‹ã€‚ä¸Šå›¾ä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œç›´æ¥å°†è¿›ç¨‹æŒ‚åˆ°ç­‰å¾…é˜Ÿåˆ—ä¹‹ä¸‹ã€‚</p></blockquote><h2 id="å”¤é†’è¿›ç¨‹"><a href="#å”¤é†’è¿›ç¨‹" class="headerlink" title="å”¤é†’è¿›ç¨‹"></a>å”¤é†’è¿›ç¨‹</h2><p><strong>å½“ socket æ¥æ”¶åˆ°æ•°æ®åï¼Œæ“ä½œç³»ç»Ÿå°†è¯¥ socket é˜Ÿåˆ—ä¸Šçš„è¿›ç¨‹é‡æ–°æ”¾å›åˆ°å·¥ä½œé˜Ÿåˆ—ï¼Œè¯¥è¿›ç¨‹å˜æˆè¿è¡ŒçŠ¶æ€ï¼Œç»§ç»­æ‰§è¡Œä»£ç ã€‚åŒæ—¶ç”±äº socket çš„æ¥æ”¶ç¼“å†²åŒºå·²ç»æœ‰äº†æ•°æ®ï¼Œrecv å¯ä»¥è¿”å›æ¥æ”¶åˆ°çš„æ•°æ®ã€‚</strong></p><h1 id="å››ã€å†…æ ¸æ¥æ”¶ç½‘ç»œæ•°æ®å…¨è¿‡ç¨‹"><a href="#å››ã€å†…æ ¸æ¥æ”¶ç½‘ç»œæ•°æ®å…¨è¿‡ç¨‹" class="headerlink" title="å››ã€å†…æ ¸æ¥æ”¶ç½‘ç»œæ•°æ®å…¨è¿‡ç¨‹"></a>å››ã€å†…æ ¸æ¥æ”¶ç½‘ç»œæ•°æ®å…¨è¿‡ç¨‹</h1><p>è¿™ä¸€æ­¥ï¼Œè´¯ç©¿ç½‘å¡ã€ä¸­æ–­ä¸è¿›ç¨‹è°ƒåº¦çš„çŸ¥è¯†ï¼Œå™è¿°é˜»å¡ recv ä¸‹ï¼Œå†…æ ¸æ¥æ”¶æ•°æ®çš„å…¨è¿‡ç¨‹ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿›ç¨‹åœ¨ recv é˜»å¡æœŸé—´ï¼Œè®¡ç®—æœºæ”¶åˆ°äº†å¯¹ç«¯ä¼ é€çš„æ•°æ®ï¼ˆæ­¥éª¤â‘ ï¼‰ï¼Œæ•°æ®ç»ç”±ç½‘å¡ä¼ é€åˆ°å†…å­˜ï¼ˆæ­¥éª¤â‘¡ï¼‰ï¼Œç„¶åç½‘å¡é€šè¿‡ä¸­æ–­ä¿¡å·é€šçŸ¥ CPU æœ‰æ•°æ®åˆ°è¾¾ï¼ŒCPU æ‰§è¡Œä¸­æ–­ç¨‹åºï¼ˆæ­¥éª¤â‘¢ï¼‰ã€‚</p><p>æ­¤å¤„çš„ä¸­æ–­ç¨‹åºä¸»è¦æœ‰ä¸¤é¡¹åŠŸèƒ½ï¼Œå…ˆå°†ç½‘ç»œæ•°æ®å†™å…¥åˆ°å¯¹åº” socket çš„æ¥æ”¶ç¼“å†²åŒºé‡Œé¢ï¼ˆæ­¥éª¤â‘£ï¼‰ï¼Œå†å”¤é†’è¿›ç¨‹ Aï¼ˆæ­¥éª¤â‘¤ï¼‰ï¼Œé‡æ–°å°†è¿›ç¨‹ A æ”¾å…¥å·¥ä½œé˜Ÿåˆ—ä¸­ã€‚<br><img alt data-src="/images/linux-epoll/%E5%86%85%E6%A0%B8%E6%8E%A5%E6%94%B6%E6%95%B0%E6%8D%AE%E5%85%A8%E8%BF%87%E7%A8%8B.jpg"><br><em>å†…æ ¸æ¥æ”¶æ•°æ®å…¨è¿‡ç¨‹</em></p><p>å”¤é†’è¿›ç¨‹çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img alt data-src="/images/linux-epoll/%E5%94%A4%E9%86%92%E8%BF%9B%E7%A8%8B.jpg"><br><em>å”¤é†’è¿›ç¨‹</em></p><p>ä»¥ä¸Šæ˜¯å†…æ ¸æ¥æ”¶æ•°æ®å…¨è¿‡ç¨‹ï¼Œè¿™é‡Œæˆ‘ä»¬å¯èƒ½ä¼šæ€è€ƒä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>å…¶ä¸€ï¼Œ<strong>æ“ä½œç³»ç»Ÿå¦‚ä½•çŸ¥é“ç½‘ç»œæ•°æ®å¯¹åº”äºå“ªä¸ª socketï¼Ÿ</strong></li><li>å…¶äºŒï¼Œ<strong>å¦‚ä½•åŒæ—¶ç›‘è§†å¤šä¸ª socket çš„æ•°æ®ï¼Ÿ</strong></li></ul><p>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š<font color="DeepPink">å› ä¸ºä¸€ä¸ª socket å¯¹åº”ç€ä¸€ä¸ªç«¯å£å·ï¼Œè€Œç½‘ç»œæ•°æ®åŒ…ä¸­åŒ…å«äº† ip å’Œç«¯å£çš„ä¿¡æ¯ï¼Œå†…æ ¸å¯ä»¥é€šè¿‡ç«¯å£å·æ‰¾åˆ°å¯¹åº”çš„ socketã€‚å½“ç„¶ï¼Œä¸ºäº†æé«˜å¤„ç†é€Ÿåº¦ï¼Œæ“ä½œç³»ç»Ÿä¼šç»´æŠ¤ç«¯å£å·åˆ° socket çš„ç´¢å¼•ç»“æ„ï¼Œä»¥å¿«é€Ÿè¯»å–ã€‚</font></p><p>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯å¤šè·¯å¤ç”¨çš„é‡ä¸­ä¹‹é‡ï¼Œä¹Ÿæ­£æ˜¯æœ¬æ–‡ååŠéƒ¨åˆ†çš„é‡ç‚¹ã€‚</p><h1 id="äº”ã€åŒæ—¶ç›‘è§†å¤šä¸ª-socket-çš„ç®€å•æ–¹æ³•"><a href="#äº”ã€åŒæ—¶ç›‘è§†å¤šä¸ª-socket-çš„ç®€å•æ–¹æ³•" class="headerlink" title="äº”ã€åŒæ—¶ç›‘è§†å¤šä¸ª socket çš„ç®€å•æ–¹æ³•"></a>äº”ã€åŒæ—¶ç›‘è§†å¤šä¸ª socket çš„ç®€å•æ–¹æ³•</h1><p>æœåŠ¡ç«¯éœ€è¦ç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œè€Œ recv åªèƒ½ç›‘è§†å•ä¸ª socketï¼Œè¿™ç§çŸ›ç›¾ä¸‹ï¼Œäººä»¬å¼€å§‹å¯»æ‰¾ç›‘è§†å¤šä¸ª socket çš„æ–¹æ³•ã€‚<font color="DeepPink"> epoll çš„è¦ä¹‰å°±æ˜¯é«˜æ•ˆåœ°ç›‘è§†å¤šä¸ª socket</font>ã€‚</p><p>ä»å†å²å‘å±•è§’åº¦çœ‹ï¼Œå¿…ç„¶å…ˆå‡ºç°ä¸€ç§ä¸å¤ªé«˜æ•ˆçš„æ–¹æ³•ï¼Œäººä»¬å†åŠ ä»¥æ”¹è¿›ï¼Œæ­£å¦‚ select ä¹‹äº epollã€‚</p><p>å…ˆç†è§£ä¸å¤ªé«˜æ•ˆçš„ selectï¼Œæ‰èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£ epoll çš„æœ¬è´¨ã€‚</p><p>å‡å¦‚èƒ½å¤Ÿé¢„å…ˆä¼ å…¥ä¸€ä¸ª socket åˆ—è¡¨ï¼Œå¦‚æœåˆ—è¡¨ä¸­çš„ socket éƒ½æ²¡æœ‰æ•°æ®ï¼ŒæŒ‚èµ·è¿›ç¨‹ï¼Œç›´åˆ°æœ‰ä¸€ä¸ª socket æ”¶åˆ°æ•°æ®ï¼Œå”¤é†’è¿›ç¨‹ã€‚è¿™ç§æ–¹æ³•å¾ˆç›´æ¥ï¼Œä¹Ÿæ˜¯ select çš„è®¾è®¡æ€æƒ³ã€‚</p><p>ä¸ºæ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å…ˆå¤ä¹  select çš„ç”¨æ³•ã€‚åœ¨ä¸‹è¾¹çš„ä»£ç ä¸­ï¼Œå…ˆå‡†å¤‡ä¸€ä¸ªæ•°ç»„ fdsï¼Œè®© fds å­˜æ”¾ç€æ‰€æœ‰éœ€è¦ç›‘è§†çš„ socketã€‚ç„¶åè°ƒç”¨ selectï¼Œå¦‚æœ fds ä¸­çš„æ‰€æœ‰ socket éƒ½æ²¡æœ‰æ•°æ®ï¼Œselect ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰ä¸€ä¸ª socket æ¥æ”¶åˆ°æ•°æ®ï¼Œselect è¿”å›ï¼Œå”¤é†’è¿›ç¨‹ã€‚ç”¨æˆ·å¯ä»¥éå† fdsï¼Œé€šè¿‡ FD_ISSET åˆ¤æ–­å…·ä½“å“ªä¸ª socket æ”¶åˆ°æ•°æ®ï¼Œç„¶ååšå‡ºå¤„ç†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">int s = socket(AF_INET, SOCK_STREAM, 0);  </span><br><span class="line">bind(s, ...);</span><br><span class="line">listen(s, ...);</span><br><span class="line">int fds[] =  å­˜æ”¾éœ€è¦ç›‘å¬çš„socket;</span><br><span class="line">while(1)&#123;</span><br><span class="line">    int n = select(..., fds, ...)</span><br><span class="line">    for(int i=0; i &lt; fds.count; i++)&#123;</span><br><span class="line">        if(FD_ISSET(fds[i], ...))&#123;</span><br><span class="line">            //fds[i]çš„æ•°æ®å¤„ç†</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="select-çš„æµç¨‹"><a href="#select-çš„æµç¨‹" class="headerlink" title="select çš„æµç¨‹"></a>select çš„æµç¨‹</h2><p>select çš„å®ç°æ€è·¯å¾ˆç›´æ¥ï¼Œå‡å¦‚ç¨‹åºåŒæ—¶ç›‘è§†å¦‚ä¸‹å›¾çš„ sock1ã€sock2 å’Œ sock3 ä¸‰ä¸ª socketï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨ select ä¹‹åï¼Œæ“ä½œç³»ç»ŸæŠŠè¿›ç¨‹ A åˆ†åˆ«åŠ å…¥è¿™ä¸‰ä¸ª socket çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚<br><img alt data-src="/images/linux-epoll/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%8A%8A%E8%BF%9B%E7%A8%8BA%E5%88%86%E5%88%AB%E5%8A%A0%E5%85%A5%E8%BF%99%E4%B8%89%E4%B8%AAsocket%E7%9A%84%E7%AD%89%E5%BE%85%E9%98%9F%E5%88%97%E4%B8%AD.jpg"><br><em>æ“ä½œç³»ç»ŸæŠŠè¿›ç¨‹ A åˆ†åˆ«åŠ å…¥è¿™ä¸‰ä¸ª socket çš„ç­‰å¾…é˜Ÿåˆ—ä¸­</em></p><p>å½“ä»»ä½•ä¸€ä¸ª socket æ”¶åˆ°æ•°æ®åï¼Œä¸­æ–­ç¨‹åºå°†å”¤èµ·è¿›ç¨‹ã€‚ä¸‹å›¾å±•ç¤ºäº† sock2 æ¥æ”¶åˆ°äº†æ•°æ®çš„å¤„ç†æµç¨‹ï¼š</p><blockquote><p>æ³¨ï¼šrecv å’Œ select çš„ä¸­æ–­å›è°ƒå¯ä»¥è®¾ç½®æˆä¸åŒçš„å†…å®¹ã€‚</p></blockquote><p><img alt data-src="/images/linux-epoll/sock2%E6%8E%A5%E6%94%B6%E5%88%B0%E4%BA%86%E6%95%B0%E6%8D%AE%E4%B8%AD%E6%96%AD%E7%A8%8B%E5%BA%8F%E5%94%A4%E8%B5%B7%E8%BF%9B%E7%A8%8BA.jpg"><br><em>sock2 æ¥æ”¶åˆ°äº†æ•°æ®ï¼Œä¸­æ–­ç¨‹åºå”¤èµ·è¿›ç¨‹ A</em></p><p>æ‰€è°“å”¤èµ·è¿›ç¨‹ï¼Œå°±æ˜¯å°†è¿›ç¨‹ä»æ‰€æœ‰çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤ï¼ŒåŠ å…¥åˆ°å·¥ä½œé˜Ÿåˆ—é‡Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img alt data-src="/images/linux-epoll/%E5%B0%86%E8%BF%9B%E7%A8%8BA%E4%BB%8E%E6%89%80%E6%9C%89%E7%AD%89%E5%BE%85%E9%98%9F%E5%88%97%E4%B8%AD%E7%A7%BB%E9%99%A4%E5%86%8D%E5%8A%A0%E5%85%A5%E5%88%B0%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97%E9%87%8C%E9%9D%A2.jpg"><br><em>å°†è¿›ç¨‹ A ä»æ‰€æœ‰ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œå†åŠ å…¥åˆ°å·¥ä½œé˜Ÿåˆ—é‡Œé¢</em></p><p>ç»ç”±è¿™äº›æ­¥éª¤ï¼Œå½“è¿›ç¨‹ A è¢«å”¤é†’åï¼Œå®ƒçŸ¥é“è‡³å°‘æœ‰ä¸€ä¸ª socket æ¥æ”¶äº†æ•°æ®ã€‚ç¨‹åºåªéœ€éå†ä¸€é socket åˆ—è¡¨ï¼Œå°±å¯ä»¥å¾—åˆ°å°±ç»ªçš„ socketã€‚</p><p>è¿™ç§ç®€å•æ–¹å¼è¡Œä¹‹æœ‰æ•ˆï¼Œåœ¨å‡ ä¹æ‰€æœ‰æ“ä½œç³»ç»Ÿéƒ½æœ‰å¯¹åº”çš„å®ç°ã€‚</p><p>ä½†æ˜¯ç®€å•çš„æ–¹æ³•å¾€å¾€æœ‰ç¼ºç‚¹ï¼Œä¸»è¦æ˜¯ï¼š</p><p>å…¶ä¸€ï¼Œ<strong>æ¯æ¬¡è°ƒç”¨ select éƒ½éœ€è¦å°†è¿›ç¨‹åŠ å…¥åˆ°æ‰€æœ‰ç›‘è§† socket çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œæ¯æ¬¡å”¤é†’éƒ½éœ€è¦ä»æ¯ä¸ªé˜Ÿåˆ—ä¸­ç§»é™¤ã€‚è¿™é‡Œæ¶‰åŠäº†ä¸¤æ¬¡éå†ï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦å°†æ•´ä¸ª fds åˆ—è¡¨ä¼ é€’ç»™å†…æ ¸ï¼Œæœ‰ä¸€å®šçš„å¼€é”€ã€‚æ­£æ˜¯å› ä¸ºéå†æ“ä½œå¼€é”€å¤§ï¼Œå‡ºäºæ•ˆç‡çš„è€ƒé‡ï¼Œæ‰ä¼šè§„å®š select çš„æœ€å¤§ç›‘è§†æ•°é‡ï¼Œé»˜è®¤åªèƒ½ç›‘è§† 1024 ä¸ª socketã€‚</strong></p><p>å…¶äºŒï¼Œ<strong>è¿›ç¨‹è¢«å”¤é†’åï¼Œç¨‹åºå¹¶ä¸çŸ¥é“å“ªäº› socket æ”¶åˆ°æ•°æ®ï¼Œè¿˜éœ€è¦éå†ä¸€æ¬¡ã€‚</strong></p><p>é‚£ä¹ˆï¼Œ<font color="DeepPink">æœ‰æ²¡æœ‰å‡å°‘éå†çš„æ–¹æ³•ï¼Ÿæœ‰æ²¡æœ‰ä¿å­˜å°±ç»ª socket çš„æ–¹æ³•ï¼Ÿè¿™ä¸¤ä¸ªé—®é¢˜ä¾¿æ˜¯ epoll æŠ€æœ¯è¦è§£å†³çš„ã€‚</font></p><blockquote><p>è¡¥å……è¯´æ˜ï¼š æœ¬èŠ‚åªè§£é‡Šäº† select çš„ä¸€ç§æƒ…å½¢ã€‚å½“ç¨‹åºè°ƒç”¨ select æ—¶ï¼Œå†…æ ¸ä¼šå…ˆéå†ä¸€é socketï¼Œå¦‚æœæœ‰ä¸€ä¸ªä»¥ä¸Šçš„ socket æ¥æ”¶ç¼“å†²åŒºæœ‰æ•°æ®ï¼Œé‚£ä¹ˆ select ç›´æ¥è¿”å›ï¼Œä¸ä¼šé˜»å¡ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ select çš„è¿”å›å€¼æœ‰å¯èƒ½å¤§äº 1 çš„åŸå› ä¹‹ä¸€ã€‚å¦‚æœæ²¡æœ‰ socket æœ‰æ•°æ®ï¼Œè¿›ç¨‹æ‰ä¼šé˜»å¡ã€‚</p></blockquote><h1 id="å…­ã€epoll-çš„è®¾è®¡æ€è·¯"><a href="#å…­ã€epoll-çš„è®¾è®¡æ€è·¯" class="headerlink" title="å…­ã€epoll çš„è®¾è®¡æ€è·¯"></a>å…­ã€epoll çš„è®¾è®¡æ€è·¯</h1><p>epoll æ˜¯åœ¨ select å‡ºç° N å¤šå¹´åæ‰è¢«å‘æ˜çš„ï¼Œæ˜¯ select å’Œ pollï¼ˆpoll å’Œ select åŸºæœ¬ä¸€æ ·ï¼Œæœ‰å°‘é‡æ”¹è¿›ï¼‰çš„å¢å¼ºç‰ˆæœ¬ã€‚epoll é€šè¿‡ä»¥ä¸‹ä¸€äº›æªæ–½æ¥æ”¹è¿›æ•ˆç‡ï¼š</p><h2 id="æªæ–½ä¸€ï¼šåŠŸèƒ½åˆ†ç¦»"><a href="#æªæ–½ä¸€ï¼šåŠŸèƒ½åˆ†ç¦»" class="headerlink" title="æªæ–½ä¸€ï¼šåŠŸèƒ½åˆ†ç¦»"></a>æªæ–½ä¸€ï¼šåŠŸèƒ½åˆ†ç¦»</h2><p>select ä½æ•ˆçš„åŸå› ä¹‹ä¸€æ˜¯å°†â€œç»´æŠ¤ç­‰å¾…é˜Ÿåˆ—â€å’Œâ€œé˜»å¡è¿›ç¨‹â€ä¸¤ä¸ªæ­¥éª¤åˆäºŒä¸ºä¸€ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯æ¬¡è°ƒç”¨ select éƒ½éœ€è¦è¿™ä¸¤æ­¥æ“ä½œï¼Œç„¶è€Œå¤§å¤šæ•°åº”ç”¨åœºæ™¯ä¸­ï¼Œéœ€è¦ç›‘è§†çš„ socket ç›¸å¯¹å›ºå®šï¼Œå¹¶ä¸éœ€è¦æ¯æ¬¡éƒ½ä¿®æ”¹ã€‚epoll å°†è¿™ä¸¤ä¸ªæ“ä½œåˆ†å¼€ï¼Œå…ˆç”¨ epoll_ctl ç»´æŠ¤ç­‰å¾…é˜Ÿåˆ—ï¼Œå†è°ƒç”¨ epoll_wait é˜»å¡è¿›ç¨‹ã€‚æ˜¾è€Œæ˜“è§åœ°ï¼Œæ•ˆç‡å°±èƒ½å¾—åˆ°æå‡ã€‚<br><img alt data-src="/images/linux-epoll/%E7%9B%B8%E6%AF%94selectepoll%E6%8B%86%E5%88%86%E4%BA%86%E5%8A%9F%E8%83%BD.jpg"></p><p><em>ç›¸æ¯” selectï¼Œepoll æ‹†åˆ†äº†åŠŸèƒ½</em></p><p>ä¸ºæ–¹ä¾¿ç†è§£åç»­çš„å†…å®¹ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ epoll çš„ç”¨æ³•ã€‚å¦‚ä¸‹çš„ä»£ç ä¸­ï¼Œå…ˆç”¨ epoll_create åˆ›å»ºä¸€ä¸ª epoll å¯¹è±¡ epfdï¼Œå†é€šè¿‡ epoll_ctl å°†éœ€è¦ç›‘è§†çš„ socket æ·»åŠ åˆ° epfd ä¸­ï¼Œæœ€åè°ƒç”¨ epoll_wait ç­‰å¾…æ•°æ®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">int s = socket(AF_INET, SOCK_STREAM, 0);   </span><br><span class="line">bind(s, ...)</span><br><span class="line">listen(s, ...)</span><br><span class="line"></span><br><span class="line">int epfd = epoll_create(...);</span><br><span class="line">epoll_ctl(epfd, ...); //å°†æ‰€æœ‰éœ€è¦ç›‘å¬çš„socketæ·»åŠ åˆ°epfdä¸­</span><br><span class="line"></span><br><span class="line">while(1)&#123;</span><br><span class="line">    int n = epoll_wait(...)</span><br><span class="line">    for(æ¥æ”¶åˆ°æ•°æ®çš„socket)&#123;</span><br><span class="line">        //å¤„ç†</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠŸèƒ½åˆ†ç¦»ï¼Œä½¿å¾— epoll æœ‰äº†ä¼˜åŒ–çš„å¯èƒ½ã€‚</p><h2 id="æªæ–½äºŒï¼šå°±ç»ªåˆ—è¡¨"><a href="#æªæ–½äºŒï¼šå°±ç»ªåˆ—è¡¨" class="headerlink" title="æªæ–½äºŒï¼šå°±ç»ªåˆ—è¡¨"></a>æªæ–½äºŒï¼šå°±ç»ªåˆ—è¡¨</h2><p>select ä½æ•ˆçš„å¦ä¸€ä¸ªåŸå› åœ¨äºç¨‹åºä¸çŸ¥é“å“ªäº› socket æ”¶åˆ°æ•°æ®ï¼Œåªèƒ½ä¸€ä¸ªä¸ªéå†ã€‚å¦‚æœå†…æ ¸ç»´æŠ¤ä¸€ä¸ªâ€œå°±ç»ªåˆ—è¡¨â€ï¼Œå¼•ç”¨æ”¶åˆ°æ•°æ®çš„ socketï¼Œå°±èƒ½é¿å…éå†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè®¡ç®—æœºå…±æœ‰ä¸‰ä¸ª socketï¼Œæ”¶åˆ°æ•°æ®çš„ sock2 å’Œ sock3 è¢«å°±ç»ªåˆ—è¡¨ rdlist æ‰€å¼•ç”¨ã€‚å½“è¿›ç¨‹è¢«å”¤é†’åï¼Œåªè¦è·å– rdlist çš„å†…å®¹ï¼Œå°±èƒ½å¤ŸçŸ¥é“å“ªäº› socket æ”¶åˆ°æ•°æ®ã€‚<br><img alt data-src="/images/linux-epoll/%E5%B0%B1%E7%BB%AA%E5%88%97%E8%A1%A8%E7%A4%BA%E6%84%8F%E5%9B%BE.jpg"><br><em>å°±ç»ªåˆ—è¡¨ç¤ºæ„å›¾</em></p><h1 id="ä¸ƒã€epoll-çš„åŸç†ä¸å·¥ä½œæµç¨‹"><a href="#ä¸ƒã€epoll-çš„åŸç†ä¸å·¥ä½œæµç¨‹" class="headerlink" title="ä¸ƒã€epoll çš„åŸç†ä¸å·¥ä½œæµç¨‹"></a>ä¸ƒã€epoll çš„åŸç†ä¸å·¥ä½œæµç¨‹</h1><p>æœ¬èŠ‚ä¼šä»¥ç¤ºä¾‹å’Œå›¾è¡¨æ¥è®²è§£ epoll çš„åŸç†å’Œå·¥ä½œæµç¨‹ã€‚</p><h2 id="åˆ›å»º-epoll-å¯¹è±¡"><a href="#åˆ›å»º-epoll-å¯¹è±¡" class="headerlink" title="åˆ›å»º epoll å¯¹è±¡"></a>åˆ›å»º epoll å¯¹è±¡</h2><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“æŸä¸ªè¿›ç¨‹è°ƒç”¨ epoll_create æ–¹æ³•æ—¶ï¼Œå†…æ ¸ä¼šåˆ›å»ºä¸€ä¸ª eventpoll å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯ç¨‹åºä¸­ epfd æ‰€ä»£è¡¨çš„å¯¹è±¡ï¼‰ã€‚eventpoll å¯¹è±¡ä¹Ÿæ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€å‘˜ï¼Œå’Œ socket ä¸€æ ·ï¼Œå®ƒä¹Ÿä¼šæœ‰ç­‰å¾…é˜Ÿåˆ—ã€‚<br><img alt data-src="/images/linux-epoll/%E5%86%85%E6%A0%B8%E5%88%9B%E5%BB%BAeventpoll%E5%AF%B9%E8%B1%A1.jpg"><br><em>å†…æ ¸åˆ›å»º eventpoll å¯¹è±¡</em></p><p>åˆ›å»ºä¸€ä¸ªä»£è¡¨è¯¥ epoll çš„ eventpoll å¯¹è±¡æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºå†…æ ¸è¦ç»´æŠ¤â€œå°±ç»ªåˆ—è¡¨â€ç­‰æ•°æ®ï¼Œâ€œå°±ç»ªåˆ—è¡¨â€å¯ä»¥ä½œä¸º eventpoll çš„æˆå‘˜ã€‚</p><h2 id="ç»´æŠ¤ç›‘è§†åˆ—è¡¨"><a href="#ç»´æŠ¤ç›‘è§†åˆ—è¡¨" class="headerlink" title="ç»´æŠ¤ç›‘è§†åˆ—è¡¨"></a>ç»´æŠ¤ç›‘è§†åˆ—è¡¨</h2><p>åˆ›å»º epoll å¯¹è±¡åï¼Œå¯ä»¥ç”¨ epoll_ctl æ·»åŠ æˆ–åˆ é™¤æ‰€è¦ç›‘å¬çš„ socketã€‚ä»¥æ·»åŠ  socket ä¸ºä¾‹ï¼Œå¦‚ä¸‹å›¾ï¼Œå¦‚æœé€šè¿‡ epoll_ctl æ·»åŠ  sock1ã€sock2 å’Œ sock3 çš„ç›‘è§†ï¼Œå†…æ ¸ä¼šå°† eventpoll æ·»åŠ åˆ°è¿™ä¸‰ä¸ª socket çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚<br><img alt data-src="/images/linux-epoll/%E6%B7%BB%E5%8A%A0%E6%89%80%E8%A6%81%E7%9B%91%E5%90%AC%E7%9A%84socket.jpg"><br><em>æ·»åŠ æ‰€è¦ç›‘å¬çš„ socket</em></p><p>å½“ socket æ”¶åˆ°æ•°æ®åï¼Œä¸­æ–­ç¨‹åºä¼šæ“ä½œ eventpoll å¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æ¥æ“ä½œè¿›ç¨‹ã€‚</p><h2 id="æ¥æ”¶æ•°æ®"><a href="#æ¥æ”¶æ•°æ®" class="headerlink" title="æ¥æ”¶æ•°æ®"></a>æ¥æ”¶æ•°æ®</h2><p>å½“ socket æ”¶åˆ°æ•°æ®åï¼Œä¸­æ–­ç¨‹åºä¼šç»™ eventpoll çš„â€œå°±ç»ªåˆ—è¡¨â€æ·»åŠ  socket å¼•ç”¨ã€‚å¦‚ä¸‹å›¾å±•ç¤ºçš„æ˜¯ sock2 å’Œ sock3 æ”¶åˆ°æ•°æ®åï¼Œä¸­æ–­ç¨‹åºè®© rdlist å¼•ç”¨è¿™ä¸¤ä¸ª socketã€‚<br><img alt data-src="/images/linux-epoll/%E7%BB%99%E5%B0%B1%E7%BB%AA%E5%88%97%E8%A1%A8%E6%B7%BB%E5%8A%A0%E5%BC%95%E7%94%A8.jpg"><br><em>ç»™å°±ç»ªåˆ—è¡¨æ·»åŠ å¼•ç”¨</em></p><p>eventpoll å¯¹è±¡ç›¸å½“äº socket å’Œè¿›ç¨‹ä¹‹é—´çš„ä¸­ä»‹ï¼Œsocket çš„æ•°æ®æ¥æ”¶å¹¶ä¸ç›´æ¥å½±å“è¿›ç¨‹ï¼Œè€Œæ˜¯é€šè¿‡æ”¹å˜ eventpoll çš„å°±ç»ªåˆ—è¡¨æ¥æ”¹å˜è¿›ç¨‹çŠ¶æ€ã€‚</p><p>å½“ç¨‹åºæ‰§è¡Œåˆ° epoll_wait æ—¶ï¼Œå¦‚æœ rdlist å·²ç»å¼•ç”¨äº† socketï¼Œé‚£ä¹ˆ epoll_wait ç›´æ¥è¿”å›ï¼Œå¦‚æœ rdlist ä¸ºç©ºï¼Œé˜»å¡è¿›ç¨‹ã€‚</p><h2 id="é˜»å¡å’Œå”¤é†’è¿›ç¨‹"><a href="#é˜»å¡å’Œå”¤é†’è¿›ç¨‹" class="headerlink" title="é˜»å¡å’Œå”¤é†’è¿›ç¨‹"></a>é˜»å¡å’Œå”¤é†’è¿›ç¨‹</h2><p>å‡è®¾è®¡ç®—æœºä¸­æ­£åœ¨è¿è¡Œè¿›ç¨‹ A å’Œè¿›ç¨‹ Bï¼Œåœ¨æŸæ—¶åˆ»è¿›ç¨‹ A è¿è¡Œåˆ°äº† epoll_wait è¯­å¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå†…æ ¸ä¼šå°†è¿›ç¨‹ A æ”¾å…¥ eventpoll çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œé˜»å¡è¿›ç¨‹ã€‚<br><img alt data-src="/images/linux-epoll/epoll_wait%E9%98%BB%E5%A1%9E%E8%BF%9B%E7%A8%8B.jpg"><br><em>epoll_wait é˜»å¡è¿›ç¨‹</em></p><p>å½“ socket æ¥æ”¶åˆ°æ•°æ®ï¼Œä¸­æ–­ç¨‹åºä¸€æ–¹é¢ä¿®æ”¹ rdlistï¼Œå¦ä¸€æ–¹é¢å”¤é†’ eventpoll ç­‰å¾…é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ï¼Œè¿›ç¨‹ A å†æ¬¡è¿›å…¥è¿è¡ŒçŠ¶æ€ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚ä¹Ÿå› ä¸º rdlist çš„å­˜åœ¨ï¼Œè¿›ç¨‹ A å¯ä»¥çŸ¥é“å“ªäº› socket å‘ç”Ÿäº†å˜åŒ–ã€‚<br><img alt data-src="/images/linux-epoll/epoll%E5%94%A4%E9%86%92%E8%BF%9B%E7%A8%8B.jpg"><br><em>epoll å”¤é†’è¿›ç¨‹</em></p><h1 id="å…«ã€epoll-çš„å®ç°ç»†èŠ‚"><a href="#å…«ã€epoll-çš„å®ç°ç»†èŠ‚" class="headerlink" title="å…«ã€epoll çš„å®ç°ç»†èŠ‚"></a>å…«ã€epoll çš„å®ç°ç»†èŠ‚</h1><p>è‡³æ­¤ï¼Œç›¸ä¿¡è¯»è€…å¯¹ epoll çš„æœ¬è´¨å·²ç»æœ‰ä¸€å®šçš„äº†è§£ã€‚ä½†æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ eventpoll çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ</p><p>æ­¤å¤–ï¼Œå°±ç»ªé˜Ÿåˆ—åº”è¯¥åº”ä½¿ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„ï¼Ÿeventpoll åº”ä½¿ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„æ¥ç®¡ç†é€šè¿‡ epoll_ctl æ·»åŠ æˆ–åˆ é™¤çš„ socketï¼Ÿ</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œeventpoll åŒ…å«äº† lockã€mtxã€wqï¼ˆç­‰å¾…é˜Ÿåˆ—ï¼‰ä¸ rdlist ç­‰æˆå‘˜ï¼Œå…¶ä¸­ rdlist å’Œ rbr æ˜¯æˆ‘ä»¬æ‰€å…³å¿ƒçš„ã€‚<br><img alt data-src="/images/linux-epoll/epoll%E5%8E%9F%E7%90%86%E7%A4%BA%E6%84%8F%E5%9B%BE.jpg"><br><em>epoll åŸç†ç¤ºæ„å›¾ï¼Œå›¾ç‰‡æ¥æºï¼šã€Šæ·±å…¥ç†è§£Nginxï¼šæ¨¡å—å¼€å‘ä¸æ¶æ„è§£æ(ç¬¬äºŒç‰ˆ)ã€‹ï¼Œé™¶è¾‰</em></p><h2 id="å°±ç»ªåˆ—è¡¨çš„æ•°æ®ç»“æ„"><a href="#å°±ç»ªåˆ—è¡¨çš„æ•°æ®ç»“æ„" class="headerlink" title="å°±ç»ªåˆ—è¡¨çš„æ•°æ®ç»“æ„"></a>å°±ç»ªåˆ—è¡¨çš„æ•°æ®ç»“æ„</h2><p>å°±ç»ªåˆ—è¡¨å¼•ç”¨ç€å°±ç»ªçš„ socketï¼Œæ‰€ä»¥å®ƒåº”èƒ½å¤Ÿå¿«é€Ÿçš„æ’å…¥æ•°æ®ã€‚</p><p>ç¨‹åºå¯èƒ½éšæ—¶è°ƒç”¨ epoll_ctl æ·»åŠ ç›‘è§† socketï¼Œä¹Ÿå¯èƒ½éšæ—¶åˆ é™¤ã€‚å½“åˆ é™¤æ—¶ï¼Œè‹¥è¯¥ socket å·²ç»å­˜æ”¾åœ¨å°±ç»ªåˆ—è¡¨ä¸­ï¼Œå®ƒä¹Ÿåº”è¯¥è¢«ç§»é™¤ã€‚æ‰€ä»¥å°±ç»ªåˆ—è¡¨åº”æ˜¯ä¸€ç§èƒ½å¤Ÿå¿«é€Ÿæ’å…¥å’Œåˆ é™¤çš„æ•°æ®ç»“æ„ã€‚</p><p>åŒå‘é“¾è¡¨å°±æ˜¯è¿™æ ·ä¸€ç§æ•°æ®ç»“æ„ï¼Œepoll ä½¿ç”¨åŒå‘é“¾è¡¨æ¥å®ç°å°±ç»ªé˜Ÿåˆ—ï¼ˆå¯¹åº”ä¸Šå›¾çš„ rdllistï¼‰ã€‚</p><h2 id="ç´¢å¼•ç»“æ„"><a href="#ç´¢å¼•ç»“æ„" class="headerlink" title="ç´¢å¼•ç»“æ„"></a>ç´¢å¼•ç»“æ„</h2><p>æ—¢ç„¶ epoll å°†â€œç»´æŠ¤ç›‘è§†é˜Ÿåˆ—â€å’Œâ€œè¿›ç¨‹é˜»å¡â€åˆ†ç¦»ï¼Œä¹Ÿæ„å‘³ç€éœ€è¦æœ‰ä¸ªæ•°æ®ç»“æ„æ¥ä¿å­˜ç›‘è§†çš„ socketï¼Œè‡³å°‘è¦æ–¹ä¾¿åœ°æ·»åŠ å’Œç§»é™¤ï¼Œè¿˜è¦ä¾¿äºæœç´¢ï¼Œä»¥é¿å…é‡å¤æ·»åŠ ã€‚çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæœç´¢ã€æ’å…¥å’Œåˆ é™¤æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(log(N))ï¼Œæ•ˆç‡è¾ƒå¥½ï¼Œepoll ä½¿ç”¨äº†çº¢é»‘æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼ˆå¯¹åº”ä¸Šå›¾çš„ rbrï¼‰ã€‚</p><p>æ³¨ï¼šå› ä¸ºæ“ä½œç³»ç»Ÿè¦å…¼é¡¾å¤šç§åŠŸèƒ½ï¼Œä»¥åŠç”±æ›´å¤šéœ€è¦ä¿å­˜çš„æ•°æ®ï¼Œrdlist å¹¶éç›´æ¥å¼•ç”¨ socketï¼Œè€Œæ˜¯é€šè¿‡ epitem é—´æ¥å¼•ç”¨ï¼Œçº¢é»‘æ ‘çš„èŠ‚ç‚¹ä¹Ÿæ˜¯ epitem å¯¹è±¡ã€‚åŒæ ·ï¼Œæ–‡ä»¶ç³»ç»Ÿä¹Ÿå¹¶éç›´æ¥å¼•ç”¨ç€ socketã€‚ä¸ºæ–¹ä¾¿ç†è§£ï¼Œæœ¬æ–‡ä¸­çœç•¥äº†ä¸€äº›é—´æ¥ç»“æ„ã€‚</p><h1 id="ä¹ã€å°ç»“"><a href="#ä¹ã€å°ç»“" class="headerlink" title="ä¹ã€å°ç»“"></a>ä¹ã€å°ç»“</h1><p>epoll åœ¨ select å’Œ poll çš„åŸºç¡€ä¸Šå¼•å…¥äº† eventpoll ä½œä¸ºä¸­é—´å±‚ï¼Œä½¿ç”¨äº†å…ˆè¿›çš„æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸€ç§é«˜æ•ˆçš„å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚è¿™é‡Œä¹Ÿä»¥è¡¨æ ¼å½¢å¼ç®€å•å¯¹æ¯”ä¸€ä¸‹ selectã€poll ä¸ epollï¼Œç»“æŸæ­¤æ–‡ã€‚å¸Œæœ›è¯»è€…èƒ½æœ‰æ‰€æ”¶è·ã€‚</p><p><img alt data-src="/images/linux-epoll/%E5%B0%8F%E7%BB%93.jpg"></p><p>åŸæ–‡åœ°å€ï¼š<a href="https://my.oschina.net/editorial-story/blog/3052308" target="_blank" rel="noopener">https://my.oschina.net/editorial-story/blog/3052308</a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Epoll </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java åŸå­æ“ä½œçš„å®ç°åŸç†</title>
      <link href="/java-atomic-operation-principle.html"/>
      <url>/java-atomic-operation-principle.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ•´ç†è‡ªã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ç¬¬äºŒç«  ä½œè€…ï¼šæ–¹è…¾é£ã€€é­é¹ã€€ç¨‹æ™“æ˜</p></blockquote><a id="more"></a><p>åŸå­ï¼ˆatomicï¼‰æœ¬æ„æ˜¯â€œä¸èƒ½è¢«è¿›ä¸€æ­¥åˆ†å‰²çš„æœ€å°ç²’å­â€ï¼Œè€ŒåŸå­æ“ä½œï¼ˆatomic operationï¼‰æ„ä¸ºâ€œä¸å¯è¢«ä¸­æ–­çš„ä¸€ä¸ªæˆ–ä¸€ç³»åˆ—æ“ä½œâ€ã€‚åœ¨å¤šå¤„ç†å™¨ä¸Šå®ç°åŸå­æ“ä½œå°±å˜å¾—æœ‰ç‚¹å¤æ‚ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ¥èŠä¸€èŠåœ¨Intelå¤„ç†å™¨å’ŒJavaé‡Œæ˜¯å¦‚ä½•å®ç°åŸå­æ“ä½œçš„ã€‚</p><h1 id="æœ¯è¯­å®šä¹‰"><a href="#æœ¯è¯­å®šä¹‰" class="headerlink" title="æœ¯è¯­å®šä¹‰"></a>æœ¯è¯­å®šä¹‰</h1><p>åœ¨äº†è§£åŸå­æ“ä½œçš„å®ç°åŸç†å‰ï¼Œå…ˆè¦äº†è§£ä¸€ä¸‹ç›¸å…³çš„æœ¯è¯­:</p><style>table th:first-of-type {    width: 100px;}table th:nth-of-type(2) {    width: 150px;}</style><table><thead><tr><th>æœ¯è¯­åç§°</th><th>è‹±æ–‡</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>ç¼“å­˜è¡Œ</td><td>Cache line</td><td>ç¼“å­˜çš„æœ€å°æ“ä½œå•ä½</td></tr><tr><td>æ¯”è¾ƒå¹¶äº¤æ¢</td><td>Compare and Swap</td><td>CASæ“ä½œéœ€è¦è¾“å…¥ä¸¤ä¸ªæ•°å€¼ï¼Œä¸€ä¸ªæ—§å€¼(æœŸæœ›æ“ä½œå‰çš„å€¼)å’Œä¸€ä¸ªæ–°å€¼ï¼Œåœ¨æ“ä½œæœŸé—´å…ˆæ¯”è¾ƒæ—§å€¼æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œæ‰äº¤æ¢æˆæ–°å€¼ï¼Œå‘ç”Ÿäº†å˜åŒ–åˆ™ä¸äº¤æ¢ã€‚</td></tr><tr><td>CPUæµæ°´çº¿</td><td>CPU pipeline</td><td>CPUæµæ°´çº¿çš„å·¥ä½œæ–¹å¼å°±åƒå·¥ä¸šç”Ÿäº§ä¸Šçš„è£…é…æµæ°´çº¿ï¼Œåœ¨CPUä¸­ç”±5~6ä¸ªä¸åŒåŠŸèƒ½çš„ç”µè·¯å•å…ƒç»„æˆä¸€æ¡æŒ‡ä»¤å¤„ç†æµæ°´çº¿ï¼Œç„¶åå°†ä¸€æ¡X86æŒ‡ä»¤åˆ†æˆ5~6æ­¥åå†ç”±è¿™äº›ç”µè·¯å•å…ƒåˆ†åˆ«æ‰§è¡Œï¼Œè¿™æ ·å°±èƒ½å®ç°åœ¨ä¸€ä¸ªCPUæ—¶é’Ÿå‘¨æœŸå®Œæˆä¸€æ¡æŒ‡ä»¤ï¼Œå› æ­¤æé«˜CPUçš„è¿ç®—é€Ÿåº¦</td></tr><tr><td>å†…å­˜é¡ºåºå†²çª</td><td>Memory order violation</td><td>å†…å­˜é¡ºåºå†²çªä¸€èˆ¬æ˜¯ç”±å‡å…±äº«å¼•èµ·çš„ï¼Œå‡å…±äº«æ˜¯æŒ‡å¤šä¸ªCPUåŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªç¼“å­˜è¡Œçš„ä¸åŒéƒ¨åˆ†è€Œå¼•èµ·å…¶ä¸­ä¸€ä¸ªCPUçš„æ“ä½œæ— æ•ˆï¼Œå½“å‡ºç°è¿™ä¸ªå†…å­˜é¡ºåºå†²çªæ—¶ï¼ŒCPUå¿…é¡»æ¸…ç©ºæµæ°´çº¿</td></tr></tbody></table><h1 id="å¤„ç†å™¨å¦‚ä½•å®ç°åŸå­æ“ä½œ"><a href="#å¤„ç†å™¨å¦‚ä½•å®ç°åŸå­æ“ä½œ" class="headerlink" title="å¤„ç†å™¨å¦‚ä½•å®ç°åŸå­æ“ä½œ"></a>å¤„ç†å™¨å¦‚ä½•å®ç°åŸå­æ“ä½œ</h1><p>32ä½IA-32å¤„ç†å™¨ä½¿ç”¨<font color="DeepPink">åŸºäºå¯¹ç¼“å­˜åŠ é”æˆ–æ€»çº¿åŠ é”çš„æ–¹å¼æ¥å®ç°å¤šå¤„ç†å™¨ä¹‹é—´çš„åŸå­æ“ä½œ</font>ã€‚é¦–å…ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨ä¿è¯åŸºæœ¬çš„å†…å­˜æ“ä½œçš„åŸå­æ€§ã€‚å¤„ç†å™¨ä¿è¯ä»ç³»ç»Ÿå†…å­˜ä¸­è¯»å–æˆ–è€…å†™å…¥ä¸€ä¸ªå­—èŠ‚æ˜¯åŸå­çš„ï¼Œæ„æ€æ˜¯å½“ä¸€ä¸ªå¤„ç†å™¨è¯»å–ä¸€ä¸ªå­—èŠ‚æ—¶ï¼Œå…¶ä»–å¤„ç†å™¨ä¸èƒ½è®¿é—®è¿™ä¸ªå­—èŠ‚çš„å†…å­˜åœ°å€ã€‚Pentium 6å’Œæœ€æ–°çš„å¤„ç†å™¨èƒ½è‡ªåŠ¨ä¿è¯å•å¤„ç†å™¨å¯¹åŒä¸€ä¸ªç¼“å­˜è¡Œé‡Œè¿›è¡Œ16/32/64ä½çš„æ“ä½œæ˜¯åŸå­çš„ï¼Œä½†æ˜¯å¤æ‚çš„å†…å­˜æ“ä½œå¤„ç†å™¨æ˜¯ä¸èƒ½è‡ªåŠ¨ä¿è¯å…¶åŸå­æ€§çš„ï¼Œæ¯”å¦‚è·¨æ€»çº¿å®½åº¦ã€è·¨å¤šä¸ªç¼“å­˜è¡Œå’Œè·¨é¡µè¡¨çš„è®¿é—®ã€‚ä½†æ˜¯ï¼Œå¤„ç†å™¨æä¾›æ€»çº¿é”å®šå’Œç¼“å­˜é”å®šä¸¤ä¸ªæœºåˆ¶æ¥ä¿è¯å¤æ‚å†…å­˜æ“ä½œçš„åŸå­æ€§ã€‚</p><blockquote><p>åœ¨Intel 2019å¹´çš„æ–‡æ¡£ä¸­ï¼Œè¯¥éƒ¨åˆ†é˜è¿°åŸºæœ¬ä¸å˜ï¼Œå…·ä½“å¯ä»¥æŸ¥è€ƒæ–‡æœ«Intelæ–‡æ¡£çš„2957é¡µ 8.1 LOCKED ATOMIC OPERATIONS</p></blockquote><h2 id="ä½¿ç”¨æ€»çº¿é”ä¿è¯åŸå­æ€§"><a href="#ä½¿ç”¨æ€»çº¿é”ä¿è¯åŸå­æ€§" class="headerlink" title="ä½¿ç”¨æ€»çº¿é”ä¿è¯åŸå­æ€§"></a>ä½¿ç”¨æ€»çº¿é”ä¿è¯åŸå­æ€§</h2><p>ç¬¬ä¸€ä¸ªæœºåˆ¶æ˜¯é€šè¿‡æ€»çº¿é”ä¿è¯åŸå­æ€§ã€‚å¦‚æœå¤šä¸ªå¤„ç†å™¨åŒæ—¶å¯¹å…±äº«å˜é‡è¿›è¡Œè¯»æ”¹å†™æ“ä½œï¼ˆi++å°±æ˜¯ç»å…¸çš„è¯»æ”¹å†™æ“ä½œï¼‰ï¼Œé‚£ä¹ˆå…±äº«å˜é‡å°±ä¼šè¢«å¤šä¸ªå¤„ç†å™¨åŒæ—¶è¿›è¡Œæ“ä½œï¼Œè¿™æ ·è¯»æ”¹å†™æ“ä½œå°±ä¸æ˜¯åŸå­çš„ï¼Œæ“ä½œå®Œä¹‹åå…±äº«å˜é‡çš„å€¼ä¼šå’ŒæœŸæœ›çš„ä¸ä¸€è‡´ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœi=1ï¼Œæˆ‘ä»¬è¿›è¡Œä¸¤æ¬¡i++æ“ä½œï¼Œæˆ‘ä»¬æœŸæœ›çš„ç»“æœæ˜¯3ï¼Œä½†æ˜¯æœ‰å¯èƒ½ç»“æœæ˜¯2ï¼Œå¦‚å›¾2-3æ‰€ç¤ºã€‚</p><p><img alt data-src="/images/java-atomic-operation-principle/%E5%9B%BE23.png"></p><p>åŸå› å¯èƒ½æ˜¯å¤šä¸ªå¤„ç†å™¨åŒæ—¶ä»å„è‡ªçš„ç¼“å­˜ä¸­è¯»å–å˜é‡iï¼Œåˆ†åˆ«è¿›è¡ŒåŠ 1æ“ä½œï¼Œç„¶ååˆ†åˆ«å†™å…¥ç³»ç»Ÿå†…å­˜ä¸­ã€‚é‚£ä¹ˆï¼Œæƒ³è¦ä¿è¯è¯»æ”¹å†™å…±äº«å˜é‡çš„æ“ä½œæ˜¯åŸå­çš„ï¼Œå°±å¿…é¡»ä¿è¯CPU1è¯»æ”¹å†™å…±äº«å˜é‡çš„æ—¶å€™ï¼ŒCPU2ä¸èƒ½æ“ä½œç¼“å­˜äº†è¯¥å…±äº«å˜é‡å†…å­˜åœ°å€çš„ç¼“å­˜ã€‚å¤„ç†å™¨ä½¿ç”¨æ€»çº¿é”å°±æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚<font color="DeepPink">æ‰€è°“æ€»çº¿é”å°±æ˜¯ä½¿ç”¨å¤„ç†å™¨æä¾›çš„ä¸€ä¸ªLOCKï¼ƒä¿¡å·ï¼Œå½“ä¸€ä¸ªå¤„ç†å™¨åœ¨æ€»çº¿ä¸Šè¾“å‡ºæ­¤ä¿¡å·æ—¶ï¼Œå…¶ä»–å¤„ç†å™¨çš„è¯·æ±‚å°†è¢«é˜»å¡ä½ï¼Œé‚£ä¹ˆè¯¥å¤„ç†å™¨å¯ä»¥ç‹¬å å…±äº«å†…å­˜ã€‚</font></p><blockquote><p>Intelæ–‡æ¡£çš„2959é¡µ 8.1.2 Bus Locking</p></blockquote><h2 id="ä½¿ç”¨ç¼“å­˜é”ä¿è¯åŸå­æ€§"><a href="#ä½¿ç”¨ç¼“å­˜é”ä¿è¯åŸå­æ€§" class="headerlink" title="ä½¿ç”¨ç¼“å­˜é”ä¿è¯åŸå­æ€§"></a>ä½¿ç”¨ç¼“å­˜é”ä¿è¯åŸå­æ€§</h2><p>ç¬¬äºŒä¸ªæœºåˆ¶æ˜¯é€šè¿‡ç¼“å­˜é”å®šæ¥ä¿è¯åŸå­æ€§ã€‚<font color="DeepPink">åœ¨åŒä¸€æ—¶åˆ»ï¼Œæˆ‘ä»¬åªéœ€ä¿è¯å¯¹æŸä¸ªå†…å­˜åœ°å€çš„æ“ä½œæ˜¯åŸå­æ€§å³å¯ï¼Œä½†æ€»çº¿é”å®šæŠŠCPUå’Œå†…å­˜ä¹‹é—´çš„é€šä¿¡é”ä½äº†ï¼Œè¿™ä½¿å¾—é”å®šæœŸé—´ï¼Œå…¶ä»–å¤„ç†å™¨ä¸èƒ½æ“ä½œå…¶ä»–å†…å­˜åœ°å€çš„æ•°æ®ï¼Œæ‰€ä»¥æ€»çº¿é”å®šçš„å¼€é”€æ¯”è¾ƒå¤§ï¼Œç›®å‰å¤„ç†å™¨åœ¨æŸäº›åœºåˆä¸‹ä½¿ç”¨ç¼“å­˜é”å®šä»£æ›¿æ€»çº¿é”å®šæ¥è¿›è¡Œä¼˜åŒ–ã€‚</font></p><p>é¢‘ç¹ä½¿ç”¨çš„å†…å­˜ä¼šç¼“å­˜åœ¨å¤„ç†å™¨çš„L1ã€L2å’ŒL3é«˜é€Ÿç¼“å­˜é‡Œï¼Œé‚£ä¹ˆåŸå­æ“ä½œå°±å¯ä»¥ç›´æ¥åœ¨å¤„ç†å™¨å†…éƒ¨ç¼“å­˜ä¸­è¿›è¡Œï¼Œå¹¶ä¸éœ€è¦å£°æ˜æ€»çº¿é”ï¼Œåœ¨Pentium 6å’Œç›®å‰çš„å¤„ç†å™¨ä¸­å¯ä»¥ä½¿ç”¨â€œç¼“å­˜é”å®šâ€çš„æ–¹å¼æ¥å®ç°å¤æ‚çš„åŸå­æ€§ã€‚<font color="DeepPink">æ‰€è°“â€œç¼“å­˜é”å®šâ€æ˜¯æŒ‡å†…å­˜åŒºåŸŸå¦‚æœè¢«ç¼“å­˜åœ¨å¤„ç†å™¨çš„ç¼“å­˜è¡Œä¸­ï¼Œå¹¶ä¸”åœ¨Lockæ“ä½œæœŸé—´è¢«é”å®šï¼Œé‚£ä¹ˆå½“å®ƒæ‰§è¡Œé”æ“ä½œå›å†™åˆ°å†…å­˜æ—¶ï¼Œå¤„ç†å™¨ä¸åœ¨æ€»çº¿ä¸Šå£°è¨€LOCKï¼ƒä¿¡å·ï¼Œè€Œæ˜¯ä¿®æ”¹å†…éƒ¨çš„å†…å­˜åœ°å€ï¼Œå¹¶å…è®¸å®ƒçš„ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œå› ä¸ºç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶ä¼šé˜»æ­¢åŒæ—¶ä¿®æ”¹ç”±ä¸¤ä¸ªä»¥ä¸Šå¤„ç†å™¨ç¼“å­˜çš„å†…å­˜åŒºåŸŸæ•°æ®ï¼Œå½“å…¶ä»–å¤„ç†å™¨å›å†™å·²è¢«é”å®šçš„ç¼“å­˜è¡Œçš„æ•°æ®æ—¶ï¼Œä¼šä½¿ç¼“å­˜è¡Œæ— æ•ˆ</font>ï¼Œåœ¨å¦‚å›¾2-3æ‰€ç¤ºçš„ä¾‹å­ä¸­ï¼Œå½“CPU1ä¿®æ”¹ç¼“å­˜è¡Œä¸­çš„iæ—¶ä½¿ç”¨äº†ç¼“å­˜é”å®šï¼Œé‚£ä¹ˆCPU2å°±ä¸èƒ½åŒæ—¶ç¼“å­˜içš„ç¼“å­˜è¡Œã€‚</p><p>ä½†æ˜¯æœ‰ä¸¤ç§æƒ…å†µä¸‹å¤„ç†å™¨ä¸ä¼šä½¿ç”¨ç¼“å­˜é”å®šï¼š</p><ul><li>ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼š<font color="DeepPink">å½“æ“ä½œçš„æ•°æ®ä¸èƒ½è¢«ç¼“å­˜åœ¨å¤„ç†å™¨å†…éƒ¨ï¼Œæˆ–æ“ä½œçš„æ•°æ®è·¨å¤šä¸ªç¼“å­˜è¡Œï¼ˆcache lineï¼‰æ—¶ï¼Œåˆ™å¤„ç†å™¨ä¼šè°ƒç”¨æ€»çº¿é”å®šã€‚</font></li><li>ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼š<font color="DeepPink">æœ‰äº›å¤„ç†å™¨ä¸æ”¯æŒç¼“å­˜é”å®šã€‚å¯¹äºIntel 486å’ŒPentiumå¤„ç†å™¨ï¼Œå°±ç®—é”å®šçš„å†…å­˜åŒºåŸŸåœ¨å¤„ç†å™¨çš„ç¼“å­˜è¡Œä¸­ä¹Ÿä¼šè°ƒç”¨æ€»çº¿é”å®šã€‚</font>é’ˆå¯¹ä»¥ä¸Šä¸¤ä¸ªæœºåˆ¶ï¼Œæˆ‘ä»¬é€šè¿‡Intelå¤„ç†å™¨æä¾›äº†å¾ˆå¤šLockå‰ç¼€çš„æŒ‡ä»¤æ¥å®ç°ã€‚ä¾‹å¦‚ï¼Œä½æµ‹è¯•å’Œä¿®æ”¹æŒ‡ä»¤ï¼šBTSã€BTRã€BTCï¼›äº¤æ¢æŒ‡ä»¤XADDã€CMPXCHGï¼Œä»¥åŠå…¶ä»–ä¸€äº›æ“ä½œæ•°å’Œé€»è¾‘æŒ‡ä»¤ï¼ˆå¦‚ADDã€ORï¼‰ç­‰ï¼Œè¢«è¿™äº›æŒ‡ä»¤æ“ä½œçš„å†…å­˜åŒºåŸŸå°±ä¼šåŠ é”ï¼Œå¯¼è‡´å…¶ä»–å¤„ç†å™¨ä¸èƒ½åŒæ—¶è®¿é—®å®ƒã€‚</li></ul><blockquote><p>Intelæ–‡æ¡£çš„2961é¡µ 8.1.4 Effects of a LOCK Operation on Internal Processor Caches</p></blockquote><h1 id="Javaå¦‚ä½•å®ç°åŸå­æ“ä½œ"><a href="#Javaå¦‚ä½•å®ç°åŸå­æ“ä½œ" class="headerlink" title="Javaå¦‚ä½•å®ç°åŸå­æ“ä½œ"></a>Javaå¦‚ä½•å®ç°åŸå­æ“ä½œ</h1><p>åœ¨Javaä¸­å¯ä»¥é€šè¿‡é”å’Œå¾ªç¯CASçš„æ–¹å¼æ¥å®ç°åŸå­æ“ä½œã€‚</p><h2 id="ä½¿ç”¨å¾ªç¯CASå®ç°åŸå­æ“ä½œ"><a href="#ä½¿ç”¨å¾ªç¯CASå®ç°åŸå­æ“ä½œ" class="headerlink" title="ä½¿ç”¨å¾ªç¯CASå®ç°åŸå­æ“ä½œ"></a>ä½¿ç”¨å¾ªç¯CASå®ç°åŸå­æ“ä½œ</h2><p>JVMä¸­çš„CASæ“ä½œæ­£æ˜¯åˆ©ç”¨äº†å¤„ç†å™¨æä¾›çš„CMPXCHG(Compare and Exchange)æŒ‡ä»¤å®ç°çš„ã€‚è‡ªæ—‹CASå®ç°çš„åŸºæœ¬æ€è·¯å°±æ˜¯å¾ªç¯è¿›è¡ŒCASæ“ä½œç›´åˆ°æˆåŠŸä¸ºæ­¢ï¼Œä»¥ä¸‹ä»£ç å®ç°äº†ä¸€ä¸ªåŸºäºCASçº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨æ–¹æ³•safeCountå’Œä¸€ä¸ªéçº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨countã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">private AtomicInteger atomicI = new AtomicInteger(0);</span><br><span class="line">private int i = 0;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    final Counter cas = new Counter();</span><br><span class="line">    List&lt;Thread&gt; ts = new ArrayList&lt;Thread&gt;(600);</span><br><span class="line">    long start = System.currentTimeMillis();</span><br><span class="line">    for (int j = 0; j &lt; 100; j++) &#123;</span><br><span class="line">        Thread t = new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                for (int i = 0; i &lt; 10000; i++) &#123;</span><br><span class="line">                    cas.count();</span><br><span class="line">                    cas.safeCount();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ts.add(t);</span><br><span class="line">    &#125;</span><br><span class="line">    for (Thread t : ts) &#123;</span><br><span class="line">        t.start();</span><br><span class="line">    &#125;</span><br><span class="line">    // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæˆ</span><br><span class="line">    for (Thread t : ts) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            t.join();</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(cas.i);</span><br><span class="line">    System.out.println(cas.atomicI.get());</span><br><span class="line">    System.out.println(System.currentTimeMillis() - start);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ä½¿ç”¨CASå®ç°çº¿ç¨‹å®‰å…¨è®¡æ•°å™¨</span><br><span class="line"> */</span><br><span class="line">private void safeCount() &#123;</span><br><span class="line">    for (; ; ) &#123;</span><br><span class="line">        int i = atomicI.get();</span><br><span class="line">        boolean suc = atomicI.compareAndSet(i, ++i);</span><br><span class="line">        if (suc) &#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * éçº¿ç¨‹å®‰å…¨è®¡æ•°å™¨</span><br><span class="line"> */</span><br><span class="line">private void count() &#123;</span><br><span class="line">    i++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»Java 1.5å¼€å§‹ï¼ŒJDKçš„å¹¶å‘åŒ…é‡Œæä¾›äº†ä¸€äº›ç±»æ¥æ”¯æŒåŸå­æ“ä½œï¼Œå¦‚AtomicBooleanï¼ˆç”¨åŸå­æ–¹å¼æ›´æ–°çš„booleanå€¼ï¼‰ã€AtomicIntegerï¼ˆç”¨åŸå­æ–¹å¼æ›´æ–°çš„intå€¼ï¼‰å’ŒAtomicLongï¼ˆç”¨åŸå­æ–¹å¼æ›´æ–°çš„longå€¼ï¼‰ã€‚è¿™äº›åŸå­åŒ…è£…ç±»è¿˜æä¾›äº†æœ‰ç”¨çš„å·¥å…·æ–¹æ³•ï¼Œæ¯”å¦‚ä»¥åŸå­çš„æ–¹å¼å°†å½“å‰å€¼è‡ªå¢1å’Œè‡ªå‡1ã€‚</p><h2 id="CASå®ç°åŸå­æ“ä½œçš„ä¸‰å¤§é—®é¢˜"><a href="#CASå®ç°åŸå­æ“ä½œçš„ä¸‰å¤§é—®é¢˜" class="headerlink" title="CASå®ç°åŸå­æ“ä½œçš„ä¸‰å¤§é—®é¢˜"></a>CASå®ç°åŸå­æ“ä½œçš„ä¸‰å¤§é—®é¢˜</h2><p>åœ¨Javaå¹¶å‘åŒ…ä¸­æœ‰ä¸€äº›å¹¶å‘æ¡†æ¶ä¹Ÿä½¿ç”¨äº†è‡ªæ—‹CASçš„æ–¹å¼æ¥å®ç°åŸå­æ“ä½œï¼Œæ¯”å¦‚LinkedTransferQueueç±»çš„Xferæ–¹æ³•ã€‚CASè™½ç„¶å¾ˆé«˜æ•ˆåœ°è§£å†³äº†åŸå­æ“ä½œï¼Œä½†æ˜¯CASä»ç„¶å­˜åœ¨ä¸‰å¤§é—®é¢˜ã€‚ABAé—®é¢˜ï¼Œå¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§ï¼Œä»¥åŠåªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œã€‚</p><ol><li><font color="DeepPink">ABAé—®é¢˜</font>ã€‚å› ä¸ºCASéœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™ï¼Œæ£€æŸ¥å€¼æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–åˆ™æ›´æ–°ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªå€¼åŸæ¥æ˜¯Aï¼Œå˜æˆäº†Bï¼Œåˆå˜æˆäº†Aï¼Œé‚£ä¹ˆä½¿ç”¨CASè¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘ç°å®ƒçš„å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šå´å˜åŒ–äº†ã€‚ABAé—®é¢˜çš„è§£å†³æ€è·¯å°±æ˜¯ä½¿ç”¨ç‰ˆæœ¬å·ã€‚<font color="DeepPink">åœ¨å˜é‡å‰é¢è¿½åŠ ä¸Šç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™æŠŠç‰ˆæœ¬å·åŠ 1</font>ï¼Œé‚£ä¹ˆAâ†’Bâ†’Aå°±ä¼šå˜æˆ1Aâ†’2Bâ†’3Aã€‚ä»Java 1.5å¼€å§‹ï¼ŒJDKçš„AtomicåŒ…é‡Œæä¾›äº†ä¸€ä¸ªç±»AtomicStampedReferenceæ¥è§£å†³ABAé—®é¢˜ã€‚è¿™ä¸ªç±»çš„compareAndSetæ–¹æ³•çš„ä½œç”¨æ˜¯é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨æ˜¯å¦ç­‰äºé¢„æœŸå¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥å½“å‰æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå¦‚æœå…¨éƒ¨ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å¼•ç”¨å’Œè¯¥æ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public boolean compareAndSet(</span><br><span class="line">V expectedReference, // é¢„æœŸå¼•ç”¨</span><br><span class="line">V newReference, // æ›´æ–°åçš„å¼•ç”¨</span><br><span class="line">int expectedStamp, // é¢„æœŸæ ‡å¿—</span><br><span class="line">int newStamp // æ›´æ–°åçš„æ ‡å¿—</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ol start="2"><li><p><font color="DeepPink">å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</font>ã€‚è‡ªæ—‹CASå¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚å¦‚æœJVMèƒ½æ”¯æŒå¤„ç†å™¨æä¾›çš„pauseæŒ‡ä»¤ï¼Œé‚£ä¹ˆæ•ˆç‡ä¼šæœ‰ä¸€å®šçš„æå‡ã€‚pauseæŒ‡ä»¤æœ‰ä¸¤ä¸ªä½œç”¨ï¼šç¬¬ä¸€ï¼Œå®ƒå¯ä»¥å»¶è¿Ÿæµæ°´çº¿æ‰§è¡ŒæŒ‡ä»¤ï¼ˆde-pipelineï¼‰ï¼Œä½¿CPUä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„æ‰§è¡Œèµ„æºï¼Œå»¶è¿Ÿçš„æ—¶é—´å–å†³äºå…·ä½“å®ç°çš„ç‰ˆæœ¬ï¼Œåœ¨ä¸€äº›å¤„ç†å™¨ä¸Šå»¶è¿Ÿæ—¶é—´æ˜¯é›¶ï¼›ç¬¬äºŒï¼Œå®ƒå¯ä»¥é¿å…åœ¨é€€å‡ºå¾ªç¯çš„æ—¶å€™å› å†…å­˜é¡ºåºå†²çªï¼ˆMemory Order Violationï¼‰è€Œå¼•èµ·CPUæµæ°´çº¿è¢«æ¸…ç©ºï¼ˆCPU Pipeline Flushï¼‰ï¼Œä»è€Œæé«˜CPUçš„æ‰§è¡Œæ•ˆç‡ã€‚</p></li><li><p><font color="DeepPink">åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</font>ã€‚å½“å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¾ªç¯CASçš„æ–¹å¼æ¥ä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼Œå¾ªç¯CASå°±æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨é”ã€‚è¿˜æœ‰ä¸€ä¸ªå–å·§çš„åŠæ³•ï¼Œå°±æ˜¯æŠŠå¤šä¸ªå…±äº«å˜é‡åˆå¹¶æˆä¸€ä¸ªå…±äº«å˜é‡æ¥æ“ä½œã€‚æ¯”å¦‚ï¼Œæœ‰ä¸¤ä¸ªå…±äº«å˜é‡iï¼2ï¼Œj=aï¼Œåˆå¹¶ä¸€ä¸‹ij=2aï¼Œç„¶åç”¨CASæ¥æ“ä½œijã€‚ä»Java 1.5å¼€å§‹ï¼ŒJDKæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œå°±å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡ŒCASæ“ä½œã€‚</p></li></ol><h2 id="ä½¿ç”¨é”æœºåˆ¶å®ç°åŸå­æ“ä½œ"><a href="#ä½¿ç”¨é”æœºåˆ¶å®ç°åŸå­æ“ä½œ" class="headerlink" title="ä½¿ç”¨é”æœºåˆ¶å®ç°åŸå­æ“ä½œ"></a>ä½¿ç”¨é”æœºåˆ¶å®ç°åŸå­æ“ä½œ</h2><p>é”æœºåˆ¶ä¿è¯äº†åªæœ‰è·å¾—é”çš„çº¿ç¨‹æ‰èƒ½å¤Ÿæ“ä½œé”å®šçš„å†…å­˜åŒºåŸŸã€‚JVMå†…éƒ¨å®ç°äº†å¾ˆå¤šç§é”æœºåˆ¶ï¼Œæœ‰åå‘é”ã€è½»é‡çº§é”å’Œäº’æ–¥é”ã€‚æœ‰æ„æ€çš„æ˜¯é™¤äº†åå‘é”ï¼ŒJVMå®ç°é”çš„æ–¹å¼éƒ½ç”¨äº†å¾ªç¯CASï¼Œå³å½“ä¸€ä¸ªçº¿ç¨‹æƒ³è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ä½¿ç”¨å¾ªç¯CASçš„æ–¹å¼æ¥è·å–é”ï¼Œå½“å®ƒé€€å‡ºåŒæ­¥å—çš„æ—¶å€™ä½¿ç”¨å¾ªç¯CASé‡Šæ”¾é”ã€‚</p><h1 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h1><p><a href="https://github.com/jiankunking/books-recommendation/blob/master/CPU/IntelÂ®%2064%20and%20IA-32%20architectures%20software%20developerâ€™s%20manual.pdf" target="_blank" rel="noopener">IntelÂ® 64 and IA-32 architectures software developerâ€™s manual</a> </p>]]></content>
      
      
      <categories>
          
          <category> JDK </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JDK </tag>
            
            <tag> Concurrent </tag>
            
            <tag> Atomic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é˜¿é‡Œåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ Fescar è§£æ</title>
      <link href="/alibaba-seata-design.html"/>
      <url>/alibaba-seata-design.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>é€šè¿‡Fescarï¼ˆSeataï¼‰äº†è§£åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶è®¾è®¡æ€è·¯</p></blockquote><a id="more"></a><p>Fescar æ˜¯ <strong>é˜¿é‡Œå·´å·´</strong> å¼€æºçš„ <strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>ä¸­é—´ä»¶ï¼Œä»¥ <strong>é«˜æ•ˆ</strong> å¹¶ä¸”å¯¹ä¸šåŠ¡ <strong>0 ä¾µå…¥</strong> çš„æ–¹å¼ï¼Œè§£å†³ <strong>å¾®æœåŠ¡</strong> åœºæ™¯ä¸‹é¢ä¸´çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚</p><h1 id="ä»€ä¹ˆæ˜¯å¾®æœåŠ¡åŒ–å¸¦æ¥çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¾®æœåŠ¡åŒ–å¸¦æ¥çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¾®æœåŠ¡åŒ–å¸¦æ¥çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¾®æœåŠ¡åŒ–å¸¦æ¥çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Ÿ</h1><p>é¦–å…ˆï¼Œè®¾æƒ³ä¸€ä¸ªä¼ ç»Ÿçš„å•ä½“åº”ç”¨ï¼ˆMonolithic Appï¼‰ï¼Œé€šè¿‡ 3 ä¸ª Moduleï¼Œåœ¨åŒä¸€ä¸ªæ•°æ®æºä¸Šæ›´æ–°æ•°æ®æ¥å®Œæˆä¸€é¡¹ä¸šåŠ¡ã€‚</p><p>å¾ˆè‡ªç„¶çš„ï¼Œæ•´ä¸ªä¸šåŠ¡è¿‡ç¨‹çš„æ•°æ®ä¸€è‡´æ€§ç”±æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯ã€‚</p><p><img alt data-src="/images/alibaba-seata-design/monolithic_architecture.png"></p><p>éšç€ä¸šåŠ¡éœ€æ±‚å’Œæ¶æ„çš„å˜åŒ–ï¼Œå•ä½“åº”ç”¨è¢«æ‹†åˆ†ä¸ºå¾®æœåŠ¡ï¼šåŸæ¥çš„ 3 ä¸ª Module è¢«æ‹†åˆ†ä¸º 3 ä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼Œåˆ†åˆ«ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®æºï¼ˆ<a href="http://microservices.io/patterns/data/database-per-service.html" target="_blank" rel="noopener">Pattern: Database per service</a>ï¼‰ã€‚ä¸šåŠ¡è¿‡ç¨‹å°†ç”± 3 ä¸ªæœåŠ¡çš„è°ƒç”¨æ¥å®Œæˆã€‚</p><p><img alt data-src="/images/alibaba-seata-design/microservices_architecture.png"></p><p>æ­¤æ—¶ï¼Œæ¯ä¸€ä¸ªæœåŠ¡å†…éƒ¨çš„æ•°æ®ä¸€è‡´æ€§ä»ç”±æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯ã€‚è€Œæ•´ä¸ªä¸šåŠ¡å±‚é¢çš„å…¨å±€æ•°æ®ä¸€è‡´æ€§è¦å¦‚ä½•ä¿éšœå‘¢ï¼Ÿè¿™å°±æ˜¯å¾®æœåŠ¡æ¶æ„ä¸‹é¢ä¸´çš„ï¼Œå…¸å‹çš„åˆ†å¸ƒå¼äº‹åŠ¡éœ€æ±‚ï¼šæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆä¿éšœä¸šåŠ¡å…¨å±€çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><p><img alt data-src="/images/alibaba-seata-design/fescar_solution.png"></p><h1 id="Fescar-çš„å‘å±•å†ç¨‹"><a href="#Fescar-çš„å‘å±•å†ç¨‹" class="headerlink" title="Fescar çš„å‘å±•å†ç¨‹"></a>Fescar çš„å‘å±•å†ç¨‹</h1><p>é˜¿é‡Œæ˜¯å›½å†…æœ€æ—©ä¸€æ‰¹è¿›è¡Œåº”ç”¨åˆ†å¸ƒå¼ï¼ˆå¾®æœåŠ¡åŒ–ï¼‰æ”¹é€ çš„ä¼ä¸šï¼Œæ‰€ä»¥å¾ˆæ—©å°±é‡åˆ°å¾®æœåŠ¡æ¶æ„ä¸‹çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚</p><p>2014 å¹´ï¼Œé˜¿é‡Œä¸­é—´ä»¶å›¢é˜Ÿå‘å¸ƒ <strong>TXCï¼ˆTaobao Transaction Constructorï¼‰</strong>ï¼Œä¸ºé›†å›¢å†…åº”ç”¨æä¾›åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚</p><p>2016 å¹´ï¼ŒTXC ç»è¿‡äº§å“åŒ–æ”¹é€ ï¼Œä»¥ <strong>GTSï¼ˆGlobal Transaction Serviceï¼‰</strong> çš„èº«ä»½ç™»é™†é˜¿é‡Œäº‘ï¼Œæˆä¸ºå½“æ—¶ä¸šç•Œå”¯ä¸€ä¸€æ¬¾äº‘ä¸Šåˆ†å¸ƒå¼äº‹åŠ¡äº§å“ï¼Œåœ¨é˜¿äº‘é‡Œçš„å…¬æœ‰äº‘ã€ä¸“æœ‰äº‘è§£å†³æ–¹æ¡ˆä¸­ï¼Œå¼€å§‹æœåŠ¡äºä¼—å¤šå¤–éƒ¨å®¢æˆ·ã€‚</p><p>2019 å¹´èµ·ï¼ŒåŸºäº TXC å’Œ GTS çš„æŠ€æœ¯ç§¯ç´¯ï¼Œé˜¿é‡Œä¸­é—´ä»¶å›¢é˜Ÿå‘èµ·äº†å¼€æºé¡¹ç›® <strong>Fescarï¼ˆFast &amp; EaSy Commit And Rollback, FESCARï¼‰</strong>ï¼Œå’Œç¤¾åŒºä¸€èµ·å»ºè®¾è¿™ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</p><p>TXC/GTS/Fescar ä¸€è„‰ç›¸æ‰¿ï¼Œä¸ºè§£å†³å¾®æœåŠ¡æ¶æ„ä¸‹çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜äº¤å‡ºäº†ä¸€ä»½ä¸ä¼—ä¸åŒçš„ç­”å·ã€‚</p><h2 id="è®¾è®¡åˆè¡·"><a href="#è®¾è®¡åˆè¡·" class="headerlink" title="è®¾è®¡åˆè¡·"></a>è®¾è®¡åˆè¡·</h2><p>é«˜é€Ÿå¢é•¿çš„äº’è”ç½‘æ—¶ä»£ï¼Œ<strong>å¿«é€Ÿè¯•é”™</strong> çš„èƒ½åŠ›å¯¹ä¸šåŠ¡æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ï¼š</p><ul><li>ä¸€æ–¹é¢ï¼Œä¸åº”è¯¥å› ä¸ºæŠ€æœ¯æ¶æ„ä¸Šçš„å¾®æœåŠ¡åŒ–å’Œåˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒçš„å¼•å…¥ï¼Œç»™ä¸šåŠ¡å±‚é¢å¸¦æ¥é¢å¤–çš„ç ”å‘è´Ÿæ‹…ã€‚</li><li>å¦ä¸€æ–¹é¢ï¼Œå¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒçš„ä¸šåŠ¡åº”è¯¥åŸºæœ¬ä¿æŒåœ¨åŒä¸€é‡çº§ä¸Šçš„æ€§èƒ½è¡¨ç°ï¼Œä¸èƒ½å› ä¸ºäº‹åŠ¡æœºåˆ¶æ˜¾è‘—æ‹–æ…¢ä¸šåŠ¡ã€‚</li></ul><p>åŸºäºè¿™ä¸¤ç‚¹ï¼Œæˆ‘ä»¬è®¾è®¡ä¹‹åˆçš„æœ€é‡è¦çš„è€ƒé‡å°±åœ¨äºï¼š</p><ul><li><strong>å¯¹ä¸šåŠ¡æ— ä¾µå…¥ï¼š</strong> è¿™é‡Œçš„ <strong>ä¾µå…¥</strong> æ˜¯æŒ‡ï¼Œå› ä¸ºåˆ†å¸ƒå¼äº‹åŠ¡è¿™ä¸ªæŠ€æœ¯é—®é¢˜çš„åˆ¶çº¦ï¼Œè¦æ±‚åº”ç”¨åœ¨ä¸šåŠ¡å±‚é¢è¿›è¡Œè®¾è®¡å’Œæ”¹é€ ã€‚è¿™ç§è®¾è®¡å’Œæ”¹é€ å¾€å¾€ä¼šç»™åº”ç”¨å¸¦æ¥å¾ˆé«˜çš„ç ”å‘å’Œç»´æŠ¤æˆæœ¬ã€‚æˆ‘ä»¬å¸Œæœ›æŠŠåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜åœ¨ <strong>ä¸­é—´ä»¶</strong> è¿™ä¸ªå±‚æ¬¡è§£å†³æ‰ï¼Œä¸è¦æ±‚åº”ç”¨åœ¨ä¸šåŠ¡å±‚é¢åšé¢å¤–çš„å·¥ä½œã€‚</li><li><strong>é«˜æ€§èƒ½ï¼š</strong> å¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¿éšœï¼Œå¿…ç„¶ä¼šæœ‰é¢å¤–çš„å¼€é”€ï¼Œå¼•èµ·æ€§èƒ½çš„ä¸‹é™ã€‚æˆ‘ä»¬å¸Œæœ›æŠŠåˆ†å¸ƒå¼äº‹åŠ¡å¼•å…¥çš„æ€§èƒ½æŸè€—é™åˆ°éå¸¸ä½çš„æ°´å¹³ï¼Œè®©åº”ç”¨ä¸å› ä¸ºåˆ†å¸ƒå¼äº‹åŠ¡çš„å¼•å…¥å¯¼è‡´ä¸šåŠ¡çš„å¯ç”¨æ€§å—å½±å“ã€‚</li></ul><h2 id="æ—¢æœ‰çš„è§£å†³æ–¹æ¡ˆä¸ºä»€ä¹ˆä¸æ»¡è¶³ï¼Ÿ"><a href="#æ—¢æœ‰çš„è§£å†³æ–¹æ¡ˆä¸ºä»€ä¹ˆä¸æ»¡è¶³ï¼Ÿ" class="headerlink" title="æ—¢æœ‰çš„è§£å†³æ–¹æ¡ˆä¸ºä»€ä¹ˆä¸æ»¡è¶³ï¼Ÿ"></a>æ—¢æœ‰çš„è§£å†³æ–¹æ¡ˆä¸ºä»€ä¹ˆä¸æ»¡è¶³ï¼Ÿ</h2><p>æ—¢æœ‰çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæŒ‰ç…§å¯¹ä¸šåŠ¡ä¾µå…¥æ€§åˆ†ä¸ºä¸¤ç±»ï¼Œå³ï¼šå¯¹ä¸šåŠ¡æ— ä¾µå…¥çš„å’Œå¯¹ä¸šåŠ¡æœ‰ä¾µå…¥çš„ã€‚</p><h3 id="ä¸šåŠ¡æ— ä¾µå…¥çš„æ–¹æ¡ˆ"><a href="#ä¸šåŠ¡æ— ä¾µå…¥çš„æ–¹æ¡ˆ" class="headerlink" title="ä¸šåŠ¡æ— ä¾µå…¥çš„æ–¹æ¡ˆ"></a>ä¸šåŠ¡æ— ä¾µå…¥çš„æ–¹æ¡ˆ</h3><p>æ—¢æœ‰çš„ä¸»æµåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆä¸­ï¼Œå¯¹ä¸šåŠ¡æ— ä¾µå…¥çš„åªæœ‰åŸºäº XA çš„æ–¹æ¡ˆï¼Œä½†åº”ç”¨ XA æ–¹æ¡ˆå­˜åœ¨ 3 ä¸ªæ–¹é¢çš„é—®é¢˜ï¼š</p><ol><li>è¦æ±‚æ•°æ®åº“æä¾›å¯¹ XA çš„æ”¯æŒã€‚å¦‚æœé‡åˆ°ä¸æ”¯æŒ XAï¼ˆæˆ–æ”¯æŒå¾—ä¸å¥½ï¼Œæ¯”å¦‚ MySQL 5.7 ä»¥å‰çš„ç‰ˆæœ¬ï¼‰çš„æ•°æ®åº“ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨ã€‚</li><li>å—åè®®æœ¬èº«çš„çº¦æŸï¼Œäº‹åŠ¡èµ„æºï¼ˆæ•°æ®è®°å½•ã€æ•°æ®åº“è¿æ¥ï¼‰çš„é”å®šå‘¨æœŸé•¿ã€‚é•¿å‘¨æœŸçš„èµ„æºé”å®šä»ä¸šåŠ¡å±‚é¢æ¥çœ‹ï¼Œå¾€å¾€æ˜¯ä¸å¿…è¦çš„ï¼Œè€Œå› ä¸ºäº‹åŠ¡èµ„æºçš„ç®¡ç†å™¨æ˜¯æ•°æ®åº“æœ¬èº«ï¼Œåº”ç”¨å±‚æ— æ³•æ’æ‰‹ã€‚è¿™æ ·å½¢æˆçš„å±€é¢å°±æ˜¯ï¼ŒåŸºäº XA çš„åº”ç”¨å¾€å¾€æ€§èƒ½ä¼šæ¯”è¾ƒå·®ï¼Œè€Œä¸”å¾ˆéš¾ä¼˜åŒ–ã€‚</li><li>å·²ç»è½åœ°çš„åŸºäº XA çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œéƒ½ä¾æ‰˜äºé‡é‡çº§çš„åº”ç”¨æœåŠ¡å™¨ï¼ˆTuxedo/WebLogic/WebSphere ç­‰)ï¼Œè¿™æ˜¯ä¸é€‚ç”¨äºå¾®æœåŠ¡æ¶æ„çš„ã€‚</li></ol><h3 id="ä¾µå…¥ä¸šåŠ¡çš„æ–¹æ¡ˆ"><a href="#ä¾µå…¥ä¸šåŠ¡çš„æ–¹æ¡ˆ" class="headerlink" title="ä¾µå…¥ä¸šåŠ¡çš„æ–¹æ¡ˆ"></a>ä¾µå…¥ä¸šåŠ¡çš„æ–¹æ¡ˆ</h3><p>å®é™…ä¸Šï¼Œæœ€åˆåˆ†å¸ƒå¼äº‹åŠ¡åªæœ‰ XA è¿™ä¸ªå”¯ä¸€æ–¹æ¡ˆã€‚XA æ˜¯å®Œå¤‡çš„ï¼Œä½†åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œç”±äºç§ç§åŸå› ï¼ˆåŒ…å«ä½†ä¸é™äºä¸Šé¢æåˆ°çš„ 3 ç‚¹ï¼‰å¾€å¾€ä¸å¾—ä¸æ”¾å¼ƒï¼Œè½¬è€Œä»ä¸šåŠ¡å±‚é¢ç€æ‰‹æ¥è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚æ¯”å¦‚ï¼š</p><ul><li>åŸºäºå¯é æ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ</li><li>TCC</li><li>Saga </li></ul><p>éƒ½å±äºè¿™ä¸€ç±»ã€‚è¿™äº›æ–¹æ¡ˆçš„å…·ä½“æœºåˆ¶åœ¨è¿™é‡Œä¸åšå±•å¼€ï¼Œç½‘ä¸Šè¿™æ–¹é¢çš„è®ºè¿°æ–‡ç« éå¸¸å¤šã€‚æ€»ä¹‹ï¼Œè¿™äº›æ–¹æ¡ˆéƒ½è¦æ±‚åœ¨åº”ç”¨çš„ä¸šåŠ¡å±‚é¢æŠŠåˆ†å¸ƒå¼äº‹åŠ¡æŠ€æœ¯çº¦æŸè€ƒè™‘åˆ°è®¾è®¡ä¸­ï¼Œé€šå¸¸æ¯ä¸€ä¸ªæœåŠ¡éƒ½éœ€è¦è®¾è®¡å®ç°æ­£å‘å’Œåå‘çš„å¹‚ç­‰æ¥å£ã€‚è¿™æ ·çš„è®¾è®¡çº¦æŸï¼Œå¾€å¾€ä¼šå¯¼è‡´å¾ˆé«˜çš„ç ”å‘å’Œç»´æŠ¤æˆæœ¬ã€‚</p><h2 id="ç†æƒ³çš„æ–¹æ¡ˆåº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ"><a href="#ç†æƒ³çš„æ–¹æ¡ˆåº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ" class="headerlink" title="ç†æƒ³çš„æ–¹æ¡ˆåº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ"></a>ç†æƒ³çš„æ–¹æ¡ˆåº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ</h2><p>ä¸å¯å¦è®¤ï¼Œä¾µå…¥ä¸šåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆéƒ½ç»è¿‡å¤§é‡å®è·µéªŒè¯ï¼Œèƒ½æœ‰æ•ˆè§£å†³é—®é¢˜ï¼Œåœ¨å„è¡Œå„ä¸šçš„ä¸šåŠ¡åº”ç”¨ç³»ç»Ÿä¸­èµ·ç€é‡è¦ä½œç”¨ã€‚ä½†å›åˆ°åŸç‚¹æ¥æ€è€ƒï¼Œè¿™äº›æ–¹æ¡ˆçš„é‡‡ç”¨å®é™…ä¸Šéƒ½æ˜¯ <strong>è¿«äºæ— å¥ˆ</strong>ã€‚è®¾æƒ³ï¼Œå¦‚æœåŸºäº XA çš„æ–¹æ¡ˆèƒ½å¤Ÿä¸é‚£ä¹ˆ <strong>é‡</strong>ï¼Œå¹¶ä¸”èƒ½ä¿è¯ä¸šåŠ¡çš„æ€§èƒ½éœ€æ±‚ï¼Œç›¸ä¿¡ä¸ä¼šæœ‰äººæ„¿æ„æŠŠåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜æ‹¿åˆ°ä¸šåŠ¡å±‚é¢æ¥è§£å†³ã€‚</p><p>ä¸€ä¸ªç†æƒ³çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆåº”è¯¥ï¼šåƒä½¿ç”¨ <strong>æœ¬åœ°äº‹åŠ¡</strong> ä¸€æ ·ç®€å•ï¼Œä¸šåŠ¡é€»è¾‘åªå…³æ³¨ä¸šåŠ¡å±‚é¢çš„éœ€æ±‚ï¼Œä¸éœ€è¦è€ƒè™‘äº‹åŠ¡æœºåˆ¶ä¸Šçš„çº¦æŸã€‚</p><h1 id="åŸç†å’Œè®¾è®¡"><a href="#åŸç†å’Œè®¾è®¡" class="headerlink" title="åŸç†å’Œè®¾è®¡"></a>åŸç†å’Œè®¾è®¡</h1><p>æˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ªå¯¹ä¸šåŠ¡æ— ä¾µå…¥çš„æ–¹æ¡ˆï¼Œæ‰€ä»¥ä»ä¸šåŠ¡æ— ä¾µå…¥çš„ XA æ–¹æ¡ˆæ¥æ€è€ƒï¼š</p><p>æ˜¯å¦å¯ä»¥åœ¨ XA çš„åŸºç¡€ä¸Šæ¼”è¿›ï¼Œè§£å†³æ‰ XA æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜å‘¢ï¼Ÿ</p><h2 id="å¦‚ä½•å®šä¹‰ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ"><a href="#å¦‚ä½•å®šä¹‰ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®šä¹‰ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ"></a>å¦‚ä½•å®šä¹‰ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ</h2><p>é¦–å…ˆï¼Œå¾ˆè‡ªç„¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ç†è§£æˆä¸€ä¸ªåŒ…å«äº†è‹¥å¹² <strong>åˆ†æ”¯äº‹åŠ¡</strong> çš„ <strong>å…¨å±€äº‹åŠ¡</strong>ã€‚<strong>å…¨å±€äº‹åŠ¡</strong> çš„èŒè´£æ˜¯åè°ƒå…¶ä¸‹ç®¡è¾–çš„ <strong>åˆ†æ”¯äº‹åŠ¡</strong> è¾¾æˆä¸€è‡´ï¼Œè¦ä¹ˆä¸€èµ·æˆåŠŸæäº¤ï¼Œè¦ä¹ˆä¸€èµ·å¤±è´¥å›æ»šã€‚æ­¤å¤–ï¼Œé€šå¸¸ <strong>åˆ†æ”¯äº‹åŠ¡</strong> æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ»¡è¶³ ACID çš„ <strong>æœ¬åœ°äº‹åŠ¡</strong>ã€‚è¿™æ˜¯æˆ‘ä»¬å¯¹åˆ†å¸ƒå¼äº‹åŠ¡ç»“æ„çš„åŸºæœ¬è®¤è¯†ï¼Œä¸ XA æ˜¯ä¸€è‡´çš„ã€‚</p><p><img alt data-src="/images/alibaba-seata-design/global_branch_transaction.png"></p><p>å…¶æ¬¡ï¼Œä¸ XA çš„æ¨¡å‹ç±»ä¼¼ï¼Œæˆ‘ä»¬å®šä¹‰ 3 ä¸ªç»„ä»¶æ¥åè®®åˆ†å¸ƒå¼äº‹åŠ¡çš„å¤„ç†è¿‡ç¨‹ã€‚</p><p><img alt data-src="/images/alibaba-seata-design/fescar_model.png"></p><ul><li><strong>Transaction Coordinator (TC)ï¼š</strong> äº‹åŠ¡åè°ƒå™¨ï¼Œç»´æŠ¤å…¨å±€äº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œè´Ÿè´£åè°ƒå¹¶é©±åŠ¨å…¨å±€äº‹åŠ¡çš„æäº¤æˆ–å›æ»šã€‚</li><li><strong>Transaction Manager (TM)ï¼š</strong> æ§åˆ¶å…¨å±€äº‹åŠ¡çš„è¾¹ç•Œï¼Œè´Ÿè´£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå¹¶æœ€ç»ˆå‘èµ·å…¨å±€æäº¤æˆ–å…¨å±€å›æ»šçš„å†³è®®ã€‚</li><li><strong>Resource Manager (RM)ï¼š</strong> æ§åˆ¶åˆ†æ”¯äº‹åŠ¡ï¼Œè´Ÿè´£åˆ†æ”¯æ³¨å†Œã€çŠ¶æ€æ±‡æŠ¥ï¼Œå¹¶æ¥æ”¶äº‹åŠ¡åè°ƒå™¨çš„æŒ‡ä»¤ï¼Œé©±åŠ¨åˆ†æ”¯ï¼ˆæœ¬åœ°ï¼‰äº‹åŠ¡çš„æäº¤å’Œå›æ»šã€‚</li></ul><p>ä¸€ä¸ªå…¸å‹çš„åˆ†å¸ƒå¼äº‹åŠ¡è¿‡ç¨‹ï¼š</p><ol><li>TM å‘ TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ XIDã€‚</li><li>XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ã€‚</li><li>RM å‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾–ã€‚ </li><li>TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®®ã€‚</li><li>TC è°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ã€‚</li></ol><p><img alt data-src="/images/alibaba-seata-design/architecture.png"></p><p>è‡³æ­¤ï¼ŒFescar çš„åè®®æœºåˆ¶æ€»ä½“ä¸Šçœ‹ä¸ XA æ˜¯ä¸€è‡´çš„ã€‚</p><h3 id="ä¸-XA-çš„å·®åˆ«åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ"><a href="#ä¸-XA-çš„å·®åˆ«åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ" class="headerlink" title="ä¸ XA çš„å·®åˆ«åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ"></a>ä¸ XA çš„å·®åˆ«åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ</h3><h4 id="æ¶æ„å±‚æ¬¡"><a href="#æ¶æ„å±‚æ¬¡" class="headerlink" title="æ¶æ„å±‚æ¬¡"></a>æ¶æ„å±‚æ¬¡</h4><p><img alt data-src="/images/alibaba-seata-design/rm_in_architecture.png"></p><p>XA æ–¹æ¡ˆçš„ RM å®é™…ä¸Šæ˜¯åœ¨æ•°æ®åº“å±‚ï¼ŒRM æœ¬è´¨ä¸Šå°±æ˜¯æ•°æ®åº“è‡ªèº«ï¼ˆé€šè¿‡æä¾›æ”¯æŒ XA çš„é©±åŠ¨ç¨‹åºæ¥ä¾›åº”ç”¨ä½¿ç”¨ï¼‰ã€‚</p><p>è€Œ <font color="DeepPink">Fescar çš„ RM æ˜¯ä»¥äºŒæ–¹åŒ…çš„å½¢å¼ä½œä¸ºä¸­é—´ä»¶å±‚éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºè¿™ä¸€ä¾§çš„ï¼Œä¸ä¾èµ–ä¸æ•°æ®åº“æœ¬èº«å¯¹åè®®çš„æ”¯æŒï¼Œå½“ç„¶ä¹Ÿä¸éœ€è¦æ•°æ®åº“æ”¯æŒ XA åè®®ã€‚</font>è¿™ç‚¹å¯¹äºå¾®æœåŠ¡åŒ–çš„æ¶æ„æ¥è¯´æ˜¯éå¸¸é‡è¦çš„ï¼šåº”ç”¨å±‚ä¸éœ€è¦ä¸ºæœ¬åœ°äº‹åŠ¡å’Œåˆ†å¸ƒå¼äº‹åŠ¡ä¸¤ç±»ä¸åŒåœºæ™¯æ¥é€‚é…ä¸¤å¥—ä¸åŒçš„æ•°æ®åº“é©±åŠ¨ã€‚</p><p>è¿™ä¸ªè®¾è®¡ï¼Œå‰¥ç¦»äº†åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆå¯¹æ•°æ®åº“åœ¨ <strong>åè®®æ”¯æŒ</strong> ä¸Šçš„è¦æ±‚ã€‚</p><h4 id="ä¸¤é˜¶æ®µæäº¤"><a href="#ä¸¤é˜¶æ®µæäº¤" class="headerlink" title="ä¸¤é˜¶æ®µæäº¤"></a>ä¸¤é˜¶æ®µæäº¤</h4><p>å…ˆæ¥çœ‹ä¸€ä¸‹ XA çš„ 2PC è¿‡ç¨‹ã€‚</p><p><img alt data-src="/images/alibaba-seata-design/xa_2pc.png"></p><p>æ— è®º Phase2 çš„å†³è®®æ˜¯ commit è¿˜æ˜¯ rollbackï¼Œäº‹åŠ¡æ€§èµ„æºçš„é”éƒ½è¦ä¿æŒåˆ° Phase2 å®Œæˆæ‰é‡Šæ”¾ã€‚</p><p>è®¾æƒ³ä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„ä¸šåŠ¡ï¼Œå¤§æ¦‚ç‡æ˜¯ 90% ä»¥ä¸Šçš„äº‹åŠ¡æœ€ç»ˆåº”è¯¥æ˜¯æˆåŠŸæäº¤çš„ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥åœ¨ Phase1 å°±å°†æœ¬åœ°äº‹åŠ¡æäº¤å‘¢ï¼Ÿè¿™æ · 90% ä»¥ä¸Šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥çœå» Phase2 æŒé”çš„æ—¶é—´ï¼Œæ•´ä½“æé«˜æ•ˆç‡ã€‚</p><p><img alt data-src="/images/alibaba-seata-design/seata_2pc.png"></p><ul><li>åˆ†æ”¯äº‹åŠ¡ä¸­æ•°æ®çš„ <strong>æœ¬åœ°é”</strong> ç”±æœ¬åœ°äº‹åŠ¡ç®¡ç†ï¼Œåœ¨åˆ†æ”¯äº‹åŠ¡ Phase1 ç»“æŸæ—¶é‡Šæ”¾ã€‚</li><li>åŒæ—¶ï¼Œéšç€æœ¬åœ°äº‹åŠ¡ç»“æŸï¼Œ<strong>è¿æ¥</strong> ä¹Ÿå¾—ä»¥é‡Šæ”¾ã€‚</li><li>åˆ†æ”¯äº‹åŠ¡ä¸­æ•°æ®çš„ <strong>å…¨å±€é”</strong> åœ¨äº‹åŠ¡åè°ƒå™¨ä¾§ç®¡ç†ï¼Œåœ¨å†³è®® Phase2 å…¨å±€æäº¤æ—¶ï¼Œå…¨å±€é”é©¬ä¸Šå¯ä»¥é‡Šæ”¾ã€‚åªæœ‰åœ¨å†³è®®å…¨å±€å›æ»šçš„æƒ…å†µä¸‹ï¼Œ<strong>å…¨å±€é”</strong> æ‰è¢«æŒæœ‰è‡³åˆ†æ”¯çš„ Phase2 ç»“æŸã€‚</li></ul><p>è¿™ä¸ªè®¾è®¡ï¼Œæå¤§åœ°å‡å°‘äº†åˆ†æ”¯äº‹åŠ¡å¯¹èµ„æºï¼ˆæ•°æ®å’Œè¿æ¥ï¼‰çš„é”å®šæ—¶é—´ï¼Œç»™æ•´ä½“å¹¶å‘å’Œååçš„æå‡æä¾›äº†åŸºç¡€ã€‚</p><p>å½“ç„¶ï¼Œä½ è‚¯å®šä¼šé—®ï¼šPhase1 å³æäº¤çš„æƒ…å†µä¸‹ï¼ŒPhase2 å¦‚ä½•å›æ»šå‘¢ï¼Ÿ</p><h2 id="åˆ†æ”¯äº‹åŠ¡å¦‚ä½•æäº¤å’Œå›æ»šï¼Ÿ"><a href="#åˆ†æ”¯äº‹åŠ¡å¦‚ä½•æäº¤å’Œå›æ»šï¼Ÿ" class="headerlink" title="åˆ†æ”¯äº‹åŠ¡å¦‚ä½•æäº¤å’Œå›æ»šï¼Ÿ"></a>åˆ†æ”¯äº‹åŠ¡å¦‚ä½•æäº¤å’Œå›æ»šï¼Ÿ</h2><p>é¦–å…ˆï¼Œ<font color="DeepPink">åº”ç”¨éœ€è¦ä½¿ç”¨ Fescar çš„ JDBC æ•°æ®æºä»£ç†ï¼Œä¹Ÿå°±æ˜¯ Fescar çš„ RMã€‚</font></p><p><img alt data-src="/images/alibaba-seata-design/data_sourc_proxy.png"></p><p><strong>Phase1ï¼š</strong></p><p><font color="DeepPink">Fescar çš„ JDBC æ•°æ®æºä»£ç†é€šè¿‡å¯¹ä¸šåŠ¡ SQL çš„è§£æï¼ŒæŠŠä¸šåŠ¡æ•°æ®åœ¨æ›´æ–°å‰åçš„æ•°æ®é•œåƒç»„ç»‡æˆå›æ»šæ—¥å¿—ï¼Œåˆ©ç”¨ <strong>æœ¬åœ°äº‹åŠ¡</strong> çš„ ACID ç‰¹æ€§ï¼Œå°†ä¸šåŠ¡æ•°æ®çš„æ›´æ–°å’Œå›æ»šæ—¥å¿—çš„å†™å…¥åœ¨åŒä¸€ä¸ª <strong>æœ¬åœ°äº‹åŠ¡</strong> ä¸­æäº¤ã€‚</font></p><p>è¿™æ ·ï¼Œå¯ä»¥ä¿è¯ï¼š<font color="DeepPink">ä»»ä½•æäº¤çš„ä¸šåŠ¡æ•°æ®çš„æ›´æ–°ä¸€å®šæœ‰ç›¸åº”çš„å›æ»šæ—¥å¿—å­˜åœ¨ã€‚</font></p><p><img alt data-src="/images/alibaba-seata-design/branch_transaction_with_undo_log.png"></p><p>åŸºäºè¿™æ ·çš„æœºåˆ¶ï¼Œåˆ†æ”¯çš„æœ¬åœ°äº‹åŠ¡ä¾¿å¯ä»¥åœ¨å…¨å±€äº‹åŠ¡çš„ Phase1 æäº¤ï¼Œé©¬ä¸Šé‡Šæ”¾æœ¬åœ°äº‹åŠ¡é”å®šçš„èµ„æºã€‚</p><p><strong>Phase2ï¼š</strong></p><ul><li><font color="DeepPink">å¦‚æœå†³è®®æ˜¯å…¨å±€æäº¤ï¼Œæ­¤æ—¶åˆ†æ”¯äº‹åŠ¡æ­¤æ—¶å·²ç»å®Œæˆæäº¤ï¼Œä¸éœ€è¦åŒæ­¥åè°ƒå¤„ç†ï¼ˆåªéœ€è¦å¼‚æ­¥æ¸…ç†å›æ»šæ—¥å¿—ï¼‰ï¼ŒPhase2 å¯ä»¥éå¸¸å¿«é€Ÿåœ°å®Œæˆã€‚</font></li></ul><p><img alt data-src="/images/alibaba-seata-design/global_commit.png"></p><ul><li><font color="DeepPink">å¦‚æœå†³è®®æ˜¯å…¨å±€å›æ»šï¼ŒRM æ”¶åˆ°åè°ƒå™¨å‘æ¥çš„å›æ»šè¯·æ±‚ï¼Œé€šè¿‡ XID å’Œ Branch ID æ‰¾åˆ°ç›¸åº”çš„å›æ»šæ—¥å¿—è®°å½•ï¼Œé€šè¿‡å›æ»šè®°å½•ç”Ÿæˆåå‘çš„æ›´æ–° SQL å¹¶æ‰§è¡Œï¼Œä»¥å®Œæˆåˆ†æ”¯çš„å›æ»šã€‚</font></li></ul><p><img alt data-src="/images/alibaba-seata-design/global_rollback.png"></p><h2 id="äº‹åŠ¡ä¼ æ’­æœºåˆ¶"><a href="#äº‹åŠ¡ä¼ æ’­æœºåˆ¶" class="headerlink" title="äº‹åŠ¡ä¼ æ’­æœºåˆ¶"></a>äº‹åŠ¡ä¼ æ’­æœºåˆ¶</h2><p>XID æ˜¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡çš„å”¯ä¸€æ ‡è¯†ï¼Œäº‹åŠ¡ä¼ æ’­æœºåˆ¶è¦åšçš„å°±æ˜¯æŠŠ XID åœ¨æœåŠ¡è°ƒç”¨é“¾è·¯ä¸­ä¼ é€’ä¸‹å»ï¼Œå¹¶ç»‘å®šåˆ°æœåŠ¡çš„äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™æ ·ï¼ŒæœåŠ¡é“¾è·¯ä¸­çš„æ•°æ®åº“æ›´æ–°æ“ä½œï¼Œå°±éƒ½ä¼šå‘è¯¥ XID ä»£è¡¨çš„å…¨å±€äº‹åŠ¡æ³¨å†Œåˆ†æ”¯ï¼Œçº³å…¥åŒä¸€ä¸ªå…¨å±€äº‹åŠ¡çš„ç®¡è¾–ã€‚</p><p>åŸºäºè¿™ä¸ªæœºåˆ¶ï¼ŒFescar æ˜¯å¯ä»¥æ”¯æŒä»»ä½•å¾®æœåŠ¡ RPC æ¡†æ¶çš„ã€‚åªè¦åœ¨ç‰¹å®šæ¡†æ¶ä¸­æ‰¾åˆ°å¯ä»¥é€æ˜ä¼ æ’­ XID çš„æœºåˆ¶å³å¯ï¼Œæ¯”å¦‚ï¼ŒDubbo çš„ Filter + RpcContextã€‚</p><p>å¯¹åº”åˆ° Java EE è§„èŒƒå’Œ Spring å®šä¹‰çš„äº‹åŠ¡ä¼ æ’­å±æ€§ï¼ŒFescar çš„æ”¯æŒå¦‚ä¸‹ï¼š</p><ul><li><strong>PROPAGATION_REQUIREDï¼š</strong> é»˜è®¤æ”¯æŒ</li><li><strong>PROPAGATION_SUPPORTSï¼š</strong> é»˜è®¤æ”¯æŒ</li><li>PROPAGATION_MANDATORYï¼šåº”ç”¨é€šè¿‡ API æ¥å®ç°</li><li>PROPAGATION_REQUIRES_NEWï¼šåº”ç”¨é€šè¿‡ API æ¥å®ç°</li><li>PROPAGATION_NOT_SUPPORTEDï¼šåº”ç”¨é€šè¿‡ API æ¥å®ç°</li><li>PROPAGATION_NEVERï¼šåº”ç”¨é€šè¿‡ API æ¥å®ç°</li><li>PROPAGATION_NESTEDï¼šä¸æ”¯æŒ</li></ul><h2 id="éš”ç¦»æ€§"><a href="#éš”ç¦»æ€§" class="headerlink" title="éš”ç¦»æ€§"></a>éš”ç¦»æ€§</h2><p>å…¨å±€äº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯å»ºç«‹åœ¨åˆ†æ”¯äº‹åŠ¡çš„æœ¬åœ°éš”ç¦»çº§åˆ«åŸºç¡€ä¹‹ä¸Šçš„ã€‚</p><p>åœ¨æ•°æ®åº“æœ¬åœ°éš”ç¦»çº§åˆ« <strong>è¯»å·²æäº¤</strong> æˆ–ä»¥ä¸Šçš„å‰æä¸‹ï¼ŒFescar è®¾è®¡äº†ç”±äº‹åŠ¡åè°ƒå™¨ç»´æŠ¤çš„ <strong>å…¨å±€å†™æ’ä»–é”</strong>ï¼Œæ¥ä¿è¯äº‹åŠ¡é—´çš„ <strong>å†™éš”ç¦»</strong>ï¼Œå°†å…¨å±€äº‹åŠ¡é»˜è®¤å®šä¹‰åœ¨ <strong>è¯»æœªæäº¤</strong> çš„éš”ç¦»çº§åˆ«ä¸Šã€‚</p><p>æˆ‘ä»¬å¯¹éš”ç¦»çº§åˆ«çš„å…±è¯†æ˜¯ï¼šå¾®æœåŠ¡åœºæ™¯äº§ç”Ÿçš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œç»å¤§éƒ¨åˆ†åº”ç”¨åœ¨ <strong>è¯»å·²æäº¤</strong> çš„éš”ç¦»çº§åˆ«ä¸‹å·¥ä½œæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚è€Œå®é™…ä¸Šï¼Œè¿™å½“ä¸­åˆæœ‰ç»å¤§å¤šæ•°çš„åº”ç”¨åœºæ™¯ï¼Œå®é™…ä¸Šå·¥ä½œåœ¨ <strong>è¯»æœªæäº¤</strong> çš„éš”ç¦»çº§åˆ«ä¸‹åŒæ ·æ²¡æœ‰é—®é¢˜ã€‚</p><p>åœ¨æç«¯åœºæ™¯ä¸‹ï¼Œåº”ç”¨å¦‚æœéœ€è¦è¾¾åˆ°å…¨å±€çš„ <strong>è¯»å·²æäº¤</strong>ï¼ŒFescar ä¹Ÿæä¾›äº†ç›¸åº”çš„æœºåˆ¶æ¥è¾¾åˆ°ç›®çš„ã€‚é»˜è®¤ï¼ŒFescar æ˜¯å·¥ä½œåœ¨ <strong>è¯»æœªæäº¤</strong> çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¿è¯ç»å¤§å¤šæ•°åœºæ™¯çš„é«˜æ•ˆæ€§ã€‚</p><p><img alt data-src="/images/alibaba-seata-design/isolation.png"><br>äº‹åŠ¡çš„ ACID å±æ€§åœ¨ Fescar ä¸­çš„ä½“ç°æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¯é¢˜ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸“é—¨çš„æ–‡ç« æ¥æ·±å…¥åˆ†æï¼Œè¿™é‡Œä¸åšè¿›ä¸€æ­¥å±•å¼€ã€‚</p><h1 id="é€‚ç”¨åœºæ™¯åˆ†æ"><a href="#é€‚ç”¨åœºæ™¯åˆ†æ" class="headerlink" title="é€‚ç”¨åœºæ™¯åˆ†æ"></a>é€‚ç”¨åœºæ™¯åˆ†æ</h1><p>å‰æ–‡æ‰€è¿°çš„ <font color="DeepPink">Fescar çš„æ ¸å¿ƒåŸç†ä¸­æœ‰ä¸€ä¸ª <strong>é‡è¦å‰æ</strong>ï¼šåˆ†æ”¯äº‹åŠ¡ä¸­æ¶‰åŠçš„èµ„æºï¼Œ<strong>å¿…é¡»</strong> æ˜¯æ”¯æŒ <strong>ACID äº‹åŠ¡</strong>çš„ <strong>å…³ç³»å‹æ•°æ®åº“</strong>ã€‚åˆ†æ”¯çš„æäº¤å’Œå›æ»šæœºåˆ¶ï¼Œéƒ½ä¾èµ–äºæœ¬åœ°äº‹åŠ¡çš„ä¿éšœã€‚æ‰€ä»¥ï¼Œå¦‚æœåº”ç”¨ä½¿ç”¨çš„æ•°æ®åº“æ˜¯ä¸æ”¯æŒäº‹åŠ¡çš„ï¼Œæˆ–æ ¹æœ¬ä¸æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œå°±ä¸é€‚ç”¨ã€‚</font></p><p>å¦å¤–ï¼Œç›®å‰ Fescar çš„å®ç°è¿˜å­˜åœ¨ä¸€äº›å±€é™ï¼Œæ¯”å¦‚ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«æœ€é«˜æ”¯æŒåˆ° <strong>è¯»å·²æäº¤</strong> çš„æ°´å¹³ï¼ŒSQL çš„è§£æè¿˜ä¸èƒ½æ¶µç›–å…¨éƒ¨çš„è¯­æ³•ç­‰ã€‚</p><p>ä¸ºäº†è¦†ç›– Fescar åŸç”Ÿæœºåˆ¶æš‚æ—¶ä¸èƒ½æ”¯æŒåº”ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬å®šä¹‰äº†å¦å¤–ä¸€ç§å·¥ä½œæ¨¡å¼ã€‚</p><p>ä¸Šé¢ä»‹ç»çš„ Fescar åŸç”Ÿå·¥ä½œæ¨¡å¼ç§°ä¸º ATï¼ˆAutomatic Transactionï¼‰æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æ˜¯å¯¹ä¸šåŠ¡æ— ä¾µå…¥çš„ã€‚ä¸ä¹‹ç›¸åº”çš„å¦å¤–ä¸€ç§å·¥ä½œæ¨¡å¼ç§°ä¸º MTï¼ˆManual Transactionï¼‰æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œåˆ†æ”¯äº‹åŠ¡éœ€è¦åº”ç”¨è‡ªå·±æ¥å®šä¹‰ä¸šåŠ¡æœ¬èº«åŠæäº¤å’Œå›æ»šçš„é€»è¾‘ã€‚</p><h2 id="åˆ†æ”¯çš„åŸºæœ¬è¡Œä¸ºæ¨¡å¼"><a href="#åˆ†æ”¯çš„åŸºæœ¬è¡Œä¸ºæ¨¡å¼" class="headerlink" title="åˆ†æ”¯çš„åŸºæœ¬è¡Œä¸ºæ¨¡å¼"></a>åˆ†æ”¯çš„åŸºæœ¬è¡Œä¸ºæ¨¡å¼</h2><p>ä½œä¸ºå…¨å±€äº‹åŠ¡ä¸€éƒ¨åˆ†çš„åˆ†æ”¯äº‹åŠ¡ï¼Œé™¤æœ¬èº«çš„ä¸šåŠ¡é€»è¾‘å¤–ï¼Œéƒ½åŒ…å« 4 ä¸ªä¸åè°ƒå™¨äº¤äº’çš„è¡Œä¸ºï¼š</p><ul><li><strong>åˆ†æ”¯æ³¨å†Œï¼š</strong> åœ¨åˆ†æ”¯äº‹åŠ¡çš„æ•°æ®æ“ä½œè¿›è¡Œä¹‹å‰ï¼Œéœ€è¦å‘åè°ƒå™¨æ³¨å†Œï¼ŒæŠŠå³å°†è¿›è¡Œçš„åˆ†æ”¯äº‹åŠ¡æ•°æ®æ“ä½œï¼Œçº³å…¥ä¸€ä¸ªå·²ç»å¼€å¯çš„å…¨å±€äº‹åŠ¡çš„ç®¡ç†ä¸­å»ï¼Œåœ¨åˆ†æ”¯æ³¨å†ŒæˆåŠŸåï¼Œæ‰å¯ä»¥è¿›è¡Œæ•°æ®æ“ä½œã€‚</li><li><strong>çŠ¶æ€ä¸ŠæŠ¥ï¼š</strong> åœ¨åˆ†æ”¯äº‹åŠ¡çš„æ•°æ®æ“ä½œå®Œæˆåï¼Œéœ€è¦å‘äº‹åŠ¡åè°ƒå™¨ä¸ŠæŠ¥å…¶æ‰§è¡Œç»“æœã€‚</li><li><strong>åˆ†æ”¯æäº¤</strong>ï¼šå“åº”åè°ƒå™¨å‘å‡ºçš„åˆ†æ”¯äº‹åŠ¡æäº¤çš„è¯·æ±‚ï¼Œå®Œæˆåˆ†æ”¯æäº¤ã€‚</li><li><strong>åˆ†æ”¯å›æ»š</strong>ï¼šå“åº”åè°ƒå™¨å‘å‡ºçš„åˆ†æ”¯äº‹åŠ¡å›æ»šçš„è¯·æ±‚ï¼Œå®Œæˆåˆ†æ”¯å›æ»šã€‚</li></ul><p><img alt data-src="/images/alibaba-seata-design/how_does_rm_talk_to_tc.png"></p><h2 id="AT-æ¨¡å¼åˆ†æ”¯çš„è¡Œä¸ºæ¨¡å¼"><a href="#AT-æ¨¡å¼åˆ†æ”¯çš„è¡Œä¸ºæ¨¡å¼" class="headerlink" title="AT æ¨¡å¼åˆ†æ”¯çš„è¡Œä¸ºæ¨¡å¼"></a>AT æ¨¡å¼åˆ†æ”¯çš„è¡Œä¸ºæ¨¡å¼</h2><p>ä¸šåŠ¡é€»è¾‘ä¸éœ€è¦å…³æ³¨äº‹åŠ¡æœºåˆ¶ï¼Œåˆ†æ”¯ä¸å…¨å±€äº‹åŠ¡çš„äº¤äº’è¿‡ç¨‹è‡ªåŠ¨è¿›è¡Œã€‚</p><p><img alt data-src="/images/alibaba-seata-design/at_branch.png"></p><h2 id="MT-æ¨¡å¼åˆ†æ”¯çš„è¡Œä¸ºæ¨¡å¼"><a href="#MT-æ¨¡å¼åˆ†æ”¯çš„è¡Œä¸ºæ¨¡å¼" class="headerlink" title="MT æ¨¡å¼åˆ†æ”¯çš„è¡Œä¸ºæ¨¡å¼"></a>MT æ¨¡å¼åˆ†æ”¯çš„è¡Œä¸ºæ¨¡å¼</h2><p>ä¸šåŠ¡é€»è¾‘éœ€è¦è¢«åˆ†è§£ä¸º Prepare/Commit/Rollback 3 éƒ¨åˆ†ï¼Œå½¢æˆä¸€ä¸ª MT åˆ†æ”¯ï¼ŒåŠ å…¥å…¨å±€äº‹åŠ¡ã€‚</p><p><img alt data-src="/images/alibaba-seata-design/mt_branch.png"></p><p>MT æ¨¡å¼ä¸€æ–¹é¢æ˜¯ AT æ¨¡å¼çš„è¡¥å……ã€‚å¦å¤–ï¼Œæ›´é‡è¦çš„ä»·å€¼åœ¨äºï¼Œé€šè¿‡ MT æ¨¡å¼å¯ä»¥æŠŠä¼—å¤šéäº‹åŠ¡æ€§èµ„æºçº³å…¥å…¨å±€äº‹åŠ¡çš„ç®¡ç†ä¸­ã€‚</p><h2 id="æ··åˆæ¨¡å¼"><a href="#æ··åˆæ¨¡å¼" class="headerlink" title="æ··åˆæ¨¡å¼"></a>æ··åˆæ¨¡å¼</h2><p>å› ä¸º AT å’Œ MT æ¨¡å¼çš„åˆ†æ”¯ä»æ ¹æœ¬ä¸Šè¡Œä¸ºæ¨¡å¼æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥å¯ä»¥å®Œå…¨å…¼å®¹ï¼Œå³ï¼Œä¸€ä¸ªå…¨å±€äº‹åŠ¡ä¸­ï¼Œå¯ä»¥åŒæ—¶å­˜åœ¨ AT å’Œ MT çš„åˆ†æ”¯ã€‚è¿™æ ·å°±å¯ä»¥è¾¾åˆ°å…¨é¢è¦†ç›–ä¸šåŠ¡åœºæ™¯çš„ç›®çš„ï¼šAT æ¨¡å¼å¯ä»¥æ”¯æŒçš„ï¼Œä½¿ç”¨ AT æ¨¡å¼ï¼›AT æ¨¡å¼æš‚æ—¶æ”¯æŒä¸äº†çš„ï¼Œç”¨ MT æ¨¡å¼æ¥æ›¿ä»£ã€‚å¦å¤–ï¼Œè‡ªç„¶çš„ï¼ŒMT æ¨¡å¼ç®¡ç†çš„éäº‹åŠ¡æ€§èµ„æºä¹Ÿå¯ä»¥å’Œæ”¯æŒäº‹åŠ¡çš„å…³ç³»å‹æ•°æ®åº“èµ„æºä¸€èµ·ï¼Œçº³å…¥åŒä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„ç®¡ç†ä¸­ã€‚</p><h2 id="åº”ç”¨åœºæ™¯çš„è¿œæ™¯"><a href="#åº”ç”¨åœºæ™¯çš„è¿œæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯çš„è¿œæ™¯"></a>åº”ç”¨åœºæ™¯çš„è¿œæ™¯</h2><p>å›åˆ°æˆ‘ä»¬è®¾è®¡çš„åˆè¡·ï¼šä¸€ä¸ªç†æƒ³çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæ˜¯ä¸åº”è¯¥ä¾µå…¥ä¸šåŠ¡çš„ã€‚MT æ¨¡å¼æ˜¯åœ¨ AT æ¨¡å¼æš‚æ—¶ä¸èƒ½å®Œå…¨è¦†ç›–æ‰€æœ‰åœºæ™¯çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ¯”è¾ƒè‡ªç„¶çš„è¡¥å……æ–¹æ¡ˆã€‚æˆ‘ä»¬å¸Œæœ›é€šè¿‡ AT æ¨¡å¼çš„ä¸æ–­æ¼”è¿›å¢å¼ºï¼Œé€æ­¥æ‰©å¤§æ‰€æ”¯æŒçš„åœºæ™¯ï¼ŒMT æ¨¡å¼é€æ­¥æ”¶æ•›ã€‚æœªæ¥ï¼Œæˆ‘ä»¬ä¼šçº³å…¥å¯¹ XA çš„åŸç”Ÿæ”¯æŒï¼Œç”¨ XA è¿™ç§æ— ä¾µå…¥çš„æ–¹å¼æ¥è¦†ç›– AT æ¨¡å¼æ— æ³•è§¦è¾¾çš„åœºæ™¯ã€‚</p><p><img alt data-src="/images/alibaba-seata-design/roadmap_of_transaction_mode.png"></p><h1 id="æ‰©å±•ç‚¹"><a href="#æ‰©å±•ç‚¹" class="headerlink" title="æ‰©å±•ç‚¹"></a>æ‰©å±•ç‚¹</h1><h2 id="å¾®æœåŠ¡æ¡†æ¶çš„æ”¯æŒ"><a href="#å¾®æœåŠ¡æ¡†æ¶çš„æ”¯æŒ" class="headerlink" title="å¾®æœåŠ¡æ¡†æ¶çš„æ”¯æŒ"></a>å¾®æœåŠ¡æ¡†æ¶çš„æ”¯æŒ</h2><p>äº‹åŠ¡ä¸Šä¸‹æ–‡åœ¨å¾®æœåŠ¡é—´çš„ä¼ æ’­éœ€è¦æ ¹æ®å¾®æœåŠ¡æ¡†æ¶æœ¬èº«çš„æœºåˆ¶ï¼Œè®¢åˆ¶æœ€ä¼˜çš„ï¼Œå¯¹åº”ç”¨å±‚é€æ˜çš„è§£å†³æ–¹æ¡ˆã€‚æœ‰å…´è¶£åœ¨è¿™æ–¹é¢å…±å»ºçš„å¼€å‘è€…å¯ä»¥å‚è€ƒå†…ç½®çš„å¯¹ Dubbo çš„æ”¯æŒæ–¹æ¡ˆï¼Œæ¥å®ç°å¯¹å…¶ä»–å¾®æœåŠ¡æ¡†æ¶çš„æ”¯æŒã€‚</p><h2 id="æ‰€æ”¯æŒçš„æ•°æ®åº“ç±»å‹"><a href="#æ‰€æ”¯æŒçš„æ•°æ®åº“ç±»å‹" class="headerlink" title="æ‰€æ”¯æŒçš„æ•°æ®åº“ç±»å‹"></a>æ‰€æ”¯æŒçš„æ•°æ®åº“ç±»å‹</h2><p>å› ä¸º AT æ¶‰åŠ SQL çš„è§£æï¼Œæ‰€ä»¥åœ¨ä¸åŒç±»å‹çš„æ•°æ®åº“ä¸Šå·¥ä½œï¼Œä¼šæœ‰ä¸€äº›ç‰¹å®šçš„é€‚é…ã€‚æœ‰å…´è¶£åœ¨è¿™æ–¹é¢å…±å»ºçš„å¼€å‘è€…å¯ä»¥å‚è€ƒå†…ç½®çš„å¯¹ MySQL çš„æ”¯æŒæ–¹æ¡ˆï¼Œæ¥å®ç°å¯¹å…¶ä»–æ•°æ®åº“çš„æ”¯æŒã€‚</p><h2 id="é…ç½®å’ŒæœåŠ¡æ³¨å†Œå‘ç°"><a href="#é…ç½®å’ŒæœåŠ¡æ³¨å†Œå‘ç°" class="headerlink" title="é…ç½®å’ŒæœåŠ¡æ³¨å†Œå‘ç°"></a>é…ç½®å’ŒæœåŠ¡æ³¨å†Œå‘ç°</h2><p>æ”¯æŒæ¥å…¥ä¸åŒçš„é…ç½®å’ŒæœåŠ¡æ³¨å†Œå‘ç°è§£å†³æ–¹æ¡ˆã€‚æ¯”å¦‚ï¼šNacosã€Eurekaã€ZooKeeper ç­‰ã€‚</p><h2 id="MT-æ¨¡å¼çš„åœºæ™¯æ‹“å±•"><a href="#MT-æ¨¡å¼çš„åœºæ™¯æ‹“å±•" class="headerlink" title="MT æ¨¡å¼çš„åœºæ™¯æ‹“å±•"></a>MT æ¨¡å¼çš„åœºæ™¯æ‹“å±•</h2><p>MT æ¨¡å¼çš„ä¸€ä¸ªé‡è¦ä½œç”¨å°±æ˜¯ï¼Œå¯ä»¥æŠŠéå…³ç³»å‹æ•°æ®åº“çš„èµ„æºï¼Œé€šè¿‡ MT æ¨¡å¼åˆ†æ”¯çš„åŒ…è£…ï¼Œçº³å…¥åˆ°å…¨å±€äº‹åŠ¡çš„ç®¡è¾–ä¸­æ¥ã€‚æ¯”å¦‚ï¼ŒRedisã€HBaseã€RocketMQ çš„äº‹åŠ¡æ¶ˆæ¯ç­‰ã€‚æœ‰å…´è¶£åœ¨è¿™æ–¹é¢å…±å»ºçš„å¼€å‘è€…å¯ä»¥åœ¨è¿™é‡Œè´¡çŒ®ä¸€ç³»åˆ—ç›¸å…³ç”Ÿæ€çš„é€‚é…æ–¹æ¡ˆã€‚</p><h2 id="äº‹åŠ¡åè°ƒå™¨çš„åˆ†å¸ƒå¼é«˜å¯ç”¨æ–¹æ¡ˆ"><a href="#äº‹åŠ¡åè°ƒå™¨çš„åˆ†å¸ƒå¼é«˜å¯ç”¨æ–¹æ¡ˆ" class="headerlink" title="äº‹åŠ¡åè°ƒå™¨çš„åˆ†å¸ƒå¼é«˜å¯ç”¨æ–¹æ¡ˆ"></a>äº‹åŠ¡åè°ƒå™¨çš„åˆ†å¸ƒå¼é«˜å¯ç”¨æ–¹æ¡ˆ</h2><p>é’ˆå¯¹ä¸åŒåœºæ™¯ï¼Œæ”¯æŒä¸åŒçš„æ–¹å¼ä½œä¸ºäº‹åŠ¡åè°ƒå™¨ Server ç«¯çš„é«˜å¯ç”¨æ–¹æ¡ˆã€‚æ¯”å¦‚ï¼Œé’ˆå¯¹äº‹åŠ¡çŠ¶æ€çš„æŒä¹…åŒ–ï¼Œå¯ä»¥æ˜¯åŸºäºæ–‡ä»¶çš„å®ç°æ–¹æ¡ˆï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºäºæ•°æ®åº“çš„å®ç°æ–¹æ¡ˆï¼›é›†ç¾¤é—´çš„çŠ¶æ€åŒæ­¥ï¼Œå¯ä»¥æ˜¯åŸºäº RPC é€šä¿¡çš„æ–¹æ¡ˆï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºäºé«˜å¯ç”¨ KV å­˜å‚¨çš„æ–¹æ¡ˆã€‚</p><h1 id="Roadmap"><a href="#Roadmap" class="headerlink" title="Roadmap"></a>Roadmap</h1><h2 id="Lanscape"><a href="#Lanscape" class="headerlink" title="Lanscape"></a>Lanscape</h2><p><img alt data-src="/images/alibaba-seata-design/landscape.png"></p><p><strong>The green</strong> part is already open sourced, <strong>the yellow</strong> part will open source by Alibaba/AntFinancial, <strong>the blue</strong> part we want co-building with out community:</p><ul><li>Developers can refer to Seata implementation of MySQL support if you want to support different databases transaction</li><li>Developers can refer to Seata implementation of Dubbo support if you want to support different microservices</li><li>Developers can refer to Seata implementation of TCC support if you want to support different data source(such as MQ, NoSQL)</li><li>Developers can refer to Seata implementation of TCC support if you want to support different data source(such as MQ, NoSQL)</li><li>Developers can easily support configuration/registry services with just a little work</li><li><strong>The blue</strong> part is warmly welcome you, join it and contribute excellent solution</li><li>We will support XA which is the standard of distributed transaction in our product roadmap</li></ul><h2 id="Roadmap-1"><a href="#Roadmap-1" class="headerlink" title="Roadmap"></a>Roadmap</h2><h3 id="v0-1-0"><a href="#v0-1-0" class="headerlink" title="v0.1.0"></a>v0.1.0</h3><ul><li>Microservice framework support: Dubbo</li><li>Database support: MySQL</li><li>Spring AOP annotation Support</li><li>Transaction coordinator: Stand-alone Server</li></ul><h3 id="v0-5-x"><a href="#v0-5-x" class="headerlink" title="v0.5.x"></a>v0.5.x</h3><ul><li>Rename Fescar to Seata</li><li>Microservice framework support: SOFA, Spring Cloud</li><li>Support TCC(Try Confirm Cancel) transaction mode</li><li>Dynamic configuration</li><li>Services discovery</li></ul><h3 id="v0-6-x"><a href="#v0-6-x" class="headerlink" title="v0.6.x"></a>v0.6.x</h3><ul><li>Transaction coordinator: Cluster Server with HA</li></ul><h3 id="v0-8-x"><a href="#v0-8-x" class="headerlink" title="v0.8.x"></a>v0.8.x</h3><ul><li>Promethus support</li><li>Management console: Monitor, Deployment, Upgrating, etc.</li></ul><h3 id="v1-0-0"><a href="#v1-0-0" class="headerlink" title="v1.0.0"></a>v1.0.0</h3><ul><li>Production ready</li></ul><h3 id="v1-5-x"><a href="#v1-5-x" class="headerlink" title="v1.5.x"></a>v1.5.x</h3><ul><li>Database support: Oracle, PostgreSQL, OceanBase</li><li>Optimization of conflict datas</li><li>Independent of Spring Annotation</li><li>Multiple source of data transaction support: MessageQueue(RocketMQ), HBase, Redis, etc.</li></ul><h3 id="v2-0-0"><a href="#v2-0-0" class="headerlink" title="v2.0.0"></a>v2.0.0</h3><ul><li>XA transaction mode support</li></ul><p>å½“ç„¶ï¼Œé¡¹ç›®è¿­ä»£æ¼”è¿›çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬æœ€é‡è§†çš„æ˜¯ç¤¾åŒºçš„å£°éŸ³ï¼Œè·¯çº¿å›¾ä¼šå’Œç¤¾åŒºå……åˆ†äº¤æµåŠæ—¶è¿›è¡Œè°ƒæ•´ã€‚</p><h1 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h1><ul><li><a href="https://github.com/alibaba/fescar" target="_blank" rel="noopener">FESCAR on GitHub</a></li><li><a href="https://help.aliyun.com/product/48444.html?spm=5176.doc55547.3.1.Gg1hcs" target="_blank" rel="noopener">GTS on Aliyun</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Architecture </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Architecture </tag>
            
            <tag> Fescar </tag>
            
            <tag> Seata </tag>
            
            <tag> Distributed </tag>
            
            <tag> Transaction </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼‚åœ°å¤šæ´»é«˜å¯ç”¨æ¶æ„è®¾è®¡</title>
      <link href="/multi-live-high-available-architecture-design.html"/>
      <url>/multi-live-high-available-architecture-design.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>å¦‚æœæ„å»ºåº”ç”¨çš„å¼‚åœ°å¤šæ´»ï¼Ÿ</p></blockquote><a id="more"></a><h1 id="æ¦‚è¦"><a href="#æ¦‚è¦" class="headerlink" title="æ¦‚è¦"></a>æ¦‚è¦</h1><p>éšç€ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•ï¼Œå¯¹äºå¾ˆå¤šå…¬å¸æ¥è¯´ï¼Œæ„å»ºäºå•åœ°åŸŸçš„æŠ€æœ¯ä½“ç³»æ¶æ„ï¼Œä¼šé¢ä¸´è¯¸å¦‚ä¸‹é¢çš„å¤šç§é—®é¢˜ï¼šç¡€è®¾æ–½çš„æœ‰é™æ€§é™åˆ¶äº†ä¸šåŠ¡çš„å¯æ‰©å±•æ€§ï¼›æœºæˆ¿ã€åŸå¸‚çº§åˆ«çš„æ•…éšœç¾å®³ï¼Œå½±å“æœåŠ¡çš„å¯æŒç»­æ€§ã€‚</p><p>ä¸ºè§£å†³é‡åˆ°çš„è¿™äº›é—®é¢˜ï¼Œå…¬å¸å¯ä»¥é€‰æ‹©æ„å»ºå¼‚åœ°å¤šæ´»æ¶æ„ï¼Œåœ¨åŒåŸ/å¼‚åœ°æ„å»ºå¤šä¸ªå•å…ƒ(ä¸šåŠ¡ä¸­å¿ƒ)ã€‚å„ä¸ªä¸šåŠ¡å•å…ƒå¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„åœ°åŸŸï¼Œä»è€Œæœ‰æ•ˆè§£å†³äº†å•åœ°åŸŸéƒ¨ç½²å¸¦æ¥çš„åŸºç¡€è®¾æ–½çš„æ‰©å±•é™åˆ¶ã€æœåŠ¡å¯æŒç»­æ€§ã€‚</p><p>å¼‚åœ°å¤šæ´»æ˜¯è¿‘å‡ å¹´æ¯”è¾ƒçƒ­é—¨çš„ä¸€ä¸ªè¯é¢˜ï¼Œé‚£ä¹ˆåœ¨å®é™…ä¸šåŠ¡ä¸­ä»€ä¹ˆæ—¶å€™éœ€è¦å»åšè¿™ä»¶äº‹ï¼Ÿå¦‚ä½•å»åšï¼Ÿåšçš„æ—¶å€™éœ€è¦è€ƒè™‘ä»€ä¹ˆï¼Ÿ</p><h2 id="ä½•æ—¶å»åšï¼Ÿ"><a href="#ä½•æ—¶å»åšï¼Ÿ" class="headerlink" title="ä½•æ—¶å»åšï¼Ÿ"></a>ä½•æ—¶å»åšï¼Ÿ</h2><p>ä¸ªäººæ„Ÿè§‰å–å†³äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ul><li>ä¸šåŠ¡å‘å±•</li><li>åŸºç¡€è®¾æ–½çŠ¶å†µ</li><li>æŠ€æœ¯ç§¯æ·€</li></ul><h2 id="å¦‚ä½•åšï¼Ÿ"><a href="#å¦‚ä½•åšï¼Ÿ" class="headerlink" title="å¦‚ä½•åšï¼Ÿ"></a>å¦‚ä½•åšï¼Ÿ</h2><p>ç›®å‰åœ¨ç½‘ä¸Šæœç´¢åˆ°çš„å¼‚åœ°å¤šæ´»æ–¹æ¡ˆæ¥çœ‹ï¼ŒåŸºæœ¬éƒ½æ˜¯é˜¿é‡Œã€é¥¿äº†ä¹ˆã€äº¬ä¸œã€å¾®åšè¿™äº›äº’è”ç½‘å¤§å‚çš„å®è·µï¼Œè¿™äº›å¤§å‚çš„æ–¹æ¡ˆæœ‰ä¸€ä¸ªå…±åŒç‚¹å°±æ˜¯ï¼šå¤§é‡çš„è‡ªç ”ç»„ä»¶ï¼Œæ¥åšç›¸å…³çš„æ•°æ®åŒæ­¥ï¼Œä¸šåŠ¡åˆ‡åˆ†ç­‰ç­‰ï¼Œé‚£ä¹ˆï¼Œå¯¹äºå¾ˆå¤šä¼ ç»Ÿä¼ä¸šæˆ–è€…ç›¸å¯¹å°ä¸€äº›çš„ä¼ä¸šï¼Œåº”è¯¥å¦‚ä½•æ¥åšè¿™ä»¶äº‹ï¼Ÿ</p><ul><li>æ ¹æ®ä¸šåŠ¡ç‰¹æ€§å€ŸåŠ©åˆé€‚çš„å…¬æœ‰äº‘æœåŠ¡</li></ul><h2 id="åšçš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"><a href="#åšçš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åšçš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"></a>åšçš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</h2><ul><li>çœŸæ­£éœ€è¦åšå¼‚åœ°å¤šæ´»çš„ä¸šåŠ¡æœ‰å“ªäº›ï¼Ÿ</li><li>åŸºç¡€è®¾æ–½å¦‚ä½•ï¼Ÿ</li><li>å¯¹äºä¸å¯ç”¨æ—¶é—´çš„å®¹å¿ç¨‹åº¦æ˜¯å¤šå°‘ï¼Ÿ</li></ul><h1 id="ä¸šåŠ¡èƒŒæ™¯"><a href="#ä¸šåŠ¡èƒŒæ™¯" class="headerlink" title="ä¸šåŠ¡èƒŒæ™¯"></a>ä¸šåŠ¡èƒŒæ™¯</h1><ul><li>åœ¨æ‰€æœ‰çš„ç³»ç»Ÿä¸­ç”¨æˆ·ä¸­å¿ƒéƒ½æ˜¯æ ¸å¿ƒä¸šåŠ¡ï¼Œå› ä¸ºå®ƒæ˜¯è¿›å…¥å…¶å®ƒå¾ˆå¤šä¸šåŠ¡å‰æã€‚</li><li>æˆ‘ä»¬è¿™è¾¹IDCä¸æ˜¯å¾ˆç¨³å®šï¼Œä¹‹å‰å‘ç”Ÿè¿‡å‡ æ¬¡æœºæˆ¿å¤§è§„æ¨¡æ•…éšœï¼Œæ¯”å¦‚æœºæˆ¿ç½‘ç»œæŒ‚äº†ï¼Œæ•´ä¸ªæœºæˆ¿å¯¹å¤–ä¸å¯ç”¨äº†ã€‚</li></ul><p>ä»¥ä¸Šä¸¤ç‚¹æ˜¯æˆ‘ä»¬è¿™æ¬¡è¦åšç”¨æˆ·ä¸­å¿ƒå¼‚åœ°å®¹ç¾çš„å‡ºå‘ç‚¹ï¼Œä»¥ä¾¿åœ¨é¢å¯¹æœºæˆ¿çº§åˆ«æ•…éšœæ—¶ï¼Œä¿è¯æœåŠ¡å¯ç”¨æ€§ã€‚</p><h1 id="ä¸šåŠ¡æ¢³ç†"><a href="#ä¸šåŠ¡æ¢³ç†" class="headerlink" title="ä¸šåŠ¡æ¢³ç†"></a>ä¸šåŠ¡æ¢³ç†</h1><p>ç”¨æˆ·ä¸­å¿ƒä»æ•´ä½“æ¥çœ‹ï¼Œå¯¹å¤–ä¸»è¦æä¾›ï¼šæ³¨å†Œã€ç™»é™†ã€æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ç­‰æœåŠ¡ã€‚è¿™äº›æœåŠ¡åˆæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ul><li>ç™»é™†çš„ä¼˜å…ˆçº§æœ€é«˜</li><li>äº‹åŠ¡æ€§è¦æ±‚ä½</li></ul><p>æ¶‰åŠçš„å…¬å…±ç»„ä»¶ä¸»è¦æœ‰ï¼š</p><ul><li>MySQLï¼šç”¨æˆ·æ•°æ®å­˜å‚¨</li><li>Redisï¼šAuthorization Codeã€çŸ­ä¿¡éªŒè¯ç ã€è´¦å·é”å®šã€access tokenç­‰çš„å­˜å‚¨</li><li>Zookeeperï¼šDubboä¾èµ–</li></ul><h1 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h1><p>ç”¨æˆ·ä¸­å¿ƒæ˜¯é€šè¿‡å¤–åŒ…çš„å½¢å¼è¿›è¡Œå¼€å‘çš„ï¼Œç›®å‰å·²ä¸Šçº¿å¹¶äº¤ä»˜ç»™å¦ä¸€ä¸ªå¤–åŒ…å•†è¿ç»´ï¼Œæ‰€ä»¥åœ¨è€ƒè™‘å®¹ç¾ä¸€æœŸæ–¹æ¡ˆçš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘å°½é‡ä¸åŠ¨ä»£ç ã€‚</p><h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h2><h3 id="ä¸€æœŸç›®æ ‡"><a href="#ä¸€æœŸç›®æ ‡" class="headerlink" title="ä¸€æœŸç›®æ ‡"></a>ä¸€æœŸç›®æ ‡</h3><p>å½“åŒ—äº¬æœºæˆ¿å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œå¯ä»¥ä¸€å®šæ—¶é—´å†…æŠŠæµé‡åˆ‡åˆ°é’å²›æœºæˆ¿è¿™è¾¹ï¼Œä¿è¯ç”¨æˆ·ä¸­å¿ƒæ ¸å¿ƒæœåŠ¡çš„åŸºæœ¬å¯ç”¨ã€‚</p><h3 id="äºŒæœŸç›®æ ‡"><a href="#äºŒæœŸç›®æ ‡" class="headerlink" title="äºŒæœŸç›®æ ‡"></a>äºŒæœŸç›®æ ‡</h3><p>ç”¨æˆ·ä¸­å¿ƒé€šè¿‡å¼‚åœ°å¤šæ´»ï¼Œå®ç°é«˜å¯ç”¨ï¼ˆéœ€è¦é›†å›¢æ™ºèƒ½DNSæ”¯æŒï¼‰ã€‚</p><h2 id="æ¶æ„è®¾è®¡"><a href="#æ¶æ„è®¾è®¡" class="headerlink" title="æ¶æ„è®¾è®¡"></a>æ¶æ„è®¾è®¡</h2><h3 id="ä¸€æœŸæ¶æ„"><a href="#ä¸€æœŸæ¶æ„" class="headerlink" title="ä¸€æœŸæ¶æ„"></a>ä¸€æœŸæ¶æ„</h3><p>å½“åŒ—äº¬æœºæˆ¿å‘ç”Ÿæ•…éšœçš„æ—¶å€™ï¼Œå¯ä»¥æŠŠæµé‡å¿«é€Ÿåˆ‡æ¢åˆ°é’å²›è¿™è¾¹ï¼Œä»¥ä¿éšœç”¨æˆ·ä¸­å¿ƒæ ¸å¿ƒæœåŠ¡å¯ç”¨ã€‚</p><p>å…·ä½“æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li>é€šè¿‡otterè¿‘å®æ—¶çš„å°†åŒ—äº¬æœºæˆ¿æ ¸å¿ƒä¸šåŠ¡æ•°æ®åŒæ­¥åˆ°é’å²›æœºæˆ¿ã€‚</li><li>é’å²›æœºæˆ¿éƒ¨ç½²Redisã€ZooKeeperç­‰ä¸­é—´ä»¶ã€‚</li><li>é’å²›æœºæˆ¿éƒ¨ç½²ç”¨æˆ·ä¸­å¿ƒçš„æ ¸å¿ƒåº”ç”¨ï¼ˆå®ä¾‹æ­£å¸¸éƒ¨ç½²ã€è¿è¡Œï¼Œåªæ˜¯å¹³æ—¶ä¸ä¼šæœ‰è®¿é—®ï¼‰ã€‚</li></ul><p>å…·ä½“æ¶æ„å¦‚ä¸‹ï¼š<br><img alt data-src="/images/multi-live-high-available-architecture-design/%E4%B8%80%E6%9C%9F%E6%9E%B6%E6%9E%84.png"></p><p>å¯ä»¥è¾¾åˆ°çš„æ•ˆæœï¼š</p><ul><li>å½“åŒ—äº¬æœºæˆ¿å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œå¯ä»¥åœ¨ä¸€å®šæ—¶é—´å†…æŠŠæµé‡åˆ‡åˆ°é’å²›æœºæˆ¿è¿™è¾¹ï¼Œä¿è¯ç”¨æˆ·ä¸­å¿ƒæ ¸å¿ƒæœåŠ¡çš„åŸºæœ¬å¯ç”¨ï¼Œä½†æ­¤æ—¶å·²ç™»å½•ç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•ã€‚</li><li>ä¸€å®šæ—¶é—´ï¼šå–å†³äºDNSä¿®æ”¹ipæ—¶é—´+DNS TTLæ—¶é—´ï¼Œç›®å‰æ¥çœ‹TTLæ˜¯10åˆ†é’Ÿï¼Œäººå·¥ä¿®æ”¹ipåº”è¯¥å¾ˆå¿«ï¼Œæ‰€ä»¥ä¸€å®šæ—¶é—´æ˜¯10~20åˆ†é’Ÿã€‚</li></ul><p>å­˜åœ¨çš„ç¼ºç‚¹ï¼š</p><ul><li>åŒ—äº¬æœºæˆ¿éæ•…éšœæœŸé—´ï¼Œé’å²›æœºæˆ¿çš„æœºå™¨ï¼Œä»…åšæ•°æ®åº“åŒæ­¥ï¼Œå­˜åœ¨ä¸€å®šçš„èµ„æºæµªè´¹ã€‚</li><li>å½“åŒ—äº¬æœºæˆ¿å‡ºç°æ•…éšœï¼Œæµé‡åˆ‡æ¢åˆ°é’å²›æœºæˆ¿åï¼Œåªèƒ½ä¿è¯ç™»é™†è¿™ä¸€æ ¸å¿ƒæœåŠ¡çš„å¯ç”¨ã€‚å¯¹äºæ³¨å†Œç­‰éœ€è¦ä¿®æ”¹æ•°æ®åº“çš„æœåŠ¡ï¼Œå‡ä¸æ”¯æŒï¼Œå¦‚æœåœ¨æ­¤æœŸé—´è®¿é—®è¿™ç±»æœåŠ¡ï¼Œä¼šå‘ç”Ÿå¼‚å¸¸ã€‚</li></ul><h3 id="äºŒæœŸæ¶æ„"><a href="#äºŒæœŸæ¶æ„" class="headerlink" title="äºŒæœŸæ¶æ„"></a>äºŒæœŸæ¶æ„</h3><p>äºŒæœŸçš„ç›®çš„å°±æ˜¯ä¿®æ­£ä¸€æœŸæ¶æ„çš„ç¼ºç‚¹ï¼Œé€šè¿‡å¼‚åœ°å¤šæ´»ï¼Œå®ç°é«˜å¯ç”¨ã€‚</p><p>äºŒæœŸé’å²›æœºæˆ¿ä¼šæ›¿æ¢ä¸ºé˜¿é‡Œäº‘æœºæˆ¿ã€‚</p><p>å…·ä½“æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li>é€šè¿‡é˜¿é‡Œäº‘DTSæœåŠ¡å®ç°ä¸¤åœ°æœºæˆ¿æ•°æ®åº“åŒæ­¥ï¼Œä¿è¯åŒ—äº¬ã€é˜¿é‡Œäº‘æ•°æ®çš„è¿‘å®æ—¶ä¸€è‡´æ€§ã€‚</li><li>åŒ—äº¬ã€é˜¿é‡Œäº‘ä¸¤åœ°æœºæˆ¿å‡æä¾›åœ¨çº¿æœåŠ¡ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ã€‚</li><li>æ¢³ç†æœåŠ¡ä¼˜å…ˆçº§ï¼Œä¿®æ”¹åº”ç”¨ä»£ç ï¼Œæ”¯æŒæœåŠ¡é™çº§ã€‚</li><li>å½“æŸä¸ªæœºæˆ¿ï¼ˆé˜¿é‡Œäº‘æˆ–è€…åŒ—äº¬ï¼‰å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œé€šè¿‡DNSæœåŠ¡æŠŠæµé‡åˆ‡æ¢åˆ°å¦ä¸€ä¸ªæœºæˆ¿ã€‚<ul><li>å¦‚æœä¸¤åœ°éƒ¨ç½²çš„æ—¶å€™ï¼Œæ²¡æœ‰å†—ä½™ä¸€å®šç¡¬ä»¶èµ„æºï¼Œåˆ™éœ€è¦å®æ–½æœåŠ¡é™çº§ã€‚</li><li>ç›®å‰é›†å›¢DNSè§£æï¼Œæ— æ³•æä¾›è‡ªåŠ¨æ£€æµ‹æœåŠ¡æ˜¯å¦å¯ç”¨çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ— æ³•è‡ªåŠ¨è¿›è¡Œåˆ‡æ¢ã€‚<ul><li>æœåŠ¡å¯ç”¨æ€§ï¼Œå¯ä»¥é€šè¿‡æˆ‘ä»¬è¿™è¾¹çš„å¤šç‚¹æ‹¨æµ‹è¿›è¡Œç›‘æ§ï¼Œå½“å¤šç‚¹æ‹¨æµ‹ä¸å¯ç”¨çš„æ—¶å€™ï¼Œå‘é€å‘Šè­¦é€šçŸ¥ç»™ç›¸å…³äººå‘˜ï¼Œä»¥ä¾¿äººå·¥ä»‹å…¥ã€‚</li><li>å¤šç‚¹æ‹¨æµ‹å‘Šè­¦ï¼Œåº”è¯¥ä¼šæä¾›ä¸¤ç±»ï¼š1ã€æŸä¸ªæ‹¨æµ‹ç‚¹ä¸é€šçš„æ—¶å€™ 2ã€æ‰€æœ‰æ‹¨æµ‹ç‚¹å‡ä¸å¯ç”¨çš„æ—¶å€™ã€‚</li></ul></li><li>ç›®å‰é›†å›¢DNSè§£æï¼ŒTTLç”Ÿæ•ˆæœ€çŸ­æ—¶é—´æ˜¯10åˆ†é’Ÿï¼Œæ— æ³•è‡ªå®šä¹‰TTLæ—¶é—´ã€‚</li></ul></li></ul><p>å…·ä½“æ¶æ„å¦‚ä¸‹ï¼š<br><img alt data-src="/images/multi-live-high-available-architecture-design/%E4%BA%8C%E6%9C%9F%E6%9E%B6%E6%9E%84%E6%99%BA%E8%83%BDDNS.png"></p><p>å¯ä»¥è¾¾åˆ°çš„æ•ˆæœï¼š</p><ul><li><p>å¦‚æœé›†å›¢DNSå¯ä»¥æä¾›ï¼Œç±»ä¼¼é˜¿é‡Œäº‘äº‘è§£æçš„ç½‘ç«™ç›‘æ§åŠŸèƒ½å¹¶èƒ½çµæ´»è®¾ç½®TTLæ—¶é—´ï¼Œè¿™æ—¶å½“åŒ—äº¬æœºæˆ¿æˆ–è€…é˜¿é‡Œäº‘æœºæˆ¿å‡ºç°æ•…éšœåï¼Œå°±å¯ä»¥åœ¨å¾ˆçŸ­çš„æ—¶é—´ï¼ˆéƒ¨åˆ†æœåŠ¡æœ€å¤§å¼‚å¸¸æ—¶é—´ï¼‰å†…è‡ªåŠ¨è¿›è¡Œæµé‡åˆ‡æ¢ã€‚</p><blockquote><p>æ­¤å¤„åªæ˜¯ä»¥é˜¿é‡Œäº‘äº‘è§£æç¤ºä¾‹ï¼Œåªè¦èƒ½æä¾›ç±»ä¼¼çš„æœåŠ¡å‡å¯ã€‚</p></blockquote></li><li><p>å¦‚æœé›†å›¢DNSæ— æ³•æä¾›ç±»ä¼¼é˜¿é‡Œäº‘äº‘è§£æçš„ç½‘ç«™ç›‘æ§åŠçµæ´»è®¾ç½®TTLæ—¶é—´çš„åŠŸèƒ½ï¼Œåˆ™éƒ¨åˆ†æœåŠ¡æœ€å¤§å¼‚å¸¸æ—¶é—´è¿˜æ˜¯å–å†³äºDNSä¿®æ”¹ipæ—¶é—´+DNS TTLæ—¶é—´ã€‚</p></li></ul><h4 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h4><h5 id="ä»€ä¹ˆæ˜¯ç½‘ç«™ç›‘æ§ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç½‘ç«™ç›‘æ§ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç½‘ç«™ç›‘æ§ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç½‘ç«™ç›‘æ§ï¼Ÿ</h5><p>HTTP/HTTPSå®æ—¶æ¢æµ‹åŸŸåè§£æè®°å½•ï¼Œæ”¯æŒè‡ªå®šä¹‰ç«¯å£ï¼Œå®æ—¶å‘ç°å®•æœºç«‹å³å‘Šè­¦ï¼›<br>å…¨ç½‘åˆ†å¸ƒå¼ç›‘æ§ï¼Œåœ¨ä¸­å›½å„ä¸ªåœ°åŒºæ¨¡æ‹Ÿç”¨æˆ·ç«¯çœŸå®è¯·æ±‚ï¼Œç›‘æ§ç»“æœçœŸå®å¯é ï¼›<br>æ”¯æŒå®•æœºæš‚åœã€å®¹ç¾åˆ‡æ¢ï¼Œæœ€å¤§é™åº¦çš„è§£å†³æœåŠ¡ä¸­æ–­å¯¹æ‚¨çš„ä¸šåŠ¡å¸¦æ¥çš„æŸå¤±ï¼›<br>å®¹ç¾åˆ‡æ¢æ”¯æŒAè®°å½•ã€CNAMEåŸŸåï¼Œæ»¡è¶³å„ç§åœºæ™¯çš„å®¹ç¾åˆ‡æ¢éœ€æ±‚ï¼›</p><h5 id="ä»€ä¹ˆæƒ…å†µä¼šè¢«ç½‘ç«™ç›‘æ§åˆ¤æ–­ä¸ºå®•æœºå¹¶å‘é€å‘Šè­¦é€šçŸ¥ï¼Ÿ"><a href="#ä»€ä¹ˆæƒ…å†µä¼šè¢«ç½‘ç«™ç›‘æ§åˆ¤æ–­ä¸ºå®•æœºå¹¶å‘é€å‘Šè­¦é€šçŸ¥ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæƒ…å†µä¼šè¢«ç½‘ç«™ç›‘æ§åˆ¤æ–­ä¸ºå®•æœºå¹¶å‘é€å‘Šè­¦é€šçŸ¥ï¼Ÿ"></a>ä»€ä¹ˆæƒ…å†µä¼šè¢«ç½‘ç«™ç›‘æ§åˆ¤æ–­ä¸ºå®•æœºå¹¶å‘é€å‘Šè­¦é€šçŸ¥ï¼Ÿ</h5><p>ç›‘æ§ç»“æœä¸­ï¼ŒHTTP/HTTPSçš„è¿”å›ç å¤§äº500çš„æœåŠ¡å™¨é”™è¯¯æƒ…å†µï¼Œæ‰ä¼šæŠ¥è­¦é€šçŸ¥ã€‚<br>ä¸¾ä¾‹è¯´æ˜ï¼šå¦‚æœè®¾ç½®äº†å››ä¸ªæ¢æµ‹ç‚¹ åŒ—äº¬è”é€šã€æ·±åœ³é˜¿é‡Œå·´å·´ã€ä¸Šæµ·ç”µä¿¡ã€é‡åº†è”é€šã€‚<br>åœºæ™¯ä¸€ï¼šå››ä¸ªæ¢æµ‹ç‚¹ä¸­50%çš„ç›‘æ§ç‚¹æ— æ³•æ”¶åˆ°æ‚¨æœåŠ¡å™¨çš„å“åº”ï¼Œæˆ–50%çš„ç›‘æ§ç‚¹æ”¶åˆ°è¿”å›ç å¤§äºç­‰äº500æ—¶ï¼Œæ‰ä¼šåˆ¤æ–­æ‚¨çš„ç½‘ç«™ä¸ºå®•æœºæƒ…å†µã€‚<br>åœºæ™¯äºŒï¼šå››ä¸ªæ¢æµ‹ç‚¹ä¸­æœ‰50%ä»¥ä¸Šçš„æ¢æµ‹ç‚¹æ¢æµ‹æ‚¨çš„ç½‘ç«™è¿”å›ç æ˜¯å°äº500çš„æƒ…å†µï¼Œåˆ™ä¸ä¼šåˆ¤æ–­æ‚¨çš„ç½‘ç«™ä¸ºå®•æœºã€‚</p><h5 id="äº‘è§£æDNSâ€œæµé‡ç®¡ç†â€"><a href="#äº‘è§£æDNSâ€œæµé‡ç®¡ç†â€" class="headerlink" title="äº‘è§£æDNSâ€œæµé‡ç®¡ç†â€"></a>äº‘è§£æDNSâ€œæµé‡ç®¡ç†â€</h5><p>äº‘è§£æâ€œæµé‡ç®¡ç†â€å¯ä»¥åœ¨æ‚¨è®¾ç½®çš„æ¯æ¡è§£æçº¿è·¯ä¸‹ï¼Œæ ¹æ®æƒé‡æ¯”ä¾‹è½®è¯¢è¿”å›è§£æç»“æœã€‚å½“çº¿è·¯ä¸‹çš„IPå®•æœºæ—¶å¯ä»¥é€šè¿‡ç›‘æ§è‡ªåŠ¨å‘ç°ï¼Œå¹¶å°†å®•æœºIPä»å½“å‰çº¿è·¯ä¸‹æ‘˜é™¤ï¼Œç›´åˆ°ç›‘æ§IPæ­£å¸¸æ—¶ä¼šæ¢å¤è§£æã€‚åŒæ—¶ï¼Œå½“ä¸€æ¡è§£æçº¿è·¯ä¸‹çš„æ‰€æœ‰IPéƒ½å®•æœºæ—¶ï¼Œå¯ä»¥åˆ‡æ¢è‡³å…¶ä»–æ­£å¸¸çº¿è·¯ã€‚æœ€å¤§ç¨‹åº¦ä¿è¯æ‚¨çš„ç½‘ç«™æœåŠ¡é«˜å¯ç”¨ï¼Œå‡å°æŸå¤±ã€‚</p><h5 id="éƒ¨åˆ†æœåŠ¡æœ€å¤§å¼‚å¸¸æ—¶é—´"><a href="#éƒ¨åˆ†æœåŠ¡æœ€å¤§å¼‚å¸¸æ—¶é—´" class="headerlink" title="éƒ¨åˆ†æœåŠ¡æœ€å¤§å¼‚å¸¸æ—¶é—´"></a>éƒ¨åˆ†æœåŠ¡æœ€å¤§å¼‚å¸¸æ—¶é—´</h5><p>æ¯”å¦‚åŒ—äº¬æœºæˆ¿å‡ºç°å¼‚å¸¸ï¼Œè¿™æ—¶è½¬å‘åˆ°é˜¿é‡Œäº‘æœºæˆ¿çš„æµé‡æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œåªæœ‰è½¬å‘åˆ°åŒ—äº¬æœºæˆ¿çš„æµé‡æ˜¯å¼‚å¸¸çš„ã€‚</p><p>è¿™æ—¶å¦‚æœä½¿ç”¨ç½‘ç«™ç›‘æ§æˆ–è€…ç±»ä¼¼æœåŠ¡ï¼Œè¿›è¡Œç›‘æ§ï¼Œå¹¶è®¾ç½®æ‹¨æµ‹é—´éš”ä¸º1åˆ†é’Ÿï¼ŒTTLç”Ÿæ•ˆæ—¶é—´ä¸º1ç§’ï¼Œé‚£ä¹ˆæœ€å¤šæœ‰60+1ç§’éƒ¨åˆ†æœåŠ¡å¼‚å¸¸æ—¶é—´ï¼Œä¹‹åDNSä¼šè‡ªåŠ¨æŠŠåŒ—äº¬æœºæˆ¿çš„ipè‡ªåŠ¨è¸¢æ‰ï¼Œæµé‡å…¨éƒ¨åˆ‡åˆ°é˜¿é‡Œäº‘ã€‚</p><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><ol><li><p>ä¸€æœŸã€äºŒæœŸæ–¹æ¡ˆçš„å®ç°å‡å¼ºä¾èµ–äºé›†å›¢çš„DNSæœåŠ¡</p></li><li><p>ç”¨æˆ·ä¸­å¿ƒé€šè¿‡ipæš´éœ²çš„æœåŠ¡ï¼Œä¸€ä½†å‡ºç°æœºæˆ¿çº§åˆ«çš„æ•…éšœï¼Œä¸€æœŸã€äºŒæœŸæ–¹æ¡ˆå‡æ— æ³•ä¿è¯è¯¥éƒ¨åˆ†æœåŠ¡å¯ç”¨ã€‚</p></li><li><p>å…¶å®é™¤äº†DNSè¿™ç§æ–¹æ¡ˆï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ¡ˆå°±æ˜¯ç”¨ç±»ä¼¼F5è¿™ç§è®¾å¤‡ï¼Œä½œè·¨æœºæˆ¿è´Ÿè½½ï¼Œä½†å¿…é¡»æ˜¯gslbï¼Œè€Œä¸”ä¸¤ç«¯å¿…é¡»æ˜¯ç›¸åŒçš„è®¾å¤‡ã€‚</p></li></ol><h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><p>å¯¹äºï¼Œéä¸€çº¿äº’è”ç½‘å¤§å‚çš„å…¬å¸è€Œè¨€ï¼Œæ˜¯å®ç°å¼‚åœ°å®¹ç¾çš„æ—¶å€™ï¼Œå€ŸåŠ©å…¬æœ‰äº‘æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œæ¯”å¦‚ï¼š</p><ul><li><p>æ•°æ®è·¨æœºæˆ¿åŒæ­¥ï¼Œå¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘çš„DTS(Data Transmission Service) æœåŠ¡ï¼Œç›®å‰DTSæ”¯æŒå…³ç³»å‹æ•°æ®åº“ã€NoSQLã€å¤§æ•°æ®(OLAP)ç­‰æ•°æ®æºé—´çš„æ•°æ®ä¼ è¾“ã€‚ å®ƒæ˜¯ä¸€ç§é›†æ•°æ®è¿ç§»ã€æ•°æ®è®¢é˜…åŠæ•°æ®å®æ—¶åŒæ­¥äºä¸€ä½“çš„æ•°æ®ä¼ è¾“æœåŠ¡ã€‚<br><img alt data-src="/images/multi-live-high-available-architecture-design/%E9%98%BF%E9%87%8C%E4%BA%91DTS%E6%9C%8D%E5%8A%A1.jpg"></p></li><li><p>è·¨æœºæˆ¿åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå¯ä»¥ä½¿ç”¨OceanBaseã€‚é‡‘èç¯å¢ƒä¸‹é€šå¸¸å¯¹æ•°æ®å¯é æ€§æœ‰æ›´é«˜çš„è¦æ±‚ï¼ŒOceanBaseæ¯ä¸€æ¬¡äº‹åŠ¡æäº¤ï¼Œå¯¹åº”æ—¥å¿—æ€»æ˜¯ä¼šåœ¨å¤šä¸ªæ•°æ®ä¸­å¿ƒå®æ—¶åŒæ­¥ï¼Œå¹¶æŒä¹…åŒ–ã€‚å³ä½¿æ˜¯æ•°æ®ä¸­å¿ƒçº§åˆ«çš„ç¾éš¾å‘ç”Ÿï¼Œæ€»æ˜¯å¯ä»¥åœ¨å…¶ä»–çš„æ•°æ®ä¸­å¿ƒæ¢å¤æ¯ä¸€ç¬”å·²ç»å®Œæˆçš„äº¤æ˜“ï¼Œå®ç°äº†çœŸæ­£é‡‘èçº§åˆ«çš„å¯é æ€§è¦æ±‚ã€‚</p></li><li><p>å¼‚åœ°å¤šæ´»ç”±äºå„ä¸ªå…¬å¸çš„ä¸šåŠ¡ã€åŸºç¡€è®¾æ–½åŠè¦è§£å†³çš„é—®é¢˜çš†ä¸å°½ç›¸åŒï¼Œæ‰€ä»¥é€‰æ‹©é€‚åˆè‡ªå·±çš„å°±å¥½ã€‚</p></li><li><p>æˆ–è€…ç›´æ¥ä½¿ç”¨äº‘æ•°æ®åº“RDS MySQL ç‰ˆ<br><img alt data-src="/images/multi-live-high-available-architecture-design/%E4%BA%91%E6%95%B0%E6%8D%AE%E5%BA%93MySQL%E7%89%88.png"></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Architecture </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Architecture </tag>
            
            <tag> Multi-Live </tag>
            
            <tag> High-Available </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PaaSå¹³å°æ¶æ„è®¾è®¡</title>
      <link href="/pass-platform-architecture-design.html"/>
      <url>/pass-platform-architecture-design.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>æ„å»ºä¸€ä¸ªPaaSå¹³å°</p></blockquote><a id="more"></a><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ç›®å‰åœ¨ç”¨çš„PaaSå¹³å°æ˜¯ä¹‹å‰è´­ä¹°çš„ä¸€ä¸ªå•†ä¸šäº§å“ï¼Œä½†æ²¡æœ‰æºç ï¼Œè¿ç»´æœŸä¹Ÿæ—©å°±ç»“æŸäº†ï¼Œæ‰€ä»¥åœ¨åæœŸä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šé‡åˆ°ä¸€äº›å„ç§å„æ ·çš„é—®é¢˜ï¼Œå¯¹äºä½¿ç”¨ã€è¿ç»´éƒ½é€ æˆä¸€å®šçš„å›°æ‰°ã€‚</p><p>è€PaaSçš„æ¶æ„åŠåŸºæœ¬åŠŸèƒ½å¦‚ä¸‹ï¼š<br><img alt data-src="/images/pass-platform-design/%E8%80%81PaaS%E6%9E%B6%E6%9E%84.png"></p><h1 id="é‡æ„"><a href="#é‡æ„" class="headerlink" title="é‡æ„"></a>é‡æ„</h1><p>ä¸ºä»€ä¹ˆé€‰æ‹©é‡æ„PaaSå¹³å°è€Œä¸æ˜¯å…¨éƒ¨è¿ç§»kubernatesé›†ç¾¤ï¼Ÿ<br>kubernatesé›†ç¾¤çš„ç¡®æä¾›äº†å¾ˆå¤šä¼˜ç§€çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼šRCã€æ»šåŠ¨æ›´æ–°æˆ–å›æ»šã€èµ„æºç›‘æ§å’Œæ—¥å¿—è®°å½•ã€è´Ÿè½½å‡è¡¡ç­‰ç­‰ã€‚</p><p>ä½†åœ¨ç›®å‰æˆ‘ä»¬è¿™è¾¹çš„ç¯å¢ƒæ¥çœ‹ï¼Œè¿ç§»kubernatesé›†ç¾¤æœ‰å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>æ— æ³•æ— æ„ŸçŸ¥è¿ç§»ï¼Œå³è¿ç§»åˆ°kubernatesé›†ç¾¤çš„è¿‡ç¨‹ä¸­åŠè¿ç§»åˆ°kubernatesé›†ç¾¤åï¼Œä¸å¢åŠ ç”¨æˆ·çš„ä½¿ç”¨ã€å­¦ä¹ æˆæœ¬ï¼Œä½†åº”ç”¨å¼•å…¥kubernatesé›†ç¾¤ä¹‹åï¼Œå¾ˆéš¾ä¿è¯è¿™ä¸€ç‚¹ã€‚å› ä¸ºæˆ‘ä»¬è¿™è¾¹çš„ç”¨æˆ·å¤§å¤šæ˜¯æˆ‘ä»¬å…¬å¸çš„ä¾›åº”å•†ï¼Œä¾›åº”å•†å…¶å®ä¸å¤ªå…³å¿ƒï¼Œä½ å¹³å°æ‰€æä¾›çš„å„ç§æ–°ç‰¹æ€§ã€åŠŸèƒ½ï¼Œæ›´ä¸æƒ³å› ä¸ºè¿™äº›æ–°ç‰¹æ€§ã€åŠŸèƒ½å¢åŠ ä»–ä»¬çš„ä½¿ç”¨ã€å­¦ä¹ æˆæœ¬ã€‚</li><li>æˆ‘ä»¬è¿™è¾¹å¾ˆå¤šé¡¹ç›®æœ¬èº«æ˜¯æœ‰ç¡¬è´Ÿè½½çš„ï¼Œæ¯”å¦‚F5ï¼Œæ‰€ä»¥kubernatesæä¾›çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¾çš„ä¸é‚£ä¹ˆé‡è¦ã€‚</li><li>æ—¥å¿—éƒ¨åˆ†ï¼Œæˆ‘ä»¬å·²ç»æ‰“é€šå„ä¸ªå¹³å°çš„æ—¥å¿—ã€ç›‘æ§ï¼Œä¸å†éœ€å…¶ä»–çš„ç»„ä»¶ã€‚</li><li>æ»šåŠ¨æ›´æ–°æˆ–å›æ»šï¼Œè€PaaSå¹³å°æœ¨æœ‰ï¼Œé‡æ„åæ–°ç‰ˆä¸­å‡†å¤‡åŠ å…¥ï¼ˆäºŒæœŸï¼‰ã€‚</li><li>RCç±»ä¼¼åŠŸèƒ½ï¼Œç›®å‰ä¸æ‰“ç®—æ”¯æŒã€‚</li></ul><h2 id="æ¶æ„åŠç”¨åˆ°ç»„ä»¶æ¢³ç†"><a href="#æ¶æ„åŠç”¨åˆ°ç»„ä»¶æ¢³ç†" class="headerlink" title="æ¶æ„åŠç”¨åˆ°ç»„ä»¶æ¢³ç†"></a>æ¶æ„åŠç”¨åˆ°ç»„ä»¶æ¢³ç†</h2><p><img alt data-src="/images/pass-platform-design/%E6%96%B0PaaS%E6%9E%B6%E6%9E%84%E5%8F%8A%E7%BB%84%E4%BB%B6.png"></p><h2 id="æ–°PaaSåŠŸèƒ½ç‚¹æ¢³ç†"><a href="#æ–°PaaSåŠŸèƒ½ç‚¹æ¢³ç†" class="headerlink" title="æ–°PaaSåŠŸèƒ½ç‚¹æ¢³ç†"></a>æ–°PaaSåŠŸèƒ½ç‚¹æ¢³ç†</h2><p><img alt data-src="/images/pass-platform-design/PaaS%E5%8A%9F%E8%83%BD%E7%82%B9.png"></p><h1 id="è¿ç§»"><a href="#è¿ç§»" class="headerlink" title="è¿ç§»"></a>è¿ç§»</h1><p>é€šè¿‡æ— ç¼è¿ç§»ï¼Œåœ¨ç”¨æˆ·æ— æ„ŸçŸ¥çš„æƒ…å†µä¸‹å®ç°è¿ç§»ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆè¦åšåˆ°æ— æ„ŸçŸ¥è¿ç§»ï¼Ÿ<br>è€PaaSä¸­ç›®å‰çš„é¡¹ç›®æ•°é‡æ˜¯ï¼š193ä¸ªï¼Œåº”ç”¨æ•°é‡æ˜¯ï¼š673ä¸ª<br>æ€»å®ä¾‹æ•°ï¼š1485ï¼Œå…¶ä¸­ç”Ÿäº§ç¯å¢ƒçš„å®ä¾‹æ•°ï¼š894<br>å¦‚æœè¿™äº›é¡¹ç›®ã€åº”ç”¨ï¼Œå› ä¸ºä½ çš„é‡æ„éƒ½éœ€è¦æ”¹åŠ¨çš„è¯ï¼Œé‚£ä¹ˆæ¨å¹¿éš¾åº¦æ˜¯å¾ˆå¤§çš„ï¼Œæ‰€ä»¥éœ€è¦å°½é‡åšåˆ°ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´æ— æ„ŸçŸ¥è¿ç§»ã€‚</p></blockquote><p>ä»¥ä¸‹è¿ç§»éƒ¨åˆ†ï¼Œéƒ½éœ€è¦åœ¨æ–°PaaSä¸Šçº¿å‰å®Œæˆå¹¶åœ¨ä¸Šçº¿ä¸€æ®µæ—¶é—´å‡†å®æ—¶åŒæ­¥è¿‡æ¥ã€‚<br><img alt data-src="/images/pass-platform-design/%E8%80%81PaaS%E8%BF%81%E7%A7%BB.png"></p>]]></content>
      
      
      <categories>
          
          <category> Architecture </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Architecture </tag>
            
            <tag> PaaS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java åƒåœ¾å›æ”¶ç®—æ³•ä¹‹G1</title>
      <link href="/java-gc-g1.html"/>
      <url>/java-gc-g1.html</url>
      
        <content type="html"><![CDATA[<p>G1(Garbage-First)å›æ”¶å™¨æ˜¯åœ¨JDK1.7ä¸­æ­£å¼ä½¿ç”¨çš„å…¨æ–°åƒåœ¾å›æ”¶å™¨ï¼ŒG1æ‹¥æœ‰ç‹¬ç‰¹çš„åƒåœ¾å›æ”¶ç­–ç•¥ï¼Œä»åˆ†ä»£ä¸Šçœ‹ï¼ŒG1ä¾ç„¶å±äºåˆ†ä»£åƒåœ¾å›æ”¶å™¨ï¼Œå®ƒä¼šåŒºåˆ†å¹´ä»£å’Œè€å¹´ä»£ï¼Œä¾ç„¶æœ‰edenå’ŒsurvivoråŒºï¼Œä½†ä»å †çš„ç»“æ„ä¸Šçœ‹ï¼Œå®ƒå¹¶ä¸è¦æ±‚æ•´ä¸ªedenåŒºã€å¹´æ¸…ä»£æˆ–è€…è€å¹´ä»£éƒ½è¿ç»­ã€‚å®ƒä½¿ç”¨äº†å…¨æ–°çš„åˆ†åŒºç®—æ³•ã€‚</p><p>å…¶ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>å¹¶è¡Œæ€§ï¼šG1åœ¨å›æ”¶æœŸé—´ï¼Œå¯ä»¥ç”±å¤šä¸ªGCçº¿ç¨‹åŒæ—¶å·¥ä½œï¼Œæœ‰æ•ˆåˆ©ç”¨å¤šæ ¸è®¡ç®—èƒ½åŠ›ã€‚</p></li><li><p>å¹¶å‘æ€§ï¼šG1æ‹¥æœ‰ä¸åº”ç”¨ç¨‹åºäº¤æ›¿æ‰§è¡Œçš„èƒ½åŠ›ï¼Œå› æ­¤ä¸€èˆ¬æ¥è¯´ï¼Œä¸ä¼šåœ¨æ•´ä¸ªå›æ”¶æœŸé—´å®Œå…¨é˜»å¡åº”ç”¨ç¨‹åºã€‚</p></li><li><p>åˆ†ä»£GCï¼šä¸ä¹‹å‰å›æ”¶å™¨ä¸åŒï¼Œå…¶ä»–å›æ”¶å™¨ï¼Œå®ƒä»¬è¦ä¹ˆå·¥ä½œåœ¨å¹´è½»ä»£è¦ä¹ˆå·¥ä½œåœ¨è€å¹´ä»£ã€‚G1å¯ä»¥åŒæ—¶å…¼é¡¾å¹´è½»ä»£ä¸è€å¹´ä»£ã€‚</p></li><li><p>ç©ºé—´æ•´ç†ï¼šG1åœ¨å›æ”¶è¿‡ç¨‹ä¸­ï¼Œä¼šè¿›è¡Œé€‚å½“çš„å¯¹è±¡ç§»åŠ¨ï¼Œä¸åƒCMSï¼Œåªæ˜¯ç®€å•çš„æ ‡è®°æ¸…é™¤ï¼Œåœ¨è‹¥å¹²æ¬¡GCåCMSå¿…é¡»è¿›è¡Œä¸€æ¬¡ç¢ç‰‡æ•´ç†ï¼ŒG1åœ¨æ¯æ¬¡å›æ”¶æ—¶éƒ½ä¼šæœ‰æ•ˆçš„å¤åˆ¶å¯¹è±¡ï¼Œå‡å°‘ç©ºé—´ç¢ç‰‡ã€‚</p></li><li><p>å¯é¢„è§æ€§ï¼šç”±äºåˆ†åŒºçš„åŸå› ï¼ŒG1å¯ä»¥åªé€‰å–éƒ¨åˆ†åŒºåŸŸè¿›è¡Œå†…å­˜å›æ”¶ï¼Œè¿™æ ·ç¼©å°äº†å›æ”¶èŒƒå›´ï¼Œå› æ­¤å¯¹äºå…¨å±€åœé¡¿ä¹Ÿèƒ½å¾—åˆ°æ›´å¥½çš„æ§åˆ¶ã€‚</p></li></ul><h1 id="ä¸€ã€G1çš„å†…å­˜åˆ’åˆ†å’Œä¸»è¦æ”¶é›†è¿‡ç¨‹"><a href="#ä¸€ã€G1çš„å†…å­˜åˆ’åˆ†å’Œä¸»è¦æ”¶é›†è¿‡ç¨‹" class="headerlink" title="ä¸€ã€G1çš„å†…å­˜åˆ’åˆ†å’Œä¸»è¦æ”¶é›†è¿‡ç¨‹"></a>ä¸€ã€G1çš„å†…å­˜åˆ’åˆ†å’Œä¸»è¦æ”¶é›†è¿‡ç¨‹</h1><p>G1æ”¶é›†å›æ”¶å™¨å°†å †è¿›è¡Œåˆ†åŒºï¼Œåˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªçš„åŒºåŸŸï¼Œæ¯æ¬¡æ”¶é›†çš„æ—¶å€™ï¼Œåªæ”¶é›†å…¶ä¸­å‡ ä¸ªåŒºåŸŸï¼Œä»¥æ­¤æ¥æ§åˆ¶åƒåœ¾å›æ”¶äº§ç”Ÿä¸€æ¬¡åœé¡¿æ—¶é—´ã€‚</p><p>G1çš„æ”¶é›†è¿‡ç¨‹å¯èƒ½æœ‰4ä¸ªé˜¶æ®µï¼š</p><ul><li><p>æ–°ç”Ÿä»£GC</p></li><li><p>å¹¶å‘æ ‡è®°å‘¨æœŸ</p></li><li><p>æ··åˆæ”¶é›†</p></li><li><p>ï¼ˆå¦‚æœéœ€è¦ï¼‰è¿›è¡ŒFull GCã€‚</p></li></ul><h1 id="äºŒã€G1çš„æ–°ç”Ÿä»£GC"><a href="#äºŒã€G1çš„æ–°ç”Ÿä»£GC" class="headerlink" title="äºŒã€G1çš„æ–°ç”Ÿä»£GC"></a>äºŒã€G1çš„æ–°ç”Ÿä»£GC</h1><p>æ–°ç”Ÿä»£GCçš„ä¸»è¦å·¥ä½œæ˜¯å›æ”¶edenåŒºå’ŒsurvivoråŒºã€‚</p><p>ä¸€æ—¦edenåŒºè¢«å æ»¡ï¼Œæ–°ç”Ÿä»£GCå°±ä¼šå¯åŠ¨ã€‚æ–°ç”Ÿä»£GCæ”¶é›†å‰åçš„å †æ•°æ®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­Eè¡¨ç¤ºedenåŒºï¼ŒSè¡¨ç¤ºsurvivoråŒºï¼ŒOè¡¨ç¤ºè€å¹´ä»£ã€‚</p><p><img alt data-src="/images/java-gc-g1/%E6%96%B0%E7%94%9F%E4%BB%A3.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ–°ç”Ÿä»£GCåªå¤„ç†edenå’ŒsurvivoråŒºï¼Œå›æ”¶åï¼Œæ‰€æœ‰çš„edenåŒºéƒ½åº”è¯¥è¢«æ¸…ç©ºï¼Œè€ŒsurvivoråŒºä¼šè¢«æ”¶é›†ä¸€éƒ¨åˆ†æ•°æ®ï¼Œä½†æ˜¯åº”è¯¥è‡³å°‘ä»ç„¶å­˜åœ¨ä¸€ä¸ªsurvivoråŒºï¼Œç±»æ¯”å…¶ä»–çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œè¿™ä¸€ç‚¹ä¼¼ä¹å¹¶æ²¡æœ‰å¤ªå¤§å˜åŒ–ã€‚å¦ä¸€ä¸ªé‡è¦çš„å˜åŒ–æ˜¯è€å¹´ä»£çš„åŒºåŸŸå¢å¤šï¼Œå› ä¸ºéƒ¨åˆ†survivoråŒºæˆ–è€…edenåŒºçš„å¯¹è±¡å¯èƒ½ä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚</p><p>ä¸‰ã€G1å¹¶å‘æ ‡è®°å‘¨æœŸ</p><p>G1çš„å¹¶å‘é˜¶æ®µå’ŒCMSæœ‰äº›ç±»ä¼¼ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸ºäº†é™ä½ä¸€æ¬¡åœé¡¿æ—¶é—´ï¼Œè€Œå°†å¯ä»¥å’Œåº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œçš„éƒ¨åˆ†å•ç‹¬æå–å‡ºæ¥æ‰§è¡Œã€‚</p><blockquote><p>å¹¶å‘æ ‡è®°å‘¨æœŸé’ˆå¯¹è€å¹´ä»£</p></blockquote><p>å¹¶å‘æ ‡è®°å‘¨æœŸå¯åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><ul><li><p>åˆå§‹æ ‡è®°ï¼šæ ‡è®°ä»æ ¹èŠ‚ç‚¹ç›´æ¥å¯è¾¾çš„å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µä¼šä¼´éšä¸€æ¬¡æ–°ç”Ÿä»£GCï¼Œå®ƒæ˜¯ä¼šäº§ç”Ÿ<font color="DeepPink">å…¨å±€åœé¡¿</font>çš„ï¼Œåº”ç”¨ç¨‹åºåœ¨è¿™ä¸ªé˜¶æ®µå¿…é¡»åœæ­¢æ‰§è¡Œã€‚</p></li><li><p>æ ¹åŒºåŸŸæ‰«æï¼šç”±äºåˆå§‹æ ‡è®°å¿…ç„¶ä¼šä¼´éšä¸€æ¬¡æ–°ç”Ÿä»£GCï¼Œæ‰€ä»¥åœ¨åˆå§‹åŒ–æ ‡è®°åï¼Œedenè¢«æ¸…ç©ºï¼Œå¹¶ä¸”å­˜æ´»å¯¹è±¡è¢«ç§»åˆ°survivoråŒºã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå°†æ‰«æç”±survivoråŒºç›´æ¥å¯è¾¾çš„è€å¹´ä»£åŒºåŸŸï¼Œå¹¶æ ‡è®°è¿™äº›ç›´æ¥å¯è¾¾çš„å¯¹è±¡ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å¯ä»¥å’Œåº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œçš„ã€‚ä½†æ˜¯æ ¹åŒºåŸŸæ‰«æä¸èƒ½å’Œæ–°ç”Ÿä»£GCåŒæ—¶å‘ç”Ÿï¼ˆå› ä¸ºæ ¹åŒºåŸŸæ‰«æä¾èµ–survivoråŒºçš„å¯¹è±¡ï¼Œè€Œæ–°ç”Ÿä»£GCä¼šä¿®æ”¹è¿™ä¸ªåŒºåŸŸï¼‰ï¼Œæ•…å¦‚æœæ°å·§æ­¤æ—¶éœ€è¦æ–°ç”Ÿä»£GCï¼ŒGCå°±éœ€è¦ç­‰å¾…æ ¹åŒºåŸŸæ‰«æç»“æŸåæ‰èƒ½è¿›è¡Œï¼Œå¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œè¿™æ¬¡æ–°ç”Ÿä»£GCçš„æ—¶é—´å°±ä¼šå»¶é•¿ã€‚</p></li><li><p>å¹¶å‘æ ‡è®°ï¼šå’ŒCMSç±»ä¼¼ï¼Œå¹¶å‘æ ‡è®°å°†ä¼šæ‰«æå¹¶æŸ¥æ‰¾æ•´ä¸ªå †çš„å­˜æ´»å¯¹è±¡ï¼Œå¹¶åšå¥½æ ‡è®°ã€‚è¿™æ˜¯ä¸€ä¸ªå¹¶å‘è¿‡ç¨‹ï¼Œå¹¶ä¸”è¿™ä¸ªè¿‡ç¨‹å¯ä»¥è¢«ä¸€æ¬¡æ–°ç”Ÿä»£GCæ‰“æ–­ã€‚</p></li><li><p>é‡æ–°æ ‡è®°ï¼šå’ŒCMSä¸€æ ·ï¼Œé‡æ–°æ ‡è®°ä¹Ÿæ˜¯ä¼šä½¿<font color="DeepPink">åº”ç”¨ç¨‹åºåœé¡¿</font>ï¼Œç”±äºåœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨ç¨‹åºä¾ç„¶è¿è¡Œï¼Œå› æ­¤æ ‡è®°ç»“æœå¯èƒ½éœ€è¦ä¿®æ­£ï¼Œæ‰€ä»¥åœ¨æ­¤é˜¶æ®µå¯¹ä¸Šä¸€æ¬¡æ ‡è®°è¿›è¡Œè¡¥å……ã€‚åœ¨G1ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹ä½¿ç”¨SATBï¼ˆSnapshot-At-The-Beginingï¼‰ç®—æ³•å®Œæˆï¼Œå³G1ä¼šåœ¨æ ‡è®°ä¹‹åˆä¸ºå­˜æ´»å¯¹è±¡åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œè¿™ä¸ªå¿«ç…§æœ‰åŠ©äºåŠ é€Ÿé‡æ–°æ ‡è®°çš„é€Ÿåº¦ã€‚</p></li><li><p>ç‹¬å æ¸…ç†ï¼šé¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªé˜¶æ®µä¼šå¼•èµ·<font color="DeepPink">åœé¡¿</font>ã€‚å®ƒå°†è®¡ç®—å„ä¸ªåŒºåŸŸçš„å­˜æ´»å¯¹è±¡å’ŒGCå›æ”¶æ¯”ä¾‹å¹¶è¿›è¡Œæ’åºï¼Œè¯†åˆ«å¯ä¾›æ··åˆå›æ”¶çš„åŒºåŸŸã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œè¿˜ä¼šæ›´æ–°è®°å¿†é›†ã€‚è¯¥é˜¶æ®µç»™å‡ºäº†éœ€è¦è¢«æ··åˆå›æ”¶çš„åŒºåŸŸå¹¶è¿›è¡Œäº†æ ‡è®°ï¼Œåœ¨æ··åˆå›æ”¶é˜¶æ®µï¼Œéœ€è¦è¿™äº›ä¿¡æ¯ã€‚</p></li><li><p>å¹¶å‘æ¸…ç†é˜¶æ®µï¼šè¯†åˆ«å¹¶æ¸…ç†å®Œå…¨ç©ºé—²çš„åŒºåŸŸã€‚å®ƒæ˜¯å¹¶å‘çš„æ¸…ç†ï¼Œä¸ä¼šå¼•èµ·åœé¡¿ã€‚</p></li></ul><blockquote><p>SATBå…¨ç§°æ˜¯Snapshot-At-The-Beginningï¼Œç”±å­—é¢ç†è§£ï¼Œæ˜¯GCå¼€å§‹æ—¶æ´»ç€çš„å¯¹è±¡çš„ä¸€ä¸ªå¿«ç…§ã€‚å®ƒæ˜¯é€šè¿‡Root Tracingå¾—åˆ°çš„ï¼Œä½œç”¨æ˜¯ç»´æŒå¹¶å‘GCçš„æ­£ç¡®æ€§ã€‚é‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆç»´æŒå¹¶å‘GCçš„æ­£ç¡®æ€§çš„å‘¢ï¼Ÿæ ¹æ®ä¸‰è‰²æ ‡è®°ç®—æ³•ï¼Œæˆ‘ä»¬çŸ¥é“å¯¹è±¡å­˜åœ¨ä¸‰ç§çŠ¶æ€ï¼šç™½ï¼šå¯¹è±¡æ²¡æœ‰è¢«æ ‡è®°åˆ°ï¼Œæ ‡è®°é˜¶æ®µç»“æŸåï¼Œä¼šè¢«å½“åšåƒåœ¾å›æ”¶æ‰ã€‚ç°ï¼šå¯¹è±¡è¢«æ ‡è®°äº†ï¼Œä½†æ˜¯å®ƒçš„fieldè¿˜æ²¡æœ‰è¢«æ ‡è®°æˆ–æ ‡è®°å®Œã€‚é»‘ï¼šå¯¹è±¡è¢«æ ‡è®°äº†ï¼Œä¸”å®ƒçš„æ‰€æœ‰fieldä¹Ÿè¢«æ ‡è®°å®Œäº†ã€‚</p></blockquote><blockquote><p>SATB åˆ©ç”¨ write barrier å°†æ‰€æœ‰å³å°†è¢«åˆ é™¤çš„å¼•ç”¨å…³ç³»çš„æ—§å¼•ç”¨è®°å½•ä¸‹æ¥ï¼Œæœ€åä»¥è¿™äº›æ—§å¼•ç”¨ä¸ºæ ¹ Stop The World åœ°é‡æ–°æ‰«æä¸€éå³å¯é¿å…æ¼æ ‡é—®é¢˜ã€‚ å› æ­¤G1 Remarké˜¶æ®µ Stop The World ä¸ CMSäº†çš„remarkæœ‰ä¸€ä¸ªæœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼Œé‚£å°±æ˜¯è¿™ä¸ªæš‚åœåªéœ€è¦æ‰«ææœ‰ write barrier æ‰€è¿½ä¸­å¯¹è±¡ä¸ºæ ¹çš„å¯¹è±¡ï¼Œ è€Œ CMS çš„remark éœ€è¦é‡æ–°æ‰«ææ•´ä¸ªæ ¹é›†åˆï¼Œå› è€ŒCMS remarkæœ‰å¯èƒ½ä¼šéå¸¸æ…¢ã€‚</p></blockquote><h1 id="å››ã€æ··åˆå›æ”¶"><a href="#å››ã€æ··åˆå›æ”¶" class="headerlink" title="å››ã€æ··åˆå›æ”¶"></a>å››ã€æ··åˆå›æ”¶</h1><p><strong>åœ¨å¹¶å‘æ ‡è®°å‘¨æœŸä¸­ï¼Œè™½æœ‰éƒ¨åˆ†å¯¹è±¡è¢«å›æ”¶ï¼Œä½†æ˜¯å›æ”¶çš„æ¯”ä¾‹æ˜¯éå¸¸ä½çš„ã€‚ä½†æ˜¯åœ¨å¹¶å‘æ ‡è®°å‘¨æœŸåï¼ŒG1å·²ç»æ˜ç¡®çŸ¥é“å“ªäº›åŒºåŸŸå«æœ‰æ¯”è¾ƒå¤šçš„åƒåœ¾å¯¹è±¡ï¼Œåœ¨æ··åˆå›æ”¶é˜¶æ®µï¼Œå°±å¯ä»¥ä¸“é—¨é’ˆå¯¹è¿™äº›åŒºåŸŸè¿›è¡Œå›æ”¶ã€‚å½“ç„¶G1ä¼šä¼˜å…ˆå›æ”¶åƒåœ¾æ¯”ä¾‹è¾ƒé«˜çš„åŒºåŸŸï¼ˆå›æ”¶è¿™äº›åŒºåŸŸçš„æ€§ä»·æ¯”é«˜ï¼‰ï¼Œè¿™æ­£æ˜¯G1åå­—çš„ç”±æ¥ï¼ˆGarbage First Garbage Collectorï¼šè¯‘ä¸ºåƒåœ¾ä¼˜å…ˆçš„åƒåœ¾å›æ”¶å™¨ï¼‰ï¼Œè¿™é‡Œçš„åƒåœ¾ä¼˜å…ˆï¼ˆGarbage Firstï¼‰æŒ‡çš„æ˜¯å›æ”¶æ—¶ä¼˜å…ˆé€‰å–åƒåœ¾æ¯”ä¾‹æœ€é«˜çš„åŒºåŸŸã€‚</strong></p><p>è¿™ä¸ªé˜¶æ®µå«åšæ··åˆå›æ”¶ï¼Œæ˜¯å› ä¸ºåœ¨è¿™ä¸ªé˜¶æ®µï¼Œå³ä¼šæ‰§è¡Œæ­£å¸¸çš„å¹´è½»ä»£GC,åˆä¼šé€‰å–ä¸€äº›è¢«æ ‡è®°çš„è€å¹´ä»£åŒºåŸŸè¿›è¡Œå›æ”¶ï¼ŒåŒæ—¶å¤„ç†äº†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚</p><p><font color="DeepPink">æ··åˆå›æ”¶ä¼šè¢«æ‰§è¡Œå¤šæ¬¡ï¼Œç›´åˆ°å›æ”¶äº†è¶³å¤Ÿå¤šçš„å†…å­˜ç©ºé—´</font>ï¼Œç„¶åï¼Œå®ƒä¼šè§¦å‘ä¸€æ¬¡æ–°ç”Ÿä»£GCã€‚æ–°ç”Ÿä»£GCåï¼Œåˆå¯èƒ½ä¼šå‘ç”Ÿä¸€æ¬¡å¹¶å‘æ ‡è®°å‘¨æœŸçš„å¤„ç†ï¼Œæœ€ååˆä¼šå¼•èµ·æ··åˆå›æ”¶ï¼Œå› æ­¤æ•´ä¸ªè¿‡ç¨‹å¯èƒ½æ˜¯å¦‚ä¸‹å›¾ï¼š</p><p><img alt data-src="/images/java-gc-g1/%E5%9B%9E%E6%94%B6%E5%BE%AA%E7%8E%AF.png"></p><h1 id="äº”ã€å¿…è¦æ—¶çš„Full-GC"><a href="#äº”ã€å¿…è¦æ—¶çš„Full-GC" class="headerlink" title="äº”ã€å¿…è¦æ—¶çš„Full GC"></a>äº”ã€å¿…è¦æ—¶çš„Full GC</h1><p>å’ŒCMSç±»ä¼¼ï¼Œå¹¶å‘æ”¶é›†è®©åº”ç”¨ç¨‹åºå’ŒGCçº¿ç¨‹äº¤æ›¿å·¥ä½œï¼Œå› æ­¤åœ¨ç‰¹åˆ«ç¹å¿™çš„æƒ…å†µä¸‹æ— å¯é¿å…çš„ä¼šå‘ç”Ÿå›æ”¶è¿‡ç¨‹ä¸­å†…å­˜ä¸è¶³çš„æƒ…å†µï¼Œå½“é‡åˆ°è¿™ç§æƒ…å†µï¼ŒG1ä¼šè½¬å…¥ä¸€ä¸ªFull GC è¿›è¡Œå›æ”¶ã€‚</p><p>ä»¥ä¸‹4ç§æƒ…å†µä¼šè§¦å‘è¿™ç±»çš„Full GCï¼š</p><h2 id="1ã€å¹¶å‘æ¨¡å¼å¤±æ•ˆ"><a href="#1ã€å¹¶å‘æ¨¡å¼å¤±æ•ˆ" class="headerlink" title="1ã€å¹¶å‘æ¨¡å¼å¤±æ•ˆ"></a>1ã€å¹¶å‘æ¨¡å¼å¤±æ•ˆ</h2><p>G1å¯åŠ¨æ ‡è®°å‘¨æœŸï¼Œä½†åœ¨Mix GCä¹‹å‰ï¼Œè€å¹´ä»£å°±è¢«å¡«æ»¡ï¼Œè¿™æ—¶å€™G1ä¼šæ”¾å¼ƒæ ‡è®°å‘¨æœŸã€‚è¿™ç§æƒ…å½¢ä¸‹ï¼Œéœ€è¦å¢åŠ å †å¤§å°ï¼Œæˆ–è€…è°ƒæ•´å‘¨æœŸï¼ˆä¾‹å¦‚å¢åŠ çº¿ç¨‹æ•°-XX:ConcGCThreadsç­‰ï¼‰ã€‚</p><p>GCæ—¥å¿—å¦‚ä¸‹çš„ç¤ºä¾‹ï¼š</p><p><img alt data-src="/images/java-gc-g1/%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%BC%8F%E5%A4%B1%E6%95%88.png"></p><p>è§£å†³åŠæ³•ï¼šå‘ç”Ÿè¿™ç§å¤±è´¥æ„å‘³ç€å †çš„å¤§å°åº”è¯¥å¢åŠ äº†ï¼Œæˆ–è€…G1æ”¶é›†å™¨çš„åå°å¤„ç†åº”è¯¥æ›´æ—©å¼€å§‹ï¼Œæˆ–è€…éœ€è¦è°ƒæ•´å‘¨æœŸï¼Œè®©å®ƒè¿è¡Œå¾—æ›´å¿«ï¼ˆå¦‚ï¼Œå¢åŠ åå°å¤„ç†çš„çº¿ç¨‹æ•°ï¼‰ã€‚</p><h2 id="2ã€æ™‹å‡å¤±è´¥"><a href="#2ã€æ™‹å‡å¤±è´¥" class="headerlink" title="2ã€æ™‹å‡å¤±è´¥"></a>2ã€æ™‹å‡å¤±è´¥</h2><p>ï¼ˆto-space exhaustedæˆ–è€…to-space overflowï¼‰</p><p>G1æ”¶é›†å™¨å®Œæˆäº†æ ‡è®°é˜¶æ®µï¼Œå¼€å§‹å¯åŠ¨æ··åˆå¼åƒåœ¾å›æ”¶ï¼Œæ¸…ç†è€å¹´ä»£çš„åˆ†åŒºï¼Œä¸è¿‡ï¼Œè€å¹´ä»£ç©ºé—´åœ¨åƒåœ¾å›æ”¶é‡Šæ”¾å‡ºè¶³å¤Ÿå†…å­˜ä¹‹å‰å°±ä¼šè¢«è€—å°½ã€‚ï¼ˆG1åœ¨è¿›è¡ŒGCçš„æ—¶å€™æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ä¾›å­˜æ´»å¯¹è±¡æˆ–æ™‹å‡å¯¹è±¡ä½¿ç”¨ï¼‰ï¼Œç”±æ­¤è§¦å‘äº†Full GCã€‚</p><p>ä¸‹é¢æ—¥å¿—ä¸­ï¼ˆå¯ä»¥åœ¨æ—¥å¿—ä¸­çœ‹åˆ°(to-space exhausted)æˆ–è€…ï¼ˆto-space overflowï¼‰ï¼‰ï¼Œååº”çš„ç°è±¡æ˜¯æ··åˆå¼GCä¹‹åç´§æ¥ç€ä¸€æ¬¡Full GCã€‚</p><p><img alt data-src="/images/java-gc-g1/%E6%99%8B%E5%8D%87%E5%A4%B1%E8%B4%A5.png"></p><p>è¿™ç§å¤±è´¥é€šå¸¸æ„å‘³ç€æ··åˆå¼æ”¶é›†éœ€è¦æ›´è¿…é€Ÿçš„å®Œæˆåƒåœ¾æ”¶é›†ï¼šæ¯æ¬¡æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†éœ€è¦å¤„ç†æ›´å¤šè€å¹´ä»£çš„åˆ†åŒºã€‚</p><p>è§£å†³è¿™ç§é—®é¢˜çš„æ–¹å¼æ˜¯ï¼š</p><ul><li><p>å¢åŠ  -XX:G1ReservePercenté€‰é¡¹çš„å€¼ï¼ˆå¹¶ç›¸åº”å¢åŠ æ€»çš„å †å¤§å°ï¼‰ï¼Œä¸ºâ€œç›®æ ‡ç©ºé—´â€å¢åŠ é¢„ç•™å†…å­˜é‡ã€‚</p></li><li><p>é€šè¿‡å‡å°‘ -XX:InitiatingHeapOccupancyPercent æå‰å¯åŠ¨æ ‡è®°å‘¨æœŸã€‚</p></li><li><p>ä¹Ÿå¯ä»¥é€šè¿‡å¢åŠ  -XX:ConcGCThreads é€‰é¡¹çš„å€¼æ¥å¢åŠ å¹¶è¡Œæ ‡è®°çº¿ç¨‹çš„æ•°ç›®ã€‚</p></li></ul><h2 id="3ã€ç–æ•£å¤±è´¥"><a href="#3ã€ç–æ•£å¤±è´¥" class="headerlink" title="3ã€ç–æ•£å¤±è´¥"></a>3ã€ç–æ•£å¤±è´¥</h2><p>ï¼ˆto-space exhaustedæˆ–è€…to-space overflowï¼‰</p><p>è¿›è¡Œæ–°ç”Ÿä»£åƒåœ¾æ”¶é›†æ˜¯ï¼ŒSurvivorç©ºé—´å’Œè€å¹´ä»£ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å®¹çº³æ‰€æœ‰çš„å¹¸å­˜å¯¹è±¡ã€‚è¿™ç§æƒ…å½¢åœ¨GCæ—¥å¿—ä¸­é€šå¸¸æ˜¯ï¼š</p><p><img alt data-src="/images/java-gc-g1/%E7%96%8F%E6%95%A3%E5%A4%B1%E8%B4%A5.png"></p><p>è¿™æ¡æ—¥å¿—è¡¨æ˜å †å·²ç»å‡ ä¹å®Œå…¨ç”¨å°½æˆ–è€…ç¢ç‰‡åŒ–äº†ã€‚G1æ”¶é›†å™¨ä¼šå°è¯•ä¿®å¤è¿™ä¸€å¤±è´¥ï¼Œä½†å¯ä»¥é¢„æœŸï¼Œç»“æœä¼šæ›´åŠ æ¶åŒ–ï¼šG1æ”¶é›†å™¨ä¼šè½¬è€Œä½¿ç”¨Full GCã€‚</p><p>è§£å†³è¿™ç§é—®é¢˜çš„æ–¹å¼æ˜¯ï¼š</p><ul><li><p>å¢åŠ  -XX:G1ReservePercenté€‰é¡¹çš„å€¼ï¼ˆå¹¶ç›¸åº”å¢åŠ æ€»çš„å †å¤§å°ï¼‰ï¼Œä¸ºâ€œç›®æ ‡ç©ºé—´â€å¢åŠ é¢„ç•™å†…å­˜é‡ã€‚</p></li><li><p>é€šè¿‡å‡å°‘ -XX:InitiatingHeapOccupancyPercent æå‰å¯åŠ¨æ ‡è®°å‘¨æœŸã€‚</p></li><li><p>ä¹Ÿå¯ä»¥é€šè¿‡å¢åŠ  -XX:ConcGCThreads é€‰é¡¹çš„å€¼æ¥å¢åŠ å¹¶è¡Œæ ‡è®°çº¿ç¨‹çš„æ•°ç›®ã€‚</p></li></ul><h2 id="4ã€Humongous-Object-åˆ†é…å¤±è´¥"><a href="#4ã€Humongous-Object-åˆ†é…å¤±è´¥" class="headerlink" title="4ã€Humongous Object åˆ†é…å¤±è´¥"></a>4ã€Humongous Object åˆ†é…å¤±è´¥</h2><p>å½“Humongous Object æ‰¾ä¸åˆ°åˆé€‚çš„ç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œå°±ä¼šå¯åŠ¨Full GCï¼Œæ¥é‡Šæ”¾ç©ºé—´ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥é¿å…åˆ†é…å¤§é‡çš„å·¨å‹å¯¹è±¡ï¼Œå¢åŠ å†…å­˜æˆ–è€…å¢å¤§-XX:G1HeapRegionSizeï¼Œä½¿å·¨å‹å¯¹è±¡ä¸å†æ˜¯å·¨å‹å¯¹è±¡ã€‚</p><blockquote><p>å¯¹äºHumongous Object çš„å¤„ç†è¿˜æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯åˆ‡æ¢GCç®—æ³•åˆ°ZGCï¼Œå› ä¸ºZGCä¸­å¯¹äºHumongous Object çš„å›æ”¶ä¸ä¼šç‰¹æ®Šå¤„ç†ï¼ˆæ¯”å¦‚ä¸ä¼šå»¶è¿Ÿæ”¶é›†ï¼‰ã€‚</p></blockquote><h1 id="å…­ã€å·¨å‹å¯¹è±¡"><a href="#å…­ã€å·¨å‹å¯¹è±¡" class="headerlink" title="å…­ã€å·¨å‹å¯¹è±¡"></a>å…­ã€å·¨å‹å¯¹è±¡</h1><p>Humongous Objectï¼šå·¨å‹å¯¹è±¡<br>Humongous regionsï¼šå·¨å‹åŒºåŸŸ</p><p>å¯¹äºG1è€Œè¨€ï¼Œåªè¦è¶…è¿‡reginå¤§å°çš„ä¸€åŠï¼Œå°±è¢«è®¤ä¸ºæ˜¯å·¨å‹å¯¹è±¡ã€‚å·¨å‹å¯¹è±¡ç›´æ¥è¢«åˆ†é…åˆ°è€å¹´ä»£ä¸­çš„â€œå·¨å‹åŒºåŸŸâ€ã€‚è¿™äº›å·¨å‹åŒºåŸŸæ˜¯ä¸€ä¸ªè¿ç»­çš„åŒºåŸŸé›†ã€‚StartsHumongous æ ‡è®°è¯¥è¿ç»­é›†çš„å¼€å§‹ï¼ŒContinuesHumongous æ ‡è®°å®ƒçš„å»¶ç»­ã€‚</p><p>åœ¨åˆ†é…å·¨å‹å¯¹è±¡ä¹‹å‰å…ˆæ£€æŸ¥æ˜¯å¦è¶…è¿‡ initiating heap occupancy percentå’Œthe marking threshold, å¦‚æœè¶…è¿‡çš„è¯ï¼Œå°±å¯åŠ¨global concurrent markingï¼Œä¸ºçš„æ˜¯ææ—©å›æ”¶ï¼Œé˜²æ­¢ evacuation failures å’Œ Full GCã€‚</p><p>å¯¹äºå·¨å‹å¯¹è±¡ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼š</p><ul><li><p>æ²¡æœ‰è¢«å¼•ç”¨çš„å·¨å‹å¯¹è±¡ä¼šåœ¨æ ‡è®°æ¸…ç†é˜¶æ®µæˆ–è€…Full GCæ—¶è¢«é‡Šæ”¾æ‰ã€‚</p></li><li><p>ä¸ºäº†å‡å°‘æ‹·è´è´Ÿè½½ï¼Œåªæœ‰åœ¨Full GCçš„æ—¶å€™ï¼Œæ‰ä¼šå‹ç¼©å¤§å¯¹è±¡regionã€‚</p></li><li><p>æ¯ä¸€ä¸ªregionä¸­éƒ½åªæœ‰ä¸€ä¸ªå·¨å‹å¯¹è±¡ï¼Œè¯¥regionå‰©ä½™çš„éƒ¨åˆ†å¾—ä¸åˆ°åˆ©ç”¨ï¼Œä¼šå¯¼è‡´å †ç¢ç‰‡åŒ–ã€‚</p></li><li><p>å¦‚æœçœ‹åˆ°ç”±äºå¤§å¯¹è±¡åˆ†é…å¯¼è‡´é¢‘ç¹çš„å¹¶å‘å›æ”¶ï¼Œéœ€è¦æŠŠå¤§å¯¹è±¡å˜ä¸ºæ™®é€šçš„å¯¹è±¡ï¼Œå»ºè®®å¢å¤§Region sizeã€‚ï¼ˆæˆ–è€…åˆ‡æ¢åˆ°ZGCï¼‰</p></li></ul><blockquote><p>å¯¹äºå¢å¤§Region sizeæœ‰ä¸€ä¸ªè´Ÿé¢å½±å“å°±æ˜¯ï¼šå‡å°‘äº†å¯ç”¨regionçš„æ•°é‡ã€‚å› æ­¤ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œä½ éœ€è¦è¿›è¡Œç›¸åº”çš„æµ‹è¯•ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦å®é™…æé«˜äº†åº”ç”¨ç¨‹åºçš„ååé‡æˆ–å»¶è¿Ÿã€‚</p></blockquote><h1 id="ä¸ƒã€å¸¸è§è°ƒä¼˜å‚æ•°"><a href="#ä¸ƒã€å¸¸è§è°ƒä¼˜å‚æ•°" class="headerlink" title="ä¸ƒã€å¸¸è§è°ƒä¼˜å‚æ•°"></a>ä¸ƒã€å¸¸è§è°ƒä¼˜å‚æ•°</h1><h2 id="1ã€-XX-MaxGCPauseMillis-N"><a href="#1ã€-XX-MaxGCPauseMillis-N" class="headerlink" title="1ã€-XX:MaxGCPauseMillis=N"></a>1ã€-XX:MaxGCPauseMillis=N</h2><p>é»˜è®¤200æ¯«ç§’</p><p>å‰é¢ä»‹ç»è¿‡ä½¿ç”¨GCçš„æœ€åŸºæœ¬çš„å‚æ•°ï¼š</p><blockquote><p>-XX:+UseG1GC -Xmx32g -XX:MaxGCPauseMillis=200</p></blockquote><p>å‰é¢2ä¸ªå‚æ•°éƒ½å¥½ç†è§£ï¼Œåé¢è¿™ä¸ªMaxGCPauseMilliså‚æ•°è¯¥æ€ä¹ˆé…ç½®å‘¢ï¼Ÿè¿™ä¸ªå‚æ•°ä»å­—é¢çš„æ„æ€ä¸Šçœ‹ï¼Œå°±æ˜¯å…è®¸çš„GCæœ€å¤§çš„æš‚åœæ—¶é—´ã€‚G1å°½é‡ç¡®ä¿æ¯æ¬¡GCæš‚åœçš„æ—¶é—´éƒ½åœ¨è®¾ç½®çš„MaxGCPauseMillisèŒƒå›´å†…ã€‚é‚£G1æ˜¯å¦‚ä½•åšåˆ°æœ€å¤§æš‚åœæ—¶é—´çš„å‘¢ï¼Ÿè¿™æ¶‰åŠåˆ°å¦ä¸€ä¸ªæ¦‚å¿µï¼ŒCSet(collection set)ã€‚å®ƒçš„æ„æ€æ˜¯åœ¨ä¸€æ¬¡åƒåœ¾æ”¶é›†å™¨ä¸­è¢«æ”¶é›†çš„åŒºåŸŸé›†åˆã€‚</p><ul><li><p>Young GCï¼šé€‰å®šæ‰€æœ‰æ–°ç”Ÿä»£é‡Œçš„regionã€‚é€šè¿‡æ§åˆ¶æ–°ç”Ÿä»£çš„regionä¸ªæ•°æ¥æ§åˆ¶young GCçš„å¼€é”€ã€‚</p></li><li><p>Mixed GCï¼šé€‰å®šæ‰€æœ‰æ–°ç”Ÿä»£é‡Œçš„regionï¼Œå¤–åŠ æ ¹æ®global concurrent markingç»Ÿè®¡å¾—å‡ºæ”¶é›†æ”¶ç›Šé«˜çš„è‹¥å¹²è€å¹´ä»£regionã€‚åœ¨ç”¨æˆ·æŒ‡å®šçš„å¼€é”€ç›®æ ‡èŒƒå›´å†…å°½å¯èƒ½é€‰æ‹©æ”¶ç›Šé«˜çš„è€å¹´ä»£regionã€‚</p></li></ul><p>åœ¨ç†è§£äº†è¿™äº›åï¼Œæˆ‘ä»¬å†è®¾ç½®æœ€å¤§æš‚åœæ—¶é—´å°±æœ‰äº†æ–¹å‘ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬èƒ½å®¹å¿çš„æœ€å¤§æš‚åœæ—¶é—´æ˜¯æœ‰ä¸€ä¸ªé™åº¦çš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸ªé™åº¦èŒƒå›´å†…è®¾ç½®ã€‚ä½†æ˜¯åº”è¯¥è®¾ç½®çš„å€¼æ˜¯å¤šå°‘å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦åœ¨ååé‡è·ŸMaxGCPauseMillisä¹‹é—´åšä¸€ä¸ªå¹³è¡¡ã€‚å¦‚æœMaxGCPauseMillisè®¾ç½®çš„è¿‡å°ï¼Œé‚£ä¹ˆGCå°±ä¼šé¢‘ç¹ï¼Œååé‡å°±ä¼šä¸‹é™ã€‚å¦‚æœMaxGCPauseMillisè®¾ç½®çš„è¿‡å¤§ï¼Œåº”ç”¨ç¨‹åºæš‚åœæ—¶é—´å°±ä¼šå˜é•¿ã€‚G1çš„é»˜è®¤æš‚åœæ—¶é—´æ˜¯200æ¯«ç§’ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™é‡Œå…¥æ‰‹ï¼Œè°ƒæ•´åˆé€‚çš„æ—¶é—´ã€‚</p><h2 id="2ã€-XX-G1HeapRegionSize-n"><a href="#2ã€-XX-G1HeapRegionSize-n" class="headerlink" title="2ã€-XX:G1HeapRegionSize=n"></a>2ã€-XX:G1HeapRegionSize=n</h2><p>è®¾ç½®çš„ G1 åŒºåŸŸçš„å¤§å°ã€‚å€¼æ˜¯ 2 çš„å¹‚ï¼ŒèŒƒå›´æ˜¯ 1 MB åˆ° 32 MB ä¹‹é—´ã€‚ç›®æ ‡æ˜¯æ ¹æ®æœ€å°çš„ Java å †å¤§å°åˆ’åˆ†å‡ºçº¦ 2048 ä¸ªåŒºåŸŸã€‚</p><ul><li>-XX:ParallelGCThreads=nï¼ˆè°ƒæ•´G1åƒåœ¾æ”¶é›†çš„åå°çº¿ç¨‹æ•°ï¼‰</li></ul><p>è®¾ç½® STW å·¥ä½œçº¿ç¨‹æ•°çš„å€¼ã€‚å°† n çš„å€¼è®¾ç½®ä¸ºé€»è¾‘å¤„ç†å™¨çš„æ•°é‡ã€‚n çš„å€¼ä¸é€»è¾‘å¤„ç†å™¨çš„æ•°é‡ç›¸åŒï¼Œæœ€å¤šä¸º 8ã€‚</p><p>å¦‚æœé€»è¾‘å¤„ç†å™¨ä¸æ­¢å…«ä¸ªï¼Œåˆ™å°† n çš„å€¼è®¾ç½®ä¸ºé€»è¾‘å¤„ç†å™¨æ•°çš„ 5/8 å·¦å³ã€‚è¿™é€‚ç”¨äºå¤§å¤šæ•°æƒ…å†µï¼Œé™¤éæ˜¯è¾ƒå¤§çš„ SPARC ç³»ç»Ÿï¼Œå…¶ä¸­ n çš„å€¼å¯ä»¥æ˜¯é€»è¾‘å¤„ç†å™¨æ•°çš„ 5/16 å·¦å³ã€‚</p><p>-XX:ConcGCThreads=nï¼ˆè°ƒæ•´G1åƒåœ¾æ”¶é›†çš„åå°çº¿ç¨‹æ•°ï¼‰</p><p>è®¾ç½®å¹¶è¡Œæ ‡è®°çš„çº¿ç¨‹æ•°ã€‚å°† n è®¾ç½®ä¸ºå¹¶è¡Œåƒåœ¾å›æ”¶çº¿ç¨‹æ•° (ParallelGCThreads) çš„ 1/4 å·¦å³ã€‚</p><h2 id="3ã€-XX-InitiatingHeapOccupancyPercent-45ï¼ˆè°ƒæ•´G1åƒåœ¾æ”¶é›†è¿è¡Œé¢‘ç‡ï¼‰"><a href="#3ã€-XX-InitiatingHeapOccupancyPercent-45ï¼ˆè°ƒæ•´G1åƒåœ¾æ”¶é›†è¿è¡Œé¢‘ç‡ï¼‰" class="headerlink" title="3ã€ -XX:InitiatingHeapOccupancyPercent=45ï¼ˆè°ƒæ•´G1åƒåœ¾æ”¶é›†è¿è¡Œé¢‘ç‡ï¼‰"></a>3ã€ -XX:InitiatingHeapOccupancyPercent=45ï¼ˆè°ƒæ•´G1åƒåœ¾æ”¶é›†è¿è¡Œé¢‘ç‡ï¼‰</h2><p>è®¾ç½®è§¦å‘æ ‡è®°å‘¨æœŸçš„ Java å †å ç”¨ç‡é˜ˆå€¼ã€‚é»˜è®¤å ç”¨ç‡æ˜¯æ•´ä¸ª Java å †çš„ 45%ã€‚</p><p>è¯¥å€¼è®¾ç½®å¤ªé«˜ï¼šä¼šé™·å…¥Full GCæ³¥æ½­ä¹‹ä¸­ï¼Œå› ä¸ºå¹¶å‘é˜¶æ®µæ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´åœ¨å‰©ä¸‹çš„å †ç©ºé—´è¢«å¡«æ»¡ä¹‹å‰å®Œæˆåƒåœ¾æ”¶é›†ã€‚</p><p>å¦‚æœè¯¥å€¼è®¾ç½®å¤ªå°ï¼šåº”ç”¨ç¨‹åºåˆä¼šä»¥è¶…è¿‡å®é™…éœ€è¦çš„èŠ‚å¥è¿›è¡Œå¤§é‡çš„åå°å¤„ç†ã€‚</p><p>é¿å…ä½¿ç”¨ä»¥ä¸‹å‚æ•°ï¼šé¿å…ä½¿ç”¨ -Xmn é€‰é¡¹æˆ– -XX:NewRatio ç­‰å…¶ä»–ç›¸å…³é€‰é¡¹æ˜¾å¼è®¾ç½®å¹´è½»ä»£å¤§å°ã€‚å›ºå®šå¹´è½»ä»£çš„å¤§å°ä¼šè¦†ç›–æš‚åœæ—¶é—´ç›®æ ‡ã€‚</p><h1 id="å…«ã€ç»†èŠ‚"><a href="#å…«ã€ç»†èŠ‚" class="headerlink" title="å…«ã€ç»†èŠ‚"></a>å…«ã€ç»†èŠ‚</h1><h2 id="1ã€G1-mixed-GCæ—¶æœºï¼Ÿ"><a href="#1ã€G1-mixed-GCæ—¶æœºï¼Ÿ" class="headerlink" title="1ã€G1 mixed GCæ—¶æœºï¼Ÿ"></a>1ã€G1 mixed GCæ—¶æœºï¼Ÿ</h2><p>mixed gcä¸­ä¹Ÿæœ‰ä¸€ä¸ªé˜ˆå€¼å‚æ•° -XX:InitiatingHeapOccupancyPercentï¼Œå½“è€å¹´ä»£å¤§å°å æ•´ä¸ªå †å¤§å°ç™¾åˆ†æ¯”è¾¾åˆ°è¯¥é˜ˆå€¼æ—¶ï¼Œä¼šè§¦å‘ä¸€æ¬¡mixed gc.</p><p>åœ¨åˆ†é…humongous objectä¹‹å‰å…ˆæ£€æŸ¥æ˜¯å¦è¶…è¿‡ initiating heap occupancy percent, å¦‚æœè¶…è¿‡çš„è¯ï¼Œå°±å¯åŠ¨global concurrent markingï¼Œä¸ºçš„æ˜¯ææ—©å›æ”¶ï¼Œé˜²æ­¢ evacuation failures å’Œ Full GCã€‚</p><p>ä¸ºäº†å‡å°‘è¿ç»­H-objsåˆ†é…å¯¹GCçš„å½±å“ï¼Œéœ€è¦æŠŠå¤§å¯¹è±¡å˜ä¸ºæ™®é€šçš„å¯¹è±¡ï¼Œå»ºè®®å¢å¤§Region sizeã€‚</p><p>ä¸€ä¸ªRegionçš„å¤§å°å¯ä»¥é€šè¿‡å‚æ•°-XX:G1HeapRegionSizeè®¾å®šï¼Œå–å€¼èŒƒå›´ä»1Måˆ°32Mï¼Œä¸”æ˜¯2çš„æŒ‡æ•°ã€‚</p><h2 id="2ã€XXï¼šG1-HeapRegionSize-é»˜è®¤å€¼ï¼Ÿ"><a href="#2ã€XXï¼šG1-HeapRegionSize-é»˜è®¤å€¼ï¼Ÿ" class="headerlink" title="2ã€XXï¼šG1 HeapRegionSize é»˜è®¤å€¼ï¼Ÿ"></a>2ã€XXï¼šG1 HeapRegionSize é»˜è®¤å€¼ï¼Ÿ</h2><p>é»˜è®¤æŠŠå †å†…å­˜æŒ‰ç…§2048ä»½å‡åˆ†ï¼Œæœ€åå¾—åˆ°ä¸€ä¸ªåˆç†çš„å¤§å°ã€‚</p><h2 id="3ã€ç›´æ¥å†…å­˜é…ç½®"><a href="#3ã€ç›´æ¥å†…å­˜é…ç½®" class="headerlink" title="3ã€ç›´æ¥å†…å­˜é…ç½®"></a>3ã€ç›´æ¥å†…å­˜é…ç½®</h2><p>Q: ä»€ä¹ˆæ—¶å€™ç”¨ç›´æ¥å†…å­˜ï¼Ÿ</p><p>A: è¯»å†™é¢‘ç¹çš„åœºåˆï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç›´æ¥å†…å­˜ã€‚</p><p>ç›´æ¥å†…å­˜ä¹Ÿæ˜¯ Java ç¨‹åºä¸­éå¸¸é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯ NIO è¢«å¹¿æ³›ä½¿ç”¨ä¹‹åï¼Œç›´æ¥å†…å­˜å¯ä»¥è·³è¿‡ Java å †ï¼Œä½¿ Java ç¨‹åºå¯ä»¥ç›´æ¥è®¿é—®åŸç”Ÿå †ç©ºé—´ã€‚å› æ­¤å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸ŠåŠ å¿«å†…å­˜çš„è®¿é—®é€Ÿåº¦ã€‚ç›´æ¥å†…å­˜å¯ä»¥ç”¨ -XX:MaxDirectMemorySize è®¾ç½®ï¼Œé»˜è®¤å€¼ä¸ºæœ€å¤§å †ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ -Xmxã€‚å½“ç›´æ¥å†…å­˜è¾¾åˆ°æœ€å¤§å€¼çš„æ—¶å€™ï¼Œä¹Ÿä¼šè§¦å‘åƒåœ¾å›æ”¶ï¼Œå¦‚æœåƒåœ¾å›æ”¶ä¸èƒ½æœ‰æ•ˆé‡Šæ”¾ç©ºé—´ï¼Œç›´æ¥å†…å­˜æº¢å‡ºä¾ç„¶ä¼šå¼•èµ·ç³»ç»Ÿçš„ OOMã€‚</p><p>ä¸€èˆ¬è€Œè¨€ç›´æ¥å†…å­˜åœ¨è®¿é—®è¯»å†™ä¸Šç›´æ¥å†…å­˜æœ‰è¾ƒå¤§ä¼˜åŠ¿ï¼ˆé€Ÿåº¦è¾ƒå¿«ï¼‰ï¼Œä½†æ˜¯åœ¨å†…å­˜ç©ºé—´ç”³è¯·çš„æ—¶å€™ï¼Œç›´æ¥å†…å­˜æ¯«æ— ä¼˜åŠ¿è€Œè¨€ã€‚</p><h2 id="4ã€RSet"><a href="#4ã€RSet" class="headerlink" title="4ã€RSet"></a>4ã€RSet</h2><p>å…¨ç§°æ˜¯Remembered Setï¼Œæ˜¯è¾…åŠ©GCè¿‡ç¨‹çš„ä¸€ç§ç»“æ„ï¼Œå…¸å‹çš„ç©ºé—´æ¢æ—¶é—´å·¥å…·ï¼Œå’ŒCard Tableæœ‰äº›ç±»ä¼¼ã€‚G1çš„RSetæ˜¯åœ¨Card Tableçš„åŸºç¡€ä¸Šå®ç°çš„ï¼šæ¯ä¸ªRegionä¼šè®°å½•ä¸‹åˆ«çš„Regionæœ‰æŒ‡å‘è‡ªå·±çš„æŒ‡é’ˆï¼Œå¹¶æ ‡è®°è¿™äº›æŒ‡é’ˆåˆ†åˆ«åœ¨å“ªäº›Cardçš„èŒƒå›´å†…ã€‚è¿™ä¸ªRSetå…¶å®æ˜¯ä¸€ä¸ªHash Tableï¼ŒKeyæ˜¯åˆ«çš„Regionçš„èµ·å§‹åœ°å€ï¼ŒValueæ˜¯ä¸€ä¸ªé›†åˆï¼Œé‡Œé¢çš„å…ƒç´ æ˜¯Card Tableçš„Indexã€‚</p><p>RSetç©¶ç«Ÿæ˜¯æ€ä¹ˆè¾…åŠ©GCçš„å‘¢ï¼Ÿ</p><p>åœ¨åšYGCçš„æ—¶å€™ï¼Œåªéœ€è¦é€‰å®šyoung generation regionçš„RSetä½œä¸ºæ ¹é›†ï¼Œè¿™äº›RSetè®°å½•äº†old-&gt;youngçš„è·¨ä»£å¼•ç”¨ï¼Œé¿å…äº†æ‰«ææ•´ä¸ªold generationã€‚è€Œmixed gcçš„æ—¶å€™ï¼Œold generationä¸­è®°å½•äº†old-&gt;oldçš„RSetï¼Œyoung-&gt;oldçš„å¼•ç”¨ç”±æ‰«æå…¨éƒ¨young generation regionå¾—åˆ°ï¼Œè¿™æ ·ä¹Ÿä¸ç”¨æ‰«æå…¨éƒ¨old generation regionã€‚æ‰€ä»¥RSetçš„å¼•å…¥å¤§å¤§å‡å°‘äº†GCçš„å·¥ä½œé‡ã€‚</p><h1 id="ä¹ã€JDK-12ä¸­G1çš„æ–°ç‰¹æ€§"><a href="#ä¹ã€JDK-12ä¸­G1çš„æ–°ç‰¹æ€§" class="headerlink" title="ä¹ã€JDK 12ä¸­G1çš„æ–°ç‰¹æ€§"></a>ä¹ã€JDK 12ä¸­G1çš„æ–°ç‰¹æ€§</h1><h2 id="1ã€å¯ä¸­æ–­-mixed-GC"><a href="#1ã€å¯ä¸­æ–­-mixed-GC" class="headerlink" title="1ã€å¯ä¸­æ–­ mixed GC"></a>1ã€å¯ä¸­æ–­ mixed GC</h2><p>å¦‚æœ Mixed GC çš„ G1 å­˜åœ¨è¶…å‡ºæš‚åœç›®æ ‡çš„å¯èƒ½æ€§ï¼Œåˆ™ä½¿å…¶å¯è¢«ä¸­æ­¢ã€‚</p><h2 id="2ã€G1æœªä½¿ç”¨åˆ†é…å†…å­˜å³æ—¶è¿”å›"><a href="#2ã€G1æœªä½¿ç”¨åˆ†é…å†…å­˜å³æ—¶è¿”å›" class="headerlink" title="2ã€G1æœªä½¿ç”¨åˆ†é…å†…å­˜å³æ—¶è¿”å›"></a>2ã€G1æœªä½¿ç”¨åˆ†é…å†…å­˜å³æ—¶è¿”å›</h2><p>å¢å¼º G1åƒåœ¾æ”¶é›†å™¨ï¼Œä»¥ä¾¿åœ¨ç©ºé—²æ—¶è‡ªåŠ¨å°† Java å †å†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚</p><h1 id="åã€GC-å‘å±•è¶‹åŠ¿"><a href="#åã€GC-å‘å±•è¶‹åŠ¿" class="headerlink" title="åã€GC å‘å±•è¶‹åŠ¿"></a>åã€GC å‘å±•è¶‹åŠ¿</h1><p>å…¶å®å¯ä»¥çœ‹åˆ°Java åƒåœ¾å›æ”¶å™¨çš„è¶‹åŠ¿ï¼Œå°±æ˜¯åœ¨å¤§å†…å­˜å †çš„å‰æä¸‹å°½ GC å¯èƒ½çš„é™ä½å¯¹åº”ç”¨ç¨‹åºçš„å½±å“ï¼›ä» CMS çš„åˆ†é˜¶æ®µå¢é‡æ ‡è®°ï¼Œåˆ° G1 é€šè¿‡ SATB ç®—æ³•æ”¹æ­£ remark é˜¶æ®µçš„ Stop The World çš„å½±å“ï¼Œå†åˆ° ZGC/C4ç”šè‡³åœ¨æ ‡è®°é˜¶æ®µæ— éœ€ Stop The Worldï¼Œè«ä¸å¦‚æ­¤ã€‚</p><h1 id="åä¸€ã€ç»“å°¾"><a href="#åä¸€ã€ç»“å°¾" class="headerlink" title="åä¸€ã€ç»“å°¾"></a>åä¸€ã€ç»“å°¾</h1><p>æ¨èå‡ ç§å­¦ä¹ è¿™ç§GCçš„æ–¹å¼ï¼š</p><ul><li><p>çœ‹JEPï¼ˆJDK Enhancement Proposalï¼‰çŸ¥é“å®ƒçš„æ¥é¾™å»è„‰ã€‚</p></li><li><p>çœ‹ç›¸åº”ç®—æ³•çš„paperï¼ˆä¹‹å‰çœ‹Shenandoah GC Paperçš„æ—¶å€™ï¼Œå°±æœ‰ä¸€ç§æ”¶è·å¾ˆå¤§çš„æ„Ÿè§‰ï¼Œå› ä¸ºShenandoah GCçš„å¤„ç†æ–¹å¼ï¼Œä»‹äºG1è·ŸZGCä¹‹é—´ï¼Œæ‰€ä»¥çœ‹äº†Shenandoah GC Paperæ„Ÿè§‰å¯¹äºG1ã€ZGCçš„ç†è§£ä¹Ÿæ›´åŠ æ·±å…¥äº†ï¼‰ã€‚</p></li></ul><p>ä¼šåœ¨æ–‡ç« ç»“æŸï¼Œè¡¥å……ä¸ŠJEPå®˜ç½‘åœ°å€è·Ÿæˆ‘æ”¶é›†çš„ä¸€äº›GCèµ„æ–™ï¼ˆåŒ…å«éƒ¨åˆ†paperï¼‰githubåœ°å€ã€‚</p><p>è¡¥ä¸€ä¸ªæˆ‘è‡ªå·±å½’çº³çš„GCå›¾ï¼š</p><p><img alt data-src="/images/java-gc-g1/GC%E8%84%89%E7%BB%9C.png"></p><p>å„ç§GCç®—æ³•éƒ½æ˜¯å›´ç»•ç€ï¼Œå›¾ä¸­å†…å®¹å±•å¼€çš„ï¼Œåªæ˜¯å„è‡ªçš„å¤„ç†æ–¹å¼ä¸åŒè€Œå·²ã€‚</p><p>èµ„æ–™æ¨èï¼š</p><p>1ã€GCç®—æ³•åŠpaper</p><p><a href="https://github.com/jiankunking/books-recommendation/tree/master/GC" target="_blank" rel="noopener">https://github.com/jiankunking/books-recommendation/tree/master/GC</a></p><p>2ã€Javaç›¸å…³ä¹¦ç±æ¨è</p><p><a href="https://github.com/jiankunking/books-recommendation/tree/master/Java" target="_blank" rel="noopener">https://github.com/jiankunking/books-recommendation/tree/master/Java</a></p><p>å‚è€ƒæ–‡çŒ®</p><p>1ã€å®æˆ˜JAVAè™šæ‹Ÿæœº JVMæ•…éšœè¯Šæ–­ä¸æ€§èƒ½ä¼˜åŒ–</p><p>2ã€jeps</p><p>3ã€å…¶å®ƒ</p><p><a href="https://www.oracle.com/technetwork/articles/java/g1gc-1984535.html" target="_blank" rel="noopener">https://www.oracle.com/technetwork/articles/java/g1gc-1984535.html</a></p><p><a href="https://plumbr.io/handbook/gc-tuning-in-practice/other-examples/humongous-allocations" target="_blank" rel="noopener">https://plumbr.io/handbook/gc-tuning-in-practice/other-examples/humongous-allocations</a></p>]]></content>
      
      
      <categories>
          
          <category> GC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> GC </tag>
            
            <tag> G1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SOFAMosn å¦‚ä½•æé«˜ GoLang çš„è½¬å‘æ€§èƒ½</title>
      <link href="/sofamosn-golang-performance.html"/>
      <url>/sofamosn-golang-performance.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>é€šè¿‡SOFAMosnäº†è§£goroutineåªèƒ½åœ¨ä¸€å®šå¹¶å‘é‡çº§ä¸Šé™ä½å¹¶å‘ç¼–ç¨‹çš„éš¾åº¦(goroutineå†…å­˜å ç”¨2kb+)<br>é«˜å¹¶å‘çš„åœºæ™¯è¿˜æ˜¯NIOæ¯”è¾ƒé€‚åˆ</p></blockquote><a id="more"></a><p>GoLang çš„è½¬å‘æ€§èƒ½æ¯”èµ· C++ è‚¯å®šæ˜¯ç¨æœ‰é€Šè‰²çš„ï¼Œä¸ºäº†å°½å¯èƒ½çš„æé«˜ MOSN çš„è½¬å‘æ€§èƒ½ï¼Œæˆ‘ä»¬åœ¨çº¿ç¨‹æ¨¡å‹ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œå½“å‰ MOSN æ”¯æŒä¸¤ç§çº¿ç¨‹æ¨¡å‹ï¼Œç”¨æˆ·å¯æ ¹æ®åœºæ™¯é€‰æ‹©å¼€å¯é€‚ç”¨çš„æ¨¡å‹ã€‚</p><h1 id="æ¨¡å‹ä¸€"><a href="#æ¨¡å‹ä¸€" class="headerlink" title="æ¨¡å‹ä¸€"></a>æ¨¡å‹ä¸€</h1><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä½¿ç”¨ GoLang é»˜è®¤çš„ epoll æœºåˆ¶ï¼Œå¯¹æ¯ä¸ªè¿æ¥åˆ†é…ç‹¬ç«‹çš„è¯»å†™åç¨‹è¿›è¡Œé˜»å¡è¯»å†™æ“ä½œï¼Œproxy å±‚åšè½¬å‘æ—¶ï¼Œä½¿ç”¨å¸¸é©» worker åç¨‹æ± è´Ÿè´£å¤„ç† Stream Event</p><p><img alt data-src="/images/sofamosn-golang-performance/MOSNThreadModelStage1.png"></p><ul><li>æ­¤æ¨¡å‹åœ¨ IO ä¸Šä½¿ç”¨ GoLang çš„è°ƒåº¦æœºåˆ¶ï¼Œé€‚ç”¨äºè¿æ¥æ•°è¾ƒå°‘çš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼šmosn ä½œä¸º sidecarã€ä¸ client åŒæœºéƒ¨ç½²çš„åœºæ™¯</li></ul><h1 id="æ¨¡å‹äºŒ"><a href="#æ¨¡å‹äºŒ" class="headerlink" title="æ¨¡å‹äºŒ"></a>æ¨¡å‹äºŒ</h1><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŸºäº <a href="https://godoc.org/github.com/mailru/easygo/netpoll" target="_blank" rel="noopener">Netpoll</a> é‡å†™ epoll æœºåˆ¶ï¼Œå°† IO å’Œ PROXY å‡è¿›è¡Œæ± åŒ–ï¼Œdownstream connection å°†è‡ªèº«çš„è¯»å†™äº‹ä»¶æ³¨å†Œåˆ° netpoll çš„ epoll/kqueue wait åç¨‹ï¼Œepoll/kqueue wait åç¨‹æ¥å—åˆ°å¯è¯»äº‹ä»¶ï¼Œè§¦å‘å›è°ƒï¼Œä»åç¨‹æ± ä¸­æŒ‘é€‰ä¸€ä¸ªæ‰§è¡Œè¯»æ“ä½œã€‚</p><p><img alt data-src="/images/sofamosn-golang-performance/MOSNThreadModelStage2.png"></p><ul><li>ä½¿ç”¨è‡ªå®šä¹‰ Netpoll IO æ± åŒ–æ“ä½œå¸¦æ¥çš„å¥½å¤„æ˜¯ï¼š<ul><li>å½“å¯è¯»äº‹ä»¶è§¦å‘æ—¶ï¼Œä»åç¨‹æ± ä¸­è·å–ä¸€ä¸ª goroutine æ¥æ‰§è¡Œè¯»å¤„ç†ï¼Œè€Œä¸æ˜¯æ–°åˆ†é…ä¸€ä¸ª goroutineï¼Œä»¥æ­¤æ¥æ§åˆ¶é«˜å¹¶å‘ä¸‹çš„åç¨‹æ•°é‡</li><li>å½“æ”¶åˆ°é“¾æ¥å¯è¯»äº‹ä»¶æ—¶ï¼Œæ‰çœŸæ­£ä¸ºå…¶åˆ†é… read buffer ä»¥åŠç›¸åº”çš„æ‰§è¡Œåç¨‹ã€‚è¿™æ · GetBytes() å¯ä»¥é™ä½å› ä¸ºå¤§é‡ç©ºé—²é“¾æ¥åœºæ™¯å¯¼è‡´çš„é¢å¤–åç¨‹å’Œ read buffer å¼€é”€</li></ul></li><li>æ­¤æ¨¡å‹é€‚ç”¨äºè¿æ¥æ•°è¾ƒå¤šã€å¯è¯»è¿æ¥æ•°é‡å—é™çš„æƒ…å†µï¼Œä¾‹å¦‚ï¼šmosn ä½œä¸º api gateway çš„åœºæ™¯</li></ul><blockquote><p>æœ¬æ–‡æ•´ç†è‡ªSOFAMosnå®˜æ–¹æ–‡æ¡£</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> SOFAMosn </tag>
            
            <tag> Performance </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ReentrantReadWriteLockåŸç†è§£æ</title>
      <link href="/java-reentrantreadwritelock.html"/>
      <url>/java-reentrantreadwritelock.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>Java JDK 11 ReentrantReadWriteLock åŸç†åˆ†æ</p></blockquote><a id="more"></a><h1 id="1ã€å‰è¨€"><a href="#1ã€å‰è¨€" class="headerlink" title="1ã€å‰è¨€"></a>1ã€å‰è¨€</h1><p>å¸Œæœ›åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œå»ºè®®å…ˆçœ‹ä¸€ä¸‹ä»¥ä¸‹ä¸‰ç¯‡æ–‡ç« ï¼š</p><p>1ã€<a href="https://juejin.im/post/5d37019a51882564c966add6" target="_blank" rel="noopener">é¢è¯•å¿…å¤‡ï¼šJava AQS å®ç°åŸç†ï¼ˆå›¾æ–‡ï¼‰åˆ†æ</a> </p><p>2ã€<a href="https://juejin.im/post/5d3848e951882556d1684532" target="_blank" rel="noopener">é¢è¯•å¿…å¤‡ï¼šJava AQS Conditionçš„å®ç°åˆ†æ</a> </p><p>3ã€<a href="https://juejin.im/post/5d3952bff265da1b7c615dba" target="_blank" rel="noopener">é¢è¯•å¿…å¤‡ï¼šJava volatileçš„å†…å­˜è¯­ä¹‰ä¸AQSé”å†…å­˜å¯è§æ€§</a> </p><p>è¯»å®Œäº†ä»¥ä¸Šä¸‰ç¯‡æ–‡ç« ï¼Œå…ˆçœ‹ä¸€ä¸‹ReentrantReadWriteLockçš„ä»£ç è·¯å¾„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">package java.util.concurrent.locks;</span><br></pre></td></tr></table></figure><p>æ¥å…ˆçŒœä¸€ä¸‹ReentrantReadWriteLockä¼šå¦‚ä½•å®ç°ï¼Ÿ</p><p>éƒ½åœ¨java.util.concurrentåŒ…ä¸‹ï¼Œé‚£ä¹ˆå¯ä»¥æ˜ç¡®ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯å…³äºé”çš„å®ç°ï¼Œåº”è¯¥ç”¨çš„å°±æ˜¯AQSï¼Œé‚£ä¹ˆï¼Œè¯»é”ã€å†™é”ä¼šä¸ä¼šå¯¹åº”çš„å°±æ˜¯AQSä¸­çš„å…±äº«æ¨¡å¼ä¸ç‹¬å æ¨¡å¼ï¼Ÿ</p><h1 id="2ã€è¯»å†™é”ä½¿ç”¨åœºæ™¯"><a href="#2ã€è¯»å†™é”ä½¿ç”¨åœºæ™¯" class="headerlink" title="2ã€è¯»å†™é”ä½¿ç”¨åœºæ™¯"></a>2ã€è¯»å†™é”ä½¿ç”¨åœºæ™¯</h1><p>è¯»æ˜¯å¤šäºå†™ï¼ˆæ¯”å¦‚cacheï¼‰</p><blockquote><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¯»å†™é”çš„æ€§èƒ½éƒ½ä¼šæ¯”æ’å®ƒé”å¥½ï¼Œå› ä¸ºå¤§å¤šæ•°åœºæ™¯è¯»æ˜¯å¤šäºå†™çš„ã€‚åœ¨è¯»å¤šäºå†™çš„æƒ…å†µä¸‹ï¼Œè¯»å†™é”èƒ½å¤Ÿæä¾›æ¯”æ’å®ƒé”æ›´å¥½çš„å¹¶å‘æ€§å’Œååé‡ã€‚</p></blockquote><h1 id="3ã€è¯»å†™é”æ¥å£ï¼šReadWriteLock"><a href="#3ã€è¯»å†™é”æ¥å£ï¼šReadWriteLock" class="headerlink" title="3ã€è¯»å†™é”æ¥å£ï¼šReadWriteLock"></a>3ã€è¯»å†™é”æ¥å£ï¼šReadWriteLock</h1><p>ä»£ç åœ°å€ï¼š<a href="https://github.com/jiankunking/openjdk11/blob/master/src/java.base/share/classes/java/util/concurrent/locks/ReadWriteLock.java" target="_blank" rel="noopener">ReadWriteLock</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public interface ReadWriteLock &#123;</span><br><span class="line">    /**</span><br><span class="line">     * Returns the lock used for reading.</span><br><span class="line">     *</span><br><span class="line">     * @return the lock used for reading</span><br><span class="line">     */</span><br><span class="line">    Lock readLock();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Returns the lock used for writing.</span><br><span class="line">     *</span><br><span class="line">     * @return the lock used for writing</span><br><span class="line">     */</span><br><span class="line">    Lock writeLock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€è¯»å†™é”çš„æ¥å£ä¸ç¤ºä¾‹</p><p>ReadWriteLockä»…å®šä¹‰äº†è·å–è¯»é”å’Œå†™é”çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå³readLock()æ–¹æ³•å’ŒwriteLock()æ–¹æ³•ï¼Œè€Œå…¶å®ç°ï¼šReentrantReadWriteLockï¼Œé™¤äº†æ¥å£æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜æä¾›äº†ä¸€äº›ä¾¿äºå¤–ç•Œç›‘æ§å…¶å†…éƒ¨å·¥ä½œçŠ¶æ€çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä»¥åŠæè¿°å¦‚è¡¨æ‰€ç¤ºï¼š</p><p><img alt data-src="/images/java-reentrantreadwritelock/ReadWriteLock%E6%8E%A5%E5%8F%A3.png"><br>æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªç¼“å­˜ç¤ºä¾‹è¯´æ˜è¯»å†™é”çš„ä½¿ç”¨æ–¹å¼ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class Cache &#123;</span><br><span class="line">    static Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">    static ReentrantReadWriteLock rwl = new ReentrantReadWriteLock();</span><br><span class="line">    static Lock r = rwl.readLock();</span><br><span class="line">    static Lock w = rwl.writeLock();</span><br><span class="line"></span><br><span class="line">    // è·å–ä¸€ä¸ªkeyå¯¹åº”çš„value</span><br><span class="line">    public static final Object get(String key) &#123;</span><br><span class="line">        r.lock();</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            return map.get(key);</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            r.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è®¾ç½®keyå¯¹åº”çš„valueï¼Œå¹¶è¿”å›æ—§çš„value</span><br><span class="line">    public static final Object put(String key, Object value) &#123;</span><br><span class="line">        w.lock();</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            return map.put(key, value);</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            w.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ¸…ç©ºæ‰€æœ‰çš„å†…å®¹</span><br><span class="line">    public static final void clear() &#123;</span><br><span class="line">        w.lock();</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            map.clear();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            w.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒCacheç»„åˆä¸€ä¸ªéçº¿ç¨‹å®‰å…¨çš„HashMapä½œä¸ºç¼“å­˜çš„å®ç°ï¼ŒåŒæ—¶ä½¿ç”¨è¯»å†™é”çš„è¯»é”å’Œå†™é”æ¥ä¿è¯Cacheæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨è¯»æ“ä½œget(String key)æ–¹æ³•ä¸­ï¼Œéœ€è¦è·å–è¯»é”ï¼Œè¿™ä½¿å¾—å¹¶å‘è®¿é—®è¯¥æ–¹æ³•æ—¶ä¸ä¼šè¢«é˜»å¡ã€‚å†™æ“ä½œput(String key,Object value)æ–¹æ³•å’Œclear()æ–¹æ³•ï¼Œåœ¨æ›´æ–°HashMapæ—¶å¿…é¡»æå‰è·å–å†™é”ï¼Œå½“è·å–å†™é”åï¼Œå…¶ä»–çº¿ç¨‹å¯¹äºè¯»é”å’Œå†™é”çš„è·å–å‡è¢«é˜»å¡ï¼Œè€Œåªæœ‰å†™é”è¢«é‡Šæ”¾ä¹‹åï¼Œå…¶ä»–è¯»å†™æ“ä½œæ‰èƒ½ç»§ç»­ã€‚Cacheä½¿ç”¨è¯»å†™é”æå‡è¯»æ“ä½œçš„å¹¶å‘æ€§ï¼Œä¹Ÿä¿è¯æ¯æ¬¡å†™æ“ä½œå¯¹æ‰€æœ‰çš„è¯»å†™æ“ä½œçš„å¯è§æ€§ï¼ŒåŒæ—¶ç®€åŒ–äº†ç¼–ç¨‹æ–¹å¼ã€‚</p><h1 id="5ã€ReentrantReadWriteLockè„‰ç»œæ¢³ç†"><a href="#5ã€ReentrantReadWriteLockè„‰ç»œæ¢³ç†" class="headerlink" title="5ã€ReentrantReadWriteLockè„‰ç»œæ¢³ç†"></a>5ã€ReentrantReadWriteLockè„‰ç»œæ¢³ç†</h1><p>ä»£ç åœ°å€ï¼š<a href="https://github.com/jiankunking/openjdk11/blob/master/src/java.base/share/classes/java/util/concurrent/locks/ReentrantReadWriteLock.java" target="_blank" rel="noopener">ReentrantReadWriteLock</a></p><p>å…ˆçœ‹ä¸€ä¸‹ç»§æ‰¿ç»“æ„ï¼š</p><p><img alt data-src="/images/java-reentrantreadwritelock/%E8%AF%BB%E5%86%99%E9%94%81%E6%8E%A5%E5%8F%A3%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB.png"><br>å†çœ‹ä¸€ä¸‹ä»£ç ç»“æ„ï¼š</p><p><img alt data-src="/images/java-reentrantreadwritelock/%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84.png"><br>å›¾ä¸­å¯ä»¥çœ‹å‡ºReentrantReadWriteLockçš„å®ç°è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ä¸»è¦åˆ†æReentrantReadWriteLockå®ç°å…³é”®ç‚¹ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>è¯»å†™çŠ¶æ€çš„è®¾è®¡</li><li>å†™é”çš„è·å–ä¸é‡Šæ”¾</li><li>è¯»é”çš„è·å–ä¸é‡Šæ”¾</li><li>é”é™çº§</li></ul><h2 id="5-1-è¯»å†™çŠ¶æ€çš„è®¾è®¡"><a href="#5-1-è¯»å†™çŠ¶æ€çš„è®¾è®¡" class="headerlink" title="5.1 è¯»å†™çŠ¶æ€çš„è®¾è®¡"></a>5.1 è¯»å†™çŠ¶æ€çš„è®¾è®¡</h2><p>è¯»å†™é”åŒæ ·ä¾èµ–è‡ªå®šä¹‰åŒæ­¥å™¨æ¥å®ç°åŒæ­¥åŠŸèƒ½ï¼Œè€Œè¯»å†™çŠ¶æ€å°±æ˜¯å…¶åŒæ­¥å™¨çš„åŒæ­¥çŠ¶æ€ã€‚å›æƒ³ReentrantLockä¸­è‡ªå®šä¹‰åŒæ­¥å™¨çš„å®ç°ï¼ŒåŒæ­¥çŠ¶æ€è¡¨ç¤ºé”è¢«ä¸€ä¸ªçº¿ç¨‹é‡å¤è·å–çš„æ¬¡æ•°ï¼Œè€Œè¯»å†™é”çš„è‡ªå®šä¹‰åŒæ­¥å™¨éœ€è¦åœ¨åŒæ­¥çŠ¶æ€ï¼ˆä¸€ä¸ªæ•´å‹å˜é‡ï¼‰ä¸Šç»´æŠ¤å¤šä¸ªè¯»çº¿ç¨‹å’Œä¸€ä¸ªå†™çº¿ç¨‹çš„çŠ¶æ€ï¼Œä½¿å¾—è¯¥çŠ¶æ€çš„è®¾è®¡æˆä¸ºè¯»å†™é”å®ç°çš„å…³é”®ã€‚</p><p>å¦‚æœåœ¨ä¸€ä¸ªæ•´å‹å˜é‡ä¸Šç»´æŠ¤å¤šç§çŠ¶æ€ï¼Œå°±ä¸€å®šéœ€è¦â€œæŒ‰ä½åˆ‡å‰²ä½¿ç”¨â€è¿™ä¸ªå˜é‡ï¼Œè¯»å†™é”å°†å˜é‡åˆ‡åˆ†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œé«˜16ä½è¡¨ç¤ºè¯»ï¼Œä½16ä½è¡¨ç¤ºå†™ï¼Œåˆ’åˆ†æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img alt data-src="/images/java-reentrantreadwritelock/32%E4%BD%8D%E8%AF%BB%E5%86%99%E6%A0%87%E8%AF%86.png"></p><p>å½“å‰åŒæ­¥çŠ¶æ€è¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹å·²ç»è·å–äº†å†™é”ï¼Œä¸”é‡è¿›å…¥äº†ä¸¤æ¬¡ï¼ŒåŒæ—¶ä¹Ÿè¿ç»­è·å–äº†ä¸¤æ¬¡è¯»é”ã€‚è¯»å†™é”æ˜¯å¦‚ä½•è¿…é€Ÿç¡®å®šè¯»å’Œå†™å„è‡ªçš„çŠ¶æ€å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯é€šè¿‡ä½è¿ç®—ã€‚å‡è®¾å½“å‰åŒæ­¥çŠ¶æ€å€¼ä¸ºSï¼Œå†™çŠ¶æ€ç­‰äºS&amp;0x0000FFFFï¼ˆå°†é«˜16ä½å…¨éƒ¨æŠ¹å»ï¼‰ï¼Œè¯»çŠ¶æ€ç­‰äºS&gt;&gt;&gt;16ï¼ˆæ— ç¬¦å·è¡¥0å³ç§»16ä½ï¼‰ã€‚å½“å†™çŠ¶æ€å¢åŠ 1æ—¶ï¼Œç­‰äºS+1ï¼Œå½“è¯»çŠ¶æ€å¢åŠ 1æ—¶ï¼Œç­‰äºS+(1&lt;&lt;16)ï¼Œä¹Ÿå°±æ˜¯S+0x00010000ã€‚</p><blockquote><p>1ã€0x0000FFFF=00000000000000001111111111111111ï¼ˆ16ä¸ª0 16ä¸ª1ï¼‰</p></blockquote><blockquote><p>2ã€&gt;&gt;&gt;ï¼š æ— ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥0è¡¥é½</p></blockquote><blockquote><p>3ã€0x00010000=10000000000000000ï¼ˆ1ä¸ª1 16ä¸ª0ï¼‰</p></blockquote><p>æ ¹æ®çŠ¶æ€çš„åˆ’åˆ†èƒ½å¾—å‡ºä¸€ä¸ªæ¨è®ºï¼šSä¸ç­‰äº0æ—¶ï¼Œå½“å†™çŠ¶æ€ï¼ˆS&amp;0x0000FFFFï¼‰ç­‰äº0æ—¶ï¼Œåˆ™è¯»çŠ¶æ€ï¼ˆS&gt;&gt;&gt;16ï¼‰å¤§äº0ï¼Œå³è¯»é”å·²è¢«è·å–ã€‚</p><h2 id="5-2-å†™é”çš„è·å–ä¸é‡Šæ”¾"><a href="#5-2-å†™é”çš„è·å–ä¸é‡Šæ”¾" class="headerlink" title="5.2 å†™é”çš„è·å–ä¸é‡Šæ”¾"></a>5.2 å†™é”çš„è·å–ä¸é‡Šæ”¾</h2><p>å†™é”æ˜¯ä¸€ä¸ªæ”¯æŒé‡è¿›å…¥çš„æ’å®ƒé”ã€‚å¦‚æœå½“å‰çº¿ç¨‹å·²ç»è·å–äº†å†™é”ï¼Œåˆ™å¢åŠ å†™çŠ¶æ€ã€‚å¦‚æœå½“å‰çº¿ç¨‹åœ¨è·å–å†™é”æ—¶ï¼Œè¯»é”å·²ç»è¢«è·å–ï¼ˆè¯»çŠ¶æ€ä¸ä¸º0ï¼‰æˆ–è€…è¯¥çº¿ç¨‹ä¸æ˜¯å·²ç»è·å–å†™é”çš„çº¿ç¨‹ï¼Œåˆ™å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œè·å–å†™é”çš„ä»£ç å¦‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">protected final boolean tryAcquire(int acquires) &#123;</span><br><span class="line">            /*</span><br><span class="line">             * Walkthrough:</span><br><span class="line">             * 1. If read count nonzero or write count nonzero</span><br><span class="line">             *    and owner is a different thread, fail.</span><br><span class="line">             * 2. If count would saturate, fail. (This can only</span><br><span class="line">             *    happen if count is already nonzero.)</span><br><span class="line">             * 3. Otherwise, this thread is eligible for lock if</span><br><span class="line">             *    it is either a reentrant acquire or</span><br><span class="line">             *    queue policy allows it. If so, update state</span><br><span class="line">             *    and set owner.</span><br><span class="line">             */</span><br><span class="line">            Thread current = Thread.currentThread();</span><br><span class="line">            int c = getState();</span><br><span class="line">            int w = exclusiveCount(c);</span><br><span class="line">            if (c != 0) &#123;</span><br><span class="line">               // å­˜åœ¨è¯»é”æˆ–è€…å½“å‰è·å–çº¿ç¨‹ä¸æ˜¯å·²ç»è·å–å†™é”çš„çº¿ç¨‹</span><br><span class="line">                if (w == 0 || current != getExclusiveOwnerThread())</span><br><span class="line">                    return false;</span><br><span class="line">                if (w + exclusiveCount(acquires) &gt; MAX_COUNT)</span><br><span class="line">                    throw new Error(&quot;Maximum lock count exceeded&quot;);</span><br><span class="line">                // Reentrant acquire</span><br><span class="line">                setState(c + acquires);</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">            if (writerShouldBlock() ||</span><br><span class="line">                !compareAndSetState(c, c + acquires))</span><br><span class="line">                return false;</span><br><span class="line">            setExclusiveOwnerThread(current);</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•é™¤äº†é‡å…¥æ¡ä»¶ï¼ˆå½“å‰çº¿ç¨‹ä¸ºè·å–äº†å†™é”çš„çº¿ç¨‹ï¼‰ä¹‹å¤–ï¼Œå¢åŠ äº†ä¸€ä¸ªè¯»é”æ˜¯å¦å­˜åœ¨çš„åˆ¤æ–­ã€‚<font color="DeepPink">å¦‚æœå­˜åœ¨è¯»é”ï¼Œåˆ™å†™é”ä¸èƒ½è¢«è·å–ï¼ŒåŸå› åœ¨äºï¼šè¯»å†™é”è¦ç¡®ä¿å†™é”çš„æ“ä½œå¯¹è¯»é”å¯è§ï¼Œå¦‚æœå…è®¸è¯»é”åœ¨å·²è¢«è·å–çš„æƒ…å†µä¸‹å¯¹å†™é”çš„è·å–ï¼Œé‚£ä¹ˆæ­£åœ¨è¿è¡Œçš„å…¶ä»–è¯»çº¿ç¨‹å°±æ— æ³•æ„ŸçŸ¥åˆ°å½“å‰å†™çº¿ç¨‹çš„æ“ä½œã€‚å› æ­¤ï¼Œåªæœ‰ç­‰å¾…å…¶ä»–è¯»çº¿ç¨‹éƒ½é‡Šæ”¾äº†è¯»é”ï¼Œå†™é”æ‰èƒ½è¢«å½“å‰çº¿ç¨‹è·å–ï¼Œè€Œå†™é”ä¸€æ—¦è¢«è·å–ï¼Œåˆ™å…¶ä»–è¯»å†™çº¿ç¨‹çš„åç»­è®¿é—®å‡è¢«é˜»å¡ã€‚</font></p><p><font color="DeepPink">å†™é”çš„é‡Šæ”¾ä¸ReentrantLockçš„é‡Šæ”¾è¿‡ç¨‹åŸºæœ¬ç±»ä¼¼ï¼Œæ¯æ¬¡é‡Šæ”¾å‡å‡å°‘å†™çŠ¶æ€ï¼Œå½“å†™çŠ¶æ€ä¸º0æ—¶è¡¨ç¤ºå†™é”å·²è¢«é‡Šæ”¾ï¼Œä»è€Œç­‰å¾…çš„è¯»å†™çº¿ç¨‹èƒ½å¤Ÿç»§ç»­è®¿é—®è¯»å†™é”ï¼ŒåŒæ—¶å‰æ¬¡å†™çº¿ç¨‹çš„ä¿®æ”¹å¯¹åç»­è¯»å†™çº¿ç¨‹å¯è§ã€‚</font></p><h2 id="5-3-è¯»é”çš„è·å–ä¸é‡Šæ”¾"><a href="#5-3-è¯»é”çš„è·å–ä¸é‡Šæ”¾" class="headerlink" title="5.3 è¯»é”çš„è·å–ä¸é‡Šæ”¾"></a>5.3 è¯»é”çš„è·å–ä¸é‡Šæ”¾</h2><p>è¯»é”æ˜¯ä¸€ä¸ªæ”¯æŒé‡è¿›å…¥çš„å…±äº«é”ï¼Œå®ƒèƒ½å¤Ÿè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–ï¼Œåœ¨æ²¡æœ‰å…¶ä»–å†™çº¿ç¨‹è®¿é—®ï¼ˆæˆ–è€…å†™çŠ¶æ€ä¸º0ï¼‰æ—¶ï¼Œè¯»é”æ€»ä¼šè¢«æˆåŠŸåœ°è·å–ï¼Œè€Œæ‰€åšçš„ä¹Ÿåªæ˜¯ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰å¢åŠ è¯»çŠ¶æ€ã€‚å¦‚æœå½“å‰çº¿ç¨‹å·²ç»è·å–äº†è¯»é”ï¼Œåˆ™å¢åŠ è¯»çŠ¶æ€ã€‚å¦‚æœå½“å‰çº¿ç¨‹åœ¨è·å–è¯»é”æ—¶ï¼Œå†™é”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼Œåˆ™è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚è·å–è¯»é”çš„å®ç°ä»Java 5åˆ°Java 6å˜å¾—å¤æ‚è®¸å¤šï¼Œä¸»è¦åŸå› æ˜¯æ–°å¢äº†ä¸€äº›åŠŸèƒ½ï¼Œä¾‹å¦‚getReadHoldCount()æ–¹æ³•ï¼Œä½œç”¨æ˜¯è¿”å›å½“å‰çº¿ç¨‹è·å–è¯»é”çš„æ¬¡æ•°ã€‚è¯»çŠ¶æ€æ˜¯æ‰€æœ‰çº¿ç¨‹è·å–è¯»é”æ¬¡æ•°çš„æ€»å’Œï¼Œè€Œæ¯ä¸ªçº¿ç¨‹å„è‡ªè·å–è¯»é”çš„æ¬¡æ•°åªèƒ½é€‰æ‹©ä¿å­˜åœ¨ThreadLocalä¸­ï¼Œç”±çº¿ç¨‹è‡ªèº«ç»´æŠ¤ï¼Œè¿™ä½¿è·å–è¯»é”çš„å®ç°å˜å¾—å¤æ‚ã€‚å› æ­¤ï¼Œè¿™é‡Œå°†è·å–è¯»é”çš„ä»£ç åšäº†åˆ å‡ï¼Œä¿ç•™å¿…è¦çš„éƒ¨åˆ†ï¼Œå¦‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">protected final int tryAcquireShared(int unused) &#123;</span><br><span class="line">          for (;;) &#123;</span><br><span class="line">                  int c = getState();</span><br><span class="line">                  int nextc = c + (1 &lt;&lt; 16);</span><br><span class="line">                  if (nextc &lt; c)</span><br><span class="line">                    throw new Error(&quot;Maximum lock count exceeded&quot;);</span><br><span class="line">                  if (exclusiveCount(c) != 0 &amp;&amp; owner != Thread.currentThread())</span><br><span class="line">                    return -1;</span><br><span class="line">                  if (compareAndSetState(c, nextc))</span><br><span class="line">                    return 1;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨tryAcquireShared(int unused)æ–¹æ³•ä¸­ï¼Œå¦‚æœå…¶ä»–çº¿ç¨‹å·²ç»è·å–äº†å†™é”ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å–è¯»é”å¤±è´¥ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚<font color="DeepPink"> å¦‚æœå½“å‰çº¿ç¨‹è·å–äº†å†™é”æˆ–è€…å†™é”æœªè¢«è·å–ï¼Œåˆ™å½“å‰çº¿ç¨‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼Œä¾é CASä¿è¯ï¼‰å¢åŠ è¯»çŠ¶æ€ï¼ŒæˆåŠŸè·å–è¯»é”ã€‚</font></p><p>è¯»é”çš„æ¯æ¬¡é‡Šæ”¾ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼Œå¯èƒ½æœ‰å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶é‡Šæ”¾è¯»é”ï¼‰å‡å‡å°‘è¯»çŠ¶æ€ï¼Œå‡å°‘çš„å€¼æ˜¯ï¼ˆ1&lt;&lt;16ï¼‰ã€‚</p><h2 id="5-4-é”é™çº§"><a href="#5-4-é”é™çº§" class="headerlink" title="5.4 é”é™çº§"></a>5.4 é”é™çº§</h2><p>é”é™çº§æŒ‡çš„æ˜¯å†™é”é™çº§æˆä¸ºè¯»é”ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ‹¥æœ‰å†™é”ï¼Œç„¶åå°†å…¶é‡Šæ”¾ï¼Œæœ€åå†è·å–è¯»é”ï¼Œè¿™ç§åˆ†æ®µå®Œæˆçš„è¿‡ç¨‹ä¸èƒ½ç§°ä¹‹ä¸ºé”é™çº§ã€‚é”é™çº§æ˜¯æŒ‡æŠŠæŒä½ï¼ˆå½“å‰æ‹¥æœ‰çš„ï¼‰å†™é”ï¼Œå†è·å–åˆ°è¯»é”ï¼Œéšåé‡Šæ”¾ï¼ˆå…ˆå‰æ‹¥æœ‰çš„ï¼‰å†™é”çš„è¿‡ç¨‹ã€‚</p><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸ªé”é™çº§çš„ç¤ºä¾‹ã€‚å› ä¸ºæ•°æ®ä¸å¸¸å˜åŒ–ï¼Œæ‰€ä»¥å¤šä¸ªçº¿ç¨‹å¯ä»¥å¹¶å‘åœ°è¿›è¡Œæ•°æ®å¤„ç†ï¼Œå½“æ•°æ®å˜æ›´åï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ„ŸçŸ¥åˆ°æ•°æ®å˜åŒ–ï¼Œåˆ™è¿›è¡Œæ•°æ®çš„å‡†å¤‡å·¥ä½œï¼ŒåŒæ—¶å…¶ä»–å¤„ç†çº¿ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹å®Œæˆæ•°æ®çš„å‡†å¤‡å·¥ä½œï¼Œå¦‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public void processData() &#123;</span><br><span class="line">        readLock.lock();</span><br><span class="line">        if (!update) &#123;</span><br><span class="line">            // å¿…é¡»å…ˆé‡Šæ”¾è¯»é”</span><br><span class="line">            readLock.unlock();</span><br><span class="line">            // é”é™çº§ä»å†™é”è·å–åˆ°å¼€å§‹</span><br><span class="line">            writeLock.lock();</span><br><span class="line">            try &#123;</span><br><span class="line">                if (!update) &#123;</span><br><span class="line">                    // å‡†å¤‡æ•°æ®çš„æµç¨‹ï¼ˆç•¥ï¼‰</span><br><span class="line">                    update = true;</span><br><span class="line">                &#125;</span><br><span class="line">                readLock.lock();</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                writeLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">            // é”é™çº§å®Œæˆï¼Œå†™é”é™çº§ä¸ºè¯»é”</span><br><span class="line">        &#125;</span><br><span class="line">        try &#123;</span><br><span class="line">            // ä½¿ç”¨æ•°æ®çš„æµç¨‹ï¼ˆç•¥ï¼‰</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            readLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå½“æ•°æ®å‘ç”Ÿå˜æ›´åï¼Œupdateå˜é‡ï¼ˆå¸ƒå°”ç±»å‹ä¸”volatileä¿®é¥°ï¼‰è¢«è®¾ç½®ä¸ºfalseï¼Œæ­¤æ—¶æ‰€æœ‰è®¿é—®processData()æ–¹æ³•çš„çº¿ç¨‹éƒ½èƒ½å¤Ÿæ„ŸçŸ¥åˆ°å˜åŒ–ï¼Œä½†åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å–åˆ°å†™é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šè¢«é˜»å¡åœ¨è¯»é”å’Œå†™é”çš„lock()æ–¹æ³•ä¸Šã€‚å½“å‰çº¿ç¨‹è·å–å†™é”å®Œæˆæ•°æ®å‡†å¤‡ä¹‹åï¼Œå†è·å–è¯»é”ï¼Œéšåé‡Šæ”¾å†™é”ï¼Œå®Œæˆé”é™çº§ã€‚</p><p><font color="DeepPink">é”é™çº§ä¸­è¯»é”çš„è·å–æ˜¯å¦å¿…è¦å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¿…è¦çš„ã€‚ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸è·å–è¯»é”è€Œæ˜¯ç›´æ¥é‡Šæ”¾å†™é”ï¼Œå‡è®¾æ­¤åˆ»å¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆè®°ä½œçº¿ç¨‹Tï¼‰è·å–äº†å†™é”å¹¶ä¿®æ”¹äº†æ•°æ®ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹æ— æ³•æ„ŸçŸ¥çº¿ç¨‹Tçš„æ•°æ®æ›´æ–°ã€‚å¦‚æœå½“å‰çº¿ç¨‹è·å–è¯»é”ï¼Œå³éµå¾ªé”é™çº§çš„æ­¥éª¤ï¼Œåˆ™çº¿ç¨‹Tå°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹ä½¿ç”¨æ•°æ®å¹¶é‡Šæ”¾è¯»é”ä¹‹åï¼Œçº¿ç¨‹Tæ‰èƒ½è·å–å†™é”è¿›è¡Œæ•°æ®æ›´æ–°ã€‚</font></p><p><font color="DeepPink">RentrantReadWriteLockä¸æ”¯æŒé”å‡çº§ï¼ˆæŠŠæŒè¯»é”ã€è·å–å†™é”ï¼Œæœ€åé‡Šæ”¾è¯»é”çš„è¿‡ç¨‹ï¼‰ã€‚ç›®çš„ä¹Ÿæ˜¯ä¿è¯æ•°æ®å¯è§æ€§ï¼Œå¦‚æœè¯»é”å·²è¢«å¤šä¸ªçº¿ç¨‹è·å–ï¼Œå…¶ä¸­ä»»æ„çº¿ç¨‹æˆåŠŸè·å–äº†å†™é”å¹¶æ›´æ–°äº†æ•°æ®ï¼Œåˆ™å…¶æ›´æ–°å¯¹å…¶ä»–è·å–åˆ°è¯»é”çš„çº¿ç¨‹æ˜¯ä¸å¯è§çš„ã€‚</font></p><h1 id="6ã€å°ç»“"><a href="#6ã€å°ç»“" class="headerlink" title="6ã€å°ç»“"></a>6ã€å°ç»“</h1><p>RentrantReadWriteLockçš„å…·ä½“æµç¨‹æ¢³ç†å®Œäº†ï¼Œå›è¿‡å¤´æ¥æƒ³ä¸€ä¸‹å‰è¨€çš„é—®é¢˜ï¼Œå¥½åƒå¹¶æ²¡æœ‰å¾—åˆ°ç­”æ¡ˆï¼Œé‚£ä¹ˆæ¥åˆ°ReentrantReadWriteLockä»£ç ä¸­ï¼Œæ­¤å¤„ä¸»è¦çœ‹ä¸€ä¸‹è¯»é”çš„è·å–ã€é‡Šæ”¾æ˜¯å¦å¯¹åº”AQSä¸­çš„å…±äº«æ¨¡å¼ã€‚</p><h2 id="6-1-è¯»é”çš„è·å–ã€é‡Šæ”¾"><a href="#6-1-è¯»é”çš„è·å–ã€é‡Šæ”¾" class="headerlink" title="6.1 è¯»é”çš„è·å–ã€é‡Šæ”¾"></a>6.1 è¯»é”çš„è·å–ã€é‡Šæ”¾</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public void lock() &#123;</span><br><span class="line">         //çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯å°±æ˜ç™½äº†ï¼Œæˆ‘ä»¬çš„çŒœæƒ³æ˜¯æ­£ç¡®çš„</span><br><span class="line">         sync.acquireShared(1);</span><br><span class="line">     &#125;</span><br><span class="line">    public void unlock() &#123;</span><br><span class="line">         //çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯å°±æ˜ç™½äº†ï¼Œæˆ‘ä»¬çš„çŒœæƒ³æ˜¯æ­£ç¡®çš„</span><br><span class="line">         sync.releaseShared(1);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><p>å…ˆæ¥çœ‹ä¸€ä¸‹ReadLockçš„å…·ä½“å®ç°ï¼Œåœ¨ReentrantReadWriteLockåˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šåœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ReadLockã€WriteLockï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public ReentrantReadWriteLock() &#123;</span><br><span class="line">       this(false);</span><br><span class="line">   &#125;</span><br><span class="line">   public ReentrantReadWriteLock(boolean fair) &#123;</span><br><span class="line">       sync = fair ? new FairSync() : new NonfairSync();</span><br><span class="line">       readerLock = new ReadLock(this);</span><br><span class="line">       writerLock = new WriteLock(this);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ä»ReentrantReadWriteLockæ„é€ å‡½æ•°çš„ä»£ç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ReadLockåˆå§‹åŒ–çš„å‚æ•°æ˜¯ReentrantReadWriteLockï¼Œé‚£ä¹ˆReadLockéœ€è¦ReentrantReadWriteLockæ¥åšä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æ¥çœ‹ä¸€ä¸‹ReadLockï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">private final Sync sync;</span><br><span class="line">    protected ReadLock(ReentrantReadWriteLock lock) &#123;</span><br><span class="line">        sync = lock.sync;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä»ReadLockçš„æ„é€ å‡½æ•°ä¸­ï¼Œå¯ä»¥çœ‹å‡ºï¼ŒReadLockéœ€è¦è·å–åˆ°Syncï¼Œé‚£ä¹ˆSyncæ˜¯è°ï¼Œåˆæ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿ</p><blockquote><p>å…¶å®ï¼Œå¦‚æœçœ‹è¿‡JUCä¸‹é¢ä»£ç çš„è¯ï¼Œçœ‹åˆ°Syncï¼Œå°±æ˜ç™½å®ƒåº”è¯¥å°±æ˜¯AQSçš„å®ç°ç±»ï¼Œé€šè¿‡å®ƒæ¥å®ç°ç›¸å…³é”çš„æ“ä½œã€‚</p></blockquote><p>æ¥çœ‹ä¸€ä¸‹ä»£ç éªŒè¯ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * Synchronization implementation for ReentrantReadWriteLock.</span><br><span class="line">     * Subclassed into fair and nonfair versions.</span><br><span class="line">     */</span><br><span class="line">    abstract static class Sync extends AbstractQueuedSynchronizer &#123;</span><br><span class="line">    //å…·ä½“ä»£ç ç•¥</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œå¯ä»¥å¤§ä½“å¾—å‡ºè¿™ä¹ˆä¸€ä¸ªç»“æœï¼šReadLockè·å–é”çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡ReentrantReadWriteLock å†…éƒ¨Syncç±»æ¥è·å–çš„å…±äº«é”ï¼Œä¹Ÿå°±æ˜¯è¯»é”çš„è·å–æ˜¯å¯¹åº”AQSä¸­çš„å…±äº«æ¨¡å¼ã€‚</p><p>ç‚¹è¿› sync.acquireShared(1)æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯è°ƒç”¨Syncçš„çˆ¶ç±»AQSä¸­æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public final void acquireShared(int arg) &#123;</span><br><span class="line">        if (tryAcquireShared(arg) &lt; 0)</span><br><span class="line">            doAcquireShared(arg);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œï¼Œä¹Ÿå°±æ˜ç™½ä¸ºå•¥AQSå­ç±»éœ€è¦é‡å†™ï¼š</p><ul><li>tryAcquire</li><li>tryRelease</li><li>tryReleaseShared</li><li>isHeldExclusively</li></ul><p>ç­‰æ–¹æ³•äº†ã€‚</p><h1 id="7ã€å‚è€ƒèµ„æ–™"><a href="#7ã€å‚è€ƒèµ„æ–™" class="headerlink" title="7ã€å‚è€ƒèµ„æ–™"></a>7ã€å‚è€ƒèµ„æ–™</h1><p>æœ¬æ–‡ç¬¬4ã€5å°èŠ‚æ•´ç†è‡ªï¼šã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹</p>]]></content>
      
      
      <categories>
          
          <category> JUC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JUC </tag>
            
            <tag> AQS </tag>
            
            <tag> JDK </tag>
            
            <tag> ReentrantReadWriteLock </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java AQS Conditionçš„å®ç°åˆ†æ</title>
      <link href="/java-aqs-condition.html"/>
      <url>/java-aqs-condition.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ•´ç†è‡ªã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ç¬¬äº”ç«  ä½œè€…ï¼šæ–¹è…¾é£ã€€é­é¹ã€€ç¨‹æ™“æ˜</p></blockquote><a id="more"></a><p>AQS:AbstractQueuedSynchronizer</p><p>ConditionObjectæ˜¯åŒæ­¥å™¨AQSçš„å†…éƒ¨ç±»ï¼Œå› ä¸ºConditionçš„æ“ä½œéœ€è¦è·å–ç›¸å…³è”çš„é”ï¼Œæ‰€ä»¥ä½œä¸ºåŒæ­¥å™¨çš„å†…éƒ¨ç±»ä¹Ÿè¾ƒä¸ºåˆç†ã€‚æ¯ä¸ªConditionå¯¹è±¡éƒ½åŒ…å«ç€ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆä»¥ä¸‹ç§°ä¸ºç­‰å¾…é˜Ÿåˆ—ï¼‰ï¼Œè¯¥é˜Ÿåˆ—æ˜¯Conditionå¯¹è±¡å®ç°ç­‰å¾…/é€šçŸ¥åŠŸèƒ½çš„å…³é”®ã€‚</p><p>ä¸‹é¢å°†åˆ†æConditionçš„å®ç°ï¼Œä¸»è¦åŒ…æ‹¬ï¼šç­‰å¾…é˜Ÿåˆ—ã€ç­‰å¾…å’Œé€šçŸ¥ï¼Œä¸‹é¢æåˆ°çš„Conditionå¦‚æœä¸åŠ è¯´æ˜å‡æŒ‡çš„æ˜¯ConditionObjectã€‚</p><h1 id="1ã€ç­‰å¾…é˜Ÿåˆ—"><a href="#1ã€ç­‰å¾…é˜Ÿåˆ—" class="headerlink" title="1ã€ç­‰å¾…é˜Ÿåˆ—"></a>1ã€ç­‰å¾…é˜Ÿåˆ—</h1><p>ç­‰å¾…é˜Ÿåˆ—æ˜¯ä¸€ä¸ªFIFOçš„é˜Ÿåˆ—ï¼Œåœ¨é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†ä¸€ä¸ªçº¿ç¨‹å¼•ç”¨ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯åœ¨Conditionå¯¹è±¡ä¸Šç­‰å¾…çš„çº¿ç¨‹ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†Condition.await()æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°†ä¼šé‡Šæ”¾é”ã€æ„é€ æˆèŠ‚ç‚¹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚äº‹å®ä¸Šï¼ŒèŠ‚ç‚¹çš„å®šä¹‰å¤ç”¨äº†åŒæ­¥å™¨ä¸­èŠ‚ç‚¹çš„å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒæ­¥é˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—ä¸­èŠ‚ç‚¹ç±»å‹éƒ½æ˜¯åŒæ­¥å™¨çš„é™æ€å†…éƒ¨ç±»AbstractQueuedSynchronizer.Nodeã€‚</p><p>ä¸€ä¸ªConditionåŒ…å«ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼ŒConditionæ‹¥æœ‰é¦–èŠ‚ç‚¹ï¼ˆfirstWaiterï¼‰å’Œå°¾èŠ‚ç‚¹ï¼ˆlastWaiterï¼‰ã€‚å½“å‰çº¿ç¨‹è°ƒç”¨Condition.await()æ–¹æ³•ï¼Œå°†ä¼šä»¥å½“å‰çº¿ç¨‹æ„é€ èŠ‚ç‚¹ï¼Œå¹¶å°†èŠ‚ç‚¹ä»å°¾éƒ¨åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œç­‰å¾…é˜Ÿåˆ—çš„åŸºæœ¬ç»“æ„å¦‚å›¾5-9æ‰€ç¤ºã€‚<br><img alt data-src="/images/java-juc-aqs-condition/59.png"></p><p>å¦‚å›¾æ‰€ç¤ºï¼ŒConditionæ‹¥æœ‰é¦–å°¾èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œè€Œæ–°å¢èŠ‚ç‚¹åªéœ€è¦å°†åŸæœ‰çš„å°¾èŠ‚ç‚¹nextWaiteræŒ‡å‘å®ƒï¼Œå¹¶ä¸”æ›´æ–°å°¾èŠ‚ç‚¹å³å¯ã€‚ä¸Šè¿°èŠ‚ç‚¹å¼•ç”¨æ›´æ–°çš„è¿‡ç¨‹å¹¶æ²¡æœ‰ä½¿ç”¨CASä¿è¯ï¼ŒåŸå› åœ¨äº<font color="DeepPink">è°ƒç”¨await()æ–¹æ³•çš„çº¿ç¨‹å¿…å®šæ˜¯è·å–äº†é”çš„çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥è¿‡ç¨‹æ˜¯ç”±é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ã€‚ </font></p><p>åœ¨Objectçš„ç›‘è§†å™¨æ¨¡å‹ä¸Šï¼Œä¸€ä¸ªå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—ï¼Œè€Œ<font color="DeepPink">å¹¶å‘åŒ…ä¸­çš„Lockï¼ˆæ›´ç¡®åˆ‡åœ°è¯´æ˜¯åŒæ­¥å™¨ï¼‰æ‹¥æœ‰ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—å’Œå¤šä¸ªç­‰å¾…é˜Ÿåˆ— </font>ï¼Œå…¶å¯¹åº”å…³ç³»å¦‚å›¾5-10æ‰€ç¤ºã€‚</p><p><img alt data-src="/images/java-juc-aqs-condition/510.png"></p><h1 id="2ã€ç­‰å¾…"><a href="#2ã€ç­‰å¾…" class="headerlink" title="2ã€ç­‰å¾…"></a>2ã€ç­‰å¾…</h1><p><font color="DeepPink">è°ƒç”¨Conditionçš„await()æ–¹æ³•ï¼ˆæˆ–è€…ä»¥awaitå¼€å¤´çš„æ–¹æ³•ï¼‰ï¼Œä¼šä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…é˜Ÿåˆ—å¹¶é‡Šæ”¾é”ï¼ŒåŒæ—¶çº¿ç¨‹çŠ¶æ€å˜ä¸ºç­‰å¾…çŠ¶æ€ã€‚å½“ä»await()æ–¹æ³•è¿”å›æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¸€å®šè·å–äº†Conditionç›¸å…³è”çš„é”ã€‚</font></p><p>å¦‚æœä»é˜Ÿåˆ—ï¼ˆåŒæ­¥é˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—ï¼‰çš„è§’åº¦çœ‹await()æ–¹æ³•ï¼Œå½“è°ƒç”¨await()æ–¹æ³•æ—¶ï¼Œç›¸å½“äºåŒæ­¥é˜Ÿåˆ—çš„é¦–èŠ‚ç‚¹ï¼ˆè·å–äº†é”çš„èŠ‚ç‚¹ï¼‰ç§»åŠ¨åˆ°Conditionçš„ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚</p><p>Conditionçš„await()æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public final void await() throws InterruptedException &#123;</span><br><span class="line">        if (Thread.interrupted())</span><br><span class="line">            throw new InterruptedException();</span><br><span class="line">        // å½“å‰çº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—</span><br><span class="line">        Node node = addConditionWaiter();</span><br><span class="line">        // é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯é‡Šæ”¾é”</span><br><span class="line">        int savedState = fullyRelease(node);</span><br><span class="line">        int interruptMode = 0;</span><br><span class="line">        while (!isOnSyncQueue(node)) &#123;</span><br><span class="line">            LockSupport.park(this);</span><br><span class="line">            if ((interruptMode = checkInterruptWhileWaiting(node)) != 0)</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)</span><br><span class="line">            interruptMode = REINTERRUPT;</span><br><span class="line">        if (node.nextWaiter != null)</span><br><span class="line">            unlinkCancelledWaiters();</span><br><span class="line">        if (interruptMode != 0)</span><br><span class="line">            reportInterruptAfterWait(interruptMode);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹æˆåŠŸè·å–äº†é”çš„çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯åŒæ­¥é˜Ÿåˆ—ä¸­çš„é¦–èŠ‚ç‚¹ï¼Œè¯¥æ–¹æ³•ä¼šå°†å½“å‰çº¿ç¨‹æ„é€ æˆèŠ‚ç‚¹å¹¶åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç„¶åé‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œå”¤é†’åŒæ­¥é˜Ÿåˆ—ä¸­çš„åç»§èŠ‚ç‚¹ï¼Œç„¶åå½“å‰çº¿ç¨‹ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</p><p>å½“ç­‰å¾…é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹è¢«å”¤é†’ï¼Œåˆ™å”¤é†’èŠ‚ç‚¹çš„çº¿ç¨‹å¼€å§‹å°è¯•è·å–åŒæ­¥çŠ¶æ€ã€‚å¦‚æœä¸æ˜¯é€šè¿‡å…¶ä»–çº¿ç¨‹è°ƒç”¨Condition.signal()æ–¹æ³•å”¤é†’ï¼Œè€Œæ˜¯å¯¹ç­‰å¾…çº¿ç¨‹è¿›è¡Œä¸­æ–­ï¼Œåˆ™ä¼šæŠ›å‡ºInterruptedExceptionã€‚</p><p>å¦‚æœä»é˜Ÿåˆ—çš„è§’åº¦å»çœ‹ï¼Œå½“å‰çº¿ç¨‹åŠ å…¥Conditionçš„ç­‰å¾…é˜Ÿåˆ—ï¼Œè¯¥è¿‡ç¨‹å¦‚å›¾5-11ç¤ºã€‚</p><p>å¦‚å›¾æ‰€ç¤ºï¼ŒåŒæ­¥é˜Ÿåˆ—çš„é¦–èŠ‚ç‚¹å¹¶ä¸ä¼šç›´æ¥åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œè€Œæ˜¯é€šè¿‡addConditionWaiter()æ–¹æ³•æŠŠå½“å‰çº¿ç¨‹æ„é€ æˆä¸€ä¸ªæ–°çš„èŠ‚ç‚¹å¹¶å°†å…¶åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚</p><h1 id="3ã€é€šçŸ¥"><a href="#3ã€é€šçŸ¥" class="headerlink" title="3ã€é€šçŸ¥"></a>3ã€é€šçŸ¥</h1><p>è°ƒç”¨Conditionçš„signal()æ–¹æ³•ï¼Œå°†ä¼šå”¤é†’åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…æ—¶é—´æœ€é•¿çš„èŠ‚ç‚¹ï¼ˆé¦–èŠ‚ç‚¹ï¼‰ï¼Œåœ¨å”¤é†’èŠ‚ç‚¹ä¹‹å‰ï¼Œä¼šå°†èŠ‚ç‚¹ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚</p><p>Conditionçš„signal()æ–¹æ³•ï¼Œå¦‚ä»£ç æ¸…å•5-23æ‰€ç¤ºã€‚<br><img alt data-src="/images/java-juc-aqs-condition/511.png"><br>ä»£ç æ¸…å•5-23ã€€ConditionObjectçš„signalæ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public final void signal() &#123;</span><br><span class="line">       //isHeldExclusively() AQS å­ç±»å®ç°</span><br><span class="line">       if (!isHeldExclusively())</span><br><span class="line">           throw new IllegalMonitorStateException();</span><br><span class="line">       Node first = firstWaiter;</span><br><span class="line">       if (first != null)</span><br><span class="line">           doSignal(first);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><font color="DeepPink">è°ƒç”¨è¯¥æ–¹æ³•çš„å‰ç½®æ¡ä»¶æ˜¯å½“å‰çº¿ç¨‹å¿…é¡»è·å–äº†é”ï¼Œå¯ä»¥çœ‹åˆ°signal()æ–¹æ³•è¿›è¡Œäº†isHeldExclusively()æ£€æŸ¥ï¼Œä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹å¿…é¡»æ˜¯è·å–äº†é”çš„çº¿ç¨‹ã€‚</font>æ¥ç€è·å–ç­‰å¾…é˜Ÿåˆ—çš„é¦–èŠ‚ç‚¹ï¼Œå°†å…¶ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—å¹¶ä½¿ç”¨LockSupportå”¤é†’èŠ‚ç‚¹ä¸­çš„çº¿ç¨‹ã€‚</p><p>èŠ‚ç‚¹ä»ç­‰å¾…é˜Ÿåˆ—ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—çš„è¿‡ç¨‹å¦‚å›¾5-12æ‰€ç¤ºã€‚</p><p><img alt data-src="/images/java-juc-aqs-condition/512.png"><br>é€šè¿‡è°ƒç”¨åŒæ­¥å™¨çš„enq(Node node)æ–¹æ³•ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­çš„å¤´èŠ‚ç‚¹çº¿ç¨‹å®‰å…¨åœ°ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ã€‚å½“èŠ‚ç‚¹ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—åï¼Œå½“å‰çº¿ç¨‹å†ä½¿ç”¨LockSupportå”¤é†’è¯¥èŠ‚ç‚¹çš„çº¿ç¨‹ã€‚</p><p>è¢«å”¤é†’åçš„çº¿ç¨‹ï¼Œå°†ä»await()æ–¹æ³•ä¸­çš„whileå¾ªç¯ä¸­é€€å‡ºï¼ˆisOnSyncQueue(Node node)æ–¹æ³•è¿”å›trueï¼ŒèŠ‚ç‚¹å·²ç»åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ï¼‰ï¼Œè¿›è€Œè°ƒç”¨åŒæ­¥å™¨çš„acquireQueued()æ–¹æ³•åŠ å…¥åˆ°è·å–åŒæ­¥çŠ¶æ€çš„ç«äº‰ä¸­ã€‚</p><p>æˆåŠŸè·å–åŒæ­¥çŠ¶æ€ï¼ˆæˆ–è€…è¯´é”ï¼‰ä¹‹åï¼Œè¢«å”¤é†’çš„çº¿ç¨‹å°†ä»å…ˆå‰è°ƒç”¨çš„await()æ–¹æ³•è¿”å›ï¼Œæ­¤æ—¶è¯¥çº¿ç¨‹å·²ç»æˆåŠŸåœ°è·å–äº†é”ã€‚</p><p>Conditionçš„signalAll()æ–¹æ³•ï¼Œç›¸å½“äºå¯¹ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å‡æ‰§è¡Œä¸€æ¬¡signal()æ–¹æ³•ï¼Œæ•ˆæœå°±æ˜¯å°†ç­‰å¾…é˜Ÿåˆ—ä¸­æ‰€æœ‰èŠ‚ç‚¹å…¨éƒ¨ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå¹¶å”¤é†’æ¯ä¸ªèŠ‚ç‚¹çš„çº¿ç¨‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JUC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JUC </tag>
            
            <tag> AQS </tag>
            
            <tag> JDK </tag>
            
            <tag> Condition </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL InnoDBå­˜å‚¨å¼•æ“ï¼šå¤–é”®ä¸é”</title>
      <link href="/mysql-innodb-foreign-key-lock.html"/>
      <url>/mysql-innodb-foreign-key-lock.html</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ•´ç†è‡ªï¼šã€ŠMySQLæŠ€æœ¯å†…å¹•:InnoDBå­˜å‚¨å¼•æ“ã€‹ ç¬¬äºŒç‰ˆ ä½œè€…ï¼šå§œæ‰¿å°§</p><p>å‡ºç‰ˆæ—¶é—´ï¼š2013-05</p><a id="more"></a><p>å¤–é”®ä¸»è¦ç”¨äºå¼•ç”¨å®Œæ•´æ€§çš„çº¦æŸæ£€æŸ¥<font color="DeepPink">åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œå¯¹äºä¸€ä¸ªå¤–é”®åˆ—ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼åœ°å¯¹è¿™ä¸ªåˆ—åŠ ç´¢å¼•ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¼šè‡ªåŠ¨å¯¹å…¶åŠ ä¸€ä¸ªç´¢å¼•ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥é¿å…è¡¨é”ã€‚</font> è¿™æ¯”Oracleæ•°æ®åº“åšå¾—å¥½ï¼ŒOracleæ•°æ®åº“ä¸ä¼šè‡ªåŠ¨æ·»åŠ ç´¢å¼•ï¼Œç”¨æˆ·å¿…é¡»è‡ªå·±æ‰‹åŠ¨æ·»åŠ ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†Oracleæ•°æ®åº“ä¸­å¯èƒ½äº§ç”Ÿæ­»é”ã€‚</p><p><font color="DeepPink">å¯¹äºå¤–é”®å€¼çš„æ’å…¥æˆ–æ›´æ–°ï¼Œé¦–å…ˆéœ€è¦æ£€æŸ¥çˆ¶è¡¨ä¸­çš„è®°å½•ï¼Œæ—¢SELECTçˆ¶è¡¨ã€‚ä½†æ˜¯å¯¹äºçˆ¶è¡¨çš„SELECTæ“ä½œï¼Œä¸æ˜¯ä½¿ç”¨ä¸€è‡´æ€§éé”å®šè¯»çš„æ–¹å¼ï¼Œå› ä¸ºè¿™ä¼šå‘ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå› æ­¤è¿™æ—¶ä½¿ç”¨çš„æ˜¯SELECTâ€¦LOCK IN SHARE MODEæ–¹å¼ï¼Œå³ä¸»åŠ¨å¯¹çˆ¶è¡¨åŠ ä¸€ä¸ªSé”ã€‚</font>å¦‚æœè¿™æ—¶çˆ¶è¡¨ä¸Šå·²ç»è¿™æ ·åŠ Xé”ï¼Œå­è¡¨ä¸Šçš„æ“ä½œä¼šè¢«é˜»å¡ï¼Œå¦‚ä¸‹ï¼š<br><img alt data-src="/images/mysql-innodb-foreign-key-lock/%E5%A4%96%E9%94%AE%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B.png"><br>åœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œä¸¤ä¸ªä¼šè¯ä¸­çš„äº‹åŠ¡éƒ½æ²¡æœ‰è¿›è¡ŒCOMMITæˆ–ROLLBACKæ“ä½œï¼Œè€Œä¼šè¯Bçš„æ“ä½œä¼šè¢«é˜»å¡ã€‚è¿™æ˜¯å› ä¸º idä¸º3çš„çˆ¶è¡¨åœ¨ä¼šè¯ Aä¸­å·²ç»åŠ äº†ä¸€ä¸ªXé”ï¼Œè€Œæ­¤æ—¶åœ¨ä¼šè¯ Bä¸­ç”¨æˆ·åˆéœ€è¦å¯¹çˆ¶è¡¨ä¸­ idä¸º3çš„è¡ŒåŠ ä¸€ä¸ª Sé”ï¼Œè¿™æ—¶ INSERTçš„æ“ä½œä¼šè¢«é˜»å¡ã€‚è®¾æƒ³å¦‚æœè®¿é—®çˆ¶è¡¨æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ä¸€è‡´æ€§çš„éé”å®šè¯»ï¼Œè¿™æ—¶Session Bä¼šè¯»åˆ°çˆ¶è¡¨æœ‰id=3çš„è®°å½•ï¼Œå¯ä»¥è¿›è¡Œæ’å…¥æ“ä½œã€‚ä½†æ˜¯å¦‚æœä¼šè¯Aå¯¹äº‹åŠ¡æäº¤äº†ï¼Œåˆ™çˆ¶è¡¨ä¸­å°±ä¸å­˜åœ¨idä¸º3çš„è®°å½•ã€‚æ•°æ®åœ¨çˆ¶ã€å­è¡¨å°±ä¼šå­˜åœ¨ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> InnoDB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL InnoDBå­˜å‚¨å¼•æ“ï¼šè¡Œé”çš„3ç§ç®—æ³•</title>
      <link href="/mysql-innodb-row-lock-algorithm.html"/>
      <url>/mysql-innodb-row-lock-algorithm.html</url>
      
        <content type="html"><![CDATA[<h1 id="è¡Œé”çš„ä¸‰ç§ç®—æ³•"><a href="#è¡Œé”çš„ä¸‰ç§ç®—æ³•" class="headerlink" title="è¡Œé”çš„ä¸‰ç§ç®—æ³•"></a>è¡Œé”çš„ä¸‰ç§ç®—æ³•</h1><p>InnoDBå­˜å‚¨å¼•æ“æœ‰3ç§è¡Œé”çš„ç®—æ³•ï¼Œå…¶åˆ†åˆ«æ˜¯ï¼š</p><ul><li>Record Lockï¼šå•ä¸ªè¡Œè®°å½•ä¸Šçš„èŒƒå›´</li><li><font color="DeepPink">Gap Lockï¼šé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä½†ä¸åŒ…å«è®°å½•æœ¬èº«</font></li><li><font color="DeepPink">Next-Key Lockï¼šGap Lock + Record Lockï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«</font></li></ul><p>Record Lockæ€»æ˜¯ä¼šé”ä½ç´¢å¼•è®°å½•ï¼Œå¦‚æœInnoDBå­˜å‚¨å¼•æ“å»ºç«‹çš„æ—¶å€™æ²¡æœ‰è®¾ç½®ä»»ä½•ä¸€ä¸ªç´¢å¼•ï¼Œè¿™æ—¶InnoDBå­˜å‚¨å¼•æ“ä¼šä½¿ç”¨éšå¼çš„ä¸»é”®æ¥è¿›è¡Œé”å®šã€‚</p><p><font color="DeepPink">Next-Key Lockæ˜¯ç»“åˆäº†Gap Lockå’ŒRecord Lockçš„ä¸€ç§é”å®šç®—æ³•ï¼Œåœ¨Next-Key Lockç®—æ³•ä¸‹ï¼Œinnodbå¯¹äºè¡Œçš„æŸ¥è¯¢éƒ½æ˜¯é‡‡ç”¨è¿™ç§é”å®šç®—æ³•ã€‚ </font>ä¾‹å¦‚ä¸€ä¸ªç´¢å¼•æœ‰9,11,13,20è¿™4ä¸ªå€¼ï¼Œé‚£ä¹ˆè¯¥ç´¢å¼•å¯èƒ½è¢«Next-Key Lockingçš„èŒƒå›´ä¸ºï¼ˆå·¦å¼€å³é—­ ï¼‰ï¼š<br>(- &amp;ï¼Œ9]<br>(9,11]<br>(13,20]<br>(20,+ &amp;)</p><p>é‡‡ç”¨Next-Key Lockçš„é”å®šæŠ€æœ¯ç§°ä¸ºNext-Key Lockingã€‚è¿™ç§è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³å¹»è¯»ï¼ˆPhantom Problemï¼‰ã€‚åˆ©ç”¨è¿™ç§é”å®šæŠ€æœ¯ï¼Œé”å®šçš„ä¸æ˜¯å•ä¸ªå€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªèŒƒå›´ã€‚</p><blockquote><p>å½“æŸ¥è¯¢çš„ç´¢å¼•å«æœ‰å”¯ä¸€å±æ€§æ—¶ï¼Œinnodbå­˜å‚¨å¼•æ“ä¼šå¯¹Next-Key Lockè¿›è¡Œä¼˜åŒ–ï¼Œå°†å…¶é™çº§ä¸ºRecord Lockï¼Œå³é”ä½ç´¢å¼•è®°å½•æœ¬èº«ï¼Œè€Œä¸å†æ˜¯èŒƒå›´ã€‚<br>å¯¹äºå”¯ä¸€ç´¢å¼•ï¼Œå…¶åŠ ä¸Šçš„æ˜¯Record Lockï¼Œä»…é”ä½è®°å½•æœ¬èº«ã€‚ä½†ä¹Ÿæœ‰ç‰¹åˆ«æƒ…å†µï¼Œé‚£å°±æ˜¯å”¯ä¸€ç´¢å¼•ç”±å¤šä¸ªåˆ—ç»„æˆï¼Œè€ŒæŸ¥è¯¢ä»…æ˜¯æŸ¥æ‰¾å¤šä¸ªå”¯ä¸€ç´¢å¼•åˆ—ä¸­çš„å…¶ä¸­ä¸€ä¸ªï¼Œé‚£ä¹ˆåŠ é”çš„æƒ…å†µä¾ç„¶æ˜¯Next-key lockã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE</span><br><span class="line">IF EXISTS t;</span><br><span class="line"></span><br><span class="line">CREATE TABLE t (a INT PRIMARY KEY);</span><br><span class="line"></span><br><span class="line">INSERT INTO t</span><br><span class="line">VALUES</span><br><span class="line">(1),</span><br><span class="line">(2),</span><br><span class="line">(5);</span><br></pre></td></tr></table></figure><p><img alt data-src="/images/mysql-innodb-row-lock-algorithm/%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E7%9A%84%E9%94%81%E5%AE%9A%E7%A4%BA%E4%BE%8B.png"><br>è¡¨tä¸­å…±æœ‰1ã€2ã€5ä¸‰ä¸ªå€¼ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåœ¨ä¼šè¯Aä¸­é¦–å…ˆå¯¹a=5è¿›è¡ŒXé”å®šã€‚è€Œç”±äºaæ˜¯ä¸»é”®ä¸”å”¯ä¸€ï¼Œå› æ­¤é”å®šçš„ä»…æ˜¯5è¿™ä¸ªå€¼ï¼Œè€Œä¸æ˜¯(2,5)è¿™ä¸ªèŒƒå›´ï¼Œè¿™æ ·åœ¨ä¼šè¯Bä¸­æ’å…¥å€¼4è€Œä¸ä¼šé˜»å¡ï¼Œå¯ä»¥ç«‹å³æ’å…¥å¹¶è¿”å›ã€‚å³é”å®šç”±Next-Key Lockç®—æ³•é™çº§ä¸ºäº†Record Lockï¼Œä»è€Œæé«˜åº”ç”¨çš„å¹¶å‘æ€§ã€‚æ­£å¦‚å‰é¢æ‰€ä»‹ç»çš„ï¼Œ<font color="DeepPink">Next-Keyé™çº§ä¸ºRecord Lockä»…åœ¨æŸ¥è¯¢çš„åˆ—æ˜¯å”¯ä¸€ç´¢å¼•çš„æƒ…å†µä¸‹ã€‚è‹¥æ˜¯è¾…åŠ©ç´¢å¼•ï¼Œåˆ™æƒ…å†µä¼šå®Œå…¨ä¸åŒã€‚ </font>åŒæ ·ï¼Œé¦–å…ˆæ ¹æ®å¦‚ä¸‹ä»£ç åˆ›å»ºæµ‹è¯•è¡¨zï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Z (</span><br><span class="line">a INT,</span><br><span class="line">b INT,</span><br><span class="line">PRIMARY KEY (a),</span><br><span class="line">KEY (b)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO Z</span><br><span class="line">VALUES</span><br><span class="line">(1, 1),</span><br><span class="line">(3, 1),</span><br><span class="line">(5, 3),</span><br><span class="line">(7, 6),</span><br><span class="line">(10, 8);</span><br></pre></td></tr></table></figure><p>è¡¨zçš„åˆ—bæ˜¯è¾…åŠ©ç´¢å¼•ï¼Œè‹¥åœ¨<strong>ä¼šè¯A</strong>ä¸­æ‰§è¡Œä¸‹é¢çš„SQLè¯­å¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM Z WHERE b=3 FOR UPDATE;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œè¿™æ—¶SQLè¯­å¥é€šè¿‡ç´¢å¼•åˆ—bè¿›è¡ŒæŸ¥è¯¢ï¼Œå› æ­¤å…¶ä½¿ç”¨ä¼ ç»Ÿçš„Next-Key LockingæŠ€æœ¯åŠ é”ï¼Œå¹¶ä¸”ç”±äº<strong>æœ‰ä¸¤ä¸ªç´¢å¼•ï¼Œå…¶éœ€è¦åˆ†åˆ«è¿›è¡Œé”å®š</strong>ã€‚<strong>å¯¹äºèšé›†ç´¢å¼•ï¼Œå…¶ä»…å¯¹åˆ—aç­‰äº5çš„ç´¢å¼•åŠ ä¸ŠRecord Lockã€‚è€Œå¯¹äºè¾…åŠ©ç´¢å¼•ï¼Œå…¶åŠ ä¸Šçš„æ˜¯Next-Key Lockingï¼Œé”å®šçš„èŒƒå›´æ˜¯(1,3)</strong>,ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<font color="DeepPink">InnoDBå­˜å‚¨å¼•æ“ä¼šå¯¹è¾…åŠ©ç´¢å¼•ä¸‹ä¸€ä¸ªé”®å€¼åŠ ä¸Šgap lockï¼Œå³è¿˜æœ‰ä¸€ä¸ªè¾…åŠ©ç´¢å¼•èŒƒå›´ä¸º(3,6)çš„é”</font>ã€‚ å› æ­¤ï¼Œè‹¥åœ¨æ–°<strong>ä¼šè¯B</strong>ä¸­è¿è¡Œä¸‹é¢çš„SQLè¯­å¥ï¼Œéƒ½ä¼šè¢«é˜»å¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM Z WHERE a=5 LOCK IN SHARE MODE;</span><br><span class="line">INSERT INTO Z SELECT 4,2;</span><br><span class="line">INSERT INTO Z SELECT 6,5;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªSQLè¯­å¥ä¸èƒ½æ‰§è¡Œï¼Œå› ä¸ºåœ¨ä¼šè¯Aä¸­æ‰§è¡Œçš„SQLè¯­å¥å·²ç»èšé›†ç´¢å¼•ä¸­åˆ—a=5çš„å€¼åŠ ä¸ŠXé”ï¼Œå› æ­¤æ‰§è¡Œä¼šè¢«é˜»å¡ã€‚ç¬¬äºŒä¸ªSQLè¯­å¥ï¼Œä¸»é”®æ’å…¥4ï¼Œæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ’å…¥çš„è¾…åŠ©ç´¢å¼•å€¼2åœ¨é”å®šçš„èŒƒå›´ï¼ˆ1ï¼Œ3ï¼‰ä¸­å› æ­¤æ‰§è¡ŒåŒæ ·ä¼šè¢«é˜»å¡ã€‚ç¬¬ä¸‰ä¸ªSQLè¯­å¥ï¼Œæ’å…¥çš„ä¸»é”®6æ²¡æœ‰è¢«é”å®šï¼Œ5ä¹Ÿä¸åœ¨èŒƒå›´ï¼ˆ1ï¼Œ3ï¼‰ä¹‹é—´ã€‚ä½†æ’å…¥çš„å€¼5åœ¨å¦ä¸€ä¸ªé”å®šèŒƒå›´ï¼ˆ3ï¼Œ6ï¼‰ä¸­ï¼Œæ•…åŒæ ·éœ€è¦ç­‰å¾…ã€‚è€Œä¸‹é¢çš„SQLè¯­å¥ï¼Œä¸ä¼šè¢«é˜»å¡ï¼Œå¯ä»¥ç«‹å³æ‰§è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO Z SELECT 8,6;</span><br><span class="line">INSERT INTO Z SEELCT 2,0;</span><br><span class="line">INSERT INTO Z SELECT 6,7;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ<font color="DeepPink">Gap Lockçš„ä½œç”¨æ˜¯ä¸ºäº†é˜»æ­¢å¤šä¸ªäº‹åŠ¡å°†è®°å½•æ’å…¥åˆ°åŒä¸€ä¸ªèŒƒå›´å†…ï¼Œè€Œè¿™ä¼šå¯¼è‡´Phantom Problemé—®é¢˜çš„äº§ç”Ÿã€‚</font> ä¾‹å¦‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¼šè¯Aä¸­ç”¨æˆ·å·²ç»é”å®šäº†b=3çš„è®°å½•ã€‚è‹¥æ­¤æ—¶æ²¡æœ‰Gap Locké”å®šï¼ˆ3ï¼Œ6ï¼‰ï¼Œé‚£ä¹ˆç”¨æˆ·å¯ä»¥æ’å…¥ç´¢å¼•båˆ—ä¸º3çš„è®°å½•ï¼Œè¿™ä¼šå¯¼è‡´ä¼šè¯Aä¸­çš„ç”¨æˆ·å†æ¬¡æ‰§è¡ŒåŒæ ·æŸ¥è¯¢æ—¶ä¼šè¿”å›ä¸åŒçš„è®°å½•ï¼Œå¯¼è‡´Phantom Problemé—®é¢˜çš„äº§ç”Ÿã€‚</p><p>ç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥æ˜¾å¼åœ°å…³é—­Gap Lockï¼š</p><ul><li>å°†äº‹åŠ¡çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºREAD COMMITTED</li><li>å°†å‚æ•°innodb_locks_unsafe_for_binlogè®¾ç½®ä¸º1</li></ul><p>åœ¨ä¸Šè¿°çš„é…ç½®ä¸‹ï¼Œé™¤äº†å¤–é”®çº¦æŸå’Œå”¯ä¸€æ€§æ£€æŸ¥ä¾ç„¶éœ€è¦çš„Gap Lockï¼Œå…¶ä½™æƒ…å†µä»…ä½¿ç”¨Record Lockè¿›è¡Œé”å®šã€‚ä½†éœ€è¦ç‰¢è®°çš„æ˜¯ï¼Œä¸Šè¿°è®¾ç½®ç ´åäº†äº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œå¹¶ä¸”å¯¹äºreplicationï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸»ä»æ•°æ®çš„ä¸ä¸€è‡´ã€‚æ­¤å¤–ï¼Œä»æ€§èƒ½ä¸Šæ¥çœ‹ï¼ŒREAD COMMITTEDä¹Ÿä¸ä¼šä¼˜äºé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«READ REPEATABLEã€‚</p><p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œå¯¹äºINSERTçš„æ“ä½œï¼Œå…¶ä¼šæ£€æŸ¥æ’å…¥è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•æ˜¯å¦è¢«é”å®šï¼Œè‹¥å·²è¢«é”å®šï¼Œåˆ™ä¸å…è®¸æŸ¥è¯¢ã€‚å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œä¼šè¯Aå·²ç»é”å®šäº†è¡¨zä¸­b=3çš„è®°å½•ï¼Œå³å·²ç»é”å®šäº†ï¼ˆ1ï¼Œ3ï¼‰çš„èŒƒå›´ï¼Œè¿™æ—¶è‹¥åœ¨å…¶ä»–ä¼šè¯ä¸­è¿›è¡Œå¦‚ä¸‹çš„æ’å…¥åŒæ ·ä¼šå¯¼è‡´é˜»å¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO Z SELECT 2,2;</span><br></pre></td></tr></table></figure><p>å› ä¸ºåœ¨è¾…åŠ©ç´¢å¼•åˆ—bä¸Šæ’å…¥å€¼ä¸º2çš„è®°å½•æ—¶ï¼Œä¼šç›‘æµ‹åˆ°ä¸‹ä¸€ä¸ªè®°å½•3å·²ç»è¢«ç´¢å¼•ã€‚è€Œå°†æ’å…¥ä¿®æ”¹ä¸ºå¦‚ä¸‹çš„å€¼ï¼Œå¯ä»¥ç«‹å³æ‰§è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO Z SELECT 2,0;</span><br></pre></td></tr></table></figure><blockquote><p>æœ€åå†æ¬¡æé†’çš„æ˜¯ï¼Œå¯¹äºå”¯ä¸€é”®å€¼çš„é”å®š,Next-Key Locké™çº§ä¸ºRecord Lockä»…å­˜åœ¨äºæŸ¥è¯¢æ‰€æœ‰çš„å”¯ä¸€ç´¢å¼•ä¸€åˆ—ã€‚è‹¥å”¯ä¸€ç´¢å¼•ç”±å¤šä¸ªåˆ—ç»„æˆï¼Œè€ŒæŸ¥è¯¢æ˜¯æŸ¥æ‰¾å¤šä¸ªå”¯ä¸€ç´¢å¼•åˆ—ä¸­çš„å…¶ä¸­ä¸€ä¸ªï¼Œé‚£ä¹ˆæŸ¥è¯¢å…¶å®æ˜¯rangeç±»å‹æŸ¥è¯¢ï¼Œè€Œä¸æ˜¯pointç±»å‹æŸ¥è¯¢æ•…InnoDBå­˜å‚¨å¼•æ“ä¾ç„¶ä½¿ç”¨Next-Key Lockè¿›è¡Œé”å®šã€‚</p></blockquote><h1 id="è§£å†³-Phantom-Problem"><a href="#è§£å†³-Phantom-Problem" class="headerlink" title="è§£å†³ Phantom Problem"></a>è§£å†³ Phantom Problem</h1><p>åœ¨é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œå³REPEATABLE READä¸‹ï¼ŒInnoDBå­˜å‚¨å¼•æ“é‡‡ç”¨<br>Next-Key Lockingæœºåˆ¶æ¥é¿å…Phantom Problem (å¹»åƒé—®é¢˜ï¼‰ã€‚è¿™ç‚¹å¯èƒ½ä¸åŒäºä¸å…¶ä»–çš„æ•°æ®åº“ï¼Œå¦‚Oracleæ•°æ®åº“ï¼Œå› ä¸ºå…¶å¯èƒ½éœ€è¦åœ¨SERIALIZABLEçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹æ‰èƒ½è§£å†³ Phantom Problemã€‚</p><p><strong>Phantom Problemæ˜¯æŒ‡åœ¨<font color="DeepPink">åŒä¸€äº‹åŠ¡</font>ä¸‹ï¼Œè¿ç»­æ‰§è¡Œä¸¤æ¬¡åŒæ ·çš„SQLè¯­å¥å¯èƒ½å¯¼è‡´ä¸åŒçš„ç»“æœï¼Œç¬¬äºŒæ¬¡çš„SQLè¯­å¥å¯èƒ½ä¼šè¿”å›ä¹‹å‰ä¸å­˜åœ¨çš„è¡Œã€‚</strong></p><p>ä¸‹é¢å°†æ¼”ç¤ºè¿™ä¸ªä¾‹å­ï¼Œä½¿ç”¨å‰ä¸€å°èŠ‚æ‰€åˆ›å»ºçš„è¡¨tã€‚è¡¨tç”±1ã€2ã€5è¿™ä¸‰ä¸ªå€¼ç»„æˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE</span><br><span class="line">IF EXISTS t;</span><br><span class="line"></span><br><span class="line">CREATE TABLE t (a INT PRIMARY KEY);</span><br><span class="line"></span><br><span class="line">INSERT INTO t</span><br><span class="line">VALUES</span><br><span class="line">(1),</span><br><span class="line">(2),</span><br><span class="line">(5);</span><br></pre></td></tr></table></figure><p>è‹¥è¿™æ—¶äº‹åŠ¡T1æ‰§è¡Œå¦‚ä¸‹çš„SQLè¯­å¥:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM t WHERE a&gt; 2 FOR UPDATE;</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™æ—¶äº‹åŠ¡T1å¹¶æ²¡æœ‰è¿›è¡Œæäº¤æ“ä½œï¼Œä¸Šè¿°åº”è¯¥è¿”å›5è¿™ä¸ªç»“æœã€‚è‹¥ä¸æ­¤åŒæ—¶,å¦ä¸€ä¸ªäº‹åŠ¡T2æ’å…¥äº† 4è¿™ä¸ªå€¼ï¼Œå¹¶ä¸”æ•°æ®åº“å…è®¸è¯¥æ“ä½œï¼Œé‚£ä¹ˆäº‹åŠ¡T1å†æ¬¡æ‰§è¡Œä¸Šè¿°SQLè¯­å¥ä¼šå¾—åˆ°ç»“æœ4å’Œ5ã€‚è¿™ä¸ç¬¬ä¸€æ¬¡å¾—åˆ°çš„ç»“æœä¸åŒï¼Œè¿åäº†äº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œå³å½“å‰äº‹åŠ¡èƒ½å¤Ÿçœ‹åˆ°å…¶ä»–äº‹åŠ¡çš„ç»“æœã€‚å…¶è¿‡ç¨‹å¦‚è¡¨6-13æ‰€ç¤ºï¼š<br><img alt data-src="/images/mysql-innodb-row-lock-algorithm/%E5%B9%BB%E8%AF%BB%E9%97%AE%E9%A2%98%E6%BC%94%E7%A4%BA.png"><br>InnoDBå­˜å‚¨å¼•æ“é‡‡ç”¨Next-Key Lockingçš„ç®—æ³•é¿å…Phantom Problemã€‚å¯¹äºä¸Šè¿°çš„SQLè¯­å¥SELECT* FROM t WHERE a&gt;2 FOR UPDATE,å…¶é”ä½çš„ä¸æ˜¯5è¿™å•ä¸ªå€¼ï¼Œè€Œæ˜¯å¯¹ï¼ˆ2, +ã€‡ã€‡)è¿™ä¸ªèŒƒå›´åŠ äº† Xé”ã€‚å› æ­¤ä»»ä½•å¯¹äºè¿™ä¸ªèŒƒå›´çš„æ’å…¥éƒ½æ˜¯ä¸è¢«å…è®¸çš„ï¼Œä»è€Œé¿å… Phantom Problemã€‚</p><p>InnoDBå­˜å‚¨å¼•æ“é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯REPEATABLE READ,åœ¨è¯¥éš”ç¦»çº§åˆ«ä¸‹,<br>å…¶é‡‡ç”¨Next-Key Lockingçš„æ–¹å¼æ¥åŠ é”ã€‚è€Œåœ¨äº‹åŠ¡éš”ç¦»çº§åˆ«READ COMMITTEDä¸‹,å…¶ä»…é‡‡ç”¨Record Lockï¼Œå› æ­¤åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œä¼šè¯Aéœ€è¦å°†äº‹åŠ¡çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºREAD COMMITTEDã€‚</p><p>æ­¤å¤–ï¼Œ<font color="DeepPink">ç”¨æˆ·å¯ä»¥é€šè¿‡InnoDBå­˜å‚¨å¼•æ“çš„Next-Key Lockingæœºåˆ¶åœ¨åº”ç”¨å±‚é¢å®ç°å”¯ä¸€æ€§çš„æ£€æŸ¥ã€‚</font> ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM table WHERE col=xxx LOCK IN SHARE MODE;</span><br><span class="line">If not found any row:</span><br><span class="line"># unique for insert value</span><br><span class="line">INSERT INTO table VALUES (...);</span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨æˆ·é€šè¿‡ç´¢å¼•æŸ»è¯¢ä¸€ä¸ªå€¼ï¼Œå¹¶å¯¹è¯¥è¡ŒåŠ ä¸Šä¸€ä¸ªSLockï¼Œé‚£ä¹ˆå³ä½¿æŸ»è¯¢çš„å€¼ä¸åœ¨ï¼Œå…¶é”å®šçš„ä¹Ÿæ˜¯ä¸€ä¸ªèŒƒå›´ï¼Œå› æ­¤è‹¥æ²¡æœ‰è¿”å›ä»»ä½•è¡Œï¼Œé‚£ä¹ˆæ–°æ’äººçš„å€¼ä¸€å®šæ˜¯å”¯ä¸€çš„ã€‚ä¹Ÿè®¸æœ‰è¯»è€…ä¼šæœ‰ç–‘é—®ï¼Œå¦‚æœåœ¨è¿›è¡Œç¬¬ä¸€æ­¥SELECT â€¢â€¢â€¢LOCK IN SHARE MODEæ“ä½œæ—¶ï¼Œæœ‰å¤šä¸ªäº‹åŠ¡å¹¶å‘æ“ä½œï¼Œé‚£ä¹ˆè¿™ç§å”¯ä¸€æ€§æ£€æŸ»æœºåˆ¶æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚å…¶å®å¹¶ä¸ä¼šï¼Œå› ä¸ºè¿™æ—¶ä¼šå¯¼è‡´æ­»é”ï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡çš„æ’äººæ“ä½œä¼šæˆåŠŸï¼Œè€Œå…¶ä½™çš„äº‹åŠ¡ä¼šæŠ›å‡ºæ­»é”çš„é”™è¯¯ï¼Œå¦‚è¡¨6-14æ‰€ç¤ºã€‚<br><img alt data-src="/images/mysql-innodb-row-lock-algorithm/%E5%94%AF%E4%B8%80%E6%80%A7%E6%A3%80%E6%9F%A5.png"></p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> InnoDB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL InnoDBå­˜å‚¨å¼•æ“ï¼šåˆ†åŒºè¡¨</title>
      <link href="/mysql-innodb-partition-table.html"/>
      <url>/mysql-innodb-partition-table.html</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ•´ç†è‡ªï¼šã€ŠMySQLæŠ€æœ¯å†…å¹•:InnoDBå­˜å‚¨å¼•æ“ã€‹ ç¬¬äºŒç‰ˆ ä½œè€…ï¼šå§œæ‰¿å°§</p><p>å‡ºç‰ˆæ—¶é—´ï¼š2013-05</p><a id="more"></a><h1 id="MySQLåˆ†åŒºè¡¨ä»‹ç»"><a href="#MySQLåˆ†åŒºè¡¨ä»‹ç»" class="headerlink" title="MySQLåˆ†åŒºè¡¨ä»‹ç»"></a>MySQLåˆ†åŒºè¡¨ä»‹ç»</h1><p>åˆ†åŒºæ˜¯ä¸€ç§è¡¨çš„è®¾è®¡æ¨¡å¼ï¼Œæ­£ç¡®çš„åˆ†åŒºå¯ä»¥æå¤§åœ°æå‡æ•°æ®åº“çš„æŸ¥è¯¢æ•ˆç‡ï¼Œå®Œæˆæ›´é«˜è´¨é‡çš„SQLç¼–ç¨‹ã€‚ä½†æ˜¯å¦‚æœé”™è¯¯åœ°ä½¿ç”¨åˆ†åŒºï¼Œé‚£ä¹ˆåˆ†åŒºå¯èƒ½å¸¦æ¥æ¯ç­æ€§çš„çš„ç»“æœã€‚</p><p><font color="DeepPink">åˆ†åŒºåŠŸèƒ½å¹¶ä¸æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®Œæˆçš„ï¼Œå› æ­¤ä¸åªæœ‰InnoDBå­˜å‚¨å¼•æ“æ”¯æŒåˆ†åŒºï¼Œå¸¸è§çš„å­˜å‚¨å¼•æ“MyISAMã€NDBç­‰éƒ½æ”¯æŒåˆ†åŒºã€‚</font> ä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„å­˜å‚¨å¼•æ“éƒ½æ”¯æŒï¼Œå¦‚CSVã€FEDORATEDã€MERGEç­‰å°±ä¸æ”¯æŒåˆ†åŒºã€‚åœ¨ä½¿ç”¨æ­¤åˆ†åŒºåŠŸèƒ½å‰ï¼Œåº”è¯¥å¯¹é€‰æ‹©çš„å­˜å‚¨å¼•æ“å¯¹åˆ†åŒºçš„æ”¯æŒæœ‰æ‰€äº†è§£ã€‚</p><p>MySQLæ•°æ®åº“åœ¨5.1ç‰ˆæœ¬æ—¶æ·»åŠ äº†å¯¹åˆ†åŒºçš„æ”¯æŒï¼Œ<font color="DeepPink">åˆ†åŒºçš„è¿‡ç¨‹æ˜¯å°†ä¸€ä¸ªè¡¨æˆ–ç´¢å¼•åˆ†è§£ä¸ºå¤šä¸ªæ›´å°ã€æ›´å¯ç®¡ç†çš„éƒ¨åˆ†ã€‚å°±è®¿é—®æ•°æ®åº“çš„åº”ç”¨è€Œè¨€ï¼Œä»é€»è¾‘ä¸Šè®²ï¼Œåªæœ‰ä¸€ä¸ªè¡¨æˆ–ä¸€ä¸ªç´¢å¼•ï¼Œä½†æ˜¯åœ¨ç‰©ç†ä¸Šè¿™ä¸ªè¡¨æˆ–ç´¢å¼•å¯èƒ½ç”±æ•°åä¸ªç‰©ç†åˆ†åŒºç»„æˆã€‚æ¯ä¸ªåˆ†åŒºéƒ½æ˜¯ç‹¬ç«‹çš„å¯¹è±¡ï¼Œå¯ä»¥ç‹¬è‡ªå¤„ç†ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªæ›´å¤§å¯¹è±¡çš„ä¸€éƒ¨åˆ†è¿›è¡Œå¤„ç†ã€‚</font></p><p>MySQLæ•°æ®åº“æ”¯æŒçš„åˆ†åŒºç±»å‹ä¸º<font color="DeepPink">æ°´å¹³åˆ†åŒº</font>ï¼ˆæŒ‡å°†åŒä¸€ä¸ªè¡¨ä¸­ä¸åŒè¡Œçš„è®°å½•åˆ†é…åˆ°ä¸åŒçš„ç‰©ç†æ–‡ä»¶ä¸­ï¼‰ï¼Œå¹¶ä¸æ”¯æŒå‚ç›´åˆ†åŒºï¼ˆæŒ‡å°†åŒä¸€è¡¨ä¸­ä¸åŒåˆ—çš„è®°å½•åˆ†é…åˆ°ä¸åŒçš„ç‰©ç†æ–‡ä»¶ä¸­ï¼‰ã€‚æ­¤å¤–ï¼Œ<font color="DeepPink">MySQLæ•°æ®åº“çš„åˆ†åŒºæ˜¯å±€éƒ¨åˆ†åŒºç´¢å¼•ï¼Œä¸€ä¸ªåˆ†åŒºä¸­æ—¢å­˜æ”¾äº†æ•°æ®åˆå­˜æ”¾äº†ç´¢å¼•ã€‚</font>è€Œå…¨å±€åˆ†åŒºæ˜¯æŒ‡ï¼Œæ•°æ®å­˜æ”¾åœ¨å„ä¸ªåˆ†åŒºä¸­ï¼Œä½†æ˜¯æ‰€æœ‰æ•°æ®çš„ç´¢å¼•æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚ç›®å‰ï¼ŒMySQLæ•°æ®åº“è¿˜ä¸æ”¯æŒå…¨å±€åˆ†åŒºã€‚</p><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰æ•°æ®åº“æ˜¯å¦å¯ç”¨äº†åˆ†åŒºåŠŸèƒ½ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show global variables like &apos;%partition%&apos;;</span><br><span class="line">+-------------------+-------+</span><br><span class="line">| Variable_name     | Value |</span><br><span class="line">+-------------------+-------+</span><br><span class="line">| have_partitioning | YES   |</span><br><span class="line">+-------------------+-------+</span><br><span class="line">1 row in set (0.04 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; show plugins</span><br><span class="line">*************************** 43. row ***************************</span><br><span class="line">   Name: partition</span><br><span class="line"> Status: ACTIVE</span><br><span class="line">   Type: STORAGE ENGINE</span><br><span class="line">Library: NULL</span><br><span class="line">License: GPL</span><br></pre></td></tr></table></figure><p>æœ‰æ—¶å€™å¯èƒ½ä¼šæœ‰è¿™ä¹ˆä¸€ç§è¯¯åŒºï¼Œåªè¦å¯ç”¨äº†åˆ†åŒºï¼Œæ•°æ®åº“å°±ä¼šè¿è¡Œçš„æ›´å¿«ã€‚è¿™ä¸ªç»“è®ºç»“è®ºæ˜¯å­˜åœ¨å¾ˆå¤šé—®é¢˜çš„ï¼Œå°±ç»éªŒæ¥çœ‹ï¼Œåˆ†åŒºå¯èƒ½ä¼šç»™æŸäº›SQLè¯­å¥æ€§èƒ½å¸¦æ¥æé«˜ï¼Œä½†æ˜¯åˆ†åŒºä¸»è¦ç”¨äºæ•°æ®åº“é«˜å¯ç”¨æ€§çš„ç®¡ç†ã€‚åœ¨OLTPåº”ç”¨ä¸­ï¼Œå¯¹äºåˆ†åŒºçš„ä½¿ç”¨åº”è¯¥éå¸¸å°å¿ƒï¼Œæ€»ä¹‹ï¼Œå¦‚æœåªæ˜¯ä¸€å‘³åœ°ä½¿ç”¨åˆ†åŒºï¼Œè€Œä¸ç†è§£åˆ†åŒºæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä¹Ÿä¸æ¸…æ¥šä½ çš„åº”ç”¨å¦‚ä½•ä½¿ç”¨åˆ†åŒºï¼Œé‚£ä¹ˆåˆ†åŒºææœ‰å¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢çš„å½±å“ã€‚</p><h1 id="MySQLåˆ†åŒºç±»å‹"><a href="#MySQLåˆ†åŒºç±»å‹" class="headerlink" title="MySQLåˆ†åŒºç±»å‹"></a>MySQLåˆ†åŒºç±»å‹</h1><h2 id="RANGEåˆ†åŒº"><a href="#RANGEåˆ†åŒº" class="headerlink" title="RANGEåˆ†åŒº"></a>RANGEåˆ†åŒº</h2><p>RANGEåˆ†åŒºï¼Œæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§åˆ†åŒºç±»å‹ï¼ŒåŸºäºå±äºä¸€ä¸ªç»™å®šè¿ç»­åŒºé—´çš„åˆ—å€¼ï¼ŒæŠŠå¤šè¡Œåˆ†é…ç»™åˆ†åŒºã€‚è¿™äº›åŒºé—´è¦è¿ç»­ä¸”ä¸èƒ½ç›¸äº’é‡å ï¼Œä½¿ç”¨VALUES LESS THANæ“ä½œç¬¦æ¥è¿›è¡Œå®šä¹‰ã€‚</p><h2 id="LISTåˆ†åŒº"><a href="#LISTåˆ†åŒº" class="headerlink" title="LISTåˆ†åŒº"></a>LISTåˆ†åŒº</h2><p>LISTåˆ†åŒºå’ŒRANGEåˆ†åŒºç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºLISTåˆ†åŒºæ˜¯åŸºäºåˆ—å€¼åŒ¹é…ä¸€ä¸ªç¦»æ•£å€¼é›†åˆä¸­çš„æŸä¸ªå€¼æ¥è¿›è¡Œé€‰æ‹©ï¼Œè€Œéè¿ç»­çš„ã€‚</p><p>LISTåˆ†åŒºé€šè¿‡ä½¿ç”¨â€œPARTITION BY LIST(expr)â€æ¥å®ç°ï¼Œå…¶ä¸­â€œexprâ€ æ˜¯æŸåˆ—å€¼æˆ–ä¸€ä¸ªåŸºäºæŸä¸ªåˆ—å€¼ã€å¹¶è¿”å›ä¸€ä¸ªæ•´æ•°å€¼çš„è¡¨è¾¾å¼ï¼Œç„¶åé€šè¿‡â€œVALUES IN (value_list)â€çš„æ–¹å¼æ¥å®šä¹‰æ¯ä¸ªåˆ†åŒºï¼Œå…¶ä¸­â€œvalue_listâ€æ˜¯ä¸€ä¸ªé€šè¿‡é€—å·åˆ†éš”çš„æ•´æ•°åˆ—è¡¨ã€‚</p><h2 id="HASHåˆ†åŒº"><a href="#HASHåˆ†åŒº" class="headerlink" title="HASHåˆ†åŒº"></a>HASHåˆ†åŒº</h2><p>HASHåˆ†åŒºçš„ç›®çš„æ˜¯å°†æ•°æ®å‡åŒ€åœ°åˆ†å¸ƒåˆ°é¢„å…ˆå®šä¹‰çš„å„ä¸ªåˆ†åŒºä¸­ï¼Œä¿è¯å„åˆ†åŒºçš„æ•°æ®é‡å¤§è‡´éƒ½æ˜¯ä¸€æ ·çš„ã€‚åœ¨RANGEå’ŒLISTåˆ†åŒºä¸­ï¼Œå¿…é¡»æ˜ç¡®æŒ‡å®šä¸€ä¸ªç»™å®šçš„åˆ—å€¼æˆ–åˆ—å€¼é›†åˆåº”è¯¥ä¿å­˜åœ¨å“ªä¸ªåˆ†åŒºä¸­ï¼›è€Œåœ¨HASHåˆ†åŒºä¸­ï¼ŒMySQLè‡ªåŠ¨å®Œæˆè¿™äº›å·¥ä½œï¼Œç”¨æˆ·æ‰€è¦åšçš„åªæ˜¯åŸºäºå°†è¦è¿›è¡Œå“ˆå¸Œåˆ†åŒºçš„åˆ—å€¼æŒ‡å®šä¸€ä¸ªåˆ—å€¼æˆ–è¡¨è¾¾å¼ï¼Œä»¥åŠæŒ‡å®šè¢«åˆ†åŒºçš„è¡¨å°†è¦è¢«åˆ†éš”æˆçš„åˆ†åŒºæ•°é‡ã€‚</p><p>è¦ä½¿ç”¨HASHåˆ†åŒºæ¥åˆ†å‰²ä¸€ä¸ªè¡¨ï¼Œè¦åœ¨CREATE TABLE è¯­å¥ä¸Šæ·»åŠ ä¸€ä¸ªâ€œPARTITION BY HASH (expr)â€å­å¥ï¼Œå…¶ä¸­â€œexprâ€æ˜¯ä¸€ä¸ªè¿”å›ä¸€ä¸ªæ•´æ•°çš„è¡¨è¾¾å¼ã€‚å®ƒå¯ä»¥ä»…ä»…æ˜¯å­—æ®µç±»å‹ä¸ºMySQL æ•´å‹çš„ä¸€åˆ—çš„åå­—ã€‚æ­¤å¤–ï¼Œä½ å¾ˆå¯èƒ½éœ€è¦åœ¨åé¢å†æ·»åŠ ä¸€ä¸ªâ€œPARTITIONS numâ€å­å¥ï¼Œå…¶ä¸­numæ˜¯ä¸€ä¸ªéè´Ÿçš„æ•´æ•°ï¼Œå®ƒè¡¨ç¤ºè¡¨å°†è¦è¢«åˆ†å‰²æˆåˆ†åŒºçš„æ•°é‡ï¼Œå¦‚æœæ²¡æœ‰åŒ…æ‹¬ä¸€ä¸ªPARTITIONSå­å¥ï¼Œé‚£ä¹ˆåˆ†åŒºçš„æ•°é‡å°†é»˜è®¤ä¸º1ã€‚</p><h2 id="LINER-HASH"><a href="#LINER-HASH" class="headerlink" title="LINER HASH"></a>LINER HASH</h2><p>MySQLè¿˜æ”¯æŒçº¿æ€§å“ˆå¸ŒåŠŸèƒ½ï¼Œå®ƒä¸å¸¸è§„å“ˆå¸Œçš„åŒºåˆ«åœ¨äºï¼Œçº¿æ€§å“ˆå¸ŒåŠŸèƒ½ä½¿ç”¨çš„ä¸€ä¸ªçº¿æ€§çš„2çš„å¹‚ï¼ˆpowers-of-twoï¼‰è¿ç®—æ³•åˆ™ï¼Œè€Œå¸¸è§„å“ˆå¸Œä½¿ç”¨çš„æ˜¯æ±‚å“ˆå¸Œå‡½æ•°å€¼çš„æ¨¡æ•°ã€‚<br>çº¿æ€§å“ˆå¸Œåˆ†åŒºå’Œå¸¸è§„å“ˆå¸Œåˆ†åŒºåœ¨è¯­æ³•ä¸Šçš„å”¯ä¸€åŒºåˆ«åœ¨äºï¼Œåœ¨â€œPARTITION BYâ€ å­å¥ä¸­æ·»åŠ â€œLINEARâ€å…³é”®å­—ã€‚</p><h2 id="KEYåˆ†åŒº"><a href="#KEYåˆ†åŒº" class="headerlink" title="KEYåˆ†åŒº"></a>KEYåˆ†åŒº</h2><p>KEYåˆ†åŒºå’ŒHASHåˆ†åŒºç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºHASHåˆ†åŒºä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„å‡½æ•°è¿›è¡Œåˆ†åŒºï¼Œæ”¯æŒå­—ç¬¦ä¸²HASHåˆ†åŒºï¼ŒKEYåˆ†åŒºä½¿ç”¨MySQLæ•°æ®åº“æä¾›çš„å‡½æ•°è¿›è¡Œåˆ†åŒºï¼Œè¿™äº›å‡½æ•°åŸºäºä¸PASSWORD()ä¸€æ ·çš„è¿ç®—æ³•åˆ™ã€‚</p><h2 id="COLUMNS"><a href="#COLUMNS" class="headerlink" title="COLUMNS"></a>COLUMNS</h2><p>åœ¨å‰é¢è¯´äº†RANGEã€LISTã€HASHå’ŒKEYè¿™å››ç§åˆ†åŒºä¸­ï¼Œåˆ†åŒºçš„æ¡ä»¶æ˜¯ï¼šæ•°æ®å¿…é¡»ä¸ºæ•´å½¢ï¼ˆintergerï¼‰ï¼Œå¦‚æœä¸æ˜¯æ•´å½¢ï¼Œé‚£åº”è¯¥éœ€è¦é€šè¿‡å‡½æ•°å°†å…¶è½¬åŒ–ä¸ºæ•´å½¢ï¼Œå¦‚YEAR()ï¼ŒTO_DAYS()ï¼ŒMONTH()ç­‰å‡½æ•°ã€‚MySQL5.5ç‰ˆæœ¬å¼€å§‹æ”¯æŒCOLUMNSåˆ†åŒºï¼Œå¯è§†ä¸ºRANGEåˆ†åŒºå’ŒLISTåˆ†åŒºçš„ä¸€ç§è¿›åŒ–ã€‚COLUMNSåˆ†åŒºå¯ä»¥ç›´æ¥ä½¿ç”¨éæ•´å½¢çš„æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œåˆ†åŒºæ ¹æ®ç±»å‹ç›´æ¥æ¯”è¾ƒè€Œå¾—ï¼Œä¸éœ€è¦è½¬åŒ–ä¸ºæ•´å½¢ã€‚æ­¤å¤–ï¼ŒRANGE COLUMNSåˆ†åŒºå¯ä»¥å¯¹å¤šä¸ªåˆ—çš„å€¼è¿›è¡Œåˆ†åŒºã€‚</p><p>COLUMNSåˆ†åŒºæ”¯æŒä»¥ä¸‹çš„æ•°æ®ç±»å‹ï¼š</p><ul><li>æ‰€æœ‰çš„æ•´å½¢ç±»å‹ï¼Œå¦‚INTã€SMALLINTã€TINYINTå’ŒBIGINTã€‚è€ŒFLOATå’ŒDECIMALåˆ™ä¸äºˆæ”¯æŒã€‚</li><li>æ—¥æœŸç±»å‹ï¼Œå¦‚DATEä½•DATETIMEã€‚å…¶ä½™çš„æ—¥æœŸç±»å‹ä¸äºˆæ”¯æŒã€‚</li><li>å­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚CHARã€VARCHARã€BINARYå’ŒVARBINARYã€‚è€ŒBLOBå’ŒTEXTç±»å‹ä¸äºˆæ”¯æŒã€‚</li></ul><h1 id="åˆ†åŒºä¸­çš„NULLå€¼"><a href="#åˆ†åŒºä¸­çš„NULLå€¼" class="headerlink" title="åˆ†åŒºä¸­çš„NULLå€¼"></a>åˆ†åŒºä¸­çš„NULLå€¼</h1><p>MySQLæ•°æ®åº“å…è®¸å¯¹NULLå€¼åšåˆ†åŒºï¼Œä½†æ˜¯å¤„ç†çš„æ–¹æ³•ä¸å…¶ä»–æ•°æ®åº“å¯èƒ½å®Œå…¨ä¸åŒã€‚MySQLæ•°æ®åº“çš„åˆ†åŒºæ€»æ˜¯è§†NULLå€¼å°äºä»»ä½•çš„ä¸€ä¸ªéNULLå€¼ï¼Œè¿™å’ŒMySQLæ•°æ®åº“ä¸­å¤„ç†NULLå€¼çš„ORDER BYæ“ä½œæ˜¯ä¸€æ ·çš„ã€‚ å› æ­¤å¯¹äºä¸åŒçš„åˆ†åŒºç±»å‹ï¼ŒMySQLæ•°æ®åº“å¯¹äºNULLå€¼çš„å¤„ç†ä¹Ÿæ˜¯å„ä¸ç›¸åŒã€‚</p><ul><li>å¯¹äºRANGEåˆ†åŒºï¼Œå¦‚æœå‘åˆ†åŒºåˆ—æ’å…¥äº†NULLå€¼ï¼Œåˆ™MySQLæ•°æ®åº“ä¼šå°†è¯¥å€¼æ”¾å…¥æœ€å·¦è¾¹çš„åˆ†åŒºã€‚</li><li>å¯¹äºLISTåˆ†åŒºï¼Œå¦‚æœå‘åˆ†åŒºåˆ—æ’å…¥äº†NULLå€¼ï¼Œåˆ™å¿…é¡»æ˜¾ç¤ºåœ°æŒ‡å‡ºå“ªä¸ªåˆ†åŒºæ”¾å…¥NULLå€¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚å¯¹äºLISTåˆ†åŒºï¼Œå¦‚æœå‘åˆ†åŒºåˆ—æ’å…¥äº†NULLå€¼ï¼Œåˆ™å¿…é¡»æ˜¾ç¤ºåœ°æŒ‡å‡ºå“ªä¸ªåˆ†åŒºæ”¾å…¥NULLå€¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</li><li>å¯¹äºHASHå’ŒKEYåˆ†åŒºï¼Œå¯¹äºNULLå€¼çš„å¤„ç†æ–¹æ³•å’ŒRANGEåˆ†åŒºã€LISTåˆ†åŒºä¸ä¸€æ ·ã€‚ä»»ä½•åˆ†åŒºå‡½æ•°éƒ½ä¼šå°†å«æœ‰NULLå€¼çš„è®°å½•è¿”å›ä¸º0ã€‚</li></ul><h1 id="åˆ†åŒºå’Œæ€§èƒ½"><a href="#åˆ†åŒºå’Œæ€§èƒ½" class="headerlink" title="åˆ†åŒºå’Œæ€§èƒ½"></a>åˆ†åŒºå’Œæ€§èƒ½</h1><p>åˆ†åŒºçœŸçš„ä¼šåŠ å¿«æ•°æ®åº“çš„æŸ¥è¯¢å—ï¼Ÿå®é™…ä¸Šå¯èƒ½æ ¹æœ¬æ„Ÿè§‰ä¸åˆ°æŸ¥è¯¢é€Ÿåº¦çš„æå‡ï¼Œç”šè‡³ä¼šå‘ç°æŸ¥è¯¢é€Ÿåº¦æ€¥å‰§ä¸‹é™ï¼Œå› æ­¤åœ¨åˆç†ä½¿ç”¨åˆ†åŒºä¹‹å‰ï¼Œå¿…é¡»äº†è§£åˆ†åŒºçš„ä½¿ç”¨ç¯å¢ƒã€‚</p><p>æ•°æ®åº“çš„åº”ç”¨åˆ†ä¸ºä¸¤ç±»ï¼šä¸€ç±»æ˜¯OLTPï¼ˆåœ¨çº¿äº‹åŠ¡å¤„ç†ï¼‰ï¼Œå¦‚Blogã€ç”µå­å•†åŠ¡ã€ç½‘ç»œæ¸¸æˆç­‰ï¼›å¦ä¸€ç±»æ˜¯OLAPï¼ˆåœ¨çº¿åˆ†æå¤„ç†ï¼‰ï¼Œå¦‚æ•°æ®ä»“åº“ã€æ•°æ®é›†å¸‚ã€‚å¯¹äºOLAPçš„åº”ç”¨ï¼Œåˆ†åŒºçš„ç¡®æ˜¯å¯ä»¥å¾ˆå¥½åœ°æé«˜æŸ¥è¯¢çš„æ€§èƒ½ï¼Œå› ä¸ºOLAPåº”ç”¨å¤§å¤šæ•°æŸ¥è¯¢éœ€è¦é¢‘ç¹åœ°æ‰«æä¸€å¼ å¾ˆå¤§çš„è¡¨ã€‚å‡è®¾æœ‰ä¸€å¼ 1äº¿è¡Œçš„è¡¨ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ—¶é—´æˆ³å±æ€§åˆ—ã€‚ç”¨æˆ·çš„æŸ¥è¯¢éœ€è¦ä»è¿™å¼ è¡¨ä¸­è·å–ä¸€å¹´çš„æ•°æ®ã€‚å¦‚æœæŒ‰æ—¶é—´æˆ³è¿›è¡Œåˆ†åŒºï¼Œåˆ™åªéœ€è¦æ‰«æç›¸åº”çš„åˆ†åŒºå³å¯ã€‚è¿™å°±æ˜¯å‰é¢ä»‹ç»çš„åˆ†åŒºä¿®å‰ªæŠ€æœ¯ã€‚</p><p><font color="DeepPink">å¯¹äºOLTPçš„åº”ç”¨ï¼Œåˆ†åŒºåº”è¯¥éå¸¸å°å¿ƒã€‚åœ¨è¿™ç§åº”ç”¨ä¸‹ï¼Œé€šå¸¸ä¸å¯èƒ½ä¼šè·å–ä¸€å¼ å¤§è¡¨10%çš„æ•°æ®ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯é€šè¿‡ç´¢å¼•è¿”å›å‡ æ¡è®°å½•å³å¯ã€‚è€Œæ ¹æ®B+æ ‘ç´¢å¼•çš„åŸç†å¯çŸ¥ï¼Œå¯¹äºä¸€å¼ å¤§è¡¨ï¼Œä¸€èˆ¬çš„B+æ ‘éœ€è¦2~3æ¬¡çš„ç£ç›˜IOã€‚å› æ­¤B+æ ‘å¯ä»¥å¾ˆå¥½åœ°å®Œæˆæ“ä½œï¼Œä¸éœ€è¦åˆ†åŒºçš„å¸®åŠ©ï¼Œå¹¶ä¸”è®¾è®¡ä¸å¥½çš„åˆ†åŒºä¼šå¸¦æ¥ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚</font></p><p>å¦‚å¾ˆå¤šå¼€å‘å›¢é˜Ÿä¼šè®¤ä¸ºå«æœ‰1000wè¡Œçš„è¡¨æ˜¯ä¸€å¼ éå¸¸å·¨å¤§çš„è¡¨ï¼Œæ‰€ä»¥ä»–ä»¬å¾€å¾€ä¼šé€‰æ‹©é‡‡ç”¨åˆ†åŒºï¼Œå¦‚å¯¹ä¸»é”®åš10ä¸ªHASHçš„åˆ†åŒºï¼Œè¿™æ ·æ¯ä¸ªåˆ†åŒºå°±åªæœ‰100wçš„æ•°æ®äº†ï¼Œå› æ­¤æŸ¥è¯¢åº”è¯¥å˜å¾—æ›´å¿«äº†ã€‚å¦‚select * from table where pk=@pkã€‚ä½†æ˜¯æœ‰æ²¡æœ‰è€ƒè™‘è¿‡è¿™æ ·ä¸€ç§æƒ…å†µï¼š100wå’Œ1000wè¡Œçš„æ•°æ®æœ¬èº«æ„æˆçš„B+æ ‘çš„å±‚æ¬¡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¯èƒ½éƒ½æ˜¯2~3å±‚ã€‚é‚£ä¹ˆä¸Šè¿°èµ°ä¸»é”®åˆ†åŒºçš„ç´¢å¼•å¹¶ä¸ä¼šå¸¦æ¥æ€§èƒ½çš„æé«˜ã€‚å¥½çš„ï¼Œå¦‚æœ1000wçš„B+æ ‘é«˜åº¦æ˜¯3,100wçš„B+æ ‘é«˜åº¦æ˜¯2ï¼Œé‚£ä¹ˆä¸Šè¿°æŒ‰ä¸»é”®åˆ†åŒºçš„ç´¢å¼•å¯ä»¥é¿å…1æ¬¡IOï¼Œä»è€Œæé«˜æŸ¥è¯¢çš„æ•ˆç‡ã€‚è¿™æ²¡é—®é¢˜ï¼Œä½†æ˜¯è¿™å¼ è¡¨åªæœ‰ä¸»é”®ç´¢å¼•ï¼Œæ²¡æœ‰ä»»ä½•å…¶ä»–çš„åˆ—éœ€è¦æŸ¥è¯¢çš„ã€‚å¦‚æœè¿˜æœ‰ç±»ä¼¼å¦‚ä¸‹çš„SQLï¼šselect * from table where key=@keyï¼Œè¿™æ—¶å¯¹äºkeyçš„æŸ¥è¯¢éœ€è¦æ‰«ææ‰€æœ‰çš„10ä¸ªåˆ†åŒºï¼Œå³ä½¿æ¯ä¸ªåˆ†åŒºçš„æŸ¥è¯¢å¼€é”€ä¸º2æ¬¡IOï¼Œåˆ™ä¸€å…±éœ€è¦20æ¬¡IOã€‚è€Œå¯¹äºåŸæ¥å•è¡¨çš„è®¾è®¡ï¼Œå¯¹äºKEYçš„æŸ¥è¯¢åªéœ€è¦2~3æ¬¡IOã€‚</p><p>ç”±ä»¥ä¸Šç»“è®ºå¯ä»¥çœ‹å‡ºï¼Œå¯¹äºåœ¨OLTPåœºæ™¯ä¸­ä½¿ç”¨åˆ†åŒºä¸€å®šè¦ç‰¹åˆ«å°å¿ƒäº†ã€‚</p><h1 id="MySQL-5-7å¯¹åˆ†åŒºçš„æ”¹è¿›"><a href="#MySQL-5-7å¯¹åˆ†åŒºçš„æ”¹è¿›" class="headerlink" title="MySQL 5.7å¯¹åˆ†åŒºçš„æ”¹è¿›"></a>MySQL 5.7å¯¹åˆ†åŒºçš„æ”¹è¿›</h1><p>åœ¨MySQL 5.6é‡Œé¢ï¼Œåˆ†åŒºçš„ä¿¡æ¯æ˜¯åœ¨MySQL Serverå±‚ç»´æŠ¤çš„ï¼ˆåœ¨.paræ–‡ä»¶é‡Œé¢ï¼‰ï¼ŒInnoDBå¼•æ“å±‚æ˜¯ä¸çŸ¥é“æœ‰åˆ†åŒºè¿™ä¸ªæ¦‚å¿µçš„ï¼ŒInnoDBå¼•æ“å±‚æŠŠæ¯ä¸€ä¸ªåˆ†åŒºéƒ½å½“æˆä¸€å¼ æ™®é€šçš„InnoDBè¡¨ã€‚åœ¨æ‰“å¼€ä¸€ä¸ªåˆ†åŒºè¡¨æ—¶ï¼Œä¼šæ‰“å¼€å¾ˆå¤šä¸ªåˆ†åŒºï¼Œæ‰“å¼€è¿™äº›åˆ†åŒºè¡¨å°±ç›¸å½“äºæ‰“å¼€äº†åŒç­‰æ•°é‡çš„InnoDBè¡¨ï¼Œè¿™éœ€è¦æ›´å¤šå†…å­˜å­˜æ”¾InnoDBè¡¨çš„å…ƒæ•°æ®å’Œå„ç§ä¸ibdæ–‡ä»¶æ‰“å¼€ç›¸å…³çš„å„ç§cacheä¸handlerçš„ä¿¡æ¯ã€‚åœ¨MySQL 5.7é‡Œé¢ï¼ŒInnoDBå¼•å…¥äº†Native Partitioningï¼Œå®ƒæŠŠåˆ†åŒºçš„ä¿¡æ¯ä»Serverå±‚ç§»åˆ°äº†InnoDBå±‚ï¼Œæ‰“å¼€ä¸€ä¸ªåˆ†åŒºè¡¨å’Œæ‰“å¼€ä¸€ä¸ªInnoDBè¡¨çš„å†…å­˜å¼€é”€åŸºæœ¬æ˜¯ä¸€æ ·çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> InnoDB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL InnoDBå­˜å‚¨å¼•æ“ï¼šä¸€è‡´æ€§é”å®šè¯»</title>
      <link href="/mysql-innodb-consistent-locking-read.html"/>
      <url>/mysql-innodb-consistent-locking-read.html</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ•´ç†è‡ªï¼šã€ŠMySQLæŠ€æœ¯å†…å¹•:InnoDBå­˜å‚¨å¼•æ“ã€‹ ç¬¬äºŒç‰ˆ ä½œè€…ï¼šå§œæ‰¿å°§</p><p>å‡ºç‰ˆæ—¶é—´ï¼š2013-05</p><a id="more"></a><p>åœ¨å‰ä¸€å°èŠ‚ä¸­è®²åˆ°ï¼Œåœ¨é»˜è®¤é…ç½®ä¸‹ï¼Œå³äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä¸º REPEATABLE READ æ¨¡å¼ä¸‹ï¼Œ InnoDB å­˜å‚¨å¼•æ“çš„ SELECT æ“ä½œä½¿ç”¨ä¸€è‡´æ€§éé”å®šè¯»ã€‚ä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·éœ€è¦æ˜¾å¼åœ°å¯¹æ•°æ®åº“è¯»å–æ“ä½œè¿›è¡ŒåŠ é”ä»¥ä¿è¯æ•°æ®é€»è¾‘çš„ä¸€è‡´æ€§ã€‚è€Œè¿™è¦æ±‚æ•°æ®åº“æ”¯æŒåŠ é”è¯­å¥ï¼Œå³ä½¿æ˜¯å¯¹äºSELECTçš„åªè¯»æ“ä½œã€‚InnoDBå­˜å‚¨å¼•æ“å¯¹äºSELECTè¯­å¥æ”¯æŒä¸¤ç§ä¸€è‡´æ€§çš„é”å®šè¯»ï¼ˆlocking read)æ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT......FOR UPDATE</span><br><span class="line">SELECT......LOCK IN SHARE MODE</span><br></pre></td></tr></table></figure><p><font color="DeepPink">SELECTâ€¦FOR UPDATEå¯¹è¯»å–çš„è¡Œè®°å½•åŠ ä¸€ä¸ªXé”ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½å¯¹å·²é”å®šçš„è¡ŒåŠ ä¸Šä»»ä½•é”ã€‚</font><br><font color="DeepPink">SELECTâ€¦LOCK IN SHARE MODEå¯¹è¯»å–çš„è¡Œè®°å½•åŠ ä¸€ä¸ªSé”ï¼Œå…¶ä»–äº‹åŠ¡å¯ä»¥å‘è¢«é”å®šçš„è¡ŒåŠ Sé”ï¼Œä½†æ˜¯å¦‚æœåŠ Xé”ï¼Œåˆ™ä¼šè¢«é˜»å¡ã€‚</font></p><p>å¯¹äºä¸€è‡´æ€§éé”å®šè¯»ï¼Œå³ä½¿è¯»å–çš„è¡Œå·²è¢«æ‰§è¡Œäº† SELECTâ€¦FOR UPDATE,ä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œè¯»å–çš„ï¼Œè¿™å’Œä¹‹å‰è®¨è®ºçš„æƒ…å†µä¸€æ ·ã€‚æ­¤å¤–ï¼ŒSELECTâ€¦FOR UPDATE, SELECTâ€¦LOCK IN SHARE MODEå¿…é¡»åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå½“äº‹åŠ¡æäº¤äº†ï¼Œé”ä¹Ÿå°±é‡Šæ”¾äº†ã€‚å› æ­¤åœ¨ä½¿ç”¨ä¸Šè¿°ä¸¤å¥SELECTé”å®šè¯­å¥æ—¶ï¼ŒåŠ¡å¿…åŠ ä¸ŠBEGIN,START TRANSACTION æˆ–è€…SET AUTOCOMMIT =0 ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> InnoDB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL InnoDBå­˜å‚¨å¼•æ“ï¼šä¸€è‡´æ€§éé”å®šè¯»</title>
      <link href="/mysql-innodb-consistent-nonlocking-read.html"/>
      <url>/mysql-innodb-consistent-nonlocking-read.html</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ•´ç†è‡ªï¼šã€ŠMySQLæŠ€æœ¯å†…å¹•:InnoDBå­˜å‚¨å¼•æ“ã€‹ ç¬¬äºŒç‰ˆ ä½œè€…ï¼šå§œæ‰¿å°§</p><p>å‡ºç‰ˆæ—¶é—´ï¼š2013-05</p><a id="more"></a><p><strong>ä¸€è‡´æ€§çš„éé”å®šè¡Œè¯»ï¼ˆconsistent nonlocking readï¼‰æ˜¯æŒ‡InnoDBå­˜å‚¨å¼•æ“é€šè¿‡è¡Œå¤šç‰ˆæœ¬æ§åˆ¶ï¼ˆmulti versioningï¼‰çš„æ–¹å¼æ¥è¯»å–å½“å‰æ‰§è¡Œæ—¶é—´æ•°æ®åº“ä¸­è¡Œçš„æ•°æ®ã€‚å¦‚æœè¯»å–çš„è¡Œæ­£åœ¨æ‰§è¡ŒDELETEã€UPDATEæ“ä½œï¼Œè¿™æ˜¯è¯»å–æ“ä½œä¸ä¼šå› æ­¤è€Œä¼šç­‰å¾…è¡Œä¸Šé”çš„é‡Šæ”¾ï¼Œç›¸åï¼ŒInnoDBä¼šå»è¯»å–è¡Œçš„ä¸€ä¸ªå¿«ç…§æ•°æ®ã€‚</strong></p><p>ä¸‹å›¾ç›´è§‚å±•ç¤ºäº†ä¸€è‡´æ€§çš„éé”å®šè¡Œè¯»ï¼š<br><img alt data-src="/images/mysql-innodb-consistent-nonlocking-read/%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%E9%9D%9E%E9%94%81%E5%AE%9A%E8%A1%8C%E8%AF%BB.png"></p><p><strong>ä¹‹æ‰€ä»¥ç§°å…¶ä¸ºéé”å®šè¯»ï¼Œå› ä¸ºä¸éœ€è¦ç­‰å¾…è®¿é—®çš„è¡Œä¸ŠXé”çš„é‡Šæ”¾ã€‚å¿«ç…§æ•°æ®æ˜¯æŒ‡è¯¥è¡Œçš„ä¹‹å‰ç‰ˆæœ¬çš„æ•°æ®ï¼Œè¯¥å®ç°æ˜¯é€šè¿‡undoæ®µæ¥å®Œæˆã€‚è€Œundoæ®µç”¨æ¥åœ¨æ­¤äº‹åŠ¡ä¸­å›æ»šæ•°æ®ï¼Œå› æ­¤å¿«ç…§æ•°æ®æœ¬èº«æ˜¯æ²¡æœ‰é¢å¤–çš„å¼€é”€ã€‚æ­¤å¤–ï¼Œè¯»å–å¿«ç…§æ•°æ®æ˜¯ä¸éœ€è¦ä¸Šé”çš„ï¼Œå› ä¸ºæ²¡æœ‰äº‹åŠ¡éœ€è¦å¯¹å†å²çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œã€‚</strong></p><p>å¯ä»¥çœ‹åˆ°ï¼Œéé”å®šè¯»æœºåˆ¶æå¤§åœ°æé«™äº†æ•°æ®åº“çš„å¹¶å‘æ€§ã€‚<strong>åœ¨InnoDBå­˜å‚¨å¼•æ“çš„é»˜è®¤è®¾ç½®ä¸‹ï¼Œè¿™æ˜¯é»˜è®¤çš„è¯»å–æ–¹å¼ï¼Œå³è¯»å–ä¸ä¼šå ç”¨å’Œç­‰å¾…è¡¨ä¸Šçš„é”ã€‚ä½†æ˜¯åœ¨ä¸åŒäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¯»å–çš„æ–¹å¼ä¸åŒï¼Œå¹¶ä¸æ˜¯åœ¨æ¯ä¸ªäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹éƒ½æ˜¯é‡‡ç”¨éé”å®šçš„ä¸€è‡´æ€§è¯»ã€‚æ­¤å¤–ï¼Œå³ä½¿éƒ½æ˜¯ä½¿ç”¨éé”å®šçš„ä¸€è‡´æ€§è¯»ï¼Œä½†æ˜¯å¯¹äºå¿«ç…§æ•°æ®çš„å®šä¹‰ä¹Ÿå„ä¸ç›¸åŒã€‚</strong></p><p>é€šè¿‡å›¾6-4å¯ä»¥çŸ¥é“ï¼Œå¿«ç…§æ•°æ®å…¶å®å°±æ˜¯å½“å‰è¡Œæ•°æ®ä¹‹å‰çš„å†å²ç‰ˆæœ¬ï¼Œæ¯è¡Œè®°å½•å¯èƒ½æœ‰å¤šä¸ªç‰ˆæœ¬ã€‚å°±å›¾6-4æ‰€æ˜¾ç¤ºçš„ï¼Œ<strong>ä¸€ä¸ªè¡Œè®°å½•å¯èƒ½æœ‰ä¸æ­¢ä¸€ä¸ªå¿«ç…§æ•°æ®ï¼Œä¸€èˆ¬ç§°è¿™ç§æŠ€æœ¯ä¸ºè¡Œå¤šç‰ˆæœ¬æŠ€æœ¯ã€‚ç”±æ­¤å¸¦æ¥çš„å¹¶å‘æ§åˆ¶ï¼Œç§°ä¹‹ä¸ºå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMultiVersionConcurrencyControl MVCCï¼‰ã€‚</strong></p><p>åœ¨äº‹åŠ¡éš”ç¦»çº§åˆ«READ COMMITTEDå’ŒREPEATABLE READ(InnoDBå­˜å‚¨å¼•æ“çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼‰ä¸‹ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨éé”å®šçš„ä¸€è‡´æ€§è¯»ã€‚ç„¶è€Œï¼Œå¯¹äºå¿«ç…§æ•°æ®çš„å®šä¹‰å´ä¸ç›¸åŒã€‚<font color="DeepPink">åœ¨READ COMMITTEDäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯¹äºå¿«ç…§æ•°æ®ï¼Œéä¸€è‡´æ€§è¯»æ€»æ˜¯è¯»å–è¢«é”å®šè¡Œçš„æœ€æ–°ä¸€ä»½å¿«ç…§æ•°æ®ã€‚è€Œåœ¨REPEATABLE READäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯¹äºå¿«ç…§æ•°æ®ï¼Œéä¸€è‡´æ€§è¯»æ€»æ˜¯è¯»å–äº‹åŠ¡å¼€å§‹æ—¶çš„è¡Œæ•°æ®ç‰ˆæœ¬ï¼ˆå…³é”®åœ¨äºäº‹åŠ¡ä¹‹é—´çš„éš”ç¦»æ€§ï¼‰ã€‚ </font>æ¥çœ‹ä¸‹é¢çš„ä¸€ä¸ªä¾‹å­ï¼Œé¦–å…ˆåœ¨å½“å‰MySQLæ•°æ®åº“çš„è¿æ¥ä¼šè¯Aä¸­æ‰§è¡Œå¦‚ä¸‹SQLè¯­å¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Session A</span><br><span class="line">mysql&gt; BEGIN;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">Sql&gt; SELECT * FROM parent WHERE id =1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">| 1 |</span><br><span class="line">+----+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>ä¼šè¯Aä¸­å·²é€šè¿‡æ˜¾å¼åœ°æ‰§è¡Œå‘½ä»¤BEGINå¼€å¯äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶è¯»å–äº†è¡¨parentä¸­idä¸º1çš„æ•°æ®ï¼Œä½†æ˜¯äº‹åŠ¡å¹¶æ²¡æœ‰ç»“æŸã€‚ä¸æ­¤åŒæ—¶ï¼Œç”¨æˆ·å†å¼€å¯å¦ä¸€ä¸ªä¼šè¯Bï¼Œè¿™æ ·å¯ä»¥æ¨¡æ‹Ÿå¹¶å‘çš„æƒ…å†µï¼Œç„¶åå¯¹ä¼šè¯Båšå¦‚ä¸‹çš„æ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; BEGIN;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; UPDATE parent SET id=3 WHERE id=l;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1 Changed: 1 warnings: 0</span><br></pre></td></tr></table></figure><p>åœ¨ä¼šè¯Bä¸­å°†äº‹åŠ¡è¡¨parentä¸­idä¸º1çš„è®°å½•ä¿®æ”¹ä¸ºid=3ï¼Œä½†æ˜¯äº‹åŠ¡åŒæ ·æ²¡æœ‰æäº¤ï¼Œè¿™æ ·id=1çš„è¡Œå…¶å®åŠ äº†ä¸€ä¸ªXé”ã€‚è¿™æ—¶å¦‚æœåœ¨ä¼šè¯Aä¸­å†æ¬¡è¯»å–idä¸º1çš„è®°å½•ï¼Œæ ¹æ®InnoDBå­˜å‚¨å¼•æ“çš„ç‰¹æ€§ï¼Œå³åœ¨READ COMMITTEDå’ŒREPEATETABLE READçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ä¼šä½¿ç”¨éé”å®šçš„ä¸€è‡´æ€§è¯»ã€‚å›åˆ°ä¹‹å‰çš„ä¼šè¯A,æ¥ç€ä¸Šæ¬¡æœªæäº¤çš„äº‹åŠ¡ï¼Œæ‰§è¡ŒSQLè¯­å¥SELECT * FROM parent WHERE id=1çš„æ“ä½œï¼Œè¿™æ—¶ä¸ç®¡ä½¿ç”¨READ COMMITTEDè¿˜æ˜¯REPEATABLE READçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œæ˜¾ç¤ºçš„æ•°æ®åº”è¯¥éƒ½æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT FROM parent WHERE id =l;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">| 1  |</span><br><span class="line">+----+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>ç”±äºå½“å‰id=1çš„æ•°æ®è¢«ä¿®æ”¹äº†1æ¬¡ï¼Œå› æ­¤åªæœ‰ä¸€ä¸ªè¡Œç‰ˆæœ¬çš„è®°å½•ã€‚æ¥ç€ï¼Œåœ¨ä¼šè¯Bä¸­æäº¤ä¸Šæ¬¡çš„äº‹åŠ¡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Session B</span><br><span class="line">mysql&gt; commit</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure><p>åœ¨ä¼šè¯Bæäº¤äº‹åŠ¡åï¼Œè¿™æ—¶åœ¨ä¼šè¯Aä¸­å†è¿è¡ŒSELECT * FROM parent WHERE id=1çš„SQLè¯­å¥ï¼Œåœ¨READ COMMITTEDå’ŒREPEATABLEäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹å¾—åˆ°ç»“æœ å°±ä¸ä¸€æ ·äº†ã€‚å¯¹äºREAD COMMITTEDçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå®ƒæ€»æ˜¯è¯»å–è¡Œçš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¦‚æœè¡Œè¢«é”å®šäº†ï¼Œåˆ™è¯»å–è¯¥è¡Œç‰ˆæœ¬çš„æœ€æ–°ä¸€ä¸ªå¿«ç…§ï¼ˆfresh snapshotï¼‰ã€‚åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå› ä¸ºä¼šè¯Bå·²ç»æäº¤äº†äº‹åŠ¡ï¼Œæ‰€ä»¥READ COMMITTEDäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;SELECT @@tx_isolation\G;</span><br><span class="line">**************************** 1.row ****************************</span><br><span class="line">@@tx_isolation: READ-COMMITTED</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT FROM parent WHERE id=1:</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure><p>è€Œå¯¹äºREPEATETABLE çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œæ€»æ˜¯è¯»å–äº‹åŠ¡å¼€å§‹æ—¶çš„è¡Œæ•°æ®ã€‚å› æ­¤å¯¹äºREPEATETABLE READäº‹åŠ¡éš”ç¦»çº§åˆ«,å…¶å¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT @@tx_isolation\G;</span><br><span class="line">**************************** 1.row ****************************</span><br><span class="line">@@tx_isolation: REPEATABLE-READ</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT FROM parent WHERE id=1;</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">| 1  |</span><br><span class="line">+----+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å°†ä»æ—¶é—´çš„è§’åº¦å±•ç°ä¸Šè¿°æ¼”ç¤ºçš„ç¤ºä¾‹è¿‡ç¨‹ï¼Œå¦‚è¡¨6-8æ‰€ç¤ºã€‚éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºREAD COMMITTED çš„äº‹åŠ¡éš”ç¦»çº§åˆ«è€Œè¨€ï¼Œä»æ•°æ®åº“ç†è®ºçš„è§’åº¦æ¥çœ‹ï¼Œå…¶è¿åäº†äº‹åŠ¡ACIDä¸­çš„Içš„ç‰¹æ€§ï¼Œå³éš”ç¦»æ€§ã€‚<br><img alt data-src="/images/mysql-innodb-consistent-nonlocking-read/%E8%A1%A868.png"></p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> InnoDB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ—¥å¿—æœåŠ¡æ¶æ„è®¾è®¡</title>
      <link href="/log-service-architecture-design.html"/>
      <url>/log-service-architecture-design.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>åœ¨æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„å‰æä¸‹ï¼Œä»£ç ã€æ¶æ„ï¼Œè¶Šç®€å•ï¼Œè¶Šç¨³å®šã€‚</p></blockquote><a id="more"></a><p>æœ€è¿‘æƒ³æŠŠä¹‹å‰åšè¿‡çš„æ—¥å¿—é¡¹ç›®åŠä¸ªäººçš„æ€è€ƒæ¢³ç†ä¸€ä¸‹ï¼Œäºæ˜¯æœ‰äº†æœ¬æ–‡ã€‚</p><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æˆ‘ä»¬è¿™è¾¹åº”ç”¨éƒ¨ç½²çš„ç¯å¢ƒæ¯”è¾ƒå¤æ‚ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>æœºå™¨ç›´æ¥éƒ¨ç½²</li><li>é€šè¿‡åŸç”Ÿdockeréƒ¨ç½²</li><li>é€šè¿‡kubernatesé›†ç¾¤éƒ¨ç½²</li></ul><p>éƒ¨ç½²ç¯å¢ƒä¸ç»Ÿä¸€ï¼Œå¯¼è‡´æŸ¥çœ‹åº”ç”¨æ—¥å¿—å¾ˆä¸æ–¹ä¾¿ã€‚</p><h1 id="ä¸šåŠ¡éœ€æ±‚"><a href="#ä¸šåŠ¡éœ€æ±‚" class="headerlink" title="ä¸šåŠ¡éœ€æ±‚"></a>ä¸šåŠ¡éœ€æ±‚</h1><p>ä¸éƒ¨ç½²ç¯å¢ƒå¯¹åº”ï¼Œå¯¹äºæ—¥å¿—æ”¶é›†éœ€æ±‚åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p><ul><li>æœºå™¨ä¸Šçš„æ–‡æœ¬æ—¥å¿—ï¼ˆç›´æ¥è¿è¡Œåœ¨ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºä¸­çš„åº”ç”¨æ—¥å¿—ï¼‰</li><li>è¿è¡Œåœ¨dockerå®¹å™¨ä¸­çš„åº”ç”¨æ—¥å¿—</li><li>è¿è¡Œåœ¨kubernatesé›†ç¾¤ä¸­çš„åº”ç”¨æ—¥å¿—</li></ul><p>å…·ä½“ä¸šåŠ¡éœ€æ±‚å¯ä»¥æ‹†åˆ†ä¸ºï¼š</p><ul><li>æŒ‰ç…§é¡¹ç›®ã€åº”ç”¨ã€å®ä¾‹ç»´åº¦æ£€ç´¢æ—¥å¿—å¹¶æ”¯æŒæœç´¢å…³é”®å­—é«˜äº®ï¼ˆå› ä¸ºå¤§å®¶æ£€ç´¢æ—¥å¿—çš„æ—¶å€™ï¼Œè‚¯å®šæ˜¯æ£€ç´¢æŸä¸ªé¡¹ç›®ã€æŸä¸ªåº”ç”¨ã€æŸä¸ªå®ä¾‹çš„æ—¥å¿—ï¼‰</li><li>æ”¯æŒæ£€ç´¢å‡ºæŸæ¡æƒ³è¦çš„æ—¥å¿—åï¼Œå¯ä»¥æŸ¥çœ‹ä¸Šä¸‹æ–‡ï¼ˆæŸ¥çœ‹è¯¥æ—¥å¿—æ‰€åœ¨æ—¥å¿—æ–‡ä»¶çš„æ—¥å¿—ä¸Šä¸‹æ–‡ï¼‰</li><li>æ”¯æŒæ—¥å¿—ä¸‹è½½ï¼ˆç›®å‰æ”¯æŒä¸¤ç§åœºæ™¯ï¼šæœç´¢ç»“æœä¸‹è½½ã€ä¸Šä¸‹æ–‡ä¸‹è½½ï¼›æ”¯æŒä¸¤ç§æ–¹å¼ï¼šåœ¨çº¿ä¸‹è½½ã€ç¦»çº¿ä¸‹è½½ï¼‰</li><li>æ”¯æŒè‡ªåŠ¨åŒ–æ‰¹é‡éƒ¨ç½²ã€å¸è½½Agentï¼Œéƒ¨ç½²ã€å¸è½½è¿‡ç¨‹å¯è§†åŒ–</li><li>å•å®ä¾‹æ”¯æŒå¤šelasticsearché›†ç¾¤</li><li>æ”¯æŒæ–‡æœ¬æ—¥å¿—ã€dockeræ—¥å¿—ã€k8sæ—¥å¿—å¹¶èƒ½ä¸å°†æ—¥å¿—ä¸å…¶ä¸šåŠ¡æ„ä¹‰å¯¹åº”ä¸Šã€‚ï¼ˆå³ä¸ç®¡æ˜¯å“ªç§æ—¥å¿—å½¢å¼ã€æ¥æºï¼Œæœ€ç»ˆéƒ½éœ€è¦ä¸ä¸šåŠ¡æ„ä¹‰ä¸Šçš„é¡¹ç›®ã€åº”ç”¨ã€å®ä¾‹å¯¹åº”èµ·æ¥ï¼Œå› ä¸ºå¯¹äºæ—¥å¿—çš„ä½¿ç”¨è€…æ¥è¯´ï¼ŒæŸ¥è¯¢æ—¥å¿—çš„å‡ºå‘ç‚¹è‚¯å®šæ˜¯æŸ¥è¯¢æŸä¸ªé¡¹ç›®ã€æŸä¸ªåº”ç”¨ï¼ˆå¯ä»¥ä¸é€‰ï¼‰ã€æŸä¸ªå®ä¾‹ï¼ˆå¯ä»¥ä¸é€‰ï¼‰ã€æŸæ®µæ—¶é—´çš„æ—¥å¿—ã€‚ï¼‰</li><li>æ”¯æŒéƒ¨ç½²åˆ°ä¸šåŠ¡è‡ªå·±çš„é›†ç¾¤ä¸­</li></ul><p>éœ€æ±‚å·²ç»æ˜ç¡®äº†ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹ä¸šç•Œæ–¹æ¡ˆã€‚</p><h1 id="ä¸šç•Œæ—¥å¿—ç³»ç»Ÿæ¶æ„"><a href="#ä¸šç•Œæ—¥å¿—ç³»ç»Ÿæ¶æ„" class="headerlink" title="ä¸šç•Œæ—¥å¿—ç³»ç»Ÿæ¶æ„"></a>ä¸šç•Œæ—¥å¿—ç³»ç»Ÿæ¶æ„</h1><p><img alt data-src="/images/log-service-architecture-design/%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84.png"></p><ul><li>Collectorçš„ä½œç”¨æ˜¯ï¼š<ul><li>æ¸…æ´—ã€æ±‡èšæ•°æ®ï¼Œå‡å°‘å¯¹äºåç«¯é›†ç¾¤çš„å‹åŠ›ã€‚</li><li>å®‰å…¨ï¼Œä¸å…è®¸Agentç›´è¿kafkaç­‰å†…éƒ¨é›†ç¾¤ï¼Œä¿è¯ä¸€å®šçš„å®‰å…¨æ€§ï¼Œå³ä½¿åç«¯å‘ç”Ÿè°ƒæ•´ä¹Ÿèƒ½ä¿è¯å¯¹äºAgentè¿æ¥ã€è®¤è¯æ–¹å¼çš„ç¨³å®šã€‚</li></ul></li><li>MQçš„ä½œç”¨æ˜¯å‰Šå³°å¡«è°·ã€è§£è€¦ã€å¤šæ¬¡æ¶ˆè´¹ã€‚</li></ul><p>ä¸Šå›¾çš„æ¶æ„æ˜¯ä¸šç•Œæ¯”è¾ƒé€šç”¨çš„ä¸€ç§æ¶æ„ï¼Œå¯¹äºå„ç§åœºæ™¯éƒ½è€ƒè™‘çš„æ¯”è¾ƒå…¨ã€‚</p><p>æ—¢ç„¶ä¸šç•Œçš„æ¶æ„å·²ç»è¿™ä¹ˆå®Œå¤‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å°±ç›´æ¥é‡‡ç”¨å‘¢ï¼Ÿ</p><p>å¯¹äºæˆ‘ä»¬è€Œè¨€ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>æ¶‰åŠçš„ç»„ä»¶æ¯”è¾ƒå¤šï¼Œé“¾è·¯æ¯”è¾ƒé•¿ï¼Œè¿ç»´æ¯”è¾ƒéº»çƒ¦</li><li>è¿™ä¸€æ•´å¥—æ¶æ„ï¼Œä¸åˆ©äºå•ç‹¬éƒ¨ç½²ï¼ˆæ¯”å¦‚æŸä¸ªä¸šåŠ¡åº”ç”¨éƒ¨ç½²æœºæˆ¿ç½‘ç»œæ˜¯éš”ç¦»çš„ï¼Œè€Œä¸”é¡¹ç›®åˆä¸å¤§ï¼Œåªèƒ½æä¾›æœ‰é™çš„å‡ å°æœºå™¨ï¼Œè¿™æ—¶å€™å¦‚æœéœ€è¦éƒ¨ç½²ä¸šç•Œè¿™å¥—æ¶æ„çš„è¯ï¼Œèµ„æºå°±ä¼šæ¯”è¾ƒå—é™ï¼Œå¦‚æœæƒ³åšåˆ°å³æ”¯æŒä¸šç•Œæ¶æ„ç»„ä»¶çš„å¯æ’æ‹”ï¼ˆæ¯”å¦‚å¯çµæ´»çš„å†³å®šæ˜¯å¦éœ€è¦Collectorã€MQï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿ç»´å‡ å¥—é…ç½®æˆ–ä»£ç ï¼‰</li><li>æœ€å…³é”®çš„å°±æ˜¯å…¶ä¸­ç»„ä»¶æä¾›çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬ç›®å‰ç”¨ä¸åˆ°ã€‚æ¯”å¦‚MQçš„å‰Šå³°å¡«è°·ã€å¤šæ¬¡æ¶ˆè´¹ã€‚</li></ul><h1 id="ç»„ä»¶é€‰æ‹©"><a href="#ç»„ä»¶é€‰æ‹©" class="headerlink" title="ç»„ä»¶é€‰æ‹©"></a>ç»„ä»¶é€‰æ‹©</h1><p>é€‰æ‹©ç»„ä»¶ï¼Œæˆ‘ä»¬è¿™è¾¹ä¸»è¦æ˜¯ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè€ƒé‡çš„ï¼š</p><ol><li>ç»„ä»¶å¯¹åº”çš„å¼€æºç”Ÿæ€å®Œæ•´ã€æ´»è·ƒåº¦é«˜</li><li>å¯¹åº”çš„æŠ€æœ¯æ ˆæ˜¯æˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„ï¼Œæˆ‘ä»¬è¿™è¾¹è¯­è¨€æŠ€æœ¯æ ˆä¸»è¦æ˜¯Javaã€Goï¼Œå¦‚æœç»„ä»¶è¯­è¨€æ˜¯Cã€Rubyï¼Œåº”è¯¥å°±è¢«æ’é™¤äº†ã€‚</li><li>è¿ç»´æˆæœ¬</li><li>æ˜“éƒ¨ç½²ã€æ€§èƒ½å¥½</li></ol><h2 id="Agent"><a href="#Agent" class="headerlink" title="Agent"></a>Agent</h2><p>ä¸€æåˆ°æ—¥å¿—æ”¶é›†æ–¹æ¡ˆï¼Œå¤§å®¶ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„è‚¯å®šæ˜¯ELK(Elasticsearchã€Logstashã€Kibana )ï¼Œä½†Logstashä¾èµ–äºJVMä¸ç®¡æ˜¯æ€§èƒ½è¿˜æ˜¯ç®€æ´æ€§ï¼Œéƒ½ä¸æ˜¯æ—¥å¿—æ”¶é›†agentçš„é¦–é€‰ã€‚</p><p>ä¸ªäººæ„Ÿè§‰ä¸€ä¸ªå¥½çš„agentåº”è¯¥æ˜¯èµ„æºå ç”¨å°‘ï¼Œæ€§èƒ½å¥½ï¼Œä¸ä¾èµ–åˆ«çš„ç»„ä»¶ï¼Œå¯ä»¥ç‹¬ç«‹éƒ¨ç½²ã€‚è€ŒLogstashæ˜æ˜¾ä¸ç¬¦åˆè¿™å‡ ç‚¹è¦æ±‚ï¼Œä¹Ÿè®¸æ­£æ˜¯åŸºäºè¿™äº›è€ƒè™‘elasticæ¨å‡ºäº†Filebeatã€‚</p><h2 id="Collectorã€MQ"><a href="#Collectorã€MQ" class="headerlink" title="Collectorã€MQ"></a>Collectorã€MQ</h2><p>Elasticsearché›†ç¾¤åœ¨éƒ¨ç½²çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½æ˜¯æå‰ä¼°è®¡å¥½å®¹é‡ã€æœºå™¨ã€shardç­‰ä¿¡æ¯ï¼Œå› ä¸ºElasticsearché›†ç¾¤è¿è¡Œåï¼Œå†æ°´å¹³æ‹“å±•ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œæˆ‘ä»¬è¿™è¾¹ç”±äºä¸šåŠ¡åŠæˆæœ¬é™åˆ¶æ— æ³•å¾ˆå¥½çš„é¢„ä¼°å®¹é‡ï¼Œæ‰€ä»¥å°±ç»“åˆå…¬å¸å®é™…è¦æ±‚ï¼šä½¿ç”¨æ—¥å¿—æœåŠ¡çš„ä¸šåŠ¡æ–¹è‡ªå¸¦æœºå™¨ï¼Œä¹Ÿå°±æ˜¯ä¸šåŠ¡æ–¹ä¼šæœ‰ç‹¬ç«‹çš„Elasticsearché›†ç¾¤ã€‚</p><p>æ¯ä¸ªä¸šåŠ¡æ–¹éƒ½ä½¿ç”¨è‡ªå·±çš„Elasticsearché›†ç¾¤ï¼Œæ‰€ä»¥é›†ç¾¤å‹åŠ›ä¸ä¼šå¾ˆå¤§ï¼Œä»è€ŒCollectorã€MQè¿™ä¸¤ä¸ªç»„ä»¶å¯¹äºæˆ‘ä»¬çš„ä½œç”¨ä¹Ÿå°±å¾ˆå°äº†ã€‚</p><h2 id="ETL"><a href="#ETL" class="headerlink" title="ETL"></a>ETL</h2><p>å› ä¸ºElasticsearch Ingest Nodeå®Œå…¨å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„è§£æéœ€æ±‚ï¼Œæ‰€ä»¥å°±æ²¡æœ‰å¿…è¦å†å¼•å…¥Logstashç­‰ç›¸å…³ç»„ä»¶äº†ã€‚</p><p>åˆ°è¿™é‡Œï¼ŒåŸºæœ¬å¯ä»¥çœ‹å‡ºæˆ‘ä»¬çš„æ¶æ„å¦‚ä¸‹ï¼š<br><img alt data-src="/images/log-service-architecture-design/%E7%B2%BE%E7%AE%80%E6%9E%B6%E6%9E%84.png"></p><blockquote><p>æ¶æ„è®¾è®¡çš„å‡ ä¸ªåŸåˆ™ï¼š</p><ul><li>åˆé€‚ä¼˜äºä¸šç•Œé¢†å…ˆ </li><li>ç®€å•ä¼˜äºå¤æ‚</li><li>æ¼”åŒ–ä¼˜äºä¸€æ­¥åˆ°ä½</li></ul></blockquote><h1 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h1><p>åŸºäºéœ€æ±‚åŠEFKå¥—ä»¶ï¼Œæ¢³ç†æˆ‘ä»¬åœºæ™¯ä¸­ç‰¹æœ‰çš„ä¸œè¥¿ï¼š</p><ul><li>dockeræ—¥å¿—çš„åœºæ™¯æ¯”è¾ƒå•ä¸€ï¼Œéƒ½æ˜¯é€šè¿‡ä¹‹å‰ä¸€ä¸ªäº§å“Aå‘å¸ƒéƒ¨ç½²çš„ï¼Œå…¶dockerå‘½åè§„åˆ™æ¯”è¾ƒç»Ÿä¸€ï¼Œå¯ä»¥é€šè¿‡æˆªå–docker.container.nameæ¥è·å–åº”ç”¨åå­—ï¼›åŒæ—¶åœ¨éƒ¨ç½²çš„æ—¶å€™ï¼Œå¯ä»¥çŸ¥é“éƒ¨ç½²ç›®æ ‡æœºå™¨çš„ipï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡åº”ç”¨+ipæ¥ä½œä¸ºå®ä¾‹åç§°ã€‚</li><li>k8såœºæ™¯ä¹Ÿæ¯”è¾ƒç»Ÿä¸€ï¼Œéƒ½æ˜¯é€šè¿‡ä¹‹å‰ä¸€ä¸ªäº§å“Bå‘å¸ƒéƒ¨ç½²çš„ï¼Œå…¶podå‘½åè§„åˆ™æ¯”è¾ƒç»Ÿä¸€ï¼Œå¯ä»¥é€šè¿‡æˆªå–kubernetes.pod.nameæ¥è·å–åº”ç”¨åå­—ï¼ˆä½†éœ€è¦é€šè¿‡namespaceså…³è”åˆ°tenantï¼Œå†é€šè¿‡tenantä¸é¡¹ç›®ä¸€ä¸€å¯¹åº”ï¼‰ï¼›k8sä¸­çš„pod.nameå°±æ˜¯å”¯ä¸€çš„ï¼Œä»¥æ­¤æ¥ä½œä¸ºå®ä¾‹åç§°å³å¯ã€‚</li><li>æ–‡æœ¬æ—¥å¿—ï¼šå› ä¸ºæ–‡æœ¬æ—¥å¿—ä¸»è¦çš„åœºæ™¯æ˜¯å·²ç»è£¸æœºéƒ¨ç½²çš„åº”ç”¨ï¼Œè¿™ç§åœºæ™¯ä¸‹ï¼Œä¸å­˜åœ¨åº”ç”¨è‡ªåŠ¨è¿ç§»çš„æƒ…å†µï¼Œæ‰€ä»¥æ–‡æœ¬æ—¥å¿—çš„åº”ç”¨åç§°ã€å®ä¾‹åç§°å¯ä»¥åœ¨éƒ¨ç½²çš„æ—¶å€™æ‰“ä¸Šæ ‡ç­¾å³å¯ã€‚</li></ul><p>å…·ä½“è§„åˆ™åŠè§£æè§ä¸‹å›¾ï¼ˆå®ä¾‹éƒ¨åˆ†å¤„ç†æš‚æœªæ ‡æ³¨ï¼‰ï¼š<br><img alt data-src="/images/log-service-architecture-design/%E6%94%B6%E9%9B%86%E5%BA%94%E7%94%A8%E6%96%87%E6%9C%AC%E6%97%A5%E5%BF%97.png"></p><blockquote><p>æ¨èå†™æ—¥å¿—åˆ°æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨æ ‡å‡†è¾“å‡ºå°±å¥½ã€‚</p></blockquote><p>åˆ°è¿™é‡Œå¯ä»¥å‘ç°æˆ‘ä»¬é€‰æ‹©Filebeatæ¥ä½œä¸ºæ—¥å¿—çš„æ”¶é›†ç«¯ï¼ŒElasticsearchæ¥å­˜å‚¨æ—¥å¿—å¹¶æä¾›æ£€ç´¢èƒ½åŠ›ã€‚</p><p>é‚£ä¹ˆï¼Œæ—¥å¿—çš„æ¸…æ´—åœ¨å“ªé‡Œåšå‘¢ï¼Ÿ</p><p>æ—¥å¿—çš„æ¸…æ´—ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>å…ˆæŠŠæ—¥å¿—æ”¶é›†åˆ°kafkaï¼Œå†é€šè¿‡Logstashæ¶ˆè´¹kafkaçš„æ•°æ®ï¼Œæ¥æ¸…æ´—æ•°æ®</li><li>ç›´æ¥é€šè¿‡Elasticsearchçš„[Ingest Node]æ¥æ¸…æ´—æ•°æ®ï¼Œå› ä¸ºIngest Nodeä¹Ÿæ”¯æŒGrokè¡¨è¾¾å¼</li></ul><p>å¯¹äºï¼Œæˆ‘ä»¬çš„åœºæ™¯è€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦æ¸…æ´—æ•°æ®çš„è¦æ±‚æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯åº”ç”¨ã€å®ä¾‹åç§°çš„æˆªå–è¿˜æœ‰æ–‡æœ¬æ—¥å¿—ä¸­æ—¥å¿—æ—¶é—´çš„å¤„ç†ï¼ˆ@timestampé‡ç½®ï¼Œæ—¶åŒºå¤„ç†ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©äº†æ–¹æ¡ˆ2ã€‚</p><p>åœ¨æˆ‘ä»¬çš„æ–¹æ¡ˆä¸­ï¼Œå¹¶æ²¡æœ‰æä¾›Kibana çš„ç•Œé¢ç›´æ¥ç»™ç”¨æˆ·ç”¨ï¼Œè€Œæ˜¯æˆ‘ä»¬è‡ªå·±æ ¹æ®å…¬å¸ä¸šåŠ¡ç‹¬ç«‹å¼€å‘çš„ã€‚</p><p>å‰ç«¯ç•Œé¢ä¸ºä»€ä¹ˆä¸é‡‡ç”¨Kibanaï¼Œè€Œéœ€è¦è‡ªå·±å¼€å‘ï¼Ÿ</p><ol><li>kibanaå¯¹äºä¸šåŠ¡å¼€å‘äººå‘˜æœ‰ä¸€å®šçš„å­¦ä¹ æˆæœ¬</li><li>kibanaç•Œé¢æ²¡æœ‰å¾ˆå¥½çš„å°†æ—¥å¿—å†…å®¹ä¸ä¸šåŠ¡æ„ä¹‰å…³è”èµ·æ¥ï¼ˆç•Œé¢é€‰æ‹©æ€»æ¯”ä¸€æ¬¡æ¬¡çš„è¾“å…¥è¦å¥½ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å°†æ—¥å¿—çš„é¡¹ç›®ã€åº”ç”¨ã€å®ä¾‹ç­‰ä¸šåŠ¡ä¿¡æ¯è§£æå‡ºæ¥çš„åŸå› ï¼‰</li><li><a href="https://github.com/jiankunking/log-search" target="_blank" rel="noopener">log-search</a>æ”¯æŒQuery Stringï¼Œå› æ­¤å¯¹äºç†Ÿæ‚‰kibanaçš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œåœ¨æˆ‘ä»¬è‡ªå·±å¼€å‘çš„å‰ç«¯ç•Œé¢æ£€ç´¢æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</li></ol><p><a href="https://github.com/jiankunking/log-search" target="_blank" rel="noopener">log-search</a>æä¾›çš„åŠŸèƒ½å¯ä»¥å‚è§githubï¼š<a href="https://github.com/jiankunking/log-search" target="_blank" rel="noopener">https://github.com/jiankunking/log-search</a></p><blockquote><p>å¦‚æœæ—¥å¿—éœ€è¦æ¸…æ´—çš„æ¯”è¾ƒå¤šï¼Œå¯ä»¥é‡‡ç”¨æ–¹æ¡ˆ1ï¼Œæˆ–è€…å…ˆä¸æ¸…æ´—ï¼Œå…ˆæŠŠæ•°æ®è½åˆ°Elasticsearchï¼Œç„¶ååœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œè¿›è¡Œå¤„ç†ã€‚æ¯”å¦‚åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ï¼Œå¯ä»¥å…ˆæŠŠæ—¥å¿—è½åˆ°Elasticsearchä¸­ï¼Œç„¶ååœ¨éœ€è¦æ£€ç´¢åº”ç”¨åç§°çš„æ—¶å€™ï¼Œé€šè¿‡ä»£ç æ¥å¤„ç†å¹¶è·å–appåå­—ã€‚</p></blockquote><h1 id="ç›‘æ§ã€å‘Šè­¦"><a href="#ç›‘æ§ã€å‘Šè­¦" class="headerlink" title="ç›‘æ§ã€å‘Šè­¦"></a>ç›‘æ§ã€å‘Šè­¦</h1><p>å…¶å®åŸºäºæ—¥å¿—å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚ï¼š</p><ul><li>åŸºäºæ—¥å¿—åšç›‘æ§ï¼ˆGoogle Dapperï¼‰</li><li>åŸºäºæ—¥å¿—åšå‘Šè­¦</li><li>åŸºäºæ—¥å¿—åšMachine Learning</li></ul><p>å…·ä½“æ€è·¯ï¼Œå¯ä»¥å‚è§ä¸‹å›¾ï¼š</p><p><img alt data-src="/images/log-service-architecture-design/%E5%9F%BA%E4%BA%8E%E6%97%A5%E5%BF%97%E7%9A%84%E7%9B%91%E6%8E%A7%E3%80%81%E5%91%8A%E8%AD%A6.png"></p><blockquote><p>å‰æï¼šèƒ½è¦æ±‚ä½¿ç”¨æ–¹ï¼ŒæŒ‰ç…§æŸç§è§„åˆ™æ‰“å°æ—¥å¿—ã€‚<br>ç›‘æ§å‘å±•ï¼šç›‘æ§åŸºæœ¬å°±æ˜¯å…ˆæ‰“é€šé“¾è·¯traceï¼Œç„¶åå†åœ¨ä¸ŠæŠ¥ä¿¡æ¯æˆ–è€…æ—¥å¿—ä¿¡æ¯ä¸­ï¼ŒåŠ å¼ºä¸šåŠ¡æ–¹é¢æ ‡è¯†ï¼Œå³ç»™ç›‘æ§æ·»åŠ ä¸šåŠ¡ç»´åº¦æ–¹é¢çš„è§†è§’ã€‚</p></blockquote><h1 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h1><h2 id="DaemonSet"><a href="#DaemonSet" class="headerlink" title="DaemonSet"></a>DaemonSet</h2><p>ä»¥DaemonSetæ–¹å¼éƒ¨ç½²Filebeatæ¥æ”¶é›†æ—¥å¿—ï¼Œå…¶å®æ”¶é›†ä¹Ÿæ˜¯å®¿ä¸»æœº/var/lib/docker/containersç›®å½•ä¸‹çš„æ—¥å¿—ã€‚<br>Running Filebeat on Kubernetes</p><h2 id="Sidecar"><a href="#Sidecar" class="headerlink" title="Sidecar"></a>Sidecar</h2><p>ä¸€ä¸ªPODä¸­è¿è¡Œä¸€ä¸ªsidecarçš„æ—¥å¿—agentå®¹å™¨ï¼Œç”¨äºé‡‡é›†è¯¥PODä¸»å®¹å™¨äº§ç”Ÿçš„æ—¥å¿—ã€‚</p><p>è«åæƒ³èµ·äº†istioã€‚</p><blockquote><p>Filebeatå¯ä»¥ä»¥sidecaræ¨¡å¼æ¥è¿›è¡Œå®¹å™¨æ—¥å¿—çš„æ”¶é›†ï¼Œä¹Ÿå°±æ˜¯filebeatå’Œå…·ä½“çš„æœåŠ¡å®¹å™¨éƒ¨ç½²åœ¨åŒä¸€ä¸ªpodå†…ï¼ŒæŒ‡å®šæ”¶é›†æ—¥å¿—çš„è·¯å¾„æˆ–æ–‡ä»¶ï¼Œ&gt; å³å¯å°†æ—¥å¿—å‘é€åˆ°æŒ‡å®šä½ç½®æˆ–Elasticsearchè¿™ç±»çš„æœç´¢å¼•æ“ã€‚<br>æ¯ä¸ªpodå†…éƒ¨ç½²filebeatçš„æ¨¡å¼ï¼Œå¥½å¤„æ˜¯å’Œå…·ä½“çš„åº”ç”¨æœåŠ¡ä½è€¦åˆï¼Œå¯æ‰©å±•æ€§å¼ºï¼Œä¸è¿‡éœ€è¦åœ¨yamlè¿›è¡Œé¢å¤–é…ç½®ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Architecture </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Architecture </tag>
            
            <tag> Log </tag>
            
            <tag> Elasticsearch </tag>
            
            <tag> Filebeat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å½“ä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ google.com å¹¶ä¸”æŒ‰ä¸‹å›è½¦ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</title>
      <link href="/what-happens-when.html"/>
      <url>/what-happens-when.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>å½“ä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ google.com å¹¶ä¸”æŒ‰ä¸‹å›è½¦ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ<br>æ•´ç†è‡ª <a href="https://github.com/skyline75489/what-happens-when-zh_CN" target="_blank" rel="noopener">https://github.com/skyline75489/what-happens-when-zh_CN</a></p></blockquote><a id="more"></a><h1 id="å½“Â·Â·Â·æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"><a href="#å½“Â·Â·Â·æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å½“Â·Â·Â·æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"></a>å½“Â·Â·Â·æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h1><p>è¿™ä¸ªä»“åº“è¯•å›¾å›ç­”ä¸€ä¸ªå¤è€çš„é¢è¯•é—®é¢˜ï¼šå½“ä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ google.com å¹¶ä¸”æŒ‰ä¸‹å›è½¦ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p><p>ä¸è¿‡æˆ‘ä»¬ä¸å†å±€é™äºå¹³å¸¸çš„å›ç­”ï¼Œè€Œæ˜¯æƒ³åŠæ³•å›ç­”åœ°å°½å¯èƒ½å…·ä½“ï¼Œä¸é—æ¼ä»»ä½•ç»†èŠ‚ã€‚</p><h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><h2 id="æŒ‰ä¸‹â€gâ€é”®"><a href="#æŒ‰ä¸‹â€gâ€é”®" class="headerlink" title="æŒ‰ä¸‹â€gâ€é”®"></a>æŒ‰ä¸‹â€gâ€é”®</h2><p>æ¥ä¸‹æ¥çš„å†…å®¹ä»‹ç»äº†ç‰©ç†é”®ç›˜å’Œç³»ç»Ÿä¸­æ–­çš„å·¥ä½œåŸç†ï¼Œä½†æ˜¯æœ‰ä¸€éƒ¨åˆ†å†…å®¹å´æ²¡æœ‰æ¶‰åŠã€‚å½“ä½ æŒ‰ä¸‹â€œgâ€é”®ï¼Œæµè§ˆå™¨æ¥æ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯ä¹‹åï¼Œä¼šè§¦å‘è‡ªåŠ¨å®Œæˆæœºåˆ¶ã€‚æµè§ˆå™¨æ ¹æ®è‡ªå·±çš„ç®—æ³•ï¼Œä»¥åŠä½ æ˜¯å¦å¤„äºéšç§æµè§ˆæ¨¡å¼ï¼Œä¼šåœ¨æµè§ˆå™¨çš„åœ°å€æ¡†ä¸‹æ–¹ç»™å‡ºè¾“å…¥å»ºè®®ã€‚å¤§éƒ¨åˆ†ç®—æ³•ä¼šä¼˜å…ˆè€ƒè™‘æ ¹æ®ä½ çš„æœç´¢å†å²å’Œä¹¦ç­¾ç­‰å†…å®¹ç»™å‡ºå»ºè®®ã€‚ä½ æ‰“ç®—è¾“å…¥â€google.comâ€ï¼Œå› æ­¤ç»™å‡ºçš„å»ºè®®å¹¶ä¸åŒ¹é…ã€‚ä½†æ˜¯è¾“å…¥è¿‡ç¨‹ä¸­ä»ç„¶æœ‰å¤§é‡çš„ä»£ç åœ¨åå°è¿è¡Œï¼Œä½ çš„æ¯ä¸€æ¬¡æŒ‰é”®éƒ½ä¼šä½¿å¾—ç»™å‡ºçš„å»ºè®®æ›´åŠ å‡†ç¡®ã€‚ç”šè‡³æœ‰å¯èƒ½åœ¨ä½ è¾“å…¥ä¹‹å‰ï¼Œæµè§ˆå™¨å°±å°†â€google.comâ€ å»ºè®®ç»™ä½ ã€‚</p><h2 id="å›è½¦é”®æŒ‰ä¸‹"><a href="#å›è½¦é”®æŒ‰ä¸‹" class="headerlink" title="å›è½¦é”®æŒ‰ä¸‹"></a>å›è½¦é”®æŒ‰ä¸‹</h2><p>ä¸ºäº†ä»é›¶å¼€å§‹ï¼Œæˆ‘ä»¬é€‰æ‹©é”®ç›˜ä¸Šçš„å›è½¦é”®è¢«æŒ‰åˆ°æœ€ä½å¤„ä½œä¸ºèµ·ç‚¹ã€‚åœ¨è¿™ä¸ªæ—¶åˆ»ï¼Œä¸€ä¸ªä¸“ç”¨äºå›è½¦é”®çš„ç”µæµå›è·¯è¢«ç›´æ¥åœ°æˆ–è€…é€šè¿‡ç”µå®¹å™¨é—´æ¥åœ°é—­åˆäº†ï¼Œä½¿å¾—å°‘é‡çš„ç”µæµè¿›å…¥äº†é”®ç›˜çš„é€»è¾‘ç”µè·¯ç³»ç»Ÿã€‚è¿™ä¸ªç³»ç»Ÿä¼šæ‰«ææ¯ä¸ªé”®çš„çŠ¶æ€ï¼Œå¯¹äºæŒ‰é”®å¼€å…³çš„ç”µä½å¼¹è·³å˜åŒ–è¿›è¡Œå™ªéŸ³æ¶ˆé™¤(debounce)ï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸ºé”®ç›˜ç å€¼ã€‚åœ¨è¿™é‡Œï¼Œå›è½¦çš„ç å€¼æ˜¯13ã€‚é”®ç›˜æ§åˆ¶å™¨åœ¨å¾—åˆ°ç å€¼ä¹‹åï¼Œå°†å…¶ç¼–ç ï¼Œç”¨äºä¹‹åçš„ä¼ è¾“ã€‚ç°åœ¨è¿™ä¸ªä¼ è¾“è¿‡ç¨‹å‡ ä¹éƒ½æ˜¯é€šè¿‡é€šç”¨ä¸²è¡Œæ€»çº¿(USB)æˆ–è€…è“ç‰™(Bluetooth)æ¥è¿›è¡Œçš„ï¼Œä»¥å‰æ˜¯é€šè¿‡PS/2æˆ–è€…ADBè¿æ¥è¿›è¡Œã€‚</p><p><em>USBé”®ç›˜ï¼š</em></p><ul><li>é”®ç›˜çš„USBå…ƒä»¶é€šè¿‡è®¡ç®—æœºä¸Šçš„USBæ¥å£ä¸USBæ§åˆ¶å™¨ç›¸è¿æ¥ï¼ŒUSBæ¥å£ä¸­çš„ç¬¬ä¸€å·é’ˆä¸ºå®ƒæä¾›äº†5Vçš„ç”µå‹</li><li>é”®ç å€¼å­˜å‚¨åœ¨é”®ç›˜å†…éƒ¨ç”µè·¯ä¸€ä¸ªå«åšâ€endpointâ€çš„å¯„å­˜å™¨å†…</li><li>USBæ§åˆ¶å™¨å¤§æ¦‚æ¯éš”10msä¾¿æŸ¥è¯¢ä¸€æ¬¡â€endpointâ€ä»¥å¾—åˆ°å­˜å‚¨çš„é”®ç å€¼æ•°æ®ï¼Œè¿™ä¸ªæœ€çŸ­æ—¶é—´é—´éš”ç”±é”®ç›˜æä¾›</li><li>é”®å€¼ç å€¼é€šè¿‡USBä¸²è¡Œæ¥å£å¼•æ“è¢«è½¬æ¢æˆä¸€ä¸ªæˆ–è€…å¤šä¸ªéµå¾ªä½å±‚USBåè®®çš„USBæ•°æ®åŒ…</li><li>è¿™äº›æ•°æ®åŒ…é€šè¿‡D+é’ˆæˆ–è€…D-é’ˆ(ä¸­é—´çš„ä¸¤ä¸ªé’ˆ)ï¼Œä»¥æœ€é«˜1.5Mb/sçš„é€Ÿåº¦ä»é”®ç›˜ä¼ è¾“è‡³è®¡ç®—æœºã€‚é€Ÿåº¦é™åˆ¶æ˜¯å› ä¸ºäººæœºäº¤äº’è®¾å¤‡æ€»æ˜¯è¢«å£°æ˜æˆâ€ä½é€Ÿè®¾å¤‡â€ï¼ˆUSB 2.0 complianceï¼‰</li><li>è¿™ä¸ªä¸²è¡Œä¿¡å·åœ¨è®¡ç®—æœºçš„USBæ§åˆ¶å™¨å¤„è¢«è§£ç ï¼Œç„¶åè¢«äººæœºäº¤äº’è®¾å¤‡é€šç”¨é”®ç›˜é©±åŠ¨è¿›è¡Œè¿›ä¸€æ­¥è§£é‡Šã€‚ä¹‹åæŒ‰é”®çš„ç å€¼è¢«ä¼ è¾“åˆ°æ“ä½œç³»ç»Ÿçš„ç¡¬ä»¶æŠ½è±¡å±‚</li></ul><p><em>è™šæ‹Ÿé”®ç›˜ï¼ˆè§¦å±è®¾å¤‡ï¼‰ï¼š</em></p><ul><li>åœ¨ç°ä»£ç”µå®¹å±ä¸Šï¼Œå½“ç”¨æˆ·æŠŠæ‰‹æŒ‡æ”¾åœ¨å±å¹•ä¸Šæ—¶ï¼Œä¸€å°éƒ¨åˆ†ç”µæµä»ä¼ å¯¼å±‚çš„é™ç”µåŸŸç»è¿‡æ‰‹æŒ‡ä¼ å¯¼ï¼Œå½¢æˆäº†ä¸€ä¸ªå›è·¯ï¼Œä½¿å¾—å±å¹•ä¸Šè§¦æ§çš„é‚£ä¸€ç‚¹ç”µå‹ä¸‹é™ï¼Œå±å¹•æ§åˆ¶å™¨äº§ç”Ÿä¸€ä¸ªä¸­æ–­ï¼ŒæŠ¥å‘Šè¿™æ¬¡â€œç‚¹å‡»â€çš„åæ ‡</li><li>ç„¶åç§»åŠ¨æ“ä½œç³»ç»Ÿé€šçŸ¥å½“å‰æ´»è·ƒçš„åº”ç”¨ï¼Œæœ‰ä¸€ä¸ªç‚¹å‡»äº‹ä»¶å‘ç”Ÿåœ¨å®ƒçš„æŸä¸ªGUIéƒ¨ä»¶ä¸Šäº†ï¼Œç°åœ¨è¿™ä¸ªéƒ¨ä»¶æ˜¯è™šæ‹Ÿé”®ç›˜çš„æŒ‰é’®</li><li>è™šæ‹Ÿé”®ç›˜å¼•å‘ä¸€ä¸ªè½¯ä¸­æ–­ï¼Œè¿”å›ç»™OSä¸€ä¸ªâ€œæŒ‰é”®æŒ‰ä¸‹â€æ¶ˆæ¯</li><li>è¿™ä¸ªæ¶ˆæ¯åˆè¿”å›æ¥å‘å½“å‰æ´»è·ƒçš„åº”ç”¨é€šçŸ¥ä¸€ä¸ªâ€œæŒ‰é”®æŒ‰ä¸‹â€äº‹ä»¶</li></ul><h2 id="äº§ç”Ÿä¸­æ–­-éUSBé”®ç›˜"><a href="#äº§ç”Ÿä¸­æ–­-éUSBé”®ç›˜" class="headerlink" title="äº§ç”Ÿä¸­æ–­[éUSBé”®ç›˜]"></a>äº§ç”Ÿä¸­æ–­[éUSBé”®ç›˜]</h2><p>é”®ç›˜åœ¨å®ƒçš„ä¸­æ–­è¯·æ±‚çº¿(IRQ)ä¸Šå‘é€ä¿¡å·ï¼Œä¿¡å·ä¼šè¢«ä¸­æ–­æ§åˆ¶å™¨æ˜ å°„åˆ°ä¸€ä¸ªä¸­æ–­å‘é‡ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ•´å‹æ•°ã€‚CPUä½¿ç”¨ä¸­æ–­æè¿°ç¬¦è¡¨(IDT)æŠŠä¸­æ–­å‘é‡æ˜ å°„åˆ°å¯¹åº”å‡½æ•°ï¼Œè¿™äº›å‡½æ•°è¢«ç§°ä¸ºä¸­æ–­å¤„ç†å™¨ï¼Œå®ƒä»¬ç”±æ“ä½œç³»ç»Ÿå†…æ ¸æä¾›ã€‚å½“ä¸€ä¸ªä¸­æ–­åˆ°è¾¾æ—¶ï¼ŒCPUæ ¹æ®IDTå’Œä¸­æ–­å‘é‡ç´¢å¼•åˆ°å¯¹åº”çš„ä¸­æ–­å¤„ç†å™¨ï¼Œç„¶åæ“ä½œç³»ç»Ÿå†…æ ¸å‡ºåœºäº†ã€‚</p><h2 id="Windows-ä¸€ä¸ª-WM-KEYDOWN-æ¶ˆæ¯è¢«å‘å¾€åº”ç”¨ç¨‹åº"><a href="#Windows-ä¸€ä¸ª-WM-KEYDOWN-æ¶ˆæ¯è¢«å‘å¾€åº”ç”¨ç¨‹åº" class="headerlink" title="(Windows)ä¸€ä¸ª WM_KEYDOWN æ¶ˆæ¯è¢«å‘å¾€åº”ç”¨ç¨‹åº"></a>(Windows)ä¸€ä¸ª <code>WM_KEYDOWN</code> æ¶ˆæ¯è¢«å‘å¾€åº”ç”¨ç¨‹åº</h2><p>HIDæŠŠé”®ç›˜æŒ‰ä¸‹çš„äº‹ä»¶ä¼ é€ç»™ <code>KBDHID.sys</code>é©±åŠ¨ï¼ŒæŠŠHIDçš„ä¿¡å·è½¬æ¢æˆä¸€ä¸ªæ‰«æç (Scancode)ï¼Œè¿™é‡Œå›è½¦çš„æ‰«æç æ˜¯<br><code>VK_RETURN(0x0d)</code>ã€‚ <code>KBDHID.sys</code> é©±åŠ¨å’Œ <code>KBDCLASS.sys</code>(é”®ç›˜ç±»é©±åŠ¨,keyboard class driver)è¿›è¡Œäº¤äº’ï¼Œè¿™ä¸ªé©±åŠ¨è´Ÿè´£å®‰å…¨åœ°å¤„ç†æ‰€æœ‰é”®ç›˜å’Œå°é”®ç›˜çš„è¾“å…¥äº‹ä»¶ã€‚ä¹‹åå®ƒåˆå»è°ƒç”¨<code>Win32K.sys</code>ï¼Œåœ¨è¿™ä¹‹å‰æœ‰å¯èƒ½æŠŠæ¶ˆæ¯ä¼ é€’ç»™å®‰è£…çš„ç¬¬ä¸‰æ–¹é”®ç›˜è¿‡æ»¤å™¨ã€‚è¿™äº›éƒ½æ˜¯å‘ç”Ÿåœ¨å†…æ ¸æ¨¡å¼ã€‚</p><p><code>Win32K.sys</code> é€šè¿‡ <code>GetForegroundWindow()</code>APIå‡½æ•°æ‰¾åˆ°å½“å‰å“ªä¸ªçª—å£æ˜¯æ´»è·ƒçš„ã€‚è¿™ä¸ªAPIå‡½æ•°æä¾›äº†å½“å‰æµè§ˆå™¨çš„åœ°å€æ çš„å¥æŸ„ã€‚Windowsç³»ç»Ÿçš„â€message pumpâ€æœºåˆ¶è°ƒç”¨ <code>SendMessage(hWnd, WM_KEYDOWN, VK_RETURN, lParam)</code> å‡½æ•°ï¼Œ<code>lParam</code>æ˜¯ä¸€ä¸ªç”¨æ¥æŒ‡ç¤ºè¿™ä¸ªæŒ‰é”®çš„æ›´å¤šä¿¡æ¯çš„æ©ç ï¼Œè¿™äº›ä¿¡æ¯åŒ…æ‹¬æŒ‰é”®é‡å¤æ¬¡æ•°ï¼ˆè¿™é‡Œæ˜¯0ï¼‰ï¼Œå®é™…æ‰«æç ï¼ˆå¯èƒ½ä¾èµ–äºOEMå‚å•†ï¼Œä¸è¿‡é€šå¸¸ä¸ä¼šæ˜¯<code>VK_RETURN</code> ï¼‰ï¼ŒåŠŸèƒ½é”®ï¼ˆalt, shift, ctrlï¼‰æ˜¯å¦è¢«æŒ‰ä¸‹ï¼ˆåœ¨è¿™é‡Œæ²¡æœ‰ï¼‰ï¼Œä»¥åŠä¸€äº›å…¶ä»–çŠ¶æ€ã€‚</p><p>Windowsçš„ <code>SendMessage</code> APIç›´æ¥å°†æ¶ˆæ¯æ·»åŠ åˆ°ç‰¹å®šçª—å£å¥æŸ„ <code>hWnd</code>çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œä¹‹åèµ‹ç»™ <code>hWnd</code> çš„ä¸»è¦æ¶ˆæ¯å¤„ç†å‡½æ•° <code>WindowProc</code>å°†ä¼šè¢«è°ƒç”¨ï¼Œç”¨äºå¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</p><p>å½“å‰æ´»è·ƒçš„å¥æŸ„ <code>hWnd</code> å®é™…ä¸Šæ˜¯ä¸€ä¸ªedit controlæ§ä»¶ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ<code>WindowProc</code> æœ‰ä¸€ä¸ªç”¨äºå¤„ç† <code>WM_KEYDOWN</code><br>æ¶ˆæ¯çš„å¤„ç†å™¨ï¼Œè¿™æ®µä»£ç ä¼šæŸ¥çœ‹ <code>SendMessage</code> ä¼ å…¥çš„ç¬¬ä¸‰ä¸ªå‚æ•° <code>wParam</code>ï¼Œå› ä¸ºè¿™ä¸ªå‚æ•°æ˜¯ <code>VK_RETURN</code> ï¼Œäºæ˜¯å®ƒçŸ¥é“ç”¨æˆ·æŒ‰ä¸‹äº†å›è½¦é”®ã€‚</p><h2 id="Mac-OS-X-ä¸€ä¸ª-KeyDown-NSEventè¢«å‘å¾€åº”ç”¨ç¨‹åº"><a href="#Mac-OS-X-ä¸€ä¸ª-KeyDown-NSEventè¢«å‘å¾€åº”ç”¨ç¨‹åº" class="headerlink" title="(Mac OS X)ä¸€ä¸ª KeyDown NSEventè¢«å‘å¾€åº”ç”¨ç¨‹åº"></a>(Mac OS X)ä¸€ä¸ª <code>KeyDown</code> NSEventè¢«å‘å¾€åº”ç”¨ç¨‹åº</h2><p>ä¸­æ–­ä¿¡å·å¼•å‘äº†I/O Kit Kexté”®ç›˜é©±åŠ¨çš„ä¸­æ–­å¤„ç†äº‹ä»¶ï¼Œé©±åŠ¨æŠŠä¿¡å·ç¿»è¯‘æˆé”®ç å€¼ï¼Œç„¶åä¼ ç»™OS Xçš„<code>WindowServer</code> è¿›ç¨‹ã€‚ç„¶åï¼Œ <code>WindowServer</code>å°†è¿™ä¸ªäº‹ä»¶é€šè¿‡Machç«¯å£åˆ†å‘ç»™åˆé€‚çš„ï¼ˆæ´»è·ƒçš„ï¼Œæˆ–è€…æ­£åœ¨ç›‘å¬çš„ï¼‰åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªä¿¡å·ä¼šè¢«æ”¾åˆ°åº”ç”¨ç¨‹åºçš„æ¶ˆæ¯é˜Ÿåˆ—é‡Œã€‚é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å¯ä»¥è¢«æ‹¥æœ‰è¶³å¤Ÿé«˜æƒé™çš„çº¿ç¨‹ä½¿ç”¨<code>mach_ipc_dispatch</code> å‡½æ•°è¯»å–åˆ°ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸æ˜¯ç”± <code>NSApplication</code>ä¸»äº‹ä»¶å¾ªç¯äº§ç”Ÿå¹¶ä¸”å¤„ç†çš„ï¼Œé€šè¿‡ <code>NSEventType</code> ä¸º <code>KeyDown</code> çš„ <code>NSEvent</code>ã€‚</p><h2 id="GNU-Linux-Xorg-æœåŠ¡å™¨ç›‘å¬é”®ç å€¼"><a href="#GNU-Linux-Xorg-æœåŠ¡å™¨ç›‘å¬é”®ç å€¼" class="headerlink" title="(GNU/Linux)Xorg æœåŠ¡å™¨ç›‘å¬é”®ç å€¼"></a>(GNU/Linux)Xorg æœåŠ¡å™¨ç›‘å¬é”®ç å€¼</h2><p>å½“ä½¿ç”¨å›¾å½¢åŒ–çš„ X Server æ—¶ï¼ŒX Serverä¼šæŒ‰ç…§ç‰¹å®šçš„è§„åˆ™æŠŠé”®ç å€¼å†ä¸€æ¬¡æ˜ å°„ï¼Œæ˜ å°„æˆæ‰«æç ã€‚å½“è¿™ä¸ªæ˜ å°„è¿‡ç¨‹å®Œæˆä¹‹åï¼ŒX Server æŠŠè¿™ä¸ªæŒ‰é”®å­—ç¬¦å‘é€ç»™çª—å£ç®¡ç†å™¨(DWMï¼Œmetacity,i3ç­‰ç­‰)ï¼Œçª—å£ç®¡ç†å™¨å†æŠŠå­—ç¬¦å‘é€ç»™å½“å‰çª—å£ã€‚å½“å‰çª—å£ä½¿ç”¨æœ‰å…³å›¾å½¢APIæŠŠæ–‡å­—æ‰“å°åœ¨è¾“å…¥æ¡†å†…ã€‚</p><h2 id="è§£æURL"><a href="#è§£æURL" class="headerlink" title="è§£æURL"></a>è§£æURL</h2><ul><li><p>æµè§ˆå™¨é€šè¿‡ URL èƒ½å¤ŸçŸ¥é“ä¸‹é¢çš„ä¿¡æ¯ï¼š</p><blockquote><ul><li><dl><dt><code>Protocol</code> â€œhttpâ€</dt><dd>ä½¿ç”¨HTTPåè®®</dd></dl></li><li><dl><dt><code>Resource</code> â€œ/â€œ</dt><dd>è¯·æ±‚çš„èµ„æºæ˜¯ä¸»é¡µ(index)</dd></dl></li></ul></blockquote></li></ul><h2 id="è¾“å…¥çš„æ˜¯-URL-è¿˜æ˜¯æœç´¢çš„å…³é”®å­—ï¼Ÿ"><a href="#è¾“å…¥çš„æ˜¯-URL-è¿˜æ˜¯æœç´¢çš„å…³é”®å­—ï¼Ÿ" class="headerlink" title="è¾“å…¥çš„æ˜¯ URL è¿˜æ˜¯æœç´¢çš„å…³é”®å­—ï¼Ÿ"></a>è¾“å…¥çš„æ˜¯ URL è¿˜æ˜¯æœç´¢çš„å…³é”®å­—ï¼Ÿ</h2><p>å½“åè®®æˆ–ä¸»æœºåä¸åˆæ³•æ—¶ï¼Œæµè§ˆå™¨ä¼šå°†åœ°å€æ ä¸­è¾“å…¥çš„æ–‡å­—ä¼ ç»™é»˜è®¤çš„æœç´¢å¼•æ“ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œåœ¨æŠŠæ–‡å­—ä¼ é€’ç»™æœç´¢å¼•æ“çš„æ—¶å€™ï¼ŒURLä¼šå¸¦æœ‰ç‰¹å®šçš„ä¸€ä¸²å­—ç¬¦ï¼Œç”¨æ¥å‘Šè¯‰æœç´¢å¼•æ“è¿™æ¬¡æœç´¢æ¥è‡ªè¿™ä¸ªç‰¹å®šæµè§ˆå™¨ã€‚</p><h2 id="è½¬æ¢é-ASCII-çš„-Unicode-å­—ç¬¦"><a href="#è½¬æ¢é-ASCII-çš„-Unicode-å­—ç¬¦" class="headerlink" title="è½¬æ¢é ASCII çš„ Unicode å­—ç¬¦"></a>è½¬æ¢é ASCII çš„ Unicode å­—ç¬¦</h2><ul><li>æµè§ˆå™¨æ£€æŸ¥è¾“å…¥æ˜¯å¦å«æœ‰ä¸æ˜¯ <code>a-z</code>ï¼Œ <code>A-Z</code>ï¼Œ<code>0-9</code>ï¼Œ <code>-</code> æˆ–è€… <code>.</code> çš„å­—ç¬¦</li><li>è¿™é‡Œä¸»æœºåæ˜¯ <code>google.com</code>ï¼Œæ‰€ä»¥æ²¡æœ‰éASCIIçš„å­—ç¬¦ï¼›å¦‚æœæœ‰çš„è¯ï¼Œæµè§ˆå™¨ä¼šå¯¹ä¸»æœºåéƒ¨åˆ†ä½¿ç”¨<a href="https://en.wikipedia.org/wiki/Punycode" target="_blank" rel="noopener">Punycode</a> ç¼–ç </li></ul><h2 id="æ£€æŸ¥-HSTS-åˆ—è¡¨"><a href="#æ£€æŸ¥-HSTS-åˆ—è¡¨" class="headerlink" title="æ£€æŸ¥ HSTS åˆ—è¡¨"></a>æ£€æŸ¥ HSTS åˆ—è¡¨</h2><ul><li>æµè§ˆå™¨æ£€æŸ¥è‡ªå¸¦çš„â€œé¢„åŠ è½½  HSTSï¼ˆHTTPä¸¥æ ¼ä¼ è¾“å®‰å…¨ï¼‰â€åˆ—è¡¨ï¼Œè¿™ä¸ªåˆ—è¡¨é‡ŒåŒ…å«äº†é‚£äº›è¯·æ±‚æµè§ˆå™¨åªä½¿ç”¨HTTPSè¿›è¡Œè¿æ¥çš„ç½‘ç«™</li><li>å¦‚æœç½‘ç«™åœ¨è¿™ä¸ªåˆ—è¡¨é‡Œï¼Œæµè§ˆå™¨ä¼šä½¿ç”¨ HTTPS è€Œä¸æ˜¯ HTTPåè®®ï¼Œå¦åˆ™ï¼Œæœ€åˆçš„è¯·æ±‚ä¼šä½¿ç”¨HTTPåè®®å‘é€</li><li>æ³¨æ„ï¼Œä¸€ä¸ªç½‘ç«™å“ªæ€•ä¸åœ¨ HSTS åˆ—è¡¨é‡Œï¼Œä¹Ÿå¯ä»¥è¦æ±‚æµè§ˆå™¨å¯¹è‡ªå·±ä½¿ç”¨ HSTS    æ”¿ç­–è¿›è¡Œè®¿é—®ã€‚æµè§ˆå™¨å‘ç½‘ç«™å‘å‡ºç¬¬ä¸€ä¸ªHTTPè¯·æ±‚ä¹‹åï¼Œç½‘ç«™ä¼šè¿”å›æµè§ˆå™¨ä¸€ä¸ªå“åº”ï¼Œè¯·æ±‚æµè§ˆå™¨åªä½¿ç”¨ HTTPS    å‘é€è¯·æ±‚ã€‚ç„¶è€Œï¼Œå°±æ˜¯è¿™ç¬¬ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œå´å¯èƒ½ä¼šä½¿ç”¨æˆ·å—åˆ°downgrade attack_ çš„å¨èƒï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç°ä»£æµè§ˆå™¨éƒ½é¢„ç½®äº† HSTS åˆ—è¡¨ã€‚</li></ul><h2 id="DNS-æŸ¥è¯¢"><a href="#DNS-æŸ¥è¯¢" class="headerlink" title="DNS æŸ¥è¯¢"></a>DNS æŸ¥è¯¢</h2><ul><li>æµè§ˆå™¨æ£€æŸ¥åŸŸåæ˜¯å¦åœ¨ç¼“å­˜å½“ä¸­ï¼ˆè¦æŸ¥çœ‹ Chrome å½“ä¸­çš„ç¼“å­˜ï¼Œ æ‰“å¼€<a href="chrome://net-internals/#dns" target="_blank" rel="noopener"><a href="chrome://net-internals/#dns" target="_blank" rel="noopener">chrome://net-internals/#dns</a></a>ï¼‰ã€‚</li><li>å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œå°±å»è°ƒç”¨ <code>gethostbyname</code>åº“å‡½æ•°ï¼ˆæ“ä½œç³»ç»Ÿä¸åŒå‡½æ•°ä¹Ÿä¸åŒï¼‰è¿›è¡ŒæŸ¥è¯¢ã€‚</li><li><code>gethostbyname</code> å‡½æ•°åœ¨è¯•å›¾è¿›è¡ŒDNSè§£æä¹‹å‰é¦–å…ˆæ£€æŸ¥åŸŸåæ˜¯å¦åœ¨æœ¬åœ°Hosts é‡Œï¼ŒHosts çš„ä½ç½®<a href="https://en.wikipedia.org/wiki/Hosts_%28file%29#Location_in_the_file_system" target="_blank" rel="noopener">ä¸åŒçš„æ“ä½œç³»ç»Ÿæœ‰æ‰€ä¸åŒ</a></li><li>å¦‚æœ <code>gethostbyname</code> æ²¡æœ‰è¿™ä¸ªåŸŸåçš„ç¼“å­˜è®°å½•ï¼Œä¹Ÿæ²¡æœ‰åœ¨ <code>hosts</code>é‡Œæ‰¾åˆ°ï¼Œå®ƒå°†ä¼šå‘ DNS æœåŠ¡å™¨å‘é€ä¸€æ¡ DNS æŸ¥è¯¢è¯·æ±‚ã€‚DNSæœåŠ¡å™¨æ˜¯ç”±ç½‘ç»œé€šä¿¡æ ˆæä¾›çš„ï¼Œé€šå¸¸æ˜¯æœ¬åœ°è·¯ç”±å™¨æˆ–è€… ISP çš„ç¼“å­˜ DNS æœåŠ¡å™¨ã€‚</li><li>æŸ¥è¯¢æœ¬åœ° DNS æœåŠ¡å™¨</li><li>å¦‚æœ DNS æœåŠ¡å™¨å’Œæˆ‘ä»¬çš„ä¸»æœºåœ¨åŒä¸€ä¸ªå­ç½‘å†…ï¼Œç³»ç»Ÿä¼šæŒ‰ç…§ä¸‹é¢çš„ ARP è¿‡ç¨‹å¯¹ DNS æœåŠ¡å™¨è¿›è¡Œ ARPæŸ¥è¯¢</li><li>å¦‚æœ DNS æœåŠ¡å™¨å’Œæˆ‘ä»¬çš„ä¸»æœºåœ¨ä¸åŒçš„å­ç½‘ï¼Œç³»ç»Ÿä¼šæŒ‰ç…§ä¸‹é¢çš„ ARP è¿‡ç¨‹å¯¹é»˜è®¤ç½‘å…³è¿›è¡ŒæŸ¥è¯¢</li></ul><h2 id="ARP-è¿‡ç¨‹"><a href="#ARP-è¿‡ç¨‹" class="headerlink" title="ARP è¿‡ç¨‹"></a>ARP è¿‡ç¨‹</h2><p>è¦æƒ³å‘é€ ARPï¼ˆåœ°å€è§£æåè®®ï¼‰å¹¿æ’­ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªç›®æ ‡ IPåœ°å€ï¼ŒåŒæ—¶è¿˜éœ€è¦çŸ¥é“ç”¨äºå‘é€ ARP å¹¿æ’­çš„æ¥å£çš„ MAC åœ°å€ã€‚</p><ul><li>é¦–å…ˆæŸ¥è¯¢ ARP ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜å‘½ä¸­ï¼Œæˆ‘ä»¬è¿”å›ç»“æœï¼šç›®æ ‡ IP = MAC</li></ul><p>å¦‚æœç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼š</p><ul><li>æŸ¥çœ‹è·¯ç”±è¡¨ï¼Œçœ‹çœ‹ç›®æ ‡ IP  åœ°å€æ˜¯ä¸æ˜¯åœ¨æœ¬åœ°è·¯ç”±è¡¨ä¸­çš„æŸä¸ªå­ç½‘å†…ã€‚æ˜¯çš„è¯ï¼Œä½¿ç”¨è·Ÿé‚£ä¸ªå­ç½‘ç›¸è¿çš„æ¥å£ï¼Œå¦åˆ™ä½¿ç”¨ä¸é»˜è®¤ç½‘å…³ç›¸è¿çš„æ¥å£ã€‚</li><li>æŸ¥è¯¢é€‰æ‹©çš„ç½‘ç»œæ¥å£çš„ MAC åœ°å€</li><li>æˆ‘ä»¬å‘é€ä¸€ä¸ªäºŒå±‚ï¼ˆ OSI æ¨¡å‹_ ä¸­çš„æ•°æ®é“¾è·¯å±‚ï¼‰ARP è¯·æ±‚ï¼š</li></ul><p><code>ARP Request</code>:</p><pre><code>Sender MAC: interface:mac:address:hereSender IP: interface.ip.goes.hereTarget MAC: FF:FF:FF:FF:FF:FF (Broadcast)Target IP: target.ip.goes.here</code></pre><p>æ ¹æ®è¿æ¥ä¸»æœºå’Œè·¯ç”±å™¨çš„ç¡¬ä»¶ç±»å‹ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><p>ç›´è¿ï¼š</p><ul><li>å¦‚æœæˆ‘ä»¬å’Œè·¯ç”±å™¨æ˜¯ç›´æ¥è¿æ¥çš„ï¼Œè·¯ç”±å™¨ä¼šè¿”å›ä¸€ä¸ª <code>ARP Reply</code>ï¼ˆè§ä¸‹é¢ï¼‰ã€‚</li></ul><p>é›†çº¿å™¨ï¼š</p><ul><li>å¦‚æœæˆ‘ä»¬è¿æ¥åˆ°ä¸€ä¸ªé›†çº¿å™¨ï¼Œé›†çº¿å™¨ä¼šæŠŠ ARP è¯·æ±‚å‘æ‰€æœ‰å…¶å®ƒç«¯å£å¹¿æ’­ï¼Œå¦‚æœè·¯ç”±å™¨ä¹Ÿâ€œè¿æ¥â€åœ¨å…¶ä¸­ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª  <code>ARP Reply</code> ã€‚</li></ul><p>äº¤æ¢æœºï¼š</p><ul><li>å¦‚æœæˆ‘ä»¬è¿æ¥åˆ°äº†ä¸€ä¸ªäº¤æ¢æœºï¼Œäº¤æ¢æœºä¼šæ£€æŸ¥æœ¬åœ° CAM/MAC è¡¨ï¼Œçœ‹çœ‹å“ªä¸ªç«¯å£æœ‰æˆ‘ä»¬è¦æ‰¾çš„é‚£ä¸ª MACåœ°å€ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œäº¤æ¢æœºä¼šå‘æ‰€æœ‰å…¶å®ƒç«¯å£å¹¿æ’­è¿™ä¸ª ARP è¯·æ±‚ã€‚</li><li>å¦‚æœäº¤æ¢æœºçš„ MAC/CAM è¡¨ä¸­æœ‰å¯¹åº”çš„æ¡ç›®ï¼Œäº¤æ¢æœºä¼šå‘æœ‰æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢çš„ MAC åœ°å€çš„é‚£ä¸ªç«¯å£å‘é€ ARP è¯·æ±‚</li><li>å¦‚æœè·¯ç”±å™¨ä¹Ÿâ€œè¿æ¥â€åœ¨å…¶ä¸­ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª <code>ARP Reply</code></li></ul><p><code>ARP Reply</code>:</p><pre><code>Sender MAC: target:mac:address:hereSender IP: target.ip.goes.hereTarget MAC: interface:mac:address:hereTarget IP: interface.ip.goes.here</code></pre><p>ç°åœ¨æˆ‘ä»¬æœ‰äº† DNS æœåŠ¡å™¨æˆ–è€…é»˜è®¤ç½‘å…³çš„ IP åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­ DNS è¯·æ±‚äº†ï¼š</p><ul><li>ä½¿ç”¨ 53 ç«¯å£å‘ DNS æœåŠ¡å™¨å‘é€ UDP è¯·æ±‚åŒ…ï¼Œå¦‚æœå“åº”åŒ…å¤ªå¤§ï¼Œä¼šä½¿ç”¨ TCP åè®®</li><li>å¦‚æœæœ¬åœ°/ISP DNSæœåŠ¡å™¨æ²¡æœ‰æ‰¾åˆ°ç»“æœï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªé€’å½’æŸ¥è¯¢è¯·æ±‚ï¼Œä¸€å±‚ä¸€å±‚å‘é«˜å±‚DNSæœåŠ¡å™¨åšæŸ¥è¯¢ï¼Œç›´åˆ°æŸ¥è¯¢åˆ°èµ·å§‹æˆæƒæœºæ„ï¼Œå¦‚æœæ‰¾åˆ°ä¼šæŠŠç»“æœè¿”å›</li></ul><h2 id="ä½¿ç”¨å¥—æ¥å­—"><a href="#ä½¿ç”¨å¥—æ¥å­—" class="headerlink" title="ä½¿ç”¨å¥—æ¥å­—"></a>ä½¿ç”¨å¥—æ¥å­—</h2><p>å½“æµè§ˆå™¨å¾—åˆ°äº†ç›®æ ‡æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œä»¥åŠ URL ä¸­ç»™å‡ºæ¥ç«¯å£å·ï¼ˆhttp åè®®é»˜è®¤ç«¯å£å·æ˜¯ 80ï¼Œ https é»˜è®¤ç«¯å£å·æ˜¯ 443ï¼‰ï¼Œå®ƒä¼šè°ƒç”¨ç³»ç»Ÿåº“å‡½æ•°<code>socket</code> ï¼Œè¯·æ±‚ä¸€ä¸ª TCPæµå¥—æ¥å­—ï¼Œå¯¹åº”çš„å‚æ•°æ˜¯ <code>AF_INET/AF_INET6</code> å’Œ<code>SOCK_STREAM</code> ã€‚</p><ul><li>è¿™ä¸ªè¯·æ±‚é¦–å…ˆè¢«äº¤ç»™ä¼ è¾“å±‚ï¼Œåœ¨ä¼ è¾“å±‚è¯·æ±‚è¢«å°è£…æˆ TCP     segmentã€‚ç›®æ ‡ç«¯å£ä¼šè¢«åŠ å…¥å¤´éƒ¨ï¼Œæºç«¯å£ä¼šåœ¨ç³»ç»Ÿå†…æ ¸çš„åŠ¨æ€ç«¯å£èŒƒå›´å†…é€‰å–ï¼ˆLinuxä¸‹æ˜¯ip_local_port_range)</li><li>TCP segment è¢«é€å¾€ç½‘ç»œå±‚ï¼Œç½‘ç»œå±‚ä¼šåœ¨å…¶ä¸­å†åŠ å…¥ä¸€ä¸ª IP   å¤´éƒ¨ï¼Œé‡Œé¢åŒ…å«äº†ç›®æ ‡æœåŠ¡å™¨çš„IPåœ°å€ä»¥åŠæœ¬æœºçš„IPåœ°å€ï¼ŒæŠŠå®ƒå°è£…æˆä¸€ä¸ªIP packetã€‚</li><li>è¿™ä¸ª TCP packet æ¥ä¸‹æ¥ä¼šè¿›å…¥é“¾è·¯å±‚ï¼Œé“¾è·¯å±‚ä¼šåœ¨å°åŒ…ä¸­åŠ å…¥ frame   å¤´éƒ¨ï¼Œé‡Œé¢åŒ…å«äº†æœ¬åœ°å†…ç½®ç½‘å¡çš„MACåœ°å€ä»¥åŠç½‘å…³ï¼ˆæœ¬åœ°è·¯ç”±å™¨ï¼‰çš„ MAC   åœ°å€ã€‚åƒå‰é¢è¯´çš„ä¸€æ ·ï¼Œå¦‚æœå†…æ ¸ä¸çŸ¥é“ç½‘å…³çš„ MAC åœ°å€ï¼Œå®ƒå¿…é¡»è¿›è¡Œ ARP å¹¿æ’­æ¥æŸ¥è¯¢å…¶åœ°å€ã€‚</li></ul><p>åˆ°äº†ç°åœ¨ï¼ŒTCP å°åŒ…å·²ç»å‡†å¤‡å¥½äº†ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼è¿›è¡Œä¼ è¾“ï¼š</p><ul><li><a href="http://en.wikipedia.org/wiki/IEEE_802.3" target="_blank" rel="noopener">ä»¥å¤ªç½‘</a></li><li><a href="https://en.wikipedia.org/wiki/IEEE_802.11" target="_blank" rel="noopener">WiFi</a></li><li><a href="https://en.wikipedia.org/wiki/Cellular_data_communication_protocol" target="_blank" rel="noopener">èœ‚çªæ•°æ®ç½‘ç»œ</a></li></ul><p>å¯¹äºå¤§éƒ¨åˆ†å®¶åº­ç½‘ç»œå’Œå°å‹ä¼ä¸šç½‘ç»œæ¥è¯´ï¼Œå°åŒ…ä¼šä»æœ¬åœ°è®¡ç®—æœºå‡ºå‘ï¼Œç»è¿‡æœ¬åœ°ç½‘ç»œï¼Œå†é€šè¿‡è°ƒåˆ¶è§£è°ƒå™¨æŠŠæ•°å­—ä¿¡å·è½¬æ¢æˆæ¨¡æ‹Ÿä¿¡å·ï¼Œä½¿å…¶é€‚äºåœ¨ç”µè¯çº¿è·¯ï¼Œæœ‰çº¿ç”µè§†å…‰ç¼†å’Œæ— çº¿ç”µè¯çº¿è·¯ä¸Šä¼ è¾“ã€‚åœ¨ä¼ è¾“çº¿è·¯çš„å¦ä¸€ç«¯ï¼Œæ˜¯å¦å¤–ä¸€ä¸ªè°ƒåˆ¶è§£è°ƒå™¨ï¼Œå®ƒæŠŠæ¨¡æ‹Ÿä¿¡å·è½¬æ¢å›æ•°å­—ä¿¡å·ï¼Œäº¤ç”±ä¸‹ä¸€ä¸ª<a href="https://en.wikipedia.org/wiki/Computer_network#Network_nodes" target="_blank" rel="noopener">ç½‘ç»œèŠ‚ç‚¹</a>å¤„ç†ã€‚èŠ‚ç‚¹çš„ç›®æ ‡åœ°å€å’Œæºåœ°å€å°†åœ¨åé¢è®¨è®ºã€‚</p><p>å¤§å‹ä¼ä¸šå’Œæ¯”è¾ƒæ–°çš„ä½å®…é€šå¸¸ä½¿ç”¨å…‰çº¤æˆ–ç›´æ¥ä»¥å¤ªç½‘è¿æ¥ï¼Œè¿™ç§æƒ…å†µä¸‹ä¿¡å·ä¸€ç›´æ˜¯æ•°å­—çš„ï¼Œä¼šè¢«ç›´æ¥ä¼ åˆ°ä¸‹ä¸€ä¸ª<a href="https://en.wikipedia.org/wiki/Computer_network#Network_nodes" target="_blank" rel="noopener">ç½‘ç»œèŠ‚ç‚¹</a>è¿›è¡Œå¤„ç†ã€‚</p><p>æœ€ç»ˆå°åŒ…ä¼šåˆ°è¾¾ç®¡ç†æœ¬åœ°å­ç½‘çš„è·¯ç”±å™¨ã€‚åœ¨é‚£é‡Œå‡ºå‘ï¼Œå®ƒä¼šç»§ç»­ç»è¿‡è‡ªæ²»åŒºåŸŸ(autonomous system, ç¼©å†™<br>AS)çš„è¾¹ç•Œè·¯ç”±å™¨ï¼Œå…¶ä»–è‡ªæ²»åŒºåŸŸï¼Œæœ€ç»ˆåˆ°è¾¾ç›®æ ‡æœåŠ¡å™¨ã€‚ä¸€è·¯ä¸Šç»è¿‡çš„è¿™äº›è·¯ç”±å™¨ä¼šä»IPæ•°æ®æŠ¥å¤´éƒ¨é‡Œæå–å‡ºç›®æ ‡åœ°å€ï¼Œå¹¶å°†å°åŒ…æ­£ç¡®åœ°è·¯ç”±åˆ°ä¸‹ä¸€ä¸ªç›®çš„åœ°ã€‚IPæ•°æ®æŠ¥å¤´éƒ¨time to live (TTL)åŸŸçš„å€¼æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨å°±å‡1ï¼Œå¦‚æœå°åŒ…çš„TTLå˜ä¸º0ï¼Œæˆ–è€…è·¯ç”±å™¨ç”±äºç½‘ç»œæ‹¥å µç­‰åŸå› å°åŒ…é˜Ÿåˆ—æ»¡äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…ä¼šè¢«è·¯ç”±å™¨ä¸¢å¼ƒã€‚</p><p>ä¸Šé¢çš„å‘é€å’Œæ¥å—è¿‡ç¨‹åœ¨ TCP è¿æ¥æœŸé—´ä¼šå‘ç”Ÿå¾ˆå¤šæ¬¡ï¼š</p><ul><li><p>å®¢æˆ·ç«¯é€‰æ‹©ä¸€ä¸ªåˆå§‹åºåˆ—å·(ISN)ï¼Œå°†è®¾ç½®äº† SYN   ä½çš„å°åŒ…å‘é€ç»™æœåŠ¡å™¨ç«¯ï¼Œè¡¨æ˜è‡ªå·±è¦å»ºç«‹è¿æ¥å¹¶è®¾ç½®äº†åˆå§‹åºåˆ—å·</p></li><li><p>æœåŠ¡å™¨ç«¯æ¥æ”¶åˆ° SYN åŒ…ï¼Œå¦‚æœå®ƒå¯ä»¥å»ºç«‹è¿æ¥ï¼š</p><pre><code>-   æœåŠ¡å™¨ç«¯é€‰æ‹©å®ƒè‡ªå·±çš„åˆå§‹åºåˆ—å·-   æœåŠ¡å™¨ç«¯è®¾ç½® SYN ä½ï¼Œè¡¨æ˜è‡ªå·±é€‰æ‹©äº†ä¸€ä¸ªåˆå§‹åºåˆ—å·-   æœåŠ¡å™¨ç«¯æŠŠ (å®¢æˆ·ç«¯ISN + 1) å¤åˆ¶åˆ° ACK åŸŸï¼Œå¹¶ä¸”è®¾ç½® ACK ä½ï¼Œè¡¨æ˜è‡ªå·±æ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„ç¬¬ä¸€ä¸ªå°åŒ…</code></pre></li><li><p>å®¢æˆ·ç«¯é€šè¿‡å‘é€ä¸‹é¢ä¸€ä¸ªå°åŒ…æ¥ç¡®è®¤è¿™æ¬¡è¿æ¥ï¼š</p><pre><code>-   è‡ªå·±çš„åºåˆ—å·+1-   æ¥æ”¶ç«¯ ACK+1-   è®¾ç½® ACK ä½</code></pre></li><li><p>æ•°æ®é€šè¿‡ä¸‹é¢çš„æ–¹å¼ä¼ è¾“ï¼š</p><pre><code>-   å½“ä¸€æ–¹å‘é€äº†Nä¸ª Bytes çš„æ•°æ®ä¹‹åï¼Œå°†è‡ªå·±çš„ SEQ åºåˆ—å·ä¹Ÿå¢åŠ N-   å¦ä¸€æ–¹ç¡®è®¤æ¥æ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…ï¼ˆæˆ–è€…ä¸€ç³»åˆ—æ•°æ®åŒ…ï¼‰ä¹‹åï¼Œå®ƒå‘é€ä¸€ä¸ª ACKåŒ…ï¼ŒACKçš„å€¼è®¾ç½®ä¸ºæ¥æ”¶åˆ°çš„æ•°æ®åŒ…çš„æœ€åä¸€ä¸ªåºåˆ—å·</code></pre></li><li><p>å…³é—­è¿æ¥æ—¶ï¼š</p><pre><code>-   è¦å…³é—­è¿æ¥çš„ä¸€æ–¹å‘é€ä¸€ä¸ª FIN åŒ…-   å¦ä¸€æ–¹ç¡®è®¤è¿™ä¸ª FIN åŒ…ï¼Œå¹¶ä¸”å‘é€è‡ªå·±çš„ FIN åŒ…-   è¦å…³é—­çš„ä¸€æ–¹ä½¿ç”¨ ACK åŒ…æ¥ç¡®è®¤æ¥æ”¶åˆ°äº† FIN</code></pre></li></ul><h2 id="TLS-æ¡æ‰‹"><a href="#TLS-æ¡æ‰‹" class="headerlink" title="TLS æ¡æ‰‹"></a>TLS æ¡æ‰‹</h2><ul><li>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª <code>ClientHello</code> æ¶ˆæ¯åˆ°æœåŠ¡å™¨ç«¯ï¼Œæ¶ˆæ¯ä¸­åŒæ—¶åŒ…å«äº†å®ƒçš„Transport Layer Security (TLS) ç‰ˆæœ¬ï¼Œå¯ç”¨çš„åŠ å¯†ç®—æ³•å’Œå‹ç¼©ç®—æ³•ã€‚</li><li>æœåŠ¡å™¨ç«¯å‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ª <code>ServerHello</code>æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä¸­åŒ…å«äº†æœåŠ¡å™¨ç«¯çš„TLSç‰ˆæœ¬ï¼ŒæœåŠ¡å™¨æ‰€é€‰æ‹©çš„åŠ å¯†å’Œå‹ç¼©ç®—æ³•ï¼Œä»¥åŠæ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼ˆCertificate Authorityï¼Œç¼©å†™CAï¼‰ç­¾å‘çš„æœåŠ¡å™¨å…¬å¼€è¯ä¹¦ï¼Œè¯ä¹¦ä¸­åŒ…å«äº†å…¬é’¥ã€‚å®¢æˆ·ç«¯ä¼šä½¿ç”¨è¿™ä¸ªå…¬é’¥åŠ å¯†æ¥ä¸‹æ¥çš„æ¡æ‰‹è¿‡ç¨‹ï¼Œç›´åˆ°åå•†ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹ç§°å¯†é’¥</li><li>å®¢æˆ·ç«¯æ ¹æ®è‡ªå·±çš„ä¿¡ä»»CAåˆ—è¡¨ï¼ŒéªŒè¯æœåŠ¡å™¨ç«¯çš„è¯ä¹¦æ˜¯å¦å¯ä¿¡ã€‚å¦‚æœè®¤ä¸ºå¯ä¿¡ï¼Œå®¢æˆ·ç«¯ä¼šç”Ÿæˆä¸€ä¸²ä¼ªéšæœºæ•°ï¼Œä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥åŠ å¯†å®ƒã€‚è¿™ä¸²éšæœºæ•°ä¼šè¢«ç”¨äºç”Ÿæˆæ–°çš„å¯¹ç§°å¯†é’¥</li><li>æœåŠ¡å™¨ç«¯ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†ä¸Šé¢æåˆ°çš„éšæœºæ•°ï¼Œç„¶åä½¿ç”¨è¿™ä¸²éšæœºæ•°ç”Ÿæˆè‡ªå·±çš„å¯¹ç§°ä¸»å¯†é’¥</li><li>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª <code>Finished</code>æ¶ˆæ¯ç»™æœåŠ¡å™¨ç«¯ï¼Œä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†è¿™æ¬¡é€šè®¯çš„ä¸€ä¸ªæ•£åˆ—å€¼</li><li>æœåŠ¡å™¨ç«¯ç”Ÿæˆè‡ªå·±çš„ hash å€¼ï¼Œç„¶åè§£å¯†å®¢æˆ·ç«¯å‘é€æ¥çš„ä¿¡æ¯ï¼Œæ£€æŸ¥è¿™ä¸¤ä¸ªå€¼æ˜¯å¦å¯¹åº”ã€‚å¦‚æœå¯¹åº”ï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª<code>Finished</code> æ¶ˆæ¯ï¼Œä¹Ÿä½¿ç”¨åå•†å¥½çš„å¯¹ç§°å¯†é’¥åŠ å¯†</li><li>ä»ç°åœ¨å¼€å§‹ï¼Œæ¥ä¸‹æ¥æ•´ä¸ª TLS ä¼šè¯éƒ½ä½¿ç”¨å¯¹ç§°ç§˜é’¥è¿›è¡ŒåŠ å¯†ï¼Œä¼ è¾“åº”ç”¨å±‚ï¼ˆHTTPï¼‰å†…å®¹</li></ul><h2 id="HTTP-åè®®"><a href="#HTTP-åè®®" class="headerlink" title="HTTP åè®®"></a>HTTP åè®®</h2><p>å¦‚æœæµè§ˆå™¨æ˜¯ Google å‡ºå“çš„ï¼Œå®ƒä¸ä¼šä½¿ç”¨ HTTP åè®®æ¥è·å–é¡µé¢ä¿¡æ¯ï¼Œè€Œæ˜¯ä¼šä¸æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚ï¼Œå•†è®¨ä½¿ç”¨ SPDY åè®®ã€‚</p><p>å¦‚æœæµè§ˆå™¨ä½¿ç”¨ HTTP åè®®è€Œä¸æ”¯æŒ SPDY åè®®ï¼Œå®ƒä¼šå‘æœåŠ¡å™¨å‘é€è¿™æ ·çš„ä¸€ä¸ªè¯·æ±‚:</p><pre><code>GET / HTTP/1.1Host: google.comConnection: close[å…¶ä»–å¤´éƒ¨]</code></pre><p>â€œå…¶ä»–å¤´éƒ¨â€åŒ…å«äº†ä¸€ç³»åˆ—çš„ç”±å†’å·åˆ†å‰²å¼€çš„é”®å€¼å¯¹ï¼Œå®ƒä»¬çš„æ ¼å¼ç¬¦åˆHTTPåè®®æ ‡å‡†ï¼Œå®ƒä»¬ä¹‹é—´ç”±ä¸€ä¸ªæ¢è¡Œç¬¦åˆ†å‰²å¼€æ¥ã€‚ï¼ˆè¿™é‡Œæˆ‘ä»¬å‡è®¾æµè§ˆå™¨æ²¡æœ‰è¿åHTTPåè®®æ ‡å‡†çš„bugï¼ŒåŒæ—¶å‡è®¾æµè§ˆå™¨ä½¿ç”¨<code>HTTP/1.1</code> åè®®ï¼Œä¸ç„¶çš„è¯å¤´éƒ¨å¯èƒ½ä¸åŒ…å« <code>Host</code> å­—æ®µï¼ŒåŒæ—¶ <code>GET</code>è¯·æ±‚ä¸­çš„ç‰ˆæœ¬å·ä¼šå˜æˆ <code>HTTP/1.0</code> æˆ–è€… <code>HTTP/0.9</code> ã€‚ï¼‰</p><p>HTTP/1.1 å®šä¹‰äº†â€œå…³é—­è¿æ¥â€çš„é€‰é¡¹â€closeâ€ï¼Œå‘é€è€…ä½¿ç”¨è¿™ä¸ªé€‰é¡¹æŒ‡ç¤ºè¿™æ¬¡è¿æ¥åœ¨å“åº”ç»“æŸä¹‹åä¼šæ–­å¼€ã€‚ä¾‹å¦‚ï¼š</p><blockquote><p>Connection:close</p></blockquote><p>ä¸æ”¯æŒæŒä¹…è¿æ¥çš„ HTTP/1.1 åº”ç”¨å¿…é¡»åœ¨æ¯æ¡æ¶ˆæ¯ä¸­éƒ½åŒ…å« â€œcloseâ€ é€‰é¡¹ã€‚</p><p>åœ¨å‘é€å®Œè¿™äº›è¯·æ±‚å’Œå¤´éƒ¨ä¹‹åï¼Œæµè§ˆå™¨å‘é€ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œè¡¨ç¤ºè¦å‘é€çš„å†…å®¹å·²ç»ç»“æŸäº†ã€‚</p><p>æœåŠ¡å™¨ç«¯è¿”å›ä¸€ä¸ªå“åº”ç ï¼ŒæŒ‡ç¤ºè¿™æ¬¡è¯·æ±‚çš„çŠ¶æ€ï¼Œå“åº”çš„å½¢å¼æ˜¯è¿™æ ·çš„:</p><pre><code>200 OK[å“åº”å¤´éƒ¨]</code></pre><p>ç„¶åæ˜¯ä¸€ä¸ªæ¢è¡Œï¼Œæ¥ä¸‹æ¥æœ‰æ•ˆè½½è·(payload)ï¼Œä¹Ÿå°±æ˜¯ <code>www.google.com</code>çš„HTMLå†…å®¹ã€‚æœåŠ¡å™¨ä¸‹é¢å¯èƒ½ä¼šå…³é—­è¿æ¥ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚ä¿æŒè¿æ¥çš„è¯ï¼ŒæœåŠ¡å™¨ç«¯ä¼šä¿æŒè¿æ¥æ‰“å¼€ï¼Œä»¥ä¾›ä¹‹åçš„è¯·æ±‚é‡ç”¨ã€‚</p><p>å¦‚æœæµè§ˆå™¨å‘é€çš„HTTPå¤´éƒ¨åŒ…å«äº†è¶³å¤Ÿå¤šçš„ä¿¡æ¯ï¼ˆä¾‹å¦‚åŒ…å«äº† Etag å¤´éƒ¨ï¼‰ï¼Œä»¥è‡³äºæœåŠ¡å™¨å¯ä»¥åˆ¤æ–­å‡ºï¼Œæµè§ˆå™¨ç¼“å­˜çš„æ–‡ä»¶ç‰ˆæœ¬è‡ªä»ä¸Šæ¬¡è·å–ä¹‹åæ²¡æœ‰å†æ›´æ”¹è¿‡ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šè¿”å›è¿™æ ·çš„å“åº”:</p><pre><code>304 Not Modified[å“åº”å¤´éƒ¨]</code></pre><p>è¿™ä¸ªå“åº”æ²¡æœ‰æœ‰æ•ˆè½½è·ï¼Œæµè§ˆå™¨ä¼šä»è‡ªå·±çš„ç¼“å­˜ä¸­å–å‡ºæƒ³è¦çš„å†…å®¹ã€‚</p><p>åœ¨è§£æå®Œ HTMLä¹‹åï¼Œæµè§ˆå™¨å’Œå®¢æˆ·ç«¯ä¼šé‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œç›´åˆ°HTMLé¡µé¢å¼•å…¥çš„æ‰€æœ‰èµ„æºï¼ˆå›¾ç‰‡ï¼ŒCSSï¼Œfavicon.icoç­‰ç­‰ï¼‰å…¨éƒ¨éƒ½è·å–å®Œæ¯•ï¼ŒåŒºåˆ«åªæ˜¯å¤´éƒ¨çš„<code>GET / HTTP/1.1</code> ä¼šå˜æˆ <code>GET /$(ç›¸å¯¹www.google.comçš„URL) HTTP/1.1</code> ã€‚</p><p>å¦‚æœHTMLå¼•å…¥äº† <code>www.google.com</code>åŸŸåä¹‹å¤–çš„èµ„æºï¼Œæµè§ˆå™¨ä¼šå›åˆ°ä¸Šé¢è§£æåŸŸåé‚£ä¸€æ­¥ï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤å¾€ä¸‹ä¸€æ­¥ä¸€æ­¥æ‰§è¡Œï¼Œè¯·æ±‚ä¸­çš„<code>Host</code> å¤´éƒ¨ä¼šå˜æˆå¦å¤–çš„åŸŸåã€‚</p><h2 id="HTTP-æœåŠ¡å™¨è¯·æ±‚å¤„ç†"><a href="#HTTP-æœåŠ¡å™¨è¯·æ±‚å¤„ç†" class="headerlink" title="HTTP æœåŠ¡å™¨è¯·æ±‚å¤„ç†"></a>HTTP æœåŠ¡å™¨è¯·æ±‚å¤„ç†</h2><p>HTTPD(HTTP Daemon)åœ¨æœåŠ¡å™¨ç«¯å¤„ç†è¯·æ±‚/å“åº”ã€‚æœ€å¸¸è§çš„ HTTPD æœ‰ Linuxä¸Šå¸¸ç”¨çš„ Apache å’Œ nginxï¼Œä»¥åŠ Windows ä¸Šçš„ IISã€‚</p><ul><li><p>HTTPD æ¥æ”¶è¯·æ±‚</p></li><li><p>æœåŠ¡å™¨æŠŠè¯·æ±‚æ‹†åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªå‚æ•°ï¼š</p><pre><code>-   HTTP è¯·æ±‚æ–¹æ³•(`GET`, `POST`, `HEAD`, `PUT`, `DELETE`,    `CONNECT`, `OPTIONS`, æˆ–è€… `TRACE`)ã€‚ç›´æ¥åœ¨åœ°å€æ ä¸­è¾“å…¥ URL    è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„æ˜¯ GET æ–¹æ³•-   åŸŸåï¼šgoogle.com-   è¯·æ±‚è·¯å¾„/é¡µé¢ï¼š/ (æˆ‘ä»¬æ²¡æœ‰è¯·æ±‚google.comä¸‹çš„æŒ‡å®šçš„é¡µé¢ï¼Œå› æ­¤    / æ˜¯é»˜è®¤çš„è·¯å¾„)</code></pre></li><li><p>æœåŠ¡å™¨éªŒè¯å…¶ä¸Šå·²ç»é…ç½®äº† google.com çš„è™šæ‹Ÿä¸»æœº</p></li><li><p>æœåŠ¡å™¨éªŒè¯ google.com æ¥å— GET æ–¹æ³•</p></li><li><p>æœåŠ¡å™¨éªŒè¯è¯¥ç”¨æˆ·å¯ä»¥ä½¿ç”¨ GET æ–¹æ³•(æ ¹æ® IP åœ°å€ï¼Œèº«ä»½ä¿¡æ¯ç­‰)</p></li><li><p>å¦‚æœæœåŠ¡å™¨å®‰è£…äº† URL é‡å†™æ¨¡å—ï¼ˆä¾‹å¦‚ Apache çš„ mod_rewrite å’Œ IIS çš„URL Rewriteï¼‰ï¼ŒæœåŠ¡å™¨ä¼šå°è¯•åŒ¹é…é‡å†™è§„åˆ™ï¼Œå¦‚æœåŒ¹é…ä¸Šçš„è¯ï¼ŒæœåŠ¡å™¨ä¼šæŒ‰ç…§è§„åˆ™é‡å†™è¿™ä¸ªè¯·æ±‚</p></li><li><p>æœåŠ¡å™¨æ ¹æ®è¯·æ±‚ä¿¡æ¯è·å–ç›¸åº”çš„å“åº”å†…å®¹ï¼Œè¿™ç§æƒ…å†µä¸‹ç”±äºè®¿é—®è·¯å¾„æ˜¯ â€œ/â€œ,ä¼šè®¿é—®é¦–é¡µæ–‡ä»¶ï¼ˆä½ å¯ä»¥é‡å†™è¿™ä¸ªè§„åˆ™ï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ï¼‰ã€‚</p></li><li><p>æœåŠ¡å™¨ä¼šä½¿ç”¨æŒ‡å®šçš„å¤„ç†ç¨‹åºåˆ†æå¤„ç†è¿™ä¸ªæ–‡ä»¶ï¼Œå‡å¦‚ Google ä½¿ç”¨PHPï¼ŒæœåŠ¡å™¨ä¼šä½¿ç”¨ PHP è§£æ indexæ–‡ä»¶ï¼Œå¹¶æ•è·è¾“å‡ºï¼ŒæŠŠ PHPçš„è¾“å‡ºç»“æœè¿”å›ç»™è¯·æ±‚è€…</p></li></ul><h2 id="æµè§ˆå™¨èƒŒåçš„æ•…äº‹"><a href="#æµè§ˆå™¨èƒŒåçš„æ•…äº‹" class="headerlink" title="æµè§ˆå™¨èƒŒåçš„æ•…äº‹"></a>æµè§ˆå™¨èƒŒåçš„æ•…äº‹</h2><p>å½“æœåŠ¡å™¨æä¾›äº†èµ„æºä¹‹åï¼ˆHTMLï¼ŒCSSï¼ŒJSï¼Œå›¾ç‰‡ç­‰ï¼‰ï¼Œæµè§ˆå™¨ä¼šæ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼š</p><ul><li>è§£æ â€”â€” HTMLï¼ŒCSSï¼ŒJS</li><li>æ¸²æŸ“ â€”â€” æ„å»º DOM æ ‘ -&gt; æ¸²æŸ“ -&gt; å¸ƒå±€ -&gt; ç»˜åˆ¶</li></ul><h2 id="æµè§ˆå™¨"><a href="#æµè§ˆå™¨" class="headerlink" title="æµè§ˆå™¨"></a>æµè§ˆå™¨</h2><p>æµè§ˆå™¨çš„åŠŸèƒ½æ˜¯ä»æœåŠ¡å™¨ä¸Šå–å›ä½ æƒ³è¦çš„èµ„æºï¼Œç„¶åå±•ç¤ºåœ¨æµè§ˆå™¨çª—å£å½“ä¸­ã€‚èµ„æºé€šå¸¸æ˜¯HTML æ–‡ä»¶ï¼Œä¹Ÿå¯èƒ½æ˜¯<br>PDFï¼Œå›¾ç‰‡ï¼Œæˆ–è€…å…¶ä»–ç±»å‹çš„å†…å®¹ã€‚èµ„æºçš„ä½ç½®é€šè¿‡ç”¨æˆ·æä¾›çš„ URI(Uniform Resource Identifier) æ¥ç¡®å®šã€‚</p><p>æµè§ˆå™¨è§£é‡Šå’Œå±•ç¤º HTML æ–‡ä»¶çš„æ–¹æ³•ï¼Œåœ¨ HTML å’Œ CSSçš„æ ‡å‡†ä¸­æœ‰è¯¦ç»†ä»‹ç»ã€‚è¿™äº›æ ‡å‡†ç”± Web æ ‡å‡†ç»„ç»‡ W3C(World Wide Web Consortium) ç»´æŠ¤ã€‚</p><p>ä¸åŒæµè§ˆå™¨çš„ç”¨æˆ·ç•Œé¢å¤§éƒ½ååˆ†æ¥è¿‘ï¼Œæœ‰å¾ˆå¤šå…±åŒçš„ UI å…ƒç´ ï¼š</p><ul><li>ä¸€ä¸ªåœ°å€æ </li><li>åé€€å’Œå‰è¿›æŒ‰é’®</li><li>ä¹¦ç­¾é€‰é¡¹</li><li>åˆ·æ–°å’Œåœæ­¢æŒ‰é’®</li><li>ä¸»é¡µæŒ‰é’®</li></ul><p><strong>æµè§ˆå™¨é«˜å±‚æ¶æ„</strong></p><p>ç»„æˆæµè§ˆå™¨çš„ç»„ä»¶æœ‰ï¼š</p><ul><li><strong>ç”¨æˆ·ç•Œé¢</strong> ç”¨æˆ·ç•Œé¢åŒ…å«äº†åœ°å€æ ï¼Œå‰è¿›åé€€æŒ‰é’®ï¼Œä¹¦ç­¾èœå•ç­‰ç­‰ï¼Œé™¤äº†è¯·æ±‚é¡µé¢ä¹‹å¤–æ‰€æœ‰ä½ çœ‹åˆ°çš„å†…å®¹éƒ½æ˜¯ç”¨æˆ·ç•Œé¢çš„ä¸€éƒ¨åˆ†</li><li><strong>æµè§ˆå™¨å¼•æ“</strong> æµè§ˆå™¨å¼•æ“è´Ÿè´£è®© UI å’Œæ¸²æŸ“å¼•æ“åè°ƒå·¥ä½œ</li><li><strong>æ¸²æŸ“å¼•æ“</strong> æ¸²æŸ“å¼•æ“è´Ÿè´£å±•ç¤ºè¯·æ±‚å†…å®¹ã€‚å¦‚æœè¯·æ±‚çš„å†…å®¹æ˜¯HTMLï¼Œæ¸²æŸ“å¼•æ“ä¼šè§£æ HTML å’Œ CSSï¼Œç„¶åå°†å†…å®¹å±•ç¤ºåœ¨å±å¹•ä¸Š</li><li><strong>ç½‘ç»œç»„ä»¶</strong> ç½‘ç»œç»„ä»¶è´Ÿè´£ç½‘ç»œè°ƒç”¨ï¼Œä¾‹å¦‚ HTTPè¯·æ±‚ç­‰ï¼Œä½¿ç”¨ä¸€ä¸ªå¹³å°æ— å…³æ¥å£ï¼Œä¸‹å±‚æ˜¯é’ˆå¯¹ä¸åŒå¹³å°çš„å…·ä½“å®ç°</li><li><strong>UIåç«¯</strong> UI åç«¯ç”¨äºç»˜åˆ¶åŸºæœ¬ UI ç»„ä»¶ï¼Œä¾‹å¦‚ä¸‹æ‹‰åˆ—è¡¨æ¡†å’Œçª—å£ã€‚UIåç«¯æš´éœ²ä¸€ä¸ªç»Ÿä¸€çš„å¹³å°æ— å…³çš„æ¥å£ï¼Œä¸‹å±‚ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ UI æ–¹æ³•å®ç°</li><li><strong>Javascript å¼•æ“</strong> Javascript å¼•æ“ç”¨äºè§£æå’Œæ‰§è¡Œ Javascript ä»£ç </li><li><strong>æ•°æ®å­˜å‚¨</strong> æ•°æ®å­˜å‚¨ç»„ä»¶æ˜¯ä¸€ä¸ªæŒä¹…å±‚ã€‚æµè§ˆå™¨å¯èƒ½éœ€è¦åœ¨æœ¬åœ°å­˜å‚¨å„ç§å„æ ·çš„æ•°æ®ï¼Œä¾‹å¦‚Cookie ç­‰ã€‚æµè§ˆå™¨ä¹Ÿéœ€è¦æ”¯æŒè¯¸å¦‚ localStorageï¼ŒIndexedDBï¼ŒWebSQL å’Œ FileSystem ä¹‹ç±»çš„å­˜å‚¨æœºåˆ¶</li></ul><h2 id="HTML-è§£æ"><a href="#HTML-è§£æ" class="headerlink" title="HTML è§£æ"></a>HTML è§£æ</h2><p>æµè§ˆå™¨æ¸²æŸ“å¼•æ“ä»ç½‘ç»œå±‚å–å¾—è¯·æ±‚çš„æ–‡æ¡£ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ–‡æ¡£ä¼šåˆ†æˆ8kBå¤§å°çš„åˆ†å—ä¼ è¾“ã€‚</p><p>HTML è§£æå™¨çš„ä¸»è¦å·¥ä½œæ˜¯å¯¹ HTML æ–‡æ¡£è¿›è¡Œè§£æï¼Œç”Ÿæˆè§£ææ ‘ã€‚</p><p>è§£ææ ‘æ˜¯ä»¥ DOM å…ƒç´ ä»¥åŠå±æ€§ä¸ºèŠ‚ç‚¹çš„æ ‘ã€‚DOMæ˜¯æ–‡æ¡£å¯¹è±¡æ¨¡å‹(Document Object Model)çš„ç¼©å†™ï¼Œå®ƒæ˜¯ HTML æ–‡æ¡£çš„å¯¹è±¡è¡¨ç¤ºï¼ŒåŒæ—¶ä¹Ÿæ˜¯ HTML å…ƒç´ é¢å‘å¤–éƒ¨(å¦‚Javascript)çš„æ¥å£ã€‚æ ‘çš„æ ¹éƒ¨æ˜¯â€Documentâ€å¯¹è±¡ã€‚æ•´ä¸ª DOM å’ŒHTML æ–‡æ¡£å‡ ä¹æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚</p><p><strong>è§£æç®—æ³•</strong></p><p>HTMLä¸èƒ½ä½¿ç”¨å¸¸è§çš„è‡ªé¡¶å‘ä¸‹æˆ–è‡ªåº•å‘ä¸Šæ–¹æ³•æ¥è¿›è¡Œåˆ†æã€‚ä¸»è¦åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹:</p><ul><li>è¯­è¨€æœ¬èº«çš„â€œå®½å®¹â€ç‰¹æ€§</li><li>HTMLæœ¬èº«å¯èƒ½æ˜¯æ®‹ç¼ºçš„ï¼Œå¯¹äºå¸¸è§çš„æ®‹ç¼ºï¼Œæµè§ˆå™¨éœ€è¦æœ‰ä¼ ç»Ÿçš„å®¹é”™æœºåˆ¶æ¥æ”¯æŒå®ƒä»¬</li><li>è§£æè¿‡ç¨‹éœ€è¦åå¤ã€‚å¯¹äºå…¶ä»–è¯­è¨€æ¥è¯´ï¼Œæºç ä¸ä¼šåœ¨è§£æè¿‡ç¨‹ä¸­å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å¯¹äºHTML æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç ï¼Œä¾‹å¦‚è„šæœ¬å…ƒç´ ä¸­åŒ…å«çš„ document.write()æ–¹æ³•ä¼šåœ¨æºç ä¸­æ·»åŠ å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè§£æè¿‡ç¨‹å®é™…ä¸Šä¼šæ”¹å˜è¾“å…¥çš„å†…å®¹</li></ul><p>ç”±äºä¸èƒ½ä½¿ç”¨å¸¸ç”¨çš„è§£ææŠ€æœ¯ï¼Œæµè§ˆå™¨åˆ›é€ äº†ä¸“é—¨ç”¨äºè§£æ HTMLçš„è§£æå™¨ã€‚è§£æç®—æ³•åœ¨ HTML5æ ‡å‡†è§„èŒƒä¸­æœ‰è¯¦ç»†ä»‹ç»ï¼Œç®—æ³•ä¸»è¦åŒ…å«äº†ä¸¤ä¸ªé˜¶æ®µï¼šæ ‡è®°åŒ–ï¼ˆtokenizationï¼‰å’Œæ ‘çš„æ„å»ºã€‚</p><p><strong>è§£æç»“æŸä¹‹å</strong></p><p>æµè§ˆå™¨å¼€å§‹åŠ è½½ç½‘é¡µçš„å¤–éƒ¨èµ„æºï¼ˆCSSï¼Œå›¾åƒï¼ŒJavascript æ–‡ä»¶ç­‰ï¼‰ã€‚</p><p>æ­¤æ—¶æµè§ˆå™¨æŠŠæ–‡æ¡£æ ‡è®°ä¸ºå¯äº¤äº’çš„ï¼ˆinteractiveï¼‰ï¼Œæµè§ˆå™¨å¼€å§‹è§£æå¤„äºâ€œæ¨è¿Ÿï¼ˆdeferredï¼‰â€æ¨¡å¼çš„è„šæœ¬ï¼Œä¹Ÿå°±æ˜¯é‚£äº›éœ€è¦åœ¨æ–‡æ¡£è§£æå®Œæ¯•ä¹‹åå†æ‰§è¡Œçš„è„šæœ¬ã€‚ä¹‹åæ–‡æ¡£çš„çŠ¶æ€ä¼šå˜ä¸ºâ€œå®Œæˆï¼ˆcompleteï¼‰â€ï¼Œæµè§ˆå™¨ä¼šè§¦å‘â€œåŠ è½½ï¼ˆloadï¼‰â€äº‹ä»¶ã€‚</p><p>æ³¨æ„è§£æ HTML ç½‘é¡µæ—¶æ°¸è¿œä¸ä¼šå‡ºç°â€œæ— æ•ˆè¯­æ³•ï¼ˆInvalid Syntaxï¼‰â€é”™è¯¯ï¼Œæµè§ˆå™¨ä¼šä¿®å¤æ‰€æœ‰é”™è¯¯å†…å®¹ï¼Œç„¶åç»§ç»­è§£æã€‚</p><h2 id="CSS-è§£æ"><a href="#CSS-è§£æ" class="headerlink" title="CSS è§£æ"></a>CSS è§£æ</h2><ul><li>æ ¹æ® <a href="http://www.w3.org/TR/CSS2/grammar.html" target="_blank" rel="noopener">CSSè¯æ³•å’Œå¥æ³•</a>åˆ†æCSSæ–‡ä»¶å’Œ <code>&lt;style&gt;</code> æ ‡ç­¾åŒ…å«çš„å†…å®¹ä»¥åŠ style å±æ€§çš„å€¼</li><li>æ¯ä¸ªCSSæ–‡ä»¶éƒ½è¢«è§£ææˆä¸€ä¸ªæ ·å¼è¡¨å¯¹è±¡ï¼ˆ<code>StyleSheet object</code>ï¼‰ï¼Œè¿™ä¸ªå¯¹è±¡é‡ŒåŒ…å«äº†å¸¦æœ‰é€‰æ‹©å™¨çš„CSSè§„åˆ™ï¼Œå’Œå¯¹åº”CSSè¯­æ³•çš„å¯¹è±¡</li><li>CSSè§£æå™¨å¯èƒ½æ˜¯è‡ªé¡¶å‘ä¸‹çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ä½¿ç”¨è§£æå™¨ç”Ÿæˆå™¨ç”Ÿæˆçš„è‡ªåº•å‘ä¸Šçš„è§£æå™¨</li></ul><h2 id="é¡µé¢æ¸²æŸ“"><a href="#é¡µé¢æ¸²æŸ“" class="headerlink" title="é¡µé¢æ¸²æŸ“"></a>é¡µé¢æ¸²æŸ“</h2><ul><li>é€šè¿‡éå†DOMèŠ‚ç‚¹æ ‘åˆ›å»ºä¸€ä¸ªâ€œFrameæ ‘â€æˆ–â€œæ¸²æŸ“æ ‘â€ï¼Œå¹¶è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å„ä¸ªCSSæ ·å¼å€¼</li><li>é€šè¿‡ç´¯åŠ å­èŠ‚ç‚¹çš„å®½åº¦ï¼Œè¯¥èŠ‚ç‚¹çš„æ°´å¹³å†…è¾¹è·(padding)ã€è¾¹æ¡†(border)å’Œå¤–è¾¹è·(margin)ï¼Œè‡ªåº•å‘ä¸Šçš„è®¡ç®—â€Frameæ ‘â€ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„é¦–é€‰(preferred)å®½åº¦</li><li>é€šè¿‡è‡ªé¡¶å‘ä¸‹çš„ç»™æ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ†é…å¯è¡Œå®½åº¦ï¼Œè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å®é™…å®½åº¦</li><li>é€šè¿‡åº”ç”¨æ–‡å­—æŠ˜è¡Œã€ç´¯åŠ å­èŠ‚ç‚¹çš„é«˜åº¦å’Œæ­¤èŠ‚ç‚¹çš„å†…è¾¹è·(padding)ã€è¾¹æ¡†(border)å’Œå¤–è¾¹è·(margin)ï¼Œè‡ªåº•å‘ä¸Šçš„è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„é«˜åº¦</li><li>ä½¿ç”¨ä¸Šé¢çš„è®¡ç®—ç»“æœæ„å»ºæ¯ä¸ªèŠ‚ç‚¹çš„åæ ‡</li><li>å½“å­˜åœ¨å…ƒç´ ä½¿ç”¨ <code>floated</code>ï¼Œä½ç½®æœ‰ <code>absolutely</code> æˆ– <code>relatively</code> å±æ€§çš„æ—¶å€™ï¼Œä¼šæœ‰æ›´å¤šå¤æ‚çš„è®¡ç®—ï¼Œè¯¦è§<a href="http://dev.w3.org/csswg/css2/" target="_blank" rel="noopener">http://dev.w3.org/csswg/css2/</a> å’Œ <a href="http://www.w3.org/Style/CSS/current-work" target="_blank" rel="noopener">http://www.w3.org/Style/CSS/current-work</a></li><li>åˆ›å»ºlayer(å±‚)æ¥è¡¨ç¤ºé¡µé¢ä¸­çš„å“ªäº›éƒ¨åˆ†å¯ä»¥æˆç»„çš„è¢«ç»˜åˆ¶ï¼Œè€Œä¸ç”¨è¢«é‡æ–°æ …æ ¼åŒ–å¤„ç†ã€‚æ¯ä¸ªå¸§å¯¹è±¡éƒ½è¢«åˆ†é…ç»™ä¸€ä¸ªå±‚</li><li>é¡µé¢ä¸Šçš„æ¯ä¸ªå±‚éƒ½è¢«åˆ†é…äº†çº¹ç†(?)</li><li>æ¯ä¸ªå±‚çš„å¸§å¯¹è±¡éƒ½ä¼šè¢«éå†ï¼Œè®¡ç®—æœºæ‰§è¡Œç»˜å›¾å‘½ä»¤ç»˜åˆ¶å„ä¸ªå±‚ï¼Œæ­¤è¿‡ç¨‹å¯èƒ½ç”±CPUæ‰§è¡Œæ …æ ¼åŒ–å¤„ç†ï¼Œæˆ–è€…ç›´æ¥é€šè¿‡D2D/SkiaGLåœ¨GPUä¸Šç»˜åˆ¶</li><li>ä¸Šé¢æ‰€æœ‰æ­¥éª¤éƒ½å¯èƒ½åˆ©ç”¨åˆ°æœ€è¿‘ä¸€æ¬¡é¡µé¢æ¸²æŸ“æ—¶è®¡ç®—å‡ºæ¥çš„å„ä¸ªå€¼ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä¸å°‘è®¡ç®—é‡</li><li>è®¡ç®—å‡ºå„ä¸ªå±‚çš„æœ€ç»ˆä½ç½®ï¼Œä¸€ç»„å‘½ä»¤ç”±Direct3D/OpenGLå‘å‡ºï¼ŒGPUå‘½ä»¤ç¼“å†²åŒºæ¸…ç©ºï¼Œå‘½ä»¤ä¼ è‡³GPUå¹¶å¼‚æ­¥æ¸²æŸ“ï¼Œå¸§è¢«é€åˆ°Window Serverã€‚</li></ul><h2 id="GPU-æ¸²æŸ“"><a href="#GPU-æ¸²æŸ“" class="headerlink" title="GPU æ¸²æŸ“"></a>GPU æ¸²æŸ“</h2><ul><li>åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œå›¾å½¢å¤„ç†å±‚å¯èƒ½ä½¿ç”¨é€šç”¨ç”¨é€”çš„<code>CPU</code>ï¼Œä¹Ÿå¯èƒ½ä½¿ç”¨å›¾å½¢å¤„ç†å™¨ <code>GPU</code></li><li>å½“ä½¿ç”¨ <code>GPU</code>ç”¨äºå›¾å½¢æ¸²æŸ“æ—¶ï¼Œå›¾å½¢é©±åŠ¨è½¯ä»¶ä¼šæŠŠä»»åŠ¡åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œè¿™æ ·å¯ä»¥å……åˆ†åˆ©ç”¨<code>GPU</code> å¼ºå¤§çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œç”¨äºåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è¿›è¡Œå¤§é‡çš„æµ®ç‚¹è®¡ç®—ã€‚</li></ul><h2 id="Window-Server"><a href="#Window-Server" class="headerlink" title="Window Server"></a>Window Server</h2><h2 id="åæœŸæ¸²æŸ“ä¸ç”¨æˆ·å¼•å‘çš„å¤„ç†"><a href="#åæœŸæ¸²æŸ“ä¸ç”¨æˆ·å¼•å‘çš„å¤„ç†" class="headerlink" title="åæœŸæ¸²æŸ“ä¸ç”¨æˆ·å¼•å‘çš„å¤„ç†"></a>åæœŸæ¸²æŸ“ä¸ç”¨æˆ·å¼•å‘çš„å¤„ç†</h2><p>æ¸²æŸ“ç»“æŸåï¼Œæµè§ˆå™¨æ ¹æ®æŸäº›æ—¶é—´æœºåˆ¶è¿è¡ŒJavaScriptä»£ç (æ¯”å¦‚Google DoodleåŠ¨ç”»)æˆ–ä¸ç”¨æˆ·äº¤äº’(åœ¨æœç´¢æ è¾“å…¥å…³é”®å­—è·å¾—æœç´¢å»ºè®®)ã€‚ç±»ä¼¼Flashå’ŒJavaçš„æ’ä»¶ä¹Ÿä¼šè¿è¡Œï¼Œå°½ç®¡Googleä¸»é¡µé‡Œæ²¡æœ‰ã€‚è¿™äº›è„šæœ¬å¯ä»¥è§¦å‘ç½‘ç»œè¯·æ±‚ï¼Œä¹Ÿå¯èƒ½æ”¹å˜ç½‘é¡µçš„å†…å®¹å’Œå¸ƒå±€ï¼Œäº§ç”Ÿåˆä¸€è½®æ¸²æŸ“ä¸ç»˜åˆ¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Network </tag>
            
            <tag> HTTP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>APIç½‘å…³æ¶æ„è®¾è®¡</title>
      <link href="/api-gateway-design.html"/>
      <url>/api-gateway-design.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>æ„å»ºä¸€ä¸ªAPIç½‘å…³</p></blockquote><a id="more"></a><h1 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h1><p>API Gatewayä¸€ä¸ªæ¯”è¾ƒå¹¿æ³›çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p>APIç½‘å…³æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ˜¯ç³»ç»Ÿçš„å”¯ä¸€å…¥å£ã€‚ä»é¢å‘å¯¹è±¡è®¾è®¡çš„è§’åº¦çœ‹ï¼Œå®ƒä¸å¤–è§‚æ¨¡å¼ç±»ä¼¼ã€‚APIç½‘å…³å°è£…äº†ç³»ç»Ÿå†…éƒ¨æ¶æ„ï¼Œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æä¾›ä¸€ä¸ªå®šåˆ¶çš„APIã€‚<br>APIç½‘å…³æ–¹å¼çš„æ ¸å¿ƒè¦ç‚¹æ˜¯ï¼Œæ‰€æœ‰çš„å®¢æˆ·ç«¯å’Œæ¶ˆè´¹ç«¯éƒ½é€šè¿‡ç»Ÿä¸€çš„ç½‘å…³æ¥å…¥å¾®æœåŠ¡ï¼Œåœ¨ç½‘å…³å±‚å¤„ç†æ‰€æœ‰çš„éä¸šåŠ¡åŠŸèƒ½ã€‚é€šå¸¸ï¼Œç½‘å…³ä¹Ÿæ˜¯æä¾›REST/HTTPçš„è®¿é—®APIã€‚æœåŠ¡ç«¯é€šè¿‡API-GWæ³¨å†Œå’Œç®¡ç†æœåŠ¡ã€‚</p></blockquote><p>ä»å®šä¹‰ä¸­å¯ä»¥å½’çº³å‡ºä¸€ä¸‹å‡ ä¸ªæ ¸å¿ƒç‚¹ï¼š</p><ol><li>æœåŠ¡è°ƒç”¨çš„ç»Ÿä¸€å…¥å£</li><li>AuthNï¼ˆAuthentication is establishing the your identity.ï¼‰</li><li>AuthZ ï¼ˆAuthorization is establishing your privileges.ï¼‰</li><li>ç›‘æ§ï¼ˆè¯·æ±‚å»¶è¿Ÿã€å¼‚å¸¸æ•°ã€å®¡è®¡æ—¥å¿—ã€è®¿é—®æ—¥å¿—ï¼‰</li><li>é«˜å¯ç”¨</li><li>ç™½åå•ã€é»‘åå•</li><li>é™æµ</li><li>ç†”æ–­</li><li>æœåŠ¡å‘ç°</li><li>åè®®æ”¯æŒ ï¼ˆåè®®è½¬æ¢ï¼‰</li><li>â€¦</li></ol><h1 id="æ€ç»´å¯¼å›¾"><a href="#æ€ç»´å¯¼å›¾" class="headerlink" title="æ€ç»´å¯¼å›¾"></a>æ€ç»´å¯¼å›¾</h1><p><img alt data-src="/images/api-gateway-design/API-Gateway.png"></p><p>ä»‹ç»å‡ ä¸ªæ¦‚å¿µï¼š</p><ol><li><p>å…ˆè¯´RCï¼ˆReplication Controllerï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</p><p> RCä¿è¯åœ¨åŒä¸€æ—¶é—´èƒ½å¤Ÿè¿è¡ŒæŒ‡å®šæ•°é‡çš„Podå‰¯æœ¬ï¼Œä¿è¯Podæ€»æ˜¯å¯ç”¨ã€‚å¦‚æœå®é™…Podæ•°é‡æ¯”æŒ‡å®šçš„å¤šå°±ç»“æŸæ‰å¤šä½™çš„ï¼Œå¦‚æœå®é™…æ•°é‡æ¯”æŒ‡å®šçš„å°‘å°±å¯åŠ¨ç¼ºå°‘çš„ã€‚å½“Podå¤±è´¥ã€è¢«åˆ é™¤æˆ–è¢«ç»ˆç»“æ—¶RCä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„Podæ¥ä¿è¯å‰¯æœ¬æ•°é‡ã€‚æ‰€ä»¥å³ä½¿åªæœ‰ä¸€ä¸ªPodä¹Ÿåº”è¯¥ä½¿ç”¨RCæ¥è¿›è¡Œç®¡ç†ã€‚</p></li><li><p>HPA<br> Horizontal Pod Autoscalingï¼Œç®€ç§°HPAï¼Œæ˜¯Kubernetesä¸­å®ç°PODæ°´å¹³è‡ªåŠ¨ä¼¸ç¼©çš„åŠŸèƒ½ã€‚</p><p> HPAæ˜¯kubernetesé‡Œé¢podå¼¹æ€§ä¼¸ç¼©çš„å®ç°,å®ƒèƒ½æ ¹æ®è®¾ç½®çš„ç›‘æ§é˜€å€¼è¿›è¡Œpodçš„å¼¹æ€§æ‰©ç¼©å®¹ï¼Œç›®å‰é»˜è®¤HPAåªèƒ½æ”¯æŒcpuå’Œå†…å­˜çš„é˜€å€¼æ£€æµ‹æ‰©ç¼©å®¹ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡custom metric api è°ƒç”¨prometheuså®ç°è‡ªå®šä¹‰metric æ¥æ›´åŠ çµæ´»çš„ç›‘æ§æŒ‡æ ‡å®ç°å¼¹æ€§ä¼¸ç¼©ã€‚</p></li></ol><h1 id="å–èˆ"><a href="#å–èˆ" class="headerlink" title="å–èˆ"></a>å–èˆ</h1><p>å–èˆä¹Ÿå°±æ˜¯å¦‚ä½•æ„å»ºé€‚åˆè‡ªå·±çš„API Gatewayï¼Ÿ</p><p>å…¶å®ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿå¯ä»¥æ‹“å±•ä¸ºå¦‚ä½•å¼€å‘é€‚åº”è‡ªå·±ä¸šåŠ¡çš„æŸç³»ç»Ÿï¼Œä¸ªäººæ„Ÿè§‰åº”è¯¥ä»ä»¥ä¸‹å‡ ç‚¹è€ƒè™‘ï¼š</p><ul><li>è‡ªå·±çš„ä¸šåŠ¡ç³»ç»Ÿéœ€è¦ä»€ä¹ˆæ ·çš„åŠŸèƒ½ï¼Ÿ</li><li>ä¸šç•Œä¸­è¯¥ç±»ç³»ç»Ÿéƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</li><li>è‡ªå·±çš„åŸºç¡€è®¾æ–½æƒ…å†µï¼ˆä¸»è¦æ˜¯PaaSåŠä¸­é—´ä»¶ï¼‰å¦‚ä½•ï¼Ÿ</li></ul><p>ç»¼åˆ1ã€2è€ƒè™‘ï¼Œåœ¨æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„å‰æä¸‹ï¼Œå¾€è¿œäº†è€ƒè™‘ï¼Œå¾€ç®€å•äº†å®ç°ï¼ˆæ—¢æ»¡è¶³ç›®å‰çš„åŠŸèƒ½ï¼Œåˆæ–¹ä¾¿ä»¥åæ‹“å±•ï¼‰ã€‚<br>å›åˆ°API Gatewayè¿™ä¸ªè¯é¢˜ï¼Œé‚£å°±éœ€è¦è€ƒè™‘ä¸€ä¸‹ï¼Œè‡ªå·±çš„ä¸šåŠ¡ç³»ç»Ÿæ˜¯å¦éœ€è¦ä»¥ä¸Šåˆ—å‡ºçš„æ‰€æœ‰åŠŸèƒ½ç‚¹ï¼Ÿå¦‚æœä¸æ˜¯æˆ–è€…ç›®å‰ä¸æ˜¯ï¼Œé‚£æˆ‘åº”è¯¥å…ˆå®ç°å“ªä¸€éƒ¨åˆ†ï¼Ÿ</p><p>å…¶ä¸­ï¼Œä½œä¸ºä¸€ä¸ªGatewayï¼Œä»¥ä¸‹å‡ ç‚¹åº”è¯¥æ˜¯åŸºç¡€åŠŸèƒ½ï¼š</p><ul><li>æœåŠ¡è°ƒç”¨çš„ç»Ÿä¸€å…¥å£</li><li>AuthNï¼ˆAuthentication is establishing the your identity.ï¼‰</li><li>AuthZ ï¼ˆAuthorization is establishing your privileges.ï¼‰</li><li>ç›‘æ§ï¼ˆè¯·æ±‚å»¶è¿Ÿã€å¼‚å¸¸æ•°ã€å®¡è®¡æ—¥å¿—ã€è®¿é—®æ—¥å¿—ï¼‰</li><li>é«˜å¯ç”¨</li></ul><p>å‰©ä¸‹çš„åŠŸèƒ½å®ç°å°±è¦çœ‹ä¸šåŠ¡éœ€è¦åŠæ—¶é—´äº†ã€‚<br>å¦‚æœç³»ç»Ÿæœ¬èº«çš„è®¿é—®é‡ä¸å¤§ï¼Œé‚£ä¹ˆé™æµã€ç†”æ–­æ˜¯å¦å°±å¯ä»¥å…ˆä¸å®ç°ï¼Ÿ</p><h2 id="ä¸ºä»€ä¹ˆéœ€è¦å…³æ³¨è‡ªå·±çš„åŸºç¡€è®¾æ–½æƒ…å†µï¼ˆä¸»è¦æ˜¯PaaSåŠä¸­é—´ä»¶ï¼‰ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦å…³æ³¨è‡ªå·±çš„åŸºç¡€è®¾æ–½æƒ…å†µï¼ˆä¸»è¦æ˜¯PaaSåŠä¸­é—´ä»¶ï¼‰ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦å…³æ³¨è‡ªå·±çš„åŸºç¡€è®¾æ–½æƒ…å†µï¼ˆä¸»è¦æ˜¯PaaSåŠä¸­é—´ä»¶ï¼‰ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦å…³æ³¨è‡ªå·±çš„åŸºç¡€è®¾æ–½æƒ…å†µï¼ˆä¸»è¦æ˜¯PaaSåŠä¸­é—´ä»¶ï¼‰ï¼Ÿ</h2><p>æ¯”å¦‚åŸºç¡€è®¾æ–½ä¸­å·²æä¾›Kubernetesé›†ç¾¤æœåŠ¡ï¼Œé‚£ä¹ˆæ¯«æ— ç–‘é—®çš„é«˜å¯ç”¨æ–¹æ¡ˆï¼Œåº”è¯¥é€‰æ‹©RCæ–¹æ¡ˆã€‚å¦‚æœæ²¡æœ‰Kubernetesé›†ç¾¤æœåŠ¡ï¼Œé‚£ä¹ˆé«˜å¯ç”¨å°±éœ€è¦è€ƒè™‘åˆ«çš„æ–¹æ¡ˆäº†ã€‚</p><blockquote><p>å¯ä»¥å‘ç°å…¶å®æ‰‹æ’•ä¸€ä¸ªapiç½‘å…³ï¼Œä¹Ÿä¸æ˜¯å¤šä¹ˆéš¾çš„äº‹æƒ…ï¼Œå…¶ä¸­å¾ˆå¤šç‚¹ï¼Œåº•å±‚åŒ…éƒ½å·²ç»æä¾›äº†æ”¯æŒï¼Œåªæ˜¯éœ€è¦æ”¯æŒçš„åŠŸèƒ½æ¯”è¾ƒå¤šã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Architecture </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Architecture </tag>
            
            <tag> Gateway </tag>
            
            <tag> Design </tag>
            
            <tag> API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java volatileçš„å†…å­˜è¯­ä¹‰ä¸AQSé”å†…å­˜å¯è§æ€§</title>
      <link href="/java-volatile-aqs.html"/>
      <url>/java-volatile-aqs.html</url>
      
        <content type="html"><![CDATA[<p>æåˆ°volatileé¦–å…ˆæƒ³åˆ°å°±æ˜¯ï¼š</p><ul><li>ä¿è¯æ­¤å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§ï¼Œè¿™é‡Œçš„ â€œå¯è§æ€§â€æ˜¯æŒ‡å½“ä¸€æ¡çº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œæ–°å€¼å¯¹äºå…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯å¯ä»¥ç«‹å³å¾—çŸ¥çš„ã€‚</li><li>ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ã€‚</li></ul><p>åˆ°è¿™é‡Œå¤§å®¶æ„Ÿè§‰è‡ªå·±å¯¹volatileç†è§£äº†å—ï¼Ÿ </p><p>å¦‚æœç†è§£äº†ï¼Œå¤§å®¶è€ƒè™‘è¿™ä¹ˆä¸€ä¸ªé—®é¢˜ï¼šReentrantLockï¼ˆæˆ–è€…å…¶å®ƒåŸºäºAQSå®ç°çš„é”ï¼‰æ˜¯å¦‚ä½•ä¿è¯ä»£ç æ®µä¸­å˜é‡ï¼ˆå˜é‡ä¸»è¦æ˜¯æŒ‡å…±äº«å˜é‡ï¼Œå­˜åœ¨ç«äº‰é—®é¢˜çš„å˜é‡ï¼‰çš„å¯è§æ€§ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">private static ReentrantLock reentrantLock = new ReentrantLock();</span><br><span class="line">private static intcount = 0;</span><br><span class="line">//...</span><br><span class="line">// å¤šçº¿ç¨‹ run å¦‚ä¸‹ä»£ç </span><br><span class="line">reentrantLock.lock();</span><br><span class="line">try</span><br><span class="line">&#123;</span><br><span class="line">    count++;</span><br><span class="line">&#125; </span><br><span class="line">finally</span><br><span class="line">&#123;</span><br><span class="line">    reentrantLock.unlock();</span><br><span class="line">&#125;</span><br><span class="line">//...</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æåˆ°äº†å¯è§æ€§ï¼Œé‚£å°±å…ˆç†Ÿæ‚‰å‡ ä¸ªæ¦‚å¿µï¼š</p><h1 id="1ã€JMM"><a href="#1ã€JMM" class="headerlink" title="1ã€JMM"></a>1ã€JMM</h1><p>JMMï¼šJava Memory Model å³ Java å†…å­˜æ¨¡å‹</p><blockquote><p>The Java Memory Model describes what behaviors are legal in multithreaded code, and how threads may interact through memory.</p></blockquote><blockquote><p>It describes the relationship between variables in a program and the low-level details of storing and retrieving them to and from memory or registers in a real computer system.</p></blockquote><blockquote><p>It does this in a way that can be implemented correctly using a wide variety of hardware and a wide variety of compiler optimizations.</p></blockquote><p><font color="DeepPink">Javaå†…å­˜æ¨¡å‹çš„ä¸»è¦ç›®æ ‡æ˜¯å®šä¹‰ç¨‹åºä¸­å„ä¸ªå˜é‡çš„è®¿é—®è§„åˆ™ï¼Œå³åœ¨è™šæ‹Ÿæœºä¸­å°†å˜é‡å­˜å‚¨åˆ°å†…å­˜å’Œä»å†…å­˜ä¸­å–å‡ºå˜é‡è¿™æ ·çš„åº•å±‚ç»†èŠ‚ã€‚</font>æ­¤å¤„çš„å˜é‡ä¸»è¦æ˜¯æŒ‡å…±äº«å˜é‡ï¼Œå­˜åœ¨ç«äº‰é—®é¢˜çš„å˜é‡ã€‚Javaå†…å­˜æ¨¡å‹è§„å®šæ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œè€Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œï¼ˆè¯»å–ã€èµ‹å€¼ç­‰ï¼‰éƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ï¼ˆ<font color="DeepPink">æ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒçš„è§„å®šï¼Œvolatileå˜é‡ä¾ç„¶æœ‰å…±äº«å†…å­˜çš„æ‹·è´ï¼Œä½†æ˜¯ç”±äºå®ƒç‰¹æ®Šçš„æ“ä½œé¡ºåºæ€§è§„å®šâ€”â€”ä»å·¥ä½œå†…å­˜ä¸­è¯»å†™æ•°æ®å‰ï¼Œå¿…é¡»å…ˆå°†ä¸»å†…å­˜ä¸­çš„æ•°æ®åŒæ­¥åˆ°å·¥ä½œå†…å­˜ä¸­ï¼Œæ‰€æœ‰çœ‹èµ·æ¥å¦‚åŒç›´æ¥åœ¨ä¸»å†…å­˜ä¸­è¯»å†™è®¿é—®ä¸€èˆ¬ï¼Œå› æ­¤è¿™é‡Œçš„æè¿°å¯¹äºvolatileä¹Ÿä¸ä¾‹å¤–</font>ï¼‰ã€‚ä¸åŒçº¿ç¨‹ä¹‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡å€¼å¾—ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚</p><h1 id="2ã€é‡æ’åº"><a href="#2ã€é‡æ’åº" class="headerlink" title="2ã€é‡æ’åº"></a>2ã€é‡æ’åº</h1><p>åœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤åšé‡æ’åºã€‚é‡æ’åºåˆ†3ç§ç±»å‹ï¼š</p><ul><li>ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’åºã€‚ç¼–è¯‘å™¨åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ç¨‹åºè¯­ä¹‰çš„å‰æä¸‹ï¼Œå¯ä»¥é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚</li><li>æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æ’åºã€‚ç°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯ï¼ˆInstruction-Level Parallelismï¼ŒILPï¼‰æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚</li><li>å†…å­˜ç³»ç»Ÿçš„é‡æ’åºã€‚ç”±äºå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯»/å†™ç¼“å†²åŒºï¼Œè¿™ä½¿å¾—åŠ è½½å’Œå­˜å‚¨æ“ä½œçœ‹ä¸Šå»å¯èƒ½æ˜¯åœ¨ä¹±åºæ‰§è¡Œã€‚</li></ul><p>ä»Javaæºä»£ç åˆ°æœ€ç»ˆå®é™…æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ï¼Œä¼šåˆ†åˆ«ç»å†ä¸‹é¢3ç§é‡æ’åºï¼š</p><p><img alt data-src="/images/java-aqs-voliate/%E9%87%8D%E6%8E%92%E5%BA%8F.png"></p><p>å¯¹äºç¼–è¯‘å™¨ï¼ŒJMMçš„ç¼–è¯‘å™¨é‡æ’åºè§„åˆ™ä¼šç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºï¼ˆä¸æ˜¯æ‰€æœ‰çš„ç¼–è¯‘å™¨é‡æ’åºéƒ½è¦ç¦æ­¢ï¼‰ã€‚å¯¹äºå¤„ç†å™¨é‡æ’åºï¼ŒJMMçš„å¤„ç†å™¨é‡æ’åºè§„åˆ™ä¼šè¦æ±‚Javaç¼–è¯‘å™¨åœ¨ç”ŸæˆæŒ‡ä»¤åºåˆ—æ—¶ï¼Œæ’å…¥ç‰¹å®šç±»å‹çš„å†…å­˜å±éšœï¼ˆMemory Barriersï¼ŒIntelç§°ä¹‹ä¸ºMemory Fenceï¼‰æŒ‡ä»¤ï¼Œé€šè¿‡å†…å­˜å±éšœæŒ‡ä»¤æ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚ </p><p>JMMå±äºè¯­è¨€çº§çš„å†…å­˜æ¨¡å‹ï¼Œå®ƒç¡®ä¿åœ¨ä¸åŒçš„ç¼–è¯‘å™¨å’Œä¸åŒçš„å¤„ç†å™¨å¹³å°ä¹‹ä¸Šï¼Œé€šè¿‡ç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºå’Œå¤„ç†å™¨é‡æ’åºï¼Œä¸ºç¨‹åºå‘˜æä¾›ä¸€è‡´çš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚</p><h1 id="3ã€happens-before"><a href="#3ã€happens-before" class="headerlink" title="3ã€happens-before"></a>3ã€happens-before</h1><ul><li>ç¨‹åºé¡ºåºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œï¼Œhappens-beforeäºè¯¥çº¿ç¨‹ä¸­çš„ä»»æ„åç»­æ“ä½œã€‚</li><li>ç›‘è§†å™¨é”è§„åˆ™ï¼šå¯¹ä¸€ä¸ªé”çš„è§£é”ï¼Œhappens-beforeäºéšåå¯¹è¿™ä¸ªé”çš„åŠ é”ã€‚</li><li>volatileå˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileåŸŸçš„å†™ï¼Œhappens-beforeäºä»»æ„åç»­å¯¹è¿™ä¸ªvolatileåŸŸçš„è¯»ã€‚ï¼ˆå¯¹ä¸€ä¸ªvolatileå˜é‡çš„è¯»ï¼Œæ€»æ˜¯èƒ½çœ‹åˆ°ã€ä»»æ„çº¿ç¨‹ã€‘å¯¹è¿™ä¸ªvolatileå˜é‡æœ€åçš„å†™å…¥ï¼‰</li><li>ä¼ é€’æ€§ï¼šå¦‚æœA happens-before Bï¼Œä¸”B happens-before Cï¼Œé‚£ä¹ˆA happens-before Cã€‚</li></ul><blockquote><p>ä¸¤ä¸ªæ“ä½œä¹‹é—´å…·æœ‰happens-beforeå…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€å‰ä¸€ä¸ªæ“ä½œå¿…é¡»è¦åœ¨åä¸€ä¸ªæ“ä½œä¹‹å‰æ‰§è¡Œï¼happens-beforeä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œï¼ˆæ‰§è¡Œçš„ç»“æœï¼‰å¯¹åä¸€ä¸ªæ“ä½œå¯è§ï¼Œä¸”å‰ä¸€ä¸ªæ“ä½œæŒ‰é¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ï¼ˆthe first is visible to and ordered before the secondï¼‰ã€‚</p></blockquote><h1 id="4ã€å†…å­˜å±éšœ"><a href="#4ã€å†…å­˜å±éšœ" class="headerlink" title="4ã€å†…å­˜å±éšœ"></a>4ã€å†…å­˜å±éšœ</h1><ul><li>ç¡¬ä»¶å±‚çš„å†…å­˜å±éšœåˆ†ä¸ºä¸¤ç§ï¼šLoad Barrier å’Œ Store Barrierå³è¯»å±éšœå’Œå†™å±éšœã€‚</li><li><font color="DeepPink">å¯¹äºLoad Barrieræ¥è¯´ï¼Œåœ¨æŒ‡ä»¤å‰æ’å…¥Load Barrierï¼Œå¯ä»¥è®©é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®å¤±æ•ˆï¼Œå¼ºåˆ¶ä»æ–°ä»ä¸»å†…å­˜åŠ è½½æ•°æ®ï¼›</font></li><li><font color="DeepPink">å¯¹äºStore Barrieræ¥è¯´ï¼Œåœ¨æŒ‡ä»¤åæ’å…¥Store Barrierï¼Œèƒ½è®©å†™å…¥ç¼“å­˜ä¸­çš„æœ€æ–°æ•°æ®æ›´æ–°å†™å…¥ä¸»å†…å­˜ï¼Œè®©å…¶ä»–çº¿ç¨‹å¯è§ã€‚</font></li><li>å†…å­˜å±éšœæœ‰ä¸¤ä¸ªä½œç”¨ï¼š<ul><li>é˜»æ­¢å±éšœä¸¤ä¾§çš„æŒ‡ä»¤é‡æ’åºï¼›</li><li>å¼ºåˆ¶æŠŠå†™ç¼“å†²åŒº/é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®ç­‰å†™å›ä¸»å†…å­˜ï¼Œè®©ç¼“å­˜ä¸­ç›¸åº”çš„æ•°æ®å¤±æ•ˆã€‚<h1 id="5ã€volatileçš„å†…å­˜è¯­ä¹‰"><a href="#5ã€volatileçš„å†…å­˜è¯­ä¹‰" class="headerlink" title="5ã€volatileçš„å†…å­˜è¯­ä¹‰"></a>5ã€volatileçš„å†…å­˜è¯­ä¹‰</h1></li></ul></li></ul><p>ä»JSR-133å¼€å§‹ï¼ˆå³ä»JDK5å¼€å§‹ï¼‰ï¼Œvolatileå˜é‡çš„å†™-è¯»å¯ä»¥å®ç°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</p><p><font color="DeepPink">ä»å†…å­˜è¯­ä¹‰çš„è§’åº¦æ¥è¯´ï¼Œvolatileçš„å†™-è¯»ä¸é”çš„é‡Šæ”¾-è·å–æœ‰ç›¸åŒçš„å†…å­˜æ•ˆæœ</font>ï¼š</p><ul><li>volatileå†™å’Œé”çš„é‡Šæ”¾æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ï¼›</li><li>volatileè¯»ä¸é”çš„è·å–æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ã€‚<blockquote><p>volatileä»…ä»…ä¿è¯å¯¹å•ä¸ªvolatileå˜é‡çš„è¯»/å†™å…·æœ‰åŸå­æ€§ï¼Œè€Œé”çš„äº’æ–¥æ‰§è¡Œçš„ç‰¹æ€§å¯ä»¥ç¡®ä¿å¯¹æ•´ä¸ªä¸´ç•ŒåŒºä»£ç çš„æ‰§è¡Œå…·æœ‰åŸå­æ€§ã€‚åœ¨åŠŸèƒ½ä¸Šï¼Œé”æ¯”volatileæ›´å¼ºå¤§ï¼›åœ¨å¯ä¼¸ç¼©æ€§å’Œæ‰§è¡Œæ€§èƒ½ä¸Šï¼Œvolatileæ›´æœ‰ä¼˜åŠ¿ã€‚</p></blockquote></li></ul><p>volatileå˜é‡è‡ªèº«å…·æœ‰ä¸‹åˆ—ç‰¹æ€§ï¼š</p><ul><li>å¯è§æ€§ã€‚å¯¹ä¸€ä¸ªvolatileå˜é‡çš„è¯»ï¼Œæ€»æ˜¯èƒ½çœ‹åˆ°ï¼ˆä»»æ„çº¿ç¨‹ï¼‰å¯¹è¿™ä¸ªvolatileå˜é‡æœ€åçš„å†™å…¥ã€‚</li><li>åŸå­æ€§ï¼šå¯¹ä»»æ„å•ä¸ªvolatileå˜é‡çš„è¯»/å†™å…·æœ‰åŸå­æ€§ï¼Œå³ä½¿æ˜¯64ä½çš„longå‹å’Œdoubleå‹å˜é‡ï¼Œåªè¦å®ƒæ˜¯volatileå˜é‡ï¼Œå¯¹è¯¥å˜é‡çš„è¯»/å†™å°±å…·æœ‰åŸå­æ€§ã€‚å¦‚æœæ˜¯å¤šä¸ªvolatileæ“ä½œæˆ–ç±»ä¼¼äºvolatile++è¿™ç§å¤åˆæ“ä½œï¼Œè¿™äº›æ“ä½œæ•´ä½“ä¸Šä¸å…·æœ‰åŸå­æ€§ã€‚</li></ul><p>volatileå†™å’Œvolatileè¯»çš„å†…å­˜è¯­ä¹‰ï¼š</p><ul><li><font color="DeepPink">çº¿ç¨‹Aå†™ä¸€ä¸ªvolatileå˜é‡ï¼Œå®è´¨ä¸Šæ˜¯çº¿ç¨‹Aå‘æ¥ä¸‹æ¥å°†è¦è¯»è¿™ä¸ªvolatileå˜é‡çš„æŸä¸ªçº¿ç¨‹å‘å‡ºäº†ï¼ˆå…¶å¯¹å…±äº«å˜é‡æ‰€åšä¿®æ”¹çš„ï¼‰æ¶ˆæ¯ã€‚</font></li><li><font color="DeepPink">çº¿ç¨‹Bè¯»ä¸€ä¸ªvolatileå˜é‡ï¼Œå®è´¨ä¸Šæ˜¯çº¿ç¨‹Bæ¥æ”¶äº†ä¹‹å‰æŸä¸ªçº¿ç¨‹å‘å‡ºçš„ï¼ˆåœ¨å†™è¿™ä¸ªvolatileå˜é‡ä¹‹å‰å¯¹å…±äº«å˜é‡æ‰€åšä¿®æ”¹çš„ï¼‰æ¶ˆæ¯ã€‚</font></li><li><font color="DeepPink">çº¿ç¨‹Aå†™ä¸€ä¸ªvolatileå˜é‡ï¼Œéšåçº¿ç¨‹Bè¯»è¿™ä¸ªvolatileå˜é‡ï¼Œè¿™ä¸ªè¿‡ç¨‹å®è´¨ä¸Šæ˜¯çº¿ç¨‹Aé€šè¿‡ä¸»å†…å­˜å‘çº¿ç¨‹Bå‘é€æ¶ˆæ¯ã€‚</font></li></ul><p>JMMé’ˆå¯¹ç¼–è¯‘å™¨åˆ¶å®šçš„volatileé‡æ’åºè§„åˆ™è¡¨</p><p><img alt data-src="/images/java-aqs-voliate/JMM%E9%92%88%E5%AF%B9%E7%BC%96%E8%AF%91%E5%99%A8%E5%88%B6%E5%AE%9A%E7%9A%84volatile%E9%87%8D%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99%E8%A1%A8.png"></p><ul><li><font color="DeepPink">å½“ç¬¬äºŒä¸ªæ“ä½œæ˜¯volatileå†™æ—¶ï¼Œä¸ç®¡ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿volatileå†™ä¹‹å‰çš„æ“ä½œä¸ä¼šè¢«ç¼–è¯‘å™¨é‡æ’åºåˆ°volatileå†™ä¹‹åã€‚</font></li><li><font color="DeepPink">å½“ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯volatileè¯»æ—¶ï¼Œä¸ç®¡ç¬¬äºŒä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿volatileè¯»ä¹‹åçš„æ“ä½œä¸ä¼šè¢«ç¼–è¯‘å™¨é‡æ’åºåˆ°volatileè¯»ä¹‹å‰ã€‚</font></li><li><font color="DeepPink">å½“ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯volatileå†™ï¼Œç¬¬äºŒä¸ªæ“ä½œæ˜¯volatileè¯»æ—¶ï¼Œä¸èƒ½é‡æ’åºã€‚</font></li></ul><p>ä¸ºäº†å®ç°volatileçš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­æ’å…¥å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚<strong>å¯¹äºç¼–è¯‘å™¨æ¥è¯´ï¼Œå‘ç°ä¸€ä¸ªæœ€ä¼˜å¸ƒç½®æ¥æœ€å°åŒ–æ’å…¥å±éšœå‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚ä¸ºæ­¤ï¼ŒJMMé‡‡å–ä¿å®ˆç­–ç•¥ã€‚ä¸‹é¢æ˜¯åŸºäºä¿å®ˆç­–ç•¥çš„JMMå†…å­˜å±éšœæ’å…¥ç­–ç•¥ã€‚</strong></p><ul><li>åœ¨æ¯ä¸ªvolatileå†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ªStoreStoreå±éšœã€‚</li><li>åœ¨æ¯ä¸ªvolatileå†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ªStoreLoadå±éšœã€‚</li><li>åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ªLoadLoadå±éšœã€‚</li><li>åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ªLoadStoreå±éšœã€‚<blockquote><p>LoadLoadå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Load1; LoadLoad; Load2ï¼Œåœ¨Load2åŠåç»­è¯»å–æ“ä½œè¦è¯»å–çš„æ•°æ®è¢«è®¿é—®å‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚</p></blockquote></li></ul><blockquote><p>StoreStoreå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Store1; StoreStore; Store2ï¼Œåœ¨Store2åŠåç»­å†™å…¥æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥æ“ä½œå¯¹å…¶å®ƒå¤„ç†å™¨å¯è§ã€‚  LoadStoreå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Load1; LoadStore; Store2ï¼Œåœ¨Store2åŠåç»­å†™å…¥æ“ä½œè¢«åˆ·å‡ºå‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚</p></blockquote><blockquote><p>StoreLoadå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Store1; StoreLoad; Load2ï¼Œåœ¨Load2åŠåç»­æ‰€æœ‰è¯»å–æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥å¯¹æ‰€æœ‰å¤„ç†å™¨å¯è§ã€‚å®ƒçš„å¼€é”€æ˜¯å››ç§å±éšœä¸­æœ€å¤§çš„ã€‚åœ¨å¤§å¤šæ•°å¤„ç†å™¨çš„å®ç°ä¸­ï¼Œè¿™ä¸ªå±éšœæ˜¯ä¸ªä¸‡èƒ½å±éšœï¼Œå…¼å…·å…¶å®ƒä¸‰ç§å†…å­˜å±éšœçš„åŠŸèƒ½ã€‚<br>ä¸Šè¿°å†…å­˜å±éšœæ’å…¥ç­–ç•¥éå¸¸ä¿å®ˆï¼Œä½†å®ƒå¯ä»¥ä¿è¯åœ¨ä»»æ„å¤„ç†å™¨å¹³å°ï¼Œä»»æ„çš„ç¨‹åºä¸­éƒ½èƒ½å¾—åˆ°æ­£ç¡®çš„volatileå†…å­˜è¯­ä¹‰ã€‚</p></blockquote><p>ä¸‹é¢æ˜¯ä¿å®ˆç­–ç•¥ä¸‹ï¼Œvolatileå†™æ’å…¥å†…å­˜å±éšœåç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾. </p><p><img alt data-src="/images/java-aqs-voliate/volatile%E5%86%99%E6%8F%92%E5%85%A5%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%90%8E%E7%94%9F%E6%88%90%E7%9A%84%E6%8C%87%E4%BB%A4%E5%BA%8F%E5%88%97%E7%A4%BA%E6%84%8F%E5%9B%BE.png"></p><p>å›¾ä¸­çš„StoreStoreå±éšœå¯ä»¥ä¿è¯åœ¨volatileå†™ä¹‹å‰ï¼Œå…¶å‰é¢çš„æ‰€æœ‰æ™®é€šå†™æ“ä½œå·²ç»å¯¹ä»»æ„å¤„ç†å™¨å¯è§äº†ã€‚è¿™æ˜¯å› ä¸º<strong>StoreStoreå±éšœå°†ä¿éšœä¸Šé¢æ‰€æœ‰çš„æ™®é€šå†™åœ¨volatileå†™ä¹‹å‰åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚</strong></p><p>è¿™é‡Œæ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ï¼Œvolatileå†™åé¢çš„StoreLoadå±éšœã€‚æ­¤å±éšœçš„ä½œç”¨æ˜¯é¿å…volatileå†™ä¸åé¢å¯èƒ½æœ‰çš„volatileè¯»/å†™æ“ä½œé‡æ’åºã€‚å› ä¸ºç¼–è¯‘å™¨å¸¸å¸¸æ— æ³•å‡†ç¡®åˆ¤æ–­åœ¨ä¸€ä¸ªvolatileå†™çš„åé¢æ˜¯å¦éœ€è¦æ’å…¥ä¸€ä¸ªStoreLoadå±éšœï¼ˆæ¯”å¦‚ï¼Œä¸€ä¸ªvolatileå†™ä¹‹åæ–¹æ³•ç«‹å³returnï¼‰ã€‚ä¸ºäº†ä¿è¯èƒ½æ­£ç¡®å®ç°volatileçš„å†…å­˜è¯­ä¹‰ï¼ŒJMMåœ¨é‡‡å–äº†ä¿å®ˆç­–ç•¥ï¼šåœ¨æ¯ä¸ªvolatileå†™çš„åé¢ï¼Œæˆ–è€…åœ¨æ¯ä¸ªvolatileè¯»çš„å‰é¢æ’å…¥ä¸€ä¸ªStoreLoadå±éšœã€‚ä»æ•´ä½“æ‰§è¡Œæ•ˆç‡çš„è§’åº¦è€ƒè™‘ï¼ŒJMMæœ€ç»ˆé€‰æ‹©äº†åœ¨æ¯ä¸ªvolatileå†™çš„åé¢æ’å…¥ä¸€ä¸ªStoreLoadå±éšœã€‚å› ä¸ºvolatileå†™-è¯»å†…å­˜è¯­ä¹‰çš„å¸¸è§ä½¿ç”¨æ¨¡å¼æ˜¯ï¼šä¸€ä¸ªå†™çº¿ç¨‹å†™volatileå˜é‡ï¼Œå¤šä¸ªè¯»çº¿ç¨‹è¯»åŒä¸€ä¸ªvolatileå˜é‡ã€‚å½“è¯»çº¿ç¨‹çš„æ•°é‡å¤§å¤§è¶…è¿‡å†™çº¿ç¨‹æ—¶ï¼Œé€‰æ‹©åœ¨volatileå†™ä¹‹åæ’å…¥StoreLoadå±éšœå°†å¸¦æ¥å¯è§‚çš„æ‰§è¡Œæ•ˆç‡çš„æå‡ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°JMMåœ¨å®ç°ä¸Šçš„ä¸€ä¸ªç‰¹ç‚¹ï¼šé¦–å…ˆç¡®ä¿æ­£ç¡®æ€§ï¼Œç„¶åå†å»è¿½æ±‚æ‰§è¡Œæ•ˆç‡ã€‚</p><p>ä¸‹é¢æ˜¯åœ¨ä¿å®ˆç­–ç•¥ä¸‹ï¼Œvolatileè¯»æ’å…¥å†…å­˜å±éšœåç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾:<br><img alt data-src="/images/java-aqs-voliate/volatile%E8%AF%BB%E6%8F%92%E5%85%A5%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%90%8E%E7%94%9F%E6%88%90%E7%9A%84%E6%8C%87%E4%BB%A4%E5%BA%8F%E5%88%97%E7%A4%BA%E6%84%8F%E5%9B%BE.png"><br>å›¾ä¸­çš„LoadLoadå±éšœç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŠŠä¸Šé¢çš„volatileè¯»ä¸ä¸‹é¢çš„æ™®é€šè¯»é‡æ’åºã€‚LoadStoreå±éšœç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŠŠä¸Šé¢çš„volatileè¯»ä¸ä¸‹é¢çš„æ™®é€šå†™é‡æ’åºã€‚ </p><p>ä¸Šè¿°volatileå†™å’Œvolatileè¯»çš„å†…å­˜å±éšœæ’å…¥ç­–ç•¥éå¸¸ä¿å®ˆã€‚åœ¨å®é™…æ‰§è¡Œæ—¶ï¼Œåªè¦ä¸æ”¹å˜volatileå†™-è¯»çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨å¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µçœç•¥ä¸å¿…è¦çš„å±éšœã€‚</p><h1 id="6ã€AQS"><a href="#6ã€AQS" class="headerlink" title="6ã€AQS"></a>6ã€AQS</h1><p>å¯¹äºAQSéœ€è¦äº†è§£è¿™ä¹ˆå‡ ç‚¹ï¼š </p><ul><li>é”çš„çŠ¶æ€é€šè¿‡volatile int stateæ¥è¡¨ç¤ºã€‚ </li><li>è·å–ä¸åˆ°é”çš„çº¿ç¨‹ä¼šè¿›å…¥AQSçš„é˜Ÿåˆ—ç­‰å¾…ã€‚ </li><li>å­ç±»éœ€è¦é‡å†™tryAcquireã€tryReleaseç­‰æ–¹æ³•ã€‚</li></ul><p>AQS è¯¦è§£å‚è§ï¼š<a href="https://juejin.im/post/5d37019a51882564c966add6" target="_blank" rel="noopener">é¢è¯•å¿…å¤‡ï¼šJava AQS å®ç°åŸç†ï¼ˆå›¾æ–‡ï¼‰åˆ†æ</a> </p><h1 id="7ã€ReentrantLock"><a href="#7ã€ReentrantLock" class="headerlink" title="7ã€ReentrantLock"></a>7ã€ReentrantLock</h1><p>ä»¥å…¬å¹³é”ä¸ºä¾‹ï¼Œçœ‹çœ‹ ReentrantLock è·å–é” &amp; é‡Šæ”¾é”çš„å…³é”®ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * The synchronization state.</span><br><span class="line"> */</span><br><span class="line">private volatile int state;</span><br><span class="line">/**</span><br><span class="line"> * Returns the current value of synchronization state.</span><br><span class="line"> * This operation has memory semantics of a &#123;@code volatile&#125; read.</span><br><span class="line"> * @return current state value</span><br><span class="line"> */</span><br><span class="line">protected final int getState() &#123;</span><br><span class="line">    return state;</span><br><span class="line">&#125;</span><br><span class="line">protected final boolean tryRelease(int releases) &#123;</span><br><span class="line">    int c = getState() - releases;</span><br><span class="line">    if (Thread.currentThread() != getExclusiveOwnerThread())</span><br><span class="line">        throw new IllegalMonitorStateException();</span><br><span class="line">    boolean free = false;</span><br><span class="line">    if (c == 0) &#123;</span><br><span class="line">        free = true;</span><br><span class="line">        setExclusiveOwnerThread(null);</span><br><span class="line">    &#125;</span><br><span class="line">    setState(c);// é‡Šæ”¾é”çš„æœ€åï¼Œå†™volatileå˜é‡state</span><br><span class="line">    return free;</span><br><span class="line">&#125;</span><br><span class="line"> protected final boolean tryAcquire(int acquires) &#123;</span><br><span class="line">        final Thread current = Thread.currentThread();</span><br><span class="line">        int c = getState();// è·å–é”çš„å¼€å§‹ï¼Œé¦–å…ˆè¯»volatileå˜é‡state</span><br><span class="line">        if (c == 0) &#123;</span><br><span class="line">            if (!hasQueuedPredecessors() &amp;&amp;</span><br><span class="line">                compareAndSetState(0, acquires)) &#123;</span><br><span class="line">                setExclusiveOwnerThread(current);</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else if (current == getExclusiveOwnerThread()) &#123;</span><br><span class="line">            int nextc = c + acquires;</span><br><span class="line">            if (nextc &lt; 0)</span><br><span class="line">                throw new Error(&quot;Maximum lock count exceeded&quot;);</span><br><span class="line">            setState(nextc);</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="DeepPink">å…¬å¹³é”åœ¨é‡Šæ”¾é”çš„æœ€åå†™volatileå˜é‡stateï¼Œåœ¨è·å–é”æ—¶é¦–å…ˆè¯»è¿™ä¸ªvolatileå˜é‡ã€‚æ ¹æ®volatileçš„happens-beforeè§„åˆ™ï¼Œé‡Šæ”¾é”çš„çº¿ç¨‹åœ¨å†™volatileå˜é‡ä¹‹å‰å¯è§çš„å…±äº«å˜é‡ï¼Œåœ¨è·å–é”çš„çº¿ç¨‹è¯»å–åŒä¸€ä¸ªvolatileå˜é‡åå°†ç«‹å³å˜å¾—å¯¹è·å–é”çš„çº¿ç¨‹å¯è§ã€‚ä»è€Œä¿è¯äº†ä»£ç æ®µä¸­å˜é‡ï¼ˆå˜é‡ä¸»è¦æ˜¯æŒ‡å…±äº«å˜é‡ï¼Œå­˜åœ¨ç«äº‰é—®é¢˜çš„å˜é‡ï¼‰çš„å¯è§æ€§ã€‚</font></p><p>8ã€å°ç»“</p><p>å¦‚æœæˆ‘ä»¬ä»”ç»†åˆ†æconcurrentåŒ…çš„æºä»£ç å®ç°ï¼Œä¼šå‘ç°ä¸€ä¸ªé€šç”¨åŒ–çš„å®ç°æ¨¡å¼ã€‚ </p><ul><li>é¦–å…ˆï¼Œ<font color="DeepPink">å£°æ˜å…±äº«å˜é‡ä¸ºvolatileã€‚ </font></li><li>ç„¶åï¼Œ<font color="DeepPink">ä½¿ç”¨CASçš„åŸå­æ¡ä»¶æ›´æ–°æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚</font></li><li>åŒæ—¶ï¼Œ<font color="DeepPink">é…åˆä»¥volatileçš„è¯»/å†™å’ŒCASæ‰€å…·æœ‰çš„volatileè¯»å’Œå†™çš„å†…å­˜è¯­ä¹‰æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</font><blockquote><p>å‰æ–‡æˆ‘ä»¬æåˆ°è¿‡ï¼Œç¼–è¯‘å™¨ä¸ä¼šå¯¹volatileè¯»ä¸volatileè¯»åé¢çš„ä»»æ„å†…å­˜æ“ä½œé‡æ’åºï¼›ç¼–è¯‘å™¨ä¸ä¼šå¯¹volatileå†™ä¸volatileå†™å‰é¢çš„ä»»æ„å†…å­˜æ“ä½œé‡æ’åºã€‚ç»„åˆè¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œæ„å‘³ç€ä¸ºäº†åŒæ—¶å®ç°volatileè¯»å’Œvolatileå†™çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨ä¸èƒ½å¯¹CASä¸CASå‰é¢å’Œåé¢çš„ä»»æ„å†…å­˜æ“ä½œé‡æ’åºã€‚</p></blockquote></li></ul><p>æœ¬æ–‡å‚è€ƒï¼š </p><p>1ã€ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ æ–¹è…¾é£ã€€é­é¹ã€€ç¨‹æ™“æ˜ã€€è‘—</p><p>2ã€<a href="https://mp.weixin.qq.com/s?__biz=MzI3ODcxMzQzMw==&mid=2247485795&idx=2&sn=73d5bcd83378f6176f9593d33dc402dc&chksm=eb538c55dc240543df3cd113cb3e586e98d3ccd0a93c6a87829a04e296b990a554596338046e#rd" target="_blank" rel="noopener">Java å¯é‡å…¥é”å†…å­˜å¯è§æ€§åˆ†æ</a> </p>]]></content>
      
      
      <categories>
          
          <category> JUC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JUC </tag>
            
            <tag> AQS </tag>
            
            <tag> JDK </tag>
            
            <tag> Volatile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java Lambdaè¡¨è¾¾å¼ å®ç°åŸç†åˆ†æ</title>
      <link href="/java-lambda.html"/>
      <url>/java-lambda.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡åˆ†æåŸºäºJDK 9</p></blockquote><a id="more"></a><h1 id="ä¸€ã€ç›®æ ‡"><a href="#ä¸€ã€ç›®æ ‡" class="headerlink" title="ä¸€ã€ç›®æ ‡"></a>ä¸€ã€ç›®æ ‡</h1><p>æœ¬æ–‡ä¸»è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š </p><p>1ã€å‡½æ•°å¼æ¥å£ åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ </p><p>2ã€Lambdaè¡¨è¾¾å¼æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</p><p>å…ˆä»‹ç»ä¸€ä¸ªjdkçš„binç›®å½•ä¸‹çš„ä¸€ä¸ªå­—èŠ‚ç æŸ¥çœ‹å·¥å…·åŠåç¼–è¯‘å·¥å…·ï¼šjavap</p><p><img alt data-src="/images/java-lambda/javap.png"></p><h1 id="äºŒã€å‡½æ•°å¼æ¥å£"><a href="#äºŒã€å‡½æ•°å¼æ¥å£" class="headerlink" title="äºŒã€å‡½æ•°å¼æ¥å£"></a>äºŒã€å‡½æ•°å¼æ¥å£</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@FunctionalInterface</span><br><span class="line">interface IFunctionTest&lt;T&gt; &#123;</span><br><span class="line">    public void print(T x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡javap åç¼–è¯‘IFunctionTest.class å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$C:\Users\Code\Java\study&gt;javap -p IFunctionTest.class</span><br><span class="line">Compiled from &quot;FunctionTest.java&quot;</span><br><span class="line">interface IFunctionTest&lt;T&gt; &#123;</span><br><span class="line">  public abstract void print(T);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å‡½æ•°å¼æ¥å£ç¼–è¯‘å®Œä¹‹åä¾ç„¶æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£å…·æœ‰å”¯ä¸€çš„ä¸€ä¸ªæŠ½åƒæ–¹æ³•ã€‚</p><p>ä¸ºä»€ä¹ˆè¯´éœ€è¦æ˜¯å”¯ä¸€ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@FunctionalInterface</span><br><span class="line">interface IFunctionTest&lt;T&gt; &#123;</span><br><span class="line">    public void print(T x);</span><br><span class="line">    public void print22(T x,int rr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img alt data-src="/images/java-lambda/javac-FunctionTest.png"></p><p>è™½ç„¶ä¸èƒ½åœ¨å‡½æ•°å¼æ¥å£ä¸­å®šä¹‰å¤šä¸ªæ–¹æ³•ï¼Œä½†å¯ä»¥å®šä¹‰é»˜è®¤æ–¹æ³•ã€é™æ€æ–¹æ³•ã€å®šä¹‰java.lang.Objecté‡Œçš„publicæ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@FunctionalInterface</span><br><span class="line">interface Print&lt;T&gt; &#123;</span><br><span class="line">    public void print(T x);</span><br><span class="line">    default void doSomeMoreWork1()&#123;</span><br><span class="line">        // Method body</span><br><span class="line">    &#125;</span><br><span class="line">    static void printHello()&#123;</span><br><span class="line">        System.out.println(&quot;Hello&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    boolean equals(Object obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åç¼–è¯‘æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$C:\Users\Code\Java\study&gt;javap -p IFunctionTest.class</span><br><span class="line">Compiled from &quot;FunctionTest.java&quot;</span><br><span class="line">interface IFunctionTest&lt;T&gt; &#123;</span><br><span class="line">  public abstract void print(T);</span><br><span class="line">  public void doSomeMoreWork1();</span><br><span class="line">  public static void printHello();</span><br><span class="line">  public abstract boolean equals(java.lang.Object);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä¸‰ã€Lambda"><a href="#ä¸‰ã€Lambda" class="headerlink" title="ä¸‰ã€Lambda"></a>ä¸‰ã€Lambda</h1><h2 id="3-1-ç¤ºä¾‹ä»£ç "><a href="#3-1-ç¤ºä¾‹ä»£ç " class="headerlink" title="3.1 ç¤ºä¾‹ä»£ç "></a>3.1 ç¤ºä¾‹ä»£ç </h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class LambdaTest &#123;</span><br><span class="line">    public static void printString(String s, Print&lt;String&gt; print) &#123;</span><br><span class="line">        print.print(s);</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        printString(&quot;test&quot;, (x) -&gt; System.out.println(x));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@FunctionalInterface</span><br><span class="line">interface Print&lt;T&gt; &#123;</span><br><span class="line">    public void print(T x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡javacç¼–è¯‘LambdaTest.javaæ–‡ä»¶ï¼Œä¼šç”ŸæˆLambdaTest.classã€Print.classä¸¤ä¸ªclassæ–‡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac LambdaTest.java</span><br></pre></td></tr></table></figure><p><img alt data-src="/images/java-lambda/javac-LambdaTest.png"></p><h2 id="3-2-å¯¹äºlambdaå®ç°çš„çŒœæµ‹"><a href="#3-2-å¯¹äºlambdaå®ç°çš„çŒœæµ‹" class="headerlink" title="3.2 å¯¹äºlambdaå®ç°çš„çŒœæµ‹"></a>3.2 å¯¹äºlambdaå®ç°çš„çŒœæµ‹</h2><p>é‚£ä¹ˆç¼–è¯‘å™¨å¯¹Lambda éƒ½åšäº†ä»€ä¹ˆï¼Ÿåç¼–è¯‘ä¸€ä¸‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Code\Java\study&gt;javap -p LambdaTest.class</span><br><span class="line">Compiled from &quot;LambdaTest.java&quot;</span><br><span class="line">public class LambdaTest &#123;</span><br><span class="line">  public LambdaTest();</span><br><span class="line">  public static void printString(java.lang.String, Print&lt;java.lang.String&gt;);</span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">  private static void lambda$main$0(java.lang.String);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºç¼–è¯‘å™¨ä¼šæ ¹æ®Lambdaè¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªç§æœ‰çš„é™æ€å‡½æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private static void lambda$main$0(java.lang.String);</span><br></pre></td></tr></table></figure><p>ä¸ºäº†éªŒè¯ä¸Šé¢çš„è½¬åŒ–æ˜¯å¦æ­£ç¡®? æˆ‘ä»¬åœ¨ä»£ç ä¸­å®šä¹‰ä¸€ä¸ªlambda$main$0è¿™ä¸ªçš„å‡½æ•°ï¼Œæœ€ç»ˆä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class LambdaTest &#123;</span><br><span class="line">    public static void printString(String s, Print&lt;String&gt; print) &#123;</span><br><span class="line">        print.print(s);</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        printString(&quot;test&quot;, (x) -&gt; System.out.println(x));</span><br><span class="line">    &#125;</span><br><span class="line">    private static void lambda$main$0(String s) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@FunctionalInterface</span><br><span class="line">interface Print&lt;T&gt; &#123;</span><br><span class="line">    public void print(T x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç åœ¨ç¼–è¯‘æ—¶ä¼šæŠ¥é”™ï¼Œé”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Code\Java\study&gt;javac LambdaTest.java</span><br><span class="line">LambdaTest.java:8: é”™è¯¯: ç¬¦å·lambda$main$0(String)ä¸LambdaTestä¸­çš„ compiler-synt</span><br><span class="line">hesized ç¬¦å·å†²çª</span><br><span class="line">    private static void lambda$main$0(String s) &#123;</span><br><span class="line">                        ^</span><br><span class="line">LambdaTest.java:1: é”™è¯¯: ç¬¦å·lambda$main$0(String)ä¸LambdaTestä¸­çš„ compiler-synt</span><br><span class="line">hesized ç¬¦å·å†²çª</span><br><span class="line">public class LambdaTest &#123;</span><br><span class="line">^</span><br><span class="line">2 ä¸ªé”™è¯¯</span><br></pre></td></tr></table></figure><p>æœ‰äº†ä¸Šé¢çš„å†…å®¹ï¼Œå¯ä»¥çŸ¥é“çš„æ˜¯Lambdaè¡¨è¾¾å¼åœ¨Java 9ä¸­é¦–å…ˆä¼šç”Ÿæˆä¸€ä¸ªç§æœ‰çš„é™æ€å‡½æ•°ï¼Œè¿™ä¸ªç§æœ‰çš„é™æ€å‡½æ•°å¹²çš„å°±æ˜¯Lambdaè¡¨è¾¾å¼é‡Œé¢çš„å†…å®¹ï¼Œé‚£ä¹ˆåˆæ˜¯å¦‚ä½•è°ƒç”¨çš„ç”Ÿæˆçš„ç§æœ‰é™æ€å‡½æ•°ï¼ˆlambda$main$0(String s)ï¼‰å‘¢ï¼Ÿ</p><h2 id="3-3-åç¼–è¯‘ä»£ç è¯¦è§£"><a href="#3-3-åç¼–è¯‘ä»£ç è¯¦è§£" class="headerlink" title="3.3 åç¼–è¯‘ä»£ç è¯¦è§£"></a>3.3 åç¼–è¯‘ä»£ç è¯¦è§£</h2><p>æŸ¥çœ‹æ›´åŠ è¯¦ç»†çš„åç¼–è¯‘ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">$C:\Users\Code\Java\study&gt; javap -p -v -c LambdaTest.class</span><br><span class="line">Classfile /C:/Users/Code/Java/study/LambdaTest.class</span><br><span class="line">  Last modified 2018-4-5; size 1184 bytes</span><br><span class="line">  MD5 checksum b144b5a936a04a7c975eae93c7370174</span><br><span class="line">  Compiled from &quot;LambdaTest.java&quot;</span><br><span class="line">public class LambdaTest</span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: 52</span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Methodref          #9.#24         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">   #2 = InterfaceMethodref #25.#26        // Print.print:(Ljava/lang/Object;)V</span><br><span class="line">   #3 = String             #27            // test</span><br><span class="line">   #4 = InvokeDynamic      #0:#33         // #0:print:()LPrint;</span><br><span class="line">   #5 = Methodref          #8.#34         // LambdaTest.printString:(Ljava/lang/String;LPrint;)V</span><br><span class="line">   #6 = Fieldref           #35.#36        // java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   #7 = Methodref          #37.#38        // java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">   #8 = Class              #39            // LambdaTest</span><br><span class="line">   #9 = Class              #40            // java/lang/Object</span><br><span class="line">  #10 = Utf8               &lt;init&gt;</span><br><span class="line">  #11 = Utf8               ()V</span><br><span class="line">  #12 = Utf8               Code</span><br><span class="line">  #13 = Utf8               LineNumberTable</span><br><span class="line">  #14 = Utf8               printString</span><br><span class="line">  #15 = Utf8               (Ljava/lang/String;LPrint;)V</span><br><span class="line">  #16 = Utf8               Signature</span><br><span class="line">  #17 = Utf8               (Ljava/lang/String;LPrint&lt;Ljava/lang/String;&gt;;)V</span><br><span class="line">  #18 = Utf8               main</span><br><span class="line">  #19 = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #20 = Utf8               lambda$main$0</span><br><span class="line">  #21 = Utf8               (Ljava/lang/String;)V</span><br><span class="line">  #22 = Utf8               SourceFile</span><br><span class="line">  #23 = Utf8               LambdaTest.java</span><br><span class="line">  #24 = NameAndType        #10:#11        // &quot;&lt;init&gt;&quot;:()V</span><br><span class="line">  #25 = Class              #41            // Print</span><br><span class="line">  #26 = NameAndType        #42:#43        // print:(Ljava/lang/Object;)V</span><br><span class="line">  #27 = Utf8               test</span><br><span class="line">  #28 = Utf8               BootstrapMethods</span><br><span class="line">  #29 = MethodHandle       #6:#44         // invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;</span><br><span class="line">  #30 = MethodType         #43            //  (Ljava/lang/Object;)V</span><br><span class="line">  #31 = MethodHandle       #6:#45         // invokestatic LambdaTest.lambda$main$0:(Ljava/lang/String;)V</span><br><span class="line">  #32 = MethodType         #21            //  (Ljava/lang/String;)V</span><br><span class="line">  #33 = NameAndType        #42:#46        // print:()LPrint;</span><br><span class="line">  #34 = NameAndType        #14:#15        // printString:(Ljava/lang/String;LPrint;)V</span><br><span class="line">  #35 = Class              #47            // java/lang/System</span><br><span class="line">  #36 = NameAndType        #48:#49        // out:Ljava/io/PrintStream;</span><br><span class="line">  #37 = Class              #50            // java/io/PrintStream</span><br><span class="line">  #38 = NameAndType        #51:#21        // println:(Ljava/lang/String;)V</span><br><span class="line">  #39 = Utf8               LambdaTest</span><br><span class="line">  #40 = Utf8               java/lang/Object</span><br><span class="line">  #41 = Utf8               Print</span><br><span class="line">  #42 = Utf8               print</span><br><span class="line">  #43 = Utf8               (Ljava/lang/Object;)V</span><br><span class="line">  #44 = Methodref          #52.#53        // java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;</span><br><span class="line">  #45 = Methodref          #8.#54         // LambdaTest.lambda$main$0:(Ljava/lang/String;)V</span><br><span class="line">  #46 = Utf8               ()LPrint;</span><br><span class="line">  #47 = Utf8               java/lang/System</span><br><span class="line">  #48 = Utf8               out</span><br><span class="line">  #49 = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #50 = Utf8               java/io/PrintStream</span><br><span class="line">  #51 = Utf8               println</span><br><span class="line">  #52 = Class              #55            // java/lang/invoke/LambdaMetafactory</span><br><span class="line">  #53 = NameAndType        #56:#60        // metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;</span><br><span class="line">  #54 = NameAndType        #20:#21        // lambda$main$0:(Ljava/lang/String;)V</span><br><span class="line"></span><br><span class="line">  #55 = Utf8               java/lang/invoke/LambdaMetafactory</span><br><span class="line">  #56 = Utf8               metafactory</span><br><span class="line">  #57 = Class              #62            // java/lang/invoke/MethodHandles$Lookup</span><br><span class="line">  #58 = Utf8               Lookup</span><br><span class="line">  #59 = Utf8               InnerClasses</span><br><span class="line">  #60 = Utf8               (Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;</span><br><span class="line">  #61 = Class              #63            // java/lang/invoke/MethodHandles</span><br><span class="line">  #62 = Utf8               java/lang/invoke/MethodHandles$Lookup</span><br><span class="line">  #63 = Utf8               java/lang/invoke/MethodHandles</span><br><span class="line">&#123;</span><br><span class="line">  public LambdaTest();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         4: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 1: 0</span><br><span class="line"></span><br><span class="line">  public static void printString(java.lang.String, Print&lt;java.lang.String&gt;);</span><br><span class="line">    descriptor: (Ljava/lang/String;LPrint;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=2, args_size=2</span><br><span class="line">         0: aload_1</span><br><span class="line">         1: aload_0</span><br><span class="line">         2: invokeinterface #2,  2            // InterfaceMethod Print.print:(Ljava/lang/Object;)V</span><br><span class="line">         7: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 3: 0</span><br><span class="line">        line 4: 7</span><br><span class="line">    Signature: #17                          // (Ljava/lang/String;LPrint&lt;Ljava/lang/String;&gt;;)V</span><br><span class="line"></span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=1, args_size=1</span><br><span class="line">         0: ldc           #3                  // String test</span><br><span class="line">         2: invokedynamic #4,  0              // InvokeDynamic #0:print:()LPrint;</span><br><span class="line">         7: invokestatic  #5                  // Method printString:(Ljava/lang/String;LPrint;)V</span><br><span class="line">        10: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 6: 0</span><br><span class="line">        line 7: 10</span><br><span class="line"></span><br><span class="line">  private static void lambda$main$0(java.lang.String);</span><br><span class="line">    descriptor: (Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PRIVATE, ACC_STATIC, ACC_SYNTHETIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=1, args_size=1</span><br><span class="line">         0: getstatic     #6                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">         3: aload_0</span><br><span class="line">         4: invokevirtual #7                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">         7: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 6: 0</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: &quot;LambdaTest.java&quot;</span><br><span class="line">InnerClasses:</span><br><span class="line">     public static final #58= #57 of #61; //Lookup=class java/lang/invoke/MethodHandles$Lookup of class java/lang/invoke/MethodHandles</span><br><span class="line">BootstrapMethods:</span><br><span class="line">  0: #29 invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;Method arguments:</span><br><span class="line">      #30 (Ljava/lang/Object;)V</span><br><span class="line">      #31 invokestatic LambdaTest.lambda$main$0:(Ljava/lang/String;)V</span><br><span class="line">      #32 (Ljava/lang/String;)V</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª class æ–‡ä»¶å±•ç¤ºäº†ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼šå¸¸é‡æ± ã€æ„é€ å™¨æ–¹æ³•å’Œ printStringã€mainã€lambdamainmain0æ–¹æ³•è¿˜æœ‰lambdaè¡¨è¾¾å¼ç”Ÿæˆçš„å†…éƒ¨ç±»ã€‚</p><h3 id="3-3-1-åŠ¨æ€é“¾æ¥"><a href="#3-3-1-åŠ¨æ€é“¾æ¥" class="headerlink" title="3.3.1 åŠ¨æ€é“¾æ¥"></a>3.3.1 åŠ¨æ€é“¾æ¥</h3><p>æ¯ä¸ªæ ˆå¸§éƒ½æœ‰ä¸€ä¸ªè¿è¡Œæ—¶å¸¸é‡æ± çš„å¼•ç”¨ã€‚è¿™ä¸ªå¼•ç”¨æŒ‡å‘æ ˆå¸§å½“å‰è¿è¡Œæ–¹æ³•æ‰€åœ¨ç±»çš„å¸¸é‡æ± ã€‚é€šè¿‡è¿™ä¸ªå¼•ç”¨æ”¯æŒåŠ¨æ€é“¾æ¥ï¼ˆdynamic linkingï¼‰ã€‚</p><p>C/C++ ä»£ç ä¸€èˆ¬è¢«ç¼–è¯‘æˆå¯¹è±¡æ–‡ä»¶ï¼Œç„¶åå¤šä¸ªå¯¹è±¡æ–‡ä»¶è¢«é“¾æ¥åˆ°ä¸€èµ·äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶æˆ–è€… dllã€‚åœ¨é“¾æ¥é˜¶æ®µï¼Œæ¯ä¸ªå¯¹è±¡æ–‡ä»¶çš„ç¬¦å·å¼•ç”¨è¢«æ›¿æ¢æˆäº†æœ€ç»ˆæ‰§è¡Œæ–‡ä»¶çš„ç›¸å¯¹åç§»å†…å­˜åœ°å€ã€‚åœ¨ Javaä¸­ï¼Œé“¾æ¥é˜¶æ®µæ˜¯è¿è¡Œæ—¶åŠ¨æ€å®Œæˆçš„ã€‚</p><p><font color="DeepPink">å½“ Java ç±»æ–‡ä»¶ç¼–è¯‘æ—¶ï¼Œæ‰€æœ‰å˜é‡å’Œæ–¹æ³•çš„å¼•ç”¨éƒ½è¢«å½“åšç¬¦å·å¼•ç”¨å­˜å‚¨åœ¨è¿™ä¸ªç±»çš„å¸¸é‡æ± ä¸­ã€‚ç¬¦å·å¼•ç”¨æ˜¯ä¸€ä¸ªé€»è¾‘å¼•ç”¨ï¼Œå®é™…ä¸Šå¹¶ä¸æŒ‡å‘ç‰©ç†å†…å­˜åœ°å€ã€‚JVM å¯ä»¥é€‰æ‹©ç¬¦å·å¼•ç”¨è§£æçš„æ—¶æœºï¼Œä¸€ç§æ˜¯å½“ç±»æ–‡ä»¶åŠ è½½å¹¶æ ¡éªŒé€šè¿‡åï¼Œè¿™ç§è§£ææ–¹å¼è¢«ç§°ä¸ºé¥¥é¥¿æ–¹å¼ã€‚å¦å¤–ä¸€ç§æ˜¯ç¬¦å·å¼•ç”¨åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™è¢«è§£æï¼Œè¿™ç§è§£ææ–¹å¼ç§°ä¸ºæƒ°æ€§æ–¹å¼ã€‚æ— è®ºå¦‚ä½• ï¼ŒJVM å¿…é¡»è¦åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨ç¬¦å·å¼•ç”¨æ—¶å®Œæˆè§£æå¹¶æŠ›å‡ºå¯èƒ½å‘ç”Ÿçš„è§£æé”™è¯¯ã€‚ç»‘å®šæ˜¯å°†å¯¹è±¡åŸŸã€æ–¹æ³•ã€ç±»çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ç»‘å®šåªä¼šå‘ç”Ÿä¸€æ¬¡ã€‚ä¸€æ—¦ç»‘å®šï¼Œç¬¦å·å¼•ç”¨ä¼šè¢«å®Œå…¨æ›¿æ¢ã€‚å¦‚æœä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨è¿˜æ²¡æœ‰è¢«è§£æï¼Œé‚£ä¹ˆå°±ä¼šè½½å…¥è¿™ä¸ªç±»ã€‚æ¯ä¸ªç›´æ¥å¼•ç”¨éƒ½è¢«å­˜å‚¨ä¸ºç›¸å¯¹äºå­˜å‚¨ç»“æ„ï¼ˆä¸è¿è¡Œæ—¶å˜é‡æˆ–æ–¹æ³•çš„ä½ç½®ç›¸å…³è”çš„ï¼‰åç§»é‡ã€‚</font></p><h3 id="3-3-2-å¸¸é‡æ± "><a href="#3-3-2-å¸¸é‡æ± " class="headerlink" title="3.3.2 å¸¸é‡æ± "></a>3.3.2 å¸¸é‡æ± </h3><p>JVM ç»´æŠ¤äº†ä¸€ä¸ªæŒ‰ç±»å‹åŒºåˆ†çš„å¸¸é‡æ± ï¼Œä¸€ä¸ªç±»ä¼¼äºç¬¦å·è¡¨çš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚å°½ç®¡å®ƒåŒ…å«æ›´å¤šæ•°æ®ã€‚Java å­—èŠ‚ç éœ€è¦æ•°æ®ã€‚è¿™ä¸ªæ•°æ®ç»å¸¸å› ä¸ºå¤ªå¤§ä¸èƒ½ç›´æ¥å­˜å‚¨åœ¨å­—èŠ‚ç ä¸­ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ï¼Œå­—èŠ‚ç åŒ…å«è¿™ä¸ªå¸¸é‡æ± çš„å¼•ç”¨ã€‚</p><p>å¸¸é‡æ± ä¸­å¯ä»¥å­˜å‚¨å¤šç§ç±»å‹çš„æ•°æ®ï¼š</p><ul><li>æ•°å­—å‹</li><li>å­—ç¬¦ä¸²å‹</li><li>ç±»å¼•ç”¨å‹</li><li>åŸŸå¼•ç”¨å‹</li><li>æ–¹æ³•å¼•ç”¨</li></ul><h3 id="3-3-3-æ–¹æ³•"><a href="#3-3-3-æ–¹æ³•" class="headerlink" title="3.3.3 æ–¹æ³•"></a>3.3.3 æ–¹æ³•</h3><p>æ¯ä¸€ä¸ªæ–¹æ³•åŒ…å«å››ä¸ªåŒºåŸŸï¼š</p><ul><li>ç­¾åå’Œè®¿é—®æ ‡ç­¾</li><li>å­—èŠ‚ç </li><li>LineNumberTableï¼šä¸ºè°ƒè¯•å™¨æä¾›æºç ä¸­çš„æ¯ä¸€è¡Œå¯¹åº”çš„å­—èŠ‚ç ä¿¡æ¯</li><li>LocalVariableTableï¼šåˆ—å‡ºäº†æ‰€æœ‰æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡</li></ul><table><thead><tr><th>æ“ä½œç </th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>aload0</td><td>è¿™ä¸ªæ“ä½œç æ˜¯aloadæ ¼å¼æ“ä½œç ä¸­çš„ä¸€ä¸ªã€‚å®ƒä»¬ç”¨æ¥æŠŠå¯¹è±¡å¼•ç”¨åŠ è½½åˆ°æ“ä½œç æ ˆã€‚è¡¨ç¤ºæ­£åœ¨è¢«è®¿é—®çš„å±€éƒ¨å˜é‡æ•°ç»„çš„ä½ç½®ï¼Œä½†åªèƒ½æ˜¯0ã€1ã€2ã€3 ä¸­çš„ä¸€ä¸ªã€‚è¿˜æœ‰ä¸€äº›å…¶å®ƒç±»ä¼¼çš„æ“ä½œç ç”¨æ¥è½½å…¥éå¯¹è±¡å¼•ç”¨çš„æ•°æ®ï¼Œå¦‚iload, lload, float å’Œ dloadã€‚å…¶ä¸­ i è¡¨ç¤º intï¼Œl è¡¨ç¤º longï¼Œf è¡¨ç¤º floatï¼Œd è¡¨ç¤º doubleã€‚å±€éƒ¨å˜é‡æ•°ç»„ä½ç½®å¤§äº 3 çš„å±€éƒ¨å˜é‡å¯ä»¥ç”¨ iload, lload, float, dload å’Œ aload è½½å…¥ã€‚è¿™äº›æ“ä½œç éƒ½åªéœ€è¦ä¸€ä¸ªæ“ä½œæ•°ï¼Œå³æ•°ç»„ä¸­çš„ä½ç½®ã€‚</td></tr><tr><td>ldc</td><td>è¿™ä¸ªæ“ä½œç ç”¨æ¥å°†å¸¸é‡ä»è¿è¡Œæ—¶å¸¸é‡æ± å‹æ ˆåˆ°æ“ä½œæ•°æ ˆã€‚</td></tr><tr><td>getstatic</td><td>è¿™ä¸ªæ“ä½œç ç”¨æ¥æŠŠä¸€ä¸ªé™æ€å˜é‡ä»è¿è¡Œæ—¶å¸¸é‡æ± çš„é™æ€å˜é‡åˆ—è¡¨ä¸­å‹æ ˆåˆ°æ“ä½œæ•°æ ˆã€‚</td></tr><tr><td>return</td><td>è¿™ä¸ªæ“ä½œç å±äºireturnã€lreturnã€freturnã€dreturnã€areturn å’Œ return æ“ä½œç ç»„ã€‚æ¯ä¸ªæ“ä½œç è¿”å›ä¸€ç§ç±»å‹çš„è¿”å›å€¼ï¼Œå…¶ä¸­ i è¡¨ç¤º intï¼Œl è¡¨ç¤º longï¼Œf è¡¨ç¤º floatï¼Œd è¡¨ç¤º doubleï¼Œa è¡¨ç¤º å¯¹è±¡å¼•ç”¨ã€‚æ²¡æœ‰å‰ç¼€ç±»å‹å­—æ¯çš„ return è¡¨ç¤ºè¿”å› voidã€‚</td></tr></tbody></table><table><thead><tr><th>å‡½æ•°è°ƒç”¨æ“ä½œç </th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>invokestatic</td><td>è°ƒç”¨ç±»æ–¹æ³•ï¼ˆé™æ€ç»‘å®šï¼Œé€Ÿåº¦å¿«ï¼‰</td></tr><tr><td>invokevirtual</td><td>æŒ‡ä»¤è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹æ–¹æ³•ï¼ˆåŠ¨æ€ç»‘å®šï¼‰</td></tr><tr><td>invokespecial</td><td>æŒ‡ä»¤è°ƒç”¨å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€çˆ¶ç±»æ–¹æ³•ã€‚ï¼ˆé™æ€ç»‘å®šï¼Œé€Ÿåº¦å¿«ï¼‰</td></tr><tr><td>invokeinterface</td><td>è°ƒç”¨å¼•ç”¨ç±»å‹ä¸ºinterfaceçš„å®ä¾‹æ–¹æ³•ï¼ˆåŠ¨æ€ç»‘å®šï¼‰</td></tr><tr><td>invokedynamic</td><td>JDK 7å¼•å…¥çš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒåŠ¨æ€è¯­è¨€çš„æ–¹æ³•è°ƒç”¨</td></tr></tbody></table><h3 id="3-3-4-ä»£ç åˆ†æ"><a href="#3-3-4-ä»£ç åˆ†æ" class="headerlink" title="3.3.4 ä»£ç åˆ†æ"></a>3.3.4 ä»£ç åˆ†æ</h3><p>æ³¨æ„åç¼–è¯‘åmainæ–¹æ³•éƒ¨åˆ†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public static void main(java.lang.String[]);</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=1, args_size=1</span><br><span class="line">         // ldc è¿™ä¸ªæ“ä½œç ç”¨æ¥å°†å¸¸é‡ä»è¿è¡Œæ—¶å¸¸é‡æ± å‹æ ˆåˆ°æ“ä½œæ•°æ ˆ</span><br><span class="line">         0: ldc           #3                  // String test</span><br><span class="line">         // æ³¨æ„ä¸‹é¢ä¸¤å¥ï¼šé€šè¿‡å®ä¾‹è°ƒç”¨ print</span><br><span class="line">         2: invokedynamic #4,  0              // InvokeDynamic #0:print:()LPrint;        </span><br><span class="line">         //è°ƒç”¨é™æ€æ–¹æ³• printString</span><br><span class="line">         7: invokestatic  #5                  // Method printString:(Ljava/lang/String;LPrint;)V</span><br><span class="line">        10: return</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œæ—¢ç„¶æ˜¯è°ƒç”¨å®ä¾‹æ–¹æ³•ï¼Œé‚£ä¹ˆå®ä¾‹åœ¨å“ªï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">InnerClasses:</span><br><span class="line">     public static final #58= #57 of #61; //Lookup=class java/lang/invoke/MethodHandles$Lookup of class java/lang/invoke/MethodHandles</span><br><span class="line">BootstrapMethods:</span><br><span class="line">  0: #29 invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;</span><br><span class="line">  Method arguments:</span><br><span class="line">      //å¯¹è±¡ç±»å‹ç»ˆç»“ç¬¦ä¸º L å’Œ ;</span><br><span class="line">      //Object V</span><br><span class="line">      #30 (Ljava/lang/Object;)V</span><br><span class="line">      #31 invokestatic LambdaTest.lambda$main$0:(Ljava/lang/String;)V</span><br><span class="line">      #32 (Ljava/lang/String;)V</span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ ä¸Š-Djdk.internal.lambda.dumpProxyClassesï¼ŒåŠ ä¸Šè¿™ä¸ªå‚æ•°åï¼Œè¿è¡Œæ—¶ï¼Œä¼šå°†ç”Ÿæˆçš„å†…éƒ¨ç±»classç è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Djdk.internal.lambda.dumpProxyClasses LambdaTest</span><br></pre></td></tr></table></figure><p><img alt data-src="/images/java-lambda/dumpProxyClasses.png"><br>é€šè¿‡jadåç¼–è¯‘LambdaTest$$Lambda$1.classæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.</span><br><span class="line">// Jad home page: http://www.kpdus.com/jad.html</span><br><span class="line">// Decompiler options: packimports(3) </span><br><span class="line">final class LambdaTest$$Lambda$1 implements Print &#123;</span><br><span class="line">    private LambdaTest$$Lambda$1() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void print(Object obj) &#123;</span><br><span class="line">        LambdaTest.lambda$main$0((String) obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-5-ä»£ç è¿˜åŸ"><a href="#3-3-5-ä»£ç è¿˜åŸ" class="headerlink" title="3.3.5 ä»£ç è¿˜åŸ"></a>3.3.5 ä»£ç è¿˜åŸ</h3><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºæœ€ç»ˆæ‰§è¡Œä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public class LambdaTest &#123;</span><br><span class="line">    public static void PrintString(String s, Print&lt;String&gt; print) &#123;</span><br><span class="line">        print.print(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        PrintString(&quot;test&quot;, new LambdaTest$$Lambda$1());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void lambda$main$0(String x) &#123;</span><br><span class="line">        System.out.println(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static final class LambdaTest$$Lambda$1 implements Print &#123;</span><br><span class="line">        public void print(Object obj) &#123;</span><br><span class="line">            LambdaTest.lambda$main$0((String) obj);</span><br><span class="line">        &#125;</span><br><span class="line">        private LambdaTest$$Lambda$1() &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@FunctionalInterface</span><br><span class="line">interface Print&lt;T&gt; &#123;</span><br><span class="line">    public void print(T x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h1><ul><li>åœ¨ç±»ç¼–è¯‘æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªç§æœ‰é™æ€æ–¹æ³•+ä¸€ä¸ªå†…éƒ¨ç±»ï¼›</li><li>åœ¨å†…éƒ¨ç±»ä¸­å®ç°äº†å‡½æ•°å¼æ¥å£ï¼Œåœ¨å®ç°æ¥å£çš„æ–¹æ³•ä¸­ï¼Œä¼šè°ƒç”¨ç¼–è¯‘å™¨ç”Ÿæˆçš„é™æ€æ–¹æ³•ï¼›</li><li>åœ¨ä½¿ç”¨lambdaè¡¨è¾¾å¼çš„åœ°æ–¹ï¼Œé€šè¿‡ä¼ é€’å†…éƒ¨ç±»å®ä¾‹ï¼Œæ¥è°ƒç”¨å‡½æ•°å¼æ¥å£æ–¹æ³•ã€‚</li></ul><blockquote><p>å°±æ˜¯ä¼ é€’ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œåœ¨Javaä¸­æå¾—è¿™ä¹ˆå¤æ‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p></blockquote><p>å‚è€ƒèµ„æ–™ï¼š </p><p><a href="https://www.cnblogs.com/WJ5888/p/4667086.html" target="_blank" rel="noopener">https://www.cnblogs.com/WJ5888/p/4667086.html</a> </p><p><a href="https://www.jianshu.com/p/57bffc6e7acd" target="_blank" rel="noopener">https://www.jianshu.com/p/57bffc6e7acd</a> </p><p><a href="http://www.importnew.com/17770.html" target="_blank" rel="noopener">http://www.importnew.com/17770.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Lambda </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java AQS å®ç°åŸç†ï¼ˆå›¾æ–‡ï¼‰åˆ†æ</title>
      <link href="/java-aqs.html"/>
      <url>/java-aqs.html</url>
      
        <content type="html"><![CDATA[<p>AQSï¼šAbstractQueuedSynchronizer</p><h1 id="1ã€AQSè®¾è®¡ç®€ä»‹"><a href="#1ã€AQSè®¾è®¡ç®€ä»‹" class="headerlink" title="1ã€AQSè®¾è®¡ç®€ä»‹"></a>1ã€AQSè®¾è®¡ç®€ä»‹</h1><ul><li>AQSçš„å®ç°æ˜¯åŸºäºä¸€ä¸ªFIFOçš„ç­‰å¾…é˜Ÿåˆ—ã€‚</li><li><font color="DeepPink">ä½¿ç”¨å•ä¸ªåŸå­å˜é‡æ¥è¡¨ç¤ºè·å–ã€é‡Šæ”¾é”çŠ¶æ€ï¼ˆfinal intï¼‰æ”¹å˜è¯¥intå€¼ä½¿ç”¨çš„æ˜¯CASã€‚</font>ï¼ˆæ€è€ƒï¼šä¸ºä»€ä¹ˆä¸€ä¸ªintå€¼å¯ä»¥ä¿è¯å†…å­˜å¯è§æ€§ï¼Ÿï¼‰</li><li><font color="DeepPink">å­ç±»åº”è¯¥å®šä¹‰ä¸€ä¸ªéå…¬å¼€çš„å†…éƒ¨ç±»ç»§æ‰¿AQSï¼Œå¹¶å®ç°å…¶ä¸­æ–¹æ³•ã€‚</font></li><li>AQSæ”¯æŒexclusiveä¸sharedä¸¤ç§æ¨¡å¼ã€‚</li><li>å†…éƒ¨ç±»ConditionObjectç”¨äºæ”¯æŒå­ç±»å®ç°exclusiveæ¨¡å¼</li><li>å­ç±»éœ€è¦é‡å†™ï¼š<ul><li>tryAcquire</li><li>tryRelease</li><li>tryReleaseShared</li><li>isHeldExclusivelyç­‰æ–¹æ³•ï¼Œå¹¶ç¡®ä¿æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li></ul></li></ul><p>è´¯ç©¿å…¨æ–‡çš„å›¾ï¼ˆæ ¸å¿ƒï¼‰ï¼š</p><p><img alt data-src="/images/java-juc-aqs/AQS%E5%9B%BE%E8%A7%A3.png"></p><blockquote><p>æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼šå®šä¹‰ä¸€ä¸ªæ“ä½œä¸­ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤çš„å®ç°å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚</p></blockquote><h1 id="2ã€ç±»ç»“æ„"><a href="#2ã€ç±»ç»“æ„" class="headerlink" title="2ã€ç±»ç»“æ„"></a>2ã€ç±»ç»“æ„</h1><ul><li>ConditionObjectç±»</li><li>Nodeç±»</li><li>Nå¤šæ–¹æ³•</li></ul><p><img alt data-src="/images/java-juc-aqs/AQS%E7%B1%BB%E7%BB%93%E6%9E%84.png"></p><h1 id="3ã€FIFOé˜Ÿåˆ—"><a href="#3ã€FIFOé˜Ÿåˆ—" class="headerlink" title="3ã€FIFOé˜Ÿåˆ—"></a>3ã€FIFOé˜Ÿåˆ—</h1><p>ç­‰å¾…é˜Ÿåˆ—æ˜¯CLHï¼ˆCraig, Landin, and Hagerstenï¼‰é”é˜Ÿåˆ—ã€‚</p><p><strong>é€šè¿‡èŠ‚ç‚¹ä¸­çš„â€œçŠ¶æ€â€å­—æ®µæ¥åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦åº”è¯¥é˜»å¡ã€‚å½“è¯¥èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹é‡Šæ”¾é”çš„æ—¶å€™ï¼Œè¯¥èŠ‚ç‚¹ä¼šè¢«å”¤é†’ã€‚</strong> </p><p><img alt data-src="/images/java-juc-aqs/AQS%E9%98%9F%E5%88%97.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private transient volatile Node head;</span><br><span class="line">private transient volatile Node tail;</span><br><span class="line">//The synchronization state.</span><br><span class="line">//åœ¨äº’æ–¥é”ä¸­å®ƒè¡¨ç¤ºç€çº¿ç¨‹æ˜¯å¦å·²ç»è·å–äº†é”ï¼Œ0æœªè·å–ï¼Œ1å·²ç»è·å–äº†ï¼Œå¤§äº1è¡¨ç¤ºé‡å…¥æ•°ã€‚</span><br><span class="line">private volatile int state;</span><br></pre></td></tr></table></figure><p>AQSç»´æŠ¤äº†ä¸€ä¸ªvolatile int stateï¼ˆä»£è¡¨å…±äº«èµ„æºï¼‰å’Œä¸€ä¸ªFIFOçº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—ï¼ˆå¤šçº¿ç¨‹äº‰ç”¨èµ„æºè¢«é˜»å¡æ—¶ä¼šè¿›å…¥æ­¤é˜Ÿåˆ—ï¼‰ã€‚</p><p>stateçš„è®¿é—®æ–¹å¼æœ‰ä¸‰ç§:</p><ul><li>getState()</li><li>setState()</li><li>compareAndSetState()</li></ul><p>AQSå®šä¹‰ä¸¤ç§èµ„æºå…±äº«æ–¹å¼ï¼šExclusiveï¼ˆç‹¬å ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ReentrantLockï¼‰å’ŒShareï¼ˆå…±äº«ï¼Œå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚Semaphore/CountDownLatchï¼‰ã€‚</p><p>ä¸åŒçš„è‡ªå®šä¹‰åŒæ­¥å™¨äº‰ç”¨å…±äº«èµ„æºçš„æ–¹å¼ä¹Ÿä¸åŒã€‚<font color="DeepPink">è‡ªå®šä¹‰åŒæ­¥å™¨åœ¨å®ç°æ—¶åªéœ€è¦å®ç°å…±äº«èµ„æºstateçš„è·å–ä¸é‡Šæ”¾æ–¹å¼å³å¯</font>ï¼Œè‡³äºå…·ä½“çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—çš„ç»´æŠ¤ï¼ˆå¦‚è·å–èµ„æºå¤±è´¥å…¥é˜Ÿ/å”¤é†’å‡ºé˜Ÿç­‰ï¼‰ï¼ŒAQSå·²ç»åœ¨é¡¶å±‚å®ç°å¥½äº†ã€‚</p><p>è‡ªå®šä¹‰åŒæ­¥å™¨å®ç°æ—¶ä¸»è¦å®ç°ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p><ul><li>isHeldExclusively()ï¼šè¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºã€‚åªæœ‰ç”¨åˆ°conditionæ‰éœ€è¦å»å®ç°å®ƒã€‚</li><li>tryAcquire(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚</li><li>tryRelease(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚</li><li>tryAcquireShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æºã€‚</li><li>tryReleaseShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼Œå¦‚æœé‡Šæ”¾åå…è®¸å”¤é†’åç»­ç­‰å¾…ç»“ç‚¹è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</li></ul><p>ä»¥ReentrantLockä¸ºä¾‹ï¼Œstateåˆå§‹åŒ–ä¸º0ï¼Œè¡¨ç¤ºæœªé”å®šçŠ¶æ€ã€‚Açº¿ç¨‹lock()æ—¶ï¼Œä¼šè°ƒç”¨tryAcquire()ç‹¬å è¯¥é”å¹¶å°†state+1ã€‚æ­¤åï¼Œå…¶ä»–çº¿ç¨‹å†tryAcquire()æ—¶å°±ä¼šå¤±è´¥ï¼Œç›´åˆ°Açº¿ç¨‹unlock()åˆ°state=0ï¼ˆå³é‡Šæ”¾é”ï¼‰ä¸ºæ­¢ï¼Œå…¶å®ƒçº¿ç¨‹æ‰æœ‰æœºä¼šè·å–è¯¥é”ã€‚å½“ç„¶ï¼Œé‡Šæ”¾é”ä¹‹å‰ï¼ŒAçº¿ç¨‹è‡ªå·±æ˜¯å¯ä»¥é‡å¤è·å–æ­¤é”çš„ï¼ˆstateä¼šç´¯åŠ ï¼‰ï¼Œè¿™å°±æ˜¯å¯é‡å…¥çš„æ¦‚å¿µã€‚ä½†è¦æ³¨æ„ï¼Œ<font color="DeepPink">è·å–å¤šå°‘æ¬¡å°±è¦é‡Šæ”¾å¤šä¹ˆæ¬¡ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯stateæ˜¯èƒ½å›åˆ°é›¶æ€çš„ã€‚</font></p><p>å†ä»¥CountDownLatchä»¥ä¾‹ï¼Œä»»åŠ¡åˆ†ä¸ºNä¸ªå­çº¿ç¨‹å»æ‰§è¡Œï¼Œstateä¹Ÿåˆå§‹åŒ–ä¸ºNï¼ˆæ³¨æ„Nè¦ä¸çº¿ç¨‹ä¸ªæ•°ä¸€è‡´ï¼‰ã€‚è¿™Nä¸ªå­çº¿ç¨‹æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®ŒåcountDown()ä¸€æ¬¡ï¼Œstateä¼šCASå‡1ã€‚ç­‰åˆ°æ‰€æœ‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œå(å³state=0)ï¼Œä¼šunpark()ä¸»è°ƒç”¨çº¿ç¨‹ï¼Œç„¶åä¸»è°ƒç”¨çº¿ç¨‹å°±ä¼šä»await()å‡½æ•°è¿”å›ï¼Œç»§ç»­åç»­åŠ¨ä½œã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œè‡ªå®šä¹‰åŒæ­¥å™¨è¦ä¹ˆæ˜¯ç‹¬å æ–¹æ³•ï¼Œè¦ä¹ˆæ˜¯å…±äº«æ–¹å¼ï¼Œä»–ä»¬ä¹Ÿåªéœ€å®ç°ï¼š<br>tryAcquire-tryRelease<br>tryAcquireShared-tryReleaseShared<br>ä¸­çš„ä¸€ç§å³å¯ã€‚</p><p>å½“ç„¶AQSä¹Ÿæ”¯æŒè‡ªå®šä¹‰åŒæ­¥å™¨åŒæ—¶å®ç°ç‹¬å å’Œå…±äº«ä¸¤ç§æ–¹å¼ï¼Œå¦‚ReentrantReadWriteLockã€‚</p><p>ä»¥ä¸‹éƒ¨åˆ†æ¥è‡ªæºç æ³¨é‡Šï¼š</p><p>æ¯æ¬¡è¿›å…¥CLHé˜Ÿåˆ—æ—¶ï¼Œéœ€è¦å¯¹å°¾èŠ‚ç‚¹è¿›å…¥é˜Ÿåˆ—è¿‡ç¨‹ï¼Œæ˜¯ä¸€ä¸ªåŸå­æ€§æ“ä½œã€‚åœ¨å‡ºé˜Ÿåˆ—æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ–°headèŠ‚ç‚¹å³å¯ã€‚åœ¨èŠ‚ç‚¹ç¡®å®šå®ƒçš„åç»§èŠ‚ç‚¹æ—¶ï¼Œ éœ€è¦èŠ±ä¸€äº›åŠŸå¤«ï¼Œç”¨äºå¤„ç†é‚£äº›ï¼Œç”±äºç­‰å¾…è¶…æ—¶æ—¶é—´ç»“æŸæˆ–ä¸­æ–­ç­‰åŸå› ï¼Œ è€Œå–æ¶ˆç­‰å¾…é”çš„çº¿ç¨‹ã€‚</p><p>èŠ‚ç‚¹çš„å‰é©±æŒ‡é’ˆï¼Œä¸»è¦ç”¨äºå¤„ç†ï¼Œå–æ¶ˆç­‰å¾…é”çš„çº¿ç¨‹ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å–æ¶ˆç­‰å¾…é”ï¼Œåˆ™æ­¤èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹çš„åç»§æŒ‡é’ˆï¼Œè¦æŒ‡å‘ï¼Œæ­¤èŠ‚ç‚¹åç»§èŠ‚ç‚¹ä¸­ï¼Œéå–æ¶ˆç­‰å¾…é”çš„çº¿ç¨‹ï¼ˆæœ‰æ•ˆç­‰å¾…é”çš„çº¿ç¨‹èŠ‚ç‚¹ï¼‰ã€‚</p><p>æˆ‘ä»¬ç”¨nextæŒ‡é’ˆè¿æ¥å®ç°é˜»å¡æœºåˆ¶ã€‚æ¯ä¸ªèŠ‚ç‚¹å‡æŒæœ‰è‡ªå·±çº¿ç¨‹ï¼ŒèŠ‚ç‚¹é€šè¿‡èŠ‚ç‚¹çš„åç»§è¿æ¥å”¤é†’å…¶åç»§èŠ‚ç‚¹ã€‚</p><p>CLHé˜Ÿåˆ—éœ€è¦ä¸€ä¸ªå‚€å„¡ç»“ç‚¹ä½œä¸ºå¼€å§‹èŠ‚ç‚¹ã€‚æˆ‘ä»¬ä¸ä¼šå†æ„é€ å‡½æ•°ä¸­åˆ›å»ºå®ƒï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰çº¿ç¨‹ç«äº‰é”ï¼Œé‚£ä¹ˆï¼ŒåŠªåŠ›å°±ç™½è´¹äº†ã€‚å–è€Œä»£ä¹‹çš„æ–¹æ¡ˆæ˜¯ï¼Œå½“æœ‰ç¬¬ä¸€ä¸ªç«äº‰è€…æ—¶ï¼Œæˆ‘ä»¬æ‰æ„é€ å¤´æŒ‡é’ˆå’Œå°¾æŒ‡é’ˆã€‚</p><p>çº¿ç¨‹é€šè¿‡åŒä¸€èŠ‚ç‚¹ç­‰å¾…æ¡ä»¶ï¼Œä½†æ˜¯ç”¨å¦å¤–ä¸€ä¸ªè¿æ¥ã€‚æ¡ä»¶åªéœ€è¦æ”¾åœ¨ä¸€ä¸ªéå¹¶å‘çš„è¿æ¥é˜Ÿåˆ—ä¸èŠ‚ç‚¹å…³è”ï¼Œå› ä¸ºåªæœ‰å½“çº¿ç¨‹ç‹¬å æŒæœ‰é”çš„æ—¶å€™ï¼Œæ‰ä¼šå»è®¿é—®æ¡ä»¶ã€‚å½“ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…æ¡ä»¶çš„æ—¶å€™ï¼ŒèŠ‚ç‚¹å°†ä¼šæ’å…¥åˆ°æ¡ä»¶é˜Ÿåˆ—ä¸­ã€‚å½“æ¡ä»¶è§¦å‘æ—¶ï¼ŒèŠ‚ç‚¹å°†ä¼šè½¬ç§»åˆ°ä¸»é˜Ÿåˆ—ä¸­ã€‚ç”¨ä¸€ä¸ªçŠ¶æ€å€¼ï¼Œæè¿°èŠ‚ç‚¹åœ¨å“ªä¸€ä¸ªé˜Ÿåˆ—ä¸Šã€‚</p><h1 id="4ã€Node"><a href="#4ã€Node" class="headerlink" title="4ã€Node"></a>4ã€Node</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">static final class Node &#123;</span><br><span class="line">    //è¯¥ç­‰å¾…èŠ‚ç‚¹å¤„äºå…±äº«æ¨¡å¼</span><br><span class="line">    static final Node SHARED = new Node();</span><br><span class="line">    //è¯¥ç­‰å¾…èŠ‚ç‚¹å¤„äºç‹¬å æ¨¡å¼</span><br><span class="line">    static final Node EXCLUSIVE = null;</span><br><span class="line">    </span><br><span class="line">    //è¡¨ç¤ºèŠ‚ç‚¹çš„çº¿ç¨‹æ˜¯å·²è¢«å–æ¶ˆçš„</span><br><span class="line">    static final int CANCELLED =  1;</span><br><span class="line">    //è¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹çš„çº¿ç¨‹éœ€è¦è¢«å”¤é†’</span><br><span class="line">    static final int SIGNAL    = -1;</span><br><span class="line">    //è¡¨ç¤ºçº¿ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸ªæ¡ä»¶</span><br><span class="line">    static final int CONDITION = -2;</span><br><span class="line">    //è¡¨ç¤ºä¸‹ä¸€ä¸ªå…±äº«æ¨¡å¼çš„èŠ‚ç‚¹åº”è¯¥æ— æ¡ä»¶çš„ä¼ æ’­ä¸‹å»</span><br><span class="line">    static final int PROPAGATE = -3;</span><br><span class="line"></span><br><span class="line">    //çŠ¶æ€ä½ ï¼Œåˆ†åˆ«å¯ä»¥ä½¿CANCELLEDã€SINGNALã€CONDITIONã€PROPAGATEã€0 </span><br><span class="line">    volatile int waitStatus;</span><br><span class="line"></span><br><span class="line">    volatile Node prev;//å‰é©±èŠ‚ç‚¹</span><br><span class="line">    volatile Node next;//åç»§èŠ‚ç‚¹</span><br><span class="line">    volatile Thread thread;//ç­‰å¾…é”çš„çº¿ç¨‹</span><br><span class="line"></span><br><span class="line">    //ConditionObjecté“¾è¡¨çš„åç»§èŠ‚ç‚¹æˆ–è€…ä»£è¡¨å…±äº«æ¨¡å¼çš„èŠ‚ç‚¹ã€‚</span><br><span class="line">    //å› ä¸ºConditioné˜Ÿåˆ—åªèƒ½åœ¨ç‹¬å æ¨¡å¼ä¸‹è¢«èƒ½è¢«è®¿é—®,æˆ‘ä»¬åªéœ€è¦ç®€å•çš„ä½¿ç”¨é“¾è¡¨é˜Ÿåˆ—æ¥é“¾æ¥æ­£åœ¨ç­‰å¾…æ¡ä»¶çš„èŠ‚ç‚¹ã€‚</span><br><span class="line">    //ç„¶åå®ƒä»¬ä¼šè¢«è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ï¼ˆAQSé˜Ÿåˆ—ï¼‰å†æ¬¡é‡æ–°è·å–ã€‚</span><br><span class="line">    //ç”±äºæ¡ä»¶é˜Ÿåˆ—åªèƒ½åœ¨ç‹¬å æ¨¡å¼ä¸‹ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è¡¨ç¤ºå…±äº«æ¨¡å¼çš„èŠ‚ç‚¹çš„è¯åªè¦ä½¿ç”¨ç‰¹æ®Šå€¼SHAREDæ¥æ ‡æ˜å³å¯ã€‚</span><br><span class="line">    Node nextWaiter;</span><br><span class="line">    //Returns true if node is waiting in shared mode</span><br><span class="line">    final boolean isShared() &#123;</span><br><span class="line">            return nextWaiter == SHARED;</span><br><span class="line">    &#125;</span><br><span class="line">    .......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>waitStatusä¸åŒå€¼å«ä¹‰ï¼š</p><ul><li>SIGNAL(-1)ï¼šå½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹å·²ç» (æˆ–å³å°†)è¢«é˜»å¡ï¼ˆé€šè¿‡parkï¼‰ , æ‰€ä»¥å½“å½“å‰èŠ‚ç‚¹é‡Šæ”¾æˆ–åˆ™è¢«å–æ¶ˆæ—¶å€™ï¼Œä¸€å®šè¦unparkå®ƒçš„åç»§èŠ‚ç‚¹ã€‚ä¸ºäº†é¿å…ç«äº‰ï¼Œè·å–æ–¹æ³•ä¸€å®šè¦é¦–å…ˆè®¾ç½®nodeä¸ºsignalï¼Œç„¶åå†æ¬¡é‡æ–°è°ƒç”¨è·å–æ–¹æ³•ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™é˜»å¡ã€‚</li><li>CANCELLED(1)ï¼šå½“å‰èŠ‚ç‚¹ç”±äºè¶…æ—¶æˆ–è€…è¢«ä¸­æ–­è€Œè¢«å–æ¶ˆã€‚ä¸€æ—¦èŠ‚ç‚¹è¢«å–æ¶ˆåï¼Œé‚£ä¹ˆå®ƒçš„çŠ¶æ€å€¼ä¸åœ¨ä¼šè¢«æ”¹å˜ï¼Œä¸”å½“å‰èŠ‚ç‚¹çš„çº¿ç¨‹ä¸ä¼šå†æ¬¡è¢«é˜»å¡ã€‚</li><li>CONDITION(-2) ï¼šè¯¥èŠ‚ç‚¹çš„çº¿ç¨‹å¤„äºç­‰å¾…æ¡ä»¶çŠ¶æ€,ä¸ä¼šè¢«å½“ä½œæ˜¯åŒæ­¥é˜Ÿåˆ—ä¸Šçš„èŠ‚ç‚¹,ç›´åˆ°è¢«å”¤é†’(signal),è®¾ç½®å…¶å€¼ä¸º0,é‡æ–°è¿›å…¥é˜»å¡çŠ¶æ€.</li><li>PROPAGATE(-3ï¼š)å…±äº«æ¨¡å¼ä¸‹çš„é‡Šæ”¾æ“ä½œåº”è¯¥è¢«ä¼ æ’­åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚è¯¥çŠ¶æ€å€¼åœ¨doReleaseSharedæ–¹æ³•ä¸­è¢«è®¾ç½®çš„ã€‚</li><li>0ï¼šä»¥ä¸Šéƒ½ä¸æ˜¯</li></ul><p>è¯¥çŠ¶æ€å€¼ä¸ºäº†ç®€ä¾¿ä½¿ç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨äº†æ•°å€¼ç±»å‹ã€‚éè´Ÿæ•°å€¼æ„å‘³ç€è¯¥èŠ‚ç‚¹ä¸éœ€è¦è¢«å”¤é†’ã€‚æ‰€ä»¥ï¼Œå¤§å¤šæ•°ä»£ç ä¸­ä¸éœ€è¦æ£€æŸ¥è¯¥çŠ¶æ€å€¼çš„ç¡®å®šå€¼ã€‚</p><p>ä¸€ä¸ªæ­£å¸¸çš„Nodeï¼Œå®ƒçš„waitStatusåˆå§‹åŒ–å€¼æ˜¯0ã€‚å¦‚æœæƒ³è¦ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨AQSæä¾›CASè¿›è¡Œä¿®æ”¹ã€‚</p><h1 id="5ã€ç‹¬å æ¨¡å¼ä¸å…±äº«æ¨¡å¼"><a href="#5ã€ç‹¬å æ¨¡å¼ä¸å…±äº«æ¨¡å¼" class="headerlink" title="5ã€ç‹¬å æ¨¡å¼ä¸å…±äº«æ¨¡å¼"></a>5ã€ç‹¬å æ¨¡å¼ä¸å…±äº«æ¨¡å¼</h1><p>åœ¨é”çš„è·å–æ—¶ï¼Œå¹¶ä¸ä¸€å®šåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½æŒæœ‰è¿™ä¸ªé”ï¼ˆæˆ–è€…ç§°ä¸ºåŒæ­¥çŠ¶æ€ï¼‰ï¼Œæ‰€ä»¥æ­¤æ—¶æœ‰äº†ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼çš„åŒºåˆ«ï¼Œä¹Ÿå°±æ˜¯åœ¨NodeèŠ‚ç‚¹ä¸­ç”±nextWaiteræ¥æ ‡è¯†ã€‚æ¯”å¦‚ReentrantLockå°±æ˜¯ä¸€ä¸ªç‹¬å é”ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å¾—é”ï¼Œè€ŒWriteAndReadLockçš„è¯»é”åˆ™èƒ½ç”±å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–ï¼Œä½†å®ƒçš„å†™é”åˆ™åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚</p><h2 id="5-1ã€ç‹¬å æ¨¡å¼"><a href="#5-1ã€ç‹¬å æ¨¡å¼" class="headerlink" title="5.1ã€ç‹¬å æ¨¡å¼"></a>5.1ã€ç‹¬å æ¨¡å¼</h2><h3 id="5-1-1-ç‹¬å æ¨¡å¼åŒæ­¥çŠ¶æ€çš„è·å–"><a href="#5-1-1-ç‹¬å æ¨¡å¼åŒæ­¥çŠ¶æ€çš„è·å–" class="headerlink" title="5.1.1 ç‹¬å æ¨¡å¼åŒæ­¥çŠ¶æ€çš„è·å–"></a>5.1.1 ç‹¬å æ¨¡å¼åŒæ­¥çŠ¶æ€çš„è·å–</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//å¿½ç•¥ä¸­æ–­çš„ï¼ˆå³ä¸æ‰‹åŠ¨æŠ›å‡ºInterruptedExceptionå¼‚å¸¸ï¼‰ç‹¬å æ¨¡å¼ä¸‹çš„è·å–æ–¹æ³•ã€‚</span><br><span class="line">//è¯¥æ–¹æ³•åœ¨æˆåŠŸè¿”å›å‰è‡³å°‘ä¼šè°ƒç”¨ä¸€æ¬¡tryAcquire()æ–¹æ³•(è¯¥æ–¹æ³•æ˜¯å­ç±»é‡å†™çš„æ–¹æ³•ï¼Œå¦‚æœè¿”å›trueåˆ™ä»£è¡¨èƒ½æˆåŠŸè·å–).</span><br><span class="line">//å¦åˆ™å½“å‰çº¿ç¨‹ä¼šè¿›å…¥é˜Ÿåˆ—æ’é˜Ÿï¼Œé‡å¤çš„é˜»å¡å’Œå”¤é†’ç­‰å¾…å†æ¬¡æˆåŠŸè·å–åè¿”å›, </span><br><span class="line">//è¯¥æ–¹æ³•å¯ä»¥ç”¨æ¥å®ç°Lock.lock</span><br><span class="line">public final void acquire(int arg) &#123;</span><br><span class="line">       if (!tryAcquire(arg) &amp;&amp;</span><br><span class="line">            acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">            selfInterrupt();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•é¦–å…ˆå°è¯•è·å–é”( tryAcquire(arg)çš„å…·ä½“å®ç°å®šä¹‰åœ¨äº†å­ç±»ä¸­),å¦‚æœè·å–åˆ°,åˆ™æ‰§è¡Œå®Œæ¯•,å¦åˆ™é€šè¿‡addWaiter(Node.EXCLUSIVE), arg)æ–¹æ³•æŠŠå½“å‰èŠ‚ç‚¹æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—æœ«å°¾,å¹¶è®¾ç½®ä¸ºç‹¬å æ¨¡å¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">private Node addWaiter(Node mode) &#123;</span><br><span class="line">        //æŠŠå½“å‰çº¿ç¨‹åŒ…è£…ä¸ºnode,è®¾ä¸ºç‹¬å æ¨¡å¼</span><br><span class="line">        Node node = new Node(Thread.currentThread(), mode);</span><br><span class="line">        // å°è¯•å¿«é€Ÿå…¥é˜Ÿï¼Œå³æ— ç«äº‰æ¡ä»¶ä¸‹è‚¯å®šæˆåŠŸã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™è¿›å…¥enqè‡ªæ—‹é‡è¯•å…¥é˜Ÿ</span><br><span class="line">        Node pred = tail;</span><br><span class="line">        if (pred != null) &#123;</span><br><span class="line">            node.prev = pred;</span><br><span class="line">            //CASæ›¿æ¢å½“å‰å°¾éƒ¨ã€‚æˆåŠŸåˆ™è¿”å›</span><br><span class="line">            if (compareAndSetTail(pred, node)) &#123;</span><br><span class="line">                pred.next = node;</span><br><span class="line">                return node;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        enq(node);</span><br><span class="line">        return node;</span><br><span class="line">    &#125;</span><br><span class="line">//æ’å…¥èŠ‚ç‚¹åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœé˜Ÿåˆ—æœªåˆå§‹åŒ–åˆ™åˆå§‹åŒ–ï¼Œç„¶åå†æ’å…¥ã€‚</span><br><span class="line">private Node enq(final Node node) &#123;</span><br><span class="line">        for (;;) &#123;</span><br><span class="line">            Node t = tail;</span><br><span class="line">            if (t == null) &#123; // Must initialize</span><br><span class="line">                if (compareAndSetHead(new Node()))</span><br><span class="line">                    tail = head;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                node.prev = t;</span><br><span class="line">                if (compareAndSetTail(t, node)) &#123;</span><br><span class="line">                    t.next = node;</span><br><span class="line">                    return t;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœtailèŠ‚ç‚¹ä¸ºç©º,æ‰§è¡Œenq(node);é‡æ–°å°è¯•,æœ€ç»ˆæŠŠnodeæ’å…¥.åœ¨æŠŠnodeæ’å…¥é˜Ÿåˆ—æœ«å°¾å,å®ƒå¹¶ä¸ç«‹å³æŒ‚èµ·è¯¥èŠ‚ç‚¹ä¸­çº¿ç¨‹,å› ä¸ºåœ¨æ’å…¥å®ƒçš„è¿‡ç¨‹ä¸­,å‰é¢çš„çº¿ç¨‹å¯èƒ½å·²ç»æ‰§è¡Œå®Œæˆ,æ‰€ä»¥å®ƒä¼šå…ˆè¿›è¡Œè‡ªæ—‹æ“ä½œacquireQueued(node, arg),å°è¯•è®©è¯¥çº¿ç¨‹é‡æ–°è·å–é”!å½“æ¡ä»¶æ»¡è¶³è·å–åˆ°äº†é”åˆ™å¯ä»¥ä»è‡ªæ—‹è¿‡ç¨‹ä¸­é€€å‡ºï¼Œå¦åˆ™ç»§ç»­ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">final boolean acquireQueued(final Node node, int arg) &#123;</span><br><span class="line">        boolean failed = true;</span><br><span class="line">        try &#123;</span><br><span class="line">            boolean interrupted = false;</span><br><span class="line">            for (;;) &#123;</span><br><span class="line">                final Node p = node.predecessor();</span><br><span class="line">                //å¦‚æœå®ƒçš„å‰ç»§èŠ‚ç‚¹ä¸ºå¤´ç»“ç‚¹,å°è¯•è·å–é”,è·å–æˆåŠŸåˆ™è¿”å›           </span><br><span class="line">                if (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class="line">                    setHead(node);</span><br><span class="line">                    p.next = null; // help GC</span><br><span class="line">                    failed = false;</span><br><span class="line">                    return interrupted;</span><br><span class="line">                &#125;</span><br><span class="line">                //åˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„çº¿ç¨‹æ˜¯å¦åº”è¯¥è¢«æŒ‚èµ·ï¼Œå¦‚æœåº”è¯¥è¢«æŒ‚èµ·åˆ™æŒ‚èµ·ã€‚</span><br><span class="line">                //ç­‰å¾…releaseå”¤é†’é‡Šæ”¾</span><br><span class="line">                if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                    parkAndCheckInterrupt())</span><br><span class="line">                    interrupted = true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (failed)</span><br><span class="line">                //åœ¨é˜Ÿåˆ—ä¸­å–æ¶ˆå½“å‰èŠ‚ç‚¹</span><br><span class="line">                cancelAcquire(node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡è·å–åˆ°é”,åˆ™åˆ¤æ–­æ˜¯å¦åº”è¯¥æŒ‚èµ·,è€Œè¿™ä¸ªåˆ¤æ–­åˆ™å¾—é€šè¿‡å®ƒçš„å‰é©±èŠ‚ç‚¹çš„waitStatusæ¥ç¡®å®š:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) &#123;</span><br><span class="line">        int ws = pred.waitStatus;</span><br><span class="line">        //è¯¥èŠ‚ç‚¹å¦‚æœçŠ¶æ€å¦‚æœä¸ºSIGNALã€‚åˆ™è¿”å›trueï¼Œç„¶åparkæŒ‚èµ·çº¿ç¨‹</span><br><span class="line">        if (ws == Node.SIGNAL)</span><br><span class="line">            return true;</span><br><span class="line">       //è¡¨æ˜è¯¥èŠ‚ç‚¹å·²ç»è¢«å–æ¶ˆï¼Œå‘å‰å¾ªç¯é‡æ–°è°ƒæ•´é“¾è¡¨èŠ‚ç‚¹</span><br><span class="line">        if (ws &gt; 0) &#123;</span><br><span class="line">            /*</span><br><span class="line">             * Predecessor was cancelled. Skip over predecessors and</span><br><span class="line">             * indicate retry.</span><br><span class="line">             */</span><br><span class="line">            do &#123;</span><br><span class="line">                node.prev = pred = pred.prev;</span><br><span class="line">            &#125; while (pred.waitStatus &gt; 0);</span><br><span class="line">            pred.next = node;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            //æ‰§è¡Œåˆ°è¿™é‡Œä»£è¡¨èŠ‚ç‚¹æ˜¯0æˆ–è€…PROPAGATEï¼Œç„¶åæ ‡è®°ä»–ä»¬ä¸ºSIGNALï¼Œä½†æ˜¯</span><br><span class="line">            //è¿˜ä¸èƒ½parkæŒ‚èµ·çº¿ç¨‹ã€‚éœ€è¦é‡è¯•æ˜¯å¦èƒ½è·å–ï¼Œå¦‚æœä¸èƒ½ï¼Œåˆ™æŒ‚èµ·ã€‚</span><br><span class="line">            compareAndSetWaitStatus(pred, ws, Node.SIGNAL);</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">//æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œä¸”è¿”å›çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€</span><br><span class="line">private final boolean parkAndCheckInterrupt() &#123;</span><br><span class="line">        LockSupport.park(this);</span><br><span class="line">        return Thread.interrupted();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æœ€å,æˆ‘ä»¬å¯¹è·å–ç‹¬å å¼é”è¿‡ç¨‹å¯¹åšä¸ªæ€»ç»“:</p><p>AQSçš„æ¨¡æ¿æ–¹æ³•acquireé€šè¿‡è°ƒç”¨å­ç±»è‡ªå®šä¹‰å®ç°çš„tryAcquireè·å–åŒæ­¥çŠ¶æ€å¤±è´¥å-&gt;å°†çº¿ç¨‹æ„é€ æˆNodeèŠ‚ç‚¹(addWaiter)-&gt;å°†NodeèŠ‚ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—å¯¹å°¾(addWaiter)-&gt;èŠ‚ç‚¹ä»¥è‡ªæ—‹çš„æ–¹æ³•è·å–åŒæ­¥çŠ¶æ€(acquirQueued)ã€‚åœ¨èŠ‚ç‚¹è‡ªæ—‹è·å–åŒæ­¥çŠ¶æ€æ—¶ï¼Œåªæœ‰å…¶å‰é©±èŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹çš„æ—¶å€™æ‰ä¼šå°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹çš„å‰é©±ä¸æ˜¯å¤´èŠ‚ç‚¹æˆ–è€…è¯¥èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹å•è·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼Œåˆ™åˆ¤æ–­å½“å‰çº¿ç¨‹éœ€è¦é˜»å¡ï¼Œå¦‚æœéœ€è¦é˜»å¡åˆ™éœ€è¦è¢«å”¤é†’è¿‡åæ‰è¿”å›ã€‚</p><p><font color="DeepPink">è·å–é”çš„è¿‡ç¨‹ï¼š</font></p><ul><li><font color="DeepPink">å½“çº¿ç¨‹è°ƒç”¨acquire()ç”³è¯·è·å–é”èµ„æºï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è¿›å…¥ä¸´ç•ŒåŒºã€‚</font></li><li><font color="DeepPink">å½“è·å–é”å¤±è´¥æ—¶ï¼Œåˆ™è¿›å…¥ä¸€ä¸ªFIFOç­‰å¾…é˜Ÿåˆ—ï¼Œç„¶åè¢«æŒ‚èµ·ç­‰å¾…å”¤é†’ã€‚</font></li><li><font color="DeepPink">å½“é˜Ÿåˆ—ä¸­çš„ç­‰å¾…çº¿ç¨‹è¢«å”¤é†’ä»¥åå°±é‡æ–°å°è¯•è·å–é”èµ„æºï¼Œå¦‚æœæˆåŠŸåˆ™è¿›å…¥ä¸´ç•ŒåŒºï¼Œå¦åˆ™ç»§ç»­æŒ‚èµ·ç­‰å¾…ã€‚</font></li></ul><h3 id="5-1-2-ç‹¬å æ¨¡å¼åŒæ­¥çŠ¶æ€çš„é‡Šæ”¾"><a href="#5-1-2-ç‹¬å æ¨¡å¼åŒæ­¥çŠ¶æ€çš„é‡Šæ”¾" class="headerlink" title="5.1.2 ç‹¬å æ¨¡å¼åŒæ­¥çŠ¶æ€çš„é‡Šæ”¾"></a>5.1.2 ç‹¬å æ¨¡å¼åŒæ­¥çŠ¶æ€çš„é‡Šæ”¾</h3><p>æ—¢ç„¶æ˜¯é‡Šæ”¾,é‚£è‚¯å®šæ˜¯æŒæœ‰é”çš„è¯¥çº¿ç¨‹æ‰§è¡Œé‡Šæ”¾æ“ä½œ,å³headèŠ‚ç‚¹ä¸­çš„çº¿ç¨‹é‡Šæ”¾é”.</p><p>AQSä¸­çš„releaseé‡Šæ”¾åŒæ­¥çŠ¶æ€å’Œacquireè·å–åŒæ­¥çŠ¶æ€ä¸€æ ·ï¼Œéƒ½æ˜¯æ¨¡æ¿æ–¹æ³•ï¼ŒtryReleaseé‡Šæ”¾çš„å…·ä½“æ“ä½œéƒ½æœ‰å­ç±»å»å®ç°ï¼Œçˆ¶ç±»AQSåªæä¾›ä¸€ä¸ªç®—æ³•éª¨æ¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public final boolean release(int arg) &#123;</span><br><span class="line">    if (tryRelease(arg)) &#123;</span><br><span class="line">        Node h = head;</span><br><span class="line">        if (h != null &amp;&amp; h.waitStatus != 0)</span><br><span class="line">            unparkSuccessor(h);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line">//å¦‚æœnodeçš„åç»§èŠ‚ç‚¹ä¸ä¸ºç©ºä¸”ä¸æ˜¯ä½œåºŸçŠ¶æ€,åˆ™å”¤é†’è¿™ä¸ªåç»§èŠ‚ç‚¹,</span><br><span class="line">//å¦åˆ™ä»æœ«å°¾å¼€å§‹å¯»æ‰¾åˆé€‚çš„èŠ‚ç‚¹,å¦‚æœæ‰¾åˆ°,åˆ™å”¤é†’</span><br><span class="line">private void unparkSuccessor(Node node) &#123;</span><br><span class="line">        int ws = node.waitStatus;</span><br><span class="line">        if (ws &lt; 0)</span><br><span class="line">            compareAndSetWaitStatus(node, ws, 0);</span><br><span class="line">        Node s = node.next;</span><br><span class="line">        if (s == null || s.waitStatus &gt; 0) &#123;</span><br><span class="line">            s = null;</span><br><span class="line">            for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev)</span><br><span class="line">                if (t.waitStatus &lt;= 0)</span><br><span class="line">                    s = t;</span><br><span class="line">        &#125;</span><br><span class="line">        if (s != null)</span><br><span class="line">            LockSupport.unpark(s.thread);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿‡ç¨‹ï¼šé¦–å…ˆè°ƒç”¨å­ç±»çš„tryRelease()æ–¹æ³•é‡Šæ”¾é”ï¼Œç„¶åå”¤é†’åç»§èŠ‚ç‚¹ï¼Œåœ¨å”¤é†’çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦åˆ¤æ–­åç»§èŠ‚ç‚¹æ˜¯å¦æ»¡è¶³æƒ…å†µï¼Œå¦‚æœåç»§èŠ‚ç‚¹ä¸ä¸ºç©ºä¸”ä¸æ˜¯ä½œåºŸçŠ¶æ€ï¼Œåˆ™å”¤é†’è¿™ä¸ªåç»§èŠ‚ç‚¹ï¼Œå¦åˆ™ä»tailèŠ‚ç‚¹å‘å‰å¯»æ‰¾åˆé€‚çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™å”¤é†’ã€‚</p><p><font color="DeepPink">é‡Šæ”¾é”è¿‡ç¨‹ï¼š</font></p><ul><li><font color="DeepPink">å½“çº¿ç¨‹è°ƒç”¨release()è¿›è¡Œé”èµ„æºé‡Šæ”¾æ—¶ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨ç­‰å¾…é”èµ„æºï¼Œåˆ™é‡Šæ”¾å®Œæˆã€‚</font></li><li><font color="DeepPink">å¦‚æœé˜Ÿåˆ—ä¸­æœ‰å…¶ä»–ç­‰å¾…é”èµ„æºçš„çº¿ç¨‹éœ€è¦å”¤é†’ï¼Œåˆ™å”¤é†’é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªç­‰å¾…èŠ‚ç‚¹ï¼ˆå…ˆå…¥å…ˆå‡ºï¼‰ã€‚</font></li></ul><h2 id="5-2ã€å…±äº«æ¨¡å¼"><a href="#5-2ã€å…±äº«æ¨¡å¼" class="headerlink" title="5.2ã€å…±äº«æ¨¡å¼"></a>5.2ã€å…±äº«æ¨¡å¼</h2><h3 id="5-2-1-å…±äº«æ¨¡å¼åŒæ­¥çŠ¶æ€çš„è·å–"><a href="#5-2-1-å…±äº«æ¨¡å¼åŒæ­¥çŠ¶æ€çš„è·å–" class="headerlink" title="5.2.1 å…±äº«æ¨¡å¼åŒæ­¥çŠ¶æ€çš„è·å–"></a>5.2.1 å…±äº«æ¨¡å¼åŒæ­¥çŠ¶æ€çš„è·å–</h3><ul><li><font color="DeepPink">å½“çº¿ç¨‹è°ƒç”¨acquireShared()ç”³è¯·è·å–é”èµ„æºæ—¶ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è¿›å…¥ä¸´ç•ŒåŒºã€‚</font></li><li><font color="DeepPink">å½“è·å–é”å¤±è´¥æ—¶ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªå…±äº«ç±»å‹çš„èŠ‚ç‚¹å¹¶è¿›å…¥ä¸€ä¸ªFIFOç­‰å¾…é˜Ÿåˆ—ï¼Œç„¶åè¢«æŒ‚èµ·ç­‰å¾…å”¤é†’ã€‚</font></li><li><font color="DeepPink">å½“é˜Ÿåˆ—ä¸­çš„ç­‰å¾…çº¿ç¨‹è¢«å”¤é†’ä»¥åå°±é‡æ–°å°è¯•è·å–é”èµ„æºï¼Œå¦‚æœæˆåŠŸåˆ™å”¤é†’åé¢è¿˜åœ¨ç­‰å¾…çš„å…±äº«èŠ‚ç‚¹å¹¶æŠŠè¯¥å”¤é†’äº‹ä»¶ä¼ é€’ä¸‹å»ï¼Œå³ä¼šä¾æ¬¡å”¤é†’åœ¨è¯¥èŠ‚ç‚¹åé¢çš„æ‰€æœ‰å…±äº«èŠ‚ç‚¹ï¼Œç„¶åè¿›å…¥ä¸´ç•ŒåŒºï¼Œå¦åˆ™ç»§ç»­æŒ‚èµ·ç­‰å¾…ã€‚</font></li></ul><h3 id="5-2-2-å…±äº«æ¨¡å¼åŒæ­¥çŠ¶æ€çš„é‡Šæ”¾"><a href="#5-2-2-å…±äº«æ¨¡å¼åŒæ­¥çŠ¶æ€çš„é‡Šæ”¾" class="headerlink" title="5.2.2 å…±äº«æ¨¡å¼åŒæ­¥çŠ¶æ€çš„é‡Šæ”¾"></a>5.2.2 å…±äº«æ¨¡å¼åŒæ­¥çŠ¶æ€çš„é‡Šæ”¾</h3><ul><li><font color="DeepPink">å½“çº¿ç¨‹è°ƒç”¨releaseShared()è¿›è¡Œé”èµ„æºé‡Šæ”¾æ—¶ï¼Œå¦‚æœé‡Šæ”¾æˆåŠŸï¼Œåˆ™å”¤é†’é˜Ÿåˆ—ä¸­ç­‰å¾…çš„èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰çš„è¯ã€‚</font></li></ul><h1 id="6-AQSå°ç»“"><a href="#6-AQSå°ç»“" class="headerlink" title="6. AQSå°ç»“"></a>6. AQSå°ç»“</h1><p>java.util.concurrentä¸­çš„å¾ˆå¤šå¯é˜»å¡ç±»ï¼ˆæ¯”å¦‚ReentrantLockï¼‰éƒ½æ˜¯åŸºäºAQSæ¥å®ç°çš„ã€‚<font color="DeepPink">AQSæ˜¯ä¸€ä¸ªåŒæ­¥æ¡†æ¶ï¼Œå®ƒæä¾›é€šç”¨æœºåˆ¶æ¥åŸå­æ€§ç®¡ç†åŒæ­¥çŠ¶æ€ã€é˜»å¡å’Œå”¤é†’çº¿ç¨‹ï¼Œä»¥åŠç»´æŠ¤è¢«é˜»å¡çº¿ç¨‹çš„é˜Ÿåˆ—ã€‚</font></p><p>JDKä¸­AQSè¢«å¹¿æ³›ä½¿ç”¨ï¼ŒåŸºäºAQSå®ç°çš„åŒæ­¥å™¨åŒ…æ‹¬ï¼š</p><ul><li>ReentrantLock</li><li>Semaphore</li><li>ReentrantReadWriteLockï¼ˆåç»­ä¼šå‡ºæ–‡ç« è®²è§£ï¼‰</li><li>CountDownLatch</li><li>FutureTask</li></ul><p>æ¯ä¸€ä¸ªåŸºäºAQSå®ç°çš„åŒæ­¥å™¨éƒ½ä¼šåŒ…å«ä¸¤ç§ç±»å‹çš„æ“ä½œï¼Œå¦‚ä¸‹ï¼š</p><ul><li>è‡³å°‘ä¸€ä¸ªacquireæ“ä½œã€‚è¿™ä¸ªæ“ä½œé˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œé™¤é/ç›´åˆ°AQSçš„çŠ¶æ€å…è®¸è¿™ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚</li><li>è‡³å°‘ä¸€ä¸ªreleaseæ“ä½œã€‚è¿™ä¸ªæ“ä½œæ”¹å˜AQSçš„çŠ¶æ€ï¼Œæ”¹å˜åçš„çŠ¶æ€å¯å…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªé˜»å¡çº¿ç¨‹è¢«è§£é™¤é˜»å¡ã€‚</li></ul><p><font color="DeepPink">åŸºäºâ€œå¤åˆä¼˜å…ˆäºç»§æ‰¿â€çš„åŸåˆ™ï¼ŒåŸºäºAQSå®ç°çš„åŒæ­¥å™¨ä¸€èˆ¬éƒ½æ˜¯ï¼šå£°æ˜ä¸€ä¸ªå†…éƒ¨ç§æœ‰çš„ç»§æ‰¿äºAQSçš„å­ç±»Syncï¼Œå¯¹åŒæ­¥å™¨æ‰€æœ‰å…¬æœ‰æ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šå§”æ‰˜ç»™è¿™ä¸ªå†…éƒ¨å­ç±»ã€‚</font></p><h1 id="7-åç»­"><a href="#7-åç»­" class="headerlink" title="7.åç»­"></a>7.åç»­</h1><p>åé¢ä¼šæ¨å‡ºä»¥ä¸‹æœ‰å…³AQSçš„æ–‡ç« ï¼Œå·²åŠ æ·±å¯¹äºAQSçš„ç†è§£</p><ul><li>AQS ConditionObjectå¯¹è±¡è§£æ</li><li>AQS åº”ç”¨æ¡ˆä¾‹ ReentrantReadWriteLockè§£æ</li><li>Java volatileçš„å†…å­˜è¯­ä¹‰ä¸AQSé”å†…å­˜å¯è§æ€§</li></ul><h1 id="8-æ„Ÿè°¢"><a href="#8-æ„Ÿè°¢" class="headerlink" title="8.æ„Ÿè°¢"></a>8.æ„Ÿè°¢</h1><p>æœ¬æ–‡å¾ˆå¤šå†…å®¹æ•´ç†è‡ªç½‘ç»œï¼Œå‚è€ƒæ–‡çŒ®ï¼š<br><a href="https://segmentfault.com/a/1190000011376192" target="_blank" rel="noopener">https://segmentfault.com/a/1190000011376192</a><br><a href="https://segmentfault.com/a/1190000011391092" target="_blank" rel="noopener">https://segmentfault.com/a/1190000011391092</a><br><a href="https://zhuanlan.zhihu.com/p/27134110" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/27134110</a><br><a href="https://blog.csdn.net/wojiaolinaaa/article/details/50070031" target="_blank" rel="noopener">https://blog.csdn.net/wojiaolinaaa/article/details/50070031</a><br><a href="https://www.cnblogs.com/waterystone/p/4920797.html" target="_blank" rel="noopener">https://www.cnblogs.com/waterystone/p/4920797.html</a></p><p>FIFOé˜Ÿåˆ—:<a href="https://www.cnblogs.com/waterystone/p/4920797.html" target="_blank" rel="noopener">https://www.cnblogs.com/waterystone/p/4920797.html</a></p>]]></content>
      
      
      <categories>
          
          <category> JUC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JUC </tag>
            
            <tag> AQS </tag>
            
            <tag> JDK </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç†è§£ Go Channels</title>
      <link href="/go-channels.html"/>
      <url>/go-channels.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>Golang Channel</p></blockquote><a id="more"></a><h1 id="ä¸€ã€è§†é¢‘ä¿¡æ¯"><a href="#ä¸€ã€è§†é¢‘ä¿¡æ¯" class="headerlink" title="ä¸€ã€è§†é¢‘ä¿¡æ¯"></a>ä¸€ã€è§†é¢‘ä¿¡æ¯</h1><h2 id="1ã€è§†é¢‘è§‚çœ‹åœ°å€"><a href="#1ã€è§†é¢‘è§‚çœ‹åœ°å€" class="headerlink" title="1ã€è§†é¢‘è§‚çœ‹åœ°å€"></a>1ã€è§†é¢‘è§‚çœ‹åœ°å€</h2><p><a href="https://www.youtube.com/watch?v=KBZlN0izeiY" target="_blank" rel="noopener">https://www.youtube.com/watch?v=KBZlN0izeiY</a></p><h2 id="2ã€PPTä¸‹è½½åœ°å€"><a href="#2ã€PPTä¸‹è½½åœ°å€" class="headerlink" title="2ã€PPTä¸‹è½½åœ°å€"></a>2ã€PPTä¸‹è½½åœ°å€</h2><p><a href="http://download.csdn.net/download/xunzaosiyecao/10212884" target="_blank" rel="noopener">http://download.csdn.net/download/xunzaosiyecao/10212884</a></p><h2 id="3ã€åšæ–‡"><a href="#3ã€åšæ–‡" class="headerlink" title="3ã€åšæ–‡"></a>3ã€åšæ–‡</h2><p><a href="https://about.sourcegraph.com/go/understanding-channels-kavya-joshi/" target="_blank" rel="noopener">https://about.sourcegraph.com/go/understanding-channels-kavya-joshi/</a></p><h1 id="äºŒã€Go-çš„å¹¶å‘ç‰¹æ€§"><a href="#äºŒã€Go-çš„å¹¶å‘ç‰¹æ€§" class="headerlink" title="äºŒã€Go çš„å¹¶å‘ç‰¹æ€§"></a>äºŒã€Go çš„å¹¶å‘ç‰¹æ€§</h1><ul><li>goroutines: ç‹¬ç«‹æ‰§è¡Œæ¯ä¸ªä»»åŠ¡ï¼Œå¹¶å¯èƒ½<font color="DeepPink">å¹¶è¡Œæ‰§è¡Œ</font></li><li>channels: ç”¨äº goroutines ä¹‹é—´çš„é€šè®¯ã€åŒæ­¥</li></ul><h2 id="1ã€ä¸€ä¸ªç®€å•çš„äº‹åŠ¡å¤„ç†çš„ä¾‹å­"><a href="#1ã€ä¸€ä¸ªç®€å•çš„äº‹åŠ¡å¤„ç†çš„ä¾‹å­" class="headerlink" title="1ã€ä¸€ä¸ªç®€å•çš„äº‹åŠ¡å¤„ç†çš„ä¾‹å­"></a>1ã€ä¸€ä¸ªç®€å•çš„äº‹åŠ¡å¤„ç†çš„ä¾‹å­</h2><p>å¯¹äºä¸‹é¢è¿™æ ·çš„éå¹¶å‘çš„ç¨‹åºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func main() &#123;</span><br><span class="line">  tasks := getTasks()</span><br><span class="line">  // å¤„ç†æ¯ä¸ªä»»åŠ¡</span><br><span class="line">  for _, task := range tasks &#123;</span><br><span class="line">    process(task)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†å…¶è½¬æ¢ä¸º Go çš„å¹¶å‘æ¨¡å¼å¾ˆå®¹æ˜“ï¼Œä½¿ç”¨å…¸å‹çš„ Task Queue çš„æ¨¡å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">func main() &#123;</span><br><span class="line">  //  åˆ›å»ºå¸¦ç¼“å†²çš„ channel</span><br><span class="line">  ch := make(chan Task, 3)</span><br><span class="line">  //  è¿è¡Œå›ºå®šæ•°é‡çš„ workers</span><br><span class="line">  for i := 0; i &lt; numWorkers; i++ &#123;</span><br><span class="line">    go worker(ch)</span><br><span class="line">  &#125;</span><br><span class="line">  //  å‘é€ä»»åŠ¡åˆ° workers</span><br><span class="line">  hellaTasks := getTasks()</span><br><span class="line">  for _, task := range hellaTasks &#123;</span><br><span class="line">    ch &lt;- task</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">func worker(ch chan Task) &#123;</span><br><span class="line">  for &#123;</span><br><span class="line">    //  æ¥æ”¶ä»»åŠ¡</span><br><span class="line">    task := &lt;-ch</span><br><span class="line">    process(task)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="2ã€channels-çš„ç‰¹æ€§"><a href="#2ã€channels-çš„ç‰¹æ€§" class="headerlink" title="2ã€channels çš„ç‰¹æ€§"></a>2ã€channels çš„ç‰¹æ€§</h1><ul><li>goroutine-safeï¼Œå¤šä¸ª goroutine å¯ä»¥åŒæ—¶è®¿é—®ä¸€ä¸ª channelã€‚</li><li>å¯ä»¥ç”¨äºåœ¨ goroutine ä¹‹é—´å­˜å‚¨å’Œä¼ é€’å€¼</li><li>å…¶è¯­ä¹‰æ˜¯å…ˆå…¥å…ˆå‡ºï¼ˆFIFOï¼‰</li><li>å¯ä»¥å¯¼è‡´ goroutine çš„ block å’Œ unblock</li></ul><h1 id="ä¸‰ã€è§£æ"><a href="#ä¸‰ã€è§£æ" class="headerlink" title="ä¸‰ã€è§£æ"></a>ä¸‰ã€è§£æ</h1><h2 id="1ã€æ„é€ -channel"><a href="#1ã€æ„é€ -channel" class="headerlink" title="1ã€æ„é€  channel"></a>1ã€æ„é€  channel</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//  å¸¦ç¼“å†²çš„ channel</span><br><span class="line">ch := make(chan Task, 3)</span><br><span class="line">//  æ— ç¼“å†²çš„ channel</span><br><span class="line">ch := make(chan Task)</span><br></pre></td></tr></table></figure><p>å›é¡¾å‰é¢æåˆ°çš„ channel çš„ç‰¹æ€§ï¼Œç‰¹åˆ«æ˜¯å‰ä¸¤ä¸ªã€‚å¦‚æœå¿½ç•¥å†…ç½®çš„ channelï¼Œè®©ä½ è®¾è®¡ä¸€ä¸ªå…·æœ‰ goroutines-safe å¹¶ä¸”å¯ä»¥ç”¨æ¥å­˜å‚¨ã€ä¼ é€’å€¼çš„ä¸œè¥¿ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿå¾ˆå¤šäººå¯èƒ½è§‰å¾—æˆ–è®¸å¯ä»¥ç”¨ä¸€ä¸ªå¸¦é”çš„é˜Ÿåˆ—æ¥åšã€‚æ²¡é”™ï¼Œäº‹å®ä¸Šï¼Œchannel å†…éƒ¨å°±æ˜¯ä¸€ä¸ªå¸¦é”çš„é˜Ÿåˆ—ã€‚<br><a href="https://golang.org/src/runtime/chan.go" target="_blank" rel="noopener">https://golang.org/src/runtime/chan.go</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">type hchan struct &#123;</span><br><span class="line">  ...</span><br><span class="line">  buf      unsafe.Pointer // æŒ‡å‘ä¸€ä¸ªç¯å½¢é˜Ÿåˆ—</span><br><span class="line">  ...</span><br><span class="line">  sendx    uint   // å‘é€ index</span><br><span class="line">  recvx    uint   // æ¥æ”¶ index</span><br><span class="line">  ...</span><br><span class="line">  lock     mutex  //  äº’æ–¥é‡</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>buf çš„å…·ä½“å®ç°å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªç¯å½¢é˜Ÿåˆ—çš„å®ç°ã€‚sendx å’Œ recvx åˆ†åˆ«ç”¨æ¥è®°å½•å‘é€ã€æ¥æ”¶çš„ä½ç½®ã€‚ç„¶åç”¨ä¸€ä¸ª lock äº’æ–¥é”æ¥ç¡®ä¿æ— ç«äº‰å†’é™©ã€‚</p><p>å¯¹äºæ¯ä¸€ä¸ª ch := make(chan Task, 3) è¿™ç±»æ“ä½œï¼Œéƒ½ä¼šåœ¨<font color="DeepPink">å †</font>ä¸­ï¼Œåˆ†é…ä¸€ä¸ªç©ºé—´ï¼Œå»ºç«‹å¹¶åˆå§‹åŒ–ä¸€ä¸ª hchan ç»“æ„å˜é‡ï¼Œè€Œ ch åˆ™æ˜¯æŒ‡å‘è¿™ä¸ª hchan ç»“æ„çš„<font color="DeepPink">æŒ‡é’ˆ</font>ã€‚</p><p>å› ä¸º ch æœ¬èº«å°±æ˜¯ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰å¯ä»¥åœ¨ goroutine å‡½æ•°è°ƒç”¨çš„æ—¶å€™ç›´æ¥å°† ch ä¼ é€’è¿‡å»ï¼Œè€Œä¸ç”¨å† &amp;ch å–æŒ‡é’ˆäº†ï¼Œæ‰€ä»¥æ‰€æœ‰ä½¿ç”¨åŒä¸€ä¸ª ch çš„ goroutine éƒ½æŒ‡å‘äº†åŒä¸€ä¸ªå®é™…çš„å†…å­˜ç©ºé—´ã€‚</p><h2 id="2ã€å‘é€ã€æ¥æ”¶"><a href="#2ã€å‘é€ã€æ¥æ”¶" class="headerlink" title="2ã€å‘é€ã€æ¥æ”¶"></a>2ã€å‘é€ã€æ¥æ”¶</h2><p>ä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬ç”¨ G1 è¡¨ç¤º main() å‡½æ•°çš„ goroutineï¼Œè€Œ G2 è¡¨ç¤º worker çš„ goroutineã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// G1</span><br><span class="line">func main() &#123;</span><br><span class="line">  ...</span><br><span class="line">  for _, task := range tasks &#123;</span><br><span class="line">    ch &lt;- task</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">// G2</span><br><span class="line">func worker(ch chan Task) &#123;</span><br><span class="line">  for &#123;</span><br><span class="line">    task :=&lt;-ch</span><br><span class="line">    process(task)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-1-ç®€å•çš„å‘é€ã€æ¥æ”¶"><a href="#2-1-ç®€å•çš„å‘é€ã€æ¥æ”¶" class="headerlink" title="2.1 ç®€å•çš„å‘é€ã€æ¥æ”¶"></a>2.1 ç®€å•çš„å‘é€ã€æ¥æ”¶</h3><p>é‚£ä¹ˆ G1 ä¸­çš„ ch &lt;- task0 å…·ä½“æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ</p><ul><li>è·å–é”</li><li>enqueue(task0)ï¼ˆè¿™é‡Œæ˜¯å†…å­˜å¤åˆ¶ task0ï¼‰</li><li>é‡Šæ”¾é”</li></ul><p>è¿™ä¸€æ­¥å¾ˆç®€å•ï¼Œæ¥ä¸‹æ¥çœ‹ G2 çš„ t := &lt;- ch æ˜¯å¦‚ä½•è¯»å–æ•°æ®çš„ã€‚</p><ul><li>è·å–é”</li><li>t = dequeue()ï¼ˆåŒæ ·ï¼Œè¿™é‡Œä¹Ÿæ˜¯å†…å­˜å¤åˆ¶ï¼‰</li><li>é‡Šæ”¾é”</li></ul><p>è¿™ä¸€æ­¥ä¹Ÿéå¸¸ç®€å•ã€‚ä½†æ˜¯æˆ‘ä»¬ä»è¿™ä¸ªæ“ä½œä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰ goroutine ä¸­å…±äº«çš„éƒ¨åˆ†åªæœ‰è¿™ä¸ª hchan çš„ç»“æ„ä½“ï¼Œè€Œæ‰€æœ‰é€šè®¯çš„æ•°æ®éƒ½æ˜¯<font color="DeepPink">å†…å­˜å¤åˆ¶</font>ã€‚è¿™éµå¾ªäº† Go å¹¶å‘è®¾è®¡ä¸­å¾ˆæ ¸å¿ƒçš„ä¸€ä¸ªç†å¿µï¼š</p><blockquote><p>Do not communicate by sharing memory;instead, share memory by communicating</p></blockquote><p>å†…å­˜å¤åˆ¶æŒ‡çš„æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// typedmemmove copies a value of type t to dst from src.</span><br><span class="line">// Must be nosplit, see #16026.</span><br><span class="line">//go:nosplit</span><br><span class="line">func typedmemmove(typ *_type, dst, src unsafe.Pointer) &#123;</span><br><span class="line">    if typ.kind&amp;kindNoPointers == 0 &#123;</span><br><span class="line">        bulkBarrierPreWrite(uintptr(dst), uintptr(src), typ.size)</span><br><span class="line">    &#125;</span><br><span class="line">    // There&apos;s a race here: if some other goroutine can write to</span><br><span class="line">    // src, it may change some pointer in src after we&apos;ve</span><br><span class="line">    // performed the write barrier but before we perform the</span><br><span class="line">    // memory copy. This safe because the write performed by that</span><br><span class="line">    // other goroutine must also be accompanied by a write</span><br><span class="line">    // barrier, so at worst we&apos;ve unnecessarily greyed the old</span><br><span class="line">    // pointer that was in src.</span><br><span class="line">    memmove(dst, src, typ.size)</span><br><span class="line">    if writeBarrier.cgo &#123;</span><br><span class="line">        cgoCheckMemmove(typ, dst, src, 0, typ.size)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3ã€é˜»å¡å’Œæ¢å¤"><a href="#3ã€é˜»å¡å’Œæ¢å¤" class="headerlink" title="3ã€é˜»å¡å’Œæ¢å¤"></a>3ã€é˜»å¡å’Œæ¢å¤</h1><h2 id="3-1-å‘é€æ–¹è¢«é˜»å¡"><a href="#3-1-å‘é€æ–¹è¢«é˜»å¡" class="headerlink" title="3.1 å‘é€æ–¹è¢«é˜»å¡"></a>3.1 å‘é€æ–¹è¢«é˜»å¡</h2><p>å‡è®¾ G2 éœ€è¦å¾ˆé•¿æ—¶é—´çš„å¤„ç†ï¼Œåœ¨æ­¤æœŸé—´ï¼ŒG1 ä¸æ–­çš„å‘é€ä»»åŠ¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ch &lt;- task1</span><br><span class="line">ch &lt;- task2</span><br><span class="line">ch &lt;- task3</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å½“å†ä¸€æ¬¡ ch &lt;- task4 çš„æ—¶å€™ï¼Œç”±äº ch çš„ç¼“å†²åªæœ‰ 3 ä¸ªï¼Œæ‰€ä»¥æ²¡æœ‰åœ°æ–¹æ”¾äº†ï¼Œäºæ˜¯ G1 è¢« block äº†ï¼Œå½“æœ‰äººä»é˜Ÿåˆ—ä¸­å–èµ°ä¸€ä¸ª Task çš„æ—¶å€™ï¼ŒG1 æ‰ä¼šè¢«æ¢å¤ã€‚è¿™æ˜¯æˆ‘ä»¬éƒ½çŸ¥é“çš„ï¼Œä¸è¿‡æˆ‘ä»¬ä»Šå¤©å…³å¿ƒçš„ä¸æ˜¯å‘ç”Ÿäº†ä»€ä¹ˆï¼Œè€Œæ˜¯å¦‚ä½•åšåˆ°çš„ï¼Ÿ</p><h2 id="3-2-goroutine-çš„è¿è¡Œæ—¶è°ƒåº¦"><a href="#3-2-goroutine-çš„è¿è¡Œæ—¶è°ƒåº¦" class="headerlink" title="3.2 goroutine çš„è¿è¡Œæ—¶è°ƒåº¦"></a>3.2 goroutine çš„è¿è¡Œæ—¶è°ƒåº¦</h2><p>é¦–å…ˆï¼Œgoroutine <font color="DeepPink">ä¸æ˜¯æ“ä½œç³»ç»Ÿçº¿ç¨‹</font>ï¼Œè€Œæ˜¯ <font color="DeepPink">ç”¨æˆ·ç©ºé—´çº¿ç¨‹</font>ã€‚å› æ­¤ goroutine æ˜¯ç”± Go runtime æ¥åˆ›å»ºå¹¶ç®¡ç†çš„ï¼Œè€Œä¸æ˜¯ OSï¼Œæ‰€ä»¥è¦æ¯”æ“ä½œç³»ç»Ÿçº¿ç¨‹è½»é‡çº§ã€‚</p><p>å½“ç„¶ï¼Œgoroutine æœ€ç»ˆè¿˜æ˜¯è¦è¿è¡ŒäºæŸä¸ªçº¿ç¨‹ä¸­çš„ï¼Œæ§åˆ¶ goroutine å¦‚ä½•è¿è¡Œäºçº¿ç¨‹ä¸­çš„æ˜¯ Go runtime ä¸­çš„ scheduler ï¼ˆè°ƒåº¦å™¨ï¼‰ã€‚</p><p>Go çš„è¿è¡Œæ—¶è°ƒåº¦å™¨æ˜¯ M:N è°ƒåº¦æ¨¡å‹ï¼Œæ—¢ N ä¸ª goroutineï¼Œä¼šè¿è¡Œäº M ä¸ª OS çº¿ç¨‹ä¸­ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ª OS çº¿ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šè¿è¡Œå¤šä¸ª goroutineã€‚</p><p>Go çš„ M:N è°ƒåº¦ä¸­ä½¿ç”¨äº†3ä¸ªç»“æ„ï¼š</p><ul><li>M: OS çº¿ç¨‹</li><li>G: goroutine</li><li>P: è°ƒåº¦ä¸Šä¸‹æ–‡<ul><li>P æ‹¥æœ‰ä¸€ä¸ªè¿è¡Œé˜Ÿåˆ—ï¼Œé‡Œé¢æ˜¯æ‰€æœ‰å¯ä»¥è¿è¡Œçš„ goroutine åŠå…¶ä¸Šä¸‹æ–‡</li></ul></li></ul><h2 id="3-3-goroutine-è¢«é˜»å¡çš„å…·ä½“è¿‡ç¨‹"><a href="#3-3-goroutine-è¢«é˜»å¡çš„å…·ä½“è¿‡ç¨‹" class="headerlink" title="3.3 goroutine è¢«é˜»å¡çš„å…·ä½“è¿‡ç¨‹"></a>3.3 goroutine è¢«é˜»å¡çš„å…·ä½“è¿‡ç¨‹</h2><p>é‚£ä¹ˆå½“ ch &lt;- task4 æ‰§è¡Œçš„æ—¶å€™ï¼Œchannel ä¸­å·²ç»æ»¡äº†ï¼Œéœ€è¦ <font color="DeepPink">pause</font> G1ã€‚è¿™ä¸ªæ—¶å€™ï¼š</p><ol><li>G1 ä¼šè°ƒç”¨è¿è¡Œæ—¶çš„ gopark</li><li>ç„¶å Go çš„è¿è¡Œæ—¶è°ƒåº¦å™¨å°±ä¼šæ¥ç®¡</li><li>å°† G1 çš„çŠ¶æ€è®¾ç½®ä¸º waiting</li><li>æ–­å¼€ G1 å’Œ M ä¹‹é—´çš„å…³ç³»ï¼ˆswitch out)ï¼Œå› æ­¤ G1 è„±ç¦» Mï¼Œæ¢å¥è¯è¯´ï¼ŒM ç©ºé—²äº†ï¼Œå¯ä»¥å®‰æ’åˆ«çš„ä»»åŠ¡äº†ã€‚</li><li>ä» P çš„è¿è¡Œé˜Ÿåˆ—ä¸­ï¼Œå–å¾—ä¸€ä¸ªå¯è¿è¡Œçš„ goroutine G</li><li>å»ºç«‹æ–°çš„ G å’Œ M çš„å…³ç³»ï¼ˆSwitch in)ï¼Œå› æ­¤ G å°±å‡†å¤‡å¥½è¿è¡Œäº†ã€‚</li><li>å½“è°ƒåº¦å™¨è¿”å›çš„æ—¶å€™ï¼Œæ–°çš„ G å°±å¼€å§‹è¿è¡Œäº†ï¼Œè€Œ G1 åˆ™ä¸ä¼šè¿è¡Œï¼Œä¹Ÿå°±æ˜¯ block äº†ã€‚</li></ol><p>ä»ä¸Šé¢çš„æµç¨‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ<font color="DeepPink">å¯¹äº goroutine æ¥è¯´ï¼ŒG1 è¢«é˜»å¡äº†ï¼Œæ–°çš„ G å¼€å§‹è¿è¡Œäº†ï¼›è€Œå¯¹äºæ“ä½œç³»ç»Ÿçº¿ç¨‹ M æ¥è¯´ï¼Œåˆ™æ ¹æœ¬æ²¡æœ‰è¢«é˜»å¡ã€‚</font></p><p>æˆ‘ä»¬çŸ¥é“ OS çº¿ç¨‹è¦æ¯” goroutine è¦æ²‰é‡çš„å¤šï¼Œå› æ­¤è¿™é‡Œå°½é‡é¿å… OS çº¿ç¨‹é˜»å¡ï¼Œå¯ä»¥æé«˜æ€§èƒ½ã€‚</p><h2 id="3-4-goroutine-æ¢å¤æ‰§è¡Œçš„å…·ä½“è¿‡ç¨‹"><a href="#3-4-goroutine-æ¢å¤æ‰§è¡Œçš„å…·ä½“è¿‡ç¨‹" class="headerlink" title="3.4 goroutine æ¢å¤æ‰§è¡Œçš„å…·ä½“è¿‡ç¨‹"></a>3.4 goroutine æ¢å¤æ‰§è¡Œçš„å…·ä½“è¿‡ç¨‹</h2><p>å‰é¢ç†è§£äº†é˜»å¡ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ç†è§£ä¸€ä¸‹å¦‚ä½•æ¢å¤è¿è¡Œã€‚ä¸è¿‡ï¼Œåœ¨ç»§ç»­äº†è§£å¦‚ä½•æ¢å¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè¿›ä¸€æ­¥ç†è§£ hchan è¿™ä¸ªç»“æ„ã€‚å› ä¸ºï¼Œå½“ channel ä¸åœ¨æ»¡çš„æ—¶å€™ï¼Œè°ƒåº¦å™¨æ˜¯å¦‚ä½•çŸ¥é“è¯¥è®©å“ªä¸ª goroutine ç»§ç»­è¿è¡Œå‘¢ï¼Ÿè€Œä¸” goroutine åˆæ˜¯å¦‚ä½•çŸ¥é“è¯¥ä»å“ªå–æ•°æ®å‘¢ï¼Ÿ</p><p>åœ¨ hchan ä¸­ï¼Œé™¤äº†ä¹‹å‰æåˆ°çš„å†…å®¹å¤–ï¼Œè¿˜å®šä¹‰æœ‰ sendq å’Œ recvq ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œåˆ†åˆ«è¡¨ç¤ºç­‰å¾…å‘é€ã€æ¥æ”¶çš„ goroutineï¼ŒåŠå…¶ç›¸å…³ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">type hchan struct &#123;</span><br><span class="line">  ...</span><br><span class="line">  buf      unsafe.Pointer // æŒ‡å‘ä¸€ä¸ªç¯å½¢é˜Ÿåˆ—</span><br><span class="line">  ...</span><br><span class="line">  sendq    waitq  // ç­‰å¾…å‘é€çš„é˜Ÿåˆ—</span><br><span class="line">  recvq    waitq  // ç­‰å¾…æ¥æ”¶çš„é˜Ÿåˆ—</span><br><span class="line">  ...</span><br><span class="line">  lock     mutex  //  äº’æ–¥é‡</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ waitq æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„é˜Ÿåˆ—ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ª sudog çš„ç»“æ„ï¼Œå…¶å®šä¹‰å¤§è‡´ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type sudog struct &#123;</span><br><span class="line">  g          *g //  æ­£åœ¨ç­‰å€™çš„ goroutine</span><br><span class="line">  elem       unsafe.Pointer // æŒ‡å‘éœ€è¦æ¥æ”¶ã€å‘é€çš„å…ƒç´ </span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://golang.org/src/runtime/runtime2.go?h=sudog#L270" target="_blank" rel="noopener">https://golang.org/src/runtime/runtime2.go?h=sudog#L270</a></p><p>æ‰€ä»¥åœ¨ä¹‹å‰çš„é˜»å¡ G1 çš„è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸Šï¼š</p><ol><li>G1 ä¼š<font color="DeepPink">ç»™è‡ªå·±</font>åˆ›å»ºä¸€ä¸ª sudog çš„å˜é‡</li><li>ç„¶åè¿½åŠ åˆ° sendq çš„ç­‰å€™é˜Ÿåˆ—ä¸­ï¼Œæ–¹ä¾¿å°†æ¥çš„<font color="DeepPink">receiver</font> æ¥ä½¿ç”¨è¿™äº›ä¿¡æ¯æ¢å¤ G1ã€‚</li></ol><p>è¿™äº›éƒ½æ˜¯<font color="DeepPink">å‘ç”Ÿåœ¨è°ƒç”¨è°ƒåº¦å™¨ä¹‹å‰</font>ã€‚</p><p>é‚£ä¹ˆç°åœ¨å¼€å§‹çœ‹ä¸€ä¸‹å¦‚ä½•æ¢å¤ã€‚</p><p>å½“ G2 è°ƒç”¨ t := &lt;- ch çš„æ—¶å€™ï¼Œchannel çš„çŠ¶æ€æ˜¯ï¼Œç¼“å†²æ˜¯æ»¡çš„ï¼Œè€Œä¸”è¿˜æœ‰ä¸€ä¸ª G1 åœ¨ç­‰å€™å‘é€é˜Ÿåˆ—é‡Œï¼Œç„¶å G2 æ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼š</p><ol><li>G2 å…ˆæ‰§è¡Œ dequeue() ä»ç¼“å†²é˜Ÿåˆ—ä¸­å–å¾— task1 ç»™ t</li><li>G2 ä» sendq ä¸­å¼¹å‡ºä¸€ä¸ªç­‰å€™å‘é€çš„ sudog</li><li>å°†å¼¹å‡ºçš„ sudog ä¸­çš„ elem çš„å€¼ enqueue() åˆ° buf ä¸­</li><li>å°†å¼¹å‡ºçš„ sudog ä¸­çš„ goroutineï¼Œä¹Ÿå°±æ˜¯ G1ï¼ŒçŠ¶æ€ä» waiting æ”¹ä¸º runnable<ol><li>ç„¶åï¼ŒG2 éœ€è¦é€šçŸ¥è°ƒåº¦å™¨ G1 å·²ç»å¯ä»¥è¿›è¡Œè°ƒåº¦äº†ï¼Œå› æ­¤è°ƒç”¨ goready(G1)ã€‚</li><li>è°ƒåº¦å™¨å°† G1 çš„çŠ¶æ€æ”¹ä¸º runnable</li><li>è°ƒåº¦å™¨å°† G1 å‹å…¥ P çš„è¿è¡Œé˜Ÿåˆ—ï¼Œå› æ­¤åœ¨å°†æ¥çš„æŸä¸ªæ—¶åˆ»è°ƒåº¦çš„æ—¶å€™ï¼ŒG1 å°±ä¼šå¼€å§‹æ¢å¤è¿è¡Œã€‚</li><li>è¿”å›åˆ° G2<blockquote><p>æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ç”± G2 æ¥è´Ÿè´£å°† G1 çš„ elem å‹å…¥ buf çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªä¼˜åŒ–ã€‚è¿™æ ·å°†æ¥ G1 æ¢å¤è¿è¡Œåï¼Œå°±ä¸å¿…å†æ¬¡è·å–é”ã€enqueue()ã€é‡Šæ”¾é”äº†ã€‚è¿™æ ·å°±é¿å…äº†å¤šæ¬¡é”çš„å¼€é”€ã€‚</p></blockquote></li></ol></li></ol><h3 id="3-5-å¦‚æœæ¥æ”¶æ–¹å…ˆé˜»å¡å‘¢ï¼Ÿ"><a href="#3-5-å¦‚æœæ¥æ”¶æ–¹å…ˆé˜»å¡å‘¢ï¼Ÿ" class="headerlink" title="3.5 å¦‚æœæ¥æ”¶æ–¹å…ˆé˜»å¡å‘¢ï¼Ÿ"></a>3.5 å¦‚æœæ¥æ”¶æ–¹å…ˆé˜»å¡å‘¢ï¼Ÿ</h3><p>æ›´é…·çš„åœ°æ–¹æ˜¯æ¥æ”¶æ–¹å…ˆé˜»å¡çš„æµç¨‹ã€‚</p><p>å¦‚æœ G2 å…ˆæ‰§è¡Œäº† t := &lt;- chï¼Œæ­¤æ—¶ buf æ˜¯ç©ºçš„ï¼Œå› æ­¤ G2 ä¼šè¢«é˜»å¡ï¼Œä»–çš„æµç¨‹æ˜¯è¿™æ ·ï¼š</p><ol><li>G2 ç»™è‡ªå·±åˆ›å»ºä¸€ä¸ª sudog ç»“æ„å˜é‡ã€‚å…¶ä¸­ g æ˜¯è‡ªå·±ï¼Œä¹Ÿå°±æ˜¯ G2ï¼Œè€Œ elem åˆ™æŒ‡å‘ t</li><li>å°†è¿™ä¸ª sudog å˜é‡å‹å…¥ recvq ç­‰å€™æ¥æ”¶é˜Ÿåˆ—</li><li>G2 éœ€è¦å‘Šè¯‰ goroutineï¼Œè‡ªå·±éœ€è¦ pause äº†ï¼Œäºæ˜¯è°ƒç”¨ gopark(G2) <ol><li>å’Œä¹‹å‰ä¸€æ ·ï¼Œè°ƒåº¦å™¨å°†å…¶ G2 çš„çŠ¶æ€æ”¹ä¸º waiting</li><li>æ–­å¼€ G2 å’Œ M çš„å…³ç³»</li><li>ä» P çš„è¿è¡Œé˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ª goroutine</li><li>å»ºç«‹æ–°çš„ goroutine å’Œ M çš„å…³ç³»</li><li>è¿”å›ï¼Œå¼€å§‹ç»§ç»­è¿è¡Œæ–°çš„ goroutine</li></ol></li></ol><p>è¿™äº›åº”è¯¥å·²ç»ä¸é™Œç”Ÿäº†ï¼Œé‚£ä¹ˆå½“ G1 å¼€å§‹å‘é€æ•°æ®çš„æ—¶å€™ï¼Œæµç¨‹æ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿ</p><p>G1 å¯ä»¥å°† enqueue(task)ï¼Œç„¶åè°ƒç”¨ goready(G2)ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥æ›´èªæ˜ä¸€äº›ã€‚</p><p>æˆ‘ä»¬æ ¹æ® hchan ç»“æ„çš„çŠ¶æ€ï¼Œå·²ç»çŸ¥é“ task è¿›å…¥ buf åï¼ŒG2 æ¢å¤è¿è¡Œåï¼Œä¼šè¯»å–å…¶å€¼ï¼Œå¤åˆ¶åˆ° t ä¸­ã€‚é‚£ä¹ˆ G1 å¯ä»¥æ ¹æœ¬ä¸èµ° bufï¼Œ<font color="DeepPink">G1 å¯ä»¥ç›´æ¥æŠŠæ•°æ®ç»™ G2</font>ã€‚</p><p>Goroutine é€šå¸¸éƒ½æœ‰è‡ªå·±çš„æ ˆï¼Œäº’ç›¸ä¹‹é—´ä¸ä¼šè®¿é—®å¯¹æ–¹çš„æ ˆå†…æ•°æ®ï¼Œ<font color="DeepPink">é™¤äº† channel</font>ã€‚è¿™é‡Œï¼Œç”±äºæˆ‘ä»¬å·²ç»çŸ¥é“äº† t çš„åœ°å€ï¼ˆé€šè¿‡ elemæŒ‡é’ˆï¼‰ï¼Œè€Œä¸”ç”±äº G2 ä¸åœ¨è¿è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾ˆå®‰å…¨çš„ç›´æ¥èµ‹å€¼ã€‚å½“ G2 æ¢å¤è¿è¡Œçš„æ—¶å€™ï¼Œæ—¢ä¸éœ€è¦å†æ¬¡è·å–é”ï¼Œä¹Ÿä¸éœ€è¦å¯¹ buf è¿›è¡Œæ“ä½œã€‚ä»è€ŒèŠ‚çº¦äº†å†…å­˜å¤åˆ¶ã€ä»¥åŠé”æ“ä½œçš„å¼€é”€ã€‚</p><h2 id="4ã€æ€»ç»“"><a href="#4ã€æ€»ç»“" class="headerlink" title="4ã€æ€»ç»“"></a>4ã€æ€»ç»“</h2><ul><li><p>goroutine-safe</p><ul><li>hchan ä¸­çš„ lock mutex</li></ul></li><li><p>å­˜å‚¨ã€ä¼ é€’å€¼ï¼ŒFIFO</p><ul><li>é€šè¿‡ hchan ä¸­çš„ç¯å½¢ç¼“å†²åŒºæ¥å®ç°</li></ul></li><li><p>å¯¼è‡´ goroutine çš„é˜»å¡å’Œæ¢å¤</p><ul><li>hchan ä¸­çš„ sendqå’Œrecvqï¼Œä¹Ÿå°±æ˜¯ sudog ç»“æ„çš„é“¾è¡¨é˜Ÿåˆ—</li><li>è°ƒç”¨è¿è¡Œæ—¶è°ƒåº¦å™¨ (gopark(), goready())<h1 id="å››ã€å…¶å®ƒ-channel-çš„æ“ä½œ"><a href="#å››ã€å…¶å®ƒ-channel-çš„æ“ä½œ" class="headerlink" title="å››ã€å…¶å®ƒ channel çš„æ“ä½œ"></a>å››ã€å…¶å®ƒ channel çš„æ“ä½œ</h1><h2 id="1ã€æ— ç¼“å†²-channel"><a href="#1ã€æ— ç¼“å†²-channel" class="headerlink" title="1ã€æ— ç¼“å†² channel"></a>1ã€æ— ç¼“å†² channel</h2>æ— ç¼“å†²çš„ channel è¡Œä¸ºå°±å’Œå‰é¢è¯´çš„<font color="DeepPink">ç›´æ¥å‘é€</font>çš„ä¾‹å­ä¸€æ ·ï¼š</li></ul></li><li><p>æ¥æ”¶æ–¹é˜»å¡ â†’ å‘é€æ–¹<font color="DeepPink">ç›´æ¥å†™å…¥æ¥æ”¶æ–¹çš„æ ˆ</font></p></li><li><p>å‘é€æ–¹é˜»å¡ â†’ æ¥å—æ³•<font color="DeepPink">ç›´æ¥ä»å‘é€æ–¹çš„ sudog ä¸­è¯»å–</font></p></li></ul><h2 id="2ã€select"><a href="#2ã€select" class="headerlink" title="2ã€select"></a>2ã€select</h2><p><a href="https://golang.org/src/runtime/select.go" target="_blank" rel="noopener">https://golang.org/src/runtime/select.go</a></p><ol><li>å…ˆæŠŠæ‰€æœ‰éœ€è¦æ“ä½œçš„ channel ä¸Šé”</li><li>ç»™è‡ªå·±åˆ›å»ºä¸€ä¸ª sudogï¼Œç„¶åæ·»åŠ åˆ°æ‰€æœ‰ channel çš„ sendqæˆ–recvqï¼ˆå–å†³äºæ˜¯å‘é€è¿˜æ˜¯æ¥æ”¶ï¼‰</li><li>æŠŠæ‰€æœ‰çš„ channel è§£é”ï¼Œç„¶å pause å½“å‰è°ƒç”¨ select çš„ goroutineï¼ˆgopark()ï¼‰</li><li>ç„¶åå½“æœ‰ä»»æ„ä¸€ä¸ª channel å¯ç”¨æ—¶ï¼Œselect çš„è¿™ä¸ª goroutine å°±ä¼šè¢«è°ƒåº¦æ‰§è¡Œã€‚</li><li>resuming mirrors the pause sequence</li></ol><p>äº”ã€ä¸ºä»€ä¹ˆ Go ä¼šè¿™æ ·è®¾è®¡ï¼Ÿ<br>1ã€Simplicity<br>æ›´å€¾å‘äºå¸¦é”çš„é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯æ— é”çš„å®ç°ã€‚</p><p>æ€§èƒ½æå‡ä¸æ˜¯å‡­ç©ºè€Œæ¥çš„ï¼Œæ˜¯éšç€å¤æ‚åº¦å¢åŠ è€Œå¢åŠ çš„ã€‚</p><p>dvyokov<br>åè€…è™½ç„¶æ€§èƒ½å¯èƒ½ä¼šæ›´å¥½ï¼Œä½†æ˜¯è¿™ä¸ªä¼˜åŠ¿ï¼Œå¹¶ä¸ä¸€å®šèƒ½å¤Ÿæˆ˜èƒœéšä¹‹è€Œæ¥çš„å®ç°ä»£ç çš„å¤æ‚åº¦æ‰€å¸¦æ¥çš„åŠ£åŠ¿ã€‚</p><h2 id="2ã€Performance"><a href="#2ã€Performance" class="headerlink" title="2ã€Performance"></a>2ã€Performance</h2><ul><li>è°ƒç”¨ Go è¿è¡Œæ—¶è°ƒåº¦å™¨ï¼Œè¿™æ ·å¯ä»¥ä¿æŒ OS çº¿ç¨‹ä¸è¢«é˜»å¡è·¨ goroutine çš„æ ˆè¯»ã€å†™ã€‚</li><li>å¯ä»¥è®© goroutine é†’æ¥åä¸å¿…è·å–é”ã€‚</li><li>å¯ä»¥é¿å…ä¸€äº›å†…å­˜å¤åˆ¶ã€‚</li></ul><p>å½“ç„¶ï¼Œ<font color="DeepPink">ä»»ä½•ä¼˜åŠ¿éƒ½ä¼šæœ‰å…¶ä»£ä»·</font>ã€‚è¿™é‡Œçš„ä»£ä»·æ˜¯å®ç°çš„å¤æ‚åº¦ï¼Œæ‰€ä»¥è¿™é‡Œæœ‰æ›´å¤æ‚çš„å†…å­˜ç®¡ç†æœºåˆ¶ã€åƒåœ¾å›æ”¶ä»¥åŠæ ˆæ”¶ç¼©æœºåˆ¶ã€‚</p><p>åœ¨è¿™é‡Œæ€§èƒ½çš„æé«˜ä¼˜åŠ¿ï¼Œè¦æ¯”å¤æ‚åº¦çš„æé«˜å¸¦æ¥çš„åŠ£åŠ¿è¦å¤§ã€‚</p><p>æ‰€ä»¥åœ¨ channel å®ç°çš„å„ç§ä»£ç ä¸­ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è§åˆ°è¿™ç§<font color="DeepPink">simplicity vs performance</font> çš„æƒè¡¡åçš„ç»“æœã€‚</p><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼š<br><a href="https://blog.lab99.org/post/golang-2017-10-04-video-understanding-channels.html#fa-song-jie-shou" target="_blank" rel="noopener">https://blog.lab99.org/post/golang-2017-10-04-video-understanding-channels.html#fa-song-jie-shou</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Channel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go 1.9 Sync Map</title>
      <link href="/go-sync-map.html"/>
      <url>/go-sync-map.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>åŸºäºGo 1.9 è§£æSync Map</p></blockquote><a id="more"></a><h1 id="æ¦‚è¦"><a href="#æ¦‚è¦" class="headerlink" title="æ¦‚è¦"></a>æ¦‚è¦</h1><h2 id="Package"><a href="#Package" class="headerlink" title="Package"></a>Package</h2><p><img alt data-src="/images/go-sync-map/package.png"></p><p>æœ¬æ–‡ä¸»è¦é˜è¿°ï¼šLoadã€Storeã€Deleteï¼Œæ›´åŠ è¯¦ç»†çš„é˜è¿°å¯ä»¥å‚è€ƒæºç æè¿°ï¼ˆå»ºè®®å…ˆå¤§ä½“æµè§ˆä¸€ä¸‹Mapæºç ï¼‰ã€‚</p><h2 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h2><ul><li>ç©ºé—´æ¢æ—¶é—´ã€‚ é€šè¿‡å†—ä½™çš„ä¸¤ä¸ªæ•°æ®ç»“æ„(readã€dirty),å®ç°åŠ é”å¯¹æ€§èƒ½çš„å½±å“ã€‚</li><li>ä½¿ç”¨åªè¯»æ•°æ®(read)ï¼Œé¿å…è¯»å†™å†²çªã€‚</li><li>åŠ¨æ€è°ƒæ•´ï¼Œmissæ¬¡æ•°å¤šäº†ä¹‹åï¼Œå°†dirtyæ•°æ®æå‡ä¸ºreadã€‚</li><li>double-checkingã€‚</li><li>å»¶è¿Ÿåˆ é™¤ã€‚ åˆ é™¤ä¸€ä¸ªé”®å€¼åªæ˜¯æ‰“æ ‡è®°ï¼ˆä¼šå°†keyå¯¹åº”valueçš„pointerç½®ä¸ºnilï¼Œä½†readä¸­ä»ç„¶æœ‰è¿™ä¸ªkey:key;value:nilçš„é”®å€¼å¯¹ï¼‰ï¼Œåªæœ‰åœ¨æå‡dirtyçš„æ—¶å€™æ‰æ¸…ç†åˆ é™¤çš„æ•°æ®ã€‚</li><li>ä¼˜å…ˆä»readè¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼Œå› ä¸ºå¯¹readçš„è¯»å–ä¸éœ€è¦é”ã€‚</li><li>è™½ç„¶readå’Œdirtyæœ‰å†—ä½™æ•°æ®ï¼Œä½†è¿™äº›æ•°æ®æ˜¯é€šè¿‡æŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªæ•°æ®ï¼Œæ‰€ä»¥å°½ç®¡Mapçš„valueä¼šå¾ˆå¤§ï¼Œä½†æ˜¯å†—ä½™çš„ç©ºé—´å ç”¨è¿˜æ˜¯æœ‰é™çš„ã€‚</li></ul><h1 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h1><h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">// Map is a concurrent map with amortized-constant-time loads, stores, and deletes.</span><br><span class="line">// It is safe for multiple goroutines to call a Map&apos;s methods concurrently.</span><br><span class="line">//</span><br><span class="line">// It is optimized for use in concurrent loops with keys that are</span><br><span class="line">// stable over time, and either few steady-state stores, or stores</span><br><span class="line">// localized to one goroutine per key.</span><br><span class="line">//</span><br><span class="line">// For use cases that do not share these attributes, it will likely have</span><br><span class="line">// comparable or worse performance and worse type safety than an ordinary</span><br><span class="line">// map paired with a read-write mutex.</span><br><span class="line">//</span><br><span class="line">// The zero Map is valid and empty.</span><br><span class="line">//</span><br><span class="line">// A Map must not be copied after first use.</span><br><span class="line"></span><br><span class="line">//è¯¥ Map æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¯»å–ï¼Œæ’å…¥ï¼Œåˆ é™¤ä¹Ÿéƒ½ä¿æŒç€å¸¸æ•°çº§çš„æ—¶é—´å¤æ‚åº¦ã€‚</span><br><span class="line">//å¤šä¸ª goroutines åç¨‹åŒæ—¶è°ƒç”¨ Map æ–¹æ³•ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è¯¥ Map çš„é›¶å€¼æ˜¯æœ‰æ•ˆçš„ï¼Œ</span><br><span class="line">//å¹¶ä¸”é›¶å€¼æ˜¯ä¸€ä¸ªç©ºçš„ Map ã€‚çº¿ç¨‹å®‰å…¨çš„ Map åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨ä¹‹åï¼Œä¸å…è®¸è¢«æ‹·è´ã€‚</span><br><span class="line">type Map struct &#123;</span><br><span class="line">mu Mutex</span><br><span class="line"></span><br><span class="line">// read contains the portion of the map&apos;s contents that are safe for</span><br><span class="line">// concurrent access (with or without mu held).</span><br><span class="line">//</span><br><span class="line">// The read field itself is always safe to load, but must only be stored with</span><br><span class="line">// mu held.</span><br><span class="line">//</span><br><span class="line">// Entries stored in read may be updated concurrently without mu, but updating</span><br><span class="line">// a previously-expunged entry requires that the entry be copied to the dirty</span><br><span class="line">// map and unexpunged with mu held.</span><br><span class="line"></span><br><span class="line"> // ä¸€ä¸ªåªè¯»çš„æ•°æ®ç»“æ„ï¼Œå› ä¸ºåªè¯»ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰è¯»å†™å†²çªã€‚</span><br><span class="line">    // æ‰€ä»¥ä»è¿™ä¸ªæ•°æ®ä¸­è¯»å–æ€»æ˜¯å®‰å…¨çš„ã€‚</span><br><span class="line">    // å®é™…ä¸Šï¼Œå®é™…ä¹Ÿä¼šæ›´æ–°è¿™ä¸ªæ•°æ®çš„entries,å¦‚æœentryæ˜¯æœªåˆ é™¤çš„(unexpunged), å¹¶ä¸éœ€è¦åŠ é”ã€‚å¦‚æœentryå·²ç»è¢«åˆ é™¤äº†ï¼Œéœ€è¦åŠ é”ï¼Œä»¥ä¾¿æ›´æ–°dirtyæ•°æ®ã€‚</span><br><span class="line">read atomic.Value // readOnly</span><br><span class="line"></span><br><span class="line">// dirty contains the portion of the map&apos;s contents that require mu to be</span><br><span class="line">// held. To ensure that the dirty map can be promoted to the read map quickly,</span><br><span class="line">// it also includes all of the non-expunged entries in the read map.</span><br><span class="line">//</span><br><span class="line">// Expunged entries are not stored in the dirty map. An expunged entry in the</span><br><span class="line">// clean map must be unexpunged and added to the dirty map before a new value</span><br><span class="line">// can be stored to it.</span><br><span class="line">//</span><br><span class="line">// If the dirty map is nil, the next write to the map will initialize it by</span><br><span class="line">// making a shallow copy of the clean map, omitting stale entries.</span><br><span class="line"></span><br><span class="line">// dirtyæ•°æ®åŒ…å«å½“å‰çš„mapåŒ…å«çš„entries,å®ƒåŒ…å«æœ€æ–°çš„entries(åŒ…æ‹¬readä¸­æœªåˆ é™¤çš„æ•°æ®,è™½æœ‰å†—ä½™ï¼Œä½†æ˜¯æå‡dirtyå­—æ®µä¸ºreadçš„æ—¶å€™éå¸¸å¿«ï¼Œä¸ç”¨ä¸€ä¸ªä¸€ä¸ªçš„å¤åˆ¶ï¼Œè€Œæ˜¯ç›´æ¥å°†è¿™ä¸ªæ•°æ®ç»“æ„ä½œä¸ºreadå­—æ®µçš„ä¸€éƒ¨åˆ†),æœ‰äº›æ•°æ®è¿˜å¯èƒ½æ²¡æœ‰ç§»åŠ¨åˆ°readå­—æ®µä¸­ã€‚</span><br><span class="line">    // å¯¹äºdirtyçš„æ“ä½œéœ€è¦åŠ é”ï¼Œå› ä¸ºå¯¹å®ƒçš„æ“ä½œå¯èƒ½ä¼šæœ‰è¯»å†™ç«äº‰ã€‚</span><br><span class="line">    // å½“dirtyä¸ºç©ºçš„æ—¶å€™ï¼Œ æ¯”å¦‚åˆå§‹åŒ–æˆ–è€…åˆšæå‡å®Œï¼Œä¸‹ä¸€æ¬¡çš„å†™æ“ä½œä¼šå¤åˆ¶readå­—æ®µä¸­æœªåˆ é™¤çš„æ•°æ®åˆ°è¿™ä¸ªæ•°æ®ä¸­ã€‚</span><br><span class="line">dirty map[interface&#123;&#125;]*entry</span><br><span class="line"></span><br><span class="line">// misses counts the number of loads since the read map was last updated that</span><br><span class="line">// needed to lock mu to determine whether the key was present.</span><br><span class="line">//</span><br><span class="line">// Once enough misses have occurred to cover the cost of copying the dirty</span><br><span class="line">// map, the dirty map will be promoted to the read map (in the unamended</span><br><span class="line">// state) and the next store to the map will make a new dirty copy.</span><br><span class="line">// å½“ä»Mapä¸­è¯»å–entryçš„æ—¶å€™ï¼Œå¦‚æœreadä¸­ä¸åŒ…å«è¿™ä¸ªentry,ä¼šå°è¯•ä»dirtyä¸­è¯»å–ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå°†missesåŠ ä¸€ï¼Œ</span><br><span class="line">    // å½“missesç´¯ç§¯åˆ° dirtyçš„é•¿åº¦çš„æ—¶å€™ï¼Œ å°±ä¼šå°†dirtyæå‡ä¸ºread,é¿å…ä»dirtyä¸­misså¤ªå¤šæ¬¡ã€‚å› ä¸ºæ“ä½œdirtyéœ€è¦åŠ é”ã€‚</span><br><span class="line">misses int</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="readOnly"><a href="#readOnly" class="headerlink" title="readOnly"></a>readOnly</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// readOnly is an immutable struct stored atomically in the Map.read field.</span><br><span class="line">type readOnly struct &#123;</span><br><span class="line">m       map[interface&#123;&#125;]*entry</span><br><span class="line">// true if the dirty map contains some key not in m.</span><br><span class="line">// å¦‚æœMap.dirtyæœ‰äº›æ•°æ®ä¸åœ¨ä¸­çš„æ—¶å€™ï¼Œè¿™ä¸ªå€¼ä¸ºtrue</span><br><span class="line">amended bool </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="entry"><a href="#entry" class="headerlink" title="entry"></a>entry</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// An entry is a slot in the map corresponding to a particular key.</span><br><span class="line">type entry struct &#123;</span><br><span class="line">// p points to the interface&#123;&#125; value stored for the entry.</span><br><span class="line">//</span><br><span class="line">// If p == nil, the entry has been deleted and m.dirty == nil.</span><br><span class="line">//</span><br><span class="line">// If p == expunged, the entry has been deleted, m.dirty != nil, and the entry</span><br><span class="line">// is missing from m.dirty.</span><br><span class="line">//</span><br><span class="line">// Otherwise, the entry is valid and recorded in m.read.m[key] and, if m.dirty</span><br><span class="line">// != nil, in m.dirty[key].</span><br><span class="line">//</span><br><span class="line">// An entry can be deleted by atomic replacement with nil: when m.dirty is</span><br><span class="line">// next created, it will atomically replace nil with expunged and leave</span><br><span class="line">// m.dirty[key] unset.</span><br><span class="line">//</span><br><span class="line">// An entry&apos;s associated value can be updated by atomic replacement, provided</span><br><span class="line">// p != expunged. If p == expunged, an entry&apos;s associated value can be updated</span><br><span class="line">// only after first setting m.dirty[key] = e so that lookups using the dirty</span><br><span class="line">// map find the entry.</span><br><span class="line"></span><br><span class="line">//pæœ‰ä¸‰ç§å€¼ï¼š</span><br><span class="line">//nil: entryå·²è¢«åˆ é™¤äº†ï¼Œå¹¶ä¸”m.dirtyä¸ºnil</span><br><span class="line">//expunged: entryå·²è¢«åˆ é™¤äº†ï¼Œå¹¶ä¸”m.dirtyä¸ä¸ºnilï¼Œè€Œä¸”è¿™ä¸ªentryä¸å­˜åœ¨äºm.dirtyä¸­</span><br><span class="line">//å…¶å®ƒï¼š entryæ˜¯ä¸€ä¸ªæ­£å¸¸çš„å€¼</span><br><span class="line">p unsafe.Pointer // *interface&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Value"><a href="#Value" class="headerlink" title="Value"></a>Value</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// A Value provides an atomic load and store of a consistently typed value.</span><br><span class="line">// Values can be created as part of other data structures.</span><br><span class="line">// The zero value for a Value returns nil from Load.</span><br><span class="line">// Once Store has been called, a Value must not be copied.</span><br><span class="line">//</span><br><span class="line">// A Value must not be copied after first use.</span><br><span class="line">type Value struct &#123;</span><br><span class="line">noCopy noCopy</span><br><span class="line"></span><br><span class="line">v interface&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img alt data-src="/images/go-sync-map/map%E7%BB%93%E6%9E%84%E5%85%B3%E7%B3%BB%E7%A4%BA%E6%84%8F%E5%9B%BE"></p><h1 id="Load"><a href="#Load" class="headerlink" title="Load"></a>Load</h1><p>æ®æŒ‡å®šçš„key,æŸ¥æ‰¾å¯¹åº”çš„å€¼value,å¦‚æœä¸å­˜åœ¨ï¼Œé€šè¿‡okåæ˜ ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">func (m *Map) Load(key interface&#123;&#125;) (value interface&#123;&#125;, ok bool) &#123;</span><br><span class="line">read, _ := m.read.Load().(readOnly)</span><br><span class="line">e, ok := read.m[key]</span><br><span class="line">// å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå¹¶ä¸”m.dirtyä¸­æœ‰æ–°æ•°æ®ï¼Œéœ€è¦ä»m.dirtyæŸ¥æ‰¾ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦åŠ é”</span><br><span class="line">if !ok &amp;&amp; read.amended &#123;</span><br><span class="line">m.mu.Lock()</span><br><span class="line">// Avoid reporting a spurious miss if m.dirty got promoted while we were</span><br><span class="line">// blocked on m.mu. (If further loads of the same key will not miss, it&apos;s</span><br><span class="line">// not worth copying the dirty map for this key.)</span><br><span class="line">//double check,é¿å…åŠ é”çš„æ—¶å€™m.dirtyæå‡ä¸ºm.read,è¿™ä¸ªæ—¶å€™m.readå¯èƒ½è¢«æ›¿æ¢äº†ã€‚</span><br><span class="line">read, _ = m.read.Load().(readOnly)</span><br><span class="line">e, ok = read.m[key]</span><br><span class="line">if !ok &amp;&amp; read.amended &#123;</span><br><span class="line">e, ok = m.dirty[key]</span><br><span class="line">// Regardless of whether the entry was present, record a miss: this key</span><br><span class="line">// will take the slow path until the dirty map is promoted to the read</span><br><span class="line">// map.</span><br><span class="line">m.missLocked()</span><br><span class="line">&#125;</span><br><span class="line">m.mu.Unlock()</span><br><span class="line">&#125;</span><br><span class="line">if !ok &#123;</span><br><span class="line">return nil, false</span><br><span class="line">&#125;</span><br><span class="line">return e.load()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (m *Map) missLocked() &#123;</span><br><span class="line">m.misses++</span><br><span class="line">if m.misses &lt; len(m.dirty) &#123;</span><br><span class="line">return</span><br><span class="line">&#125;</span><br><span class="line">m.read.Store(readOnly&#123;m: m.dirty&#125;)</span><br><span class="line">m.dirty = nil</span><br><span class="line">m.misses = 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img alt data-src="/images/go-sync-map/get%E6%B5%81%E7%A8%8B%E5%9B%BE.png"></p><h1 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h1><p>æ›´æ–°æˆ–è€…æ–°å¢ä¸€ä¸ªentry</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">// Store sets the value for a key.</span><br><span class="line">func (m *Map) Store(key, value interface&#123;&#125;) &#123;</span><br><span class="line">read, _ := m.read.Load().(readOnly)</span><br><span class="line">// ä» read map ä¸­è¯»å– key æˆåŠŸå¹¶ä¸”å–å‡ºçš„ entry å°è¯•å­˜å‚¨ value æˆåŠŸï¼Œç›´æ¥è¿”å›</span><br><span class="line">if e, ok := read.m[key]; ok &amp;&amp; e.tryStore(&amp;value) &#123;</span><br><span class="line">return</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">m.mu.Lock()</span><br><span class="line">read, _ = m.read.Load().(readOnly)</span><br><span class="line">if e, ok := read.m[key]; ok &#123;</span><br><span class="line">if e.unexpungeLocked() &#123;//ç¡®ä¿æœªè¢«æ ‡è®°æˆåˆ é™¤ï¼Œå³e æŒ‡å‘çš„æ˜¯é nil çš„</span><br><span class="line">// The entry was previously expunged, which implies that there is a</span><br><span class="line">// non-nil dirty map and this entry is not in it.</span><br><span class="line">//m.dirtyä¸­ä¸å­˜åœ¨è¿™ä¸ªé”®ï¼Œæ‰€ä»¥åŠ å…¥m.dirty</span><br><span class="line">m.dirty[key] = e</span><br><span class="line">&#125;</span><br><span class="line">e.storeLocked(&amp;value)</span><br><span class="line">&#125; else if e, ok := m.dirty[key]; ok &#123;</span><br><span class="line">e.storeLocked(&amp;value)</span><br><span class="line">&#125; else &#123;</span><br><span class="line">if !read.amended &#123;</span><br><span class="line">// We&apos;re adding the first new key to the dirty map.</span><br><span class="line">// Make sure it is allocated and mark the read-only map as incomplete.</span><br><span class="line">m.dirtyLocked()</span><br><span class="line">m.read.Store(readOnly&#123;m: read.m, amended: true&#125;)</span><br><span class="line">&#125;</span><br><span class="line">m.dirty[key] = newEntry(value)</span><br><span class="line">&#125;</span><br><span class="line">m.mu.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// tryStore stores a value if the entry has not been expunged.</span><br><span class="line">//</span><br><span class="line">// If the entry is expunged, tryStore returns false and leaves the entry</span><br><span class="line">// unchanged.</span><br><span class="line">func (e *entry) tryStore(i *interface&#123;&#125;) bool &#123;</span><br><span class="line">p := atomic.LoadPointer(&amp;e.p)</span><br><span class="line">if p == expunged &#123;</span><br><span class="line">return false</span><br><span class="line">&#125;</span><br><span class="line">for &#123;</span><br><span class="line">if atomic.CompareAndSwapPointer(&amp;e.p, p, unsafe.Pointer(i)) &#123;</span><br><span class="line">return true</span><br><span class="line">&#125;</span><br><span class="line">p = atomic.LoadPointer(&amp;e.p)</span><br><span class="line">if p == expunged &#123;</span><br><span class="line">return false</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func (m *Map) dirtyLocked() &#123;</span><br><span class="line">if m.dirty != nil &#123;</span><br><span class="line">return</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">read, _ := m.read.Load().(readOnly)</span><br><span class="line">m.dirty = make(map[interface&#123;&#125;]*entry, len(read.m))</span><br><span class="line">for k, e := range read.m &#123;</span><br><span class="line">if !e.tryExpungeLocked() &#123;</span><br><span class="line">m.dirty[k] = e</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (e *entry) tryExpungeLocked() (isExpunged bool) &#123;</span><br><span class="line">p := atomic.LoadPointer(&amp;e.p)</span><br><span class="line">for p == nil &#123;</span><br><span class="line"> // å°†å·²ç»åˆ é™¤æ ‡è®°ä¸ºnilçš„æ•°æ®æ ‡è®°ä¸ºexpunged</span><br><span class="line">if atomic.CompareAndSwapPointer(&amp;e.p, nil, expunged) &#123;</span><br><span class="line">return true</span><br><span class="line">&#125;</span><br><span class="line">p = atomic.LoadPointer(&amp;e.p)</span><br><span class="line">&#125;</span><br><span class="line">return p == expunged</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// unexpungeLocked ensures that the entry is not marked as expunged.</span><br><span class="line">// If the entry was previously expunged, it must be added to the dirty map</span><br><span class="line">// before m.mu is unlocked.</span><br><span class="line"></span><br><span class="line">// unexpungeLocked å‡½æ•°ç¡®ä¿äº† entry æ²¡æœ‰è¢«æ ‡è®°æˆå·²è¢«æ¸…é™¤ã€‚</span><br><span class="line">// å¦‚æœ entry å…ˆå‰è¢«æ¸…é™¤è¿‡äº†ï¼Œé‚£ä¹ˆåœ¨ mutex è§£é”ä¹‹å‰ï¼Œå®ƒä¸€å®šè¦è¢«åŠ å…¥åˆ° dirty map ä¸­</span><br><span class="line"></span><br><span class="line">//å¦‚æœ entry çš„ unexpungeLocked è¿”å›ä¸º trueï¼Œé‚£ä¹ˆå°±è¯´æ˜ entry </span><br><span class="line">//ä¹‹å‰è¢«æ ‡è®°æˆäº† expungedï¼Œå¹¶ç»è¿‡ CAS æ“ä½œæˆåŠŸæŠŠå®ƒç½®ä¸º nilã€‚</span><br><span class="line">func (e *entry) unexpungeLocked() (wasExpunged bool) &#123;</span><br><span class="line">return atomic.CompareAndSwapPointer(&amp;e.p, expunged, nil)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img alt data-src="/images/go-sync-map/store%E6%B5%81%E7%A8%8B%E5%9B%BE.bmp"></p><h1 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h1><p>åˆ é™¤ä¸€ä¸ªé”®å€¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// Delete deletes the value for a key.</span><br><span class="line">func (m *Map) Delete(key interface&#123;&#125;) &#123;</span><br><span class="line">read, _ := m.read.Load().(readOnly)</span><br><span class="line">e, ok := read.m[key]</span><br><span class="line">if !ok &amp;&amp; read.amended &#123;</span><br><span class="line">m.mu.Lock()</span><br><span class="line">read, _ = m.read.Load().(readOnly)</span><br><span class="line">e, ok = read.m[key]</span><br><span class="line">if !ok &amp;&amp; read.amended &#123;</span><br><span class="line">delete(m.dirty, key)</span><br><span class="line">&#125;</span><br><span class="line">m.mu.Unlock()</span><br><span class="line">&#125;</span><br><span class="line">if ok &#123;</span><br><span class="line">e.delete()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (e *entry) delete() (hadValue bool) &#123;</span><br><span class="line">for &#123;</span><br><span class="line">p := atomic.LoadPointer(&amp;e.p)</span><br><span class="line">// å·²æ ‡è®°ä¸ºåˆ é™¤</span><br><span class="line">if p == nil || p == expunged &#123;</span><br><span class="line">return false</span><br><span class="line">&#125;</span><br><span class="line">// åŸå­æ“ä½œï¼Œe.pæ ‡è®°ä¸ºnil</span><br><span class="line">if atomic.CompareAndSwapPointer(&amp;e.p, p, nil) &#123;</span><br><span class="line">return true</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img alt data-src="/images/go-sync-map/delete%E6%B5%81%E7%A8%8B%E5%9B%BE.png"></p><h1 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h1><h2 id="å·²ç»åˆ é™¤çš„key-å†æ¬¡Loadçš„æ—¶å€™ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ"><a href="#å·²ç»åˆ é™¤çš„key-å†æ¬¡Loadçš„æ—¶å€™ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ" class="headerlink" title="å·²ç»åˆ é™¤çš„key,å†æ¬¡Loadçš„æ—¶å€™ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ"></a>å·²ç»åˆ é™¤çš„key,å†æ¬¡Loadçš„æ—¶å€™ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func (e *entry) load() (value interface&#123;&#125;, ok bool) &#123;</span><br><span class="line">p := atomic.LoadPointer(&amp;e.p)</span><br><span class="line">if p == nil || p == expunged &#123;</span><br><span class="line">return nil, false</span><br><span class="line">&#125;</span><br><span class="line">return *(*interface&#123;&#125;)(p), true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨Map Loadæ–¹æ³•ä¸­è°ƒç”¨e.load()æ—¶ï¼Œloadæ–¹æ³•ä¼šè¯†åˆ«è¯¥å€¼æ˜¯å¦å·²è¢«åˆ é™¤</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://studygolang.com/articles/10511" target="_blank" rel="noopener">https://studygolang.com/articles/10511</a><br><a href="http://www.jianshu.com/p/43e66dab535b" target="_blank" rel="noopener">http://www.jianshu.com/p/43e66dab535b</a></p>]]></content>
      
      
      <categories>
          
          <category> Go </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Sync </tag>
            
            <tag> Map </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºSpring AOPä¸IOCçš„ä¸ªäººæ€è€ƒ</title>
      <link href="/spring-aop-ioc-think.html"/>
      <url>/spring-aop-ioc-think.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨é˜…è¯»æœ¬æ–‡å‰ï¼Œå¼ºçƒˆå»ºè®®é˜…è¯»ï¼š<br><a href="http://www.jiankunking.com/java-jdk-aop.html" target="_blank" rel="noopener">Java JDK åŠ¨æ€ä»£ç†ï¼ˆAOPï¼‰ä½¿ç”¨åŠå®ç°åŸç†åˆ†æ</a></p><a id="more"></a><p>AOPæ˜¯Springæä¾›çš„å…³é”®ç‰¹æ€§ä¹‹ä¸€ã€‚AOPå³é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯OOPç¼–ç¨‹çš„æœ‰æ•ˆè¡¥å……ã€‚ä½¿ç”¨AOPæŠ€æœ¯ï¼Œå¯ä»¥å°†ä¸€äº›ç³»ç»Ÿæ€§ç›¸å…³çš„ç¼–ç¨‹å·¥ä½œï¼Œç‹¬ç«‹æå–å‡ºæ¥ï¼Œç‹¬ç«‹å®ç°ï¼Œç„¶åé€šè¿‡åˆ‡é¢åˆ‡å…¥è¿›ç³»ç»Ÿã€‚ä»è€Œé¿å…äº†åœ¨ä¸šåŠ¡é€»è¾‘çš„ä»£ç ä¸­æ··å…¥å¾ˆå¤šçš„ç³»ç»Ÿç›¸å…³çš„é€»è¾‘â€”â€”æ¯”å¦‚æƒé™ç®¡ç†ï¼Œäº‹ç‰©ç®¡ç†ï¼Œæ—¥å¿—è®°å½•ç­‰ç­‰ã€‚è¿™äº›ç³»ç»Ÿæ€§çš„ç¼–ç¨‹å·¥ä½œéƒ½å¯ä»¥ç‹¬ç«‹ç¼–ç å®ç°ï¼Œç„¶åé€šè¿‡AOPæŠ€æœ¯åˆ‡å…¥è¿›ç³»ç»Ÿå³å¯ã€‚ä»è€Œè¾¾åˆ°äº†å°†ä¸åŒçš„å…³æ³¨ç‚¹åˆ†ç¦»å‡ºæ¥çš„æ•ˆæœã€‚<br><img alt data-src="/images/spring-jdk-aop-think/AOP%E7%A4%BA%E6%84%8F.png"><br>æœ¬æ–‡æ·±å…¥å‰–æSpringçš„AOPçš„åŸç†ã€‚</p><h1 id="ä¸€ã€AOP-çš„å®ç°åŸç†"><a href="#ä¸€ã€AOP-çš„å®ç°åŸç†" class="headerlink" title="ä¸€ã€AOP çš„å®ç°åŸç†"></a>ä¸€ã€AOP çš„å®ç°åŸç†</h1><p>AOPåˆ†ä¸ºé™æ€AOPå’ŒåŠ¨æ€AOPã€‚</p><p>é™æ€AOPæ˜¯æŒ‡AspectJå®ç°çš„AOPï¼Œä»–æ˜¯å°†åˆ‡é¢ä»£ç ç›´æ¥ç¼–è¯‘åˆ°Javaç±»æ–‡ä»¶ä¸­ã€‚</p><p>åŠ¨æ€AOPæ˜¯æŒ‡å°†åˆ‡é¢ä»£ç è¿›è¡ŒåŠ¨æ€ç»‡å…¥å®ç°çš„AOPã€‚</p><p>Springçš„AOPä¸ºåŠ¨æ€AOPï¼Œå®ç°çš„æŠ€æœ¯ä¸ºï¼šJDKæä¾›çš„åŠ¨æ€ä»£ç†æŠ€æœ¯ å’Œ CGLIB(åŠ¨æ€å­—èŠ‚ç å¢å¼ºæŠ€æœ¯)ã€‚å°½ç®¡å®ç°æŠ€æœ¯ä¸ä¸€æ ·ï¼Œä½†éƒ½æ˜¯åŸºäºä»£ç†æ¨¡å¼ï¼Œéƒ½æ˜¯ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚</p><h2 id="1ã€JDKåŠ¨æ€ä»£ç†"><a href="#1ã€JDKåŠ¨æ€ä»£ç†" class="headerlink" title="1ã€JDKåŠ¨æ€ä»£ç†"></a>1ã€JDKåŠ¨æ€ä»£ç†</h2><p>JDKéƒ¨åˆ†è§£æå‚è€ƒï¼š<br><a href="https://juejin.im/post/5d31c1b7f265da1b9421845d" target="_blank" rel="noopener">Java JDK åŠ¨æ€ä»£ç†ï¼ˆAOPï¼‰ä½¿ç”¨åŠå®ç°åŸç†åˆ†æ</a></p><h2 id="2ã€CGLIBï¼ˆcode-generate-libaryï¼‰"><a href="#2ã€CGLIBï¼ˆcode-generate-libaryï¼‰" class="headerlink" title="2ã€CGLIBï¼ˆcode generate libaryï¼‰"></a>2ã€CGLIBï¼ˆcode generate libaryï¼‰</h2><p>å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯å®ç°AOPï¼Œå…¶å®å°±æ˜¯ç»§æ‰¿è¢«ä»£ç†å¯¹è±¡ï¼Œç„¶åOverrideéœ€è¦è¢«ä»£ç†çš„æ–¹æ³•ï¼Œåœ¨è¦†ç›–è¯¥æ–¹æ³•æ—¶ï¼Œè‡ªç„¶æ˜¯å¯ä»¥æ’å…¥æˆ‘ä»¬è‡ªå·±çš„ä»£ç çš„ã€‚</p><p><font color="DeepPink">å› ä¸ºéœ€è¦Overrideè¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œæ‰€ä»¥è‡ªç„¶CGLIBæŠ€æœ¯å®ç°AOPæ—¶ï¼Œå°±å¿…é¡»è¦æ±‚éœ€è¦è¢«ä»£ç†çš„æ–¹æ³•ä¸èƒ½æ˜¯finalæ–¹æ³•ï¼Œå› ä¸ºfinalæ–¹æ³•ä¸èƒ½è¢«å­ç±»è¦†ç›–ã€‚</font></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">package net.aazj.aop;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import net.sf.cglib.proxy.Enhancer;</span><br><span class="line">import net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line">import net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"></span><br><span class="line">public class CGProxy implements MethodInterceptor&#123;</span><br><span class="line">    private Object target;    // è¢«ä»£ç†å¯¹è±¡</span><br><span class="line">    public CGProxy(Object target)&#123;</span><br><span class="line">        this.target = target;</span><br><span class="line">    &#125;</span><br><span class="line">    public Object intercept(Object obj, java.lang.reflect.Method method, Object[] args, MethodProxy proxy) throws Throwable &#123;</span><br><span class="line">        System.out.println(&quot;do sth before....&quot;);</span><br><span class="line">        Object result = proxy.invokeSuper(obj, args);</span><br><span class="line">        System.out.println(&quot;do sth after....&quot;);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    public Object getProxyObject() &#123;</span><br><span class="line">        Enhancer enhancer = new Enhancer();</span><br><span class="line">        // è®¾ç½®çˆ¶ç±»</span><br><span class="line">        enhancer.setSuperclass(this.target.getClass());    </span><br><span class="line">        // è®¾ç½®å›è°ƒ</span><br><span class="line">        enhancer.setCallback(this);    // åœ¨è°ƒç”¨çˆ¶ç±»æ–¹æ³•æ—¶ï¼Œå›è°ƒ this.intercept()</span><br><span class="line">        // åˆ›å»ºä»£ç†å¯¹è±¡</span><br><span class="line">        return enhancer.create();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public interface UserService &#123;</span><br><span class="line">    public void addUser(User user);</span><br><span class="line">    public User getUser(int id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class UserServiceImpl implements UserService &#123;</span><br><span class="line">    public void addUser(User user) &#123;</span><br><span class="line">        System.out.println(&quot;add user into database.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public User getUser(int id) &#123;</span><br><span class="line">        User user = new User();</span><br><span class="line">        user.setId(id);</span><br><span class="line">        System.out.println(&quot;getUser from database.&quot;);</span><br><span class="line">        return user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class CGProxyTest &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">         // è¢«ä»£ç†çš„å¯¹è±¡</span><br><span class="line">        Object proxyedObject = new UserServiceImpl();   </span><br><span class="line">        CGProxy cgProxy = new CGProxy(proxyedObject);</span><br><span class="line">        UserService proxyObject = (UserService) cgProxy.getProxyObject();</span><br><span class="line">        proxyObject.getUser(1);</span><br><span class="line">        proxyObject.addUser(new User());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">do sth before....</span><br><span class="line">getUser from database.</span><br><span class="line">do sth after....</span><br><span class="line">do sth before....</span><br><span class="line">add user into database.</span><br><span class="line">do sth after....</span><br></pre></td></tr></table></figure><p>å®ƒçš„åŸç†æ˜¯ï¼šç”Ÿæˆä¸€ä¸ªçˆ¶ç±»<br>enhancer.setSuperclass(this.target.getClass())<br>çš„å­ç±»enhancer.create(),ç„¶åå¯¹çˆ¶ç±»çš„æ–¹æ³•è¿›è¡Œæ‹¦æˆªenhancer.setCallback(this). </p><h1 id="äºŒã€æ€è€ƒ"><a href="#äºŒã€æ€è€ƒ" class="headerlink" title="äºŒã€æ€è€ƒ"></a>äºŒã€æ€è€ƒ</h1><p>ä»ä»¥ä¸Šä¸¤ç§ä»£ç†æ–¹å¼å¯ä»¥çœ‹å‡ºï¼Œ<font color="DeepPink">å®ç°AOPçš„å…³é”®æ˜¯ï¼šåŠ¨æ€ä»£ç†ï¼Œå³å°†éœ€è¦ç”¨çš„æ¥å£ã€ç±»å†åŒ…è£…ä¸€å±‚ï¼Œé€šè¿‡åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç æ–‡ä»¶å®ç°å„ç§æ‹¦æˆªä¸é€šçŸ¥ã€‚</font></p><p><font color="DeepPink">æ³¨æ„ï¼Œä¸¤è€…(JDKåŠ¨æ€ä»£ç†ã€CGLIB)éƒ½éœ€è¦ï¼šè¦ä»£ç†çœŸå®å¯¹è±¡çš„å®ä¾‹ã€‚</font></p><p>æ¯”å¦‚ï¼šåœ¨Spring MVCçš„Controllerå±‚ä¸€èˆ¬@Autowiredæ˜¯Serviceæ¥å£ï¼Œä½†å¸¦æœ‰@Serviceæ ‡è¯†çš„å´æ˜¯å®ç°Serviceæ¥å£çš„å®ä½“ç±»ï¼Œè¿™æ ·å¯¹äºJDKåŠ¨æ€ä»£ç†æ¥è¯´å·²ç»è¶³ä»¥ç”Ÿæˆä»£ç†ç±»äº†(å…¶å®ï¼Œä¸è¿‡æ˜¯cglibè¿˜æ˜¯jdkçš„åŠ¨æ€ä»£ç†ï¼Œä½ ç›´æ¥@Autowired Serviceæ¥å£å®ç°ç±»ï¼Œä¹Ÿæ˜¯å¯ä»¥æ³¨å…¥æˆåŠŸçš„ï¼Œä½†ä¸å¦‚æ³¨å…¥Serviceæ¥å£çµæ´»)ï¼Œå¤§å®¶åœ¨è·Ÿè¸ªä»£ç çš„æ—¶å€™å¯ä»¥çœ‹ä¸€ä¸‹Springæ³¨å…¥çš„beançœŸæ­£çš„ç±»å‹ï¼Œä½ å°±å¯ä»¥å‘ç°å®ƒæ˜¯ä»£ç†ç”Ÿæˆçš„å®ä¾‹ã€‚ </p><p>æ¯”å¦‚è¿™ç§ï¼š </p><p><img alt data-src="/images/spring-jdk-aop-think/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B.png"></p><p>å¸¦æœ‰æ³¨è§£æ ‡è¯†çš„æ¥å£æˆ–è€…åœ¨Spring.XMLä¸­é…ç½®çš„beanä¼šåœ¨Springåˆå§‹åŒ–çš„æ—¶å€™ï¼Œè¢«Springé€šè¿‡åå°„åŠ è½½å®ä¾‹åŒ–åˆ°Springå®¹å™¨ä¸­ã€‚</p><blockquote><p>åšè¿‡Client/Serveræ¶æ„å¼€å‘çš„æœ‹å‹åº”è¯¥çŸ¥é“ï¼Œåœ¨Applicationè¿è¡Œè¿‡ç¨‹ä¸­ä¸€èˆ¬éƒ½ä¼šæœ‰ä¸€ä¸ªåº”ç”¨ä¸Šä¸‹æ–‡Contextï¼Œä¸€èˆ¬å°†ä¸€äº›ç³»ç»Ÿä¿¡æ¯æ”¾åœ¨é‡Œé¢ï¼Œæ¯”å¦‚ä¸€äº›ç™»å½•ä¿¡æ¯ã€WCFè¿æ¥å®ä¾‹ç­‰ã€‚è¿™äº›ä¿¡æ¯åœ¨ç³»ç»Ÿçš„ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥å–åˆ°ï¼ˆå…¶å®å°±æ˜¯ä¸€äº›é¡¶çº§å˜é‡é›†åˆï¼Œç”Ÿå‘½å‘¨æœŸæœ€é•¿çš„ä¸€äº›å®¶ä¼™ï¼‰ã€‚</p></blockquote><blockquote><p>æ¢ä¸ªè§’åº¦æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬åœ¨Applicationåˆå§‹åŒ–çš„æ—¶å€™ï¼Œç”¨åå°„ï¼ˆè·å–è¦ä»£ç†å¯¹è±¡çš„å®ä¾‹ï¼‰å’ŒåŠ¨æ€ä»£ç†è·å–æœ‰æ³¨è§£æ ‡è¯†æˆ–è€…åœ¨xmlä¸­é…ç½®beançš„å®ä¾‹ï¼Œå¹¶æ”¾åˆ°åº”ç”¨ä¸Šä¸‹æ–‡Contextä¸­ï¼Œåœ¨éœ€è¦çš„åœ°æ–¹éƒ½èƒ½å–åˆ°ï¼Œè¿™ä¸å°±æ˜¯ä¸€ä¸ªç®€å•ç‰ˆçš„Spring å®¹å™¨å—ï¼Ÿ</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JDK </tag>
            
            <tag> Spring </tag>
            
            <tag> AOP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-JDK-åŠ¨æ€ä»£ç†ï¼ˆAOPï¼‰ä½¿ç”¨åŠå®ç°åŸç†åˆ†æ</title>
      <link href="/java-jdk-aop.html"/>
      <url>/java-jdk-aop.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€ä»€ä¹ˆæ˜¯ä»£ç†ï¼Ÿ"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯ä»£ç†ï¼Ÿ" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯ä»£ç†ï¼Ÿ"></a>ä¸€ã€ä»€ä¹ˆæ˜¯ä»£ç†ï¼Ÿ</h1><p>ä»£ç†æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œå…¶ç›®çš„å°±æ˜¯ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ä»¥æ§åˆ¶å¯¹æŸä¸ªå¯¹è±¡çš„è®¿é—®ã€‚ä»£ç†ç±»è´Ÿè´£ä¸ºå§”æ‰˜ç±»é¢„å¤„ç†æ¶ˆæ¯ï¼Œè¿‡æ»¤æ¶ˆæ¯å¹¶è½¬å‘æ¶ˆæ¯ï¼Œä»¥åŠè¿›è¡Œæ¶ˆæ¯è¢«å§”æ‰˜ç±»æ‰§è¡Œåçš„åç»­å¤„ç†ã€‚</p><p>ä»£ç†æ¨¡å¼UMLå›¾ï¼š</p><p><img alt data-src="/images/spring-jdk-aop/UML.png"><br>ç®€å•ç»“æ„ç¤ºæ„å›¾ï¼š</p><p><img alt data-src="/images/spring-jdk-aop/%E7%AE%80%E5%8D%95%E7%A4%BA%E6%84%8F%E5%9B%BE.png"><br>ä¸ºäº†ä¿æŒè¡Œä¸ºçš„ä¸€è‡´æ€§ï¼Œä»£ç†ç±»å’Œå§”æ‰˜ç±»é€šå¸¸ä¼šå®ç°ç›¸åŒçš„æ¥å£ï¼Œæ‰€ä»¥åœ¨è®¿é—®è€…çœ‹æ¥ä¸¤è€…æ²¡æœ‰ä¸æ¯«çš„åŒºåˆ«ã€‚é€šè¿‡ä»£ç†ç±»è¿™ä¸­é—´ä¸€å±‚ï¼Œèƒ½æœ‰æ•ˆæ§åˆ¶å¯¹å§”æ‰˜ç±»å¯¹è±¡çš„ç›´æ¥è®¿é—®ï¼Œä¹Ÿå¯ä»¥å¾ˆå¥½åœ°éšè—å’Œä¿æŠ¤å§”æ‰˜ç±»å¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿä¸ºå®æ–½ä¸åŒæ§åˆ¶ç­–ç•¥é¢„ç•™äº†ç©ºé—´ï¼Œä»è€Œåœ¨è®¾è®¡ä¸Šè·å¾—äº†æ›´å¤§çš„çµæ´»æ€§ã€‚Java åŠ¨æ€ä»£ç†æœºåˆ¶ä»¥å·§å¦™çš„æ–¹å¼è¿‘ä¹å®Œç¾åœ°å®è·µäº†ä»£ç†æ¨¡å¼çš„è®¾è®¡ç†å¿µã€‚</p><h1 id="äºŒã€Java-åŠ¨æ€ä»£ç†ç±»"><a href="#äºŒã€Java-åŠ¨æ€ä»£ç†ç±»" class="headerlink" title="äºŒã€Java åŠ¨æ€ä»£ç†ç±»"></a>äºŒã€Java åŠ¨æ€ä»£ç†ç±»</h1><p>JavaåŠ¨æ€ä»£ç†ç±»ä½äºjava.lang.reflectåŒ…ä¸‹ï¼Œä¸€èˆ¬ä¸»è¦æ¶‰åŠåˆ°ä»¥ä¸‹ä¸¤ä¸ªç±»ï¼š</p><p>(1)Interface InvocationHandlerï¼šè¯¥æ¥å£ä¸­ä»…å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public object invoke(Object obj,Method method, Object[] args)</span><br></pre></td></tr></table></figure><p>åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œ<font color="DeepPink">ç¬¬ä¸€ä¸ªå‚æ•°objä¸€èˆ¬æ˜¯æŒ‡ä»£ç†ç±»ï¼Œmethodæ˜¯è¢«ä»£ç†çš„æ–¹æ³•ï¼Œå¦‚ä¸Šä¾‹ä¸­çš„request()ï¼Œargsä¸ºè¯¥æ–¹æ³•çš„å‚æ•°æ•°ç»„ã€‚</font>è¿™ä¸ªæŠ½è±¡æ–¹æ³•åœ¨ä»£ç†ç±»ä¸­åŠ¨æ€å®ç°ã€‚</p><p>(2)Proxyï¼šè¯¥ç±»å³ä¸ºåŠ¨æ€ä»£ç†ç±»ï¼Œå…¶ä¸­ä¸»è¦åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><p>protected Proxy(InvocationHandler h)ï¼šæ„é€ å‡½æ•°ï¼Œç”¨äºç»™å†…éƒ¨çš„hèµ‹å€¼ã€‚</p><p>static Class getProxyClass(</p><p>ClassLoader loader,</p><p>Class[] interfaces)ï¼šè·å¾—ä¸€ä¸ªä»£ç†ç±»ï¼Œå…¶ä¸­loaderæ˜¯ç±»è£…è½½å™¨ï¼Œinterfacesæ˜¯çœŸå®ç±»æ‰€æ‹¥æœ‰çš„å…¨éƒ¨æ¥å£çš„æ•°ç»„ã€‚</p><p>static Object newProxyInstance(ClassLoaderloader, Class[] interfaces,InvocationHandler h)ï¼šè¿”å›ä»£ç†ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œè¿”å›åçš„ä»£ç†ç±»å¯ä»¥å½“ä½œè¢«ä»£ç†ç±»ä½¿ç”¨(å¯ä½¿ç”¨è¢«ä»£ç†ç±»çš„åœ¨Subjectæ¥å£ä¸­å£°æ˜è¿‡çš„æ–¹æ³•)</p><p>æ‰€è°“DynamicProxyæ˜¯è¿™æ ·ä¸€ç§classï¼š<font color="DeepPink">å®ƒæ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„classï¼Œåœ¨ç”Ÿæˆå®ƒæ—¶ä½ å¿…é¡»æä¾›ä¸€ç»„interfaceç»™å®ƒï¼Œç„¶åè¯¥classå°±å®£ç§°å®ƒå®ç°äº†è¿™äº›interfaceã€‚</font>ä½ å½“ç„¶å¯ä»¥æŠŠè¯¥classçš„å®ä¾‹å½“ä½œè¿™äº›interfaceä¸­çš„ä»»ä½•ä¸€ä¸ªæ¥ç”¨ã€‚å½“ç„¶ï¼Œè¿™ä¸ªDynamicProxyå…¶å®å°±æ˜¯ä¸€ä¸ªProxyï¼Œå®ƒä¸ä¼šæ›¿ä½ ä½œå®è´¨æ€§çš„å·¥ä½œï¼Œ<font color="DeepPink">åœ¨ç”Ÿæˆå®ƒçš„å®ä¾‹æ—¶ä½ å¿…é¡»æä¾›ä¸€ä¸ªhandlerï¼Œç”±å®ƒæ¥ç®¡å®é™…çš„å·¥ä½œã€‚</font></p><p>åœ¨ä½¿ç”¨åŠ¨æ€ä»£ç†ç±»æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»å®ç°InvocationHandleræ¥å£</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œè¢«ä»£ç†çš„å¯¹è±¡(RealSubject)å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ”¹å˜ï¼Œéœ€è¦æ§åˆ¶çš„æ¥å£(Subjectæ¥å£)å¯ä»¥åœ¨è¿è¡Œæ—¶æ”¹å˜ï¼Œæ§åˆ¶çš„æ–¹å¼(DynamicSubjectç±»)ä¹Ÿå¯ä»¥åŠ¨æ€æ”¹å˜ï¼Œä»è€Œå®ç°äº†éå¸¸çµæ´»çš„åŠ¨æ€ä»£ç†å…³ç³»ã€‚</p><p>åŠ¨æ€ä»£ç†æ­¥éª¤ï¼š</p><ol><li><p>åˆ›å»ºä¸€ä¸ªå®ç°æ¥å£InvocationHandlerçš„ç±»ï¼Œå®ƒå¿…é¡»å®ç°invokeæ–¹æ³•</p></li><li><p>åˆ›å»ºè¢«ä»£ç†çš„ç±»ä»¥åŠæ¥å£</p></li><li><p>é€šè¿‡Proxyçš„é™æ€æ–¹æ³•</p></li></ol><p>newProxyInstance(ClassLoaderloader,Class[]interfaces,InvocationHandler h)åˆ›å»ºä¸€ä¸ªä»£ç†</p><ol start="4"><li>é€šè¿‡ä»£ç†è°ƒç”¨æ–¹æ³•</li></ol><h1 id="ä¸‰ã€JDKçš„åŠ¨æ€ä»£ç†æ€ä¹ˆä½¿ç”¨ï¼Ÿ"><a href="#ä¸‰ã€JDKçš„åŠ¨æ€ä»£ç†æ€ä¹ˆä½¿ç”¨ï¼Ÿ" class="headerlink" title="ä¸‰ã€JDKçš„åŠ¨æ€ä»£ç†æ€ä¹ˆä½¿ç”¨ï¼Ÿ"></a>ä¸‰ã€JDKçš„åŠ¨æ€ä»£ç†æ€ä¹ˆä½¿ç”¨ï¼Ÿ</h1><p>1ã€éœ€è¦åŠ¨æ€ä»£ç†çš„æ¥å£ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package jiankunking;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * éœ€è¦åŠ¨æ€ä»£ç†çš„æ¥å£</span><br><span class="line"> */</span><br><span class="line">public interface Subject &#123;</span><br><span class="line">    /**</span><br><span class="line">     * ä½ å¥½</span><br><span class="line">     *</span><br><span class="line">     * @param name</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String SayHello(String name);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * å†è§</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String SayGoodBye();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€éœ€è¦ä»£ç†çš„å®é™…å¯¹è±¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">package jiankunking;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * å®é™…å¯¹è±¡</span><br><span class="line"> */</span><br><span class="line">public class RealSubject implements Subject &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * ä½ å¥½</span><br><span class="line">     *</span><br><span class="line">     * @param name</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public String SayHello(String name) &#123;</span><br><span class="line">        return &quot;hello &quot; + name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * å†è§</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public String SayGoodBye() &#123;</span><br><span class="line">        return &quot; good bye &quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€è°ƒç”¨å¤„ç†å™¨å®ç°ç±»ï¼ˆæœ‰æœ¨æœ‰æ„Ÿè§‰è¿™é‡Œå°±æ˜¯ä¼ è¯´ä¸­çš„AOPå•Šï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">package jiankunking;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.InvocationHandler;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è°ƒç”¨å¤„ç†å™¨å®ç°ç±»</span><br><span class="line"> * æ¯æ¬¡ç”ŸæˆåŠ¨æ€ä»£ç†ç±»å¯¹è±¡æ—¶éƒ½éœ€è¦æŒ‡å®šä¸€ä¸ªå®ç°äº†è¯¥æ¥å£çš„è°ƒç”¨å¤„ç†å™¨å¯¹è±¡</span><br><span class="line"> */</span><br><span class="line">public class InvocationHandlerImpl implements InvocationHandler &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬è¦ä»£ç†çš„çœŸå®å¯¹è±¡</span><br><span class="line">     */</span><br><span class="line">    private Object subject;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * æ„é€ æ–¹æ³•ï¼Œç»™æˆ‘ä»¬è¦ä»£ç†çš„çœŸå®å¯¹è±¡èµ‹åˆå€¼</span><br><span class="line">     *</span><br><span class="line">     * @param subject</span><br><span class="line">     */</span><br><span class="line">    public InvocationHandlerImpl(Object subject) &#123;</span><br><span class="line">        this.subject = subject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * è¯¥æ–¹æ³•è´Ÿè´£é›†ä¸­å¤„ç†åŠ¨æ€ä»£ç†ç±»ä¸Šçš„æ‰€æœ‰æ–¹æ³•è°ƒç”¨ã€‚</span><br><span class="line">     * è°ƒç”¨å¤„ç†å™¨æ ¹æ®è¿™ä¸‰ä¸ªå‚æ•°è¿›è¡Œé¢„å¤„ç†æˆ–åˆ†æ´¾åˆ°å§”æ‰˜ç±»å®ä¾‹ä¸Šåå°„æ‰§è¡Œ</span><br><span class="line">     *</span><br><span class="line">     * @param proxy  ä»£ç†ç±»å®ä¾‹</span><br><span class="line">     * @param method è¢«è°ƒç”¨çš„æ–¹æ³•å¯¹è±¡</span><br><span class="line">     * @param args   è°ƒç”¨å‚æ•°</span><br><span class="line">     * @return</span><br><span class="line">     * @throws Throwable</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line">        //åœ¨ä»£ç†çœŸå®å¯¹è±¡å‰æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€äº›è‡ªå·±çš„æ“ä½œ</span><br><span class="line">        System.out.println(&quot;åœ¨è°ƒç”¨ä¹‹å‰ï¼Œæˆ‘è¦å¹²ç‚¹å•¥å‘¢ï¼Ÿ&quot;);</span><br><span class="line">        System.out.println(&quot;Method:&quot; + method);</span><br><span class="line">        //å½“ä»£ç†å¯¹è±¡è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå…¶ä¼šè‡ªåŠ¨çš„è·³è½¬åˆ°ä»£ç†å¯¹è±¡å…³è”çš„handlerå¯¹è±¡çš„invokeæ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨</span><br><span class="line">        Object returnValue = method.invoke(subject, args);</span><br><span class="line">        //åœ¨ä»£ç†çœŸå®å¯¹è±¡åæˆ‘ä»¬ä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›è‡ªå·±çš„æ“ä½œ</span><br><span class="line">        System.out.println(&quot;åœ¨è°ƒç”¨ä¹‹åï¼Œæˆ‘è¦å¹²ç‚¹å•¥å‘¢ï¼Ÿ&quot;);</span><br><span class="line">        return returnValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€æµ‹è¯•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package jiankunking;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.InvocationHandler;</span><br><span class="line">import java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * åŠ¨æ€ä»£ç†æ¼”ç¤º</span><br><span class="line"> */</span><br><span class="line">public class DynamicProxyDemonstration &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        //ä»£ç†çš„çœŸå®å¯¹è±¡</span><br><span class="line">        Subject realSubject = new RealSubject();</span><br><span class="line">        /**</span><br><span class="line">         * InvocationHandlerImpl å®ç°äº† InvocationHandler æ¥å£ï¼Œå¹¶èƒ½å®ç°æ–¹æ³•è°ƒç”¨ä»ä»£ç†ç±»åˆ°å§”æ‰˜ç±»çš„åˆ†æ´¾è½¬å‘</span><br><span class="line">         * å…¶å†…éƒ¨é€šå¸¸åŒ…å«æŒ‡å‘å§”æ‰˜ç±»å®ä¾‹çš„å¼•ç”¨ï¼Œç”¨äºçœŸæ­£æ‰§è¡Œåˆ†æ´¾è½¬å‘è¿‡æ¥çš„æ–¹æ³•è°ƒç”¨.</span><br><span class="line">         * å³ï¼šè¦ä»£ç†å“ªä¸ªçœŸå®å¯¹è±¡ï¼Œå°±å°†è¯¥å¯¹è±¡ä¼ è¿›å»ï¼Œæœ€åæ˜¯é€šè¿‡è¯¥çœŸå®å¯¹è±¡æ¥è°ƒç”¨å…¶æ–¹æ³•</span><br><span class="line">         */</span><br><span class="line">        InvocationHandler handler = new InvocationHandlerImpl(realSubject);</span><br><span class="line"></span><br><span class="line">        ClassLoader loader = handler.getClass().getClassLoader();</span><br><span class="line">        Class&lt;?&gt;[] interfaces = realSubject.getClass().getInterfaces();</span><br><span class="line">        /**</span><br><span class="line">         * è¯¥æ–¹æ³•ç”¨äºä¸ºæŒ‡å®šç±»è£…è½½å™¨ã€ä¸€ç»„æ¥å£åŠè°ƒç”¨å¤„ç†å™¨ç”ŸæˆåŠ¨æ€ä»£ç†ç±»å®ä¾‹</span><br><span class="line">         */</span><br><span class="line">        Subject subject = (Subject) Proxy.newProxyInstance(loader, interfaces, handler);</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;åŠ¨æ€ä»£ç†å¯¹è±¡çš„ç±»å‹ï¼š&quot; + subject.getClass().getName());</span><br><span class="line"></span><br><span class="line">        String hello = subject.SayHello(&quot;jiankunking&quot;);</span><br><span class="line">        System.out.println(hello);</span><br><span class="line">//        String goodbye = subject.SayGoodBye();</span><br><span class="line">//        System.out.println(goodbye);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5ã€è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><p><img alt data-src="/images/spring-jdk-aop/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%BC%94%E7%A4%BA%E8%BE%93%E5%87%BA.png"></p><h1 id="å››ã€åŠ¨æ€ä»£ç†æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#å››ã€åŠ¨æ€ä»£ç†æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="å››ã€åŠ¨æ€ä»£ç†æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>å››ã€åŠ¨æ€ä»£ç†æ€ä¹ˆå®ç°çš„ï¼Ÿ</h1><p>ä»ä½¿ç”¨ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå…³é”®ç‚¹åœ¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Subject subject = (Subject) Proxy.newProxyInstance(loader, interfaces, handler);</span><br></pre></td></tr></table></figure><p>é€šè¿‡è·Ÿè¸ªæç¤ºä»£ç å¯ä»¥çœ‹å‡ºï¼š<font color="DeepPink">å½“ä»£ç†å¯¹è±¡è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå…¶ä¼šè‡ªåŠ¨çš„è·³è½¬åˆ°ä»£ç†å¯¹è±¡å…³è”çš„handlerå¯¹è±¡çš„invokeæ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ã€‚</font></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä»£ç æ‰§è¡Œåˆ°ï¼šsubject.SayHello(â€œjiankunkingâ€)è¿™å¥è¯æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨InvocationHandlerImplçš„invokeæ–¹æ³•ã€‚è¿™æ˜¯ä¸ºå•¥å‘¢ï¼Ÿ</p><blockquote><p>ä¸‹é¢æ˜¯ä»£ç è·Ÿåˆ†æçš„è¿‡ç¨‹ï¼Œä¸æƒ³çœ‹çš„æœ‹å‹å¯ä»¥ç›´æ¥çœ‹ç»“è®º</p></blockquote><p>ä»¥ä¸‹ä»£ç æ¥è‡ª:JDK1.8.0_92</p><p>æ—¢ç„¶ç”Ÿæˆä»£ç†å¯¹è±¡æ˜¯ç”¨çš„Proxyç±»çš„é™æ€æ–¹newProxyInstanceï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å»å®ƒçš„æºç é‡Œçœ‹ä¸€ä¸‹å®ƒåˆ°åº•éƒ½åšäº†äº›ä»€ä¹ˆï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Returns an instance of a proxy class for the specified interfaces</span><br><span class="line"> * that dispatches method invocations to the specified invocation</span><br><span class="line"> * handler.</span><br><span class="line"> *</span><br><span class="line"> * &lt;p&gt;&#123;@code Proxy.newProxyInstance&#125; throws</span><br><span class="line"> * &#123;@code IllegalArgumentException&#125; for the same reasons that</span><br><span class="line"> * &#123;@code Proxy.getProxyClass&#125; does.</span><br><span class="line"> *</span><br><span class="line"> * @param   loader the class loader to define the proxy class</span><br><span class="line"> * @param   interfaces the list of interfaces for the proxy class</span><br><span class="line"> *          to implement</span><br><span class="line"> * @param   h the invocation handler to dispatch method invocations to</span><br><span class="line"> * @return  a proxy instance with the specified invocation handler of a</span><br><span class="line"> *          proxy class that is defined by the specified class loader</span><br><span class="line"> *          and that implements the specified interfaces</span><br><span class="line"> * @throws  IllegalArgumentException if any of the restrictions on the</span><br><span class="line"> *          parameters that may be passed to &#123;@code getProxyClass&#125;</span><br><span class="line"> *          are violated</span><br><span class="line"> * @throws  SecurityException if a security manager, &lt;em&gt;s&lt;/em&gt;, is present</span><br><span class="line"> *          and any of the following conditions is met:</span><br><span class="line"> *          &lt;ul&gt;</span><br><span class="line"> *          &lt;li&gt; the given &#123;@code loader&#125; is &#123;@code null&#125; and</span><br><span class="line"> *               the caller&apos;s class loader is not &#123;@code null&#125; and the</span><br><span class="line"> *               invocation of &#123;@link SecurityManager#checkPermission</span><br><span class="line"> *               s.checkPermission&#125; with</span><br><span class="line"> *               &#123;@code RuntimePermission(&quot;getClassLoader&quot;)&#125; permission</span><br><span class="line"> *               denies access;&lt;/li&gt;</span><br><span class="line"> *          &lt;li&gt; for each proxy interface, &#123;@code intf&#125;,</span><br><span class="line"> *               the caller&apos;s class loader is not the same as or an</span><br><span class="line"> *               ancestor of the class loader for &#123;@code intf&#125; and</span><br><span class="line"> *               invocation of &#123;@link SecurityManager#checkPackageAccess</span><br><span class="line"> *               s.checkPackageAccess()&#125; denies access to &#123;@code intf&#125;;&lt;/li&gt;</span><br><span class="line"> *          &lt;li&gt; any of the given proxy interfaces is non-public and the</span><br><span class="line"> *               caller class is not in the same &#123;@linkplain Package runtime package&#125;</span><br><span class="line"> *               as the non-public interface and the invocation of</span><br><span class="line"> *               &#123;@link SecurityManager#checkPermission s.checkPermission&#125; with</span><br><span class="line"> *               &#123;@code ReflectPermission(&quot;newProxyInPackage.&#123;package name&#125;&quot;)&#125;</span><br><span class="line"> *               permission denies access.&lt;/li&gt;</span><br><span class="line"> *          &lt;/ul&gt;</span><br><span class="line"> * @throws  NullPointerException if the &#123;@code interfaces&#125; array</span><br><span class="line"> *          argument or any of its elements are &#123;@code null&#125;, or</span><br><span class="line"> *          if the invocation handler, &#123;@code h&#125;, is</span><br><span class="line"> *          &#123;@code null&#125;</span><br><span class="line"> */</span><br><span class="line">@CallerSensitive </span><br><span class="line">public static Object newProxyInstance(ClassLoader loader,</span><br><span class="line">                                          Class&lt;?&gt;[] interfaces,</span><br><span class="line">                                          InvocationHandler h) throws IllegalArgumentException &#123;</span><br><span class="line">        //æ£€æŸ¥h ä¸ä¸ºç©ºï¼Œå¦åˆ™æŠ›å¼‚å¸¸</span><br><span class="line">        Objects.requireNonNull(h);</span><br><span class="line"> </span><br><span class="line">        final Class&lt;?&gt;[] intfs = interfaces.clone();</span><br><span class="line">        final SecurityManager sm = System.getSecurityManager();</span><br><span class="line">        if (sm != null) &#123;</span><br><span class="line">            checkProxyAccess(Reflection.getCallerClass(), loader, intfs);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        /*</span><br><span class="line">         * è·å¾—ä¸æŒ‡å®šç±»è£…è½½å™¨å’Œä¸€ç»„æ¥å£ç›¸å…³çš„ä»£ç†ç±»ç±»å‹å¯¹è±¡</span><br><span class="line">         */</span><br><span class="line">        Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</span><br><span class="line"> </span><br><span class="line">        /*</span><br><span class="line">         * é€šè¿‡åå°„è·å–æ„é€ å‡½æ•°å¯¹è±¡å¹¶ç”Ÿæˆä»£ç†ç±»å®ä¾‹</span><br><span class="line">         */</span><br><span class="line">        try &#123;</span><br><span class="line">            if (sm != null) &#123;</span><br><span class="line">                checkNewProxyPermission(Reflection.getCallerClass(), cl);</span><br><span class="line">            &#125;</span><br><span class="line">            //è·å–ä»£ç†å¯¹è±¡çš„æ„é€ æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯$Proxy0(InvocationHandler h)ï¼‰ </span><br><span class="line">            final Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);</span><br><span class="line">            final InvocationHandler ih = h;</span><br><span class="line">            if (!Modifier.isPublic(cl.getModifiers())) &#123;</span><br><span class="line">                AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123;</span><br><span class="line">                    public Void run() &#123;</span><br><span class="line">                        cons.setAccessible(true);</span><br><span class="line">                        return null;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            //ç”Ÿæˆä»£ç†ç±»çš„å®ä¾‹å¹¶æŠŠInvocationHandlerImplçš„å®ä¾‹ä¼ ç»™å®ƒçš„æ„é€ æ–¹æ³•</span><br><span class="line">            return cons.newInstance(new Object[]&#123;h&#125;);</span><br><span class="line">        &#125; catch (IllegalAccessException|InstantiationException e) &#123;</span><br><span class="line">            throw new InternalError(e.toString(), e);</span><br><span class="line">        &#125; catch (InvocationTargetException e) &#123;</span><br><span class="line">            Throwable t = e.getCause();</span><br><span class="line">            if (t instanceof RuntimeException) &#123;</span><br><span class="line">                throw (RuntimeException) t;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                throw new InternalError(t.toString(), t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (NoSuchMethodException e) &#123;</span><br><span class="line">            throw new InternalError(e.toString(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†è¿›å»getProxyClass0æ–¹æ³•çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Generate a proxy class.  Must call the checkProxyAccess method</span><br><span class="line"> * to perform permission checks before calling this.</span><br><span class="line"> */</span><br><span class="line">private static Class&lt;?&gt; getProxyClass0(ClassLoader loader,</span><br><span class="line">                                       Class&lt;?&gt;... interfaces) &#123;</span><br><span class="line">    if (interfaces.length &gt; 65535) &#123;</span><br><span class="line">        throw new IllegalArgumentException(&quot;interface limit exceeded&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    // If the proxy class defined by the given loader implementing</span><br><span class="line">    // the given interfaces exists, this will simply return the cached copy;</span><br><span class="line">    // otherwise, it will create the proxy class via the ProxyClassFactory</span><br><span class="line">    return proxyClassCache.get(loader, interfaces);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœŸç›¸è¿˜æ˜¯æ²¡æœ‰æ¥åˆ°ï¼Œç»§ç»­ï¼Œçœ‹ä¸€ä¸‹ proxyClassCache</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> /**</span><br><span class="line"> * a cache of proxy classes</span><br><span class="line"> */</span><br><span class="line">private static final WeakCache&lt;ClassLoader, Class&lt;?&gt;[], Class&lt;?&gt;&gt; proxyClassCache = new WeakCache&lt;&gt;(new KeyFactory(), new ProxyClassFactory());</span><br></pre></td></tr></table></figure><p>å¥¥ï¼ŒåŸæ¥ç”¨äº†ä¸€ä¸‹ç¼“å­˜å•Š</p><p>é‚£ä¹ˆå®ƒå¯¹åº”çš„getæ–¹æ³•å•¥æ ·å‘¢ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Look-up the value through the cache. This always evaluates the</span><br><span class="line"> * &#123;@code subKeyFactory&#125; function and optionally evaluates</span><br><span class="line"> * &#123;@code valueFactory&#125; function if there is no entry in the cache for given</span><br><span class="line"> * pair of (key, subKey) or the entry has already been cleared.</span><br><span class="line"> *</span><br><span class="line"> * @param key       possibly null key</span><br><span class="line"> * @param parameter parameter used together with key to create sub-key and</span><br><span class="line"> *                  value (should not be null)</span><br><span class="line"> * @return the cached value (never null)</span><br><span class="line"> * @throws NullPointerException if &#123;@code parameter&#125; passed in or</span><br><span class="line"> *                              &#123;@code sub-key&#125; calculated by</span><br><span class="line"> *                              &#123;@code subKeyFactory&#125; or &#123;@code value&#125;</span><br><span class="line"> *                              calculated by &#123;@code valueFactory&#125; is null.</span><br><span class="line"> */</span><br><span class="line">public V get(K key, P parameter) &#123;</span><br><span class="line">    Objects.requireNonNull(parameter);</span><br><span class="line">    expungeStaleEntries();</span><br><span class="line">    Object cacheKey = CacheKey.valueOf(key, refQueue);</span><br><span class="line">    // lazily install the 2nd level valuesMap for the particular cacheKey</span><br><span class="line">    ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; valuesMap = map.get(cacheKey);</span><br><span class="line">    if (valuesMap == null) &#123;</span><br><span class="line">       //putIfAbsentè¿™ä¸ªæ–¹æ³•åœ¨keyä¸å­˜åœ¨çš„æ—¶å€™åŠ å…¥ä¸€ä¸ªå€¼,å¦‚æœkeyå­˜åœ¨å°±ä¸æ”¾å…¥</span><br><span class="line">        ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; oldValuesMap = map.putIfAbsent(cacheKey,valuesMap = new ConcurrentHashMap&lt;&gt;());</span><br><span class="line">        if (oldValuesMap != null) &#123;</span><br><span class="line">            valuesMap = oldValuesMap;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    // create subKey and retrieve the possible Supplier&lt;V&gt; stored by that</span><br><span class="line">    // subKey from valuesMap</span><br><span class="line">    Object subKey = Objects.requireNonNull(subKeyFactory.apply(key, parameter));</span><br><span class="line">    Supplier&lt;V&gt; supplier = valuesMap.get(subKey);</span><br><span class="line">    Factory factory = null;</span><br><span class="line"> </span><br><span class="line">    while (true) &#123;</span><br><span class="line">        if (supplier != null) &#123;</span><br><span class="line">            // supplier might be a Factory or a CacheValue&lt;V&gt; instance</span><br><span class="line">            V value = supplier.get();</span><br><span class="line">            if (value != null) &#123;</span><br><span class="line">                return value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // else no supplier in cache</span><br><span class="line">        // or a supplier that returned null (could be a cleared CacheValue</span><br><span class="line">        // or a Factory that wasn&apos;t successful in installing the CacheValue)</span><br><span class="line"> </span><br><span class="line">        // lazily construct a Factory</span><br><span class="line">        if (factory == null) &#123;</span><br><span class="line">            factory = new Factory(key, parameter, subKey, valuesMap);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        if (supplier == null) &#123;        </span><br><span class="line">            supplier = valuesMap.putIfAbsent(subKey, factory);</span><br><span class="line">            if (supplier == null) &#123;</span><br><span class="line">                // successfully installed Factory</span><br><span class="line">                supplier = factory;</span><br><span class="line">            &#125;</span><br><span class="line">            // else retry with winning supplier</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (valuesMap.replace(subKey, supplier, factory)) &#123;</span><br><span class="line">                // successfully replaced</span><br><span class="line">                // cleared CacheEntry / unsuccessful Factory</span><br><span class="line">                // with our Factory</span><br><span class="line">                supplier = factory;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                // retry with current supplier</span><br><span class="line">                supplier = valuesMap.get(subKey);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒè°ƒç”¨äº† supplier.get(); è·å–åŠ¨æ€ä»£ç†ç±»ï¼Œå…¶ä¸­supplieræ˜¯Factory,è¿™ä¸ªç±»å®šä¹‰åœ¨WeakCachçš„å†…éƒ¨ã€‚</p><p>æ¥ç…ç…ï¼Œgeté‡Œé¢åˆåšäº†ä»€ä¹ˆï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public synchronized V get() &#123; // serialize access</span><br><span class="line">            // re-check</span><br><span class="line">            Supplier&lt;V&gt; supplier = valuesMap.get(subKey);</span><br><span class="line">            if (supplier != this) &#123;</span><br><span class="line">                // something changed while we were waiting:</span><br><span class="line">                // might be that we were replaced by a CacheValue</span><br><span class="line">                // or were removed because of failure -&gt;</span><br><span class="line">                // return null to signal WeakCache.get() to retry</span><br><span class="line">                // the loop</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">            // else still us (supplier == this)</span><br><span class="line"> </span><br><span class="line">            // create new value</span><br><span class="line">            V value = null;</span><br><span class="line">            try &#123;</span><br><span class="line">                value = Objects.requireNonNull(valueFactory.apply(key, parameter));</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                if (value == null) &#123; // remove us on failure</span><br><span class="line">                    valuesMap.remove(subKey, this);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            // the only path to reach here is with non-null value</span><br><span class="line">            assert value != null;</span><br><span class="line"> </span><br><span class="line">            // wrap value with CacheValue (WeakReference)</span><br><span class="line">            CacheValue&lt;V&gt; cacheValue = new CacheValue&lt;&gt;(value);</span><br><span class="line"> </span><br><span class="line">            // try replacing us with CacheValue (this should always succeed)</span><br><span class="line">            if (valuesMap.replace(subKey, this, cacheValue)) &#123;</span><br><span class="line">                // put also in reverseMap</span><br><span class="line">                reverseMap.put(cacheValue, Boolean.TRUE);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                throw new AssertionError(&quot;Should not reach here&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            // successfully replaced us with new CacheValue -&gt; return the value</span><br><span class="line">            // wrapped by it</span><br><span class="line">            return value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å‘ç°é‡ç‚¹è¿˜æ˜¯æœ¨æœ‰å‡ºç°ï¼Œä½†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒè°ƒç”¨äº†valueFactory.apply(key, parameter)æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"> /**</span><br><span class="line"> * A factory function that generates, defines and returns the proxy class given</span><br><span class="line"> * the ClassLoader and array of interfaces.</span><br><span class="line"> */</span><br><span class="line">private static final class ProxyClassFactory implements BiFunction&lt;ClassLoader, Class&lt;?&gt;[], Class&lt;?&gt;&gt; &#123;</span><br><span class="line">    // prefix for all proxy class names</span><br><span class="line">    private static final String proxyClassNamePrefix = &quot;$Proxy&quot;;</span><br><span class="line"> </span><br><span class="line">    // next number to use for generation of unique proxy class names</span><br><span class="line">    private static final AtomicLong nextUniqueNumber = new AtomicLong();</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public Class&lt;?&gt; apply(ClassLoader loader, Class&lt;?&gt;[] interfaces) &#123;</span><br><span class="line">        Map&lt;Class&lt;?&gt;, Boolean&gt; interfaceSet = new IdentityHashMap&lt;&gt;(interfaces.length);</span><br><span class="line">        for (Class&lt;?&gt; intf : interfaces) &#123;</span><br><span class="line">            /*</span><br><span class="line">             * Verify that the class loader resolves the name of this</span><br><span class="line">             * interface to the same Class object.</span><br><span class="line">             */</span><br><span class="line">            Class&lt;?&gt; interfaceClass = null;</span><br><span class="line">            try &#123;</span><br><span class="line">                interfaceClass = Class.forName(intf.getName(), false, loader);</span><br><span class="line">            &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            if (interfaceClass != intf) &#123;</span><br><span class="line">                throw new IllegalArgumentException(</span><br><span class="line">                    intf + &quot; is not visible from class loader&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            /*</span><br><span class="line">             * Verify that the Class object actually represents an</span><br><span class="line">             * interface.</span><br><span class="line">             */</span><br><span class="line">            if (!interfaceClass.isInterface()) &#123;</span><br><span class="line">                throw new IllegalArgumentException(</span><br><span class="line">                    interfaceClass.getName() + &quot; is not an interface&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            /*</span><br><span class="line">             * Verify that this interface is not a duplicate.</span><br><span class="line">             */</span><br><span class="line">            if (interfaceSet.put(interfaceClass, Boolean.TRUE) != null) &#123;</span><br><span class="line">                throw new IllegalArgumentException(</span><br><span class="line">                    &quot;repeated interface: &quot; + interfaceClass.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        String proxyPkg = null;     // package to define proxy class in</span><br><span class="line">        int accessFlags = Modifier.PUBLIC | Modifier.FINAL;</span><br><span class="line"> </span><br><span class="line">        /*</span><br><span class="line">         * Record the package of a non-public proxy interface so that the</span><br><span class="line">         * proxy class will be defined in the same package.  Verify that</span><br><span class="line">         * all non-public proxy interfaces are in the same package.</span><br><span class="line">         */</span><br><span class="line">        for (Class&lt;?&gt; intf : interfaces) &#123;</span><br><span class="line">            int flags = intf.getModifiers();</span><br><span class="line">            if (!Modifier.isPublic(flags)) &#123;</span><br><span class="line">                accessFlags = Modifier.FINAL;</span><br><span class="line">                String name = intf.getName();</span><br><span class="line">                int n = name.lastIndexOf(&apos;.&apos;);</span><br><span class="line">                String pkg = ((n == -1) ? &quot;&quot; : name.substring(0, n + 1));</span><br><span class="line">                if (proxyPkg == null) &#123;</span><br><span class="line">                    proxyPkg = pkg;</span><br><span class="line">                &#125; else if (!pkg.equals(proxyPkg)) &#123;</span><br><span class="line">                    throw new IllegalArgumentException(</span><br><span class="line">                        &quot;non-public interfaces from different packages&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        if (proxyPkg == null) &#123;</span><br><span class="line">            // if no non-public proxy interfaces, use com.sun.proxy package</span><br><span class="line">            proxyPkg = ReflectUtil.PROXY_PACKAGE + &quot;.&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        /*</span><br><span class="line">         * Choose a name for the proxy class to generate.</span><br><span class="line">         */</span><br><span class="line">        long num = nextUniqueNumber.getAndIncrement();</span><br><span class="line">        String proxyName = proxyPkg + proxyClassNamePrefix + num;</span><br><span class="line"> </span><br><span class="line">        /*</span><br><span class="line">         * Generate the specified proxy class.</span><br><span class="line">         */</span><br><span class="line">        byte[] proxyClassFile = ProxyGenerator.generateProxyClass(</span><br><span class="line">            proxyName, interfaces, accessFlags);</span><br><span class="line">        try &#123;</span><br><span class="line">            return defineClass0(loader, proxyName, proxyClassFile, 0, proxyClassFile.length);</span><br><span class="line">        &#125; catch (ClassFormatError e) &#123;</span><br><span class="line">            /*</span><br><span class="line">             * A ClassFormatError here means that (barring bugs in the</span><br><span class="line">             * proxy class generation code) there was some other</span><br><span class="line">             * invalid aspect of the arguments supplied to the proxy</span><br><span class="line">             * class creation (such as virtual machine limitations</span><br><span class="line">             * exceeded).</span><br><span class="line">             */</span><br><span class="line">            throw new IllegalArgumentException(e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡çœ‹ä»£ç ç»ˆäºæ‰¾åˆ°äº†é‡ç‚¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//ç”Ÿæˆå­—èŠ‚ç </span><br><span class="line">byte[] proxyClassFile = ProxyGenerator.generateProxyClass(proxyName, interfaces, accessFlags);</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬ä¹Ÿä½¿ç”¨æµ‹è¯•ä¸€ä¸‹ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ç”Ÿæˆçš„å­—èŠ‚ç æ˜¯ä¸ªä»€ä¹ˆæ ·å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">package jiankunking;</span><br><span class="line"> </span><br><span class="line">import sun.misc.ProxyGenerator;</span><br><span class="line"> </span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileNotFoundException;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.lang.reflect.InvocationHandler;</span><br><span class="line">import java.lang.reflect.Proxy;</span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line"> * åŠ¨æ€ä»£ç†æ¼”ç¤º</span><br><span class="line"> */</span><br><span class="line">public class DynamicProxyDemonstration &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        //ä»£ç†çš„çœŸå®å¯¹è±¡</span><br><span class="line">        Subject realSubject = new RealSubject();</span><br><span class="line"> </span><br><span class="line">        /**</span><br><span class="line">         * InvocationHandlerImpl å®ç°äº† InvocationHandler æ¥å£ï¼Œå¹¶èƒ½å®ç°æ–¹æ³•è°ƒç”¨ä»ä»£ç†ç±»åˆ°å§”æ‰˜ç±»çš„åˆ†æ´¾è½¬å‘</span><br><span class="line">         * å…¶å†…éƒ¨é€šå¸¸åŒ…å«æŒ‡å‘å§”æ‰˜ç±»å®ä¾‹çš„å¼•ç”¨ï¼Œç”¨äºçœŸæ­£æ‰§è¡Œåˆ†æ´¾è½¬å‘è¿‡æ¥çš„æ–¹æ³•è°ƒç”¨.</span><br><span class="line">         * å³ï¼šè¦ä»£ç†å“ªä¸ªçœŸå®å¯¹è±¡ï¼Œå°±å°†è¯¥å¯¹è±¡ä¼ è¿›å»ï¼Œæœ€åæ˜¯é€šè¿‡è¯¥çœŸå®å¯¹è±¡æ¥è°ƒç”¨å…¶æ–¹æ³•</span><br><span class="line">         */</span><br><span class="line">        InvocationHandler handler = new InvocationHandlerImpl(realSubject);</span><br><span class="line"> </span><br><span class="line">        ClassLoader loader = handler.getClass().getClassLoader();</span><br><span class="line">        Class[] interfaces = realSubject.getClass().getInterfaces();</span><br><span class="line">        /**</span><br><span class="line">         * è¯¥æ–¹æ³•ç”¨äºä¸ºæŒ‡å®šç±»è£…è½½å™¨ã€ä¸€ç»„æ¥å£åŠè°ƒç”¨å¤„ç†å™¨ç”ŸæˆåŠ¨æ€ä»£ç†ç±»å®ä¾‹</span><br><span class="line">         */</span><br><span class="line">        Subject subject = (Subject) Proxy.newProxyInstance(loader, interfaces, handler);</span><br><span class="line">        System.out.println(&quot;åŠ¨æ€ä»£ç†å¯¹è±¡çš„ç±»å‹ï¼š&quot;+subject.getClass().getName());</span><br><span class="line"></span><br><span class="line">        String hello = subject.SayHello(&quot;jiankunking&quot;);</span><br><span class="line">        System.out.println(hello);</span><br><span class="line">        // å°†ç”Ÿæˆçš„å­—èŠ‚ç ä¿å­˜åˆ°æœ¬åœ°ï¼Œ</span><br><span class="line">        createProxyClassFile();</span><br><span class="line">    &#125;</span><br><span class="line">    private static void createProxyClassFile()&#123;</span><br><span class="line">        String name = &quot;ProxySubject&quot;;</span><br><span class="line">        byte[] data = ProxyGenerator.generateProxyClass(name,new Class[]&#123;Subject.class&#125;);</span><br><span class="line">        FileOutputStream out =null;</span><br><span class="line">        try &#123;</span><br><span class="line">            out = new FileOutputStream(name+&quot;.class&quot;);</span><br><span class="line">            System.out.println((new File(&quot;hello&quot;)).getAbsolutePath());</span><br><span class="line">            out.write(data);</span><br><span class="line">        &#125; catch (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;finally &#123;</span><br><span class="line">            if(null!=out) try &#123;</span><br><span class="line">                out.close();</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹ä¸€ä¸‹è¿™é‡Œä»£ç†å¯¹è±¡çš„ç±»å‹ï¼š</p><p><img alt data-src="/images/spring-jdk-aop/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B.png"><br>æˆ‘ä»¬ç”¨jd-jui å·¥å…·å°†ç”Ÿæˆçš„å­—èŠ‚ç åç¼–è¯‘ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">import java.lang.reflect.InvocationHandler;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.lang.reflect.Proxy;</span><br><span class="line">import java.lang.reflect.UndeclaredThrowableException;</span><br><span class="line">import jiankunking.Subject;</span><br><span class="line"> </span><br><span class="line">public final class ProxySubject extends Proxy implements Subject &#123;</span><br><span class="line">  private static Method m1;</span><br><span class="line">  private static Method m3;</span><br><span class="line">  private static Method m4;</span><br><span class="line">  private static Method m2;</span><br><span class="line">  private static Method m0;</span><br><span class="line">  </span><br><span class="line">  public ProxySubject(InvocationHandler paramInvocationHandler) &#123;</span><br><span class="line">    super(paramInvocationHandler);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  public final boolean equals(Object paramObject)&#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        return ((Boolean)this.h.invoke(this, m1, new Object[] &#123; paramObject &#125;)).booleanValue();</span><br><span class="line">    &#125; catch (Error|RuntimeException localError)&#123;</span><br><span class="line">        throw localError;</span><br><span class="line">    &#125; catch (Throwable localThrowable) &#123;</span><br><span class="line">      throw new UndeclaredThrowableException(localThrowable);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  public final String SayGoodBye() &#123;</span><br><span class="line">    try&#123;</span><br><span class="line">      return (String)this.h.invoke(this, m3, null);</span><br><span class="line">    &#125; catch (Error|RuntimeException localError) &#123;</span><br><span class="line">      throw localError;</span><br><span class="line">    &#125; catch (Throwable localThrowable) &#123;</span><br><span class="line">      throw new UndeclaredThrowableException(localThrowable);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  public final String SayHello(String paramString) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      return (String)this.h.invoke(this, m4, new Object[] &#123; paramString &#125;);</span><br><span class="line">    &#125; catch (Error|RuntimeException localError)&#123;</span><br><span class="line">      throw localError;</span><br><span class="line">    &#125; catch (Throwable localThrowable)&#123;</span><br><span class="line">      throw new UndeclaredThrowableException(localThrowable);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  public final String toString() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      return (String)this.h.invoke(this, m2, null);</span><br><span class="line">    &#125; catch (Error|RuntimeException localError) &#123;</span><br><span class="line">      throw localError;</span><br><span class="line">    &#125; catch (Throwable localThrowable) &#123;</span><br><span class="line">      throw new UndeclaredThrowableException(localThrowable);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  public final int hashCode() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      return ((Integer)this.h.invoke(this, m0, null)).intValue();</span><br><span class="line">    &#125; catch (Error|RuntimeException localError) &#123;</span><br><span class="line">      throw localError;</span><br><span class="line">    &#125; catch (Throwable localThrowable) &#123;</span><br><span class="line">      throw new UndeclaredThrowableException(localThrowable);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  static</span><br><span class="line">  &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      m1 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;equals&quot;, new Class[] &#123; Class.forName(&quot;java.lang.Object&quot;) &#125;);</span><br><span class="line">      m3 = Class.forName(&quot;jiankunking.Subject&quot;).getMethod(&quot;SayGoodBye&quot;, new Class[0]);</span><br><span class="line">      m4 = Class.forName(&quot;jiankunking.Subject&quot;).getMethod(&quot;SayHello&quot;, new Class[] &#123; Class.forName(&quot;java.lang.String&quot;) &#125;);</span><br><span class="line">      m2 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;toString&quot;, new Class[0]);</span><br><span class="line">      m0 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;hashCode&quot;, new Class[0]);</span><br><span class="line">      return;</span><br><span class="line">    &#125; catch (NoSuchMethodException localNoSuchMethodException) &#123;</span><br><span class="line">      throw new NoSuchMethodError(localNoSuchMethodException.getMessage());</span><br><span class="line">    &#125; catch (ClassNotFoundException localClassNotFoundException) &#123;</span><br><span class="line">      throw new NoClassDefFoundError(localClassNotFoundException.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯æœ€ç»ˆçœŸæ­£çš„ä»£ç†ç±»ï¼Œå®ƒç»§æ‰¿è‡ªProxyå¹¶å®ç°äº†æˆ‘ä»¬å®šä¹‰çš„Subjectæ¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Subject subject = (Subject) Proxy.newProxyInstance(loader, interfaces, handler);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„subjectå®é™…æ˜¯è¿™ä¸ªç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬è°ƒç”¨å®ƒçš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public final String SayHello(String paramString)</span><br></pre></td></tr></table></figure><p>å°±æ˜¯è°ƒç”¨æˆ‘ä»¬å®šä¹‰çš„InvocationHandlerImplçš„ invokeæ–¹æ³•ï¼š</p><p><img alt data-src="/images/spring-jdk-aop/sayhello.png"></p><blockquote><p>ä¸Šé¢æ˜¯ä»£ç è·Ÿåˆ†æçš„è¿‡ç¨‹ï¼Œä¸æƒ³çœ‹çš„æœ‹å‹å¯ä»¥ç›´æ¥çœ‹ç»“è®º</p></blockquote><h1 id="äº”ã€ç»“è®º"><a href="#äº”ã€ç»“è®º" class="headerlink" title="äº”ã€ç»“è®º"></a>äº”ã€ç»“è®º</h1><p>åˆ°äº†è¿™é‡Œï¼Œç»ˆäºè§£ç­”äº†ï¼š</p><p>subject.SayHello(â€œjiankunkingâ€)è¿™å¥è¯æ—¶ï¼Œä¸ºä»€ä¹ˆä¼šè‡ªåŠ¨è°ƒç”¨InvocationHandlerImplçš„invokeæ–¹æ³•ï¼Ÿ</p><p>å› ä¸ºJDKç”Ÿæˆçš„æœ€ç»ˆçœŸæ­£çš„ä»£ç†ç±»ï¼Œå®ƒç»§æ‰¿è‡ªProxyå¹¶å®ç°äº†æˆ‘ä»¬å®šä¹‰çš„Subjectæ¥å£ï¼Œåœ¨å®ç°Subjectæ¥å£æ–¹æ³•çš„å†…éƒ¨ï¼Œé€šè¿‡åå°„è°ƒç”¨äº†InvocationHandlerImplçš„invokeæ–¹æ³•ã€‚</p><p>é€šè¿‡åˆ†æä»£ç å¯ä»¥çœ‹å‡ºJava åŠ¨æ€ä»£ç†ï¼Œå…·ä½“æœ‰å¦‚ä¸‹å››æ­¥éª¤ï¼š</p><ol><li><p>é€šè¿‡å®ç° InvocationHandler æ¥å£åˆ›å»ºè‡ªå·±çš„è°ƒç”¨å¤„ç†å™¨ï¼›</p></li><li><p>é€šè¿‡ä¸º Proxy ç±»æŒ‡å®š ClassLoader å¯¹è±¡å’Œä¸€ç»„ interface æ¥åˆ›å»ºåŠ¨æ€ä»£ç†ç±»ï¼›</p></li><li><p>é€šè¿‡åå°„æœºåˆ¶è·å¾—åŠ¨æ€ä»£ç†ç±»çš„æ„é€ å‡½æ•°ï¼Œå…¶å”¯ä¸€å‚æ•°ç±»å‹æ˜¯è°ƒç”¨å¤„ç†å™¨æ¥å£ç±»å‹ï¼›</p></li><li><p>é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºåŠ¨æ€ä»£ç†ç±»å®ä¾‹ï¼Œæ„é€ æ—¶è°ƒç”¨å¤„ç†å™¨å¯¹è±¡ä½œä¸ºå‚æ•°è¢«ä¼ å…¥ã€‚</p></li></ol><p>æ¼”ç¤ºä»£ç ä¸‹è½½ï¼š<br><a href="https://github.com/jiankunking/DynamicProxyDemo" target="_blank" rel="noopener">https://github.com/jiankunking/DynamicProxyDemo</a></p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JDK </tag>
            
            <tag> Spring </tag>
            
            <tag> AOP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java HashMap</title>
      <link href="/java-hashmap.html"/>
      <url>/java-hashmap.html</url>
      
        <content type="html"><![CDATA[<blockquote><p> ä»£ç åŸºäº Jdk1.8</p></blockquote><a id="more"></a><p>æœ€è¿‘åœ¨å·¥ä½œç”¨åˆ°Mapç­‰ä¸€ç³»åˆ—çš„é›†åˆï¼Œäºæ˜¯ï¼Œæƒ³ä»”ç»†çœ‹ä¸€ä¸‹å…¶å…·ä½“å®ç°ã€‚</p><h1 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt;</span><br><span class="line">    implements Map&lt;K,V&gt;, Cloneable, Serializable</span><br></pre></td></tr></table></figure><h2 id="æŠ½è±¡ç±»AbstractMap"><a href="#æŠ½è±¡ç±»AbstractMap" class="headerlink" title="æŠ½è±¡ç±»AbstractMap"></a>æŠ½è±¡ç±»AbstractMap</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public abstract class AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;</span><br></pre></td></tr></table></figure><p>è¯¥ç±»å®ç°äº†Mapæ¥å£ï¼Œå…·ä½“ç»“æ„å¦‚ä¸‹ï¼š<br><img alt data-src="/images/java-hashmap/AbstractMap%E7%BB%93%E6%9E%84.png"><br>è¯¥ç±»ä»£ç å¾ˆç®€å•ï¼Œä¸å†èµ˜è¿°ã€‚</p><h2 id="åºåˆ—åŒ–æ¥å£ï¼šSerializable"><a href="#åºåˆ—åŒ–æ¥å£ï¼šSerializable" class="headerlink" title="åºåˆ—åŒ–æ¥å£ï¼šSerializable"></a>åºåˆ—åŒ–æ¥å£ï¼šSerializable</h2><p>è¯¥æ¥å£æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œä½†é€šè¿‡è¯¥æ¥å£ï¼Œå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆHashMapæ€»ä¸€äº›å­—æ®µæ˜¯ç”¨transientæ¥ä¿®é¥°ã€‚</p><blockquote><p>ä¸€æ—¦å˜é‡è¢«transientä¿®é¥°ï¼Œå˜é‡å°†ä¸å†æ˜¯å¯¹è±¡æŒä¹…åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥å˜é‡å†…å®¹åœ¨åºåˆ—åŒ–åæ— æ³•è·å¾—è®¿é—®ã€‚</p></blockquote><h1 id="é˜…è¯»JDKä¸­ç±»æ³¨é‡Š"><a href="#é˜…è¯»JDKä¸­ç±»æ³¨é‡Š" class="headerlink" title="é˜…è¯»JDKä¸­ç±»æ³¨é‡Š"></a>é˜…è¯»JDKä¸­ç±»æ³¨é‡Š</h1><h2 id="HashMapæ˜¯æ— åºçš„"><a href="#HashMapæ˜¯æ— åºçš„" class="headerlink" title="HashMapæ˜¯æ— åºçš„"></a>HashMapæ˜¯æ— åºçš„</h2><p>å¦‚æœå¸Œæœ›ä¿æŒå…ƒç´ çš„è¾“å…¥é¡ºåºåº”è¯¥ä½¿ç”¨LinkedHashMap</p><h2 id="é™¤äº†éåŒæ­¥å’Œå…è®¸ä½¿ç”¨nullä¹‹å¤–ï¼ŒHashMapä¸HashtableåŸºæœ¬ä¸€è‡´ã€‚"><a href="#é™¤äº†éåŒæ­¥å’Œå…è®¸ä½¿ç”¨nullä¹‹å¤–ï¼ŒHashMapä¸HashtableåŸºæœ¬ä¸€è‡´ã€‚" class="headerlink" title="é™¤äº†éåŒæ­¥å’Œå…è®¸ä½¿ç”¨nullä¹‹å¤–ï¼ŒHashMapä¸HashtableåŸºæœ¬ä¸€è‡´ã€‚"></a>é™¤äº†éåŒæ­¥å’Œå…è®¸ä½¿ç”¨nullä¹‹å¤–ï¼ŒHashMapä¸HashtableåŸºæœ¬ä¸€è‡´ã€‚</h2><p>æ­¤å¤„çš„éåŒæ­¥æŒ‡çš„æ˜¯å¤šçº¿ç¨‹è®¿é—®ï¼Œå¹¶è‡³å°‘ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹HashMapç»“æ„ã€‚ç»“æ„ä¿®æ”¹åŒ…æ‹¬ä»»ä½•æ–°å¢ã€åˆ é™¤æ˜ å°„ï¼Œä½†ä»…ä»…ä¿®æ”¹HashMapä¸­å·²å­˜åœ¨é¡¹å€¼å¾—æ“ä½œä¸å±äºç»“æ„ä¿®æ”¹ã€‚</p><h2 id="åˆå§‹å®¹é‡ä¸åŠ è½½å› å­æ˜¯å½±å“HashMapçš„ä¸¤ä¸ªé‡è¦å› ç´ ã€‚"><a href="#åˆå§‹å®¹é‡ä¸åŠ è½½å› å­æ˜¯å½±å“HashMapçš„ä¸¤ä¸ªé‡è¦å› ç´ ã€‚" class="headerlink" title="åˆå§‹å®¹é‡ä¸åŠ è½½å› å­æ˜¯å½±å“HashMapçš„ä¸¤ä¸ªé‡è¦å› ç´ ã€‚"></a>åˆå§‹å®¹é‡ä¸åŠ è½½å› å­æ˜¯å½±å“HashMapçš„ä¸¤ä¸ªé‡è¦å› ç´ ã€‚</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public HashMap(int initialCapacity, float loadFactor)</span><br></pre></td></tr></table></figure><p>åˆå§‹å®¹é‡é»˜è®¤å€¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * The default initial capacity - MUST be a power of two.</span><br><span class="line"> */</span><br><span class="line">static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16</span><br></pre></td></tr></table></figure><p>åŠ è½½å› å­é»˜è®¤å€¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * The load factor used when none specified in constructor.</span><br><span class="line"> */</span><br><span class="line">static final float DEFAULT_LOAD_FACTOR = 0.75f;</span><br></pre></td></tr></table></figure><p>å®¹é‡æ˜¯HashMapåœ¨åˆ›å»ºæ—¶â€œæ¡¶â€çš„æ•°é‡ï¼Œè€Œåˆå§‹å®¹é‡æ˜¯å“ˆå¸Œè¡¨åœ¨åˆ›å»ºæ—¶åˆ†é…çš„ç©ºé—´å¤§å°ã€‚åŠ è½½å› å­æ˜¯å“ˆå¸Œè¡¨åœ¨å…¶å®¹é‡è‡ªåŠ¨å¢åŠ æ—¶èƒ½è¾¾åˆ°å¤šæ»¡çš„è¡¡é‡å°ºåº¦ï¼ˆæ¯”å¦‚é»˜è®¤ä¸º0.75ï¼Œå³æ¡¶ä¸­æ•°æ®è¾¾åˆ°3/4å°±ä¸èƒ½å†æ”¾æ•°æ®äº†ï¼‰ã€‚</p><blockquote><p>é»˜è®¤çš„è´Ÿè½½å› å­å¤§å°ä¸º0.75ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ªmapå¡«æ»¡äº†75%çš„bucketæ—¶å€™ï¼Œå’Œå…¶å®ƒé›†åˆç±»(å¦‚ArrayListç­‰)ä¸€æ ·ï¼Œå°†ä¼šåˆ›å»ºåŸæ¥HashMapå¤§å°çš„ä¸¤å€çš„bucketæ•°ç»„ï¼Œæ¥é‡æ–°è°ƒæ•´mapçš„å¤§å°ï¼Œå¹¶å°†åŸæ¥çš„å¯¹è±¡æ”¾å…¥æ–°çš„bucketæ•°ç»„ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹å«ä½œrehashingï¼Œå› ä¸ºå®ƒè°ƒç”¨hashæ–¹æ³•æ‰¾åˆ°æ–°çš„bucketä½ç½®ã€‚<br>å½“é‡æ–°è°ƒæ•´HashMapå¤§å°çš„æ—¶å€™ï¼Œä¼šå­˜åœ¨æ¡ä»¶ç«äº‰ï¼Œå› ä¸ºå¦‚æœä¸¤ä¸ªçº¿ç¨‹éƒ½å‘ç°HashMapéœ€è¦é‡æ–°è°ƒæ•´å¤§å°äº†ï¼Œå®ƒä»¬ä¼šåŒæ—¶è¯•ç€è°ƒæ•´å¤§å°ã€‚åœ¨è°ƒæ•´å¤§å°çš„è¿‡ç¨‹ä¸­ï¼Œå­˜å‚¨åœ¨é“¾è¡¨ä¸­çš„å…ƒç´ çš„æ¬¡åºä¼šåè¿‡æ¥ï¼Œå› ä¸ºç§»åŠ¨åˆ°æ–°çš„bucketä½ç½®çš„æ—¶å€™ï¼ŒHashMapå¹¶ä¸ä¼šå°†å…ƒç´ æ”¾åœ¨é“¾è¡¨çš„å°¾éƒ¨ï¼Œè€Œæ˜¯æ”¾åœ¨å¤´éƒ¨ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å°¾éƒ¨éå†(tail traversing)ã€‚å¦‚æœæ¡ä»¶ç«äº‰å‘ç”Ÿäº†ï¼Œé‚£ä¹ˆå°±æ­»å¾ªç¯äº†ã€‚<br>æ‰€ä»¥ HashMapåº”è¯¥é¿å…åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ã€‚</p></blockquote><p>é»˜è®¤0.75è¿™æ˜¯æ—¶é—´å’Œç©ºé—´æˆæœ¬ä¸Šä¸€ç§æŠ˜è¡·ï¼šå¢å¤§è´Ÿè½½å› å­å¯ä»¥å‡å°‘ Hash è¡¨ï¼ˆå°±æ˜¯é‚£ä¸ª Entry æ•°ç»„ï¼‰æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œä½†ä¼šå¢åŠ æŸ¥è¯¢æ•°æ®çš„æ—¶é—´å¼€é”€ï¼Œè€ŒæŸ¥è¯¢æ˜¯æœ€é¢‘ç¹çš„çš„æ“ä½œï¼ˆHashMap çš„ get() ä¸ put() æ–¹æ³•éƒ½è¦ç”¨åˆ°æŸ¥è¯¢ï¼‰ï¼›å‡å°è´Ÿè½½å› å­ä¼šæé«˜æ•°æ®æŸ¥è¯¢çš„æ€§èƒ½ï¼Œä½†ä¼šå¢åŠ  Hash è¡¨æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p><h2 id="å­˜å‚¨å½¢å¼"><a href="#å­˜å‚¨å½¢å¼" class="headerlink" title="å­˜å‚¨å½¢å¼"></a>å­˜å‚¨å½¢å¼</h2><p>é“¾è¡¨å½¢å¼å­˜å‚¨ï¼Ÿæ ‘å½¢ç»“æ„ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* This map usually acts as a binned (bucketed) hash table, but</span><br><span class="line">* when bins get too large, they are transformed into bins of</span><br><span class="line">* TreeNodes, each structured similarly to those in</span><br><span class="line">* java.util.TreeMap. Most methods try to use normal bins, but</span><br><span class="line">* relay to TreeNode methods when applicable (simply by checking</span><br><span class="line">* instanceof a node).</span><br></pre></td></tr></table></figure><h1 id="æºç é˜…è¯»"><a href="#æºç é˜…è¯»" class="headerlink" title="æºç é˜…è¯»"></a>æºç é˜…è¯»</h1><h2 id="æ·»åŠ å…ƒç´ "><a href="#æ·»åŠ å…ƒç´ " class="headerlink" title="æ·»åŠ å…ƒç´ "></a>æ·»åŠ å…ƒç´ </h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * Associates the specified value with the specified key in this map.</span><br><span class="line">    * If the map previously contained a mapping for the key, the old</span><br><span class="line">    * value is replaced.</span><br><span class="line">    *</span><br><span class="line">    * @param key key with which the specified value is to be associated</span><br><span class="line">    * @param value value to be associated with the specified key</span><br><span class="line">    * @return the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or</span><br><span class="line">    *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;.</span><br><span class="line">    *         (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map</span><br><span class="line">    *         previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.)</span><br><span class="line">    */</span><br><span class="line">   public V put(K key, V value) &#123;</span><br><span class="line">       return putVal(hash(key), key, value, false, true);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   /**</span><br><span class="line">    * Implements Map.put and related methods</span><br><span class="line">    *</span><br><span class="line">    * @param hash hash for key</span><br><span class="line">    * @param key the key</span><br><span class="line">    * @param value the value to put</span><br><span class="line">    * @param onlyIfAbsent if true, don&apos;t change existing value</span><br><span class="line">    * @param evict if false, the table is in creation mode.</span><br><span class="line">    * @return previous value, or null if none</span><br><span class="line">    */</span><br><span class="line">   final V putVal(int hash, K key, V value, boolean onlyIfAbsent,</span><br><span class="line">                  boolean evict) &#123;</span><br><span class="line">       Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i;</span><br><span class="line">       //hashmapç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ ï¼Œè°ƒç”¨resize()æ–¹æ³•åˆå§‹åŒ–table</span><br><span class="line">       if ((tab = table) == null || (n = tab.length) == 0)</span><br><span class="line">           n = (tab = resize()).length;</span><br><span class="line">       //é€šè¿‡ä¸è¿ç®—åˆ¤æ–­tab[hash]ä½ç½®æ˜¯å¦æœ‰å€¼</span><br><span class="line">       //ä»newNodeè¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œhashmapä¸­key valueæ˜¯ä»¥Node&lt;K,V&gt;å®ä¾‹çš„å½¢å¼å­˜æ”¾çš„</span><br><span class="line">       if ((p = tab[i = (n - 1) &amp; hash]) == null)</span><br><span class="line">           tab[i] = newNode(hash, key, value, null);</span><br><span class="line">       //tab[i]æœ‰å…ƒç´ ï¼Œåˆ™éœ€è¦éå†ç»“ç‚¹åå†æ·»åŠ </span><br><span class="line">       else &#123;</span><br><span class="line">           Node&lt;K,V&gt; e; K k;</span><br><span class="line">           // hashã€keyå‡ç­‰ï¼Œè¯´æ˜å¾…æ’å…¥å…ƒç´ å’Œç¬¬ä¸€ä¸ªå…ƒç´ ç›¸ç­‰ï¼Œç›´æ¥æ›´æ–°</span><br><span class="line">           if (p.hash == hash &amp;&amp;</span><br><span class="line">               ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))</span><br><span class="line">               e = p;</span><br><span class="line">           else if (p instanceof TreeNode)//å¦‚æœpç±»å‹ä¸ºTreeNodeï¼Œè°ƒç”¨æ ‘çš„æ·»åŠ å…ƒç´ æ–¹æ³•(çº¢é»‘æ ‘å†²çªæ’å…¥)</span><br><span class="line">               e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);</span><br><span class="line">           else &#123;</span><br><span class="line">               //ä¸æ˜¯TreeNode,å³ä¸ºé“¾è¡¨,éå†é“¾è¡¨ï¼ŒæŸ¥æ‰¾ç»™å®šå…³é”®å­— </span><br><span class="line">               for (int binCount = 0; ; ++binCount) &#123;</span><br><span class="line">                   if ((e = p.next) == null) &#123;</span><br><span class="line">                   //åˆ°è¾¾é“¾è¡¨çš„å°¾ç«¯ä¹Ÿæ²¡æœ‰æ‰¾åˆ°keyå€¼ç›¸åŒçš„èŠ‚ç‚¹ï¼Œåˆ™ç”Ÿæˆä¸€ä¸ªæ–°çš„Node</span><br><span class="line">                       p.next = newNode(hash, key, value, null);</span><br><span class="line">                       //åˆ›å»ºæ–°èŠ‚ç‚¹åè‹¥è¶…å‡ºæ ‘å½¢åŒ–é˜ˆå€¼ï¼Œåˆ™è½¬æ¢ä¸ºæ ‘å½¢å­˜å‚¨  </span><br><span class="line">                       if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st</span><br><span class="line">                           treeifyBin(tab, hash);//å½“æ¡¶ä¸­é“¾è¡¨çš„æ•°é‡&gt;=9çš„æ—¶å€™ï¼Œåº•å±‚åˆ™æ”¹ä¸ºçº¢é»‘æ ‘å®ç°</span><br><span class="line">                       break;</span><br><span class="line">                   &#125;</span><br><span class="line">                   //å¦‚æœæ‰¾åˆ°å…³é”®å­—ç›¸åŒçš„ç»“ç‚¹  </span><br><span class="line">                   if (e.hash == hash &amp;&amp;</span><br><span class="line">                       ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))</span><br><span class="line">                       break;</span><br><span class="line">                   //æ›´æ–°pæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span><br><span class="line">                   p = e;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           // eä¸ä¸ºç©ºï¼Œå³mapä¸­å­˜åœ¨è¦æ·»åŠ çš„å…³é”®å­—  </span><br><span class="line">           if (e != null) &#123; // existing mapping for key</span><br><span class="line">               V oldValue = e.value;</span><br><span class="line">               if (!onlyIfAbsent || oldValue == null)</span><br><span class="line">                   e.value = value;</span><br><span class="line">               afterNodeAccess(e);</span><br><span class="line">               return oldValue;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       ++modCount;</span><br><span class="line">       if (++size &gt; threshold)</span><br><span class="line">           resize();//æ‰©å®¹</span><br><span class="line">       afterNodeInsertion(evict);</span><br><span class="line">       return null;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å°æ³¨ï¼š<br>1ã€å›è°ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">afterNodeAccess(e);</span><br><span class="line">afterNodeInsertion(evict);</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸ºLinkedHashMapå›è°ƒå‡†å¤‡çš„ã€‚<br>2ã€è®¡ç®—hashå€¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> /**</span><br><span class="line"> * Computes key.hashCode() and spreads (XORs) higher bits of hash</span><br><span class="line"> * to lower.  Because the table uses power-of-two masking, sets of</span><br><span class="line"> * hashes that vary only in bits above the current mask will</span><br><span class="line"> * always collide. (Among known examples are sets of Float keys</span><br><span class="line"> * holding consecutive whole numbers in small tables.)  So we</span><br><span class="line"> * apply a transform that spreads the impact of higher bits</span><br><span class="line"> * downward. There is a tradeoff between speed, utility, and</span><br><span class="line"> * quality of bit-spreading. Because many common sets of hashes</span><br><span class="line"> * are already reasonably distributed (so don&apos;t benefit from</span><br><span class="line"> * spreading), and because we use trees to handle large sets of</span><br><span class="line"> * collisions in bins, we just XOR some shifted bits in the</span><br><span class="line"> * cheapest possible way to reduce systematic lossage, as well as</span><br><span class="line"> * to incorporate impact of the highest bits that would otherwise</span><br><span class="line"> * never be used in index calculations because of table bounds.</span><br><span class="line"> */</span><br><span class="line">static final int hash(Object key) &#123;</span><br><span class="line">int h;</span><br><span class="line">return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€˜&gt;&gt;&gt;â€™ï¼šæ— ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥0è¡¥é½</p><blockquote><p>value &gt;&gt;&gt; num â€“ num æŒ‡å®šè¦ç§»ä½å€¼value ç§»åŠ¨çš„ä½æ•°ã€‚</p></blockquote><p>å³æŒ‰äºŒè¿›åˆ¶å½¢å¼æŠŠæ‰€æœ‰çš„æ•°å­—å‘å³ç§»åŠ¨å¯¹åº”ä½æ•°ï¼Œä½ä½ç§»å‡ºï¼ˆèˆå¼ƒï¼‰ï¼Œé«˜ä½çš„ç©ºä½è¡¥é›¶ã€‚å¯¹äºæ­£æ•°æ¥è¯´å’Œå¸¦ç¬¦å·å³ç§»ç›¸åŒï¼Œå¯¹äºè´Ÿæ•°æ¥è¯´ä¸åŒã€‚</p><p>^å¼‚æˆ–ï¼šä¸¤ä¸ªæ“ä½œæ•°çš„ä½ä¸­ï¼Œç›¸åŒåˆ™ç»“æœä¸º0ï¼Œä¸åŒåˆ™ç»“æœä¸º1ã€‚</p><p>è¿™ä¹Ÿæ­£å¥½è§£é‡Šäº†ä¸ºä»€ä¹ˆHashMapåº•å±‚æ•°ç»„çš„é•¿åº¦æ€»æ˜¯ 2 çš„ n æ¬¡æ–¹ã€‚å› ä¸ºè¿™æ ·ï¼ˆæ•°ç»„é•¿åº¦-1ï¼‰æ­£å¥½ç›¸å½“äºä¸€ä¸ªâ€œä½ä½æ©ç â€ã€‚â€œå¼‚æˆ–â€æ“ä½œçš„ç»“æœå°±æ˜¯æ•£åˆ—å€¼çš„é«˜ä½å…¨éƒ¨å½’é›¶ï¼Œåªä¿ç•™ä½ä½å€¼ï¼Œç”¨æ¥åšæ•°ç»„ä¸‹æ ‡è®¿é—®ã€‚<br>ä»¥åˆå§‹é•¿åº¦16ä¸ºä¾‹ï¼Œ16-1=15ã€‚<br>2è¿›åˆ¶è¡¨ç¤ºæ˜¯00000000 00000000 00001111ã€‚<br>å’ŒæŸhashå€¼åšâ€œå¼‚æˆ–â€æ“ä½œå¦‚ä¸‹ï¼Œç»“æœå°±æ˜¯æˆªå–äº†æœ€ä½çš„å››ä½å€¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">10100101 11000100 00100101</span><br><span class="line">00000000 00000000 00001111</span><br><span class="line">----------------------------------</span><br><span class="line">00000000 00000000 00000101    //é«˜ä½å…¨éƒ¨å½’é›¶ï¼Œåªä¿ç•™æœ«å››ä½</span><br></pre></td></tr></table></figure><p>æ›´è¯¦ç»†çš„æ­¥éª¤å¦‚ä¸‹ï¼š </p><p><img alt data-src="/images/java-hashmap/%E5%BC%82%E6%88%96%E8%BF%90%E7%AE%97.png"></p><p>3ã€å­˜å‚¨ç»“æ„ </p><p><img alt data-src="/images/java-hashmap/hashmap%E7%BB%93%E6%9E%84.png"><br><img alt data-src="/images/java-hashmap/table%E6%95%B0%E7%BB%84.png"></p><h2 id="è·å–å…ƒç´ "><a href="#è·å–å…ƒç´ " class="headerlink" title="è·å–å…ƒç´ "></a>è·å–å…ƒç´ </h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * Returns the value to which the specified key is mapped,</span><br><span class="line">    * or &#123;@code null&#125; if this map contains no mapping for the key.</span><br><span class="line">    *</span><br><span class="line">    * &lt;p&gt;More formally, if this map contains a mapping from a key</span><br><span class="line">    * &#123;@code k&#125; to a value &#123;@code v&#125; such that &#123;@code (key==null ? k==null :</span><br><span class="line">    * key.equals(k))&#125;, then this method returns &#123;@code v&#125;; otherwise</span><br><span class="line">    * it returns &#123;@code null&#125;.  (There can be at most one such mapping.)</span><br><span class="line">    *</span><br><span class="line">    * &lt;p&gt;A return value of &#123;@code null&#125; does not &lt;i&gt;necessarily&lt;/i&gt;</span><br><span class="line">    * indicate that the map contains no mapping for the key; it&apos;s also</span><br><span class="line">    * possible that the map explicitly maps the key to &#123;@code null&#125;.</span><br><span class="line">    * The &#123;@link #containsKey containsKey&#125; operation may be used to</span><br><span class="line">    * distinguish these two cases.</span><br><span class="line">    *</span><br><span class="line">    * @see #put(Object, Object)</span><br><span class="line">    */</span><br><span class="line">   public V get(Object key) &#123;</span><br><span class="line">       Node&lt;K,V&gt; e;</span><br><span class="line">       return (e = getNode(hash(key), key)) == null ? null : e.value;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   /**</span><br><span class="line">    * Implements Map.get and related methods</span><br><span class="line">    *</span><br><span class="line">    * @param hash hash for key</span><br><span class="line">    * @param key the key</span><br><span class="line">    * @return the node, or null if none</span><br><span class="line">    */</span><br><span class="line">   final Node&lt;K,V&gt; getNode(int hash, Object key) &#123;</span><br><span class="line">       Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k;</span><br><span class="line">       if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;</span><br><span class="line">           //hash &amp; length-1 å®šä½æ•°ç»„ä¸‹æ ‡</span><br><span class="line">           (first = tab[(n - 1) &amp; hash]) != null) &#123;</span><br><span class="line">           if (first.hash == hash &amp;&amp; // always check first node</span><br><span class="line">               ((k = first.key) == key || (key != null &amp;&amp; key.equals(k))))</span><br><span class="line">               return first;</span><br><span class="line">           if ((e = first.next) != null) &#123;</span><br><span class="line">               //ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯TreeNode,åˆ™é‡‡ç”¨ä½æ¡¶+çº¢é»‘æ ‘ç»“æ„ï¼Œ </span><br><span class="line">               //è°ƒç”¨TreeNode.getTreeNode(hash,key), </span><br><span class="line">               //éå†çº¢é»‘æ ‘ï¼Œå¾—åˆ°èŠ‚ç‚¹çš„value  </span><br><span class="line">               if (first instanceof TreeNode)</span><br><span class="line">                   return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">               do &#123;</span><br><span class="line">                   if (e.hash == hash &amp;&amp;</span><br><span class="line">                       ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))</span><br><span class="line">                       return e;</span><br><span class="line">               &#125; while ((e = e.next) != null);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       return null;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>æ ‘èŠ‚ç‚¹çš„æŸ¥æ‰¾ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Calls find for root node.</span><br><span class="line"> */</span><br><span class="line">final TreeNode&lt;K,V&gt; getTreeNode(int h, Object k) &#123;</span><br><span class="line">    return ((parent != null) ? root() : this).find(h, k, null);</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * Finds the node starting at root p with the given hash and key.</span><br><span class="line"> * The kc argument caches comparableClassFor(key) upon first use</span><br><span class="line"> * comparing keys.</span><br><span class="line"> *é€šè¿‡hashå€¼çš„æ¯”è¾ƒï¼Œé€’å½’çš„å»éå†çº¢é»‘æ ‘ï¼Œ</span><br><span class="line"> compareableClassFor(Class k)ï¼šåˆ¤æ–­å®ä¾‹kå¯¹åº”çš„ç±»æ˜¯å¦å®ç°äº†Comparableæ¥å£ï¼Œå¦‚æœå®ç°äº†è¯¥æ¥å£å¹¶</span><br><span class="line"> åœ¨æŸäº›æ—¶å€™å¦‚æœçº¢é»‘æ ‘èŠ‚ç‚¹çš„å…ƒç´ are of the same &quot;class C implements Comparable&lt;C&gt;&quot; type  </span><br><span class="line"> *åˆ©ç”¨ä»–ä»¬çš„compareTo()æ–¹æ³•æ¥æ¯”è¾ƒå¤§å°ï¼Œè¿™é‡Œéœ€è¦é€šè¿‡åå°„æœºåˆ¶æ¥checkä»–ä»¬åˆ°åº•æ˜¯ä¸æ˜¯å±äºåŒä¸€ä¸ªç±»,æ˜¯ä¸æ˜¯å…·æœ‰å¯æ¯”è¾ƒæ€§.</span><br><span class="line"> */</span><br><span class="line">final TreeNode&lt;K,V&gt; find(int h, Object k, Class&lt;?&gt; kc) &#123;</span><br><span class="line">    TreeNode&lt;K,V&gt; p = this;</span><br><span class="line">    do &#123;</span><br><span class="line">        int ph, dir; K pk;</span><br><span class="line">        TreeNode&lt;K,V&gt; pl = p.left, pr = p.right, q;</span><br><span class="line">        if ((ph = p.hash) &gt; h)</span><br><span class="line">            p = pl;</span><br><span class="line">        else if (ph &lt; h)</span><br><span class="line">            p = pr;</span><br><span class="line">        else if ((pk = p.key) == k || (k != null &amp;&amp; k.equals(pk)))</span><br><span class="line">            return p;</span><br><span class="line">        else if (pl == null)</span><br><span class="line">            p = pr;</span><br><span class="line">        else if (pr == null)</span><br><span class="line">            p = pl;</span><br><span class="line">        else if ((kc != null ||</span><br><span class="line">                  (kc = comparableClassFor(k)) != null) &amp;&amp;</span><br><span class="line">                 (dir = compareComparables(kc, k, pk)) != 0)</span><br><span class="line">            p = (dir &lt; 0) ? pl : pr;</span><br><span class="line">        else if ((q = pr.find(h, k, kc)) != null)</span><br><span class="line">            return q;</span><br><span class="line">        else</span><br><span class="line">            p = pl;</span><br><span class="line">    &#125; while (p != null);</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…ƒç´ åŒ…å«containsKey"><a href="#å…ƒç´ åŒ…å«containsKey" class="headerlink" title="å…ƒç´ åŒ…å«containsKey"></a>å…ƒç´ åŒ…å«containsKey</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Returns &lt;tt&gt;true&lt;/tt&gt; if this map contains a mapping for the</span><br><span class="line"> * specified key.</span><br><span class="line"> *</span><br><span class="line"> * @param   key   The key whose presence in this map is to be tested</span><br><span class="line"> * @return &lt;tt&gt;true&lt;/tt&gt; if this map contains a mapping for the specified</span><br><span class="line"> * key.</span><br><span class="line"> */</span><br><span class="line">public boolean containsKey(Object key) &#123;</span><br><span class="line">    return getNode(hash(key), key) != null;</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * Implements Map.get and related methods</span><br><span class="line"> *</span><br><span class="line"> * @param hash hash for key</span><br><span class="line"> * @param key the key</span><br><span class="line"> * @return the node, or null if none</span><br><span class="line"> */</span><br><span class="line">final Node&lt;K,V&gt; getNode(int hash, Object key) &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k;</span><br><span class="line">    if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;</span><br><span class="line">        //åˆ¤æ–­tab[hash]ä½ç½®æ˜¯å¦æœ‰å€¼</span><br><span class="line">        (first = tab[(n - 1) &amp; hash]) != null) &#123;</span><br><span class="line">        if (first.hash == hash &amp;&amp; // always check first node</span><br><span class="line">            ((k = first.key) == key || (key != null &amp;&amp; key.equals(k))))</span><br><span class="line">            return first;</span><br><span class="line">        if ((e = first.next) != null) &#123;</span><br><span class="line">            if (first instanceof TreeNode)</span><br><span class="line">                return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">            //éå†å¯»æ‰¾ </span><br><span class="line">            do &#123;</span><br><span class="line">                if (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))</span><br><span class="line">                    return e;</span><br><span class="line">            &#125; while ((e = e.next) != null);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br><span class="line"> /**</span><br><span class="line">  * Calls find for root node.</span><br><span class="line">  */</span><br><span class="line">  final TreeNode&lt;K,V&gt; getTreeNode(int h, Object k) &#123;</span><br><span class="line">      return ((parent != null) ? root() : this).find(h, k, null);</span><br><span class="line">   &#125;</span><br><span class="line"> /**</span><br><span class="line">     * Returns root of tree containing this node.</span><br><span class="line">     * è·å–çº¢é»‘æ ‘çš„æ ¹</span><br><span class="line">     */</span><br><span class="line">    final TreeNode&lt;K,V&gt; root() &#123;</span><br><span class="line">        for (TreeNode&lt;K,V&gt; r = this, p;;) &#123;</span><br><span class="line">            if ((p = r.parent) == null)</span><br><span class="line">                return r;</span><br><span class="line">            r = p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">/**</span><br><span class="line">     * Finds the node starting at root p with the given hash and key.</span><br><span class="line">     * The kc argument caches comparableClassFor(key) upon first use</span><br><span class="line">     * comparing keys.</span><br><span class="line">     */</span><br><span class="line">    final TreeNode&lt;K,V&gt; find(int h, Object k, Class&lt;?&gt; kc) &#123;// kå³keyï¼Œkcä¸ºnull</span><br><span class="line">        TreeNode&lt;K,V&gt; p = this;</span><br><span class="line">        do &#123;</span><br><span class="line">            int ph, dir; K pk;</span><br><span class="line">            TreeNode&lt;K,V&gt; pl = p.left, pr = p.right, q;</span><br><span class="line">            if ((ph = p.hash) &gt; h)// phå­˜å½“å‰èŠ‚ç‚¹hash</span><br><span class="line">                p = pl;</span><br><span class="line">            else if (ph &lt; h) // æ‰€æŸ¥hashæ¯”å½“å‰èŠ‚ç‚¹hashå¤§</span><br><span class="line">                p = pr;// æŸ¥å³å­æ ‘</span><br><span class="line">            else if ((pk = p.key) == k || (k != null &amp;&amp; k.equals(pk)))</span><br><span class="line">                return p;// hashã€keyå‡ç›¸åŒï¼Œã€æ‰¾åˆ°äº†ï¼ã€‘è¿”å›å½“å‰èŠ‚ç‚¹</span><br><span class="line">            else if (pl == null)// hashç­‰ï¼Œkeyä¸ç­‰ï¼Œä¸”å½“å‰èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹null</span><br><span class="line">                p = pr;//æŸ¥å³å­æ ‘</span><br><span class="line">            else if (pr == null)</span><br><span class="line">                p = pl;</span><br><span class="line">           //get-&gt;getTreeNodeä¼ é€’çš„kcä¸ºnullã€‚||é€»è¾‘æˆ–,çŸ­è·¯è¿ç®—,æœ‰çœŸå³å¯</span><br><span class="line">           // false || (false &amp;&amp; ï¼Ÿï¼Ÿ)</span><br><span class="line">            else if ((kc != null ||</span><br><span class="line">                      (kc = comparableClassFor(k)) != null) &amp;&amp;</span><br><span class="line">                     (dir = compareComparables(kc, k, pk)) != 0)</span><br><span class="line">                p = (dir &lt; 0) ? pl : pr;</span><br><span class="line">            else if ((q = pr.find(h, k, kc)) != null)</span><br><span class="line">                return q;</span><br><span class="line">            else</span><br><span class="line">                p = pl;</span><br><span class="line">        &#125; while (p != null);</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="ç§»é™¤remove"><a href="#ç§»é™¤remove" class="headerlink" title="ç§»é™¤remove"></a>ç§»é™¤remove</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">   * Removes the mapping for the specified key from this map if present.</span><br><span class="line">   *</span><br><span class="line">   * @param  key key whose mapping is to be removed from the map</span><br><span class="line">   * @return the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or</span><br><span class="line">   *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;.</span><br><span class="line">   *         (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map</span><br><span class="line">   *         previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.)</span><br><span class="line">   */</span><br><span class="line">  public V remove(Object key) &#123;</span><br><span class="line">      Node&lt;K,V&gt; e;</span><br><span class="line">      return (e = removeNode(hash(key), key, null, false, true)) == null ?</span><br><span class="line">          null : e.value;</span><br><span class="line">  &#125;</span><br><span class="line">   /**</span><br><span class="line">   * Implements Map.remove and related methods</span><br><span class="line">   *</span><br><span class="line">   * @param hash hash for key</span><br><span class="line">   * @param key the key</span><br><span class="line">   * @param value the value to match if matchValue, else ignored</span><br><span class="line">   * @param matchValue if true only remove if value is equal</span><br><span class="line">   * @param movable if false do not move other nodes while removing</span><br><span class="line">   * @return the node, or null if none</span><br><span class="line">   */</span><br><span class="line">  final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value,</span><br><span class="line">                             boolean matchValue, boolean movable) &#123;</span><br><span class="line">      Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, index;</span><br><span class="line">      if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;</span><br><span class="line">          (p = tab[index = (n - 1) &amp; hash]) != null) &#123;</span><br><span class="line">          Node&lt;K,V&gt; node = null, e; K k; V v;</span><br><span class="line">          if (p.hash == hash &amp;&amp;</span><br><span class="line">          //å…ˆæ¯”è¾ƒå†…å­˜åœ°å€ï¼Œå¦‚æœåœ°å€ä¸ä¸€è‡´ï¼Œå†è°ƒç”¨equalsè¿›è¡Œæ¯”è¾ƒ</span><br><span class="line">              ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))</span><br><span class="line">              node = p;</span><br><span class="line">          else if ((e = p.next) != null) &#123;</span><br><span class="line">              //å¦‚æœæ˜¯ä»¥çº¢é»‘æ ‘å¤„ç†å†²çªï¼Œåˆ™é€šè¿‡getTreeNodeæŸ¥æ‰¾</span><br><span class="line">              if (p instanceof TreeNode)</span><br><span class="line">                  node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</span><br><span class="line">              else &#123;</span><br><span class="line">                   //å¦‚æœæ˜¯ä»¥é“¾å¼çš„æ–¹å¼å¤„ç†å†²çªï¼Œåˆ™é€šè¿‡éå†é“¾è¡¨æ¥å¯»æ‰¾èŠ‚ç‚¹</span><br><span class="line">                  do &#123;</span><br><span class="line">                      if (e.hash == hash &amp;&amp;</span><br><span class="line">                          ((k = e.key) == key ||</span><br><span class="line">                           (key != null &amp;&amp; key.equals(k)))) &#123;</span><br><span class="line">                          node = e;</span><br><span class="line">                          break;</span><br><span class="line">                      &#125;</span><br><span class="line">                      p = e;</span><br><span class="line">                  &#125; while ((e = e.next) != null);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">           //æ¯”å¯¹æ‰¾åˆ°çš„keyçš„valueè·Ÿè¦åˆ é™¤çš„æ˜¯å¦åŒ¹é…</span><br><span class="line">          if (node != null &amp;&amp; (!matchValue || (v = node.value) == value ||</span><br><span class="line">                               (value != null &amp;&amp; value.equals(v)))) &#123;</span><br><span class="line">              if (node instanceof TreeNode)</span><br><span class="line">                  ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable);</span><br><span class="line">              else if (node == p)</span><br><span class="line">                  tab[index] = node.next;</span><br><span class="line">              else</span><br><span class="line">                  p.next = node.next;</span><br><span class="line">              //å·²ä»ç»“æ„ä¸Šä¿®æ”¹ æ­¤åˆ—è¡¨çš„æ¬¡æ•°</span><br><span class="line">              ++modCount;</span><br><span class="line">              --size;</span><br><span class="line">              //å›è°ƒ</span><br><span class="line">              afterNodeRemoval(node);</span><br><span class="line">              return node;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      return null;</span><br><span class="line">  &#125;</span><br><span class="line">      /**</span><br><span class="line">       * Removes the given node, that must be present before this call.</span><br><span class="line">       * This is messier than typical red-black deletion code because we</span><br><span class="line">       * cannot swap the contents of an interior node with a leaf</span><br><span class="line">       * successor that is pinned by &quot;next&quot; pointers that are accessible</span><br><span class="line">       * independently during traversal. So instead we swap the tree</span><br><span class="line">       * linkages. If the current tree appears to have too few nodes,</span><br><span class="line">       * the bin is converted back to a plain bin. (The test triggers</span><br><span class="line">       * somewhere between 2 and 6 nodes, depending on tree structure).</span><br><span class="line">       */</span><br><span class="line">      final void removeTreeNode(HashMap&lt;K,V&gt; map, Node&lt;K,V&gt;[] tab,</span><br><span class="line">                                boolean movable) &#123;</span><br><span class="line">          int n;</span><br><span class="line">          if (tab == null || (n = tab.length) == 0)</span><br><span class="line">              return;</span><br><span class="line">          int index = (n - 1) &amp; hash;</span><br><span class="line">          TreeNode&lt;K,V&gt; first = (TreeNode&lt;K,V&gt;)tab[index], root = first, rl;</span><br><span class="line">          TreeNode&lt;K,V&gt; succ = (TreeNode&lt;K,V&gt;)next, pred = prev;</span><br><span class="line">          if (pred == null)</span><br><span class="line">              tab[index] = first = succ;</span><br><span class="line">          else</span><br><span class="line">              pred.next = succ;</span><br><span class="line">          if (succ != null)</span><br><span class="line">              succ.prev = pred;</span><br><span class="line">          if (first == null)</span><br><span class="line">              return;</span><br><span class="line">          if (root.parent != null)</span><br><span class="line">              root = root.root();</span><br><span class="line">          if (root == null || root.right == null ||</span><br><span class="line">              (rl = root.left) == null || rl.left == null) &#123;</span><br><span class="line">              tab[index] = first.untreeify(map);  // too small</span><br><span class="line">              return;</span><br><span class="line">          &#125;</span><br><span class="line">          TreeNode&lt;K,V&gt; p = this, pl = left, pr = right, replacement;</span><br><span class="line">          if (pl != null &amp;&amp; pr != null) &#123;</span><br><span class="line">              TreeNode&lt;K,V&gt; s = pr, sl;</span><br><span class="line">              while ((sl = s.left) != null) // find successor</span><br><span class="line">                  s = sl;</span><br><span class="line">              boolean c = s.red; s.red = p.red; p.red = c; // swap colors</span><br><span class="line">              TreeNode&lt;K,V&gt; sr = s.right;</span><br><span class="line">              TreeNode&lt;K,V&gt; pp = p.parent;</span><br><span class="line">              if (s == pr) &#123; // p was s&apos;s direct parent</span><br><span class="line">                  p.parent = s;</span><br><span class="line">                  s.right = p;</span><br><span class="line">              &#125;</span><br><span class="line">              else &#123;</span><br><span class="line">                  TreeNode&lt;K,V&gt; sp = s.parent;</span><br><span class="line">                  if ((p.parent = sp) != null) &#123;</span><br><span class="line">                      if (s == sp.left)</span><br><span class="line">                          sp.left = p;</span><br><span class="line">                      else</span><br><span class="line">                          sp.right = p;</span><br><span class="line">                  &#125;</span><br><span class="line">                  if ((s.right = pr) != null)</span><br><span class="line">                      pr.parent = s;</span><br><span class="line">              &#125;</span><br><span class="line">              p.left = null;</span><br><span class="line">              if ((p.right = sr) != null)</span><br><span class="line">                  sr.parent = p;</span><br><span class="line">              if ((s.left = pl) != null)</span><br><span class="line">                  pl.parent = s;</span><br><span class="line">              if ((s.parent = pp) == null)</span><br><span class="line">                  root = s;</span><br><span class="line">              else if (p == pp.left)</span><br><span class="line">                  pp.left = s;</span><br><span class="line">              else</span><br><span class="line">                  pp.right = s;</span><br><span class="line">              if (sr != null)</span><br><span class="line">                  replacement = sr;</span><br><span class="line">              else</span><br><span class="line">                  replacement = p;</span><br><span class="line">          &#125;</span><br><span class="line">          else if (pl != null)</span><br><span class="line">              replacement = pl;</span><br><span class="line">          else if (pr != null)</span><br><span class="line">              replacement = pr;</span><br><span class="line">          else</span><br><span class="line">              replacement = p;</span><br><span class="line">          if (replacement != p) &#123;</span><br><span class="line">              TreeNode&lt;K,V&gt; pp = replacement.parent = p.parent;</span><br><span class="line">              if (pp == null)</span><br><span class="line">                  root = replacement;</span><br><span class="line">              else if (p == pp.left)</span><br><span class="line">                  pp.left = replacement;</span><br><span class="line">              else</span><br><span class="line">                  pp.right = replacement;</span><br><span class="line">              p.left = p.right = p.parent = null;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          TreeNode&lt;K,V&gt; r = p.red ? root : balanceDeletion(root, replacement);</span><br><span class="line"></span><br><span class="line">          if (replacement == p) &#123;  // detach</span><br><span class="line">              TreeNode&lt;K,V&gt; pp = p.parent;</span><br><span class="line">              p.parent = null;</span><br><span class="line">              if (pp != null) &#123;</span><br><span class="line">                  if (p == pp.left)</span><br><span class="line">                      pp.left = null;</span><br><span class="line">                  else if (p == pp.right)</span><br><span class="line">                      pp.right = null;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          if (movable)</span><br><span class="line">              moveRootToFront(tab, r);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><p>åœ¨åˆ›å»º HashMap æ—¶æ ¹æ®å®é™…éœ€è¦é€‚å½“åœ°è°ƒæ•´ load factor çš„å€¼ï¼›å¦‚æœç¨‹åºæ¯”è¾ƒå…³å¿ƒç©ºé—´å¼€é”€ã€å†…å­˜æ¯”è¾ƒç´§å¼ ï¼Œå¯ä»¥é€‚å½“åœ°å¢åŠ è´Ÿè½½å› å­ï¼›å¦‚æœç¨‹åºæ¯”è¾ƒå…³å¿ƒæ—¶é—´å¼€é”€ï¼Œå†…å­˜æ¯”è¾ƒå®½è£•åˆ™å¯ä»¥é€‚å½“çš„å‡å°‘è´Ÿè½½å› å­ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç¨‹åºå‘˜æ— éœ€æ”¹å˜è´Ÿè½½å› å­çš„å€¼ã€‚</p><p>å¦‚æœå¼€å§‹å°±çŸ¥é“ HashMap ä¼šä¿å­˜å¤šä¸ª key-value å¯¹ï¼Œå¯ä»¥åœ¨åˆ›å»ºæ—¶å°±ä½¿ç”¨è¾ƒå¤§çš„åˆå§‹åŒ–å®¹é‡ï¼Œå¦‚æœ HashMap ä¸­ Entry çš„æ•°é‡ä¸€ç›´ä¸ä¼šè¶…è¿‡æé™å®¹é‡ï¼ˆcapacity * load factorï¼‰ï¼ŒHashMap å°±æ— éœ€è°ƒç”¨ resize() æ–¹æ³•é‡æ–°åˆ†é… table æ•°ç»„ï¼Œä»è€Œä¿è¯è¾ƒå¥½çš„æ€§èƒ½ã€‚å½“ç„¶ï¼Œå¼€å§‹å°±å°†åˆå§‹å®¹é‡è®¾ç½®å¤ªé«˜å¯èƒ½ä¼šæµªè´¹ç©ºé—´ï¼ˆç³»ç»Ÿéœ€è¦åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º capacity çš„ Entry æ•°ç»„ï¼‰ï¼Œå› æ­¤åˆ›å»º HashMap æ—¶åˆå§‹åŒ–å®¹é‡è®¾ç½®ä¹Ÿéœ€è¦å°å¿ƒå¯¹å¾…ã€‚</p><p>HashMapé«˜æ€§èƒ½éœ€è¦ä»¥ä¸‹å‡ ç‚¹ï¼š </p><ul><li>é«˜æ•ˆçš„hashç®—æ³• </li><li>ä¿è¯hashå€¼åˆ°å†…å­˜åœ°å€ï¼ˆæ•°ç»„ç´¢å¼•ï¼‰çš„æ˜ å°„é€Ÿåº¦ </li><li>æ ¹æ®å†…å­˜åœ°å€ï¼ˆæ•°ç»„ç´¢å¼•ï¼‰å¯ä»¥ç›´æ¥å¾—åˆ°ç›¸åº”çš„å€¼</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> HashMap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡ILåˆ†æC#ä¸­çš„å§”æ‰˜ã€äº‹ä»¶ã€Funcã€Actionã€Predicateä¹‹é—´çš„åŒºåˆ«ä¸è”ç³»</title>
      <link href="/csharp-il-delegate-event-func-action-predicate.html"/>
      <url>/csharp-il-delegate-event-func-action-predicate.html</url>
      
        <content type="html"><![CDATA[<p>ä¸€ç›´ä»¥æ¥éƒ½æ˜¯å¯¹äºäº‹ä»¶ä¸å§”æ‰˜æ¯”è¾ƒæ··æ·†ï¼Œè€Œä¸”ä¸å¤ªä¼šç”¨ã€‚æ‰¾äº†ä¸ªæ—¶é—´ï¼Œæ€»ç»“äº†ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ¸…æ™°äº†å¾ˆå¤šã€‚</p><p>å…ˆè¯´ä¸€ä¸‹ä¸ªäººç†è§£çš„ç»“è®ºå§ï¼š</p><blockquote><p>delegateæ˜¯C#ä¸­çš„ä¸€ç§ç±»å‹ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªèƒ½å¤ŸæŒæœ‰å¯¹æŸä¸ªæ–¹æ³•çš„å¼•ç”¨çš„ç±»ã€‚</p></blockquote><p>delegateå£°æ˜çš„å˜é‡ä¸delegateå£°æ˜çš„äº‹ä»¶ï¼Œå¹¶æ²¡æœ‰æœ¬è´¨çš„åŒºåˆ«ï¼Œäº‹ä»¶æ˜¯åœ¨delegateå£°æ˜å˜é‡çš„åŸºç¡€ä¸ŠåŒ…è£…è€Œæˆçš„ï¼Œç±»ä¼¼äºå˜é‡ä¸å±æ€§çš„å…³ç³»ï¼ˆåœ¨ILä»£ç ä¸­å¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ªdelegateå£°æ˜çš„äº‹ä»¶éƒ½å¯¹åº”æ˜¯ç§æœ‰çš„delegateå£°æ˜çš„å˜é‡ï¼‰ï¼Œæå‡äº†å®‰å…¨æ€§ã€‚</p><p>Action ä¸Funcï¼šè¿™ä¸¤ä¸ªå…¶å®è¯´ç™½äº†å°±æ˜¯ç³»ç»Ÿå®šä¹‰å¥½çš„Delegateï¼Œä»–æœ‰å¾ˆå¤šé‡è½½çš„æ–¹æ³•ï¼Œä¾¿äºå„ç§åº”ç”¨æƒ…å†µä¸‹çš„è°ƒç”¨ã€‚ä»–åœ¨ç³»ç»Ÿçš„Systemå‘½åç©ºé—´ä¸‹ï¼Œå› æ­¤å…¨å±€å¯è§ã€‚</p><p>é¦–å…ˆäº†è§£ä¸€ä¸‹ï¼Œ ILDasmä¸­å›¾æ ‡å«ä¹‰ï¼š<br><img alt data-src="/images/csharp-delegate/ILDasm.png"><br>è¯¥å›¾æ¥è‡ªï¼š<a href="http://www.cnblogs.com/zery/p/3366175.html" target="_blank" rel="noopener">http://www.cnblogs.com/zery/p/3366175.html</a></p><p>å§”æ‰˜åˆ›å»ºæ­¥éª¤ï¼š</p><ol><li><font color="DeepPink">ç”¨delegateå…³é”®å­—åˆ›å»ºä¸€ä¸ªå§”æ‰˜ï¼ŒåŒ…æ‹¬å£°æ˜è¿”å›å€¼å’Œå‚æ•°ç±»å‹ã€‚</font></li><li><font color="DeepPink">ä½¿ç”¨çš„åœ°æ–¹æ¥æ”¶è¿™ä¸ªå§”æ‰˜ã€‚</font></li><li><font color="DeepPink">åˆ›å»ºè¿™ä¸ªå§”æ‰˜çš„å®ä¾‹å¹¶æŒ‡å®šä¸€ä¸ªè¿”å›å€¼å’Œå‚æ•°ç±»å‹åŒ¹é…çš„æ–¹æ³•ä¼ é€’è¿‡å»ã€‚</font></li></ol><h1 id="ä¸€ã€äº‹ä»¶ä¸å§”æ‰˜"><a href="#ä¸€ã€äº‹ä»¶ä¸å§”æ‰˜" class="headerlink" title="ä¸€ã€äº‹ä»¶ä¸å§”æ‰˜"></a>ä¸€ã€äº‹ä»¶ä¸å§”æ‰˜</h1><p>æ–°å»ºä¸€ä¸ªäº‹ä»¶å§”æ‰˜æµ‹è¯•é¡¹ç›®ï¼šEventDelegateTestã€‚</p><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">namespace EventDelegateTest</span><br><span class="line">&#123;</span><br><span class="line">    public class TestClass</span><br><span class="line">    &#123;</span><br><span class="line">        public delegate int delegateAction();</span><br><span class="line">        public event delegateAction OnActionEvent;</span><br><span class="line">        public delegateAction daNew;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ä»£ç åï¼Œä½¿ç”¨ Visual Studio 2010è‡ªå¸¦çš„ILDASM.EXEï¼š<br><img alt data-src="/images/csharp-delegate/IL%E5%8F%8D%E6%B1%87%E7%BC%96%E7%A8%8B%E5%BA%8F.png"></p><p>æ‰“å¼€è¯¥dllï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š<br><img alt data-src="/images/csharp-delegate/%E5%8F%8D%E7%BC%96%E8%AF%91DLL%E4%BF%A1%E6%81%AF.png"></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºå¦‚ä¸‹å‡ ç‚¹ä¿¡æ¯ï¼š</p><h2 id="1ã€delegate"><a href="#1ã€delegate" class="headerlink" title="1ã€delegate"></a>1ã€delegate</h2><p>å§”æ‰˜ public delegate int delegateAction();åœ¨ILä¸­æ˜¯ä»¥ç±»ï¼ˆdelegateActionï¼‰çš„å½¢å¼å­˜åœ¨çš„<br>.NETå°†å§”æ‰˜å®šä¹‰ä¸ºä¸€ä¸ªå¯†å°ç±»ï¼Œæ´¾ç”Ÿè‡ªåŸºç±»System.MulticastDelegateï¼Œå¹¶ç»§æ‰¿äº†åŸºç±»çš„ä¸‰ä¸ªæ–¹æ³•:<br><img alt data-src="/images/csharp-delegate/delegateAction.png"></p><h2 id="2ã€event"><a href="#2ã€event" class="headerlink" title="2ã€event"></a>2ã€event</h2><p>public event delegateAction OnActionEvent;åœ¨ILä¸­ä¸ä»…ä»…å¯¹åº”event OnActionEventè€Œä¸”è¿˜å¯¹åº”ä¸€ä¸ªfield OnActionEvent;è€Œfield OnActionEventä¸ public delegateAction daNewç”Ÿæˆçš„field daNewæ˜¯ä¸€æ ·çš„.<br><img alt data-src="/images/csharp-delegate/OnActionEvent.png"><br><img alt data-src="/images/csharp-delegate/daNew.png"><br>éƒ½æ˜¯ä»¥å­—æ®µï¼ˆfield ï¼‰çš„å½¢å¼å­˜åœ¨çš„ã€‚<br>åŒå‡»event OnActionEventå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š<br><img alt data-src="/images/csharp-delegate/event-OnActionEvent.png"></p><p>åœ¨ILä¸­äº‹ä»¶è¢«å°è£…æˆäº†åŒ…å«ä¸€ä¸ªadd_å‰ç¼€å’Œä¸€ä¸ªremove_å‰ç¼€çš„çš„ä»£ç æ®µã€‚<br>å…¶ä¸­ï¼Œadd_å‰ç¼€çš„æ–¹æ³•å…¶å®æ˜¯é€šè¿‡è°ƒç”¨Delegate.Combine()æ–¹æ³•æ¥å®ç°çš„ï¼Œç»„æˆäº†ä¸€ä¸ªå¤šæ’­å§”æ‰˜ï¼›remove_å°±æ˜¯è°ƒç”¨Delegate.Remove()æ–¹æ³•ï¼Œç”¨äºç§»é™¤å¤šæ’­å§”æ‰˜ä¸­çš„æŸä¸ªå§”æ‰˜ã€‚</p><blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼šäº‹ä»¶å…¶å®å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¤šæ’­å§”æ‰˜ã€‚</p></blockquote><p>é‚£ä¹ˆå¯¹äºäº‹ä»¶è¿›è¡Œè¿™ä¸€æ¬¡å°è£…æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ<br>1ã€å› ä¸ºdelegateå¯ä»¥æ”¯æŒçš„æ“ä½œéå¸¸å¤šï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å†™onXXXChanged += aaaFuncï¼ŒæŠŠæŸä¸ªå‡½æ•°æŒ‡é’ˆæŒ‚è½½åˆ°è¿™ä¸ªå§”æ‰˜ä¸Šé¢ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥ç®€å•ç²—æš´åœ°ç›´æ¥å†™onXXXChanged = aaaFuncï¼Œè®©è¿™ä¸ªå§”æ‰˜åªåŒ…å«è¿™ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚ä¸è¿‡è¿™æ ·ä¸€æ¥ä¼šäº§ç”Ÿä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬ç”¨onXXXChanged = aaaFuncè¿™æ ·çš„å†™æ³•ï¼Œé‚£ä¹ˆä¼šæŠŠè¿™ä¸ªå§”æ‰˜å·²æ‹¥æœ‰çš„å…¶ä»–å‡½æ•°æŒ‡é’ˆç»™è¦†ç›–æ‰ï¼Œè¿™å¤§æ¦‚ä¸æ˜¯å®šä¹‰onXXXChangedçš„ç¨‹åºå‘˜æƒ³è¦çœ‹åˆ°çš„ç»“æœã€‚</p><blockquote><p>å°æ³¨ï¼šè™½ç„¶äº‹ä»¶ä¸èƒ½ç›´æ¥=æŸä¸ªå‡½æ•°ï¼Œä¹Ÿä¸å¯ä»¥ç›´æ¥=null</p></blockquote><p><img alt data-src="/images/csharp-delegate/event_not_null.png"></p><p>2ã€è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯onXXXChangedè¿™ä¸ªå§”æ‰˜åº”è¯¥ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼ˆå³è°ƒç”¨å®ƒæ‰€åŒ…å«çš„å‡½æ•°æŒ‡é’ˆï¼‰ã€‚ä»é¢å‘å¯¹è±¡çš„è§’åº¦æ¥è¯´ï¼ŒXXXæ”¹å˜äº†è¿™ä¸ªäº‹å®ï¼ˆå³onXXXChanedçš„å­—é¢å«ä¹‰ï¼‰åº”è¯¥ç”±åŒ…å«å®ƒçš„é‚£ä¸ªå¯¹è±¡æ¥å†³å®šã€‚ä½†å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªå¯¹è±¡çš„å¤–éƒ¨ç¯å¢ƒè°ƒç”¨onXXXChangedï¼Œè¿™æ—¢äº§ç”Ÿäº†å®‰å…¨é—®é¢˜ä¹Ÿä¸ç¬¦åˆé¢å‘å¯¹è±¡çš„åˆè¡·ã€‚<br>è¯´åˆ°è¿™é‡Œå¯¹äºäº‹ä»¶ä¸å§”æ‰˜çš„ç®¡ç†ç®—æ˜¯è¯´æ˜ç™½äº†ï¼Œé‚£ä¹ˆå¹³æ—¶å¸¸ç”¨çš„Actionä¸Funcï¼Œä¸å§”æ‰˜åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</p><h1 id="äºŒã€Action-ä¸Func"><a href="#äºŒã€Action-ä¸Func" class="headerlink" title="äºŒã€Action ä¸Func"></a>äºŒã€Action ä¸Func</h1><p><strong>Action å§”æ‰˜ï¼šå°è£…ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…·æœ‰å‚æ•°ï¼ˆ0åˆ°16ä¸ªå‚æ•°ï¼‰å¹¶ä¸”ä¸è¿”å›å€¼ã€‚</strong><br>å…·ä½“å½¢å¼å¦‚ä¸‹ï¼š<a href="https://msdn.microsoft.com/zh-cn/library/system.action(v=vs.110).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/zh-cn/library/system.action(v=vs.110).aspx</a><br><img alt data-src="/images/csharp-delegate/Action.png"></p><p><strong>Func&lt;T, TResult&gt; å§”æ‰˜ï¼šå°è£…ä¸€ä¸ªå…·æœ‰å‚æ•°ï¼ˆ0åˆ°16ä¸ªå‚æ•°ï¼‰å¹¶è¿”å› TResult å‚æ•°æŒ‡å®šçš„ç±»å‹å€¼çš„æ–¹æ³•ã€‚</strong><br>å…·ä½“å½¢å¼å¦‚ä¸‹ï¼š<a href="https://msdn.microsoft.com/zh-cn/library/bb534960(v=vs.110).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/zh-cn/library/bb534960(v=vs.110).aspx</a><br><img alt data-src="/images/csharp-delegate/Func_T_TResult.png"></p><p>é‚£ä¹ˆè¿™Actionä¸Funcæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ<br>1ã€Actionï¼ˆä»¥Action&lt;T1, T2&gt; å§”æ‰˜ï¼šå°è£…ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…·æœ‰ä¸¤ä¸ªå‚æ•°å¹¶ä¸”ä¸è¿”å›å€¼ä¸ºä¾‹ï¼‰<br>ä»å¾®è½¯å…¬å¸ƒçš„æºç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¦‚ä¸‹å®ç°ï¼š<br><img alt data-src="/images/csharp-delegate/Action_T.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public Action&lt;bool,bool&gt;  ac;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªå£°æ˜å°±æ˜¯ï¼šè¯¥æ–¹æ³•å…·æœ‰ä¸¤ä¸ªå‚æ•°å¹¶ä¸”ä¸è¿”å›å€¼çš„å§”æ‰˜ã€‚<br>å…¶ä½™ä½¿ç”¨æ–¹å¼ä¸å§”æ‰˜å˜é‡ä¸€æ ·ã€‚<br>2ã€Funcï¼ˆä»¥Func&lt;T1, T2, TResult&gt; å§”æ‰˜ï¼šå°è£…ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªå‚æ•°å¹¶è¿”å› TResult å‚æ•°æŒ‡å®šçš„ç±»å‹å€¼çš„æ–¹æ³•ä¸ºä¾‹ï¼‰<br>ä»å¾®è½¯å…¬å¸ƒçš„æºç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¦‚ä¸‹å®ç°ï¼š<br><img alt data-src="/images/csharp-delegate/Func_T_TResult_%E6%BA%90%E7%A0%81.png"></p><p>æ­¤å¤„ï¼Œå¯ä»¥çœ‹å‡ºFuncä¸Actionæ˜¯ç±»ä¼¼çš„ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ï¼ŒFuncå¿…é¡»æŒ‡å®šè¿”å›å€¼çš„ç±»å‹ï¼Œä½¿ç”¨æ–¹å¼ä¸å§”æ‰˜å’±ä»¬è‡ªå·±ä½¿ç”¨å§”æ‰˜å˜é‡æ˜¯ä¸€æ ·çš„ï¼Œç›´æ¥ä½¿ç”¨ç›¸åº”å‚æ•°çš„Funcæˆ–è€…Actionå£°æ˜å˜é‡ï¼Œ=æˆ–è€…+=æŒ‚è½½å‡½æ•°ï¼ˆæ–¹æ³•å³å¯ï¼‰<br>è¿™ä¸¤ä¸ªå…¶å®è¯´ç™½äº†å°±æ˜¯ç³»ç»Ÿå®šä¹‰å¥½çš„Delegateï¼Œä»–æœ‰å¾ˆå¤šé‡è½½çš„æ–¹æ³•ï¼Œä¾¿äºå„ç§åº”ç”¨æƒ…å†µä¸‹çš„è°ƒç”¨ã€‚ä»–åœ¨ç³»ç»Ÿçš„Systemå‘½åç©ºé—´ä¸‹ï¼Œå› æ­¤å…¨å±€å¯è§ã€‚</p><h1 id="ä¸‰ã€Predicate"><a href="#ä¸‰ã€Predicate" class="headerlink" title="ä¸‰ã€Predicate"></a>ä¸‰ã€Predicate</h1><p><strong>æ˜¯è¿”å›boolå‹çš„æ³›å‹å§”æ‰˜ï¼ŒPredicateæœ‰ä¸”åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›å€¼å›ºå®šä¸ºboolã€‚è¡¨ç¤ºå®šä¹‰ä¸€ç»„æ¡ä»¶å¹¶ç¡®å®šæŒ‡å®šå¯¹è±¡æ˜¯å¦ç¬¦åˆè¿™äº›æ¡ä»¶çš„æ–¹æ³•ã€‚</strong></p><p>æ­¤æ–¹æ³•å¸¸åœ¨é›†åˆï¼ˆArray å’Œ List<t>ï¼‰çš„æŸ¥æ‰¾ä¸­è¢«ç”¨åˆ°ï¼Œå¦‚ï¼šæ•°ç»„ï¼Œæ­£åˆ™æ‹¼é…çš„ç»“æœé›†ä¸­è¢«ç”¨åˆ°ã€‚</t></p><p>å®˜æ–¹æ–‡æ¡£ï¼š<br><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.predicate-1?redirectedfrom=MSDN&amp;view=netframework-4.8" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/dotnet/api/system.predicate-1?redirectedfrom=MSDN&amp;view=netframework-4.8</a></p><p>å…·ä½“ç”¨æ³•demoå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.ComponentModel;</span><br><span class="line">using System.Data;</span><br><span class="line">using System.Drawing;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Windows.Forms;</span><br><span class="line"> </span><br><span class="line">namespace IconTest</span><br><span class="line">&#123;</span><br><span class="line">    public partial class Form2 : Form</span><br><span class="line">    &#123;</span><br><span class="line">        Predicate&lt;int&gt; myPredicate;</span><br><span class="line">        int[] myNum = new int[8] &#123; 12, 33, 89, 21, 15, 29, 40, 52 &#125;;</span><br><span class="line">        public int[] myResult;</span><br><span class="line">        public Form2()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            myPredicate = delegate(int curNum) ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€</span><br><span class="line">            &#123;</span><br><span class="line">                if (curNum % 2 == 0)</span><br><span class="line">                &#123;</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                    return false;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        private void Form2_Load(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            myResult = Array.FindAll(myNum, myPredicate);</span><br><span class="line">        &#125;          </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šä¾‹ä¸­è¯´æ˜äº†Predicateçš„ä½¿ç”¨ï¼ŒFindAllæ–¹æ³•ä¸­ï¼Œå‚æ•°2å³æ˜¯ä¸€ä¸ªPredicateï¼Œåœ¨å…·ä½“çš„æ‰§è¡Œä¸­ï¼Œæ¯ä¸€ä¸ªæ•°ç»„çš„å…ƒç´ éƒ½ä¼šæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ï¼Œå¦‚æœæ»¡è¶³è¦æ±‚è¿”å›trueï¼Œå¹¶ä¼šè¢«å­˜æ”¾åœ¨ç»“æœé›†ä¸­ï¼Œä¸ç¬¦åˆçš„åˆ™è¢«å‰”é™¤ï¼Œæœ€ç»ˆè¿”å›çš„é›†åˆï¼Œå³æ˜¯ç»“æœåˆ¤æ–­åæƒ³è¦çš„é›†åˆã€‚<br>Array.FindAll æ³›å‹æ–¹æ³•ï¼š<br><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.array.findall?redirectedfrom=MSDN&amp;view=netframework-4.8#System_Array_FindAll__1___0___System_Predicate___0" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/dotnet/api/system.array.findall?redirectedfrom=MSDN&amp;view=netframework-4.8#System_Array_FindAll__1___0___System_Predicate___0</a>__<br>ä»¥ä¸Šä»£ç æ‰§è¡Œç»“æœä¸ºï¼š<br><img alt data-src="/images/csharp-delegate/Form2_Load.png"><br>é‚£ä¹ˆPredicate<t>ä¸å§”æ‰˜åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ<br><img alt data-src="/images/csharp-delegate/Predicate_T.png"></t></p><p>ä»å¾®è½¯æºç ä¸­å¯ä»¥çœ‹å‡ºPredicate<t>æ˜¯è¿”å›boolå‹çš„æ³›å‹å§”æ‰˜ï¼Œä»æœ¬è´¨ä¸Šæ¥è¯´ä¸Funcã€Actionã€äº‹ä»¶ã€å§”æ‰˜å˜é‡å¹¶æ— æœ¬è´¨åŒºåˆ«ã€‚</t></p><h1 id="å››ã€èµ„æ–™"><a href="#å››ã€èµ„æ–™" class="headerlink" title="å››ã€èµ„æ–™"></a>å››ã€èµ„æ–™</h1><p>å‚è€ƒæ–‡ç« ï¼š<br><a href="http://www.zhihu.com/question/28932542" target="_blank" rel="noopener">http://www.zhihu.com/question/28932542</a></p><p>å…³äºäº‹ä»¶éƒ¨åˆ†åº”ç”¨æ³¨æ„å¯ä»¥å‚è€ƒï¼š<br><a href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html" target="_blank" rel="noopener">http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html</a></p><p>.NET Framework æºç ï¼š<br><a href="https://referencesource.microsoft.com" target="_blank" rel="noopener">https://referencesource.microsoft.com</a><br>Delegate ç±»:<br><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.delegate?redirectedfrom=MSDN&amp;view=netframework-4.8" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/dotnet/api/system.delegate?redirectedfrom=MSDN&amp;view=netframework-4.8</a></p><p><img alt data-src="/images/csharp-delegate/%E5%A7%94%E6%89%98%E5%9B%BE%E8%A7%A3.png"></p>]]></content>
      
      
      <categories>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
            <tag> Delegate </tag>
            
            <tag> Action </tag>
            
            <tag> Predicate </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
