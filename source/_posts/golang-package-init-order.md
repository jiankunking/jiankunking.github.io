---
title: Golang 初始化顺序
abbrlink: 55125
date: 2019-09-01 09:29:22
tags:
  - Go
  - Init
  - Order
---

> golang package init order

<!-- more -->

Go程序的初始化和执行总是从 main.main  函数开始的。但是如果 main  包里导入了其它的包，则会按照顺序将它们包含进 main  包里（这里的导入顺序依赖具体实现，一般可能是以文件名或包路径名的字符串顺序导入）。如果某个包被多次导入的话，在执行的时候只会导入一次。当一个包被导入时，如果它还导入了其它的包，则先将其它的包包含进来，然后创建和初始化这个包的常量和变量。然后就是调用包里的 init  函数，如果一个包有多个 init  函数的话，实现可能是以文件名的顺序调用，同一个文件内的多个 init  则是以出现的顺序依次调用（ init  不是普通函数，可以定义有多个，所以不能被其它函数调用）。最终，在 main  包的所有包常量、包变量被创建和初始化，并且 init  函数被执行后，才会进入 main.main  函数，程序开始正常执行。下图是Go程序函数启动顺序的示意图：

![](/images/golang-package-init-order/init.png)

要注意的是，在 main.main  函数执行之前所有代码都运行在同一个Goroutine中，也是运行在程序的主系统线程中。如果某个 init  函数内部用go关键字启动了新的Goroutine的话，新的Goroutine和 main.main  函数是并发执行的。
因为所有的 init  函数和 main  函数都是在主线程完成，它们也是满足顺序一致性模型的。

> 整理自：Go语言高级编程 作者：柴树杉、曹春晖
> 图片来自：beego官网router部分